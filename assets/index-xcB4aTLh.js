var qR=e=>{throw TypeError(e)};var ZS=(e,i,s)=>i.has(e)||qR("Cannot "+s);var Xn=(e,i,s)=>(ZS(e,i,"read from private field"),s?s.call(e):i.get(e)),xl=(e,i,s)=>i.has(e)?qR("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(e):i.set(e,s),Po=(e,i,s,a)=>(ZS(e,i,"write to private field"),a?a.call(e,s):i.set(e,s),s),$u=(e,i,s)=>(ZS(e,i,"access private method"),s);var ZE=(e,i,s,a)=>({set _(b){Po(e,i,b,s)},get _(){return Xn(e,i,a)}});function _mergeNamespaces(e,i){for(var s=0;s<i.length;s++){const a=i[s];if(typeof a!="string"&&!Array.isArray(a)){for(const b in a)if(b!=="default"&&!(b in e)){const et=Object.getOwnPropertyDescriptor(a,b);et&&Object.defineProperty(e,b,et.get?et:{enumerable:!0,get:()=>a[b]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))a(b);new MutationObserver(b=>{for(const et of b)if(et.type==="childList")for(const nt of et.addedNodes)nt.tagName==="LINK"&&nt.rel==="modulepreload"&&a(nt)}).observe(document,{childList:!0,subtree:!0});function s(b){const et={};return b.integrity&&(et.integrity=b.integrity),b.referrerPolicy&&(et.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?et.credentials="include":b.crossOrigin==="anonymous"?et.credentials="omit":et.credentials="same-origin",et}function a(b){if(b.ep)return;b.ep=!0;const et=s(b);fetch(b.href,et)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$2=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r$1=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$4=Symbol.for("react.forward_ref"),w$2=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(e){return e===null||typeof e!="object"?null:(e=z$1&&e[z$1]||e["@@iterator"],typeof e=="function"?e:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$2={};function E$2(e,i,s){this.props=e,this.context=i,this.refs=D$2,this.updater=s||B$1}E$2.prototype.isReactComponent={};E$2.prototype.setState=function(e,i){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,i,"setState")};E$2.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function F(){}F.prototype=E$2.prototype;function G$1(e,i,s){this.props=e,this.context=i,this.refs=D$2,this.updater=s||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$2.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$2={key:!0,ref:!0,__self:!0,__source:!0};function M$2(e,i,s){var a,b={},et=null,nt=null;if(i!=null)for(a in i.ref!==void 0&&(nt=i.ref),i.key!==void 0&&(et=""+i.key),i)J.call(i,a)&&!L$2.hasOwnProperty(a)&&(b[a]=i[a]);var c=arguments.length-2;if(c===1)b.children=s;else if(1<c){for(var ct=Array(c),pt=0;pt<c;pt++)ct[pt]=arguments[pt+2];b.children=ct}if(e&&e.defaultProps)for(a in c=e.defaultProps,c)b[a]===void 0&&(b[a]=c[a]);return{$$typeof:l$1,type:e,key:et,ref:nt,props:b,_owner:K$1.current}}function N$1(e,i){return{$$typeof:l$1,type:e.type,key:i,ref:e.ref,props:e.props,_owner:e._owner}}function O$1(e){return typeof e=="object"&&e!==null&&e.$$typeof===l$1}function escape(e){var i={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(s){return i[s]})}var P$2=/\/+/g;function Q$1(e,i){return typeof e=="object"&&e!==null&&e.key!=null?escape(""+e.key):i.toString(36)}function R$1(e,i,s,a,b){var et=typeof e;(et==="undefined"||et==="boolean")&&(e=null);var nt=!1;if(e===null)nt=!0;else switch(et){case"string":case"number":nt=!0;break;case"object":switch(e.$$typeof){case l$1:case n$1:nt=!0}}if(nt)return nt=e,b=b(nt),e=a===""?"."+Q$1(nt,0):a,I$1(b)?(s="",e!=null&&(s=e.replace(P$2,"$&/")+"/"),R$1(b,i,s,"",function(pt){return pt})):b!=null&&(O$1(b)&&(b=N$1(b,s+(!b.key||nt&&nt.key===b.key?"":(""+b.key).replace(P$2,"$&/")+"/")+e)),i.push(b)),1;if(nt=0,a=a===""?".":a+":",I$1(e))for(var c=0;c<e.length;c++){et=e[c];var ct=a+Q$1(et,c);nt+=R$1(et,i,s,ct,b)}else if(ct=A$1(e),typeof ct=="function")for(e=ct.call(e),c=0;!(et=e.next()).done;)et=et.value,ct=a+Q$1(et,c++),nt+=R$1(et,i,s,ct,b);else if(et==="object")throw i=String(e),Error("Objects are not valid as a React child (found: "+(i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return nt}function S$1(e,i,s){if(e==null)return e;var a=[],b=0;return R$1(e,a,"","",function(et){return i.call(s,et,b++)}),a}function T$1(e){if(e._status===-1){var i=e._result;i=i(),i.then(function(s){(e._status===0||e._status===-1)&&(e._status=1,e._result=s)},function(s){(e._status===0||e._status===-1)&&(e._status=2,e._result=s)}),e._status===-1&&(e._status=0,e._result=i)}if(e._status===1)return e._result.default;throw e._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};function X$2(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$1,forEach:function(e,i,s){S$1(e,function(){i.apply(this,arguments)},s)},count:function(e){var i=0;return S$1(e,function(){i++}),i},toArray:function(e){return S$1(e,function(i){return i})||[]},only:function(e){if(!O$1(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};react_production_min.Component=E$2;react_production_min.Fragment=p$2;react_production_min.Profiler=r$1;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w$2;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.act=X$2;react_production_min.cloneElement=function(e,i,s){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=C$1({},e.props),b=e.key,et=e.ref,nt=e._owner;if(i!=null){if(i.ref!==void 0&&(et=i.ref,nt=K$1.current),i.key!==void 0&&(b=""+i.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(ct in i)J.call(i,ct)&&!L$2.hasOwnProperty(ct)&&(a[ct]=i[ct]===void 0&&c!==void 0?c[ct]:i[ct])}var ct=arguments.length-2;if(ct===1)a.children=s;else if(1<ct){c=Array(ct);for(var pt=0;pt<ct;pt++)c[pt]=arguments[pt+2];a.children=c}return{$$typeof:l$1,type:e.type,key:b,ref:et,props:a,_owner:nt}};react_production_min.createContext=function(e){return e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:t,_context:e},e.Consumer=e};react_production_min.createElement=M$2;react_production_min.createFactory=function(e){var i=M$2.bind(null,e);return i.type=e,i};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(e){return{$$typeof:v$4,render:e}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(e){return{$$typeof:y,_payload:{_status:-1,_result:e},_init:T$1}};react_production_min.memo=function(e,i){return{$$typeof:x,type:e,compare:i===void 0?null:i}};react_production_min.startTransition=function(e){var i=V$1.transition;V$1.transition={};try{e()}finally{V$1.transition=i}};react_production_min.unstable_act=X$2;react_production_min.useCallback=function(e,i){return U$1.current.useCallback(e,i)};react_production_min.useContext=function(e){return U$1.current.useContext(e)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(e){return U$1.current.useDeferredValue(e)};react_production_min.useEffect=function(e,i){return U$1.current.useEffect(e,i)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(e,i,s){return U$1.current.useImperativeHandle(e,i,s)};react_production_min.useInsertionEffect=function(e,i){return U$1.current.useInsertionEffect(e,i)};react_production_min.useLayoutEffect=function(e,i){return U$1.current.useLayoutEffect(e,i)};react_production_min.useMemo=function(e,i){return U$1.current.useMemo(e,i)};react_production_min.useReducer=function(e,i,s){return U$1.current.useReducer(e,i,s)};react_production_min.useRef=function(e){return U$1.current.useRef(e)};react_production_min.useState=function(e){return U$1.current.useState(e)};react_production_min.useSyncExternalStore=function(e,i,s){return U$1.current.useSyncExternalStore(e,i,s)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;const React=getDefaultExportFromCjs(reactExports),React$1=_mergeNamespaces({__proto__:null,default:React},[reactExports]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$1={key:!0,ref:!0,__self:!0,__source:!0};function q(e,i,s){var a,b={},et=null,nt=null;s!==void 0&&(et=""+s),i.key!==void 0&&(et=""+i.key),i.ref!==void 0&&(nt=i.ref);for(a in i)m$1.call(i,a)&&!p$1.hasOwnProperty(a)&&(b[a]=i[a]);if(e&&e.defaultProps)for(a in i=e.defaultProps,i)b[a]===void 0&&(b[a]=i[a]);return{$$typeof:k,type:e,key:et,ref:nt,props:b,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function i(rr,cr){var Hr=rr.length;rr.push(cr);e:for(;0<Hr;){var $r=Hr-1>>>1,_n=rr[$r];if(0<b(_n,cr))rr[$r]=cr,rr[Hr]=_n,Hr=$r;else break e}}function s(rr){return rr.length===0?null:rr[0]}function a(rr){if(rr.length===0)return null;var cr=rr[0],Hr=rr.pop();if(Hr!==cr){rr[0]=Hr;e:for(var $r=0,_n=rr.length,fn=_n>>>1;$r<fn;){var jn=2*($r+1)-1,vs=rr[jn],Cs=jn+1,ns=rr[Cs];if(0>b(vs,Hr))Cs<_n&&0>b(ns,vs)?(rr[$r]=ns,rr[Cs]=Hr,$r=Cs):(rr[$r]=vs,rr[jn]=Hr,$r=jn);else if(Cs<_n&&0>b(ns,Hr))rr[$r]=ns,rr[Cs]=Hr,$r=Cs;else break e}}return cr}function b(rr,cr){var Hr=rr.sortIndex-cr.sortIndex;return Hr!==0?Hr:rr.id-cr.id}if(typeof performance=="object"&&typeof performance.now=="function"){var et=performance;e.unstable_now=function(){return et.now()}}else{var nt=Date,c=nt.now();e.unstable_now=function(){return nt.now()-c}}var ct=[],pt=[],xt=1,St=null,Et=3,Rt=!1,Nt=!1,It=!1,Gt=typeof setTimeout=="function"?setTimeout:null,Dt=typeof clearTimeout=="function"?clearTimeout:null,Bt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Lt(rr){for(var cr=s(pt);cr!==null;){if(cr.callback===null)a(pt);else if(cr.startTime<=rr)a(pt),cr.sortIndex=cr.expirationTime,i(ct,cr);else break;cr=s(pt)}}function Vt(rr){if(It=!1,Lt(rr),!Nt)if(s(ct)!==null)Nt=!0,xr(Zt);else{var cr=s(pt);cr!==null&&gr(Vt,cr.startTime-rr)}}function Zt(rr,cr){Nt=!1,It&&(It=!1,Dt(_r),_r=-1),Rt=!0;var Hr=Et;try{for(Lt(cr),St=s(ct);St!==null&&(!(St.expirationTime>cr)||rr&&!an());){var $r=St.callback;if(typeof $r=="function"){St.callback=null,Et=St.priorityLevel;var _n=$r(St.expirationTime<=cr);cr=e.unstable_now(),typeof _n=="function"?St.callback=_n:St===s(ct)&&a(ct),Lt(cr)}else a(ct);St=s(ct)}if(St!==null)var fn=!0;else{var jn=s(pt);jn!==null&&gr(Vt,jn.startTime-cr),fn=!1}return fn}finally{St=null,Et=Hr,Rt=!1}}var nr=!1,ur=null,_r=-1,Ur=5,ln=-1;function an(){return!(e.unstable_now()-ln<Ur)}function Fr(){if(ur!==null){var rr=e.unstable_now();ln=rr;var cr=!0;try{cr=ur(!0,rr)}finally{cr?rn():(nr=!1,ur=null)}}else nr=!1}var rn;if(typeof Bt=="function")rn=function(){Bt(Fr)};else if(typeof MessageChannel<"u"){var gn=new MessageChannel,_i=gn.port2;gn.port1.onmessage=Fr,rn=function(){_i.postMessage(null)}}else rn=function(){Gt(Fr,0)};function xr(rr){ur=rr,nr||(nr=!0,rn())}function gr(rr,cr){_r=Gt(function(){rr(e.unstable_now())},cr)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(rr){rr.callback=null},e.unstable_continueExecution=function(){Nt||Rt||(Nt=!0,xr(Zt))},e.unstable_forceFrameRate=function(rr){0>rr||125<rr?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ur=0<rr?Math.floor(1e3/rr):5},e.unstable_getCurrentPriorityLevel=function(){return Et},e.unstable_getFirstCallbackNode=function(){return s(ct)},e.unstable_next=function(rr){switch(Et){case 1:case 2:case 3:var cr=3;break;default:cr=Et}var Hr=Et;Et=cr;try{return rr()}finally{Et=Hr}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(rr,cr){switch(rr){case 1:case 2:case 3:case 4:case 5:break;default:rr=3}var Hr=Et;Et=rr;try{return cr()}finally{Et=Hr}},e.unstable_scheduleCallback=function(rr,cr,Hr){var $r=e.unstable_now();switch(typeof Hr=="object"&&Hr!==null?(Hr=Hr.delay,Hr=typeof Hr=="number"&&0<Hr?$r+Hr:$r):Hr=$r,rr){case 1:var _n=-1;break;case 2:_n=250;break;case 5:_n=1073741823;break;case 4:_n=1e4;break;default:_n=5e3}return _n=Hr+_n,rr={id:xt++,callback:cr,priorityLevel:rr,startTime:Hr,expirationTime:_n,sortIndex:-1},Hr>$r?(rr.sortIndex=Hr,i(pt,rr),s(ct)===null&&rr===s(pt)&&(It?(Dt(_r),_r=-1):It=!0,gr(Vt,Hr-$r))):(rr.sortIndex=_n,i(ct,rr),Nt||Rt||(Nt=!0,xr(Zt))),rr},e.unstable_shouldYield=an,e.unstable_wrapCallback=function(rr){var cr=Et;return function(){var Hr=Et;Et=cr;try{return rr.apply(this,arguments)}finally{Et=Hr}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p(e){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+e,s=1;s<arguments.length;s++)i+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+e+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(e,i){ha(e,i),ha(e+"Capture",i)}function ha(e,i){for(ea[e]=i,e=0;e<i.length;e++)da.add(i[e])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(e){return ja.call(ma,e)?!0:ja.call(la,e)?!1:ka.test(e)?ma[e]=!0:(la[e]=!0,!1)}function pa(e,i,s,a){if(s!==null&&s.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return a?!1:s!==null?!s.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function qa(e,i,s,a){if(i===null||typeof i>"u"||pa(e,i,s,a))return!0;if(a)return!1;if(s!==null)switch(s.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function v$3(e,i,s,a,b,et,nt){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=a,this.attributeNamespace=b,this.mustUseProperty=s,this.propertyName=e,this.type=i,this.sanitizeURL=et,this.removeEmptyString=nt}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){z[e]=new v$3(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var i=e[0];z[i]=new v$3(i,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){z[e]=new v$3(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){z[e]=new v$3(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){z[e]=new v$3(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){z[e]=new v$3(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){z[e]=new v$3(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){z[e]=new v$3(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){z[e]=new v$3(e,5,!1,e.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var i=e.replace(ra,sa);z[i]=new v$3(i,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var i=e.replace(ra,sa);z[i]=new v$3(i,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var i=e.replace(ra,sa);z[i]=new v$3(i,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){z[e]=new v$3(e,1,!1,e.toLowerCase(),null,!1,!1)});z.xlinkHref=new v$3("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){z[e]=new v$3(e,1,!1,e.toLowerCase(),null,!0,!0)});function ta(e,i,s,a){var b=z.hasOwnProperty(i)?z[i]:null;(b!==null?b.type!==0:a||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(qa(i,s,b,a)&&(s=null),a||b===null?oa(i)&&(s===null?e.removeAttribute(i):e.setAttribute(i,""+s)):b.mustUseProperty?e[b.propertyName]=s===null?b.type===3?!1:"":s:(i=b.attributeName,a=b.attributeNamespace,s===null?e.removeAttribute(i):(b=b.type,s=b===3||b===4&&s===!0?"":""+s,a?e.setAttributeNS(a,i,s):e.setAttribute(i,s))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(e){return e===null||typeof e!="object"?null:(e=Ja&&e[Ja]||e["@@iterator"],typeof e=="function"?e:null)}var A=Object.assign,La;function Ma(e){if(La===void 0)try{throw Error()}catch(s){var i=s.stack.trim().match(/\n( *(at )?)/);La=i&&i[1]||""}return`
`+La+e}var Na=!1;function Oa(e,i){if(!e||Na)return"";Na=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(pt){var a=pt}Reflect.construct(e,[],i)}else{try{i.call()}catch(pt){a=pt}e.call(i.prototype)}else{try{throw Error()}catch(pt){a=pt}e()}}catch(pt){if(pt&&a&&typeof pt.stack=="string"){for(var b=pt.stack.split(`
`),et=a.stack.split(`
`),nt=b.length-1,c=et.length-1;1<=nt&&0<=c&&b[nt]!==et[c];)c--;for(;1<=nt&&0<=c;nt--,c--)if(b[nt]!==et[c]){if(nt!==1||c!==1)do if(nt--,c--,0>c||b[nt]!==et[c]){var ct=`
`+b[nt].replace(" at new "," at ");return e.displayName&&ct.includes("<anonymous>")&&(ct=ct.replace("<anonymous>",e.displayName)),ct}while(1<=nt&&0<=c);break}}}finally{Na=!1,Error.prepareStackTrace=s}return(e=e?e.displayName||e.name:"")?Ma(e):""}function Pa(e){switch(e.tag){case 5:return Ma(e.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return e=Oa(e.type,!1),e;case 11:return e=Oa(e.type.render,!1),e;case 1:return e=Oa(e.type,!0),e;default:return""}}function Qa(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Ca:return(e.displayName||"Context")+".Consumer";case Ba:return(e._context.displayName||"Context")+".Provider";case Da:var i=e.render;return e=e.displayName,e||(e=i.displayName||i.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Ga:return i=e.displayName||null,i!==null?i:Qa(e.type)||"Memo";case Ha:i=e._payload,e=e._init;try{return Qa(e(i))}catch{}}return null}function Ra(e){var i=e.type;switch(e.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=i.render,e=e.displayName||e.name||"",i.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(i);case 8:return i===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function Sa(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Ta(e){var i=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function Ua(e){var i=Ta(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,i),a=""+e[i];if(!e.hasOwnProperty(i)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var b=s.get,et=s.set;return Object.defineProperty(e,i,{configurable:!0,get:function(){return b.call(this)},set:function(nt){a=""+nt,et.call(this,nt)}}),Object.defineProperty(e,i,{enumerable:s.enumerable}),{getValue:function(){return a},setValue:function(nt){a=""+nt},stopTracking:function(){e._valueTracker=null,delete e[i]}}}}function Va(e){e._valueTracker||(e._valueTracker=Ua(e))}function Wa(e){if(!e)return!1;var i=e._valueTracker;if(!i)return!0;var s=i.getValue(),a="";return e&&(a=Ta(e)?e.checked?"true":"false":e.value),e=a,e!==s?(i.setValue(e),!0):!1}function Xa(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Ya(e,i){var s=i.checked;return A({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??e._wrapperState.initialChecked})}function Za(e,i){var s=i.defaultValue==null?"":i.defaultValue,a=i.checked!=null?i.checked:i.defaultChecked;s=Sa(i.value!=null?i.value:s),e._wrapperState={initialChecked:a,initialValue:s,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function ab(e,i){i=i.checked,i!=null&&ta(e,"checked",i,!1)}function bb(e,i){ab(e,i);var s=Sa(i.value),a=i.type;if(s!=null)a==="number"?(s===0&&e.value===""||e.value!=s)&&(e.value=""+s):e.value!==""+s&&(e.value=""+s);else if(a==="submit"||a==="reset"){e.removeAttribute("value");return}i.hasOwnProperty("value")?cb(e,i.type,s):i.hasOwnProperty("defaultValue")&&cb(e,i.type,Sa(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(e.defaultChecked=!!i.defaultChecked)}function db(e,i,s){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var a=i.type;if(!(a!=="submit"&&a!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+e._wrapperState.initialValue,s||i===e.value||(e.value=i),e.defaultValue=i}s=e.name,s!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,s!==""&&(e.name=s)}function cb(e,i,s){(i!=="number"||Xa(e.ownerDocument)!==e)&&(s==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+s&&(e.defaultValue=""+s))}var eb=Array.isArray;function fb(e,i,s,a){if(e=e.options,i){i={};for(var b=0;b<s.length;b++)i["$"+s[b]]=!0;for(s=0;s<e.length;s++)b=i.hasOwnProperty("$"+e[s].value),e[s].selected!==b&&(e[s].selected=b),b&&a&&(e[s].defaultSelected=!0)}else{for(s=""+Sa(s),i=null,b=0;b<e.length;b++){if(e[b].value===s){e[b].selected=!0,a&&(e[b].defaultSelected=!0);return}i!==null||e[b].disabled||(i=e[b])}i!==null&&(i.selected=!0)}}function gb(e,i){if(i.dangerouslySetInnerHTML!=null)throw Error(p(91));return A({},i,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function hb(e,i){var s=i.value;if(s==null){if(s=i.children,i=i.defaultValue,s!=null){if(i!=null)throw Error(p(92));if(eb(s)){if(1<s.length)throw Error(p(93));s=s[0]}i=s}i==null&&(i=""),s=i}e._wrapperState={initialValue:Sa(s)}}function ib(e,i){var s=Sa(i.value),a=Sa(i.defaultValue);s!=null&&(s=""+s,s!==e.value&&(e.value=s),i.defaultValue==null&&e.defaultValue!==s&&(e.defaultValue=s)),a!=null&&(e.defaultValue=""+a)}function jb(e){var i=e.textContent;i===e._wrapperState.initialValue&&i!==""&&i!==null&&(e.value=i)}function kb(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(e,i){return e==null||e==="http://www.w3.org/1999/xhtml"?kb(i):e==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var mb,nb=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,s,a,b){MSApp.execUnsafeLocalFunction(function(){return e(i,s,a,b)})}:e}(function(e,i){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=i;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=mb.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;i.firstChild;)e.appendChild(i.firstChild)}});function ob(e,i){if(i){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=i;return}}e.textContent=i}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(e){qb.forEach(function(i){i=i+e.charAt(0).toUpperCase()+e.substring(1),pb[i]=pb[e]})});function rb(e,i,s){return i==null||typeof i=="boolean"||i===""?"":s||typeof i!="number"||i===0||pb.hasOwnProperty(e)&&pb[e]?(""+i).trim():i+"px"}function sb(e,i){e=e.style;for(var s in i)if(i.hasOwnProperty(s)){var a=s.indexOf("--")===0,b=rb(s,i[s],a);s==="float"&&(s="cssFloat"),a?e.setProperty(s,b):e[s]=b}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(e,i){if(i){if(tb[e]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(p(137,e));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(p(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(p(61))}if(i.style!=null&&typeof i.style!="object")throw Error(p(62))}}function vb(e,i){if(e.indexOf("-")===-1)return typeof i.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var yb=null,zb=null,Ab=null;function Bb(e){if(e=Cb(e)){if(typeof yb!="function")throw Error(p(280));var i=e.stateNode;i&&(i=Db(i),yb(e.stateNode,e.type,i))}}function Eb(e){zb?Ab?Ab.push(e):Ab=[e]:zb=e}function Fb(){if(zb){var e=zb,i=Ab;if(Ab=zb=null,Bb(e),i)for(e=0;e<i.length;e++)Bb(i[e])}}function Gb(e,i){return e(i)}function Hb(){}var Ib=!1;function Jb(e,i,s){if(Ib)return e(i,s);Ib=!0;try{return Gb(e,i,s)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(e,i){var s=e.stateNode;if(s===null)return null;var a=Db(s);if(a===null)return null;s=a[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(e=e.type,a=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!a;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(p(231,i,typeof s));return s}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(e,i,s,a,b,et,nt,c,ct){var pt=Array.prototype.slice.call(arguments,3);try{i.apply(s,pt)}catch(xt){this.onError(xt)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(e){Ob=!0,Pb=e}};function Tb(e,i,s,a,b,et,nt,c,ct){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(e,i,s,a,b,et,nt,c,ct){if(Tb.apply(this,arguments),Ob){if(Ob){var pt=Pb;Ob=!1,Pb=null}else throw Error(p(198));Qb||(Qb=!0,Rb=pt)}}function Vb(e){var i=e,s=e;if(e.alternate)for(;i.return;)i=i.return;else{e=i;do i=e,i.flags&4098&&(s=i.return),e=i.return;while(e)}return i.tag===3?s:null}function Wb(e){if(e.tag===13){var i=e.memoizedState;if(i===null&&(e=e.alternate,e!==null&&(i=e.memoizedState)),i!==null)return i.dehydrated}return null}function Xb(e){if(Vb(e)!==e)throw Error(p(188))}function Yb(e){var i=e.alternate;if(!i){if(i=Vb(e),i===null)throw Error(p(188));return i!==e?null:e}for(var s=e,a=i;;){var b=s.return;if(b===null)break;var et=b.alternate;if(et===null){if(a=b.return,a!==null){s=a;continue}break}if(b.child===et.child){for(et=b.child;et;){if(et===s)return Xb(b),e;if(et===a)return Xb(b),i;et=et.sibling}throw Error(p(188))}if(s.return!==a.return)s=b,a=et;else{for(var nt=!1,c=b.child;c;){if(c===s){nt=!0,s=b,a=et;break}if(c===a){nt=!0,a=b,s=et;break}c=c.sibling}if(!nt){for(c=et.child;c;){if(c===s){nt=!0,s=et,a=b;break}if(c===a){nt=!0,a=et,s=b;break}c=c.sibling}if(!nt)throw Error(p(189))}}if(s.alternate!==a)throw Error(p(190))}if(s.tag!==3)throw Error(p(188));return s.stateNode.current===s?e:i}function Zb(e){return e=Yb(e),e!==null?$b(e):null}function $b(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var i=$b(e);if(i!==null)return i;e=e.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(e){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,e,void 0,(e.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(e){return e>>>=0,e===0?32:31-(pc(e)/qc|0)|0}var rc=64,sc=4194304;function tc(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function uc(e,i){var s=e.pendingLanes;if(s===0)return 0;var a=0,b=e.suspendedLanes,et=e.pingedLanes,nt=s&268435455;if(nt!==0){var c=nt&~b;c!==0?a=tc(c):(et&=nt,et!==0&&(a=tc(et)))}else nt=s&~b,nt!==0?a=tc(nt):et!==0&&(a=tc(et));if(a===0)return 0;if(i!==0&&i!==a&&!(i&b)&&(b=a&-a,et=i&-i,b>=et||b===16&&(et&4194240)!==0))return i;if(a&4&&(a|=s&16),i=e.entangledLanes,i!==0)for(e=e.entanglements,i&=a;0<i;)s=31-oc(i),b=1<<s,a|=e[s],i&=~b;return a}function vc(e,i){switch(e){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(e,i){for(var s=e.suspendedLanes,a=e.pingedLanes,b=e.expirationTimes,et=e.pendingLanes;0<et;){var nt=31-oc(et),c=1<<nt,ct=b[nt];ct===-1?(!(c&s)||c&a)&&(b[nt]=vc(c,i)):ct<=i&&(e.expiredLanes|=c),et&=~c}}function xc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function yc(){var e=rc;return rc<<=1,!(rc&4194240)&&(rc=64),e}function zc(e){for(var i=[],s=0;31>s;s++)i.push(e);return i}function Ac(e,i,s){e.pendingLanes|=i,i!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,i=31-oc(i),e[i]=s}function Bc(e,i){var s=e.pendingLanes&~i;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=i,e.mutableReadLanes&=i,e.entangledLanes&=i,i=e.entanglements;var a=e.eventTimes;for(e=e.expirationTimes;0<s;){var b=31-oc(s),et=1<<b;i[b]=0,a[b]=-1,e[b]=-1,s&=~et}}function Cc(e,i){var s=e.entangledLanes|=i;for(e=e.entanglements;s;){var a=31-oc(s),b=1<<a;b&i|e[a]&i&&(e[a]|=i),s&=~b}}var C=0;function Dc(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(e,i){switch(e){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(i.pointerId)}}function Tc(e,i,s,a,b,et){return e===null||e.nativeEvent!==et?(e={blockedOn:i,domEventName:s,eventSystemFlags:a,nativeEvent:et,targetContainers:[b]},i!==null&&(i=Cb(i),i!==null&&Fc(i)),e):(e.eventSystemFlags|=a,i=e.targetContainers,b!==null&&i.indexOf(b)===-1&&i.push(b),e)}function Uc(e,i,s,a,b){switch(i){case"focusin":return Lc=Tc(Lc,e,i,s,a,b),!0;case"dragenter":return Mc=Tc(Mc,e,i,s,a,b),!0;case"mouseover":return Nc=Tc(Nc,e,i,s,a,b),!0;case"pointerover":var et=b.pointerId;return Oc.set(et,Tc(Oc.get(et)||null,e,i,s,a,b)),!0;case"gotpointercapture":return et=b.pointerId,Pc.set(et,Tc(Pc.get(et)||null,e,i,s,a,b)),!0}return!1}function Vc(e){var i=Wc(e.target);if(i!==null){var s=Vb(i);if(s!==null){if(i=s.tag,i===13){if(i=Wb(s),i!==null){e.blockedOn=i,Ic(e.priority,function(){Gc(s)});return}}else if(i===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Xc(e){if(e.blockedOn!==null)return!1;for(var i=e.targetContainers;0<i.length;){var s=Yc(e.domEventName,e.eventSystemFlags,i[0],e.nativeEvent);if(s===null){s=e.nativeEvent;var a=new s.constructor(s.type,s);wb=a,s.target.dispatchEvent(a),wb=null}else return i=Cb(s),i!==null&&Fc(i),e.blockedOn=s,!1;i.shift()}return!0}function Zc(e,i,s){Xc(e)&&s.delete(i)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(e,i){e.blockedOn===i&&(e.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(e){function i(b){return ad(b,e)}if(0<Kc.length){ad(Kc[0],e);for(var s=1;s<Kc.length;s++){var a=Kc[s];a.blockedOn===e&&(a.blockedOn=null)}}for(Lc!==null&&ad(Lc,e),Mc!==null&&ad(Mc,e),Nc!==null&&ad(Nc,e),Oc.forEach(i),Pc.forEach(i),s=0;s<Qc.length;s++)a=Qc[s],a.blockedOn===e&&(a.blockedOn=null);for(;0<Qc.length&&(s=Qc[0],s.blockedOn===null);)Vc(s),s.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(e,i,s,a){var b=C,et=cd.transition;cd.transition=null;try{C=1,fd(e,i,s,a)}finally{C=b,cd.transition=et}}function gd(e,i,s,a){var b=C,et=cd.transition;cd.transition=null;try{C=4,fd(e,i,s,a)}finally{C=b,cd.transition=et}}function fd(e,i,s,a){if(dd){var b=Yc(e,i,s,a);if(b===null)hd(e,i,a,id$2,s),Sc(e,a);else if(Uc(b,e,i,s,a))a.stopPropagation();else if(Sc(e,a),i&4&&-1<Rc.indexOf(e)){for(;b!==null;){var et=Cb(b);if(et!==null&&Ec(et),et=Yc(e,i,s,a),et===null&&hd(e,i,a,id$2,s),et===b)break;b=et}b!==null&&a.stopPropagation()}else hd(e,i,a,null,s)}}var id$2=null;function Yc(e,i,s,a){if(id$2=null,e=xb(a),e=Wc(e),e!==null)if(i=Vb(e),i===null)e=null;else if(s=i.tag,s===13){if(e=Wb(i),e!==null)return e;e=null}else if(s===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;e=null}else i!==e&&(e=null);return id$2=e,null}function jd(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var e,i=ld,s=i.length,a,b="value"in kd?kd.value:kd.textContent,et=b.length;for(e=0;e<s&&i[e]===b[e];e++);var nt=s-e;for(a=1;a<=nt&&i[s-a]===b[et-a];a++);return md=b.slice(e,1<a?1-a:void 0)}function od(e){var i=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&i===13&&(e=13)):e=i,e===10&&(e=13),32<=e||e===13?e:0}function pd(){return!0}function qd(){return!1}function rd(e){function i(s,a,b,et,nt){this._reactName=s,this._targetInst=b,this.type=a,this.nativeEvent=et,this.target=nt,this.currentTarget=null;for(var c in e)e.hasOwnProperty(c)&&(s=e[c],this[c]=s?s(et):et[c]);return this.isDefaultPrevented=(et.defaultPrevented!=null?et.defaultPrevented:et.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),i}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==yd&&(yd&&e.type==="mousemove"?(wd=e.screenX-yd.screenX,xd=e.screenY-yd.screenY):xd=wd=0,yd=e),wd)},movementY:function(e){return"movementY"in e?e.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(e){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(e):(e=Od[e])?!!i[e]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(e){if(e.key){var i=Md[e.key]||e.key;if(i!=="Unidentified")return i}return e.type==="keypress"?(e=od(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Nd[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(e){return e.type==="keypress"?od(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?od(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae$1=ia&&"CompositionEvent"in window,be$1=null;ia&&"documentMode"in document&&(be$1=document.documentMode);var ce$1=ia&&"TextEvent"in window&&!be$1,de$1=ia&&(!ae$1||be$1&&8<be$1&&11>=be$1),ee$1=" ",fe=!1;function ge$1(e,i){switch(e){case"keyup":return $d.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he$1(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ie$1=!1;function je(e,i){switch(e){case"compositionend":return he$1(i);case"keypress":return i.which!==32?null:(fe=!0,ee$1);case"textInput":return e=i.data,e===ee$1&&fe?null:e;default:return null}}function ke(e,i){if(ie$1)return e==="compositionend"||!ae$1&&ge$1(e,i)?(e=nd(),md=ld=kd=null,ie$1=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return de$1&&i.locale!=="ko"?null:i.data;default:return null}}var le$1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me$1(e){var i=e&&e.nodeName&&e.nodeName.toLowerCase();return i==="input"?!!le$1[e.type]:i==="textarea"}function ne$1(e,i,s,a){Eb(a),i=oe$1(i,"onChange"),0<i.length&&(s=new td("onChange","change",null,s,a),e.push({event:s,listeners:i}))}var pe$1=null,qe=null;function re(e){se$1(e,0)}function te$1(e){var i=ue$1(e);if(Wa(i))return e}function ve$1(e,i){if(e==="change")return i}var we$1=!1;if(ia){var xe$1;if(ia){var ye$1="oninput"in document;if(!ye$1){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye$1=typeof ze.oninput=="function"}xe$1=ye$1}else xe$1=!1;we$1=xe$1&&(!document.documentMode||9<document.documentMode)}function Ae(){pe$1&&(pe$1.detachEvent("onpropertychange",Be),qe=pe$1=null)}function Be(e){if(e.propertyName==="value"&&te$1(qe)){var i=[];ne$1(i,qe,e,xb(e)),Jb(re,i)}}function Ce(e,i,s){e==="focusin"?(Ae(),pe$1=i,qe=s,pe$1.attachEvent("onpropertychange",Be)):e==="focusout"&&Ae()}function De(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return te$1(qe)}function Ee(e,i){if(e==="click")return te$1(i)}function Fe(e,i){if(e==="input"||e==="change")return te$1(i)}function Ge(e,i){return e===i&&(e!==0||1/e===1/i)||e!==e&&i!==i}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(e,i){if(He(e,i))return!0;if(typeof e!="object"||e===null||typeof i!="object"||i===null)return!1;var s=Object.keys(e),a=Object.keys(i);if(s.length!==a.length)return!1;for(a=0;a<s.length;a++){var b=s[a];if(!ja.call(i,b)||!He(e[b],i[b]))return!1}return!0}function Je(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ke(e,i){var s=Je(e);e=0;for(var a;s;){if(s.nodeType===3){if(a=e+s.textContent.length,e<=i&&a>=i)return{node:s,offset:i-e};e=a}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=Je(s)}}function Le(e,i){return e&&i?e===i?!0:e&&e.nodeType===3?!1:i&&i.nodeType===3?Le(e,i.parentNode):"contains"in e?e.contains(i):e.compareDocumentPosition?!!(e.compareDocumentPosition(i)&16):!1:!1}function Me(){for(var e=window,i=Xa();i instanceof e.HTMLIFrameElement;){try{var s=typeof i.contentWindow.location.href=="string"}catch{s=!1}if(s)e=i.contentWindow;else break;i=Xa(e.document)}return i}function Ne(e){var i=e&&e.nodeName&&e.nodeName.toLowerCase();return i&&(i==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||i==="textarea"||e.contentEditable==="true")}function Oe(e){var i=Me(),s=e.focusedElem,a=e.selectionRange;if(i!==s&&s&&s.ownerDocument&&Le(s.ownerDocument.documentElement,s)){if(a!==null&&Ne(s)){if(i=a.start,e=a.end,e===void 0&&(e=i),"selectionStart"in s)s.selectionStart=i,s.selectionEnd=Math.min(e,s.value.length);else if(e=(i=s.ownerDocument||document)&&i.defaultView||window,e.getSelection){e=e.getSelection();var b=s.textContent.length,et=Math.min(a.start,b);a=a.end===void 0?et:Math.min(a.end,b),!e.extend&&et>a&&(b=a,a=et,et=b),b=Ke(s,et);var nt=Ke(s,a);b&&nt&&(e.rangeCount!==1||e.anchorNode!==b.node||e.anchorOffset!==b.offset||e.focusNode!==nt.node||e.focusOffset!==nt.offset)&&(i=i.createRange(),i.setStart(b.node,b.offset),e.removeAllRanges(),et>a?(e.addRange(i),e.extend(nt.node,nt.offset)):(i.setEnd(nt.node,nt.offset),e.addRange(i)))}}for(i=[],e=s;e=e.parentNode;)e.nodeType===1&&i.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<i.length;s++)e=i[s],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te$1=!1;function Ue(e,i,s){var a=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;Te$1||Qe==null||Qe!==Xa(a)||(a=Qe,"selectionStart"in a&&Ne(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),Se&&Ie(Se,a)||(Se=a,a=oe$1(Re,"onSelect"),0<a.length&&(i=new td("onSelect","select",null,i,s),e.push({event:i,listeners:a}),i.target=Qe)))}function Ve(e,i){var s={};return s[e.toLowerCase()]=i.toLowerCase(),s["Webkit"+e]="webkit"+i,s["Moz"+e]="moz"+i,s}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(e){if(Xe[e])return Xe[e];if(!We[e])return e;var i=We[e],s;for(s in i)if(i.hasOwnProperty(s)&&s in Ye)return Xe[e]=i[s];return e}var $e$1=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(e,i){df.set(e,i),fa(i,[e])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e$1,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(e,i,s){var a=e.type||"unknown-event";e.currentTarget=s,Ub(a,i,void 0,e),e.currentTarget=null}function se$1(e,i){i=(i&4)!==0;for(var s=0;s<e.length;s++){var a=e[s],b=a.event;a=a.listeners;e:{var et=void 0;if(i)for(var nt=a.length-1;0<=nt;nt--){var c=a[nt],ct=c.instance,pt=c.currentTarget;if(c=c.listener,ct!==et&&b.isPropagationStopped())break e;nf(b,c,pt),et=ct}else for(nt=0;nt<a.length;nt++){if(c=a[nt],ct=c.instance,pt=c.currentTarget,c=c.listener,ct!==et&&b.isPropagationStopped())break e;nf(b,c,pt),et=ct}}}if(Qb)throw e=Rb,Qb=!1,Rb=null,e}function D$1(e,i){var s=i[of];s===void 0&&(s=i[of]=new Set);var a=e+"__bubble";s.has(a)||(pf(i,e,2,!1),s.add(a))}function qf(e,i,s){var a=0;i&&(a|=4),pf(s,e,a,i)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(e){if(!e[rf]){e[rf]=!0,da.forEach(function(s){s!=="selectionchange"&&(mf.has(s)||qf(s,!1,e),qf(s,!0,e))});var i=e.nodeType===9?e:e.ownerDocument;i===null||i[rf]||(i[rf]=!0,qf("selectionchange",!1,i))}}function pf(e,i,s,a){switch(jd(i)){case 1:var b=ed;break;case 4:b=gd;break;default:b=fd}s=b.bind(null,i,s,e),b=void 0,!Lb||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(b=!0),a?b!==void 0?e.addEventListener(i,s,{capture:!0,passive:b}):e.addEventListener(i,s,!0):b!==void 0?e.addEventListener(i,s,{passive:b}):e.addEventListener(i,s,!1)}function hd(e,i,s,a,b){var et=a;if(!(i&1)&&!(i&2)&&a!==null)e:for(;;){if(a===null)return;var nt=a.tag;if(nt===3||nt===4){var c=a.stateNode.containerInfo;if(c===b||c.nodeType===8&&c.parentNode===b)break;if(nt===4)for(nt=a.return;nt!==null;){var ct=nt.tag;if((ct===3||ct===4)&&(ct=nt.stateNode.containerInfo,ct===b||ct.nodeType===8&&ct.parentNode===b))return;nt=nt.return}for(;c!==null;){if(nt=Wc(c),nt===null)return;if(ct=nt.tag,ct===5||ct===6){a=et=nt;continue e}c=c.parentNode}}a=a.return}Jb(function(){var pt=et,xt=xb(s),St=[];e:{var Et=df.get(e);if(Et!==void 0){var Rt=td,Nt=e;switch(e){case"keypress":if(od(s)===0)break e;case"keydown":case"keyup":Rt=Rd;break;case"focusin":Nt="focus",Rt=Fd;break;case"focusout":Nt="blur",Rt=Fd;break;case"beforeblur":case"afterblur":Rt=Fd;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Rt=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Rt=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Rt=Vd;break;case $e$1:case af:case bf:Rt=Hd;break;case cf:Rt=Xd;break;case"scroll":Rt=vd;break;case"wheel":Rt=Zd;break;case"copy":case"cut":case"paste":Rt=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Rt=Td}var It=(i&4)!==0,Gt=!It&&e==="scroll",Dt=It?Et!==null?Et+"Capture":null:Et;It=[];for(var Bt=pt,Lt;Bt!==null;){Lt=Bt;var Vt=Lt.stateNode;if(Lt.tag===5&&Vt!==null&&(Lt=Vt,Dt!==null&&(Vt=Kb(Bt,Dt),Vt!=null&&It.push(tf(Bt,Vt,Lt)))),Gt)break;Bt=Bt.return}0<It.length&&(Et=new Rt(Et,Nt,null,s,xt),St.push({event:Et,listeners:It}))}}if(!(i&7)){e:{if(Et=e==="mouseover"||e==="pointerover",Rt=e==="mouseout"||e==="pointerout",Et&&s!==wb&&(Nt=s.relatedTarget||s.fromElement)&&(Wc(Nt)||Nt[uf]))break e;if((Rt||Et)&&(Et=xt.window===xt?xt:(Et=xt.ownerDocument)?Et.defaultView||Et.parentWindow:window,Rt?(Nt=s.relatedTarget||s.toElement,Rt=pt,Nt=Nt?Wc(Nt):null,Nt!==null&&(Gt=Vb(Nt),Nt!==Gt||Nt.tag!==5&&Nt.tag!==6)&&(Nt=null)):(Rt=null,Nt=pt),Rt!==Nt)){if(It=Bd,Vt="onMouseLeave",Dt="onMouseEnter",Bt="mouse",(e==="pointerout"||e==="pointerover")&&(It=Td,Vt="onPointerLeave",Dt="onPointerEnter",Bt="pointer"),Gt=Rt==null?Et:ue$1(Rt),Lt=Nt==null?Et:ue$1(Nt),Et=new It(Vt,Bt+"leave",Rt,s,xt),Et.target=Gt,Et.relatedTarget=Lt,Vt=null,Wc(xt)===pt&&(It=new It(Dt,Bt+"enter",Nt,s,xt),It.target=Lt,It.relatedTarget=Gt,Vt=It),Gt=Vt,Rt&&Nt)t:{for(It=Rt,Dt=Nt,Bt=0,Lt=It;Lt;Lt=vf(Lt))Bt++;for(Lt=0,Vt=Dt;Vt;Vt=vf(Vt))Lt++;for(;0<Bt-Lt;)It=vf(It),Bt--;for(;0<Lt-Bt;)Dt=vf(Dt),Lt--;for(;Bt--;){if(It===Dt||Dt!==null&&It===Dt.alternate)break t;It=vf(It),Dt=vf(Dt)}It=null}else It=null;Rt!==null&&wf(St,Et,Rt,It,!1),Nt!==null&&Gt!==null&&wf(St,Gt,Nt,It,!0)}}e:{if(Et=pt?ue$1(pt):window,Rt=Et.nodeName&&Et.nodeName.toLowerCase(),Rt==="select"||Rt==="input"&&Et.type==="file")var Zt=ve$1;else if(me$1(Et))if(we$1)Zt=Fe;else{Zt=De;var nr=Ce}else(Rt=Et.nodeName)&&Rt.toLowerCase()==="input"&&(Et.type==="checkbox"||Et.type==="radio")&&(Zt=Ee);if(Zt&&(Zt=Zt(e,pt))){ne$1(St,Zt,s,xt);break e}nr&&nr(e,Et,pt),e==="focusout"&&(nr=Et._wrapperState)&&nr.controlled&&Et.type==="number"&&cb(Et,"number",Et.value)}switch(nr=pt?ue$1(pt):window,e){case"focusin":(me$1(nr)||nr.contentEditable==="true")&&(Qe=nr,Re=pt,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te$1=!0;break;case"contextmenu":case"mouseup":case"dragend":Te$1=!1,Ue(St,s,xt);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(St,s,xt)}var ur;if(ae$1)e:{switch(e){case"compositionstart":var _r="onCompositionStart";break e;case"compositionend":_r="onCompositionEnd";break e;case"compositionupdate":_r="onCompositionUpdate";break e}_r=void 0}else ie$1?ge$1(e,s)&&(_r="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(_r="onCompositionStart");_r&&(de$1&&s.locale!=="ko"&&(ie$1||_r!=="onCompositionStart"?_r==="onCompositionEnd"&&ie$1&&(ur=nd()):(kd=xt,ld="value"in kd?kd.value:kd.textContent,ie$1=!0)),nr=oe$1(pt,_r),0<nr.length&&(_r=new Ld(_r,e,null,s,xt),St.push({event:_r,listeners:nr}),ur?_r.data=ur:(ur=he$1(s),ur!==null&&(_r.data=ur)))),(ur=ce$1?je(e,s):ke(e,s))&&(pt=oe$1(pt,"onBeforeInput"),0<pt.length&&(xt=new Ld("onBeforeInput","beforeinput",null,s,xt),St.push({event:xt,listeners:pt}),xt.data=ur))}se$1(St,i)})}function tf(e,i,s){return{instance:e,listener:i,currentTarget:s}}function oe$1(e,i){for(var s=i+"Capture",a=[];e!==null;){var b=e,et=b.stateNode;b.tag===5&&et!==null&&(b=et,et=Kb(e,s),et!=null&&a.unshift(tf(e,et,b)),et=Kb(e,i),et!=null&&a.push(tf(e,et,b))),e=e.return}return a}function vf(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function wf(e,i,s,a,b){for(var et=i._reactName,nt=[];s!==null&&s!==a;){var c=s,ct=c.alternate,pt=c.stateNode;if(ct!==null&&ct===a)break;c.tag===5&&pt!==null&&(c=pt,b?(ct=Kb(s,et),ct!=null&&nt.unshift(tf(s,ct,c))):b||(ct=Kb(s,et),ct!=null&&nt.push(tf(s,ct,c)))),s=s.return}nt.length!==0&&e.push({event:i,listeners:nt})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(e){return(typeof e=="string"?e:""+e).replace(xf,`
`).replace(yf,"")}function Af(e,i,s){if(i=zf(i),zf(e)!==i&&s)throw Error(p(425))}function Bf(){}var Cf=null,Df=null;function Ef(e,i){return e==="textarea"||e==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(e){return Hf.resolve(null).then(e).catch(If)}:Ff;function If(e){setTimeout(function(){throw e})}function Kf(e,i){var s=i,a=0;do{var b=s.nextSibling;if(e.removeChild(s),b&&b.nodeType===8)if(s=b.data,s==="/$"){if(a===0){e.removeChild(b),bd(i);return}a--}else s!=="$"&&s!=="$?"&&s!=="$!"||a++;s=b}while(s);bd(i)}function Lf(e){for(;e!=null;e=e.nextSibling){var i=e.nodeType;if(i===1||i===3)break;if(i===8){if(i=e.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return e}function Mf(e){e=e.previousSibling;for(var i=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"){if(i===0)return e;i--}else s==="/$"&&i++}e=e.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(e){var i=e[Of];if(i)return i;for(var s=e.parentNode;s;){if(i=s[uf]||s[Of]){if(s=i.alternate,i.child!==null||s!==null&&s.child!==null)for(e=Mf(e);e!==null;){if(s=e[Of])return s;e=Mf(e)}return i}e=s,s=e.parentNode}return null}function Cb(e){return e=e[Of]||e[uf],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ue$1(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(p(33))}function Db(e){return e[Pf]||null}var Sf=[],Tf=-1;function Uf(e){return{current:e}}function E$1(e){0>Tf||(e.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(e,i){Tf++,Sf[Tf]=e.current,e.current=i}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(e,i){var s=e.type.contextTypes;if(!s)return Vf;var a=e.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===i)return a.__reactInternalMemoizedMaskedChildContext;var b={},et;for(et in s)b[et]=i[et];return a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=b),b}function Zf(e){return e=e.childContextTypes,e!=null}function $f(){E$1(Wf),E$1(H)}function ag(e,i,s){if(H.current!==Vf)throw Error(p(168));G(H,i),G(Wf,s)}function bg(e,i,s){var a=e.stateNode;if(i=i.childContextTypes,typeof a.getChildContext!="function")return s;a=a.getChildContext();for(var b in a)if(!(b in i))throw Error(p(108,Ra(e)||"Unknown",b));return A({},s,a)}function cg(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,e),G(Wf,Wf.current),!0}function dg(e,i,s){var a=e.stateNode;if(!a)throw Error(p(169));s?(e=bg(e,i,Xf),a.__reactInternalMemoizedMergedChildContext=e,E$1(Wf),E$1(H),G(H,e)):E$1(Wf),G(Wf,s)}var eg=null,fg=!1,gg=!1;function hg(e){eg===null?eg=[e]:eg.push(e)}function ig(e){fg=!0,hg(e)}function jg(){if(!gg&&eg!==null){gg=!0;var e=0,i=C;try{var s=eg;for(C=1;e<s.length;e++){var a=s[e];do a=a(!0);while(a!==null)}eg=null,fg=!1}catch(b){throw eg!==null&&(eg=eg.slice(e+1)),ac(fc,jg),b}finally{C=i,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(e,i){kg[lg++]=ng,kg[lg++]=mg,mg=e,ng=i}function ug(e,i,s){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=e;var a=rg;e=sg;var b=32-oc(a)-1;a&=~(1<<b),s+=1;var et=32-oc(i)+b;if(30<et){var nt=b-b%5;et=(a&(1<<nt)-1).toString(32),a>>=nt,b-=nt,rg=1<<32-oc(i)+b|s<<b|a,sg=et+e}else rg=1<<et|s<<b|a,sg=e}function vg(e){e.return!==null&&(tg(e,1),ug(e,1,0))}function wg(e){for(;e===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;e===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(e,i){var s=Bg(5,null,null,0);s.elementType="DELETED",s.stateNode=i,s.return=e,i=e.deletions,i===null?(e.deletions=[s],e.flags|=16):i.push(s)}function Cg(e,i){switch(e.tag){case 5:var s=e.type;return i=i.nodeType!==1||s.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(e.stateNode=i,xg=e,yg=Lf(i.firstChild),!0):!1;case 6:return i=e.pendingProps===""||i.nodeType!==3?null:i,i!==null?(e.stateNode=i,xg=e,yg=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(s=qg!==null?{id:rg,overflow:sg}:null,e.memoizedState={dehydrated:i,treeContext:s,retryLane:1073741824},s=Bg(18,null,null,0),s.stateNode=i,s.return=e,e.child=s,xg=e,yg=null,!0):!1;default:return!1}}function Dg(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Eg(e){if(I){var i=yg;if(i){var s=i;if(!Cg(e,i)){if(Dg(e))throw Error(p(418));i=Lf(s.nextSibling);var a=xg;i&&Cg(e,i)?Ag(a,s):(e.flags=e.flags&-4097|2,I=!1,xg=e)}}else{if(Dg(e))throw Error(p(418));e.flags=e.flags&-4097|2,I=!1,xg=e}}}function Fg(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;xg=e}function Gg(e){if(e!==xg)return!1;if(!I)return Fg(e),I=!0,!1;var i;if((i=e.tag!==3)&&!(i=e.tag!==5)&&(i=e.type,i=i!=="head"&&i!=="body"&&!Ef(e.type,e.memoizedProps)),i&&(i=yg)){if(Dg(e))throw Hg(),Error(p(418));for(;i;)Ag(e,i),i=Lf(i.nextSibling)}if(Fg(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(p(317));e:{for(e=e.nextSibling,i=0;e;){if(e.nodeType===8){var s=e.data;if(s==="/$"){if(i===0){yg=Lf(e.nextSibling);break e}i--}else s!=="$"&&s!=="$!"&&s!=="$?"||i++}e=e.nextSibling}yg=null}}else yg=xg?Lf(e.stateNode.nextSibling):null;return!0}function Hg(){for(var e=yg;e;)e=Lf(e.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(e){zg===null?zg=[e]:zg.push(e)}var Kg=ua.ReactCurrentBatchConfig;function Lg(e,i,s){if(e=s.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(p(309));var a=s.stateNode}if(!a)throw Error(p(147,e));var b=a,et=""+e;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===et?i.ref:(i=function(nt){var c=b.refs;nt===null?delete c[et]:c[et]=nt},i._stringRef=et,i)}if(typeof e!="string")throw Error(p(284));if(!s._owner)throw Error(p(290,e))}return e}function Mg(e,i){throw e=Object.prototype.toString.call(i),Error(p(31,e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e))}function Ng(e){var i=e._init;return i(e._payload)}function Og(e){function i(Dt,Bt){if(e){var Lt=Dt.deletions;Lt===null?(Dt.deletions=[Bt],Dt.flags|=16):Lt.push(Bt)}}function s(Dt,Bt){if(!e)return null;for(;Bt!==null;)i(Dt,Bt),Bt=Bt.sibling;return null}function a(Dt,Bt){for(Dt=new Map;Bt!==null;)Bt.key!==null?Dt.set(Bt.key,Bt):Dt.set(Bt.index,Bt),Bt=Bt.sibling;return Dt}function b(Dt,Bt){return Dt=Pg(Dt,Bt),Dt.index=0,Dt.sibling=null,Dt}function et(Dt,Bt,Lt){return Dt.index=Lt,e?(Lt=Dt.alternate,Lt!==null?(Lt=Lt.index,Lt<Bt?(Dt.flags|=2,Bt):Lt):(Dt.flags|=2,Bt)):(Dt.flags|=1048576,Bt)}function nt(Dt){return e&&Dt.alternate===null&&(Dt.flags|=2),Dt}function c(Dt,Bt,Lt,Vt){return Bt===null||Bt.tag!==6?(Bt=Qg(Lt,Dt.mode,Vt),Bt.return=Dt,Bt):(Bt=b(Bt,Lt),Bt.return=Dt,Bt)}function ct(Dt,Bt,Lt,Vt){var Zt=Lt.type;return Zt===ya?xt(Dt,Bt,Lt.props.children,Vt,Lt.key):Bt!==null&&(Bt.elementType===Zt||typeof Zt=="object"&&Zt!==null&&Zt.$$typeof===Ha&&Ng(Zt)===Bt.type)?(Vt=b(Bt,Lt.props),Vt.ref=Lg(Dt,Bt,Lt),Vt.return=Dt,Vt):(Vt=Rg(Lt.type,Lt.key,Lt.props,null,Dt.mode,Vt),Vt.ref=Lg(Dt,Bt,Lt),Vt.return=Dt,Vt)}function pt(Dt,Bt,Lt,Vt){return Bt===null||Bt.tag!==4||Bt.stateNode.containerInfo!==Lt.containerInfo||Bt.stateNode.implementation!==Lt.implementation?(Bt=Sg(Lt,Dt.mode,Vt),Bt.return=Dt,Bt):(Bt=b(Bt,Lt.children||[]),Bt.return=Dt,Bt)}function xt(Dt,Bt,Lt,Vt,Zt){return Bt===null||Bt.tag!==7?(Bt=Tg(Lt,Dt.mode,Vt,Zt),Bt.return=Dt,Bt):(Bt=b(Bt,Lt),Bt.return=Dt,Bt)}function St(Dt,Bt,Lt){if(typeof Bt=="string"&&Bt!==""||typeof Bt=="number")return Bt=Qg(""+Bt,Dt.mode,Lt),Bt.return=Dt,Bt;if(typeof Bt=="object"&&Bt!==null){switch(Bt.$$typeof){case va:return Lt=Rg(Bt.type,Bt.key,Bt.props,null,Dt.mode,Lt),Lt.ref=Lg(Dt,null,Bt),Lt.return=Dt,Lt;case wa:return Bt=Sg(Bt,Dt.mode,Lt),Bt.return=Dt,Bt;case Ha:var Vt=Bt._init;return St(Dt,Vt(Bt._payload),Lt)}if(eb(Bt)||Ka(Bt))return Bt=Tg(Bt,Dt.mode,Lt,null),Bt.return=Dt,Bt;Mg(Dt,Bt)}return null}function Et(Dt,Bt,Lt,Vt){var Zt=Bt!==null?Bt.key:null;if(typeof Lt=="string"&&Lt!==""||typeof Lt=="number")return Zt!==null?null:c(Dt,Bt,""+Lt,Vt);if(typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case va:return Lt.key===Zt?ct(Dt,Bt,Lt,Vt):null;case wa:return Lt.key===Zt?pt(Dt,Bt,Lt,Vt):null;case Ha:return Zt=Lt._init,Et(Dt,Bt,Zt(Lt._payload),Vt)}if(eb(Lt)||Ka(Lt))return Zt!==null?null:xt(Dt,Bt,Lt,Vt,null);Mg(Dt,Lt)}return null}function Rt(Dt,Bt,Lt,Vt,Zt){if(typeof Vt=="string"&&Vt!==""||typeof Vt=="number")return Dt=Dt.get(Lt)||null,c(Bt,Dt,""+Vt,Zt);if(typeof Vt=="object"&&Vt!==null){switch(Vt.$$typeof){case va:return Dt=Dt.get(Vt.key===null?Lt:Vt.key)||null,ct(Bt,Dt,Vt,Zt);case wa:return Dt=Dt.get(Vt.key===null?Lt:Vt.key)||null,pt(Bt,Dt,Vt,Zt);case Ha:var nr=Vt._init;return Rt(Dt,Bt,Lt,nr(Vt._payload),Zt)}if(eb(Vt)||Ka(Vt))return Dt=Dt.get(Lt)||null,xt(Bt,Dt,Vt,Zt,null);Mg(Bt,Vt)}return null}function Nt(Dt,Bt,Lt,Vt){for(var Zt=null,nr=null,ur=Bt,_r=Bt=0,Ur=null;ur!==null&&_r<Lt.length;_r++){ur.index>_r?(Ur=ur,ur=null):Ur=ur.sibling;var ln=Et(Dt,ur,Lt[_r],Vt);if(ln===null){ur===null&&(ur=Ur);break}e&&ur&&ln.alternate===null&&i(Dt,ur),Bt=et(ln,Bt,_r),nr===null?Zt=ln:nr.sibling=ln,nr=ln,ur=Ur}if(_r===Lt.length)return s(Dt,ur),I&&tg(Dt,_r),Zt;if(ur===null){for(;_r<Lt.length;_r++)ur=St(Dt,Lt[_r],Vt),ur!==null&&(Bt=et(ur,Bt,_r),nr===null?Zt=ur:nr.sibling=ur,nr=ur);return I&&tg(Dt,_r),Zt}for(ur=a(Dt,ur);_r<Lt.length;_r++)Ur=Rt(ur,Dt,_r,Lt[_r],Vt),Ur!==null&&(e&&Ur.alternate!==null&&ur.delete(Ur.key===null?_r:Ur.key),Bt=et(Ur,Bt,_r),nr===null?Zt=Ur:nr.sibling=Ur,nr=Ur);return e&&ur.forEach(function(an){return i(Dt,an)}),I&&tg(Dt,_r),Zt}function It(Dt,Bt,Lt,Vt){var Zt=Ka(Lt);if(typeof Zt!="function")throw Error(p(150));if(Lt=Zt.call(Lt),Lt==null)throw Error(p(151));for(var nr=Zt=null,ur=Bt,_r=Bt=0,Ur=null,ln=Lt.next();ur!==null&&!ln.done;_r++,ln=Lt.next()){ur.index>_r?(Ur=ur,ur=null):Ur=ur.sibling;var an=Et(Dt,ur,ln.value,Vt);if(an===null){ur===null&&(ur=Ur);break}e&&ur&&an.alternate===null&&i(Dt,ur),Bt=et(an,Bt,_r),nr===null?Zt=an:nr.sibling=an,nr=an,ur=Ur}if(ln.done)return s(Dt,ur),I&&tg(Dt,_r),Zt;if(ur===null){for(;!ln.done;_r++,ln=Lt.next())ln=St(Dt,ln.value,Vt),ln!==null&&(Bt=et(ln,Bt,_r),nr===null?Zt=ln:nr.sibling=ln,nr=ln);return I&&tg(Dt,_r),Zt}for(ur=a(Dt,ur);!ln.done;_r++,ln=Lt.next())ln=Rt(ur,Dt,_r,ln.value,Vt),ln!==null&&(e&&ln.alternate!==null&&ur.delete(ln.key===null?_r:ln.key),Bt=et(ln,Bt,_r),nr===null?Zt=ln:nr.sibling=ln,nr=ln);return e&&ur.forEach(function(Fr){return i(Dt,Fr)}),I&&tg(Dt,_r),Zt}function Gt(Dt,Bt,Lt,Vt){if(typeof Lt=="object"&&Lt!==null&&Lt.type===ya&&Lt.key===null&&(Lt=Lt.props.children),typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case va:e:{for(var Zt=Lt.key,nr=Bt;nr!==null;){if(nr.key===Zt){if(Zt=Lt.type,Zt===ya){if(nr.tag===7){s(Dt,nr.sibling),Bt=b(nr,Lt.props.children),Bt.return=Dt,Dt=Bt;break e}}else if(nr.elementType===Zt||typeof Zt=="object"&&Zt!==null&&Zt.$$typeof===Ha&&Ng(Zt)===nr.type){s(Dt,nr.sibling),Bt=b(nr,Lt.props),Bt.ref=Lg(Dt,nr,Lt),Bt.return=Dt,Dt=Bt;break e}s(Dt,nr);break}else i(Dt,nr);nr=nr.sibling}Lt.type===ya?(Bt=Tg(Lt.props.children,Dt.mode,Vt,Lt.key),Bt.return=Dt,Dt=Bt):(Vt=Rg(Lt.type,Lt.key,Lt.props,null,Dt.mode,Vt),Vt.ref=Lg(Dt,Bt,Lt),Vt.return=Dt,Dt=Vt)}return nt(Dt);case wa:e:{for(nr=Lt.key;Bt!==null;){if(Bt.key===nr)if(Bt.tag===4&&Bt.stateNode.containerInfo===Lt.containerInfo&&Bt.stateNode.implementation===Lt.implementation){s(Dt,Bt.sibling),Bt=b(Bt,Lt.children||[]),Bt.return=Dt,Dt=Bt;break e}else{s(Dt,Bt);break}else i(Dt,Bt);Bt=Bt.sibling}Bt=Sg(Lt,Dt.mode,Vt),Bt.return=Dt,Dt=Bt}return nt(Dt);case Ha:return nr=Lt._init,Gt(Dt,Bt,nr(Lt._payload),Vt)}if(eb(Lt))return Nt(Dt,Bt,Lt,Vt);if(Ka(Lt))return It(Dt,Bt,Lt,Vt);Mg(Dt,Lt)}return typeof Lt=="string"&&Lt!==""||typeof Lt=="number"?(Lt=""+Lt,Bt!==null&&Bt.tag===6?(s(Dt,Bt.sibling),Bt=b(Bt,Lt),Bt.return=Dt,Dt=Bt):(s(Dt,Bt),Bt=Qg(Lt,Dt.mode,Vt),Bt.return=Dt,Dt=Bt),nt(Dt)):s(Dt,Bt)}return Gt}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(e){var i=Wg.current;E$1(Wg),e._currentValue=i}function bh(e,i,s){for(;e!==null;){var a=e.alternate;if((e.childLanes&i)!==i?(e.childLanes|=i,a!==null&&(a.childLanes|=i)):a!==null&&(a.childLanes&i)!==i&&(a.childLanes|=i),e===s)break;e=e.return}}function ch(e,i){Xg=e,Zg=Yg=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&i&&(dh=!0),e.firstContext=null)}function eh(e){var i=e._currentValue;if(Zg!==e)if(e={context:e,memoizedValue:i,next:null},Yg===null){if(Xg===null)throw Error(p(308));Yg=e,Xg.dependencies={lanes:0,firstContext:e}}else Yg=Yg.next=e;return i}var fh=null;function gh(e){fh===null?fh=[e]:fh.push(e)}function hh(e,i,s,a){var b=i.interleaved;return b===null?(s.next=s,gh(i)):(s.next=b.next,b.next=s),i.interleaved=s,ih(e,a)}function ih(e,i){e.lanes|=i;var s=e.alternate;for(s!==null&&(s.lanes|=i),s=e,e=e.return;e!==null;)e.childLanes|=i,s=e.alternate,s!==null&&(s.childLanes|=i),s=e,e=e.return;return s.tag===3?s.stateNode:null}var jh=!1;function kh(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(e,i){e=e.updateQueue,i.updateQueue===e&&(i.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function mh(e,i){return{eventTime:e,lane:i,tag:0,payload:null,callback:null,next:null}}function nh(e,i,s){var a=e.updateQueue;if(a===null)return null;if(a=a.shared,K&2){var b=a.pending;return b===null?i.next=i:(i.next=b.next,b.next=i),a.pending=i,ih(e,s)}return b=a.interleaved,b===null?(i.next=i,gh(a)):(i.next=b.next,b.next=i),a.interleaved=i,ih(e,s)}function oh(e,i,s){if(i=i.updateQueue,i!==null&&(i=i.shared,(s&4194240)!==0)){var a=i.lanes;a&=e.pendingLanes,s|=a,i.lanes=s,Cc(e,s)}}function ph(e,i){var s=e.updateQueue,a=e.alternate;if(a!==null&&(a=a.updateQueue,s===a)){var b=null,et=null;if(s=s.firstBaseUpdate,s!==null){do{var nt={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};et===null?b=et=nt:et=et.next=nt,s=s.next}while(s!==null);et===null?b=et=i:et=et.next=i}else b=et=i;s={baseState:a.baseState,firstBaseUpdate:b,lastBaseUpdate:et,shared:a.shared,effects:a.effects},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=i:e.next=i,s.lastBaseUpdate=i}function qh(e,i,s,a){var b=e.updateQueue;jh=!1;var et=b.firstBaseUpdate,nt=b.lastBaseUpdate,c=b.shared.pending;if(c!==null){b.shared.pending=null;var ct=c,pt=ct.next;ct.next=null,nt===null?et=pt:nt.next=pt,nt=ct;var xt=e.alternate;xt!==null&&(xt=xt.updateQueue,c=xt.lastBaseUpdate,c!==nt&&(c===null?xt.firstBaseUpdate=pt:c.next=pt,xt.lastBaseUpdate=ct))}if(et!==null){var St=b.baseState;nt=0,xt=pt=ct=null,c=et;do{var Et=c.lane,Rt=c.eventTime;if((a&Et)===Et){xt!==null&&(xt=xt.next={eventTime:Rt,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var Nt=e,It=c;switch(Et=i,Rt=s,It.tag){case 1:if(Nt=It.payload,typeof Nt=="function"){St=Nt.call(Rt,St,Et);break e}St=Nt;break e;case 3:Nt.flags=Nt.flags&-65537|128;case 0:if(Nt=It.payload,Et=typeof Nt=="function"?Nt.call(Rt,St,Et):Nt,Et==null)break e;St=A({},St,Et);break e;case 2:jh=!0}}c.callback!==null&&c.lane!==0&&(e.flags|=64,Et=b.effects,Et===null?b.effects=[c]:Et.push(c))}else Rt={eventTime:Rt,lane:Et,tag:c.tag,payload:c.payload,callback:c.callback,next:null},xt===null?(pt=xt=Rt,ct=St):xt=xt.next=Rt,nt|=Et;if(c=c.next,c===null){if(c=b.shared.pending,c===null)break;Et=c,c=Et.next,Et.next=null,b.lastBaseUpdate=Et,b.shared.pending=null}}while(!0);if(xt===null&&(ct=St),b.baseState=ct,b.firstBaseUpdate=pt,b.lastBaseUpdate=xt,i=b.shared.interleaved,i!==null){b=i;do nt|=b.lane,b=b.next;while(b!==i)}else et===null&&(b.shared.lanes=0);rh|=nt,e.lanes=nt,e.memoizedState=St}}function sh(e,i,s){if(e=i.effects,i.effects=null,e!==null)for(i=0;i<e.length;i++){var a=e[i],b=a.callback;if(b!==null){if(a.callback=null,a=s,typeof b!="function")throw Error(p(191,b));b.call(a)}}}var th={},uh=Uf(th),vh$1=Uf(th),wh=Uf(th);function xh(e){if(e===th)throw Error(p(174));return e}function yh(e,i){switch(G(wh,i),G(vh$1,e),G(uh,th),e=i.nodeType,e){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:lb(null,"");break;default:e=e===8?i.parentNode:i,i=e.namespaceURI||null,e=e.tagName,i=lb(i,e)}E$1(uh),G(uh,i)}function zh(){E$1(uh),E$1(vh$1),E$1(wh)}function Ah(e){xh(wh.current);var i=xh(uh.current),s=lb(i,e.type);i!==s&&(G(vh$1,e),G(uh,s))}function Bh(e){vh$1.current===e&&(E$1(uh),E$1(vh$1))}var L$1=Uf(0);function Ch(e){for(var i=e;i!==null;){if(i.tag===13){var s=i.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var Dh=[];function Eh(){for(var e=0;e<Dh.length;e++)Dh[e]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M$1=null,N=null,O=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P$1(){throw Error(p(321))}function Mh(e,i){if(i===null)return!1;for(var s=0;s<i.length&&s<e.length;s++)if(!He(e[s],i[s]))return!1;return!0}function Nh(e,i,s,a,b,et){if(Hh=et,M$1=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,Fh.current=e===null||e.memoizedState===null?Oh:Ph,e=s(a,b),Jh){et=0;do{if(Jh=!1,Kh=0,25<=et)throw Error(p(301));et+=1,O=N=null,i.updateQueue=null,Fh.current=Qh,e=s(a,b)}while(Jh)}if(Fh.current=Rh,i=N!==null&&N.next!==null,Hh=0,O=N=M$1=null,Ih=!1,i)throw Error(p(300));return e}function Sh(){var e=Kh!==0;return Kh=0,e}function Th(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O===null?M$1.memoizedState=O=e:O=O.next=e,O}function Uh(){if(N===null){var e=M$1.alternate;e=e!==null?e.memoizedState:null}else e=N.next;var i=O===null?M$1.memoizedState:O.next;if(i!==null)O=i,N=e;else{if(e===null)throw Error(p(310));N=e,e={memoizedState:N.memoizedState,baseState:N.baseState,baseQueue:N.baseQueue,queue:N.queue,next:null},O===null?M$1.memoizedState=O=e:O=O.next=e}return O}function Vh(e,i){return typeof i=="function"?i(e):i}function Wh(e){var i=Uh(),s=i.queue;if(s===null)throw Error(p(311));s.lastRenderedReducer=e;var a=N,b=a.baseQueue,et=s.pending;if(et!==null){if(b!==null){var nt=b.next;b.next=et.next,et.next=nt}a.baseQueue=b=et,s.pending=null}if(b!==null){et=b.next,a=a.baseState;var c=nt=null,ct=null,pt=et;do{var xt=pt.lane;if((Hh&xt)===xt)ct!==null&&(ct=ct.next={lane:0,action:pt.action,hasEagerState:pt.hasEagerState,eagerState:pt.eagerState,next:null}),a=pt.hasEagerState?pt.eagerState:e(a,pt.action);else{var St={lane:xt,action:pt.action,hasEagerState:pt.hasEagerState,eagerState:pt.eagerState,next:null};ct===null?(c=ct=St,nt=a):ct=ct.next=St,M$1.lanes|=xt,rh|=xt}pt=pt.next}while(pt!==null&&pt!==et);ct===null?nt=a:ct.next=c,He(a,i.memoizedState)||(dh=!0),i.memoizedState=a,i.baseState=nt,i.baseQueue=ct,s.lastRenderedState=a}if(e=s.interleaved,e!==null){b=e;do et=b.lane,M$1.lanes|=et,rh|=et,b=b.next;while(b!==e)}else b===null&&(s.lanes=0);return[i.memoizedState,s.dispatch]}function Xh(e){var i=Uh(),s=i.queue;if(s===null)throw Error(p(311));s.lastRenderedReducer=e;var a=s.dispatch,b=s.pending,et=i.memoizedState;if(b!==null){s.pending=null;var nt=b=b.next;do et=e(et,nt.action),nt=nt.next;while(nt!==b);He(et,i.memoizedState)||(dh=!0),i.memoizedState=et,i.baseQueue===null&&(i.baseState=et),s.lastRenderedState=et}return[et,a]}function Yh(){}function Zh(e,i){var s=M$1,a=Uh(),b=i(),et=!He(a.memoizedState,b);if(et&&(a.memoizedState=b,dh=!0),a=a.queue,$h(ai.bind(null,s,a,e),[e]),a.getSnapshot!==i||et||O!==null&&O.memoizedState.tag&1){if(s.flags|=2048,bi(9,ci.bind(null,s,a,b,i),void 0,null),Q===null)throw Error(p(349));Hh&30||di(s,i,b)}return b}function di(e,i,s){e.flags|=16384,e={getSnapshot:i,value:s},i=M$1.updateQueue,i===null?(i={lastEffect:null,stores:null},M$1.updateQueue=i,i.stores=[e]):(s=i.stores,s===null?i.stores=[e]:s.push(e))}function ci(e,i,s,a){i.value=s,i.getSnapshot=a,ei(i)&&fi(e)}function ai(e,i,s){return s(function(){ei(i)&&fi(e)})}function ei(e){var i=e.getSnapshot;e=e.value;try{var s=i();return!He(e,s)}catch{return!0}}function fi(e){var i=ih(e,1);i!==null&&gi(i,e,1,-1)}function hi(e){var i=Th();return typeof e=="function"&&(e=e()),i.memoizedState=i.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:e},i.queue=e,e=e.dispatch=ii.bind(null,M$1,e),[i.memoizedState,e]}function bi(e,i,s,a){return e={tag:e,create:i,destroy:s,deps:a,next:null},i=M$1.updateQueue,i===null?(i={lastEffect:null,stores:null},M$1.updateQueue=i,i.lastEffect=e.next=e):(s=i.lastEffect,s===null?i.lastEffect=e.next=e:(a=s.next,s.next=e,e.next=a,i.lastEffect=e)),e}function ji(){return Uh().memoizedState}function ki(e,i,s,a){var b=Th();M$1.flags|=e,b.memoizedState=bi(1|i,s,void 0,a===void 0?null:a)}function li(e,i,s,a){var b=Uh();a=a===void 0?null:a;var et=void 0;if(N!==null){var nt=N.memoizedState;if(et=nt.destroy,a!==null&&Mh(a,nt.deps)){b.memoizedState=bi(i,s,et,a);return}}M$1.flags|=e,b.memoizedState=bi(1|i,s,et,a)}function mi(e,i){return ki(8390656,8,e,i)}function $h(e,i){return li(2048,8,e,i)}function ni(e,i){return li(4,2,e,i)}function oi(e,i){return li(4,4,e,i)}function pi(e,i){if(typeof i=="function")return e=e(),i(e),function(){i(null)};if(i!=null)return e=e(),i.current=e,function(){i.current=null}}function qi(e,i,s){return s=s!=null?s.concat([e]):null,li(4,4,pi.bind(null,i,e),s)}function ri(){}function si(e,i){var s=Uh();i=i===void 0?null:i;var a=s.memoizedState;return a!==null&&i!==null&&Mh(i,a[1])?a[0]:(s.memoizedState=[e,i],e)}function ti(e,i){var s=Uh();i=i===void 0?null:i;var a=s.memoizedState;return a!==null&&i!==null&&Mh(i,a[1])?a[0]:(e=e(),s.memoizedState=[e,i],e)}function ui$1(e,i,s){return Hh&21?(He(s,i)||(s=yc(),M$1.lanes|=s,rh|=s,e.baseState=!0),i):(e.baseState&&(e.baseState=!1,dh=!0),e.memoizedState=s)}function vi(e,i){var s=C;C=s!==0&&4>s?s:4,e(!0);var a=Gh.transition;Gh.transition={};try{e(!1),i()}finally{C=s,Gh.transition=a}}function wi(){return Uh().memoizedState}function xi(e,i,s){var a=yi(e);if(s={lane:a,action:s,hasEagerState:!1,eagerState:null,next:null},zi(e))Ai(i,s);else if(s=hh(e,i,s,a),s!==null){var b=R();gi(s,e,a,b),Bi(s,i,a)}}function ii(e,i,s){var a=yi(e),b={lane:a,action:s,hasEagerState:!1,eagerState:null,next:null};if(zi(e))Ai(i,b);else{var et=e.alternate;if(e.lanes===0&&(et===null||et.lanes===0)&&(et=i.lastRenderedReducer,et!==null))try{var nt=i.lastRenderedState,c=et(nt,s);if(b.hasEagerState=!0,b.eagerState=c,He(c,nt)){var ct=i.interleaved;ct===null?(b.next=b,gh(i)):(b.next=ct.next,ct.next=b),i.interleaved=b;return}}catch{}finally{}s=hh(e,i,b,a),s!==null&&(b=R(),gi(s,e,a,b),Bi(s,i,a))}}function zi(e){var i=e.alternate;return e===M$1||i!==null&&i===M$1}function Ai(e,i){Jh=Ih=!0;var s=e.pending;s===null?i.next=i:(i.next=s.next,s.next=i),e.pending=i}function Bi(e,i,s){if(s&4194240){var a=i.lanes;a&=e.pendingLanes,s|=a,i.lanes=s,Cc(e,s)}}var Rh={readContext:eh,useCallback:P$1,useContext:P$1,useEffect:P$1,useImperativeHandle:P$1,useInsertionEffect:P$1,useLayoutEffect:P$1,useMemo:P$1,useReducer:P$1,useRef:P$1,useState:P$1,useDebugValue:P$1,useDeferredValue:P$1,useTransition:P$1,useMutableSource:P$1,useSyncExternalStore:P$1,useId:P$1,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(e,i){return Th().memoizedState=[e,i===void 0?null:i],e},useContext:eh,useEffect:mi,useImperativeHandle:function(e,i,s){return s=s!=null?s.concat([e]):null,ki(4194308,4,pi.bind(null,i,e),s)},useLayoutEffect:function(e,i){return ki(4194308,4,e,i)},useInsertionEffect:function(e,i){return ki(4,2,e,i)},useMemo:function(e,i){var s=Th();return i=i===void 0?null:i,e=e(),s.memoizedState=[e,i],e},useReducer:function(e,i,s){var a=Th();return i=s!==void 0?s(i):i,a.memoizedState=a.baseState=i,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},a.queue=e,e=e.dispatch=xi.bind(null,M$1,e),[a.memoizedState,e]},useRef:function(e){var i=Th();return e={current:e},i.memoizedState=e},useState:hi,useDebugValue:ri,useDeferredValue:function(e){return Th().memoizedState=e},useTransition:function(){var e=hi(!1),i=e[0];return e=vi.bind(null,e[1]),Th().memoizedState=e,[i,e]},useMutableSource:function(){},useSyncExternalStore:function(e,i,s){var a=M$1,b=Th();if(I){if(s===void 0)throw Error(p(407));s=s()}else{if(s=i(),Q===null)throw Error(p(349));Hh&30||di(a,i,s)}b.memoizedState=s;var et={value:s,getSnapshot:i};return b.queue=et,mi(ai.bind(null,a,et,e),[e]),a.flags|=2048,bi(9,ci.bind(null,a,et,s,i),void 0,null),s},useId:function(){var e=Th(),i=Q.identifierPrefix;if(I){var s=sg,a=rg;s=(a&~(1<<32-oc(a)-1)).toString(32)+s,i=":"+i+"R"+s,s=Kh++,0<s&&(i+="H"+s.toString(32)),i+=":"}else s=Lh++,i=":"+i+"r"+s.toString(32)+":";return e.memoizedState=i},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(e){var i=Uh();return ui$1(i,N.memoizedState,e)},useTransition:function(){var e=Wh(Vh)[0],i=Uh().memoizedState;return[e,i]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(e){var i=Uh();return N===null?i.memoizedState=e:ui$1(i,N.memoizedState,e)},useTransition:function(){var e=Xh(Vh)[0],i=Uh().memoizedState;return[e,i]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(e,i){if(e&&e.defaultProps){i=A({},i),e=e.defaultProps;for(var s in e)i[s]===void 0&&(i[s]=e[s]);return i}return i}function Di(e,i,s,a){i=e.memoizedState,s=s(a,i),s=s==null?i:A({},i,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var Ei={isMounted:function(e){return(e=e._reactInternals)?Vb(e)===e:!1},enqueueSetState:function(e,i,s){e=e._reactInternals;var a=R(),b=yi(e),et=mh(a,b);et.payload=i,s!=null&&(et.callback=s),i=nh(e,et,b),i!==null&&(gi(i,e,b,a),oh(i,e,b))},enqueueReplaceState:function(e,i,s){e=e._reactInternals;var a=R(),b=yi(e),et=mh(a,b);et.tag=1,et.payload=i,s!=null&&(et.callback=s),i=nh(e,et,b),i!==null&&(gi(i,e,b,a),oh(i,e,b))},enqueueForceUpdate:function(e,i){e=e._reactInternals;var s=R(),a=yi(e),b=mh(s,a);b.tag=2,i!=null&&(b.callback=i),i=nh(e,b,a),i!==null&&(gi(i,e,a,s),oh(i,e,a))}};function Fi(e,i,s,a,b,et,nt){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(a,et,nt):i.prototype&&i.prototype.isPureReactComponent?!Ie(s,a)||!Ie(b,et):!0}function Gi(e,i,s){var a=!1,b=Vf,et=i.contextType;return typeof et=="object"&&et!==null?et=eh(et):(b=Zf(i)?Xf:H.current,a=i.contextTypes,et=(a=a!=null)?Yf(e,b):Vf),i=new i(s,et),e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=Ei,e.stateNode=i,i._reactInternals=e,a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=b,e.__reactInternalMemoizedMaskedChildContext=et),i}function Hi(e,i,s,a){e=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(s,a),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(s,a),i.state!==e&&Ei.enqueueReplaceState(i,i.state,null)}function Ii(e,i,s,a){var b=e.stateNode;b.props=s,b.state=e.memoizedState,b.refs={},kh(e);var et=i.contextType;typeof et=="object"&&et!==null?b.context=eh(et):(et=Zf(i)?Xf:H.current,b.context=Yf(e,et)),b.state=e.memoizedState,et=i.getDerivedStateFromProps,typeof et=="function"&&(Di(e,i,et,s),b.state=e.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(i=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),i!==b.state&&Ei.enqueueReplaceState(b,b.state,null),qh(e,s,b,a),b.state=e.memoizedState),typeof b.componentDidMount=="function"&&(e.flags|=4194308)}function Ji(e,i){try{var s="",a=i;do s+=Pa(a),a=a.return;while(a);var b=s}catch(et){b=`
Error generating stack: `+et.message+`
`+et.stack}return{value:e,source:i,stack:b,digest:null}}function Ki(e,i,s){return{value:e,source:null,stack:s??null,digest:i??null}}function Li(e,i){try{console.error(i.value)}catch(s){setTimeout(function(){throw s})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(e,i,s){s=mh(-1,s),s.tag=3,s.payload={element:null};var a=i.value;return s.callback=function(){Oi||(Oi=!0,Pi=a),Li(e,i)},s}function Qi(e,i,s){s=mh(-1,s),s.tag=3;var a=e.type.getDerivedStateFromError;if(typeof a=="function"){var b=i.value;s.payload=function(){return a(b)},s.callback=function(){Li(e,i)}}var et=e.stateNode;return et!==null&&typeof et.componentDidCatch=="function"&&(s.callback=function(){Li(e,i),typeof a!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var nt=i.stack;this.componentDidCatch(i.value,{componentStack:nt!==null?nt:""})}),s}function Si(e,i,s){var a=e.pingCache;if(a===null){a=e.pingCache=new Mi;var b=new Set;a.set(i,b)}else b=a.get(i),b===void 0&&(b=new Set,a.set(i,b));b.has(s)||(b.add(s),e=Ti.bind(null,e,i,s),i.then(e,e))}function Ui(e){do{var i;if((i=e.tag===13)&&(i=e.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return e;e=e.return}while(e!==null);return null}function Vi(e,i,s,a,b){return e.mode&1?(e.flags|=65536,e.lanes=b,e):(e===i?e.flags|=65536:(e.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(i=mh(-1,1),i.tag=2,nh(s,i,1))),s.lanes|=1),e)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(e,i,s,a){i.child=e===null?Vg(i,null,s,a):Ug(i,e.child,s,a)}function Yi(e,i,s,a,b){s=s.render;var et=i.ref;return ch(i,b),a=Nh(e,i,s,a,et,b),s=Sh(),e!==null&&!dh?(i.updateQueue=e.updateQueue,i.flags&=-2053,e.lanes&=~b,Zi(e,i,b)):(I&&s&&vg(i),i.flags|=1,Xi(e,i,a,b),i.child)}function $i(e,i,s,a,b){if(e===null){var et=s.type;return typeof et=="function"&&!aj(et)&&et.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(i.tag=15,i.type=et,bj(e,i,et,a,b)):(e=Rg(s.type,null,a,i,i.mode,b),e.ref=i.ref,e.return=i,i.child=e)}if(et=e.child,!(e.lanes&b)){var nt=et.memoizedProps;if(s=s.compare,s=s!==null?s:Ie,s(nt,a)&&e.ref===i.ref)return Zi(e,i,b)}return i.flags|=1,e=Pg(et,a),e.ref=i.ref,e.return=i,i.child=e}function bj(e,i,s,a,b){if(e!==null){var et=e.memoizedProps;if(Ie(et,a)&&e.ref===i.ref)if(dh=!1,i.pendingProps=a=et,(e.lanes&b)!==0)e.flags&131072&&(dh=!0);else return i.lanes=e.lanes,Zi(e,i,b)}return cj(e,i,s,a,b)}function dj(e,i,s){var a=i.pendingProps,b=a.children,et=e!==null?e.memoizedState:null;if(a.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(ej,fj),fj|=s;else{if(!(s&1073741824))return e=et!==null?et.baseLanes|s:s,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:e,cachePool:null,transitions:null},i.updateQueue=null,G(ej,fj),fj|=e,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=et!==null?et.baseLanes:s,G(ej,fj),fj|=a}else et!==null?(a=et.baseLanes|s,i.memoizedState=null):a=s,G(ej,fj),fj|=a;return Xi(e,i,b,s),i.child}function gj(e,i){var s=i.ref;(e===null&&s!==null||e!==null&&e.ref!==s)&&(i.flags|=512,i.flags|=2097152)}function cj(e,i,s,a,b){var et=Zf(s)?Xf:H.current;return et=Yf(i,et),ch(i,b),s=Nh(e,i,s,a,et,b),a=Sh(),e!==null&&!dh?(i.updateQueue=e.updateQueue,i.flags&=-2053,e.lanes&=~b,Zi(e,i,b)):(I&&a&&vg(i),i.flags|=1,Xi(e,i,s,b),i.child)}function hj(e,i,s,a,b){if(Zf(s)){var et=!0;cg(i)}else et=!1;if(ch(i,b),i.stateNode===null)ij(e,i),Gi(i,s,a),Ii(i,s,a,b),a=!0;else if(e===null){var nt=i.stateNode,c=i.memoizedProps;nt.props=c;var ct=nt.context,pt=s.contextType;typeof pt=="object"&&pt!==null?pt=eh(pt):(pt=Zf(s)?Xf:H.current,pt=Yf(i,pt));var xt=s.getDerivedStateFromProps,St=typeof xt=="function"||typeof nt.getSnapshotBeforeUpdate=="function";St||typeof nt.UNSAFE_componentWillReceiveProps!="function"&&typeof nt.componentWillReceiveProps!="function"||(c!==a||ct!==pt)&&Hi(i,nt,a,pt),jh=!1;var Et=i.memoizedState;nt.state=Et,qh(i,a,nt,b),ct=i.memoizedState,c!==a||Et!==ct||Wf.current||jh?(typeof xt=="function"&&(Di(i,s,xt,a),ct=i.memoizedState),(c=jh||Fi(i,s,c,a,Et,ct,pt))?(St||typeof nt.UNSAFE_componentWillMount!="function"&&typeof nt.componentWillMount!="function"||(typeof nt.componentWillMount=="function"&&nt.componentWillMount(),typeof nt.UNSAFE_componentWillMount=="function"&&nt.UNSAFE_componentWillMount()),typeof nt.componentDidMount=="function"&&(i.flags|=4194308)):(typeof nt.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=a,i.memoizedState=ct),nt.props=a,nt.state=ct,nt.context=pt,a=c):(typeof nt.componentDidMount=="function"&&(i.flags|=4194308),a=!1)}else{nt=i.stateNode,lh(e,i),c=i.memoizedProps,pt=i.type===i.elementType?c:Ci(i.type,c),nt.props=pt,St=i.pendingProps,Et=nt.context,ct=s.contextType,typeof ct=="object"&&ct!==null?ct=eh(ct):(ct=Zf(s)?Xf:H.current,ct=Yf(i,ct));var Rt=s.getDerivedStateFromProps;(xt=typeof Rt=="function"||typeof nt.getSnapshotBeforeUpdate=="function")||typeof nt.UNSAFE_componentWillReceiveProps!="function"&&typeof nt.componentWillReceiveProps!="function"||(c!==St||Et!==ct)&&Hi(i,nt,a,ct),jh=!1,Et=i.memoizedState,nt.state=Et,qh(i,a,nt,b);var Nt=i.memoizedState;c!==St||Et!==Nt||Wf.current||jh?(typeof Rt=="function"&&(Di(i,s,Rt,a),Nt=i.memoizedState),(pt=jh||Fi(i,s,pt,a,Et,Nt,ct)||!1)?(xt||typeof nt.UNSAFE_componentWillUpdate!="function"&&typeof nt.componentWillUpdate!="function"||(typeof nt.componentWillUpdate=="function"&&nt.componentWillUpdate(a,Nt,ct),typeof nt.UNSAFE_componentWillUpdate=="function"&&nt.UNSAFE_componentWillUpdate(a,Nt,ct)),typeof nt.componentDidUpdate=="function"&&(i.flags|=4),typeof nt.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof nt.componentDidUpdate!="function"||c===e.memoizedProps&&Et===e.memoizedState||(i.flags|=4),typeof nt.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&Et===e.memoizedState||(i.flags|=1024),i.memoizedProps=a,i.memoizedState=Nt),nt.props=a,nt.state=Nt,nt.context=ct,a=pt):(typeof nt.componentDidUpdate!="function"||c===e.memoizedProps&&Et===e.memoizedState||(i.flags|=4),typeof nt.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&Et===e.memoizedState||(i.flags|=1024),a=!1)}return jj(e,i,s,a,et,b)}function jj(e,i,s,a,b,et){gj(e,i);var nt=(i.flags&128)!==0;if(!a&&!nt)return b&&dg(i,s,!1),Zi(e,i,et);a=i.stateNode,Wi.current=i;var c=nt&&typeof s.getDerivedStateFromError!="function"?null:a.render();return i.flags|=1,e!==null&&nt?(i.child=Ug(i,e.child,null,et),i.child=Ug(i,null,c,et)):Xi(e,i,c,et),i.memoizedState=a.state,b&&dg(i,s,!0),i.child}function kj(e){var i=e.stateNode;i.pendingContext?ag(e,i.pendingContext,i.pendingContext!==i.context):i.context&&ag(e,i.context,!1),yh(e,i.containerInfo)}function lj(e,i,s,a,b){return Ig(),Jg(b),i.flags|=256,Xi(e,i,s,a),i.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(e){return{baseLanes:e,cachePool:null,transitions:null}}function oj(e,i,s){var a=i.pendingProps,b=L$1.current,et=!1,nt=(i.flags&128)!==0,c;if((c=nt)||(c=e!==null&&e.memoizedState===null?!1:(b&2)!==0),c?(et=!0,i.flags&=-129):(e===null||e.memoizedState!==null)&&(b|=1),G(L$1,b&1),e===null)return Eg(i),e=i.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(i.mode&1?e.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(nt=a.children,e=a.fallback,et?(a=i.mode,et=i.child,nt={mode:"hidden",children:nt},!(a&1)&&et!==null?(et.childLanes=0,et.pendingProps=nt):et=pj(nt,a,0,null),e=Tg(e,a,s,null),et.return=i,e.return=i,et.sibling=e,i.child=et,i.child.memoizedState=nj(s),i.memoizedState=mj,e):qj(i,nt));if(b=e.memoizedState,b!==null&&(c=b.dehydrated,c!==null))return rj(e,i,nt,a,c,b,s);if(et){et=a.fallback,nt=i.mode,b=e.child,c=b.sibling;var ct={mode:"hidden",children:a.children};return!(nt&1)&&i.child!==b?(a=i.child,a.childLanes=0,a.pendingProps=ct,i.deletions=null):(a=Pg(b,ct),a.subtreeFlags=b.subtreeFlags&14680064),c!==null?et=Pg(c,et):(et=Tg(et,nt,s,null),et.flags|=2),et.return=i,a.return=i,a.sibling=et,i.child=a,a=et,et=i.child,nt=e.child.memoizedState,nt=nt===null?nj(s):{baseLanes:nt.baseLanes|s,cachePool:null,transitions:nt.transitions},et.memoizedState=nt,et.childLanes=e.childLanes&~s,i.memoizedState=mj,a}return et=e.child,e=et.sibling,a=Pg(et,{mode:"visible",children:a.children}),!(i.mode&1)&&(a.lanes=s),a.return=i,a.sibling=null,e!==null&&(s=i.deletions,s===null?(i.deletions=[e],i.flags|=16):s.push(e)),i.child=a,i.memoizedState=null,a}function qj(e,i){return i=pj({mode:"visible",children:i},e.mode,0,null),i.return=e,e.child=i}function sj(e,i,s,a){return a!==null&&Jg(a),Ug(i,e.child,null,s),e=qj(i,i.pendingProps.children),e.flags|=2,i.memoizedState=null,e}function rj(e,i,s,a,b,et,nt){if(s)return i.flags&256?(i.flags&=-257,a=Ki(Error(p(422))),sj(e,i,nt,a)):i.memoizedState!==null?(i.child=e.child,i.flags|=128,null):(et=a.fallback,b=i.mode,a=pj({mode:"visible",children:a.children},b,0,null),et=Tg(et,b,nt,null),et.flags|=2,a.return=i,et.return=i,a.sibling=et,i.child=a,i.mode&1&&Ug(i,e.child,null,nt),i.child.memoizedState=nj(nt),i.memoizedState=mj,et);if(!(i.mode&1))return sj(e,i,nt,null);if(b.data==="$!"){if(a=b.nextSibling&&b.nextSibling.dataset,a)var c=a.dgst;return a=c,et=Error(p(419)),a=Ki(et,a,void 0),sj(e,i,nt,a)}if(c=(nt&e.childLanes)!==0,dh||c){if(a=Q,a!==null){switch(nt&-nt){case 4:b=2;break;case 16:b=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:b=32;break;case 536870912:b=268435456;break;default:b=0}b=b&(a.suspendedLanes|nt)?0:b,b!==0&&b!==et.retryLane&&(et.retryLane=b,ih(e,b),gi(a,e,b,-1))}return tj(),a=Ki(Error(p(421))),sj(e,i,nt,a)}return b.data==="$?"?(i.flags|=128,i.child=e.child,i=uj.bind(null,e),b._reactRetry=i,null):(e=et.treeContext,yg=Lf(b.nextSibling),xg=i,I=!0,zg=null,e!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=e.id,sg=e.overflow,qg=i),i=qj(i,a.children),i.flags|=4096,i)}function vj(e,i,s){e.lanes|=i;var a=e.alternate;a!==null&&(a.lanes|=i),bh(e.return,i,s)}function wj(e,i,s,a,b){var et=e.memoizedState;et===null?e.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:a,tail:s,tailMode:b}:(et.isBackwards=i,et.rendering=null,et.renderingStartTime=0,et.last=a,et.tail=s,et.tailMode=b)}function xj(e,i,s){var a=i.pendingProps,b=a.revealOrder,et=a.tail;if(Xi(e,i,a.children,s),a=L$1.current,a&2)a=a&1|2,i.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=i.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&vj(e,s,i);else if(e.tag===19)vj(e,s,i);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break e;for(;e.sibling===null;){if(e.return===null||e.return===i)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}a&=1}if(G(L$1,a),!(i.mode&1))i.memoizedState=null;else switch(b){case"forwards":for(s=i.child,b=null;s!==null;)e=s.alternate,e!==null&&Ch(e)===null&&(b=s),s=s.sibling;s=b,s===null?(b=i.child,i.child=null):(b=s.sibling,s.sibling=null),wj(i,!1,b,s,et);break;case"backwards":for(s=null,b=i.child,i.child=null;b!==null;){if(e=b.alternate,e!==null&&Ch(e)===null){i.child=b;break}e=b.sibling,b.sibling=s,s=b,b=e}wj(i,!0,s,null,et);break;case"together":wj(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function ij(e,i){!(i.mode&1)&&e!==null&&(e.alternate=null,i.alternate=null,i.flags|=2)}function Zi(e,i,s){if(e!==null&&(i.dependencies=e.dependencies),rh|=i.lanes,!(s&i.childLanes))return null;if(e!==null&&i.child!==e.child)throw Error(p(153));if(i.child!==null){for(e=i.child,s=Pg(e,e.pendingProps),i.child=s,s.return=i;e.sibling!==null;)e=e.sibling,s=s.sibling=Pg(e,e.pendingProps),s.return=i;s.sibling=null}return i.child}function yj(e,i,s){switch(i.tag){case 3:kj(i),Ig();break;case 5:Ah(i);break;case 1:Zf(i.type)&&cg(i);break;case 4:yh(i,i.stateNode.containerInfo);break;case 10:var a=i.type._context,b=i.memoizedProps.value;G(Wg,a._currentValue),a._currentValue=b;break;case 13:if(a=i.memoizedState,a!==null)return a.dehydrated!==null?(G(L$1,L$1.current&1),i.flags|=128,null):s&i.child.childLanes?oj(e,i,s):(G(L$1,L$1.current&1),e=Zi(e,i,s),e!==null?e.sibling:null);G(L$1,L$1.current&1);break;case 19:if(a=(s&i.childLanes)!==0,e.flags&128){if(a)return xj(e,i,s);i.flags|=128}if(b=i.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),G(L$1,L$1.current),a)break;return null;case 22:case 23:return i.lanes=0,dj(e,i,s)}return Zi(e,i,s)}var zj,Aj,Bj,Cj;zj=function(e,i){for(var s=i.child;s!==null;){if(s.tag===5||s.tag===6)e.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};Aj=function(){};Bj=function(e,i,s,a){var b=e.memoizedProps;if(b!==a){e=i.stateNode,xh(uh.current);var et=null;switch(s){case"input":b=Ya(e,b),a=Ya(e,a),et=[];break;case"select":b=A({},b,{value:void 0}),a=A({},a,{value:void 0}),et=[];break;case"textarea":b=gb(e,b),a=gb(e,a),et=[];break;default:typeof b.onClick!="function"&&typeof a.onClick=="function"&&(e.onclick=Bf)}ub(s,a);var nt;s=null;for(pt in b)if(!a.hasOwnProperty(pt)&&b.hasOwnProperty(pt)&&b[pt]!=null)if(pt==="style"){var c=b[pt];for(nt in c)c.hasOwnProperty(nt)&&(s||(s={}),s[nt]="")}else pt!=="dangerouslySetInnerHTML"&&pt!=="children"&&pt!=="suppressContentEditableWarning"&&pt!=="suppressHydrationWarning"&&pt!=="autoFocus"&&(ea.hasOwnProperty(pt)?et||(et=[]):(et=et||[]).push(pt,null));for(pt in a){var ct=a[pt];if(c=b!=null?b[pt]:void 0,a.hasOwnProperty(pt)&&ct!==c&&(ct!=null||c!=null))if(pt==="style")if(c){for(nt in c)!c.hasOwnProperty(nt)||ct&&ct.hasOwnProperty(nt)||(s||(s={}),s[nt]="");for(nt in ct)ct.hasOwnProperty(nt)&&c[nt]!==ct[nt]&&(s||(s={}),s[nt]=ct[nt])}else s||(et||(et=[]),et.push(pt,s)),s=ct;else pt==="dangerouslySetInnerHTML"?(ct=ct?ct.__html:void 0,c=c?c.__html:void 0,ct!=null&&c!==ct&&(et=et||[]).push(pt,ct)):pt==="children"?typeof ct!="string"&&typeof ct!="number"||(et=et||[]).push(pt,""+ct):pt!=="suppressContentEditableWarning"&&pt!=="suppressHydrationWarning"&&(ea.hasOwnProperty(pt)?(ct!=null&&pt==="onScroll"&&D$1("scroll",e),et||c===ct||(et=[])):(et=et||[]).push(pt,ct))}s&&(et=et||[]).push("style",s);var pt=et;(i.updateQueue=pt)&&(i.flags|=4)}};Cj=function(e,i,s,a){s!==a&&(i.flags|=4)};function Dj(e,i){if(!I)switch(e.tailMode){case"hidden":i=e.tail;for(var s=null;i!==null;)i.alternate!==null&&(s=i),i=i.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var a=null;s!==null;)s.alternate!==null&&(a=s),s=s.sibling;a===null?i||e.tail===null?e.tail=null:e.tail.sibling=null:a.sibling=null}}function S(e){var i=e.alternate!==null&&e.alternate.child===e.child,s=0,a=0;if(i)for(var b=e.child;b!==null;)s|=b.lanes|b.childLanes,a|=b.subtreeFlags&14680064,a|=b.flags&14680064,b.return=e,b=b.sibling;else for(b=e.child;b!==null;)s|=b.lanes|b.childLanes,a|=b.subtreeFlags,a|=b.flags,b.return=e,b=b.sibling;return e.subtreeFlags|=a,e.childLanes=s,i}function Ej(e,i,s){var a=i.pendingProps;switch(wg(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S(i),null;case 1:return Zf(i.type)&&$f(),S(i),null;case 3:return a=i.stateNode,zh(),E$1(Wf),E$1(H),Eh(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(Gg(i)?i.flags|=4:e===null||e.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(e,i),S(i),null;case 5:Bh(i);var b=xh(wh.current);if(s=i.type,e!==null&&i.stateNode!=null)Bj(e,i,s,a,b),e.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!a){if(i.stateNode===null)throw Error(p(166));return S(i),null}if(e=xh(uh.current),Gg(i)){a=i.stateNode,s=i.type;var et=i.memoizedProps;switch(a[Of]=i,a[Pf]=et,e=(i.mode&1)!==0,s){case"dialog":D$1("cancel",a),D$1("close",a);break;case"iframe":case"object":case"embed":D$1("load",a);break;case"video":case"audio":for(b=0;b<lf.length;b++)D$1(lf[b],a);break;case"source":D$1("error",a);break;case"img":case"image":case"link":D$1("error",a),D$1("load",a);break;case"details":D$1("toggle",a);break;case"input":Za(a,et),D$1("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!et.multiple},D$1("invalid",a);break;case"textarea":hb(a,et),D$1("invalid",a)}ub(s,et),b=null;for(var nt in et)if(et.hasOwnProperty(nt)){var c=et[nt];nt==="children"?typeof c=="string"?a.textContent!==c&&(et.suppressHydrationWarning!==!0&&Af(a.textContent,c,e),b=["children",c]):typeof c=="number"&&a.textContent!==""+c&&(et.suppressHydrationWarning!==!0&&Af(a.textContent,c,e),b=["children",""+c]):ea.hasOwnProperty(nt)&&c!=null&&nt==="onScroll"&&D$1("scroll",a)}switch(s){case"input":Va(a),db(a,et,!0);break;case"textarea":Va(a),jb(a);break;case"select":case"option":break;default:typeof et.onClick=="function"&&(a.onclick=Bf)}a=b,i.updateQueue=a,a!==null&&(i.flags|=4)}else{nt=b.nodeType===9?b:b.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=kb(s)),e==="http://www.w3.org/1999/xhtml"?s==="script"?(e=nt.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof a.is=="string"?e=nt.createElement(s,{is:a.is}):(e=nt.createElement(s),s==="select"&&(nt=e,a.multiple?nt.multiple=!0:a.size&&(nt.size=a.size))):e=nt.createElementNS(e,s),e[Of]=i,e[Pf]=a,zj(e,i,!1,!1),i.stateNode=e;e:{switch(nt=vb(s,a),s){case"dialog":D$1("cancel",e),D$1("close",e),b=a;break;case"iframe":case"object":case"embed":D$1("load",e),b=a;break;case"video":case"audio":for(b=0;b<lf.length;b++)D$1(lf[b],e);b=a;break;case"source":D$1("error",e),b=a;break;case"img":case"image":case"link":D$1("error",e),D$1("load",e),b=a;break;case"details":D$1("toggle",e),b=a;break;case"input":Za(e,a),b=Ya(e,a),D$1("invalid",e);break;case"option":b=a;break;case"select":e._wrapperState={wasMultiple:!!a.multiple},b=A({},a,{value:void 0}),D$1("invalid",e);break;case"textarea":hb(e,a),b=gb(e,a),D$1("invalid",e);break;default:b=a}ub(s,b),c=b;for(et in c)if(c.hasOwnProperty(et)){var ct=c[et];et==="style"?sb(e,ct):et==="dangerouslySetInnerHTML"?(ct=ct?ct.__html:void 0,ct!=null&&nb(e,ct)):et==="children"?typeof ct=="string"?(s!=="textarea"||ct!=="")&&ob(e,ct):typeof ct=="number"&&ob(e,""+ct):et!=="suppressContentEditableWarning"&&et!=="suppressHydrationWarning"&&et!=="autoFocus"&&(ea.hasOwnProperty(et)?ct!=null&&et==="onScroll"&&D$1("scroll",e):ct!=null&&ta(e,et,ct,nt))}switch(s){case"input":Va(e),db(e,a,!1);break;case"textarea":Va(e),jb(e);break;case"option":a.value!=null&&e.setAttribute("value",""+Sa(a.value));break;case"select":e.multiple=!!a.multiple,et=a.value,et!=null?fb(e,!!a.multiple,et,!1):a.defaultValue!=null&&fb(e,!!a.multiple,a.defaultValue,!0);break;default:typeof b.onClick=="function"&&(e.onclick=Bf)}switch(s){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return S(i),null;case 6:if(e&&i.stateNode!=null)Cj(e,i,e.memoizedProps,a);else{if(typeof a!="string"&&i.stateNode===null)throw Error(p(166));if(s=xh(wh.current),xh(uh.current),Gg(i)){if(a=i.stateNode,s=i.memoizedProps,a[Of]=i,(et=a.nodeValue!==s)&&(e=xg,e!==null))switch(e.tag){case 3:Af(a.nodeValue,s,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Af(a.nodeValue,s,(e.mode&1)!==0)}et&&(i.flags|=4)}else a=(s.nodeType===9?s:s.ownerDocument).createTextNode(a),a[Of]=i,i.stateNode=a}return S(i),null;case 13:if(E$1(L$1),a=i.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(I&&yg!==null&&i.mode&1&&!(i.flags&128))Hg(),Ig(),i.flags|=98560,et=!1;else if(et=Gg(i),a!==null&&a.dehydrated!==null){if(e===null){if(!et)throw Error(p(318));if(et=i.memoizedState,et=et!==null?et.dehydrated:null,!et)throw Error(p(317));et[Of]=i}else Ig(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;S(i),et=!1}else zg!==null&&(Fj(zg),zg=null),et=!0;if(!et)return i.flags&65536?i:null}return i.flags&128?(i.lanes=s,i):(a=a!==null,a!==(e!==null&&e.memoizedState!==null)&&a&&(i.child.flags|=8192,i.mode&1&&(e===null||L$1.current&1?T===0&&(T=3):tj())),i.updateQueue!==null&&(i.flags|=4),S(i),null);case 4:return zh(),Aj(e,i),e===null&&sf(i.stateNode.containerInfo),S(i),null;case 10:return ah(i.type._context),S(i),null;case 17:return Zf(i.type)&&$f(),S(i),null;case 19:if(E$1(L$1),et=i.memoizedState,et===null)return S(i),null;if(a=(i.flags&128)!==0,nt=et.rendering,nt===null)if(a)Dj(et,!1);else{if(T!==0||e!==null&&e.flags&128)for(e=i.child;e!==null;){if(nt=Ch(e),nt!==null){for(i.flags|=128,Dj(et,!1),a=nt.updateQueue,a!==null&&(i.updateQueue=a,i.flags|=4),i.subtreeFlags=0,a=s,s=i.child;s!==null;)et=s,e=a,et.flags&=14680066,nt=et.alternate,nt===null?(et.childLanes=0,et.lanes=e,et.child=null,et.subtreeFlags=0,et.memoizedProps=null,et.memoizedState=null,et.updateQueue=null,et.dependencies=null,et.stateNode=null):(et.childLanes=nt.childLanes,et.lanes=nt.lanes,et.child=nt.child,et.subtreeFlags=0,et.deletions=null,et.memoizedProps=nt.memoizedProps,et.memoizedState=nt.memoizedState,et.updateQueue=nt.updateQueue,et.type=nt.type,e=nt.dependencies,et.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),s=s.sibling;return G(L$1,L$1.current&1|2),i.child}e=e.sibling}et.tail!==null&&B()>Gj&&(i.flags|=128,a=!0,Dj(et,!1),i.lanes=4194304)}else{if(!a)if(e=Ch(nt),e!==null){if(i.flags|=128,a=!0,s=e.updateQueue,s!==null&&(i.updateQueue=s,i.flags|=4),Dj(et,!0),et.tail===null&&et.tailMode==="hidden"&&!nt.alternate&&!I)return S(i),null}else 2*B()-et.renderingStartTime>Gj&&s!==1073741824&&(i.flags|=128,a=!0,Dj(et,!1),i.lanes=4194304);et.isBackwards?(nt.sibling=i.child,i.child=nt):(s=et.last,s!==null?s.sibling=nt:i.child=nt,et.last=nt)}return et.tail!==null?(i=et.tail,et.rendering=i,et.tail=i.sibling,et.renderingStartTime=B(),i.sibling=null,s=L$1.current,G(L$1,a?s&1|2:s&1),i):(S(i),null);case 22:case 23:return Hj(),a=i.memoizedState!==null,e!==null&&e.memoizedState!==null!==a&&(i.flags|=8192),a&&i.mode&1?fj&1073741824&&(S(i),i.subtreeFlags&6&&(i.flags|=8192)):S(i),null;case 24:return null;case 25:return null}throw Error(p(156,i.tag))}function Ij(e,i){switch(wg(i),i.tag){case 1:return Zf(i.type)&&$f(),e=i.flags,e&65536?(i.flags=e&-65537|128,i):null;case 3:return zh(),E$1(Wf),E$1(H),Eh(),e=i.flags,e&65536&&!(e&128)?(i.flags=e&-65537|128,i):null;case 5:return Bh(i),null;case 13:if(E$1(L$1),e=i.memoizedState,e!==null&&e.dehydrated!==null){if(i.alternate===null)throw Error(p(340));Ig()}return e=i.flags,e&65536?(i.flags=e&-65537|128,i):null;case 19:return E$1(L$1),null;case 4:return zh(),null;case 10:return ah(i.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Lj(e,i){var s=e.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(a){W(e,i,a)}else s.current=null}function Mj(e,i,s){try{s()}catch(a){W(e,i,a)}}var Nj=!1;function Oj(e,i){if(Cf=dd,e=Me(),Ne(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var a=s.getSelection&&s.getSelection();if(a&&a.rangeCount!==0){s=a.anchorNode;var b=a.anchorOffset,et=a.focusNode;a=a.focusOffset;try{s.nodeType,et.nodeType}catch{s=null;break e}var nt=0,c=-1,ct=-1,pt=0,xt=0,St=e,Et=null;t:for(;;){for(var Rt;St!==s||b!==0&&St.nodeType!==3||(c=nt+b),St!==et||a!==0&&St.nodeType!==3||(ct=nt+a),St.nodeType===3&&(nt+=St.nodeValue.length),(Rt=St.firstChild)!==null;)Et=St,St=Rt;for(;;){if(St===e)break t;if(Et===s&&++pt===b&&(c=nt),Et===et&&++xt===a&&(ct=nt),(Rt=St.nextSibling)!==null)break;St=Et,Et=St.parentNode}St=Rt}s=c===-1||ct===-1?null:{start:c,end:ct}}else s=null}s=s||{start:0,end:0}}else s=null;for(Df={focusedElem:e,selectionRange:s},dd=!1,V=i;V!==null;)if(i=V,e=i.child,(i.subtreeFlags&1028)!==0&&e!==null)e.return=i,V=e;else for(;V!==null;){i=V;try{var Nt=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(Nt!==null){var It=Nt.memoizedProps,Gt=Nt.memoizedState,Dt=i.stateNode,Bt=Dt.getSnapshotBeforeUpdate(i.elementType===i.type?It:Ci(i.type,It),Gt);Dt.__reactInternalSnapshotBeforeUpdate=Bt}break;case 3:var Lt=i.stateNode.containerInfo;Lt.nodeType===1?Lt.textContent="":Lt.nodeType===9&&Lt.documentElement&&Lt.removeChild(Lt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}catch(Vt){W(i,i.return,Vt)}if(e=i.sibling,e!==null){e.return=i.return,V=e;break}V=i.return}return Nt=Nj,Nj=!1,Nt}function Pj(e,i,s){var a=i.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var b=a=a.next;do{if((b.tag&e)===e){var et=b.destroy;b.destroy=void 0,et!==void 0&&Mj(i,s,et)}b=b.next}while(b!==a)}}function Qj(e,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var s=i=i.next;do{if((s.tag&e)===e){var a=s.create;s.destroy=a()}s=s.next}while(s!==i)}}function Rj(e){var i=e.ref;if(i!==null){var s=e.stateNode;switch(e.tag){case 5:e=s;break;default:e=s}typeof i=="function"?i(e):i.current=e}}function Sj(e){var i=e.alternate;i!==null&&(e.alternate=null,Sj(i)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(i=e.stateNode,i!==null&&(delete i[Of],delete i[Pf],delete i[of],delete i[Qf],delete i[Rf])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Tj(e){return e.tag===5||e.tag===3||e.tag===4}function Uj(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Tj(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Vj(e,i,s){var a=e.tag;if(a===5||a===6)e=e.stateNode,i?s.nodeType===8?s.parentNode.insertBefore(e,i):s.insertBefore(e,i):(s.nodeType===8?(i=s.parentNode,i.insertBefore(e,s)):(i=s,i.appendChild(e)),s=s._reactRootContainer,s!=null||i.onclick!==null||(i.onclick=Bf));else if(a!==4&&(e=e.child,e!==null))for(Vj(e,i,s),e=e.sibling;e!==null;)Vj(e,i,s),e=e.sibling}function Wj(e,i,s){var a=e.tag;if(a===5||a===6)e=e.stateNode,i?s.insertBefore(e,i):s.appendChild(e);else if(a!==4&&(e=e.child,e!==null))for(Wj(e,i,s),e=e.sibling;e!==null;)Wj(e,i,s),e=e.sibling}var X$1=null,Xj=!1;function Yj(e,i,s){for(s=s.child;s!==null;)Zj(e,i,s),s=s.sibling}function Zj(e,i,s){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,s)}catch{}switch(s.tag){case 5:U||Lj(s,i);case 6:var a=X$1,b=Xj;X$1=null,Yj(e,i,s),X$1=a,Xj=b,X$1!==null&&(Xj?(e=X$1,s=s.stateNode,e.nodeType===8?e.parentNode.removeChild(s):e.removeChild(s)):X$1.removeChild(s.stateNode));break;case 18:X$1!==null&&(Xj?(e=X$1,s=s.stateNode,e.nodeType===8?Kf(e.parentNode,s):e.nodeType===1&&Kf(e,s),bd(e)):Kf(X$1,s.stateNode));break;case 4:a=X$1,b=Xj,X$1=s.stateNode.containerInfo,Xj=!0,Yj(e,i,s),X$1=a,Xj=b;break;case 0:case 11:case 14:case 15:if(!U&&(a=s.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){b=a=a.next;do{var et=b,nt=et.destroy;et=et.tag,nt!==void 0&&(et&2||et&4)&&Mj(s,i,nt),b=b.next}while(b!==a)}Yj(e,i,s);break;case 1:if(!U&&(Lj(s,i),a=s.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=s.memoizedProps,a.state=s.memoizedState,a.componentWillUnmount()}catch(c){W(s,i,c)}Yj(e,i,s);break;case 21:Yj(e,i,s);break;case 22:s.mode&1?(U=(a=U)||s.memoizedState!==null,Yj(e,i,s),U=a):Yj(e,i,s);break;default:Yj(e,i,s)}}function ak(e){var i=e.updateQueue;if(i!==null){e.updateQueue=null;var s=e.stateNode;s===null&&(s=e.stateNode=new Kj),i.forEach(function(a){var b=bk.bind(null,e,a);s.has(a)||(s.add(a),a.then(b,b))})}}function ck(e,i){var s=i.deletions;if(s!==null)for(var a=0;a<s.length;a++){var b=s[a];try{var et=e,nt=i,c=nt;e:for(;c!==null;){switch(c.tag){case 5:X$1=c.stateNode,Xj=!1;break e;case 3:X$1=c.stateNode.containerInfo,Xj=!0;break e;case 4:X$1=c.stateNode.containerInfo,Xj=!0;break e}c=c.return}if(X$1===null)throw Error(p(160));Zj(et,nt,b),X$1=null,Xj=!1;var ct=b.alternate;ct!==null&&(ct.return=null),b.return=null}catch(pt){W(b,i,pt)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)dk(i,e),i=i.sibling}function dk(e,i){var s=e.alternate,a=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ck(i,e),ek(e),a&4){try{Pj(3,e,e.return),Qj(3,e)}catch(It){W(e,e.return,It)}try{Pj(5,e,e.return)}catch(It){W(e,e.return,It)}}break;case 1:ck(i,e),ek(e),a&512&&s!==null&&Lj(s,s.return);break;case 5:if(ck(i,e),ek(e),a&512&&s!==null&&Lj(s,s.return),e.flags&32){var b=e.stateNode;try{ob(b,"")}catch(It){W(e,e.return,It)}}if(a&4&&(b=e.stateNode,b!=null)){var et=e.memoizedProps,nt=s!==null?s.memoizedProps:et,c=e.type,ct=e.updateQueue;if(e.updateQueue=null,ct!==null)try{c==="input"&&et.type==="radio"&&et.name!=null&&ab(b,et),vb(c,nt);var pt=vb(c,et);for(nt=0;nt<ct.length;nt+=2){var xt=ct[nt],St=ct[nt+1];xt==="style"?sb(b,St):xt==="dangerouslySetInnerHTML"?nb(b,St):xt==="children"?ob(b,St):ta(b,xt,St,pt)}switch(c){case"input":bb(b,et);break;case"textarea":ib(b,et);break;case"select":var Et=b._wrapperState.wasMultiple;b._wrapperState.wasMultiple=!!et.multiple;var Rt=et.value;Rt!=null?fb(b,!!et.multiple,Rt,!1):Et!==!!et.multiple&&(et.defaultValue!=null?fb(b,!!et.multiple,et.defaultValue,!0):fb(b,!!et.multiple,et.multiple?[]:"",!1))}b[Pf]=et}catch(It){W(e,e.return,It)}}break;case 6:if(ck(i,e),ek(e),a&4){if(e.stateNode===null)throw Error(p(162));b=e.stateNode,et=e.memoizedProps;try{b.nodeValue=et}catch(It){W(e,e.return,It)}}break;case 3:if(ck(i,e),ek(e),a&4&&s!==null&&s.memoizedState.isDehydrated)try{bd(i.containerInfo)}catch(It){W(e,e.return,It)}break;case 4:ck(i,e),ek(e);break;case 13:ck(i,e),ek(e),b=e.child,b.flags&8192&&(et=b.memoizedState!==null,b.stateNode.isHidden=et,!et||b.alternate!==null&&b.alternate.memoizedState!==null||(fk=B())),a&4&&ak(e);break;case 22:if(xt=s!==null&&s.memoizedState!==null,e.mode&1?(U=(pt=U)||xt,ck(i,e),U=pt):ck(i,e),ek(e),a&8192){if(pt=e.memoizedState!==null,(e.stateNode.isHidden=pt)&&!xt&&e.mode&1)for(V=e,xt=e.child;xt!==null;){for(St=V=xt;V!==null;){switch(Et=V,Rt=Et.child,Et.tag){case 0:case 11:case 14:case 15:Pj(4,Et,Et.return);break;case 1:Lj(Et,Et.return);var Nt=Et.stateNode;if(typeof Nt.componentWillUnmount=="function"){a=Et,s=Et.return;try{i=a,Nt.props=i.memoizedProps,Nt.state=i.memoizedState,Nt.componentWillUnmount()}catch(It){W(a,s,It)}}break;case 5:Lj(Et,Et.return);break;case 22:if(Et.memoizedState!==null){gk(St);continue}}Rt!==null?(Rt.return=Et,V=Rt):gk(St)}xt=xt.sibling}e:for(xt=null,St=e;;){if(St.tag===5){if(xt===null){xt=St;try{b=St.stateNode,pt?(et=b.style,typeof et.setProperty=="function"?et.setProperty("display","none","important"):et.display="none"):(c=St.stateNode,ct=St.memoizedProps.style,nt=ct!=null&&ct.hasOwnProperty("display")?ct.display:null,c.style.display=rb("display",nt))}catch(It){W(e,e.return,It)}}}else if(St.tag===6){if(xt===null)try{St.stateNode.nodeValue=pt?"":St.memoizedProps}catch(It){W(e,e.return,It)}}else if((St.tag!==22&&St.tag!==23||St.memoizedState===null||St===e)&&St.child!==null){St.child.return=St,St=St.child;continue}if(St===e)break e;for(;St.sibling===null;){if(St.return===null||St.return===e)break e;xt===St&&(xt=null),St=St.return}xt===St&&(xt=null),St.sibling.return=St.return,St=St.sibling}}break;case 19:ck(i,e),ek(e),a&4&&ak(e);break;case 21:break;default:ck(i,e),ek(e)}}function ek(e){var i=e.flags;if(i&2){try{e:{for(var s=e.return;s!==null;){if(Tj(s)){var a=s;break e}s=s.return}throw Error(p(160))}switch(a.tag){case 5:var b=a.stateNode;a.flags&32&&(ob(b,""),a.flags&=-33);var et=Uj(e);Wj(e,et,b);break;case 3:case 4:var nt=a.stateNode.containerInfo,c=Uj(e);Vj(e,c,nt);break;default:throw Error(p(161))}}catch(ct){W(e,e.return,ct)}e.flags&=-3}i&4096&&(e.flags&=-4097)}function hk(e,i,s){V=e,ik(e)}function ik(e,i,s){for(var a=(e.mode&1)!==0;V!==null;){var b=V,et=b.child;if(b.tag===22&&a){var nt=b.memoizedState!==null||Jj;if(!nt){var c=b.alternate,ct=c!==null&&c.memoizedState!==null||U;c=Jj;var pt=U;if(Jj=nt,(U=ct)&&!pt)for(V=b;V!==null;)nt=V,ct=nt.child,nt.tag===22&&nt.memoizedState!==null?jk(b):ct!==null?(ct.return=nt,V=ct):jk(b);for(;et!==null;)V=et,ik(et),et=et.sibling;V=b,Jj=c,U=pt}kk(e)}else b.subtreeFlags&8772&&et!==null?(et.return=b,V=et):kk(e)}}function kk(e){for(;V!==null;){var i=V;if(i.flags&8772){var s=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:U||Qj(5,i);break;case 1:var a=i.stateNode;if(i.flags&4&&!U)if(s===null)a.componentDidMount();else{var b=i.elementType===i.type?s.memoizedProps:Ci(i.type,s.memoizedProps);a.componentDidUpdate(b,s.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var et=i.updateQueue;et!==null&&sh(i,et,a);break;case 3:var nt=i.updateQueue;if(nt!==null){if(s=null,i.child!==null)switch(i.child.tag){case 5:s=i.child.stateNode;break;case 1:s=i.child.stateNode}sh(i,nt,s)}break;case 5:var c=i.stateNode;if(s===null&&i.flags&4){s=c;var ct=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":ct.autoFocus&&s.focus();break;case"img":ct.src&&(s.src=ct.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var pt=i.alternate;if(pt!==null){var xt=pt.memoizedState;if(xt!==null){var St=xt.dehydrated;St!==null&&bd(St)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p(163))}U||i.flags&512&&Rj(i)}catch(Et){W(i,i.return,Et)}}if(i===e){V=null;break}if(s=i.sibling,s!==null){s.return=i.return,V=s;break}V=i.return}}function gk(e){for(;V!==null;){var i=V;if(i===e){V=null;break}var s=i.sibling;if(s!==null){s.return=i.return,V=s;break}V=i.return}}function jk(e){for(;V!==null;){var i=V;try{switch(i.tag){case 0:case 11:case 15:var s=i.return;try{Qj(4,i)}catch(ct){W(i,s,ct)}break;case 1:var a=i.stateNode;if(typeof a.componentDidMount=="function"){var b=i.return;try{a.componentDidMount()}catch(ct){W(i,b,ct)}}var et=i.return;try{Rj(i)}catch(ct){W(i,et,ct)}break;case 5:var nt=i.return;try{Rj(i)}catch(ct){W(i,nt,ct)}}}catch(ct){W(i,i.return,ct)}if(i===e){V=null;break}var c=i.sibling;if(c!==null){c.return=i.return,V=c;break}V=i.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K=0,Q=null,Y=null,Z=0,fj=0,ej=Uf(0),T=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R(){return K&6?B():Ak!==-1?Ak:Ak=B()}function yi(e){return e.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(e=C,e!==0||(e=window.event,e=e===void 0?16:jd(e.type)),e):1}function gi(e,i,s,a){if(50<yk)throw yk=0,zk=null,Error(p(185));Ac(e,s,a),(!(K&2)||e!==Q)&&(e===Q&&(!(K&2)&&(qk|=s),T===4&&Ck(e,Z)),Dk(e,a),s===1&&K===0&&!(i.mode&1)&&(Gj=B()+500,fg&&jg()))}function Dk(e,i){var s=e.callbackNode;wc(e,i);var a=uc(e,e===Q?Z:0);if(a===0)s!==null&&bc(s),e.callbackNode=null,e.callbackPriority=0;else if(i=a&-a,e.callbackPriority!==i){if(s!=null&&bc(s),i===1)e.tag===0?ig(Ek.bind(null,e)):hg(Ek.bind(null,e)),Jf(function(){!(K&6)&&jg()}),s=null;else{switch(Dc(a)){case 1:s=fc;break;case 4:s=gc;break;case 16:s=hc;break;case 536870912:s=jc;break;default:s=hc}s=Fk(s,Gk.bind(null,e))}e.callbackPriority=i,e.callbackNode=s}}function Gk(e,i){if(Ak=-1,Bk=0,K&6)throw Error(p(327));var s=e.callbackNode;if(Hk()&&e.callbackNode!==s)return null;var a=uc(e,e===Q?Z:0);if(a===0)return null;if(a&30||a&e.expiredLanes||i)i=Ik(e,a);else{i=a;var b=K;K|=2;var et=Jk();(Q!==e||Z!==i)&&(uk=null,Gj=B()+500,Kk(e,i));do try{Lk();break}catch(c){Mk(e,c)}while(!0);$g(),mk.current=et,K=b,Y!==null?i=0:(Q=null,Z=0,i=T)}if(i!==0){if(i===2&&(b=xc(e),b!==0&&(a=b,i=Nk(e,b))),i===1)throw s=pk,Kk(e,0),Ck(e,a),Dk(e,B()),s;if(i===6)Ck(e,a);else{if(b=e.current.alternate,!(a&30)&&!Ok(b)&&(i=Ik(e,a),i===2&&(et=xc(e),et!==0&&(a=et,i=Nk(e,et))),i===1))throw s=pk,Kk(e,0),Ck(e,a),Dk(e,B()),s;switch(e.finishedWork=b,e.finishedLanes=a,i){case 0:case 1:throw Error(p(345));case 2:Pk(e,tk,uk);break;case 3:if(Ck(e,a),(a&130023424)===a&&(i=fk+500-B(),10<i)){if(uc(e,0)!==0)break;if(b=e.suspendedLanes,(b&a)!==a){R(),e.pingedLanes|=e.suspendedLanes&b;break}e.timeoutHandle=Ff(Pk.bind(null,e,tk,uk),i);break}Pk(e,tk,uk);break;case 4:if(Ck(e,a),(a&4194240)===a)break;for(i=e.eventTimes,b=-1;0<a;){var nt=31-oc(a);et=1<<nt,nt=i[nt],nt>b&&(b=nt),a&=~et}if(a=b,a=B()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*lk(a/1960))-a,10<a){e.timeoutHandle=Ff(Pk.bind(null,e,tk,uk),a);break}Pk(e,tk,uk);break;case 5:Pk(e,tk,uk);break;default:throw Error(p(329))}}}return Dk(e,B()),e.callbackNode===s?Gk.bind(null,e):null}function Nk(e,i){var s=sk;return e.current.memoizedState.isDehydrated&&(Kk(e,i).flags|=256),e=Ik(e,i),e!==2&&(i=tk,tk=s,i!==null&&Fj(i)),e}function Fj(e){tk===null?tk=e:tk.push.apply(tk,e)}function Ok(e){for(var i=e;;){if(i.flags&16384){var s=i.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var a=0;a<s.length;a++){var b=s[a],et=b.getSnapshot;b=b.value;try{if(!He(et(),b))return!1}catch{return!1}}}if(s=i.child,i.subtreeFlags&16384&&s!==null)s.return=i,i=s;else{if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Ck(e,i){for(i&=~rk,i&=~qk,e.suspendedLanes|=i,e.pingedLanes&=~i,e=e.expirationTimes;0<i;){var s=31-oc(i),a=1<<s;e[s]=-1,i&=~a}}function Ek(e){if(K&6)throw Error(p(327));Hk();var i=uc(e,0);if(!(i&1))return Dk(e,B()),null;var s=Ik(e,i);if(e.tag!==0&&s===2){var a=xc(e);a!==0&&(i=a,s=Nk(e,a))}if(s===1)throw s=pk,Kk(e,0),Ck(e,i),Dk(e,B()),s;if(s===6)throw Error(p(345));return e.finishedWork=e.current.alternate,e.finishedLanes=i,Pk(e,tk,uk),Dk(e,B()),null}function Qk(e,i){var s=K;K|=1;try{return e(i)}finally{K=s,K===0&&(Gj=B()+500,fg&&jg())}}function Rk(e){wk!==null&&wk.tag===0&&!(K&6)&&Hk();var i=K;K|=1;var s=ok.transition,a=C;try{if(ok.transition=null,C=1,e)return e()}finally{C=a,ok.transition=s,K=i,!(K&6)&&jg()}}function Hj(){fj=ej.current,E$1(ej)}function Kk(e,i){e.finishedWork=null,e.finishedLanes=0;var s=e.timeoutHandle;if(s!==-1&&(e.timeoutHandle=-1,Gf(s)),Y!==null)for(s=Y.return;s!==null;){var a=s;switch(wg(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&$f();break;case 3:zh(),E$1(Wf),E$1(H),Eh();break;case 5:Bh(a);break;case 4:zh();break;case 13:E$1(L$1);break;case 19:E$1(L$1);break;case 10:ah(a.type._context);break;case 22:case 23:Hj()}s=s.return}if(Q=e,Y=e=Pg(e.current,null),Z=fj=i,T=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for(i=0;i<fh.length;i++)if(s=fh[i],a=s.interleaved,a!==null){s.interleaved=null;var b=a.next,et=s.pending;if(et!==null){var nt=et.next;et.next=b,a.next=nt}s.pending=a}fh=null}return e}function Mk(e,i){do{var s=Y;try{if($g(),Fh.current=Rh,Ih){for(var a=M$1.memoizedState;a!==null;){var b=a.queue;b!==null&&(b.pending=null),a=a.next}Ih=!1}if(Hh=0,O=N=M$1=null,Jh=!1,Kh=0,nk.current=null,s===null||s.return===null){T=1,pk=i,Y=null;break}e:{var et=e,nt=s.return,c=s,ct=i;if(i=Z,c.flags|=32768,ct!==null&&typeof ct=="object"&&typeof ct.then=="function"){var pt=ct,xt=c,St=xt.tag;if(!(xt.mode&1)&&(St===0||St===11||St===15)){var Et=xt.alternate;Et?(xt.updateQueue=Et.updateQueue,xt.memoizedState=Et.memoizedState,xt.lanes=Et.lanes):(xt.updateQueue=null,xt.memoizedState=null)}var Rt=Ui(nt);if(Rt!==null){Rt.flags&=-257,Vi(Rt,nt,c,et,i),Rt.mode&1&&Si(et,pt,i),i=Rt,ct=pt;var Nt=i.updateQueue;if(Nt===null){var It=new Set;It.add(ct),i.updateQueue=It}else Nt.add(ct);break e}else{if(!(i&1)){Si(et,pt,i),tj();break e}ct=Error(p(426))}}else if(I&&c.mode&1){var Gt=Ui(nt);if(Gt!==null){!(Gt.flags&65536)&&(Gt.flags|=256),Vi(Gt,nt,c,et,i),Jg(Ji(ct,c));break e}}et=ct=Ji(ct,c),T!==4&&(T=2),sk===null?sk=[et]:sk.push(et),et=nt;do{switch(et.tag){case 3:et.flags|=65536,i&=-i,et.lanes|=i;var Dt=Ni(et,ct,i);ph(et,Dt);break e;case 1:c=ct;var Bt=et.type,Lt=et.stateNode;if(!(et.flags&128)&&(typeof Bt.getDerivedStateFromError=="function"||Lt!==null&&typeof Lt.componentDidCatch=="function"&&(Ri===null||!Ri.has(Lt)))){et.flags|=65536,i&=-i,et.lanes|=i;var Vt=Qi(et,c,i);ph(et,Vt);break e}}et=et.return}while(et!==null)}Sk(s)}catch(Zt){i=Zt,Y===s&&s!==null&&(Y=s=s.return);continue}break}while(!0)}function Jk(){var e=mk.current;return mk.current=Rh,e===null?Rh:e}function tj(){(T===0||T===3||T===2)&&(T=4),Q===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q,Z)}function Ik(e,i){var s=K;K|=2;var a=Jk();(Q!==e||Z!==i)&&(uk=null,Kk(e,i));do try{Tk();break}catch(b){Mk(e,b)}while(!0);if($g(),K=s,mk.current=a,Y!==null)throw Error(p(261));return Q=null,Z=0,T}function Tk(){for(;Y!==null;)Uk(Y)}function Lk(){for(;Y!==null&&!cc();)Uk(Y)}function Uk(e){var i=Vk(e.alternate,e,fj);e.memoizedProps=e.pendingProps,i===null?Sk(e):Y=i,nk.current=null}function Sk(e){var i=e;do{var s=i.alternate;if(e=i.return,i.flags&32768){if(s=Ij(s,i),s!==null){s.flags&=32767,Y=s;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{T=6,Y=null;return}}else if(s=Ej(s,i,fj),s!==null){Y=s;return}if(i=i.sibling,i!==null){Y=i;return}Y=i=e}while(i!==null);T===0&&(T=5)}function Pk(e,i,s){var a=C,b=ok.transition;try{ok.transition=null,C=1,Wk(e,i,s,a)}finally{ok.transition=b,C=a}return null}function Wk(e,i,s,a){do Hk();while(wk!==null);if(K&6)throw Error(p(327));s=e.finishedWork;var b=e.finishedLanes;if(s===null)return null;if(e.finishedWork=null,e.finishedLanes=0,s===e.current)throw Error(p(177));e.callbackNode=null,e.callbackPriority=0;var et=s.lanes|s.childLanes;if(Bc(e,et),e===Q&&(Y=Q=null,Z=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),et=(s.flags&15990)!==0,s.subtreeFlags&15990||et){et=ok.transition,ok.transition=null;var nt=C;C=1;var c=K;K|=4,nk.current=null,Oj(e,s),dk(s,e),Oe(Df),dd=!!Cf,Df=Cf=null,e.current=s,hk(s),dc(),K=c,C=nt,ok.transition=et}else e.current=s;if(vk&&(vk=!1,wk=e,xk=b),et=e.pendingLanes,et===0&&(Ri=null),mc(s.stateNode),Dk(e,B()),i!==null)for(a=e.onRecoverableError,s=0;s<i.length;s++)b=i[s],a(b.value,{componentStack:b.stack,digest:b.digest});if(Oi)throw Oi=!1,e=Pi,Pi=null,e;return xk&1&&e.tag!==0&&Hk(),et=e.pendingLanes,et&1?e===zk?yk++:(yk=0,zk=e):yk=0,jg(),null}function Hk(){if(wk!==null){var e=Dc(xk),i=ok.transition,s=C;try{if(ok.transition=null,C=16>e?16:e,wk===null)var a=!1;else{if(e=wk,wk=null,xk=0,K&6)throw Error(p(331));var b=K;for(K|=4,V=e.current;V!==null;){var et=V,nt=et.child;if(V.flags&16){var c=et.deletions;if(c!==null){for(var ct=0;ct<c.length;ct++){var pt=c[ct];for(V=pt;V!==null;){var xt=V;switch(xt.tag){case 0:case 11:case 15:Pj(8,xt,et)}var St=xt.child;if(St!==null)St.return=xt,V=St;else for(;V!==null;){xt=V;var Et=xt.sibling,Rt=xt.return;if(Sj(xt),xt===pt){V=null;break}if(Et!==null){Et.return=Rt,V=Et;break}V=Rt}}}var Nt=et.alternate;if(Nt!==null){var It=Nt.child;if(It!==null){Nt.child=null;do{var Gt=It.sibling;It.sibling=null,It=Gt}while(It!==null)}}V=et}}if(et.subtreeFlags&2064&&nt!==null)nt.return=et,V=nt;else e:for(;V!==null;){if(et=V,et.flags&2048)switch(et.tag){case 0:case 11:case 15:Pj(9,et,et.return)}var Dt=et.sibling;if(Dt!==null){Dt.return=et.return,V=Dt;break e}V=et.return}}var Bt=e.current;for(V=Bt;V!==null;){nt=V;var Lt=nt.child;if(nt.subtreeFlags&2064&&Lt!==null)Lt.return=nt,V=Lt;else e:for(nt=Bt;V!==null;){if(c=V,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Qj(9,c)}}catch(Zt){W(c,c.return,Zt)}if(c===nt){V=null;break e}var Vt=c.sibling;if(Vt!==null){Vt.return=c.return,V=Vt;break e}V=c.return}}if(K=b,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,e)}catch{}a=!0}return a}finally{C=s,ok.transition=i}}return!1}function Xk(e,i,s){i=Ji(s,i),i=Ni(e,i,1),e=nh(e,i,1),i=R(),e!==null&&(Ac(e,1,i),Dk(e,i))}function W(e,i,s){if(e.tag===3)Xk(e,e,s);else for(;i!==null;){if(i.tag===3){Xk(i,e,s);break}else if(i.tag===1){var a=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(Ri===null||!Ri.has(a))){e=Ji(s,e),e=Qi(i,e,1),i=nh(i,e,1),e=R(),i!==null&&(Ac(i,1,e),Dk(i,e));break}}i=i.return}}function Ti(e,i,s){var a=e.pingCache;a!==null&&a.delete(i),i=R(),e.pingedLanes|=e.suspendedLanes&s,Q===e&&(Z&s)===s&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-fk?Kk(e,0):rk|=s),Dk(e,i)}function Yk(e,i){i===0&&(e.mode&1?(i=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):i=1);var s=R();e=ih(e,i),e!==null&&(Ac(e,i,s),Dk(e,s))}function uj(e){var i=e.memoizedState,s=0;i!==null&&(s=i.retryLane),Yk(e,s)}function bk(e,i){var s=0;switch(e.tag){case 13:var a=e.stateNode,b=e.memoizedState;b!==null&&(s=b.retryLane);break;case 19:a=e.stateNode;break;default:throw Error(p(314))}a!==null&&a.delete(i),Yk(e,s)}var Vk;Vk=function(e,i,s){if(e!==null)if(e.memoizedProps!==i.pendingProps||Wf.current)dh=!0;else{if(!(e.lanes&s)&&!(i.flags&128))return dh=!1,yj(e,i,s);dh=!!(e.flags&131072)}else dh=!1,I&&i.flags&1048576&&ug(i,ng,i.index);switch(i.lanes=0,i.tag){case 2:var a=i.type;ij(e,i),e=i.pendingProps;var b=Yf(i,H.current);ch(i,s),b=Nh(null,i,a,e,b,s);var et=Sh();return i.flags|=1,typeof b=="object"&&b!==null&&typeof b.render=="function"&&b.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,Zf(a)?(et=!0,cg(i)):et=!1,i.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,kh(i),b.updater=Ei,i.stateNode=b,b._reactInternals=i,Ii(i,a,e,s),i=jj(null,i,a,!0,et,s)):(i.tag=0,I&&et&&vg(i),Xi(null,i,b,s),i=i.child),i;case 16:a=i.elementType;e:{switch(ij(e,i),e=i.pendingProps,b=a._init,a=b(a._payload),i.type=a,b=i.tag=Zk(a),e=Ci(a,e),b){case 0:i=cj(null,i,a,e,s);break e;case 1:i=hj(null,i,a,e,s);break e;case 11:i=Yi(null,i,a,e,s);break e;case 14:i=$i(null,i,a,Ci(a.type,e),s);break e}throw Error(p(306,a,""))}return i;case 0:return a=i.type,b=i.pendingProps,b=i.elementType===a?b:Ci(a,b),cj(e,i,a,b,s);case 1:return a=i.type,b=i.pendingProps,b=i.elementType===a?b:Ci(a,b),hj(e,i,a,b,s);case 3:e:{if(kj(i),e===null)throw Error(p(387));a=i.pendingProps,et=i.memoizedState,b=et.element,lh(e,i),qh(i,a,null,s);var nt=i.memoizedState;if(a=nt.element,et.isDehydrated)if(et={element:a,isDehydrated:!1,cache:nt.cache,pendingSuspenseBoundaries:nt.pendingSuspenseBoundaries,transitions:nt.transitions},i.updateQueue.baseState=et,i.memoizedState=et,i.flags&256){b=Ji(Error(p(423)),i),i=lj(e,i,a,s,b);break e}else if(a!==b){b=Ji(Error(p(424)),i),i=lj(e,i,a,s,b);break e}else for(yg=Lf(i.stateNode.containerInfo.firstChild),xg=i,I=!0,zg=null,s=Vg(i,null,a,s),i.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(Ig(),a===b){i=Zi(e,i,s);break e}Xi(e,i,a,s)}i=i.child}return i;case 5:return Ah(i),e===null&&Eg(i),a=i.type,b=i.pendingProps,et=e!==null?e.memoizedProps:null,nt=b.children,Ef(a,b)?nt=null:et!==null&&Ef(a,et)&&(i.flags|=32),gj(e,i),Xi(e,i,nt,s),i.child;case 6:return e===null&&Eg(i),null;case 13:return oj(e,i,s);case 4:return yh(i,i.stateNode.containerInfo),a=i.pendingProps,e===null?i.child=Ug(i,null,a,s):Xi(e,i,a,s),i.child;case 11:return a=i.type,b=i.pendingProps,b=i.elementType===a?b:Ci(a,b),Yi(e,i,a,b,s);case 7:return Xi(e,i,i.pendingProps,s),i.child;case 8:return Xi(e,i,i.pendingProps.children,s),i.child;case 12:return Xi(e,i,i.pendingProps.children,s),i.child;case 10:e:{if(a=i.type._context,b=i.pendingProps,et=i.memoizedProps,nt=b.value,G(Wg,a._currentValue),a._currentValue=nt,et!==null)if(He(et.value,nt)){if(et.children===b.children&&!Wf.current){i=Zi(e,i,s);break e}}else for(et=i.child,et!==null&&(et.return=i);et!==null;){var c=et.dependencies;if(c!==null){nt=et.child;for(var ct=c.firstContext;ct!==null;){if(ct.context===a){if(et.tag===1){ct=mh(-1,s&-s),ct.tag=2;var pt=et.updateQueue;if(pt!==null){pt=pt.shared;var xt=pt.pending;xt===null?ct.next=ct:(ct.next=xt.next,xt.next=ct),pt.pending=ct}}et.lanes|=s,ct=et.alternate,ct!==null&&(ct.lanes|=s),bh(et.return,s,i),c.lanes|=s;break}ct=ct.next}}else if(et.tag===10)nt=et.type===i.type?null:et.child;else if(et.tag===18){if(nt=et.return,nt===null)throw Error(p(341));nt.lanes|=s,c=nt.alternate,c!==null&&(c.lanes|=s),bh(nt,s,i),nt=et.sibling}else nt=et.child;if(nt!==null)nt.return=et;else for(nt=et;nt!==null;){if(nt===i){nt=null;break}if(et=nt.sibling,et!==null){et.return=nt.return,nt=et;break}nt=nt.return}et=nt}Xi(e,i,b.children,s),i=i.child}return i;case 9:return b=i.type,a=i.pendingProps.children,ch(i,s),b=eh(b),a=a(b),i.flags|=1,Xi(e,i,a,s),i.child;case 14:return a=i.type,b=Ci(a,i.pendingProps),b=Ci(a.type,b),$i(e,i,a,b,s);case 15:return bj(e,i,i.type,i.pendingProps,s);case 17:return a=i.type,b=i.pendingProps,b=i.elementType===a?b:Ci(a,b),ij(e,i),i.tag=1,Zf(a)?(e=!0,cg(i)):e=!1,ch(i,s),Gi(i,a,b),Ii(i,a,b,s),jj(null,i,a,!0,e,s);case 19:return xj(e,i,s);case 22:return dj(e,i,s)}throw Error(p(156,i.tag))};function Fk(e,i){return ac(e,i)}function $k(e,i,s,a){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(e,i,s,a){return new $k(e,i,s,a)}function aj(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Zk(e){if(typeof e=="function")return aj(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Da)return 11;if(e===Ga)return 14}return 2}function Pg(e,i){var s=e.alternate;return s===null?(s=Bg(e.tag,i,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=i,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&14680064,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,i=e.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s}function Rg(e,i,s,a,b,et){var nt=2;if(a=e,typeof e=="function")aj(e)&&(nt=1);else if(typeof e=="string")nt=5;else e:switch(e){case ya:return Tg(s.children,b,et,i);case za:nt=8,b|=8;break;case Aa:return e=Bg(12,s,i,b|2),e.elementType=Aa,e.lanes=et,e;case Ea:return e=Bg(13,s,i,b),e.elementType=Ea,e.lanes=et,e;case Fa:return e=Bg(19,s,i,b),e.elementType=Fa,e.lanes=et,e;case Ia:return pj(s,b,et,i);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Ba:nt=10;break e;case Ca:nt=9;break e;case Da:nt=11;break e;case Ga:nt=14;break e;case Ha:nt=16,a=null;break e}throw Error(p(130,e==null?e:typeof e,""))}return i=Bg(nt,s,i,b),i.elementType=e,i.type=a,i.lanes=et,i}function Tg(e,i,s,a){return e=Bg(7,e,a,i),e.lanes=s,e}function pj(e,i,s,a){return e=Bg(22,e,a,i),e.elementType=Ia,e.lanes=s,e.stateNode={isHidden:!1},e}function Qg(e,i,s){return e=Bg(6,e,null,i),e.lanes=s,e}function Sg(e,i,s){return i=Bg(4,e.children!==null?e.children:[],e.key,i),i.lanes=s,i.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},i}function al(e,i,s,a,b){this.tag=i,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=a,this.onRecoverableError=b,this.mutableSourceEagerHydrationData=null}function bl(e,i,s,a,b,et,nt,c,ct){return e=new al(e,i,s,c,ct),i===1?(i=1,et===!0&&(i|=8)):i=0,et=Bg(3,null,null,i),e.current=et,et.stateNode=e,et.memoizedState={element:a,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(et),e}function cl(e,i,s){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:a==null?null:""+a,children:e,containerInfo:i,implementation:s}}function dl(e){if(!e)return Vf;e=e._reactInternals;e:{if(Vb(e)!==e||e.tag!==1)throw Error(p(170));var i=e;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(Zf(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(p(171))}if(e.tag===1){var s=e.type;if(Zf(s))return bg(e,s,i)}return i}function el(e,i,s,a,b,et,nt,c,ct){return e=bl(s,a,!0,e,b,et,nt,c,ct),e.context=dl(null),s=e.current,a=R(),b=yi(s),et=mh(a,b),et.callback=i??null,nh(s,et,b),e.current.lanes=b,Ac(e,b,a),Dk(e,a),e}function fl(e,i,s,a){var b=i.current,et=R(),nt=yi(b);return s=dl(s),i.context===null?i.context=s:i.pendingContext=s,i=mh(et,nt),i.payload={element:e},a=a===void 0?null:a,a!==null&&(i.callback=a),e=nh(b,i,nt),e!==null&&(gi(e,b,nt,et),oh(e,b,nt)),nt}function gl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function hl(e,i){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<i?s:i}}function il(e,i){hl(e,i),(e=e.alternate)&&hl(e,i)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(e){console.error(e)};function ll(e){this._internalRoot=e}ml.prototype.render=ll.prototype.render=function(e){var i=this._internalRoot;if(i===null)throw Error(p(409));fl(e,i,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var i=e.containerInfo;Rk(function(){fl(null,e,null,null)}),i[uf]=null}};function ml(e){this._internalRoot=e}ml.prototype.unstable_scheduleHydration=function(e){if(e){var i=Hc();e={blockedOn:null,target:e,priority:i};for(var s=0;s<Qc.length&&i!==0&&i<Qc[s].priority;s++);Qc.splice(s,0,e),s===0&&Vc(e)}};function nl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function ol(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(e,i,s,a,b){if(b){if(typeof a=="function"){var et=a;a=function(){var pt=gl(nt);et.call(pt)}}var nt=el(i,a,e,0,null,!1,!1,"",pl);return e._reactRootContainer=nt,e[uf]=nt.current,sf(e.nodeType===8?e.parentNode:e),Rk(),nt}for(;b=e.lastChild;)e.removeChild(b);if(typeof a=="function"){var c=a;a=function(){var pt=gl(ct);c.call(pt)}}var ct=bl(e,0,!1,null,null,!1,!1,"",pl);return e._reactRootContainer=ct,e[uf]=ct.current,sf(e.nodeType===8?e.parentNode:e),Rk(function(){fl(i,ct,s,a)}),ct}function rl(e,i,s,a,b){var et=s._reactRootContainer;if(et){var nt=et;if(typeof b=="function"){var c=b;b=function(){var ct=gl(nt);c.call(ct)}}fl(i,nt,e,b)}else nt=ql(s,i,e,b,a);return gl(nt)}Ec=function(e){switch(e.tag){case 3:var i=e.stateNode;if(i.current.memoizedState.isDehydrated){var s=tc(i.pendingLanes);s!==0&&(Cc(i,s|1),Dk(i,B()),!(K&6)&&(Gj=B()+500,jg()))}break;case 13:Rk(function(){var a=ih(e,1);if(a!==null){var b=R();gi(a,e,1,b)}}),il(e,1)}};Fc=function(e){if(e.tag===13){var i=ih(e,134217728);if(i!==null){var s=R();gi(i,e,134217728,s)}il(e,134217728)}};Gc=function(e){if(e.tag===13){var i=yi(e),s=ih(e,i);if(s!==null){var a=R();gi(s,e,i,a)}il(e,i)}};Hc=function(){return C};Ic=function(e,i){var s=C;try{return C=e,i()}finally{C=s}};yb=function(e,i,s){switch(i){case"input":if(bb(e,s),i=s.name,s.type==="radio"&&i!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<s.length;i++){var a=s[i];if(a!==e&&a.form===e.form){var b=Db(a);if(!b)throw Error(p(90));Wa(a),bb(a,b)}}}break;case"textarea":ib(e,s);break;case"select":i=s.value,i!=null&&fb(e,!!s.multiple,i,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue$1,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Zb(e),e===null?null:e.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(e,i){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(i))throw Error(p(200));return cl(e,i,null,s)};reactDom_production_min.createRoot=function(e,i){if(!nl(e))throw Error(p(299));var s=!1,a="",b=kl;return i!=null&&(i.unstable_strictMode===!0&&(s=!0),i.identifierPrefix!==void 0&&(a=i.identifierPrefix),i.onRecoverableError!==void 0&&(b=i.onRecoverableError)),i=bl(e,1,!1,null,null,s,!1,a,b),e[uf]=i.current,sf(e.nodeType===8?e.parentNode:e),new ll(i)};reactDom_production_min.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var i=e._reactInternals;if(i===void 0)throw typeof e.render=="function"?Error(p(188)):(e=Object.keys(e).join(","),Error(p(268,e)));return e=Zb(i),e=e===null?null:e.stateNode,e};reactDom_production_min.flushSync=function(e){return Rk(e)};reactDom_production_min.hydrate=function(e,i,s){if(!ol(i))throw Error(p(200));return rl(null,e,i,!0,s)};reactDom_production_min.hydrateRoot=function(e,i,s){if(!nl(e))throw Error(p(405));var a=s!=null&&s.hydratedSources||null,b=!1,et="",nt=kl;if(s!=null&&(s.unstable_strictMode===!0&&(b=!0),s.identifierPrefix!==void 0&&(et=s.identifierPrefix),s.onRecoverableError!==void 0&&(nt=s.onRecoverableError)),i=el(i,null,e,1,s??null,b,!1,et,nt),e[uf]=i.current,sf(e),a)for(e=0;e<a.length;e++)s=a[e],b=s._getVersion,b=b(s._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[s,b]:i.mutableSourceEagerHydrationData.push(s,b);return new ml(i)};reactDom_production_min.render=function(e,i,s){if(!ol(i))throw Error(p(200));return rl(null,e,i,!1,s)};reactDom_production_min.unmountComponentAtNode=function(e){if(!ol(e))throw Error(p(40));return e._reactRootContainer?(Rk(function(){rl(null,null,e,!1,function(){e._reactRootContainer=null,e[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(e,i,s,a){if(!ol(s))throw Error(p(200));if(e==null||e._reactInternals===void 0)throw Error(p(38));return rl(e,i,s,!1,a)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(e){console.error(e)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports;const vt=getDefaultExportFromCjs(reactDomExports);var createRoot,m=reactDomExports;createRoot=m.createRoot,m.hydrateRoot;const TOAST_LIMIT=1,TOAST_REMOVE_DELAY=1e6;let count$2=0;function genId(){return count$2=(count$2+1)%Number.MAX_SAFE_INTEGER,count$2.toString()}const toastTimeouts=new Map,addToRemoveQueue=e=>{if(toastTimeouts.has(e))return;const i=setTimeout(()=>{toastTimeouts.delete(e),dispatch({type:"REMOVE_TOAST",toastId:e})},TOAST_REMOVE_DELAY);toastTimeouts.set(e,i)},reducer=(e,i)=>{switch(i.type){case"ADD_TOAST":return{...e,toasts:[i.toast,...e.toasts].slice(0,TOAST_LIMIT)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(s=>s.id===i.toast.id?{...s,...i.toast}:s)};case"DISMISS_TOAST":{const{toastId:s}=i;return s?addToRemoveQueue(s):e.toasts.forEach(a=>{addToRemoveQueue(a.id)}),{...e,toasts:e.toasts.map(a=>a.id===s||s===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return i.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(s=>s.id!==i.toastId)}}},listeners=[];let memoryState={toasts:[]};function dispatch(e){memoryState=reducer(memoryState,e),listeners.forEach(i=>{i(memoryState)})}function toast({...e}){const i=genId(),s=b=>dispatch({type:"UPDATE_TOAST",toast:{...b,id:i}}),a=()=>dispatch({type:"DISMISS_TOAST",toastId:i});return dispatch({type:"ADD_TOAST",toast:{...e,id:i,open:!0,onOpenChange:b=>{b||a()}}}),{id:i,dismiss:a,update:s}}function useToast(){const[e,i]=reactExports.useState(memoryState);return reactExports.useEffect(()=>(listeners.push(i),()=>{const s=listeners.indexOf(i);s>-1&&listeners.splice(s,1)}),[e]),{...e,toast,dismiss:s=>dispatch({type:"DISMISS_TOAST",toastId:s})}}function composeEventHandlers(e,i,{checkForDefaultPrevented:s=!0}={}){return function(b){if(e==null||e(b),s===!1||!b.defaultPrevented)return i==null?void 0:i(b)}}function setRef$2(e,i){if(typeof e=="function")return e(i);e!=null&&(e.current=i)}function composeRefs$1(...e){return i=>{let s=!1;const a=e.map(b=>{const et=setRef$2(b,i);return!s&&typeof et=="function"&&(s=!0),et});if(s)return()=>{for(let b=0;b<a.length;b++){const et=a[b];typeof et=="function"?et():setRef$2(e[b],null)}}}}function useComposedRefs$1(...e){return reactExports.useCallback(composeRefs$1(...e),e)}function createContext2(e,i){const s=reactExports.createContext(i),a=et=>{const{children:nt,...c}=et,ct=reactExports.useMemo(()=>c,Object.values(c));return jsxRuntimeExports.jsx(s.Provider,{value:ct,children:nt})};a.displayName=e+"Provider";function b(et){const nt=reactExports.useContext(s);if(nt)return nt;if(i!==void 0)return i;throw new Error(`\`${et}\` must be used within \`${e}\``)}return[a,b]}function createContextScope(e,i=[]){let s=[];function a(et,nt){const c=reactExports.createContext(nt),ct=s.length;s=[...s,nt];const pt=St=>{var Dt;const{scope:Et,children:Rt,...Nt}=St,It=((Dt=Et==null?void 0:Et[e])==null?void 0:Dt[ct])||c,Gt=reactExports.useMemo(()=>Nt,Object.values(Nt));return jsxRuntimeExports.jsx(It.Provider,{value:Gt,children:Rt})};pt.displayName=et+"Provider";function xt(St,Et){var It;const Rt=((It=Et==null?void 0:Et[e])==null?void 0:It[ct])||c,Nt=reactExports.useContext(Rt);if(Nt)return Nt;if(nt!==void 0)return nt;throw new Error(`\`${St}\` must be used within \`${et}\``)}return[pt,xt]}const b=()=>{const et=s.map(nt=>reactExports.createContext(nt));return function(c){const ct=(c==null?void 0:c[e])||et;return reactExports.useMemo(()=>({[`__scope${e}`]:{...c,[e]:ct}}),[c,ct])}};return b.scopeName=e,[a,composeContextScopes(b,...i)]}function composeContextScopes(...e){const i=e[0];if(e.length===1)return i;const s=()=>{const a=e.map(b=>({useScope:b(),scopeName:b.scopeName}));return function(et){const nt=a.reduce((c,{useScope:ct,scopeName:pt})=>{const St=ct(et)[`__scope${pt}`];return{...c,...St}},{});return reactExports.useMemo(()=>({[`__scope${i.scopeName}`]:nt}),[nt])}};return s.scopeName=i.scopeName,s}function createSlot(e){const i=createSlotClone(e),s=reactExports.forwardRef((a,b)=>{const{children:et,...nt}=a,c=reactExports.Children.toArray(et),ct=c.find(isSlottable);if(ct){const pt=ct.props.children,xt=c.map(St=>St===ct?reactExports.Children.count(pt)>1?reactExports.Children.only(null):reactExports.isValidElement(pt)?pt.props.children:null:St);return jsxRuntimeExports.jsx(i,{...nt,ref:b,children:reactExports.isValidElement(pt)?reactExports.cloneElement(pt,void 0,xt):null})}return jsxRuntimeExports.jsx(i,{...nt,ref:b,children:et})});return s.displayName=`${e}.Slot`,s}var Slot$2=createSlot("Slot");function createSlotClone(e){const i=reactExports.forwardRef((s,a)=>{const{children:b,...et}=s;if(reactExports.isValidElement(b)){const nt=getElementRef$1(b),c=mergeProps(et,b.props);return b.type!==reactExports.Fragment&&(c.ref=a?composeRefs$1(a,nt):nt),reactExports.cloneElement(b,c)}return reactExports.Children.count(b)>1?reactExports.Children.only(null):null});return i.displayName=`${e}.SlotClone`,i}var SLOTTABLE_IDENTIFIER=Symbol("radix.slottable");function createSlottable(e){const i=({children:s})=>jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:s});return i.displayName=`${e}.Slottable`,i.__radixId=SLOTTABLE_IDENTIFIER,i}function isSlottable(e){return reactExports.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===SLOTTABLE_IDENTIFIER}function mergeProps(e,i){const s={...i};for(const a in i){const b=e[a],et=i[a];/^on[A-Z]/.test(a)?b&&et?s[a]=(...c)=>{const ct=et(...c);return b(...c),ct}:b&&(s[a]=b):a==="style"?s[a]={...b,...et}:a==="className"&&(s[a]=[b,et].filter(Boolean).join(" "))}return{...e,...s}}function getElementRef$1(e){var a,b;let i=(a=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:a.get,s=i&&"isReactWarning"in i&&i.isReactWarning;return s?e.ref:(i=(b=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:b.get,s=i&&"isReactWarning"in i&&i.isReactWarning,s?e.props.ref:e.props.ref||e.ref)}function createCollection(e){const i=e+"CollectionProvider",[s,a]=createContextScope(i),[b,et]=s(i,{collectionRef:{current:null},itemMap:new Map}),nt=It=>{const{scope:Gt,children:Dt}=It,Bt=React.useRef(null),Lt=React.useRef(new Map).current;return jsxRuntimeExports.jsx(b,{scope:Gt,itemMap:Lt,collectionRef:Bt,children:Dt})};nt.displayName=i;const c=e+"CollectionSlot",ct=createSlot(c),pt=React.forwardRef((It,Gt)=>{const{scope:Dt,children:Bt}=It,Lt=et(c,Dt),Vt=useComposedRefs$1(Gt,Lt.collectionRef);return jsxRuntimeExports.jsx(ct,{ref:Vt,children:Bt})});pt.displayName=c;const xt=e+"CollectionItemSlot",St="data-radix-collection-item",Et=createSlot(xt),Rt=React.forwardRef((It,Gt)=>{const{scope:Dt,children:Bt,...Lt}=It,Vt=React.useRef(null),Zt=useComposedRefs$1(Gt,Vt),nr=et(xt,Dt);return React.useEffect(()=>(nr.itemMap.set(Vt,{ref:Vt,...Lt}),()=>void nr.itemMap.delete(Vt))),jsxRuntimeExports.jsx(Et,{[St]:"",ref:Zt,children:Bt})});Rt.displayName=xt;function Nt(It){const Gt=et(e+"CollectionConsumer",It);return React.useCallback(()=>{const Bt=Gt.collectionRef.current;if(!Bt)return[];const Lt=Array.from(Bt.querySelectorAll(`[${St}]`));return Array.from(Gt.itemMap.values()).sort((nr,ur)=>Lt.indexOf(nr.ref.current)-Lt.indexOf(ur.ref.current))},[Gt.collectionRef,Gt.itemMap])}return[{Provider:nt,Slot:pt,ItemSlot:Rt},Nt,a]}var NODES=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Primitive=NODES.reduce((e,i)=>{const s=createSlot(`Primitive.${i}`),a=reactExports.forwardRef((b,et)=>{const{asChild:nt,...c}=b,ct=nt?s:i;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),jsxRuntimeExports.jsx(ct,{...c,ref:et})});return a.displayName=`Primitive.${i}`,{...e,[i]:a}},{});function dispatchDiscreteCustomEvent(e,i){e&&reactDomExports.flushSync(()=>e.dispatchEvent(i))}function useCallbackRef$1(e){const i=reactExports.useRef(e);return reactExports.useEffect(()=>{i.current=e}),reactExports.useMemo(()=>(...s)=>{var a;return(a=i.current)==null?void 0:a.call(i,...s)},[])}function useEscapeKeydown(e,i=globalThis==null?void 0:globalThis.document){const s=useCallbackRef$1(e);reactExports.useEffect(()=>{const a=b=>{b.key==="Escape"&&s(b)};return i.addEventListener("keydown",a,{capture:!0}),()=>i.removeEventListener("keydown",a,{capture:!0})},[s,i])}var DISMISSABLE_LAYER_NAME="DismissableLayer",CONTEXT_UPDATE="dismissableLayer.update",POINTER_DOWN_OUTSIDE="dismissableLayer.pointerDownOutside",FOCUS_OUTSIDE="dismissableLayer.focusOutside",originalBodyPointerEvents,DismissableLayerContext=reactExports.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),DismissableLayer=reactExports.forwardRef((e,i)=>{const{disableOutsidePointerEvents:s=!1,onEscapeKeyDown:a,onPointerDownOutside:b,onFocusOutside:et,onInteractOutside:nt,onDismiss:c,...ct}=e,pt=reactExports.useContext(DismissableLayerContext),[xt,St]=reactExports.useState(null),Et=(xt==null?void 0:xt.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,Rt]=reactExports.useState({}),Nt=useComposedRefs$1(i,ur=>St(ur)),It=Array.from(pt.layers),[Gt]=[...pt.layersWithOutsidePointerEventsDisabled].slice(-1),Dt=It.indexOf(Gt),Bt=xt?It.indexOf(xt):-1,Lt=pt.layersWithOutsidePointerEventsDisabled.size>0,Vt=Bt>=Dt,Zt=usePointerDownOutside(ur=>{const _r=ur.target,Ur=[...pt.branches].some(ln=>ln.contains(_r));!Vt||Ur||(b==null||b(ur),nt==null||nt(ur),ur.defaultPrevented||c==null||c())},Et),nr=useFocusOutside(ur=>{const _r=ur.target;[...pt.branches].some(ln=>ln.contains(_r))||(et==null||et(ur),nt==null||nt(ur),ur.defaultPrevented||c==null||c())},Et);return useEscapeKeydown(ur=>{Bt===pt.layers.size-1&&(a==null||a(ur),!ur.defaultPrevented&&c&&(ur.preventDefault(),c()))},Et),reactExports.useEffect(()=>{if(xt)return s&&(pt.layersWithOutsidePointerEventsDisabled.size===0&&(originalBodyPointerEvents=Et.body.style.pointerEvents,Et.body.style.pointerEvents="none"),pt.layersWithOutsidePointerEventsDisabled.add(xt)),pt.layers.add(xt),dispatchUpdate(),()=>{s&&pt.layersWithOutsidePointerEventsDisabled.size===1&&(Et.body.style.pointerEvents=originalBodyPointerEvents)}},[xt,Et,s,pt]),reactExports.useEffect(()=>()=>{xt&&(pt.layers.delete(xt),pt.layersWithOutsidePointerEventsDisabled.delete(xt),dispatchUpdate())},[xt,pt]),reactExports.useEffect(()=>{const ur=()=>Rt({});return document.addEventListener(CONTEXT_UPDATE,ur),()=>document.removeEventListener(CONTEXT_UPDATE,ur)},[]),jsxRuntimeExports.jsx(Primitive.div,{...ct,ref:Nt,style:{pointerEvents:Lt?Vt?"auto":"none":void 0,...e.style},onFocusCapture:composeEventHandlers(e.onFocusCapture,nr.onFocusCapture),onBlurCapture:composeEventHandlers(e.onBlurCapture,nr.onBlurCapture),onPointerDownCapture:composeEventHandlers(e.onPointerDownCapture,Zt.onPointerDownCapture)})});DismissableLayer.displayName=DISMISSABLE_LAYER_NAME;var BRANCH_NAME="DismissableLayerBranch",DismissableLayerBranch=reactExports.forwardRef((e,i)=>{const s=reactExports.useContext(DismissableLayerContext),a=reactExports.useRef(null),b=useComposedRefs$1(i,a);return reactExports.useEffect(()=>{const et=a.current;if(et)return s.branches.add(et),()=>{s.branches.delete(et)}},[s.branches]),jsxRuntimeExports.jsx(Primitive.div,{...e,ref:b})});DismissableLayerBranch.displayName=BRANCH_NAME;function usePointerDownOutside(e,i=globalThis==null?void 0:globalThis.document){const s=useCallbackRef$1(e),a=reactExports.useRef(!1),b=reactExports.useRef(()=>{});return reactExports.useEffect(()=>{const et=c=>{if(c.target&&!a.current){let ct=function(){handleAndDispatchCustomEvent$1(POINTER_DOWN_OUTSIDE,s,pt,{discrete:!0})};const pt={originalEvent:c};c.pointerType==="touch"?(i.removeEventListener("click",b.current),b.current=ct,i.addEventListener("click",b.current,{once:!0})):ct()}else i.removeEventListener("click",b.current);a.current=!1},nt=window.setTimeout(()=>{i.addEventListener("pointerdown",et)},0);return()=>{window.clearTimeout(nt),i.removeEventListener("pointerdown",et),i.removeEventListener("click",b.current)}},[i,s]),{onPointerDownCapture:()=>a.current=!0}}function useFocusOutside(e,i=globalThis==null?void 0:globalThis.document){const s=useCallbackRef$1(e),a=reactExports.useRef(!1);return reactExports.useEffect(()=>{const b=et=>{et.target&&!a.current&&handleAndDispatchCustomEvent$1(FOCUS_OUTSIDE,s,{originalEvent:et},{discrete:!1})};return i.addEventListener("focusin",b),()=>i.removeEventListener("focusin",b)},[i,s]),{onFocusCapture:()=>a.current=!0,onBlurCapture:()=>a.current=!1}}function dispatchUpdate(){const e=new CustomEvent(CONTEXT_UPDATE);document.dispatchEvent(e)}function handleAndDispatchCustomEvent$1(e,i,s,{discrete:a}){const b=s.originalEvent.target,et=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:s});i&&b.addEventListener(e,i,{once:!0}),a?dispatchDiscreteCustomEvent(b,et):b.dispatchEvent(et)}var Root$6=DismissableLayer,Branch=DismissableLayerBranch,useLayoutEffect2=globalThis!=null&&globalThis.document?reactExports.useLayoutEffect:()=>{},PORTAL_NAME$4="Portal",Portal$2=reactExports.forwardRef((e,i)=>{var c;const{container:s,...a}=e,[b,et]=reactExports.useState(!1);useLayoutEffect2(()=>et(!0),[]);const nt=s||b&&((c=globalThis==null?void 0:globalThis.document)==null?void 0:c.body);return nt?vt.createPortal(jsxRuntimeExports.jsx(Primitive.div,{...a,ref:i}),nt):null});Portal$2.displayName=PORTAL_NAME$4;function useStateMachine(e,i){return reactExports.useReducer((s,a)=>i[s][a]??s,e)}var Presence=e=>{const{present:i,children:s}=e,a=usePresence$1(i),b=typeof s=="function"?s({present:a.isPresent}):reactExports.Children.only(s),et=useComposedRefs$1(a.ref,getElementRef(b));return typeof s=="function"||a.isPresent?reactExports.cloneElement(b,{ref:et}):null};Presence.displayName="Presence";function usePresence$1(e){const[i,s]=reactExports.useState(),a=reactExports.useRef(null),b=reactExports.useRef(e),et=reactExports.useRef("none"),nt=e?"mounted":"unmounted",[c,ct]=useStateMachine(nt,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return reactExports.useEffect(()=>{const pt=getAnimationName(a.current);et.current=c==="mounted"?pt:"none"},[c]),useLayoutEffect2(()=>{const pt=a.current,xt=b.current;if(xt!==e){const Et=et.current,Rt=getAnimationName(pt);e?ct("MOUNT"):Rt==="none"||(pt==null?void 0:pt.display)==="none"?ct("UNMOUNT"):ct(xt&&Et!==Rt?"ANIMATION_OUT":"UNMOUNT"),b.current=e}},[e,ct]),useLayoutEffect2(()=>{if(i){let pt;const xt=i.ownerDocument.defaultView??window,St=Rt=>{const It=getAnimationName(a.current).includes(Rt.animationName);if(Rt.target===i&&It&&(ct("ANIMATION_END"),!b.current)){const Gt=i.style.animationFillMode;i.style.animationFillMode="forwards",pt=xt.setTimeout(()=>{i.style.animationFillMode==="forwards"&&(i.style.animationFillMode=Gt)})}},Et=Rt=>{Rt.target===i&&(et.current=getAnimationName(a.current))};return i.addEventListener("animationstart",Et),i.addEventListener("animationcancel",St),i.addEventListener("animationend",St),()=>{xt.clearTimeout(pt),i.removeEventListener("animationstart",Et),i.removeEventListener("animationcancel",St),i.removeEventListener("animationend",St)}}else ct("ANIMATION_END")},[i,ct]),{isPresent:["mounted","unmountSuspended"].includes(c),ref:reactExports.useCallback(pt=>{a.current=pt?getComputedStyle(pt):null,s(pt)},[])}}function getAnimationName(e){return(e==null?void 0:e.animationName)||"none"}function getElementRef(e){var a,b;let i=(a=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:a.get,s=i&&"isReactWarning"in i&&i.isReactWarning;return s?e.ref:(i=(b=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:b.get,s=i&&"isReactWarning"in i&&i.isReactWarning,s?e.props.ref:e.props.ref||e.ref)}var useInsertionEffect=React$1[" useInsertionEffect ".trim().toString()]||useLayoutEffect2;function useControllableState({prop:e,defaultProp:i,onChange:s=()=>{},caller:a}){const[b,et,nt]=useUncontrolledState({defaultProp:i,onChange:s}),c=e!==void 0,ct=c?e:b;{const xt=reactExports.useRef(e!==void 0);reactExports.useEffect(()=>{const St=xt.current;St!==c&&console.warn(`${a} is changing from ${St?"controlled":"uncontrolled"} to ${c?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),xt.current=c},[c,a])}const pt=reactExports.useCallback(xt=>{var St;if(c){const Et=isFunction(xt)?xt(e):xt;Et!==e&&((St=nt.current)==null||St.call(nt,Et))}else et(xt)},[c,e,et,nt]);return[ct,pt]}function useUncontrolledState({defaultProp:e,onChange:i}){const[s,a]=reactExports.useState(e),b=reactExports.useRef(s),et=reactExports.useRef(i);return useInsertionEffect(()=>{et.current=i},[i]),reactExports.useEffect(()=>{var nt;b.current!==s&&((nt=et.current)==null||nt.call(et,s),b.current=s)},[s,b]),[s,a,et]}function isFunction(e){return typeof e=="function"}var VISUALLY_HIDDEN_STYLES=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),NAME$2="VisuallyHidden",VisuallyHidden=reactExports.forwardRef((e,i)=>jsxRuntimeExports.jsx(Primitive.span,{...e,ref:i,style:{...VISUALLY_HIDDEN_STYLES,...e.style}}));VisuallyHidden.displayName=NAME$2;var Root$5=VisuallyHidden,PROVIDER_NAME$1="ToastProvider",[Collection$2,useCollection$2,createCollectionScope$2]=createCollection("Toast"),[createToastContext,createToastScope]=createContextScope("Toast",[createCollectionScope$2]),[ToastProviderProvider,useToastProviderContext]=createToastContext(PROVIDER_NAME$1),ToastProvider$1=e=>{const{__scopeToast:i,label:s="Notification",duration:a=5e3,swipeDirection:b="right",swipeThreshold:et=50,children:nt}=e,[c,ct]=reactExports.useState(null),[pt,xt]=reactExports.useState(0),St=reactExports.useRef(!1),Et=reactExports.useRef(!1);return s.trim()||console.error(`Invalid prop \`label\` supplied to \`${PROVIDER_NAME$1}\`. Expected non-empty \`string\`.`),jsxRuntimeExports.jsx(Collection$2.Provider,{scope:i,children:jsxRuntimeExports.jsx(ToastProviderProvider,{scope:i,label:s,duration:a,swipeDirection:b,swipeThreshold:et,toastCount:pt,viewport:c,onViewportChange:ct,onToastAdd:reactExports.useCallback(()=>xt(Rt=>Rt+1),[]),onToastRemove:reactExports.useCallback(()=>xt(Rt=>Rt-1),[]),isFocusedToastEscapeKeyDownRef:St,isClosePausedRef:Et,children:nt})})};ToastProvider$1.displayName=PROVIDER_NAME$1;var VIEWPORT_NAME$1="ToastViewport",VIEWPORT_DEFAULT_HOTKEY=["F8"],VIEWPORT_PAUSE="toast.viewportPause",VIEWPORT_RESUME="toast.viewportResume",ToastViewport$1=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,hotkey:a=VIEWPORT_DEFAULT_HOTKEY,label:b="Notifications ({hotkey})",...et}=e,nt=useToastProviderContext(VIEWPORT_NAME$1,s),c=useCollection$2(s),ct=reactExports.useRef(null),pt=reactExports.useRef(null),xt=reactExports.useRef(null),St=reactExports.useRef(null),Et=useComposedRefs$1(i,St,nt.onViewportChange),Rt=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),Nt=nt.toastCount>0;reactExports.useEffect(()=>{const Gt=Dt=>{var Lt;a.length!==0&&a.every(Vt=>Dt[Vt]||Dt.code===Vt)&&((Lt=St.current)==null||Lt.focus())};return document.addEventListener("keydown",Gt),()=>document.removeEventListener("keydown",Gt)},[a]),reactExports.useEffect(()=>{const Gt=ct.current,Dt=St.current;if(Nt&&Gt&&Dt){const Bt=()=>{if(!nt.isClosePausedRef.current){const nr=new CustomEvent(VIEWPORT_PAUSE);Dt.dispatchEvent(nr),nt.isClosePausedRef.current=!0}},Lt=()=>{if(nt.isClosePausedRef.current){const nr=new CustomEvent(VIEWPORT_RESUME);Dt.dispatchEvent(nr),nt.isClosePausedRef.current=!1}},Vt=nr=>{!Gt.contains(nr.relatedTarget)&&Lt()},Zt=()=>{Gt.contains(document.activeElement)||Lt()};return Gt.addEventListener("focusin",Bt),Gt.addEventListener("focusout",Vt),Gt.addEventListener("pointermove",Bt),Gt.addEventListener("pointerleave",Zt),window.addEventListener("blur",Bt),window.addEventListener("focus",Lt),()=>{Gt.removeEventListener("focusin",Bt),Gt.removeEventListener("focusout",Vt),Gt.removeEventListener("pointermove",Bt),Gt.removeEventListener("pointerleave",Zt),window.removeEventListener("blur",Bt),window.removeEventListener("focus",Lt)}}},[Nt,nt.isClosePausedRef]);const It=reactExports.useCallback(({tabbingDirection:Gt})=>{const Bt=c().map(Lt=>{const Vt=Lt.ref.current,Zt=[Vt,...getTabbableCandidates$1(Vt)];return Gt==="forwards"?Zt:Zt.reverse()});return(Gt==="forwards"?Bt.reverse():Bt).flat()},[c]);return reactExports.useEffect(()=>{const Gt=St.current;if(Gt){const Dt=Bt=>{var Zt,nr,ur;const Lt=Bt.altKey||Bt.ctrlKey||Bt.metaKey;if(Bt.key==="Tab"&&!Lt){const _r=document.activeElement,Ur=Bt.shiftKey;if(Bt.target===Gt&&Ur){(Zt=pt.current)==null||Zt.focus();return}const Fr=It({tabbingDirection:Ur?"backwards":"forwards"}),rn=Fr.findIndex(gn=>gn===_r);focusFirst$1(Fr.slice(rn+1))?Bt.preventDefault():Ur?(nr=pt.current)==null||nr.focus():(ur=xt.current)==null||ur.focus()}};return Gt.addEventListener("keydown",Dt),()=>Gt.removeEventListener("keydown",Dt)}},[c,It]),jsxRuntimeExports.jsxs(Branch,{ref:ct,role:"region","aria-label":b.replace("{hotkey}",Rt),tabIndex:-1,style:{pointerEvents:Nt?void 0:"none"},children:[Nt&&jsxRuntimeExports.jsx(FocusProxy,{ref:pt,onFocusFromOutsideViewport:()=>{const Gt=It({tabbingDirection:"forwards"});focusFirst$1(Gt)}}),jsxRuntimeExports.jsx(Collection$2.Slot,{scope:s,children:jsxRuntimeExports.jsx(Primitive.ol,{tabIndex:-1,...et,ref:Et})}),Nt&&jsxRuntimeExports.jsx(FocusProxy,{ref:xt,onFocusFromOutsideViewport:()=>{const Gt=It({tabbingDirection:"backwards"});focusFirst$1(Gt)}})]})});ToastViewport$1.displayName=VIEWPORT_NAME$1;var FOCUS_PROXY_NAME="ToastFocusProxy",FocusProxy=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,onFocusFromOutsideViewport:a,...b}=e,et=useToastProviderContext(FOCUS_PROXY_NAME,s);return jsxRuntimeExports.jsx(VisuallyHidden,{"aria-hidden":!0,tabIndex:0,...b,ref:i,style:{position:"fixed"},onFocus:nt=>{var pt;const c=nt.relatedTarget;!((pt=et.viewport)!=null&&pt.contains(c))&&a()}})});FocusProxy.displayName=FOCUS_PROXY_NAME;var TOAST_NAME="Toast",TOAST_SWIPE_START="toast.swipeStart",TOAST_SWIPE_MOVE="toast.swipeMove",TOAST_SWIPE_CANCEL="toast.swipeCancel",TOAST_SWIPE_END="toast.swipeEnd",Toast$1=reactExports.forwardRef((e,i)=>{const{forceMount:s,open:a,defaultOpen:b,onOpenChange:et,...nt}=e,[c,ct]=useControllableState({prop:a,defaultProp:b??!0,onChange:et,caller:TOAST_NAME});return jsxRuntimeExports.jsx(Presence,{present:s||c,children:jsxRuntimeExports.jsx(ToastImpl,{open:c,...nt,ref:i,onClose:()=>ct(!1),onPause:useCallbackRef$1(e.onPause),onResume:useCallbackRef$1(e.onResume),onSwipeStart:composeEventHandlers(e.onSwipeStart,pt=>{pt.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:composeEventHandlers(e.onSwipeMove,pt=>{const{x:xt,y:St}=pt.detail.delta;pt.currentTarget.setAttribute("data-swipe","move"),pt.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${xt}px`),pt.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${St}px`)}),onSwipeCancel:composeEventHandlers(e.onSwipeCancel,pt=>{pt.currentTarget.setAttribute("data-swipe","cancel"),pt.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),pt.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),pt.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),pt.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:composeEventHandlers(e.onSwipeEnd,pt=>{const{x:xt,y:St}=pt.detail.delta;pt.currentTarget.setAttribute("data-swipe","end"),pt.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),pt.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),pt.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${xt}px`),pt.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${St}px`),ct(!1)})})})});Toast$1.displayName=TOAST_NAME;var[ToastInteractiveProvider,useToastInteractiveContext]=createToastContext(TOAST_NAME,{onClose(){}}),ToastImpl=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,type:a="foreground",duration:b,open:et,onClose:nt,onEscapeKeyDown:c,onPause:ct,onResume:pt,onSwipeStart:xt,onSwipeMove:St,onSwipeCancel:Et,onSwipeEnd:Rt,...Nt}=e,It=useToastProviderContext(TOAST_NAME,s),[Gt,Dt]=reactExports.useState(null),Bt=useComposedRefs$1(i,gn=>Dt(gn)),Lt=reactExports.useRef(null),Vt=reactExports.useRef(null),Zt=b||It.duration,nr=reactExports.useRef(0),ur=reactExports.useRef(Zt),_r=reactExports.useRef(0),{onToastAdd:Ur,onToastRemove:ln}=It,an=useCallbackRef$1(()=>{var _i;(Gt==null?void 0:Gt.contains(document.activeElement))&&((_i=It.viewport)==null||_i.focus()),nt()}),Fr=reactExports.useCallback(gn=>{!gn||gn===1/0||(window.clearTimeout(_r.current),nr.current=new Date().getTime(),_r.current=window.setTimeout(an,gn))},[an]);reactExports.useEffect(()=>{const gn=It.viewport;if(gn){const _i=()=>{Fr(ur.current),pt==null||pt()},xr=()=>{const gr=new Date().getTime()-nr.current;ur.current=ur.current-gr,window.clearTimeout(_r.current),ct==null||ct()};return gn.addEventListener(VIEWPORT_PAUSE,xr),gn.addEventListener(VIEWPORT_RESUME,_i),()=>{gn.removeEventListener(VIEWPORT_PAUSE,xr),gn.removeEventListener(VIEWPORT_RESUME,_i)}}},[It.viewport,Zt,ct,pt,Fr]),reactExports.useEffect(()=>{et&&!It.isClosePausedRef.current&&Fr(Zt)},[et,Zt,It.isClosePausedRef,Fr]),reactExports.useEffect(()=>(Ur(),()=>ln()),[Ur,ln]);const rn=reactExports.useMemo(()=>Gt?getAnnounceTextContent(Gt):null,[Gt]);return It.viewport?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[rn&&jsxRuntimeExports.jsx(ToastAnnounce,{__scopeToast:s,role:"status","aria-live":a==="foreground"?"assertive":"polite","aria-atomic":!0,children:rn}),jsxRuntimeExports.jsx(ToastInteractiveProvider,{scope:s,onClose:an,children:reactDomExports.createPortal(jsxRuntimeExports.jsx(Collection$2.ItemSlot,{scope:s,children:jsxRuntimeExports.jsx(Root$6,{asChild:!0,onEscapeKeyDown:composeEventHandlers(c,()=>{It.isFocusedToastEscapeKeyDownRef.current||an(),It.isFocusedToastEscapeKeyDownRef.current=!1}),children:jsxRuntimeExports.jsx(Primitive.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":et?"open":"closed","data-swipe-direction":It.swipeDirection,...Nt,ref:Bt,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:composeEventHandlers(e.onKeyDown,gn=>{gn.key==="Escape"&&(c==null||c(gn.nativeEvent),gn.nativeEvent.defaultPrevented||(It.isFocusedToastEscapeKeyDownRef.current=!0,an()))}),onPointerDown:composeEventHandlers(e.onPointerDown,gn=>{gn.button===0&&(Lt.current={x:gn.clientX,y:gn.clientY})}),onPointerMove:composeEventHandlers(e.onPointerMove,gn=>{if(!Lt.current)return;const _i=gn.clientX-Lt.current.x,xr=gn.clientY-Lt.current.y,gr=!!Vt.current,rr=["left","right"].includes(It.swipeDirection),cr=["left","up"].includes(It.swipeDirection)?Math.min:Math.max,Hr=rr?cr(0,_i):0,$r=rr?0:cr(0,xr),_n=gn.pointerType==="touch"?10:2,fn={x:Hr,y:$r},jn={originalEvent:gn,delta:fn};gr?(Vt.current=fn,handleAndDispatchCustomEvent(TOAST_SWIPE_MOVE,St,jn,{discrete:!1})):isDeltaInDirection(fn,It.swipeDirection,_n)?(Vt.current=fn,handleAndDispatchCustomEvent(TOAST_SWIPE_START,xt,jn,{discrete:!1}),gn.target.setPointerCapture(gn.pointerId)):(Math.abs(_i)>_n||Math.abs(xr)>_n)&&(Lt.current=null)}),onPointerUp:composeEventHandlers(e.onPointerUp,gn=>{const _i=Vt.current,xr=gn.target;if(xr.hasPointerCapture(gn.pointerId)&&xr.releasePointerCapture(gn.pointerId),Vt.current=null,Lt.current=null,_i){const gr=gn.currentTarget,rr={originalEvent:gn,delta:_i};isDeltaInDirection(_i,It.swipeDirection,It.swipeThreshold)?handleAndDispatchCustomEvent(TOAST_SWIPE_END,Rt,rr,{discrete:!0}):handleAndDispatchCustomEvent(TOAST_SWIPE_CANCEL,Et,rr,{discrete:!0}),gr.addEventListener("click",cr=>cr.preventDefault(),{once:!0})}})})})}),It.viewport)})]}):null}),ToastAnnounce=e=>{const{__scopeToast:i,children:s,...a}=e,b=useToastProviderContext(TOAST_NAME,i),[et,nt]=reactExports.useState(!1),[c,ct]=reactExports.useState(!1);return useNextFrame(()=>nt(!0)),reactExports.useEffect(()=>{const pt=window.setTimeout(()=>ct(!0),1e3);return()=>window.clearTimeout(pt)},[]),c?null:jsxRuntimeExports.jsx(Portal$2,{asChild:!0,children:jsxRuntimeExports.jsx(VisuallyHidden,{...a,children:et&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[b.label," ",s]})})})},TITLE_NAME$2="ToastTitle",ToastTitle$1=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,...a}=e;return jsxRuntimeExports.jsx(Primitive.div,{...a,ref:i})});ToastTitle$1.displayName=TITLE_NAME$2;var DESCRIPTION_NAME$2="ToastDescription",ToastDescription$1=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,...a}=e;return jsxRuntimeExports.jsx(Primitive.div,{...a,ref:i})});ToastDescription$1.displayName=DESCRIPTION_NAME$2;var ACTION_NAME$1="ToastAction",ToastAction$1=reactExports.forwardRef((e,i)=>{const{altText:s,...a}=e;return s.trim()?jsxRuntimeExports.jsx(ToastAnnounceExclude,{altText:s,asChild:!0,children:jsxRuntimeExports.jsx(ToastClose$1,{...a,ref:i})}):(console.error(`Invalid prop \`altText\` supplied to \`${ACTION_NAME$1}\`. Expected non-empty \`string\`.`),null)});ToastAction$1.displayName=ACTION_NAME$1;var CLOSE_NAME$1="ToastClose",ToastClose$1=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,...a}=e,b=useToastInteractiveContext(CLOSE_NAME$1,s);return jsxRuntimeExports.jsx(ToastAnnounceExclude,{asChild:!0,children:jsxRuntimeExports.jsx(Primitive.button,{type:"button",...a,ref:i,onClick:composeEventHandlers(e.onClick,b.onClose)})})});ToastClose$1.displayName=CLOSE_NAME$1;var ToastAnnounceExclude=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,altText:a,...b}=e;return jsxRuntimeExports.jsx(Primitive.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":a||void 0,...b,ref:i})});function getAnnounceTextContent(e){const i=[];return Array.from(e.childNodes).forEach(a=>{if(a.nodeType===a.TEXT_NODE&&a.textContent&&i.push(a.textContent),isHTMLElement$2(a)){const b=a.ariaHidden||a.hidden||a.style.display==="none",et=a.dataset.radixToastAnnounceExclude==="";if(!b)if(et){const nt=a.dataset.radixToastAnnounceAlt;nt&&i.push(nt)}else i.push(...getAnnounceTextContent(a))}}),i}function handleAndDispatchCustomEvent(e,i,s,{discrete:a}){const b=s.originalEvent.currentTarget,et=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:s});i&&b.addEventListener(e,i,{once:!0}),a?dispatchDiscreteCustomEvent(b,et):b.dispatchEvent(et)}var isDeltaInDirection=(e,i,s=0)=>{const a=Math.abs(e.x),b=Math.abs(e.y),et=a>b;return i==="left"||i==="right"?et&&a>s:!et&&b>s};function useNextFrame(e=()=>{}){const i=useCallbackRef$1(e);useLayoutEffect2(()=>{let s=0,a=0;return s=window.requestAnimationFrame(()=>a=window.requestAnimationFrame(i)),()=>{window.cancelAnimationFrame(s),window.cancelAnimationFrame(a)}},[i])}function isHTMLElement$2(e){return e.nodeType===e.ELEMENT_NODE}function getTabbableCandidates$1(e){const i=[],s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const b=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||b?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)i.push(s.currentNode);return i}function focusFirst$1(e){const i=document.activeElement;return e.some(s=>s===i?!0:(s.focus(),document.activeElement!==i))}var Provider$2=ToastProvider$1,Viewport$1=ToastViewport$1,Root2$4=Toast$1,Title$1=ToastTitle$1,Description$1=ToastDescription$1,Action$2=ToastAction$1,Close$1=ToastClose$1;function r(e){var i,s,a="";if(typeof e=="string"||typeof e=="number")a+=e;else if(typeof e=="object")if(Array.isArray(e)){var b=e.length;for(i=0;i<b;i++)e[i]&&(s=r(e[i]))&&(a&&(a+=" "),a+=s)}else for(s in e)e[s]&&(a&&(a+=" "),a+=s);return a}function clsx(){for(var e,i,s=0,a="",b=arguments.length;s<b;s++)(e=arguments[s])&&(i=r(e))&&(a&&(a+=" "),a+=i);return a}const falsyToString=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,cx=clsx,cva=(e,i)=>s=>{var a;if((i==null?void 0:i.variants)==null)return cx(e,s==null?void 0:s.class,s==null?void 0:s.className);const{variants:b,defaultVariants:et}=i,nt=Object.keys(b).map(pt=>{const xt=s==null?void 0:s[pt],St=et==null?void 0:et[pt];if(xt===null)return null;const Et=falsyToString(xt)||falsyToString(St);return b[pt][Et]}),c=s&&Object.entries(s).reduce((pt,xt)=>{let[St,Et]=xt;return Et===void 0||(pt[St]=Et),pt},{}),ct=i==null||(a=i.compoundVariants)===null||a===void 0?void 0:a.reduce((pt,xt)=>{let{class:St,className:Et,...Rt}=xt;return Object.entries(Rt).every(Nt=>{let[It,Gt]=Nt;return Array.isArray(Gt)?Gt.includes({...et,...c}[It]):{...et,...c}[It]===Gt})?[...pt,St,Et]:pt},[]);return cx(e,nt,ct,s==null?void 0:s.class,s==null?void 0:s.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const toKebabCase=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),mergeClasses=(...e)=>e.filter((i,s,a)=>!!i&&i.trim()!==""&&a.indexOf(i)===s).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Icon$1=reactExports.forwardRef(({color:e="currentColor",size:i=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:b="",children:et,iconNode:nt,...c},ct)=>reactExports.createElement("svg",{ref:ct,...defaultAttributes,width:i,height:i,stroke:e,strokeWidth:a?Number(s)*24/Number(i):s,className:mergeClasses("lucide",b),...c},[...nt.map(([pt,xt])=>reactExports.createElement(pt,xt)),...Array.isArray(et)?et:[et]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const createLucideIcon=(e,i)=>{const s=reactExports.forwardRef(({className:a,...b},et)=>reactExports.createElement(Icon$1,{ref:et,iconNode:i,className:mergeClasses(`lucide-${toKebabCase(e)}`,a),...b}));return s.displayName=`${e}`,s};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ArrowLeft=createLucideIcon("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ArrowRight=createLucideIcon("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bell=createLucideIcon("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Briefcase=createLucideIcon("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Camera=createLucideIcon("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Check=createLucideIcon("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChefHat=createLucideIcon("ChefHat",[["path",{d:"M17 21a1 1 0 0 0 1-1v-5.35c0-.457.316-.844.727-1.041a4 4 0 0 0-2.134-7.589 5 5 0 0 0-9.186 0 4 4 0 0 0-2.134 7.588c.411.198.727.585.727 1.041V20a1 1 0 0 0 1 1Z",key:"1qvrer"}],["path",{d:"M6 17h12",key:"1jwigz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronDown=createLucideIcon("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronLeft=createLucideIcon("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronRight=createLucideIcon("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronUp=createLucideIcon("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CircleHelp=createLucideIcon("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Clock=createLucideIcon("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CreditCard=createLucideIcon("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DollarSign=createLucideIcon("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ExternalLink=createLucideIcon("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EyeOff=createLucideIcon("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eye=createLucideIcon("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FileText=createLucideIcon("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Globe=createLucideIcon("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Heart=createLucideIcon("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const House=createLucideIcon("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Leaf=createLucideIcon("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LoaderCircle=createLucideIcon("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lock=createLucideIcon("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LogOut=createLucideIcon("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mail=createLucideIcon("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MapPin=createLucideIcon("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MessageCircle=createLucideIcon("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Minus=createLucideIcon("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Moon=createLucideIcon("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Navigation=createLucideIcon("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Package=createLucideIcon("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Percent=createLucideIcon("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Phone=createLucideIcon("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Plus=createLucideIcon("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RefreshCw=createLucideIcon("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Search=createLucideIcon("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Settings=createLucideIcon("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Share2=createLucideIcon("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ShieldCheck=createLucideIcon("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ShoppingBag=createLucideIcon("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Smartphone=createLucideIcon("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SquarePen=createLucideIcon("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Star=createLucideIcon("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Store$1=createLucideIcon("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tag=createLucideIcon("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Trash2=createLucideIcon("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TrendingUp=createLucideIcon("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TriangleAlert=createLucideIcon("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Truck=createLucideIcon("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UserPlus=createLucideIcon("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const User=createLucideIcon("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Users=createLucideIcon("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=createLucideIcon("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),CLASS_PART_SEPARATOR="-",createClassGroupUtils=e=>{const i=createClassMap(e),{conflictingClassGroups:s,conflictingClassGroupModifiers:a}=e;return{getClassGroupId:nt=>{const c=nt.split(CLASS_PART_SEPARATOR);return c[0]===""&&c.length!==1&&c.shift(),getGroupRecursive(c,i)||getGroupIdForArbitraryProperty(nt)},getConflictingClassGroupIds:(nt,c)=>{const ct=s[nt]||[];return c&&a[nt]?[...ct,...a[nt]]:ct}}},getGroupRecursive=(e,i)=>{var nt;if(e.length===0)return i.classGroupId;const s=e[0],a=i.nextPart.get(s),b=a?getGroupRecursive(e.slice(1),a):void 0;if(b)return b;if(i.validators.length===0)return;const et=e.join(CLASS_PART_SEPARATOR);return(nt=i.validators.find(({validator:c})=>c(et)))==null?void 0:nt.classGroupId},arbitraryPropertyRegex=/^\[(.+)\]$/,getGroupIdForArbitraryProperty=e=>{if(arbitraryPropertyRegex.test(e)){const i=arbitraryPropertyRegex.exec(e)[1],s=i==null?void 0:i.substring(0,i.indexOf(":"));if(s)return"arbitrary.."+s}},createClassMap=e=>{const{theme:i,prefix:s}=e,a={nextPart:new Map,validators:[]};return getPrefixedClassGroupEntries(Object.entries(e.classGroups),s).forEach(([et,nt])=>{processClassesRecursively(nt,a,et,i)}),a},processClassesRecursively=(e,i,s,a)=>{e.forEach(b=>{if(typeof b=="string"){const et=b===""?i:getPart(i,b);et.classGroupId=s;return}if(typeof b=="function"){if(isThemeGetter(b)){processClassesRecursively(b(a),i,s,a);return}i.validators.push({validator:b,classGroupId:s});return}Object.entries(b).forEach(([et,nt])=>{processClassesRecursively(nt,getPart(i,et),s,a)})})},getPart=(e,i)=>{let s=e;return i.split(CLASS_PART_SEPARATOR).forEach(a=>{s.nextPart.has(a)||s.nextPart.set(a,{nextPart:new Map,validators:[]}),s=s.nextPart.get(a)}),s},isThemeGetter=e=>e.isThemeGetter,getPrefixedClassGroupEntries=(e,i)=>i?e.map(([s,a])=>{const b=a.map(et=>typeof et=="string"?i+et:typeof et=="object"?Object.fromEntries(Object.entries(et).map(([nt,c])=>[i+nt,c])):et);return[s,b]}):e,createLruCache=e=>{if(e<1)return{get:()=>{},set:()=>{}};let i=0,s=new Map,a=new Map;const b=(et,nt)=>{s.set(et,nt),i++,i>e&&(i=0,a=s,s=new Map)};return{get(et){let nt=s.get(et);if(nt!==void 0)return nt;if((nt=a.get(et))!==void 0)return b(et,nt),nt},set(et,nt){s.has(et)?s.set(et,nt):b(et,nt)}}},IMPORTANT_MODIFIER="!",createParseClassName=e=>{const{separator:i,experimentalParseClassName:s}=e,a=i.length===1,b=i[0],et=i.length,nt=c=>{const ct=[];let pt=0,xt=0,St;for(let Gt=0;Gt<c.length;Gt++){let Dt=c[Gt];if(pt===0){if(Dt===b&&(a||c.slice(Gt,Gt+et)===i)){ct.push(c.slice(xt,Gt)),xt=Gt+et;continue}if(Dt==="/"){St=Gt;continue}}Dt==="["?pt++:Dt==="]"&&pt--}const Et=ct.length===0?c:c.substring(xt),Rt=Et.startsWith(IMPORTANT_MODIFIER),Nt=Rt?Et.substring(1):Et,It=St&&St>xt?St-xt:void 0;return{modifiers:ct,hasImportantModifier:Rt,baseClassName:Nt,maybePostfixModifierPosition:It}};return s?c=>s({className:c,parseClassName:nt}):nt},sortModifiers=e=>{if(e.length<=1)return e;const i=[];let s=[];return e.forEach(a=>{a[0]==="["?(i.push(...s.sort(),a),s=[]):s.push(a)}),i.push(...s.sort()),i},createConfigUtils=e=>({cache:createLruCache(e.cacheSize),parseClassName:createParseClassName(e),...createClassGroupUtils(e)}),SPLIT_CLASSES_REGEX=/\s+/,mergeClassList=(e,i)=>{const{parseClassName:s,getClassGroupId:a,getConflictingClassGroupIds:b}=i,et=[],nt=e.trim().split(SPLIT_CLASSES_REGEX);let c="";for(let ct=nt.length-1;ct>=0;ct-=1){const pt=nt[ct],{modifiers:xt,hasImportantModifier:St,baseClassName:Et,maybePostfixModifierPosition:Rt}=s(pt);let Nt=!!Rt,It=a(Nt?Et.substring(0,Rt):Et);if(!It){if(!Nt){c=pt+(c.length>0?" "+c:c);continue}if(It=a(Et),!It){c=pt+(c.length>0?" "+c:c);continue}Nt=!1}const Gt=sortModifiers(xt).join(":"),Dt=St?Gt+IMPORTANT_MODIFIER:Gt,Bt=Dt+It;if(et.includes(Bt))continue;et.push(Bt);const Lt=b(It,Nt);for(let Vt=0;Vt<Lt.length;++Vt){const Zt=Lt[Vt];et.push(Dt+Zt)}c=pt+(c.length>0?" "+c:c)}return c};function twJoin(){let e=0,i,s,a="";for(;e<arguments.length;)(i=arguments[e++])&&(s=toValue(i))&&(a&&(a+=" "),a+=s);return a}const toValue=e=>{if(typeof e=="string")return e;let i,s="";for(let a=0;a<e.length;a++)e[a]&&(i=toValue(e[a]))&&(s&&(s+=" "),s+=i);return s};function createTailwindMerge(e,...i){let s,a,b,et=nt;function nt(ct){const pt=i.reduce((xt,St)=>St(xt),e());return s=createConfigUtils(pt),a=s.cache.get,b=s.cache.set,et=c,c(ct)}function c(ct){const pt=a(ct);if(pt)return pt;const xt=mergeClassList(ct,s);return b(ct,xt),xt}return function(){return et(twJoin.apply(null,arguments))}}const fromTheme=e=>{const i=s=>s[e]||[];return i.isThemeGetter=!0,i},arbitraryValueRegex=/^\[(?:([a-z-]+):)?(.+)\]$/i,fractionRegex=/^\d+\/\d+$/,stringLengths=new Set(["px","full","screen"]),tshirtUnitRegex=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,lengthUnitRegex=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,colorFunctionRegex=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,shadowRegex=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,imageRegex=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,isLength=e=>isNumber$1(e)||stringLengths.has(e)||fractionRegex.test(e),isArbitraryLength=e=>getIsArbitraryValue(e,"length",isLengthOnly),isNumber$1=e=>!!e&&!Number.isNaN(Number(e)),isArbitraryNumber=e=>getIsArbitraryValue(e,"number",isNumber$1),isInteger=e=>!!e&&Number.isInteger(Number(e)),isPercent=e=>e.endsWith("%")&&isNumber$1(e.slice(0,-1)),isArbitraryValue=e=>arbitraryValueRegex.test(e),isTshirtSize=e=>tshirtUnitRegex.test(e),sizeLabels=new Set(["length","size","percentage"]),isArbitrarySize=e=>getIsArbitraryValue(e,sizeLabels,isNever),isArbitraryPosition=e=>getIsArbitraryValue(e,"position",isNever),imageLabels=new Set(["image","url"]),isArbitraryImage=e=>getIsArbitraryValue(e,imageLabels,isImage),isArbitraryShadow=e=>getIsArbitraryValue(e,"",isShadow),isAny=()=>!0,getIsArbitraryValue=(e,i,s)=>{const a=arbitraryValueRegex.exec(e);return a?a[1]?typeof i=="string"?a[1]===i:i.has(a[1]):s(a[2]):!1},isLengthOnly=e=>lengthUnitRegex.test(e)&&!colorFunctionRegex.test(e),isNever=()=>!1,isShadow=e=>shadowRegex.test(e),isImage=e=>imageRegex.test(e),getDefaultConfig=()=>{const e=fromTheme("colors"),i=fromTheme("spacing"),s=fromTheme("blur"),a=fromTheme("brightness"),b=fromTheme("borderColor"),et=fromTheme("borderRadius"),nt=fromTheme("borderSpacing"),c=fromTheme("borderWidth"),ct=fromTheme("contrast"),pt=fromTheme("grayscale"),xt=fromTheme("hueRotate"),St=fromTheme("invert"),Et=fromTheme("gap"),Rt=fromTheme("gradientColorStops"),Nt=fromTheme("gradientColorStopPositions"),It=fromTheme("inset"),Gt=fromTheme("margin"),Dt=fromTheme("opacity"),Bt=fromTheme("padding"),Lt=fromTheme("saturate"),Vt=fromTheme("scale"),Zt=fromTheme("sepia"),nr=fromTheme("skew"),ur=fromTheme("space"),_r=fromTheme("translate"),Ur=()=>["auto","contain","none"],ln=()=>["auto","hidden","clip","visible","scroll"],an=()=>["auto",isArbitraryValue,i],Fr=()=>[isArbitraryValue,i],rn=()=>["",isLength,isArbitraryLength],gn=()=>["auto",isNumber$1,isArbitraryValue],_i=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],xr=()=>["solid","dashed","dotted","double","none"],gr=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],rr=()=>["start","end","center","between","around","evenly","stretch"],cr=()=>["","0",isArbitraryValue],Hr=()=>["auto","avoid","all","avoid-page","page","left","right","column"],$r=()=>[isNumber$1,isArbitraryValue];return{cacheSize:500,separator:":",theme:{colors:[isAny],spacing:[isLength,isArbitraryLength],blur:["none","",isTshirtSize,isArbitraryValue],brightness:$r(),borderColor:[e],borderRadius:["none","","full",isTshirtSize,isArbitraryValue],borderSpacing:Fr(),borderWidth:rn(),contrast:$r(),grayscale:cr(),hueRotate:$r(),invert:cr(),gap:Fr(),gradientColorStops:[e],gradientColorStopPositions:[isPercent,isArbitraryLength],inset:an(),margin:an(),opacity:$r(),padding:Fr(),saturate:$r(),scale:$r(),sepia:cr(),skew:$r(),space:Fr(),translate:Fr()},classGroups:{aspect:[{aspect:["auto","square","video",isArbitraryValue]}],container:["container"],columns:[{columns:[isTshirtSize]}],"break-after":[{"break-after":Hr()}],"break-before":[{"break-before":Hr()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[..._i(),isArbitraryValue]}],overflow:[{overflow:ln()}],"overflow-x":[{"overflow-x":ln()}],"overflow-y":[{"overflow-y":ln()}],overscroll:[{overscroll:Ur()}],"overscroll-x":[{"overscroll-x":Ur()}],"overscroll-y":[{"overscroll-y":Ur()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[It]}],"inset-x":[{"inset-x":[It]}],"inset-y":[{"inset-y":[It]}],start:[{start:[It]}],end:[{end:[It]}],top:[{top:[It]}],right:[{right:[It]}],bottom:[{bottom:[It]}],left:[{left:[It]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",isInteger,isArbitraryValue]}],basis:[{basis:an()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",isArbitraryValue]}],grow:[{grow:cr()}],shrink:[{shrink:cr()}],order:[{order:["first","last","none",isInteger,isArbitraryValue]}],"grid-cols":[{"grid-cols":[isAny]}],"col-start-end":[{col:["auto",{span:["full",isInteger,isArbitraryValue]},isArbitraryValue]}],"col-start":[{"col-start":gn()}],"col-end":[{"col-end":gn()}],"grid-rows":[{"grid-rows":[isAny]}],"row-start-end":[{row:["auto",{span:[isInteger,isArbitraryValue]},isArbitraryValue]}],"row-start":[{"row-start":gn()}],"row-end":[{"row-end":gn()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",isArbitraryValue]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",isArbitraryValue]}],gap:[{gap:[Et]}],"gap-x":[{"gap-x":[Et]}],"gap-y":[{"gap-y":[Et]}],"justify-content":[{justify:["normal",...rr()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...rr(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...rr(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[Bt]}],px:[{px:[Bt]}],py:[{py:[Bt]}],ps:[{ps:[Bt]}],pe:[{pe:[Bt]}],pt:[{pt:[Bt]}],pr:[{pr:[Bt]}],pb:[{pb:[Bt]}],pl:[{pl:[Bt]}],m:[{m:[Gt]}],mx:[{mx:[Gt]}],my:[{my:[Gt]}],ms:[{ms:[Gt]}],me:[{me:[Gt]}],mt:[{mt:[Gt]}],mr:[{mr:[Gt]}],mb:[{mb:[Gt]}],ml:[{ml:[Gt]}],"space-x":[{"space-x":[ur]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[ur]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",isArbitraryValue,i]}],"min-w":[{"min-w":[isArbitraryValue,i,"min","max","fit"]}],"max-w":[{"max-w":[isArbitraryValue,i,"none","full","min","max","fit","prose",{screen:[isTshirtSize]},isTshirtSize]}],h:[{h:[isArbitraryValue,i,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[isArbitraryValue,i,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[isArbitraryValue,i,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[isArbitraryValue,i,"auto","min","max","fit"]}],"font-size":[{text:["base",isTshirtSize,isArbitraryLength]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",isArbitraryNumber]}],"font-family":[{font:[isAny]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",isArbitraryValue]}],"line-clamp":[{"line-clamp":["none",isNumber$1,isArbitraryNumber]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",isLength,isArbitraryValue]}],"list-image":[{"list-image":["none",isArbitraryValue]}],"list-style-type":[{list:["none","disc","decimal",isArbitraryValue]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[Dt]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[Dt]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...xr(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",isLength,isArbitraryLength]}],"underline-offset":[{"underline-offset":["auto",isLength,isArbitraryValue]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Fr()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",isArbitraryValue]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",isArbitraryValue]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[Dt]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[..._i(),isArbitraryPosition]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",isArbitrarySize]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},isArbitraryImage]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[Nt]}],"gradient-via-pos":[{via:[Nt]}],"gradient-to-pos":[{to:[Nt]}],"gradient-from":[{from:[Rt]}],"gradient-via":[{via:[Rt]}],"gradient-to":[{to:[Rt]}],rounded:[{rounded:[et]}],"rounded-s":[{"rounded-s":[et]}],"rounded-e":[{"rounded-e":[et]}],"rounded-t":[{"rounded-t":[et]}],"rounded-r":[{"rounded-r":[et]}],"rounded-b":[{"rounded-b":[et]}],"rounded-l":[{"rounded-l":[et]}],"rounded-ss":[{"rounded-ss":[et]}],"rounded-se":[{"rounded-se":[et]}],"rounded-ee":[{"rounded-ee":[et]}],"rounded-es":[{"rounded-es":[et]}],"rounded-tl":[{"rounded-tl":[et]}],"rounded-tr":[{"rounded-tr":[et]}],"rounded-br":[{"rounded-br":[et]}],"rounded-bl":[{"rounded-bl":[et]}],"border-w":[{border:[c]}],"border-w-x":[{"border-x":[c]}],"border-w-y":[{"border-y":[c]}],"border-w-s":[{"border-s":[c]}],"border-w-e":[{"border-e":[c]}],"border-w-t":[{"border-t":[c]}],"border-w-r":[{"border-r":[c]}],"border-w-b":[{"border-b":[c]}],"border-w-l":[{"border-l":[c]}],"border-opacity":[{"border-opacity":[Dt]}],"border-style":[{border:[...xr(),"hidden"]}],"divide-x":[{"divide-x":[c]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[c]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[Dt]}],"divide-style":[{divide:xr()}],"border-color":[{border:[b]}],"border-color-x":[{"border-x":[b]}],"border-color-y":[{"border-y":[b]}],"border-color-s":[{"border-s":[b]}],"border-color-e":[{"border-e":[b]}],"border-color-t":[{"border-t":[b]}],"border-color-r":[{"border-r":[b]}],"border-color-b":[{"border-b":[b]}],"border-color-l":[{"border-l":[b]}],"divide-color":[{divide:[b]}],"outline-style":[{outline:["",...xr()]}],"outline-offset":[{"outline-offset":[isLength,isArbitraryValue]}],"outline-w":[{outline:[isLength,isArbitraryLength]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:rn()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[Dt]}],"ring-offset-w":[{"ring-offset":[isLength,isArbitraryLength]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",isTshirtSize,isArbitraryShadow]}],"shadow-color":[{shadow:[isAny]}],opacity:[{opacity:[Dt]}],"mix-blend":[{"mix-blend":[...gr(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":gr()}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[a]}],contrast:[{contrast:[ct]}],"drop-shadow":[{"drop-shadow":["","none",isTshirtSize,isArbitraryValue]}],grayscale:[{grayscale:[pt]}],"hue-rotate":[{"hue-rotate":[xt]}],invert:[{invert:[St]}],saturate:[{saturate:[Lt]}],sepia:[{sepia:[Zt]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[a]}],"backdrop-contrast":[{"backdrop-contrast":[ct]}],"backdrop-grayscale":[{"backdrop-grayscale":[pt]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[xt]}],"backdrop-invert":[{"backdrop-invert":[St]}],"backdrop-opacity":[{"backdrop-opacity":[Dt]}],"backdrop-saturate":[{"backdrop-saturate":[Lt]}],"backdrop-sepia":[{"backdrop-sepia":[Zt]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[nt]}],"border-spacing-x":[{"border-spacing-x":[nt]}],"border-spacing-y":[{"border-spacing-y":[nt]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",isArbitraryValue]}],duration:[{duration:$r()}],ease:[{ease:["linear","in","out","in-out",isArbitraryValue]}],delay:[{delay:$r()}],animate:[{animate:["none","spin","ping","pulse","bounce",isArbitraryValue]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Vt]}],"scale-x":[{"scale-x":[Vt]}],"scale-y":[{"scale-y":[Vt]}],rotate:[{rotate:[isInteger,isArbitraryValue]}],"translate-x":[{"translate-x":[_r]}],"translate-y":[{"translate-y":[_r]}],"skew-x":[{"skew-x":[nr]}],"skew-y":[{"skew-y":[nr]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",isArbitraryValue]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",isArbitraryValue]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Fr()}],"scroll-mx":[{"scroll-mx":Fr()}],"scroll-my":[{"scroll-my":Fr()}],"scroll-ms":[{"scroll-ms":Fr()}],"scroll-me":[{"scroll-me":Fr()}],"scroll-mt":[{"scroll-mt":Fr()}],"scroll-mr":[{"scroll-mr":Fr()}],"scroll-mb":[{"scroll-mb":Fr()}],"scroll-ml":[{"scroll-ml":Fr()}],"scroll-p":[{"scroll-p":Fr()}],"scroll-px":[{"scroll-px":Fr()}],"scroll-py":[{"scroll-py":Fr()}],"scroll-ps":[{"scroll-ps":Fr()}],"scroll-pe":[{"scroll-pe":Fr()}],"scroll-pt":[{"scroll-pt":Fr()}],"scroll-pr":[{"scroll-pr":Fr()}],"scroll-pb":[{"scroll-pb":Fr()}],"scroll-pl":[{"scroll-pl":Fr()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",isArbitraryValue]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[isLength,isArbitraryLength,isArbitraryNumber]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},twMerge=createTailwindMerge(getDefaultConfig);function cn(...e){return twMerge(clsx(e))}function calculateDistance(e,i,s,a){const et=deg2rad(s-e),nt=deg2rad(a-i),c=Math.sin(et/2)*Math.sin(et/2)+Math.cos(deg2rad(e))*Math.cos(deg2rad(s))*Math.sin(nt/2)*Math.sin(nt/2),pt=6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)));return pt<1?`${Math.round(pt*1e3)}m`:`${pt.toFixed(1)} km`}function deg2rad(e){return e*(Math.PI/180)}const ToastProvider=Provider$2,ToastViewport=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Viewport$1,{ref:s,className:cn("fixed top-0 z-[100] flex max-h-screen w-full flex-col p-4 sm:right-0 sm:flex-col md:max-w-[420px]",e),...i}));ToastViewport.displayName=Viewport$1.displayName;const toastVariants=cva("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-top-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Toast=reactExports.forwardRef(({className:e,variant:i,...s},a)=>jsxRuntimeExports.jsx(Root2$4,{ref:a,className:cn(toastVariants({variant:i}),e),...s}));Toast.displayName=Root2$4.displayName;const ToastAction=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Action$2,{ref:s,className:cn("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...i}));ToastAction.displayName=Action$2.displayName;const ToastClose=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Close$1,{ref:s,className:cn("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...i,children:jsxRuntimeExports.jsx(X,{className:"h-4 w-4"})}));ToastClose.displayName=Close$1.displayName;const ToastTitle=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Title$1,{ref:s,className:cn("text-sm font-semibold",e),...i}));ToastTitle.displayName=Title$1.displayName;const ToastDescription=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Description$1,{ref:s,className:cn("text-sm opacity-90",e),...i}));ToastDescription.displayName=Description$1.displayName;function Toaster$1(){const{toasts:e}=useToast();return jsxRuntimeExports.jsxs(ToastProvider,{children:[e.map(function({id:i,title:s,description:a,action:b,...et}){return jsxRuntimeExports.jsxs(Toast,{...et,children:[jsxRuntimeExports.jsxs("div",{className:"grid gap-1",children:[s&&jsxRuntimeExports.jsx(ToastTitle,{children:s}),a&&jsxRuntimeExports.jsx(ToastDescription,{children:a})]}),b,jsxRuntimeExports.jsx(ToastClose,{})]},i)}),jsxRuntimeExports.jsx(ToastViewport,{})]})}var P=["light","dark"],E="(prefers-color-scheme: dark)",L=reactExports.createContext(void 0),D={setTheme:e=>{},themes:[]},j=()=>{var e;return(e=reactExports.useContext(L))!=null?e:D};reactExports.memo(({forcedTheme:e,storageKey:i,attribute:s,enableSystem:a,enableColorScheme:b,defaultTheme:et,value:nt,attrs:c,nonce:ct})=>{let pt=et==="system",xt=s==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${c.map(Nt=>`'${Nt}'`).join(",")})`};`:`var d=document.documentElement,n='${s}',s='setAttribute';`,St=b?P.includes(et)&&et?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${et}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",Et=(Nt,It=!1,Gt=!0)=>{let Dt=nt?nt[Nt]:Nt,Bt=It?Nt+"|| ''":`'${Dt}'`,Lt="";return b&&Gt&&!It&&P.includes(Nt)&&(Lt+=`d.style.colorScheme = '${Nt}';`),s==="class"?It||Dt?Lt+=`c.add(${Bt})`:Lt+="null":Dt&&(Lt+=`d[s](n,${Bt})`),Lt},Rt=e?`!function(){${xt}${Et(e)}}()`:a?`!function(){try{${xt}var e=localStorage.getItem('${i}');if('system'===e||(!e&&${pt})){var t='${E}',m=window.matchMedia(t);if(m.media!==t||m.matches){${Et("dark")}}else{${Et("light")}}}else if(e){${nt?`var x=${JSON.stringify(nt)};`:""}${Et(nt?"x[e]":"e",!0)}}${pt?"":"else{"+Et(et,!1,!1)+"}"}${St}}catch(e){}}()`:`!function(){try{${xt}var e=localStorage.getItem('${i}');if(e){${nt?`var x=${JSON.stringify(nt)};`:""}${Et(nt?"x[e]":"e",!0)}}else{${Et(et,!1,!1)};}${St}}catch(t){}}();`;return reactExports.createElement("script",{nonce:ct,dangerouslySetInnerHTML:{__html:Rt}})});var jt=e=>{switch(e){case"success":return ee;case"info":return ae;case"warning":return oe;case"error":return se;default:return null}},te=Array(12).fill(0),Yt=({visible:e,className:i})=>React.createElement("div",{className:["sonner-loading-wrapper",i].filter(Boolean).join(" "),"data-visible":e},React.createElement("div",{className:"sonner-spinner"},te.map((s,a)=>React.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${a}`})))),ee=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),oe=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),ae=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),se=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Ot=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},React.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),React.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Ft=()=>{let[e,i]=React.useState(document.hidden);return React.useEffect(()=>{let s=()=>{i(document.hidden)};return document.addEventListener("visibilitychange",s),()=>window.removeEventListener("visibilitychange",s)},[]),e},bt=1,yt=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let i=this.subscribers.indexOf(e);this.subscribers.splice(i,1)}),this.publish=e=>{this.subscribers.forEach(i=>i(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var i;let{message:s,...a}=e,b=typeof(e==null?void 0:e.id)=="number"||((i=e.id)==null?void 0:i.length)>0?e.id:bt++,et=this.toasts.find(c=>c.id===b),nt=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(b)&&this.dismissedToasts.delete(b),et?this.toasts=this.toasts.map(c=>c.id===b?(this.publish({...c,...e,id:b,title:s}),{...c,...e,id:b,dismissible:nt,title:s}):c):this.addToast({title:s,...a,dismissible:nt,id:b}),b},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(i=>{this.subscribers.forEach(s=>s({id:i.id,dismiss:!0}))}),this.subscribers.forEach(i=>i({id:e,dismiss:!0})),e),this.message=(e,i)=>this.create({...i,message:e}),this.error=(e,i)=>this.create({...i,message:e,type:"error"}),this.success=(e,i)=>this.create({...i,type:"success",message:e}),this.info=(e,i)=>this.create({...i,type:"info",message:e}),this.warning=(e,i)=>this.create({...i,type:"warning",message:e}),this.loading=(e,i)=>this.create({...i,type:"loading",message:e}),this.promise=(e,i)=>{if(!i)return;let s;i.loading!==void 0&&(s=this.create({...i,promise:e,type:"loading",message:i.loading,description:typeof i.description!="function"?i.description:void 0}));let a=e instanceof Promise?e:e(),b=s!==void 0,et,nt=a.then(async ct=>{if(et=["resolve",ct],React.isValidElement(ct))b=!1,this.create({id:s,type:"default",message:ct});else if(ie(ct)&&!ct.ok){b=!1;let pt=typeof i.error=="function"?await i.error(`HTTP error! status: ${ct.status}`):i.error,xt=typeof i.description=="function"?await i.description(`HTTP error! status: ${ct.status}`):i.description;this.create({id:s,type:"error",message:pt,description:xt})}else if(i.success!==void 0){b=!1;let pt=typeof i.success=="function"?await i.success(ct):i.success,xt=typeof i.description=="function"?await i.description(ct):i.description;this.create({id:s,type:"success",message:pt,description:xt})}}).catch(async ct=>{if(et=["reject",ct],i.error!==void 0){b=!1;let pt=typeof i.error=="function"?await i.error(ct):i.error,xt=typeof i.description=="function"?await i.description(ct):i.description;this.create({id:s,type:"error",message:pt,description:xt})}}).finally(()=>{var ct;b&&(this.dismiss(s),s=void 0),(ct=i.finally)==null||ct.call(i)}),c=()=>new Promise((ct,pt)=>nt.then(()=>et[0]==="reject"?pt(et[1]):ct(et[1])).catch(pt));return typeof s!="string"&&typeof s!="number"?{unwrap:c}:Object.assign(s,{unwrap:c})},this.custom=(e,i)=>{let s=(i==null?void 0:i.id)||bt++;return this.create({jsx:e(s),id:s,...i}),s},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},v$2=new yt,ne=(e,i)=>{let s=(i==null?void 0:i.id)||bt++;return v$2.addToast({title:e,...i,id:s}),s},ie=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",le=ne,ce=()=>v$2.toasts,de=()=>v$2.getActiveToasts(),ue=Object.assign(le,{success:v$2.success,info:v$2.info,warning:v$2.warning,error:v$2.error,custom:v$2.custom,message:v$2.message,promise:v$2.promise,dismiss:v$2.dismiss,loading:v$2.loading},{getHistory:ce,getToasts:de});function wt(e,{insertAt:i}={}){if(typeof document>"u")return;let s=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",i==="top"&&s.firstChild?s.insertBefore(a,s.firstChild):s.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}wt(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function tt(e){return e.label!==void 0}var pe=3,me="32px",ge="16px",Wt=4e3,he=356,be=14,ye=20,we=200;function M(...e){return e.filter(Boolean).join(" ")}function xe(e){let[i,s]=e.split("-"),a=[];return i&&a.push(i),s&&a.push(s),a}var ve=e=>{var i,s,a,b,et,nt,c,ct,pt,xt,St;let{invert:Et,toast:Rt,unstyled:Nt,interacting:It,setHeights:Gt,visibleToasts:Dt,heights:Bt,index:Lt,toasts:Vt,expanded:Zt,removeToast:nr,defaultRichColors:ur,closeButton:_r,style:Ur,cancelButtonStyle:ln,actionButtonStyle:an,className:Fr="",descriptionClassName:rn="",duration:gn,position:_i,gap:xr,loadingIcon:gr,expandByDefault:rr,classNames:cr,icons:Hr,closeButtonAriaLabel:$r="Close toast",pauseWhenPageIsHidden:_n}=e,[fn,jn]=React.useState(null),[vs,Cs]=React.useState(null),[ns,Nn]=React.useState(!1),[ls,ms]=React.useState(!1),[Ss,Ks]=React.useState(!1),[ws,ps]=React.useState(!1),[Rl,Qo]=React.useState(!1),[Vo,wo]=React.useState(0),[tu,ou]=React.useState(0),Sl=React.useRef(Rt.duration||gn||Wt),ru=React.useRef(null),Ll=React.useRef(null),Jo=Lt===0,iu=Lt+1<=Dt,xa=Rt.type,Il=Rt.dismissible!==!1,Eu=Rt.className||"",$l=Rt.descriptionClassName||"",xu=React.useMemo(()=>Bt.findIndex(lo=>lo.toastId===Rt.id)||0,[Bt,Rt.id]),Kp=React.useMemo(()=>{var lo;return(lo=Rt.closeButton)!=null?lo:_r},[Rt.closeButton,_r]),Rp=React.useMemo(()=>Rt.duration||gn||Wt,[Rt.duration,gn]),Ip=React.useRef(0),Cl=React.useRef(0),hu=React.useRef(0),_d=React.useRef(null),[Pp,ep]=_i.split("-"),tp=React.useMemo(()=>Bt.reduce((lo,Oo,jo)=>jo>=xu?lo:lo+Oo.height,0),[Bt,xu]),Bu=Ft(),Wm=Rt.invert||Et,mp=xa==="loading";Cl.current=React.useMemo(()=>xu*xr+tp,[xu,tp]),React.useEffect(()=>{Sl.current=Rp},[Rp]),React.useEffect(()=>{Nn(!0)},[]),React.useEffect(()=>{let lo=Ll.current;if(lo){let Oo=lo.getBoundingClientRect().height;return ou(Oo),Gt(jo=>[{toastId:Rt.id,height:Oo,position:Rt.position},...jo]),()=>Gt(jo=>jo.filter(Tu=>Tu.toastId!==Rt.id))}},[Gt,Rt.id]),React.useLayoutEffect(()=>{if(!ns)return;let lo=Ll.current,Oo=lo.style.height;lo.style.height="auto";let jo=lo.getBoundingClientRect().height;lo.style.height=Oo,ou(jo),Gt(Tu=>Tu.find(mn=>mn.toastId===Rt.id)?Tu.map(mn=>mn.toastId===Rt.id?{...mn,height:jo}:mn):[{toastId:Rt.id,height:jo,position:Rt.position},...Tu])},[ns,Rt.title,Rt.description,Gt,Rt.id]);let To=React.useCallback(()=>{ms(!0),wo(Cl.current),Gt(lo=>lo.filter(Oo=>Oo.toastId!==Rt.id)),setTimeout(()=>{nr(Rt)},we)},[Rt,nr,Gt,Cl]);React.useEffect(()=>{if(Rt.promise&&xa==="loading"||Rt.duration===1/0||Rt.type==="loading")return;let lo;return Zt||It||_n&&Bu?(()=>{if(hu.current<Ip.current){let Oo=new Date().getTime()-Ip.current;Sl.current=Sl.current-Oo}hu.current=new Date().getTime()})():Sl.current!==1/0&&(Ip.current=new Date().getTime(),lo=setTimeout(()=>{var Oo;(Oo=Rt.onAutoClose)==null||Oo.call(Rt,Rt),To()},Sl.current)),()=>clearTimeout(lo)},[Zt,It,Rt,xa,_n,Bu,To]),React.useEffect(()=>{Rt.delete&&To()},[To,Rt.delete]);function Kl(){var lo,Oo,jo;return Hr!=null&&Hr.loading?React.createElement("div",{className:M(cr==null?void 0:cr.loader,(lo=Rt==null?void 0:Rt.classNames)==null?void 0:lo.loader,"sonner-loader"),"data-visible":xa==="loading"},Hr.loading):gr?React.createElement("div",{className:M(cr==null?void 0:cr.loader,(Oo=Rt==null?void 0:Rt.classNames)==null?void 0:Oo.loader,"sonner-loader"),"data-visible":xa==="loading"},gr):React.createElement(Yt,{className:M(cr==null?void 0:cr.loader,(jo=Rt==null?void 0:Rt.classNames)==null?void 0:jo.loader),visible:xa==="loading"})}return React.createElement("li",{tabIndex:0,ref:Ll,className:M(Fr,Eu,cr==null?void 0:cr.toast,(i=Rt==null?void 0:Rt.classNames)==null?void 0:i.toast,cr==null?void 0:cr.default,cr==null?void 0:cr[xa],(s=Rt==null?void 0:Rt.classNames)==null?void 0:s[xa]),"data-sonner-toast":"","data-rich-colors":(a=Rt.richColors)!=null?a:ur,"data-styled":!(Rt.jsx||Rt.unstyled||Nt),"data-mounted":ns,"data-promise":!!Rt.promise,"data-swiped":Rl,"data-removed":ls,"data-visible":iu,"data-y-position":Pp,"data-x-position":ep,"data-index":Lt,"data-front":Jo,"data-swiping":Ss,"data-dismissible":Il,"data-type":xa,"data-invert":Wm,"data-swipe-out":ws,"data-swipe-direction":vs,"data-expanded":!!(Zt||rr&&ns),style:{"--index":Lt,"--toasts-before":Lt,"--z-index":Vt.length-Lt,"--offset":`${ls?Vo:Cl.current}px`,"--initial-height":rr?"auto":`${tu}px`,...Ur,...Rt.style},onDragEnd:()=>{Ks(!1),jn(null),_d.current=null},onPointerDown:lo=>{mp||!Il||(ru.current=new Date,wo(Cl.current),lo.target.setPointerCapture(lo.pointerId),lo.target.tagName!=="BUTTON"&&(Ks(!0),_d.current={x:lo.clientX,y:lo.clientY}))},onPointerUp:()=>{var lo,Oo,jo,Tu;if(ws||!Il)return;_d.current=null;let mn=Number(((lo=Ll.current)==null?void 0:lo.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),du=Number(((Oo=Ll.current)==null?void 0:Oo.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),gp=new Date().getTime()-((jo=ru.current)==null?void 0:jo.getTime()),au=fn==="x"?mn:du,Fs=Math.abs(au)/gp;if(Math.abs(au)>=ye||Fs>.11){wo(Cl.current),(Tu=Rt.onDismiss)==null||Tu.call(Rt,Rt),Cs(fn==="x"?mn>0?"right":"left":du>0?"down":"up"),To(),ps(!0),Qo(!1);return}Ks(!1),jn(null)},onPointerMove:lo=>{var Oo,jo,Tu,mn;if(!_d.current||!Il||((Oo=window.getSelection())==null?void 0:Oo.toString().length)>0)return;let du=lo.clientY-_d.current.y,gp=lo.clientX-_d.current.x,au=(jo=e.swipeDirections)!=null?jo:xe(_i);!fn&&(Math.abs(gp)>1||Math.abs(du)>1)&&jn(Math.abs(gp)>Math.abs(du)?"x":"y");let Fs={x:0,y:0};fn==="y"?(au.includes("top")||au.includes("bottom"))&&(au.includes("top")&&du<0||au.includes("bottom")&&du>0)&&(Fs.y=du):fn==="x"&&(au.includes("left")||au.includes("right"))&&(au.includes("left")&&gp<0||au.includes("right")&&gp>0)&&(Fs.x=gp),(Math.abs(Fs.x)>0||Math.abs(Fs.y)>0)&&Qo(!0),(Tu=Ll.current)==null||Tu.style.setProperty("--swipe-amount-x",`${Fs.x}px`),(mn=Ll.current)==null||mn.style.setProperty("--swipe-amount-y",`${Fs.y}px`)}},Kp&&!Rt.jsx?React.createElement("button",{"aria-label":$r,"data-disabled":mp,"data-close-button":!0,onClick:mp||!Il?()=>{}:()=>{var lo;To(),(lo=Rt.onDismiss)==null||lo.call(Rt,Rt)},className:M(cr==null?void 0:cr.closeButton,(b=Rt==null?void 0:Rt.classNames)==null?void 0:b.closeButton)},(et=Hr==null?void 0:Hr.close)!=null?et:Ot):null,Rt.jsx||reactExports.isValidElement(Rt.title)?Rt.jsx?Rt.jsx:typeof Rt.title=="function"?Rt.title():Rt.title:React.createElement(React.Fragment,null,xa||Rt.icon||Rt.promise?React.createElement("div",{"data-icon":"",className:M(cr==null?void 0:cr.icon,(nt=Rt==null?void 0:Rt.classNames)==null?void 0:nt.icon)},Rt.promise||Rt.type==="loading"&&!Rt.icon?Rt.icon||Kl():null,Rt.type!=="loading"?Rt.icon||(Hr==null?void 0:Hr[xa])||jt(xa):null):null,React.createElement("div",{"data-content":"",className:M(cr==null?void 0:cr.content,(c=Rt==null?void 0:Rt.classNames)==null?void 0:c.content)},React.createElement("div",{"data-title":"",className:M(cr==null?void 0:cr.title,(ct=Rt==null?void 0:Rt.classNames)==null?void 0:ct.title)},typeof Rt.title=="function"?Rt.title():Rt.title),Rt.description?React.createElement("div",{"data-description":"",className:M(rn,$l,cr==null?void 0:cr.description,(pt=Rt==null?void 0:Rt.classNames)==null?void 0:pt.description)},typeof Rt.description=="function"?Rt.description():Rt.description):null),reactExports.isValidElement(Rt.cancel)?Rt.cancel:Rt.cancel&&tt(Rt.cancel)?React.createElement("button",{"data-button":!0,"data-cancel":!0,style:Rt.cancelButtonStyle||ln,onClick:lo=>{var Oo,jo;tt(Rt.cancel)&&Il&&((jo=(Oo=Rt.cancel).onClick)==null||jo.call(Oo,lo),To())},className:M(cr==null?void 0:cr.cancelButton,(xt=Rt==null?void 0:Rt.classNames)==null?void 0:xt.cancelButton)},Rt.cancel.label):null,reactExports.isValidElement(Rt.action)?Rt.action:Rt.action&&tt(Rt.action)?React.createElement("button",{"data-button":!0,"data-action":!0,style:Rt.actionButtonStyle||an,onClick:lo=>{var Oo,jo;tt(Rt.action)&&((jo=(Oo=Rt.action).onClick)==null||jo.call(Oo,lo),!lo.defaultPrevented&&To())},className:M(cr==null?void 0:cr.actionButton,(St=Rt==null?void 0:Rt.classNames)==null?void 0:St.actionButton)},Rt.action.label):null))};function _t(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function Te(e,i){let s={};return[e,i].forEach((a,b)=>{let et=b===1,nt=et?"--mobile-offset":"--offset",c=et?ge:me;function ct(pt){["top","right","bottom","left"].forEach(xt=>{s[`${nt}-${xt}`]=typeof pt=="number"?`${pt}px`:pt})}typeof a=="number"||typeof a=="string"?ct(a):typeof a=="object"?["top","right","bottom","left"].forEach(pt=>{a[pt]===void 0?s[`${nt}-${pt}`]=c:s[`${nt}-${pt}`]=typeof a[pt]=="number"?`${a[pt]}px`:a[pt]}):ct(c)}),s}var $e=reactExports.forwardRef(function(e,i){let{invert:s,position:a="bottom-right",hotkey:b=["altKey","KeyT"],expand:et,closeButton:nt,className:c,offset:ct,mobileOffset:pt,theme:xt="light",richColors:St,duration:Et,style:Rt,visibleToasts:Nt=pe,toastOptions:It,dir:Gt=_t(),gap:Dt=be,loadingIcon:Bt,icons:Lt,containerAriaLabel:Vt="Notifications",pauseWhenPageIsHidden:Zt}=e,[nr,ur]=React.useState([]),_r=React.useMemo(()=>Array.from(new Set([a].concat(nr.filter(_n=>_n.position).map(_n=>_n.position)))),[nr,a]),[Ur,ln]=React.useState([]),[an,Fr]=React.useState(!1),[rn,gn]=React.useState(!1),[_i,xr]=React.useState(xt!=="system"?xt:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),gr=React.useRef(null),rr=b.join("+").replace(/Key/g,"").replace(/Digit/g,""),cr=React.useRef(null),Hr=React.useRef(!1),$r=React.useCallback(_n=>{ur(fn=>{var jn;return(jn=fn.find(vs=>vs.id===_n.id))!=null&&jn.delete||v$2.dismiss(_n.id),fn.filter(({id:vs})=>vs!==_n.id)})},[]);return React.useEffect(()=>v$2.subscribe(_n=>{if(_n.dismiss){ur(fn=>fn.map(jn=>jn.id===_n.id?{...jn,delete:!0}:jn));return}setTimeout(()=>{vt.flushSync(()=>{ur(fn=>{let jn=fn.findIndex(vs=>vs.id===_n.id);return jn!==-1?[...fn.slice(0,jn),{...fn[jn],..._n},...fn.slice(jn+1)]:[_n,...fn]})})})}),[]),React.useEffect(()=>{if(xt!=="system"){xr(xt);return}if(xt==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?xr("dark"):xr("light")),typeof window>"u")return;let _n=window.matchMedia("(prefers-color-scheme: dark)");try{_n.addEventListener("change",({matches:fn})=>{xr(fn?"dark":"light")})}catch{_n.addListener(({matches:jn})=>{try{xr(jn?"dark":"light")}catch(vs){console.error(vs)}})}},[xt]),React.useEffect(()=>{nr.length<=1&&Fr(!1)},[nr]),React.useEffect(()=>{let _n=fn=>{var jn,vs;b.every(Cs=>fn[Cs]||fn.code===Cs)&&(Fr(!0),(jn=gr.current)==null||jn.focus()),fn.code==="Escape"&&(document.activeElement===gr.current||(vs=gr.current)!=null&&vs.contains(document.activeElement))&&Fr(!1)};return document.addEventListener("keydown",_n),()=>document.removeEventListener("keydown",_n)},[b]),React.useEffect(()=>{if(gr.current)return()=>{cr.current&&(cr.current.focus({preventScroll:!0}),cr.current=null,Hr.current=!1)}},[gr.current]),React.createElement("section",{ref:i,"aria-label":`${Vt} ${rr}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},_r.map((_n,fn)=>{var jn;let[vs,Cs]=_n.split("-");return nr.length?React.createElement("ol",{key:_n,dir:Gt==="auto"?_t():Gt,tabIndex:-1,ref:gr,className:c,"data-sonner-toaster":!0,"data-theme":_i,"data-y-position":vs,"data-lifted":an&&nr.length>1&&!et,"data-x-position":Cs,style:{"--front-toast-height":`${((jn=Ur[0])==null?void 0:jn.height)||0}px`,"--width":`${he}px`,"--gap":`${Dt}px`,...Rt,...Te(ct,pt)},onBlur:ns=>{Hr.current&&!ns.currentTarget.contains(ns.relatedTarget)&&(Hr.current=!1,cr.current&&(cr.current.focus({preventScroll:!0}),cr.current=null))},onFocus:ns=>{ns.target instanceof HTMLElement&&ns.target.dataset.dismissible==="false"||Hr.current||(Hr.current=!0,cr.current=ns.relatedTarget)},onMouseEnter:()=>Fr(!0),onMouseMove:()=>Fr(!0),onMouseLeave:()=>{rn||Fr(!1)},onDragEnd:()=>Fr(!1),onPointerDown:ns=>{ns.target instanceof HTMLElement&&ns.target.dataset.dismissible==="false"||gn(!0)},onPointerUp:()=>gn(!1)},nr.filter(ns=>!ns.position&&fn===0||ns.position===_n).map((ns,Nn)=>{var ls,ms;return React.createElement(ve,{key:ns.id,icons:Lt,index:Nn,toast:ns,defaultRichColors:St,duration:(ls=It==null?void 0:It.duration)!=null?ls:Et,className:It==null?void 0:It.className,descriptionClassName:It==null?void 0:It.descriptionClassName,invert:s,visibleToasts:Nt,closeButton:(ms=It==null?void 0:It.closeButton)!=null?ms:nt,interacting:rn,position:_n,style:It==null?void 0:It.style,unstyled:It==null?void 0:It.unstyled,classNames:It==null?void 0:It.classNames,cancelButtonStyle:It==null?void 0:It.cancelButtonStyle,actionButtonStyle:It==null?void 0:It.actionButtonStyle,removeToast:$r,toasts:nr.filter(Ss=>Ss.position==ns.position),heights:Ur.filter(Ss=>Ss.position==ns.position),setHeights:ln,expandByDefault:et,gap:Dt,loadingIcon:Bt,expanded:an,pauseWhenPageIsHidden:Zt,swipeDirections:e.swipeDirections})})):null}))});const Toaster=({...e})=>{const{theme:i="system"}=j();return jsxRuntimeExports.jsx($e,{theme:i,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},position:"top-center",...e})};var useReactId=React$1[" useId ".trim().toString()]||(()=>{}),count$1=0;function useId(e){const[i,s]=reactExports.useState(useReactId());return useLayoutEffect2(()=>{s(a=>a??String(count$1++))},[e]),i?`radix-${i}`:""}const sides=["top","right","bottom","left"],min=Math.min,max=Math.max,round=Math.round,floor=Math.floor,createCoords=e=>({x:e,y:e}),oppositeSideMap={left:"right",right:"left",bottom:"top",top:"bottom"},oppositeAlignmentMap={start:"end",end:"start"};function clamp$2(e,i,s){return max(e,min(i,s))}function evaluate(e,i){return typeof e=="function"?e(i):e}function getSide(e){return e.split("-")[0]}function getAlignment(e){return e.split("-")[1]}function getOppositeAxis(e){return e==="x"?"y":"x"}function getAxisLength(e){return e==="y"?"height":"width"}const yAxisSides=new Set(["top","bottom"]);function getSideAxis(e){return yAxisSides.has(getSide(e))?"y":"x"}function getAlignmentAxis(e){return getOppositeAxis(getSideAxis(e))}function getAlignmentSides(e,i,s){s===void 0&&(s=!1);const a=getAlignment(e),b=getAlignmentAxis(e),et=getAxisLength(b);let nt=b==="x"?a===(s?"end":"start")?"right":"left":a==="start"?"bottom":"top";return i.reference[et]>i.floating[et]&&(nt=getOppositePlacement(nt)),[nt,getOppositePlacement(nt)]}function getExpandedPlacements(e){const i=getOppositePlacement(e);return[getOppositeAlignmentPlacement(e),i,getOppositeAlignmentPlacement(i)]}function getOppositeAlignmentPlacement(e){return e.replace(/start|end/g,i=>oppositeAlignmentMap[i])}const lrPlacement=["left","right"],rlPlacement=["right","left"],tbPlacement=["top","bottom"],btPlacement=["bottom","top"];function getSideList(e,i,s){switch(e){case"top":case"bottom":return s?i?rlPlacement:lrPlacement:i?lrPlacement:rlPlacement;case"left":case"right":return i?tbPlacement:btPlacement;default:return[]}}function getOppositeAxisPlacements(e,i,s,a){const b=getAlignment(e);let et=getSideList(getSide(e),s==="start",a);return b&&(et=et.map(nt=>nt+"-"+b),i&&(et=et.concat(et.map(getOppositeAlignmentPlacement)))),et}function getOppositePlacement(e){return e.replace(/left|right|bottom|top/g,i=>oppositeSideMap[i])}function expandPaddingObject(e){return{top:0,right:0,bottom:0,left:0,...e}}function getPaddingObject(e){return typeof e!="number"?expandPaddingObject(e):{top:e,right:e,bottom:e,left:e}}function rectToClientRect(e){const{x:i,y:s,width:a,height:b}=e;return{width:a,height:b,top:s,left:i,right:i+a,bottom:s+b,x:i,y:s}}function computeCoordsFromPlacement(e,i,s){let{reference:a,floating:b}=e;const et=getSideAxis(i),nt=getAlignmentAxis(i),c=getAxisLength(nt),ct=getSide(i),pt=et==="y",xt=a.x+a.width/2-b.width/2,St=a.y+a.height/2-b.height/2,Et=a[c]/2-b[c]/2;let Rt;switch(ct){case"top":Rt={x:xt,y:a.y-b.height};break;case"bottom":Rt={x:xt,y:a.y+a.height};break;case"right":Rt={x:a.x+a.width,y:St};break;case"left":Rt={x:a.x-b.width,y:St};break;default:Rt={x:a.x,y:a.y}}switch(getAlignment(i)){case"start":Rt[nt]-=Et*(s&&pt?-1:1);break;case"end":Rt[nt]+=Et*(s&&pt?-1:1);break}return Rt}const computePosition$1=async(e,i,s)=>{const{placement:a="bottom",strategy:b="absolute",middleware:et=[],platform:nt}=s,c=et.filter(Boolean),ct=await(nt.isRTL==null?void 0:nt.isRTL(i));let pt=await nt.getElementRects({reference:e,floating:i,strategy:b}),{x:xt,y:St}=computeCoordsFromPlacement(pt,a,ct),Et=a,Rt={},Nt=0;for(let It=0;It<c.length;It++){const{name:Gt,fn:Dt}=c[It],{x:Bt,y:Lt,data:Vt,reset:Zt}=await Dt({x:xt,y:St,initialPlacement:a,placement:Et,strategy:b,middlewareData:Rt,rects:pt,platform:nt,elements:{reference:e,floating:i}});xt=Bt??xt,St=Lt??St,Rt={...Rt,[Gt]:{...Rt[Gt],...Vt}},Zt&&Nt<=50&&(Nt++,typeof Zt=="object"&&(Zt.placement&&(Et=Zt.placement),Zt.rects&&(pt=Zt.rects===!0?await nt.getElementRects({reference:e,floating:i,strategy:b}):Zt.rects),{x:xt,y:St}=computeCoordsFromPlacement(pt,Et,ct)),It=-1)}return{x:xt,y:St,placement:Et,strategy:b,middlewareData:Rt}};async function detectOverflow(e,i){var s;i===void 0&&(i={});const{x:a,y:b,platform:et,rects:nt,elements:c,strategy:ct}=e,{boundary:pt="clippingAncestors",rootBoundary:xt="viewport",elementContext:St="floating",altBoundary:Et=!1,padding:Rt=0}=evaluate(i,e),Nt=getPaddingObject(Rt),Gt=c[Et?St==="floating"?"reference":"floating":St],Dt=rectToClientRect(await et.getClippingRect({element:(s=await(et.isElement==null?void 0:et.isElement(Gt)))==null||s?Gt:Gt.contextElement||await(et.getDocumentElement==null?void 0:et.getDocumentElement(c.floating)),boundary:pt,rootBoundary:xt,strategy:ct})),Bt=St==="floating"?{x:a,y:b,width:nt.floating.width,height:nt.floating.height}:nt.reference,Lt=await(et.getOffsetParent==null?void 0:et.getOffsetParent(c.floating)),Vt=await(et.isElement==null?void 0:et.isElement(Lt))?await(et.getScale==null?void 0:et.getScale(Lt))||{x:1,y:1}:{x:1,y:1},Zt=rectToClientRect(et.convertOffsetParentRelativeRectToViewportRelativeRect?await et.convertOffsetParentRelativeRectToViewportRelativeRect({elements:c,rect:Bt,offsetParent:Lt,strategy:ct}):Bt);return{top:(Dt.top-Zt.top+Nt.top)/Vt.y,bottom:(Zt.bottom-Dt.bottom+Nt.bottom)/Vt.y,left:(Dt.left-Zt.left+Nt.left)/Vt.x,right:(Zt.right-Dt.right+Nt.right)/Vt.x}}const arrow$3=e=>({name:"arrow",options:e,async fn(i){const{x:s,y:a,placement:b,rects:et,platform:nt,elements:c,middlewareData:ct}=i,{element:pt,padding:xt=0}=evaluate(e,i)||{};if(pt==null)return{};const St=getPaddingObject(xt),Et={x:s,y:a},Rt=getAlignmentAxis(b),Nt=getAxisLength(Rt),It=await nt.getDimensions(pt),Gt=Rt==="y",Dt=Gt?"top":"left",Bt=Gt?"bottom":"right",Lt=Gt?"clientHeight":"clientWidth",Vt=et.reference[Nt]+et.reference[Rt]-Et[Rt]-et.floating[Nt],Zt=Et[Rt]-et.reference[Rt],nr=await(nt.getOffsetParent==null?void 0:nt.getOffsetParent(pt));let ur=nr?nr[Lt]:0;(!ur||!await(nt.isElement==null?void 0:nt.isElement(nr)))&&(ur=c.floating[Lt]||et.floating[Nt]);const _r=Vt/2-Zt/2,Ur=ur/2-It[Nt]/2-1,ln=min(St[Dt],Ur),an=min(St[Bt],Ur),Fr=ln,rn=ur-It[Nt]-an,gn=ur/2-It[Nt]/2+_r,_i=clamp$2(Fr,gn,rn),xr=!ct.arrow&&getAlignment(b)!=null&&gn!==_i&&et.reference[Nt]/2-(gn<Fr?ln:an)-It[Nt]/2<0,gr=xr?gn<Fr?gn-Fr:gn-rn:0;return{[Rt]:Et[Rt]+gr,data:{[Rt]:_i,centerOffset:gn-_i-gr,...xr&&{alignmentOffset:gr}},reset:xr}}}),flip$2=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(i){var s,a;const{placement:b,middlewareData:et,rects:nt,initialPlacement:c,platform:ct,elements:pt}=i,{mainAxis:xt=!0,crossAxis:St=!0,fallbackPlacements:Et,fallbackStrategy:Rt="bestFit",fallbackAxisSideDirection:Nt="none",flipAlignment:It=!0,...Gt}=evaluate(e,i);if((s=et.arrow)!=null&&s.alignmentOffset)return{};const Dt=getSide(b),Bt=getSideAxis(c),Lt=getSide(c)===c,Vt=await(ct.isRTL==null?void 0:ct.isRTL(pt.floating)),Zt=Et||(Lt||!It?[getOppositePlacement(c)]:getExpandedPlacements(c)),nr=Nt!=="none";!Et&&nr&&Zt.push(...getOppositeAxisPlacements(c,It,Nt,Vt));const ur=[c,...Zt],_r=await detectOverflow(i,Gt),Ur=[];let ln=((a=et.flip)==null?void 0:a.overflows)||[];if(xt&&Ur.push(_r[Dt]),St){const gn=getAlignmentSides(b,nt,Vt);Ur.push(_r[gn[0]],_r[gn[1]])}if(ln=[...ln,{placement:b,overflows:Ur}],!Ur.every(gn=>gn<=0)){var an,Fr;const gn=(((an=et.flip)==null?void 0:an.index)||0)+1,_i=ur[gn];if(_i&&(!(St==="alignment"?Bt!==getSideAxis(_i):!1)||ln.every(rr=>rr.overflows[0]>0&&getSideAxis(rr.placement)===Bt)))return{data:{index:gn,overflows:ln},reset:{placement:_i}};let xr=(Fr=ln.filter(gr=>gr.overflows[0]<=0).sort((gr,rr)=>gr.overflows[1]-rr.overflows[1])[0])==null?void 0:Fr.placement;if(!xr)switch(Rt){case"bestFit":{var rn;const gr=(rn=ln.filter(rr=>{if(nr){const cr=getSideAxis(rr.placement);return cr===Bt||cr==="y"}return!0}).map(rr=>[rr.placement,rr.overflows.filter(cr=>cr>0).reduce((cr,Hr)=>cr+Hr,0)]).sort((rr,cr)=>rr[1]-cr[1])[0])==null?void 0:rn[0];gr&&(xr=gr);break}case"initialPlacement":xr=c;break}if(b!==xr)return{reset:{placement:xr}}}return{}}}};function getSideOffsets(e,i){return{top:e.top-i.height,right:e.right-i.width,bottom:e.bottom-i.height,left:e.left-i.width}}function isAnySideFullyClipped(e){return sides.some(i=>e[i]>=0)}const hide$2=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(i){const{rects:s}=i,{strategy:a="referenceHidden",...b}=evaluate(e,i);switch(a){case"referenceHidden":{const et=await detectOverflow(i,{...b,elementContext:"reference"}),nt=getSideOffsets(et,s.reference);return{data:{referenceHiddenOffsets:nt,referenceHidden:isAnySideFullyClipped(nt)}}}case"escaped":{const et=await detectOverflow(i,{...b,altBoundary:!0}),nt=getSideOffsets(et,s.floating);return{data:{escapedOffsets:nt,escaped:isAnySideFullyClipped(nt)}}}default:return{}}}}},originSides=new Set(["left","top"]);async function convertValueToCoords(e,i){const{placement:s,platform:a,elements:b}=e,et=await(a.isRTL==null?void 0:a.isRTL(b.floating)),nt=getSide(s),c=getAlignment(s),ct=getSideAxis(s)==="y",pt=originSides.has(nt)?-1:1,xt=et&&ct?-1:1,St=evaluate(i,e);let{mainAxis:Et,crossAxis:Rt,alignmentAxis:Nt}=typeof St=="number"?{mainAxis:St,crossAxis:0,alignmentAxis:null}:{mainAxis:St.mainAxis||0,crossAxis:St.crossAxis||0,alignmentAxis:St.alignmentAxis};return c&&typeof Nt=="number"&&(Rt=c==="end"?Nt*-1:Nt),ct?{x:Rt*xt,y:Et*pt}:{x:Et*pt,y:Rt*xt}}const offset$2=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(i){var s,a;const{x:b,y:et,placement:nt,middlewareData:c}=i,ct=await convertValueToCoords(i,e);return nt===((s=c.offset)==null?void 0:s.placement)&&(a=c.arrow)!=null&&a.alignmentOffset?{}:{x:b+ct.x,y:et+ct.y,data:{...ct,placement:nt}}}}},shift$2=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(i){const{x:s,y:a,placement:b}=i,{mainAxis:et=!0,crossAxis:nt=!1,limiter:c={fn:Gt=>{let{x:Dt,y:Bt}=Gt;return{x:Dt,y:Bt}}},...ct}=evaluate(e,i),pt={x:s,y:a},xt=await detectOverflow(i,ct),St=getSideAxis(getSide(b)),Et=getOppositeAxis(St);let Rt=pt[Et],Nt=pt[St];if(et){const Gt=Et==="y"?"top":"left",Dt=Et==="y"?"bottom":"right",Bt=Rt+xt[Gt],Lt=Rt-xt[Dt];Rt=clamp$2(Bt,Rt,Lt)}if(nt){const Gt=St==="y"?"top":"left",Dt=St==="y"?"bottom":"right",Bt=Nt+xt[Gt],Lt=Nt-xt[Dt];Nt=clamp$2(Bt,Nt,Lt)}const It=c.fn({...i,[Et]:Rt,[St]:Nt});return{...It,data:{x:It.x-s,y:It.y-a,enabled:{[Et]:et,[St]:nt}}}}}},limitShift$2=function(e){return e===void 0&&(e={}),{options:e,fn(i){const{x:s,y:a,placement:b,rects:et,middlewareData:nt}=i,{offset:c=0,mainAxis:ct=!0,crossAxis:pt=!0}=evaluate(e,i),xt={x:s,y:a},St=getSideAxis(b),Et=getOppositeAxis(St);let Rt=xt[Et],Nt=xt[St];const It=evaluate(c,i),Gt=typeof It=="number"?{mainAxis:It,crossAxis:0}:{mainAxis:0,crossAxis:0,...It};if(ct){const Lt=Et==="y"?"height":"width",Vt=et.reference[Et]-et.floating[Lt]+Gt.mainAxis,Zt=et.reference[Et]+et.reference[Lt]-Gt.mainAxis;Rt<Vt?Rt=Vt:Rt>Zt&&(Rt=Zt)}if(pt){var Dt,Bt;const Lt=Et==="y"?"width":"height",Vt=originSides.has(getSide(b)),Zt=et.reference[St]-et.floating[Lt]+(Vt&&((Dt=nt.offset)==null?void 0:Dt[St])||0)+(Vt?0:Gt.crossAxis),nr=et.reference[St]+et.reference[Lt]+(Vt?0:((Bt=nt.offset)==null?void 0:Bt[St])||0)-(Vt?Gt.crossAxis:0);Nt<Zt?Nt=Zt:Nt>nr&&(Nt=nr)}return{[Et]:Rt,[St]:Nt}}}},size$2=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(i){var s,a;const{placement:b,rects:et,platform:nt,elements:c}=i,{apply:ct=()=>{},...pt}=evaluate(e,i),xt=await detectOverflow(i,pt),St=getSide(b),Et=getAlignment(b),Rt=getSideAxis(b)==="y",{width:Nt,height:It}=et.floating;let Gt,Dt;St==="top"||St==="bottom"?(Gt=St,Dt=Et===(await(nt.isRTL==null?void 0:nt.isRTL(c.floating))?"start":"end")?"left":"right"):(Dt=St,Gt=Et==="end"?"top":"bottom");const Bt=It-xt.top-xt.bottom,Lt=Nt-xt.left-xt.right,Vt=min(It-xt[Gt],Bt),Zt=min(Nt-xt[Dt],Lt),nr=!i.middlewareData.shift;let ur=Vt,_r=Zt;if((s=i.middlewareData.shift)!=null&&s.enabled.x&&(_r=Lt),(a=i.middlewareData.shift)!=null&&a.enabled.y&&(ur=Bt),nr&&!Et){const ln=max(xt.left,0),an=max(xt.right,0),Fr=max(xt.top,0),rn=max(xt.bottom,0);Rt?_r=Nt-2*(ln!==0||an!==0?ln+an:max(xt.left,xt.right)):ur=It-2*(Fr!==0||rn!==0?Fr+rn:max(xt.top,xt.bottom))}await ct({...i,availableWidth:_r,availableHeight:ur});const Ur=await nt.getDimensions(c.floating);return Nt!==Ur.width||It!==Ur.height?{reset:{rects:!0}}:{}}}};function hasWindow(){return typeof window<"u"}function getNodeName(e){return isNode(e)?(e.nodeName||"").toLowerCase():"#document"}function getWindow(e){var i;return(e==null||(i=e.ownerDocument)==null?void 0:i.defaultView)||window}function getDocumentElement(e){var i;return(i=(isNode(e)?e.ownerDocument:e.document)||window.document)==null?void 0:i.documentElement}function isNode(e){return hasWindow()?e instanceof Node||e instanceof getWindow(e).Node:!1}function isElement(e){return hasWindow()?e instanceof Element||e instanceof getWindow(e).Element:!1}function isHTMLElement$1(e){return hasWindow()?e instanceof HTMLElement||e instanceof getWindow(e).HTMLElement:!1}function isShadowRoot(e){return!hasWindow()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof getWindow(e).ShadowRoot}const invalidOverflowDisplayValues=new Set(["inline","contents"]);function isOverflowElement(e){const{overflow:i,overflowX:s,overflowY:a,display:b}=getComputedStyle$2(e);return/auto|scroll|overlay|hidden|clip/.test(i+a+s)&&!invalidOverflowDisplayValues.has(b)}const tableElements=new Set(["table","td","th"]);function isTableElement(e){return tableElements.has(getNodeName(e))}const topLayerSelectors=[":popover-open",":modal"];function isTopLayer(e){return topLayerSelectors.some(i=>{try{return e.matches(i)}catch{return!1}})}const transformProperties=["transform","translate","scale","rotate","perspective"],willChangeValues=["transform","translate","scale","rotate","perspective","filter"],containValues=["paint","layout","strict","content"];function isContainingBlock(e){const i=isWebKit(),s=isElement(e)?getComputedStyle$2(e):e;return transformProperties.some(a=>s[a]?s[a]!=="none":!1)||(s.containerType?s.containerType!=="normal":!1)||!i&&(s.backdropFilter?s.backdropFilter!=="none":!1)||!i&&(s.filter?s.filter!=="none":!1)||willChangeValues.some(a=>(s.willChange||"").includes(a))||containValues.some(a=>(s.contain||"").includes(a))}function getContainingBlock(e){let i=getParentNode(e);for(;isHTMLElement$1(i)&&!isLastTraversableNode(i);){if(isContainingBlock(i))return i;if(isTopLayer(i))return null;i=getParentNode(i)}return null}function isWebKit(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const lastTraversableNodeNames=new Set(["html","body","#document"]);function isLastTraversableNode(e){return lastTraversableNodeNames.has(getNodeName(e))}function getComputedStyle$2(e){return getWindow(e).getComputedStyle(e)}function getNodeScroll(e){return isElement(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function getParentNode(e){if(getNodeName(e)==="html")return e;const i=e.assignedSlot||e.parentNode||isShadowRoot(e)&&e.host||getDocumentElement(e);return isShadowRoot(i)?i.host:i}function getNearestOverflowAncestor(e){const i=getParentNode(e);return isLastTraversableNode(i)?e.ownerDocument?e.ownerDocument.body:e.body:isHTMLElement$1(i)&&isOverflowElement(i)?i:getNearestOverflowAncestor(i)}function getOverflowAncestors(e,i,s){var a;i===void 0&&(i=[]),s===void 0&&(s=!0);const b=getNearestOverflowAncestor(e),et=b===((a=e.ownerDocument)==null?void 0:a.body),nt=getWindow(b);if(et){const c=getFrameElement(nt);return i.concat(nt,nt.visualViewport||[],isOverflowElement(b)?b:[],c&&s?getOverflowAncestors(c):[])}return i.concat(b,getOverflowAncestors(b,[],s))}function getFrameElement(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function getCssDimensions(e){const i=getComputedStyle$2(e);let s=parseFloat(i.width)||0,a=parseFloat(i.height)||0;const b=isHTMLElement$1(e),et=b?e.offsetWidth:s,nt=b?e.offsetHeight:a,c=round(s)!==et||round(a)!==nt;return c&&(s=et,a=nt),{width:s,height:a,$:c}}function unwrapElement(e){return isElement(e)?e:e.contextElement}function getScale(e){const i=unwrapElement(e);if(!isHTMLElement$1(i))return createCoords(1);const s=i.getBoundingClientRect(),{width:a,height:b,$:et}=getCssDimensions(i);let nt=(et?round(s.width):s.width)/a,c=(et?round(s.height):s.height)/b;return(!nt||!Number.isFinite(nt))&&(nt=1),(!c||!Number.isFinite(c))&&(c=1),{x:nt,y:c}}const noOffsets=createCoords(0);function getVisualOffsets(e){const i=getWindow(e);return!isWebKit()||!i.visualViewport?noOffsets:{x:i.visualViewport.offsetLeft,y:i.visualViewport.offsetTop}}function shouldAddVisualOffsets(e,i,s){return i===void 0&&(i=!1),!s||i&&s!==getWindow(e)?!1:i}function getBoundingClientRect(e,i,s,a){i===void 0&&(i=!1),s===void 0&&(s=!1);const b=e.getBoundingClientRect(),et=unwrapElement(e);let nt=createCoords(1);i&&(a?isElement(a)&&(nt=getScale(a)):nt=getScale(e));const c=shouldAddVisualOffsets(et,s,a)?getVisualOffsets(et):createCoords(0);let ct=(b.left+c.x)/nt.x,pt=(b.top+c.y)/nt.y,xt=b.width/nt.x,St=b.height/nt.y;if(et){const Et=getWindow(et),Rt=a&&isElement(a)?getWindow(a):a;let Nt=Et,It=getFrameElement(Nt);for(;It&&a&&Rt!==Nt;){const Gt=getScale(It),Dt=It.getBoundingClientRect(),Bt=getComputedStyle$2(It),Lt=Dt.left+(It.clientLeft+parseFloat(Bt.paddingLeft))*Gt.x,Vt=Dt.top+(It.clientTop+parseFloat(Bt.paddingTop))*Gt.y;ct*=Gt.x,pt*=Gt.y,xt*=Gt.x,St*=Gt.y,ct+=Lt,pt+=Vt,Nt=getWindow(It),It=getFrameElement(Nt)}}return rectToClientRect({width:xt,height:St,x:ct,y:pt})}function getWindowScrollBarX(e,i){const s=getNodeScroll(e).scrollLeft;return i?i.left+s:getBoundingClientRect(getDocumentElement(e)).left+s}function getHTMLOffset(e,i,s){s===void 0&&(s=!1);const a=e.getBoundingClientRect(),b=a.left+i.scrollLeft-(s?0:getWindowScrollBarX(e,a)),et=a.top+i.scrollTop;return{x:b,y:et}}function convertOffsetParentRelativeRectToViewportRelativeRect(e){let{elements:i,rect:s,offsetParent:a,strategy:b}=e;const et=b==="fixed",nt=getDocumentElement(a),c=i?isTopLayer(i.floating):!1;if(a===nt||c&&et)return s;let ct={scrollLeft:0,scrollTop:0},pt=createCoords(1);const xt=createCoords(0),St=isHTMLElement$1(a);if((St||!St&&!et)&&((getNodeName(a)!=="body"||isOverflowElement(nt))&&(ct=getNodeScroll(a)),isHTMLElement$1(a))){const Rt=getBoundingClientRect(a);pt=getScale(a),xt.x=Rt.x+a.clientLeft,xt.y=Rt.y+a.clientTop}const Et=nt&&!St&&!et?getHTMLOffset(nt,ct,!0):createCoords(0);return{width:s.width*pt.x,height:s.height*pt.y,x:s.x*pt.x-ct.scrollLeft*pt.x+xt.x+Et.x,y:s.y*pt.y-ct.scrollTop*pt.y+xt.y+Et.y}}function getClientRects(e){return Array.from(e.getClientRects())}function getDocumentRect(e){const i=getDocumentElement(e),s=getNodeScroll(e),a=e.ownerDocument.body,b=max(i.scrollWidth,i.clientWidth,a.scrollWidth,a.clientWidth),et=max(i.scrollHeight,i.clientHeight,a.scrollHeight,a.clientHeight);let nt=-s.scrollLeft+getWindowScrollBarX(e);const c=-s.scrollTop;return getComputedStyle$2(a).direction==="rtl"&&(nt+=max(i.clientWidth,a.clientWidth)-b),{width:b,height:et,x:nt,y:c}}function getViewportRect(e,i){const s=getWindow(e),a=getDocumentElement(e),b=s.visualViewport;let et=a.clientWidth,nt=a.clientHeight,c=0,ct=0;if(b){et=b.width,nt=b.height;const pt=isWebKit();(!pt||pt&&i==="fixed")&&(c=b.offsetLeft,ct=b.offsetTop)}return{width:et,height:nt,x:c,y:ct}}const absoluteOrFixed=new Set(["absolute","fixed"]);function getInnerBoundingClientRect(e,i){const s=getBoundingClientRect(e,!0,i==="fixed"),a=s.top+e.clientTop,b=s.left+e.clientLeft,et=isHTMLElement$1(e)?getScale(e):createCoords(1),nt=e.clientWidth*et.x,c=e.clientHeight*et.y,ct=b*et.x,pt=a*et.y;return{width:nt,height:c,x:ct,y:pt}}function getClientRectFromClippingAncestor(e,i,s){let a;if(i==="viewport")a=getViewportRect(e,s);else if(i==="document")a=getDocumentRect(getDocumentElement(e));else if(isElement(i))a=getInnerBoundingClientRect(i,s);else{const b=getVisualOffsets(e);a={x:i.x-b.x,y:i.y-b.y,width:i.width,height:i.height}}return rectToClientRect(a)}function hasFixedPositionAncestor(e,i){const s=getParentNode(e);return s===i||!isElement(s)||isLastTraversableNode(s)?!1:getComputedStyle$2(s).position==="fixed"||hasFixedPositionAncestor(s,i)}function getClippingElementAncestors(e,i){const s=i.get(e);if(s)return s;let a=getOverflowAncestors(e,[],!1).filter(c=>isElement(c)&&getNodeName(c)!=="body"),b=null;const et=getComputedStyle$2(e).position==="fixed";let nt=et?getParentNode(e):e;for(;isElement(nt)&&!isLastTraversableNode(nt);){const c=getComputedStyle$2(nt),ct=isContainingBlock(nt);!ct&&c.position==="fixed"&&(b=null),(et?!ct&&!b:!ct&&c.position==="static"&&!!b&&absoluteOrFixed.has(b.position)||isOverflowElement(nt)&&!ct&&hasFixedPositionAncestor(e,nt))?a=a.filter(xt=>xt!==nt):b=c,nt=getParentNode(nt)}return i.set(e,a),a}function getClippingRect(e){let{element:i,boundary:s,rootBoundary:a,strategy:b}=e;const nt=[...s==="clippingAncestors"?isTopLayer(i)?[]:getClippingElementAncestors(i,this._c):[].concat(s),a],c=nt[0],ct=nt.reduce((pt,xt)=>{const St=getClientRectFromClippingAncestor(i,xt,b);return pt.top=max(St.top,pt.top),pt.right=min(St.right,pt.right),pt.bottom=min(St.bottom,pt.bottom),pt.left=max(St.left,pt.left),pt},getClientRectFromClippingAncestor(i,c,b));return{width:ct.right-ct.left,height:ct.bottom-ct.top,x:ct.left,y:ct.top}}function getDimensions(e){const{width:i,height:s}=getCssDimensions(e);return{width:i,height:s}}function getRectRelativeToOffsetParent(e,i,s){const a=isHTMLElement$1(i),b=getDocumentElement(i),et=s==="fixed",nt=getBoundingClientRect(e,!0,et,i);let c={scrollLeft:0,scrollTop:0};const ct=createCoords(0);function pt(){ct.x=getWindowScrollBarX(b)}if(a||!a&&!et)if((getNodeName(i)!=="body"||isOverflowElement(b))&&(c=getNodeScroll(i)),a){const Rt=getBoundingClientRect(i,!0,et,i);ct.x=Rt.x+i.clientLeft,ct.y=Rt.y+i.clientTop}else b&&pt();et&&!a&&b&&pt();const xt=b&&!a&&!et?getHTMLOffset(b,c):createCoords(0),St=nt.left+c.scrollLeft-ct.x-xt.x,Et=nt.top+c.scrollTop-ct.y-xt.y;return{x:St,y:Et,width:nt.width,height:nt.height}}function isStaticPositioned(e){return getComputedStyle$2(e).position==="static"}function getTrueOffsetParent(e,i){if(!isHTMLElement$1(e)||getComputedStyle$2(e).position==="fixed")return null;if(i)return i(e);let s=e.offsetParent;return getDocumentElement(e)===s&&(s=s.ownerDocument.body),s}function getOffsetParent(e,i){const s=getWindow(e);if(isTopLayer(e))return s;if(!isHTMLElement$1(e)){let b=getParentNode(e);for(;b&&!isLastTraversableNode(b);){if(isElement(b)&&!isStaticPositioned(b))return b;b=getParentNode(b)}return s}let a=getTrueOffsetParent(e,i);for(;a&&isTableElement(a)&&isStaticPositioned(a);)a=getTrueOffsetParent(a,i);return a&&isLastTraversableNode(a)&&isStaticPositioned(a)&&!isContainingBlock(a)?s:a||getContainingBlock(e)||s}const getElementRects=async function(e){const i=this.getOffsetParent||getOffsetParent,s=this.getDimensions,a=await s(e.floating);return{reference:getRectRelativeToOffsetParent(e.reference,await i(e.floating),e.strategy),floating:{x:0,y:0,width:a.width,height:a.height}}};function isRTL(e){return getComputedStyle$2(e).direction==="rtl"}const platform={convertOffsetParentRelativeRectToViewportRelativeRect,getDocumentElement,getClippingRect,getOffsetParent,getElementRects,getClientRects,getDimensions,getScale,isElement,isRTL};function rectsAreEqual(e,i){return e.x===i.x&&e.y===i.y&&e.width===i.width&&e.height===i.height}function observeMove(e,i){let s=null,a;const b=getDocumentElement(e);function et(){var c;clearTimeout(a),(c=s)==null||c.disconnect(),s=null}function nt(c,ct){c===void 0&&(c=!1),ct===void 0&&(ct=1),et();const pt=e.getBoundingClientRect(),{left:xt,top:St,width:Et,height:Rt}=pt;if(c||i(),!Et||!Rt)return;const Nt=floor(St),It=floor(b.clientWidth-(xt+Et)),Gt=floor(b.clientHeight-(St+Rt)),Dt=floor(xt),Lt={rootMargin:-Nt+"px "+-It+"px "+-Gt+"px "+-Dt+"px",threshold:max(0,min(1,ct))||1};let Vt=!0;function Zt(nr){const ur=nr[0].intersectionRatio;if(ur!==ct){if(!Vt)return nt();ur?nt(!1,ur):a=setTimeout(()=>{nt(!1,1e-7)},1e3)}ur===1&&!rectsAreEqual(pt,e.getBoundingClientRect())&&nt(),Vt=!1}try{s=new IntersectionObserver(Zt,{...Lt,root:b.ownerDocument})}catch{s=new IntersectionObserver(Zt,Lt)}s.observe(e)}return nt(!0),et}function autoUpdate(e,i,s,a){a===void 0&&(a={});const{ancestorScroll:b=!0,ancestorResize:et=!0,elementResize:nt=typeof ResizeObserver=="function",layoutShift:c=typeof IntersectionObserver=="function",animationFrame:ct=!1}=a,pt=unwrapElement(e),xt=b||et?[...pt?getOverflowAncestors(pt):[],...getOverflowAncestors(i)]:[];xt.forEach(Dt=>{b&&Dt.addEventListener("scroll",s,{passive:!0}),et&&Dt.addEventListener("resize",s)});const St=pt&&c?observeMove(pt,s):null;let Et=-1,Rt=null;nt&&(Rt=new ResizeObserver(Dt=>{let[Bt]=Dt;Bt&&Bt.target===pt&&Rt&&(Rt.unobserve(i),cancelAnimationFrame(Et),Et=requestAnimationFrame(()=>{var Lt;(Lt=Rt)==null||Lt.observe(i)})),s()}),pt&&!ct&&Rt.observe(pt),Rt.observe(i));let Nt,It=ct?getBoundingClientRect(e):null;ct&&Gt();function Gt(){const Dt=getBoundingClientRect(e);It&&!rectsAreEqual(It,Dt)&&s(),It=Dt,Nt=requestAnimationFrame(Gt)}return s(),()=>{var Dt;xt.forEach(Bt=>{b&&Bt.removeEventListener("scroll",s),et&&Bt.removeEventListener("resize",s)}),St==null||St(),(Dt=Rt)==null||Dt.disconnect(),Rt=null,ct&&cancelAnimationFrame(Nt)}}const offset$1=offset$2,shift$1=shift$2,flip$1=flip$2,size$1=size$2,hide$1=hide$2,arrow$2=arrow$3,limitShift$1=limitShift$2,computePosition=(e,i,s)=>{const a=new Map,b={platform,...s},et={...b.platform,_c:a};return computePosition$1(e,i,{...b,platform:et})};var isClient=typeof document<"u",noop$3=function(){},index=isClient?reactExports.useLayoutEffect:noop$3;function deepEqual$1(e,i){if(e===i)return!0;if(typeof e!=typeof i)return!1;if(typeof e=="function"&&e.toString()===i.toString())return!0;let s,a,b;if(e&&i&&typeof e=="object"){if(Array.isArray(e)){if(s=e.length,s!==i.length)return!1;for(a=s;a--!==0;)if(!deepEqual$1(e[a],i[a]))return!1;return!0}if(b=Object.keys(e),s=b.length,s!==Object.keys(i).length)return!1;for(a=s;a--!==0;)if(!{}.hasOwnProperty.call(i,b[a]))return!1;for(a=s;a--!==0;){const et=b[a];if(!(et==="_owner"&&e.$$typeof)&&!deepEqual$1(e[et],i[et]))return!1}return!0}return e!==e&&i!==i}function getDPR(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function roundByDPR(e,i){const s=getDPR(e);return Math.round(i*s)/s}function useLatestRef(e){const i=reactExports.useRef(e);return index(()=>{i.current=e}),i}function useFloating(e){e===void 0&&(e={});const{placement:i="bottom",strategy:s="absolute",middleware:a=[],platform:b,elements:{reference:et,floating:nt}={},transform:c=!0,whileElementsMounted:ct,open:pt}=e,[xt,St]=reactExports.useState({x:0,y:0,strategy:s,placement:i,middlewareData:{},isPositioned:!1}),[Et,Rt]=reactExports.useState(a);deepEqual$1(Et,a)||Rt(a);const[Nt,It]=reactExports.useState(null),[Gt,Dt]=reactExports.useState(null),Bt=reactExports.useCallback(rr=>{rr!==nr.current&&(nr.current=rr,It(rr))},[]),Lt=reactExports.useCallback(rr=>{rr!==ur.current&&(ur.current=rr,Dt(rr))},[]),Vt=et||Nt,Zt=nt||Gt,nr=reactExports.useRef(null),ur=reactExports.useRef(null),_r=reactExports.useRef(xt),Ur=ct!=null,ln=useLatestRef(ct),an=useLatestRef(b),Fr=useLatestRef(pt),rn=reactExports.useCallback(()=>{if(!nr.current||!ur.current)return;const rr={placement:i,strategy:s,middleware:Et};an.current&&(rr.platform=an.current),computePosition(nr.current,ur.current,rr).then(cr=>{const Hr={...cr,isPositioned:Fr.current!==!1};gn.current&&!deepEqual$1(_r.current,Hr)&&(_r.current=Hr,reactDomExports.flushSync(()=>{St(Hr)}))})},[Et,i,s,an,Fr]);index(()=>{pt===!1&&_r.current.isPositioned&&(_r.current.isPositioned=!1,St(rr=>({...rr,isPositioned:!1})))},[pt]);const gn=reactExports.useRef(!1);index(()=>(gn.current=!0,()=>{gn.current=!1}),[]),index(()=>{if(Vt&&(nr.current=Vt),Zt&&(ur.current=Zt),Vt&&Zt){if(ln.current)return ln.current(Vt,Zt,rn);rn()}},[Vt,Zt,rn,ln,Ur]);const _i=reactExports.useMemo(()=>({reference:nr,floating:ur,setReference:Bt,setFloating:Lt}),[Bt,Lt]),xr=reactExports.useMemo(()=>({reference:Vt,floating:Zt}),[Vt,Zt]),gr=reactExports.useMemo(()=>{const rr={position:s,left:0,top:0};if(!xr.floating)return rr;const cr=roundByDPR(xr.floating,xt.x),Hr=roundByDPR(xr.floating,xt.y);return c?{...rr,transform:"translate("+cr+"px, "+Hr+"px)",...getDPR(xr.floating)>=1.5&&{willChange:"transform"}}:{position:s,left:cr,top:Hr}},[s,c,xr.floating,xt.x,xt.y]);return reactExports.useMemo(()=>({...xt,update:rn,refs:_i,elements:xr,floatingStyles:gr}),[xt,rn,_i,xr,gr])}const arrow$1=e=>{function i(s){return{}.hasOwnProperty.call(s,"current")}return{name:"arrow",options:e,fn(s){const{element:a,padding:b}=typeof e=="function"?e(s):e;return a&&i(a)?a.current!=null?arrow$2({element:a.current,padding:b}).fn(s):{}:a?arrow$2({element:a,padding:b}).fn(s):{}}}},offset=(e,i)=>({...offset$1(e),options:[e,i]}),shift=(e,i)=>({...shift$1(e),options:[e,i]}),limitShift=(e,i)=>({...limitShift$1(e),options:[e,i]}),flip=(e,i)=>({...flip$1(e),options:[e,i]}),size=(e,i)=>({...size$1(e),options:[e,i]}),hide=(e,i)=>({...hide$1(e),options:[e,i]}),arrow=(e,i)=>({...arrow$1(e),options:[e,i]});var NAME$1="Arrow",Arrow$1=reactExports.forwardRef((e,i)=>{const{children:s,width:a=10,height:b=5,...et}=e;return jsxRuntimeExports.jsx(Primitive.svg,{...et,ref:i,width:a,height:b,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?s:jsxRuntimeExports.jsx("polygon",{points:"0,0 30,0 15,10"})})});Arrow$1.displayName=NAME$1;var Root$4=Arrow$1;function useSize(e){const[i,s]=reactExports.useState(void 0);return useLayoutEffect2(()=>{if(e){s({width:e.offsetWidth,height:e.offsetHeight});const a=new ResizeObserver(b=>{if(!Array.isArray(b)||!b.length)return;const et=b[0];let nt,c;if("borderBoxSize"in et){const ct=et.borderBoxSize,pt=Array.isArray(ct)?ct[0]:ct;nt=pt.inlineSize,c=pt.blockSize}else nt=e.offsetWidth,c=e.offsetHeight;s({width:nt,height:c})});return a.observe(e,{box:"border-box"}),()=>a.unobserve(e)}else s(void 0)},[e]),i}var POPPER_NAME="Popper",[createPopperContext,createPopperScope]=createContextScope(POPPER_NAME),[PopperProvider,usePopperContext]=createPopperContext(POPPER_NAME),Popper=e=>{const{__scopePopper:i,children:s}=e,[a,b]=reactExports.useState(null);return jsxRuntimeExports.jsx(PopperProvider,{scope:i,anchor:a,onAnchorChange:b,children:s})};Popper.displayName=POPPER_NAME;var ANCHOR_NAME="PopperAnchor",PopperAnchor=reactExports.forwardRef((e,i)=>{const{__scopePopper:s,virtualRef:a,...b}=e,et=usePopperContext(ANCHOR_NAME,s),nt=reactExports.useRef(null),c=useComposedRefs$1(i,nt);return reactExports.useEffect(()=>{et.onAnchorChange((a==null?void 0:a.current)||nt.current)}),a?null:jsxRuntimeExports.jsx(Primitive.div,{...b,ref:c})});PopperAnchor.displayName=ANCHOR_NAME;var CONTENT_NAME$6="PopperContent",[PopperContentProvider,useContentContext]=createPopperContext(CONTENT_NAME$6),PopperContent=reactExports.forwardRef((e,i)=>{var ns,Nn,ls,ms,Ss,Ks;const{__scopePopper:s,side:a="bottom",sideOffset:b=0,align:et="center",alignOffset:nt=0,arrowPadding:c=0,avoidCollisions:ct=!0,collisionBoundary:pt=[],collisionPadding:xt=0,sticky:St="partial",hideWhenDetached:Et=!1,updatePositionStrategy:Rt="optimized",onPlaced:Nt,...It}=e,Gt=usePopperContext(CONTENT_NAME$6,s),[Dt,Bt]=reactExports.useState(null),Lt=useComposedRefs$1(i,ws=>Bt(ws)),[Vt,Zt]=reactExports.useState(null),nr=useSize(Vt),ur=(nr==null?void 0:nr.width)??0,_r=(nr==null?void 0:nr.height)??0,Ur=a+(et!=="center"?"-"+et:""),ln=typeof xt=="number"?xt:{top:0,right:0,bottom:0,left:0,...xt},an=Array.isArray(pt)?pt:[pt],Fr=an.length>0,rn={padding:ln,boundary:an.filter(isNotNull$2),altBoundary:Fr},{refs:gn,floatingStyles:_i,placement:xr,isPositioned:gr,middlewareData:rr}=useFloating({strategy:"fixed",placement:Ur,whileElementsMounted:(...ws)=>autoUpdate(...ws,{animationFrame:Rt==="always"}),elements:{reference:Gt.anchor},middleware:[offset({mainAxis:b+_r,alignmentAxis:nt}),ct&&shift({mainAxis:!0,crossAxis:!1,limiter:St==="partial"?limitShift():void 0,...rn}),ct&&flip({...rn}),size({...rn,apply:({elements:ws,rects:ps,availableWidth:Rl,availableHeight:Qo})=>{const{width:Vo,height:wo}=ps.reference,tu=ws.floating.style;tu.setProperty("--radix-popper-available-width",`${Rl}px`),tu.setProperty("--radix-popper-available-height",`${Qo}px`),tu.setProperty("--radix-popper-anchor-width",`${Vo}px`),tu.setProperty("--radix-popper-anchor-height",`${wo}px`)}}),Vt&&arrow({element:Vt,padding:c}),transformOrigin({arrowWidth:ur,arrowHeight:_r}),Et&&hide({strategy:"referenceHidden",...rn})]}),[cr,Hr]=getSideAndAlignFromPlacement(xr),$r=useCallbackRef$1(Nt);useLayoutEffect2(()=>{gr&&($r==null||$r())},[gr,$r]);const _n=(ns=rr.arrow)==null?void 0:ns.x,fn=(Nn=rr.arrow)==null?void 0:Nn.y,jn=((ls=rr.arrow)==null?void 0:ls.centerOffset)!==0,[vs,Cs]=reactExports.useState();return useLayoutEffect2(()=>{Dt&&Cs(window.getComputedStyle(Dt).zIndex)},[Dt]),jsxRuntimeExports.jsx("div",{ref:gn.setFloating,"data-radix-popper-content-wrapper":"",style:{..._i,transform:gr?_i.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:vs,"--radix-popper-transform-origin":[(ms=rr.transformOrigin)==null?void 0:ms.x,(Ss=rr.transformOrigin)==null?void 0:Ss.y].join(" "),...((Ks=rr.hide)==null?void 0:Ks.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:jsxRuntimeExports.jsx(PopperContentProvider,{scope:s,placedSide:cr,onArrowChange:Zt,arrowX:_n,arrowY:fn,shouldHideArrow:jn,children:jsxRuntimeExports.jsx(Primitive.div,{"data-side":cr,"data-align":Hr,...It,ref:Lt,style:{...It.style,animation:gr?void 0:"none"}})})})});PopperContent.displayName=CONTENT_NAME$6;var ARROW_NAME$2="PopperArrow",OPPOSITE_SIDE={top:"bottom",right:"left",bottom:"top",left:"right"},PopperArrow=reactExports.forwardRef(function(i,s){const{__scopePopper:a,...b}=i,et=useContentContext(ARROW_NAME$2,a),nt=OPPOSITE_SIDE[et.placedSide];return jsxRuntimeExports.jsx("span",{ref:et.onArrowChange,style:{position:"absolute",left:et.arrowX,top:et.arrowY,[nt]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[et.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[et.placedSide],visibility:et.shouldHideArrow?"hidden":void 0},children:jsxRuntimeExports.jsx(Root$4,{...b,ref:s,style:{...b.style,display:"block"}})})});PopperArrow.displayName=ARROW_NAME$2;function isNotNull$2(e){return e!==null}var transformOrigin=e=>({name:"transformOrigin",options:e,fn(i){var Gt,Dt,Bt;const{placement:s,rects:a,middlewareData:b}=i,nt=((Gt=b.arrow)==null?void 0:Gt.centerOffset)!==0,c=nt?0:e.arrowWidth,ct=nt?0:e.arrowHeight,[pt,xt]=getSideAndAlignFromPlacement(s),St={start:"0%",center:"50%",end:"100%"}[xt],Et=(((Dt=b.arrow)==null?void 0:Dt.x)??0)+c/2,Rt=(((Bt=b.arrow)==null?void 0:Bt.y)??0)+ct/2;let Nt="",It="";return pt==="bottom"?(Nt=nt?St:`${Et}px`,It=`${-ct}px`):pt==="top"?(Nt=nt?St:`${Et}px`,It=`${a.floating.height+ct}px`):pt==="right"?(Nt=`${-ct}px`,It=nt?St:`${Rt}px`):pt==="left"&&(Nt=`${a.floating.width+ct}px`,It=nt?St:`${Rt}px`),{data:{x:Nt,y:It}}}});function getSideAndAlignFromPlacement(e){const[i,s="center"]=e.split("-");return[i,s]}var Root2$3=Popper,Anchor=PopperAnchor,Content$2=PopperContent,Arrow=PopperArrow,[createTooltipContext,createTooltipScope]=createContextScope("Tooltip",[createPopperScope]),usePopperScope$1=createPopperScope(),PROVIDER_NAME="TooltipProvider",DEFAULT_DELAY_DURATION=700,TOOLTIP_OPEN="tooltip.open",[TooltipProviderContextProvider,useTooltipProviderContext]=createTooltipContext(PROVIDER_NAME),TooltipProvider$1=e=>{const{__scopeTooltip:i,delayDuration:s=DEFAULT_DELAY_DURATION,skipDelayDuration:a=300,disableHoverableContent:b=!1,children:et}=e,nt=reactExports.useRef(!0),c=reactExports.useRef(!1),ct=reactExports.useRef(0);return reactExports.useEffect(()=>{const pt=ct.current;return()=>window.clearTimeout(pt)},[]),jsxRuntimeExports.jsx(TooltipProviderContextProvider,{scope:i,isOpenDelayedRef:nt,delayDuration:s,onOpen:reactExports.useCallback(()=>{window.clearTimeout(ct.current),nt.current=!1},[]),onClose:reactExports.useCallback(()=>{window.clearTimeout(ct.current),ct.current=window.setTimeout(()=>nt.current=!0,a)},[a]),isPointerInTransitRef:c,onPointerInTransitChange:reactExports.useCallback(pt=>{c.current=pt},[]),disableHoverableContent:b,children:et})};TooltipProvider$1.displayName=PROVIDER_NAME;var TOOLTIP_NAME="Tooltip",[TooltipContextProvider,useTooltipContext]=createTooltipContext(TOOLTIP_NAME),TRIGGER_NAME$5="TooltipTrigger",TooltipTrigger=reactExports.forwardRef((e,i)=>{const{__scopeTooltip:s,...a}=e,b=useTooltipContext(TRIGGER_NAME$5,s),et=useTooltipProviderContext(TRIGGER_NAME$5,s),nt=usePopperScope$1(s),c=reactExports.useRef(null),ct=useComposedRefs$1(i,c,b.onTriggerChange),pt=reactExports.useRef(!1),xt=reactExports.useRef(!1),St=reactExports.useCallback(()=>pt.current=!1,[]);return reactExports.useEffect(()=>()=>document.removeEventListener("pointerup",St),[St]),jsxRuntimeExports.jsx(Anchor,{asChild:!0,...nt,children:jsxRuntimeExports.jsx(Primitive.button,{"aria-describedby":b.open?b.contentId:void 0,"data-state":b.stateAttribute,...a,ref:ct,onPointerMove:composeEventHandlers(e.onPointerMove,Et=>{Et.pointerType!=="touch"&&!xt.current&&!et.isPointerInTransitRef.current&&(b.onTriggerEnter(),xt.current=!0)}),onPointerLeave:composeEventHandlers(e.onPointerLeave,()=>{b.onTriggerLeave(),xt.current=!1}),onPointerDown:composeEventHandlers(e.onPointerDown,()=>{b.open&&b.onClose(),pt.current=!0,document.addEventListener("pointerup",St,{once:!0})}),onFocus:composeEventHandlers(e.onFocus,()=>{pt.current||b.onOpen()}),onBlur:composeEventHandlers(e.onBlur,b.onClose),onClick:composeEventHandlers(e.onClick,b.onClose)})})});TooltipTrigger.displayName=TRIGGER_NAME$5;var PORTAL_NAME$3="TooltipPortal",[PortalProvider$1,usePortalContext$1]=createTooltipContext(PORTAL_NAME$3,{forceMount:void 0}),CONTENT_NAME$5="TooltipContent",TooltipContent$1=reactExports.forwardRef((e,i)=>{const s=usePortalContext$1(CONTENT_NAME$5,e.__scopeTooltip),{forceMount:a=s.forceMount,side:b="top",...et}=e,nt=useTooltipContext(CONTENT_NAME$5,e.__scopeTooltip);return jsxRuntimeExports.jsx(Presence,{present:a||nt.open,children:nt.disableHoverableContent?jsxRuntimeExports.jsx(TooltipContentImpl,{side:b,...et,ref:i}):jsxRuntimeExports.jsx(TooltipContentHoverable,{side:b,...et,ref:i})})}),TooltipContentHoverable=reactExports.forwardRef((e,i)=>{const s=useTooltipContext(CONTENT_NAME$5,e.__scopeTooltip),a=useTooltipProviderContext(CONTENT_NAME$5,e.__scopeTooltip),b=reactExports.useRef(null),et=useComposedRefs$1(i,b),[nt,c]=reactExports.useState(null),{trigger:ct,onClose:pt}=s,xt=b.current,{onPointerInTransitChange:St}=a,Et=reactExports.useCallback(()=>{c(null),St(!1)},[St]),Rt=reactExports.useCallback((Nt,It)=>{const Gt=Nt.currentTarget,Dt={x:Nt.clientX,y:Nt.clientY},Bt=getExitSideFromRect(Dt,Gt.getBoundingClientRect()),Lt=getPaddedExitPoints(Dt,Bt),Vt=getPointsFromRect(It.getBoundingClientRect()),Zt=getHull([...Lt,...Vt]);c(Zt),St(!0)},[St]);return reactExports.useEffect(()=>()=>Et(),[Et]),reactExports.useEffect(()=>{if(ct&&xt){const Nt=Gt=>Rt(Gt,xt),It=Gt=>Rt(Gt,ct);return ct.addEventListener("pointerleave",Nt),xt.addEventListener("pointerleave",It),()=>{ct.removeEventListener("pointerleave",Nt),xt.removeEventListener("pointerleave",It)}}},[ct,xt,Rt,Et]),reactExports.useEffect(()=>{if(nt){const Nt=It=>{const Gt=It.target,Dt={x:It.clientX,y:It.clientY},Bt=(ct==null?void 0:ct.contains(Gt))||(xt==null?void 0:xt.contains(Gt)),Lt=!isPointInPolygon$1(Dt,nt);Bt?Et():Lt&&(Et(),pt())};return document.addEventListener("pointermove",Nt),()=>document.removeEventListener("pointermove",Nt)}},[ct,xt,nt,pt,Et]),jsxRuntimeExports.jsx(TooltipContentImpl,{...e,ref:et})}),[VisuallyHiddenContentContextProvider,useVisuallyHiddenContentContext]=createTooltipContext(TOOLTIP_NAME,{isInside:!1}),Slottable$1=createSlottable("TooltipContent"),TooltipContentImpl=reactExports.forwardRef((e,i)=>{const{__scopeTooltip:s,children:a,"aria-label":b,onEscapeKeyDown:et,onPointerDownOutside:nt,...c}=e,ct=useTooltipContext(CONTENT_NAME$5,s),pt=usePopperScope$1(s),{onClose:xt}=ct;return reactExports.useEffect(()=>(document.addEventListener(TOOLTIP_OPEN,xt),()=>document.removeEventListener(TOOLTIP_OPEN,xt)),[xt]),reactExports.useEffect(()=>{if(ct.trigger){const St=Et=>{const Rt=Et.target;Rt!=null&&Rt.contains(ct.trigger)&&xt()};return window.addEventListener("scroll",St,{capture:!0}),()=>window.removeEventListener("scroll",St,{capture:!0})}},[ct.trigger,xt]),jsxRuntimeExports.jsx(DismissableLayer,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:et,onPointerDownOutside:nt,onFocusOutside:St=>St.preventDefault(),onDismiss:xt,children:jsxRuntimeExports.jsxs(Content$2,{"data-state":ct.stateAttribute,...pt,...c,ref:i,style:{...c.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[jsxRuntimeExports.jsx(Slottable$1,{children:a}),jsxRuntimeExports.jsx(VisuallyHiddenContentContextProvider,{scope:s,isInside:!0,children:jsxRuntimeExports.jsx(Root$5,{id:ct.contentId,role:"tooltip",children:b||a})})]})})});TooltipContent$1.displayName=CONTENT_NAME$5;var ARROW_NAME$1="TooltipArrow",TooltipArrow=reactExports.forwardRef((e,i)=>{const{__scopeTooltip:s,...a}=e,b=usePopperScope$1(s);return useVisuallyHiddenContentContext(ARROW_NAME$1,s).isInside?null:jsxRuntimeExports.jsx(Arrow,{...b,...a,ref:i})});TooltipArrow.displayName=ARROW_NAME$1;function getExitSideFromRect(e,i){const s=Math.abs(i.top-e.y),a=Math.abs(i.bottom-e.y),b=Math.abs(i.right-e.x),et=Math.abs(i.left-e.x);switch(Math.min(s,a,b,et)){case et:return"left";case b:return"right";case s:return"top";case a:return"bottom";default:throw new Error("unreachable")}}function getPaddedExitPoints(e,i,s=5){const a=[];switch(i){case"top":a.push({x:e.x-s,y:e.y+s},{x:e.x+s,y:e.y+s});break;case"bottom":a.push({x:e.x-s,y:e.y-s},{x:e.x+s,y:e.y-s});break;case"left":a.push({x:e.x+s,y:e.y-s},{x:e.x+s,y:e.y+s});break;case"right":a.push({x:e.x-s,y:e.y-s},{x:e.x-s,y:e.y+s});break}return a}function getPointsFromRect(e){const{top:i,right:s,bottom:a,left:b}=e;return[{x:b,y:i},{x:s,y:i},{x:s,y:a},{x:b,y:a}]}function isPointInPolygon$1(e,i){const{x:s,y:a}=e;let b=!1;for(let et=0,nt=i.length-1;et<i.length;nt=et++){const c=i[et],ct=i[nt],pt=c.x,xt=c.y,St=ct.x,Et=ct.y;xt>a!=Et>a&&s<(St-pt)*(a-xt)/(Et-xt)+pt&&(b=!b)}return b}function getHull(e){const i=e.slice();return i.sort((s,a)=>s.x<a.x?-1:s.x>a.x?1:s.y<a.y?-1:s.y>a.y?1:0),getHullPresorted(i)}function getHullPresorted(e){if(e.length<=1)return e.slice();const i=[];for(let a=0;a<e.length;a++){const b=e[a];for(;i.length>=2;){const et=i[i.length-1],nt=i[i.length-2];if((et.x-nt.x)*(b.y-nt.y)>=(et.y-nt.y)*(b.x-nt.x))i.pop();else break}i.push(b)}i.pop();const s=[];for(let a=e.length-1;a>=0;a--){const b=e[a];for(;s.length>=2;){const et=s[s.length-1],nt=s[s.length-2];if((et.x-nt.x)*(b.y-nt.y)>=(et.y-nt.y)*(b.x-nt.x))s.pop();else break}s.push(b)}return s.pop(),i.length===1&&s.length===1&&i[0].x===s[0].x&&i[0].y===s[0].y?i:i.concat(s)}var Provider$1=TooltipProvider$1,Content2$3=TooltipContent$1;const TooltipProvider=Provider$1,TooltipContent=reactExports.forwardRef(({className:e,sideOffset:i=4,...s},a)=>jsxRuntimeExports.jsx(Content2$3,{ref:a,sideOffset:i,className:cn("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s}));TooltipContent.displayName=Content2$3.displayName;var Subscribable=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},isServer=typeof window>"u"||"Deno"in globalThis;function noop$2(){}function functionalUpdate(e,i){return typeof e=="function"?e(i):e}function isValidTimeout(e){return typeof e=="number"&&e>=0&&e!==1/0}function timeUntilStale(e,i){return Math.max(e+(i||0)-Date.now(),0)}function resolveStaleTime(e,i){return typeof e=="function"?e(i):e}function resolveEnabled(e,i){return typeof e=="function"?e(i):e}function matchQuery(e,i){const{type:s="all",exact:a,fetchStatus:b,predicate:et,queryKey:nt,stale:c}=e;if(nt){if(a){if(i.queryHash!==hashQueryKeyByOptions(nt,i.options))return!1}else if(!partialMatchKey(i.queryKey,nt))return!1}if(s!=="all"){const ct=i.isActive();if(s==="active"&&!ct||s==="inactive"&&ct)return!1}return!(typeof c=="boolean"&&i.isStale()!==c||b&&b!==i.state.fetchStatus||et&&!et(i))}function matchMutation(e,i){const{exact:s,status:a,predicate:b,mutationKey:et}=e;if(et){if(!i.options.mutationKey)return!1;if(s){if(hashKey(i.options.mutationKey)!==hashKey(et))return!1}else if(!partialMatchKey(i.options.mutationKey,et))return!1}return!(a&&i.state.status!==a||b&&!b(i))}function hashQueryKeyByOptions(e,i){return((i==null?void 0:i.queryKeyHashFn)||hashKey)(e)}function hashKey(e){return JSON.stringify(e,(i,s)=>isPlainObject(s)?Object.keys(s).sort().reduce((a,b)=>(a[b]=s[b],a),{}):s)}function partialMatchKey(e,i){return e===i?!0:typeof e!=typeof i?!1:e&&i&&typeof e=="object"&&typeof i=="object"?Object.keys(i).every(s=>partialMatchKey(e[s],i[s])):!1}function replaceEqualDeep(e,i){if(e===i)return e;const s=isPlainArray(e)&&isPlainArray(i);if(s||isPlainObject(e)&&isPlainObject(i)){const a=s?e:Object.keys(e),b=a.length,et=s?i:Object.keys(i),nt=et.length,c=s?[]:{},ct=new Set(a);let pt=0;for(let xt=0;xt<nt;xt++){const St=s?xt:et[xt];(!s&&ct.has(St)||s)&&e[St]===void 0&&i[St]===void 0?(c[St]=void 0,pt++):(c[St]=replaceEqualDeep(e[St],i[St]),c[St]===e[St]&&e[St]!==void 0&&pt++)}return b===nt&&pt===b?e:c}return i}function isPlainArray(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function isPlainObject(e){if(!hasObjectPrototype(e))return!1;const i=e.constructor;if(i===void 0)return!0;const s=i.prototype;return!(!hasObjectPrototype(s)||!s.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function hasObjectPrototype(e){return Object.prototype.toString.call(e)==="[object Object]"}function sleep(e){return new Promise(i=>{setTimeout(i,e)})}function replaceData(e,i,s){return typeof s.structuralSharing=="function"?s.structuralSharing(e,i):s.structuralSharing!==!1?replaceEqualDeep(e,i):i}function addToEnd(e,i,s=0){const a=[...e,i];return s&&a.length>s?a.slice(1):a}function addToStart(e,i,s=0){const a=[i,...e];return s&&a.length>s?a.slice(0,-1):a}var skipToken=Symbol();function ensureQueryFn(e,i){return!e.queryFn&&(i!=null&&i.initialPromise)?()=>i.initialPromise:!e.queryFn||e.queryFn===skipToken?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}var ty,t_,Kx,KR,FocusManager=(KR=class extends Subscribable{constructor(){super();xl(this,ty);xl(this,t_);xl(this,Kx);Po(this,Kx,i=>{if(!isServer&&window.addEventListener){const s=()=>i();return window.addEventListener("visibilitychange",s,!1),()=>{window.removeEventListener("visibilitychange",s)}}})}onSubscribe(){Xn(this,t_)||this.setEventListener(Xn(this,Kx))}onUnsubscribe(){var i;this.hasListeners()||((i=Xn(this,t_))==null||i.call(this),Po(this,t_,void 0))}setEventListener(i){var s;Po(this,Kx,i),(s=Xn(this,t_))==null||s.call(this),Po(this,t_,i(a=>{typeof a=="boolean"?this.setFocused(a):this.onFocus()}))}setFocused(i){Xn(this,ty)!==i&&(Po(this,ty,i),this.onFocus())}onFocus(){const i=this.isFocused();this.listeners.forEach(s=>{s(i)})}isFocused(){var i;return typeof Xn(this,ty)=="boolean"?Xn(this,ty):((i=globalThis.document)==null?void 0:i.visibilityState)!=="hidden"}},ty=new WeakMap,t_=new WeakMap,Kx=new WeakMap,KR),focusManager=new FocusManager,Xx,r_,Zx,XR,OnlineManager=(XR=class extends Subscribable{constructor(){super();xl(this,Xx,!0);xl(this,r_);xl(this,Zx);Po(this,Zx,i=>{if(!isServer&&window.addEventListener){const s=()=>i(!0),a=()=>i(!1);return window.addEventListener("online",s,!1),window.addEventListener("offline",a,!1),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",a)}}})}onSubscribe(){Xn(this,r_)||this.setEventListener(Xn(this,Zx))}onUnsubscribe(){var i;this.hasListeners()||((i=Xn(this,r_))==null||i.call(this),Po(this,r_,void 0))}setEventListener(i){var s;Po(this,Zx,i),(s=Xn(this,r_))==null||s.call(this),Po(this,r_,i(this.setOnline.bind(this)))}setOnline(i){Xn(this,Xx)!==i&&(Po(this,Xx,i),this.listeners.forEach(a=>{a(i)}))}isOnline(){return Xn(this,Xx)}},Xx=new WeakMap,r_=new WeakMap,Zx=new WeakMap,XR),onlineManager=new OnlineManager;function pendingThenable(){let e,i;const s=new Promise((b,et)=>{e=b,i=et});s.status="pending",s.catch(()=>{});function a(b){Object.assign(s,b),delete s.resolve,delete s.reject}return s.resolve=b=>{a({status:"fulfilled",value:b}),e(b)},s.reject=b=>{a({status:"rejected",reason:b}),i(b)},s}function defaultRetryDelay(e){return Math.min(1e3*2**e,3e4)}function canFetch(e){return(e??"online")==="online"?onlineManager.isOnline():!0}var CancelledError=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function isCancelledError(e){return e instanceof CancelledError}function createRetryer(e){let i=!1,s=0,a=!1,b;const et=pendingThenable(),nt=It=>{var Gt;a||(Et(new CancelledError(It)),(Gt=e.abort)==null||Gt.call(e))},c=()=>{i=!0},ct=()=>{i=!1},pt=()=>focusManager.isFocused()&&(e.networkMode==="always"||onlineManager.isOnline())&&e.canRun(),xt=()=>canFetch(e.networkMode)&&e.canRun(),St=It=>{var Gt;a||(a=!0,(Gt=e.onSuccess)==null||Gt.call(e,It),b==null||b(),et.resolve(It))},Et=It=>{var Gt;a||(a=!0,(Gt=e.onError)==null||Gt.call(e,It),b==null||b(),et.reject(It))},Rt=()=>new Promise(It=>{var Gt;b=Dt=>{(a||pt())&&It(Dt)},(Gt=e.onPause)==null||Gt.call(e)}).then(()=>{var It;b=void 0,a||(It=e.onContinue)==null||It.call(e)}),Nt=()=>{if(a)return;let It;const Gt=s===0?e.initialPromise:void 0;try{It=Gt??e.fn()}catch(Dt){It=Promise.reject(Dt)}Promise.resolve(It).then(St).catch(Dt=>{var nr;if(a)return;const Bt=e.retry??(isServer?0:3),Lt=e.retryDelay??defaultRetryDelay,Vt=typeof Lt=="function"?Lt(s,Dt):Lt,Zt=Bt===!0||typeof Bt=="number"&&s<Bt||typeof Bt=="function"&&Bt(s,Dt);if(i||!Zt){Et(Dt);return}s++,(nr=e.onFail)==null||nr.call(e,s,Dt),sleep(Vt).then(()=>pt()?void 0:Rt()).then(()=>{i?Et(Dt):Nt()})})};return{promise:et,cancel:nt,continue:()=>(b==null||b(),et),cancelRetry:c,continueRetry:ct,canStart:xt,start:()=>(xt()?Nt():Rt().then(Nt),et)}}var defaultScheduler=e=>setTimeout(e,0);function createNotifyManager(){let e=[],i=0,s=c=>{c()},a=c=>{c()},b=defaultScheduler;const et=c=>{i?e.push(c):b(()=>{s(c)})},nt=()=>{const c=e;e=[],c.length&&b(()=>{a(()=>{c.forEach(ct=>{s(ct)})})})};return{batch:c=>{let ct;i++;try{ct=c()}finally{i--,i||nt()}return ct},batchCalls:c=>(...ct)=>{et(()=>{c(...ct)})},schedule:et,setNotifyFunction:c=>{s=c},setBatchNotifyFunction:c=>{a=c},setScheduler:c=>{b=c}}}var notifyManager=createNotifyManager(),ry,ZR,Removable=(ZR=class{constructor(){xl(this,ry)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),isValidTimeout(this.gcTime)&&Po(this,ry,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(isServer?1/0:5*60*1e3))}clearGcTimeout(){Xn(this,ry)&&(clearTimeout(Xn(this,ry)),Po(this,ry,void 0))}},ry=new WeakMap,ZR),Yx,iy,qp,ny,Gu,Y1,sy,xm,y0,YR,Query=(YR=class extends Removable{constructor(i){super();xl(this,xm);xl(this,Yx);xl(this,iy);xl(this,qp);xl(this,ny);xl(this,Gu);xl(this,Y1);xl(this,sy);Po(this,sy,!1),Po(this,Y1,i.defaultOptions),this.setOptions(i.options),this.observers=[],Po(this,ny,i.client),Po(this,qp,Xn(this,ny).getQueryCache()),this.queryKey=i.queryKey,this.queryHash=i.queryHash,Po(this,Yx,getDefaultState$1(this.options)),this.state=i.state??Xn(this,Yx),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var i;return(i=Xn(this,Gu))==null?void 0:i.promise}setOptions(i){this.options={...Xn(this,Y1),...i},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Xn(this,qp).remove(this)}setData(i,s){const a=replaceData(this.state.data,i,this.options);return $u(this,xm,y0).call(this,{data:a,type:"success",dataUpdatedAt:s==null?void 0:s.updatedAt,manual:s==null?void 0:s.manual}),a}setState(i,s){$u(this,xm,y0).call(this,{type:"setState",state:i,setStateOptions:s})}cancel(i){var a,b;const s=(a=Xn(this,Gu))==null?void 0:a.promise;return(b=Xn(this,Gu))==null||b.cancel(i),s?s.then(noop$2).catch(noop$2):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Xn(this,Yx))}isActive(){return this.observers.some(i=>resolveEnabled(i.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===skipToken||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(i=>resolveStaleTime(i.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(i=>i.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(i=0){return this.state.data===void 0?!0:i==="static"?!1:this.state.isInvalidated?!0:!timeUntilStale(this.state.dataUpdatedAt,i)}onFocus(){var s;const i=this.observers.find(a=>a.shouldFetchOnWindowFocus());i==null||i.refetch({cancelRefetch:!1}),(s=Xn(this,Gu))==null||s.continue()}onOnline(){var s;const i=this.observers.find(a=>a.shouldFetchOnReconnect());i==null||i.refetch({cancelRefetch:!1}),(s=Xn(this,Gu))==null||s.continue()}addObserver(i){this.observers.includes(i)||(this.observers.push(i),this.clearGcTimeout(),Xn(this,qp).notify({type:"observerAdded",query:this,observer:i}))}removeObserver(i){this.observers.includes(i)&&(this.observers=this.observers.filter(s=>s!==i),this.observers.length||(Xn(this,Gu)&&(Xn(this,sy)?Xn(this,Gu).cancel({revert:!0}):Xn(this,Gu).cancelRetry()),this.scheduleGc()),Xn(this,qp).notify({type:"observerRemoved",query:this,observer:i}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||$u(this,xm,y0).call(this,{type:"invalidate"})}fetch(i,s){var pt,xt,St;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(s!=null&&s.cancelRefetch))this.cancel({silent:!0});else if(Xn(this,Gu))return Xn(this,Gu).continueRetry(),Xn(this,Gu).promise}if(i&&this.setOptions(i),!this.options.queryFn){const Et=this.observers.find(Rt=>Rt.options.queryFn);Et&&this.setOptions(Et.options)}const a=new AbortController,b=Et=>{Object.defineProperty(Et,"signal",{enumerable:!0,get:()=>(Po(this,sy,!0),a.signal)})},et=()=>{const Et=ensureQueryFn(this.options,s),Nt=(()=>{const It={client:Xn(this,ny),queryKey:this.queryKey,meta:this.meta};return b(It),It})();return Po(this,sy,!1),this.options.persister?this.options.persister(Et,Nt,this):Et(Nt)},c=(()=>{const Et={fetchOptions:s,options:this.options,queryKey:this.queryKey,client:Xn(this,ny),state:this.state,fetchFn:et};return b(Et),Et})();(pt=this.options.behavior)==null||pt.onFetch(c,this),Po(this,iy,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((xt=c.fetchOptions)==null?void 0:xt.meta))&&$u(this,xm,y0).call(this,{type:"fetch",meta:(St=c.fetchOptions)==null?void 0:St.meta});const ct=Et=>{var Rt,Nt,It,Gt;isCancelledError(Et)&&Et.silent||$u(this,xm,y0).call(this,{type:"error",error:Et}),isCancelledError(Et)||((Nt=(Rt=Xn(this,qp).config).onError)==null||Nt.call(Rt,Et,this),(Gt=(It=Xn(this,qp).config).onSettled)==null||Gt.call(It,this.state.data,Et,this)),this.scheduleGc()};return Po(this,Gu,createRetryer({initialPromise:s==null?void 0:s.initialPromise,fn:c.fetchFn,abort:a.abort.bind(a),onSuccess:Et=>{var Rt,Nt,It,Gt;if(Et===void 0){ct(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(Et)}catch(Dt){ct(Dt);return}(Nt=(Rt=Xn(this,qp).config).onSuccess)==null||Nt.call(Rt,Et,this),(Gt=(It=Xn(this,qp).config).onSettled)==null||Gt.call(It,Et,this.state.error,this),this.scheduleGc()},onError:ct,onFail:(Et,Rt)=>{$u(this,xm,y0).call(this,{type:"failed",failureCount:Et,error:Rt})},onPause:()=>{$u(this,xm,y0).call(this,{type:"pause"})},onContinue:()=>{$u(this,xm,y0).call(this,{type:"continue"})},retry:c.options.retry,retryDelay:c.options.retryDelay,networkMode:c.options.networkMode,canRun:()=>!0})),Xn(this,Gu).start()}},Yx=new WeakMap,iy=new WeakMap,qp=new WeakMap,ny=new WeakMap,Gu=new WeakMap,Y1=new WeakMap,sy=new WeakMap,xm=new WeakSet,y0=function(i){const s=a=>{switch(i.type){case"failed":return{...a,fetchFailureCount:i.failureCount,fetchFailureReason:i.error};case"pause":return{...a,fetchStatus:"paused"};case"continue":return{...a,fetchStatus:"fetching"};case"fetch":return{...a,...fetchState(a.data,this.options),fetchMeta:i.meta??null};case"success":return Po(this,iy,void 0),{...a,data:i.data,dataUpdateCount:a.dataUpdateCount+1,dataUpdatedAt:i.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!i.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const b=i.error;return isCancelledError(b)&&b.revert&&Xn(this,iy)?{...Xn(this,iy),fetchStatus:"idle"}:{...a,error:b,errorUpdateCount:a.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:a.fetchFailureCount+1,fetchFailureReason:b,fetchStatus:"idle",status:"error"};case"invalidate":return{...a,isInvalidated:!0};case"setState":return{...a,...i.state}}};this.state=s(this.state),notifyManager.batch(()=>{this.observers.forEach(a=>{a.onQueryUpdate()}),Xn(this,qp).notify({query:this,type:"updated",action:i})})},YR);function fetchState(e,i){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:canFetch(i.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function getDefaultState$1(e){const i=typeof e.initialData=="function"?e.initialData():e.initialData,s=i!==void 0,a=s?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:i,dataUpdateCount:0,dataUpdatedAt:s?a??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:s?"success":"pending",fetchStatus:"idle"}}var $m,QR,QueryCache=(QR=class extends Subscribable{constructor(i={}){super();xl(this,$m);this.config=i,Po(this,$m,new Map)}build(i,s,a){const b=s.queryKey,et=s.queryHash??hashQueryKeyByOptions(b,s);let nt=this.get(et);return nt||(nt=new Query({client:i,queryKey:b,queryHash:et,options:i.defaultQueryOptions(s),state:a,defaultOptions:i.getQueryDefaults(b)}),this.add(nt)),nt}add(i){Xn(this,$m).has(i.queryHash)||(Xn(this,$m).set(i.queryHash,i),this.notify({type:"added",query:i}))}remove(i){const s=Xn(this,$m).get(i.queryHash);s&&(i.destroy(),s===i&&Xn(this,$m).delete(i.queryHash),this.notify({type:"removed",query:i}))}clear(){notifyManager.batch(()=>{this.getAll().forEach(i=>{this.remove(i)})})}get(i){return Xn(this,$m).get(i)}getAll(){return[...Xn(this,$m).values()]}find(i){const s={exact:!0,...i};return this.getAll().find(a=>matchQuery(s,a))}findAll(i={}){const s=this.getAll();return Object.keys(i).length>0?s.filter(a=>matchQuery(i,a)):s}notify(i){notifyManager.batch(()=>{this.listeners.forEach(s=>{s(i)})})}onFocus(){notifyManager.batch(()=>{this.getAll().forEach(i=>{i.onFocus()})})}onOnline(){notifyManager.batch(()=>{this.getAll().forEach(i=>{i.onOnline()})})}},$m=new WeakMap,QR),Gm,_h,oy,Hm,e_,JR,Mutation=(JR=class extends Removable{constructor(i){super();xl(this,Hm);xl(this,Gm);xl(this,_h);xl(this,oy);this.mutationId=i.mutationId,Po(this,_h,i.mutationCache),Po(this,Gm,[]),this.state=i.state||getDefaultState(),this.setOptions(i.options),this.scheduleGc()}setOptions(i){this.options=i,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(i){Xn(this,Gm).includes(i)||(Xn(this,Gm).push(i),this.clearGcTimeout(),Xn(this,_h).notify({type:"observerAdded",mutation:this,observer:i}))}removeObserver(i){Po(this,Gm,Xn(this,Gm).filter(s=>s!==i)),this.scheduleGc(),Xn(this,_h).notify({type:"observerRemoved",mutation:this,observer:i})}optionalRemove(){Xn(this,Gm).length||(this.state.status==="pending"?this.scheduleGc():Xn(this,_h).remove(this))}continue(){var i;return((i=Xn(this,oy))==null?void 0:i.continue())??this.execute(this.state.variables)}async execute(i){var et,nt,c,ct,pt,xt,St,Et,Rt,Nt,It,Gt,Dt,Bt,Lt,Vt,Zt,nr,ur,_r;const s=()=>{$u(this,Hm,e_).call(this,{type:"continue"})};Po(this,oy,createRetryer({fn:()=>this.options.mutationFn?this.options.mutationFn(i):Promise.reject(new Error("No mutationFn found")),onFail:(Ur,ln)=>{$u(this,Hm,e_).call(this,{type:"failed",failureCount:Ur,error:ln})},onPause:()=>{$u(this,Hm,e_).call(this,{type:"pause"})},onContinue:s,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Xn(this,_h).canRun(this)}));const a=this.state.status==="pending",b=!Xn(this,oy).canStart();try{if(a)s();else{$u(this,Hm,e_).call(this,{type:"pending",variables:i,isPaused:b}),await((nt=(et=Xn(this,_h).config).onMutate)==null?void 0:nt.call(et,i,this));const ln=await((ct=(c=this.options).onMutate)==null?void 0:ct.call(c,i));ln!==this.state.context&&$u(this,Hm,e_).call(this,{type:"pending",context:ln,variables:i,isPaused:b})}const Ur=await Xn(this,oy).start();return await((xt=(pt=Xn(this,_h).config).onSuccess)==null?void 0:xt.call(pt,Ur,i,this.state.context,this)),await((Et=(St=this.options).onSuccess)==null?void 0:Et.call(St,Ur,i,this.state.context)),await((Nt=(Rt=Xn(this,_h).config).onSettled)==null?void 0:Nt.call(Rt,Ur,null,this.state.variables,this.state.context,this)),await((Gt=(It=this.options).onSettled)==null?void 0:Gt.call(It,Ur,null,i,this.state.context)),$u(this,Hm,e_).call(this,{type:"success",data:Ur}),Ur}catch(Ur){try{throw await((Bt=(Dt=Xn(this,_h).config).onError)==null?void 0:Bt.call(Dt,Ur,i,this.state.context,this)),await((Vt=(Lt=this.options).onError)==null?void 0:Vt.call(Lt,Ur,i,this.state.context)),await((nr=(Zt=Xn(this,_h).config).onSettled)==null?void 0:nr.call(Zt,void 0,Ur,this.state.variables,this.state.context,this)),await((_r=(ur=this.options).onSettled)==null?void 0:_r.call(ur,void 0,Ur,i,this.state.context)),Ur}finally{$u(this,Hm,e_).call(this,{type:"error",error:Ur})}}finally{Xn(this,_h).runNext(this)}}},Gm=new WeakMap,_h=new WeakMap,oy=new WeakMap,Hm=new WeakSet,e_=function(i){const s=a=>{switch(i.type){case"failed":return{...a,failureCount:i.failureCount,failureReason:i.error};case"pause":return{...a,isPaused:!0};case"continue":return{...a,isPaused:!1};case"pending":return{...a,context:i.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:i.isPaused,status:"pending",variables:i.variables,submittedAt:Date.now()};case"success":return{...a,data:i.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...a,data:void 0,error:i.error,failureCount:a.failureCount+1,failureReason:i.error,isPaused:!1,status:"error"}}};this.state=s(this.state),notifyManager.batch(()=>{Xn(this,Gm).forEach(a=>{a.onMutationUpdate(i)}),Xn(this,_h).notify({mutation:this,type:"updated",action:i})})},JR);function getDefaultState(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var x0,vm,Q1,eI,MutationCache=(eI=class extends Subscribable{constructor(i={}){super();xl(this,x0);xl(this,vm);xl(this,Q1);this.config=i,Po(this,x0,new Set),Po(this,vm,new Map),Po(this,Q1,0)}build(i,s,a){const b=new Mutation({mutationCache:this,mutationId:++ZE(this,Q1)._,options:i.defaultMutationOptions(s),state:a});return this.add(b),b}add(i){Xn(this,x0).add(i);const s=scopeFor(i);if(typeof s=="string"){const a=Xn(this,vm).get(s);a?a.push(i):Xn(this,vm).set(s,[i])}this.notify({type:"added",mutation:i})}remove(i){if(Xn(this,x0).delete(i)){const s=scopeFor(i);if(typeof s=="string"){const a=Xn(this,vm).get(s);if(a)if(a.length>1){const b=a.indexOf(i);b!==-1&&a.splice(b,1)}else a[0]===i&&Xn(this,vm).delete(s)}}this.notify({type:"removed",mutation:i})}canRun(i){const s=scopeFor(i);if(typeof s=="string"){const a=Xn(this,vm).get(s),b=a==null?void 0:a.find(et=>et.state.status==="pending");return!b||b===i}else return!0}runNext(i){var a;const s=scopeFor(i);if(typeof s=="string"){const b=(a=Xn(this,vm).get(s))==null?void 0:a.find(et=>et!==i&&et.state.isPaused);return(b==null?void 0:b.continue())??Promise.resolve()}else return Promise.resolve()}clear(){notifyManager.batch(()=>{Xn(this,x0).forEach(i=>{this.notify({type:"removed",mutation:i})}),Xn(this,x0).clear(),Xn(this,vm).clear()})}getAll(){return Array.from(Xn(this,x0))}find(i){const s={exact:!0,...i};return this.getAll().find(a=>matchMutation(s,a))}findAll(i={}){return this.getAll().filter(s=>matchMutation(i,s))}notify(i){notifyManager.batch(()=>{this.listeners.forEach(s=>{s(i)})})}resumePausedMutations(){const i=this.getAll().filter(s=>s.state.isPaused);return notifyManager.batch(()=>Promise.all(i.map(s=>s.continue().catch(noop$2))))}},x0=new WeakMap,vm=new WeakMap,Q1=new WeakMap,eI);function scopeFor(e){var i;return(i=e.options.scope)==null?void 0:i.id}function infiniteQueryBehavior(e){return{onFetch:(i,s)=>{var xt,St,Et,Rt,Nt;const a=i.options,b=(Et=(St=(xt=i.fetchOptions)==null?void 0:xt.meta)==null?void 0:St.fetchMore)==null?void 0:Et.direction,et=((Rt=i.state.data)==null?void 0:Rt.pages)||[],nt=((Nt=i.state.data)==null?void 0:Nt.pageParams)||[];let c={pages:[],pageParams:[]},ct=0;const pt=async()=>{let It=!1;const Gt=Lt=>{Object.defineProperty(Lt,"signal",{enumerable:!0,get:()=>(i.signal.aborted?It=!0:i.signal.addEventListener("abort",()=>{It=!0}),i.signal)})},Dt=ensureQueryFn(i.options,i.fetchOptions),Bt=async(Lt,Vt,Zt)=>{if(It)return Promise.reject();if(Vt==null&&Lt.pages.length)return Promise.resolve(Lt);const ur=(()=>{const an={client:i.client,queryKey:i.queryKey,pageParam:Vt,direction:Zt?"backward":"forward",meta:i.options.meta};return Gt(an),an})(),_r=await Dt(ur),{maxPages:Ur}=i.options,ln=Zt?addToStart:addToEnd;return{pages:ln(Lt.pages,_r,Ur),pageParams:ln(Lt.pageParams,Vt,Ur)}};if(b&&et.length){const Lt=b==="backward",Vt=Lt?getPreviousPageParam:getNextPageParam,Zt={pages:et,pageParams:nt},nr=Vt(a,Zt);c=await Bt(Zt,nr,Lt)}else{const Lt=e??et.length;do{const Vt=ct===0?nt[0]??a.initialPageParam:getNextPageParam(a,c);if(ct>0&&Vt==null)break;c=await Bt(c,Vt),ct++}while(ct<Lt)}return c};i.options.persister?i.fetchFn=()=>{var It,Gt;return(Gt=(It=i.options).persister)==null?void 0:Gt.call(It,pt,{client:i.client,queryKey:i.queryKey,meta:i.options.meta,signal:i.signal},s)}:i.fetchFn=pt}}}function getNextPageParam(e,{pages:i,pageParams:s}){const a=i.length-1;return i.length>0?e.getNextPageParam(i[a],i,s[a],s):void 0}function getPreviousPageParam(e,{pages:i,pageParams:s}){var a;return i.length>0?(a=e.getPreviousPageParam)==null?void 0:a.call(e,i[0],i,s[0],s):void 0}var su,i_,n_,Qx,Jx,s_,ev,tv,tI,QueryClient=(tI=class{constructor(e={}){xl(this,su);xl(this,i_);xl(this,n_);xl(this,Qx);xl(this,Jx);xl(this,s_);xl(this,ev);xl(this,tv);Po(this,su,e.queryCache||new QueryCache),Po(this,i_,e.mutationCache||new MutationCache),Po(this,n_,e.defaultOptions||{}),Po(this,Qx,new Map),Po(this,Jx,new Map),Po(this,s_,0)}mount(){ZE(this,s_)._++,Xn(this,s_)===1&&(Po(this,ev,focusManager.subscribe(async e=>{e&&(await this.resumePausedMutations(),Xn(this,su).onFocus())})),Po(this,tv,onlineManager.subscribe(async e=>{e&&(await this.resumePausedMutations(),Xn(this,su).onOnline())})))}unmount(){var e,i;ZE(this,s_)._--,Xn(this,s_)===0&&((e=Xn(this,ev))==null||e.call(this),Po(this,ev,void 0),(i=Xn(this,tv))==null||i.call(this),Po(this,tv,void 0))}isFetching(e){return Xn(this,su).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return Xn(this,i_).findAll({...e,status:"pending"}).length}getQueryData(e){var s;const i=this.defaultQueryOptions({queryKey:e});return(s=Xn(this,su).get(i.queryHash))==null?void 0:s.state.data}ensureQueryData(e){const i=this.defaultQueryOptions(e),s=Xn(this,su).build(this,i),a=s.state.data;return a===void 0?this.fetchQuery(e):(e.revalidateIfStale&&s.isStaleByTime(resolveStaleTime(i.staleTime,s))&&this.prefetchQuery(i),Promise.resolve(a))}getQueriesData(e){return Xn(this,su).findAll(e).map(({queryKey:i,state:s})=>{const a=s.data;return[i,a]})}setQueryData(e,i,s){const a=this.defaultQueryOptions({queryKey:e}),b=Xn(this,su).get(a.queryHash),et=b==null?void 0:b.state.data,nt=functionalUpdate(i,et);if(nt!==void 0)return Xn(this,su).build(this,a).setData(nt,{...s,manual:!0})}setQueriesData(e,i,s){return notifyManager.batch(()=>Xn(this,su).findAll(e).map(({queryKey:a})=>[a,this.setQueryData(a,i,s)]))}getQueryState(e){var s;const i=this.defaultQueryOptions({queryKey:e});return(s=Xn(this,su).get(i.queryHash))==null?void 0:s.state}removeQueries(e){const i=Xn(this,su);notifyManager.batch(()=>{i.findAll(e).forEach(s=>{i.remove(s)})})}resetQueries(e,i){const s=Xn(this,su);return notifyManager.batch(()=>(s.findAll(e).forEach(a=>{a.reset()}),this.refetchQueries({type:"active",...e},i)))}cancelQueries(e,i={}){const s={revert:!0,...i},a=notifyManager.batch(()=>Xn(this,su).findAll(e).map(b=>b.cancel(s)));return Promise.all(a).then(noop$2).catch(noop$2)}invalidateQueries(e,i={}){return notifyManager.batch(()=>(Xn(this,su).findAll(e).forEach(s=>{s.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},i)))}refetchQueries(e,i={}){const s={...i,cancelRefetch:i.cancelRefetch??!0},a=notifyManager.batch(()=>Xn(this,su).findAll(e).filter(b=>!b.isDisabled()&&!b.isStatic()).map(b=>{let et=b.fetch(void 0,s);return s.throwOnError||(et=et.catch(noop$2)),b.state.fetchStatus==="paused"?Promise.resolve():et}));return Promise.all(a).then(noop$2)}fetchQuery(e){const i=this.defaultQueryOptions(e);i.retry===void 0&&(i.retry=!1);const s=Xn(this,su).build(this,i);return s.isStaleByTime(resolveStaleTime(i.staleTime,s))?s.fetch(i):Promise.resolve(s.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(noop$2).catch(noop$2)}fetchInfiniteQuery(e){return e.behavior=infiniteQueryBehavior(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(noop$2).catch(noop$2)}ensureInfiniteQueryData(e){return e.behavior=infiniteQueryBehavior(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return onlineManager.isOnline()?Xn(this,i_).resumePausedMutations():Promise.resolve()}getQueryCache(){return Xn(this,su)}getMutationCache(){return Xn(this,i_)}getDefaultOptions(){return Xn(this,n_)}setDefaultOptions(e){Po(this,n_,e)}setQueryDefaults(e,i){Xn(this,Qx).set(hashKey(e),{queryKey:e,defaultOptions:i})}getQueryDefaults(e){const i=[...Xn(this,Qx).values()],s={};return i.forEach(a=>{partialMatchKey(e,a.queryKey)&&Object.assign(s,a.defaultOptions)}),s}setMutationDefaults(e,i){Xn(this,Jx).set(hashKey(e),{mutationKey:e,defaultOptions:i})}getMutationDefaults(e){const i=[...Xn(this,Jx).values()],s={};return i.forEach(a=>{partialMatchKey(e,a.mutationKey)&&Object.assign(s,a.defaultOptions)}),s}defaultQueryOptions(e){if(e._defaulted)return e;const i={...Xn(this,n_).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return i.queryHash||(i.queryHash=hashQueryKeyByOptions(i.queryKey,i)),i.refetchOnReconnect===void 0&&(i.refetchOnReconnect=i.networkMode!=="always"),i.throwOnError===void 0&&(i.throwOnError=!!i.suspense),!i.networkMode&&i.persister&&(i.networkMode="offlineFirst"),i.queryFn===skipToken&&(i.enabled=!1),i}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...Xn(this,n_).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){Xn(this,su).clear(),Xn(this,i_).clear()}},su=new WeakMap,i_=new WeakMap,n_=new WeakMap,Qx=new WeakMap,Jx=new WeakMap,s_=new WeakMap,ev=new WeakMap,tv=new WeakMap,tI),QueryClientContext=reactExports.createContext(void 0),QueryClientProvider=({client:e,children:i})=>(reactExports.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),jsxRuntimeExports.jsx(QueryClientContext.Provider,{value:e,children:i}));/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends$2(){return _extends$2=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},_extends$2.apply(this,arguments)}var Action$1;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Action$1||(Action$1={}));const PopStateEventType="popstate";function createBrowserHistory(e){e===void 0&&(e={});function i(a,b){let{pathname:et,search:nt,hash:c}=a.location;return createLocation("",{pathname:et,search:nt,hash:c},b.state&&b.state.usr||null,b.state&&b.state.key||"default")}function s(a,b){return typeof b=="string"?b:createPath(b)}return getUrlBasedHistory(i,s,null,e)}function invariant$1(e,i){if(e===!1||e===null||typeof e>"u")throw new Error(i)}function warning$1(e,i){if(!e){typeof console<"u"&&console.warn(i);try{throw new Error(i)}catch{}}}function createKey(){return Math.random().toString(36).substr(2,8)}function getHistoryState(e,i){return{usr:e.state,key:e.key,idx:i}}function createLocation(e,i,s,a){return s===void 0&&(s=null),_extends$2({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof i=="string"?parsePath(i):i,{state:s,key:i&&i.key||a||createKey()})}function createPath(e){let{pathname:i="/",search:s="",hash:a=""}=e;return s&&s!=="?"&&(i+=s.charAt(0)==="?"?s:"?"+s),a&&a!=="#"&&(i+=a.charAt(0)==="#"?a:"#"+a),i}function parsePath(e){let i={};if(e){let s=e.indexOf("#");s>=0&&(i.hash=e.substr(s),e=e.substr(0,s));let a=e.indexOf("?");a>=0&&(i.search=e.substr(a),e=e.substr(0,a)),e&&(i.pathname=e)}return i}function getUrlBasedHistory(e,i,s,a){a===void 0&&(a={});let{window:b=document.defaultView,v5Compat:et=!1}=a,nt=b.history,c=Action$1.Pop,ct=null,pt=xt();pt==null&&(pt=0,nt.replaceState(_extends$2({},nt.state,{idx:pt}),""));function xt(){return(nt.state||{idx:null}).idx}function St(){c=Action$1.Pop;let Gt=xt(),Dt=Gt==null?null:Gt-pt;pt=Gt,ct&&ct({action:c,location:It.location,delta:Dt})}function Et(Gt,Dt){c=Action$1.Push;let Bt=createLocation(It.location,Gt,Dt);pt=xt()+1;let Lt=getHistoryState(Bt,pt),Vt=It.createHref(Bt);try{nt.pushState(Lt,"",Vt)}catch(Zt){if(Zt instanceof DOMException&&Zt.name==="DataCloneError")throw Zt;b.location.assign(Vt)}et&&ct&&ct({action:c,location:It.location,delta:1})}function Rt(Gt,Dt){c=Action$1.Replace;let Bt=createLocation(It.location,Gt,Dt);pt=xt();let Lt=getHistoryState(Bt,pt),Vt=It.createHref(Bt);nt.replaceState(Lt,"",Vt),et&&ct&&ct({action:c,location:It.location,delta:0})}function Nt(Gt){let Dt=b.location.origin!=="null"?b.location.origin:b.location.href,Bt=typeof Gt=="string"?Gt:createPath(Gt);return Bt=Bt.replace(/ $/,"%20"),invariant$1(Dt,"No window.location.(origin|href) available to create URL for href: "+Bt),new URL(Bt,Dt)}let It={get action(){return c},get location(){return e(b,nt)},listen(Gt){if(ct)throw new Error("A history only accepts one active listener");return b.addEventListener(PopStateEventType,St),ct=Gt,()=>{b.removeEventListener(PopStateEventType,St),ct=null}},createHref(Gt){return i(b,Gt)},createURL:Nt,encodeLocation(Gt){let Dt=Nt(Gt);return{pathname:Dt.pathname,search:Dt.search,hash:Dt.hash}},push:Et,replace:Rt,go(Gt){return nt.go(Gt)}};return It}var ResultType;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(ResultType||(ResultType={}));function matchRoutes(e,i,s){return s===void 0&&(s="/"),matchRoutesImpl(e,i,s,!1)}function matchRoutesImpl(e,i,s,a){let b=typeof i=="string"?parsePath(i):i,et=stripBasename(b.pathname||"/",s);if(et==null)return null;let nt=flattenRoutes(e);rankRouteBranches(nt);let c=null;for(let ct=0;c==null&&ct<nt.length;++ct){let pt=decodePath$1(et);c=matchRouteBranch(nt[ct],pt,a)}return c}function flattenRoutes(e,i,s,a){i===void 0&&(i=[]),s===void 0&&(s=[]),a===void 0&&(a="");let b=(et,nt,c)=>{let ct={relativePath:c===void 0?et.path||"":c,caseSensitive:et.caseSensitive===!0,childrenIndex:nt,route:et};ct.relativePath.startsWith("/")&&(invariant$1(ct.relativePath.startsWith(a),'Absolute route path "'+ct.relativePath+'" nested under path '+('"'+a+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),ct.relativePath=ct.relativePath.slice(a.length));let pt=joinPaths([a,ct.relativePath]),xt=s.concat(ct);et.children&&et.children.length>0&&(invariant$1(et.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+pt+'".')),flattenRoutes(et.children,i,xt,pt)),!(et.path==null&&!et.index)&&i.push({path:pt,score:computeScore(pt,et.index),routesMeta:xt})};return e.forEach((et,nt)=>{var c;if(et.path===""||!((c=et.path)!=null&&c.includes("?")))b(et,nt);else for(let ct of explodeOptionalSegments(et.path))b(et,nt,ct)}),i}function explodeOptionalSegments(e){let i=e.split("/");if(i.length===0)return[];let[s,...a]=i,b=s.endsWith("?"),et=s.replace(/\?$/,"");if(a.length===0)return b?[et,""]:[et];let nt=explodeOptionalSegments(a.join("/")),c=[];return c.push(...nt.map(ct=>ct===""?et:[et,ct].join("/"))),b&&c.push(...nt),c.map(ct=>e.startsWith("/")&&ct===""?"/":ct)}function rankRouteBranches(e){e.sort((i,s)=>i.score!==s.score?s.score-i.score:compareIndexes(i.routesMeta.map(a=>a.childrenIndex),s.routesMeta.map(a=>a.childrenIndex)))}const paramRe=/^:[\w-]+$/,dynamicSegmentValue=3,indexRouteValue=2,emptySegmentValue=1,staticSegmentValue=10,splatPenalty=-2,isSplat=e=>e==="*";function computeScore(e,i){let s=e.split("/"),a=s.length;return s.some(isSplat)&&(a+=splatPenalty),i&&(a+=indexRouteValue),s.filter(b=>!isSplat(b)).reduce((b,et)=>b+(paramRe.test(et)?dynamicSegmentValue:et===""?emptySegmentValue:staticSegmentValue),a)}function compareIndexes(e,i){return e.length===i.length&&e.slice(0,-1).every((a,b)=>a===i[b])?e[e.length-1]-i[i.length-1]:0}function matchRouteBranch(e,i,s){let{routesMeta:a}=e,b={},et="/",nt=[];for(let c=0;c<a.length;++c){let ct=a[c],pt=c===a.length-1,xt=et==="/"?i:i.slice(et.length)||"/",St=matchPath({path:ct.relativePath,caseSensitive:ct.caseSensitive,end:pt},xt),Et=ct.route;if(!St&&pt&&s&&!a[a.length-1].route.index&&(St=matchPath({path:ct.relativePath,caseSensitive:ct.caseSensitive,end:!1},xt)),!St)return null;Object.assign(b,St.params),nt.push({params:b,pathname:joinPaths([et,St.pathname]),pathnameBase:normalizePathname(joinPaths([et,St.pathnameBase])),route:Et}),St.pathnameBase!=="/"&&(et=joinPaths([et,St.pathnameBase]))}return nt}function matchPath(e,i){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[s,a]=compilePath(e.path,e.caseSensitive,e.end),b=i.match(s);if(!b)return null;let et=b[0],nt=et.replace(/(.)\/+$/,"$1"),c=b.slice(1);return{params:a.reduce((pt,xt,St)=>{let{paramName:Et,isOptional:Rt}=xt;if(Et==="*"){let It=c[St]||"";nt=et.slice(0,et.length-It.length).replace(/(.)\/+$/,"$1")}const Nt=c[St];return Rt&&!Nt?pt[Et]=void 0:pt[Et]=(Nt||"").replace(/%2F/g,"/"),pt},{}),pathname:et,pathnameBase:nt,pattern:e}}function compilePath(e,i,s){i===void 0&&(i=!1),s===void 0&&(s=!0),warning$1(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let a=[],b="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(nt,c,ct)=>(a.push({paramName:c,isOptional:ct!=null}),ct?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(a.push({paramName:"*"}),b+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?b+="\\/*$":e!==""&&e!=="/"&&(b+="(?:(?=\\/|$))"),[new RegExp(b,i?void 0:"i"),a]}function decodePath$1(e){try{return e.split("/").map(i=>decodeURIComponent(i).replace(/\//g,"%2F")).join("/")}catch(i){return warning$1(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+i+").")),e}}function stripBasename(e,i){if(i==="/")return e;if(!e.toLowerCase().startsWith(i.toLowerCase()))return null;let s=i.endsWith("/")?i.length-1:i.length,a=e.charAt(s);return a&&a!=="/"?null:e.slice(s)||"/"}function resolvePath(e,i){i===void 0&&(i="/");let{pathname:s,search:a="",hash:b=""}=typeof e=="string"?parsePath(e):e;return{pathname:s?s.startsWith("/")?s:resolvePathname(s,i):i,search:normalizeSearch(a),hash:normalizeHash(b)}}function resolvePathname(e,i){let s=i.replace(/\/+$/,"").split("/");return e.split("/").forEach(b=>{b===".."?s.length>1&&s.pop():b!=="."&&s.push(b)}),s.length>1?s.join("/"):"/"}function getInvalidPathError(e,i,s,a){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+i+"` field ["+JSON.stringify(a)+"].  Please separate it out to the ")+("`to."+s+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function getPathContributingMatches(e){return e.filter((i,s)=>s===0||i.route.path&&i.route.path.length>0)}function getResolveToMatches(e,i){let s=getPathContributingMatches(e);return i?s.map((a,b)=>b===s.length-1?a.pathname:a.pathnameBase):s.map(a=>a.pathnameBase)}function resolveTo(e,i,s,a){a===void 0&&(a=!1);let b;typeof e=="string"?b=parsePath(e):(b=_extends$2({},e),invariant$1(!b.pathname||!b.pathname.includes("?"),getInvalidPathError("?","pathname","search",b)),invariant$1(!b.pathname||!b.pathname.includes("#"),getInvalidPathError("#","pathname","hash",b)),invariant$1(!b.search||!b.search.includes("#"),getInvalidPathError("#","search","hash",b)));let et=e===""||b.pathname==="",nt=et?"/":b.pathname,c;if(nt==null)c=s;else{let St=i.length-1;if(!a&&nt.startsWith("..")){let Et=nt.split("/");for(;Et[0]==="..";)Et.shift(),St-=1;b.pathname=Et.join("/")}c=St>=0?i[St]:"/"}let ct=resolvePath(b,c),pt=nt&&nt!=="/"&&nt.endsWith("/"),xt=(et||nt===".")&&s.endsWith("/");return!ct.pathname.endsWith("/")&&(pt||xt)&&(ct.pathname+="/"),ct}const joinPaths=e=>e.join("/").replace(/\/\/+/g,"/"),normalizePathname=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),normalizeSearch=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,normalizeHash=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function isRouteErrorResponse(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const validMutationMethodsArr=["post","put","patch","delete"];new Set(validMutationMethodsArr);const validRequestMethodsArr=["get",...validMutationMethodsArr];new Set(validRequestMethodsArr);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},_extends$1.apply(this,arguments)}const DataRouterContext=reactExports.createContext(null),DataRouterStateContext=reactExports.createContext(null),NavigationContext=reactExports.createContext(null),LocationContext$1=reactExports.createContext(null),RouteContext=reactExports.createContext({outlet:null,matches:[],isDataRoute:!1}),RouteErrorContext=reactExports.createContext(null);function useHref(e,i){let{relative:s}=i===void 0?{}:i;useInRouterContext()||invariant$1(!1);let{basename:a,navigator:b}=reactExports.useContext(NavigationContext),{hash:et,pathname:nt,search:c}=useResolvedPath(e,{relative:s}),ct=nt;return a!=="/"&&(ct=nt==="/"?a:joinPaths([a,nt])),b.createHref({pathname:ct,search:c,hash:et})}function useInRouterContext(){return reactExports.useContext(LocationContext$1)!=null}function useLocation(){return useInRouterContext()||invariant$1(!1),reactExports.useContext(LocationContext$1).location}function useIsomorphicLayoutEffect$2(e){reactExports.useContext(NavigationContext).static||reactExports.useLayoutEffect(e)}function useNavigate(){let{isDataRoute:e}=reactExports.useContext(RouteContext);return e?useNavigateStable():useNavigateUnstable()}function useNavigateUnstable(){useInRouterContext()||invariant$1(!1);let e=reactExports.useContext(DataRouterContext),{basename:i,future:s,navigator:a}=reactExports.useContext(NavigationContext),{matches:b}=reactExports.useContext(RouteContext),{pathname:et}=useLocation(),nt=JSON.stringify(getResolveToMatches(b,s.v7_relativeSplatPath)),c=reactExports.useRef(!1);return useIsomorphicLayoutEffect$2(()=>{c.current=!0}),reactExports.useCallback(function(pt,xt){if(xt===void 0&&(xt={}),!c.current)return;if(typeof pt=="number"){a.go(pt);return}let St=resolveTo(pt,JSON.parse(nt),et,xt.relative==="path");e==null&&i!=="/"&&(St.pathname=St.pathname==="/"?i:joinPaths([i,St.pathname])),(xt.replace?a.replace:a.push)(St,xt.state,xt)},[i,a,nt,et,e])}function useParams(){let{matches:e}=reactExports.useContext(RouteContext),i=e[e.length-1];return i?i.params:{}}function useResolvedPath(e,i){let{relative:s}=i===void 0?{}:i,{future:a}=reactExports.useContext(NavigationContext),{matches:b}=reactExports.useContext(RouteContext),{pathname:et}=useLocation(),nt=JSON.stringify(getResolveToMatches(b,a.v7_relativeSplatPath));return reactExports.useMemo(()=>resolveTo(e,JSON.parse(nt),et,s==="path"),[e,nt,et,s])}function useRoutes(e,i){return useRoutesImpl(e,i)}function useRoutesImpl(e,i,s,a){useInRouterContext()||invariant$1(!1);let{navigator:b}=reactExports.useContext(NavigationContext),{matches:et}=reactExports.useContext(RouteContext),nt=et[et.length-1],c=nt?nt.params:{};nt&&nt.pathname;let ct=nt?nt.pathnameBase:"/";nt&&nt.route;let pt=useLocation(),xt;if(i){var St;let Gt=typeof i=="string"?parsePath(i):i;ct==="/"||(St=Gt.pathname)!=null&&St.startsWith(ct)||invariant$1(!1),xt=Gt}else xt=pt;let Et=xt.pathname||"/",Rt=Et;if(ct!=="/"){let Gt=ct.replace(/^\//,"").split("/");Rt="/"+Et.replace(/^\//,"").split("/").slice(Gt.length).join("/")}let Nt=matchRoutes(e,{pathname:Rt}),It=_renderMatches(Nt&&Nt.map(Gt=>Object.assign({},Gt,{params:Object.assign({},c,Gt.params),pathname:joinPaths([ct,b.encodeLocation?b.encodeLocation(Gt.pathname).pathname:Gt.pathname]),pathnameBase:Gt.pathnameBase==="/"?ct:joinPaths([ct,b.encodeLocation?b.encodeLocation(Gt.pathnameBase).pathname:Gt.pathnameBase])})),et,s,a);return i&&It?reactExports.createElement(LocationContext$1.Provider,{value:{location:_extends$1({pathname:"/",search:"",hash:"",state:null,key:"default"},xt),navigationType:Action$1.Pop}},It):It}function DefaultErrorComponent(){let e=useRouteError(),i=isRouteErrorResponse(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),s=e instanceof Error?e.stack:null,b={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("h2",null,"Unexpected Application Error!"),reactExports.createElement("h3",{style:{fontStyle:"italic"}},i),s?reactExports.createElement("pre",{style:b},s):null,null)}const defaultErrorElement=reactExports.createElement(DefaultErrorComponent,null);class RenderErrorBoundary extends reactExports.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,s){return s.location!==i.location||s.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:s.error,location:s.location,revalidation:i.revalidation||s.revalidation}}componentDidCatch(i,s){console.error("React Router caught the following error during render",i,s)}render(){return this.state.error!==void 0?reactExports.createElement(RouteContext.Provider,{value:this.props.routeContext},reactExports.createElement(RouteErrorContext.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function RenderedRoute(e){let{routeContext:i,match:s,children:a}=e,b=reactExports.useContext(DataRouterContext);return b&&b.static&&b.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(b.staticContext._deepestRenderedBoundaryId=s.route.id),reactExports.createElement(RouteContext.Provider,{value:i},a)}function _renderMatches(e,i,s,a){var b;if(i===void 0&&(i=[]),s===void 0&&(s=null),a===void 0&&(a=null),e==null){var et;if(!s)return null;if(s.errors)e=s.matches;else if((et=a)!=null&&et.v7_partialHydration&&i.length===0&&!s.initialized&&s.matches.length>0)e=s.matches;else return null}let nt=e,c=(b=s)==null?void 0:b.errors;if(c!=null){let xt=nt.findIndex(St=>St.route.id&&(c==null?void 0:c[St.route.id])!==void 0);xt>=0||invariant$1(!1),nt=nt.slice(0,Math.min(nt.length,xt+1))}let ct=!1,pt=-1;if(s&&a&&a.v7_partialHydration)for(let xt=0;xt<nt.length;xt++){let St=nt[xt];if((St.route.HydrateFallback||St.route.hydrateFallbackElement)&&(pt=xt),St.route.id){let{loaderData:Et,errors:Rt}=s,Nt=St.route.loader&&Et[St.route.id]===void 0&&(!Rt||Rt[St.route.id]===void 0);if(St.route.lazy||Nt){ct=!0,pt>=0?nt=nt.slice(0,pt+1):nt=[nt[0]];break}}}return nt.reduceRight((xt,St,Et)=>{let Rt,Nt=!1,It=null,Gt=null;s&&(Rt=c&&St.route.id?c[St.route.id]:void 0,It=St.route.errorElement||defaultErrorElement,ct&&(pt<0&&Et===0?(Nt=!0,Gt=null):pt===Et&&(Nt=!0,Gt=St.route.hydrateFallbackElement||null)));let Dt=i.concat(nt.slice(0,Et+1)),Bt=()=>{let Lt;return Rt?Lt=It:Nt?Lt=Gt:St.route.Component?Lt=reactExports.createElement(St.route.Component,null):St.route.element?Lt=St.route.element:Lt=xt,reactExports.createElement(RenderedRoute,{match:St,routeContext:{outlet:xt,matches:Dt,isDataRoute:s!=null},children:Lt})};return s&&(St.route.ErrorBoundary||St.route.errorElement||Et===0)?reactExports.createElement(RenderErrorBoundary,{location:s.location,revalidation:s.revalidation,component:It,error:Rt,children:Bt(),routeContext:{outlet:null,matches:Dt,isDataRoute:!0}}):Bt()},null)}var DataRouterHook$1=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(DataRouterHook$1||{}),DataRouterStateHook$1=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(DataRouterStateHook$1||{});function useDataRouterContext(e){let i=reactExports.useContext(DataRouterContext);return i||invariant$1(!1),i}function useDataRouterState(e){let i=reactExports.useContext(DataRouterStateContext);return i||invariant$1(!1),i}function useRouteContext(e){let i=reactExports.useContext(RouteContext);return i||invariant$1(!1),i}function useCurrentRouteId(e){let i=useRouteContext(),s=i.matches[i.matches.length-1];return s.route.id||invariant$1(!1),s.route.id}function useRouteError(){var e;let i=reactExports.useContext(RouteErrorContext),s=useDataRouterState(DataRouterStateHook$1.UseRouteError),a=useCurrentRouteId(DataRouterStateHook$1.UseRouteError);return i!==void 0?i:(e=s.errors)==null?void 0:e[a]}function useNavigateStable(){let{router:e}=useDataRouterContext(DataRouterHook$1.UseNavigateStable),i=useCurrentRouteId(DataRouterStateHook$1.UseNavigateStable),s=reactExports.useRef(!1);return useIsomorphicLayoutEffect$2(()=>{s.current=!0}),reactExports.useCallback(function(b,et){et===void 0&&(et={}),s.current&&(typeof b=="number"?e.navigate(b):e.navigate(b,_extends$1({fromRouteId:i},et)))},[e,i])}function logV6DeprecationWarnings(e,i){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function Navigate(e){let{to:i,replace:s,state:a,relative:b}=e;useInRouterContext()||invariant$1(!1);let{future:et,static:nt}=reactExports.useContext(NavigationContext),{matches:c}=reactExports.useContext(RouteContext),{pathname:ct}=useLocation(),pt=useNavigate(),xt=resolveTo(i,getResolveToMatches(c,et.v7_relativeSplatPath),ct,b==="path"),St=JSON.stringify(xt);return reactExports.useEffect(()=>pt(JSON.parse(St),{replace:s,state:a,relative:b}),[pt,St,b,s,a]),null}function Route(e){invariant$1(!1)}function Router(e){let{basename:i="/",children:s=null,location:a,navigationType:b=Action$1.Pop,navigator:et,static:nt=!1,future:c}=e;useInRouterContext()&&invariant$1(!1);let ct=i.replace(/^\/*/,"/"),pt=reactExports.useMemo(()=>({basename:ct,navigator:et,static:nt,future:_extends$1({v7_relativeSplatPath:!1},c)}),[ct,c,et,nt]);typeof a=="string"&&(a=parsePath(a));let{pathname:xt="/",search:St="",hash:Et="",state:Rt=null,key:Nt="default"}=a,It=reactExports.useMemo(()=>{let Gt=stripBasename(xt,ct);return Gt==null?null:{location:{pathname:Gt,search:St,hash:Et,state:Rt,key:Nt},navigationType:b}},[ct,xt,St,Et,Rt,Nt,b]);return It==null?null:reactExports.createElement(NavigationContext.Provider,{value:pt},reactExports.createElement(LocationContext$1.Provider,{children:s,value:It}))}function Routes(e){let{children:i,location:s}=e;return useRoutes(createRoutesFromChildren(i),s)}new Promise(()=>{});function createRoutesFromChildren(e,i){i===void 0&&(i=[]);let s=[];return reactExports.Children.forEach(e,(a,b)=>{if(!reactExports.isValidElement(a))return;let et=[...i,b];if(a.type===reactExports.Fragment){s.push.apply(s,createRoutesFromChildren(a.props.children,et));return}a.type!==Route&&invariant$1(!1),!a.props.index||!a.props.children||invariant$1(!1);let nt={id:a.props.id||et.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(nt.children=createRoutesFromChildren(a.props.children,et)),s.push(nt)}),s}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},_extends.apply(this,arguments)}function _objectWithoutPropertiesLoose$1(e,i){if(e==null)return{};var s={},a=Object.keys(e),b,et;for(et=0;et<a.length;et++)b=a[et],!(i.indexOf(b)>=0)&&(s[b]=e[b]);return s}function isModifiedEvent(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function shouldProcessLinkClick(e,i){return e.button===0&&(!i||i==="_self")&&!isModifiedEvent(e)}const _excluded$2=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],REACT_ROUTER_VERSION="6";try{window.__reactRouterVersion=REACT_ROUTER_VERSION}catch{}const START_TRANSITION="startTransition",startTransitionImpl=React$1[START_TRANSITION];function BrowserRouter(e){let{basename:i,children:s,future:a,window:b}=e,et=reactExports.useRef();et.current==null&&(et.current=createBrowserHistory({window:b,v5Compat:!0}));let nt=et.current,[c,ct]=reactExports.useState({action:nt.action,location:nt.location}),{v7_startTransition:pt}=a||{},xt=reactExports.useCallback(St=>{pt&&startTransitionImpl?startTransitionImpl(()=>ct(St)):ct(St)},[ct,pt]);return reactExports.useLayoutEffect(()=>nt.listen(xt),[nt,xt]),reactExports.useEffect(()=>logV6DeprecationWarnings(a),[a]),reactExports.createElement(Router,{basename:i,children:s,location:c.location,navigationType:c.action,navigator:nt,future:a})}const isBrowser$1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ABSOLUTE_URL_REGEX=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Link=reactExports.forwardRef(function(i,s){let{onClick:a,relative:b,reloadDocument:et,replace:nt,state:c,target:ct,to:pt,preventScrollReset:xt,viewTransition:St}=i,Et=_objectWithoutPropertiesLoose$1(i,_excluded$2),{basename:Rt}=reactExports.useContext(NavigationContext),Nt,It=!1;if(typeof pt=="string"&&ABSOLUTE_URL_REGEX.test(pt)&&(Nt=pt,isBrowser$1))try{let Lt=new URL(window.location.href),Vt=pt.startsWith("//")?new URL(Lt.protocol+pt):new URL(pt),Zt=stripBasename(Vt.pathname,Rt);Vt.origin===Lt.origin&&Zt!=null?pt=Zt+Vt.search+Vt.hash:It=!0}catch{}let Gt=useHref(pt,{relative:b}),Dt=useLinkClickHandler(pt,{replace:nt,state:c,target:ct,preventScrollReset:xt,relative:b,viewTransition:St});function Bt(Lt){a&&a(Lt),Lt.defaultPrevented||Dt(Lt)}return reactExports.createElement("a",_extends({},Et,{href:Nt||Gt,onClick:It||et?a:Bt,ref:s,target:ct}))});var DataRouterHook;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(DataRouterHook||(DataRouterHook={}));var DataRouterStateHook;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(DataRouterStateHook||(DataRouterStateHook={}));function useLinkClickHandler(e,i){let{target:s,replace:a,state:b,preventScrollReset:et,relative:nt,viewTransition:c}=i===void 0?{}:i,ct=useNavigate(),pt=useLocation(),xt=useResolvedPath(e,{relative:nt});return reactExports.useCallback(St=>{if(shouldProcessLinkClick(St,s)){St.preventDefault();let Et=a!==void 0?a:createPath(pt)===createPath(xt);ct(e,{replace:Et,state:b,preventScrollReset:et,relative:nt,viewTransition:c})}},[pt,ct,xt,a,b,s,e,et,nt,c])}const getDefaultsFromPostinstall=()=>{};var define_process_env_default$1={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CONSTANTS={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const assert=function(e,i){if(!e)throw assertionError(i)},assertionError=function(e){return new Error("Firebase Database ("+CONSTANTS.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const stringToByteArray$1=function(e){const i=[];let s=0;for(let a=0;a<e.length;a++){let b=e.charCodeAt(a);b<128?i[s++]=b:b<2048?(i[s++]=b>>6|192,i[s++]=b&63|128):(b&64512)===55296&&a+1<e.length&&(e.charCodeAt(a+1)&64512)===56320?(b=65536+((b&1023)<<10)+(e.charCodeAt(++a)&1023),i[s++]=b>>18|240,i[s++]=b>>12&63|128,i[s++]=b>>6&63|128,i[s++]=b&63|128):(i[s++]=b>>12|224,i[s++]=b>>6&63|128,i[s++]=b&63|128)}return i},byteArrayToString=function(e){const i=[];let s=0,a=0;for(;s<e.length;){const b=e[s++];if(b<128)i[a++]=String.fromCharCode(b);else if(b>191&&b<224){const et=e[s++];i[a++]=String.fromCharCode((b&31)<<6|et&63)}else if(b>239&&b<365){const et=e[s++],nt=e[s++],c=e[s++],ct=((b&7)<<18|(et&63)<<12|(nt&63)<<6|c&63)-65536;i[a++]=String.fromCharCode(55296+(ct>>10)),i[a++]=String.fromCharCode(56320+(ct&1023))}else{const et=e[s++],nt=e[s++];i[a++]=String.fromCharCode((b&15)<<12|(et&63)<<6|nt&63)}}return i.join("")},base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,i){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=i?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let b=0;b<e.length;b+=3){const et=e[b],nt=b+1<e.length,c=nt?e[b+1]:0,ct=b+2<e.length,pt=ct?e[b+2]:0,xt=et>>2,St=(et&3)<<4|c>>4;let Et=(c&15)<<2|pt>>6,Rt=pt&63;ct||(Rt=64,nt||(Et=64)),a.push(s[xt],s[St],s[Et],s[Rt])}return a.join("")},encodeString(e,i){return this.HAS_NATIVE_SUPPORT&&!i?btoa(e):this.encodeByteArray(stringToByteArray$1(e),i)},decodeString(e,i){return this.HAS_NATIVE_SUPPORT&&!i?atob(e):byteArrayToString(this.decodeStringToByteArray(e,i))},decodeStringToByteArray(e,i){this.init_();const s=i?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let b=0;b<e.length;){const et=s[e.charAt(b++)],c=b<e.length?s[e.charAt(b)]:0;++b;const pt=b<e.length?s[e.charAt(b)]:64;++b;const St=b<e.length?s[e.charAt(b)]:64;if(++b,et==null||c==null||pt==null||St==null)throw new DecodeBase64StringError;const Et=et<<2|c>>4;if(a.push(Et),pt!==64){const Rt=c<<4&240|pt>>2;if(a.push(Rt),St!==64){const Nt=pt<<6&192|St;a.push(Nt)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class DecodeBase64StringError extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const base64Encode=function(e){const i=stringToByteArray$1(e);return base64.encodeByteArray(i,!0)},base64urlEncodeWithoutPadding=function(e){return base64Encode(e).replace(/\./g,"")},base64Decode=function(e){try{return base64.decodeString(e,!0)}catch(i){console.error("base64Decode failed: ",i)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function deepCopy(e){return deepExtend(void 0,e)}function deepExtend(e,i){if(!(i instanceof Object))return i;switch(i.constructor){case Date:const s=i;return new Date(s.getTime());case Object:e===void 0&&(e={});break;case Array:e=[];break;default:return i}for(const s in i)!i.hasOwnProperty(s)||!isValidKey$1(s)||(e[s]=deepExtend(e[s],i[s]));return e}function isValidKey$1(e){return e!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getGlobal(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const getDefaultsFromGlobal=()=>getGlobal().__FIREBASE_DEFAULTS__,getDefaultsFromEnvVariable=()=>{if(typeof process>"u"||typeof define_process_env_default$1>"u")return;const e=define_process_env_default$1.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},getDefaultsFromCookie=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const i=e&&base64Decode(e[1]);return i&&JSON.parse(i)},getDefaults=()=>{try{return getDefaultsFromPostinstall()||getDefaultsFromGlobal()||getDefaultsFromEnvVariable()||getDefaultsFromCookie()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},getDefaultEmulatorHost=e=>{var i,s;return(s=(i=getDefaults())==null?void 0:i.emulatorHosts)==null?void 0:s[e]},getDefaultEmulatorHostnameAndPort=e=>{const i=getDefaultEmulatorHost(e);if(!i)return;const s=i.lastIndexOf(":");if(s<=0||s+1===i.length)throw new Error(`Invalid host ${i} with no separate hostname and port!`);const a=parseInt(i.substring(s+1),10);return i[0]==="["?[i.substring(1,s-1),a]:[i.substring(0,s),a]},getDefaultAppConfig=()=>{var e;return(e=getDefaults())==null?void 0:e.config},getExperimentalSetting=e=>{var i;return(i=getDefaults())==null?void 0:i[`_${e}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Deferred{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((i,s)=>{this.resolve=i,this.reject=s})}wrapCallback(i){return(s,a)=>{s?this.reject(s):this.resolve(a),typeof i=="function"&&(this.promise.catch(()=>{}),i.length===1?i(s):i(s,a))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isCloudWorkstation(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function pingServer(e){return(await fetch(e,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function createMockUserToken(e,i){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},a=i||"demo-project",b=e.iat||0,et=e.sub||e.user_id;if(!et)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const nt={iss:`https://securetoken.google.com/${a}`,aud:a,iat:b,exp:b+3600,auth_time:b,sub:et,user_id:et,firebase:{sign_in_provider:"custom",identities:{}},...e};return[base64urlEncodeWithoutPadding(JSON.stringify(s)),base64urlEncodeWithoutPadding(JSON.stringify(nt)),""].join(".")}const emulatorStatus={};function getEmulatorSummary(){const e={prod:[],emulator:[]};for(const i of Object.keys(emulatorStatus))emulatorStatus[i]?e.emulator.push(i):e.prod.push(i);return e}function getOrCreateEl(e){let i=document.getElementById(e),s=!1;return i||(i=document.createElement("div"),i.setAttribute("id",e),s=!0),{created:s,element:i}}let previouslyDismissed=!1;function updateEmulatorBanner(e,i){if(typeof window>"u"||typeof document>"u"||!isCloudWorkstation(window.location.host)||emulatorStatus[e]===i||emulatorStatus[e]||previouslyDismissed)return;emulatorStatus[e]=i;function s(Et){return`__firebase__banner__${Et}`}const a="__firebase__banner",et=getEmulatorSummary().prod.length>0;function nt(){const Et=document.getElementById(a);Et&&Et.remove()}function c(Et){Et.style.display="flex",Et.style.background="#7faaf0",Et.style.position="fixed",Et.style.bottom="5px",Et.style.left="5px",Et.style.padding=".5em",Et.style.borderRadius="5px",Et.style.alignItems="center"}function ct(Et,Rt){Et.setAttribute("width","24"),Et.setAttribute("id",Rt),Et.setAttribute("height","24"),Et.setAttribute("viewBox","0 0 24 24"),Et.setAttribute("fill","none"),Et.style.marginLeft="-6px"}function pt(){const Et=document.createElement("span");return Et.style.cursor="pointer",Et.style.marginLeft="16px",Et.style.fontSize="24px",Et.innerHTML=" &times;",Et.onclick=()=>{previouslyDismissed=!0,nt()},Et}function xt(Et,Rt){Et.setAttribute("id",Rt),Et.innerText="Learn more",Et.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",Et.setAttribute("target","__blank"),Et.style.paddingLeft="5px",Et.style.textDecoration="underline"}function St(){const Et=getOrCreateEl(a),Rt=s("text"),Nt=document.getElementById(Rt)||document.createElement("span"),It=s("learnmore"),Gt=document.getElementById(It)||document.createElement("a"),Dt=s("preprendIcon"),Bt=document.getElementById(Dt)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(Et.created){const Lt=Et.element;c(Lt),xt(Gt,It);const Vt=pt();ct(Bt,Dt),Lt.append(Bt,Nt,Gt,Vt),document.body.appendChild(Lt)}et?(Nt.innerText="Preview backend disconnected.",Bt.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(Bt.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,Nt.innerText="Preview backend running in this workspace."),Nt.setAttribute("id",Rt)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",St):St()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getUA(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function isMobileCordova(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA())}function isCloudflareWorker(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function isBrowserExtension(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function isReactNative(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function isIE(){const e=getUA();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function isNodeSdk(){return CONSTANTS.NODE_ADMIN===!0}function isIndexedDBAvailable(){try{return typeof indexedDB=="object"}catch{return!1}}function validateIndexedDBOpenable(){return new Promise((e,i)=>{try{let s=!0;const a="validate-browser-context-for-indexeddb-analytics-module",b=self.indexedDB.open(a);b.onsuccess=()=>{b.result.close(),s||self.indexedDB.deleteDatabase(a),e(!0)},b.onupgradeneeded=()=>{s=!1},b.onerror=()=>{var et;i(((et=b.error)==null?void 0:et.message)||"")}}catch(s){i(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERROR_NAME="FirebaseError";class FirebaseError extends Error{constructor(i,s,a){super(s),this.code=i,this.customData=a,this.name=ERROR_NAME,Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}}class ErrorFactory{constructor(i,s,a){this.service=i,this.serviceName=s,this.errors=a}create(i,...s){const a=s[0]||{},b=`${this.service}/${i}`,et=this.errors[i],nt=et?replaceTemplate(et,a):"Error",c=`${this.serviceName}: ${nt} (${b}).`;return new FirebaseError(b,c,a)}}function replaceTemplate(e,i){return e.replace(PATTERN,(s,a)=>{const b=i[a];return b!=null?String(b):`<${a}?>`})}const PATTERN=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jsonEval(e){return JSON.parse(e)}function stringify(e){return JSON.stringify(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const decode=function(e){let i={},s={},a={},b="";try{const et=e.split(".");i=jsonEval(base64Decode(et[0])||""),s=jsonEval(base64Decode(et[1])||""),b=et[2],a=s.d||{},delete s.d}catch{}return{header:i,claims:s,data:a,signature:b}},isValidFormat=function(e){const i=decode(e),s=i.claims;return!!s&&typeof s=="object"&&s.hasOwnProperty("iat")},isAdmin=function(e){const i=decode(e).claims;return typeof i=="object"&&i.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function contains(e,i){return Object.prototype.hasOwnProperty.call(e,i)}function safeGet(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]}function isEmpty(e){for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i))return!1;return!0}function map(e,i,s){const a={};for(const b in e)Object.prototype.hasOwnProperty.call(e,b)&&(a[b]=i.call(s,e[b],b,e));return a}function deepEqual(e,i){if(e===i)return!0;const s=Object.keys(e),a=Object.keys(i);for(const b of s){if(!a.includes(b))return!1;const et=e[b],nt=i[b];if(isObject$1(et)&&isObject$1(nt)){if(!deepEqual(et,nt))return!1}else if(et!==nt)return!1}for(const b of a)if(!s.includes(b))return!1;return!0}function isObject$1(e){return e!==null&&typeof e=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function querystring(e){const i=[];for(const[s,a]of Object.entries(e))Array.isArray(a)?a.forEach(b=>{i.push(encodeURIComponent(s)+"="+encodeURIComponent(b))}):i.push(encodeURIComponent(s)+"="+encodeURIComponent(a));return i.length?"&"+i.join("&"):""}function querystringDecode(e){const i={};return e.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[b,et]=a.split("=");i[decodeURIComponent(b)]=decodeURIComponent(et)}}),i}function extractQuerystring(e){const i=e.indexOf("?");if(!i)return"";const s=e.indexOf("#",i);return e.substring(i,s>0?s:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sha1{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let i=1;i<this.blockSize;++i)this.pad_[i]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(i,s){s||(s=0);const a=this.W_;if(typeof i=="string")for(let St=0;St<16;St++)a[St]=i.charCodeAt(s)<<24|i.charCodeAt(s+1)<<16|i.charCodeAt(s+2)<<8|i.charCodeAt(s+3),s+=4;else for(let St=0;St<16;St++)a[St]=i[s]<<24|i[s+1]<<16|i[s+2]<<8|i[s+3],s+=4;for(let St=16;St<80;St++){const Et=a[St-3]^a[St-8]^a[St-14]^a[St-16];a[St]=(Et<<1|Et>>>31)&4294967295}let b=this.chain_[0],et=this.chain_[1],nt=this.chain_[2],c=this.chain_[3],ct=this.chain_[4],pt,xt;for(let St=0;St<80;St++){St<40?St<20?(pt=c^et&(nt^c),xt=1518500249):(pt=et^nt^c,xt=1859775393):St<60?(pt=et&nt|c&(et|nt),xt=2400959708):(pt=et^nt^c,xt=3395469782);const Et=(b<<5|b>>>27)+pt+ct+xt+a[St]&4294967295;ct=c,c=nt,nt=(et<<30|et>>>2)&4294967295,et=b,b=Et}this.chain_[0]=this.chain_[0]+b&4294967295,this.chain_[1]=this.chain_[1]+et&4294967295,this.chain_[2]=this.chain_[2]+nt&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+ct&4294967295}update(i,s){if(i==null)return;s===void 0&&(s=i.length);const a=s-this.blockSize;let b=0;const et=this.buf_;let nt=this.inbuf_;for(;b<s;){if(nt===0)for(;b<=a;)this.compress_(i,b),b+=this.blockSize;if(typeof i=="string"){for(;b<s;)if(et[nt]=i.charCodeAt(b),++nt,++b,nt===this.blockSize){this.compress_(et),nt=0;break}}else for(;b<s;)if(et[nt]=i[b],++nt,++b,nt===this.blockSize){this.compress_(et),nt=0;break}}this.inbuf_=nt,this.total_+=s}digest(){const i=[];let s=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let b=this.blockSize-1;b>=56;b--)this.buf_[b]=s&255,s/=256;this.compress_(this.buf_);let a=0;for(let b=0;b<5;b++)for(let et=24;et>=0;et-=8)i[a]=this.chain_[b]>>et&255,++a;return i}}function createSubscribe(e,i){const s=new ObserverProxy(e,i);return s.subscribe.bind(s)}class ObserverProxy{constructor(i,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{i(this)}).catch(a=>{this.error(a)})}next(i){this.forEachObserver(s=>{s.next(i)})}error(i){this.forEachObserver(s=>{s.error(i)}),this.close(i)}complete(){this.forEachObserver(i=>{i.complete()}),this.close()}subscribe(i,s,a){let b;if(i===void 0&&s===void 0&&a===void 0)throw new Error("Missing Observer.");implementsAnyMethods(i,["next","error","complete"])?b=i:b={next:i,error:s,complete:a},b.next===void 0&&(b.next=noop$1),b.error===void 0&&(b.error=noop$1),b.complete===void 0&&(b.complete=noop$1);const et=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?b.error(this.finalError):b.complete()}catch{}}),this.observers.push(b),et}unsubscribeOne(i){this.observers===void 0||this.observers[i]===void 0||(delete this.observers[i],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(i){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,i)}sendOne(i,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[i]!==void 0)try{s(this.observers[i])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(i){this.finalized||(this.finalized=!0,i!==void 0&&(this.finalError=i),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function implementsAnyMethods(e,i){if(typeof e!="object"||e===null)return!1;for(const s of i)if(s in e&&typeof e[s]=="function")return!0;return!1}function noop$1(){}function errorPrefix(e,i){return`${e} failed: ${i} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const stringToByteArray=function(e){const i=[];let s=0;for(let a=0;a<e.length;a++){let b=e.charCodeAt(a);if(b>=55296&&b<=56319){const et=b-55296;a++,assert(a<e.length,"Surrogate pair missing trail surrogate.");const nt=e.charCodeAt(a)-56320;b=65536+(et<<10)+nt}b<128?i[s++]=b:b<2048?(i[s++]=b>>6|192,i[s++]=b&63|128):b<65536?(i[s++]=b>>12|224,i[s++]=b>>6&63|128,i[s++]=b&63|128):(i[s++]=b>>18|240,i[s++]=b>>12&63|128,i[s++]=b>>6&63|128,i[s++]=b&63|128)}return i},stringLength=function(e){let i=0;for(let s=0;s<e.length;s++){const a=e.charCodeAt(s);a<128?i++:a<2048?i+=2:a>=55296&&a<=56319?(i+=4,s++):i+=3}return i};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getModularInstance(e){return e&&e._delegate?e._delegate:e}class Component{constructor(i,s,a){this.name=i,this.instanceFactory=s,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(i){return this.instantiationMode=i,this}setMultipleInstances(i){return this.multipleInstances=i,this}setServiceProps(i){return this.serviceProps=i,this}setInstanceCreatedCallback(i){return this.onInstanceCreated=i,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME$1="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Provider{constructor(i,s){this.name=i,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(i){const s=this.normalizeInstanceIdentifier(i);if(!this.instancesDeferred.has(s)){const a=new Deferred;if(this.instancesDeferred.set(s,a),this.isInitialized(s)||this.shouldAutoInitialize())try{const b=this.getOrInitializeService({instanceIdentifier:s});b&&a.resolve(b)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(i){const s=this.normalizeInstanceIdentifier(i==null?void 0:i.identifier),a=(i==null?void 0:i.optional)??!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(b){if(a)return null;throw b}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(i){if(i.name!==this.name)throw Error(`Mismatching Component ${i.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=i,!!this.shouldAutoInitialize()){if(isComponentEager(i))try{this.getOrInitializeService({instanceIdentifier:DEFAULT_ENTRY_NAME$1})}catch{}for(const[s,a]of this.instancesDeferred.entries()){const b=this.normalizeInstanceIdentifier(s);try{const et=this.getOrInitializeService({instanceIdentifier:b});a.resolve(et)}catch{}}}}clearInstance(i=DEFAULT_ENTRY_NAME$1){this.instancesDeferred.delete(i),this.instancesOptions.delete(i),this.instances.delete(i)}async delete(){const i=Array.from(this.instances.values());await Promise.all([...i.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...i.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(i=DEFAULT_ENTRY_NAME$1){return this.instances.has(i)}getOptions(i=DEFAULT_ENTRY_NAME$1){return this.instancesOptions.get(i)||{}}initialize(i={}){const{options:s={}}=i,a=this.normalizeInstanceIdentifier(i.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const b=this.getOrInitializeService({instanceIdentifier:a,options:s});for(const[et,nt]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(et);a===c&&nt.resolve(b)}return b}onInit(i,s){const a=this.normalizeInstanceIdentifier(s),b=this.onInitCallbacks.get(a)??new Set;b.add(i),this.onInitCallbacks.set(a,b);const et=this.instances.get(a);return et&&i(et,a),()=>{b.delete(i)}}invokeOnInitCallbacks(i,s){const a=this.onInitCallbacks.get(s);if(a)for(const b of a)try{b(i,s)}catch{}}getOrInitializeService({instanceIdentifier:i,options:s={}}){let a=this.instances.get(i);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:normalizeIdentifierForFactory(i),options:s}),this.instances.set(i,a),this.instancesOptions.set(i,s),this.invokeOnInitCallbacks(a,i),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,i,a)}catch{}return a||null}normalizeInstanceIdentifier(i=DEFAULT_ENTRY_NAME$1){return this.component?this.component.multipleInstances?i:DEFAULT_ENTRY_NAME$1:i}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function normalizeIdentifierForFactory(e){return e===DEFAULT_ENTRY_NAME$1?void 0:e}function isComponentEager(e){return e.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ComponentContainer{constructor(i){this.name=i,this.providers=new Map}addComponent(i){const s=this.getProvider(i.name);if(s.isComponentSet())throw new Error(`Component ${i.name} has already been registered with ${this.name}`);s.setComponent(i)}addOrOverwriteComponent(i){this.getProvider(i.name).isComponentSet()&&this.providers.delete(i.name),this.addComponent(i)}getProvider(i){if(this.providers.has(i))return this.providers.get(i);const s=new Provider(i,this);return this.providers.set(i,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var LogLevel;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(LogLevel||(LogLevel={}));const levelStringToEnum={debug:LogLevel.DEBUG,verbose:LogLevel.VERBOSE,info:LogLevel.INFO,warn:LogLevel.WARN,error:LogLevel.ERROR,silent:LogLevel.SILENT},defaultLogLevel=LogLevel.INFO,ConsoleMethod={[LogLevel.DEBUG]:"log",[LogLevel.VERBOSE]:"log",[LogLevel.INFO]:"info",[LogLevel.WARN]:"warn",[LogLevel.ERROR]:"error"},defaultLogHandler=(e,i,...s)=>{if(i<e.logLevel)return;const a=new Date().toISOString(),b=ConsoleMethod[i];if(b)console[b](`[${a}]  ${e.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${i})`)};class Logger{constructor(i){this.name=i,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(i){if(!(i in LogLevel))throw new TypeError(`Invalid value "${i}" assigned to \`logLevel\``);this._logLevel=i}setLogLevel(i){this._logLevel=typeof i=="string"?levelStringToEnum[i]:i}get logHandler(){return this._logHandler}set logHandler(i){if(typeof i!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=i}get userLogHandler(){return this._userLogHandler}set userLogHandler(i){this._userLogHandler=i}debug(...i){this._userLogHandler&&this._userLogHandler(this,LogLevel.DEBUG,...i),this._logHandler(this,LogLevel.DEBUG,...i)}log(...i){this._userLogHandler&&this._userLogHandler(this,LogLevel.VERBOSE,...i),this._logHandler(this,LogLevel.VERBOSE,...i)}info(...i){this._userLogHandler&&this._userLogHandler(this,LogLevel.INFO,...i),this._logHandler(this,LogLevel.INFO,...i)}warn(...i){this._userLogHandler&&this._userLogHandler(this,LogLevel.WARN,...i),this._logHandler(this,LogLevel.WARN,...i)}error(...i){this._userLogHandler&&this._userLogHandler(this,LogLevel.ERROR,...i),this._logHandler(this,LogLevel.ERROR,...i)}}const instanceOfAny=(e,i)=>i.some(s=>e instanceof s);let idbProxyableTypes,cursorAdvanceMethods;function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const cursorRequestMap=new WeakMap,transactionDoneMap=new WeakMap,transactionStoreNamesMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;function promisifyRequest(e){const i=new Promise((s,a)=>{const b=()=>{e.removeEventListener("success",et),e.removeEventListener("error",nt)},et=()=>{s(wrap(e.result)),b()},nt=()=>{a(e.error),b()};e.addEventListener("success",et),e.addEventListener("error",nt)});return i.then(s=>{s instanceof IDBCursor&&cursorRequestMap.set(s,e)}).catch(()=>{}),reverseTransformCache.set(i,e),i}function cacheDonePromiseForTransaction(e){if(transactionDoneMap.has(e))return;const i=new Promise((s,a)=>{const b=()=>{e.removeEventListener("complete",et),e.removeEventListener("error",nt),e.removeEventListener("abort",nt)},et=()=>{s(),b()},nt=()=>{a(e.error||new DOMException("AbortError","AbortError")),b()};e.addEventListener("complete",et),e.addEventListener("error",nt),e.addEventListener("abort",nt)});transactionDoneMap.set(e,i)}let idbProxyTraps={get(e,i,s){if(e instanceof IDBTransaction){if(i==="done")return transactionDoneMap.get(e);if(i==="objectStoreNames")return e.objectStoreNames||transactionStoreNamesMap.get(e);if(i==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return wrap(e[i])},set(e,i,s){return e[i]=s,!0},has(e,i){return e instanceof IDBTransaction&&(i==="done"||i==="store")?!0:i in e}};function replaceTraps(e){idbProxyTraps=e(idbProxyTraps)}function wrapFunction(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(i,...s){const a=e.call(unwrap(this),i,...s);return transactionStoreNamesMap.set(a,i.sort?i.sort():[i]),wrap(a)}:getCursorAdvanceMethods().includes(e)?function(...i){return e.apply(unwrap(this),i),wrap(cursorRequestMap.get(this))}:function(...i){return wrap(e.apply(unwrap(this),i))}}function transformCachableValue(e){return typeof e=="function"?wrapFunction(e):(e instanceof IDBTransaction&&cacheDonePromiseForTransaction(e),instanceOfAny(e,getIdbProxyableTypes())?new Proxy(e,idbProxyTraps):e)}function wrap(e){if(e instanceof IDBRequest)return promisifyRequest(e);if(transformCache.has(e))return transformCache.get(e);const i=transformCachableValue(e);return i!==e&&(transformCache.set(e,i),reverseTransformCache.set(i,e)),i}const unwrap=e=>reverseTransformCache.get(e);function openDB(e,i,{blocked:s,upgrade:a,blocking:b,terminated:et}={}){const nt=indexedDB.open(e,i),c=wrap(nt);return a&&nt.addEventListener("upgradeneeded",ct=>{a(wrap(nt.result),ct.oldVersion,ct.newVersion,wrap(nt.transaction),ct)}),s&&nt.addEventListener("blocked",ct=>s(ct.oldVersion,ct.newVersion,ct)),c.then(ct=>{et&&ct.addEventListener("close",()=>et()),b&&ct.addEventListener("versionchange",pt=>b(pt.oldVersion,pt.newVersion,pt))}).catch(()=>{}),c}const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(e,i){if(!(e instanceof IDBDatabase&&!(i in e)&&typeof i=="string"))return;if(cachedMethods.get(i))return cachedMethods.get(i);const s=i.replace(/FromIndex$/,""),a=i!==s,b=writeMethods.includes(s);if(!(s in(a?IDBIndex:IDBObjectStore).prototype)||!(b||readMethods.includes(s)))return;const et=async function(nt,...c){const ct=this.transaction(nt,b?"readwrite":"readonly");let pt=ct.store;return a&&(pt=pt.index(c.shift())),(await Promise.all([pt[s](...c),b&&ct.done]))[0]};return cachedMethods.set(i,et),et}replaceTraps(e=>({...e,get:(i,s,a)=>getMethod(i,s)||e.get(i,s,a),has:(i,s)=>!!getMethod(i,s)||e.has(i,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PlatformLoggerServiceImpl{constructor(i){this.container=i}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(isVersionServiceProvider(s)){const a=s.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(s=>s).join(" ")}}function isVersionServiceProvider(e){const i=e.getComponent();return(i==null?void 0:i.type)==="VERSION"}const name$q="@firebase/app",version$1$1="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logger$1=new Logger("@firebase/app"),name$p="@firebase/app-compat",name$o="@firebase/analytics-compat",name$n="@firebase/analytics",name$m="@firebase/app-check-compat",name$l="@firebase/app-check",name$k="@firebase/auth",name$j="@firebase/auth-compat",name$i="@firebase/database",name$h="@firebase/data-connect",name$g="@firebase/database-compat",name$f="@firebase/functions",name$e="@firebase/functions-compat",name$d="@firebase/installations",name$c="@firebase/installations-compat",name$b="@firebase/messaging",name$a="@firebase/messaging-compat",name$9="@firebase/performance",name$8="@firebase/performance-compat",name$7="@firebase/remote-config",name$6="@firebase/remote-config-compat",name$5="@firebase/storage",name$4="@firebase/storage-compat",name$3$1="@firebase/firestore",name$2$1="@firebase/ai",name$1$1="@firebase/firestore-compat",name$r="firebase",version$4="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME="[DEFAULT]",PLATFORM_LOG_STRING={[name$q]:"fire-core",[name$p]:"fire-core-compat",[name$n]:"fire-analytics",[name$o]:"fire-analytics-compat",[name$l]:"fire-app-check",[name$m]:"fire-app-check-compat",[name$k]:"fire-auth",[name$j]:"fire-auth-compat",[name$i]:"fire-rtdb",[name$h]:"fire-data-connect",[name$g]:"fire-rtdb-compat",[name$f]:"fire-fn",[name$e]:"fire-fn-compat",[name$d]:"fire-iid",[name$c]:"fire-iid-compat",[name$b]:"fire-fcm",[name$a]:"fire-fcm-compat",[name$9]:"fire-perf",[name$8]:"fire-perf-compat",[name$7]:"fire-rc",[name$6]:"fire-rc-compat",[name$5]:"fire-gcs",[name$4]:"fire-gcs-compat",[name$3$1]:"fire-fst",[name$1$1]:"fire-fst-compat",[name$2$1]:"fire-vertex","fire-js":"fire-js",[name$r]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _apps=new Map,_serverApps=new Map,_components=new Map;function _addComponent(e,i){try{e.container.addComponent(i)}catch(s){logger$1.debug(`Component ${i.name} failed to register with FirebaseApp ${e.name}`,s)}}function _registerComponent(e){const i=e.name;if(_components.has(i))return logger$1.debug(`There were multiple attempts to register component ${i}.`),!1;_components.set(i,e);for(const s of _apps.values())_addComponent(s,e);for(const s of _serverApps.values())_addComponent(s,e);return!0}function _getProvider(e,i){const s=e.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),e.container.getProvider(i)}function _isFirebaseServerApp(e){return e==null?!1:e.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERRORS={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ERROR_FACTORY=new ErrorFactory("app","Firebase",ERRORS);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FirebaseAppImpl{constructor(i,s,a){this._isDeleted=!1,this._options={...i},this._config={...s},this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Component("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(i){this.checkDestroyed(),this._automaticDataCollectionEnabled=i}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(i){this._isDeleted=i}checkDestroyed(){if(this.isDeleted)throw ERROR_FACTORY.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SDK_VERSION$1=version$4;function initializeApp(e,i={}){let s=e;typeof i!="object"&&(i={name:i});const a={name:DEFAULT_ENTRY_NAME,automaticDataCollectionEnabled:!0,...i},b=a.name;if(typeof b!="string"||!b)throw ERROR_FACTORY.create("bad-app-name",{appName:String(b)});if(s||(s=getDefaultAppConfig()),!s)throw ERROR_FACTORY.create("no-options");const et=_apps.get(b);if(et){if(deepEqual(s,et.options)&&deepEqual(a,et.config))return et;throw ERROR_FACTORY.create("duplicate-app",{appName:b})}const nt=new ComponentContainer(b);for(const ct of _components.values())nt.addComponent(ct);const c=new FirebaseAppImpl(s,a,nt);return _apps.set(b,c),c}function getApp(e=DEFAULT_ENTRY_NAME){const i=_apps.get(e);if(!i&&e===DEFAULT_ENTRY_NAME&&getDefaultAppConfig())return initializeApp();if(!i)throw ERROR_FACTORY.create("no-app",{appName:e});return i}function registerVersion(e,i,s){let a=PLATFORM_LOG_STRING[e]??e;s&&(a+=`-${s}`);const b=a.match(/\s|\//),et=i.match(/\s|\//);if(b||et){const nt=[`Unable to register library "${a}" with version "${i}":`];b&&nt.push(`library name "${a}" contains illegal characters (whitespace or "/")`),b&&et&&nt.push("and"),et&&nt.push(`version name "${i}" contains illegal characters (whitespace or "/")`),logger$1.warn(nt.join(" "));return}_registerComponent(new Component(`${a}-version`,()=>({library:a,version:i}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DB_NAME$1="firebase-heartbeat-database",DB_VERSION$1=1,STORE_NAME="firebase-heartbeat-store";let dbPromise=null;function getDbPromise(){return dbPromise||(dbPromise=openDB(DB_NAME$1,DB_VERSION$1,{upgrade:(e,i)=>{switch(i){case 0:try{e.createObjectStore(STORE_NAME)}catch(s){console.warn(s)}}}}).catch(e=>{throw ERROR_FACTORY.create("idb-open",{originalErrorMessage:e.message})})),dbPromise}async function readHeartbeatsFromIndexedDB(e){try{const s=(await getDbPromise()).transaction(STORE_NAME),a=await s.objectStore(STORE_NAME).get(computeKey(e));return await s.done,a}catch(i){if(i instanceof FirebaseError)logger$1.warn(i.message);else{const s=ERROR_FACTORY.create("idb-get",{originalErrorMessage:i==null?void 0:i.message});logger$1.warn(s.message)}}}async function writeHeartbeatsToIndexedDB(e,i){try{const a=(await getDbPromise()).transaction(STORE_NAME,"readwrite");await a.objectStore(STORE_NAME).put(i,computeKey(e)),await a.done}catch(s){if(s instanceof FirebaseError)logger$1.warn(s.message);else{const a=ERROR_FACTORY.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});logger$1.warn(a.message)}}}function computeKey(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MAX_HEADER_BYTES=1024,MAX_NUM_STORED_HEARTBEATS=30;class HeartbeatServiceImpl{constructor(i){this.container=i,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new HeartbeatStorageImpl(s),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var i,s;try{const b=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),et=getUTCDateString();if(((i=this._heartbeatsCache)==null?void 0:i.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)==null?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===et||this._heartbeatsCache.heartbeats.some(nt=>nt.date===et))return;if(this._heartbeatsCache.heartbeats.push({date:et,agent:b}),this._heartbeatsCache.heartbeats.length>MAX_NUM_STORED_HEARTBEATS){const nt=getEarliestHeartbeatIdx(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(nt,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){logger$1.warn(a)}}async getHeartbeatsHeader(){var i;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((i=this._heartbeatsCache)==null?void 0:i.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=getUTCDateString(),{heartbeatsToSend:a,unsentEntries:b}=extractHeartbeatsForHeader(this._heartbeatsCache.heartbeats),et=base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=s,b.length>0?(this._heartbeatsCache.heartbeats=b,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),et}catch(s){return logger$1.warn(s),""}}}function getUTCDateString(){return new Date().toISOString().substring(0,10)}function extractHeartbeatsForHeader(e,i=MAX_HEADER_BYTES){const s=[];let a=e.slice();for(const b of e){const et=s.find(nt=>nt.agent===b.agent);if(et){if(et.dates.push(b.date),countBytes(s)>i){et.dates.pop();break}}else if(s.push({agent:b.agent,dates:[b.date]}),countBytes(s)>i){s.pop();break}a=a.slice(1)}return{heartbeatsToSend:s,unsentEntries:a}}class HeartbeatStorageImpl{constructor(i){this.app=i,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return isIndexedDBAvailable()?validateIndexedDBOpenable().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await readHeartbeatsFromIndexedDB(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(i){if(await this._canUseIndexedDBPromise){const a=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:i.lastSentHeartbeatDate??a.lastSentHeartbeatDate,heartbeats:i.heartbeats})}else return}async add(i){if(await this._canUseIndexedDBPromise){const a=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:i.lastSentHeartbeatDate??a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...i.heartbeats]})}else return}}function countBytes(e){return base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:e})).length}function getEarliestHeartbeatIdx(e){if(e.length===0)return-1;let i=0,s=e[0].date;for(let a=1;a<e.length;a++)e[a].date<s&&(s=e[a].date,i=a);return i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function registerCoreComponents(e){_registerComponent(new Component("platform-logger",i=>new PlatformLoggerServiceImpl(i),"PRIVATE")),_registerComponent(new Component("heartbeat",i=>new HeartbeatServiceImpl(i),"PRIVATE")),registerVersion(name$q,version$1$1,e),registerVersion(name$q,version$1$1,"esm2020"),registerVersion("fire-js","")}registerCoreComponents("");function _prodErrorMap(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const prodErrorMap=_prodErrorMap,_DEFAULT_AUTH_ERROR_FACTORY=new ErrorFactory("auth","Firebase",_prodErrorMap());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logClient$1=new Logger("@firebase/auth");function _logWarn(e,...i){logClient$1.logLevel<=LogLevel.WARN&&logClient$1.warn(`Auth (${SDK_VERSION$1}): ${e}`,...i)}function _logError(e,...i){logClient$1.logLevel<=LogLevel.ERROR&&logClient$1.error(`Auth (${SDK_VERSION$1}): ${e}`,...i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _fail(e,...i){throw createErrorInternal(e,...i)}function _createError(e,...i){return createErrorInternal(e,...i)}function _errorWithCustomMessage(e,i,s){const a={...prodErrorMap(),[i]:s};return new ErrorFactory("auth","Firebase",a).create(i,{appName:e.name})}function _serverAppCurrentUserOperationNotSupportedError(e){return _errorWithCustomMessage(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function createErrorInternal(e,...i){if(typeof e!="string"){const s=i[0],a=[...i.slice(1)];return a[0]&&(a[0].appName=e.name),e._errorFactory.create(s,...a)}return _DEFAULT_AUTH_ERROR_FACTORY.create(e,...i)}function _assert(e,i,...s){if(!e)throw createErrorInternal(i,...s)}function debugFail(e){const i="INTERNAL ASSERTION FAILED: "+e;throw _logError(i),new Error(i)}function debugAssert(e,i){e||debugFail(i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _getCurrentUrl(){var e;return typeof self<"u"&&((e=self.location)==null?void 0:e.href)||""}function _isHttpOrHttps(){return _getCurrentScheme()==="http:"||_getCurrentScheme()==="https:"}function _getCurrentScheme(){var e;return typeof self<"u"&&((e=self.location)==null?void 0:e.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _isOnline(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(_isHttpOrHttps()||isBrowserExtension()||"connection"in navigator)?navigator.onLine:!0}function _getUserLanguage(){if(typeof navigator>"u")return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Delay{constructor(i,s){this.shortDelay=i,this.longDelay=s,debugAssert(s>i,"Short delay should be less than long delay!"),this.isMobile=isMobileCordova()||isReactNative()}get(){return _isOnline()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _emulatorUrl(e,i){debugAssert(e.emulator,"Emulator should always be set here");const{url:s}=e.emulator;return i?`${s}${i.startsWith("/")?i.slice(1):i}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FetchProvider{static initialize(i,s,a){this.fetchImpl=i,s&&(this.headersImpl=s),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;debugFail("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;debugFail("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;debugFail("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SERVER_ERROR_MAP={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CookieAuthProxiedEndpoints=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],DEFAULT_API_TIMEOUT_MS=new Delay(3e4,6e4);function _addTidIfNecessary(e,i){return e.tenantId&&!i.tenantId?{...i,tenantId:e.tenantId}:i}async function _performApiRequest(e,i,s,a,b={}){return _performFetchWithErrorHandling(e,b,async()=>{let et={},nt={};a&&(i==="GET"?nt=a:et={body:JSON.stringify(a)});const c=querystring({key:e.config.apiKey,...nt}).slice(1),ct=await e._getAdditionalHeaders();ct["Content-Type"]="application/json",e.languageCode&&(ct["X-Firebase-Locale"]=e.languageCode);const pt={method:i,headers:ct,...et};return isCloudflareWorker()||(pt.referrerPolicy="no-referrer"),e.emulatorConfig&&isCloudWorkstation(e.emulatorConfig.host)&&(pt.credentials="include"),FetchProvider.fetch()(await _getFinalTarget(e,e.config.apiHost,s,c),pt)})}async function _performFetchWithErrorHandling(e,i,s){e._canInitEmulator=!1;const a={...SERVER_ERROR_MAP,...i};try{const b=new NetworkTimeout(e),et=await Promise.race([s(),b.promise]);b.clearNetworkTimeout();const nt=await et.json();if("needConfirmation"in nt)throw _makeTaggedError(e,"account-exists-with-different-credential",nt);if(et.ok&&!("errorMessage"in nt))return nt;{const c=et.ok?nt.errorMessage:nt.error.message,[ct,pt]=c.split(" : ");if(ct==="FEDERATED_USER_ID_ALREADY_LINKED")throw _makeTaggedError(e,"credential-already-in-use",nt);if(ct==="EMAIL_EXISTS")throw _makeTaggedError(e,"email-already-in-use",nt);if(ct==="USER_DISABLED")throw _makeTaggedError(e,"user-disabled",nt);const xt=a[ct]||ct.toLowerCase().replace(/[_\s]+/g,"-");if(pt)throw _errorWithCustomMessage(e,xt,pt);_fail(e,xt)}}catch(b){if(b instanceof FirebaseError)throw b;_fail(e,"network-request-failed",{message:String(b)})}}async function _performSignInRequest(e,i,s,a,b={}){const et=await _performApiRequest(e,i,s,a,b);return"mfaPendingCredential"in et&&_fail(e,"multi-factor-auth-required",{_serverResponse:et}),et}async function _getFinalTarget(e,i,s,a){const b=`${i}${s}?${a}`,et=e,nt=et.config.emulator?_emulatorUrl(e.config,b):`${e.config.apiScheme}://${b}`;return CookieAuthProxiedEndpoints.includes(s)&&(await et._persistenceManagerAvailable,et._getPersistenceType()==="COOKIE")?et._getPersistence()._getFinalTarget(nt).toString():nt}function _parseEnforcementState(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class NetworkTimeout{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(i){this.auth=i,this.timer=null,this.promise=new Promise((s,a)=>{this.timer=setTimeout(()=>a(_createError(this.auth,"network-request-failed")),DEFAULT_API_TIMEOUT_MS.get())})}}function _makeTaggedError(e,i,s){const a={appName:e.name};s.email&&(a.email=s.email),s.phoneNumber&&(a.phoneNumber=s.phoneNumber);const b=_createError(e,i,a);return b.customData._tokenResponse=s,b}function isEnterprise(e){return e!==void 0&&e.enterprise!==void 0}class RecaptchaConfig{constructor(i){if(this.siteKey="",this.recaptchaEnforcementState=[],i.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=i.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=i.recaptchaEnforcementState}getProviderEnforcementState(i){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===i)return _parseEnforcementState(s.enforcementState);return null}isProviderEnabled(i){return this.getProviderEnforcementState(i)==="ENFORCE"||this.getProviderEnforcementState(i)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function getRecaptchaConfig(e,i){return _performApiRequest(e,"GET","/v2/recaptchaConfig",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function deleteAccount(e,i){return _performApiRequest(e,"POST","/v1/accounts:delete",i)}async function getAccountInfo(e,i){return _performApiRequest(e,"POST","/v1/accounts:lookup",i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function utcTimestampToDateString(e){if(e)try{const i=new Date(Number(e));if(!isNaN(i.getTime()))return i.toUTCString()}catch{}}async function getIdTokenResult(e,i=!1){const s=getModularInstance(e),a=await s.getIdToken(i),b=_parseToken(a);_assert(b&&b.exp&&b.auth_time&&b.iat,s.auth,"internal-error");const et=typeof b.firebase=="object"?b.firebase:void 0,nt=et==null?void 0:et.sign_in_provider;return{claims:b,token:a,authTime:utcTimestampToDateString(secondsStringToMilliseconds(b.auth_time)),issuedAtTime:utcTimestampToDateString(secondsStringToMilliseconds(b.iat)),expirationTime:utcTimestampToDateString(secondsStringToMilliseconds(b.exp)),signInProvider:nt||null,signInSecondFactor:(et==null?void 0:et.sign_in_second_factor)||null}}function secondsStringToMilliseconds(e){return Number(e)*1e3}function _parseToken(e){const[i,s,a]=e.split(".");if(i===void 0||s===void 0||a===void 0)return _logError("JWT malformed, contained fewer than 3 sections"),null;try{const b=base64Decode(s);return b?JSON.parse(b):(_logError("Failed to decode base64 JWT payload"),null)}catch(b){return _logError("Caught error parsing JWT payload as JSON",b==null?void 0:b.toString()),null}}function _tokenExpiresIn(e){const i=_parseToken(e);return _assert(i,"internal-error"),_assert(typeof i.exp<"u","internal-error"),_assert(typeof i.iat<"u","internal-error"),Number(i.exp)-Number(i.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _logoutIfInvalidated(e,i,s=!1){if(s)return i;try{return await i}catch(a){throw a instanceof FirebaseError&&isUserInvalidated(a)&&e.auth.currentUser===e&&await e.auth.signOut(),a}}function isUserInvalidated({code:e}){return e==="auth/user-disabled"||e==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ProactiveRefresh{constructor(i){this.user=i,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(i){if(i){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const a=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,a)}}schedule(i=!1){if(!this.isRunning)return;const s=this.getInterval(i);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(i){(i==null?void 0:i.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UserMetadata{constructor(i,s){this.createdAt=i,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=utcTimestampToDateString(this.lastLoginAt),this.creationTime=utcTimestampToDateString(this.createdAt)}_copy(i){this.createdAt=i.createdAt,this.lastLoginAt=i.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _reloadWithoutSaving(e){var St;const i=e.auth,s=await e.getIdToken(),a=await _logoutIfInvalidated(e,getAccountInfo(i,{idToken:s}));_assert(a==null?void 0:a.users.length,i,"internal-error");const b=a.users[0];e._notifyReloadListener(b);const et=(St=b.providerUserInfo)!=null&&St.length?extractProviderData(b.providerUserInfo):[],nt=mergeProviderData(e.providerData,et),c=e.isAnonymous,ct=!(e.email&&b.passwordHash)&&!(nt!=null&&nt.length),pt=c?ct:!1,xt={uid:b.localId,displayName:b.displayName||null,photoURL:b.photoUrl||null,email:b.email||null,emailVerified:b.emailVerified||!1,phoneNumber:b.phoneNumber||null,tenantId:b.tenantId||null,providerData:nt,metadata:new UserMetadata(b.createdAt,b.lastLoginAt),isAnonymous:pt};Object.assign(e,xt)}async function reload(e){const i=getModularInstance(e);await _reloadWithoutSaving(i),await i.auth._persistUserIfCurrent(i),i.auth._notifyListenersIfCurrent(i)}function mergeProviderData(e,i){return[...e.filter(a=>!i.some(b=>b.providerId===a.providerId)),...i]}function extractProviderData(e){return e.map(({providerId:i,...s})=>({providerId:i,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function requestStsToken(e,i){const s=await _performFetchWithErrorHandling(e,{},async()=>{const a=querystring({grant_type:"refresh_token",refresh_token:i}).slice(1),{tokenApiHost:b,apiKey:et}=e.config,nt=await _getFinalTarget(e,b,"/v1/token",`key=${et}`),c=await e._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";const ct={method:"POST",headers:c,body:a};return e.emulatorConfig&&isCloudWorkstation(e.emulatorConfig.host)&&(ct.credentials="include"),FetchProvider.fetch()(nt,ct)});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function revokeToken(e,i){return _performApiRequest(e,"POST","/v2/accounts:revokeToken",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StsTokenManager{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(i){_assert(i.idToken,"internal-error"),_assert(typeof i.idToken<"u","internal-error"),_assert(typeof i.refreshToken<"u","internal-error");const s="expiresIn"in i&&typeof i.expiresIn<"u"?Number(i.expiresIn):_tokenExpiresIn(i.idToken);this.updateTokensAndExpiration(i.idToken,i.refreshToken,s)}updateFromIdToken(i){_assert(i.length!==0,"internal-error");const s=_tokenExpiresIn(i);this.updateTokensAndExpiration(i,null,s)}async getToken(i,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(_assert(this.refreshToken,i,"user-token-expired"),this.refreshToken?(await this.refresh(i,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(i,s){const{accessToken:a,refreshToken:b,expiresIn:et}=await requestStsToken(i,s);this.updateTokensAndExpiration(a,b,Number(et))}updateTokensAndExpiration(i,s,a){this.refreshToken=s||null,this.accessToken=i||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(i,s){const{refreshToken:a,accessToken:b,expirationTime:et}=s,nt=new StsTokenManager;return a&&(_assert(typeof a=="string","internal-error",{appName:i}),nt.refreshToken=a),b&&(_assert(typeof b=="string","internal-error",{appName:i}),nt.accessToken=b),et&&(_assert(typeof et=="number","internal-error",{appName:i}),nt.expirationTime=et),nt}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(i){this.accessToken=i.accessToken,this.refreshToken=i.refreshToken,this.expirationTime=i.expirationTime}_clone(){return Object.assign(new StsTokenManager,this.toJSON())}_performRefresh(){return debugFail("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function assertStringOrUndefined(e,i){_assert(typeof e=="string"||typeof e>"u","internal-error",{appName:i})}class UserImpl{constructor({uid:i,auth:s,stsTokenManager:a,...b}){this.providerId="firebase",this.proactiveRefresh=new ProactiveRefresh(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=s,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=b.displayName||null,this.email=b.email||null,this.emailVerified=b.emailVerified||!1,this.phoneNumber=b.phoneNumber||null,this.photoURL=b.photoURL||null,this.isAnonymous=b.isAnonymous||!1,this.tenantId=b.tenantId||null,this.providerData=b.providerData?[...b.providerData]:[],this.metadata=new UserMetadata(b.createdAt||void 0,b.lastLoginAt||void 0)}async getIdToken(i){const s=await _logoutIfInvalidated(this,this.stsTokenManager.getToken(this.auth,i));return _assert(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(i){return getIdTokenResult(this,i)}reload(){return reload(this)}_assign(i){this!==i&&(_assert(this.uid===i.uid,this.auth,"internal-error"),this.displayName=i.displayName,this.photoURL=i.photoURL,this.email=i.email,this.emailVerified=i.emailVerified,this.phoneNumber=i.phoneNumber,this.isAnonymous=i.isAnonymous,this.tenantId=i.tenantId,this.providerData=i.providerData.map(s=>({...s})),this.metadata._copy(i.metadata),this.stsTokenManager._assign(i.stsTokenManager))}_clone(i){const s=new UserImpl({...this,auth:i,stsTokenManager:this.stsTokenManager._clone()});return s.metadata._copy(this.metadata),s}_onReload(i){_assert(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=i,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(i){this.reloadListener?this.reloadListener(i):this.reloadUserInfo=i}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(i,s=!1){let a=!1;i.idToken&&i.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(i),a=!0),s&&await _reloadWithoutSaving(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(_isFirebaseServerApp(this.auth.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this.auth));const i=await this.getIdToken();return await _logoutIfInvalidated(this,deleteAccount(this.auth,{idToken:i})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(i=>({...i})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(i,s){const a=s.displayName??void 0,b=s.email??void 0,et=s.phoneNumber??void 0,nt=s.photoURL??void 0,c=s.tenantId??void 0,ct=s._redirectEventId??void 0,pt=s.createdAt??void 0,xt=s.lastLoginAt??void 0,{uid:St,emailVerified:Et,isAnonymous:Rt,providerData:Nt,stsTokenManager:It}=s;_assert(St&&It,i,"internal-error");const Gt=StsTokenManager.fromJSON(this.name,It);_assert(typeof St=="string",i,"internal-error"),assertStringOrUndefined(a,i.name),assertStringOrUndefined(b,i.name),_assert(typeof Et=="boolean",i,"internal-error"),_assert(typeof Rt=="boolean",i,"internal-error"),assertStringOrUndefined(et,i.name),assertStringOrUndefined(nt,i.name),assertStringOrUndefined(c,i.name),assertStringOrUndefined(ct,i.name),assertStringOrUndefined(pt,i.name),assertStringOrUndefined(xt,i.name);const Dt=new UserImpl({uid:St,auth:i,email:b,emailVerified:Et,displayName:a,isAnonymous:Rt,photoURL:nt,phoneNumber:et,tenantId:c,stsTokenManager:Gt,createdAt:pt,lastLoginAt:xt});return Nt&&Array.isArray(Nt)&&(Dt.providerData=Nt.map(Bt=>({...Bt}))),ct&&(Dt._redirectEventId=ct),Dt}static async _fromIdTokenResponse(i,s,a=!1){const b=new StsTokenManager;b.updateFromServerResponse(s);const et=new UserImpl({uid:s.localId,auth:i,stsTokenManager:b,isAnonymous:a});return await _reloadWithoutSaving(et),et}static async _fromGetAccountInfoResponse(i,s,a){const b=s.users[0];_assert(b.localId!==void 0,"internal-error");const et=b.providerUserInfo!==void 0?extractProviderData(b.providerUserInfo):[],nt=!(b.email&&b.passwordHash)&&!(et!=null&&et.length),c=new StsTokenManager;c.updateFromIdToken(a);const ct=new UserImpl({uid:b.localId,auth:i,stsTokenManager:c,isAnonymous:nt}),pt={uid:b.localId,displayName:b.displayName||null,photoURL:b.photoUrl||null,email:b.email||null,emailVerified:b.emailVerified||!1,phoneNumber:b.phoneNumber||null,tenantId:b.tenantId||null,providerData:et,metadata:new UserMetadata(b.createdAt,b.lastLoginAt),isAnonymous:!(b.email&&b.passwordHash)&&!(et!=null&&et.length)};return Object.assign(ct,pt),ct}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const instanceCache=new Map;function _getInstance(e){debugAssert(e instanceof Function,"Expected a class definition");let i=instanceCache.get(e);return i?(debugAssert(i instanceof e,"Instance stored in cache mismatched with class"),i):(i=new e,instanceCache.set(e,i),i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class InMemoryPersistence{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(i,s){this.storage[i]=s}async _get(i){const s=this.storage[i];return s===void 0?null:s}async _remove(i){delete this.storage[i]}_addListener(i,s){}_removeListener(i,s){}}InMemoryPersistence.type="NONE";const inMemoryPersistence=InMemoryPersistence;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _persistenceKeyName(e,i,s){return`firebase:${e}:${i}:${s}`}class PersistenceUserManager{constructor(i,s,a){this.persistence=i,this.auth=s,this.userKey=a;const{config:b,name:et}=this.auth;this.fullUserKey=_persistenceKeyName(this.userKey,b.apiKey,et),this.fullPersistenceKey=_persistenceKeyName("persistence",b.apiKey,et),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(i){return this.persistence._set(this.fullUserKey,i.toJSON())}async getCurrentUser(){const i=await this.persistence._get(this.fullUserKey);if(!i)return null;if(typeof i=="string"){const s=await getAccountInfo(this.auth,{idToken:i}).catch(()=>{});return s?UserImpl._fromGetAccountInfoResponse(this.auth,s,i):null}return UserImpl._fromJSON(this.auth,i)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(i){if(this.persistence===i)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=i,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(i,s,a="authUser"){if(!s.length)return new PersistenceUserManager(_getInstance(inMemoryPersistence),i,a);const b=(await Promise.all(s.map(async pt=>{if(await pt._isAvailable())return pt}))).filter(pt=>pt);let et=b[0]||_getInstance(inMemoryPersistence);const nt=_persistenceKeyName(a,i.config.apiKey,i.name);let c=null;for(const pt of s)try{const xt=await pt._get(nt);if(xt){let St;if(typeof xt=="string"){const Et=await getAccountInfo(i,{idToken:xt}).catch(()=>{});if(!Et)break;St=await UserImpl._fromGetAccountInfoResponse(i,Et,xt)}else St=UserImpl._fromJSON(i,xt);pt!==et&&(c=St),et=pt;break}}catch{}const ct=b.filter(pt=>pt._shouldAllowMigration);return!et._shouldAllowMigration||!ct.length?new PersistenceUserManager(et,i,a):(et=ct[0],c&&await et._set(nt,c.toJSON()),await Promise.all(s.map(async pt=>{if(pt!==et)try{await pt._remove(nt)}catch{}})),new PersistenceUserManager(et,i,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _getBrowserName(e){const i=e.toLowerCase();if(i.includes("opera/")||i.includes("opr/")||i.includes("opios/"))return"Opera";if(_isIEMobile(i))return"IEMobile";if(i.includes("msie")||i.includes("trident/"))return"IE";if(i.includes("edge/"))return"Edge";if(_isFirefox(i))return"Firefox";if(i.includes("silk/"))return"Silk";if(_isBlackBerry(i))return"Blackberry";if(_isWebOS(i))return"Webos";if(_isSafari(i))return"Safari";if((i.includes("chrome/")||_isChromeIOS(i))&&!i.includes("edge/"))return"Chrome";if(_isAndroid(i))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=e.match(s);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function _isFirefox(e=getUA()){return/firefox\//i.test(e)}function _isSafari(e=getUA()){const i=e.toLowerCase();return i.includes("safari/")&&!i.includes("chrome/")&&!i.includes("crios/")&&!i.includes("android")}function _isChromeIOS(e=getUA()){return/crios\//i.test(e)}function _isIEMobile(e=getUA()){return/iemobile/i.test(e)}function _isAndroid(e=getUA()){return/android/i.test(e)}function _isBlackBerry(e=getUA()){return/blackberry/i.test(e)}function _isWebOS(e=getUA()){return/webos/i.test(e)}function _isIOS(e=getUA()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function _isIOSStandalone(e=getUA()){var i;return _isIOS(e)&&!!((i=window.navigator)!=null&&i.standalone)}function _isIE10(){return isIE()&&document.documentMode===10}function _isMobileBrowser(e=getUA()){return _isIOS(e)||_isAndroid(e)||_isWebOS(e)||_isBlackBerry(e)||/windows phone/i.test(e)||_isIEMobile(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _getClientVersion(e,i=[]){let s;switch(e){case"Browser":s=_getBrowserName(getUA());break;case"Worker":s=`${_getBrowserName(getUA())}-${e}`;break;default:s=e}const a=i.length?i.join(","):"FirebaseCore-web";return`${s}/JsCore/${SDK_VERSION$1}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AuthMiddlewareQueue{constructor(i){this.auth=i,this.queue=[]}pushCallback(i,s){const a=et=>new Promise((nt,c)=>{try{const ct=i(et);nt(ct)}catch(ct){c(ct)}});a.onAbort=s,this.queue.push(a);const b=this.queue.length-1;return()=>{this.queue[b]=()=>Promise.resolve()}}async runMiddleware(i){if(this.auth.currentUser===i)return;const s=[];try{for(const a of this.queue)await a(i),a.onAbort&&s.push(a.onAbort)}catch(a){s.reverse();for(const b of s)try{b()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _getPasswordPolicy(e,i={}){return _performApiRequest(e,"GET","/v2/passwordPolicy",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MINIMUM_MIN_PASSWORD_LENGTH=6;class PasswordPolicyImpl{constructor(i){var a;const s=i.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=s.minPasswordLength??MINIMUM_MIN_PASSWORD_LENGTH,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),s.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),s.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),s.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),s.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=i.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((a=i.allowedNonAlphanumericCharacters)==null?void 0:a.join(""))??"",this.forceUpgradeOnSignin=i.forceUpgradeOnSignin??!1,this.schemaVersion=i.schemaVersion}validatePassword(i){const s={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(i,s),this.validatePasswordCharacterOptions(i,s),s.isValid&&(s.isValid=s.meetsMinPasswordLength??!0),s.isValid&&(s.isValid=s.meetsMaxPasswordLength??!0),s.isValid&&(s.isValid=s.containsLowercaseLetter??!0),s.isValid&&(s.isValid=s.containsUppercaseLetter??!0),s.isValid&&(s.isValid=s.containsNumericCharacter??!0),s.isValid&&(s.isValid=s.containsNonAlphanumericCharacter??!0),s}validatePasswordLengthOptions(i,s){const a=this.customStrengthOptions.minPasswordLength,b=this.customStrengthOptions.maxPasswordLength;a&&(s.meetsMinPasswordLength=i.length>=a),b&&(s.meetsMaxPasswordLength=i.length<=b)}validatePasswordCharacterOptions(i,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let a;for(let b=0;b<i.length;b++)a=i.charAt(b),this.updatePasswordCharacterOptionsStatuses(s,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(i,s,a,b,et){this.customStrengthOptions.containsLowercaseLetter&&(i.containsLowercaseLetter||(i.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(i.containsUppercaseLetter||(i.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(i.containsNumericCharacter||(i.containsNumericCharacter=b)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(i.containsNonAlphanumericCharacter||(i.containsNonAlphanumericCharacter=et))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AuthImpl{constructor(i,s,a,b){this.app=i,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=a,this.config=b,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Subscription(this),this.idTokenSubscription=new Subscription(this),this.beforeStateQueue=new AuthMiddlewareQueue(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=_DEFAULT_AUTH_ERROR_FACTORY,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=i.name,this.clientVersion=b.sdkClientVersion,this._persistenceManagerAvailable=new Promise(et=>this._resolvePersistenceManagerAvailable=et)}_initializeWithPersistence(i,s){return s&&(this._popupRedirectResolver=_getInstance(s)),this._initializationPromise=this.queue(async()=>{var a,b,et;if(!this._deleted&&(this.persistenceManager=await PersistenceUserManager.create(this,i),(a=this._resolvePersistenceManagerAvailable)==null||a.call(this),!this._deleted)){if((b=this._popupRedirectResolver)!=null&&b._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((et=this.currentUser)==null?void 0:et.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const i=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!i)){if(this.currentUser&&i&&this.currentUser.uid===i.uid){this._currentUser._assign(i),await this.currentUser.getIdToken();return}await this._updateCurrentUser(i,!0)}}async initializeCurrentUserFromIdToken(i){try{const s=await getAccountInfo(this,{idToken:i}),a=await UserImpl._fromGetAccountInfoResponse(this,s,i);await this.directlySetCurrentUser(a)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(i){var et;if(_isFirebaseServerApp(this.app)){const nt=this.app.settings.authIdToken;return nt?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(nt).then(c,c))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let a=s,b=!1;if(i&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const nt=(et=this.redirectUser)==null?void 0:et._redirectEventId,c=a==null?void 0:a._redirectEventId,ct=await this.tryRedirectSignIn(i);(!nt||nt===c)&&(ct!=null&&ct.user)&&(a=ct.user,b=!0)}if(!a)return this.directlySetCurrentUser(null);if(!a._redirectEventId){if(b)try{await this.beforeStateQueue.runMiddleware(a)}catch(nt){a=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(nt))}return a?this.reloadAndSetCurrentUserOrClear(a):this.directlySetCurrentUser(null)}return _assert(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===a._redirectEventId?this.directlySetCurrentUser(a):this.reloadAndSetCurrentUserOrClear(a)}async tryRedirectSignIn(i){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,i,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(i){try{await _reloadWithoutSaving(i)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(i)}useDeviceLanguage(){this.languageCode=_getUserLanguage()}async _delete(){this._deleted=!0}async updateCurrentUser(i){if(_isFirebaseServerApp(this.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this));const s=i?getModularInstance(i):null;return s&&_assert(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(i,s=!1){if(!this._deleted)return i&&_assert(this.tenantId===i.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(i),this.queue(async()=>{await this.directlySetCurrentUser(i),this.notifyAuthListeners()})}async signOut(){return _isFirebaseServerApp(this.app)?Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(i){return _isFirebaseServerApp(this.app)?Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(_getInstance(i))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(i){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(i)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const i=await _getPasswordPolicy(this),s=new PasswordPolicyImpl(i);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(i){this._errorFactory=new ErrorFactory("auth","Firebase",i())}onAuthStateChanged(i,s,a){return this.registerStateListener(this.authStateSubscription,i,s,a)}beforeAuthStateChanged(i,s){return this.beforeStateQueue.pushCallback(i,s)}onIdTokenChanged(i,s,a){return this.registerStateListener(this.idTokenSubscription,i,s,a)}authStateReady(){return new Promise((i,s)=>{if(this.currentUser)i();else{const a=this.onAuthStateChanged(()=>{a(),i()},s)}})}async revokeAccessToken(i){if(this.currentUser){const s=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:i,idToken:s};this.tenantId!=null&&(a.tenantId=this.tenantId),await revokeToken(this,a)}}toJSON(){var i;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(i=this._currentUser)==null?void 0:i.toJSON()}}async _setRedirectUser(i,s){const a=await this.getOrInitRedirectPersistenceManager(s);return i===null?a.removeCurrentUser():a.setCurrentUser(i)}async getOrInitRedirectPersistenceManager(i){if(!this.redirectPersistenceManager){const s=i&&_getInstance(i)||this._popupRedirectResolver;_assert(s,this,"argument-error"),this.redirectPersistenceManager=await PersistenceUserManager.create(this,[_getInstance(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(i){var s,a;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)==null?void 0:s._redirectEventId)===i?this._currentUser:((a=this.redirectUser)==null?void 0:a._redirectEventId)===i?this.redirectUser:null}async _persistUserIfCurrent(i){if(i===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(i))}_notifyListenersIfCurrent(i){i===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=((s=this.currentUser)==null?void 0:s.uid)??null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(i,s,a,b){if(this._deleted)return()=>{};const et=typeof s=="function"?s:s.next.bind(s);let nt=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(_assert(c,this,"internal-error"),c.then(()=>{nt||et(this.currentUser)}),typeof s=="function"){const ct=i.addObserver(s,a,b);return()=>{nt=!0,ct()}}else{const ct=i.addObserver(s);return()=>{nt=!0,ct()}}}async directlySetCurrentUser(i){this.currentUser&&this.currentUser!==i&&this._currentUser._stopProactiveRefresh(),i&&this.isProactiveRefreshEnabled&&i._startProactiveRefresh(),this.currentUser=i,i?await this.assertedPersistence.setCurrentUser(i):await this.assertedPersistence.removeCurrentUser()}queue(i){return this.operations=this.operations.then(i,i),this.operations}get assertedPersistence(){return _assert(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(i){!i||this.frameworks.includes(i)||(this.frameworks.push(i),this.frameworks.sort(),this.clientVersion=_getClientVersion(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var b;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const s=await((b=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:b.getHeartbeatsHeader());s&&(i["X-Firebase-Client"]=s);const a=await this._getAppCheckToken();return a&&(i["X-Firebase-AppCheck"]=a),i}async _getAppCheckToken(){var s;if(_isFirebaseServerApp(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((s=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getToken());return i!=null&&i.error&&_logWarn(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function _castAuth(e){return getModularInstance(e)}class Subscription{constructor(i){this.auth=i,this.observer=null,this.addObserver=createSubscribe(s=>this.observer=s)}get next(){return _assert(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let externalJSProvider={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _setExternalJSProvider(e){externalJSProvider=e}function _loadJS(e){return externalJSProvider.loadJS(e)}function _recaptchaEnterpriseScriptUrl(){return externalJSProvider.recaptchaEnterpriseScript}function _gapiScriptUrl(){return externalJSProvider.gapiScript}function _generateCallbackName(e){return`__${e}${Math.floor(Math.random()*1e6)}`}class MockGreCAPTCHATopLevel{constructor(){this.enterprise=new MockGreCAPTCHA}ready(i){i()}execute(i,s){return Promise.resolve("token")}render(i,s){return""}}class MockGreCAPTCHA{ready(i){i()}execute(i,s){return Promise.resolve("token")}render(i,s){return""}}const RECAPTCHA_ENTERPRISE_VERIFIER_TYPE="recaptcha-enterprise",FAKE_TOKEN="NO_RECAPTCHA";class RecaptchaEnterpriseVerifier{constructor(i){this.type=RECAPTCHA_ENTERPRISE_VERIFIER_TYPE,this.auth=_castAuth(i)}async verify(i="verify",s=!1){async function a(et){if(!s){if(et.tenantId==null&&et._agentRecaptchaConfig!=null)return et._agentRecaptchaConfig.siteKey;if(et.tenantId!=null&&et._tenantRecaptchaConfigs[et.tenantId]!==void 0)return et._tenantRecaptchaConfigs[et.tenantId].siteKey}return new Promise(async(nt,c)=>{getRecaptchaConfig(et,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(ct=>{if(ct.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{const pt=new RecaptchaConfig(ct);return et.tenantId==null?et._agentRecaptchaConfig=pt:et._tenantRecaptchaConfigs[et.tenantId]=pt,nt(pt.siteKey)}}).catch(ct=>{c(ct)})})}function b(et,nt,c){const ct=window.grecaptcha;isEnterprise(ct)?ct.enterprise.ready(()=>{ct.enterprise.execute(et,{action:i}).then(pt=>{nt(pt)}).catch(()=>{nt(FAKE_TOKEN)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new MockGreCAPTCHATopLevel().execute("siteKey",{action:"verify"}):new Promise((et,nt)=>{a(this.auth).then(c=>{if(!s&&isEnterprise(window.grecaptcha))b(c,et,nt);else{if(typeof window>"u"){nt(new Error("RecaptchaVerifier is only supported in browser"));return}let ct=_recaptchaEnterpriseScriptUrl();ct.length!==0&&(ct+=c),_loadJS(ct).then(()=>{b(c,et,nt)}).catch(pt=>{nt(pt)})}}).catch(c=>{nt(c)})})}}async function injectRecaptchaFields(e,i,s,a=!1,b=!1){const et=new RecaptchaEnterpriseVerifier(e);let nt;if(b)nt=FAKE_TOKEN;else try{nt=await et.verify(s)}catch{nt=await et.verify(s,!0)}const c={...i};if(s==="mfaSmsEnrollment"||s==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in c){const ct=c.phoneEnrollmentInfo.phoneNumber,pt=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:ct,recaptchaToken:pt,captchaResponse:nt,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){const ct=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:ct,captchaResponse:nt,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return a?Object.assign(c,{captchaResp:nt}):Object.assign(c,{captchaResponse:nt}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c}async function handleRecaptchaFlow(e,i,s,a,b){var et;if((et=e._getRecaptchaConfig())!=null&&et.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const nt=await injectRecaptchaFields(e,i,s,s==="getOobCode");return a(e,nt)}else return a(e,i).catch(async nt=>{if(nt.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const c=await injectRecaptchaFields(e,i,s,s==="getOobCode");return a(e,c)}else return Promise.reject(nt)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function initializeAuth(e,i){const s=_getProvider(e,"auth");if(s.isInitialized()){const b=s.getImmediate(),et=s.getOptions();if(deepEqual(et,i??{}))return b;_fail(b,"already-initialized")}return s.initialize({options:i})}function _initializeAuthInstance(e,i){const s=(i==null?void 0:i.persistence)||[],a=(Array.isArray(s)?s:[s]).map(_getInstance);i!=null&&i.errorMap&&e._updateErrorMap(i.errorMap),e._initializeWithPersistence(a,i==null?void 0:i.popupRedirectResolver)}function connectAuthEmulator(e,i,s){const a=_castAuth(e);_assert(/^https?:\/\//.test(i),a,"invalid-emulator-scheme");const b=!!(s!=null&&s.disableWarnings),et=extractProtocol(i),{host:nt,port:c}=extractHostAndPort(i),ct=c===null?"":`:${c}`,pt={url:`${et}//${nt}${ct}/`},xt=Object.freeze({host:nt,port:c,protocol:et.replace(":",""),options:Object.freeze({disableWarnings:b})});if(!a._canInitEmulator){_assert(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),_assert(deepEqual(pt,a.config.emulator)&&deepEqual(xt,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=pt,a.emulatorConfig=xt,a.settings.appVerificationDisabledForTesting=!0,isCloudWorkstation(nt)?(pingServer(`${et}//${nt}${ct}`),updateEmulatorBanner("Auth",!0)):emitEmulatorWarning()}function extractProtocol(e){const i=e.indexOf(":");return i<0?"":e.substr(0,i+1)}function extractHostAndPort(e){const i=extractProtocol(e),s=/(\/\/)?([^?#/]+)/.exec(e.substr(i.length));if(!s)return{host:"",port:null};const a=s[2].split("@").pop()||"",b=/^(\[[^\]]+\])(:|$)/.exec(a);if(b){const et=b[1];return{host:et,port:parsePort(a.substr(et.length+1))}}else{const[et,nt]=a.split(":");return{host:et,port:parsePort(nt)}}}function parsePort(e){if(!e)return null;const i=Number(e);return isNaN(i)?null:i}function emitEmulatorWarning(){function e(){const i=document.createElement("p"),s=i.style;i.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",i.classList.add("firebase-emulator-warning"),document.body.appendChild(i)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",e):e())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AuthCredential{constructor(i,s){this.providerId=i,this.signInMethod=s}toJSON(){return debugFail("not implemented")}_getIdTokenResponse(i){return debugFail("not implemented")}_linkToIdToken(i,s){return debugFail("not implemented")}_getReauthenticationResolver(i){return debugFail("not implemented")}}async function linkEmailPassword(e,i){return _performApiRequest(e,"POST","/v1/accounts:signUp",i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signInWithPassword(e,i){return _performSignInRequest(e,"POST","/v1/accounts:signInWithPassword",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signInWithEmailLink$1(e,i){return _performSignInRequest(e,"POST","/v1/accounts:signInWithEmailLink",_addTidIfNecessary(e,i))}async function signInWithEmailLinkForLinking(e,i){return _performSignInRequest(e,"POST","/v1/accounts:signInWithEmailLink",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EmailAuthCredential extends AuthCredential{constructor(i,s,a,b=null){super("password",a),this._email=i,this._password=s,this._tenantId=b}static _fromEmailAndPassword(i,s){return new EmailAuthCredential(i,s,"password")}static _fromEmailAndCode(i,s,a=null){return new EmailAuthCredential(i,s,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(i){const s=typeof i=="string"?JSON.parse(i):i;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(i){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return handleRecaptchaFlow(i,s,"signInWithPassword",signInWithPassword);case"emailLink":return signInWithEmailLink$1(i,{email:this._email,oobCode:this._password});default:_fail(i,"internal-error")}}async _linkToIdToken(i,s){switch(this.signInMethod){case"password":const a={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return handleRecaptchaFlow(i,a,"signUpPassword",linkEmailPassword);case"emailLink":return signInWithEmailLinkForLinking(i,{idToken:s,email:this._email,oobCode:this._password});default:_fail(i,"internal-error")}}_getReauthenticationResolver(i){return this._getIdTokenResponse(i)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signInWithIdp(e,i){return _performSignInRequest(e,"POST","/v1/accounts:signInWithIdp",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IDP_REQUEST_URI$1="http://localhost";class OAuthCredential extends AuthCredential{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(i){const s=new OAuthCredential(i.providerId,i.signInMethod);return i.idToken||i.accessToken?(i.idToken&&(s.idToken=i.idToken),i.accessToken&&(s.accessToken=i.accessToken),i.nonce&&!i.pendingToken&&(s.nonce=i.nonce),i.pendingToken&&(s.pendingToken=i.pendingToken)):i.oauthToken&&i.oauthTokenSecret?(s.accessToken=i.oauthToken,s.secret=i.oauthTokenSecret):_fail("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(i){const s=typeof i=="string"?JSON.parse(i):i,{providerId:a,signInMethod:b,...et}=s;if(!a||!b)return null;const nt=new OAuthCredential(a,b);return nt.idToken=et.idToken||void 0,nt.accessToken=et.accessToken||void 0,nt.secret=et.secret,nt.nonce=et.nonce,nt.pendingToken=et.pendingToken||null,nt}_getIdTokenResponse(i){const s=this.buildRequest();return signInWithIdp(i,s)}_linkToIdToken(i,s){const a=this.buildRequest();return a.idToken=s,signInWithIdp(i,a)}_getReauthenticationResolver(i){const s=this.buildRequest();return s.autoCreate=!1,signInWithIdp(i,s)}buildRequest(){const i={requestUri:IDP_REQUEST_URI$1,returnSecureToken:!0};if(this.pendingToken)i.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),i.postBody=querystring(s)}return i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function parseMode(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function parseDeepLink(e){const i=querystringDecode(extractQuerystring(e)).link,s=i?querystringDecode(extractQuerystring(i)).deep_link_id:null,a=querystringDecode(extractQuerystring(e)).deep_link_id;return(a?querystringDecode(extractQuerystring(a)).link:null)||a||s||i||e}class ActionCodeURL{constructor(i){const s=querystringDecode(extractQuerystring(i)),a=s.apiKey??null,b=s.oobCode??null,et=parseMode(s.mode??null);_assert(a&&b&&et,"argument-error"),this.apiKey=a,this.operation=et,this.code=b,this.continueUrl=s.continueUrl??null,this.languageCode=s.lang??null,this.tenantId=s.tenantId??null}static parseLink(i){const s=parseDeepLink(i);try{return new ActionCodeURL(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EmailAuthProvider{constructor(){this.providerId=EmailAuthProvider.PROVIDER_ID}static credential(i,s){return EmailAuthCredential._fromEmailAndPassword(i,s)}static credentialWithLink(i,s){const a=ActionCodeURL.parseLink(s);return _assert(a,"argument-error"),EmailAuthCredential._fromEmailAndCode(i,a.code,a.tenantId)}}EmailAuthProvider.PROVIDER_ID="password";EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD="password";EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FederatedAuthProvider{constructor(i){this.providerId=i,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(i){this.defaultLanguageCode=i}setCustomParameters(i){return this.customParameters=i,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BaseOAuthProvider extends FederatedAuthProvider{constructor(){super(...arguments),this.scopes=[]}addScope(i){return this.scopes.includes(i)||this.scopes.push(i),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FacebookAuthProvider extends BaseOAuthProvider{constructor(){super("facebook.com")}static credential(i){return OAuthCredential._fromParams({providerId:FacebookAuthProvider.PROVIDER_ID,signInMethod:FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD,accessToken:i})}static credentialFromResult(i){return FacebookAuthProvider.credentialFromTaggedObject(i)}static credentialFromError(i){return FacebookAuthProvider.credentialFromTaggedObject(i.customData||{})}static credentialFromTaggedObject({_tokenResponse:i}){if(!i||!("oauthAccessToken"in i)||!i.oauthAccessToken)return null;try{return FacebookAuthProvider.credential(i.oauthAccessToken)}catch{return null}}}FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD="facebook.com";FacebookAuthProvider.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GoogleAuthProvider extends BaseOAuthProvider{constructor(){super("google.com"),this.addScope("profile")}static credential(i,s){return OAuthCredential._fromParams({providerId:GoogleAuthProvider.PROVIDER_ID,signInMethod:GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD,idToken:i,accessToken:s})}static credentialFromResult(i){return GoogleAuthProvider.credentialFromTaggedObject(i)}static credentialFromError(i){return GoogleAuthProvider.credentialFromTaggedObject(i.customData||{})}static credentialFromTaggedObject({_tokenResponse:i}){if(!i)return null;const{oauthIdToken:s,oauthAccessToken:a}=i;if(!s&&!a)return null;try{return GoogleAuthProvider.credential(s,a)}catch{return null}}}GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD="google.com";GoogleAuthProvider.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GithubAuthProvider extends BaseOAuthProvider{constructor(){super("github.com")}static credential(i){return OAuthCredential._fromParams({providerId:GithubAuthProvider.PROVIDER_ID,signInMethod:GithubAuthProvider.GITHUB_SIGN_IN_METHOD,accessToken:i})}static credentialFromResult(i){return GithubAuthProvider.credentialFromTaggedObject(i)}static credentialFromError(i){return GithubAuthProvider.credentialFromTaggedObject(i.customData||{})}static credentialFromTaggedObject({_tokenResponse:i}){if(!i||!("oauthAccessToken"in i)||!i.oauthAccessToken)return null;try{return GithubAuthProvider.credential(i.oauthAccessToken)}catch{return null}}}GithubAuthProvider.GITHUB_SIGN_IN_METHOD="github.com";GithubAuthProvider.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TwitterAuthProvider extends BaseOAuthProvider{constructor(){super("twitter.com")}static credential(i,s){return OAuthCredential._fromParams({providerId:TwitterAuthProvider.PROVIDER_ID,signInMethod:TwitterAuthProvider.TWITTER_SIGN_IN_METHOD,oauthToken:i,oauthTokenSecret:s})}static credentialFromResult(i){return TwitterAuthProvider.credentialFromTaggedObject(i)}static credentialFromError(i){return TwitterAuthProvider.credentialFromTaggedObject(i.customData||{})}static credentialFromTaggedObject({_tokenResponse:i}){if(!i)return null;const{oauthAccessToken:s,oauthTokenSecret:a}=i;if(!s||!a)return null;try{return TwitterAuthProvider.credential(s,a)}catch{return null}}}TwitterAuthProvider.TWITTER_SIGN_IN_METHOD="twitter.com";TwitterAuthProvider.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signUp(e,i){return _performSignInRequest(e,"POST","/v1/accounts:signUp",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UserCredentialImpl{constructor(i){this.user=i.user,this.providerId=i.providerId,this._tokenResponse=i._tokenResponse,this.operationType=i.operationType}static async _fromIdTokenResponse(i,s,a,b=!1){const et=await UserImpl._fromIdTokenResponse(i,a,b),nt=providerIdForResponse(a);return new UserCredentialImpl({user:et,providerId:nt,_tokenResponse:a,operationType:s})}static async _forOperation(i,s,a){await i._updateTokensIfNecessary(a,!0);const b=providerIdForResponse(a);return new UserCredentialImpl({user:i,providerId:b,_tokenResponse:a,operationType:s})}}function providerIdForResponse(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MultiFactorError extends FirebaseError{constructor(i,s,a,b){super(s.code,s.message),this.operationType=a,this.user=b,Object.setPrototypeOf(this,MultiFactorError.prototype),this.customData={appName:i.name,tenantId:i.tenantId??void 0,_serverResponse:s.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(i,s,a,b){return new MultiFactorError(i,s,a,b)}}function _processCredentialSavingMfaContextIfNecessary(e,i,s,a){return(i==="reauthenticate"?s._getReauthenticationResolver(e):s._getIdTokenResponse(e)).catch(et=>{throw et.code==="auth/multi-factor-auth-required"?MultiFactorError._fromErrorAndOperation(e,et,i,a):et})}async function _link$1(e,i,s=!1){const a=await _logoutIfInvalidated(e,i._linkToIdToken(e.auth,await e.getIdToken()),s);return UserCredentialImpl._forOperation(e,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _reauthenticate(e,i,s=!1){const{auth:a}=e;if(_isFirebaseServerApp(a.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(a));const b="reauthenticate";try{const et=await _logoutIfInvalidated(e,_processCredentialSavingMfaContextIfNecessary(a,b,i,e),s);_assert(et.idToken,a,"internal-error");const nt=_parseToken(et.idToken);_assert(nt,a,"internal-error");const{sub:c}=nt;return _assert(e.uid===c,a,"user-mismatch"),UserCredentialImpl._forOperation(e,b,et)}catch(et){throw(et==null?void 0:et.code)==="auth/user-not-found"&&_fail(a,"user-mismatch"),et}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _signInWithCredential(e,i,s=!1){if(_isFirebaseServerApp(e.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(e));const a="signIn",b=await _processCredentialSavingMfaContextIfNecessary(e,a,i),et=await UserCredentialImpl._fromIdTokenResponse(e,a,b);return s||await e._updateCurrentUser(et.user),et}async function signInWithCredential(e,i){return _signInWithCredential(_castAuth(e),i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function recachePasswordPolicy(e){const i=_castAuth(e);i._getPasswordPolicyInternal()&&await i._updatePasswordPolicy()}async function createUserWithEmailAndPassword(e,i,s){if(_isFirebaseServerApp(e.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(e));const a=_castAuth(e),nt=await handleRecaptchaFlow(a,{returnSecureToken:!0,email:i,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",signUp).catch(ct=>{throw ct.code==="auth/password-does-not-meet-requirements"&&recachePasswordPolicy(e),ct}),c=await UserCredentialImpl._fromIdTokenResponse(a,"signIn",nt);return await a._updateCurrentUser(c.user),c}function signInWithEmailAndPassword(e,i,s){return _isFirebaseServerApp(e.app)?Promise.reject(_serverAppCurrentUserOperationNotSupportedError(e)):signInWithCredential(getModularInstance(e),EmailAuthProvider.credential(i,s)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&recachePasswordPolicy(e),a})}function onIdTokenChanged(e,i,s,a){return getModularInstance(e).onIdTokenChanged(i,s,a)}function beforeAuthStateChanged(e,i,s){return getModularInstance(e).beforeAuthStateChanged(i,s)}function signOut(e){return getModularInstance(e).signOut()}const STORAGE_AVAILABLE_KEY="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BrowserPersistenceClass{constructor(i,s){this.storageRetriever=i,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(STORAGE_AVAILABLE_KEY,"1"),this.storage.removeItem(STORAGE_AVAILABLE_KEY),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(i,s){return this.storage.setItem(i,JSON.stringify(s)),Promise.resolve()}_get(i){const s=this.storage.getItem(i);return Promise.resolve(s?JSON.parse(s):null)}_remove(i){return this.storage.removeItem(i),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _POLLING_INTERVAL_MS$1=1e3,IE10_LOCAL_STORAGE_SYNC_DELAY=10;class BrowserLocalPersistence extends BrowserPersistenceClass{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(i,s)=>this.onStorageEvent(i,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=_isMobileBrowser(),this._shouldAllowMigration=!0}forAllChangedKeys(i){for(const s of Object.keys(this.listeners)){const a=this.storage.getItem(s),b=this.localCache[s];a!==b&&i(s,b,a)}}onStorageEvent(i,s=!1){if(!i.key){this.forAllChangedKeys((nt,c,ct)=>{this.notifyListeners(nt,ct)});return}const a=i.key;s?this.detachListener():this.stopPolling();const b=()=>{const nt=this.storage.getItem(a);!s&&this.localCache[a]===nt||this.notifyListeners(a,nt)},et=this.storage.getItem(a);_isIE10()&&et!==i.newValue&&i.newValue!==i.oldValue?setTimeout(b,IE10_LOCAL_STORAGE_SYNC_DELAY):b()}notifyListeners(i,s){this.localCache[i]=s;const a=this.listeners[i];if(a)for(const b of Array.from(a))b(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((i,s,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:i,oldValue:s,newValue:a}),!0)})},_POLLING_INTERVAL_MS$1)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(i,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[i]||(this.listeners[i]=new Set,this.localCache[i]=this.storage.getItem(i)),this.listeners[i].add(s)}_removeListener(i,s){this.listeners[i]&&(this.listeners[i].delete(s),this.listeners[i].size===0&&delete this.listeners[i]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(i,s){await super._set(i,s),this.localCache[i]=JSON.stringify(s)}async _get(i){const s=await super._get(i);return this.localCache[i]=JSON.stringify(s),s}async _remove(i){await super._remove(i),delete this.localCache[i]}}BrowserLocalPersistence.type="LOCAL";const browserLocalPersistence=BrowserLocalPersistence;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BrowserSessionPersistence extends BrowserPersistenceClass{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(i,s){}_removeListener(i,s){}}BrowserSessionPersistence.type="SESSION";const browserSessionPersistence=BrowserSessionPersistence;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _allSettled(e){return Promise.all(e.map(async i=>{try{return{fulfilled:!0,value:await i}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Receiver{constructor(i){this.eventTarget=i,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(i){const s=this.receivers.find(b=>b.isListeningto(i));if(s)return s;const a=new Receiver(i);return this.receivers.push(a),a}isListeningto(i){return this.eventTarget===i}async handleEvent(i){const s=i,{eventId:a,eventType:b,data:et}=s.data,nt=this.handlersMap[b];if(!(nt!=null&&nt.size))return;s.ports[0].postMessage({status:"ack",eventId:a,eventType:b});const c=Array.from(nt).map(async pt=>pt(s.origin,et)),ct=await _allSettled(c);s.ports[0].postMessage({status:"done",eventId:a,eventType:b,response:ct})}_subscribe(i,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[i]||(this.handlersMap[i]=new Set),this.handlersMap[i].add(s)}_unsubscribe(i,s){this.handlersMap[i]&&s&&this.handlersMap[i].delete(s),(!s||this.handlersMap[i].size===0)&&delete this.handlersMap[i],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Receiver.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _generateEventId(e="",i=10){let s="";for(let a=0;a<i;a++)s+=Math.floor(Math.random()*10);return e+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sender{constructor(i){this.target=i,this.handlers=new Set}removeMessageHandler(i){i.messageChannel&&(i.messageChannel.port1.removeEventListener("message",i.onMessage),i.messageChannel.port1.close()),this.handlers.delete(i)}async _send(i,s,a=50){const b=typeof MessageChannel<"u"?new MessageChannel:null;if(!b)throw new Error("connection_unavailable");let et,nt;return new Promise((c,ct)=>{const pt=_generateEventId("",20);b.port1.start();const xt=setTimeout(()=>{ct(new Error("unsupported_event"))},a);nt={messageChannel:b,onMessage(St){const Et=St;if(Et.data.eventId===pt)switch(Et.data.status){case"ack":clearTimeout(xt),et=setTimeout(()=>{ct(new Error("timeout"))},3e3);break;case"done":clearTimeout(et),c(Et.data.response);break;default:clearTimeout(xt),clearTimeout(et),ct(new Error("invalid_response"));break}}},this.handlers.add(nt),b.port1.addEventListener("message",nt.onMessage),this.target.postMessage({eventType:i,eventId:pt,data:s},[b.port2])}).finally(()=>{nt&&this.removeMessageHandler(nt)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _window(){return window}function _setWindowLocation(e){_window().location.href=e}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _isWorker(){return typeof _window().WorkerGlobalScope<"u"&&typeof _window().importScripts=="function"}async function _getActiveServiceWorker(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function _getServiceWorkerController(){var e;return((e=navigator==null?void 0:navigator.serviceWorker)==null?void 0:e.controller)||null}function _getWorkerGlobalScope(){return _isWorker()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DB_NAME="firebaseLocalStorageDb",DB_VERSION=1,DB_OBJECTSTORE_NAME="firebaseLocalStorage",DB_DATA_KEYPATH="fbase_key";class DBPromise{constructor(i){this.request=i}toPromise(){return new Promise((i,s)=>{this.request.addEventListener("success",()=>{i(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function getObjectStore(e,i){return e.transaction([DB_OBJECTSTORE_NAME],i?"readwrite":"readonly").objectStore(DB_OBJECTSTORE_NAME)}function _deleteDatabase(){const e=indexedDB.deleteDatabase(DB_NAME);return new DBPromise(e).toPromise()}function _openDatabase(){const e=indexedDB.open(DB_NAME,DB_VERSION);return new Promise((i,s)=>{e.addEventListener("error",()=>{s(e.error)}),e.addEventListener("upgradeneeded",()=>{const a=e.result;try{a.createObjectStore(DB_OBJECTSTORE_NAME,{keyPath:DB_DATA_KEYPATH})}catch(b){s(b)}}),e.addEventListener("success",async()=>{const a=e.result;a.objectStoreNames.contains(DB_OBJECTSTORE_NAME)?i(a):(a.close(),await _deleteDatabase(),i(await _openDatabase()))})})}async function _putObject(e,i,s){const a=getObjectStore(e,!0).put({[DB_DATA_KEYPATH]:i,value:s});return new DBPromise(a).toPromise()}async function getObject(e,i){const s=getObjectStore(e,!1).get(i),a=await new DBPromise(s).toPromise();return a===void 0?null:a.value}function _deleteObject(e,i){const s=getObjectStore(e,!0).delete(i);return new DBPromise(s).toPromise()}const _POLLING_INTERVAL_MS=800,_TRANSACTION_RETRY_COUNT=3;class IndexedDBLocalPersistence{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await _openDatabase(),this.db)}async _withRetries(i){let s=0;for(;;)try{const a=await this._openDb();return await i(a)}catch(a){if(s++>_TRANSACTION_RETRY_COUNT)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return _isWorker()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Receiver._getInstance(_getWorkerGlobalScope()),this.receiver._subscribe("keyChanged",async(i,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(i,s)=>["keyChanged"])}async initializeSender(){var s,a;if(this.activeServiceWorker=await _getActiveServiceWorker(),!this.activeServiceWorker)return;this.sender=new Sender(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);i&&(s=i[0])!=null&&s.fulfilled&&(a=i[0])!=null&&a.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(i){if(!(!this.sender||!this.activeServiceWorker||_getServiceWorkerController()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:i},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const i=await _openDatabase();return await _putObject(i,STORAGE_AVAILABLE_KEY,"1"),await _deleteObject(i,STORAGE_AVAILABLE_KEY),!0}catch{}return!1}async _withPendingWrite(i){this.pendingWrites++;try{await i()}finally{this.pendingWrites--}}async _set(i,s){return this._withPendingWrite(async()=>(await this._withRetries(a=>_putObject(a,i,s)),this.localCache[i]=s,this.notifyServiceWorker(i)))}async _get(i){const s=await this._withRetries(a=>getObject(a,i));return this.localCache[i]=s,s}async _remove(i){return this._withPendingWrite(async()=>(await this._withRetries(s=>_deleteObject(s,i)),delete this.localCache[i],this.notifyServiceWorker(i)))}async _poll(){const i=await this._withRetries(b=>{const et=getObjectStore(b,!1).getAll();return new DBPromise(et).toPromise()});if(!i)return[];if(this.pendingWrites!==0)return[];const s=[],a=new Set;if(i.length!==0)for(const{fbase_key:b,value:et}of i)a.add(b),JSON.stringify(this.localCache[b])!==JSON.stringify(et)&&(this.notifyListeners(b,et),s.push(b));for(const b of Object.keys(this.localCache))this.localCache[b]&&!a.has(b)&&(this.notifyListeners(b,null),s.push(b));return s}notifyListeners(i,s){this.localCache[i]=s;const a=this.listeners[i];if(a)for(const b of Array.from(a))b(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),_POLLING_INTERVAL_MS)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(i,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[i]||(this.listeners[i]=new Set,this._get(i)),this.listeners[i].add(s)}_removeListener(i,s){this.listeners[i]&&(this.listeners[i].delete(s),this.listeners[i].size===0&&delete this.listeners[i]),Object.keys(this.listeners).length===0&&this.stopPolling()}}IndexedDBLocalPersistence.type="LOCAL";const indexedDBLocalPersistence=IndexedDBLocalPersistence;new Delay(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _withDefaultResolver(e,i){return i?_getInstance(i):(_assert(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IdpCredential extends AuthCredential{constructor(i){super("custom","custom"),this.params=i}_getIdTokenResponse(i){return signInWithIdp(i,this._buildIdpRequest())}_linkToIdToken(i,s){return signInWithIdp(i,this._buildIdpRequest(s))}_getReauthenticationResolver(i){return signInWithIdp(i,this._buildIdpRequest())}_buildIdpRequest(i){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return i&&(s.idToken=i),s}}function _signIn(e){return _signInWithCredential(e.auth,new IdpCredential(e),e.bypassAuthState)}function _reauth(e){const{auth:i,user:s}=e;return _assert(s,i,"internal-error"),_reauthenticate(s,new IdpCredential(e),e.bypassAuthState)}async function _link(e){const{auth:i,user:s}=e;return _assert(s,i,"internal-error"),_link$1(s,new IdpCredential(e),e.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AbstractPopupRedirectOperation{constructor(i,s,a,b,et=!1){this.auth=i,this.resolver=a,this.user=b,this.bypassAuthState=et,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(i,s)=>{this.pendingPromise={resolve:i,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(i){const{urlResponse:s,sessionId:a,postBody:b,tenantId:et,error:nt,type:c}=i;if(nt){this.reject(nt);return}const ct={auth:this.auth,requestUri:s,sessionId:a,tenantId:et||void 0,postBody:b||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(ct))}catch(pt){this.reject(pt)}}onError(i){this.reject(i)}getIdpTask(i){switch(i){case"signInViaPopup":case"signInViaRedirect":return _signIn;case"linkViaPopup":case"linkViaRedirect":return _link;case"reauthViaPopup":case"reauthViaRedirect":return _reauth;default:_fail(this.auth,"internal-error")}}resolve(i){debugAssert(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(i),this.unregisterAndCleanUp()}reject(i){debugAssert(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(i),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _POLL_WINDOW_CLOSE_TIMEOUT=new Delay(2e3,1e4);class PopupOperation extends AbstractPopupRedirectOperation{constructor(i,s,a,b,et){super(i,s,b,et),this.provider=a,this.authWindow=null,this.pollId=null,PopupOperation.currentPopupAction&&PopupOperation.currentPopupAction.cancel(),PopupOperation.currentPopupAction=this}async executeNotNull(){const i=await this.execute();return _assert(i,this.auth,"internal-error"),i}async onExecution(){debugAssert(this.filter.length===1,"Popup operations only handle one event");const i=_generateEventId();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],i),this.authWindow.associatedEvent=i,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(_createError(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var i;return((i=this.authWindow)==null?void 0:i.associatedEvent)||null}cancel(){this.reject(_createError(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,PopupOperation.currentPopupAction=null}pollUserCancellation(){const i=()=>{var s,a;if((a=(s=this.authWindow)==null?void 0:s.window)!=null&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(_createError(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(i,_POLL_WINDOW_CLOSE_TIMEOUT.get())};i()}}PopupOperation.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PENDING_REDIRECT_KEY="pendingRedirect",redirectOutcomeMap=new Map;class RedirectAction extends AbstractPopupRedirectOperation{constructor(i,s,a=!1){super(i,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,a),this.eventId=null}async execute(){let i=redirectOutcomeMap.get(this.auth._key());if(!i){try{const a=await _getAndClearPendingRedirectStatus(this.resolver,this.auth)?await super.execute():null;i=()=>Promise.resolve(a)}catch(s){i=()=>Promise.reject(s)}redirectOutcomeMap.set(this.auth._key(),i)}return this.bypassAuthState||redirectOutcomeMap.set(this.auth._key(),()=>Promise.resolve(null)),i()}async onAuthEvent(i){if(i.type==="signInViaRedirect")return super.onAuthEvent(i);if(i.type==="unknown"){this.resolve(null);return}if(i.eventId){const s=await this.auth._redirectUserForId(i.eventId);if(s)return this.user=s,super.onAuthEvent(i);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function _getAndClearPendingRedirectStatus(e,i){const s=pendingRedirectKey(i),a=resolverPersistence(e);if(!await a._isAvailable())return!1;const b=await a._get(s)==="true";return await a._remove(s),b}function _overrideRedirectResult(e,i){redirectOutcomeMap.set(e._key(),i)}function resolverPersistence(e){return _getInstance(e._redirectPersistence)}function pendingRedirectKey(e){return _persistenceKeyName(PENDING_REDIRECT_KEY,e.config.apiKey,e.name)}async function _getRedirectResult(e,i,s=!1){if(_isFirebaseServerApp(e.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(e));const a=_castAuth(e),b=_withDefaultResolver(a,i),nt=await new RedirectAction(a,b,s).execute();return nt&&!s&&(delete nt.user._redirectEventId,await a._persistUserIfCurrent(nt.user),await a._setRedirectUser(null,i)),nt}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EVENT_DUPLICATION_CACHE_DURATION_MS=10*60*1e3;class AuthEventManager{constructor(i){this.auth=i,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(i){this.consumers.add(i),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,i)&&(this.sendToConsumer(this.queuedRedirectEvent,i),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(i){this.consumers.delete(i)}onEvent(i){if(this.hasEventBeenHandled(i))return!1;let s=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(i,a)&&(s=!0,this.sendToConsumer(i,a),this.saveEventToCache(i))}),this.hasHandledPotentialRedirect||!isRedirectEvent(i)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=i,s=!0)),s}sendToConsumer(i,s){var a;if(i.error&&!isNullRedirectEvent(i)){const b=((a=i.error.code)==null?void 0:a.split("auth/")[1])||"internal-error";s.onError(_createError(this.auth,b))}else s.onAuthEvent(i)}isEventForConsumer(i,s){const a=s.eventId===null||!!i.eventId&&i.eventId===s.eventId;return s.filter.includes(i.type)&&a}hasEventBeenHandled(i){return Date.now()-this.lastProcessedEventTime>=EVENT_DUPLICATION_CACHE_DURATION_MS&&this.cachedEventUids.clear(),this.cachedEventUids.has(eventUid(i))}saveEventToCache(i){this.cachedEventUids.add(eventUid(i)),this.lastProcessedEventTime=Date.now()}}function eventUid(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(i=>i).join("-")}function isNullRedirectEvent({type:e,error:i}){return e==="unknown"&&(i==null?void 0:i.code)==="auth/no-auth-event"}function isRedirectEvent(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return isNullRedirectEvent(e);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _getProjectConfig(e,i={}){return _performApiRequest(e,"GET","/v1/projects",i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IP_ADDRESS_REGEX=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,HTTP_REGEX=/^https?/;async function _validateOrigin(e){if(e.config.emulator)return;const{authorizedDomains:i}=await _getProjectConfig(e);for(const s of i)try{if(matchDomain(s))return}catch{}_fail(e,"unauthorized-domain")}function matchDomain(e){const i=_getCurrentUrl(),{protocol:s,hostname:a}=new URL(i);if(e.startsWith("chrome-extension://")){const nt=new URL(e);return nt.hostname===""&&a===""?s==="chrome-extension:"&&e.replace("chrome-extension://","")===i.replace("chrome-extension://",""):s==="chrome-extension:"&&nt.hostname===a}if(!HTTP_REGEX.test(s))return!1;if(IP_ADDRESS_REGEX.test(e))return a===e;const b=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+b+"|"+b+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NETWORK_TIMEOUT=new Delay(3e4,6e4);function resetUnloadedGapiModules(){const e=_window().___jsl;if(e!=null&&e.H){for(const i of Object.keys(e.H))if(e.H[i].r=e.H[i].r||[],e.H[i].L=e.H[i].L||[],e.H[i].r=[...e.H[i].L],e.CP)for(let s=0;s<e.CP.length;s++)e.CP[s]=null}}function loadGapi(e){return new Promise((i,s)=>{var b,et,nt;function a(){resetUnloadedGapiModules(),gapi.load("gapi.iframes",{callback:()=>{i(gapi.iframes.getContext())},ontimeout:()=>{resetUnloadedGapiModules(),s(_createError(e,"network-request-failed"))},timeout:NETWORK_TIMEOUT.get()})}if((et=(b=_window().gapi)==null?void 0:b.iframes)!=null&&et.Iframe)i(gapi.iframes.getContext());else if((nt=_window().gapi)!=null&&nt.load)a();else{const c=_generateCallbackName("iframefcb");return _window()[c]=()=>{gapi.load?a():s(_createError(e,"network-request-failed"))},_loadJS(`${_gapiScriptUrl()}?onload=${c}`).catch(ct=>s(ct))}}).catch(i=>{throw cachedGApiLoader=null,i})}let cachedGApiLoader=null;function _loadGapi(e){return cachedGApiLoader=cachedGApiLoader||loadGapi(e),cachedGApiLoader}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PING_TIMEOUT=new Delay(5e3,15e3),IFRAME_PATH="__/auth/iframe",EMULATED_IFRAME_PATH="emulator/auth/iframe",IFRAME_ATTRIBUTES={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},EID_FROM_APIHOST=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function getIframeUrl(e){const i=e.config;_assert(i.authDomain,e,"auth-domain-config-required");const s=i.emulator?_emulatorUrl(i,EMULATED_IFRAME_PATH):`https://${e.config.authDomain}/${IFRAME_PATH}`,a={apiKey:i.apiKey,appName:e.name,v:SDK_VERSION$1},b=EID_FROM_APIHOST.get(e.config.apiHost);b&&(a.eid=b);const et=e._getFrameworks();return et.length&&(a.fw=et.join(",")),`${s}?${querystring(a).slice(1)}`}async function _openIframe(e){const i=await _loadGapi(e),s=_window().gapi;return _assert(s,e,"internal-error"),i.open({where:document.body,url:getIframeUrl(e),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:IFRAME_ATTRIBUTES,dontclear:!0},a=>new Promise(async(b,et)=>{await a.restyle({setHideOnLeave:!1});const nt=_createError(e,"network-request-failed"),c=_window().setTimeout(()=>{et(nt)},PING_TIMEOUT.get());function ct(){_window().clearTimeout(c),b(a)}a.ping(ct).then(ct,()=>{et(nt)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BASE_POPUP_OPTIONS={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},DEFAULT_WIDTH=500,DEFAULT_HEIGHT=600,TARGET_BLANK="_blank",FIREFOX_EMPTY_URL="http://localhost";class AuthPopup{constructor(i){this.window=i,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function _open(e,i,s,a=DEFAULT_WIDTH,b=DEFAULT_HEIGHT){const et=Math.max((window.screen.availHeight-b)/2,0).toString(),nt=Math.max((window.screen.availWidth-a)/2,0).toString();let c="";const ct={...BASE_POPUP_OPTIONS,width:a.toString(),height:b.toString(),top:et,left:nt},pt=getUA().toLowerCase();s&&(c=_isChromeIOS(pt)?TARGET_BLANK:s),_isFirefox(pt)&&(i=i||FIREFOX_EMPTY_URL,ct.scrollbars="yes");const xt=Object.entries(ct).reduce((Et,[Rt,Nt])=>`${Et}${Rt}=${Nt},`,"");if(_isIOSStandalone(pt)&&c!=="_self")return openAsNewWindowIOS(i||"",c),new AuthPopup(null);const St=window.open(i||"",c,xt);_assert(St,e,"popup-blocked");try{St.focus()}catch{}return new AuthPopup(St)}function openAsNewWindowIOS(e,i){const s=document.createElement("a");s.href=e,s.target=i;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WIDGET_PATH="__/auth/handler",EMULATOR_WIDGET_PATH="emulator/auth/handler",FIREBASE_APP_CHECK_FRAGMENT_ID=encodeURIComponent("fac");async function _getRedirectUrl(e,i,s,a,b,et){_assert(e.config.authDomain,e,"auth-domain-config-required"),_assert(e.config.apiKey,e,"invalid-api-key");const nt={apiKey:e.config.apiKey,appName:e.name,authType:s,redirectUrl:a,v:SDK_VERSION$1,eventId:b};if(i instanceof FederatedAuthProvider){i.setDefaultLanguage(e.languageCode),nt.providerId=i.providerId||"",isEmpty(i.getCustomParameters())||(nt.customParameters=JSON.stringify(i.getCustomParameters()));for(const[xt,St]of Object.entries({}))nt[xt]=St}if(i instanceof BaseOAuthProvider){const xt=i.getScopes().filter(St=>St!=="");xt.length>0&&(nt.scopes=xt.join(","))}e.tenantId&&(nt.tid=e.tenantId);const c=nt;for(const xt of Object.keys(c))c[xt]===void 0&&delete c[xt];const ct=await e._getAppCheckToken(),pt=ct?`#${FIREBASE_APP_CHECK_FRAGMENT_ID}=${encodeURIComponent(ct)}`:"";return`${getHandlerBase(e)}?${querystring(c).slice(1)}${pt}`}function getHandlerBase({config:e}){return e.emulator?_emulatorUrl(e,EMULATOR_WIDGET_PATH):`https://${e.authDomain}/${WIDGET_PATH}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WEB_STORAGE_SUPPORT_KEY="webStorageSupport";class BrowserPopupRedirectResolver{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=browserSessionPersistence,this._completeRedirectFn=_getRedirectResult,this._overrideRedirectResult=_overrideRedirectResult}async _openPopup(i,s,a,b){var nt;debugAssert((nt=this.eventManagers[i._key()])==null?void 0:nt.manager,"_initialize() not called before _openPopup()");const et=await _getRedirectUrl(i,s,a,_getCurrentUrl(),b);return _open(i,et,_generateEventId())}async _openRedirect(i,s,a,b){await this._originValidation(i);const et=await _getRedirectUrl(i,s,a,_getCurrentUrl(),b);return _setWindowLocation(et),new Promise(()=>{})}_initialize(i){const s=i._key();if(this.eventManagers[s]){const{manager:b,promise:et}=this.eventManagers[s];return b?Promise.resolve(b):(debugAssert(et,"If manager is not set, promise should be"),et)}const a=this.initAndGetManager(i);return this.eventManagers[s]={promise:a},a.catch(()=>{delete this.eventManagers[s]}),a}async initAndGetManager(i){const s=await _openIframe(i),a=new AuthEventManager(i);return s.register("authEvent",b=>(_assert(b==null?void 0:b.authEvent,i,"invalid-auth-event"),{status:a.onEvent(b.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[i._key()]={manager:a},this.iframes[i._key()]=s,a}_isIframeWebStorageSupported(i,s){this.iframes[i._key()].send(WEB_STORAGE_SUPPORT_KEY,{type:WEB_STORAGE_SUPPORT_KEY},b=>{var nt;const et=(nt=b==null?void 0:b[0])==null?void 0:nt[WEB_STORAGE_SUPPORT_KEY];et!==void 0&&s(!!et),_fail(i,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(i){const s=i._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=_validateOrigin(i)),this.originValidationPromises[s]}get _shouldInitProactively(){return _isMobileBrowser()||_isSafari()||_isIOS()}}const browserPopupRedirectResolver=BrowserPopupRedirectResolver;var name$3="@firebase/auth",version$3="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AuthInterop{constructor(i){this.auth=i,this.internalListeners=new Map}getUid(){var i;return this.assertAuthConfigured(),((i=this.auth.currentUser)==null?void 0:i.uid)||null}async getToken(i){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(i)}:null}addAuthTokenListener(i){if(this.assertAuthConfigured(),this.internalListeners.has(i))return;const s=this.auth.onIdTokenChanged(a=>{i((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(i,s),this.updateProactiveRefresh()}removeAuthTokenListener(i){this.assertAuthConfigured();const s=this.internalListeners.get(i);s&&(this.internalListeners.delete(i),s(),this.updateProactiveRefresh())}assertAuthConfigured(){_assert(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getVersionForPlatform(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function registerAuth(e){_registerComponent(new Component("auth",(i,{options:s})=>{const a=i.getProvider("app").getImmediate(),b=i.getProvider("heartbeat"),et=i.getProvider("app-check-internal"),{apiKey:nt,authDomain:c}=a.options;_assert(nt&&!nt.includes(":"),"invalid-api-key",{appName:a.name});const ct={apiKey:nt,authDomain:c,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_getClientVersion(e)},pt=new AuthImpl(a,b,et,ct);return _initializeAuthInstance(pt,s),pt},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((i,s,a)=>{i.getProvider("auth-internal").initialize()})),_registerComponent(new Component("auth-internal",i=>{const s=_castAuth(i.getProvider("auth").getImmediate());return(a=>new AuthInterop(a))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),registerVersion(name$3,version$3,getVersionForPlatform(e)),registerVersion(name$3,version$3,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ID_TOKEN_MAX_AGE=5*60,authIdTokenMaxAge=getExperimentalSetting("authIdTokenMaxAge")||DEFAULT_ID_TOKEN_MAX_AGE;let lastPostedIdToken=null;const mintCookieFactory=e=>async i=>{const s=i&&await i.getIdTokenResult(),a=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(a&&a>authIdTokenMaxAge)return;const b=s==null?void 0:s.token;lastPostedIdToken!==b&&(lastPostedIdToken=b,await fetch(e,{method:b?"POST":"DELETE",headers:b?{Authorization:`Bearer ${b}`}:{}}))};function getAuth(e=getApp()){const i=_getProvider(e,"auth");if(i.isInitialized())return i.getImmediate();const s=initializeAuth(e,{popupRedirectResolver:browserPopupRedirectResolver,persistence:[indexedDBLocalPersistence,browserLocalPersistence,browserSessionPersistence]}),a=getExperimentalSetting("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const et=new URL(a,location.origin);if(location.origin===et.origin){const nt=mintCookieFactory(et.toString());beforeAuthStateChanged(s,nt,()=>nt(s.currentUser)),onIdTokenChanged(s,c=>nt(c))}}const b=getDefaultEmulatorHost("auth");return b&&connectAuthEmulator(s,`http://${b}`),s}function getScriptParentElement(){var e;return((e=document.getElementsByTagName("head"))==null?void 0:e[0])??document}_setExternalJSProvider({loadJS(e){return new Promise((i,s)=>{const a=document.createElement("script");a.setAttribute("src",e),a.onload=i,a.onerror=b=>{const et=_createError("internal-error");et.customData=b,s(et)},a.type="text/javascript",a.charset="UTF-8",getScriptParentElement().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});registerAuth("Browser");var define_process_env_default={};const name$2="@firebase/database",version$2="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let SDK_VERSION="";function setSDKVersion(e){SDK_VERSION=e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DOMStorageWrapper{constructor(i){this.domStorage_=i,this.prefix_="firebase:"}set(i,s){s==null?this.domStorage_.removeItem(this.prefixedName_(i)):this.domStorage_.setItem(this.prefixedName_(i),stringify(s))}get(i){const s=this.domStorage_.getItem(this.prefixedName_(i));return s==null?null:jsonEval(s)}remove(i){this.domStorage_.removeItem(this.prefixedName_(i))}prefixedName_(i){return this.prefix_+i}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MemoryStorage{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(i,s){s==null?delete this.cache_[i]:this.cache_[i]=s}get(i){return contains(this.cache_,i)?this.cache_[i]:null}remove(i){delete this.cache_[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const createStoragefor=function(e){try{if(typeof window<"u"&&typeof window[e]<"u"){const i=window[e];return i.setItem("firebase:sentinel","cache"),i.removeItem("firebase:sentinel"),new DOMStorageWrapper(i)}}catch{}return new MemoryStorage},PersistentStorage=createStoragefor("localStorage"),SessionStorage=createStoragefor("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logClient=new Logger("@firebase/database"),LUIDGenerator=function(){let e=1;return function(){return e++}}(),sha1=function(e){const i=stringToByteArray(e),s=new Sha1;s.update(i);const a=s.digest();return base64.encodeByteArray(a)},buildLogMessage_=function(...e){let i="";for(let s=0;s<e.length;s++){const a=e[s];Array.isArray(a)||a&&typeof a=="object"&&typeof a.length=="number"?i+=buildLogMessage_.apply(null,a):typeof a=="object"?i+=stringify(a):i+=a,i+=" "}return i};let logger=null,firstLog_=!0;const enableLogging$1=function(e,i){assert(!i,"Can't turn on custom loggers persistently."),logClient.logLevel=LogLevel.VERBOSE,logger=logClient.log.bind(logClient)},log=function(...e){if(firstLog_===!0&&(firstLog_=!1,logger===null&&SessionStorage.get("logging_enabled")===!0&&enableLogging$1()),logger){const i=buildLogMessage_.apply(null,e);logger(i)}},logWrapper=function(e){return function(...i){log(e,...i)}},error=function(...e){const i="FIREBASE INTERNAL ERROR: "+buildLogMessage_(...e);logClient.error(i)},fatal=function(...e){const i=`FIREBASE FATAL ERROR: ${buildLogMessage_(...e)}`;throw logClient.error(i),new Error(i)},warn=function(...e){const i="FIREBASE WARNING: "+buildLogMessage_(...e);logClient.warn(i)},warnIfPageIsSecure=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&warn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},isInvalidJSONNumber=function(e){return typeof e=="number"&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},executeWhenDOMReady=function(e){if(document.readyState==="complete")e();else{let i=!1;const s=function(){if(!document.body){setTimeout(s,Math.floor(10));return}i||(i=!0,e())};document.addEventListener?(document.addEventListener("DOMContentLoaded",s,!1),window.addEventListener("load",s,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&s()}),window.attachEvent("onload",s))}},MIN_NAME="[MIN_NAME]",MAX_NAME="[MAX_NAME]",nameCompare=function(e,i){if(e===i)return 0;if(e===MIN_NAME||i===MAX_NAME)return-1;if(i===MIN_NAME||e===MAX_NAME)return 1;{const s=tryParseInt(e),a=tryParseInt(i);return s!==null?a!==null?s-a===0?e.length-i.length:s-a:-1:a!==null?1:e<i?-1:1}},stringCompare=function(e,i){return e===i?0:e<i?-1:1},requireKey=function(e,i){if(i&&e in i)return i[e];throw new Error("Missing required key ("+e+") in object: "+stringify(i))},ObjectToUniqueKey=function(e){if(typeof e!="object"||e===null)return stringify(e);const i=[];for(const a in e)i.push(a);i.sort();let s="{";for(let a=0;a<i.length;a++)a!==0&&(s+=","),s+=stringify(i[a]),s+=":",s+=ObjectToUniqueKey(e[i[a]]);return s+="}",s},splitStringBySize=function(e,i){const s=e.length;if(s<=i)return[e];const a=[];for(let b=0;b<s;b+=i)b+i>s?a.push(e.substring(b,s)):a.push(e.substring(b,b+i));return a};function each(e,i){for(const s in e)e.hasOwnProperty(s)&&i(s,e[s])}const doubleToIEEE754String=function(e){assert(!isInvalidJSONNumber(e),"Invalid JSON number");const i=11,s=52,a=(1<<i-1)-1;let b,et,nt,c,ct;e===0?(et=0,nt=0,b=1/e===-1/0?1:0):(b=e<0,e=Math.abs(e),e>=Math.pow(2,1-a)?(c=Math.min(Math.floor(Math.log(e)/Math.LN2),a),et=c+a,nt=Math.round(e*Math.pow(2,s-c)-Math.pow(2,s))):(et=0,nt=Math.round(e/Math.pow(2,1-a-s))));const pt=[];for(ct=s;ct;ct-=1)pt.push(nt%2?1:0),nt=Math.floor(nt/2);for(ct=i;ct;ct-=1)pt.push(et%2?1:0),et=Math.floor(et/2);pt.push(b?1:0),pt.reverse();const xt=pt.join("");let St="";for(ct=0;ct<64;ct+=8){let Et=parseInt(xt.substr(ct,8),2).toString(16);Et.length===1&&(Et="0"+Et),St=St+Et}return St.toLowerCase()},isChromeExtensionContentScript=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},isWindowsStoreApp=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function errorForServerCode(e,i){let s="Unknown Error";e==="too_big"?s="The data requested exceeds the maximum size that can be accessed with a single request.":e==="permission_denied"?s="Client doesn't have permission to access the desired data.":e==="unavailable"&&(s="The service is unavailable");const a=new Error(e+" at "+i._path.toString()+": "+s);return a.code=e.toUpperCase(),a}const INTEGER_REGEXP_=new RegExp("^-?(0*)\\d{1,10}$"),INTEGER_32_MIN=-2147483648,INTEGER_32_MAX=2147483647,tryParseInt=function(e){if(INTEGER_REGEXP_.test(e)){const i=Number(e);if(i>=INTEGER_32_MIN&&i<=INTEGER_32_MAX)return i}return null},exceptionGuard=function(e){try{e()}catch(i){setTimeout(()=>{const s=i.stack||"";throw warn("Exception was thrown by user callback.",s),i},Math.floor(0))}},beingCrawled=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},setTimeoutNonBlocking=function(e,i){const s=setTimeout(e,i);return typeof s=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(s):typeof s=="object"&&s.unref&&s.unref(),s};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AppCheckTokenProvider{constructor(i,s){this.appCheckProvider=s,this.appName=i.name,_isFirebaseServerApp(i)&&i.settings.appCheckToken&&(this.serverAppAppCheckToken=i.settings.appCheckToken),this.appCheck=s==null?void 0:s.getImmediate({optional:!0}),this.appCheck||s==null||s.get().then(a=>this.appCheck=a)}getToken(i){if(this.serverAppAppCheckToken){if(i)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(i):new Promise((s,a)=>{setTimeout(()=>{this.appCheck?this.getToken(i).then(s,a):s(null)},0)})}addTokenChangeListener(i){var s;(s=this.appCheckProvider)==null||s.get().then(a=>a.addTokenListener(i))}notifyForInvalidToken(){warn(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FirebaseAuthTokenProvider{constructor(i,s,a){this.appName_=i,this.firebaseOptions_=s,this.authProvider_=a,this.auth_=null,this.auth_=a.getImmediate({optional:!0}),this.auth_||a.onInit(b=>this.auth_=b)}getToken(i){return this.auth_?this.auth_.getToken(i).catch(s=>s&&s.code==="auth/token-not-initialized"?(log("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(s)):new Promise((s,a)=>{setTimeout(()=>{this.auth_?this.getToken(i).then(s,a):s(null)},0)})}addTokenChangeListener(i){this.auth_?this.auth_.addAuthTokenListener(i):this.authProvider_.get().then(s=>s.addAuthTokenListener(i))}removeTokenChangeListener(i){this.authProvider_.get().then(s=>s.removeAuthTokenListener(i))}notifyForInvalidToken(){let i='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?i+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?i+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':i+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',warn(i)}}class EmulatorTokenProvider{constructor(i){this.accessToken=i}getToken(i){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(i){i(this.accessToken)}removeTokenChangeListener(i){}notifyForInvalidToken(){}}EmulatorTokenProvider.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PROTOCOL_VERSION="5",VERSION_PARAM="v",TRANSPORT_SESSION_PARAM="s",REFERER_PARAM="r",FORGE_REF="f",FORGE_DOMAIN_RE=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,LAST_SESSION_PARAM="ls",APPLICATION_ID_PARAM="p",APP_CHECK_TOKEN_PARAM="ac",WEBSOCKET="websocket",LONG_POLLING="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RepoInfo{constructor(i,s,a,b,et=!1,nt="",c=!1,ct=!1,pt=null){this.secure=s,this.namespace=a,this.webSocketOnly=b,this.nodeAdmin=et,this.persistenceKey=nt,this.includeNamespaceInQueryParams=c,this.isUsingEmulator=ct,this.emulatorOptions=pt,this._host=i.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=PersistentStorage.get("host:"+i)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(i){i!==this.internalHost&&(this.internalHost=i,this.isCacheableHost()&&PersistentStorage.set("host:"+this._host,this.internalHost))}toString(){let i=this.toURLString();return this.persistenceKey&&(i+="<"+this.persistenceKey+">"),i}toURLString(){const i=this.secure?"https://":"http://",s=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${i}${this.host}/${s}`}}function repoInfoNeedsQueryParam(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams}function repoInfoConnectionURL(e,i,s){assert(typeof i=="string","typeof type must == string"),assert(typeof s=="object","typeof params must == object");let a;if(i===WEBSOCKET)a=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(i===LONG_POLLING)a=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+i);repoInfoNeedsQueryParam(e)&&(s.ns=e.namespace);const b=[];return each(s,(et,nt)=>{b.push(et+"="+nt)}),a+b.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StatsCollection{constructor(){this.counters_={}}incrementCounter(i,s=1){contains(this.counters_,i)||(this.counters_[i]=0),this.counters_[i]+=s}get(){return deepCopy(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const collections={},reporters={};function statsManagerGetCollection(e){const i=e.toString();return collections[i]||(collections[i]=new StatsCollection),collections[i]}function statsManagerGetOrCreateReporter(e,i){const s=e.toString();return reporters[s]||(reporters[s]=i()),reporters[s]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PacketReceiver{constructor(i){this.onMessage_=i,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(i,s){this.closeAfterResponse=i,this.onClose=s,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(i,s){for(this.pendingResponses[i]=s;this.pendingResponses[this.currentResponseNum];){const a=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let b=0;b<a.length;++b)a[b]&&exceptionGuard(()=>{this.onMessage_(a[b])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FIREBASE_LONGPOLL_START_PARAM="start",FIREBASE_LONGPOLL_CLOSE_COMMAND="close",FIREBASE_LONGPOLL_COMMAND_CB_NAME="pLPCommand",FIREBASE_LONGPOLL_DATA_CB_NAME="pRTLPCB",FIREBASE_LONGPOLL_ID_PARAM="id",FIREBASE_LONGPOLL_PW_PARAM="pw",FIREBASE_LONGPOLL_SERIAL_PARAM="ser",FIREBASE_LONGPOLL_CALLBACK_ID_PARAM="cb",FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM="seg",FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET="ts",FIREBASE_LONGPOLL_DATA_PARAM="d",FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM="dframe",MAX_URL_DATA_SIZE=1870,SEG_HEADER_SIZE=30,MAX_PAYLOAD_SIZE=MAX_URL_DATA_SIZE-SEG_HEADER_SIZE,KEEPALIVE_REQUEST_INTERVAL=25e3,LP_CONNECT_TIMEOUT=3e4;class BrowserPollConnection{constructor(i,s,a,b,et,nt,c){this.connId=i,this.repoInfo=s,this.applicationId=a,this.appCheckToken=b,this.authToken=et,this.transportSessionId=nt,this.lastSessionId=c,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=logWrapper(i),this.stats_=statsManagerGetCollection(s),this.urlFn=ct=>(this.appCheckToken&&(ct[APP_CHECK_TOKEN_PARAM]=this.appCheckToken),repoInfoConnectionURL(s,LONG_POLLING,ct))}open(i,s){this.curSegmentNum=0,this.onDisconnect_=s,this.myPacketOrderer=new PacketReceiver(i),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(LP_CONNECT_TIMEOUT)),executeWhenDOMReady(()=>{if(this.isClosed_)return;this.scriptTagHolder=new FirebaseIFrameScriptHolder((...et)=>{const[nt,c,ct,pt,xt]=et;if(this.incrementIncomingBytes_(et),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,nt===FIREBASE_LONGPOLL_START_PARAM)this.id=c,this.password=ct;else if(nt===FIREBASE_LONGPOLL_CLOSE_COMMAND)c?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(c,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+nt)},(...et)=>{const[nt,c]=et;this.incrementIncomingBytes_(et),this.myPacketOrderer.handleResponse(nt,c)},()=>{this.onClosed_()},this.urlFn);const a={};a[FIREBASE_LONGPOLL_START_PARAM]="t",a[FIREBASE_LONGPOLL_SERIAL_PARAM]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(a[FIREBASE_LONGPOLL_CALLBACK_ID_PARAM]=this.scriptTagHolder.uniqueCallbackIdentifier),a[VERSION_PARAM]=PROTOCOL_VERSION,this.transportSessionId&&(a[TRANSPORT_SESSION_PARAM]=this.transportSessionId),this.lastSessionId&&(a[LAST_SESSION_PARAM]=this.lastSessionId),this.applicationId&&(a[APPLICATION_ID_PARAM]=this.applicationId),this.appCheckToken&&(a[APP_CHECK_TOKEN_PARAM]=this.appCheckToken),typeof location<"u"&&location.hostname&&FORGE_DOMAIN_RE.test(location.hostname)&&(a[REFERER_PARAM]=FORGE_REF);const b=this.urlFn(a);this.log_("Connecting via long-poll to "+b),this.scriptTagHolder.addTag(b,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){BrowserPollConnection.forceAllow_=!0}static forceDisallow(){BrowserPollConnection.forceDisallow_=!0}static isAvailable(){return BrowserPollConnection.forceAllow_?!0:!BrowserPollConnection.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!isChromeExtensionContentScript()&&!isWindowsStoreApp()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(i){const s=stringify(i);this.bytesSent+=s.length,this.stats_.incrementCounter("bytes_sent",s.length);const a=base64Encode(s),b=splitStringBySize(a,MAX_PAYLOAD_SIZE);for(let et=0;et<b.length;et++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,b.length,b[et]),this.curSegmentNum++}addDisconnectPingFrame(i,s){this.myDisconnFrame=document.createElement("iframe");const a={};a[FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM]="t",a[FIREBASE_LONGPOLL_ID_PARAM]=i,a[FIREBASE_LONGPOLL_PW_PARAM]=s,this.myDisconnFrame.src=this.urlFn(a),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(i){const s=stringify(i).length;this.bytesReceived+=s,this.stats_.incrementCounter("bytes_received",s)}}class FirebaseIFrameScriptHolder{constructor(i,s,a,b){this.onDisconnect=a,this.urlFn=b,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=LUIDGenerator(),window[FIREBASE_LONGPOLL_COMMAND_CB_NAME+this.uniqueCallbackIdentifier]=i,window[FIREBASE_LONGPOLL_DATA_CB_NAME+this.uniqueCallbackIdentifier]=s,this.myIFrame=FirebaseIFrameScriptHolder.createIFrame_();let et="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(et='<script>document.domain="'+document.domain+'";<\/script>');const nt="<html><body>"+et+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(nt),this.myIFrame.doc.close()}catch(c){log("frame writing exception"),c.stack&&log(c.stack),log(c)}}}static createIFrame_(){const i=document.createElement("iframe");if(i.style.display="none",document.body){document.body.appendChild(i);try{i.contentWindow.document||log("No IE domain setting required")}catch{const a=document.domain;i.src="javascript:void((function(){document.open();document.domain='"+a+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return i.contentDocument?i.doc=i.contentDocument:i.contentWindow?i.doc=i.contentWindow.document:i.document&&(i.doc=i.document),i}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const i=this.onDisconnect;i&&(this.onDisconnect=null,i())}startLongPoll(i,s){for(this.myID=i,this.myPW=s,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const i={};i[FIREBASE_LONGPOLL_ID_PARAM]=this.myID,i[FIREBASE_LONGPOLL_PW_PARAM]=this.myPW,i[FIREBASE_LONGPOLL_SERIAL_PARAM]=this.currentSerial;let s=this.urlFn(i),a="",b=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+SEG_HEADER_SIZE+a.length<=MAX_URL_DATA_SIZE;){const nt=this.pendingSegs.shift();a=a+"&"+FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM+b+"="+nt.seg+"&"+FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET+b+"="+nt.ts+"&"+FIREBASE_LONGPOLL_DATA_PARAM+b+"="+nt.d,b++}return s=s+a,this.addLongPollTag_(s,this.currentSerial),!0}else return!1}enqueueSegment(i,s,a){this.pendingSegs.push({seg:i,ts:s,d:a}),this.alive&&this.newRequest_()}addLongPollTag_(i,s){this.outstandingRequests.add(s);const a=()=>{this.outstandingRequests.delete(s),this.newRequest_()},b=setTimeout(a,Math.floor(KEEPALIVE_REQUEST_INTERVAL)),et=()=>{clearTimeout(b),a()};this.addTag(i,et)}addTag(i,s){setTimeout(()=>{try{if(!this.sendNewPolls)return;const a=this.myIFrame.doc.createElement("script");a.type="text/javascript",a.async=!0,a.src=i,a.onload=a.onreadystatechange=function(){const b=a.readyState;(!b||b==="loaded"||b==="complete")&&(a.onload=a.onreadystatechange=null,a.parentNode&&a.parentNode.removeChild(a),s())},a.onerror=()=>{log("Long-poll script failed to load: "+i),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(a)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WEBSOCKET_MAX_FRAME_SIZE=16384,WEBSOCKET_KEEPALIVE_INTERVAL=45e3;let WebSocketImpl=null;typeof MozWebSocket<"u"?WebSocketImpl=MozWebSocket:typeof WebSocket<"u"&&(WebSocketImpl=WebSocket);class WebSocketConnection{constructor(i,s,a,b,et,nt,c){this.connId=i,this.applicationId=a,this.appCheckToken=b,this.authToken=et,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=logWrapper(this.connId),this.stats_=statsManagerGetCollection(s),this.connURL=WebSocketConnection.connectionURL_(s,nt,c,b,a),this.nodeAdmin=s.nodeAdmin}static connectionURL_(i,s,a,b,et){const nt={};return nt[VERSION_PARAM]=PROTOCOL_VERSION,typeof location<"u"&&location.hostname&&FORGE_DOMAIN_RE.test(location.hostname)&&(nt[REFERER_PARAM]=FORGE_REF),s&&(nt[TRANSPORT_SESSION_PARAM]=s),a&&(nt[LAST_SESSION_PARAM]=a),b&&(nt[APP_CHECK_TOKEN_PARAM]=b),et&&(nt[APPLICATION_ID_PARAM]=et),repoInfoConnectionURL(i,WEBSOCKET,nt)}open(i,s){this.onDisconnect=s,this.onMessage=i,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,PersistentStorage.set("previous_websocket_failure",!0);try{let a;isNodeSdk(),this.mySock=new WebSocketImpl(this.connURL,[],a)}catch(a){this.log_("Error instantiating WebSocket.");const b=a.message||a.data;b&&this.log_(b),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=a=>{this.handleIncomingFrame(a)},this.mySock.onerror=a=>{this.log_("WebSocket error.  Closing connection.");const b=a.message||a.data;b&&this.log_(b),this.onClosed_()}}start(){}static forceDisallow(){WebSocketConnection.forceDisallow_=!0}static isAvailable(){let i=!1;if(typeof navigator<"u"&&navigator.userAgent){const s=/Android ([0-9]{0,}\.[0-9]{0,})/,a=navigator.userAgent.match(s);a&&a.length>1&&parseFloat(a[1])<4.4&&(i=!0)}return!i&&WebSocketImpl!==null&&!WebSocketConnection.forceDisallow_}static previouslyFailed(){return PersistentStorage.isInMemoryStorage||PersistentStorage.get("previous_websocket_failure")===!0}markConnectionHealthy(){PersistentStorage.remove("previous_websocket_failure")}appendFrame_(i){if(this.frames.push(i),this.frames.length===this.totalFrames){const s=this.frames.join("");this.frames=null;const a=jsonEval(s);this.onMessage(a)}}handleNewFrameCount_(i){this.totalFrames=i,this.frames=[]}extractFrameCount_(i){if(assert(this.frames===null,"We already have a frame buffer"),i.length<=6){const s=Number(i);if(!isNaN(s))return this.handleNewFrameCount_(s),null}return this.handleNewFrameCount_(1),i}handleIncomingFrame(i){if(this.mySock===null)return;const s=i.data;if(this.bytesReceived+=s.length,this.stats_.incrementCounter("bytes_received",s.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(s);else{const a=this.extractFrameCount_(s);a!==null&&this.appendFrame_(a)}}send(i){this.resetKeepAlive();const s=stringify(i);this.bytesSent+=s.length,this.stats_.incrementCounter("bytes_sent",s.length);const a=splitStringBySize(s,WEBSOCKET_MAX_FRAME_SIZE);a.length>1&&this.sendString_(String(a.length));for(let b=0;b<a.length;b++)this.sendString_(a[b])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(WEBSOCKET_KEEPALIVE_INTERVAL))}sendString_(i){try{this.mySock.send(i)}catch(s){this.log_("Exception thrown from WebSocket.send():",s.message||s.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}WebSocketConnection.responsesRequiredToBeHealthy=2;WebSocketConnection.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TransportManager{static get ALL_TRANSPORTS(){return[BrowserPollConnection,WebSocketConnection]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(i){this.initTransports_(i)}initTransports_(i){const s=WebSocketConnection&&WebSocketConnection.isAvailable();let a=s&&!WebSocketConnection.previouslyFailed();if(i.webSocketOnly&&(s||warn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),a=!0),a)this.transports_=[WebSocketConnection];else{const b=this.transports_=[];for(const et of TransportManager.ALL_TRANSPORTS)et&&et.isAvailable()&&b.push(et);TransportManager.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}TransportManager.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UPGRADE_TIMEOUT=6e4,DELAY_BEFORE_SENDING_EXTRA_REQUESTS=5e3,BYTES_SENT_HEALTHY_OVERRIDE=10*1024,BYTES_RECEIVED_HEALTHY_OVERRIDE=100*1024,MESSAGE_TYPE="t",MESSAGE_DATA="d",CONTROL_SHUTDOWN="s",CONTROL_RESET="r",CONTROL_ERROR="e",CONTROL_PONG="o",SWITCH_ACK="a",END_TRANSMISSION="n",PING="p",SERVER_HELLO="h";class Connection{constructor(i,s,a,b,et,nt,c,ct,pt,xt){this.id=i,this.repoInfo_=s,this.applicationId_=a,this.appCheckToken_=b,this.authToken_=et,this.onMessage_=nt,this.onReady_=c,this.onDisconnect_=ct,this.onKill_=pt,this.lastSessionId=xt,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=logWrapper("c:"+this.id+":"),this.transportManager_=new TransportManager(s),this.log_("Connection created"),this.start_()}start_(){const i=this.transportManager_.initialTransport();this.conn_=new i(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=i.responsesRequiredToBeHealthy||0;const s=this.connReceiver_(this.conn_),a=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(s,a)},Math.floor(0));const b=i.healthyTimeout||0;b>0&&(this.healthyTimeout_=setTimeoutNonBlocking(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>BYTES_RECEIVED_HEALTHY_OVERRIDE?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>BYTES_SENT_HEALTHY_OVERRIDE?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(b)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(i){return s=>{i===this.conn_?this.onConnectionLost_(s):i===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(i){return s=>{this.state_!==2&&(i===this.rx_?this.onPrimaryMessageReceived_(s):i===this.secondaryConn_?this.onSecondaryMessageReceived_(s):this.log_("message on old connection"))}}sendRequest(i){const s={t:"d",d:i};this.sendData_(s)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(i){if(MESSAGE_TYPE in i){const s=i[MESSAGE_TYPE];s===SWITCH_ACK?this.upgradeIfSecondaryHealthy_():s===CONTROL_RESET?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):s===CONTROL_PONG&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(i){const s=requireKey("t",i),a=requireKey("d",i);if(s==="c")this.onSecondaryControl_(a);else if(s==="d")this.pendingDataMessages.push(a);else throw new Error("Unknown protocol layer: "+s)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:PING,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:SWITCH_ACK,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:END_TRANSMISSION,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(i){const s=requireKey("t",i),a=requireKey("d",i);s==="c"?this.onControl_(a):s==="d"&&this.onDataMessage_(a)}onDataMessage_(i){this.onPrimaryResponse_(),this.onMessage_(i)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(i){const s=requireKey(MESSAGE_TYPE,i);if(MESSAGE_DATA in i){const a=i[MESSAGE_DATA];if(s===SERVER_HELLO){const b={...a};this.repoInfo_.isUsingEmulator&&(b.h=this.repoInfo_.host),this.onHandshake_(b)}else if(s===END_TRANSMISSION){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let b=0;b<this.pendingDataMessages.length;++b)this.onDataMessage_(this.pendingDataMessages[b]);this.pendingDataMessages=[],this.tryCleanupConnection()}else s===CONTROL_SHUTDOWN?this.onConnectionShutdown_(a):s===CONTROL_RESET?this.onReset_(a):s===CONTROL_ERROR?error("Server Error: "+a):s===CONTROL_PONG?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):error("Unknown control packet command: "+s)}}onHandshake_(i){const s=i.ts,a=i.v,b=i.h;this.sessionId=i.s,this.repoInfo_.host=b,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,s),PROTOCOL_VERSION!==a&&warn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const i=this.transportManager_.upgradeTransport();i&&this.startUpgrade_(i)}startUpgrade_(i){this.secondaryConn_=new i(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=i.responsesRequiredToBeHealthy||0;const s=this.connReceiver_(this.secondaryConn_),a=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(s,a),setTimeoutNonBlocking(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(UPGRADE_TIMEOUT))}onReset_(i){this.log_("Reset packet received.  New host: "+i),this.repoInfo_.host=i,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(i,s){this.log_("Realtime connection established."),this.conn_=i,this.state_=1,this.onReady_&&(this.onReady_(s,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):setTimeoutNonBlocking(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(DELAY_BEFORE_SENDING_EXTRA_REQUESTS))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:PING,d:{}}}))}onSecondaryConnectionLost_(){const i=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===i||this.rx_===i)&&this.close()}onConnectionLost_(i){this.conn_=null,!i&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(PersistentStorage.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(i){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(i),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(i){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(i)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ServerActions{put(i,s,a,b){}merge(i,s,a,b){}refreshAuthToken(i){}refreshAppCheckToken(i){}onDisconnectPut(i,s,a){}onDisconnectMerge(i,s,a){}onDisconnectCancel(i,s){}reportStats(i){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EventEmitter{constructor(i){this.allowedEvents_=i,this.listeners_={},assert(Array.isArray(i)&&i.length>0,"Requires a non-empty array")}trigger(i,...s){if(Array.isArray(this.listeners_[i])){const a=[...this.listeners_[i]];for(let b=0;b<a.length;b++)a[b].callback.apply(a[b].context,s)}}on(i,s,a){this.validateEventType_(i),this.listeners_[i]=this.listeners_[i]||[],this.listeners_[i].push({callback:s,context:a});const b=this.getInitialEvent(i);b&&s.apply(a,b)}off(i,s,a){this.validateEventType_(i);const b=this.listeners_[i]||[];for(let et=0;et<b.length;et++)if(b[et].callback===s&&(!a||a===b[et].context)){b.splice(et,1);return}}validateEventType_(i){assert(this.allowedEvents_.find(s=>s===i),"Unknown event: "+i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OnlineMonitor extends EventEmitter{static getInstance(){return new OnlineMonitor}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!isMobileCordova()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(i){return assert(i==="online","Unknown event type: "+i),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MAX_PATH_DEPTH=32,MAX_PATH_LENGTH_BYTES=768;class Path{constructor(i,s){if(s===void 0){this.pieces_=i.split("/");let a=0;for(let b=0;b<this.pieces_.length;b++)this.pieces_[b].length>0&&(this.pieces_[a]=this.pieces_[b],a++);this.pieces_.length=a,this.pieceNum_=0}else this.pieces_=i,this.pieceNum_=s}toString(){let i="";for(let s=this.pieceNum_;s<this.pieces_.length;s++)this.pieces_[s]!==""&&(i+="/"+this.pieces_[s]);return i||"/"}}function newEmptyPath(){return new Path("")}function pathGetFront(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function pathGetLength(e){return e.pieces_.length-e.pieceNum_}function pathPopFront(e){let i=e.pieceNum_;return i<e.pieces_.length&&i++,new Path(e.pieces_,i)}function pathGetBack(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function pathToUrlEncodedString(e){let i="";for(let s=e.pieceNum_;s<e.pieces_.length;s++)e.pieces_[s]!==""&&(i+="/"+encodeURIComponent(String(e.pieces_[s])));return i||"/"}function pathSlice(e,i=0){return e.pieces_.slice(e.pieceNum_+i)}function pathParent(e){if(e.pieceNum_>=e.pieces_.length)return null;const i=[];for(let s=e.pieceNum_;s<e.pieces_.length-1;s++)i.push(e.pieces_[s]);return new Path(i,0)}function pathChild(e,i){const s=[];for(let a=e.pieceNum_;a<e.pieces_.length;a++)s.push(e.pieces_[a]);if(i instanceof Path)for(let a=i.pieceNum_;a<i.pieces_.length;a++)s.push(i.pieces_[a]);else{const a=i.split("/");for(let b=0;b<a.length;b++)a[b].length>0&&s.push(a[b])}return new Path(s,0)}function pathIsEmpty(e){return e.pieceNum_>=e.pieces_.length}function newRelativePath(e,i){const s=pathGetFront(e),a=pathGetFront(i);if(s===null)return i;if(s===a)return newRelativePath(pathPopFront(e),pathPopFront(i));throw new Error("INTERNAL ERROR: innerPath ("+i+") is not within outerPath ("+e+")")}function pathCompare(e,i){const s=pathSlice(e,0),a=pathSlice(i,0);for(let b=0;b<s.length&&b<a.length;b++){const et=nameCompare(s[b],a[b]);if(et!==0)return et}return s.length===a.length?0:s.length<a.length?-1:1}function pathEquals(e,i){if(pathGetLength(e)!==pathGetLength(i))return!1;for(let s=e.pieceNum_,a=i.pieceNum_;s<=e.pieces_.length;s++,a++)if(e.pieces_[s]!==i.pieces_[a])return!1;return!0}function pathContains(e,i){let s=e.pieceNum_,a=i.pieceNum_;if(pathGetLength(e)>pathGetLength(i))return!1;for(;s<e.pieces_.length;){if(e.pieces_[s]!==i.pieces_[a])return!1;++s,++a}return!0}class ValidationPath{constructor(i,s){this.errorPrefix_=s,this.parts_=pathSlice(i,0),this.byteLength_=Math.max(1,this.parts_.length);for(let a=0;a<this.parts_.length;a++)this.byteLength_+=stringLength(this.parts_[a]);validationPathCheckValid(this)}}function validationPathPush(e,i){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(i),e.byteLength_+=stringLength(i),validationPathCheckValid(e)}function validationPathPop(e){const i=e.parts_.pop();e.byteLength_-=stringLength(i),e.parts_.length>0&&(e.byteLength_-=1)}function validationPathCheckValid(e){if(e.byteLength_>MAX_PATH_LENGTH_BYTES)throw new Error(e.errorPrefix_+"has a key path longer than "+MAX_PATH_LENGTH_BYTES+" bytes ("+e.byteLength_+").");if(e.parts_.length>MAX_PATH_DEPTH)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+MAX_PATH_DEPTH+") or object contains a cycle "+validationPathToErrorString(e))}function validationPathToErrorString(e){return e.parts_.length===0?"":"in property '"+e.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VisibilityMonitor extends EventEmitter{static getInstance(){return new VisibilityMonitor}constructor(){super(["visible"]);let i,s;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(s="visibilitychange",i="hidden"):typeof document.mozHidden<"u"?(s="mozvisibilitychange",i="mozHidden"):typeof document.msHidden<"u"?(s="msvisibilitychange",i="msHidden"):typeof document.webkitHidden<"u"&&(s="webkitvisibilitychange",i="webkitHidden")),this.visible_=!0,s&&document.addEventListener(s,()=>{const a=!document[i];a!==this.visible_&&(this.visible_=a,this.trigger("visible",a))},!1)}getInitialEvent(i){return assert(i==="visible","Unknown event type: "+i),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RECONNECT_MIN_DELAY=1e3,RECONNECT_MAX_DELAY_DEFAULT=60*5*1e3,RECONNECT_MAX_DELAY_FOR_ADMINS=30*1e3,RECONNECT_DELAY_MULTIPLIER=1.3,RECONNECT_DELAY_RESET_TIMEOUT=3e4,SERVER_KILL_INTERRUPT_REASON="server_kill",INVALID_TOKEN_THRESHOLD=3;class PersistentConnection extends ServerActions{constructor(i,s,a,b,et,nt,c,ct){if(super(),this.repoInfo_=i,this.applicationId_=s,this.onDataUpdate_=a,this.onConnectStatus_=b,this.onServerInfoUpdate_=et,this.authTokenProvider_=nt,this.appCheckTokenProvider_=c,this.authOverride_=ct,this.id=PersistentConnection.nextPersistentConnectionId_++,this.log_=logWrapper("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=RECONNECT_MIN_DELAY,this.maxReconnectDelay_=RECONNECT_MAX_DELAY_DEFAULT,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,ct&&!isNodeSdk())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");VisibilityMonitor.getInstance().on("visible",this.onVisible_,this),i.host.indexOf("fblocal")===-1&&OnlineMonitor.getInstance().on("online",this.onOnline_,this)}sendRequest(i,s,a){const b=++this.requestNumber_,et={r:b,a:i,b:s};this.log_(stringify(et)),assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(et),a&&(this.requestCBHash_[b]=a)}get(i){this.initConnection_();const s=new Deferred,b={action:"g",request:{p:i._path.toString(),q:i._queryObject},onComplete:nt=>{const c=nt.d;nt.s==="ok"?s.resolve(c):s.reject(c)}};this.outstandingGets_.push(b),this.outstandingGetCount_++;const et=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(et),s.promise}listen(i,s,a,b){this.initConnection_();const et=i._queryIdentifier,nt=i._path.toString();this.log_("Listen called for "+nt+" "+et),this.listens.has(nt)||this.listens.set(nt,new Map),assert(i._queryParams.isDefault()||!i._queryParams.loadsAllData(),"listen() called for non-default but complete query"),assert(!this.listens.get(nt).has(et),"listen() called twice for same path/queryId.");const c={onComplete:b,hashFn:s,query:i,tag:a};this.listens.get(nt).set(et,c),this.connected_&&this.sendListen_(c)}sendGet_(i){const s=this.outstandingGets_[i];this.sendRequest("g",s.request,a=>{delete this.outstandingGets_[i],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),s.onComplete&&s.onComplete(a)})}sendListen_(i){const s=i.query,a=s._path.toString(),b=s._queryIdentifier;this.log_("Listen on "+a+" for "+b);const et={p:a},nt="q";i.tag&&(et.q=s._queryObject,et.t=i.tag),et.h=i.hashFn(),this.sendRequest(nt,et,c=>{const ct=c.d,pt=c.s;PersistentConnection.warnOnListenWarnings_(ct,s),(this.listens.get(a)&&this.listens.get(a).get(b))===i&&(this.log_("listen response",c),pt!=="ok"&&this.removeListen_(a,b),i.onComplete&&i.onComplete(pt,ct))})}static warnOnListenWarnings_(i,s){if(i&&typeof i=="object"&&contains(i,"w")){const a=safeGet(i,"w");if(Array.isArray(a)&&~a.indexOf("no_index")){const b='".indexOn": "'+s._queryParams.getIndex().toString()+'"',et=s._path.toString();warn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${b} at ${et} to your security rules for better performance.`)}}}refreshAuthToken(i){this.authToken_=i,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(i)}reduceReconnectDelayIfAdminCredential_(i){(i&&i.length===40||isAdmin(i))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS)}refreshAppCheckToken(i){this.appCheckToken_=i,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const i=this.authToken_,s=isValidFormat(i)?"auth":"gauth",a={cred:i};this.authOverride_===null?a.noauth=!0:typeof this.authOverride_=="object"&&(a.authvar=this.authOverride_),this.sendRequest(s,a,b=>{const et=b.s,nt=b.d||"error";this.authToken_===i&&(et==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(et,nt))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},i=>{const s=i.s,a=i.d||"error";s==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(s,a)})}unlisten(i,s){const a=i._path.toString(),b=i._queryIdentifier;this.log_("Unlisten called for "+a+" "+b),assert(i._queryParams.isDefault()||!i._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(a,b)&&this.connected_&&this.sendUnlisten_(a,b,i._queryObject,s)}sendUnlisten_(i,s,a,b){this.log_("Unlisten on "+i+" for "+s);const et={p:i},nt="n";b&&(et.q=a,et.t=b),this.sendRequest(nt,et)}onDisconnectPut(i,s,a){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",i,s,a):this.onDisconnectRequestQueue_.push({pathString:i,action:"o",data:s,onComplete:a})}onDisconnectMerge(i,s,a){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",i,s,a):this.onDisconnectRequestQueue_.push({pathString:i,action:"om",data:s,onComplete:a})}onDisconnectCancel(i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",i,null,s):this.onDisconnectRequestQueue_.push({pathString:i,action:"oc",data:null,onComplete:s})}sendOnDisconnect_(i,s,a,b){const et={p:s,d:a};this.log_("onDisconnect "+i,et),this.sendRequest(i,et,nt=>{b&&setTimeout(()=>{b(nt.s,nt.d)},Math.floor(0))})}put(i,s,a,b){this.putInternal("p",i,s,a,b)}merge(i,s,a,b){this.putInternal("m",i,s,a,b)}putInternal(i,s,a,b,et){this.initConnection_();const nt={p:s,d:a};et!==void 0&&(nt.h=et),this.outstandingPuts_.push({action:i,request:nt,onComplete:b}),this.outstandingPutCount_++;const c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+s)}sendPut_(i){const s=this.outstandingPuts_[i].action,a=this.outstandingPuts_[i].request,b=this.outstandingPuts_[i].onComplete;this.outstandingPuts_[i].queued=this.connected_,this.sendRequest(s,a,et=>{this.log_(s+" response",et),delete this.outstandingPuts_[i],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),b&&b(et.s,et.d)})}reportStats(i){if(this.connected_){const s={c:i};this.log_("reportStats",s),this.sendRequest("s",s,a=>{if(a.s!=="ok"){const et=a.d;this.log_("reportStats","Error sending stats: "+et)}})}}onDataMessage_(i){if("r"in i){this.log_("from server: "+stringify(i));const s=i.r,a=this.requestCBHash_[s];a&&(delete this.requestCBHash_[s],a(i.b))}else{if("error"in i)throw"A server-side error has occurred: "+i.error;"a"in i&&this.onDataPush_(i.a,i.b)}}onDataPush_(i,s){this.log_("handleServerMessage",i,s),i==="d"?this.onDataUpdate_(s.p,s.d,!1,s.t):i==="m"?this.onDataUpdate_(s.p,s.d,!0,s.t):i==="c"?this.onListenRevoked_(s.p,s.q):i==="ac"?this.onAuthRevoked_(s.s,s.d):i==="apc"?this.onAppCheckRevoked_(s.s,s.d):i==="sd"?this.onSecurityDebugPacket_(s):error("Unrecognized action received from server: "+stringify(i)+`
Are you using the latest client?`)}onReady_(i,s){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(i),this.lastSessionId=s,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(i){assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(i))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(i){i&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)),this.visible_=i}onOnline_(i){i?(this.log_("Browser went online."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>RECONNECT_DELAY_RESET_TIMEOUT&&(this.reconnectDelay_=RECONNECT_MIN_DELAY),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const i=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let s=Math.max(0,this.reconnectDelay_-i);s=Math.random()*s,this.log_("Trying to reconnect in "+s+"ms"),this.scheduleConnect_(s),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*RECONNECT_DELAY_MULTIPLIER)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const i=this.onDataMessage_.bind(this),s=this.onReady_.bind(this),a=this.onRealtimeDisconnect_.bind(this),b=this.id+":"+PersistentConnection.nextConnectionId_++,et=this.lastSessionId;let nt=!1,c=null;const ct=function(){c?c.close():(nt=!0,a())},pt=function(St){assert(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(St)};this.realtime_={close:ct,sendRequest:pt};const xt=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[St,Et]=await Promise.all([this.authTokenProvider_.getToken(xt),this.appCheckTokenProvider_.getToken(xt)]);nt?log("getToken() completed but was canceled"):(log("getToken() completed. Creating connection."),this.authToken_=St&&St.accessToken,this.appCheckToken_=Et&&Et.token,c=new Connection(b,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,i,s,a,Rt=>{warn(Rt+" ("+this.repoInfo_.toString()+")"),this.interrupt(SERVER_KILL_INTERRUPT_REASON)},et))}catch(St){this.log_("Failed to get token: "+St),nt||(this.repoInfo_.nodeAdmin&&warn(St),ct())}}}interrupt(i){log("Interrupting connection for reason: "+i),this.interruptReasons_[i]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(i){log("Resuming connection for reason: "+i),delete this.interruptReasons_[i],isEmpty(this.interruptReasons_)&&(this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(i){const s=i-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:s})}cancelSentTransactions_(){for(let i=0;i<this.outstandingPuts_.length;i++){const s=this.outstandingPuts_[i];s&&"h"in s.request&&s.queued&&(s.onComplete&&s.onComplete("disconnect"),delete this.outstandingPuts_[i],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(i,s){let a;s?a=s.map(et=>ObjectToUniqueKey(et)).join("$"):a="default";const b=this.removeListen_(i,a);b&&b.onComplete&&b.onComplete("permission_denied")}removeListen_(i,s){const a=new Path(i).toString();let b;if(this.listens.has(a)){const et=this.listens.get(a);b=et.get(s),et.delete(s),et.size===0&&this.listens.delete(a)}else b=void 0;return b}onAuthRevoked_(i,s){log("Auth token revoked: "+i+"/"+s),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(i==="invalid_token"||i==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=INVALID_TOKEN_THRESHOLD&&(this.reconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(i,s){log("App check token revoked: "+i+"/"+s),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(i==="invalid_token"||i==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=INVALID_TOKEN_THRESHOLD&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(i){this.securityDebugCallback_?this.securityDebugCallback_(i):"msg"in i&&console.log("FIREBASE: "+i.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const i of this.listens.values())for(const s of i.values())this.sendListen_(s);for(let i=0;i<this.outstandingPuts_.length;i++)this.outstandingPuts_[i]&&this.sendPut_(i);for(;this.onDisconnectRequestQueue_.length;){const i=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(i.action,i.pathString,i.data,i.onComplete)}for(let i=0;i<this.outstandingGets_.length;i++)this.outstandingGets_[i]&&this.sendGet_(i)}sendConnectStats_(){const i={};let s="js";i["sdk."+s+"."+SDK_VERSION.replace(/\./g,"-")]=1,isMobileCordova()?i["framework.cordova"]=1:isReactNative()&&(i["framework.reactnative"]=1),this.reportStats(i)}shouldReconnect_(){const i=OnlineMonitor.getInstance().currentlyOnline();return isEmpty(this.interruptReasons_)&&i}}PersistentConnection.nextPersistentConnectionId_=0;PersistentConnection.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NamedNode{constructor(i,s){this.name=i,this.node=s}static Wrap(i,s){return new NamedNode(i,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Index{getCompare(){return this.compare.bind(this)}indexedValueChanged(i,s){const a=new NamedNode(MIN_NAME,i),b=new NamedNode(MIN_NAME,s);return this.compare(a,b)!==0}minPost(){return NamedNode.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let __EMPTY_NODE;class KeyIndex extends Index{static get __EMPTY_NODE(){return __EMPTY_NODE}static set __EMPTY_NODE(i){__EMPTY_NODE=i}compare(i,s){return nameCompare(i.name,s.name)}isDefinedOn(i){throw assertionError("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(i,s){return!1}minPost(){return NamedNode.MIN}maxPost(){return new NamedNode(MAX_NAME,__EMPTY_NODE)}makePost(i,s){return assert(typeof i=="string","KeyIndex indexValue must always be a string."),new NamedNode(i,__EMPTY_NODE)}toString(){return".key"}}const KEY_INDEX=new KeyIndex;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SortedMapIterator{constructor(i,s,a,b,et=null){this.isReverse_=b,this.resultGenerator_=et,this.nodeStack_=[];let nt=1;for(;!i.isEmpty();)if(i=i,nt=s?a(i.key,s):1,b&&(nt*=-1),nt<0)this.isReverse_?i=i.left:i=i.right;else if(nt===0){this.nodeStack_.push(i);break}else this.nodeStack_.push(i),this.isReverse_?i=i.right:i=i.left}getNext(){if(this.nodeStack_.length===0)return null;let i=this.nodeStack_.pop(),s;if(this.resultGenerator_?s=this.resultGenerator_(i.key,i.value):s={key:i.key,value:i.value},this.isReverse_)for(i=i.left;!i.isEmpty();)this.nodeStack_.push(i),i=i.right;else for(i=i.right;!i.isEmpty();)this.nodeStack_.push(i),i=i.left;return s}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const i=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(i.key,i.value):{key:i.key,value:i.value}}}class LLRBNode{constructor(i,s,a,b,et){this.key=i,this.value=s,this.color=a??LLRBNode.RED,this.left=b??SortedMap.EMPTY_NODE,this.right=et??SortedMap.EMPTY_NODE}copy(i,s,a,b,et){return new LLRBNode(i??this.key,s??this.value,a??this.color,b??this.left,et??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(i){return this.left.inorderTraversal(i)||!!i(this.key,this.value)||this.right.inorderTraversal(i)}reverseTraversal(i){return this.right.reverseTraversal(i)||i(this.key,this.value)||this.left.reverseTraversal(i)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(i,s,a){let b=this;const et=a(i,b.key);return et<0?b=b.copy(null,null,null,b.left.insert(i,s,a),null):et===0?b=b.copy(null,s,null,null,null):b=b.copy(null,null,null,null,b.right.insert(i,s,a)),b.fixUp_()}removeMin_(){if(this.left.isEmpty())return SortedMap.EMPTY_NODE;let i=this;return!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.removeMin_(),null),i.fixUp_()}remove(i,s){let a,b;if(a=this,s(i,a.key)<0)!a.left.isEmpty()&&!a.left.isRed_()&&!a.left.left.isRed_()&&(a=a.moveRedLeft_()),a=a.copy(null,null,null,a.left.remove(i,s),null);else{if(a.left.isRed_()&&(a=a.rotateRight_()),!a.right.isEmpty()&&!a.right.isRed_()&&!a.right.left.isRed_()&&(a=a.moveRedRight_()),s(i,a.key)===0){if(a.right.isEmpty())return SortedMap.EMPTY_NODE;b=a.right.min_(),a=a.copy(b.key,b.value,null,null,a.right.removeMin_())}a=a.copy(null,null,null,null,a.right.remove(i,s))}return a.fixUp_()}isRed_(){return this.color}fixUp_(){let i=this;return i.right.isRed_()&&!i.left.isRed_()&&(i=i.rotateLeft_()),i.left.isRed_()&&i.left.left.isRed_()&&(i=i.rotateRight_()),i.left.isRed_()&&i.right.isRed_()&&(i=i.colorFlip_()),i}moveRedLeft_(){let i=this.colorFlip_();return i.right.left.isRed_()&&(i=i.copy(null,null,null,null,i.right.rotateRight_()),i=i.rotateLeft_(),i=i.colorFlip_()),i}moveRedRight_(){let i=this.colorFlip_();return i.left.left.isRed_()&&(i=i.rotateRight_(),i=i.colorFlip_()),i}rotateLeft_(){const i=this.copy(null,null,LLRBNode.RED,null,this.right.left);return this.right.copy(null,null,this.color,i,null)}rotateRight_(){const i=this.copy(null,null,LLRBNode.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,i)}colorFlip_(){const i=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,i,s)}checkMaxDepth_(){const i=this.check_();return Math.pow(2,i)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const i=this.left.check_();if(i!==this.right.check_())throw new Error("Black depths differ");return i+(this.isRed_()?0:1)}}LLRBNode.RED=!0;LLRBNode.BLACK=!1;class LLRBEmptyNode{copy(i,s,a,b,et){return this}insert(i,s,a){return new LLRBNode(i,s,null)}remove(i,s){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(i){return!1}reverseTraversal(i){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class SortedMap{constructor(i,s=SortedMap.EMPTY_NODE){this.comparator_=i,this.root_=s}insert(i,s){return new SortedMap(this.comparator_,this.root_.insert(i,s,this.comparator_).copy(null,null,LLRBNode.BLACK,null,null))}remove(i){return new SortedMap(this.comparator_,this.root_.remove(i,this.comparator_).copy(null,null,LLRBNode.BLACK,null,null))}get(i){let s,a=this.root_;for(;!a.isEmpty();){if(s=this.comparator_(i,a.key),s===0)return a.value;s<0?a=a.left:s>0&&(a=a.right)}return null}getPredecessorKey(i){let s,a=this.root_,b=null;for(;!a.isEmpty();)if(s=this.comparator_(i,a.key),s===0){if(a.left.isEmpty())return b?b.key:null;for(a=a.left;!a.right.isEmpty();)a=a.right;return a.key}else s<0?a=a.left:s>0&&(b=a,a=a.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(i){return this.root_.inorderTraversal(i)}reverseTraversal(i){return this.root_.reverseTraversal(i)}getIterator(i){return new SortedMapIterator(this.root_,null,this.comparator_,!1,i)}getIteratorFrom(i,s){return new SortedMapIterator(this.root_,i,this.comparator_,!1,s)}getReverseIteratorFrom(i,s){return new SortedMapIterator(this.root_,i,this.comparator_,!0,s)}getReverseIterator(i){return new SortedMapIterator(this.root_,null,this.comparator_,!0,i)}}SortedMap.EMPTY_NODE=new LLRBEmptyNode;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NAME_ONLY_COMPARATOR(e,i){return nameCompare(e.name,i.name)}function NAME_COMPARATOR(e,i){return nameCompare(e,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let MAX_NODE$2;function setMaxNode$1(e){MAX_NODE$2=e}const priorityHashText=function(e){return typeof e=="number"?"number:"+doubleToIEEE754String(e):"string:"+e},validatePriorityNode=function(e){if(e.isLeafNode()){const i=e.val();assert(typeof i=="string"||typeof i=="number"||typeof i=="object"&&contains(i,".sv"),"Priority must be a string or number.")}else assert(e===MAX_NODE$2||e.isEmpty(),"priority of unexpected type.");assert(e===MAX_NODE$2||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let __childrenNodeConstructor;class LeafNode{static set __childrenNodeConstructor(i){__childrenNodeConstructor=i}static get __childrenNodeConstructor(){return __childrenNodeConstructor}constructor(i,s=LeafNode.__childrenNodeConstructor.EMPTY_NODE){this.value_=i,this.priorityNode_=s,this.lazyHash_=null,assert(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),validatePriorityNode(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(i){return new LeafNode(this.value_,i)}getImmediateChild(i){return i===".priority"?this.priorityNode_:LeafNode.__childrenNodeConstructor.EMPTY_NODE}getChild(i){return pathIsEmpty(i)?this:pathGetFront(i)===".priority"?this.priorityNode_:LeafNode.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(i,s){return null}updateImmediateChild(i,s){return i===".priority"?this.updatePriority(s):s.isEmpty()&&i!==".priority"?this:LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(i,s).updatePriority(this.priorityNode_)}updateChild(i,s){const a=pathGetFront(i);return a===null?s:s.isEmpty()&&a!==".priority"?this:(assert(a!==".priority"||pathGetLength(i)===1,".priority must be the last token in a path"),this.updateImmediateChild(a,LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateChild(pathPopFront(i),s)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(i,s){return!1}val(i){return i&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let i="";this.priorityNode_.isEmpty()||(i+="priority:"+priorityHashText(this.priorityNode_.val())+":");const s=typeof this.value_;i+=s+":",s==="number"?i+=doubleToIEEE754String(this.value_):i+=this.value_,this.lazyHash_=sha1(i)}return this.lazyHash_}getValue(){return this.value_}compareTo(i){return i===LeafNode.__childrenNodeConstructor.EMPTY_NODE?1:i instanceof LeafNode.__childrenNodeConstructor?-1:(assert(i.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(i))}compareToLeafNode_(i){const s=typeof i.value_,a=typeof this.value_,b=LeafNode.VALUE_TYPE_ORDER.indexOf(s),et=LeafNode.VALUE_TYPE_ORDER.indexOf(a);return assert(b>=0,"Unknown leaf type: "+s),assert(et>=0,"Unknown leaf type: "+a),b===et?a==="object"?0:this.value_<i.value_?-1:this.value_===i.value_?0:1:et-b}withIndex(){return this}isIndexed(){return!0}equals(i){if(i===this)return!0;if(i.isLeafNode()){const s=i;return this.value_===s.value_&&this.priorityNode_.equals(s.priorityNode_)}else return!1}}LeafNode.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nodeFromJSON$1,MAX_NODE$1;function setNodeFromJSON(e){nodeFromJSON$1=e}function setMaxNode(e){MAX_NODE$1=e}class PriorityIndex extends Index{compare(i,s){const a=i.node.getPriority(),b=s.node.getPriority(),et=a.compareTo(b);return et===0?nameCompare(i.name,s.name):et}isDefinedOn(i){return!i.getPriority().isEmpty()}indexedValueChanged(i,s){return!i.getPriority().equals(s.getPriority())}minPost(){return NamedNode.MIN}maxPost(){return new NamedNode(MAX_NAME,new LeafNode("[PRIORITY-POST]",MAX_NODE$1))}makePost(i,s){const a=nodeFromJSON$1(i);return new NamedNode(s,new LeafNode("[PRIORITY-POST]",a))}toString(){return".priority"}}const PRIORITY_INDEX=new PriorityIndex;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LOG_2=Math.log(2);class Base12Num{constructor(i){const s=et=>parseInt(Math.log(et)/LOG_2,10),a=et=>parseInt(Array(et+1).join("1"),2);this.count=s(i+1),this.current_=this.count-1;const b=a(this.count);this.bits_=i+1&b}nextBitIsOne(){const i=!(this.bits_&1<<this.current_);return this.current_--,i}}const buildChildSet=function(e,i,s,a){e.sort(i);const b=function(ct,pt){const xt=pt-ct;let St,Et;if(xt===0)return null;if(xt===1)return St=e[ct],Et=s?s(St):St,new LLRBNode(Et,St.node,LLRBNode.BLACK,null,null);{const Rt=parseInt(xt/2,10)+ct,Nt=b(ct,Rt),It=b(Rt+1,pt);return St=e[Rt],Et=s?s(St):St,new LLRBNode(Et,St.node,LLRBNode.BLACK,Nt,It)}},et=function(ct){let pt=null,xt=null,St=e.length;const Et=function(Nt,It){const Gt=St-Nt,Dt=St;St-=Nt;const Bt=b(Gt+1,Dt),Lt=e[Gt],Vt=s?s(Lt):Lt;Rt(new LLRBNode(Vt,Lt.node,It,null,Bt))},Rt=function(Nt){pt?(pt.left=Nt,pt=Nt):(xt=Nt,pt=Nt)};for(let Nt=0;Nt<ct.count;++Nt){const It=ct.nextBitIsOne(),Gt=Math.pow(2,ct.count-(Nt+1));It?Et(Gt,LLRBNode.BLACK):(Et(Gt,LLRBNode.BLACK),Et(Gt,LLRBNode.RED))}return xt},nt=new Base12Num(e.length),c=et(nt);return new SortedMap(a||i,c)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _defaultIndexMap;const fallbackObject={};class IndexMap{static get Default(){return assert(fallbackObject&&PRIORITY_INDEX,"ChildrenNode.ts has not been loaded"),_defaultIndexMap=_defaultIndexMap||new IndexMap({".priority":fallbackObject},{".priority":PRIORITY_INDEX}),_defaultIndexMap}constructor(i,s){this.indexes_=i,this.indexSet_=s}get(i){const s=safeGet(this.indexes_,i);if(!s)throw new Error("No index defined for "+i);return s instanceof SortedMap?s:null}hasIndex(i){return contains(this.indexSet_,i.toString())}addIndex(i,s){assert(i!==KEY_INDEX,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const a=[];let b=!1;const et=s.getIterator(NamedNode.Wrap);let nt=et.getNext();for(;nt;)b=b||i.isDefinedOn(nt.node),a.push(nt),nt=et.getNext();let c;b?c=buildChildSet(a,i.getCompare()):c=fallbackObject;const ct=i.toString(),pt={...this.indexSet_};pt[ct]=i;const xt={...this.indexes_};return xt[ct]=c,new IndexMap(xt,pt)}addToIndexes(i,s){const a=map(this.indexes_,(b,et)=>{const nt=safeGet(this.indexSet_,et);if(assert(nt,"Missing index implementation for "+et),b===fallbackObject)if(nt.isDefinedOn(i.node)){const c=[],ct=s.getIterator(NamedNode.Wrap);let pt=ct.getNext();for(;pt;)pt.name!==i.name&&c.push(pt),pt=ct.getNext();return c.push(i),buildChildSet(c,nt.getCompare())}else return fallbackObject;else{const c=s.get(i.name);let ct=b;return c&&(ct=ct.remove(new NamedNode(i.name,c))),ct.insert(i,i.node)}});return new IndexMap(a,this.indexSet_)}removeFromIndexes(i,s){const a=map(this.indexes_,b=>{if(b===fallbackObject)return b;{const et=s.get(i.name);return et?b.remove(new NamedNode(i.name,et)):b}});return new IndexMap(a,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let EMPTY_NODE;class ChildrenNode{static get EMPTY_NODE(){return EMPTY_NODE||(EMPTY_NODE=new ChildrenNode(new SortedMap(NAME_COMPARATOR),null,IndexMap.Default))}constructor(i,s,a){this.children_=i,this.priorityNode_=s,this.indexMap_=a,this.lazyHash_=null,this.priorityNode_&&validatePriorityNode(this.priorityNode_),this.children_.isEmpty()&&assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||EMPTY_NODE}updatePriority(i){return this.children_.isEmpty()?this:new ChildrenNode(this.children_,i,this.indexMap_)}getImmediateChild(i){if(i===".priority")return this.getPriority();{const s=this.children_.get(i);return s===null?EMPTY_NODE:s}}getChild(i){const s=pathGetFront(i);return s===null?this:this.getImmediateChild(s).getChild(pathPopFront(i))}hasChild(i){return this.children_.get(i)!==null}updateImmediateChild(i,s){if(assert(s,"We should always be passing snapshot nodes"),i===".priority")return this.updatePriority(s);{const a=new NamedNode(i,s);let b,et;s.isEmpty()?(b=this.children_.remove(i),et=this.indexMap_.removeFromIndexes(a,this.children_)):(b=this.children_.insert(i,s),et=this.indexMap_.addToIndexes(a,this.children_));const nt=b.isEmpty()?EMPTY_NODE:this.priorityNode_;return new ChildrenNode(b,nt,et)}}updateChild(i,s){const a=pathGetFront(i);if(a===null)return s;{assert(pathGetFront(i)!==".priority"||pathGetLength(i)===1,".priority must be the last token in a path");const b=this.getImmediateChild(a).updateChild(pathPopFront(i),s);return this.updateImmediateChild(a,b)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(i){if(this.isEmpty())return null;const s={};let a=0,b=0,et=!0;if(this.forEachChild(PRIORITY_INDEX,(nt,c)=>{s[nt]=c.val(i),a++,et&&ChildrenNode.INTEGER_REGEXP_.test(nt)?b=Math.max(b,Number(nt)):et=!1}),!i&&et&&b<2*a){const nt=[];for(const c in s)nt[c]=s[c];return nt}else return i&&!this.getPriority().isEmpty()&&(s[".priority"]=this.getPriority().val()),s}hash(){if(this.lazyHash_===null){let i="";this.getPriority().isEmpty()||(i+="priority:"+priorityHashText(this.getPriority().val())+":"),this.forEachChild(PRIORITY_INDEX,(s,a)=>{const b=a.hash();b!==""&&(i+=":"+s+":"+b)}),this.lazyHash_=i===""?"":sha1(i)}return this.lazyHash_}getPredecessorChildName(i,s,a){const b=this.resolveIndex_(a);if(b){const et=b.getPredecessorKey(new NamedNode(i,s));return et?et.name:null}else return this.children_.getPredecessorKey(i)}getFirstChildName(i){const s=this.resolveIndex_(i);if(s){const a=s.minKey();return a&&a.name}else return this.children_.minKey()}getFirstChild(i){const s=this.getFirstChildName(i);return s?new NamedNode(s,this.children_.get(s)):null}getLastChildName(i){const s=this.resolveIndex_(i);if(s){const a=s.maxKey();return a&&a.name}else return this.children_.maxKey()}getLastChild(i){const s=this.getLastChildName(i);return s?new NamedNode(s,this.children_.get(s)):null}forEachChild(i,s){const a=this.resolveIndex_(i);return a?a.inorderTraversal(b=>s(b.name,b.node)):this.children_.inorderTraversal(s)}getIterator(i){return this.getIteratorFrom(i.minPost(),i)}getIteratorFrom(i,s){const a=this.resolveIndex_(s);if(a)return a.getIteratorFrom(i,b=>b);{const b=this.children_.getIteratorFrom(i.name,NamedNode.Wrap);let et=b.peek();for(;et!=null&&s.compare(et,i)<0;)b.getNext(),et=b.peek();return b}}getReverseIterator(i){return this.getReverseIteratorFrom(i.maxPost(),i)}getReverseIteratorFrom(i,s){const a=this.resolveIndex_(s);if(a)return a.getReverseIteratorFrom(i,b=>b);{const b=this.children_.getReverseIteratorFrom(i.name,NamedNode.Wrap);let et=b.peek();for(;et!=null&&s.compare(et,i)>0;)b.getNext(),et=b.peek();return b}}compareTo(i){return this.isEmpty()?i.isEmpty()?0:-1:i.isLeafNode()||i.isEmpty()?1:i===MAX_NODE?-1:0}withIndex(i){if(i===KEY_INDEX||this.indexMap_.hasIndex(i))return this;{const s=this.indexMap_.addIndex(i,this.children_);return new ChildrenNode(this.children_,this.priorityNode_,s)}}isIndexed(i){return i===KEY_INDEX||this.indexMap_.hasIndex(i)}equals(i){if(i===this)return!0;if(i.isLeafNode())return!1;{const s=i;if(this.getPriority().equals(s.getPriority()))if(this.children_.count()===s.children_.count()){const a=this.getIterator(PRIORITY_INDEX),b=s.getIterator(PRIORITY_INDEX);let et=a.getNext(),nt=b.getNext();for(;et&&nt;){if(et.name!==nt.name||!et.node.equals(nt.node))return!1;et=a.getNext(),nt=b.getNext()}return et===null&&nt===null}else return!1;else return!1}}resolveIndex_(i){return i===KEY_INDEX?null:this.indexMap_.get(i.toString())}}ChildrenNode.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class MaxNode extends ChildrenNode{constructor(){super(new SortedMap(NAME_COMPARATOR),ChildrenNode.EMPTY_NODE,IndexMap.Default)}compareTo(i){return i===this?0:1}equals(i){return i===this}getPriority(){return this}getImmediateChild(i){return ChildrenNode.EMPTY_NODE}isEmpty(){return!1}}const MAX_NODE=new MaxNode;Object.defineProperties(NamedNode,{MIN:{value:new NamedNode(MIN_NAME,ChildrenNode.EMPTY_NODE)},MAX:{value:new NamedNode(MAX_NAME,MAX_NODE)}});KeyIndex.__EMPTY_NODE=ChildrenNode.EMPTY_NODE;LeafNode.__childrenNodeConstructor=ChildrenNode;setMaxNode$1(MAX_NODE);setMaxNode(MAX_NODE);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const USE_HINZE=!0;function nodeFromJSON(e,i=null){if(e===null)return ChildrenNode.EMPTY_NODE;if(typeof e=="object"&&".priority"in e&&(i=e[".priority"]),assert(i===null||typeof i=="string"||typeof i=="number"||typeof i=="object"&&".sv"in i,"Invalid priority type found: "+typeof i),typeof e=="object"&&".value"in e&&e[".value"]!==null&&(e=e[".value"]),typeof e!="object"||".sv"in e){const s=e;return new LeafNode(s,nodeFromJSON(i))}if(!(e instanceof Array)&&USE_HINZE){const s=[];let a=!1;if(each(e,(nt,c)=>{if(nt.substring(0,1)!=="."){const ct=nodeFromJSON(c);ct.isEmpty()||(a=a||!ct.getPriority().isEmpty(),s.push(new NamedNode(nt,ct)))}}),s.length===0)return ChildrenNode.EMPTY_NODE;const et=buildChildSet(s,NAME_ONLY_COMPARATOR,nt=>nt.name,NAME_COMPARATOR);if(a){const nt=buildChildSet(s,PRIORITY_INDEX.getCompare());return new ChildrenNode(et,nodeFromJSON(i),new IndexMap({".priority":nt},{".priority":PRIORITY_INDEX}))}else return new ChildrenNode(et,nodeFromJSON(i),IndexMap.Default)}else{let s=ChildrenNode.EMPTY_NODE;return each(e,(a,b)=>{if(contains(e,a)&&a.substring(0,1)!=="."){const et=nodeFromJSON(b);(et.isLeafNode()||!et.isEmpty())&&(s=s.updateImmediateChild(a,et))}}),s.updatePriority(nodeFromJSON(i))}}setNodeFromJSON(nodeFromJSON);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PathIndex extends Index{constructor(i){super(),this.indexPath_=i,assert(!pathIsEmpty(i)&&pathGetFront(i)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(i){return i.getChild(this.indexPath_)}isDefinedOn(i){return!i.getChild(this.indexPath_).isEmpty()}compare(i,s){const a=this.extractChild(i.node),b=this.extractChild(s.node),et=a.compareTo(b);return et===0?nameCompare(i.name,s.name):et}makePost(i,s){const a=nodeFromJSON(i),b=ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,a);return new NamedNode(s,b)}maxPost(){const i=ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,MAX_NODE);return new NamedNode(MAX_NAME,i)}toString(){return pathSlice(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ValueIndex extends Index{compare(i,s){const a=i.node.compareTo(s.node);return a===0?nameCompare(i.name,s.name):a}isDefinedOn(i){return!0}indexedValueChanged(i,s){return!i.equals(s)}minPost(){return NamedNode.MIN}maxPost(){return NamedNode.MAX}makePost(i,s){const a=nodeFromJSON(i);return new NamedNode(s,a)}toString(){return".value"}}const VALUE_INDEX=new ValueIndex;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function changeValue(e){return{type:"value",snapshotNode:e}}function changeChildAdded(e,i){return{type:"child_added",snapshotNode:i,childName:e}}function changeChildRemoved(e,i){return{type:"child_removed",snapshotNode:i,childName:e}}function changeChildChanged(e,i,s){return{type:"child_changed",snapshotNode:i,childName:e,oldSnap:s}}function changeChildMoved(e,i){return{type:"child_moved",snapshotNode:i,childName:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IndexedFilter{constructor(i){this.index_=i}updateChild(i,s,a,b,et,nt){assert(i.isIndexed(this.index_),"A node must be indexed if only a child is updated");const c=i.getImmediateChild(s);return c.getChild(b).equals(a.getChild(b))&&c.isEmpty()===a.isEmpty()||(nt!=null&&(a.isEmpty()?i.hasChild(s)?nt.trackChildChange(changeChildRemoved(s,c)):assert(i.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):c.isEmpty()?nt.trackChildChange(changeChildAdded(s,a)):nt.trackChildChange(changeChildChanged(s,a,c))),i.isLeafNode()&&a.isEmpty())?i:i.updateImmediateChild(s,a).withIndex(this.index_)}updateFullNode(i,s,a){return a!=null&&(i.isLeafNode()||i.forEachChild(PRIORITY_INDEX,(b,et)=>{s.hasChild(b)||a.trackChildChange(changeChildRemoved(b,et))}),s.isLeafNode()||s.forEachChild(PRIORITY_INDEX,(b,et)=>{if(i.hasChild(b)){const nt=i.getImmediateChild(b);nt.equals(et)||a.trackChildChange(changeChildChanged(b,et,nt))}else a.trackChildChange(changeChildAdded(b,et))})),s.withIndex(this.index_)}updatePriority(i,s){return i.isEmpty()?ChildrenNode.EMPTY_NODE:i.updatePriority(s)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RangedFilter{constructor(i){this.indexedFilter_=new IndexedFilter(i.getIndex()),this.index_=i.getIndex(),this.startPost_=RangedFilter.getStartPost_(i),this.endPost_=RangedFilter.getEndPost_(i),this.startIsInclusive_=!i.startAfterSet_,this.endIsInclusive_=!i.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(i){const s=this.startIsInclusive_?this.index_.compare(this.getStartPost(),i)<=0:this.index_.compare(this.getStartPost(),i)<0,a=this.endIsInclusive_?this.index_.compare(i,this.getEndPost())<=0:this.index_.compare(i,this.getEndPost())<0;return s&&a}updateChild(i,s,a,b,et,nt){return this.matches(new NamedNode(s,a))||(a=ChildrenNode.EMPTY_NODE),this.indexedFilter_.updateChild(i,s,a,b,et,nt)}updateFullNode(i,s,a){s.isLeafNode()&&(s=ChildrenNode.EMPTY_NODE);let b=s.withIndex(this.index_);b=b.updatePriority(ChildrenNode.EMPTY_NODE);const et=this;return s.forEachChild(PRIORITY_INDEX,(nt,c)=>{et.matches(new NamedNode(nt,c))||(b=b.updateImmediateChild(nt,ChildrenNode.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(i,b,a)}updatePriority(i,s){return i}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(i){if(i.hasStart()){const s=i.getIndexStartName();return i.getIndex().makePost(i.getIndexStartValue(),s)}else return i.getIndex().minPost()}static getEndPost_(i){if(i.hasEnd()){const s=i.getIndexEndName();return i.getIndex().makePost(i.getIndexEndValue(),s)}else return i.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LimitedFilter{constructor(i){this.withinDirectionalStart=s=>this.reverse_?this.withinEndPost(s):this.withinStartPost(s),this.withinDirectionalEnd=s=>this.reverse_?this.withinStartPost(s):this.withinEndPost(s),this.withinStartPost=s=>{const a=this.index_.compare(this.rangedFilter_.getStartPost(),s);return this.startIsInclusive_?a<=0:a<0},this.withinEndPost=s=>{const a=this.index_.compare(s,this.rangedFilter_.getEndPost());return this.endIsInclusive_?a<=0:a<0},this.rangedFilter_=new RangedFilter(i),this.index_=i.getIndex(),this.limit_=i.getLimit(),this.reverse_=!i.isViewFromLeft(),this.startIsInclusive_=!i.startAfterSet_,this.endIsInclusive_=!i.endBeforeSet_}updateChild(i,s,a,b,et,nt){return this.rangedFilter_.matches(new NamedNode(s,a))||(a=ChildrenNode.EMPTY_NODE),i.getImmediateChild(s).equals(a)?i:i.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(i,s,a,b,et,nt):this.fullLimitUpdateChild_(i,s,a,et,nt)}updateFullNode(i,s,a){let b;if(s.isLeafNode()||s.isEmpty())b=ChildrenNode.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<s.numChildren()&&s.isIndexed(this.index_)){b=ChildrenNode.EMPTY_NODE.withIndex(this.index_);let et;this.reverse_?et=s.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):et=s.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let nt=0;for(;et.hasNext()&&nt<this.limit_;){const c=et.getNext();if(this.withinDirectionalStart(c))if(this.withinDirectionalEnd(c))b=b.updateImmediateChild(c.name,c.node),nt++;else break;else continue}}else{b=s.withIndex(this.index_),b=b.updatePriority(ChildrenNode.EMPTY_NODE);let et;this.reverse_?et=b.getReverseIterator(this.index_):et=b.getIterator(this.index_);let nt=0;for(;et.hasNext();){const c=et.getNext();nt<this.limit_&&this.withinDirectionalStart(c)&&this.withinDirectionalEnd(c)?nt++:b=b.updateImmediateChild(c.name,ChildrenNode.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(i,b,a)}updatePriority(i,s){return i}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(i,s,a,b,et){let nt;if(this.reverse_){const St=this.index_.getCompare();nt=(Et,Rt)=>St(Rt,Et)}else nt=this.index_.getCompare();const c=i;assert(c.numChildren()===this.limit_,"");const ct=new NamedNode(s,a),pt=this.reverse_?c.getFirstChild(this.index_):c.getLastChild(this.index_),xt=this.rangedFilter_.matches(ct);if(c.hasChild(s)){const St=c.getImmediateChild(s);let Et=b.getChildAfterChild(this.index_,pt,this.reverse_);for(;Et!=null&&(Et.name===s||c.hasChild(Et.name));)Et=b.getChildAfterChild(this.index_,Et,this.reverse_);const Rt=Et==null?1:nt(Et,ct);if(xt&&!a.isEmpty()&&Rt>=0)return et!=null&&et.trackChildChange(changeChildChanged(s,a,St)),c.updateImmediateChild(s,a);{et!=null&&et.trackChildChange(changeChildRemoved(s,St));const It=c.updateImmediateChild(s,ChildrenNode.EMPTY_NODE);return Et!=null&&this.rangedFilter_.matches(Et)?(et!=null&&et.trackChildChange(changeChildAdded(Et.name,Et.node)),It.updateImmediateChild(Et.name,Et.node)):It}}else return a.isEmpty()?i:xt&&nt(pt,ct)>=0?(et!=null&&(et.trackChildChange(changeChildRemoved(pt.name,pt.node)),et.trackChildChange(changeChildAdded(s,a))),c.updateImmediateChild(s,a).updateImmediateChild(pt.name,ChildrenNode.EMPTY_NODE)):i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QueryParams{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=PRIORITY_INDEX}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:MIN_NAME}hasEnd(){return this.endSet_}getIndexEndValue(){return assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:MAX_NAME}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return assert(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===PRIORITY_INDEX}copy(){const i=new QueryParams;return i.limitSet_=this.limitSet_,i.limit_=this.limit_,i.startSet_=this.startSet_,i.startAfterSet_=this.startAfterSet_,i.indexStartValue_=this.indexStartValue_,i.startNameSet_=this.startNameSet_,i.indexStartName_=this.indexStartName_,i.endSet_=this.endSet_,i.endBeforeSet_=this.endBeforeSet_,i.indexEndValue_=this.indexEndValue_,i.endNameSet_=this.endNameSet_,i.indexEndName_=this.indexEndName_,i.index_=this.index_,i.viewFrom_=this.viewFrom_,i}}function queryParamsGetNodeFilter(e){return e.loadsAllData()?new IndexedFilter(e.getIndex()):e.hasLimit()?new LimitedFilter(e):new RangedFilter(e)}function queryParamsToRestQueryStringParameters(e){const i={};if(e.isDefault())return i;let s;if(e.index_===PRIORITY_INDEX?s="$priority":e.index_===VALUE_INDEX?s="$value":e.index_===KEY_INDEX?s="$key":(assert(e.index_ instanceof PathIndex,"Unrecognized index type!"),s=e.index_.toString()),i.orderBy=stringify(s),e.startSet_){const a=e.startAfterSet_?"startAfter":"startAt";i[a]=stringify(e.indexStartValue_),e.startNameSet_&&(i[a]+=","+stringify(e.indexStartName_))}if(e.endSet_){const a=e.endBeforeSet_?"endBefore":"endAt";i[a]=stringify(e.indexEndValue_),e.endNameSet_&&(i[a]+=","+stringify(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?i.limitToFirst=e.limit_:i.limitToLast=e.limit_),i}function queryParamsGetQueryObject(e){const i={};if(e.startSet_&&(i.sp=e.indexStartValue_,e.startNameSet_&&(i.sn=e.indexStartName_),i.sin=!e.startAfterSet_),e.endSet_&&(i.ep=e.indexEndValue_,e.endNameSet_&&(i.en=e.indexEndName_),i.ein=!e.endBeforeSet_),e.limitSet_){i.l=e.limit_;let s=e.viewFrom_;s===""&&(e.isViewFromLeft()?s="l":s="r"),i.vf=s}return e.index_!==PRIORITY_INDEX&&(i.i=e.index_.toString()),i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ReadonlyRestClient extends ServerActions{reportStats(i){throw new Error("Method not implemented.")}static getListenId_(i,s){return s!==void 0?"tag$"+s:(assert(i._queryParams.isDefault(),"should have a tag if it's not a default query."),i._path.toString())}constructor(i,s,a,b){super(),this.repoInfo_=i,this.onDataUpdate_=s,this.authTokenProvider_=a,this.appCheckTokenProvider_=b,this.log_=logWrapper("p:rest:"),this.listens_={}}listen(i,s,a,b){const et=i._path.toString();this.log_("Listen called for "+et+" "+i._queryIdentifier);const nt=ReadonlyRestClient.getListenId_(i,a),c={};this.listens_[nt]=c;const ct=queryParamsToRestQueryStringParameters(i._queryParams);this.restRequest_(et+".json",ct,(pt,xt)=>{let St=xt;if(pt===404&&(St=null,pt=null),pt===null&&this.onDataUpdate_(et,St,!1,a),safeGet(this.listens_,nt)===c){let Et;pt?pt===401?Et="permission_denied":Et="rest_error:"+pt:Et="ok",b(Et,null)}})}unlisten(i,s){const a=ReadonlyRestClient.getListenId_(i,s);delete this.listens_[a]}get(i){const s=queryParamsToRestQueryStringParameters(i._queryParams),a=i._path.toString(),b=new Deferred;return this.restRequest_(a+".json",s,(et,nt)=>{let c=nt;et===404&&(c=null,et=null),et===null?(this.onDataUpdate_(a,c,!1,null),b.resolve(c)):b.reject(new Error(c))}),b.promise}refreshAuthToken(i){}restRequest_(i,s={},a){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([b,et])=>{b&&b.accessToken&&(s.auth=b.accessToken),et&&et.token&&(s.ac=et.token);const nt=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+i+"?ns="+this.repoInfo_.namespace+querystring(s);this.log_("Sending REST request for "+nt);const c=new XMLHttpRequest;c.onreadystatechange=()=>{if(a&&c.readyState===4){this.log_("REST Response for "+nt+" received. status:",c.status,"response:",c.responseText);let ct=null;if(c.status>=200&&c.status<300){try{ct=jsonEval(c.responseText)}catch{warn("Failed to parse JSON response for "+nt+": "+c.responseText)}a(null,ct)}else c.status!==401&&c.status!==404&&warn("Got unsuccessful REST response for "+nt+" Status: "+c.status),a(c.status);a=null}},c.open("GET",nt,!0),c.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SnapshotHolder{constructor(){this.rootNode_=ChildrenNode.EMPTY_NODE}getNode(i){return this.rootNode_.getChild(i)}updateSnapshot(i,s){this.rootNode_=this.rootNode_.updateChild(i,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function newSparseSnapshotTree(){return{value:null,children:new Map}}function sparseSnapshotTreeRemember(e,i,s){if(pathIsEmpty(i))e.value=s,e.children.clear();else if(e.value!==null)e.value=e.value.updateChild(i,s);else{const a=pathGetFront(i);e.children.has(a)||e.children.set(a,newSparseSnapshotTree());const b=e.children.get(a);i=pathPopFront(i),sparseSnapshotTreeRemember(b,i,s)}}function sparseSnapshotTreeForEachTree(e,i,s){e.value!==null?s(i,e.value):sparseSnapshotTreeForEachChild(e,(a,b)=>{const et=new Path(i.toString()+"/"+a);sparseSnapshotTreeForEachTree(b,et,s)})}function sparseSnapshotTreeForEachChild(e,i){e.children.forEach((s,a)=>{i(a,s)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StatsListener{constructor(i){this.collection_=i,this.last_=null}get(){const i=this.collection_.get(),s={...i};return this.last_&&each(this.last_,(a,b)=>{s[a]=s[a]-b}),this.last_=i,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FIRST_STATS_MIN_TIME=10*1e3,FIRST_STATS_MAX_TIME=30*1e3,REPORT_STATS_INTERVAL=5*60*1e3;class StatsReporter{constructor(i,s){this.server_=s,this.statsToReport_={},this.statsListener_=new StatsListener(i);const a=FIRST_STATS_MIN_TIME+(FIRST_STATS_MAX_TIME-FIRST_STATS_MIN_TIME)*Math.random();setTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(a))}reportStats_(){const i=this.statsListener_.get(),s={};let a=!1;each(i,(b,et)=>{et>0&&contains(this.statsToReport_,b)&&(s[b]=et,a=!0)}),a&&this.server_.reportStats(s),setTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(Math.random()*2*REPORT_STATS_INTERVAL))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var OperationType;(function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(OperationType||(OperationType={}));function newOperationSourceUser(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function newOperationSourceServer(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function newOperationSourceServerTaggedQuery(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AckUserWrite{constructor(i,s,a){this.path=i,this.affectedTree=s,this.revert=a,this.type=OperationType.ACK_USER_WRITE,this.source=newOperationSourceUser()}operationForChild(i){if(pathIsEmpty(this.path)){if(this.affectedTree.value!=null)return assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const s=this.affectedTree.subtree(new Path(i));return new AckUserWrite(newEmptyPath(),s,this.revert)}}else return assert(pathGetFront(this.path)===i,"operationForChild called for unrelated child."),new AckUserWrite(pathPopFront(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ListenComplete{constructor(i,s){this.source=i,this.path=s,this.type=OperationType.LISTEN_COMPLETE}operationForChild(i){return pathIsEmpty(this.path)?new ListenComplete(this.source,newEmptyPath()):new ListenComplete(this.source,pathPopFront(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Overwrite{constructor(i,s,a){this.source=i,this.path=s,this.snap=a,this.type=OperationType.OVERWRITE}operationForChild(i){return pathIsEmpty(this.path)?new Overwrite(this.source,newEmptyPath(),this.snap.getImmediateChild(i)):new Overwrite(this.source,pathPopFront(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Merge{constructor(i,s,a){this.source=i,this.path=s,this.children=a,this.type=OperationType.MERGE}operationForChild(i){if(pathIsEmpty(this.path)){const s=this.children.subtree(new Path(i));return s.isEmpty()?null:s.value?new Overwrite(this.source,newEmptyPath(),s.value):new Merge(this.source,newEmptyPath(),s)}else return assert(pathGetFront(this.path)===i,"Can't get a merge for a child not on the path of the operation"),new Merge(this.source,pathPopFront(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CacheNode{constructor(i,s,a){this.node_=i,this.fullyInitialized_=s,this.filtered_=a}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(i){if(pathIsEmpty(i))return this.isFullyInitialized()&&!this.filtered_;const s=pathGetFront(i);return this.isCompleteForChild(s)}isCompleteForChild(i){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(i)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EventGenerator{constructor(i){this.query_=i,this.index_=this.query_._queryParams.getIndex()}}function eventGeneratorGenerateEventsForChanges(e,i,s,a){const b=[],et=[];return i.forEach(nt=>{nt.type==="child_changed"&&e.index_.indexedValueChanged(nt.oldSnap,nt.snapshotNode)&&et.push(changeChildMoved(nt.childName,nt.snapshotNode))}),eventGeneratorGenerateEventsForType(e,b,"child_removed",i,a,s),eventGeneratorGenerateEventsForType(e,b,"child_added",i,a,s),eventGeneratorGenerateEventsForType(e,b,"child_moved",et,a,s),eventGeneratorGenerateEventsForType(e,b,"child_changed",i,a,s),eventGeneratorGenerateEventsForType(e,b,"value",i,a,s),b}function eventGeneratorGenerateEventsForType(e,i,s,a,b,et){const nt=a.filter(c=>c.type===s);nt.sort((c,ct)=>eventGeneratorCompareChanges(e,c,ct)),nt.forEach(c=>{const ct=eventGeneratorMaterializeSingleChange(e,c,et);b.forEach(pt=>{pt.respondsTo(c.type)&&i.push(pt.createEvent(ct,e.query_))})})}function eventGeneratorMaterializeSingleChange(e,i,s){return i.type==="value"||i.type==="child_removed"||(i.prevName=s.getPredecessorChildName(i.childName,i.snapshotNode,e.index_)),i}function eventGeneratorCompareChanges(e,i,s){if(i.childName==null||s.childName==null)throw assertionError("Should only compare child_ events.");const a=new NamedNode(i.childName,i.snapshotNode),b=new NamedNode(s.childName,s.snapshotNode);return e.index_.compare(a,b)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function newViewCache(e,i){return{eventCache:e,serverCache:i}}function viewCacheUpdateEventSnap(e,i,s,a){return newViewCache(new CacheNode(i,s,a),e.serverCache)}function viewCacheUpdateServerSnap(e,i,s,a){return newViewCache(e.eventCache,new CacheNode(i,s,a))}function viewCacheGetCompleteEventSnap(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function viewCacheGetCompleteServerSnap(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let emptyChildrenSingleton;const EmptyChildren=()=>(emptyChildrenSingleton||(emptyChildrenSingleton=new SortedMap(stringCompare)),emptyChildrenSingleton);class ImmutableTree{static fromObject(i){let s=new ImmutableTree(null);return each(i,(a,b)=>{s=s.set(new Path(a),b)}),s}constructor(i,s=EmptyChildren()){this.value=i,this.children=s}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(i,s){if(this.value!=null&&s(this.value))return{path:newEmptyPath(),value:this.value};if(pathIsEmpty(i))return null;{const a=pathGetFront(i),b=this.children.get(a);if(b!==null){const et=b.findRootMostMatchingPathAndValue(pathPopFront(i),s);return et!=null?{path:pathChild(new Path(a),et.path),value:et.value}:null}else return null}}findRootMostValueAndPath(i){return this.findRootMostMatchingPathAndValue(i,()=>!0)}subtree(i){if(pathIsEmpty(i))return this;{const s=pathGetFront(i),a=this.children.get(s);return a!==null?a.subtree(pathPopFront(i)):new ImmutableTree(null)}}set(i,s){if(pathIsEmpty(i))return new ImmutableTree(s,this.children);{const a=pathGetFront(i),et=(this.children.get(a)||new ImmutableTree(null)).set(pathPopFront(i),s),nt=this.children.insert(a,et);return new ImmutableTree(this.value,nt)}}remove(i){if(pathIsEmpty(i))return this.children.isEmpty()?new ImmutableTree(null):new ImmutableTree(null,this.children);{const s=pathGetFront(i),a=this.children.get(s);if(a){const b=a.remove(pathPopFront(i));let et;return b.isEmpty()?et=this.children.remove(s):et=this.children.insert(s,b),this.value===null&&et.isEmpty()?new ImmutableTree(null):new ImmutableTree(this.value,et)}else return this}}get(i){if(pathIsEmpty(i))return this.value;{const s=pathGetFront(i),a=this.children.get(s);return a?a.get(pathPopFront(i)):null}}setTree(i,s){if(pathIsEmpty(i))return s;{const a=pathGetFront(i),et=(this.children.get(a)||new ImmutableTree(null)).setTree(pathPopFront(i),s);let nt;return et.isEmpty()?nt=this.children.remove(a):nt=this.children.insert(a,et),new ImmutableTree(this.value,nt)}}fold(i){return this.fold_(newEmptyPath(),i)}fold_(i,s){const a={};return this.children.inorderTraversal((b,et)=>{a[b]=et.fold_(pathChild(i,b),s)}),s(i,this.value,a)}findOnPath(i,s){return this.findOnPath_(i,newEmptyPath(),s)}findOnPath_(i,s,a){const b=this.value?a(s,this.value):!1;if(b)return b;if(pathIsEmpty(i))return null;{const et=pathGetFront(i),nt=this.children.get(et);return nt?nt.findOnPath_(pathPopFront(i),pathChild(s,et),a):null}}foreachOnPath(i,s){return this.foreachOnPath_(i,newEmptyPath(),s)}foreachOnPath_(i,s,a){if(pathIsEmpty(i))return this;{this.value&&a(s,this.value);const b=pathGetFront(i),et=this.children.get(b);return et?et.foreachOnPath_(pathPopFront(i),pathChild(s,b),a):new ImmutableTree(null)}}foreach(i){this.foreach_(newEmptyPath(),i)}foreach_(i,s){this.children.inorderTraversal((a,b)=>{b.foreach_(pathChild(i,a),s)}),this.value&&s(i,this.value)}foreachChild(i){this.children.inorderTraversal((s,a)=>{a.value&&i(s,a.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CompoundWrite{constructor(i){this.writeTree_=i}static empty(){return new CompoundWrite(new ImmutableTree(null))}}function compoundWriteAddWrite(e,i,s){if(pathIsEmpty(i))return new CompoundWrite(new ImmutableTree(s));{const a=e.writeTree_.findRootMostValueAndPath(i);if(a!=null){const b=a.path;let et=a.value;const nt=newRelativePath(b,i);return et=et.updateChild(nt,s),new CompoundWrite(e.writeTree_.set(b,et))}else{const b=new ImmutableTree(s),et=e.writeTree_.setTree(i,b);return new CompoundWrite(et)}}}function compoundWriteAddWrites(e,i,s){let a=e;return each(s,(b,et)=>{a=compoundWriteAddWrite(a,pathChild(i,b),et)}),a}function compoundWriteRemoveWrite(e,i){if(pathIsEmpty(i))return CompoundWrite.empty();{const s=e.writeTree_.setTree(i,new ImmutableTree(null));return new CompoundWrite(s)}}function compoundWriteHasCompleteWrite(e,i){return compoundWriteGetCompleteNode(e,i)!=null}function compoundWriteGetCompleteNode(e,i){const s=e.writeTree_.findRootMostValueAndPath(i);return s!=null?e.writeTree_.get(s.path).getChild(newRelativePath(s.path,i)):null}function compoundWriteGetCompleteChildren(e){const i=[],s=e.writeTree_.value;return s!=null?s.isLeafNode()||s.forEachChild(PRIORITY_INDEX,(a,b)=>{i.push(new NamedNode(a,b))}):e.writeTree_.children.inorderTraversal((a,b)=>{b.value!=null&&i.push(new NamedNode(a,b.value))}),i}function compoundWriteChildCompoundWrite(e,i){if(pathIsEmpty(i))return e;{const s=compoundWriteGetCompleteNode(e,i);return s!=null?new CompoundWrite(new ImmutableTree(s)):new CompoundWrite(e.writeTree_.subtree(i))}}function compoundWriteIsEmpty(e){return e.writeTree_.isEmpty()}function compoundWriteApply(e,i){return applySubtreeWrite(newEmptyPath(),e.writeTree_,i)}function applySubtreeWrite(e,i,s){if(i.value!=null)return s.updateChild(e,i.value);{let a=null;return i.children.inorderTraversal((b,et)=>{b===".priority"?(assert(et.value!==null,"Priority writes must always be leaf nodes"),a=et.value):s=applySubtreeWrite(pathChild(e,b),et,s)}),!s.getChild(e).isEmpty()&&a!==null&&(s=s.updateChild(pathChild(e,".priority"),a)),s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function writeTreeChildWrites(e,i){return newWriteTreeRef(i,e)}function writeTreeAddOverwrite(e,i,s,a,b){assert(a>e.lastWriteId,"Stacking an older write on top of newer ones"),b===void 0&&(b=!0),e.allWrites.push({path:i,snap:s,writeId:a,visible:b}),b&&(e.visibleWrites=compoundWriteAddWrite(e.visibleWrites,i,s)),e.lastWriteId=a}function writeTreeAddMerge(e,i,s,a){assert(a>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:i,children:s,writeId:a,visible:!0}),e.visibleWrites=compoundWriteAddWrites(e.visibleWrites,i,s),e.lastWriteId=a}function writeTreeGetWrite(e,i){for(let s=0;s<e.allWrites.length;s++){const a=e.allWrites[s];if(a.writeId===i)return a}return null}function writeTreeRemoveWrite(e,i){const s=e.allWrites.findIndex(c=>c.writeId===i);assert(s>=0,"removeWrite called with nonexistent writeId.");const a=e.allWrites[s];e.allWrites.splice(s,1);let b=a.visible,et=!1,nt=e.allWrites.length-1;for(;b&&nt>=0;){const c=e.allWrites[nt];c.visible&&(nt>=s&&writeTreeRecordContainsPath_(c,a.path)?b=!1:pathContains(a.path,c.path)&&(et=!0)),nt--}if(b){if(et)return writeTreeResetTree_(e),!0;if(a.snap)e.visibleWrites=compoundWriteRemoveWrite(e.visibleWrites,a.path);else{const c=a.children;each(c,ct=>{e.visibleWrites=compoundWriteRemoveWrite(e.visibleWrites,pathChild(a.path,ct))})}return!0}else return!1}function writeTreeRecordContainsPath_(e,i){if(e.snap)return pathContains(e.path,i);for(const s in e.children)if(e.children.hasOwnProperty(s)&&pathContains(pathChild(e.path,s),i))return!0;return!1}function writeTreeResetTree_(e){e.visibleWrites=writeTreeLayerTree_(e.allWrites,writeTreeDefaultFilter_,newEmptyPath()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}function writeTreeDefaultFilter_(e){return e.visible}function writeTreeLayerTree_(e,i,s){let a=CompoundWrite.empty();for(let b=0;b<e.length;++b){const et=e[b];if(i(et)){const nt=et.path;let c;if(et.snap)pathContains(s,nt)?(c=newRelativePath(s,nt),a=compoundWriteAddWrite(a,c,et.snap)):pathContains(nt,s)&&(c=newRelativePath(nt,s),a=compoundWriteAddWrite(a,newEmptyPath(),et.snap.getChild(c)));else if(et.children){if(pathContains(s,nt))c=newRelativePath(s,nt),a=compoundWriteAddWrites(a,c,et.children);else if(pathContains(nt,s))if(c=newRelativePath(nt,s),pathIsEmpty(c))a=compoundWriteAddWrites(a,newEmptyPath(),et.children);else{const ct=safeGet(et.children,pathGetFront(c));if(ct){const pt=ct.getChild(pathPopFront(c));a=compoundWriteAddWrite(a,newEmptyPath(),pt)}}}else throw assertionError("WriteRecord should have .snap or .children")}}return a}function writeTreeCalcCompleteEventCache(e,i,s,a,b){if(!a&&!b){const et=compoundWriteGetCompleteNode(e.visibleWrites,i);if(et!=null)return et;{const nt=compoundWriteChildCompoundWrite(e.visibleWrites,i);if(compoundWriteIsEmpty(nt))return s;if(s==null&&!compoundWriteHasCompleteWrite(nt,newEmptyPath()))return null;{const c=s||ChildrenNode.EMPTY_NODE;return compoundWriteApply(nt,c)}}}else{const et=compoundWriteChildCompoundWrite(e.visibleWrites,i);if(!b&&compoundWriteIsEmpty(et))return s;if(!b&&s==null&&!compoundWriteHasCompleteWrite(et,newEmptyPath()))return null;{const nt=function(pt){return(pt.visible||b)&&(!a||!~a.indexOf(pt.writeId))&&(pathContains(pt.path,i)||pathContains(i,pt.path))},c=writeTreeLayerTree_(e.allWrites,nt,i),ct=s||ChildrenNode.EMPTY_NODE;return compoundWriteApply(c,ct)}}}function writeTreeCalcCompleteEventChildren(e,i,s){let a=ChildrenNode.EMPTY_NODE;const b=compoundWriteGetCompleteNode(e.visibleWrites,i);if(b)return b.isLeafNode()||b.forEachChild(PRIORITY_INDEX,(et,nt)=>{a=a.updateImmediateChild(et,nt)}),a;if(s){const et=compoundWriteChildCompoundWrite(e.visibleWrites,i);return s.forEachChild(PRIORITY_INDEX,(nt,c)=>{const ct=compoundWriteApply(compoundWriteChildCompoundWrite(et,new Path(nt)),c);a=a.updateImmediateChild(nt,ct)}),compoundWriteGetCompleteChildren(et).forEach(nt=>{a=a.updateImmediateChild(nt.name,nt.node)}),a}else{const et=compoundWriteChildCompoundWrite(e.visibleWrites,i);return compoundWriteGetCompleteChildren(et).forEach(nt=>{a=a.updateImmediateChild(nt.name,nt.node)}),a}}function writeTreeCalcEventCacheAfterServerOverwrite(e,i,s,a,b){assert(a||b,"Either existingEventSnap or existingServerSnap must exist");const et=pathChild(i,s);if(compoundWriteHasCompleteWrite(e.visibleWrites,et))return null;{const nt=compoundWriteChildCompoundWrite(e.visibleWrites,et);return compoundWriteIsEmpty(nt)?b.getChild(s):compoundWriteApply(nt,b.getChild(s))}}function writeTreeCalcCompleteChild(e,i,s,a){const b=pathChild(i,s),et=compoundWriteGetCompleteNode(e.visibleWrites,b);if(et!=null)return et;if(a.isCompleteForChild(s)){const nt=compoundWriteChildCompoundWrite(e.visibleWrites,b);return compoundWriteApply(nt,a.getNode().getImmediateChild(s))}else return null}function writeTreeShadowingWrite(e,i){return compoundWriteGetCompleteNode(e.visibleWrites,i)}function writeTreeCalcIndexedSlice(e,i,s,a,b,et,nt){let c;const ct=compoundWriteChildCompoundWrite(e.visibleWrites,i),pt=compoundWriteGetCompleteNode(ct,newEmptyPath());if(pt!=null)c=pt;else if(s!=null)c=compoundWriteApply(ct,s);else return[];if(c=c.withIndex(nt),!c.isEmpty()&&!c.isLeafNode()){const xt=[],St=nt.getCompare(),Et=et?c.getReverseIteratorFrom(a,nt):c.getIteratorFrom(a,nt);let Rt=Et.getNext();for(;Rt&&xt.length<b;)St(Rt,a)!==0&&xt.push(Rt),Rt=Et.getNext();return xt}else return[]}function newWriteTree(){return{visibleWrites:CompoundWrite.empty(),allWrites:[],lastWriteId:-1}}function writeTreeRefCalcCompleteEventCache(e,i,s,a){return writeTreeCalcCompleteEventCache(e.writeTree,e.treePath,i,s,a)}function writeTreeRefCalcCompleteEventChildren(e,i){return writeTreeCalcCompleteEventChildren(e.writeTree,e.treePath,i)}function writeTreeRefCalcEventCacheAfterServerOverwrite(e,i,s,a){return writeTreeCalcEventCacheAfterServerOverwrite(e.writeTree,e.treePath,i,s,a)}function writeTreeRefShadowingWrite(e,i){return writeTreeShadowingWrite(e.writeTree,pathChild(e.treePath,i))}function writeTreeRefCalcIndexedSlice(e,i,s,a,b,et){return writeTreeCalcIndexedSlice(e.writeTree,e.treePath,i,s,a,b,et)}function writeTreeRefCalcCompleteChild(e,i,s){return writeTreeCalcCompleteChild(e.writeTree,e.treePath,i,s)}function writeTreeRefChild(e,i){return newWriteTreeRef(pathChild(e.treePath,i),e.writeTree)}function newWriteTreeRef(e,i){return{treePath:e,writeTree:i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ChildChangeAccumulator{constructor(){this.changeMap=new Map}trackChildChange(i){const s=i.type,a=i.childName;assert(s==="child_added"||s==="child_changed"||s==="child_removed","Only child changes supported for tracking"),assert(a!==".priority","Only non-priority child changes can be tracked.");const b=this.changeMap.get(a);if(b){const et=b.type;if(s==="child_added"&&et==="child_removed")this.changeMap.set(a,changeChildChanged(a,i.snapshotNode,b.snapshotNode));else if(s==="child_removed"&&et==="child_added")this.changeMap.delete(a);else if(s==="child_removed"&&et==="child_changed")this.changeMap.set(a,changeChildRemoved(a,b.oldSnap));else if(s==="child_changed"&&et==="child_added")this.changeMap.set(a,changeChildAdded(a,i.snapshotNode));else if(s==="child_changed"&&et==="child_changed")this.changeMap.set(a,changeChildChanged(a,i.snapshotNode,b.oldSnap));else throw assertionError("Illegal combination of changes: "+i+" occurred after "+b)}else this.changeMap.set(a,i)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NoCompleteChildSource_{getCompleteChild(i){return null}getChildAfterChild(i,s,a){return null}}const NO_COMPLETE_CHILD_SOURCE=new NoCompleteChildSource_;class WriteTreeCompleteChildSource{constructor(i,s,a=null){this.writes_=i,this.viewCache_=s,this.optCompleteServerCache_=a}getCompleteChild(i){const s=this.viewCache_.eventCache;if(s.isCompleteForChild(i))return s.getNode().getImmediateChild(i);{const a=this.optCompleteServerCache_!=null?new CacheNode(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return writeTreeRefCalcCompleteChild(this.writes_,i,a)}}getChildAfterChild(i,s,a){const b=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:viewCacheGetCompleteServerSnap(this.viewCache_),et=writeTreeRefCalcIndexedSlice(this.writes_,b,s,1,a,i);return et.length===0?null:et[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function newViewProcessor(e){return{filter:e}}function viewProcessorAssertIndexed(e,i){assert(i.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),assert(i.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed")}function viewProcessorApplyOperation(e,i,s,a,b){const et=new ChildChangeAccumulator;let nt,c;if(s.type===OperationType.OVERWRITE){const pt=s;pt.source.fromUser?nt=viewProcessorApplyUserOverwrite(e,i,pt.path,pt.snap,a,b,et):(assert(pt.source.fromServer,"Unknown source."),c=pt.source.tagged||i.serverCache.isFiltered()&&!pathIsEmpty(pt.path),nt=viewProcessorApplyServerOverwrite(e,i,pt.path,pt.snap,a,b,c,et))}else if(s.type===OperationType.MERGE){const pt=s;pt.source.fromUser?nt=viewProcessorApplyUserMerge(e,i,pt.path,pt.children,a,b,et):(assert(pt.source.fromServer,"Unknown source."),c=pt.source.tagged||i.serverCache.isFiltered(),nt=viewProcessorApplyServerMerge(e,i,pt.path,pt.children,a,b,c,et))}else if(s.type===OperationType.ACK_USER_WRITE){const pt=s;pt.revert?nt=viewProcessorRevertUserWrite(e,i,pt.path,a,b,et):nt=viewProcessorAckUserWrite(e,i,pt.path,pt.affectedTree,a,b,et)}else if(s.type===OperationType.LISTEN_COMPLETE)nt=viewProcessorListenComplete(e,i,s.path,a,et);else throw assertionError("Unknown operation type: "+s.type);const ct=et.getChanges();return viewProcessorMaybeAddValueEvent(i,nt,ct),{viewCache:nt,changes:ct}}function viewProcessorMaybeAddValueEvent(e,i,s){const a=i.eventCache;if(a.isFullyInitialized()){const b=a.getNode().isLeafNode()||a.getNode().isEmpty(),et=viewCacheGetCompleteEventSnap(e);(s.length>0||!e.eventCache.isFullyInitialized()||b&&!a.getNode().equals(et)||!a.getNode().getPriority().equals(et.getPriority()))&&s.push(changeValue(viewCacheGetCompleteEventSnap(i)))}}function viewProcessorGenerateEventCacheAfterServerEvent(e,i,s,a,b,et){const nt=i.eventCache;if(writeTreeRefShadowingWrite(a,s)!=null)return i;{let c,ct;if(pathIsEmpty(s))if(assert(i.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),i.serverCache.isFiltered()){const pt=viewCacheGetCompleteServerSnap(i),xt=pt instanceof ChildrenNode?pt:ChildrenNode.EMPTY_NODE,St=writeTreeRefCalcCompleteEventChildren(a,xt);c=e.filter.updateFullNode(i.eventCache.getNode(),St,et)}else{const pt=writeTreeRefCalcCompleteEventCache(a,viewCacheGetCompleteServerSnap(i));c=e.filter.updateFullNode(i.eventCache.getNode(),pt,et)}else{const pt=pathGetFront(s);if(pt===".priority"){assert(pathGetLength(s)===1,"Can't have a priority with additional path components");const xt=nt.getNode();ct=i.serverCache.getNode();const St=writeTreeRefCalcEventCacheAfterServerOverwrite(a,s,xt,ct);St!=null?c=e.filter.updatePriority(xt,St):c=nt.getNode()}else{const xt=pathPopFront(s);let St;if(nt.isCompleteForChild(pt)){ct=i.serverCache.getNode();const Et=writeTreeRefCalcEventCacheAfterServerOverwrite(a,s,nt.getNode(),ct);Et!=null?St=nt.getNode().getImmediateChild(pt).updateChild(xt,Et):St=nt.getNode().getImmediateChild(pt)}else St=writeTreeRefCalcCompleteChild(a,pt,i.serverCache);St!=null?c=e.filter.updateChild(nt.getNode(),pt,St,xt,b,et):c=nt.getNode()}}return viewCacheUpdateEventSnap(i,c,nt.isFullyInitialized()||pathIsEmpty(s),e.filter.filtersNodes())}}function viewProcessorApplyServerOverwrite(e,i,s,a,b,et,nt,c){const ct=i.serverCache;let pt;const xt=nt?e.filter:e.filter.getIndexedFilter();if(pathIsEmpty(s))pt=xt.updateFullNode(ct.getNode(),a,null);else if(xt.filtersNodes()&&!ct.isFiltered()){const Rt=ct.getNode().updateChild(s,a);pt=xt.updateFullNode(ct.getNode(),Rt,null)}else{const Rt=pathGetFront(s);if(!ct.isCompleteForPath(s)&&pathGetLength(s)>1)return i;const Nt=pathPopFront(s),Gt=ct.getNode().getImmediateChild(Rt).updateChild(Nt,a);Rt===".priority"?pt=xt.updatePriority(ct.getNode(),Gt):pt=xt.updateChild(ct.getNode(),Rt,Gt,Nt,NO_COMPLETE_CHILD_SOURCE,null)}const St=viewCacheUpdateServerSnap(i,pt,ct.isFullyInitialized()||pathIsEmpty(s),xt.filtersNodes()),Et=new WriteTreeCompleteChildSource(b,St,et);return viewProcessorGenerateEventCacheAfterServerEvent(e,St,s,b,Et,c)}function viewProcessorApplyUserOverwrite(e,i,s,a,b,et,nt){const c=i.eventCache;let ct,pt;const xt=new WriteTreeCompleteChildSource(b,i,et);if(pathIsEmpty(s))pt=e.filter.updateFullNode(i.eventCache.getNode(),a,nt),ct=viewCacheUpdateEventSnap(i,pt,!0,e.filter.filtersNodes());else{const St=pathGetFront(s);if(St===".priority")pt=e.filter.updatePriority(i.eventCache.getNode(),a),ct=viewCacheUpdateEventSnap(i,pt,c.isFullyInitialized(),c.isFiltered());else{const Et=pathPopFront(s),Rt=c.getNode().getImmediateChild(St);let Nt;if(pathIsEmpty(Et))Nt=a;else{const It=xt.getCompleteChild(St);It!=null?pathGetBack(Et)===".priority"&&It.getChild(pathParent(Et)).isEmpty()?Nt=It:Nt=It.updateChild(Et,a):Nt=ChildrenNode.EMPTY_NODE}if(Rt.equals(Nt))ct=i;else{const It=e.filter.updateChild(c.getNode(),St,Nt,Et,xt,nt);ct=viewCacheUpdateEventSnap(i,It,c.isFullyInitialized(),e.filter.filtersNodes())}}}return ct}function viewProcessorCacheHasChild(e,i){return e.eventCache.isCompleteForChild(i)}function viewProcessorApplyUserMerge(e,i,s,a,b,et,nt){let c=i;return a.foreach((ct,pt)=>{const xt=pathChild(s,ct);viewProcessorCacheHasChild(i,pathGetFront(xt))&&(c=viewProcessorApplyUserOverwrite(e,c,xt,pt,b,et,nt))}),a.foreach((ct,pt)=>{const xt=pathChild(s,ct);viewProcessorCacheHasChild(i,pathGetFront(xt))||(c=viewProcessorApplyUserOverwrite(e,c,xt,pt,b,et,nt))}),c}function viewProcessorApplyMerge(e,i,s){return s.foreach((a,b)=>{i=i.updateChild(a,b)}),i}function viewProcessorApplyServerMerge(e,i,s,a,b,et,nt,c){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized())return i;let ct=i,pt;pathIsEmpty(s)?pt=a:pt=new ImmutableTree(null).setTree(s,a);const xt=i.serverCache.getNode();return pt.children.inorderTraversal((St,Et)=>{if(xt.hasChild(St)){const Rt=i.serverCache.getNode().getImmediateChild(St),Nt=viewProcessorApplyMerge(e,Rt,Et);ct=viewProcessorApplyServerOverwrite(e,ct,new Path(St),Nt,b,et,nt,c)}}),pt.children.inorderTraversal((St,Et)=>{const Rt=!i.serverCache.isCompleteForChild(St)&&Et.value===null;if(!xt.hasChild(St)&&!Rt){const Nt=i.serverCache.getNode().getImmediateChild(St),It=viewProcessorApplyMerge(e,Nt,Et);ct=viewProcessorApplyServerOverwrite(e,ct,new Path(St),It,b,et,nt,c)}}),ct}function viewProcessorAckUserWrite(e,i,s,a,b,et,nt){if(writeTreeRefShadowingWrite(b,s)!=null)return i;const c=i.serverCache.isFiltered(),ct=i.serverCache;if(a.value!=null){if(pathIsEmpty(s)&&ct.isFullyInitialized()||ct.isCompleteForPath(s))return viewProcessorApplyServerOverwrite(e,i,s,ct.getNode().getChild(s),b,et,c,nt);if(pathIsEmpty(s)){let pt=new ImmutableTree(null);return ct.getNode().forEachChild(KEY_INDEX,(xt,St)=>{pt=pt.set(new Path(xt),St)}),viewProcessorApplyServerMerge(e,i,s,pt,b,et,c,nt)}else return i}else{let pt=new ImmutableTree(null);return a.foreach((xt,St)=>{const Et=pathChild(s,xt);ct.isCompleteForPath(Et)&&(pt=pt.set(xt,ct.getNode().getChild(Et)))}),viewProcessorApplyServerMerge(e,i,s,pt,b,et,c,nt)}}function viewProcessorListenComplete(e,i,s,a,b){const et=i.serverCache,nt=viewCacheUpdateServerSnap(i,et.getNode(),et.isFullyInitialized()||pathIsEmpty(s),et.isFiltered());return viewProcessorGenerateEventCacheAfterServerEvent(e,nt,s,a,NO_COMPLETE_CHILD_SOURCE,b)}function viewProcessorRevertUserWrite(e,i,s,a,b,et){let nt;if(writeTreeRefShadowingWrite(a,s)!=null)return i;{const c=new WriteTreeCompleteChildSource(a,i,b),ct=i.eventCache.getNode();let pt;if(pathIsEmpty(s)||pathGetFront(s)===".priority"){let xt;if(i.serverCache.isFullyInitialized())xt=writeTreeRefCalcCompleteEventCache(a,viewCacheGetCompleteServerSnap(i));else{const St=i.serverCache.getNode();assert(St instanceof ChildrenNode,"serverChildren would be complete if leaf node"),xt=writeTreeRefCalcCompleteEventChildren(a,St)}xt=xt,pt=e.filter.updateFullNode(ct,xt,et)}else{const xt=pathGetFront(s);let St=writeTreeRefCalcCompleteChild(a,xt,i.serverCache);St==null&&i.serverCache.isCompleteForChild(xt)&&(St=ct.getImmediateChild(xt)),St!=null?pt=e.filter.updateChild(ct,xt,St,pathPopFront(s),c,et):i.eventCache.getNode().hasChild(xt)?pt=e.filter.updateChild(ct,xt,ChildrenNode.EMPTY_NODE,pathPopFront(s),c,et):pt=ct,pt.isEmpty()&&i.serverCache.isFullyInitialized()&&(nt=writeTreeRefCalcCompleteEventCache(a,viewCacheGetCompleteServerSnap(i)),nt.isLeafNode()&&(pt=e.filter.updateFullNode(pt,nt,et)))}return nt=i.serverCache.isFullyInitialized()||writeTreeRefShadowingWrite(a,newEmptyPath())!=null,viewCacheUpdateEventSnap(i,pt,nt,e.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class View{constructor(i,s){this.query_=i,this.eventRegistrations_=[];const a=this.query_._queryParams,b=new IndexedFilter(a.getIndex()),et=queryParamsGetNodeFilter(a);this.processor_=newViewProcessor(et);const nt=s.serverCache,c=s.eventCache,ct=b.updateFullNode(ChildrenNode.EMPTY_NODE,nt.getNode(),null),pt=et.updateFullNode(ChildrenNode.EMPTY_NODE,c.getNode(),null),xt=new CacheNode(ct,nt.isFullyInitialized(),b.filtersNodes()),St=new CacheNode(pt,c.isFullyInitialized(),et.filtersNodes());this.viewCache_=newViewCache(St,xt),this.eventGenerator_=new EventGenerator(this.query_)}get query(){return this.query_}}function viewGetServerCache(e){return e.viewCache_.serverCache.getNode()}function viewGetCompleteNode(e){return viewCacheGetCompleteEventSnap(e.viewCache_)}function viewGetCompleteServerCache(e,i){const s=viewCacheGetCompleteServerSnap(e.viewCache_);return s&&(e.query._queryParams.loadsAllData()||!pathIsEmpty(i)&&!s.getImmediateChild(pathGetFront(i)).isEmpty())?s.getChild(i):null}function viewIsEmpty(e){return e.eventRegistrations_.length===0}function viewAddEventRegistration(e,i){e.eventRegistrations_.push(i)}function viewRemoveEventRegistration(e,i,s){const a=[];if(s){assert(i==null,"A cancel should cancel all event registrations.");const b=e.query._path;e.eventRegistrations_.forEach(et=>{const nt=et.createCancelEvent(s,b);nt&&a.push(nt)})}if(i){let b=[];for(let et=0;et<e.eventRegistrations_.length;++et){const nt=e.eventRegistrations_[et];if(!nt.matches(i))b.push(nt);else if(i.hasAnyCallback()){b=b.concat(e.eventRegistrations_.slice(et+1));break}}e.eventRegistrations_=b}else e.eventRegistrations_=[];return a}function viewApplyOperation(e,i,s,a){i.type===OperationType.MERGE&&i.source.queryId!==null&&(assert(viewCacheGetCompleteServerSnap(e.viewCache_),"We should always have a full cache before handling merges"),assert(viewCacheGetCompleteEventSnap(e.viewCache_),"Missing event cache, even though we have a server cache"));const b=e.viewCache_,et=viewProcessorApplyOperation(e.processor_,b,i,s,a);return viewProcessorAssertIndexed(e.processor_,et.viewCache),assert(et.viewCache.serverCache.isFullyInitialized()||!b.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=et.viewCache,viewGenerateEventsForChanges_(e,et.changes,et.viewCache.eventCache.getNode(),null)}function viewGetInitialEvents(e,i){const s=e.viewCache_.eventCache,a=[];return s.getNode().isLeafNode()||s.getNode().forEachChild(PRIORITY_INDEX,(et,nt)=>{a.push(changeChildAdded(et,nt))}),s.isFullyInitialized()&&a.push(changeValue(s.getNode())),viewGenerateEventsForChanges_(e,a,s.getNode(),i)}function viewGenerateEventsForChanges_(e,i,s,a){const b=a?[a]:e.eventRegistrations_;return eventGeneratorGenerateEventsForChanges(e.eventGenerator_,i,s,b)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let referenceConstructor$1;class SyncPoint{constructor(){this.views=new Map}}function syncPointSetReferenceConstructor(e){assert(!referenceConstructor$1,"__referenceConstructor has already been defined"),referenceConstructor$1=e}function syncPointGetReferenceConstructor(){return assert(referenceConstructor$1,"Reference.ts has not been loaded"),referenceConstructor$1}function syncPointIsEmpty(e){return e.views.size===0}function syncPointApplyOperation(e,i,s,a){const b=i.source.queryId;if(b!==null){const et=e.views.get(b);return assert(et!=null,"SyncTree gave us an op for an invalid query."),viewApplyOperation(et,i,s,a)}else{let et=[];for(const nt of e.views.values())et=et.concat(viewApplyOperation(nt,i,s,a));return et}}function syncPointGetView(e,i,s,a,b){const et=i._queryIdentifier,nt=e.views.get(et);if(!nt){let c=writeTreeRefCalcCompleteEventCache(s,b?a:null),ct=!1;c?ct=!0:a instanceof ChildrenNode?(c=writeTreeRefCalcCompleteEventChildren(s,a),ct=!1):(c=ChildrenNode.EMPTY_NODE,ct=!1);const pt=newViewCache(new CacheNode(c,ct,!1),new CacheNode(a,b,!1));return new View(i,pt)}return nt}function syncPointAddEventRegistration(e,i,s,a,b,et){const nt=syncPointGetView(e,i,a,b,et);return e.views.has(i._queryIdentifier)||e.views.set(i._queryIdentifier,nt),viewAddEventRegistration(nt,s),viewGetInitialEvents(nt,s)}function syncPointRemoveEventRegistration(e,i,s,a){const b=i._queryIdentifier,et=[];let nt=[];const c=syncPointHasCompleteView(e);if(b==="default")for(const[ct,pt]of e.views.entries())nt=nt.concat(viewRemoveEventRegistration(pt,s,a)),viewIsEmpty(pt)&&(e.views.delete(ct),pt.query._queryParams.loadsAllData()||et.push(pt.query));else{const ct=e.views.get(b);ct&&(nt=nt.concat(viewRemoveEventRegistration(ct,s,a)),viewIsEmpty(ct)&&(e.views.delete(b),ct.query._queryParams.loadsAllData()||et.push(ct.query)))}return c&&!syncPointHasCompleteView(e)&&et.push(new(syncPointGetReferenceConstructor())(i._repo,i._path)),{removed:et,events:nt}}function syncPointGetQueryViews(e){const i=[];for(const s of e.views.values())s.query._queryParams.loadsAllData()||i.push(s);return i}function syncPointGetCompleteServerCache(e,i){let s=null;for(const a of e.views.values())s=s||viewGetCompleteServerCache(a,i);return s}function syncPointViewForQuery(e,i){if(i._queryParams.loadsAllData())return syncPointGetCompleteView(e);{const a=i._queryIdentifier;return e.views.get(a)}}function syncPointViewExistsForQuery(e,i){return syncPointViewForQuery(e,i)!=null}function syncPointHasCompleteView(e){return syncPointGetCompleteView(e)!=null}function syncPointGetCompleteView(e){for(const i of e.views.values())if(i.query._queryParams.loadsAllData())return i;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let referenceConstructor;function syncTreeSetReferenceConstructor(e){assert(!referenceConstructor,"__referenceConstructor has already been defined"),referenceConstructor=e}function syncTreeGetReferenceConstructor(){return assert(referenceConstructor,"Reference.ts has not been loaded"),referenceConstructor}let syncTreeNextQueryTag_=1;class SyncTree{constructor(i){this.listenProvider_=i,this.syncPointTree_=new ImmutableTree(null),this.pendingWriteTree_=newWriteTree(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function syncTreeApplyUserOverwrite(e,i,s,a,b){return writeTreeAddOverwrite(e.pendingWriteTree_,i,s,a,b),b?syncTreeApplyOperationToSyncPoints_(e,new Overwrite(newOperationSourceUser(),i,s)):[]}function syncTreeApplyUserMerge(e,i,s,a){writeTreeAddMerge(e.pendingWriteTree_,i,s,a);const b=ImmutableTree.fromObject(s);return syncTreeApplyOperationToSyncPoints_(e,new Merge(newOperationSourceUser(),i,b))}function syncTreeAckUserWrite(e,i,s=!1){const a=writeTreeGetWrite(e.pendingWriteTree_,i);if(writeTreeRemoveWrite(e.pendingWriteTree_,i)){let et=new ImmutableTree(null);return a.snap!=null?et=et.set(newEmptyPath(),!0):each(a.children,nt=>{et=et.set(new Path(nt),!0)}),syncTreeApplyOperationToSyncPoints_(e,new AckUserWrite(a.path,et,s))}else return[]}function syncTreeApplyServerOverwrite(e,i,s){return syncTreeApplyOperationToSyncPoints_(e,new Overwrite(newOperationSourceServer(),i,s))}function syncTreeApplyServerMerge(e,i,s){const a=ImmutableTree.fromObject(s);return syncTreeApplyOperationToSyncPoints_(e,new Merge(newOperationSourceServer(),i,a))}function syncTreeApplyListenComplete(e,i){return syncTreeApplyOperationToSyncPoints_(e,new ListenComplete(newOperationSourceServer(),i))}function syncTreeApplyTaggedListenComplete(e,i,s){const a=syncTreeQueryKeyForTag_(e,s);if(a){const b=syncTreeParseQueryKey_(a),et=b.path,nt=b.queryId,c=newRelativePath(et,i),ct=new ListenComplete(newOperationSourceServerTaggedQuery(nt),c);return syncTreeApplyTaggedOperation_(e,et,ct)}else return[]}function syncTreeRemoveEventRegistration(e,i,s,a,b=!1){const et=i._path,nt=e.syncPointTree_.get(et);let c=[];if(nt&&(i._queryIdentifier==="default"||syncPointViewExistsForQuery(nt,i))){const ct=syncPointRemoveEventRegistration(nt,i,s,a);syncPointIsEmpty(nt)&&(e.syncPointTree_=e.syncPointTree_.remove(et));const pt=ct.removed;if(c=ct.events,!b){const xt=pt.findIndex(Et=>Et._queryParams.loadsAllData())!==-1,St=e.syncPointTree_.findOnPath(et,(Et,Rt)=>syncPointHasCompleteView(Rt));if(xt&&!St){const Et=e.syncPointTree_.subtree(et);if(!Et.isEmpty()){const Rt=syncTreeCollectDistinctViewsForSubTree_(Et);for(let Nt=0;Nt<Rt.length;++Nt){const It=Rt[Nt],Gt=It.query,Dt=syncTreeCreateListenerForView_(e,It);e.listenProvider_.startListening(syncTreeQueryForListening_(Gt),syncTreeTagForQuery(e,Gt),Dt.hashFn,Dt.onComplete)}}}!St&&pt.length>0&&!a&&(xt?e.listenProvider_.stopListening(syncTreeQueryForListening_(i),null):pt.forEach(Et=>{const Rt=e.queryToTagMap.get(syncTreeMakeQueryKey_(Et));e.listenProvider_.stopListening(syncTreeQueryForListening_(Et),Rt)}))}syncTreeRemoveTags_(e,pt)}return c}function syncTreeApplyTaggedQueryOverwrite(e,i,s,a){const b=syncTreeQueryKeyForTag_(e,a);if(b!=null){const et=syncTreeParseQueryKey_(b),nt=et.path,c=et.queryId,ct=newRelativePath(nt,i),pt=new Overwrite(newOperationSourceServerTaggedQuery(c),ct,s);return syncTreeApplyTaggedOperation_(e,nt,pt)}else return[]}function syncTreeApplyTaggedQueryMerge(e,i,s,a){const b=syncTreeQueryKeyForTag_(e,a);if(b){const et=syncTreeParseQueryKey_(b),nt=et.path,c=et.queryId,ct=newRelativePath(nt,i),pt=ImmutableTree.fromObject(s),xt=new Merge(newOperationSourceServerTaggedQuery(c),ct,pt);return syncTreeApplyTaggedOperation_(e,nt,xt)}else return[]}function syncTreeAddEventRegistration(e,i,s,a=!1){const b=i._path;let et=null,nt=!1;e.syncPointTree_.foreachOnPath(b,(Et,Rt)=>{const Nt=newRelativePath(Et,b);et=et||syncPointGetCompleteServerCache(Rt,Nt),nt=nt||syncPointHasCompleteView(Rt)});let c=e.syncPointTree_.get(b);c?(nt=nt||syncPointHasCompleteView(c),et=et||syncPointGetCompleteServerCache(c,newEmptyPath())):(c=new SyncPoint,e.syncPointTree_=e.syncPointTree_.set(b,c));let ct;et!=null?ct=!0:(ct=!1,et=ChildrenNode.EMPTY_NODE,e.syncPointTree_.subtree(b).foreachChild((Rt,Nt)=>{const It=syncPointGetCompleteServerCache(Nt,newEmptyPath());It&&(et=et.updateImmediateChild(Rt,It))}));const pt=syncPointViewExistsForQuery(c,i);if(!pt&&!i._queryParams.loadsAllData()){const Et=syncTreeMakeQueryKey_(i);assert(!e.queryToTagMap.has(Et),"View does not exist, but we have a tag");const Rt=syncTreeGetNextQueryTag_();e.queryToTagMap.set(Et,Rt),e.tagToQueryMap.set(Rt,Et)}const xt=writeTreeChildWrites(e.pendingWriteTree_,b);let St=syncPointAddEventRegistration(c,i,s,xt,et,ct);if(!pt&&!nt&&!a){const Et=syncPointViewForQuery(c,i);St=St.concat(syncTreeSetupListener_(e,i,Et))}return St}function syncTreeCalcCompleteEventCache(e,i,s){const b=e.pendingWriteTree_,et=e.syncPointTree_.findOnPath(i,(nt,c)=>{const ct=newRelativePath(nt,i),pt=syncPointGetCompleteServerCache(c,ct);if(pt)return pt});return writeTreeCalcCompleteEventCache(b,i,et,s,!0)}function syncTreeGetServerValue(e,i){const s=i._path;let a=null;e.syncPointTree_.foreachOnPath(s,(pt,xt)=>{const St=newRelativePath(pt,s);a=a||syncPointGetCompleteServerCache(xt,St)});let b=e.syncPointTree_.get(s);b?a=a||syncPointGetCompleteServerCache(b,newEmptyPath()):(b=new SyncPoint,e.syncPointTree_=e.syncPointTree_.set(s,b));const et=a!=null,nt=et?new CacheNode(a,!0,!1):null,c=writeTreeChildWrites(e.pendingWriteTree_,i._path),ct=syncPointGetView(b,i,c,et?nt.getNode():ChildrenNode.EMPTY_NODE,et);return viewGetCompleteNode(ct)}function syncTreeApplyOperationToSyncPoints_(e,i){return syncTreeApplyOperationHelper_(i,e.syncPointTree_,null,writeTreeChildWrites(e.pendingWriteTree_,newEmptyPath()))}function syncTreeApplyOperationHelper_(e,i,s,a){if(pathIsEmpty(e.path))return syncTreeApplyOperationDescendantsHelper_(e,i,s,a);{const b=i.get(newEmptyPath());s==null&&b!=null&&(s=syncPointGetCompleteServerCache(b,newEmptyPath()));let et=[];const nt=pathGetFront(e.path),c=e.operationForChild(nt),ct=i.children.get(nt);if(ct&&c){const pt=s?s.getImmediateChild(nt):null,xt=writeTreeRefChild(a,nt);et=et.concat(syncTreeApplyOperationHelper_(c,ct,pt,xt))}return b&&(et=et.concat(syncPointApplyOperation(b,e,a,s))),et}}function syncTreeApplyOperationDescendantsHelper_(e,i,s,a){const b=i.get(newEmptyPath());s==null&&b!=null&&(s=syncPointGetCompleteServerCache(b,newEmptyPath()));let et=[];return i.children.inorderTraversal((nt,c)=>{const ct=s?s.getImmediateChild(nt):null,pt=writeTreeRefChild(a,nt),xt=e.operationForChild(nt);xt&&(et=et.concat(syncTreeApplyOperationDescendantsHelper_(xt,c,ct,pt)))}),b&&(et=et.concat(syncPointApplyOperation(b,e,a,s))),et}function syncTreeCreateListenerForView_(e,i){const s=i.query,a=syncTreeTagForQuery(e,s);return{hashFn:()=>(viewGetServerCache(i)||ChildrenNode.EMPTY_NODE).hash(),onComplete:b=>{if(b==="ok")return a?syncTreeApplyTaggedListenComplete(e,s._path,a):syncTreeApplyListenComplete(e,s._path);{const et=errorForServerCode(b,s);return syncTreeRemoveEventRegistration(e,s,null,et)}}}}function syncTreeTagForQuery(e,i){const s=syncTreeMakeQueryKey_(i);return e.queryToTagMap.get(s)}function syncTreeMakeQueryKey_(e){return e._path.toString()+"$"+e._queryIdentifier}function syncTreeQueryKeyForTag_(e,i){return e.tagToQueryMap.get(i)}function syncTreeParseQueryKey_(e){const i=e.indexOf("$");return assert(i!==-1&&i<e.length-1,"Bad queryKey."),{queryId:e.substr(i+1),path:new Path(e.substr(0,i))}}function syncTreeApplyTaggedOperation_(e,i,s){const a=e.syncPointTree_.get(i);assert(a,"Missing sync point for query tag that we're tracking");const b=writeTreeChildWrites(e.pendingWriteTree_,i);return syncPointApplyOperation(a,s,b,null)}function syncTreeCollectDistinctViewsForSubTree_(e){return e.fold((i,s,a)=>{if(s&&syncPointHasCompleteView(s))return[syncPointGetCompleteView(s)];{let b=[];return s&&(b=syncPointGetQueryViews(s)),each(a,(et,nt)=>{b=b.concat(nt)}),b}})}function syncTreeQueryForListening_(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(syncTreeGetReferenceConstructor())(e._repo,e._path):e}function syncTreeRemoveTags_(e,i){for(let s=0;s<i.length;++s){const a=i[s];if(!a._queryParams.loadsAllData()){const b=syncTreeMakeQueryKey_(a),et=e.queryToTagMap.get(b);e.queryToTagMap.delete(b),e.tagToQueryMap.delete(et)}}}function syncTreeGetNextQueryTag_(){return syncTreeNextQueryTag_++}function syncTreeSetupListener_(e,i,s){const a=i._path,b=syncTreeTagForQuery(e,i),et=syncTreeCreateListenerForView_(e,s),nt=e.listenProvider_.startListening(syncTreeQueryForListening_(i),b,et.hashFn,et.onComplete),c=e.syncPointTree_.subtree(a);if(b)assert(!syncPointHasCompleteView(c.value),"If we're adding a query, it shouldn't be shadowed");else{const ct=c.fold((pt,xt,St)=>{if(!pathIsEmpty(pt)&&xt&&syncPointHasCompleteView(xt))return[syncPointGetCompleteView(xt).query];{let Et=[];return xt&&(Et=Et.concat(syncPointGetQueryViews(xt).map(Rt=>Rt.query))),each(St,(Rt,Nt)=>{Et=Et.concat(Nt)}),Et}});for(let pt=0;pt<ct.length;++pt){const xt=ct[pt];e.listenProvider_.stopListening(syncTreeQueryForListening_(xt),syncTreeTagForQuery(e,xt))}}return nt}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ExistingValueProvider{constructor(i){this.node_=i}getImmediateChild(i){const s=this.node_.getImmediateChild(i);return new ExistingValueProvider(s)}node(){return this.node_}}class DeferredValueProvider{constructor(i,s){this.syncTree_=i,this.path_=s}getImmediateChild(i){const s=pathChild(this.path_,i);return new DeferredValueProvider(this.syncTree_,s)}node(){return syncTreeCalcCompleteEventCache(this.syncTree_,this.path_)}}const generateWithValues=function(e){return e=e||{},e.timestamp=e.timestamp||new Date().getTime(),e},resolveDeferredLeafValue=function(e,i,s){if(!e||typeof e!="object")return e;if(assert(".sv"in e,"Unexpected leaf node or priority contents"),typeof e[".sv"]=="string")return resolveScalarDeferredValue(e[".sv"],i,s);if(typeof e[".sv"]=="object")return resolveComplexDeferredValue(e[".sv"],i);assert(!1,"Unexpected server value: "+JSON.stringify(e,null,2))},resolveScalarDeferredValue=function(e,i,s){switch(e){case"timestamp":return s.timestamp;default:assert(!1,"Unexpected server value: "+e)}},resolveComplexDeferredValue=function(e,i,s){e.hasOwnProperty("increment")||assert(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const a=e.increment;typeof a!="number"&&assert(!1,"Unexpected increment value: "+a);const b=i.node();if(assert(b!==null&&typeof b<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!b.isLeafNode())return a;const nt=b.getValue();return typeof nt!="number"?a:nt+a},resolveDeferredValueTree=function(e,i,s,a){return resolveDeferredValue(i,new DeferredValueProvider(s,e),a)},resolveDeferredValueSnapshot=function(e,i,s){return resolveDeferredValue(e,new ExistingValueProvider(i),s)};function resolveDeferredValue(e,i,s){const a=e.getPriority().val(),b=resolveDeferredLeafValue(a,i.getImmediateChild(".priority"),s);let et;if(e.isLeafNode()){const nt=e,c=resolveDeferredLeafValue(nt.getValue(),i,s);return c!==nt.getValue()||b!==nt.getPriority().val()?new LeafNode(c,nodeFromJSON(b)):e}else{const nt=e;return et=nt,b!==nt.getPriority().val()&&(et=et.updatePriority(new LeafNode(b))),nt.forEachChild(PRIORITY_INDEX,(c,ct)=>{const pt=resolveDeferredValue(ct,i.getImmediateChild(c),s);pt!==ct&&(et=et.updateImmediateChild(c,pt))}),et}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tree{constructor(i="",s=null,a={children:{},childCount:0}){this.name=i,this.parent=s,this.node=a}}function treeSubTree(e,i){let s=i instanceof Path?i:new Path(i),a=e,b=pathGetFront(s);for(;b!==null;){const et=safeGet(a.node.children,b)||{children:{},childCount:0};a=new Tree(b,a,et),s=pathPopFront(s),b=pathGetFront(s)}return a}function treeGetValue(e){return e.node.value}function treeSetValue(e,i){e.node.value=i,treeUpdateParents(e)}function treeHasChildren(e){return e.node.childCount>0}function treeIsEmpty(e){return treeGetValue(e)===void 0&&!treeHasChildren(e)}function treeForEachChild(e,i){each(e.node.children,(s,a)=>{i(new Tree(s,e,a))})}function treeForEachDescendant(e,i,s,a){s&&!a&&i(e),treeForEachChild(e,b=>{treeForEachDescendant(b,i,!0,a)}),s&&a&&i(e)}function treeForEachAncestor(e,i,s){let a=e.parent;for(;a!==null;){if(i(a))return!0;a=a.parent}return!1}function treeGetPath(e){return new Path(e.parent===null?e.name:treeGetPath(e.parent)+"/"+e.name)}function treeUpdateParents(e){e.parent!==null&&treeUpdateChild(e.parent,e.name,e)}function treeUpdateChild(e,i,s){const a=treeIsEmpty(s),b=contains(e.node.children,i);a&&b?(delete e.node.children[i],e.node.childCount--,treeUpdateParents(e)):!a&&!b&&(e.node.children[i]=s.node,e.node.childCount++,treeUpdateParents(e))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const INVALID_KEY_REGEX_=/[\[\].#$\/\u0000-\u001F\u007F]/,INVALID_PATH_REGEX_=/[\[\].#$\u0000-\u001F\u007F]/,MAX_LEAF_SIZE_=10*1024*1024,isValidKey=function(e){return typeof e=="string"&&e.length!==0&&!INVALID_KEY_REGEX_.test(e)},isValidPathString=function(e){return typeof e=="string"&&e.length!==0&&!INVALID_PATH_REGEX_.test(e)},isValidRootPathString=function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),isValidPathString(e)},isValidPriority=function(e){return e===null||typeof e=="string"||typeof e=="number"&&!isInvalidJSONNumber(e)||e&&typeof e=="object"&&contains(e,".sv")},validateFirebaseDataArg=function(e,i,s,a){a&&i===void 0||validateFirebaseData(errorPrefix(e,"value"),i,s)},validateFirebaseData=function(e,i,s){const a=s instanceof Path?new ValidationPath(s,e):s;if(i===void 0)throw new Error(e+"contains undefined "+validationPathToErrorString(a));if(typeof i=="function")throw new Error(e+"contains a function "+validationPathToErrorString(a)+" with contents = "+i.toString());if(isInvalidJSONNumber(i))throw new Error(e+"contains "+i.toString()+" "+validationPathToErrorString(a));if(typeof i=="string"&&i.length>MAX_LEAF_SIZE_/3&&stringLength(i)>MAX_LEAF_SIZE_)throw new Error(e+"contains a string greater than "+MAX_LEAF_SIZE_+" utf8 bytes "+validationPathToErrorString(a)+" ('"+i.substring(0,50)+"...')");if(i&&typeof i=="object"){let b=!1,et=!1;if(each(i,(nt,c)=>{if(nt===".value")b=!0;else if(nt!==".priority"&&nt!==".sv"&&(et=!0,!isValidKey(nt)))throw new Error(e+" contains an invalid key ("+nt+") "+validationPathToErrorString(a)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);validationPathPush(a,nt),validateFirebaseData(e,c,a),validationPathPop(a)}),b&&et)throw new Error(e+' contains ".value" child '+validationPathToErrorString(a)+" in addition to actual children.")}},validateFirebaseMergePaths=function(e,i){let s,a;for(s=0;s<i.length;s++){a=i[s];const et=pathSlice(a);for(let nt=0;nt<et.length;nt++)if(!(et[nt]===".priority"&&nt===et.length-1)){if(!isValidKey(et[nt]))throw new Error(e+"contains an invalid key ("+et[nt]+") in path "+a.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}i.sort(pathCompare);let b=null;for(s=0;s<i.length;s++){if(a=i[s],b!==null&&pathContains(b,a))throw new Error(e+"contains a path "+b.toString()+" that is ancestor of another path "+a.toString());b=a}},validateFirebaseMergeDataArg=function(e,i,s,a){const b=errorPrefix(e,"values");if(!(i&&typeof i=="object")||Array.isArray(i))throw new Error(b+" must be an object containing the children to replace.");const et=[];each(i,(nt,c)=>{const ct=new Path(nt);if(validateFirebaseData(b,c,pathChild(s,ct)),pathGetBack(ct)===".priority"&&!isValidPriority(c))throw new Error(b+"contains an invalid value for '"+ct.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");et.push(ct)}),validateFirebaseMergePaths(b,et)},validatePathString=function(e,i,s,a){if(!isValidPathString(s))throw new Error(errorPrefix(e,i)+'was an invalid path = "'+s+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},validateRootPathString=function(e,i,s,a){s&&(s=s.replace(/^\/*\.info(\/|$)/,"/")),validatePathString(e,i,s)},validateWritablePath=function(e,i){if(pathGetFront(i)===".info")throw new Error(e+" failed = Can't modify data under /.info/")},validateUrl=function(e,i){const s=i.path.toString();if(typeof i.repoInfo.host!="string"||i.repoInfo.host.length===0||!isValidKey(i.repoInfo.namespace)&&i.repoInfo.host.split(":")[0]!=="localhost"||s.length!==0&&!isValidRootPathString(s))throw new Error(errorPrefix(e,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EventQueue{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function eventQueueQueueEvents(e,i){let s=null;for(let a=0;a<i.length;a++){const b=i[a],et=b.getPath();s!==null&&!pathEquals(et,s.path)&&(e.eventLists_.push(s),s=null),s===null&&(s={events:[],path:et}),s.events.push(b)}s&&e.eventLists_.push(s)}function eventQueueRaiseEventsAtPath(e,i,s){eventQueueQueueEvents(e,s),eventQueueRaiseQueuedEventsMatchingPredicate(e,a=>pathEquals(a,i))}function eventQueueRaiseEventsForChangedPath(e,i,s){eventQueueQueueEvents(e,s),eventQueueRaiseQueuedEventsMatchingPredicate(e,a=>pathContains(a,i)||pathContains(i,a))}function eventQueueRaiseQueuedEventsMatchingPredicate(e,i){e.recursionDepth_++;let s=!0;for(let a=0;a<e.eventLists_.length;a++){const b=e.eventLists_[a];if(b){const et=b.path;i(et)?(eventListRaise(e.eventLists_[a]),e.eventLists_[a]=null):s=!1}}s&&(e.eventLists_=[]),e.recursionDepth_--}function eventListRaise(e){for(let i=0;i<e.events.length;i++){const s=e.events[i];if(s!==null){e.events[i]=null;const a=s.getEventRunner();logger&&log("event: "+s.toString()),exceptionGuard(a)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const INTERRUPT_REASON="repo_interrupt",MAX_TRANSACTION_RETRIES=25;class Repo{constructor(i,s,a,b){this.repoInfo_=i,this.forceRestClient_=s,this.authTokenProvider_=a,this.appCheckProvider_=b,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new EventQueue,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=newSparseSnapshotTree(),this.transactionQueueTree_=new Tree,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function repoStart(e,i,s){if(e.stats_=statsManagerGetCollection(e.repoInfo_),e.forceRestClient_||beingCrawled())e.server_=new ReadonlyRestClient(e.repoInfo_,(a,b,et,nt)=>{repoOnDataUpdate(e,a,b,et,nt)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>repoOnConnectStatus(e,!0),0);else{if(typeof s<"u"&&s!==null){if(typeof s!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{stringify(s)}catch(a){throw new Error("Invalid authOverride provided: "+a)}}e.persistentConnection_=new PersistentConnection(e.repoInfo_,i,(a,b,et,nt)=>{repoOnDataUpdate(e,a,b,et,nt)},a=>{repoOnConnectStatus(e,a)},a=>{repoOnServerInfoUpdate(e,a)},e.authTokenProvider_,e.appCheckProvider_,s),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(a=>{e.server_.refreshAuthToken(a)}),e.appCheckProvider_.addTokenChangeListener(a=>{e.server_.refreshAppCheckToken(a.token)}),e.statsReporter_=statsManagerGetOrCreateReporter(e.repoInfo_,()=>new StatsReporter(e.stats_,e.server_)),e.infoData_=new SnapshotHolder,e.infoSyncTree_=new SyncTree({startListening:(a,b,et,nt)=>{let c=[];const ct=e.infoData_.getNode(a._path);return ct.isEmpty()||(c=syncTreeApplyServerOverwrite(e.infoSyncTree_,a._path,ct),setTimeout(()=>{nt("ok")},0)),c},stopListening:()=>{}}),repoUpdateInfo(e,"connected",!1),e.serverSyncTree_=new SyncTree({startListening:(a,b,et,nt)=>(e.server_.listen(a,et,b,(c,ct)=>{const pt=nt(c,ct);eventQueueRaiseEventsForChangedPath(e.eventQueue_,a._path,pt)}),[]),stopListening:(a,b)=>{e.server_.unlisten(a,b)}})}function repoServerTime(e){const s=e.infoData_.getNode(new Path(".info/serverTimeOffset")).val()||0;return new Date().getTime()+s}function repoGenerateServerValues(e){return generateWithValues({timestamp:repoServerTime(e)})}function repoOnDataUpdate(e,i,s,a,b){e.dataUpdateCount++;const et=new Path(i);s=e.interceptServerDataCallback_?e.interceptServerDataCallback_(i,s):s;let nt=[];if(b)if(a){const ct=map(s,pt=>nodeFromJSON(pt));nt=syncTreeApplyTaggedQueryMerge(e.serverSyncTree_,et,ct,b)}else{const ct=nodeFromJSON(s);nt=syncTreeApplyTaggedQueryOverwrite(e.serverSyncTree_,et,ct,b)}else if(a){const ct=map(s,pt=>nodeFromJSON(pt));nt=syncTreeApplyServerMerge(e.serverSyncTree_,et,ct)}else{const ct=nodeFromJSON(s);nt=syncTreeApplyServerOverwrite(e.serverSyncTree_,et,ct)}let c=et;nt.length>0&&(c=repoRerunTransactions(e,et)),eventQueueRaiseEventsForChangedPath(e.eventQueue_,c,nt)}function repoOnConnectStatus(e,i){repoUpdateInfo(e,"connected",i),i===!1&&repoRunOnDisconnectEvents(e)}function repoOnServerInfoUpdate(e,i){each(i,(s,a)=>{repoUpdateInfo(e,s,a)})}function repoUpdateInfo(e,i,s){const a=new Path("/.info/"+i),b=nodeFromJSON(s);e.infoData_.updateSnapshot(a,b);const et=syncTreeApplyServerOverwrite(e.infoSyncTree_,a,b);eventQueueRaiseEventsForChangedPath(e.eventQueue_,a,et)}function repoGetNextWriteId(e){return e.nextWriteId_++}function repoGetValue(e,i,s){const a=syncTreeGetServerValue(e.serverSyncTree_,i);return a!=null?Promise.resolve(a):e.server_.get(i).then(b=>{const et=nodeFromJSON(b).withIndex(i._queryParams.getIndex());syncTreeAddEventRegistration(e.serverSyncTree_,i,s,!0);let nt;if(i._queryParams.loadsAllData())nt=syncTreeApplyServerOverwrite(e.serverSyncTree_,i._path,et);else{const c=syncTreeTagForQuery(e.serverSyncTree_,i);nt=syncTreeApplyTaggedQueryOverwrite(e.serverSyncTree_,i._path,et,c)}return eventQueueRaiseEventsForChangedPath(e.eventQueue_,i._path,nt),syncTreeRemoveEventRegistration(e.serverSyncTree_,i,s,null,!0),et},b=>(repoLog(e,"get for query "+stringify(i)+" failed: "+b),Promise.reject(new Error(b))))}function repoSetWithPriority(e,i,s,a,b){repoLog(e,"set",{path:i.toString(),value:s,priority:a});const et=repoGenerateServerValues(e),nt=nodeFromJSON(s,a),c=syncTreeCalcCompleteEventCache(e.serverSyncTree_,i),ct=resolveDeferredValueSnapshot(nt,c,et),pt=repoGetNextWriteId(e),xt=syncTreeApplyUserOverwrite(e.serverSyncTree_,i,ct,pt,!0);eventQueueQueueEvents(e.eventQueue_,xt),e.server_.put(i.toString(),nt.val(!0),(Et,Rt)=>{const Nt=Et==="ok";Nt||warn("set at "+i+" failed: "+Et);const It=syncTreeAckUserWrite(e.serverSyncTree_,pt,!Nt);eventQueueRaiseEventsForChangedPath(e.eventQueue_,i,It),repoCallOnCompleteCallback(e,b,Et,Rt)});const St=repoAbortTransactions(e,i);repoRerunTransactions(e,St),eventQueueRaiseEventsForChangedPath(e.eventQueue_,St,[])}function repoUpdate(e,i,s,a){repoLog(e,"update",{path:i.toString(),value:s});let b=!0;const et=repoGenerateServerValues(e),nt={};if(each(s,(c,ct)=>{b=!1,nt[c]=resolveDeferredValueTree(pathChild(i,c),nodeFromJSON(ct),e.serverSyncTree_,et)}),b)log("update() called with empty data.  Don't do anything."),repoCallOnCompleteCallback(e,a,"ok",void 0);else{const c=repoGetNextWriteId(e),ct=syncTreeApplyUserMerge(e.serverSyncTree_,i,nt,c);eventQueueQueueEvents(e.eventQueue_,ct),e.server_.merge(i.toString(),s,(pt,xt)=>{const St=pt==="ok";St||warn("update at "+i+" failed: "+pt);const Et=syncTreeAckUserWrite(e.serverSyncTree_,c,!St),Rt=Et.length>0?repoRerunTransactions(e,i):i;eventQueueRaiseEventsForChangedPath(e.eventQueue_,Rt,Et),repoCallOnCompleteCallback(e,a,pt,xt)}),each(s,pt=>{const xt=repoAbortTransactions(e,pathChild(i,pt));repoRerunTransactions(e,xt)}),eventQueueRaiseEventsForChangedPath(e.eventQueue_,i,[])}}function repoRunOnDisconnectEvents(e){repoLog(e,"onDisconnectEvents");const i=repoGenerateServerValues(e),s=newSparseSnapshotTree();sparseSnapshotTreeForEachTree(e.onDisconnect_,newEmptyPath(),(b,et)=>{const nt=resolveDeferredValueTree(b,et,e.serverSyncTree_,i);sparseSnapshotTreeRemember(s,b,nt)});let a=[];sparseSnapshotTreeForEachTree(s,newEmptyPath(),(b,et)=>{a=a.concat(syncTreeApplyServerOverwrite(e.serverSyncTree_,b,et));const nt=repoAbortTransactions(e,b);repoRerunTransactions(e,nt)}),e.onDisconnect_=newSparseSnapshotTree(),eventQueueRaiseEventsForChangedPath(e.eventQueue_,newEmptyPath(),a)}function repoAddEventCallbackForQuery(e,i,s){let a;pathGetFront(i._path)===".info"?a=syncTreeAddEventRegistration(e.infoSyncTree_,i,s):a=syncTreeAddEventRegistration(e.serverSyncTree_,i,s),eventQueueRaiseEventsAtPath(e.eventQueue_,i._path,a)}function repoRemoveEventCallbackForQuery(e,i,s){let a;pathGetFront(i._path)===".info"?a=syncTreeRemoveEventRegistration(e.infoSyncTree_,i,s):a=syncTreeRemoveEventRegistration(e.serverSyncTree_,i,s),eventQueueRaiseEventsAtPath(e.eventQueue_,i._path,a)}function repoInterrupt(e){e.persistentConnection_&&e.persistentConnection_.interrupt(INTERRUPT_REASON)}function repoLog(e,...i){let s="";e.persistentConnection_&&(s=e.persistentConnection_.id+":"),log(s,...i)}function repoCallOnCompleteCallback(e,i,s,a){i&&exceptionGuard(()=>{if(s==="ok")i(null);else{const b=(s||"error").toUpperCase();let et=b;a&&(et+=": "+a);const nt=new Error(et);nt.code=b,i(nt)}})}function repoGetLatestState(e,i,s){return syncTreeCalcCompleteEventCache(e.serverSyncTree_,i,s)||ChildrenNode.EMPTY_NODE}function repoSendReadyTransactions(e,i=e.transactionQueueTree_){if(i||repoPruneCompletedTransactionsBelowNode(e,i),treeGetValue(i)){const s=repoBuildTransactionQueue(e,i);assert(s.length>0,"Sending zero length transaction queue"),s.every(b=>b.status===0)&&repoSendTransactionQueue(e,treeGetPath(i),s)}else treeHasChildren(i)&&treeForEachChild(i,s=>{repoSendReadyTransactions(e,s)})}function repoSendTransactionQueue(e,i,s){const a=s.map(pt=>pt.currentWriteId),b=repoGetLatestState(e,i,a);let et=b;const nt=b.hash();for(let pt=0;pt<s.length;pt++){const xt=s[pt];assert(xt.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),xt.status=1,xt.retryCount++;const St=newRelativePath(i,xt.path);et=et.updateChild(St,xt.currentOutputSnapshotRaw)}const c=et.val(!0),ct=i;e.server_.put(ct.toString(),c,pt=>{repoLog(e,"transaction put response",{path:ct.toString(),status:pt});let xt=[];if(pt==="ok"){const St=[];for(let Et=0;Et<s.length;Et++)s[Et].status=2,xt=xt.concat(syncTreeAckUserWrite(e.serverSyncTree_,s[Et].currentWriteId)),s[Et].onComplete&&St.push(()=>s[Et].onComplete(null,!0,s[Et].currentOutputSnapshotResolved)),s[Et].unwatcher();repoPruneCompletedTransactionsBelowNode(e,treeSubTree(e.transactionQueueTree_,i)),repoSendReadyTransactions(e,e.transactionQueueTree_),eventQueueRaiseEventsForChangedPath(e.eventQueue_,i,xt);for(let Et=0;Et<St.length;Et++)exceptionGuard(St[Et])}else{if(pt==="datastale")for(let St=0;St<s.length;St++)s[St].status===3?s[St].status=4:s[St].status=0;else{warn("transaction at "+ct.toString()+" failed: "+pt);for(let St=0;St<s.length;St++)s[St].status=4,s[St].abortReason=pt}repoRerunTransactions(e,i)}},nt)}function repoRerunTransactions(e,i){const s=repoGetAncestorTransactionNode(e,i),a=treeGetPath(s),b=repoBuildTransactionQueue(e,s);return repoRerunTransactionQueue(e,b,a),a}function repoRerunTransactionQueue(e,i,s){if(i.length===0)return;const a=[];let b=[];const nt=i.filter(c=>c.status===0).map(c=>c.currentWriteId);for(let c=0;c<i.length;c++){const ct=i[c],pt=newRelativePath(s,ct.path);let xt=!1,St;if(assert(pt!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),ct.status===4)xt=!0,St=ct.abortReason,b=b.concat(syncTreeAckUserWrite(e.serverSyncTree_,ct.currentWriteId,!0));else if(ct.status===0)if(ct.retryCount>=MAX_TRANSACTION_RETRIES)xt=!0,St="maxretry",b=b.concat(syncTreeAckUserWrite(e.serverSyncTree_,ct.currentWriteId,!0));else{const Et=repoGetLatestState(e,ct.path,nt);ct.currentInputSnapshot=Et;const Rt=i[c].update(Et.val());if(Rt!==void 0){validateFirebaseData("transaction failed: Data returned ",Rt,ct.path);let Nt=nodeFromJSON(Rt);typeof Rt=="object"&&Rt!=null&&contains(Rt,".priority")||(Nt=Nt.updatePriority(Et.getPriority()));const Gt=ct.currentWriteId,Dt=repoGenerateServerValues(e),Bt=resolveDeferredValueSnapshot(Nt,Et,Dt);ct.currentOutputSnapshotRaw=Nt,ct.currentOutputSnapshotResolved=Bt,ct.currentWriteId=repoGetNextWriteId(e),nt.splice(nt.indexOf(Gt),1),b=b.concat(syncTreeApplyUserOverwrite(e.serverSyncTree_,ct.path,Bt,ct.currentWriteId,ct.applyLocally)),b=b.concat(syncTreeAckUserWrite(e.serverSyncTree_,Gt,!0))}else xt=!0,St="nodata",b=b.concat(syncTreeAckUserWrite(e.serverSyncTree_,ct.currentWriteId,!0))}eventQueueRaiseEventsForChangedPath(e.eventQueue_,s,b),b=[],xt&&(i[c].status=2,function(Et){setTimeout(Et,Math.floor(0))}(i[c].unwatcher),i[c].onComplete&&(St==="nodata"?a.push(()=>i[c].onComplete(null,!1,i[c].currentInputSnapshot)):a.push(()=>i[c].onComplete(new Error(St),!1,null))))}repoPruneCompletedTransactionsBelowNode(e,e.transactionQueueTree_);for(let c=0;c<a.length;c++)exceptionGuard(a[c]);repoSendReadyTransactions(e,e.transactionQueueTree_)}function repoGetAncestorTransactionNode(e,i){let s,a=e.transactionQueueTree_;for(s=pathGetFront(i);s!==null&&treeGetValue(a)===void 0;)a=treeSubTree(a,s),i=pathPopFront(i),s=pathGetFront(i);return a}function repoBuildTransactionQueue(e,i){const s=[];return repoAggregateTransactionQueuesForNode(e,i,s),s.sort((a,b)=>a.order-b.order),s}function repoAggregateTransactionQueuesForNode(e,i,s){const a=treeGetValue(i);if(a)for(let b=0;b<a.length;b++)s.push(a[b]);treeForEachChild(i,b=>{repoAggregateTransactionQueuesForNode(e,b,s)})}function repoPruneCompletedTransactionsBelowNode(e,i){const s=treeGetValue(i);if(s){let a=0;for(let b=0;b<s.length;b++)s[b].status!==2&&(s[a]=s[b],a++);s.length=a,treeSetValue(i,s.length>0?s:void 0)}treeForEachChild(i,a=>{repoPruneCompletedTransactionsBelowNode(e,a)})}function repoAbortTransactions(e,i){const s=treeGetPath(repoGetAncestorTransactionNode(e,i)),a=treeSubTree(e.transactionQueueTree_,i);return treeForEachAncestor(a,b=>{repoAbortTransactionsOnNode(e,b)}),repoAbortTransactionsOnNode(e,a),treeForEachDescendant(a,b=>{repoAbortTransactionsOnNode(e,b)}),s}function repoAbortTransactionsOnNode(e,i){const s=treeGetValue(i);if(s){const a=[];let b=[],et=-1;for(let nt=0;nt<s.length;nt++)s[nt].status===3||(s[nt].status===1?(assert(et===nt-1,"All SENT items should be at beginning of queue."),et=nt,s[nt].status=3,s[nt].abortReason="set"):(assert(s[nt].status===0,"Unexpected transaction status in abort"),s[nt].unwatcher(),b=b.concat(syncTreeAckUserWrite(e.serverSyncTree_,s[nt].currentWriteId,!0)),s[nt].onComplete&&a.push(s[nt].onComplete.bind(null,new Error("set"),!1,null))));et===-1?treeSetValue(i,void 0):s.length=et+1,eventQueueRaiseEventsForChangedPath(e.eventQueue_,treeGetPath(i),b);for(let nt=0;nt<a.length;nt++)exceptionGuard(a[nt])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function decodePath(e){let i="";const s=e.split("/");for(let a=0;a<s.length;a++)if(s[a].length>0){let b=s[a];try{b=decodeURIComponent(b.replace(/\+/g," "))}catch{}i+="/"+b}return i}function decodeQuery(e){const i={};e.charAt(0)==="?"&&(e=e.substring(1));for(const s of e.split("&")){if(s.length===0)continue;const a=s.split("=");a.length===2?i[decodeURIComponent(a[0])]=decodeURIComponent(a[1]):warn(`Invalid query segment '${s}' in query '${e}'`)}return i}const parseRepoInfo=function(e,i){const s=parseDatabaseURL(e),a=s.namespace;s.domain==="firebase.com"&&fatal(s.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!a||a==="undefined")&&s.domain!=="localhost"&&fatal("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),s.secure||warnIfPageIsSecure();const b=s.scheme==="ws"||s.scheme==="wss";return{repoInfo:new RepoInfo(s.host,s.secure,a,b,i,"",a!==s.subdomain),path:new Path(s.pathString)}},parseDatabaseURL=function(e){let i="",s="",a="",b="",et="",nt=!0,c="https",ct=443;if(typeof e=="string"){let pt=e.indexOf("//");pt>=0&&(c=e.substring(0,pt-1),e=e.substring(pt+2));let xt=e.indexOf("/");xt===-1&&(xt=e.length);let St=e.indexOf("?");St===-1&&(St=e.length),i=e.substring(0,Math.min(xt,St)),xt<St&&(b=decodePath(e.substring(xt,St)));const Et=decodeQuery(e.substring(Math.min(e.length,St)));pt=i.indexOf(":"),pt>=0?(nt=c==="https"||c==="wss",ct=parseInt(i.substring(pt+1),10)):pt=i.length;const Rt=i.slice(0,pt);if(Rt.toLowerCase()==="localhost")s="localhost";else if(Rt.split(".").length<=2)s=Rt;else{const Nt=i.indexOf(".");a=i.substring(0,Nt).toLowerCase(),s=i.substring(Nt+1),et=a}"ns"in Et&&(et=Et.ns)}return{host:i,port:ct,domain:s,subdomain:a,secure:nt,scheme:c,pathString:b,namespace:et}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PUSH_CHARS="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",nextPushId=function(){let e=0;const i=[];return function(s){const a=s===e;e=s;let b;const et=new Array(8);for(b=7;b>=0;b--)et[b]=PUSH_CHARS.charAt(s%64),s=Math.floor(s/64);assert(s===0,"Cannot push at time == 0");let nt=et.join("");if(a){for(b=11;b>=0&&i[b]===63;b--)i[b]=0;i[b]++}else for(b=0;b<12;b++)i[b]=Math.floor(Math.random()*64);for(b=0;b<12;b++)nt+=PUSH_CHARS.charAt(i[b]);return assert(nt.length===20,"nextPushId: Length should be 20."),nt}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DataEvent{constructor(i,s,a,b){this.eventType=i,this.eventRegistration=s,this.snapshot=a,this.prevName=b}getPath(){const i=this.snapshot.ref;return this.eventType==="value"?i._path:i.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+stringify(this.snapshot.exportVal())}}class CancelEvent{constructor(i,s,a){this.eventRegistration=i,this.error=s,this.path=a}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CallbackContext{constructor(i,s){this.snapshotCallback=i,this.cancelCallback=s}onValue(i,s){this.snapshotCallback.call(null,i,s)}onCancel(i){return assert(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,i)}get hasCancelCallback(){return!!this.cancelCallback}matches(i){return this.snapshotCallback===i.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===i.snapshotCallback.userCallback&&this.snapshotCallback.context===i.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QueryImpl{constructor(i,s,a,b){this._repo=i,this._path=s,this._queryParams=a,this._orderByCalled=b}get key(){return pathIsEmpty(this._path)?null:pathGetBack(this._path)}get ref(){return new ReferenceImpl(this._repo,this._path)}get _queryIdentifier(){const i=queryParamsGetQueryObject(this._queryParams),s=ObjectToUniqueKey(i);return s==="{}"?"default":s}get _queryObject(){return queryParamsGetQueryObject(this._queryParams)}isEqual(i){if(i=getModularInstance(i),!(i instanceof QueryImpl))return!1;const s=this._repo===i._repo,a=pathEquals(this._path,i._path),b=this._queryIdentifier===i._queryIdentifier;return s&&a&&b}toJSON(){return this.toString()}toString(){return this._repo.toString()+pathToUrlEncodedString(this._path)}}class ReferenceImpl extends QueryImpl{constructor(i,s){super(i,s,new QueryParams,!1)}get parent(){const i=pathParent(this._path);return i===null?null:new ReferenceImpl(this._repo,i)}get root(){let i=this;for(;i.parent!==null;)i=i.parent;return i}}class DataSnapshot{constructor(i,s,a){this._node=i,this.ref=s,this._index=a}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(i){const s=new Path(i),a=child(this.ref,i);return new DataSnapshot(this._node.getChild(s),a,PRIORITY_INDEX)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(i){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(a,b)=>i(new DataSnapshot(b,child(this.ref,a),PRIORITY_INDEX)))}hasChild(i){const s=new Path(i);return!this._node.getChild(s).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ref(e,i){return e=getModularInstance(e),e._checkNotDeleted("ref"),i!==void 0?child(e._root,i):e._root}function child(e,i){return e=getModularInstance(e),pathGetFront(e._path)===null?validateRootPathString("child","path",i):validatePathString("child","path",i),new ReferenceImpl(e._repo,pathChild(e._path,i))}function push(e,i){e=getModularInstance(e),validateWritablePath("push",e._path),validateFirebaseDataArg("push",i,e._path,!0);const s=repoServerTime(e._repo),a=nextPushId(s),b=child(e,a),et=child(e,a);let nt;return nt=Promise.resolve(et),b.then=nt.then.bind(nt),b.catch=nt.then.bind(nt,void 0),b}function remove(e){return validateWritablePath("remove",e._path),set(e,null)}function set(e,i){e=getModularInstance(e),validateWritablePath("set",e._path),validateFirebaseDataArg("set",i,e._path,!1);const s=new Deferred;return repoSetWithPriority(e._repo,e._path,i,null,s.wrapCallback(()=>{})),s.promise}function update(e,i){validateFirebaseMergeDataArg("update",i,e._path);const s=new Deferred;return repoUpdate(e._repo,e._path,i,s.wrapCallback(()=>{})),s.promise}function get(e){e=getModularInstance(e);const i=new CallbackContext(()=>{}),s=new ValueEventRegistration(i);return repoGetValue(e._repo,e,s).then(a=>new DataSnapshot(a,new ReferenceImpl(e._repo,e._path),e._queryParams.getIndex()))}class ValueEventRegistration{constructor(i){this.callbackContext=i}respondsTo(i){return i==="value"}createEvent(i,s){const a=s._queryParams.getIndex();return new DataEvent("value",this,new DataSnapshot(i.snapshotNode,new ReferenceImpl(s._repo,s._path),a))}getEventRunner(i){return i.getEventType()==="cancel"?()=>this.callbackContext.onCancel(i.error):()=>this.callbackContext.onValue(i.snapshot,null)}createCancelEvent(i,s){return this.callbackContext.hasCancelCallback?new CancelEvent(this,i,s):null}matches(i){return i instanceof ValueEventRegistration?!i.callbackContext||!this.callbackContext?!0:i.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function addEventListener(e,i,s,a,b){let et;if(typeof a=="object"&&(et=void 0,b=a),typeof a=="function"&&(et=a),b&&b.onlyOnce){const ct=s,pt=(xt,St)=>{repoRemoveEventCallbackForQuery(e._repo,e,c),ct(xt,St)};pt.userCallback=s.userCallback,pt.context=s.context,s=pt}const nt=new CallbackContext(s,et||void 0),c=new ValueEventRegistration(nt);return repoAddEventCallbackForQuery(e._repo,e,c),()=>repoRemoveEventCallbackForQuery(e._repo,e,c)}function onValue(e,i,s,a){return addEventListener(e,"value",i,s,a)}syncPointSetReferenceConstructor(ReferenceImpl);syncTreeSetReferenceConstructor(ReferenceImpl);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FIREBASE_DATABASE_EMULATOR_HOST_VAR="FIREBASE_DATABASE_EMULATOR_HOST",repos={};let useRestClient=!1;function repoManagerApplyEmulatorSettings(e,i,s,a){const b=i.lastIndexOf(":"),et=i.substring(0,b),nt=isCloudWorkstation(et);e.repoInfo_=new RepoInfo(i,nt,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,s),a&&(e.authTokenProvider_=a)}function repoManagerDatabaseFromApp(e,i,s,a,b){let et=a||e.options.databaseURL;et===void 0&&(e.options.projectId||fatal("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),log("Using default host for project ",e.options.projectId),et=`${e.options.projectId}-default-rtdb.firebaseio.com`);let nt=parseRepoInfo(et,b),c=nt.repoInfo,ct;typeof process<"u"&&define_process_env_default&&(ct=define_process_env_default[FIREBASE_DATABASE_EMULATOR_HOST_VAR]),ct?(et=`http://${ct}?ns=${c.namespace}`,nt=parseRepoInfo(et,b),c=nt.repoInfo):nt.repoInfo.secure;const pt=new FirebaseAuthTokenProvider(e.name,e.options,i);validateUrl("Invalid Firebase Database URL",nt),pathIsEmpty(nt.path)||fatal("Database URL must point to the root of a Firebase Database (not including a child path).");const xt=repoManagerCreateRepo(c,e,pt,new AppCheckTokenProvider(e,s));return new Database(xt,e)}function repoManagerDeleteRepo(e,i){const s=repos[i];(!s||s[e.key]!==e)&&fatal(`Database ${i}(${e.repoInfo_}) has already been deleted.`),repoInterrupt(e),delete s[e.key]}function repoManagerCreateRepo(e,i,s,a){let b=repos[i.name];b||(b={},repos[i.name]=b);let et=b[e.toURLString()];return et&&fatal("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),et=new Repo(e,useRestClient,s,a),b[e.toURLString()]=et,et}class Database{constructor(i,s){this._repoInternal=i,this.app=s,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(repoStart(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ReferenceImpl(this._repo,newEmptyPath())),this._rootInternal}_delete(){return this._rootInternal!==null&&(repoManagerDeleteRepo(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(i){this._rootInternal===null&&fatal("Cannot call "+i+" on a deleted database.")}}function getDatabase(e=getApp(),i){const s=_getProvider(e,"database").getImmediate({identifier:i});if(!s._instanceStarted){const a=getDefaultEmulatorHostnameAndPort("database");a&&connectDatabaseEmulator(s,...a)}return s}function connectDatabaseEmulator(e,i,s,a={}){e=getModularInstance(e),e._checkNotDeleted("useEmulator");const b=`${i}:${s}`,et=e._repoInternal;if(e._instanceStarted){if(b===e._repoInternal.repoInfo_.host&&deepEqual(a,et.repoInfo_.emulatorOptions))return;fatal("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let nt;if(et.repoInfo_.nodeAdmin)a.mockUserToken&&fatal('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),nt=new EmulatorTokenProvider(EmulatorTokenProvider.OWNER);else if(a.mockUserToken){const c=typeof a.mockUserToken=="string"?a.mockUserToken:createMockUserToken(a.mockUserToken,e.app.options.projectId);nt=new EmulatorTokenProvider(c)}isCloudWorkstation(i)&&(pingServer(i),updateEmulatorBanner("Database",!0)),repoManagerApplyEmulatorSettings(et,b,a,nt)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function registerDatabase(e){setSDKVersion(SDK_VERSION$1),_registerComponent(new Component("database",(i,{instanceIdentifier:s})=>{const a=i.getProvider("app").getImmediate(),b=i.getProvider("auth-internal"),et=i.getProvider("app-check-internal");return repoManagerDatabaseFromApp(a,b,et,s)},"PUBLIC").setMultipleInstances(!0)),registerVersion(name$2,version$2,e),registerVersion(name$2,version$2,"esm2020")}PersistentConnection.prototype.simpleListen=function(e,i){this.sendRequest("q",{p:e},i)};PersistentConnection.prototype.echo=function(e,i){this.sendRequest("echo",{d:e},i)};registerDatabase();var name$1="firebase",version$1="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */registerVersion(name$1,version$1,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_HOST="firebasestorage.googleapis.com",CONFIG_STORAGE_BUCKET_KEY="storageBucket",DEFAULT_MAX_OPERATION_RETRY_TIME=2*60*1e3,DEFAULT_MAX_UPLOAD_RETRY_TIME=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StorageError extends FirebaseError{constructor(i,s,a=0){super(prependCode(i),`Firebase Storage: ${s} (${prependCode(i)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,StorageError.prototype)}get status(){return this.status_}set status(i){this.status_=i}_codeEquals(i){return prependCode(i)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(i){this.customData.serverResponse=i,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var StorageErrorCode;(function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(StorageErrorCode||(StorageErrorCode={}));function prependCode(e){return"storage/"+e}function unknown(){const e="An unknown error occurred, please check the error payload for server response.";return new StorageError(StorageErrorCode.UNKNOWN,e)}function retryLimitExceeded(){return new StorageError(StorageErrorCode.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function canceled(){return new StorageError(StorageErrorCode.CANCELED,"User canceled the upload/download.")}function invalidUrl(e){return new StorageError(StorageErrorCode.INVALID_URL,"Invalid URL '"+e+"'.")}function invalidDefaultBucket(e){return new StorageError(StorageErrorCode.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}function invalidArgument(e){return new StorageError(StorageErrorCode.INVALID_ARGUMENT,e)}function appDeleted(){return new StorageError(StorageErrorCode.APP_DELETED,"The Firebase app was deleted.")}function invalidRootOperation(e){return new StorageError(StorageErrorCode.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Location{constructor(i,s){this.bucket=i,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const i=encodeURIComponent;return"/b/"+i(this.bucket)+"/o/"+i(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(i,s){let a;try{a=Location.makeFromUrl(i,s)}catch{return new Location(i,"")}if(a.path==="")return a;throw invalidDefaultBucket(i)}static makeFromUrl(i,s){let a=null;const b="([A-Za-z0-9.\\-_]+)";function et(Vt){Vt.path.charAt(Vt.path.length-1)==="/"&&(Vt.path_=Vt.path_.slice(0,-1))}const nt="(/(.*))?$",c=new RegExp("^gs://"+b+nt,"i"),ct={bucket:1,path:3};function pt(Vt){Vt.path_=decodeURIComponent(Vt.path)}const xt="v[A-Za-z0-9_]+",St=s.replace(/[.]/g,"\\."),Et="(/([^?#]*).*)?$",Rt=new RegExp(`^https?://${St}/${xt}/b/${b}/o${Et}`,"i"),Nt={bucket:1,path:3},It=s===DEFAULT_HOST?"(?:storage.googleapis.com|storage.cloud.google.com)":s,Gt="([^?#]*)",Dt=new RegExp(`^https?://${It}/${b}/${Gt}`,"i"),Lt=[{regex:c,indices:ct,postModify:et},{regex:Rt,indices:Nt,postModify:pt},{regex:Dt,indices:{bucket:1,path:2},postModify:pt}];for(let Vt=0;Vt<Lt.length;Vt++){const Zt=Lt[Vt],nr=Zt.regex.exec(i);if(nr){const ur=nr[Zt.indices.bucket];let _r=nr[Zt.indices.path];_r||(_r=""),a=new Location(ur,_r),Zt.postModify(a);break}}if(a==null)throw invalidUrl(i);return a}}class FailRequest{constructor(i){this.promise_=Promise.reject(i)}getPromise(){return this.promise_}cancel(i=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function start(e,i,s){let a=1,b=null,et=null,nt=!1,c=0;function ct(){return c===2}let pt=!1;function xt(...Gt){pt||(pt=!0,i.apply(null,Gt))}function St(Gt){b=setTimeout(()=>{b=null,e(Rt,ct())},Gt)}function Et(){et&&clearTimeout(et)}function Rt(Gt,...Dt){if(pt){Et();return}if(Gt){Et(),xt.call(null,Gt,...Dt);return}if(ct()||nt){Et(),xt.call(null,Gt,...Dt);return}a<64&&(a*=2);let Lt;c===1?(c=2,Lt=0):Lt=(a+Math.random())*1e3,St(Lt)}let Nt=!1;function It(Gt){Nt||(Nt=!0,Et(),!pt&&(b!==null?(Gt||(c=2),clearTimeout(b),St(0)):Gt||(c=1)))}return St(0),et=setTimeout(()=>{nt=!0,It(!0)},s),It}function stop(e){e(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isJustDef(e){return e!==void 0}function validateNumber(e,i,s,a){if(a<i)throw invalidArgument(`Invalid value for '${e}'. Expected ${i} or greater.`);if(a>s)throw invalidArgument(`Invalid value for '${e}'. Expected ${s} or less.`)}function makeQueryString(e){const i=encodeURIComponent;let s="?";for(const a in e)if(e.hasOwnProperty(a)){const b=i(a)+"="+i(e[a]);s=s+b+"&"}return s=s.slice(0,-1),s}var ErrorCode;(function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"})(ErrorCode||(ErrorCode={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isRetryStatusCode(e,i){const s=e>=500&&e<600,b=[408,429].indexOf(e)!==-1,et=i.indexOf(e)!==-1;return s||b||et}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NetworkRequest{constructor(i,s,a,b,et,nt,c,ct,pt,xt,St,Et=!0,Rt=!1){this.url_=i,this.method_=s,this.headers_=a,this.body_=b,this.successCodes_=et,this.additionalRetryCodes_=nt,this.callback_=c,this.errorCallback_=ct,this.timeout_=pt,this.progressCallback_=xt,this.connectionFactory_=St,this.retry=Et,this.isUsingEmulator=Rt,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((Nt,It)=>{this.resolve_=Nt,this.reject_=It,this.start_()})}start_(){const i=(a,b)=>{if(b){a(!1,new RequestEndStatus(!1,null,!0));return}const et=this.connectionFactory_();this.pendingConnection_=et;const nt=c=>{const ct=c.loaded,pt=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(ct,pt)};this.progressCallback_!==null&&et.addUploadProgressListener(nt),et.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&et.removeUploadProgressListener(nt),this.pendingConnection_=null;const c=et.getErrorCode()===ErrorCode.NO_ERROR,ct=et.getStatus();if(!c||isRetryStatusCode(ct,this.additionalRetryCodes_)&&this.retry){const xt=et.getErrorCode()===ErrorCode.ABORT;a(!1,new RequestEndStatus(!1,null,xt));return}const pt=this.successCodes_.indexOf(ct)!==-1;a(!0,new RequestEndStatus(pt,et))})},s=(a,b)=>{const et=this.resolve_,nt=this.reject_,c=b.connection;if(b.wasSuccessCode)try{const ct=this.callback_(c,c.getResponse());isJustDef(ct)?et(ct):et()}catch(ct){nt(ct)}else if(c!==null){const ct=unknown();ct.serverResponse=c.getErrorText(),this.errorCallback_?nt(this.errorCallback_(c,ct)):nt(ct)}else if(b.canceled){const ct=this.appDelete_?appDeleted():canceled();nt(ct)}else{const ct=retryLimitExceeded();nt(ct)}};this.canceled_?s(!1,new RequestEndStatus(!1,null,!0)):this.backoffId_=start(i,s,this.timeout_)}getPromise(){return this.promise_}cancel(i){this.canceled_=!0,this.appDelete_=i||!1,this.backoffId_!==null&&stop(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class RequestEndStatus{constructor(i,s,a){this.wasSuccessCode=i,this.connection=s,this.canceled=!!a}}function addAuthHeader_(e,i){i!==null&&i.length>0&&(e.Authorization="Firebase "+i)}function addVersionHeader_(e,i){e["X-Firebase-Storage-Version"]="webjs/"+(i??"AppManager")}function addGmpidHeader_(e,i){i&&(e["X-Firebase-GMPID"]=i)}function addAppCheckHeader_(e,i){i!==null&&(e["X-Firebase-AppCheck"]=i)}function makeRequest(e,i,s,a,b,et,nt=!0,c=!1){const ct=makeQueryString(e.urlParams),pt=e.url+ct,xt=Object.assign({},e.headers);return addGmpidHeader_(xt,i),addAuthHeader_(xt,s),addVersionHeader_(xt,et),addAppCheckHeader_(xt,a),new NetworkRequest(pt,e.method,xt,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,b,nt,c)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function parent$1(e){if(e.length===0)return null;const i=e.lastIndexOf("/");return i===-1?"":e.slice(0,i)}function lastComponent(e){const i=e.lastIndexOf("/",e.length-2);return i===-1?e:e.slice(i+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Reference{constructor(i,s){this._service=i,s instanceof Location?this._location=s:this._location=Location.makeFromUrl(s,i.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(i,s){return new Reference(i,s)}get root(){const i=new Location(this._location.bucket,"");return this._newRef(this._service,i)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return lastComponent(this._location.path)}get storage(){return this._service}get parent(){const i=parent$1(this._location.path);if(i===null)return null;const s=new Location(this._location.bucket,i);return new Reference(this._service,s)}_throwIfRoot(i){if(this._location.path==="")throw invalidRootOperation(i)}}function extractBucket(e,i){const s=i==null?void 0:i[CONFIG_STORAGE_BUCKET_KEY];return s==null?null:Location.makeFromBucketSpec(s,e)}function connectStorageEmulator$1(e,i,s,a={}){e.host=`${i}:${s}`;const b=isCloudWorkstation(i);b&&(pingServer(`https://${e.host}/b`),updateEmulatorBanner("Storage",!0)),e._isUsingEmulator=!0,e._protocol=b?"https":"http";const{mockUserToken:et}=a;et&&(e._overrideAuthToken=typeof et=="string"?et:createMockUserToken(et,e.app.options.projectId))}class FirebaseStorageImpl{constructor(i,s,a,b,et,nt=!1){this.app=i,this._authProvider=s,this._appCheckProvider=a,this._url=b,this._firebaseVersion=et,this._isUsingEmulator=nt,this._bucket=null,this._host=DEFAULT_HOST,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=DEFAULT_MAX_OPERATION_RETRY_TIME,this._maxUploadRetryTime=DEFAULT_MAX_UPLOAD_RETRY_TIME,this._requests=new Set,b!=null?this._bucket=Location.makeFromBucketSpec(b,this._host):this._bucket=extractBucket(this._host,this.app.options)}get host(){return this._host}set host(i){this._host=i,this._url!=null?this._bucket=Location.makeFromBucketSpec(this._url,i):this._bucket=extractBucket(i,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(i){validateNumber("time",0,Number.POSITIVE_INFINITY,i),this._maxUploadRetryTime=i}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(i){validateNumber("time",0,Number.POSITIVE_INFINITY,i),this._maxOperationRetryTime=i}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const i=this._authProvider.getImmediate({optional:!0});if(i){const s=await i.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){if(_isFirebaseServerApp(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=this._appCheckProvider.getImmediate({optional:!0});return i?(await i.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(i=>i.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(i){return new Reference(this,i)}_makeRequest(i,s,a,b,et=!0){if(this._deleted)return new FailRequest(appDeleted());{const nt=makeRequest(i,this._appId,a,b,s,this._firebaseVersion,et,this._isUsingEmulator);return this._requests.add(nt),nt.getPromise().then(()=>this._requests.delete(nt),()=>this._requests.delete(nt)),nt}}async makeRequestWithTokens(i,s){const[a,b]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(i,s,a,b).getPromise()}}const name="@firebase/storage",version="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const STORAGE_TYPE="storage";function getStorage(e=getApp(),i){e=getModularInstance(e);const a=_getProvider(e,STORAGE_TYPE).getImmediate({identifier:i}),b=getDefaultEmulatorHostnameAndPort("storage");return b&&connectStorageEmulator(a,...b),a}function connectStorageEmulator(e,i,s,a={}){connectStorageEmulator$1(e,i,s,a)}function factory(e,{instanceIdentifier:i}){const s=e.getProvider("app").getImmediate(),a=e.getProvider("auth-internal"),b=e.getProvider("app-check-internal");return new FirebaseStorageImpl(s,a,b,i,SDK_VERSION$1)}function registerStorage(){_registerComponent(new Component(STORAGE_TYPE,factory,"PUBLIC").setMultipleInstances(!0)),registerVersion(name,version,""),registerVersion(name,version,"esm2020")}registerStorage();const firebaseConfig={apiKey:"AIzaSyC_2a50875vxMTHa8jZhcfMP--nO_Jvmko",authDomain:"nulltobuild.firebaseapp.com",databaseURL:"https://nulltobuild-default-rtdb.firebaseio.com",projectId:"nulltobuild",storageBucket:"nulltobuild.firebasestorage.app",messagingSenderId:"937347030160",appId:"1:937347030160:web:d60bb96785fbc5a7e9cc15"},app=initializeApp(firebaseConfig),auth=getAuth(app),database=getDatabase(app);getStorage(app);const MAPBOX_ACCESS_TOKEN="pk.eyJ1IjoicGF2YW5rdW1hcnN3YW15IiwiYSI6ImNtNnc1c3ZpdTBkdGgyanM5b25rN2ZqcncifQ.Ls1e2W6rx3apoBsStWa5Ow",AuthContext=reactExports.createContext(void 0);async function getLocationDetails(e,i){try{const a=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${i},${e}.json?access_token=${MAPBOX_ACCESS_TOKEN}&types=address,place,postcode`)).json();let b="",et="",nt="";if(a.features&&a.features.length>0){nt=a.features[0].place_name;for(const c of a.features)c.place_type.includes("place")?b=c.text:c.place_type.includes("postcode")&&(et=c.text)}return{city:b||"Unknown",pincode:et,address:nt||""}}catch(s){return console.error("Error getting location details:",s),{city:"Unknown",pincode:"",address:""}}}function AuthProvider({children:e}){const[i,s]=reactExports.useState(null),[a,b]=reactExports.useState(null),[et,nt]=reactExports.useState(!0),c=async()=>{if(i)try{const Nt=ref(database,`users/${i.uid}`),It=await get(Nt);It.exists()&&b(It.val())}catch(Nt){console.error("Error refreshing user data:",Nt)}};reactExports.useEffect(()=>{const Nt=auth.onAuthStateChanged(It=>{s(It),It?setTimeout(async()=>{try{const Gt=ref(database,`users/${It.uid}`),Dt=await get(Gt);Dt.exists()&&b(Dt.val())}catch(Gt){console.error("Error fetching user data:",Gt)}nt(!1)},0):(b(null),nt(!1))});return()=>Nt()},[]);const ct=async(Nt,It)=>{const Gt=await signInWithEmailAndPassword(auth,Nt,It),Dt=ref(database,`users/${Gt.user.uid}`),Bt=await get(Dt);Bt.exists()&&b(Bt.val())},pt=async(Nt,It,Gt,Dt,Bt)=>{const Lt=await createUserWithEmailAndPassword(auth,Nt,It),Vt={id:Lt.user.uid,email:Nt,name:Gt,phone:Dt,role:Bt,createdAt:Date.now()};await set(ref(database,`users/${Lt.user.uid}`),Vt),b(Vt)},xt=async(Nt,It,Gt,Dt="home")=>{var an,Fr;if(!a)return;const{city:Bt,pincode:Lt,address:Vt}=await getLocationDetails(Nt,It);let Zt=Lt;if(!Zt&&Gt){const rn=Gt.match(/\b\d{6}\b/);rn&&(Zt=rn[0])}const nr=Gt||Vt||"",ur={...a.address,line2:((an=a.address)==null?void 0:an.line2)||"",landmark:((Fr=a.address)==null?void 0:Fr.landmark)||"",line1:nr,city:Bt,pincode:Zt||"",lat:Nt,lng:It,label:Dt},_r=a.savedAddresses||[],Ur=_r.findIndex(rn=>rn.lat===Nt&&rn.lng===It);let ln;Ur>=0?(ln=[..._r],ln[Ur]={...ln[Ur],...ur,label:Dt}):ln=[..._r,ur],await update(ref(database,`users/${a.id}`),{address:ur,savedAddresses:ln}),b(rn=>rn?{...rn,address:ur,savedAddresses:ln}:null)},St=async()=>{await signOut(auth),b(null)},Et=async Nt=>{if(!a)return;const It=a.favorites||[];let Gt;It.includes(Nt)?Gt=It.filter(Dt=>Dt!==Nt):Gt=[...It,Nt];try{await update(ref(database,`users/${a.id}`),{favorites:Gt}),b({...a,favorites:Gt})}catch(Dt){console.error("Error updating favorites:",Dt)}},Rt=async(Nt,It)=>{if(!a||!a.savedAddresses)return;const Gt=a.savedAddresses.filter(Dt=>!(Dt.lat===Nt&&Dt.lng===It));try{await update(ref(database,`users/${a.id}`),{savedAddresses:Gt}),b(Dt=>Dt?{...Dt,savedAddresses:Gt}:null)}catch(Dt){console.error("Error deleting address:",Dt)}};return jsxRuntimeExports.jsx(AuthContext.Provider,{value:{firebaseUser:i,user:a,loading:et,signIn:ct,signUp:pt,signOut:St,updateUserLocation:xt,toggleFavorite:Et,refreshUser:c,deleteAddress:Rt},children:e})}function useAuth(){const e=reactExports.useContext(AuthContext);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e}const CartContext=reactExports.createContext(void 0),CART_STORAGE_KEY="amma-cheythi-cart";function CartProvider({children:e}){const[i,s]=reactExports.useState(()=>{const xt=localStorage.getItem(CART_STORAGE_KEY);return xt?JSON.parse(xt):{items:[],kitchenId:null,kitchenName:null,cookingInstructions:{tags:[],note:""}}});reactExports.useEffect(()=>{localStorage.setItem(CART_STORAGE_KEY,JSON.stringify(i))},[i]);const a=(xt,St)=>{s(Et=>({...Et,cookingInstructions:{tags:xt,note:St}}))},b=(xt,St,Et)=>{s(Rt=>Rt.kitchenId&&Rt.kitchenId!==St?(ue.error("You can only order from one kitchen at a time. Clear cart first."),Rt):Rt.items.find(It=>It.dish.id===xt.id)?{...Rt,items:Rt.items.map(It=>It.dish.id===xt.id?{...It,quantity:It.quantity+1}:It)}:(ue.success(`Added ${xt.name} to cart!`),{items:[...Rt.items,{dish:xt,quantity:1,kitchenId:St,kitchenName:Et}],kitchenId:St,kitchenName:Et}))},et=xt=>{s(St=>{const Et=St.items.filter(Rt=>Rt.dish.id!==xt);return{items:Et,kitchenId:Et.length>0?St.kitchenId:null,kitchenName:Et.length>0?St.kitchenName:null}})},nt=(xt,St)=>{if(St<=0){et(xt);return}s(Et=>({...Et,items:Et.items.map(Rt=>Rt.dish.id===xt?{...Rt,quantity:St}:Rt)}))},c=()=>{s({items:[],kitchenId:null,kitchenName:null})},ct=()=>i.items.reduce((xt,St)=>xt+St.quantity,0),pt=()=>i.items.reduce((xt,St)=>xt+St.dish.price*St.quantity,0);return jsxRuntimeExports.jsx(CartContext.Provider,{value:{cart:i,addToCart:b,removeFromCart:et,updateQuantity:nt,clearCart:c,getItemCount:ct,getTotal:pt,updateCookingInstructions:a},children:e})}function useCart(){const e=reactExports.useContext(CartContext);if(e===void 0)throw new Error("useCart must be used within a CartProvider");return e}function isPointInPolygon(e,i){if(!i||!i.coordinates||i.coordinates.length===0)return!1;const s=i.coordinates[0],a=e.lng,b=e.lat;let et=!1;for(let nt=0,c=s.length-1;nt<s.length;c=nt++){const ct=s[nt][0],pt=s[nt][1],xt=s[c][0],St=s[c][1];pt>b!=St>b&&a<(xt-ct)*(b-pt)/(St-pt)+ct&&(et=!et)}return et}function isPointInZone(e,i,s){return isPointInPolygon({lat:e,lng:i},s)}function isLocationInAnyZone(e,i){for(const s of i){if(!s.zone||!s.zone.coordinates||!s.zone.coordinates[0]){console.log(`Skipping franchise ${s.id} - invalid zone data`);continue}const a=isPointInPolygon(e,s.zone);if(console.log(`Zone check for ${s.id}:`,{point:e,zoneCoords:s.zone.coordinates[0].slice(0,3),result:a}),a)return{isInZone:!0,franchiseId:s.id}}return{isInZone:!1,franchiseId:null}}function getPolygonCenter(e){if(!e||!e.coordinates||e.coordinates.length===0)return null;const i=e.coordinates[0];let s=0,a=0;for(const b of i)a+=b[0],s+=b[1];return{lat:s/i.length,lng:a/i.length}}function geoJSONToZonePolygon(e){return!e||!e.geometry||e.geometry.type!=="Polygon"?null:{type:"Polygon",coordinates:e.geometry.coordinates}}function useUserLocation(){const[e,i]=reactExports.useState(null),[s,a]=reactExports.useState(!0),[b,et]=reactExports.useState(null),nt=async(ct,pt)=>{try{const St=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${pt},${ct}.json?access_token=${MAPBOX_ACCESS_TOKEN}`)).json();if(St.features&&St.features.length>0){const Et=St.features[0].context||[],Rt=Et.find(It=>It.id.startsWith("locality")||It.id.startsWith("neighborhood")),Nt=Et.find(It=>It.id.startsWith("place"));return Rt?Rt.text:Nt?Nt.text:St.features[0].text||"Unknown"}return"Unknown location"}catch(xt){return console.error("Geocoding error:",xt),"Unknown location"}},c=()=>{if(a(!0),et(null),!("geolocation"in navigator)){et("Geolocation not supported"),a(!1);return}navigator.geolocation.getCurrentPosition(async ct=>{const{latitude:pt,longitude:xt}=ct.coords,St=await nt(pt,xt);i({lat:pt,lng:xt,address:St}),a(!1)},ct=>{console.error("Location error:",ct),et("Location access denied"),a(!1)},{enableHighAccuracy:!0,timeout:1e4})};return reactExports.useEffect(()=>{c()},[]),{location:e,loading:s,error:b,refetch:c,setLocation:i}}const LocationContext=reactExports.createContext(void 0);function LocationProvider({children:e}){const{location:i,loading:s,error:a,refetch:b,setLocation:et}=useUserLocation(),[nt,c]=reactExports.useState([]),[ct,pt]=reactExports.useState(!0),[xt,St]=reactExports.useState(!0),[Et,Rt]=reactExports.useState(null),[Nt,It]=reactExports.useState(!1);reactExports.useEffect(()=>{const Bt=ref(database,"franchises"),Lt=onValue(Bt,Vt=>{const Zt=Vt.val();if(Zt){const nr=Object.entries(Zt).map(([ur,_r])=>({..._r,id:ur})).filter(ur=>ur.isActive);c(nr)}else c([]);pt(!1)});return()=>Lt()},[]),reactExports.useEffect(()=>{if(s||ct)return;if(!i){console.log("No location available, allowing access by default"),St(!0),Rt(null),It(!0);return}if(nt.length===0){console.log("No franchises exist, allowing access"),St(!0),Rt(null),It(!0);return}const Bt=nt.filter(Zt=>Zt.zone&&Zt.zone.coordinates&&Zt.zone.coordinates[0]&&Zt.zone.coordinates[0].length>0);if(console.log("Location check:",{userLat:i.lat,userLng:i.lng,totalFranchises:nt.length,validFranchises:Bt.length,franchiseZones:nt.map(Zt=>{var nr,ur,_r,Ur;return{id:Zt.id,name:Zt.name,hasZone:!!Zt.zone,zoneType:(nr=Zt.zone)==null?void 0:nr.type,coordsLength:(Ur=(_r=(ur=Zt.zone)==null?void 0:ur.coordinates)==null?void 0:_r[0])==null?void 0:Ur.length}})}),Bt.length===0){console.log("No valid franchise zones, allowing access"),St(!0),Rt(null),It(!0);return}const Lt=Bt.map(Zt=>({id:Zt.id,zone:Zt.zone})),Vt=isLocationInAnyZone({lat:i.lat,lng:i.lng},Lt);console.log("Zone check result:",Vt),St(Vt.isInZone),Rt(Vt.franchiseId),It(!0)},[i,nt,s,ct]);const Gt=nt.find(Bt=>Bt.id===Et)||null,Dt=s||ct||!Nt;return jsxRuntimeExports.jsx(LocationContext.Provider,{value:{userLocation:i,locationLoading:s,locationError:a,isInServiceArea:xt,currentFranchiseId:Et,currentFranchise:Gt,franchises:nt,checkingZone:Dt,refetchLocation:b,setUserLocation:et},children:e})}function useLocationContext(){const e=reactExports.useContext(LocationContext);if(e===void 0)throw new Error("useLocationContext must be used within a LocationProvider");return e}const LayoutGroupContext=reactExports.createContext({});function useConstant(e){const i=reactExports.useRef(null);return i.current===null&&(i.current=e()),i.current}const isBrowser=typeof window<"u",useIsomorphicLayoutEffect$1=isBrowser?reactExports.useLayoutEffect:reactExports.useEffect,PresenceContext=reactExports.createContext(null);function addUniqueItem(e,i){e.indexOf(i)===-1&&e.push(i)}function removeItem(e,i){const s=e.indexOf(i);s>-1&&e.splice(s,1)}const clamp$1=(e,i,s)=>s>i?i:s<e?e:s;function formatErrorMessage(e,i){return i?`${e}. For more information and steps for solving, visit https://motion.dev/troubleshooting/${i}`:e}let warning=()=>{},invariant=()=>{};typeof process<"u";const MotionGlobalConfig={},isNumericalString=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function isObject(e){return typeof e=="object"&&e!==null}const isZeroValueString=e=>/^0[^.\s]+$/u.test(e);function memo(e){let i;return()=>(i===void 0&&(i=e()),i)}const noop=e=>e,combineFunctions=(e,i)=>s=>i(e(s)),pipe=(...e)=>e.reduce(combineFunctions),progress=(e,i,s)=>{const a=i-e;return a===0?1:(s-e)/a};class SubscriptionManager{constructor(){this.subscriptions=[]}add(i){return addUniqueItem(this.subscriptions,i),()=>removeItem(this.subscriptions,i)}notify(i,s,a){const b=this.subscriptions.length;if(b)if(b===1)this.subscriptions[0](i,s,a);else for(let et=0;et<b;et++){const nt=this.subscriptions[et];nt&&nt(i,s,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const secondsToMilliseconds=e=>e*1e3,millisecondsToSeconds=e=>e/1e3;function velocityPerSecond(e,i){return i?e*(1e3/i):0}const calcBezier=(e,i,s)=>(((1-3*s+3*i)*e+(3*s-6*i))*e+3*i)*e,subdivisionPrecision=1e-7,subdivisionMaxIterations=12;function binarySubdivide(e,i,s,a,b){let et,nt,c=0;do nt=i+(s-i)/2,et=calcBezier(nt,a,b)-e,et>0?s=nt:i=nt;while(Math.abs(et)>subdivisionPrecision&&++c<subdivisionMaxIterations);return nt}function cubicBezier(e,i,s,a){if(e===i&&s===a)return noop;const b=et=>binarySubdivide(et,0,1,e,s);return et=>et===0||et===1?et:calcBezier(b(et),i,a)}const mirrorEasing=e=>i=>i<=.5?e(2*i)/2:(2-e(2*(1-i)))/2,reverseEasing=e=>i=>1-e(1-i),backOut=cubicBezier(.33,1.53,.69,.99),backIn=reverseEasing(backOut),backInOut=mirrorEasing(backIn),anticipate=e=>(e*=2)<1?.5*backIn(e):.5*(2-Math.pow(2,-10*(e-1))),circIn=e=>1-Math.sin(Math.acos(e)),circOut=reverseEasing(circIn),circInOut=mirrorEasing(circIn),easeIn=cubicBezier(.42,0,1,1),easeOut=cubicBezier(0,0,.58,1),easeInOut=cubicBezier(.42,0,.58,1),isEasingArray=e=>Array.isArray(e)&&typeof e[0]!="number",isBezierDefinition=e=>Array.isArray(e)&&typeof e[0]=="number",easingLookup={linear:noop,easeIn,easeInOut,easeOut,circIn,circInOut,circOut,backIn,backInOut,backOut,anticipate},isValidEasing=e=>typeof e=="string",easingDefinitionToFunction=e=>{if(isBezierDefinition(e)){invariant(e.length===4,"Cubic bezier arrays must contain four numerical values.","cubic-bezier-length");const[i,s,a,b]=e;return cubicBezier(i,s,a,b)}else if(isValidEasing(e))return invariant(easingLookup[e]!==void 0,`Invalid easing type '${e}'`,"invalid-easing-type"),easingLookup[e];return e},stepsOrder=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],statsBuffer={value:null,addProjectionMetrics:null};function createRenderStep(e,i){let s=new Set,a=new Set,b=!1,et=!1;const nt=new WeakSet;let c={delta:0,timestamp:0,isProcessing:!1},ct=0;function pt(St){nt.has(St)&&(xt.schedule(St),e()),ct++,St(c)}const xt={schedule:(St,Et=!1,Rt=!1)=>{const It=Rt&&b?s:a;return Et&&nt.add(St),It.has(St)||It.add(St),St},cancel:St=>{a.delete(St),nt.delete(St)},process:St=>{if(c=St,b){et=!0;return}b=!0,[s,a]=[a,s],s.forEach(pt),i&&statsBuffer.value&&statsBuffer.value.frameloop[i].push(ct),ct=0,s.clear(),b=!1,et&&(et=!1,xt.process(St))}};return xt}const maxElapsed=40;function createRenderBatcher(e,i){let s=!1,a=!0;const b={delta:0,timestamp:0,isProcessing:!1},et=()=>s=!0,nt=stepsOrder.reduce((Lt,Vt)=>(Lt[Vt]=createRenderStep(et,i?Vt:void 0),Lt),{}),{setup:c,read:ct,resolveKeyframes:pt,preUpdate:xt,update:St,preRender:Et,render:Rt,postRender:Nt}=nt,It=()=>{const Lt=MotionGlobalConfig.useManualTiming?b.timestamp:performance.now();s=!1,MotionGlobalConfig.useManualTiming||(b.delta=a?1e3/60:Math.max(Math.min(Lt-b.timestamp,maxElapsed),1)),b.timestamp=Lt,b.isProcessing=!0,c.process(b),ct.process(b),pt.process(b),xt.process(b),St.process(b),Et.process(b),Rt.process(b),Nt.process(b),b.isProcessing=!1,s&&i&&(a=!1,e(It))},Gt=()=>{s=!0,a=!0,b.isProcessing||e(It)};return{schedule:stepsOrder.reduce((Lt,Vt)=>{const Zt=nt[Vt];return Lt[Vt]=(nr,ur=!1,_r=!1)=>(s||Gt(),Zt.schedule(nr,ur,_r)),Lt},{}),cancel:Lt=>{for(let Vt=0;Vt<stepsOrder.length;Vt++)nt[stepsOrder[Vt]].cancel(Lt)},state:b,steps:nt}}const{schedule:frame,cancel:cancelFrame,state:frameData,steps:frameSteps}=createRenderBatcher(typeof requestAnimationFrame<"u"?requestAnimationFrame:noop,!0);let now;function clearTime(){now=void 0}const time={now:()=>(now===void 0&&time.set(frameData.isProcessing||MotionGlobalConfig.useManualTiming?frameData.timestamp:performance.now()),now),set:e=>{now=e,queueMicrotask(clearTime)}},checkStringStartsWith=e=>i=>typeof i=="string"&&i.startsWith(e),isCSSVariableName=checkStringStartsWith("--"),startsAsVariableToken=checkStringStartsWith("var(--"),isCSSVariableToken=e=>startsAsVariableToken(e)?singleCssVariableRegex.test(e.split("/*")[0].trim()):!1,singleCssVariableRegex=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,number={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},alpha={...number,transform:e=>clamp$1(0,1,e)},scale={...number,default:1},sanitize=e=>Math.round(e*1e5)/1e5,floatRegex=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function isNullish(e){return e==null}const singleColorRegex=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,isColorString=(e,i)=>s=>!!(typeof s=="string"&&singleColorRegex.test(s)&&s.startsWith(e)||i&&!isNullish(s)&&Object.prototype.hasOwnProperty.call(s,i)),splitColor=(e,i,s)=>a=>{if(typeof a!="string")return a;const[b,et,nt,c]=a.match(floatRegex);return{[e]:parseFloat(b),[i]:parseFloat(et),[s]:parseFloat(nt),alpha:c!==void 0?parseFloat(c):1}},clampRgbUnit=e=>clamp$1(0,255,e),rgbUnit={...number,transform:e=>Math.round(clampRgbUnit(e))},rgba={test:isColorString("rgb","red"),parse:splitColor("red","green","blue"),transform:({red:e,green:i,blue:s,alpha:a=1})=>"rgba("+rgbUnit.transform(e)+", "+rgbUnit.transform(i)+", "+rgbUnit.transform(s)+", "+sanitize(alpha.transform(a))+")"};function parseHex(e){let i="",s="",a="",b="";return e.length>5?(i=e.substring(1,3),s=e.substring(3,5),a=e.substring(5,7),b=e.substring(7,9)):(i=e.substring(1,2),s=e.substring(2,3),a=e.substring(3,4),b=e.substring(4,5),i+=i,s+=s,a+=a,b+=b),{red:parseInt(i,16),green:parseInt(s,16),blue:parseInt(a,16),alpha:b?parseInt(b,16)/255:1}}const hex={test:isColorString("#"),parse:parseHex,transform:rgba.transform},createUnitType=e=>({test:i=>typeof i=="string"&&i.endsWith(e)&&i.split(" ").length===1,parse:parseFloat,transform:i=>`${i}${e}`}),degrees=createUnitType("deg"),percent=createUnitType("%"),px=createUnitType("px"),vh=createUnitType("vh"),vw=createUnitType("vw"),progressPercentage={...percent,parse:e=>percent.parse(e)/100,transform:e=>percent.transform(e*100)},hsla={test:isColorString("hsl","hue"),parse:splitColor("hue","saturation","lightness"),transform:({hue:e,saturation:i,lightness:s,alpha:a=1})=>"hsla("+Math.round(e)+", "+percent.transform(sanitize(i))+", "+percent.transform(sanitize(s))+", "+sanitize(alpha.transform(a))+")"},color={test:e=>rgba.test(e)||hex.test(e)||hsla.test(e),parse:e=>rgba.test(e)?rgba.parse(e):hsla.test(e)?hsla.parse(e):hex.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?rgba.transform(e):hsla.transform(e),getAnimatableNone:e=>{const i=color.parse(e);return i.alpha=0,color.transform(i)}},colorRegex=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function test(e){var i,s;return isNaN(e)&&typeof e=="string"&&(((i=e.match(floatRegex))==null?void 0:i.length)||0)+(((s=e.match(colorRegex))==null?void 0:s.length)||0)>0}const NUMBER_TOKEN="number",COLOR_TOKEN="color",VAR_TOKEN="var",VAR_FUNCTION_TOKEN="var(",SPLIT_TOKEN="${}",complexRegex=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function analyseComplexValue(e){const i=e.toString(),s=[],a={color:[],number:[],var:[]},b=[];let et=0;const c=i.replace(complexRegex,ct=>(color.test(ct)?(a.color.push(et),b.push(COLOR_TOKEN),s.push(color.parse(ct))):ct.startsWith(VAR_FUNCTION_TOKEN)?(a.var.push(et),b.push(VAR_TOKEN),s.push(ct)):(a.number.push(et),b.push(NUMBER_TOKEN),s.push(parseFloat(ct))),++et,SPLIT_TOKEN)).split(SPLIT_TOKEN);return{values:s,split:c,indexes:a,types:b}}function parseComplexValue(e){return analyseComplexValue(e).values}function createTransformer(e){const{split:i,types:s}=analyseComplexValue(e),a=i.length;return b=>{let et="";for(let nt=0;nt<a;nt++)if(et+=i[nt],b[nt]!==void 0){const c=s[nt];c===NUMBER_TOKEN?et+=sanitize(b[nt]):c===COLOR_TOKEN?et+=color.transform(b[nt]):et+=b[nt]}return et}}const convertNumbersToZero=e=>typeof e=="number"?0:color.test(e)?color.getAnimatableNone(e):e;function getAnimatableNone$1(e){const i=parseComplexValue(e);return createTransformer(e)(i.map(convertNumbersToZero))}const complex={test,parse:parseComplexValue,createTransformer,getAnimatableNone:getAnimatableNone$1};function hueToRgb(e,i,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+(i-e)*6*s:s<1/2?i:s<2/3?e+(i-e)*(2/3-s)*6:e}function hslaToRgba({hue:e,saturation:i,lightness:s,alpha:a}){e/=360,i/=100,s/=100;let b=0,et=0,nt=0;if(!i)b=et=nt=s;else{const c=s<.5?s*(1+i):s+i-s*i,ct=2*s-c;b=hueToRgb(ct,c,e+1/3),et=hueToRgb(ct,c,e),nt=hueToRgb(ct,c,e-1/3)}return{red:Math.round(b*255),green:Math.round(et*255),blue:Math.round(nt*255),alpha:a}}function mixImmediate(e,i){return s=>s>0?i:e}const mixNumber$1=(e,i,s)=>e+(i-e)*s,mixLinearColor=(e,i,s)=>{const a=e*e,b=s*(i*i-a)+a;return b<0?0:Math.sqrt(b)},colorTypes=[hex,rgba,hsla],getColorType=e=>colorTypes.find(i=>i.test(e));function asRGBA(e){const i=getColorType(e);if(warning(!!i,`'${e}' is not an animatable color. Use the equivalent color code instead.`,"color-not-animatable"),!i)return!1;let s=i.parse(e);return i===hsla&&(s=hslaToRgba(s)),s}const mixColor=(e,i)=>{const s=asRGBA(e),a=asRGBA(i);if(!s||!a)return mixImmediate(e,i);const b={...s};return et=>(b.red=mixLinearColor(s.red,a.red,et),b.green=mixLinearColor(s.green,a.green,et),b.blue=mixLinearColor(s.blue,a.blue,et),b.alpha=mixNumber$1(s.alpha,a.alpha,et),rgba.transform(b))},invisibleValues=new Set(["none","hidden"]);function mixVisibility(e,i){return invisibleValues.has(e)?s=>s<=0?e:i:s=>s>=1?i:e}function mixNumber(e,i){return s=>mixNumber$1(e,i,s)}function getMixer(e){return typeof e=="number"?mixNumber:typeof e=="string"?isCSSVariableToken(e)?mixImmediate:color.test(e)?mixColor:mixComplex:Array.isArray(e)?mixArray:typeof e=="object"?color.test(e)?mixColor:mixObject:mixImmediate}function mixArray(e,i){const s=[...e],a=s.length,b=e.map((et,nt)=>getMixer(et)(et,i[nt]));return et=>{for(let nt=0;nt<a;nt++)s[nt]=b[nt](et);return s}}function mixObject(e,i){const s={...e,...i},a={};for(const b in s)e[b]!==void 0&&i[b]!==void 0&&(a[b]=getMixer(e[b])(e[b],i[b]));return b=>{for(const et in a)s[et]=a[et](b);return s}}function matchOrder(e,i){const s=[],a={color:0,var:0,number:0};for(let b=0;b<i.values.length;b++){const et=i.types[b],nt=e.indexes[et][a[et]],c=e.values[nt]??0;s[b]=c,a[et]++}return s}const mixComplex=(e,i)=>{const s=complex.createTransformer(i),a=analyseComplexValue(e),b=analyseComplexValue(i);return a.indexes.var.length===b.indexes.var.length&&a.indexes.color.length===b.indexes.color.length&&a.indexes.number.length>=b.indexes.number.length?invisibleValues.has(e)&&!b.values.length||invisibleValues.has(i)&&!a.values.length?mixVisibility(e,i):pipe(mixArray(matchOrder(a,b),b.values),s):(warning(!0,`Complex values '${e}' and '${i}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`,"complex-values-different"),mixImmediate(e,i))};function mix(e,i,s){return typeof e=="number"&&typeof i=="number"&&typeof s=="number"?mixNumber$1(e,i,s):getMixer(e)(e,i)}const frameloopDriver=e=>{const i=({timestamp:s})=>e(s);return{start:(s=!0)=>frame.update(i,s),stop:()=>cancelFrame(i),now:()=>frameData.isProcessing?frameData.timestamp:time.now()}},generateLinearEasing=(e,i,s=10)=>{let a="";const b=Math.max(Math.round(i/s),2);for(let et=0;et<b;et++)a+=Math.round(e(et/(b-1))*1e4)/1e4+", ";return`linear(${a.substring(0,a.length-2)})`},maxGeneratorDuration=2e4;function calcGeneratorDuration(e){let i=0;const s=50;let a=e.next(i);for(;!a.done&&i<maxGeneratorDuration;)i+=s,a=e.next(i);return i>=maxGeneratorDuration?1/0:i}function createGeneratorEasing(e,i=100,s){const a=s({...e,keyframes:[0,i]}),b=Math.min(calcGeneratorDuration(a),maxGeneratorDuration);return{type:"keyframes",ease:et=>a.next(b*et).value/i,duration:millisecondsToSeconds(b)}}const velocitySampleDuration=5;function calcGeneratorVelocity(e,i,s){const a=Math.max(i-velocitySampleDuration,0);return velocityPerSecond(s-e(a),i-a)}const springDefaults={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},safeMin=.001;function findSpring({duration:e=springDefaults.duration,bounce:i=springDefaults.bounce,velocity:s=springDefaults.velocity,mass:a=springDefaults.mass}){let b,et;warning(e<=secondsToMilliseconds(springDefaults.maxDuration),"Spring duration must be 10 seconds or less","spring-duration-limit");let nt=1-i;nt=clamp$1(springDefaults.minDamping,springDefaults.maxDamping,nt),e=clamp$1(springDefaults.minDuration,springDefaults.maxDuration,millisecondsToSeconds(e)),nt<1?(b=pt=>{const xt=pt*nt,St=xt*e,Et=xt-s,Rt=calcAngularFreq(pt,nt),Nt=Math.exp(-St);return safeMin-Et/Rt*Nt},et=pt=>{const St=pt*nt*e,Et=St*s+s,Rt=Math.pow(nt,2)*Math.pow(pt,2)*e,Nt=Math.exp(-St),It=calcAngularFreq(Math.pow(pt,2),nt);return(-b(pt)+safeMin>0?-1:1)*((Et-Rt)*Nt)/It}):(b=pt=>{const xt=Math.exp(-pt*e),St=(pt-s)*e+1;return-safeMin+xt*St},et=pt=>{const xt=Math.exp(-pt*e),St=(s-pt)*(e*e);return xt*St});const c=5/e,ct=approximateRoot(b,et,c);if(e=secondsToMilliseconds(e),isNaN(ct))return{stiffness:springDefaults.stiffness,damping:springDefaults.damping,duration:e};{const pt=Math.pow(ct,2)*a;return{stiffness:pt,damping:nt*2*Math.sqrt(a*pt),duration:e}}}const rootIterations=12;function approximateRoot(e,i,s){let a=s;for(let b=1;b<rootIterations;b++)a=a-e(a)/i(a);return a}function calcAngularFreq(e,i){return e*Math.sqrt(1-i*i)}const durationKeys=["duration","bounce"],physicsKeys=["stiffness","damping","mass"];function isSpringType(e,i){return i.some(s=>e[s]!==void 0)}function getSpringOptions(e){let i={velocity:springDefaults.velocity,stiffness:springDefaults.stiffness,damping:springDefaults.damping,mass:springDefaults.mass,isResolvedFromDuration:!1,...e};if(!isSpringType(e,physicsKeys)&&isSpringType(e,durationKeys))if(e.visualDuration){const s=e.visualDuration,a=2*Math.PI/(s*1.2),b=a*a,et=2*clamp$1(.05,1,1-(e.bounce||0))*Math.sqrt(b);i={...i,mass:springDefaults.mass,stiffness:b,damping:et}}else{const s=findSpring(e);i={...i,...s,mass:springDefaults.mass},i.isResolvedFromDuration=!0}return i}function spring(e=springDefaults.visualDuration,i=springDefaults.bounce){const s=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:i}:e;let{restSpeed:a,restDelta:b}=s;const et=s.keyframes[0],nt=s.keyframes[s.keyframes.length-1],c={done:!1,value:et},{stiffness:ct,damping:pt,mass:xt,duration:St,velocity:Et,isResolvedFromDuration:Rt}=getSpringOptions({...s,velocity:-millisecondsToSeconds(s.velocity||0)}),Nt=Et||0,It=pt/(2*Math.sqrt(ct*xt)),Gt=nt-et,Dt=millisecondsToSeconds(Math.sqrt(ct/xt)),Bt=Math.abs(Gt)<5;a||(a=Bt?springDefaults.restSpeed.granular:springDefaults.restSpeed.default),b||(b=Bt?springDefaults.restDelta.granular:springDefaults.restDelta.default);let Lt;if(It<1){const Zt=calcAngularFreq(Dt,It);Lt=nr=>{const ur=Math.exp(-It*Dt*nr);return nt-ur*((Nt+It*Dt*Gt)/Zt*Math.sin(Zt*nr)+Gt*Math.cos(Zt*nr))}}else if(It===1)Lt=Zt=>nt-Math.exp(-Dt*Zt)*(Gt+(Nt+Dt*Gt)*Zt);else{const Zt=Dt*Math.sqrt(It*It-1);Lt=nr=>{const ur=Math.exp(-It*Dt*nr),_r=Math.min(Zt*nr,300);return nt-ur*((Nt+It*Dt*Gt)*Math.sinh(_r)+Zt*Gt*Math.cosh(_r))/Zt}}const Vt={calculatedDuration:Rt&&St||null,next:Zt=>{const nr=Lt(Zt);if(Rt)c.done=Zt>=St;else{let ur=Zt===0?Nt:0;It<1&&(ur=Zt===0?secondsToMilliseconds(Nt):calcGeneratorVelocity(Lt,Zt,nr));const _r=Math.abs(ur)<=a,Ur=Math.abs(nt-nr)<=b;c.done=_r&&Ur}return c.value=c.done?nt:nr,c},toString:()=>{const Zt=Math.min(calcGeneratorDuration(Vt),maxGeneratorDuration),nr=generateLinearEasing(ur=>Vt.next(Zt*ur).value,Zt,30);return Zt+"ms "+nr},toTransition:()=>{}};return Vt}spring.applyToOptions=e=>{const i=createGeneratorEasing(e,100,spring);return e.ease=i.ease,e.duration=secondsToMilliseconds(i.duration),e.type="keyframes",e};function inertia({keyframes:e,velocity:i=0,power:s=.8,timeConstant:a=325,bounceDamping:b=10,bounceStiffness:et=500,modifyTarget:nt,min:c,max:ct,restDelta:pt=.5,restSpeed:xt}){const St=e[0],Et={done:!1,value:St},Rt=_r=>c!==void 0&&_r<c||ct!==void 0&&_r>ct,Nt=_r=>c===void 0?ct:ct===void 0||Math.abs(c-_r)<Math.abs(ct-_r)?c:ct;let It=s*i;const Gt=St+It,Dt=nt===void 0?Gt:nt(Gt);Dt!==Gt&&(It=Dt-St);const Bt=_r=>-It*Math.exp(-_r/a),Lt=_r=>Dt+Bt(_r),Vt=_r=>{const Ur=Bt(_r),ln=Lt(_r);Et.done=Math.abs(Ur)<=pt,Et.value=Et.done?Dt:ln};let Zt,nr;const ur=_r=>{Rt(Et.value)&&(Zt=_r,nr=spring({keyframes:[Et.value,Nt(Et.value)],velocity:calcGeneratorVelocity(Lt,_r,Et.value),damping:b,stiffness:et,restDelta:pt,restSpeed:xt}))};return ur(0),{calculatedDuration:null,next:_r=>{let Ur=!1;return!nr&&Zt===void 0&&(Ur=!0,Vt(_r),ur(_r)),Zt!==void 0&&_r>=Zt?nr.next(_r-Zt):(!Ur&&Vt(_r),Et)}}}function createMixers(e,i,s){const a=[],b=s||MotionGlobalConfig.mix||mix,et=e.length-1;for(let nt=0;nt<et;nt++){let c=b(e[nt],e[nt+1]);if(i){const ct=Array.isArray(i)?i[nt]||noop:i;c=pipe(ct,c)}a.push(c)}return a}function interpolate(e,i,{clamp:s=!0,ease:a,mixer:b}={}){const et=e.length;if(invariant(et===i.length,"Both input and output ranges must be the same length","range-length"),et===1)return()=>i[0];if(et===2&&i[0]===i[1])return()=>i[1];const nt=e[0]===e[1];e[0]>e[et-1]&&(e=[...e].reverse(),i=[...i].reverse());const c=createMixers(i,a,b),ct=c.length,pt=xt=>{if(nt&&xt<e[0])return i[0];let St=0;if(ct>1)for(;St<e.length-2&&!(xt<e[St+1]);St++);const Et=progress(e[St],e[St+1],xt);return c[St](Et)};return s?xt=>pt(clamp$1(e[0],e[et-1],xt)):pt}function fillOffset(e,i){const s=e[e.length-1];for(let a=1;a<=i;a++){const b=progress(0,i,a);e.push(mixNumber$1(s,1,b))}}function defaultOffset(e){const i=[0];return fillOffset(i,e.length-1),i}function convertOffsetToTimes(e,i){return e.map(s=>s*i)}function defaultEasing(e,i){return e.map(()=>i||easeInOut).splice(0,e.length-1)}function keyframes({duration:e=300,keyframes:i,times:s,ease:a="easeInOut"}){const b=isEasingArray(a)?a.map(easingDefinitionToFunction):easingDefinitionToFunction(a),et={done:!1,value:i[0]},nt=convertOffsetToTimes(s&&s.length===i.length?s:defaultOffset(i),e),c=interpolate(nt,i,{ease:Array.isArray(b)?b:defaultEasing(i,b)});return{calculatedDuration:e,next:ct=>(et.value=c(ct),et.done=ct>=e,et)}}const isNotNull$1=e=>e!==null;function getFinalKeyframe$1(e,{repeat:i,repeatType:s="loop"},a,b=1){const et=e.filter(isNotNull$1),c=b<0||i&&s!=="loop"&&i%2===1?0:et.length-1;return!c||a===void 0?et[c]:a}const transitionTypeMap={decay:inertia,inertia,tween:keyframes,keyframes,spring};function replaceTransitionType(e){typeof e.type=="string"&&(e.type=transitionTypeMap[e.type])}class WithPromise{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(i=>{this.resolve=i})}notifyFinished(){this.resolve()}then(i,s){return this.finished.then(i,s)}}const percentToProgress=e=>e/100;class JSAnimation extends WithPromise{constructor(i){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var a,b;const{motionValue:s}=this.options;s&&s.updatedAt!==time.now()&&this.tick(time.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(b=(a=this.options).onStop)==null||b.call(a))},this.options=i,this.initAnimation(),this.play(),i.autoplay===!1&&this.pause()}initAnimation(){const{options:i}=this;replaceTransitionType(i);const{type:s=keyframes,repeat:a=0,repeatDelay:b=0,repeatType:et,velocity:nt=0}=i;let{keyframes:c}=i;const ct=s||keyframes;ct!==keyframes&&typeof c[0]!="number"&&(this.mixKeyframes=pipe(percentToProgress,mix(c[0],c[1])),c=[0,100]);const pt=ct({...i,keyframes:c});et==="mirror"&&(this.mirroredGenerator=ct({...i,keyframes:[...c].reverse(),velocity:-nt})),pt.calculatedDuration===null&&(pt.calculatedDuration=calcGeneratorDuration(pt));const{calculatedDuration:xt}=pt;this.calculatedDuration=xt,this.resolvedDuration=xt+b,this.totalDuration=this.resolvedDuration*(a+1)-b,this.generator=pt}updateTime(i){const s=Math.round(i-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=s}tick(i,s=!1){const{generator:a,totalDuration:b,mixKeyframes:et,mirroredGenerator:nt,resolvedDuration:c,calculatedDuration:ct}=this;if(this.startTime===null)return a.next(0);const{delay:pt=0,keyframes:xt,repeat:St,repeatType:Et,repeatDelay:Rt,type:Nt,onUpdate:It,finalKeyframe:Gt}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,i):this.speed<0&&(this.startTime=Math.min(i-b/this.speed,this.startTime)),s?this.currentTime=i:this.updateTime(i);const Dt=this.currentTime-pt*(this.playbackSpeed>=0?1:-1),Bt=this.playbackSpeed>=0?Dt<0:Dt>b;this.currentTime=Math.max(Dt,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=b);let Lt=this.currentTime,Vt=a;if(St){const _r=Math.min(this.currentTime,b)/c;let Ur=Math.floor(_r),ln=_r%1;!ln&&_r>=1&&(ln=1),ln===1&&Ur--,Ur=Math.min(Ur,St+1),!!(Ur%2)&&(Et==="reverse"?(ln=1-ln,Rt&&(ln-=Rt/c)):Et==="mirror"&&(Vt=nt)),Lt=clamp$1(0,1,ln)*c}const Zt=Bt?{done:!1,value:xt[0]}:Vt.next(Lt);et&&(Zt.value=et(Zt.value));let{done:nr}=Zt;!Bt&&ct!==null&&(nr=this.playbackSpeed>=0?this.currentTime>=b:this.currentTime<=0);const ur=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&nr);return ur&&Nt!==inertia&&(Zt.value=getFinalKeyframe$1(xt,this.options,Gt,this.speed)),It&&It(Zt.value),ur&&this.finish(),Zt}then(i,s){return this.finished.then(i,s)}get duration(){return millisecondsToSeconds(this.calculatedDuration)}get iterationDuration(){const{delay:i=0}=this.options||{};return this.duration+millisecondsToSeconds(i)}get time(){return millisecondsToSeconds(this.currentTime)}set time(i){var s;i=secondsToMilliseconds(i),this.currentTime=i,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=i:this.driver&&(this.startTime=this.driver.now()-i/this.playbackSpeed),(s=this.driver)==null||s.start(!1)}get speed(){return this.playbackSpeed}set speed(i){this.updateTime(time.now());const s=this.playbackSpeed!==i;this.playbackSpeed=i,s&&(this.time=millisecondsToSeconds(this.currentTime))}play(){var b,et;if(this.isStopped)return;const{driver:i=frameloopDriver,startTime:s}=this.options;this.driver||(this.driver=i(nt=>this.tick(nt))),(et=(b=this.options).onPlay)==null||et.call(b);const a=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=a):this.holdTime!==null?this.startTime=a-this.holdTime:this.startTime||(this.startTime=s??a),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(time.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var i,s;this.notifyFinished(),this.teardown(),this.state="finished",(s=(i=this.options).onComplete)==null||s.call(i)}cancel(){var i,s;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(s=(i=this.options).onCancel)==null||s.call(i)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(i){return this.startTime=0,this.tick(i,!0)}attachTimeline(i){var s;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(s=this.driver)==null||s.stop(),i.observe(this)}}function fillWildcards(e){for(let i=1;i<e.length;i++)e[i]??(e[i]=e[i-1])}const radToDeg=e=>e*180/Math.PI,rotate=e=>{const i=radToDeg(Math.atan2(e[1],e[0]));return rebaseAngle(i)},matrix2dParsers={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate,rotateZ:rotate,skewX:e=>radToDeg(Math.atan(e[1])),skewY:e=>radToDeg(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},rebaseAngle=e=>(e=e%360,e<0&&(e+=360),e),rotateZ=rotate,scaleX=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),scaleY=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),matrix3dParsers={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX,scaleY,scale:e=>(scaleX(e)+scaleY(e))/2,rotateX:e=>rebaseAngle(radToDeg(Math.atan2(e[6],e[5]))),rotateY:e=>rebaseAngle(radToDeg(Math.atan2(-e[2],e[0]))),rotateZ,rotate:rotateZ,skewX:e=>radToDeg(Math.atan(e[4])),skewY:e=>radToDeg(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function defaultTransformValue(e){return e.includes("scale")?1:0}function parseValueFromTransform(e,i){if(!e||e==="none")return defaultTransformValue(i);const s=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let a,b;if(s)a=matrix3dParsers,b=s;else{const c=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);a=matrix2dParsers,b=c}if(!b)return defaultTransformValue(i);const et=a[i],nt=b[1].split(",").map(convertTransformToNumber);return typeof et=="function"?et(nt):nt[et]}const readTransformValue=(e,i)=>{const{transform:s="none"}=getComputedStyle(e);return parseValueFromTransform(s,i)};function convertTransformToNumber(e){return parseFloat(e.trim())}const transformPropOrder=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],transformProps=new Set(transformPropOrder),isNumOrPxType=e=>e===number||e===px,transformKeys=new Set(["x","y","z"]),nonTranslationalTransformKeys=transformPropOrder.filter(e=>!transformKeys.has(e));function removeNonTranslationalTransform(e){const i=[];return nonTranslationalTransformKeys.forEach(s=>{const a=e.getValue(s);a!==void 0&&(i.push([s,a.get()]),a.set(s.startsWith("scale")?1:0))}),i}const positionalValues={width:({x:e},{paddingLeft:i="0",paddingRight:s="0"})=>e.max-e.min-parseFloat(i)-parseFloat(s),height:({y:e},{paddingTop:i="0",paddingBottom:s="0"})=>e.max-e.min-parseFloat(i)-parseFloat(s),top:(e,{top:i})=>parseFloat(i),left:(e,{left:i})=>parseFloat(i),bottom:({y:e},{top:i})=>parseFloat(i)+(e.max-e.min),right:({x:e},{left:i})=>parseFloat(i)+(e.max-e.min),x:(e,{transform:i})=>parseValueFromTransform(i,"x"),y:(e,{transform:i})=>parseValueFromTransform(i,"y")};positionalValues.translateX=positionalValues.x;positionalValues.translateY=positionalValues.y;const toResolve=new Set;let isScheduled=!1,anyNeedsMeasurement=!1,isForced=!1;function measureAllKeyframes(){if(anyNeedsMeasurement){const e=Array.from(toResolve).filter(a=>a.needsMeasurement),i=new Set(e.map(a=>a.element)),s=new Map;i.forEach(a=>{const b=removeNonTranslationalTransform(a);b.length&&(s.set(a,b),a.render())}),e.forEach(a=>a.measureInitialState()),i.forEach(a=>{a.render();const b=s.get(a);b&&b.forEach(([et,nt])=>{var c;(c=a.getValue(et))==null||c.set(nt)})}),e.forEach(a=>a.measureEndState()),e.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}anyNeedsMeasurement=!1,isScheduled=!1,toResolve.forEach(e=>e.complete(isForced)),toResolve.clear()}function readAllKeyframes(){toResolve.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(anyNeedsMeasurement=!0)})}function flushKeyframeResolvers(){isForced=!0,readAllKeyframes(),measureAllKeyframes(),isForced=!1}class KeyframeResolver{constructor(i,s,a,b,et,nt=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...i],this.onComplete=s,this.name=a,this.motionValue=b,this.element=et,this.isAsync=nt}scheduleResolve(){this.state="scheduled",this.isAsync?(toResolve.add(this),isScheduled||(isScheduled=!0,frame.read(readAllKeyframes),frame.resolveKeyframes(measureAllKeyframes))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:i,name:s,element:a,motionValue:b}=this;if(i[0]===null){const et=b==null?void 0:b.get(),nt=i[i.length-1];if(et!==void 0)i[0]=et;else if(a&&s){const c=a.readValue(s,nt);c!=null&&(i[0]=c)}i[0]===void 0&&(i[0]=nt),b&&et===void 0&&b.set(i[0])}fillWildcards(i)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(i=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,i),toResolve.delete(this)}cancel(){this.state==="scheduled"&&(toResolve.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const isCSSVar=e=>e.startsWith("--");function setStyle(e,i,s){isCSSVar(i)?e.style.setProperty(i,s):e.style[i]=s}const supportsScrollTimeline=memo(()=>window.ScrollTimeline!==void 0),supportsFlags={};function memoSupports(e,i){const s=memo(e);return()=>supportsFlags[i]??s()}const supportsLinearEasing=memoSupports(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),cubicBezierAsString=([e,i,s,a])=>`cubic-bezier(${e}, ${i}, ${s}, ${a})`,supportedWaapiEasing={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:cubicBezierAsString([0,.65,.55,1]),circOut:cubicBezierAsString([.55,0,1,.45]),backIn:cubicBezierAsString([.31,.01,.66,-.59]),backOut:cubicBezierAsString([.33,1.53,.69,.99])};function mapEasingToNativeEasing(e,i){if(e)return typeof e=="function"?supportsLinearEasing()?generateLinearEasing(e,i):"ease-out":isBezierDefinition(e)?cubicBezierAsString(e):Array.isArray(e)?e.map(s=>mapEasingToNativeEasing(s,i)||supportedWaapiEasing.easeOut):supportedWaapiEasing[e]}function startWaapiAnimation(e,i,s,{delay:a=0,duration:b=300,repeat:et=0,repeatType:nt="loop",ease:c="easeOut",times:ct}={},pt=void 0){const xt={[i]:s};ct&&(xt.offset=ct);const St=mapEasingToNativeEasing(c,b);Array.isArray(St)&&(xt.easing=St);const Et={delay:a,duration:b,easing:Array.isArray(St)?"linear":St,fill:"both",iterations:et+1,direction:nt==="reverse"?"alternate":"normal"};return pt&&(Et.pseudoElement=pt),e.animate(xt,Et)}function isGenerator(e){return typeof e=="function"&&"applyToOptions"in e}function applyGeneratorOptions({type:e,...i}){return isGenerator(e)&&supportsLinearEasing()?e.applyToOptions(i):(i.duration??(i.duration=300),i.ease??(i.ease="easeOut"),i)}class NativeAnimation extends WithPromise{constructor(i){if(super(),this.finishedTime=null,this.isStopped=!1,!i)return;const{element:s,name:a,keyframes:b,pseudoElement:et,allowFlatten:nt=!1,finalKeyframe:c,onComplete:ct}=i;this.isPseudoElement=!!et,this.allowFlatten=nt,this.options=i,invariant(typeof i.type!="string",`Mini animate() doesn't support "type" as a string.`,"mini-spring");const pt=applyGeneratorOptions(i);this.animation=startWaapiAnimation(s,a,b,pt,et),pt.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!et){const xt=getFinalKeyframe$1(b,this.options,c,this.speed);this.updateMotionValue?this.updateMotionValue(xt):setStyle(s,a,xt),this.animation.cancel()}ct==null||ct(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var i,s;(s=(i=this.animation).finish)==null||s.call(i)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:i}=this;i==="idle"||i==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var i,s;this.isPseudoElement||(s=(i=this.animation).commitStyles)==null||s.call(i)}get duration(){var s,a;const i=((a=(s=this.animation.effect)==null?void 0:s.getComputedTiming)==null?void 0:a.call(s).duration)||0;return millisecondsToSeconds(Number(i))}get iterationDuration(){const{delay:i=0}=this.options||{};return this.duration+millisecondsToSeconds(i)}get time(){return millisecondsToSeconds(Number(this.animation.currentTime)||0)}set time(i){this.finishedTime=null,this.animation.currentTime=secondsToMilliseconds(i)}get speed(){return this.animation.playbackRate}set speed(i){i<0&&(this.finishedTime=null),this.animation.playbackRate=i}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(i){this.animation.startTime=i}attachTimeline({timeline:i,observe:s}){var a;return this.allowFlatten&&((a=this.animation.effect)==null||a.updateTiming({easing:"linear"})),this.animation.onfinish=null,i&&supportsScrollTimeline()?(this.animation.timeline=i,noop):s(this)}}const unsupportedEasingFunctions={anticipate,backInOut,circInOut};function isUnsupportedEase(e){return e in unsupportedEasingFunctions}function replaceStringEasing(e){typeof e.ease=="string"&&isUnsupportedEase(e.ease)&&(e.ease=unsupportedEasingFunctions[e.ease])}const sampleDelta=10;class NativeAnimationExtended extends NativeAnimation{constructor(i){replaceStringEasing(i),replaceTransitionType(i),super(i),i.startTime&&(this.startTime=i.startTime),this.options=i}updateMotionValue(i){const{motionValue:s,onUpdate:a,onComplete:b,element:et,...nt}=this.options;if(!s)return;if(i!==void 0){s.set(i);return}const c=new JSAnimation({...nt,autoplay:!1}),ct=secondsToMilliseconds(this.finishedTime??this.time);s.setWithVelocity(c.sample(ct-sampleDelta).value,c.sample(ct).value,sampleDelta),c.stop()}}const isAnimatable=(e,i)=>i==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(complex.test(e)||e==="0")&&!e.startsWith("url("));function hasKeyframesChanged(e){const i=e[0];if(e.length===1)return!0;for(let s=0;s<e.length;s++)if(e[s]!==i)return!0}function canAnimate(e,i,s,a){const b=e[0];if(b===null)return!1;if(i==="display"||i==="visibility")return!0;const et=e[e.length-1],nt=isAnimatable(b,i),c=isAnimatable(et,i);return warning(nt===c,`You are trying to animate ${i} from "${b}" to "${et}". "${nt?et:b}" is not an animatable value.`,"value-not-animatable"),!nt||!c?!1:hasKeyframesChanged(e)||(s==="spring"||isGenerator(s))&&a}function makeAnimationInstant(e){e.duration=0,e.type="keyframes"}const acceleratedValues=new Set(["opacity","clipPath","filter","transform"]),supportsWaapi=memo(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function supportsBrowserAnimation(e){var xt;const{motionValue:i,name:s,repeatDelay:a,repeatType:b,damping:et,type:nt}=e;if(!(((xt=i==null?void 0:i.owner)==null?void 0:xt.current)instanceof HTMLElement))return!1;const{onUpdate:ct,transformTemplate:pt}=i.owner.getProps();return supportsWaapi()&&s&&acceleratedValues.has(s)&&(s!=="transform"||!pt)&&!ct&&!a&&b!=="mirror"&&et!==0&&nt!=="inertia"}const MAX_RESOLVE_DELAY=40;class AsyncMotionValueAnimation extends WithPromise{constructor({autoplay:i=!0,delay:s=0,type:a="keyframes",repeat:b=0,repeatDelay:et=0,repeatType:nt="loop",keyframes:c,name:ct,motionValue:pt,element:xt,...St}){var Nt;super(),this.stop=()=>{var It,Gt;this._animation&&(this._animation.stop(),(It=this.stopTimeline)==null||It.call(this)),(Gt=this.keyframeResolver)==null||Gt.cancel()},this.createdAt=time.now();const Et={autoplay:i,delay:s,type:a,repeat:b,repeatDelay:et,repeatType:nt,name:ct,motionValue:pt,element:xt,...St},Rt=(xt==null?void 0:xt.KeyframeResolver)||KeyframeResolver;this.keyframeResolver=new Rt(c,(It,Gt,Dt)=>this.onKeyframesResolved(It,Gt,Et,!Dt),ct,pt,xt),(Nt=this.keyframeResolver)==null||Nt.scheduleResolve()}onKeyframesResolved(i,s,a,b){this.keyframeResolver=void 0;const{name:et,type:nt,velocity:c,delay:ct,isHandoff:pt,onUpdate:xt}=a;this.resolvedAt=time.now(),canAnimate(i,et,nt,c)||((MotionGlobalConfig.instantAnimations||!ct)&&(xt==null||xt(getFinalKeyframe$1(i,a,s))),i[0]=i[i.length-1],makeAnimationInstant(a),a.repeat=0);const Et={startTime:b?this.resolvedAt?this.resolvedAt-this.createdAt>MAX_RESOLVE_DELAY?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:s,...a,keyframes:i},Rt=!pt&&supportsBrowserAnimation(Et)?new NativeAnimationExtended({...Et,element:Et.motionValue.owner.current}):new JSAnimation(Et);Rt.finished.then(()=>this.notifyFinished()).catch(noop),this.pendingTimeline&&(this.stopTimeline=Rt.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=Rt}get finished(){return this._animation?this.animation.finished:this._finished}then(i,s){return this.finished.finally(i).then(()=>{})}get animation(){var i;return this._animation||((i=this.keyframeResolver)==null||i.resume(),flushKeyframeResolvers()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(i){this.animation.time=i}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(i){this.animation.speed=i}get startTime(){return this.animation.startTime}attachTimeline(i){return this._animation?this.stopTimeline=this.animation.attachTimeline(i):this.pendingTimeline=i,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var i;this._animation&&this.animation.cancel(),(i=this.keyframeResolver)==null||i.cancel()}}const splitCSSVariableRegex=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function parseCSSVariable(e){const i=splitCSSVariableRegex.exec(e);if(!i)return[,];const[,s,a,b]=i;return[`--${s??a}`,b]}const maxDepth=4;function getVariableValue(e,i,s=1){invariant(s<=maxDepth,`Max CSS variable fallback depth detected in property "${e}". This may indicate a circular fallback dependency.`,"max-css-var-depth");const[a,b]=parseCSSVariable(e);if(!a)return;const et=window.getComputedStyle(i).getPropertyValue(a);if(et){const nt=et.trim();return isNumericalString(nt)?parseFloat(nt):nt}return isCSSVariableToken(b)?getVariableValue(b,i,s+1):b}function getValueTransition(e,i){return(e==null?void 0:e[i])??(e==null?void 0:e.default)??e}const positionalKeys=new Set(["width","height","top","left","right","bottom",...transformPropOrder]),auto={test:e=>e==="auto",parse:e=>e},testValueType=e=>i=>i.test(e),dimensionValueTypes=[number,px,percent,degrees,vw,vh,auto],findDimensionValueType=e=>dimensionValueTypes.find(testValueType(e));function isNone(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||isZeroValueString(e):!0}const maxDefaults=new Set(["brightness","contrast","saturate","opacity"]);function applyDefaultFilter(e){const[i,s]=e.slice(0,-1).split("(");if(i==="drop-shadow")return e;const[a]=s.match(floatRegex)||[];if(!a)return e;const b=s.replace(a,"");let et=maxDefaults.has(i)?1:0;return a!==s&&(et*=100),i+"("+et+b+")"}const functionRegex=/\b([a-z-]*)\(.*?\)/gu,filter={...complex,getAnimatableNone:e=>{const i=e.match(functionRegex);return i?i.map(applyDefaultFilter).join(" "):e}},int={...number,transform:Math.round},transformValueTypes={rotate:degrees,rotateX:degrees,rotateY:degrees,rotateZ:degrees,scale,scaleX:scale,scaleY:scale,scaleZ:scale,skew:degrees,skewX:degrees,skewY:degrees,distance:px,translateX:px,translateY:px,translateZ:px,x:px,y:px,z:px,perspective:px,transformPerspective:px,opacity:alpha,originX:progressPercentage,originY:progressPercentage,originZ:px},numberValueTypes={borderWidth:px,borderTopWidth:px,borderRightWidth:px,borderBottomWidth:px,borderLeftWidth:px,borderRadius:px,radius:px,borderTopLeftRadius:px,borderTopRightRadius:px,borderBottomRightRadius:px,borderBottomLeftRadius:px,width:px,maxWidth:px,height:px,maxHeight:px,top:px,right:px,bottom:px,left:px,inset:px,insetBlock:px,insetBlockStart:px,insetBlockEnd:px,insetInline:px,insetInlineStart:px,insetInlineEnd:px,padding:px,paddingTop:px,paddingRight:px,paddingBottom:px,paddingLeft:px,paddingBlock:px,paddingBlockStart:px,paddingBlockEnd:px,paddingInline:px,paddingInlineStart:px,paddingInlineEnd:px,margin:px,marginTop:px,marginRight:px,marginBottom:px,marginLeft:px,marginBlock:px,marginBlockStart:px,marginBlockEnd:px,marginInline:px,marginInlineStart:px,marginInlineEnd:px,backgroundPositionX:px,backgroundPositionY:px,...transformValueTypes,zIndex:int,fillOpacity:alpha,strokeOpacity:alpha,numOctaves:int},defaultValueTypes={...numberValueTypes,color,backgroundColor:color,outlineColor:color,fill:color,stroke:color,borderColor:color,borderTopColor:color,borderRightColor:color,borderBottomColor:color,borderLeftColor:color,filter,WebkitFilter:filter},getDefaultValueType=e=>defaultValueTypes[e];function getAnimatableNone(e,i){let s=getDefaultValueType(e);return s!==filter&&(s=complex),s.getAnimatableNone?s.getAnimatableNone(i):void 0}const invalidTemplates=new Set(["auto","none","0"]);function makeNoneKeyframesAnimatable(e,i,s){let a=0,b;for(;a<e.length&&!b;){const et=e[a];typeof et=="string"&&!invalidTemplates.has(et)&&analyseComplexValue(et).values.length&&(b=e[a]),a++}if(b&&s)for(const et of i)e[et]=getAnimatableNone(s,b)}class DOMKeyframesResolver extends KeyframeResolver{constructor(i,s,a,b,et){super(i,s,a,b,et,!0)}readKeyframes(){const{unresolvedKeyframes:i,element:s,name:a}=this;if(!s||!s.current)return;super.readKeyframes();for(let ct=0;ct<i.length;ct++){let pt=i[ct];if(typeof pt=="string"&&(pt=pt.trim(),isCSSVariableToken(pt))){const xt=getVariableValue(pt,s.current);xt!==void 0&&(i[ct]=xt),ct===i.length-1&&(this.finalKeyframe=pt)}}if(this.resolveNoneKeyframes(),!positionalKeys.has(a)||i.length!==2)return;const[b,et]=i,nt=findDimensionValueType(b),c=findDimensionValueType(et);if(nt!==c)if(isNumOrPxType(nt)&&isNumOrPxType(c))for(let ct=0;ct<i.length;ct++){const pt=i[ct];typeof pt=="string"&&(i[ct]=parseFloat(pt))}else positionalValues[a]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:i,name:s}=this,a=[];for(let b=0;b<i.length;b++)(i[b]===null||isNone(i[b]))&&a.push(b);a.length&&makeNoneKeyframesAnimatable(i,a,s)}measureInitialState(){const{element:i,unresolvedKeyframes:s,name:a}=this;if(!i||!i.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=positionalValues[a](i.measureViewportBox(),window.getComputedStyle(i.current)),s[0]=this.measuredOrigin;const b=s[s.length-1];b!==void 0&&i.getValue(a,b).jump(b,!1)}measureEndState(){var c;const{element:i,name:s,unresolvedKeyframes:a}=this;if(!i||!i.current)return;const b=i.getValue(s);b&&b.jump(this.measuredOrigin,!1);const et=a.length-1,nt=a[et];a[et]=positionalValues[s](i.measureViewportBox(),window.getComputedStyle(i.current)),nt!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=nt),(c=this.removedTransforms)!=null&&c.length&&this.removedTransforms.forEach(([ct,pt])=>{i.getValue(ct).set(pt)}),this.resolveNoneKeyframes()}}function resolveElements(e,i,s){if(e instanceof EventTarget)return[e];if(typeof e=="string"){const b=document.querySelectorAll(e);return b?Array.from(b):[]}return Array.from(e)}const getValueAsType=(e,i)=>i&&typeof e=="number"?i.transform(e):e;function isHTMLElement(e){return isObject(e)&&"offsetHeight"in e}const MAX_VELOCITY_DELTA=30,isFloat=e=>!isNaN(parseFloat(e));class MotionValue{constructor(i,s={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=a=>{var et;const b=time.now();if(this.updatedAt!==b&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&((et=this.events.change)==null||et.notify(this.current),this.dependents))for(const nt of this.dependents)nt.dirty()},this.hasAnimated=!1,this.setCurrent(i),this.owner=s.owner}setCurrent(i){this.current=i,this.updatedAt=time.now(),this.canTrackVelocity===null&&i!==void 0&&(this.canTrackVelocity=isFloat(this.current))}setPrevFrameValue(i=this.current){this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt}onChange(i){return this.on("change",i)}on(i,s){this.events[i]||(this.events[i]=new SubscriptionManager);const a=this.events[i].add(s);return i==="change"?()=>{a(),frame.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const i in this.events)this.events[i].clear()}attach(i,s){this.passiveEffect=i,this.stopPassiveEffect=s}set(i){this.passiveEffect?this.passiveEffect(i,this.updateAndNotify):this.updateAndNotify(i)}setWithVelocity(i,s,a){this.set(s),this.prev=void 0,this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt-a}jump(i,s=!0){this.updateAndNotify(i),this.prev=i,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var i;(i=this.events.change)==null||i.notify(this.current)}addDependent(i){this.dependents||(this.dependents=new Set),this.dependents.add(i)}removeDependent(i){this.dependents&&this.dependents.delete(i)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const i=time.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||i-this.updatedAt>MAX_VELOCITY_DELTA)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,MAX_VELOCITY_DELTA);return velocityPerSecond(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(i){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=i(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var i,s;(i=this.dependents)==null||i.clear(),(s=this.events.destroy)==null||s.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function motionValue(e,i){return new MotionValue(e,i)}const{schedule:microtask,cancel:cancelMicrotask}=createRenderBatcher(queueMicrotask,!1),isDragging={x:!1,y:!1};function isDragActive(){return isDragging.x||isDragging.y}function setDragLock(e){return e==="x"||e==="y"?isDragging[e]?null:(isDragging[e]=!0,()=>{isDragging[e]=!1}):isDragging.x||isDragging.y?null:(isDragging.x=isDragging.y=!0,()=>{isDragging.x=isDragging.y=!1})}function setupGesture(e,i){const s=resolveElements(e),a=new AbortController,b={passive:!0,...i,signal:a.signal};return[s,b,()=>a.abort()]}function isValidHover(e){return!(e.pointerType==="touch"||isDragActive())}function hover(e,i,s={}){const[a,b,et]=setupGesture(e,s),nt=c=>{if(!isValidHover(c))return;const{target:ct}=c,pt=i(ct,c);if(typeof pt!="function"||!ct)return;const xt=St=>{isValidHover(St)&&(pt(St),ct.removeEventListener("pointerleave",xt))};ct.addEventListener("pointerleave",xt,b)};return a.forEach(c=>{c.addEventListener("pointerenter",nt,b)}),et}const isNodeOrChild=(e,i)=>i?e===i?!0:isNodeOrChild(e,i.parentElement):!1,isPrimaryPointer=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,focusableElements=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function isElementKeyboardAccessible(e){return focusableElements.has(e.tagName)||e.tabIndex!==-1}const isPressing=new WeakSet;function filterEvents(e){return i=>{i.key==="Enter"&&e(i)}}function firePointerEvent(e,i){e.dispatchEvent(new PointerEvent("pointer"+i,{isPrimary:!0,bubbles:!0}))}const enableKeyboardPress=(e,i)=>{const s=e.currentTarget;if(!s)return;const a=filterEvents(()=>{if(isPressing.has(s))return;firePointerEvent(s,"down");const b=filterEvents(()=>{firePointerEvent(s,"up")}),et=()=>firePointerEvent(s,"cancel");s.addEventListener("keyup",b,i),s.addEventListener("blur",et,i)});s.addEventListener("keydown",a,i),s.addEventListener("blur",()=>s.removeEventListener("keydown",a),i)};function isValidPressEvent(e){return isPrimaryPointer(e)&&!isDragActive()}function press(e,i,s={}){const[a,b,et]=setupGesture(e,s),nt=c=>{const ct=c.currentTarget;if(!isValidPressEvent(c))return;isPressing.add(ct);const pt=i(ct,c),xt=(Rt,Nt)=>{window.removeEventListener("pointerup",St),window.removeEventListener("pointercancel",Et),isPressing.has(ct)&&isPressing.delete(ct),isValidPressEvent(Rt)&&typeof pt=="function"&&pt(Rt,{success:Nt})},St=Rt=>{xt(Rt,ct===window||ct===document||s.useGlobalTarget||isNodeOrChild(ct,Rt.target))},Et=Rt=>{xt(Rt,!1)};window.addEventListener("pointerup",St,b),window.addEventListener("pointercancel",Et,b)};return a.forEach(c=>{(s.useGlobalTarget?window:c).addEventListener("pointerdown",nt,b),isHTMLElement(c)&&(c.addEventListener("focus",pt=>enableKeyboardPress(pt,b)),!isElementKeyboardAccessible(c)&&!c.hasAttribute("tabindex")&&(c.tabIndex=0))}),et}function isSVGElement(e){return isObject(e)&&"ownerSVGElement"in e}function isSVGSVGElement(e){return isSVGElement(e)&&e.tagName==="svg"}const isMotionValue=e=>!!(e&&e.getVelocity),valueTypes=[...dimensionValueTypes,color,complex],findValueType=e=>valueTypes.find(testValueType(e)),MotionConfigContext=reactExports.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function setRef$1(e,i){if(typeof e=="function")return e(i);e!=null&&(e.current=i)}function composeRefs(...e){return i=>{let s=!1;const a=e.map(b=>{const et=setRef$1(b,i);return!s&&typeof et=="function"&&(s=!0),et});if(s)return()=>{for(let b=0;b<a.length;b++){const et=a[b];typeof et=="function"?et():setRef$1(e[b],null)}}}}function useComposedRefs(...e){return reactExports.useCallback(composeRefs(...e),e)}class PopChildMeasure extends reactExports.Component{getSnapshotBeforeUpdate(i){const s=this.props.childRef.current;if(s&&i.isPresent&&!this.props.isPresent){const a=s.offsetParent,b=isHTMLElement(a)&&a.offsetWidth||0,et=this.props.sizeRef.current;et.height=s.offsetHeight||0,et.width=s.offsetWidth||0,et.top=s.offsetTop,et.left=s.offsetLeft,et.right=b-et.width-et.left}return null}componentDidUpdate(){}render(){return this.props.children}}function PopChild({children:e,isPresent:i,anchorX:s,root:a}){var xt;const b=reactExports.useId(),et=reactExports.useRef(null),nt=reactExports.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=reactExports.useContext(MotionConfigContext),ct=((xt=e.props)==null?void 0:xt.ref)??(e==null?void 0:e.ref),pt=useComposedRefs(et,ct);return reactExports.useInsertionEffect(()=>{const{width:St,height:Et,top:Rt,left:Nt,right:It}=nt.current;if(i||!et.current||!St||!Et)return;const Gt=s==="left"?`left: ${Nt}`:`right: ${It}`;et.current.dataset.motionPopId=b;const Dt=document.createElement("style");c&&(Dt.nonce=c);const Bt=a??document.head;return Bt.appendChild(Dt),Dt.sheet&&Dt.sheet.insertRule(`
          [data-motion-pop-id="${b}"] {
            position: absolute !important;
            width: ${St}px !important;
            height: ${Et}px !important;
            ${Gt}px !important;
            top: ${Rt}px !important;
          }
        `),()=>{Bt.contains(Dt)&&Bt.removeChild(Dt)}},[i]),jsxRuntimeExports.jsx(PopChildMeasure,{isPresent:i,childRef:et,sizeRef:nt,children:reactExports.cloneElement(e,{ref:pt})})}const PresenceChild=({children:e,initial:i,isPresent:s,onExitComplete:a,custom:b,presenceAffectsLayout:et,mode:nt,anchorX:c,root:ct})=>{const pt=useConstant(newChildrenMap),xt=reactExports.useId();let St=!0,Et=reactExports.useMemo(()=>(St=!1,{id:xt,initial:i,isPresent:s,custom:b,onExitComplete:Rt=>{pt.set(Rt,!0);for(const Nt of pt.values())if(!Nt)return;a&&a()},register:Rt=>(pt.set(Rt,!1),()=>pt.delete(Rt))}),[s,pt,a]);return et&&St&&(Et={...Et}),reactExports.useMemo(()=>{pt.forEach((Rt,Nt)=>pt.set(Nt,!1))},[s]),reactExports.useEffect(()=>{!s&&!pt.size&&a&&a()},[s]),nt==="popLayout"&&(e=jsxRuntimeExports.jsx(PopChild,{isPresent:s,anchorX:c,root:ct,children:e})),jsxRuntimeExports.jsx(PresenceContext.Provider,{value:Et,children:e})};function newChildrenMap(){return new Map}function usePresence(e=!0){const i=reactExports.useContext(PresenceContext);if(i===null)return[!0,null];const{isPresent:s,onExitComplete:a,register:b}=i,et=reactExports.useId();reactExports.useEffect(()=>{if(e)return b(et)},[e]);const nt=reactExports.useCallback(()=>e&&a&&a(et),[et,a,e]);return!s&&a?[!1,nt]:[!0]}const getChildKey=e=>e.key||"";function onlyElements(e){const i=[];return reactExports.Children.forEach(e,s=>{reactExports.isValidElement(s)&&i.push(s)}),i}const AnimatePresence=({children:e,custom:i,initial:s=!0,onExitComplete:a,presenceAffectsLayout:b=!0,mode:et="sync",propagate:nt=!1,anchorX:c="left",root:ct})=>{const[pt,xt]=usePresence(nt),St=reactExports.useMemo(()=>onlyElements(e),[e]),Et=nt&&!pt?[]:St.map(getChildKey),Rt=reactExports.useRef(!0),Nt=reactExports.useRef(St),It=useConstant(()=>new Map),Gt=reactExports.useRef(new Set),[Dt,Bt]=reactExports.useState(St),[Lt,Vt]=reactExports.useState(St);useIsomorphicLayoutEffect$1(()=>{Rt.current=!1,Nt.current=St;for(let ur=0;ur<Lt.length;ur++){const _r=getChildKey(Lt[ur]);Et.includes(_r)?(It.delete(_r),Gt.current.delete(_r)):It.get(_r)!==!0&&It.set(_r,!1)}},[Lt,Et.length,Et.join("-")]);const Zt=[];if(St!==Dt){let ur=[...St];for(let _r=0;_r<Lt.length;_r++){const Ur=Lt[_r],ln=getChildKey(Ur);Et.includes(ln)||(ur.splice(_r,0,Ur),Zt.push(Ur))}return et==="wait"&&Zt.length&&(ur=Zt),Vt(onlyElements(ur)),Bt(St),null}const{forceRender:nr}=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:Lt.map(ur=>{const _r=getChildKey(ur),Ur=nt&&!pt?!1:St===Lt||Et.includes(_r),ln=()=>{if(Gt.current.has(_r))return;if(Gt.current.add(_r),It.has(_r))It.set(_r,!0);else return;let an=!0;It.forEach(Fr=>{Fr||(an=!1)}),an&&(nr==null||nr(),Vt(Nt.current),nt&&(xt==null||xt()),a&&a())};return jsxRuntimeExports.jsx(PresenceChild,{isPresent:Ur,initial:!Rt.current||s?void 0:!1,custom:i,presenceAffectsLayout:b,mode:et,root:ct,onExitComplete:Ur?void 0:ln,anchorX:c,children:ur},_r)})})},LazyContext=reactExports.createContext({strict:!1}),featureProps={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},featureDefinitions={};for(const e in featureProps)featureDefinitions[e]={isEnabled:i=>featureProps[e].some(s=>!!i[s])};function loadFeatures(e){for(const i in e)featureDefinitions[i]={...featureDefinitions[i],...e[i]}}const validMotionProps=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function isValidMotionProp(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||validMotionProps.has(e)}let shouldForward=e=>!isValidMotionProp(e);function loadExternalIsValidProp(e){typeof e=="function"&&(shouldForward=i=>i.startsWith("on")?!isValidMotionProp(i):e(i))}try{loadExternalIsValidProp(require("@emotion/is-prop-valid").default)}catch{}function filterProps(e,i,s){const a={};for(const b in e)b==="values"&&typeof e.values=="object"||(shouldForward(b)||s===!0&&isValidMotionProp(b)||!i&&!isValidMotionProp(b)||e.draggable&&b.startsWith("onDrag"))&&(a[b]=e[b]);return a}const MotionContext=reactExports.createContext({});function isAnimationControls(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function isVariantLabel(e){return typeof e=="string"||Array.isArray(e)}const variantPriorityOrder=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],variantProps=["initial",...variantPriorityOrder];function isControllingVariants(e){return isAnimationControls(e.animate)||variantProps.some(i=>isVariantLabel(e[i]))}function isVariantNode(e){return!!(isControllingVariants(e)||e.variants)}function getCurrentTreeVariants(e,i){if(isControllingVariants(e)){const{initial:s,animate:a}=e;return{initial:s===!1||isVariantLabel(s)?s:void 0,animate:isVariantLabel(a)?a:void 0}}return e.inherit!==!1?i:{}}function useCreateMotionContext(e){const{initial:i,animate:s}=getCurrentTreeVariants(e,reactExports.useContext(MotionContext));return reactExports.useMemo(()=>({initial:i,animate:s}),[variantLabelsAsDependency(i),variantLabelsAsDependency(s)])}function variantLabelsAsDependency(e){return Array.isArray(e)?e.join(" "):e}function pixelsToPercent(e,i){return i.max===i.min?0:e/(i.max-i.min)*100}const correctBorderRadius={correct:(e,i)=>{if(!i.target)return e;if(typeof e=="string")if(px.test(e))e=parseFloat(e);else return e;const s=pixelsToPercent(e,i.target.x),a=pixelsToPercent(e,i.target.y);return`${s}% ${a}%`}},correctBoxShadow={correct:(e,{treeScale:i,projectionDelta:s})=>{const a=e,b=complex.parse(e);if(b.length>5)return a;const et=complex.createTransformer(e),nt=typeof b[0]!="number"?1:0,c=s.x.scale*i.x,ct=s.y.scale*i.y;b[0+nt]/=c,b[1+nt]/=ct;const pt=mixNumber$1(c,ct,.5);return typeof b[2+nt]=="number"&&(b[2+nt]/=pt),typeof b[3+nt]=="number"&&(b[3+nt]/=pt),et(b)}},scaleCorrectors={borderRadius:{...correctBorderRadius,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:correctBorderRadius,borderTopRightRadius:correctBorderRadius,borderBottomLeftRadius:correctBorderRadius,borderBottomRightRadius:correctBorderRadius,boxShadow:correctBoxShadow};function isForcedMotionValue(e,{layout:i,layoutId:s}){return transformProps.has(e)||e.startsWith("origin")||(i||s!==void 0)&&(!!scaleCorrectors[e]||e==="opacity")}const translateAlias={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},numTransforms=transformPropOrder.length;function buildTransform(e,i,s){let a="",b=!0;for(let et=0;et<numTransforms;et++){const nt=transformPropOrder[et],c=e[nt];if(c===void 0)continue;let ct=!0;if(typeof c=="number"?ct=c===(nt.startsWith("scale")?1:0):ct=parseFloat(c)===0,!ct||s){const pt=getValueAsType(c,numberValueTypes[nt]);if(!ct){b=!1;const xt=translateAlias[nt]||nt;a+=`${xt}(${pt}) `}s&&(i[nt]=pt)}}return a=a.trim(),s?a=s(i,b?"":a):b&&(a="none"),a}function buildHTMLStyles(e,i,s){const{style:a,vars:b,transformOrigin:et}=e;let nt=!1,c=!1;for(const ct in i){const pt=i[ct];if(transformProps.has(ct)){nt=!0;continue}else if(isCSSVariableName(ct)){b[ct]=pt;continue}else{const xt=getValueAsType(pt,numberValueTypes[ct]);ct.startsWith("origin")?(c=!0,et[ct]=xt):a[ct]=xt}}if(i.transform||(nt||s?a.transform=buildTransform(i,e.transform,s):a.transform&&(a.transform="none")),c){const{originX:ct="50%",originY:pt="50%",originZ:xt=0}=et;a.transformOrigin=`${ct} ${pt} ${xt}`}}const createHtmlRenderState=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function copyRawValuesOnly(e,i,s){for(const a in i)!isMotionValue(i[a])&&!isForcedMotionValue(a,s)&&(e[a]=i[a])}function useInitialMotionValues({transformTemplate:e},i){return reactExports.useMemo(()=>{const s=createHtmlRenderState();return buildHTMLStyles(s,i,e),Object.assign({},s.vars,s.style)},[i])}function useStyle(e,i){const s=e.style||{},a={};return copyRawValuesOnly(a,s,e),Object.assign(a,useInitialMotionValues(e,i)),a}function useHTMLProps(e,i){const s={},a=useStyle(e,i);return e.drag&&e.dragListener!==!1&&(s.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(s.tabIndex=0),s.style=a,s}const dashKeys={offset:"stroke-dashoffset",array:"stroke-dasharray"},camelKeys={offset:"strokeDashoffset",array:"strokeDasharray"};function buildSVGPath(e,i,s=1,a=0,b=!0){e.pathLength=1;const et=b?dashKeys:camelKeys;e[et.offset]=px.transform(-a);const nt=px.transform(i),c=px.transform(s);e[et.array]=`${nt} ${c}`}const cssMotionPathProperties=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function buildSVGAttrs(e,{attrX:i,attrY:s,attrScale:a,pathLength:b,pathSpacing:et=1,pathOffset:nt=0,...c},ct,pt,xt){if(buildHTMLStyles(e,c,pt),ct){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:St,style:Et}=e;St.transform&&(Et.transform=St.transform,delete St.transform),(Et.transform||St.transformOrigin)&&(Et.transformOrigin=St.transformOrigin??"50% 50%",delete St.transformOrigin),Et.transform&&(Et.transformBox=(xt==null?void 0:xt.transformBox)??"fill-box",delete St.transformBox);for(const Rt of cssMotionPathProperties)St[Rt]!==void 0&&(Et[Rt]=St[Rt],delete St[Rt]);i!==void 0&&(St.x=i),s!==void 0&&(St.y=s),a!==void 0&&(St.scale=a),b!==void 0&&buildSVGPath(St,b,et,nt,!1)}const createSvgRenderState=()=>({...createHtmlRenderState(),attrs:{}}),isSVGTag=e=>typeof e=="string"&&e.toLowerCase()==="svg";function useSVGProps(e,i,s,a){const b=reactExports.useMemo(()=>{const et=createSvgRenderState();return buildSVGAttrs(et,i,isSVGTag(a),e.transformTemplate,e.style),{...et.attrs,style:{...et.style}}},[i]);if(e.style){const et={};copyRawValuesOnly(et,e.style,e),b.style={...et,...b.style}}return b}const lowercaseSVGElements=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function isSVGComponent(e){return typeof e!="string"||e.includes("-")?!1:!!(lowercaseSVGElements.indexOf(e)>-1||/[A-Z]/u.test(e))}function useRender(e,i,s,{latestValues:a},b,et=!1,nt){const ct=(nt??isSVGComponent(e)?useSVGProps:useHTMLProps)(i,a,b,e),pt=filterProps(i,typeof e=="string",et),xt=e!==reactExports.Fragment?{...pt,...ct,ref:s}:{},{children:St}=i,Et=reactExports.useMemo(()=>isMotionValue(St)?St.get():St,[St]);return reactExports.createElement(e,{...xt,children:Et})}function getValueState(e){const i=[{},{}];return e==null||e.values.forEach((s,a)=>{i[0][a]=s.get(),i[1][a]=s.getVelocity()}),i}function resolveVariantFromProps(e,i,s,a){if(typeof i=="function"){const[b,et]=getValueState(a);i=i(s!==void 0?s:e.custom,b,et)}if(typeof i=="string"&&(i=e.variants&&e.variants[i]),typeof i=="function"){const[b,et]=getValueState(a);i=i(s!==void 0?s:e.custom,b,et)}return i}function resolveMotionValue(e){return isMotionValue(e)?e.get():e}function makeState({scrapeMotionValuesFromProps:e,createRenderState:i},s,a,b){return{latestValues:makeLatestValues(s,a,b,e),renderState:i()}}function makeLatestValues(e,i,s,a){const b={},et=a(e,{});for(const Et in et)b[Et]=resolveMotionValue(et[Et]);let{initial:nt,animate:c}=e;const ct=isControllingVariants(e),pt=isVariantNode(e);i&&pt&&!ct&&e.inherit!==!1&&(nt===void 0&&(nt=i.initial),c===void 0&&(c=i.animate));let xt=s?s.initial===!1:!1;xt=xt||nt===!1;const St=xt?c:nt;if(St&&typeof St!="boolean"&&!isAnimationControls(St)){const Et=Array.isArray(St)?St:[St];for(let Rt=0;Rt<Et.length;Rt++){const Nt=resolveVariantFromProps(e,Et[Rt]);if(Nt){const{transitionEnd:It,transition:Gt,...Dt}=Nt;for(const Bt in Dt){let Lt=Dt[Bt];if(Array.isArray(Lt)){const Vt=xt?Lt.length-1:0;Lt=Lt[Vt]}Lt!==null&&(b[Bt]=Lt)}for(const Bt in It)b[Bt]=It[Bt]}}}return b}const makeUseVisualState=e=>(i,s)=>{const a=reactExports.useContext(MotionContext),b=reactExports.useContext(PresenceContext),et=()=>makeState(e,i,a,b);return s?et():useConstant(et)};function scrapeMotionValuesFromProps$1(e,i,s){var et;const{style:a}=e,b={};for(const nt in a)(isMotionValue(a[nt])||i.style&&isMotionValue(i.style[nt])||isForcedMotionValue(nt,e)||((et=s==null?void 0:s.getValue(nt))==null?void 0:et.liveStyle)!==void 0)&&(b[nt]=a[nt]);return b}const useHTMLVisualState=makeUseVisualState({scrapeMotionValuesFromProps:scrapeMotionValuesFromProps$1,createRenderState:createHtmlRenderState});function scrapeMotionValuesFromProps(e,i,s){const a=scrapeMotionValuesFromProps$1(e,i,s);for(const b in e)if(isMotionValue(e[b])||isMotionValue(i[b])){const et=transformPropOrder.indexOf(b)!==-1?"attr"+b.charAt(0).toUpperCase()+b.substring(1):b;a[et]=e[b]}return a}const useSVGVisualState=makeUseVisualState({scrapeMotionValuesFromProps,createRenderState:createSvgRenderState}),motionComponentSymbol=Symbol.for("motionComponentSymbol");function isRefObject(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function setRef(e,i){if(typeof e=="function")return e(i);isRefObject(e)&&(e.current=i)}function useMotionRef(e,i,s){const a=reactExports.useRef(null);return reactExports.useCallback(b=>{if(b&&e.onMount&&e.onMount(b),i&&(b?i.mount(b):i.unmount()),s)if(b){const et=setRef(s,b);typeof et=="function"&&(a.current=et)}else a.current?(a.current(),a.current=null):setRef(s,b)},[i,e,s])}const camelToDash=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),optimizedAppearDataId="framerAppearId",optimizedAppearDataAttribute="data-"+camelToDash(optimizedAppearDataId),SwitchLayoutGroupContext=reactExports.createContext({});function useVisualElement(e,i,s,a,b,et){var Gt,Dt;const{visualElement:nt}=reactExports.useContext(MotionContext),c=reactExports.useContext(LazyContext),ct=reactExports.useContext(PresenceContext),pt=reactExports.useContext(MotionConfigContext).reducedMotion,xt=reactExports.useRef(null);a=a||c.renderer,!xt.current&&a&&(xt.current=a(e,{visualState:i,parent:nt,props:s,presenceContext:ct,blockInitialAnimation:ct?ct.initial===!1:!1,reducedMotionConfig:pt,isSVG:et}));const St=xt.current,Et=reactExports.useContext(SwitchLayoutGroupContext);St&&!St.projection&&b&&(St.type==="html"||St.type==="svg")&&createProjectionNode$1(xt.current,s,b,Et);const Rt=reactExports.useRef(!1);reactExports.useInsertionEffect(()=>{St&&Rt.current&&St.update(s,ct)});const Nt=s[optimizedAppearDataAttribute],It=reactExports.useRef(!!Nt&&!((Gt=window.MotionHandoffIsComplete)!=null&&Gt.call(window,Nt))&&((Dt=window.MotionHasOptimisedAnimation)==null?void 0:Dt.call(window,Nt)));return useIsomorphicLayoutEffect$1(()=>{St&&(Rt.current=!0,window.MotionIsMounted=!0,St.updateFeatures(),St.scheduleRenderMicrotask(),It.current&&St.animationState&&St.animationState.animateChanges())}),reactExports.useEffect(()=>{St&&(!It.current&&St.animationState&&St.animationState.animateChanges(),It.current&&(queueMicrotask(()=>{var Bt;(Bt=window.MotionHandoffMarkAsComplete)==null||Bt.call(window,Nt)}),It.current=!1),St.enteringChildren=void 0)}),St}function createProjectionNode$1(e,i,s,a){const{layoutId:b,layout:et,drag:nt,dragConstraints:c,layoutScroll:ct,layoutRoot:pt,layoutCrossfade:xt}=i;e.projection=new s(e.latestValues,i["data-framer-portal-id"]?void 0:getClosestProjectingNode(e.parent)),e.projection.setOptions({layoutId:b,layout:et,alwaysMeasureLayout:!!nt||c&&isRefObject(c),visualElement:e,animationType:typeof et=="string"?et:"both",initialPromotionConfig:a,crossfade:xt,layoutScroll:ct,layoutRoot:pt})}function getClosestProjectingNode(e){if(e)return e.options.allowProjection!==!1?e.projection:getClosestProjectingNode(e.parent)}function createMotionComponent(e,{forwardMotionProps:i=!1,type:s}={},a,b){a&&loadFeatures(a);const et=s?s==="svg":isSVGComponent(e),nt=et?useSVGVisualState:useHTMLVisualState;function c(pt,xt){let St;const Et={...reactExports.useContext(MotionConfigContext),...pt,layoutId:useLayoutId(pt)},{isStatic:Rt}=Et,Nt=useCreateMotionContext(pt),It=nt(pt,Rt);if(!Rt&&isBrowser){useStrictMode();const Gt=getProjectionFunctionality(Et);St=Gt.MeasureLayout,Nt.visualElement=useVisualElement(e,It,Et,b,Gt.ProjectionNode,et)}return jsxRuntimeExports.jsxs(MotionContext.Provider,{value:Nt,children:[St&&Nt.visualElement?jsxRuntimeExports.jsx(St,{visualElement:Nt.visualElement,...Et}):null,useRender(e,pt,useMotionRef(It,Nt.visualElement,xt),It,Rt,i,et)]})}c.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const ct=reactExports.forwardRef(c);return ct[motionComponentSymbol]=e,ct}function useLayoutId({layoutId:e}){const i=reactExports.useContext(LayoutGroupContext).id;return i&&e!==void 0?i+"-"+e:e}function useStrictMode(e,i){reactExports.useContext(LazyContext).strict}function getProjectionFunctionality(e){const{drag:i,layout:s}=featureDefinitions;if(!i&&!s)return{};const a={...i,...s};return{MeasureLayout:i!=null&&i.isEnabled(e)||s!=null&&s.isEnabled(e)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}function createMotionProxy(e,i){if(typeof Proxy>"u")return createMotionComponent;const s=new Map,a=(et,nt)=>createMotionComponent(et,nt,e,i),b=(et,nt)=>a(et,nt);return new Proxy(b,{get:(et,nt)=>nt==="create"?a:(s.has(nt)||s.set(nt,createMotionComponent(nt,void 0,e,i)),s.get(nt))})}function convertBoundingBoxToBox({top:e,left:i,right:s,bottom:a}){return{x:{min:i,max:s},y:{min:e,max:a}}}function convertBoxToBoundingBox({x:e,y:i}){return{top:i.min,right:e.max,bottom:i.max,left:e.min}}function transformBoxPoints(e,i){if(!i)return e;const s=i({x:e.left,y:e.top}),a=i({x:e.right,y:e.bottom});return{top:s.y,left:s.x,bottom:a.y,right:a.x}}function isIdentityScale(e){return e===void 0||e===1}function hasScale({scale:e,scaleX:i,scaleY:s}){return!isIdentityScale(e)||!isIdentityScale(i)||!isIdentityScale(s)}function hasTransform(e){return hasScale(e)||has2DTranslate(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function has2DTranslate(e){return is2DTranslate(e.x)||is2DTranslate(e.y)}function is2DTranslate(e){return e&&e!=="0%"}function scalePoint(e,i,s){const a=e-s,b=i*a;return s+b}function applyPointDelta(e,i,s,a,b){return b!==void 0&&(e=scalePoint(e,b,a)),scalePoint(e,s,a)+i}function applyAxisDelta(e,i=0,s=1,a,b){e.min=applyPointDelta(e.min,i,s,a,b),e.max=applyPointDelta(e.max,i,s,a,b)}function applyBoxDelta(e,{x:i,y:s}){applyAxisDelta(e.x,i.translate,i.scale,i.originPoint),applyAxisDelta(e.y,s.translate,s.scale,s.originPoint)}const TREE_SCALE_SNAP_MIN=.999999999999,TREE_SCALE_SNAP_MAX=1.0000000000001;function applyTreeDeltas(e,i,s,a=!1){const b=s.length;if(!b)return;i.x=i.y=1;let et,nt;for(let c=0;c<b;c++){et=s[c],nt=et.projectionDelta;const{visualElement:ct}=et.options;ct&&ct.props.style&&ct.props.style.display==="contents"||(a&&et.options.layoutScroll&&et.scroll&&et!==et.root&&transformBox(e,{x:-et.scroll.offset.x,y:-et.scroll.offset.y}),nt&&(i.x*=nt.x.scale,i.y*=nt.y.scale,applyBoxDelta(e,nt)),a&&hasTransform(et.latestValues)&&transformBox(e,et.latestValues))}i.x<TREE_SCALE_SNAP_MAX&&i.x>TREE_SCALE_SNAP_MIN&&(i.x=1),i.y<TREE_SCALE_SNAP_MAX&&i.y>TREE_SCALE_SNAP_MIN&&(i.y=1)}function translateAxis(e,i){e.min=e.min+i,e.max=e.max+i}function transformAxis(e,i,s,a,b=.5){const et=mixNumber$1(e.min,e.max,b);applyAxisDelta(e,i,s,et,a)}function transformBox(e,i){transformAxis(e.x,i.x,i.scaleX,i.scale,i.originX),transformAxis(e.y,i.y,i.scaleY,i.scale,i.originY)}function measureViewportBox(e,i){return convertBoundingBoxToBox(transformBoxPoints(e.getBoundingClientRect(),i))}function measurePageBox(e,i,s){const a=measureViewportBox(e,s),{scroll:b}=i;return b&&(translateAxis(a.x,b.offset.x),translateAxis(a.y,b.offset.y)),a}const createAxisDelta=()=>({translate:0,scale:1,origin:0,originPoint:0}),createDelta=()=>({x:createAxisDelta(),y:createAxisDelta()}),createAxis=()=>({min:0,max:0}),createBox=()=>({x:createAxis(),y:createAxis()}),prefersReducedMotion={current:null},hasReducedMotionListener={current:!1};function initPrefersReducedMotion(){if(hasReducedMotionListener.current=!0,!!isBrowser)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),i=()=>prefersReducedMotion.current=e.matches;e.addEventListener("change",i),i()}else prefersReducedMotion.current=!1}const visualElementStore=new WeakMap;function updateMotionValuesFromProps(e,i,s){for(const a in i){const b=i[a],et=s[a];if(isMotionValue(b))e.addValue(a,b);else if(isMotionValue(et))e.addValue(a,motionValue(b,{owner:e}));else if(et!==b)if(e.hasValue(a)){const nt=e.getValue(a);nt.liveStyle===!0?nt.jump(b):nt.hasAnimated||nt.set(b)}else{const nt=e.getStaticValue(a);e.addValue(a,motionValue(nt!==void 0?nt:b,{owner:e}))}}for(const a in s)i[a]===void 0&&e.removeValue(a);return i}const propEventHandlers=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class VisualElement{scrapeMotionValuesFromProps(i,s,a){return{}}constructor({parent:i,props:s,presenceContext:a,reducedMotionConfig:b,blockInitialAnimation:et,visualState:nt},c={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=KeyframeResolver,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const Et=time.now();this.renderScheduledAt<Et&&(this.renderScheduledAt=Et,frame.render(this.render,!1,!0))};const{latestValues:ct,renderState:pt}=nt;this.latestValues=ct,this.baseTarget={...ct},this.initialValues=s.initial?{...ct}:{},this.renderState=pt,this.parent=i,this.props=s,this.presenceContext=a,this.depth=i?i.depth+1:0,this.reducedMotionConfig=b,this.options=c,this.blockInitialAnimation=!!et,this.isControllingVariants=isControllingVariants(s),this.isVariantNode=isVariantNode(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(i&&i.current);const{willChange:xt,...St}=this.scrapeMotionValuesFromProps(s,{},this);for(const Et in St){const Rt=St[Et];ct[Et]!==void 0&&isMotionValue(Rt)&&Rt.set(ct[Et])}}mount(i){var s;this.current=i,visualElementStore.set(i,this),this.projection&&!this.projection.instance&&this.projection.mount(i),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((a,b)=>this.bindToMotionValue(b,a)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(hasReducedMotionListener.current||initPrefersReducedMotion(),this.shouldReduceMotion=prefersReducedMotion.current),(s=this.parent)==null||s.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var i;this.projection&&this.projection.unmount(),cancelFrame(this.notifyUpdate),cancelFrame(this.render),this.valueSubscriptions.forEach(s=>s()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(i=this.parent)==null||i.removeChild(this);for(const s in this.events)this.events[s].clear();for(const s in this.features){const a=this.features[s];a&&(a.unmount(),a.isMounted=!1)}this.current=null}addChild(i){this.children.add(i),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(i)}removeChild(i){this.children.delete(i),this.enteringChildren&&this.enteringChildren.delete(i)}bindToMotionValue(i,s){this.valueSubscriptions.has(i)&&this.valueSubscriptions.get(i)();const a=transformProps.has(i);a&&this.onBindTransform&&this.onBindTransform();const b=s.on("change",nt=>{this.latestValues[i]=nt,this.props.onUpdate&&frame.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let et;window.MotionCheckAppearSync&&(et=window.MotionCheckAppearSync(this,i,s)),this.valueSubscriptions.set(i,()=>{b(),et&&et(),s.owner&&s.stop()})}sortNodePosition(i){return!this.current||!this.sortInstanceNodePosition||this.type!==i.type?0:this.sortInstanceNodePosition(this.current,i.current)}updateFeatures(){let i="animation";for(i in featureDefinitions){const s=featureDefinitions[i];if(!s)continue;const{isEnabled:a,Feature:b}=s;if(!this.features[i]&&b&&a(this.props)&&(this.features[i]=new b(this)),this.features[i]){const et=this.features[i];et.isMounted?et.update():(et.mount(),et.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):createBox()}getStaticValue(i){return this.latestValues[i]}setStaticValue(i,s){this.latestValues[i]=s}update(i,s){(i.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=i,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let a=0;a<propEventHandlers.length;a++){const b=propEventHandlers[a];this.propEventSubscriptions[b]&&(this.propEventSubscriptions[b](),delete this.propEventSubscriptions[b]);const et="on"+b,nt=i[et];nt&&(this.propEventSubscriptions[b]=this.on(b,nt))}this.prevMotionValues=updateMotionValuesFromProps(this,this.scrapeMotionValuesFromProps(i,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(i){return this.props.variants?this.props.variants[i]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(i){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(i),()=>s.variantChildren.delete(i)}addValue(i,s){const a=this.values.get(i);s!==a&&(a&&this.removeValue(i),this.bindToMotionValue(i,s),this.values.set(i,s),this.latestValues[i]=s.get())}removeValue(i){this.values.delete(i);const s=this.valueSubscriptions.get(i);s&&(s(),this.valueSubscriptions.delete(i)),delete this.latestValues[i],this.removeValueFromRenderState(i,this.renderState)}hasValue(i){return this.values.has(i)}getValue(i,s){if(this.props.values&&this.props.values[i])return this.props.values[i];let a=this.values.get(i);return a===void 0&&s!==void 0&&(a=motionValue(s===null?void 0:s,{owner:this}),this.addValue(i,a)),a}readValue(i,s){let a=this.latestValues[i]!==void 0||!this.current?this.latestValues[i]:this.getBaseTargetFromProps(this.props,i)??this.readValueFromInstance(this.current,i,this.options);return a!=null&&(typeof a=="string"&&(isNumericalString(a)||isZeroValueString(a))?a=parseFloat(a):!findValueType(a)&&complex.test(s)&&(a=getAnimatableNone(i,s)),this.setBaseTarget(i,isMotionValue(a)?a.get():a)),isMotionValue(a)?a.get():a}setBaseTarget(i,s){this.baseTarget[i]=s}getBaseTarget(i){var et;const{initial:s}=this.props;let a;if(typeof s=="string"||typeof s=="object"){const nt=resolveVariantFromProps(this.props,s,(et=this.presenceContext)==null?void 0:et.custom);nt&&(a=nt[i])}if(s&&a!==void 0)return a;const b=this.getBaseTargetFromProps(this.props,i);return b!==void 0&&!isMotionValue(b)?b:this.initialValues[i]!==void 0&&a===void 0?void 0:this.baseTarget[i]}on(i,s){return this.events[i]||(this.events[i]=new SubscriptionManager),this.events[i].add(s)}notify(i,...s){this.events[i]&&this.events[i].notify(...s)}scheduleRenderMicrotask(){microtask.render(this.render)}}class DOMVisualElement extends VisualElement{constructor(){super(...arguments),this.KeyframeResolver=DOMKeyframesResolver}sortInstanceNodePosition(i,s){return i.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(i,s){return i.style?i.style[s]:void 0}removeValueFromRenderState(i,{vars:s,style:a}){delete s[i],delete a[i]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:i}=this.props;isMotionValue(i)&&(this.childSubscription=i.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function renderHTML(e,{style:i,vars:s},a,b){const et=e.style;let nt;for(nt in i)et[nt]=i[nt];b==null||b.applyProjectionStyles(et,a);for(nt in s)et.setProperty(nt,s[nt])}function getComputedStyle$1(e){return window.getComputedStyle(e)}class HTMLVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="html",this.renderInstance=renderHTML}readValueFromInstance(i,s){var a;if(transformProps.has(s))return(a=this.projection)!=null&&a.isProjecting?defaultTransformValue(s):readTransformValue(i,s);{const b=getComputedStyle$1(i),et=(isCSSVariableName(s)?b.getPropertyValue(s):b[s])||0;return typeof et=="string"?et.trim():et}}measureInstanceViewportBox(i,{transformPagePoint:s}){return measureViewportBox(i,s)}build(i,s,a){buildHTMLStyles(i,s,a.transformTemplate)}scrapeMotionValuesFromProps(i,s,a){return scrapeMotionValuesFromProps$1(i,s,a)}}const camelCaseAttributes=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function renderSVG(e,i,s,a){renderHTML(e,i,void 0,a);for(const b in i.attrs)e.setAttribute(camelCaseAttributes.has(b)?b:camelToDash(b),i.attrs[b])}class SVGVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=createBox}getBaseTargetFromProps(i,s){return i[s]}readValueFromInstance(i,s){if(transformProps.has(s)){const a=getDefaultValueType(s);return a&&a.default||0}return s=camelCaseAttributes.has(s)?s:camelToDash(s),i.getAttribute(s)}scrapeMotionValuesFromProps(i,s,a){return scrapeMotionValuesFromProps(i,s,a)}build(i,s,a){buildSVGAttrs(i,s,this.isSVGTag,a.transformTemplate,a.style)}renderInstance(i,s,a,b){renderSVG(i,s,a,b)}mount(i){this.isSVGTag=isSVGTag(i.tagName),super.mount(i)}}const createDomVisualElement=(e,i)=>i.isSVG??isSVGComponent(e)?new SVGVisualElement(i):new HTMLVisualElement(i,{allowProjection:e!==reactExports.Fragment});function resolveVariant(e,i,s){const a=e.getProps();return resolveVariantFromProps(a,i,s!==void 0?s:a.custom,e)}const isKeyframesTarget=e=>Array.isArray(e);function setMotionValue(e,i,s){e.hasValue(i)?e.getValue(i).set(s):e.addValue(i,motionValue(s))}function resolveFinalValueInKeyframes(e){return isKeyframesTarget(e)?e[e.length-1]||0:e}function setTarget(e,i){const s=resolveVariant(e,i);let{transitionEnd:a={},transition:b={},...et}=s||{};et={...et,...a};for(const nt in et){const c=resolveFinalValueInKeyframes(et[nt]);setMotionValue(e,nt,c)}}function isWillChangeMotionValue(e){return!!(isMotionValue(e)&&e.add)}function addValueToWillChange(e,i){const s=e.getValue("willChange");if(isWillChangeMotionValue(s))return s.add(i);if(!s&&MotionGlobalConfig.WillChange){const a=new MotionGlobalConfig.WillChange("auto");e.addValue("willChange",a),a.add(i)}}function getOptimisedAppearId(e){return e.props[optimizedAppearDataAttribute]}const isNotNull=e=>e!==null;function getFinalKeyframe(e,{repeat:i,repeatType:s="loop"},a){const b=e.filter(isNotNull),et=i&&s!=="loop"&&i%2===1?0:b.length-1;return!et||a===void 0?b[et]:a}const underDampedSpring={type:"spring",stiffness:500,damping:25,restSpeed:10},criticallyDampedSpring=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),keyframesTransition={type:"keyframes",duration:.8},ease={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},getDefaultTransition=(e,{keyframes:i})=>i.length>2?keyframesTransition:transformProps.has(e)?e.startsWith("scale")?criticallyDampedSpring(i[1]):underDampedSpring:ease;function isTransitionDefined({when:e,delay:i,delayChildren:s,staggerChildren:a,staggerDirection:b,repeat:et,repeatType:nt,repeatDelay:c,from:ct,elapsed:pt,...xt}){return!!Object.keys(xt).length}const animateMotionValue=(e,i,s,a={},b,et)=>nt=>{const c=getValueTransition(a,e)||{},ct=c.delay||a.delay||0;let{elapsed:pt=0}=a;pt=pt-secondsToMilliseconds(ct);const xt={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:i.getVelocity(),...c,delay:-pt,onUpdate:Et=>{i.set(Et),c.onUpdate&&c.onUpdate(Et)},onComplete:()=>{nt(),c.onComplete&&c.onComplete()},name:e,motionValue:i,element:et?void 0:b};isTransitionDefined(c)||Object.assign(xt,getDefaultTransition(e,xt)),xt.duration&&(xt.duration=secondsToMilliseconds(xt.duration)),xt.repeatDelay&&(xt.repeatDelay=secondsToMilliseconds(xt.repeatDelay)),xt.from!==void 0&&(xt.keyframes[0]=xt.from);let St=!1;if((xt.type===!1||xt.duration===0&&!xt.repeatDelay)&&(makeAnimationInstant(xt),xt.delay===0&&(St=!0)),(MotionGlobalConfig.instantAnimations||MotionGlobalConfig.skipAnimations)&&(St=!0,makeAnimationInstant(xt),xt.delay=0),xt.allowFlatten=!c.type&&!c.ease,St&&!et&&i.get()!==void 0){const Et=getFinalKeyframe(xt.keyframes,c);if(Et!==void 0){frame.update(()=>{xt.onUpdate(Et),xt.onComplete()});return}}return c.isSync?new JSAnimation(xt):new AsyncMotionValueAnimation(xt)};function shouldBlockAnimation({protectedKeys:e,needsAnimating:i},s){const a=e.hasOwnProperty(s)&&i[s]!==!0;return i[s]=!1,a}function animateTarget(e,i,{delay:s=0,transitionOverride:a,type:b}={}){let{transition:et=e.getDefaultTransition(),transitionEnd:nt,...c}=i;a&&(et=a);const ct=[],pt=b&&e.animationState&&e.animationState.getState()[b];for(const xt in c){const St=e.getValue(xt,e.latestValues[xt]??null),Et=c[xt];if(Et===void 0||pt&&shouldBlockAnimation(pt,xt))continue;const Rt={delay:s,...getValueTransition(et||{},xt)},Nt=St.get();if(Nt!==void 0&&!St.isAnimating&&!Array.isArray(Et)&&Et===Nt&&!Rt.velocity)continue;let It=!1;if(window.MotionHandoffAnimation){const Dt=getOptimisedAppearId(e);if(Dt){const Bt=window.MotionHandoffAnimation(Dt,xt,frame);Bt!==null&&(Rt.startTime=Bt,It=!0)}}addValueToWillChange(e,xt),St.start(animateMotionValue(xt,St,Et,e.shouldReduceMotion&&positionalKeys.has(xt)?{type:!1}:Rt,e,It));const Gt=St.animation;Gt&&ct.push(Gt)}return nt&&Promise.all(ct).then(()=>{frame.update(()=>{nt&&setTarget(e,nt)})}),ct}function calcChildStagger(e,i,s,a=0,b=1){const et=Array.from(e).sort((pt,xt)=>pt.sortNodePosition(xt)).indexOf(i),nt=e.size,c=(nt-1)*a;return typeof s=="function"?s(et,nt):b===1?et*a:c-et*a}function animateVariant(e,i,s={}){var ct;const a=resolveVariant(e,i,s.type==="exit"?(ct=e.presenceContext)==null?void 0:ct.custom:void 0);let{transition:b=e.getDefaultTransition()||{}}=a||{};s.transitionOverride&&(b=s.transitionOverride);const et=a?()=>Promise.all(animateTarget(e,a,s)):()=>Promise.resolve(),nt=e.variantChildren&&e.variantChildren.size?(pt=0)=>{const{delayChildren:xt=0,staggerChildren:St,staggerDirection:Et}=b;return animateChildren(e,i,pt,xt,St,Et,s)}:()=>Promise.resolve(),{when:c}=b;if(c){const[pt,xt]=c==="beforeChildren"?[et,nt]:[nt,et];return pt().then(()=>xt())}else return Promise.all([et(),nt(s.delay)])}function animateChildren(e,i,s=0,a=0,b=0,et=1,nt){const c=[];for(const ct of e.variantChildren)ct.notify("AnimationStart",i),c.push(animateVariant(ct,i,{...nt,delay:s+(typeof a=="function"?0:a)+calcChildStagger(e.variantChildren,ct,a,b,et)}).then(()=>ct.notify("AnimationComplete",i)));return Promise.all(c)}function animateVisualElement(e,i,s={}){e.notify("AnimationStart",i);let a;if(Array.isArray(i)){const b=i.map(et=>animateVariant(e,et,s));a=Promise.all(b)}else if(typeof i=="string")a=animateVariant(e,i,s);else{const b=typeof i=="function"?resolveVariant(e,i,s.custom):i;a=Promise.all(animateTarget(e,b,s))}return a.then(()=>{e.notify("AnimationComplete",i)})}function shallowCompare(e,i){if(!Array.isArray(i))return!1;const s=i.length;if(s!==e.length)return!1;for(let a=0;a<s;a++)if(i[a]!==e[a])return!1;return!0}const numVariantProps=variantProps.length;function getVariantContext(e){if(!e)return;if(!e.isControllingVariants){const s=e.parent?getVariantContext(e.parent)||{}:{};return e.props.initial!==void 0&&(s.initial=e.props.initial),s}const i={};for(let s=0;s<numVariantProps;s++){const a=variantProps[s],b=e.props[a];(isVariantLabel(b)||b===!1)&&(i[a]=b)}return i}const reversePriorityOrder=[...variantPriorityOrder].reverse(),numAnimationTypes=variantPriorityOrder.length;function animateList(e){return i=>Promise.all(i.map(({animation:s,options:a})=>animateVisualElement(e,s,a)))}function createAnimationState(e){let i=animateList(e),s=createState(),a=!0;const b=ct=>(pt,xt)=>{var Et;const St=resolveVariant(e,xt,ct==="exit"?(Et=e.presenceContext)==null?void 0:Et.custom:void 0);if(St){const{transition:Rt,transitionEnd:Nt,...It}=St;pt={...pt,...It,...Nt}}return pt};function et(ct){i=ct(e)}function nt(ct){const{props:pt}=e,xt=getVariantContext(e.parent)||{},St=[],Et=new Set;let Rt={},Nt=1/0;for(let Gt=0;Gt<numAnimationTypes;Gt++){const Dt=reversePriorityOrder[Gt],Bt=s[Dt],Lt=pt[Dt]!==void 0?pt[Dt]:xt[Dt],Vt=isVariantLabel(Lt),Zt=Dt===ct?Bt.isActive:null;Zt===!1&&(Nt=Gt);let nr=Lt===xt[Dt]&&Lt!==pt[Dt]&&Vt;if(nr&&a&&e.manuallyAnimateOnMount&&(nr=!1),Bt.protectedKeys={...Rt},!Bt.isActive&&Zt===null||!Lt&&!Bt.prevProp||isAnimationControls(Lt)||typeof Lt=="boolean")continue;const ur=checkVariantsDidChange(Bt.prevProp,Lt);let _r=ur||Dt===ct&&Bt.isActive&&!nr&&Vt||Gt>Nt&&Vt,Ur=!1;const ln=Array.isArray(Lt)?Lt:[Lt];let an=ln.reduce(b(Dt),{});Zt===!1&&(an={});const{prevResolvedValues:Fr={}}=Bt,rn={...Fr,...an},gn=gr=>{_r=!0,Et.has(gr)&&(Ur=!0,Et.delete(gr)),Bt.needsAnimating[gr]=!0;const rr=e.getValue(gr);rr&&(rr.liveStyle=!1)};for(const gr in rn){const rr=an[gr],cr=Fr[gr];if(Rt.hasOwnProperty(gr))continue;let Hr=!1;isKeyframesTarget(rr)&&isKeyframesTarget(cr)?Hr=!shallowCompare(rr,cr):Hr=rr!==cr,Hr?rr!=null?gn(gr):Et.add(gr):rr!==void 0&&Et.has(gr)?gn(gr):Bt.protectedKeys[gr]=!0}Bt.prevProp=Lt,Bt.prevResolvedValues=an,Bt.isActive&&(Rt={...Rt,...an}),a&&e.blockInitialAnimation&&(_r=!1);const _i=nr&&ur;_r&&(!_i||Ur)&&St.push(...ln.map(gr=>{const rr={type:Dt};if(typeof gr=="string"&&a&&!_i&&e.manuallyAnimateOnMount&&e.parent){const{parent:cr}=e,Hr=resolveVariant(cr,gr);if(cr.enteringChildren&&Hr){const{delayChildren:$r}=Hr.transition||{};rr.delay=calcChildStagger(cr.enteringChildren,e,$r)}}return{animation:gr,options:rr}}))}if(Et.size){const Gt={};if(typeof pt.initial!="boolean"){const Dt=resolveVariant(e,Array.isArray(pt.initial)?pt.initial[0]:pt.initial);Dt&&Dt.transition&&(Gt.transition=Dt.transition)}Et.forEach(Dt=>{const Bt=e.getBaseTarget(Dt),Lt=e.getValue(Dt);Lt&&(Lt.liveStyle=!0),Gt[Dt]=Bt??null}),St.push({animation:Gt})}let It=!!St.length;return a&&(pt.initial===!1||pt.initial===pt.animate)&&!e.manuallyAnimateOnMount&&(It=!1),a=!1,It?i(St):Promise.resolve()}function c(ct,pt){var St;if(s[ct].isActive===pt)return Promise.resolve();(St=e.variantChildren)==null||St.forEach(Et=>{var Rt;return(Rt=Et.animationState)==null?void 0:Rt.setActive(ct,pt)}),s[ct].isActive=pt;const xt=nt(ct);for(const Et in s)s[Et].protectedKeys={};return xt}return{animateChanges:nt,setActive:c,setAnimateFunction:et,getState:()=>s,reset:()=>{s=createState()}}}function checkVariantsDidChange(e,i){return typeof i=="string"?i!==e:Array.isArray(i)?!shallowCompare(i,e):!1}function createTypeState(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function createState(){return{animate:createTypeState(!0),whileInView:createTypeState(),whileHover:createTypeState(),whileTap:createTypeState(),whileDrag:createTypeState(),whileFocus:createTypeState(),exit:createTypeState()}}let Feature$1=class{constructor(i){this.isMounted=!1,this.node=i}update(){}};class AnimationFeature extends Feature$1{constructor(i){super(i),i.animationState||(i.animationState=createAnimationState(i))}updateAnimationControlsSubscription(){const{animate:i}=this.node.getProps();isAnimationControls(i)&&(this.unmountControls=i.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:i}=this.node.getProps(),{animate:s}=this.node.prevProps||{};i!==s&&this.updateAnimationControlsSubscription()}unmount(){var i;this.node.animationState.reset(),(i=this.unmountControls)==null||i.call(this)}}let id$1=0;class ExitAnimationFeature extends Feature$1{constructor(){super(...arguments),this.id=id$1++}update(){if(!this.node.presenceContext)return;const{isPresent:i,onExitComplete:s}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||i===a)return;const b=this.node.animationState.setActive("exit",!i);s&&!i&&b.then(()=>{s(this.id)})}mount(){const{register:i,onExitComplete:s}=this.node.presenceContext||{};s&&s(this.id),i&&(this.unmount=i(this.id))}unmount(){}}const animations={animation:{Feature:AnimationFeature},exit:{Feature:ExitAnimationFeature}};function addDomEvent(e,i,s,a={passive:!0}){return e.addEventListener(i,s,a),()=>e.removeEventListener(i,s)}function extractEventInfo(e){return{point:{x:e.pageX,y:e.pageY}}}const addPointerInfo=e=>i=>isPrimaryPointer(i)&&e(i,extractEventInfo(i));function addPointerEvent(e,i,s,a){return addDomEvent(e,i,addPointerInfo(s),a)}const SCALE_PRECISION=1e-4,SCALE_MIN=1-SCALE_PRECISION,SCALE_MAX=1+SCALE_PRECISION,TRANSLATE_PRECISION=.01,TRANSLATE_MIN=0-TRANSLATE_PRECISION,TRANSLATE_MAX=0+TRANSLATE_PRECISION;function calcLength(e){return e.max-e.min}function isNear(e,i,s){return Math.abs(e-i)<=s}function calcAxisDelta(e,i,s,a=.5){e.origin=a,e.originPoint=mixNumber$1(i.min,i.max,e.origin),e.scale=calcLength(s)/calcLength(i),e.translate=mixNumber$1(s.min,s.max,e.origin)-e.originPoint,(e.scale>=SCALE_MIN&&e.scale<=SCALE_MAX||isNaN(e.scale))&&(e.scale=1),(e.translate>=TRANSLATE_MIN&&e.translate<=TRANSLATE_MAX||isNaN(e.translate))&&(e.translate=0)}function calcBoxDelta(e,i,s,a){calcAxisDelta(e.x,i.x,s.x,a?a.originX:void 0),calcAxisDelta(e.y,i.y,s.y,a?a.originY:void 0)}function calcRelativeAxis(e,i,s){e.min=s.min+i.min,e.max=e.min+calcLength(i)}function calcRelativeBox(e,i,s){calcRelativeAxis(e.x,i.x,s.x),calcRelativeAxis(e.y,i.y,s.y)}function calcRelativeAxisPosition(e,i,s){e.min=i.min-s.min,e.max=e.min+calcLength(i)}function calcRelativePosition(e,i,s){calcRelativeAxisPosition(e.x,i.x,s.x),calcRelativeAxisPosition(e.y,i.y,s.y)}function eachAxis(e){return[e("x"),e("y")]}const getContextWindow=({current:e})=>e?e.ownerDocument.defaultView:null,distance=(e,i)=>Math.abs(e-i);function distance2D(e,i){const s=distance(e.x,i.x),a=distance(e.y,i.y);return Math.sqrt(s**2+a**2)}class PanSession{constructor(i,s,{transformPagePoint:a,contextWindow:b=window,dragSnapToOrigin:et=!1,distanceThreshold:nt=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Et=getPanInfo(this.lastMoveEventInfo,this.history),Rt=this.startEvent!==null,Nt=distance2D(Et.offset,{x:0,y:0})>=this.distanceThreshold;if(!Rt&&!Nt)return;const{point:It}=Et,{timestamp:Gt}=frameData;this.history.push({...It,timestamp:Gt});const{onStart:Dt,onMove:Bt}=this.handlers;Rt||(Dt&&Dt(this.lastMoveEvent,Et),this.startEvent=this.lastMoveEvent),Bt&&Bt(this.lastMoveEvent,Et)},this.handlePointerMove=(Et,Rt)=>{this.lastMoveEvent=Et,this.lastMoveEventInfo=transformPoint(Rt,this.transformPagePoint),frame.update(this.updatePoint,!0)},this.handlePointerUp=(Et,Rt)=>{this.end();const{onEnd:Nt,onSessionEnd:It,resumeAnimation:Gt}=this.handlers;if(this.dragSnapToOrigin&&Gt&&Gt(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Dt=getPanInfo(Et.type==="pointercancel"?this.lastMoveEventInfo:transformPoint(Rt,this.transformPagePoint),this.history);this.startEvent&&Nt&&Nt(Et,Dt),It&&It(Et,Dt)},!isPrimaryPointer(i))return;this.dragSnapToOrigin=et,this.handlers=s,this.transformPagePoint=a,this.distanceThreshold=nt,this.contextWindow=b||window;const c=extractEventInfo(i),ct=transformPoint(c,this.transformPagePoint),{point:pt}=ct,{timestamp:xt}=frameData;this.history=[{...pt,timestamp:xt}];const{onSessionStart:St}=s;St&&St(i,getPanInfo(ct,this.history)),this.removeListeners=pipe(addPointerEvent(this.contextWindow,"pointermove",this.handlePointerMove),addPointerEvent(this.contextWindow,"pointerup",this.handlePointerUp),addPointerEvent(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(i){this.handlers=i}end(){this.removeListeners&&this.removeListeners(),cancelFrame(this.updatePoint)}}function transformPoint(e,i){return i?{point:i(e.point)}:e}function subtractPoint(e,i){return{x:e.x-i.x,y:e.y-i.y}}function getPanInfo({point:e},i){return{point:e,delta:subtractPoint(e,lastDevicePoint(i)),offset:subtractPoint(e,startDevicePoint(i)),velocity:getVelocity(i,.1)}}function startDevicePoint(e){return e[0]}function lastDevicePoint(e){return e[e.length-1]}function getVelocity(e,i){if(e.length<2)return{x:0,y:0};let s=e.length-1,a=null;const b=lastDevicePoint(e);for(;s>=0&&(a=e[s],!(b.timestamp-a.timestamp>secondsToMilliseconds(i)));)s--;if(!a)return{x:0,y:0};const et=millisecondsToSeconds(b.timestamp-a.timestamp);if(et===0)return{x:0,y:0};const nt={x:(b.x-a.x)/et,y:(b.y-a.y)/et};return nt.x===1/0&&(nt.x=0),nt.y===1/0&&(nt.y=0),nt}function applyConstraints(e,{min:i,max:s},a){return i!==void 0&&e<i?e=a?mixNumber$1(i,e,a.min):Math.max(e,i):s!==void 0&&e>s&&(e=a?mixNumber$1(s,e,a.max):Math.min(e,s)),e}function calcRelativeAxisConstraints(e,i,s){return{min:i!==void 0?e.min+i:void 0,max:s!==void 0?e.max+s-(e.max-e.min):void 0}}function calcRelativeConstraints(e,{top:i,left:s,bottom:a,right:b}){return{x:calcRelativeAxisConstraints(e.x,s,b),y:calcRelativeAxisConstraints(e.y,i,a)}}function calcViewportAxisConstraints(e,i){let s=i.min-e.min,a=i.max-e.max;return i.max-i.min<e.max-e.min&&([s,a]=[a,s]),{min:s,max:a}}function calcViewportConstraints(e,i){return{x:calcViewportAxisConstraints(e.x,i.x),y:calcViewportAxisConstraints(e.y,i.y)}}function calcOrigin(e,i){let s=.5;const a=calcLength(e),b=calcLength(i);return b>a?s=progress(i.min,i.max-a,e.min):a>b&&(s=progress(e.min,e.max-b,i.min)),clamp$1(0,1,s)}function rebaseAxisConstraints(e,i){const s={};return i.min!==void 0&&(s.min=i.min-e.min),i.max!==void 0&&(s.max=i.max-e.min),s}const defaultElastic=.35;function resolveDragElastic(e=defaultElastic){return e===!1?e=0:e===!0&&(e=defaultElastic),{x:resolveAxisElastic(e,"left","right"),y:resolveAxisElastic(e,"top","bottom")}}function resolveAxisElastic(e,i,s){return{min:resolvePointElastic(e,i),max:resolvePointElastic(e,s)}}function resolvePointElastic(e,i){return typeof e=="number"?e:e[i]||0}const elementDragControls=new WeakMap;class VisualElementDragControls{constructor(i){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=createBox(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=i}start(i,{snapToCursor:s=!1,distanceThreshold:a}={}){const{presenceContext:b}=this.visualElement;if(b&&b.isPresent===!1)return;const et=St=>{const{dragSnapToOrigin:Et}=this.getProps();Et?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(extractEventInfo(St).point)},nt=(St,Et)=>{const{drag:Rt,dragPropagation:Nt,onDragStart:It}=this.getProps();if(Rt&&!Nt&&(this.openDragLock&&this.openDragLock(),this.openDragLock=setDragLock(Rt),!this.openDragLock))return;this.latestPointerEvent=St,this.latestPanInfo=Et,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),eachAxis(Dt=>{let Bt=this.getAxisMotionValue(Dt).get()||0;if(percent.test(Bt)){const{projection:Lt}=this.visualElement;if(Lt&&Lt.layout){const Vt=Lt.layout.layoutBox[Dt];Vt&&(Bt=calcLength(Vt)*(parseFloat(Bt)/100))}}this.originPoint[Dt]=Bt}),It&&frame.postRender(()=>It(St,Et)),addValueToWillChange(this.visualElement,"transform");const{animationState:Gt}=this.visualElement;Gt&&Gt.setActive("whileDrag",!0)},c=(St,Et)=>{this.latestPointerEvent=St,this.latestPanInfo=Et;const{dragPropagation:Rt,dragDirectionLock:Nt,onDirectionLock:It,onDrag:Gt}=this.getProps();if(!Rt&&!this.openDragLock)return;const{offset:Dt}=Et;if(Nt&&this.currentDirection===null){this.currentDirection=getCurrentDirection(Dt),this.currentDirection!==null&&It&&It(this.currentDirection);return}this.updateAxis("x",Et.point,Dt),this.updateAxis("y",Et.point,Dt),this.visualElement.render(),Gt&&Gt(St,Et)},ct=(St,Et)=>{this.latestPointerEvent=St,this.latestPanInfo=Et,this.stop(St,Et),this.latestPointerEvent=null,this.latestPanInfo=null},pt=()=>eachAxis(St=>{var Et;return this.getAnimationState(St)==="paused"&&((Et=this.getAxisMotionValue(St).animation)==null?void 0:Et.play())}),{dragSnapToOrigin:xt}=this.getProps();this.panSession=new PanSession(i,{onSessionStart:et,onStart:nt,onMove:c,onSessionEnd:ct,resumeAnimation:pt},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:xt,distanceThreshold:a,contextWindow:getContextWindow(this.visualElement)})}stop(i,s){const a=i||this.latestPointerEvent,b=s||this.latestPanInfo,et=this.isDragging;if(this.cancel(),!et||!b||!a)return;const{velocity:nt}=b;this.startAnimation(nt);const{onDragEnd:c}=this.getProps();c&&frame.postRender(()=>c(a,b))}cancel(){this.isDragging=!1;const{projection:i,animationState:s}=this.visualElement;i&&(i.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(i,s,a){const{drag:b}=this.getProps();if(!a||!shouldDrag(i,b,this.currentDirection))return;const et=this.getAxisMotionValue(i);let nt=this.originPoint[i]+a[i];this.constraints&&this.constraints[i]&&(nt=applyConstraints(nt,this.constraints[i],this.elastic[i])),et.set(nt)}resolveConstraints(){var et;const{dragConstraints:i,dragElastic:s}=this.getProps(),a=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(et=this.visualElement.projection)==null?void 0:et.layout,b=this.constraints;i&&isRefObject(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&a?this.constraints=calcRelativeConstraints(a.layoutBox,i):this.constraints=!1,this.elastic=resolveDragElastic(s),b!==this.constraints&&a&&this.constraints&&!this.hasMutatedConstraints&&eachAxis(nt=>{this.constraints!==!1&&this.getAxisMotionValue(nt)&&(this.constraints[nt]=rebaseAxisConstraints(a.layoutBox[nt],this.constraints[nt]))})}resolveRefConstraints(){const{dragConstraints:i,onMeasureDragConstraints:s}=this.getProps();if(!i||!isRefObject(i))return!1;const a=i.current;invariant(a!==null,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.","drag-constraints-ref");const{projection:b}=this.visualElement;if(!b||!b.layout)return!1;const et=measurePageBox(a,b.root,this.visualElement.getTransformPagePoint());let nt=calcViewportConstraints(b.layout.layoutBox,et);if(s){const c=s(convertBoxToBoundingBox(nt));this.hasMutatedConstraints=!!c,c&&(nt=convertBoundingBoxToBox(c))}return nt}startAnimation(i){const{drag:s,dragMomentum:a,dragElastic:b,dragTransition:et,dragSnapToOrigin:nt,onDragTransitionEnd:c}=this.getProps(),ct=this.constraints||{},pt=eachAxis(xt=>{if(!shouldDrag(xt,s,this.currentDirection))return;let St=ct&&ct[xt]||{};nt&&(St={min:0,max:0});const Et=b?200:1e6,Rt=b?40:1e7,Nt={type:"inertia",velocity:a?i[xt]:0,bounceStiffness:Et,bounceDamping:Rt,timeConstant:750,restDelta:1,restSpeed:10,...et,...St};return this.startAxisValueAnimation(xt,Nt)});return Promise.all(pt).then(c)}startAxisValueAnimation(i,s){const a=this.getAxisMotionValue(i);return addValueToWillChange(this.visualElement,i),a.start(animateMotionValue(i,a,0,s,this.visualElement,!1))}stopAnimation(){eachAxis(i=>this.getAxisMotionValue(i).stop())}pauseAnimation(){eachAxis(i=>{var s;return(s=this.getAxisMotionValue(i).animation)==null?void 0:s.pause()})}getAnimationState(i){var s;return(s=this.getAxisMotionValue(i).animation)==null?void 0:s.state}getAxisMotionValue(i){const s=`_drag${i.toUpperCase()}`,a=this.visualElement.getProps(),b=a[s];return b||this.visualElement.getValue(i,(a.initial?a.initial[i]:void 0)||0)}snapToCursor(i){eachAxis(s=>{const{drag:a}=this.getProps();if(!shouldDrag(s,a,this.currentDirection))return;const{projection:b}=this.visualElement,et=this.getAxisMotionValue(s);if(b&&b.layout){const{min:nt,max:c}=b.layout.layoutBox[s],ct=et.get()||0;et.set(i[s]-mixNumber$1(nt,c,.5)+ct)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:i,dragConstraints:s}=this.getProps(),{projection:a}=this.visualElement;if(!isRefObject(s)||!a||!this.constraints)return;this.stopAnimation();const b={x:0,y:0};eachAxis(nt=>{const c=this.getAxisMotionValue(nt);if(c&&this.constraints!==!1){const ct=c.get();b[nt]=calcOrigin({min:ct,max:ct},this.constraints[nt])}});const{transformTemplate:et}=this.visualElement.getProps();this.visualElement.current.style.transform=et?et({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),eachAxis(nt=>{if(!shouldDrag(nt,i,null))return;const c=this.getAxisMotionValue(nt),{min:ct,max:pt}=this.constraints[nt];c.set(mixNumber$1(ct,pt,b[nt]))})}addListeners(){if(!this.visualElement.current)return;elementDragControls.set(this.visualElement,this);const i=this.visualElement.current,s=addPointerEvent(i,"pointerdown",ct=>{const{drag:pt,dragListener:xt=!0}=this.getProps();pt&&xt&&this.start(ct)}),a=()=>{const{dragConstraints:ct}=this.getProps();isRefObject(ct)&&ct.current&&(this.constraints=this.resolveRefConstraints())},{projection:b}=this.visualElement,et=b.addEventListener("measure",a);b&&!b.layout&&(b.root&&b.root.updateScroll(),b.updateLayout()),frame.read(a);const nt=addDomEvent(window,"resize",()=>this.scalePositionWithinConstraints()),c=b.addEventListener("didUpdate",({delta:ct,hasLayoutChanged:pt})=>{this.isDragging&&pt&&(eachAxis(xt=>{const St=this.getAxisMotionValue(xt);St&&(this.originPoint[xt]+=ct[xt].translate,St.set(St.get()+ct[xt].translate))}),this.visualElement.render())});return()=>{nt(),s(),et(),c&&c()}}getProps(){const i=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:a=!1,dragPropagation:b=!1,dragConstraints:et=!1,dragElastic:nt=defaultElastic,dragMomentum:c=!0}=i;return{...i,drag:s,dragDirectionLock:a,dragPropagation:b,dragConstraints:et,dragElastic:nt,dragMomentum:c}}}function shouldDrag(e,i,s){return(i===!0||i===e)&&(s===null||s===e)}function getCurrentDirection(e,i=10){let s=null;return Math.abs(e.y)>i?s="y":Math.abs(e.x)>i&&(s="x"),s}class DragGesture extends Feature$1{constructor(i){super(i),this.removeGroupControls=noop,this.removeListeners=noop,this.controls=new VisualElementDragControls(i)}mount(){const{dragControls:i}=this.node.getProps();i&&(this.removeGroupControls=i.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||noop}update(){const{dragControls:i}=this.node.getProps(),{dragControls:s}=this.node.prevProps||{};i!==s&&(this.removeGroupControls(),i&&(this.removeGroupControls=i.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners()}}const asyncHandler=e=>(i,s)=>{e&&frame.postRender(()=>e(i,s))};class PanGesture extends Feature$1{constructor(){super(...arguments),this.removePointerDownListener=noop}onPointerDown(i){this.session=new PanSession(i,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:getContextWindow(this.node)})}createPanHandlers(){const{onPanSessionStart:i,onPanStart:s,onPan:a,onPanEnd:b}=this.node.getProps();return{onSessionStart:asyncHandler(i),onStart:asyncHandler(s),onMove:a,onEnd:(et,nt)=>{delete this.session,b&&frame.postRender(()=>b(et,nt))}}}mount(){this.removePointerDownListener=addPointerEvent(this.node.current,"pointerdown",i=>this.onPointerDown(i))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const globalProjectionState={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let hasTakenAnySnapshot=!1;class MeasureLayoutWithContext extends reactExports.Component{componentDidMount(){const{visualElement:i,layoutGroup:s,switchLayoutGroup:a,layoutId:b}=this.props,{projection:et}=i;et&&(s.group&&s.group.add(et),a&&a.register&&b&&a.register(et),hasTakenAnySnapshot&&et.root.didUpdate(),et.addEventListener("animationComplete",()=>{this.safeToRemove()}),et.setOptions({...et.options,onExitComplete:()=>this.safeToRemove()})),globalProjectionState.hasEverUpdated=!0}getSnapshotBeforeUpdate(i){const{layoutDependency:s,visualElement:a,drag:b,isPresent:et}=this.props,{projection:nt}=a;return nt&&(nt.isPresent=et,hasTakenAnySnapshot=!0,b||i.layoutDependency!==s||s===void 0||i.isPresent!==et?nt.willUpdate():this.safeToRemove(),i.isPresent!==et&&(et?nt.promote():nt.relegate()||frame.postRender(()=>{const c=nt.getStack();(!c||!c.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:i}=this.props.visualElement;i&&(i.root.didUpdate(),microtask.postRender(()=>{!i.currentAnimation&&i.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:i,layoutGroup:s,switchLayoutGroup:a}=this.props,{projection:b}=i;hasTakenAnySnapshot=!0,b&&(b.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(b),a&&a.deregister&&a.deregister(b))}safeToRemove(){const{safeToRemove:i}=this.props;i&&i()}render(){return null}}function MeasureLayout(e){const[i,s]=usePresence(),a=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(MeasureLayoutWithContext,{...e,layoutGroup:a,switchLayoutGroup:reactExports.useContext(SwitchLayoutGroupContext),isPresent:i,safeToRemove:s})}function animateSingleValue(e,i,s){const a=isMotionValue(e)?e:motionValue(e);return a.start(animateMotionValue("",a,i,s)),a.animation}const compareByDepth=(e,i)=>e.depth-i.depth;class FlatTree{constructor(){this.children=[],this.isDirty=!1}add(i){addUniqueItem(this.children,i),this.isDirty=!0}remove(i){removeItem(this.children,i),this.isDirty=!0}forEach(i){this.isDirty&&this.children.sort(compareByDepth),this.isDirty=!1,this.children.forEach(i)}}function delay(e,i){const s=time.now(),a=({timestamp:b})=>{const et=b-s;et>=i&&(cancelFrame(a),e(et-i))};return frame.setup(a,!0),()=>cancelFrame(a)}const borders=["TopLeft","TopRight","BottomLeft","BottomRight"],numBorders=borders.length,asNumber=e=>typeof e=="string"?parseFloat(e):e,isPx=e=>typeof e=="number"||px.test(e);function mixValues(e,i,s,a,b,et){b?(e.opacity=mixNumber$1(0,s.opacity??1,easeCrossfadeIn(a)),e.opacityExit=mixNumber$1(i.opacity??1,0,easeCrossfadeOut(a))):et&&(e.opacity=mixNumber$1(i.opacity??1,s.opacity??1,a));for(let nt=0;nt<numBorders;nt++){const c=`border${borders[nt]}Radius`;let ct=getRadius(i,c),pt=getRadius(s,c);if(ct===void 0&&pt===void 0)continue;ct||(ct=0),pt||(pt=0),ct===0||pt===0||isPx(ct)===isPx(pt)?(e[c]=Math.max(mixNumber$1(asNumber(ct),asNumber(pt),a),0),(percent.test(pt)||percent.test(ct))&&(e[c]+="%")):e[c]=pt}(i.rotate||s.rotate)&&(e.rotate=mixNumber$1(i.rotate||0,s.rotate||0,a))}function getRadius(e,i){return e[i]!==void 0?e[i]:e.borderRadius}const easeCrossfadeIn=compress(0,.5,circOut),easeCrossfadeOut=compress(.5,.95,noop);function compress(e,i,s){return a=>a<e?0:a>i?1:s(progress(e,i,a))}function copyAxisInto(e,i){e.min=i.min,e.max=i.max}function copyBoxInto(e,i){copyAxisInto(e.x,i.x),copyAxisInto(e.y,i.y)}function copyAxisDeltaInto(e,i){e.translate=i.translate,e.scale=i.scale,e.originPoint=i.originPoint,e.origin=i.origin}function removePointDelta(e,i,s,a,b){return e-=i,e=scalePoint(e,1/s,a),b!==void 0&&(e=scalePoint(e,1/b,a)),e}function removeAxisDelta(e,i=0,s=1,a=.5,b,et=e,nt=e){if(percent.test(i)&&(i=parseFloat(i),i=mixNumber$1(nt.min,nt.max,i/100)-nt.min),typeof i!="number")return;let c=mixNumber$1(et.min,et.max,a);e===et&&(c-=i),e.min=removePointDelta(e.min,i,s,c,b),e.max=removePointDelta(e.max,i,s,c,b)}function removeAxisTransforms(e,i,[s,a,b],et,nt){removeAxisDelta(e,i[s],i[a],i[b],i.scale,et,nt)}const xKeys=["x","scaleX","originX"],yKeys=["y","scaleY","originY"];function removeBoxTransforms(e,i,s,a){removeAxisTransforms(e.x,i,xKeys,s?s.x:void 0,a?a.x:void 0),removeAxisTransforms(e.y,i,yKeys,s?s.y:void 0,a?a.y:void 0)}function isAxisDeltaZero(e){return e.translate===0&&e.scale===1}function isDeltaZero(e){return isAxisDeltaZero(e.x)&&isAxisDeltaZero(e.y)}function axisEquals(e,i){return e.min===i.min&&e.max===i.max}function boxEquals(e,i){return axisEquals(e.x,i.x)&&axisEquals(e.y,i.y)}function axisEqualsRounded(e,i){return Math.round(e.min)===Math.round(i.min)&&Math.round(e.max)===Math.round(i.max)}function boxEqualsRounded(e,i){return axisEqualsRounded(e.x,i.x)&&axisEqualsRounded(e.y,i.y)}function aspectRatio(e){return calcLength(e.x)/calcLength(e.y)}function axisDeltaEquals(e,i){return e.translate===i.translate&&e.scale===i.scale&&e.originPoint===i.originPoint}class NodeStack{constructor(){this.members=[]}add(i){addUniqueItem(this.members,i),i.scheduleRender()}remove(i){if(removeItem(this.members,i),i===this.prevLead&&(this.prevLead=void 0),i===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(i){const s=this.members.findIndex(b=>i===b);if(s===0)return!1;let a;for(let b=s;b>=0;b--){const et=this.members[b];if(et.isPresent!==!1){a=et;break}}return a?(this.promote(a),!0):!1}promote(i,s){const a=this.lead;if(i!==a&&(this.prevLead=a,this.lead=i,i.show(),a)){a.instance&&a.scheduleRender(),i.scheduleRender(),i.resumeFrom=a,s&&(i.resumeFrom.preserveOpacity=!0),a.snapshot&&(i.snapshot=a.snapshot,i.snapshot.latestValues=a.animationValues||a.latestValues),i.root&&i.root.isUpdating&&(i.isLayoutDirty=!0);const{crossfade:b}=i.options;b===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(i=>{const{options:s,resumingFrom:a}=i;s.onExitComplete&&s.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(i=>{i.instance&&i.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function buildProjectionTransform(e,i,s){let a="";const b=e.x.translate/i.x,et=e.y.translate/i.y,nt=(s==null?void 0:s.z)||0;if((b||et||nt)&&(a=`translate3d(${b}px, ${et}px, ${nt}px) `),(i.x!==1||i.y!==1)&&(a+=`scale(${1/i.x}, ${1/i.y}) `),s){const{transformPerspective:pt,rotate:xt,rotateX:St,rotateY:Et,skewX:Rt,skewY:Nt}=s;pt&&(a=`perspective(${pt}px) ${a}`),xt&&(a+=`rotate(${xt}deg) `),St&&(a+=`rotateX(${St}deg) `),Et&&(a+=`rotateY(${Et}deg) `),Rt&&(a+=`skewX(${Rt}deg) `),Nt&&(a+=`skewY(${Nt}deg) `)}const c=e.x.scale*i.x,ct=e.y.scale*i.y;return(c!==1||ct!==1)&&(a+=`scale(${c}, ${ct})`),a||"none"}const transformAxes=["","X","Y","Z"],animationTarget=1e3;let id=0;function resetDistortingTransform(e,i,s,a){const{latestValues:b}=i;b[e]&&(s[e]=b[e],i.setStaticValue(e,0),a&&(a[e]=0))}function cancelTreeOptimisedTransformAnimations(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:i}=e.options;if(!i)return;const s=getOptimisedAppearId(i);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:b,layoutId:et}=e.options;window.MotionCancelOptimisedAnimation(s,"transform",frame,!(b||et))}const{parent:a}=e;a&&!a.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(a)}function createProjectionNode({attachResizeListener:e,defaultParent:i,measureScroll:s,checkIsScrollRoot:a,resetTransform:b}){return class{constructor(nt={},c=i==null?void 0:i()){this.id=id++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(propagateDirtyNodes),this.nodes.forEach(resolveTargetDelta),this.nodes.forEach(calcProjection),this.nodes.forEach(cleanDirtyNodes)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=nt,this.root=c?c.root||c:this,this.path=c?[...c.path,c]:[],this.parent=c,this.depth=c?c.depth+1:0;for(let ct=0;ct<this.path.length;ct++)this.path[ct].shouldResetTransform=!0;this.root===this&&(this.nodes=new FlatTree)}addEventListener(nt,c){return this.eventHandlers.has(nt)||this.eventHandlers.set(nt,new SubscriptionManager),this.eventHandlers.get(nt).add(c)}notifyListeners(nt,...c){const ct=this.eventHandlers.get(nt);ct&&ct.notify(...c)}hasListeners(nt){return this.eventHandlers.has(nt)}mount(nt){if(this.instance)return;this.isSVG=isSVGElement(nt)&&!isSVGSVGElement(nt),this.instance=nt;const{layoutId:c,layout:ct,visualElement:pt}=this.options;if(pt&&!pt.current&&pt.mount(nt),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(ct||c)&&(this.isLayoutDirty=!0),e){let xt,St=0;const Et=()=>this.root.updateBlockedByResize=!1;frame.read(()=>{St=window.innerWidth}),e(nt,()=>{const Rt=window.innerWidth;Rt!==St&&(St=Rt,this.root.updateBlockedByResize=!0,xt&&xt(),xt=delay(Et,250),globalProjectionState.hasAnimatedSinceResize&&(globalProjectionState.hasAnimatedSinceResize=!1,this.nodes.forEach(finishAnimation)))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&pt&&(c||ct)&&this.addEventListener("didUpdate",({delta:xt,hasLayoutChanged:St,hasRelativeLayoutChanged:Et,layout:Rt})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const Nt=this.options.transition||pt.getDefaultTransition()||defaultLayoutTransition,{onLayoutAnimationStart:It,onLayoutAnimationComplete:Gt}=pt.getProps(),Dt=!this.targetLayout||!boxEqualsRounded(this.targetLayout,Rt),Bt=!St&&Et;if(this.options.layoutRoot||this.resumeFrom||Bt||St&&(Dt||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const Lt={...getValueTransition(Nt,"layout"),onPlay:It,onComplete:Gt};(pt.shouldReduceMotion||this.options.layoutRoot)&&(Lt.delay=0,Lt.type=!1),this.startAnimation(Lt),this.setAnimationOrigin(xt,Bt)}else St||finishAnimation(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=Rt})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const nt=this.getStack();nt&&nt.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),cancelFrame(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(resetSkewAndRotation),this.animationId++)}getTransformTemplate(){const{visualElement:nt}=this.options;return nt&&nt.getProps().transformTemplate}willUpdate(nt=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let xt=0;xt<this.path.length;xt++){const St=this.path[xt];St.shouldResetTransform=!0,St.updateScroll("snapshot"),St.options.layoutRoot&&St.willUpdate(!1)}const{layoutId:c,layout:ct}=this.options;if(c===void 0&&!ct)return;const pt=this.getTransformTemplate();this.prevTransformTemplateValue=pt?pt(this.latestValues,""):void 0,this.updateSnapshot(),nt&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(clearMeasurements);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(clearIsLayoutDirty);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(resetTransformStyle),this.nodes.forEach(updateLayout),this.nodes.forEach(notifyLayoutUpdate)):this.nodes.forEach(clearIsLayoutDirty),this.clearAllSnapshots();const c=time.now();frameData.delta=clamp$1(0,1e3/60,c-frameData.timestamp),frameData.timestamp=c,frameData.isProcessing=!0,frameSteps.update.process(frameData),frameSteps.preRender.process(frameData),frameSteps.render.process(frameData),frameData.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,microtask.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(clearSnapshot),this.sharedNodes.forEach(removeLeadSnapshots)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,frame.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){frame.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!calcLength(this.snapshot.measuredBox.x)&&!calcLength(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let ct=0;ct<this.path.length;ct++)this.path[ct].updateScroll();const nt=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=createBox(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:c}=this.options;c&&c.notify("LayoutMeasure",this.layout.layoutBox,nt?nt.layoutBox:void 0)}updateScroll(nt="measure"){let c=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===nt&&(c=!1),c&&this.instance){const ct=a(this.instance);this.scroll={animationId:this.root.animationId,phase:nt,isRoot:ct,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:ct}}}resetTransform(){if(!b)return;const nt=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,c=this.projectionDelta&&!isDeltaZero(this.projectionDelta),ct=this.getTransformTemplate(),pt=ct?ct(this.latestValues,""):void 0,xt=pt!==this.prevTransformTemplateValue;nt&&this.instance&&(c||hasTransform(this.latestValues)||xt)&&(b(this.instance,pt),this.shouldResetTransform=!1,this.scheduleRender())}measure(nt=!0){const c=this.measurePageBox();let ct=this.removeElementScroll(c);return nt&&(ct=this.removeTransform(ct)),roundBox(ct),{animationId:this.root.animationId,measuredBox:c,layoutBox:ct,latestValues:{},source:this.id}}measurePageBox(){var pt;const{visualElement:nt}=this.options;if(!nt)return createBox();const c=nt.measureViewportBox();if(!(((pt=this.scroll)==null?void 0:pt.wasRoot)||this.path.some(checkNodeWasScrollRoot))){const{scroll:xt}=this.root;xt&&(translateAxis(c.x,xt.offset.x),translateAxis(c.y,xt.offset.y))}return c}removeElementScroll(nt){var ct;const c=createBox();if(copyBoxInto(c,nt),(ct=this.scroll)!=null&&ct.wasRoot)return c;for(let pt=0;pt<this.path.length;pt++){const xt=this.path[pt],{scroll:St,options:Et}=xt;xt!==this.root&&St&&Et.layoutScroll&&(St.wasRoot&&copyBoxInto(c,nt),translateAxis(c.x,St.offset.x),translateAxis(c.y,St.offset.y))}return c}applyTransform(nt,c=!1){const ct=createBox();copyBoxInto(ct,nt);for(let pt=0;pt<this.path.length;pt++){const xt=this.path[pt];!c&&xt.options.layoutScroll&&xt.scroll&&xt!==xt.root&&transformBox(ct,{x:-xt.scroll.offset.x,y:-xt.scroll.offset.y}),hasTransform(xt.latestValues)&&transformBox(ct,xt.latestValues)}return hasTransform(this.latestValues)&&transformBox(ct,this.latestValues),ct}removeTransform(nt){const c=createBox();copyBoxInto(c,nt);for(let ct=0;ct<this.path.length;ct++){const pt=this.path[ct];if(!pt.instance||!hasTransform(pt.latestValues))continue;hasScale(pt.latestValues)&&pt.updateSnapshot();const xt=createBox(),St=pt.measurePageBox();copyBoxInto(xt,St),removeBoxTransforms(c,pt.latestValues,pt.snapshot?pt.snapshot.layoutBox:void 0,xt)}return hasTransform(this.latestValues)&&removeBoxTransforms(c,this.latestValues),c}setTargetDelta(nt){this.targetDelta=nt,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(nt){this.options={...this.options,...nt,crossfade:nt.crossfade!==void 0?nt.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==frameData.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(nt=!1){var Rt;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const ct=!!this.resumingFrom||this!==c;if(!(nt||ct&&this.isSharedProjectionDirty||this.isProjectionDirty||(Rt=this.parent)!=null&&Rt.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:xt,layoutId:St}=this.options;if(!this.layout||!(xt||St))return;this.resolvedRelativeTargetAt=frameData.timestamp;const Et=this.getClosestProjectingParent();Et&&this.linkedParentVersion!==Et.layoutVersion&&!Et.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(Et&&Et.layout?this.createRelativeTarget(Et,this.layout.layoutBox,Et.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=createBox(),this.targetWithTransforms=createBox()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),calcRelativeBox(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):copyBoxInto(this.target,this.layout.layoutBox),applyBoxDelta(this.target,this.targetDelta)):copyBoxInto(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,Et&&!!Et.resumingFrom==!!this.resumingFrom&&!Et.options.layoutScroll&&Et.target&&this.animationProgress!==1?this.createRelativeTarget(Et,this.target,Et.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||hasScale(this.parent.latestValues)||has2DTranslate(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(nt,c,ct){this.relativeParent=nt,this.linkedParentVersion=nt.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,c,ct),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var Nt;const nt=this.getLead(),c=!!this.resumingFrom||this!==nt;let ct=!0;if((this.isProjectionDirty||(Nt=this.parent)!=null&&Nt.isProjectionDirty)&&(ct=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(ct=!1),this.resolvedRelativeTargetAt===frameData.timestamp&&(ct=!1),ct)return;const{layout:pt,layoutId:xt}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(pt||xt))return;copyBoxInto(this.layoutCorrected,this.layout.layoutBox);const St=this.treeScale.x,Et=this.treeScale.y;applyTreeDeltas(this.layoutCorrected,this.treeScale,this.path,c),nt.layout&&!nt.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(nt.target=nt.layout.layoutBox,nt.targetWithTransforms=createBox());const{target:Rt}=nt;if(!Rt){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(copyAxisDeltaInto(this.prevProjectionDelta.x,this.projectionDelta.x),copyAxisDeltaInto(this.prevProjectionDelta.y,this.projectionDelta.y)),calcBoxDelta(this.projectionDelta,this.layoutCorrected,Rt,this.latestValues),(this.treeScale.x!==St||this.treeScale.y!==Et||!axisDeltaEquals(this.projectionDelta.x,this.prevProjectionDelta.x)||!axisDeltaEquals(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",Rt))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(nt=!0){var c;if((c=this.options.visualElement)==null||c.scheduleRender(),nt){const ct=this.getStack();ct&&ct.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=createDelta(),this.projectionDelta=createDelta(),this.projectionDeltaWithTransform=createDelta()}setAnimationOrigin(nt,c=!1){const ct=this.snapshot,pt=ct?ct.latestValues:{},xt={...this.latestValues},St=createDelta();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!c;const Et=createBox(),Rt=ct?ct.source:void 0,Nt=this.layout?this.layout.source:void 0,It=Rt!==Nt,Gt=this.getStack(),Dt=!Gt||Gt.members.length<=1,Bt=!!(It&&!Dt&&this.options.crossfade===!0&&!this.path.some(hasOpacityCrossfade));this.animationProgress=0;let Lt;this.mixTargetDelta=Vt=>{const Zt=Vt/1e3;mixAxisDelta(St.x,nt.x,Zt),mixAxisDelta(St.y,nt.y,Zt),this.setTargetDelta(St),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(calcRelativePosition(Et,this.layout.layoutBox,this.relativeParent.layout.layoutBox),mixBox(this.relativeTarget,this.relativeTargetOrigin,Et,Zt),Lt&&boxEquals(this.relativeTarget,Lt)&&(this.isProjectionDirty=!1),Lt||(Lt=createBox()),copyBoxInto(Lt,this.relativeTarget)),It&&(this.animationValues=xt,mixValues(xt,pt,this.latestValues,Zt,Bt,Dt)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Zt},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(nt){var c,ct,pt;this.notifyListeners("animationStart"),(c=this.currentAnimation)==null||c.stop(),(pt=(ct=this.resumingFrom)==null?void 0:ct.currentAnimation)==null||pt.stop(),this.pendingAnimation&&(cancelFrame(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=frame.update(()=>{globalProjectionState.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=motionValue(0)),this.currentAnimation=animateSingleValue(this.motionValue,[0,1e3],{...nt,velocity:0,isSync:!0,onUpdate:xt=>{this.mixTargetDelta(xt),nt.onUpdate&&nt.onUpdate(xt)},onStop:()=>{},onComplete:()=>{nt.onComplete&&nt.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const nt=this.getStack();nt&&nt.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(animationTarget),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const nt=this.getLead();let{targetWithTransforms:c,target:ct,layout:pt,latestValues:xt}=nt;if(!(!c||!ct||!pt)){if(this!==nt&&this.layout&&pt&&shouldAnimatePositionOnly(this.options.animationType,this.layout.layoutBox,pt.layoutBox)){ct=this.target||createBox();const St=calcLength(this.layout.layoutBox.x);ct.x.min=nt.target.x.min,ct.x.max=ct.x.min+St;const Et=calcLength(this.layout.layoutBox.y);ct.y.min=nt.target.y.min,ct.y.max=ct.y.min+Et}copyBoxInto(c,ct),transformBox(c,xt),calcBoxDelta(this.projectionDeltaWithTransform,this.layoutCorrected,c,xt)}}registerSharedNode(nt,c){this.sharedNodes.has(nt)||this.sharedNodes.set(nt,new NodeStack),this.sharedNodes.get(nt).add(c);const pt=c.options.initialPromotionConfig;c.promote({transition:pt?pt.transition:void 0,preserveFollowOpacity:pt&&pt.shouldPreserveFollowOpacity?pt.shouldPreserveFollowOpacity(c):void 0})}isLead(){const nt=this.getStack();return nt?nt.lead===this:!0}getLead(){var c;const{layoutId:nt}=this.options;return nt?((c=this.getStack())==null?void 0:c.lead)||this:this}getPrevLead(){var c;const{layoutId:nt}=this.options;return nt?(c=this.getStack())==null?void 0:c.prevLead:void 0}getStack(){const{layoutId:nt}=this.options;if(nt)return this.root.sharedNodes.get(nt)}promote({needsReset:nt,transition:c,preserveFollowOpacity:ct}={}){const pt=this.getStack();pt&&pt.promote(this,ct),nt&&(this.projectionDelta=void 0,this.needsReset=!0),c&&this.setOptions({transition:c})}relegate(){const nt=this.getStack();return nt?nt.relegate(this):!1}resetSkewAndRotation(){const{visualElement:nt}=this.options;if(!nt)return;let c=!1;const{latestValues:ct}=nt;if((ct.z||ct.rotate||ct.rotateX||ct.rotateY||ct.rotateZ||ct.skewX||ct.skewY)&&(c=!0),!c)return;const pt={};ct.z&&resetDistortingTransform("z",nt,pt,this.animationValues);for(let xt=0;xt<transformAxes.length;xt++)resetDistortingTransform(`rotate${transformAxes[xt]}`,nt,pt,this.animationValues),resetDistortingTransform(`skew${transformAxes[xt]}`,nt,pt,this.animationValues);nt.render();for(const xt in pt)nt.setStaticValue(xt,pt[xt]),this.animationValues&&(this.animationValues[xt]=pt[xt]);nt.scheduleRender()}applyProjectionStyles(nt,c){if(!this.instance||this.isSVG)return;if(!this.isVisible){nt.visibility="hidden";return}const ct=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,nt.visibility="",nt.opacity="",nt.pointerEvents=resolveMotionValue(c==null?void 0:c.pointerEvents)||"",nt.transform=ct?ct(this.latestValues,""):"none";return}const pt=this.getLead();if(!this.projectionDelta||!this.layout||!pt.target){this.options.layoutId&&(nt.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,nt.pointerEvents=resolveMotionValue(c==null?void 0:c.pointerEvents)||""),this.hasProjected&&!hasTransform(this.latestValues)&&(nt.transform=ct?ct({},""):"none",this.hasProjected=!1);return}nt.visibility="";const xt=pt.animationValues||pt.latestValues;this.applyTransformsToTarget();let St=buildProjectionTransform(this.projectionDeltaWithTransform,this.treeScale,xt);ct&&(St=ct(xt,St)),nt.transform=St;const{x:Et,y:Rt}=this.projectionDelta;nt.transformOrigin=`${Et.origin*100}% ${Rt.origin*100}% 0`,pt.animationValues?nt.opacity=pt===this?xt.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:xt.opacityExit:nt.opacity=pt===this?xt.opacity!==void 0?xt.opacity:"":xt.opacityExit!==void 0?xt.opacityExit:0;for(const Nt in scaleCorrectors){if(xt[Nt]===void 0)continue;const{correct:It,applyTo:Gt,isCSSVariable:Dt}=scaleCorrectors[Nt],Bt=St==="none"?xt[Nt]:It(xt[Nt],pt);if(Gt){const Lt=Gt.length;for(let Vt=0;Vt<Lt;Vt++)nt[Gt[Vt]]=Bt}else Dt?this.options.visualElement.renderState.vars[Nt]=Bt:nt[Nt]=Bt}this.options.layoutId&&(nt.pointerEvents=pt===this?resolveMotionValue(c==null?void 0:c.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(nt=>{var c;return(c=nt.currentAnimation)==null?void 0:c.stop()}),this.root.nodes.forEach(clearMeasurements),this.root.sharedNodes.clear()}}}function updateLayout(e){e.updateLayout()}function notifyLayoutUpdate(e){var s;const i=((s=e.resumeFrom)==null?void 0:s.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&i&&e.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:b}=e.layout,{animationType:et}=e.options,nt=i.source!==e.layout.source;et==="size"?eachAxis(St=>{const Et=nt?i.measuredBox[St]:i.layoutBox[St],Rt=calcLength(Et);Et.min=a[St].min,Et.max=Et.min+Rt}):shouldAnimatePositionOnly(et,i.layoutBox,a)&&eachAxis(St=>{const Et=nt?i.measuredBox[St]:i.layoutBox[St],Rt=calcLength(a[St]);Et.max=Et.min+Rt,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[St].max=e.relativeTarget[St].min+Rt)});const c=createDelta();calcBoxDelta(c,a,i.layoutBox);const ct=createDelta();nt?calcBoxDelta(ct,e.applyTransform(b,!0),i.measuredBox):calcBoxDelta(ct,a,i.layoutBox);const pt=!isDeltaZero(c);let xt=!1;if(!e.resumeFrom){const St=e.getClosestProjectingParent();if(St&&!St.resumeFrom){const{snapshot:Et,layout:Rt}=St;if(Et&&Rt){const Nt=createBox();calcRelativePosition(Nt,i.layoutBox,Et.layoutBox);const It=createBox();calcRelativePosition(It,a,Rt.layoutBox),boxEqualsRounded(Nt,It)||(xt=!0),St.options.layoutRoot&&(e.relativeTarget=It,e.relativeTargetOrigin=Nt,e.relativeParent=St)}}}e.notifyListeners("didUpdate",{layout:a,snapshot:i,delta:ct,layoutDelta:c,hasLayoutChanged:pt,hasRelativeLayoutChanged:xt})}else if(e.isLead()){const{onExitComplete:a}=e.options;a&&a()}e.options.transition=void 0}function propagateDirtyNodes(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function cleanDirtyNodes(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function clearSnapshot(e){e.clearSnapshot()}function clearMeasurements(e){e.clearMeasurements()}function clearIsLayoutDirty(e){e.isLayoutDirty=!1}function resetTransformStyle(e){const{visualElement:i}=e.options;i&&i.getProps().onBeforeLayoutMeasure&&i.notify("BeforeLayoutMeasure"),e.resetTransform()}function finishAnimation(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function resolveTargetDelta(e){e.resolveTargetDelta()}function calcProjection(e){e.calcProjection()}function resetSkewAndRotation(e){e.resetSkewAndRotation()}function removeLeadSnapshots(e){e.removeLeadSnapshot()}function mixAxisDelta(e,i,s){e.translate=mixNumber$1(i.translate,0,s),e.scale=mixNumber$1(i.scale,1,s),e.origin=i.origin,e.originPoint=i.originPoint}function mixAxis(e,i,s,a){e.min=mixNumber$1(i.min,s.min,a),e.max=mixNumber$1(i.max,s.max,a)}function mixBox(e,i,s,a){mixAxis(e.x,i.x,s.x,a),mixAxis(e.y,i.y,s.y,a)}function hasOpacityCrossfade(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const defaultLayoutTransition={duration:.45,ease:[.4,0,.1,1]},userAgentContains=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),roundPoint=userAgentContains("applewebkit/")&&!userAgentContains("chrome/")?Math.round:noop;function roundAxis(e){e.min=roundPoint(e.min),e.max=roundPoint(e.max)}function roundBox(e){roundAxis(e.x),roundAxis(e.y)}function shouldAnimatePositionOnly(e,i,s){return e==="position"||e==="preserve-aspect"&&!isNear(aspectRatio(i),aspectRatio(s),.2)}function checkNodeWasScrollRoot(e){var i;return e!==e.root&&((i=e.scroll)==null?void 0:i.wasRoot)}const DocumentProjectionNode=createProjectionNode({attachResizeListener:(e,i)=>addDomEvent(e,"resize",i),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),rootProjectionNode={current:void 0},HTMLProjectionNode=createProjectionNode({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!rootProjectionNode.current){const e=new DocumentProjectionNode({});e.mount(window),e.setOptions({layoutScroll:!0}),rootProjectionNode.current=e}return rootProjectionNode.current},resetTransform:(e,i)=>{e.style.transform=i!==void 0?i:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),drag={pan:{Feature:PanGesture},drag:{Feature:DragGesture,ProjectionNode:HTMLProjectionNode,MeasureLayout}};function handleHoverEvent(e,i,s){const{props:a}=e;e.animationState&&a.whileHover&&e.animationState.setActive("whileHover",s==="Start");const b="onHover"+s,et=a[b];et&&frame.postRender(()=>et(i,extractEventInfo(i)))}class HoverGesture extends Feature$1{mount(){const{current:i}=this.node;i&&(this.unmount=hover(i,(s,a)=>(handleHoverEvent(this.node,a,"Start"),b=>handleHoverEvent(this.node,b,"End"))))}unmount(){}}class FocusGesture extends Feature$1{constructor(){super(...arguments),this.isActive=!1}onFocus(){let i=!1;try{i=this.node.current.matches(":focus-visible")}catch{i=!0}!i||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=pipe(addDomEvent(this.node.current,"focus",()=>this.onFocus()),addDomEvent(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function handlePressEvent(e,i,s){const{props:a}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&a.whileTap&&e.animationState.setActive("whileTap",s==="Start");const b="onTap"+(s==="End"?"":s),et=a[b];et&&frame.postRender(()=>et(i,extractEventInfo(i)))}class PressGesture extends Feature$1{mount(){const{current:i}=this.node;i&&(this.unmount=press(i,(s,a)=>(handlePressEvent(this.node,a,"Start"),(b,{success:et})=>handlePressEvent(this.node,b,et?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const observerCallbacks=new WeakMap,observers=new WeakMap,fireObserverCallback=e=>{const i=observerCallbacks.get(e.target);i&&i(e)},fireAllObserverCallbacks=e=>{e.forEach(fireObserverCallback)};function initIntersectionObserver({root:e,...i}){const s=e||document;observers.has(s)||observers.set(s,{});const a=observers.get(s),b=JSON.stringify(i);return a[b]||(a[b]=new IntersectionObserver(fireAllObserverCallbacks,{root:e,...i})),a[b]}function observeIntersection(e,i,s){const a=initIntersectionObserver(i);return observerCallbacks.set(e,s),a.observe(e),()=>{observerCallbacks.delete(e),a.unobserve(e)}}const thresholdNames={some:0,all:1};class InViewFeature extends Feature$1{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:i={}}=this.node.getProps(),{root:s,margin:a,amount:b="some",once:et}=i,nt={root:s?s.current:void 0,rootMargin:a,threshold:typeof b=="number"?b:thresholdNames[b]},c=ct=>{const{isIntersecting:pt}=ct;if(this.isInView===pt||(this.isInView=pt,et&&!pt&&this.hasEnteredView))return;pt&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",pt);const{onViewportEnter:xt,onViewportLeave:St}=this.node.getProps(),Et=pt?xt:St;Et&&Et(ct)};return observeIntersection(this.node.current,nt,c)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:i,prevProps:s}=this.node;["amount","margin","root"].some(hasViewportOptionChanged(i,s))&&this.startObserver()}unmount(){}}function hasViewportOptionChanged({viewport:e={}},{viewport:i={}}={}){return s=>e[s]!==i[s]}const gestureAnimations={inView:{Feature:InViewFeature},tap:{Feature:PressGesture},focus:{Feature:FocusGesture},hover:{Feature:HoverGesture}},layout={layout:{ProjectionNode:HTMLProjectionNode,MeasureLayout}},featureBundle={...animations,...gestureAnimations,...drag,...layout},motion=createMotionProxy(featureBundle,createDomVisualElement);function KitchenCard({kitchen:e,index:i=0}){const{userLocation:s}=useLocationContext(),a=s&&e.address.lat&&e.address.lng?calculateDistance(s.lat,s.lng,e.address.lat,e.address.lng):e.address.city;return jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:i*.1,duration:.3},children:jsxRuntimeExports.jsx(Link,{to:`/kitchen/${e.id}`,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl overflow-hidden shadow-card hover:shadow-elevated transition-shadow duration-300",children:[jsxRuntimeExports.jsxs("div",{className:"relative h-36 overflow-hidden",children:[jsxRuntimeExports.jsx("img",{src:e.image,alt:e.name,className:"w-full h-full object-cover",loading:"lazy"}),jsxRuntimeExports.jsx("div",{className:cn("absolute top-3 right-3 px-2.5 py-1 rounded-full text-xs font-semibold",e.isOpen?"bg-accent text-accent-foreground":"bg-muted text-muted-foreground"),children:e.isOpen?"Cooking Today":"Closed"}),e.isVeg&&jsxRuntimeExports.jsx("div",{className:"absolute top-3 left-3 p-1.5 rounded-full bg-veg",children:jsxRuntimeExports.jsx(Leaf,{className:"w-3 h-3 text-white"})})]}),jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground text-base mb-1 truncate",children:e.name}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground text-sm mb-3 line-clamp-1",children:e.specialties.slice(0,3).join("  ")}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center gap-1",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 rounded-md bg-gold-soft",children:[jsxRuntimeExports.jsx(Star,{className:"w-3.5 h-3.5 text-gold fill-gold"}),jsxRuntimeExports.jsx("span",{className:"font-semibold text-foreground",children:e.rating.toFixed(1)})]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[jsxRuntimeExports.jsx(Clock,{className:"w-3.5 h-3.5"}),jsxRuntimeExports.jsx("span",{children:e.cookingTime})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-3.5 h-3.5"}),jsxRuntimeExports.jsx("span",{className:"truncate max-w-[80px]",children:a})]})]})]})]})})})}function useKitchens(){const[e,i]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[b,et]=reactExports.useState(null);return reactExports.useEffect(()=>{const nt=ref(database,"kitchens"),c=onValue(nt,ct=>{try{const pt=ct.val();if(pt){const xt=Object.entries(pt).map(([Et,Rt])=>({...Rt,id:Et})),St=xt.filter(Et=>Et.isApproved===!0);i(St.length>0?St:xt)}else i([]);a(!1)}catch{et("Failed to fetch kitchens"),a(!1)}},ct=>{et(ct.message),a(!1)});return()=>c()},[]),{kitchens:e,loading:s,error:b}}function useKitchen(e){const[i,s]=reactExports.useState(null),[a,b]=reactExports.useState(!0),[et,nt]=reactExports.useState(null);return reactExports.useEffect(()=>{if(!e){b(!1);return}const c=ref(database,`kitchens/${e}`),ct=onValue(c,pt=>{try{const xt=pt.val();s(xt?{...xt,id:e}:null),b(!1)}catch{nt("Failed to fetch kitchen"),b(!1)}});return()=>ct()},[e]),{kitchen:i,loading:a,error:et}}function useDishes(e){const[i,s]=reactExports.useState([]),[a,b]=reactExports.useState(!0),[et,nt]=reactExports.useState(null);return reactExports.useEffect(()=>{if(!e){b(!1);return}const c=ref(database,"dishes"),ct=onValue(c,pt=>{try{const xt=pt.val();if(xt){const St=Object.entries(xt).map(([Et,Rt])=>({...Rt,id:Et})).filter(Et=>Et.kitchenId===e);s(St)}else s([]);b(!1)}catch{nt("Failed to fetch dishes"),b(!1)}});return()=>ct()},[e]),{dishes:i,loading:a,error:et}}function useUserOrders(e){const[i,s]=reactExports.useState([]),[a,b]=reactExports.useState(!0),[et,nt]=reactExports.useState(null);return reactExports.useEffect(()=>{if(!e){b(!1);return}const c=ref(database,"orders"),ct=onValue(c,pt=>{try{const xt=pt.val();if(xt){const St=Object.entries(xt).map(([Et,Rt])=>({...Rt,id:Et})).filter(Et=>Et.userId===e).sort((Et,Rt)=>Rt.createdAt-Et.createdAt);s(St)}else s([]);b(!1)}catch{nt("Failed to fetch orders"),b(!1)}});return()=>ct()},[e]),{orders:i,loading:a,error:et}}async function createKitchen(e){const i=ref(database,"kitchens"),s=push(i);return await set(s,e),s.key}async function updateKitchen(e,i){const s=ref(database,`kitchens/${e}`);await update(s,i)}async function createDish(e){const i=ref(database,"dishes"),s=push(i);return await set(s,e),s.key}async function deleteDish(e){const i=ref(database,`dishes/${e}`);await remove(i)}async function createOrder(e){const i=ref(database,"orders"),s=push(i);return await set(s,e),s.key}async function updateOrderStatus(e,i){const s=ref(database,`orders/${e}`);await update(s,{status:i,updatedAt:Date.now()})}async function createCoupon(e){const i=ref(database,"coupons"),s=push(i);return await set(s,e),s.key}async function updateCoupon(e,i){const s=ref(database,`coupons/${e}`);await update(s,i)}async function deleteCoupon(e){const i=ref(database,`coupons/${e}`);await remove(i)}async function getCouponByCode(e){const i=ref(database,"coupons"),s=await get(i);if(s.exists()){const a=s.val();for(const[b,et]of Object.entries(a)){const nt=et;if(nt.code.toUpperCase()===e.toUpperCase())return{...nt,id:b}}}return null}function useKitchenCoupons(e){const[i,s]=reactExports.useState([]),[a,b]=reactExports.useState(!0);return reactExports.useEffect(()=>{if(!e){b(!1);return}const et=ref(database,"coupons"),nt=onValue(et,c=>{const ct=c.val();if(ct){const pt=Object.entries(ct).map(([xt,St])=>({...St,id:xt})).filter(xt=>xt.kitchenId===e);s(pt)}else s([]);b(!1)});return()=>nt()},[e]),{coupons:i,loading:a}}const buttonVariants=cva("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Button=reactExports.forwardRef(({className:e,variant:i,size:s,asChild:a=!1,...b},et)=>{const nt=a?Slot$2:"button";return jsxRuntimeExports.jsx(nt,{className:cn(buttonVariants({variant:i,size:s,className:e})),ref:et,...b})});Button.displayName="Button";function BottomNav(){const e=useLocation(),{getItemCount:i}=useCart(),s=i(),a=[{icon:House,label:"Home",path:"/"},{icon:Search,label:"Search",path:"/search"},{icon:ChefHat,label:"Cart",path:"/cart",count:s},{icon:ShoppingBag,label:"Orders",path:"/orders"},{icon:User,label:"Profile",path:"/profile"}];return jsxRuntimeExports.jsx("nav",{className:"fixed bottom-2 left-4 right-4 z-50 bg-background/80 backdrop-blur-3xl border border-border/50 rounded-2xl shadow-lg safe-bottom",children:jsxRuntimeExports.jsx("div",{className:"flex items-center justify-around px-2 py-2 max-w-lg mx-auto relative",children:a.map(b=>{const et=e.pathname===b.path,nt=b.icon;return jsxRuntimeExports.jsx(Link,{to:b.path,className:"relative flex-1 group",children:jsxRuntimeExports.jsxs(motion.div,{whileTap:{scale:.9},className:"flex flex-col items-center justify-center gap-1 py-2 rounded-xl transition-colors relative z-10",children:[et&&jsxRuntimeExports.jsx(motion.div,{layoutId:"navBubble",className:"absolute inset-0 bg-primary/10 rounded-xl -z-10",transition:{type:"spring",bounce:.2,duration:.6}}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(motion.div,{animate:{scale:et?1.1:1,y:et?-2:0},transition:{type:"spring",stiffness:400,damping:25},children:jsxRuntimeExports.jsx(nt,{className:cn("w-6 h-6 transition-all duration-300",et?"text-primary fill-primary/20 stroke-[2.5px]":"text-muted-foreground/70 group-hover:text-foreground stroke-[2px]")})}),b.count!==void 0&&b.count>0&&jsxRuntimeExports.jsx(motion.span,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1.5 -right-1.5 min-w-[16px] h-4 px-0.5 rounded-full bg-primary text-primary-foreground text-[10px] font-bold flex items-center justify-center ring-2 ring-background shadow-sm",children:b.count>9?"9+":b.count})]}),jsxRuntimeExports.jsx(motion.span,{animate:{scale:et?1.05:1,fontWeight:et?600:500},className:cn("text-[10px] transition-colors duration-300",et?"text-primary":"text-muted-foreground/70 group-hover:text-foreground"),children:b.label})]})},b.path)})})})}function OutOfZoneScreen(){const{userLocation:e,refetchLocation:i,locationLoading:s}=useLocationContext();return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-6 text-center",children:[jsxRuntimeExports.jsx(motion.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"w-24 h-24 rounded-full bg-destructive/10 flex items-center justify-center mb-6",children:jsxRuntimeExports.jsx(TriangleAlert,{className:"w-12 h-12 text-destructive"})}),jsxRuntimeExports.jsx(motion.h1,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1},className:"text-2xl font-bold text-foreground mb-3",children:"Service Not Available"}),jsxRuntimeExports.jsx(motion.p,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},className:"text-muted-foreground mb-6 max-w-sm",children:"Sorry, Amma Cheythi Vanta is not yet available in your area. We're expanding soon!"}),e&&jsxRuntimeExports.jsx(motion.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"bg-secondary rounded-xl p-4 mb-6 w-full max-w-sm",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Your location"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-foreground",children:e.address})]})]})}),jsxRuntimeExports.jsx(motion.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},children:jsxRuntimeExports.jsxs(Button,{variant:"outline",onClick:i,disabled:s,className:"gap-2",children:[jsxRuntimeExports.jsx(RefreshCw,{className:`w-4 h-4 ${s?"animate-spin":""}`}),"Refresh Location"]})}),jsxRuntimeExports.jsx(motion.p,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},className:"text-xs text-muted-foreground mt-8",children:"If you think this is an error, please allow location access and try again."})]})}const categories$1=[{id:"biryani",name:"Biryani",image:"https://images.unsplash.com/photo-1563379091339-03b21ab4a4f8?w=400&q=80"},{id:"tiffins",name:"Tiffins",image:"https://images.unsplash.com/photo-1589301760014-d929f3979dbc?w=400&q=80"},{id:"thali",name:"Thali",image:"https://images.unsplash.com/photo-1574484284002-952d92456975?w=400&q=80"},{id:"curries",name:"Curries",image:"https://images.unsplash.com/photo-1545247181-516773cae754?w=400&q=80"},{id:"sweets",name:"Sweets",image:"https://img.freepik.com/premium-photo/indian-festival-assorted-sweet-food-mithai-white-background_466689-64857.jpg"},{id:"snacks",name:"Snacks",image:"https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?w=400&q=80"},{id:"rice",name:"Rice",image:"https://images.unsplash.com/photo-1512058564366-18510be2db19?w=400&q=80"},{id:"pickles",name:"Pickles",image:"https://media.istockphoto.com/id/528476560/photo/mango-pickle.jpg?s=612x612&w=0&k=20&c=1Hi9BzNeMEfKkBOMniMyxWF4mVs8LXrE-qHEu3F_R5M="}];function Categories({onSelectCategory:e,selectedCategory:i}){const s={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}}},a={hidden:{opacity:0,scale:.8},show:{opacity:1,scale:1}};return jsxRuntimeExports.jsxs("div",{className:"w-full",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between mb-3 px-1",children:jsxRuntimeExports.jsx("h3",{className:"font-semibold text-lg",children:"What's on your mind?"})}),jsxRuntimeExports.jsx(motion.div,{variants:s,initial:"hidden",animate:"show",className:"grid grid-cols-4 gap-x-4 gap-y-6",children:categories$1.map(b=>{const et=(i==null?void 0:i.toLowerCase())===b.name.toLowerCase();return jsxRuntimeExports.jsxs(motion.button,{variants:a,whileTap:{scale:.9},onClick:()=>e==null?void 0:e(b.name),className:"flex flex-col items-center gap-2 group w-full",children:[jsxRuntimeExports.jsxs("div",{className:`relative w-full aspect-square rounded-2xl overflow-hidden shadow-sm transition-all duration-300 ${et?"ring-4 ring-[#FFD700] ring-offset-2 ring-offset-background shadow-xl scale-105":"ring-1 ring-border/50 group-hover:ring-primary/50 group-hover:shadow-md"}`,children:[jsxRuntimeExports.jsx("img",{src:b.image,alt:b.name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110",loading:"lazy"}),jsxRuntimeExports.jsx("div",{className:`absolute inset-0 bg-gradient-to-t from-black/40 to-transparent transition-opacity ${et?"opacity-100":"opacity-0 group-hover:opacity-100"}`})]}),jsxRuntimeExports.jsx("span",{className:`text-[11px] sm:text-xs font-medium text-center truncate w-full transition-colors ${et?"text-primary font-bold":"text-foreground/90 group-hover:text-primary"}`,children:b.name})]},b.id)})})]})}var lottie$1={exports:{}};(function(module,exports){typeof document<"u"&&typeof navigator<"u"&&function(e,i){module.exports=i()}(commonjsGlobal,function(){var svgNS="http://www.w3.org/2000/svg",locationHref="",_useWebWorker=!1,initialDefaultFrame=-999999,setWebWorker=function(i){_useWebWorker=!!i},getWebWorker=function(){return _useWebWorker},setLocationHref=function(i){locationHref=i},getLocationHref=function(){return locationHref};function createTag(e){return document.createElement(e)}function extendPrototype(e,i){var s,a=e.length,b;for(s=0;s<a;s+=1){b=e[s].prototype;for(var et in b)Object.prototype.hasOwnProperty.call(b,et)&&(i.prototype[et]=b[et])}}function getDescriptor(e,i){return Object.getOwnPropertyDescriptor(e,i)}function createProxyFunction(e){function i(){}return i.prototype=e,i}var audioControllerFactory=function(){function e(i){this.audios=[],this.audioFactory=i,this._volume=1,this._isMuted=!1}return e.prototype={addAudio:function(s){this.audios.push(s)},pause:function(){var s,a=this.audios.length;for(s=0;s<a;s+=1)this.audios[s].pause()},resume:function(){var s,a=this.audios.length;for(s=0;s<a;s+=1)this.audios[s].resume()},setRate:function(s){var a,b=this.audios.length;for(a=0;a<b;a+=1)this.audios[a].setRate(s)},createAudio:function(s){return this.audioFactory?this.audioFactory(s):window.Howl?new window.Howl({src:[s]}):{isPlaying:!1,play:function(){this.isPlaying=!0},seek:function(){this.isPlaying=!1},playing:function(){},rate:function(){},setVolume:function(){}}},setAudioFactory:function(s){this.audioFactory=s},setVolume:function(s){this._volume=s,this._updateVolume()},mute:function(){this._isMuted=!0,this._updateVolume()},unmute:function(){this._isMuted=!1,this._updateVolume()},getVolume:function(){return this._volume},_updateVolume:function(){var s,a=this.audios.length;for(s=0;s<a;s+=1)this.audios[s].volume(this._volume*(this._isMuted?0:1))}},function(){return new e}}(),createTypedArray=function(){function e(s,a){var b=0,et=[],nt;switch(s){case"int16":case"uint8c":nt=1;break;default:nt=1.1;break}for(b=0;b<a;b+=1)et.push(nt);return et}function i(s,a){return s==="float32"?new Float32Array(a):s==="int16"?new Int16Array(a):s==="uint8c"?new Uint8ClampedArray(a):e(s,a)}return typeof Uint8ClampedArray=="function"&&typeof Float32Array=="function"?i:e}();function createSizedArray(e){return Array.apply(null,{length:e})}function _typeof$6(e){"@babel/helpers - typeof";return _typeof$6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$6(e)}var subframeEnabled=!0,expressionsPlugin=null,expressionsInterfaces=null,idPrefix$1="",isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),bmPow=Math.pow,bmSqrt=Math.sqrt,bmFloor=Math.floor,bmMax=Math.max,bmMin=Math.min,BMMath={};(function(){var e=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],i,s=e.length;for(i=0;i<s;i+=1)BMMath[e[i]]=Math[e[i]]})(),BMMath.random=Math.random,BMMath.abs=function(e){var i=_typeof$6(e);if(i==="object"&&e.length){var s=createSizedArray(e.length),a,b=e.length;for(a=0;a<b;a+=1)s[a]=Math.abs(e[a]);return s}return Math.abs(e)};var defaultCurveSegments=150,degToRads=Math.PI/180,roundCorner=.5519;function styleDiv(e){e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.display="block",e.style.transformOrigin="0 0",e.style.webkitTransformOrigin="0 0",e.style.backfaceVisibility="visible",e.style.webkitBackfaceVisibility="visible",e.style.transformStyle="preserve-3d",e.style.webkitTransformStyle="preserve-3d",e.style.mozTransformStyle="preserve-3d"}function BMEnterFrameEvent(e,i,s,a){this.type=e,this.currentTime=i,this.totalTime=s,this.direction=a<0?-1:1}function BMCompleteEvent(e,i){this.type=e,this.direction=i<0?-1:1}function BMCompleteLoopEvent(e,i,s,a){this.type=e,this.currentLoop=s,this.totalLoops=i,this.direction=a<0?-1:1}function BMSegmentStartEvent(e,i,s){this.type=e,this.firstFrame=i,this.totalFrames=s}function BMDestroyEvent(e,i){this.type=e,this.target=i}function BMRenderFrameErrorEvent(e,i){this.type="renderFrameError",this.nativeError=e,this.currentTime=i}function BMConfigErrorEvent(e){this.type="configError",this.nativeError=e}var createElementID=function(){var e=0;return function(){return e+=1,idPrefix$1+"__lottie_element_"+e}}();function HSVtoRGB(e,i,s){var a,b,et,nt,c,ct,pt,xt;switch(nt=Math.floor(e*6),c=e*6-nt,ct=s*(1-i),pt=s*(1-c*i),xt=s*(1-(1-c)*i),nt%6){case 0:a=s,b=xt,et=ct;break;case 1:a=pt,b=s,et=ct;break;case 2:a=ct,b=s,et=xt;break;case 3:a=ct,b=pt,et=s;break;case 4:a=xt,b=ct,et=s;break;case 5:a=s,b=ct,et=pt;break}return[a,b,et]}function RGBtoHSV(e,i,s){var a=Math.max(e,i,s),b=Math.min(e,i,s),et=a-b,nt,c=a===0?0:et/a,ct=a/255;switch(a){case b:nt=0;break;case e:nt=i-s+et*(i<s?6:0),nt/=6*et;break;case i:nt=s-e+et*2,nt/=6*et;break;case s:nt=e-i+et*4,nt/=6*et;break}return[nt,c,ct]}function addSaturationToRGB(e,i){var s=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return s[1]+=i,s[1]>1?s[1]=1:s[1]<=0&&(s[1]=0),HSVtoRGB(s[0],s[1],s[2])}function addBrightnessToRGB(e,i){var s=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return s[2]+=i,s[2]>1?s[2]=1:s[2]<0&&(s[2]=0),HSVtoRGB(s[0],s[1],s[2])}function addHueToRGB(e,i){var s=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return s[0]+=i/360,s[0]>1?s[0]-=1:s[0]<0&&(s[0]+=1),HSVtoRGB(s[0],s[1],s[2])}var rgbToHex=function(){var e=[],i,s;for(i=0;i<256;i+=1)s=i.toString(16),e[i]=s.length===1?"0"+s:s;return function(a,b,et){return a<0&&(a=0),b<0&&(b=0),et<0&&(et=0),"#"+e[a]+e[b]+e[et]}}(),setSubframeEnabled=function(i){subframeEnabled=!!i},getSubframeEnabled=function(){return subframeEnabled},setExpressionsPlugin=function(i){expressionsPlugin=i},getExpressionsPlugin=function(){return expressionsPlugin},setExpressionInterfaces=function(i){expressionsInterfaces=i},getExpressionInterfaces=function(){return expressionsInterfaces},setDefaultCurveSegments=function(i){defaultCurveSegments=i},getDefaultCurveSegments=function(){return defaultCurveSegments},setIdPrefix=function(i){idPrefix$1=i};function createNS(e){return document.createElementNS(svgNS,e)}function _typeof$5(e){"@babel/helpers - typeof";return _typeof$5=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$5(e)}var dataManager=function(){var e=1,i=[],s,a,b={onmessage:function(){},postMessage:function(Rt){s({data:Rt})}},et={postMessage:function(Rt){b.onmessage({data:Rt})}};function nt(Et){if(window.Worker&&window.Blob&&getWebWorker()){var Rt=new Blob(["var _workerSelf = self; self.onmessage = ",Et.toString()],{type:"text/javascript"}),Nt=URL.createObjectURL(Rt);return new Worker(Nt)}return s=Et,b}function c(){a||(a=nt(function(Rt){function Nt(){function Gt(_i,xr){var gr,rr,cr=_i.length,Hr,$r,_n,fn;for(rr=0;rr<cr;rr+=1)if(gr=_i[rr],"ks"in gr&&!gr.completed){if(gr.completed=!0,gr.hasMask){var jn=gr.masksProperties;for($r=jn.length,Hr=0;Hr<$r;Hr+=1)if(jn[Hr].pt.k.i)Zt(jn[Hr].pt.k);else for(fn=jn[Hr].pt.k.length,_n=0;_n<fn;_n+=1)jn[Hr].pt.k[_n].s&&Zt(jn[Hr].pt.k[_n].s[0]),jn[Hr].pt.k[_n].e&&Zt(jn[Hr].pt.k[_n].e[0])}gr.ty===0?(gr.layers=Lt(gr.refId,xr),Gt(gr.layers,xr)):gr.ty===4?Vt(gr.shapes):gr.ty===5&&rn(gr)}}function Dt(_i,xr){if(_i){var gr=0,rr=_i.length;for(gr=0;gr<rr;gr+=1)_i[gr].t===1&&(_i[gr].data.layers=Lt(_i[gr].data.refId,xr),Gt(_i[gr].data.layers,xr))}}function Bt(_i,xr){for(var gr=0,rr=xr.length;gr<rr;){if(xr[gr].id===_i)return xr[gr];gr+=1}return null}function Lt(_i,xr){var gr=Bt(_i,xr);return gr?gr.layers.__used?JSON.parse(JSON.stringify(gr.layers)):(gr.layers.__used=!0,gr.layers):null}function Vt(_i){var xr,gr=_i.length,rr,cr;for(xr=gr-1;xr>=0;xr-=1)if(_i[xr].ty==="sh")if(_i[xr].ks.k.i)Zt(_i[xr].ks.k);else for(cr=_i[xr].ks.k.length,rr=0;rr<cr;rr+=1)_i[xr].ks.k[rr].s&&Zt(_i[xr].ks.k[rr].s[0]),_i[xr].ks.k[rr].e&&Zt(_i[xr].ks.k[rr].e[0]);else _i[xr].ty==="gr"&&Vt(_i[xr].it)}function Zt(_i){var xr,gr=_i.i.length;for(xr=0;xr<gr;xr+=1)_i.i[xr][0]+=_i.v[xr][0],_i.i[xr][1]+=_i.v[xr][1],_i.o[xr][0]+=_i.v[xr][0],_i.o[xr][1]+=_i.v[xr][1]}function nr(_i,xr){var gr=xr?xr.split("."):[100,100,100];return _i[0]>gr[0]?!0:gr[0]>_i[0]?!1:_i[1]>gr[1]?!0:gr[1]>_i[1]?!1:_i[2]>gr[2]?!0:gr[2]>_i[2]?!1:null}var ur=function(){var _i=[4,4,14];function xr(rr){var cr=rr.t.d;rr.t.d={k:[{s:cr,t:0}]}}function gr(rr){var cr,Hr=rr.length;for(cr=0;cr<Hr;cr+=1)rr[cr].ty===5&&xr(rr[cr])}return function(rr){if(nr(_i,rr.v)&&(gr(rr.layers),rr.assets)){var cr,Hr=rr.assets.length;for(cr=0;cr<Hr;cr+=1)rr.assets[cr].layers&&gr(rr.assets[cr].layers)}}}(),_r=function(){var _i=[4,7,99];return function(xr){if(xr.chars&&!nr(_i,xr.v)){var gr,rr=xr.chars.length;for(gr=0;gr<rr;gr+=1){var cr=xr.chars[gr];cr.data&&cr.data.shapes&&(Vt(cr.data.shapes),cr.data.ip=0,cr.data.op=99999,cr.data.st=0,cr.data.sr=1,cr.data.ks={p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0}},xr.chars[gr].t||(cr.data.shapes.push({ty:"no"}),cr.data.shapes[0].it.push({p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0},sk:{k:0,a:0},sa:{k:0,a:0},ty:"tr"})))}}}}(),Ur=function(){var _i=[5,7,15];function xr(rr){var cr=rr.t.p;typeof cr.a=="number"&&(cr.a={a:0,k:cr.a}),typeof cr.p=="number"&&(cr.p={a:0,k:cr.p}),typeof cr.r=="number"&&(cr.r={a:0,k:cr.r})}function gr(rr){var cr,Hr=rr.length;for(cr=0;cr<Hr;cr+=1)rr[cr].ty===5&&xr(rr[cr])}return function(rr){if(nr(_i,rr.v)&&(gr(rr.layers),rr.assets)){var cr,Hr=rr.assets.length;for(cr=0;cr<Hr;cr+=1)rr.assets[cr].layers&&gr(rr.assets[cr].layers)}}}(),ln=function(){var _i=[4,1,9];function xr(rr){var cr,Hr=rr.length,$r,_n;for(cr=0;cr<Hr;cr+=1)if(rr[cr].ty==="gr")xr(rr[cr].it);else if(rr[cr].ty==="fl"||rr[cr].ty==="st")if(rr[cr].c.k&&rr[cr].c.k[0].i)for(_n=rr[cr].c.k.length,$r=0;$r<_n;$r+=1)rr[cr].c.k[$r].s&&(rr[cr].c.k[$r].s[0]/=255,rr[cr].c.k[$r].s[1]/=255,rr[cr].c.k[$r].s[2]/=255,rr[cr].c.k[$r].s[3]/=255),rr[cr].c.k[$r].e&&(rr[cr].c.k[$r].e[0]/=255,rr[cr].c.k[$r].e[1]/=255,rr[cr].c.k[$r].e[2]/=255,rr[cr].c.k[$r].e[3]/=255);else rr[cr].c.k[0]/=255,rr[cr].c.k[1]/=255,rr[cr].c.k[2]/=255,rr[cr].c.k[3]/=255}function gr(rr){var cr,Hr=rr.length;for(cr=0;cr<Hr;cr+=1)rr[cr].ty===4&&xr(rr[cr].shapes)}return function(rr){if(nr(_i,rr.v)&&(gr(rr.layers),rr.assets)){var cr,Hr=rr.assets.length;for(cr=0;cr<Hr;cr+=1)rr.assets[cr].layers&&gr(rr.assets[cr].layers)}}}(),an=function(){var _i=[4,4,18];function xr(rr){var cr,Hr=rr.length,$r,_n;for(cr=Hr-1;cr>=0;cr-=1)if(rr[cr].ty==="sh")if(rr[cr].ks.k.i)rr[cr].ks.k.c=rr[cr].closed;else for(_n=rr[cr].ks.k.length,$r=0;$r<_n;$r+=1)rr[cr].ks.k[$r].s&&(rr[cr].ks.k[$r].s[0].c=rr[cr].closed),rr[cr].ks.k[$r].e&&(rr[cr].ks.k[$r].e[0].c=rr[cr].closed);else rr[cr].ty==="gr"&&xr(rr[cr].it)}function gr(rr){var cr,Hr,$r=rr.length,_n,fn,jn,vs;for(Hr=0;Hr<$r;Hr+=1){if(cr=rr[Hr],cr.hasMask){var Cs=cr.masksProperties;for(fn=Cs.length,_n=0;_n<fn;_n+=1)if(Cs[_n].pt.k.i)Cs[_n].pt.k.c=Cs[_n].cl;else for(vs=Cs[_n].pt.k.length,jn=0;jn<vs;jn+=1)Cs[_n].pt.k[jn].s&&(Cs[_n].pt.k[jn].s[0].c=Cs[_n].cl),Cs[_n].pt.k[jn].e&&(Cs[_n].pt.k[jn].e[0].c=Cs[_n].cl)}cr.ty===4&&xr(cr.shapes)}}return function(rr){if(nr(_i,rr.v)&&(gr(rr.layers),rr.assets)){var cr,Hr=rr.assets.length;for(cr=0;cr<Hr;cr+=1)rr.assets[cr].layers&&gr(rr.assets[cr].layers)}}}();function Fr(_i){_i.__complete||(ln(_i),ur(_i),_r(_i),Ur(_i),an(_i),Gt(_i.layers,_i.assets),Dt(_i.chars,_i.assets),_i.__complete=!0)}function rn(_i){_i.t.a.length===0&&"m"in _i.t.p}var gn={};return gn.completeData=Fr,gn.checkColors=ln,gn.checkChars=_r,gn.checkPathProperties=Ur,gn.checkShapes=an,gn.completeLayers=Gt,gn}if(et.dataManager||(et.dataManager=Nt()),et.assetLoader||(et.assetLoader=function(){function Gt(Bt){var Lt=Bt.getResponseHeader("content-type");return Lt&&Bt.responseType==="json"&&Lt.indexOf("json")!==-1||Bt.response&&_typeof$5(Bt.response)==="object"?Bt.response:Bt.response&&typeof Bt.response=="string"?JSON.parse(Bt.response):Bt.responseText?JSON.parse(Bt.responseText):null}function Dt(Bt,Lt,Vt,Zt){var nr,ur=new XMLHttpRequest;try{ur.responseType="json"}catch{}ur.onreadystatechange=function(){if(ur.readyState===4)if(ur.status===200)nr=Gt(ur),Vt(nr);else try{nr=Gt(ur),Vt(nr)}catch(_r){Zt&&Zt(_r)}};try{ur.open(["G","E","T"].join(""),Bt,!0)}catch{ur.open(["G","E","T"].join(""),Lt+"/"+Bt,!0)}ur.send()}return{load:Dt}}()),Rt.data.type==="loadAnimation")et.assetLoader.load(Rt.data.path,Rt.data.fullPath,function(Gt){et.dataManager.completeData(Gt),et.postMessage({id:Rt.data.id,payload:Gt,status:"success"})},function(){et.postMessage({id:Rt.data.id,status:"error"})});else if(Rt.data.type==="complete"){var It=Rt.data.animation;et.dataManager.completeData(It),et.postMessage({id:Rt.data.id,payload:It,status:"success"})}else Rt.data.type==="loadData"&&et.assetLoader.load(Rt.data.path,Rt.data.fullPath,function(Gt){et.postMessage({id:Rt.data.id,payload:Gt,status:"success"})},function(){et.postMessage({id:Rt.data.id,status:"error"})})}),a.onmessage=function(Et){var Rt=Et.data,Nt=Rt.id,It=i[Nt];i[Nt]=null,Rt.status==="success"?It.onComplete(Rt.payload):It.onError&&It.onError()})}function ct(Et,Rt){e+=1;var Nt="processId_"+e;return i[Nt]={onComplete:Et,onError:Rt},Nt}function pt(Et,Rt,Nt){c();var It=ct(Rt,Nt);a.postMessage({type:"loadAnimation",path:Et,fullPath:window.location.origin+window.location.pathname,id:It})}function xt(Et,Rt,Nt){c();var It=ct(Rt,Nt);a.postMessage({type:"loadData",path:Et,fullPath:window.location.origin+window.location.pathname,id:It})}function St(Et,Rt,Nt){c();var It=ct(Rt,Nt);a.postMessage({type:"complete",animation:Et,id:It})}return{loadAnimation:pt,loadData:xt,completeAnimation:St}}(),ImagePreloader=function(){var e=function(){var Dt=createTag("canvas");Dt.width=1,Dt.height=1;var Bt=Dt.getContext("2d");return Bt.fillStyle="rgba(0,0,0,0)",Bt.fillRect(0,0,1,1),Dt}();function i(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function s(){this.loadedFootagesCount+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function a(Dt,Bt,Lt){var Vt="";if(Dt.e)Vt=Dt.p;else if(Bt){var Zt=Dt.p;Zt.indexOf("images/")!==-1&&(Zt=Zt.split("/")[1]),Vt=Bt+Zt}else Vt=Lt,Vt+=Dt.u?Dt.u:"",Vt+=Dt.p;return Vt}function b(Dt){var Bt=0,Lt=setInterval((function(){var Vt=Dt.getBBox();(Vt.width||Bt>500)&&(this._imageLoaded(),clearInterval(Lt)),Bt+=1}).bind(this),50)}function et(Dt){var Bt=a(Dt,this.assetsPath,this.path),Lt=createNS("image");isSafari?this.testImageLoaded(Lt):Lt.addEventListener("load",this._imageLoaded,!1),Lt.addEventListener("error",(function(){Vt.img=e,this._imageLoaded()}).bind(this),!1),Lt.setAttributeNS("http://www.w3.org/1999/xlink","href",Bt),this._elementHelper.append?this._elementHelper.append(Lt):this._elementHelper.appendChild(Lt);var Vt={img:Lt,assetData:Dt};return Vt}function nt(Dt){var Bt=a(Dt,this.assetsPath,this.path),Lt=createTag("img");Lt.crossOrigin="anonymous",Lt.addEventListener("load",this._imageLoaded,!1),Lt.addEventListener("error",(function(){Vt.img=e,this._imageLoaded()}).bind(this),!1),Lt.src=Bt;var Vt={img:Lt,assetData:Dt};return Vt}function c(Dt){var Bt={assetData:Dt},Lt=a(Dt,this.assetsPath,this.path);return dataManager.loadData(Lt,(function(Vt){Bt.img=Vt,this._footageLoaded()}).bind(this),(function(){Bt.img={},this._footageLoaded()}).bind(this)),Bt}function ct(Dt,Bt){this.imagesLoadedCb=Bt;var Lt,Vt=Dt.length;for(Lt=0;Lt<Vt;Lt+=1)Dt[Lt].layers||(!Dt[Lt].t||Dt[Lt].t==="seq"?(this.totalImages+=1,this.images.push(this._createImageData(Dt[Lt]))):Dt[Lt].t===3&&(this.totalFootages+=1,this.images.push(this.createFootageData(Dt[Lt]))))}function pt(Dt){this.path=Dt||""}function xt(Dt){this.assetsPath=Dt||""}function St(Dt){for(var Bt=0,Lt=this.images.length;Bt<Lt;){if(this.images[Bt].assetData===Dt)return this.images[Bt].img;Bt+=1}return null}function Et(){this.imagesLoadedCb=null,this.images.length=0}function Rt(){return this.totalImages===this.loadedAssets}function Nt(){return this.totalFootages===this.loadedFootagesCount}function It(Dt,Bt){Dt==="svg"?(this._elementHelper=Bt,this._createImageData=this.createImageData.bind(this)):this._createImageData=this.createImgData.bind(this)}function Gt(){this._imageLoaded=i.bind(this),this._footageLoaded=s.bind(this),this.testImageLoaded=b.bind(this),this.createFootageData=c.bind(this),this.assetsPath="",this.path="",this.totalImages=0,this.totalFootages=0,this.loadedAssets=0,this.loadedFootagesCount=0,this.imagesLoadedCb=null,this.images=[]}return Gt.prototype={loadAssets:ct,setAssetsPath:xt,setPath:pt,loadedImages:Rt,loadedFootages:Nt,destroy:Et,getAsset:St,createImgData:nt,createImageData:et,imageLoaded:i,footageLoaded:s,setCacheType:It},Gt}();function BaseEvent(){}BaseEvent.prototype={triggerEvent:function(i,s){if(this._cbs[i])for(var a=this._cbs[i],b=0;b<a.length;b+=1)a[b](s)},addEventListener:function(i,s){return this._cbs[i]||(this._cbs[i]=[]),this._cbs[i].push(s),(function(){this.removeEventListener(i,s)}).bind(this)},removeEventListener:function(i,s){if(!s)this._cbs[i]=null;else if(this._cbs[i]){for(var a=0,b=this._cbs[i].length;a<b;)this._cbs[i][a]===s&&(this._cbs[i].splice(a,1),a-=1,b-=1),a+=1;this._cbs[i].length||(this._cbs[i]=null)}}};var markerParser=function(){function e(i){for(var s=i.split(`\r
`),a={},b,et=0,nt=0;nt<s.length;nt+=1)b=s[nt].split(":"),b.length===2&&(a[b[0]]=b[1].trim(),et+=1);if(et===0)throw new Error;return a}return function(i){for(var s=[],a=0;a<i.length;a+=1){var b=i[a],et={time:b.tm,duration:b.dr};try{et.payload=JSON.parse(i[a].cm)}catch{try{et.payload=e(i[a].cm)}catch{et.payload={name:i[a].cm}}}s.push(et)}return s}}(),ProjectInterface=function(){function e(i){this.compositions.push(i)}return function(){function i(s){for(var a=0,b=this.compositions.length;a<b;){if(this.compositions[a].data&&this.compositions[a].data.nm===s)return this.compositions[a].prepareFrame&&this.compositions[a].data.xt&&this.compositions[a].prepareFrame(this.currentFrame),this.compositions[a].compInterface;a+=1}return null}return i.compositions=[],i.currentFrame=0,i.registerComposition=e,i}}(),renderers={},registerRenderer=function(i,s){renderers[i]=s};function getRenderer(e){return renderers[e]}function getRegisteredRenderer(){if(renderers.canvas)return"canvas";for(var e in renderers)if(renderers[e])return e;return""}function _typeof$4(e){"@babel/helpers - typeof";return _typeof$4=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$4(e)}var AnimationItem=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.firstFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=createElementID(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.isSubframeEnabled=getSubframeEnabled(),this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=ProjectInterface(),this.imagePreloader=new ImagePreloader,this.audioController=audioControllerFactory(),this.markers=[],this.configAnimation=this.configAnimation.bind(this),this.onSetupError=this.onSetupError.bind(this),this.onSegmentComplete=this.onSegmentComplete.bind(this),this.drawnFrameEvent=new BMEnterFrameEvent("drawnFrame",0,0,0),this.expressionsPlugin=getExpressionsPlugin()};extendPrototype([BaseEvent],AnimationItem),AnimationItem.prototype.setParams=function(e){(e.wrapper||e.container)&&(this.wrapper=e.wrapper||e.container);var i="svg";e.animType?i=e.animType:e.renderer&&(i=e.renderer);var s=getRenderer(i);this.renderer=new s(this,e.rendererSettings),this.imagePreloader.setCacheType(i,this.renderer.globalData.defs),this.renderer.setProjectInterface(this.projectInterface),this.animType=i,e.loop===""||e.loop===null||e.loop===void 0||e.loop===!0?this.loop=!0:e.loop===!1?this.loop=!1:this.loop=parseInt(e.loop,10),this.autoplay="autoplay"in e?e.autoplay:!0,this.name=e.name?e.name:"",this.autoloadSegments=Object.prototype.hasOwnProperty.call(e,"autoloadSegments")?e.autoloadSegments:!0,this.assetsPath=e.assetsPath,this.initialSegment=e.initialSegment,e.audioFactory&&this.audioController.setAudioFactory(e.audioFactory),e.animationData?this.setupAnimation(e.animationData):e.path&&(e.path.lastIndexOf("\\")!==-1?this.path=e.path.substr(0,e.path.lastIndexOf("\\")+1):this.path=e.path.substr(0,e.path.lastIndexOf("/")+1),this.fileName=e.path.substr(e.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),dataManager.loadAnimation(e.path,this.configAnimation,this.onSetupError))},AnimationItem.prototype.onSetupError=function(){this.trigger("data_failed")},AnimationItem.prototype.setupAnimation=function(e){dataManager.completeAnimation(e,this.configAnimation)},AnimationItem.prototype.setData=function(e,i){i&&_typeof$4(i)!=="object"&&(i=JSON.parse(i));var s={wrapper:e,animationData:i},a=e.attributes;s.path=a.getNamedItem("data-animation-path")?a.getNamedItem("data-animation-path").value:a.getNamedItem("data-bm-path")?a.getNamedItem("data-bm-path").value:a.getNamedItem("bm-path")?a.getNamedItem("bm-path").value:"",s.animType=a.getNamedItem("data-anim-type")?a.getNamedItem("data-anim-type").value:a.getNamedItem("data-bm-type")?a.getNamedItem("data-bm-type").value:a.getNamedItem("bm-type")?a.getNamedItem("bm-type").value:a.getNamedItem("data-bm-renderer")?a.getNamedItem("data-bm-renderer").value:a.getNamedItem("bm-renderer")?a.getNamedItem("bm-renderer").value:getRegisteredRenderer()||"canvas";var b=a.getNamedItem("data-anim-loop")?a.getNamedItem("data-anim-loop").value:a.getNamedItem("data-bm-loop")?a.getNamedItem("data-bm-loop").value:a.getNamedItem("bm-loop")?a.getNamedItem("bm-loop").value:"";b==="false"?s.loop=!1:b==="true"?s.loop=!0:b!==""&&(s.loop=parseInt(b,10));var et=a.getNamedItem("data-anim-autoplay")?a.getNamedItem("data-anim-autoplay").value:a.getNamedItem("data-bm-autoplay")?a.getNamedItem("data-bm-autoplay").value:a.getNamedItem("bm-autoplay")?a.getNamedItem("bm-autoplay").value:!0;s.autoplay=et!=="false",s.name=a.getNamedItem("data-name")?a.getNamedItem("data-name").value:a.getNamedItem("data-bm-name")?a.getNamedItem("data-bm-name").value:a.getNamedItem("bm-name")?a.getNamedItem("bm-name").value:"";var nt=a.getNamedItem("data-anim-prerender")?a.getNamedItem("data-anim-prerender").value:a.getNamedItem("data-bm-prerender")?a.getNamedItem("data-bm-prerender").value:a.getNamedItem("bm-prerender")?a.getNamedItem("bm-prerender").value:"";nt==="false"&&(s.prerender=!1),s.path?this.setParams(s):this.trigger("destroy")},AnimationItem.prototype.includeLayers=function(e){e.op>this.animationData.op&&(this.animationData.op=e.op,this.totalFrames=Math.floor(e.op-this.animationData.ip));var i=this.animationData.layers,s,a=i.length,b=e.layers,et,nt=b.length;for(et=0;et<nt;et+=1)for(s=0;s<a;){if(i[s].id===b[et].id){i[s]=b[et];break}s+=1}if((e.chars||e.fonts)&&(this.renderer.globalData.fontManager.addChars(e.chars),this.renderer.globalData.fontManager.addFonts(e.fonts,this.renderer.globalData.defs)),e.assets)for(a=e.assets.length,s=0;s<a;s+=1)this.animationData.assets.push(e.assets[s]);this.animationData.__complete=!1,dataManager.completeAnimation(this.animationData,this.onSegmentComplete)},AnimationItem.prototype.onSegmentComplete=function(e){this.animationData=e;var i=getExpressionsPlugin();i&&i.initExpressions(this),this.loadNextSegment()},AnimationItem.prototype.loadNextSegment=function(){var e=this.animationData.segments;if(!e||e.length===0||!this.autoloadSegments){this.trigger("data_ready"),this.timeCompleted=this.totalFrames;return}var i=e.shift();this.timeCompleted=i.time*this.frameRate;var s=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,dataManager.loadData(s,this.includeLayers.bind(this),(function(){this.trigger("data_failed")}).bind(this))},AnimationItem.prototype.loadSegments=function(){var e=this.animationData.segments;e||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},AnimationItem.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},AnimationItem.prototype.configAnimation=function(e){if(this.renderer)try{this.animationData=e,this.initialSegment?(this.totalFrames=Math.floor(this.initialSegment[1]-this.initialSegment[0]),this.firstFrame=Math.round(this.initialSegment[0])):(this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.firstFrame=Math.round(this.animationData.ip)),this.renderer.configAnimation(e),e.assets||(e.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(e.assets),this.markers=markerParser(e.markers||[]),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded(),this.isPaused&&this.audioController.pause()}catch(i){this.triggerConfigError(i)}},AnimationItem.prototype.waitForFontsLoaded=function(){this.renderer&&(this.renderer.globalData.fontManager.isLoaded?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},AnimationItem.prototype.checkLoaded=function(){if(!this.isLoaded&&this.renderer.globalData.fontManager.isLoaded&&(this.imagePreloader.loadedImages()||this.renderer.rendererType!=="canvas")&&this.imagePreloader.loadedFootages()){this.isLoaded=!0;var e=getExpressionsPlugin();e&&e.initExpressions(this),this.renderer.initItems(),setTimeout((function(){this.trigger("DOMLoaded")}).bind(this),0),this.gotoFrame(),this.autoplay&&this.play()}},AnimationItem.prototype.resize=function(e,i){var s=typeof e=="number"?e:void 0,a=typeof i=="number"?i:void 0;this.renderer.updateContainerSize(s,a)},AnimationItem.prototype.setSubframe=function(e){this.isSubframeEnabled=!!e},AnimationItem.prototype.gotoFrame=function(){this.currentFrame=this.isSubframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame(),this.trigger("drawnFrame")},AnimationItem.prototype.renderFrame=function(){if(!(this.isLoaded===!1||!this.renderer))try{this.expressionsPlugin&&this.expressionsPlugin.resetFrame(),this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(e){this.triggerRenderFrameError(e)}},AnimationItem.prototype.play=function(e){e&&this.name!==e||this.isPaused===!0&&(this.isPaused=!1,this.trigger("_play"),this.audioController.resume(),this._idle&&(this._idle=!1,this.trigger("_active")))},AnimationItem.prototype.pause=function(e){e&&this.name!==e||this.isPaused===!1&&(this.isPaused=!0,this.trigger("_pause"),this._idle=!0,this.trigger("_idle"),this.audioController.pause())},AnimationItem.prototype.togglePause=function(e){e&&this.name!==e||(this.isPaused===!0?this.play():this.pause())},AnimationItem.prototype.stop=function(e){e&&this.name!==e||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},AnimationItem.prototype.getMarkerData=function(e){for(var i,s=0;s<this.markers.length;s+=1)if(i=this.markers[s],i.payload&&i.payload.name===e)return i;return null},AnimationItem.prototype.goToAndStop=function(e,i,s){if(!(s&&this.name!==s)){var a=Number(e);if(isNaN(a)){var b=this.getMarkerData(e);b&&this.goToAndStop(b.time,!0)}else i?this.setCurrentRawFrameValue(e):this.setCurrentRawFrameValue(e*this.frameModifier);this.pause()}},AnimationItem.prototype.goToAndPlay=function(e,i,s){if(!(s&&this.name!==s)){var a=Number(e);if(isNaN(a)){var b=this.getMarkerData(e);b&&(b.duration?this.playSegments([b.time,b.time+b.duration],!0):this.goToAndStop(b.time,!0))}else this.goToAndStop(a,i,s);this.play()}},AnimationItem.prototype.advanceTime=function(e){if(!(this.isPaused===!0||this.isLoaded===!1)){var i=this.currentRawFrame+e*this.frameModifier,s=!1;i>=this.totalFrames-1&&this.frameModifier>0?!this.loop||this.playCount===this.loop?this.checkSegments(i>this.totalFrames?i%this.totalFrames:0)||(s=!0,i=this.totalFrames-1):i>=this.totalFrames?(this.playCount+=1,this.checkSegments(i%this.totalFrames)||(this.setCurrentRawFrameValue(i%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(i):i<0?this.checkSegments(i%this.totalFrames)||(this.loop&&!(this.playCount--<=0&&this.loop!==!0)?(this.setCurrentRawFrameValue(this.totalFrames+i%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0):(s=!0,i=0)):this.setCurrentRawFrameValue(i),s&&(this.setCurrentRawFrameValue(i),this.pause(),this.trigger("complete"))}},AnimationItem.prototype.adjustSegment=function(e,i){this.playCount=0,e[1]<e[0]?(this.frameModifier>0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.totalFrames=e[0]-e[1],this.timeCompleted=this.totalFrames,this.firstFrame=e[1],this.setCurrentRawFrameValue(this.totalFrames-.001-i)):e[1]>e[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.totalFrames=e[1]-e[0],this.timeCompleted=this.totalFrames,this.firstFrame=e[0],this.setCurrentRawFrameValue(.001+i)),this.trigger("segmentStart")},AnimationItem.prototype.setSegment=function(e,i){var s=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<e?s=e:this.currentRawFrame+this.firstFrame>i&&(s=i-e)),this.firstFrame=e,this.totalFrames=i-e,this.timeCompleted=this.totalFrames,s!==-1&&this.goToAndStop(s,!0)},AnimationItem.prototype.playSegments=function(e,i){if(i&&(this.segments.length=0),_typeof$4(e[0])==="object"){var s,a=e.length;for(s=0;s<a;s+=1)this.segments.push(e[s])}else this.segments.push(e);this.segments.length&&i&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},AnimationItem.prototype.resetSegments=function(e){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),e&&this.checkSegments(0)},AnimationItem.prototype.checkSegments=function(e){return this.segments.length?(this.adjustSegment(this.segments.shift(),e),!0):!1},AnimationItem.prototype.destroy=function(e){e&&this.name!==e||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=null,this.onLoopComplete=null,this.onComplete=null,this.onSegmentStart=null,this.onDestroy=null,this.renderer=null,this.expressionsPlugin=null,this.imagePreloader=null,this.projectInterface=null)},AnimationItem.prototype.setCurrentRawFrameValue=function(e){this.currentRawFrame=e,this.gotoFrame()},AnimationItem.prototype.setSpeed=function(e){this.playSpeed=e,this.updaFrameModifier()},AnimationItem.prototype.setDirection=function(e){this.playDirection=e<0?-1:1,this.updaFrameModifier()},AnimationItem.prototype.setLoop=function(e){this.loop=e},AnimationItem.prototype.setVolume=function(e,i){i&&this.name!==i||this.audioController.setVolume(e)},AnimationItem.prototype.getVolume=function(){return this.audioController.getVolume()},AnimationItem.prototype.mute=function(e){e&&this.name!==e||this.audioController.mute()},AnimationItem.prototype.unmute=function(e){e&&this.name!==e||this.audioController.unmute()},AnimationItem.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection,this.audioController.setRate(this.playSpeed*this.playDirection)},AnimationItem.prototype.getPath=function(){return this.path},AnimationItem.prototype.getAssetsPath=function(e){var i="";if(e.e)i=e.p;else if(this.assetsPath){var s=e.p;s.indexOf("images/")!==-1&&(s=s.split("/")[1]),i=this.assetsPath+s}else i=this.path,i+=e.u?e.u:"",i+=e.p;return i},AnimationItem.prototype.getAssetData=function(e){for(var i=0,s=this.assets.length;i<s;){if(e===this.assets[i].id)return this.assets[i];i+=1}return null},AnimationItem.prototype.hide=function(){this.renderer.hide()},AnimationItem.prototype.show=function(){this.renderer.show()},AnimationItem.prototype.getDuration=function(e){return e?this.totalFrames:this.totalFrames/this.frameRate},AnimationItem.prototype.updateDocumentData=function(e,i,s){try{var a=this.renderer.getElementByPath(e);a.updateDocumentData(i,s)}catch{}},AnimationItem.prototype.trigger=function(e){if(this._cbs&&this._cbs[e])switch(e){case"enterFrame":this.triggerEvent(e,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameModifier));break;case"drawnFrame":this.drawnFrameEvent.currentTime=this.currentFrame,this.drawnFrameEvent.totalTime=this.totalFrames,this.drawnFrameEvent.direction=this.frameModifier,this.triggerEvent(e,this.drawnFrameEvent);break;case"loopComplete":this.triggerEvent(e,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(e,new BMCompleteEvent(e,this.frameMult));break;case"segmentStart":this.triggerEvent(e,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(e,new BMDestroyEvent(e,this));break;default:this.triggerEvent(e)}e==="enterFrame"&&this.onEnterFrame&&this.onEnterFrame.call(this,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameMult)),e==="loopComplete"&&this.onLoopComplete&&this.onLoopComplete.call(this,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult)),e==="complete"&&this.onComplete&&this.onComplete.call(this,new BMCompleteEvent(e,this.frameMult)),e==="segmentStart"&&this.onSegmentStart&&this.onSegmentStart.call(this,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames)),e==="destroy"&&this.onDestroy&&this.onDestroy.call(this,new BMDestroyEvent(e,this))},AnimationItem.prototype.triggerRenderFrameError=function(e){var i=new BMRenderFrameErrorEvent(e,this.currentFrame);this.triggerEvent("error",i),this.onError&&this.onError.call(this,i)},AnimationItem.prototype.triggerConfigError=function(e){var i=new BMConfigErrorEvent(e,this.currentFrame);this.triggerEvent("error",i),this.onError&&this.onError.call(this,i)};var animationManager=function(){var e={},i=[],s=0,a=0,b=0,et=!0,nt=!1;function c(xr){for(var gr=0,rr=xr.target;gr<a;)i[gr].animation===rr&&(i.splice(gr,1),gr-=1,a-=1,rr.isPaused||St()),gr+=1}function ct(xr,gr){if(!xr)return null;for(var rr=0;rr<a;){if(i[rr].elem===xr&&i[rr].elem!==null)return i[rr].animation;rr+=1}var cr=new AnimationItem;return Et(cr,xr),cr.setData(xr,gr),cr}function pt(){var xr,gr=i.length,rr=[];for(xr=0;xr<gr;xr+=1)rr.push(i[xr].animation);return rr}function xt(){b+=1,ln()}function St(){b-=1}function Et(xr,gr){xr.addEventListener("destroy",c),xr.addEventListener("_active",xt),xr.addEventListener("_idle",St),i.push({elem:gr,animation:xr}),a+=1}function Rt(xr){var gr=new AnimationItem;return Et(gr,null),gr.setParams(xr),gr}function Nt(xr,gr){var rr;for(rr=0;rr<a;rr+=1)i[rr].animation.setSpeed(xr,gr)}function It(xr,gr){var rr;for(rr=0;rr<a;rr+=1)i[rr].animation.setDirection(xr,gr)}function Gt(xr){var gr;for(gr=0;gr<a;gr+=1)i[gr].animation.play(xr)}function Dt(xr){var gr=xr-s,rr;for(rr=0;rr<a;rr+=1)i[rr].animation.advanceTime(gr);s=xr,b&&!nt?window.requestAnimationFrame(Dt):et=!0}function Bt(xr){s=xr,window.requestAnimationFrame(Dt)}function Lt(xr){var gr;for(gr=0;gr<a;gr+=1)i[gr].animation.pause(xr)}function Vt(xr,gr,rr){var cr;for(cr=0;cr<a;cr+=1)i[cr].animation.goToAndStop(xr,gr,rr)}function Zt(xr){var gr;for(gr=0;gr<a;gr+=1)i[gr].animation.stop(xr)}function nr(xr){var gr;for(gr=0;gr<a;gr+=1)i[gr].animation.togglePause(xr)}function ur(xr){var gr;for(gr=a-1;gr>=0;gr-=1)i[gr].animation.destroy(xr)}function _r(xr,gr,rr){var cr=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),Hr,$r=cr.length;for(Hr=0;Hr<$r;Hr+=1)rr&&cr[Hr].setAttribute("data-bm-type",rr),ct(cr[Hr],xr);if(gr&&$r===0){rr||(rr="svg");var _n=document.getElementsByTagName("body")[0];_n.innerText="";var fn=createTag("div");fn.style.width="100%",fn.style.height="100%",fn.setAttribute("data-bm-type",rr),_n.appendChild(fn),ct(fn,xr)}}function Ur(){var xr;for(xr=0;xr<a;xr+=1)i[xr].animation.resize()}function ln(){!nt&&b&&et&&(window.requestAnimationFrame(Bt),et=!1)}function an(){nt=!0}function Fr(){nt=!1,ln()}function rn(xr,gr){var rr;for(rr=0;rr<a;rr+=1)i[rr].animation.setVolume(xr,gr)}function gn(xr){var gr;for(gr=0;gr<a;gr+=1)i[gr].animation.mute(xr)}function _i(xr){var gr;for(gr=0;gr<a;gr+=1)i[gr].animation.unmute(xr)}return e.registerAnimation=ct,e.loadAnimation=Rt,e.setSpeed=Nt,e.setDirection=It,e.play=Gt,e.pause=Lt,e.stop=Zt,e.togglePause=nr,e.searchAnimations=_r,e.resize=Ur,e.goToAndStop=Vt,e.destroy=ur,e.freeze=an,e.unfreeze=Fr,e.setVolume=rn,e.mute=gn,e.unmute=_i,e.getRegisteredAnimations=pt,e}(),BezierFactory=function(){var e={};e.getBezierEasing=s;var i={};function s(Bt,Lt,Vt,Zt,nr){var ur=nr||("bez_"+Bt+"_"+Lt+"_"+Vt+"_"+Zt).replace(/\./g,"p");if(i[ur])return i[ur];var _r=new Dt([Bt,Lt,Vt,Zt]);return i[ur]=_r,_r}var a=4,b=.001,et=1e-7,nt=10,c=11,ct=1/(c-1),pt=typeof Float32Array=="function";function xt(Bt,Lt){return 1-3*Lt+3*Bt}function St(Bt,Lt){return 3*Lt-6*Bt}function Et(Bt){return 3*Bt}function Rt(Bt,Lt,Vt){return((xt(Lt,Vt)*Bt+St(Lt,Vt))*Bt+Et(Lt))*Bt}function Nt(Bt,Lt,Vt){return 3*xt(Lt,Vt)*Bt*Bt+2*St(Lt,Vt)*Bt+Et(Lt)}function It(Bt,Lt,Vt,Zt,nr){var ur,_r,Ur=0;do _r=Lt+(Vt-Lt)/2,ur=Rt(_r,Zt,nr)-Bt,ur>0?Vt=_r:Lt=_r;while(Math.abs(ur)>et&&++Ur<nt);return _r}function Gt(Bt,Lt,Vt,Zt){for(var nr=0;nr<a;++nr){var ur=Nt(Lt,Vt,Zt);if(ur===0)return Lt;var _r=Rt(Lt,Vt,Zt)-Bt;Lt-=_r/ur}return Lt}function Dt(Bt){this._p=Bt,this._mSampleValues=pt?new Float32Array(c):new Array(c),this._precomputed=!1,this.get=this.get.bind(this)}return Dt.prototype={get:function(Lt){var Vt=this._p[0],Zt=this._p[1],nr=this._p[2],ur=this._p[3];return this._precomputed||this._precompute(),Vt===Zt&&nr===ur?Lt:Lt===0?0:Lt===1?1:Rt(this._getTForX(Lt),Zt,ur)},_precompute:function(){var Lt=this._p[0],Vt=this._p[1],Zt=this._p[2],nr=this._p[3];this._precomputed=!0,(Lt!==Vt||Zt!==nr)&&this._calcSampleValues()},_calcSampleValues:function(){for(var Lt=this._p[0],Vt=this._p[2],Zt=0;Zt<c;++Zt)this._mSampleValues[Zt]=Rt(Zt*ct,Lt,Vt)},_getTForX:function(Lt){for(var Vt=this._p[0],Zt=this._p[2],nr=this._mSampleValues,ur=0,_r=1,Ur=c-1;_r!==Ur&&nr[_r]<=Lt;++_r)ur+=ct;--_r;var ln=(Lt-nr[_r])/(nr[_r+1]-nr[_r]),an=ur+ln*ct,Fr=Nt(an,Vt,Zt);return Fr>=b?Gt(Lt,an,Vt,Zt):Fr===0?an:It(Lt,ur,ur+ct,Vt,Zt)}},e}(),pooling=function(){function e(i){return i.concat(createSizedArray(i.length))}return{double:e}}(),poolFactory=function(){return function(e,i,s){var a=0,b=e,et=createSizedArray(b),nt={newElement:c,release:ct};function c(){var pt;return a?(a-=1,pt=et[a]):pt=i(),pt}function ct(pt){a===b&&(et=pooling.double(et),b*=2),s&&s(pt),et[a]=pt,a+=1}return nt}}(),bezierLengthPool=function(){function e(){return{addedLength:0,percents:createTypedArray("float32",getDefaultCurveSegments()),lengths:createTypedArray("float32",getDefaultCurveSegments())}}return poolFactory(8,e)}(),segmentsLengthPool=function(){function e(){return{lengths:[],totalLength:0}}function i(s){var a,b=s.lengths.length;for(a=0;a<b;a+=1)bezierLengthPool.release(s.lengths[a]);s.lengths.length=0}return poolFactory(8,e,i)}();function bezFunction(){var e=Math;function i(Et,Rt,Nt,It,Gt,Dt){var Bt=Et*It+Rt*Gt+Nt*Dt-Gt*It-Dt*Et-Nt*Rt;return Bt>-.001&&Bt<.001}function s(Et,Rt,Nt,It,Gt,Dt,Bt,Lt,Vt){if(Nt===0&&Dt===0&&Vt===0)return i(Et,Rt,It,Gt,Bt,Lt);var Zt=e.sqrt(e.pow(It-Et,2)+e.pow(Gt-Rt,2)+e.pow(Dt-Nt,2)),nr=e.sqrt(e.pow(Bt-Et,2)+e.pow(Lt-Rt,2)+e.pow(Vt-Nt,2)),ur=e.sqrt(e.pow(Bt-It,2)+e.pow(Lt-Gt,2)+e.pow(Vt-Dt,2)),_r;return Zt>nr?Zt>ur?_r=Zt-nr-ur:_r=ur-nr-Zt:ur>nr?_r=ur-nr-Zt:_r=nr-Zt-ur,_r>-1e-4&&_r<1e-4}var a=function(){return function(Et,Rt,Nt,It){var Gt=getDefaultCurveSegments(),Dt,Bt,Lt,Vt,Zt,nr=0,ur,_r=[],Ur=[],ln=bezierLengthPool.newElement();for(Lt=Nt.length,Dt=0;Dt<Gt;Dt+=1){for(Zt=Dt/(Gt-1),ur=0,Bt=0;Bt<Lt;Bt+=1)Vt=bmPow(1-Zt,3)*Et[Bt]+3*bmPow(1-Zt,2)*Zt*Nt[Bt]+3*(1-Zt)*bmPow(Zt,2)*It[Bt]+bmPow(Zt,3)*Rt[Bt],_r[Bt]=Vt,Ur[Bt]!==null&&(ur+=bmPow(_r[Bt]-Ur[Bt],2)),Ur[Bt]=_r[Bt];ur&&(ur=bmSqrt(ur),nr+=ur),ln.percents[Dt]=Zt,ln.lengths[Dt]=nr}return ln.addedLength=nr,ln}}();function b(Et){var Rt=segmentsLengthPool.newElement(),Nt=Et.c,It=Et.v,Gt=Et.o,Dt=Et.i,Bt,Lt=Et._length,Vt=Rt.lengths,Zt=0;for(Bt=0;Bt<Lt-1;Bt+=1)Vt[Bt]=a(It[Bt],It[Bt+1],Gt[Bt],Dt[Bt+1]),Zt+=Vt[Bt].addedLength;return Nt&&Lt&&(Vt[Bt]=a(It[Bt],It[0],Gt[Bt],Dt[0]),Zt+=Vt[Bt].addedLength),Rt.totalLength=Zt,Rt}function et(Et){this.segmentLength=0,this.points=new Array(Et)}function nt(Et,Rt){this.partialLength=Et,this.point=Rt}var c=function(){var Et={};return function(Rt,Nt,It,Gt){var Dt=(Rt[0]+"_"+Rt[1]+"_"+Nt[0]+"_"+Nt[1]+"_"+It[0]+"_"+It[1]+"_"+Gt[0]+"_"+Gt[1]).replace(/\./g,"p");if(!Et[Dt]){var Bt=getDefaultCurveSegments(),Lt,Vt,Zt,nr,ur,_r=0,Ur,ln,an=null;Rt.length===2&&(Rt[0]!==Nt[0]||Rt[1]!==Nt[1])&&i(Rt[0],Rt[1],Nt[0],Nt[1],Rt[0]+It[0],Rt[1]+It[1])&&i(Rt[0],Rt[1],Nt[0],Nt[1],Nt[0]+Gt[0],Nt[1]+Gt[1])&&(Bt=2);var Fr=new et(Bt);for(Zt=It.length,Lt=0;Lt<Bt;Lt+=1){for(ln=createSizedArray(Zt),ur=Lt/(Bt-1),Ur=0,Vt=0;Vt<Zt;Vt+=1)nr=bmPow(1-ur,3)*Rt[Vt]+3*bmPow(1-ur,2)*ur*(Rt[Vt]+It[Vt])+3*(1-ur)*bmPow(ur,2)*(Nt[Vt]+Gt[Vt])+bmPow(ur,3)*Nt[Vt],ln[Vt]=nr,an!==null&&(Ur+=bmPow(ln[Vt]-an[Vt],2));Ur=bmSqrt(Ur),_r+=Ur,Fr.points[Lt]=new nt(Ur,ln),an=ln}Fr.segmentLength=_r,Et[Dt]=Fr}return Et[Dt]}}();function ct(Et,Rt){var Nt=Rt.percents,It=Rt.lengths,Gt=Nt.length,Dt=bmFloor((Gt-1)*Et),Bt=Et*Rt.addedLength,Lt=0;if(Dt===Gt-1||Dt===0||Bt===It[Dt])return Nt[Dt];for(var Vt=It[Dt]>Bt?-1:1,Zt=!0;Zt;)if(It[Dt]<=Bt&&It[Dt+1]>Bt?(Lt=(Bt-It[Dt])/(It[Dt+1]-It[Dt]),Zt=!1):Dt+=Vt,Dt<0||Dt>=Gt-1){if(Dt===Gt-1)return Nt[Dt];Zt=!1}return Nt[Dt]+(Nt[Dt+1]-Nt[Dt])*Lt}function pt(Et,Rt,Nt,It,Gt,Dt){var Bt=ct(Gt,Dt),Lt=1-Bt,Vt=e.round((Lt*Lt*Lt*Et[0]+(Bt*Lt*Lt+Lt*Bt*Lt+Lt*Lt*Bt)*Nt[0]+(Bt*Bt*Lt+Lt*Bt*Bt+Bt*Lt*Bt)*It[0]+Bt*Bt*Bt*Rt[0])*1e3)/1e3,Zt=e.round((Lt*Lt*Lt*Et[1]+(Bt*Lt*Lt+Lt*Bt*Lt+Lt*Lt*Bt)*Nt[1]+(Bt*Bt*Lt+Lt*Bt*Bt+Bt*Lt*Bt)*It[1]+Bt*Bt*Bt*Rt[1])*1e3)/1e3;return[Vt,Zt]}var xt=createTypedArray("float32",8);function St(Et,Rt,Nt,It,Gt,Dt,Bt){Gt<0?Gt=0:Gt>1&&(Gt=1);var Lt=ct(Gt,Bt);Dt=Dt>1?1:Dt;var Vt=ct(Dt,Bt),Zt,nr=Et.length,ur=1-Lt,_r=1-Vt,Ur=ur*ur*ur,ln=Lt*ur*ur*3,an=Lt*Lt*ur*3,Fr=Lt*Lt*Lt,rn=ur*ur*_r,gn=Lt*ur*_r+ur*Lt*_r+ur*ur*Vt,_i=Lt*Lt*_r+ur*Lt*Vt+Lt*ur*Vt,xr=Lt*Lt*Vt,gr=ur*_r*_r,rr=Lt*_r*_r+ur*Vt*_r+ur*_r*Vt,cr=Lt*Vt*_r+ur*Vt*Vt+Lt*_r*Vt,Hr=Lt*Vt*Vt,$r=_r*_r*_r,_n=Vt*_r*_r+_r*Vt*_r+_r*_r*Vt,fn=Vt*Vt*_r+_r*Vt*Vt+Vt*_r*Vt,jn=Vt*Vt*Vt;for(Zt=0;Zt<nr;Zt+=1)xt[Zt*4]=e.round((Ur*Et[Zt]+ln*Nt[Zt]+an*It[Zt]+Fr*Rt[Zt])*1e3)/1e3,xt[Zt*4+1]=e.round((rn*Et[Zt]+gn*Nt[Zt]+_i*It[Zt]+xr*Rt[Zt])*1e3)/1e3,xt[Zt*4+2]=e.round((gr*Et[Zt]+rr*Nt[Zt]+cr*It[Zt]+Hr*Rt[Zt])*1e3)/1e3,xt[Zt*4+3]=e.round(($r*Et[Zt]+_n*Nt[Zt]+fn*It[Zt]+jn*Rt[Zt])*1e3)/1e3;return xt}return{getSegmentsLength:b,getNewSegment:St,getPointInSegment:pt,buildBezierData:c,pointOnLine2D:i,pointOnLine3D:s}}var bez=bezFunction(),initFrame=initialDefaultFrame,mathAbs=Math.abs;function interpolateValue(e,i){var s=this.offsetTime,a;this.propType==="multidimensional"&&(a=createTypedArray("float32",this.pv.length));for(var b=i.lastIndex,et=b,nt=this.keyframes.length-1,c=!0,ct,pt,xt;c;){if(ct=this.keyframes[et],pt=this.keyframes[et+1],et===nt-1&&e>=pt.t-s){ct.h&&(ct=pt),b=0;break}if(pt.t-s>e){b=et;break}et<nt-1?et+=1:(b=0,c=!1)}xt=this.keyframesMetadata[et]||{};var St,Et,Rt,Nt,It,Gt,Dt=pt.t-s,Bt=ct.t-s,Lt;if(ct.to){xt.bezierData||(xt.bezierData=bez.buildBezierData(ct.s,pt.s||ct.e,ct.to,ct.ti));var Vt=xt.bezierData;if(e>=Dt||e<Bt){var Zt=e>=Dt?Vt.points.length-1:0;for(Et=Vt.points[Zt].point.length,St=0;St<Et;St+=1)a[St]=Vt.points[Zt].point[St]}else{xt.__fnct?Gt=xt.__fnct:(Gt=BezierFactory.getBezierEasing(ct.o.x,ct.o.y,ct.i.x,ct.i.y,ct.n).get,xt.__fnct=Gt),Rt=Gt((e-Bt)/(Dt-Bt));var nr=Vt.segmentLength*Rt,ur,_r=i.lastFrame<e&&i._lastKeyframeIndex===et?i._lastAddedLength:0;for(It=i.lastFrame<e&&i._lastKeyframeIndex===et?i._lastPoint:0,c=!0,Nt=Vt.points.length;c;){if(_r+=Vt.points[It].partialLength,nr===0||Rt===0||It===Vt.points.length-1){for(Et=Vt.points[It].point.length,St=0;St<Et;St+=1)a[St]=Vt.points[It].point[St];break}else if(nr>=_r&&nr<_r+Vt.points[It+1].partialLength){for(ur=(nr-_r)/Vt.points[It+1].partialLength,Et=Vt.points[It].point.length,St=0;St<Et;St+=1)a[St]=Vt.points[It].point[St]+(Vt.points[It+1].point[St]-Vt.points[It].point[St])*ur;break}It<Nt-1?It+=1:c=!1}i._lastPoint=It,i._lastAddedLength=_r-Vt.points[It].partialLength,i._lastKeyframeIndex=et}}else{var Ur,ln,an,Fr,rn;if(nt=ct.s.length,Lt=pt.s||ct.e,this.sh&&ct.h!==1)if(e>=Dt)a[0]=Lt[0],a[1]=Lt[1],a[2]=Lt[2];else if(e<=Bt)a[0]=ct.s[0],a[1]=ct.s[1],a[2]=ct.s[2];else{var gn=createQuaternion(ct.s),_i=createQuaternion(Lt),xr=(e-Bt)/(Dt-Bt);quaternionToEuler(a,slerp(gn,_i,xr))}else for(et=0;et<nt;et+=1)ct.h!==1&&(e>=Dt?Rt=1:e<Bt?Rt=0:(ct.o.x.constructor===Array?(xt.__fnct||(xt.__fnct=[]),xt.__fnct[et]?Gt=xt.__fnct[et]:(Ur=ct.o.x[et]===void 0?ct.o.x[0]:ct.o.x[et],ln=ct.o.y[et]===void 0?ct.o.y[0]:ct.o.y[et],an=ct.i.x[et]===void 0?ct.i.x[0]:ct.i.x[et],Fr=ct.i.y[et]===void 0?ct.i.y[0]:ct.i.y[et],Gt=BezierFactory.getBezierEasing(Ur,ln,an,Fr).get,xt.__fnct[et]=Gt)):xt.__fnct?Gt=xt.__fnct:(Ur=ct.o.x,ln=ct.o.y,an=ct.i.x,Fr=ct.i.y,Gt=BezierFactory.getBezierEasing(Ur,ln,an,Fr).get,ct.keyframeMetadata=Gt),Rt=Gt((e-Bt)/(Dt-Bt)))),Lt=pt.s||ct.e,rn=ct.h===1?ct.s[et]:ct.s[et]+(Lt[et]-ct.s[et])*Rt,this.propType==="multidimensional"?a[et]=rn:a=rn}return i.lastIndex=b,a}function slerp(e,i,s){var a=[],b=e[0],et=e[1],nt=e[2],c=e[3],ct=i[0],pt=i[1],xt=i[2],St=i[3],Et,Rt,Nt,It,Gt;return Rt=b*ct+et*pt+nt*xt+c*St,Rt<0&&(Rt=-Rt,ct=-ct,pt=-pt,xt=-xt,St=-St),1-Rt>1e-6?(Et=Math.acos(Rt),Nt=Math.sin(Et),It=Math.sin((1-s)*Et)/Nt,Gt=Math.sin(s*Et)/Nt):(It=1-s,Gt=s),a[0]=It*b+Gt*ct,a[1]=It*et+Gt*pt,a[2]=It*nt+Gt*xt,a[3]=It*c+Gt*St,a}function quaternionToEuler(e,i){var s=i[0],a=i[1],b=i[2],et=i[3],nt=Math.atan2(2*a*et-2*s*b,1-2*a*a-2*b*b),c=Math.asin(2*s*a+2*b*et),ct=Math.atan2(2*s*et-2*a*b,1-2*s*s-2*b*b);e[0]=nt/degToRads,e[1]=c/degToRads,e[2]=ct/degToRads}function createQuaternion(e){var i=e[0]*degToRads,s=e[1]*degToRads,a=e[2]*degToRads,b=Math.cos(i/2),et=Math.cos(s/2),nt=Math.cos(a/2),c=Math.sin(i/2),ct=Math.sin(s/2),pt=Math.sin(a/2),xt=b*et*nt-c*ct*pt,St=c*ct*nt+b*et*pt,Et=c*et*nt+b*ct*pt,Rt=b*ct*nt-c*et*pt;return[St,Et,Rt,xt]}function getValueAtCurrentTime(){var e=this.comp.renderedFrame-this.offsetTime,i=this.keyframes[0].t-this.offsetTime,s=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(e===this._caching.lastFrame||this._caching.lastFrame!==initFrame&&(this._caching.lastFrame>=s&&e>=s||this._caching.lastFrame<i&&e<i))){this._caching.lastFrame>=e&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var a=this.interpolateValue(e,this._caching);this.pv=a}return this._caching.lastFrame=e,this.pv}function setVValue(e){var i;if(this.propType==="unidimensional")i=e*this.mult,mathAbs(this.v-i)>1e-5&&(this.v=i,this._mdf=!0);else for(var s=0,a=this.v.length;s<a;)i=e[s]*this.mult,mathAbs(this.v[s]-i)>1e-5&&(this.v[s]=i,this._mdf=!0),s+=1}function processEffectsSequence(){if(!(this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)){if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=this._isFirstFrame;var e,i=this.effectsSequence.length,s=this.kf?this.pv:this.data.k;for(e=0;e<i;e+=1)s=this.effectsSequence[e](s);this.setVValue(s),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function addEffect(e){this.effectsSequence.push(e),this.container.addDynamicProperty(this)}function ValueProperty(e,i,s,a){this.propType="unidimensional",this.mult=s||1,this.data=i,this.v=s?i.k*s:i.k,this.pv=i.k,this._mdf=!1,this.elem=e,this.container=a,this.comp=e.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function MultiDimensionalProperty(e,i,s,a){this.propType="multidimensional",this.mult=s||1,this.data=i,this._mdf=!1,this.elem=e,this.container=a,this.comp=e.comp,this.k=!1,this.kf=!1,this.frameId=-1;var b,et=i.k.length;for(this.v=createTypedArray("float32",et),this.pv=createTypedArray("float32",et),this.vel=createTypedArray("float32",et),b=0;b<et;b+=1)this.v[b]=i.k[b]*this.mult,this.pv[b]=i.k[b];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function KeyframedValueProperty(e,i,s,a){this.propType="unidimensional",this.keyframes=i.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.frameId=-1,this._caching={lastFrame:initFrame,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=i,this.mult=s||1,this.elem=e,this.container=a,this.comp=e.comp,this.v=initFrame,this.pv=initFrame,this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.addEffect=addEffect}function KeyframedMultidimensionalProperty(e,i,s,a){this.propType="multidimensional";var b,et=i.k.length,nt,c,ct,pt;for(b=0;b<et-1;b+=1)i.k[b].to&&i.k[b].s&&i.k[b+1]&&i.k[b+1].s&&(nt=i.k[b].s,c=i.k[b+1].s,ct=i.k[b].to,pt=i.k[b].ti,(nt.length===2&&!(nt[0]===c[0]&&nt[1]===c[1])&&bez.pointOnLine2D(nt[0],nt[1],c[0],c[1],nt[0]+ct[0],nt[1]+ct[1])&&bez.pointOnLine2D(nt[0],nt[1],c[0],c[1],c[0]+pt[0],c[1]+pt[1])||nt.length===3&&!(nt[0]===c[0]&&nt[1]===c[1]&&nt[2]===c[2])&&bez.pointOnLine3D(nt[0],nt[1],nt[2],c[0],c[1],c[2],nt[0]+ct[0],nt[1]+ct[1],nt[2]+ct[2])&&bez.pointOnLine3D(nt[0],nt[1],nt[2],c[0],c[1],c[2],c[0]+pt[0],c[1]+pt[1],c[2]+pt[2]))&&(i.k[b].to=null,i.k[b].ti=null),nt[0]===c[0]&&nt[1]===c[1]&&ct[0]===0&&ct[1]===0&&pt[0]===0&&pt[1]===0&&(nt.length===2||nt[2]===c[2]&&ct[2]===0&&pt[2]===0)&&(i.k[b].to=null,i.k[b].ti=null));this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.data=i,this.keyframes=i.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=s||1,this.elem=e,this.container=a,this.comp=e.comp,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.frameId=-1;var xt=i.k[0].s.length;for(this.v=createTypedArray("float32",xt),this.pv=createTypedArray("float32",xt),b=0;b<xt;b+=1)this.v[b]=initFrame,this.pv[b]=initFrame;this._caching={lastFrame:initFrame,lastIndex:0,value:createTypedArray("float32",xt)},this.addEffect=addEffect}var PropertyFactory=function(){function e(s,a,b,et,nt){a.sid&&(a=s.globalData.slotManager.getProp(a));var c;if(!a.k.length)c=new ValueProperty(s,a,et,nt);else if(typeof a.k[0]=="number")c=new MultiDimensionalProperty(s,a,et,nt);else switch(b){case 0:c=new KeyframedValueProperty(s,a,et,nt);break;case 1:c=new KeyframedMultidimensionalProperty(s,a,et,nt);break}return c.effectsSequence.length&&nt.addDynamicProperty(c),c}var i={getProp:e};return i}();function DynamicPropertyContainer(){}DynamicPropertyContainer.prototype={addDynamicProperty:function(i){this.dynamicProperties.indexOf(i)===-1&&(this.dynamicProperties.push(i),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){this._mdf=!1;var i,s=this.dynamicProperties.length;for(i=0;i<s;i+=1)this.dynamicProperties[i].getValue(),this.dynamicProperties[i]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(i){this.container=i,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};var pointPool=function(){function e(){return createTypedArray("float32",2)}return poolFactory(8,e)}();function ShapePath(){this.c=!1,this._length=0,this._maxLength=8,this.v=createSizedArray(this._maxLength),this.o=createSizedArray(this._maxLength),this.i=createSizedArray(this._maxLength)}ShapePath.prototype.setPathData=function(e,i){this.c=e,this.setLength(i);for(var s=0;s<i;)this.v[s]=pointPool.newElement(),this.o[s]=pointPool.newElement(),this.i[s]=pointPool.newElement(),s+=1},ShapePath.prototype.setLength=function(e){for(;this._maxLength<e;)this.doubleArrayLength();this._length=e},ShapePath.prototype.doubleArrayLength=function(){this.v=this.v.concat(createSizedArray(this._maxLength)),this.i=this.i.concat(createSizedArray(this._maxLength)),this.o=this.o.concat(createSizedArray(this._maxLength)),this._maxLength*=2},ShapePath.prototype.setXYAt=function(e,i,s,a,b){var et;switch(this._length=Math.max(this._length,a+1),this._length>=this._maxLength&&this.doubleArrayLength(),s){case"v":et=this.v;break;case"i":et=this.i;break;case"o":et=this.o;break;default:et=[];break}(!et[a]||et[a]&&!b)&&(et[a]=pointPool.newElement()),et[a][0]=e,et[a][1]=i},ShapePath.prototype.setTripleAt=function(e,i,s,a,b,et,nt,c){this.setXYAt(e,i,"v",nt,c),this.setXYAt(s,a,"o",nt,c),this.setXYAt(b,et,"i",nt,c)},ShapePath.prototype.reverse=function(){var e=new ShapePath;e.setPathData(this.c,this._length);var i=this.v,s=this.o,a=this.i,b=0;this.c&&(e.setTripleAt(i[0][0],i[0][1],a[0][0],a[0][1],s[0][0],s[0][1],0,!1),b=1);var et=this._length-1,nt=this._length,c;for(c=b;c<nt;c+=1)e.setTripleAt(i[et][0],i[et][1],a[et][0],a[et][1],s[et][0],s[et][1],c,!1),et-=1;return e},ShapePath.prototype.length=function(){return this._length};var shapePool=function(){function e(){return new ShapePath}function i(b){var et=b._length,nt;for(nt=0;nt<et;nt+=1)pointPool.release(b.v[nt]),pointPool.release(b.i[nt]),pointPool.release(b.o[nt]),b.v[nt]=null,b.i[nt]=null,b.o[nt]=null;b._length=0,b.c=!1}function s(b){var et=a.newElement(),nt,c=b._length===void 0?b.v.length:b._length;for(et.setLength(c),et.c=b.c,nt=0;nt<c;nt+=1)et.setTripleAt(b.v[nt][0],b.v[nt][1],b.o[nt][0],b.o[nt][1],b.i[nt][0],b.i[nt][1],nt);return et}var a=poolFactory(4,e,i);return a.clone=s,a}();function ShapeCollection(){this._length=0,this._maxLength=4,this.shapes=createSizedArray(this._maxLength)}ShapeCollection.prototype.addShape=function(e){this._length===this._maxLength&&(this.shapes=this.shapes.concat(createSizedArray(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=e,this._length+=1},ShapeCollection.prototype.releaseShapes=function(){var e;for(e=0;e<this._length;e+=1)shapePool.release(this.shapes[e]);this._length=0};var shapeCollectionPool=function(){var e={newShapeCollection:b,release:et},i=0,s=4,a=createSizedArray(s);function b(){var nt;return i?(i-=1,nt=a[i]):nt=new ShapeCollection,nt}function et(nt){var c,ct=nt._length;for(c=0;c<ct;c+=1)shapePool.release(nt.shapes[c]);nt._length=0,i===s&&(a=pooling.double(a),s*=2),a[i]=nt,i+=1}return e}(),ShapePropertyFactory=function(){var e=-999999;function i(Dt,Bt,Lt){var Vt=Lt.lastIndex,Zt,nr,ur,_r,Ur,ln,an,Fr,rn,gn=this.keyframes;if(Dt<gn[0].t-this.offsetTime)Zt=gn[0].s[0],ur=!0,Vt=0;else if(Dt>=gn[gn.length-1].t-this.offsetTime)Zt=gn[gn.length-1].s?gn[gn.length-1].s[0]:gn[gn.length-2].e[0],ur=!0;else{for(var _i=Vt,xr=gn.length-1,gr=!0,rr,cr,Hr;gr&&(rr=gn[_i],cr=gn[_i+1],!(cr.t-this.offsetTime>Dt));)_i<xr-1?_i+=1:gr=!1;if(Hr=this.keyframesMetadata[_i]||{},ur=rr.h===1,Vt=_i,!ur){if(Dt>=cr.t-this.offsetTime)Fr=1;else if(Dt<rr.t-this.offsetTime)Fr=0;else{var $r;Hr.__fnct?$r=Hr.__fnct:($r=BezierFactory.getBezierEasing(rr.o.x,rr.o.y,rr.i.x,rr.i.y).get,Hr.__fnct=$r),Fr=$r((Dt-(rr.t-this.offsetTime))/(cr.t-this.offsetTime-(rr.t-this.offsetTime)))}nr=cr.s?cr.s[0]:rr.e[0]}Zt=rr.s[0]}for(ln=Bt._length,an=Zt.i[0].length,Lt.lastIndex=Vt,_r=0;_r<ln;_r+=1)for(Ur=0;Ur<an;Ur+=1)rn=ur?Zt.i[_r][Ur]:Zt.i[_r][Ur]+(nr.i[_r][Ur]-Zt.i[_r][Ur])*Fr,Bt.i[_r][Ur]=rn,rn=ur?Zt.o[_r][Ur]:Zt.o[_r][Ur]+(nr.o[_r][Ur]-Zt.o[_r][Ur])*Fr,Bt.o[_r][Ur]=rn,rn=ur?Zt.v[_r][Ur]:Zt.v[_r][Ur]+(nr.v[_r][Ur]-Zt.v[_r][Ur])*Fr,Bt.v[_r][Ur]=rn}function s(){var Dt=this.comp.renderedFrame-this.offsetTime,Bt=this.keyframes[0].t-this.offsetTime,Lt=this.keyframes[this.keyframes.length-1].t-this.offsetTime,Vt=this._caching.lastFrame;return Vt!==e&&(Vt<Bt&&Dt<Bt||Vt>Lt&&Dt>Lt)||(this._caching.lastIndex=Vt<Dt?this._caching.lastIndex:0,this.interpolateShape(Dt,this.pv,this._caching)),this._caching.lastFrame=Dt,this.pv}function a(){this.paths=this.localShapeCollection}function b(Dt,Bt){if(Dt._length!==Bt._length||Dt.c!==Bt.c)return!1;var Lt,Vt=Dt._length;for(Lt=0;Lt<Vt;Lt+=1)if(Dt.v[Lt][0]!==Bt.v[Lt][0]||Dt.v[Lt][1]!==Bt.v[Lt][1]||Dt.o[Lt][0]!==Bt.o[Lt][0]||Dt.o[Lt][1]!==Bt.o[Lt][1]||Dt.i[Lt][0]!==Bt.i[Lt][0]||Dt.i[Lt][1]!==Bt.i[Lt][1])return!1;return!0}function et(Dt){b(this.v,Dt)||(this.v=shapePool.clone(Dt),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function nt(){if(this.elem.globalData.frameId!==this.frameId){if(!this.effectsSequence.length){this._mdf=!1;return}if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=!1;var Dt;this.kf?Dt=this.pv:this.data.ks?Dt=this.data.ks.k:Dt=this.data.pt.k;var Bt,Lt=this.effectsSequence.length;for(Bt=0;Bt<Lt;Bt+=1)Dt=this.effectsSequence[Bt](Dt);this.setVValue(Dt),this.lock=!1,this.frameId=this.elem.globalData.frameId}}function c(Dt,Bt,Lt){this.propType="shape",this.comp=Dt.comp,this.container=Dt,this.elem=Dt,this.data=Bt,this.k=!1,this.kf=!1,this._mdf=!1;var Vt=Lt===3?Bt.pt.k:Bt.ks.k;this.v=shapePool.clone(Vt),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=a,this.effectsSequence=[]}function ct(Dt){this.effectsSequence.push(Dt),this.container.addDynamicProperty(this)}c.prototype.interpolateShape=i,c.prototype.getValue=nt,c.prototype.setVValue=et,c.prototype.addEffect=ct;function pt(Dt,Bt,Lt){this.propType="shape",this.comp=Dt.comp,this.elem=Dt,this.container=Dt,this.offsetTime=Dt.data.st,this.keyframes=Lt===3?Bt.pt.k:Bt.ks.k,this.keyframesMetadata=[],this.k=!0,this.kf=!0;var Vt=this.keyframes[0].s[0].i.length;this.v=shapePool.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,Vt),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=e,this.reset=a,this._caching={lastFrame:e,lastIndex:0},this.effectsSequence=[s.bind(this)]}pt.prototype.getValue=nt,pt.prototype.interpolateShape=i,pt.prototype.setVValue=et,pt.prototype.addEffect=ct;var xt=function(){var Dt=roundCorner;function Bt(Lt,Vt){this.v=shapePool.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=Vt.d,this.elem=Lt,this.comp=Lt.comp,this.frameId=-1,this.initDynamicPropertyContainer(Lt),this.p=PropertyFactory.getProp(Lt,Vt.p,1,0,this),this.s=PropertyFactory.getProp(Lt,Vt.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return Bt.prototype={reset:a,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var Vt=this.p.v[0],Zt=this.p.v[1],nr=this.s.v[0]/2,ur=this.s.v[1]/2,_r=this.d!==3,Ur=this.v;Ur.v[0][0]=Vt,Ur.v[0][1]=Zt-ur,Ur.v[1][0]=_r?Vt+nr:Vt-nr,Ur.v[1][1]=Zt,Ur.v[2][0]=Vt,Ur.v[2][1]=Zt+ur,Ur.v[3][0]=_r?Vt-nr:Vt+nr,Ur.v[3][1]=Zt,Ur.i[0][0]=_r?Vt-nr*Dt:Vt+nr*Dt,Ur.i[0][1]=Zt-ur,Ur.i[1][0]=_r?Vt+nr:Vt-nr,Ur.i[1][1]=Zt-ur*Dt,Ur.i[2][0]=_r?Vt+nr*Dt:Vt-nr*Dt,Ur.i[2][1]=Zt+ur,Ur.i[3][0]=_r?Vt-nr:Vt+nr,Ur.i[3][1]=Zt+ur*Dt,Ur.o[0][0]=_r?Vt+nr*Dt:Vt-nr*Dt,Ur.o[0][1]=Zt-ur,Ur.o[1][0]=_r?Vt+nr:Vt-nr,Ur.o[1][1]=Zt+ur*Dt,Ur.o[2][0]=_r?Vt-nr*Dt:Vt+nr*Dt,Ur.o[2][1]=Zt+ur,Ur.o[3][0]=_r?Vt-nr:Vt+nr,Ur.o[3][1]=Zt-ur*Dt}},extendPrototype([DynamicPropertyContainer],Bt),Bt}(),St=function(){function Dt(Bt,Lt){this.v=shapePool.newElement(),this.v.setPathData(!0,0),this.elem=Bt,this.comp=Bt.comp,this.data=Lt,this.frameId=-1,this.d=Lt.d,this.initDynamicPropertyContainer(Bt),Lt.sy===1?(this.ir=PropertyFactory.getProp(Bt,Lt.ir,0,0,this),this.is=PropertyFactory.getProp(Bt,Lt.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=PropertyFactory.getProp(Bt,Lt.pt,0,0,this),this.p=PropertyFactory.getProp(Bt,Lt.p,1,0,this),this.r=PropertyFactory.getProp(Bt,Lt.r,0,degToRads,this),this.or=PropertyFactory.getProp(Bt,Lt.or,0,0,this),this.os=PropertyFactory.getProp(Bt,Lt.os,0,.01,this),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return Dt.prototype={reset:a,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var Lt=Math.floor(this.pt.v)*2,Vt=Math.PI*2/Lt,Zt=!0,nr=this.or.v,ur=this.ir.v,_r=this.os.v,Ur=this.is.v,ln=2*Math.PI*nr/(Lt*2),an=2*Math.PI*ur/(Lt*2),Fr,rn,gn,_i,xr=-Math.PI/2;xr+=this.r.v;var gr=this.data.d===3?-1:1;for(this.v._length=0,Fr=0;Fr<Lt;Fr+=1){rn=Zt?nr:ur,gn=Zt?_r:Ur,_i=Zt?ln:an;var rr=rn*Math.cos(xr),cr=rn*Math.sin(xr),Hr=rr===0&&cr===0?0:cr/Math.sqrt(rr*rr+cr*cr),$r=rr===0&&cr===0?0:-rr/Math.sqrt(rr*rr+cr*cr);rr+=+this.p.v[0],cr+=+this.p.v[1],this.v.setTripleAt(rr,cr,rr-Hr*_i*gn*gr,cr-$r*_i*gn*gr,rr+Hr*_i*gn*gr,cr+$r*_i*gn*gr,Fr,!0),Zt=!Zt,xr+=Vt*gr}},convertPolygonToPath:function(){var Lt=Math.floor(this.pt.v),Vt=Math.PI*2/Lt,Zt=this.or.v,nr=this.os.v,ur=2*Math.PI*Zt/(Lt*4),_r,Ur=-Math.PI*.5,ln=this.data.d===3?-1:1;for(Ur+=this.r.v,this.v._length=0,_r=0;_r<Lt;_r+=1){var an=Zt*Math.cos(Ur),Fr=Zt*Math.sin(Ur),rn=an===0&&Fr===0?0:Fr/Math.sqrt(an*an+Fr*Fr),gn=an===0&&Fr===0?0:-an/Math.sqrt(an*an+Fr*Fr);an+=+this.p.v[0],Fr+=+this.p.v[1],this.v.setTripleAt(an,Fr,an-rn*ur*nr*ln,Fr-gn*ur*nr*ln,an+rn*ur*nr*ln,Fr+gn*ur*nr*ln,_r,!0),Ur+=Vt*ln}this.paths.length=0,this.paths[0]=this.v}},extendPrototype([DynamicPropertyContainer],Dt),Dt}(),Et=function(){function Dt(Bt,Lt){this.v=shapePool.newElement(),this.v.c=!0,this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=Bt,this.comp=Bt.comp,this.frameId=-1,this.d=Lt.d,this.initDynamicPropertyContainer(Bt),this.p=PropertyFactory.getProp(Bt,Lt.p,1,0,this),this.s=PropertyFactory.getProp(Bt,Lt.s,1,0,this),this.r=PropertyFactory.getProp(Bt,Lt.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return Dt.prototype={convertRectToPath:function(){var Lt=this.p.v[0],Vt=this.p.v[1],Zt=this.s.v[0]/2,nr=this.s.v[1]/2,ur=bmMin(Zt,nr,this.r.v),_r=ur*(1-roundCorner);this.v._length=0,this.d===2||this.d===1?(this.v.setTripleAt(Lt+Zt,Vt-nr+ur,Lt+Zt,Vt-nr+ur,Lt+Zt,Vt-nr+_r,0,!0),this.v.setTripleAt(Lt+Zt,Vt+nr-ur,Lt+Zt,Vt+nr-_r,Lt+Zt,Vt+nr-ur,1,!0),ur!==0?(this.v.setTripleAt(Lt+Zt-ur,Vt+nr,Lt+Zt-ur,Vt+nr,Lt+Zt-_r,Vt+nr,2,!0),this.v.setTripleAt(Lt-Zt+ur,Vt+nr,Lt-Zt+_r,Vt+nr,Lt-Zt+ur,Vt+nr,3,!0),this.v.setTripleAt(Lt-Zt,Vt+nr-ur,Lt-Zt,Vt+nr-ur,Lt-Zt,Vt+nr-_r,4,!0),this.v.setTripleAt(Lt-Zt,Vt-nr+ur,Lt-Zt,Vt-nr+_r,Lt-Zt,Vt-nr+ur,5,!0),this.v.setTripleAt(Lt-Zt+ur,Vt-nr,Lt-Zt+ur,Vt-nr,Lt-Zt+_r,Vt-nr,6,!0),this.v.setTripleAt(Lt+Zt-ur,Vt-nr,Lt+Zt-_r,Vt-nr,Lt+Zt-ur,Vt-nr,7,!0)):(this.v.setTripleAt(Lt-Zt,Vt+nr,Lt-Zt+_r,Vt+nr,Lt-Zt,Vt+nr,2),this.v.setTripleAt(Lt-Zt,Vt-nr,Lt-Zt,Vt-nr+_r,Lt-Zt,Vt-nr,3))):(this.v.setTripleAt(Lt+Zt,Vt-nr+ur,Lt+Zt,Vt-nr+_r,Lt+Zt,Vt-nr+ur,0,!0),ur!==0?(this.v.setTripleAt(Lt+Zt-ur,Vt-nr,Lt+Zt-ur,Vt-nr,Lt+Zt-_r,Vt-nr,1,!0),this.v.setTripleAt(Lt-Zt+ur,Vt-nr,Lt-Zt+_r,Vt-nr,Lt-Zt+ur,Vt-nr,2,!0),this.v.setTripleAt(Lt-Zt,Vt-nr+ur,Lt-Zt,Vt-nr+ur,Lt-Zt,Vt-nr+_r,3,!0),this.v.setTripleAt(Lt-Zt,Vt+nr-ur,Lt-Zt,Vt+nr-_r,Lt-Zt,Vt+nr-ur,4,!0),this.v.setTripleAt(Lt-Zt+ur,Vt+nr,Lt-Zt+ur,Vt+nr,Lt-Zt+_r,Vt+nr,5,!0),this.v.setTripleAt(Lt+Zt-ur,Vt+nr,Lt+Zt-_r,Vt+nr,Lt+Zt-ur,Vt+nr,6,!0),this.v.setTripleAt(Lt+Zt,Vt+nr-ur,Lt+Zt,Vt+nr-ur,Lt+Zt,Vt+nr-_r,7,!0)):(this.v.setTripleAt(Lt-Zt,Vt-nr,Lt-Zt+_r,Vt-nr,Lt-Zt,Vt-nr,1,!0),this.v.setTripleAt(Lt-Zt,Vt+nr,Lt-Zt,Vt+nr-_r,Lt-Zt,Vt+nr,2,!0),this.v.setTripleAt(Lt+Zt,Vt+nr,Lt+Zt-_r,Vt+nr,Lt+Zt,Vt+nr,3,!0)))},getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:a},extendPrototype([DynamicPropertyContainer],Dt),Dt}();function Rt(Dt,Bt,Lt){var Vt;if(Lt===3||Lt===4){var Zt=Lt===3?Bt.pt:Bt.ks,nr=Zt.k;nr.length?Vt=new pt(Dt,Bt,Lt):Vt=new c(Dt,Bt,Lt)}else Lt===5?Vt=new Et(Dt,Bt):Lt===6?Vt=new xt(Dt,Bt):Lt===7&&(Vt=new St(Dt,Bt));return Vt.k&&Dt.addDynamicProperty(Vt),Vt}function Nt(){return c}function It(){return pt}var Gt={};return Gt.getShapeProp=Rt,Gt.getConstructorFunction=Nt,Gt.getKeyframedConstructorFunction=It,Gt}();/*!
 Transformation Matrix v2.0
 (c) Epistemex 2014-2015
 www.epistemex.com
 By Ken Fyrstenberg
 Contributions by leeoniya.
 License: MIT, header required.
 */var Matrix=function(){var e=Math.cos,i=Math.sin,s=Math.tan,a=Math.round;function b(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function et(rr){if(rr===0)return this;var cr=e(rr),Hr=i(rr);return this._t(cr,-Hr,0,0,Hr,cr,0,0,0,0,1,0,0,0,0,1)}function nt(rr){if(rr===0)return this;var cr=e(rr),Hr=i(rr);return this._t(1,0,0,0,0,cr,-Hr,0,0,Hr,cr,0,0,0,0,1)}function c(rr){if(rr===0)return this;var cr=e(rr),Hr=i(rr);return this._t(cr,0,Hr,0,0,1,0,0,-Hr,0,cr,0,0,0,0,1)}function ct(rr){if(rr===0)return this;var cr=e(rr),Hr=i(rr);return this._t(cr,-Hr,0,0,Hr,cr,0,0,0,0,1,0,0,0,0,1)}function pt(rr,cr){return this._t(1,cr,rr,1,0,0)}function xt(rr,cr){return this.shear(s(rr),s(cr))}function St(rr,cr){var Hr=e(cr),$r=i(cr);return this._t(Hr,$r,0,0,-$r,Hr,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,s(rr),1,0,0,0,0,1,0,0,0,0,1)._t(Hr,-$r,0,0,$r,Hr,0,0,0,0,1,0,0,0,0,1)}function Et(rr,cr,Hr){return!Hr&&Hr!==0&&(Hr=1),rr===1&&cr===1&&Hr===1?this:this._t(rr,0,0,0,0,cr,0,0,0,0,Hr,0,0,0,0,1)}function Rt(rr,cr,Hr,$r,_n,fn,jn,vs,Cs,ns,Nn,ls,ms,Ss,Ks,ws){return this.props[0]=rr,this.props[1]=cr,this.props[2]=Hr,this.props[3]=$r,this.props[4]=_n,this.props[5]=fn,this.props[6]=jn,this.props[7]=vs,this.props[8]=Cs,this.props[9]=ns,this.props[10]=Nn,this.props[11]=ls,this.props[12]=ms,this.props[13]=Ss,this.props[14]=Ks,this.props[15]=ws,this}function Nt(rr,cr,Hr){return Hr=Hr||0,rr!==0||cr!==0||Hr!==0?this._t(1,0,0,0,0,1,0,0,0,0,1,0,rr,cr,Hr,1):this}function It(rr,cr,Hr,$r,_n,fn,jn,vs,Cs,ns,Nn,ls,ms,Ss,Ks,ws){var ps=this.props;if(rr===1&&cr===0&&Hr===0&&$r===0&&_n===0&&fn===1&&jn===0&&vs===0&&Cs===0&&ns===0&&Nn===1&&ls===0)return ps[12]=ps[12]*rr+ps[15]*ms,ps[13]=ps[13]*fn+ps[15]*Ss,ps[14]=ps[14]*Nn+ps[15]*Ks,ps[15]*=ws,this._identityCalculated=!1,this;var Rl=ps[0],Qo=ps[1],Vo=ps[2],wo=ps[3],tu=ps[4],ou=ps[5],Sl=ps[6],ru=ps[7],Ll=ps[8],Jo=ps[9],iu=ps[10],xa=ps[11],Il=ps[12],Eu=ps[13],$l=ps[14],xu=ps[15];return ps[0]=Rl*rr+Qo*_n+Vo*Cs+wo*ms,ps[1]=Rl*cr+Qo*fn+Vo*ns+wo*Ss,ps[2]=Rl*Hr+Qo*jn+Vo*Nn+wo*Ks,ps[3]=Rl*$r+Qo*vs+Vo*ls+wo*ws,ps[4]=tu*rr+ou*_n+Sl*Cs+ru*ms,ps[5]=tu*cr+ou*fn+Sl*ns+ru*Ss,ps[6]=tu*Hr+ou*jn+Sl*Nn+ru*Ks,ps[7]=tu*$r+ou*vs+Sl*ls+ru*ws,ps[8]=Ll*rr+Jo*_n+iu*Cs+xa*ms,ps[9]=Ll*cr+Jo*fn+iu*ns+xa*Ss,ps[10]=Ll*Hr+Jo*jn+iu*Nn+xa*Ks,ps[11]=Ll*$r+Jo*vs+iu*ls+xa*ws,ps[12]=Il*rr+Eu*_n+$l*Cs+xu*ms,ps[13]=Il*cr+Eu*fn+$l*ns+xu*Ss,ps[14]=Il*Hr+Eu*jn+$l*Nn+xu*Ks,ps[15]=Il*$r+Eu*vs+$l*ls+xu*ws,this._identityCalculated=!1,this}function Gt(rr){var cr=rr.props;return this.transform(cr[0],cr[1],cr[2],cr[3],cr[4],cr[5],cr[6],cr[7],cr[8],cr[9],cr[10],cr[11],cr[12],cr[13],cr[14],cr[15])}function Dt(){return this._identityCalculated||(this._identity=!(this.props[0]!==1||this.props[1]!==0||this.props[2]!==0||this.props[3]!==0||this.props[4]!==0||this.props[5]!==1||this.props[6]!==0||this.props[7]!==0||this.props[8]!==0||this.props[9]!==0||this.props[10]!==1||this.props[11]!==0||this.props[12]!==0||this.props[13]!==0||this.props[14]!==0||this.props[15]!==1),this._identityCalculated=!0),this._identity}function Bt(rr){for(var cr=0;cr<16;){if(rr.props[cr]!==this.props[cr])return!1;cr+=1}return!0}function Lt(rr){var cr;for(cr=0;cr<16;cr+=1)rr.props[cr]=this.props[cr];return rr}function Vt(rr){var cr;for(cr=0;cr<16;cr+=1)this.props[cr]=rr[cr]}function Zt(rr,cr,Hr){return{x:rr*this.props[0]+cr*this.props[4]+Hr*this.props[8]+this.props[12],y:rr*this.props[1]+cr*this.props[5]+Hr*this.props[9]+this.props[13],z:rr*this.props[2]+cr*this.props[6]+Hr*this.props[10]+this.props[14]}}function nr(rr,cr,Hr){return rr*this.props[0]+cr*this.props[4]+Hr*this.props[8]+this.props[12]}function ur(rr,cr,Hr){return rr*this.props[1]+cr*this.props[5]+Hr*this.props[9]+this.props[13]}function _r(rr,cr,Hr){return rr*this.props[2]+cr*this.props[6]+Hr*this.props[10]+this.props[14]}function Ur(){var rr=this.props[0]*this.props[5]-this.props[1]*this.props[4],cr=this.props[5]/rr,Hr=-this.props[1]/rr,$r=-this.props[4]/rr,_n=this.props[0]/rr,fn=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/rr,jn=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/rr,vs=new Matrix;return vs.props[0]=cr,vs.props[1]=Hr,vs.props[4]=$r,vs.props[5]=_n,vs.props[12]=fn,vs.props[13]=jn,vs}function ln(rr){var cr=this.getInverseMatrix();return cr.applyToPointArray(rr[0],rr[1],rr[2]||0)}function an(rr){var cr,Hr=rr.length,$r=[];for(cr=0;cr<Hr;cr+=1)$r[cr]=ln(rr[cr]);return $r}function Fr(rr,cr,Hr){var $r=createTypedArray("float32",6);if(this.isIdentity())$r[0]=rr[0],$r[1]=rr[1],$r[2]=cr[0],$r[3]=cr[1],$r[4]=Hr[0],$r[5]=Hr[1];else{var _n=this.props[0],fn=this.props[1],jn=this.props[4],vs=this.props[5],Cs=this.props[12],ns=this.props[13];$r[0]=rr[0]*_n+rr[1]*jn+Cs,$r[1]=rr[0]*fn+rr[1]*vs+ns,$r[2]=cr[0]*_n+cr[1]*jn+Cs,$r[3]=cr[0]*fn+cr[1]*vs+ns,$r[4]=Hr[0]*_n+Hr[1]*jn+Cs,$r[5]=Hr[0]*fn+Hr[1]*vs+ns}return $r}function rn(rr,cr,Hr){var $r;return this.isIdentity()?$r=[rr,cr,Hr]:$r=[rr*this.props[0]+cr*this.props[4]+Hr*this.props[8]+this.props[12],rr*this.props[1]+cr*this.props[5]+Hr*this.props[9]+this.props[13],rr*this.props[2]+cr*this.props[6]+Hr*this.props[10]+this.props[14]],$r}function gn(rr,cr){if(this.isIdentity())return rr+","+cr;var Hr=this.props;return Math.round((rr*Hr[0]+cr*Hr[4]+Hr[12])*100)/100+","+Math.round((rr*Hr[1]+cr*Hr[5]+Hr[13])*100)/100}function _i(){for(var rr=0,cr=this.props,Hr="matrix3d(",$r=1e4;rr<16;)Hr+=a(cr[rr]*$r)/$r,Hr+=rr===15?")":",",rr+=1;return Hr}function xr(rr){var cr=1e4;return rr<1e-6&&rr>0||rr>-1e-6&&rr<0?a(rr*cr)/cr:rr}function gr(){var rr=this.props,cr=xr(rr[0]),Hr=xr(rr[1]),$r=xr(rr[4]),_n=xr(rr[5]),fn=xr(rr[12]),jn=xr(rr[13]);return"matrix("+cr+","+Hr+","+$r+","+_n+","+fn+","+jn+")"}return function(){this.reset=b,this.rotate=et,this.rotateX=nt,this.rotateY=c,this.rotateZ=ct,this.skew=xt,this.skewFromAxis=St,this.shear=pt,this.scale=Et,this.setTransform=Rt,this.translate=Nt,this.transform=It,this.multiply=Gt,this.applyToPoint=Zt,this.applyToX=nr,this.applyToY=ur,this.applyToZ=_r,this.applyToPointArray=rn,this.applyToTriplePoints=Fr,this.applyToPointStringified=gn,this.toCSS=_i,this.to2dCSS=gr,this.clone=Lt,this.cloneFromProps=Vt,this.equals=Bt,this.inversePoints=an,this.inversePoint=ln,this.getInverseMatrix=Ur,this._t=this.transform,this.isIdentity=Dt,this._identity=!0,this._identityCalculated=!1,this.props=createTypedArray("float32",16),this.reset()}}();function _typeof$3(e){"@babel/helpers - typeof";return _typeof$3=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$3(e)}var lottie={};function setLocation(e){setLocationHref(e)}function searchAnimations(){animationManager.searchAnimations()}function setSubframeRendering(e){setSubframeEnabled(e)}function setPrefix(e){setIdPrefix(e)}function loadAnimation(e){return animationManager.loadAnimation(e)}function setQuality(e){if(typeof e=="string")switch(e){case"high":setDefaultCurveSegments(200);break;default:case"medium":setDefaultCurveSegments(50);break;case"low":setDefaultCurveSegments(10);break}else!isNaN(e)&&e>1&&setDefaultCurveSegments(e)}function inBrowser(){return typeof navigator<"u"}function installPlugin(e,i){e==="expressions"&&setExpressionsPlugin(i)}function getFactory(e){switch(e){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix;default:return null}}lottie.play=animationManager.play,lottie.pause=animationManager.pause,lottie.setLocationHref=setLocation,lottie.togglePause=animationManager.togglePause,lottie.setSpeed=animationManager.setSpeed,lottie.setDirection=animationManager.setDirection,lottie.stop=animationManager.stop,lottie.searchAnimations=searchAnimations,lottie.registerAnimation=animationManager.registerAnimation,lottie.loadAnimation=loadAnimation,lottie.setSubframeRendering=setSubframeRendering,lottie.resize=animationManager.resize,lottie.goToAndStop=animationManager.goToAndStop,lottie.destroy=animationManager.destroy,lottie.setQuality=setQuality,lottie.inBrowser=inBrowser,lottie.installPlugin=installPlugin,lottie.freeze=animationManager.freeze,lottie.unfreeze=animationManager.unfreeze,lottie.setVolume=animationManager.setVolume,lottie.mute=animationManager.mute,lottie.unmute=animationManager.unmute,lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations,lottie.useWebWorker=setWebWorker,lottie.setIDPrefix=setPrefix,lottie.__getFactory=getFactory,lottie.version="5.13.0";function checkReady(){document.readyState==="complete"&&(clearInterval(readyStateCheckInterval),searchAnimations())}function getQueryVariable(e){for(var i=queryString.split("&"),s=0;s<i.length;s+=1){var a=i[s].split("=");if(decodeURIComponent(a[0])==e)return decodeURIComponent(a[1])}return null}var queryString="";{var scripts=document.getElementsByTagName("script"),index=scripts.length-1,myScript=scripts[index]||{src:""};queryString=myScript.src?myScript.src.replace(/^[^\?]+\??/,""):"",getQueryVariable("renderer")}var readyStateCheckInterval=setInterval(checkReady,100);try{_typeof$3(exports)!=="object"&&(window.bodymovin=lottie)}catch(e){}var ShapeModifiers=function(){var e={},i={};e.registerModifier=s,e.getModifier=a;function s(b,et){i[b]||(i[b]=et)}function a(b,et,nt){return new i[b](et,nt)}return e}();function ShapeModifier(){}ShapeModifier.prototype.initModifierProperties=function(){},ShapeModifier.prototype.addShapeToModifier=function(){},ShapeModifier.prototype.addShape=function(e){if(!this.closed){e.sh.container.addDynamicProperty(e.sh);var i={shape:e.sh,data:e,localShapeCollection:shapeCollectionPool.newShapeCollection()};this.shapes.push(i),this.addShapeToModifier(i),this._isAnimated&&e.setAsAnimated()}},ShapeModifier.prototype.init=function(e,i){this.shapes=[],this.elem=e,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,i),this.frameId=initialDefaultFrame,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},ShapeModifier.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},extendPrototype([DynamicPropertyContainer],ShapeModifier);function TrimModifier(){}extendPrototype([ShapeModifier],TrimModifier),TrimModifier.prototype.initModifierProperties=function(e,i){this.s=PropertyFactory.getProp(e,i.s,0,.01,this),this.e=PropertyFactory.getProp(e,i.e,0,.01,this),this.o=PropertyFactory.getProp(e,i.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=i.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},TrimModifier.prototype.addShapeToModifier=function(e){e.pathsData=[]},TrimModifier.prototype.calculateShapeEdges=function(e,i,s,a,b){var et=[];i<=1?et.push({s:e,e:i}):e>=1?et.push({s:e-1,e:i-1}):(et.push({s:e,e:1}),et.push({s:0,e:i-1}));var nt=[],c,ct=et.length,pt;for(c=0;c<ct;c+=1)if(pt=et[c],!(pt.e*b<a||pt.s*b>a+s)){var xt,St;pt.s*b<=a?xt=0:xt=(pt.s*b-a)/s,pt.e*b>=a+s?St=1:St=(pt.e*b-a)/s,nt.push([xt,St])}return nt.length||nt.push([0,0]),nt},TrimModifier.prototype.releasePathsData=function(e){var i,s=e.length;for(i=0;i<s;i+=1)segmentsLengthPool.release(e[i]);return e.length=0,e},TrimModifier.prototype.processShapes=function(e){var i,s;if(this._mdf||e){var a=this.o.v%360/360;if(a<0&&(a+=1),this.s.v>1?i=1+a:this.s.v<0?i=0+a:i=this.s.v+a,this.e.v>1?s=1+a:this.e.v<0?s=0+a:s=this.e.v+a,i>s){var b=i;i=s,s=b}i=Math.round(i*1e4)*1e-4,s=Math.round(s*1e4)*1e-4,this.sValue=i,this.eValue=s}else i=this.sValue,s=this.eValue;var et,nt,c=this.shapes.length,ct,pt,xt,St,Et,Rt=0;if(s===i)for(nt=0;nt<c;nt+=1)this.shapes[nt].localShapeCollection.releaseShapes(),this.shapes[nt].shape._mdf=!0,this.shapes[nt].shape.paths=this.shapes[nt].localShapeCollection,this._mdf&&(this.shapes[nt].pathsData.length=0);else if(s===1&&i===0||s===0&&i===1){if(this._mdf)for(nt=0;nt<c;nt+=1)this.shapes[nt].pathsData.length=0,this.shapes[nt].shape._mdf=!0}else{var Nt=[],It,Gt;for(nt=0;nt<c;nt+=1)if(It=this.shapes[nt],!It.shape._mdf&&!this._mdf&&!e&&this.m!==2)It.shape.paths=It.localShapeCollection;else{if(et=It.shape.paths,pt=et._length,Et=0,!It.shape._mdf&&It.pathsData.length)Et=It.totalShapeLength;else{for(xt=this.releasePathsData(It.pathsData),ct=0;ct<pt;ct+=1)St=bez.getSegmentsLength(et.shapes[ct]),xt.push(St),Et+=St.totalLength;It.totalShapeLength=Et,It.pathsData=xt}Rt+=Et,It.shape._mdf=!0}var Dt=i,Bt=s,Lt=0,Vt;for(nt=c-1;nt>=0;nt-=1)if(It=this.shapes[nt],It.shape._mdf){for(Gt=It.localShapeCollection,Gt.releaseShapes(),this.m===2&&c>1?(Vt=this.calculateShapeEdges(i,s,It.totalShapeLength,Lt,Rt),Lt+=It.totalShapeLength):Vt=[[Dt,Bt]],pt=Vt.length,ct=0;ct<pt;ct+=1){Dt=Vt[ct][0],Bt=Vt[ct][1],Nt.length=0,Bt<=1?Nt.push({s:It.totalShapeLength*Dt,e:It.totalShapeLength*Bt}):Dt>=1?Nt.push({s:It.totalShapeLength*(Dt-1),e:It.totalShapeLength*(Bt-1)}):(Nt.push({s:It.totalShapeLength*Dt,e:It.totalShapeLength}),Nt.push({s:0,e:It.totalShapeLength*(Bt-1)}));var Zt=this.addShapes(It,Nt[0]);if(Nt[0].s!==Nt[0].e){if(Nt.length>1){var nr=It.shape.paths.shapes[It.shape.paths._length-1];if(nr.c){var ur=Zt.pop();this.addPaths(Zt,Gt),Zt=this.addShapes(It,Nt[1],ur)}else this.addPaths(Zt,Gt),Zt=this.addShapes(It,Nt[1])}this.addPaths(Zt,Gt)}}It.shape.paths=Gt}}},TrimModifier.prototype.addPaths=function(e,i){var s,a=e.length;for(s=0;s<a;s+=1)i.addShape(e[s])},TrimModifier.prototype.addSegment=function(e,i,s,a,b,et,nt){b.setXYAt(i[0],i[1],"o",et),b.setXYAt(s[0],s[1],"i",et+1),nt&&b.setXYAt(e[0],e[1],"v",et),b.setXYAt(a[0],a[1],"v",et+1)},TrimModifier.prototype.addSegmentFromArray=function(e,i,s,a){i.setXYAt(e[1],e[5],"o",s),i.setXYAt(e[2],e[6],"i",s+1),a&&i.setXYAt(e[0],e[4],"v",s),i.setXYAt(e[3],e[7],"v",s+1)},TrimModifier.prototype.addShapes=function(e,i,s){var a=e.pathsData,b=e.shape.paths.shapes,et,nt=e.shape.paths._length,c,ct,pt=0,xt,St,Et,Rt,Nt=[],It,Gt=!0;for(s?(St=s._length,It=s._length):(s=shapePool.newElement(),St=0,It=0),Nt.push(s),et=0;et<nt;et+=1){for(Et=a[et].lengths,s.c=b[et].c,ct=b[et].c?Et.length:Et.length+1,c=1;c<ct;c+=1)if(xt=Et[c-1],pt+xt.addedLength<i.s)pt+=xt.addedLength,s.c=!1;else if(pt>i.e){s.c=!1;break}else i.s<=pt&&i.e>=pt+xt.addedLength?(this.addSegment(b[et].v[c-1],b[et].o[c-1],b[et].i[c],b[et].v[c],s,St,Gt),Gt=!1):(Rt=bez.getNewSegment(b[et].v[c-1],b[et].v[c],b[et].o[c-1],b[et].i[c],(i.s-pt)/xt.addedLength,(i.e-pt)/xt.addedLength,Et[c-1]),this.addSegmentFromArray(Rt,s,St,Gt),Gt=!1,s.c=!1),pt+=xt.addedLength,St+=1;if(b[et].c&&Et.length){if(xt=Et[c-1],pt<=i.e){var Dt=Et[c-1].addedLength;i.s<=pt&&i.e>=pt+Dt?(this.addSegment(b[et].v[c-1],b[et].o[c-1],b[et].i[0],b[et].v[0],s,St,Gt),Gt=!1):(Rt=bez.getNewSegment(b[et].v[c-1],b[et].v[0],b[et].o[c-1],b[et].i[0],(i.s-pt)/Dt,(i.e-pt)/Dt,Et[c-1]),this.addSegmentFromArray(Rt,s,St,Gt),Gt=!1,s.c=!1)}else s.c=!1;pt+=xt.addedLength,St+=1}if(s._length&&(s.setXYAt(s.v[It][0],s.v[It][1],"i",It),s.setXYAt(s.v[s._length-1][0],s.v[s._length-1][1],"o",s._length-1)),pt>i.e)break;et<nt-1&&(s=shapePool.newElement(),Gt=!0,Nt.push(s),St=0)}return Nt};function PuckerAndBloatModifier(){}extendPrototype([ShapeModifier],PuckerAndBloatModifier),PuckerAndBloatModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,i.a,0,null,this),this._isAnimated=!!this.amount.effectsSequence.length},PuckerAndBloatModifier.prototype.processPath=function(e,i){var s=i/100,a=[0,0],b=e._length,et=0;for(et=0;et<b;et+=1)a[0]+=e.v[et][0],a[1]+=e.v[et][1];a[0]/=b,a[1]/=b;var nt=shapePool.newElement();nt.c=e.c;var c,ct,pt,xt,St,Et;for(et=0;et<b;et+=1)c=e.v[et][0]+(a[0]-e.v[et][0])*s,ct=e.v[et][1]+(a[1]-e.v[et][1])*s,pt=e.o[et][0]+(a[0]-e.o[et][0])*-s,xt=e.o[et][1]+(a[1]-e.o[et][1])*-s,St=e.i[et][0]+(a[0]-e.i[et][0])*-s,Et=e.i[et][1]+(a[1]-e.i[et][1])*-s,nt.setTripleAt(c,ct,pt,xt,St,Et,et);return nt},PuckerAndBloatModifier.prototype.processShapes=function(e){var i,s,a=this.shapes.length,b,et,nt=this.amount.v;if(nt!==0){var c,ct;for(s=0;s<a;s+=1){if(c=this.shapes[s],ct=c.localShapeCollection,!(!c.shape._mdf&&!this._mdf&&!e))for(ct.releaseShapes(),c.shape._mdf=!0,i=c.shape.paths.shapes,et=c.shape.paths._length,b=0;b<et;b+=1)ct.addShape(this.processPath(i[b],nt));c.shape.paths=c.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};var TransformPropertyFactory=function(){var e=[0,0];function i(ct){var pt=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||pt,this.a&&ct.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&ct.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&ct.skewFromAxis(-this.sk.v,this.sa.v),this.r?ct.rotate(-this.r.v):ct.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?ct.translate(this.px.v,this.py.v,-this.pz.v):ct.translate(this.px.v,this.py.v,0):ct.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}function s(ct){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||ct){var pt;if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var xt,St;if(pt=this.elem.globalData.frameRate,this.p&&this.p.keyframes&&this.p.getValueAtTime)this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(xt=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/pt,0),St=this.p.getValueAtTime(this.p.keyframes[0].t/pt,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(xt=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/pt,0),St=this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/pt,0)):(xt=this.p.pv,St=this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/pt,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){xt=[],St=[];var Et=this.px,Rt=this.py;Et._caching.lastFrame+Et.offsetTime<=Et.keyframes[0].t?(xt[0]=Et.getValueAtTime((Et.keyframes[0].t+.01)/pt,0),xt[1]=Rt.getValueAtTime((Rt.keyframes[0].t+.01)/pt,0),St[0]=Et.getValueAtTime(Et.keyframes[0].t/pt,0),St[1]=Rt.getValueAtTime(Rt.keyframes[0].t/pt,0)):Et._caching.lastFrame+Et.offsetTime>=Et.keyframes[Et.keyframes.length-1].t?(xt[0]=Et.getValueAtTime(Et.keyframes[Et.keyframes.length-1].t/pt,0),xt[1]=Rt.getValueAtTime(Rt.keyframes[Rt.keyframes.length-1].t/pt,0),St[0]=Et.getValueAtTime((Et.keyframes[Et.keyframes.length-1].t-.01)/pt,0),St[1]=Rt.getValueAtTime((Rt.keyframes[Rt.keyframes.length-1].t-.01)/pt,0)):(xt=[Et.pv,Rt.pv],St[0]=Et.getValueAtTime((Et._caching.lastFrame+Et.offsetTime-.01)/pt,Et.offsetTime),St[1]=Rt.getValueAtTime((Rt._caching.lastFrame+Rt.offsetTime-.01)/pt,Rt.offsetTime))}else St=e,xt=St;this.v.rotate(-Math.atan2(xt[1]-St[1],xt[0]-St[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}}function a(){if(this.appliedTransformations=0,this.pre.reset(),!this.a.effectsSequence.length)this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1;else return;if(!this.s.effectsSequence.length)this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2;else return;if(this.sk)if(!this.sk.effectsSequence.length&&!this.sa.effectsSequence.length)this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3;else return;this.r?this.r.effectsSequence.length||(this.pre.rotate(-this.r.v),this.appliedTransformations=4):!this.rz.effectsSequence.length&&!this.ry.effectsSequence.length&&!this.rx.effectsSequence.length&&!this.or.effectsSequence.length&&(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}function b(){}function et(ct){this._addDynamicProperty(ct),this.elem.addDynamicProperty(ct),this._isDirty=!0}function nt(ct,pt,xt){if(this.elem=ct,this.frameId=-1,this.propType="transform",this.data=pt,this.v=new Matrix,this.pre=new Matrix,this.appliedTransformations=0,this.initDynamicPropertyContainer(xt||ct),pt.p&&pt.p.s?(this.px=PropertyFactory.getProp(ct,pt.p.x,0,0,this),this.py=PropertyFactory.getProp(ct,pt.p.y,0,0,this),pt.p.z&&(this.pz=PropertyFactory.getProp(ct,pt.p.z,0,0,this))):this.p=PropertyFactory.getProp(ct,pt.p||{k:[0,0,0]},1,0,this),pt.rx){if(this.rx=PropertyFactory.getProp(ct,pt.rx,0,degToRads,this),this.ry=PropertyFactory.getProp(ct,pt.ry,0,degToRads,this),this.rz=PropertyFactory.getProp(ct,pt.rz,0,degToRads,this),pt.or.k[0].ti){var St,Et=pt.or.k.length;for(St=0;St<Et;St+=1)pt.or.k[St].to=null,pt.or.k[St].ti=null}this.or=PropertyFactory.getProp(ct,pt.or,1,degToRads,this),this.or.sh=!0}else this.r=PropertyFactory.getProp(ct,pt.r||{k:0},0,degToRads,this);pt.sk&&(this.sk=PropertyFactory.getProp(ct,pt.sk,0,degToRads,this),this.sa=PropertyFactory.getProp(ct,pt.sa,0,degToRads,this)),this.a=PropertyFactory.getProp(ct,pt.a||{k:[0,0,0]},1,0,this),this.s=PropertyFactory.getProp(ct,pt.s||{k:[100,100,100]},1,.01,this),pt.o?this.o=PropertyFactory.getProp(ct,pt.o,0,.01,ct):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}nt.prototype={applyToMatrix:i,getValue:s,precalculateMatrix:a,autoOrient:b},extendPrototype([DynamicPropertyContainer],nt),nt.prototype.addDynamicProperty=et,nt.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty;function c(ct,pt,xt){return new nt(ct,pt,xt)}return{getTransformProperty:c}}();function RepeaterModifier(){}extendPrototype([ShapeModifier],RepeaterModifier),RepeaterModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.c=PropertyFactory.getProp(e,i.c,0,null,this),this.o=PropertyFactory.getProp(e,i.o,0,null,this),this.tr=TransformPropertyFactory.getTransformProperty(e,i.tr,this),this.so=PropertyFactory.getProp(e,i.tr.so,0,.01,this),this.eo=PropertyFactory.getProp(e,i.tr.eo,0,.01,this),this.data=i,this.dynamicProperties.length||this.getValue(!0),this._isAnimated=!!this.dynamicProperties.length,this.pMatrix=new Matrix,this.rMatrix=new Matrix,this.sMatrix=new Matrix,this.tMatrix=new Matrix,this.matrix=new Matrix},RepeaterModifier.prototype.applyTransforms=function(e,i,s,a,b,et){var nt=et?-1:1,c=a.s.v[0]+(1-a.s.v[0])*(1-b),ct=a.s.v[1]+(1-a.s.v[1])*(1-b);e.translate(a.p.v[0]*nt*b,a.p.v[1]*nt*b,a.p.v[2]),i.translate(-a.a.v[0],-a.a.v[1],a.a.v[2]),i.rotate(-a.r.v*nt*b),i.translate(a.a.v[0],a.a.v[1],a.a.v[2]),s.translate(-a.a.v[0],-a.a.v[1],a.a.v[2]),s.scale(et?1/c:c,et?1/ct:ct),s.translate(a.a.v[0],a.a.v[1],a.a.v[2])},RepeaterModifier.prototype.init=function(e,i,s,a){for(this.elem=e,this.arr=i,this.pos=s,this.elemsData=a,this._currentCopies=0,this._elements=[],this._groups=[],this.frameId=-1,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,i[s]);s>0;)s-=1,this._elements.unshift(i[s]);this.dynamicProperties.length?this.k=!0:this.getValue(!0)},RepeaterModifier.prototype.resetElements=function(e){var i,s=e.length;for(i=0;i<s;i+=1)e[i]._processed=!1,e[i].ty==="gr"&&this.resetElements(e[i].it)},RepeaterModifier.prototype.cloneElements=function(e){var i=JSON.parse(JSON.stringify(e));return this.resetElements(i),i},RepeaterModifier.prototype.changeGroupRender=function(e,i){var s,a=e.length;for(s=0;s<a;s+=1)e[s]._render=i,e[s].ty==="gr"&&this.changeGroupRender(e[s].it,i)},RepeaterModifier.prototype.processShapes=function(e){var i,s,a,b,et,nt=!1;if(this._mdf||e){var c=Math.ceil(this.c.v);if(this._groups.length<c){for(;this._groups.length<c;){var ct={it:this.cloneElements(this._elements),ty:"gr"};ct.it.push({a:{a:0,ix:1,k:[0,0]},nm:"Transform",o:{a:0,ix:7,k:100},p:{a:0,ix:2,k:[0,0]},r:{a:1,ix:6,k:[{s:0,e:0,t:0},{s:0,e:0,t:1}]},s:{a:0,ix:3,k:[100,100]},sa:{a:0,ix:5,k:0},sk:{a:0,ix:4,k:0},ty:"tr"}),this.arr.splice(0,0,ct),this._groups.splice(0,0,ct),this._currentCopies+=1}this.elem.reloadShapes(),nt=!0}et=0;var pt;for(a=0;a<=this._groups.length-1;a+=1){if(pt=et<c,this._groups[a]._render=pt,this.changeGroupRender(this._groups[a].it,pt),!pt){var xt=this.elemsData[a].it,St=xt[xt.length-1];St.transform.op.v!==0?(St.transform.op._mdf=!0,St.transform.op.v=0):St.transform.op._mdf=!1}et+=1}this._currentCopies=c;var Et=this.o.v,Rt=Et%1,Nt=Et>0?Math.floor(Et):Math.ceil(Et),It=this.pMatrix.props,Gt=this.rMatrix.props,Dt=this.sMatrix.props;this.pMatrix.reset(),this.rMatrix.reset(),this.sMatrix.reset(),this.tMatrix.reset(),this.matrix.reset();var Bt=0;if(Et>0){for(;Bt<Nt;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),Bt+=1;Rt&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,Rt,!1),Bt+=Rt)}else if(Et<0){for(;Bt>Nt;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!0),Bt-=1;Rt&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,-Rt,!0),Bt-=Rt)}a=this.data.m===1?0:this._currentCopies-1,b=this.data.m===1?1:-1,et=this._currentCopies;for(var Lt,Vt;et;){if(i=this.elemsData[a].it,s=i[i.length-1].transform.mProps.v.props,Vt=s.length,i[i.length-1].transform.mProps._mdf=!0,i[i.length-1].transform.op._mdf=!0,i[i.length-1].transform.op.v=this._currentCopies===1?this.so.v:this.so.v+(this.eo.v-this.so.v)*(a/(this._currentCopies-1)),Bt!==0){for((a!==0&&b===1||a!==this._currentCopies-1&&b===-1)&&this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),this.matrix.transform(Gt[0],Gt[1],Gt[2],Gt[3],Gt[4],Gt[5],Gt[6],Gt[7],Gt[8],Gt[9],Gt[10],Gt[11],Gt[12],Gt[13],Gt[14],Gt[15]),this.matrix.transform(Dt[0],Dt[1],Dt[2],Dt[3],Dt[4],Dt[5],Dt[6],Dt[7],Dt[8],Dt[9],Dt[10],Dt[11],Dt[12],Dt[13],Dt[14],Dt[15]),this.matrix.transform(It[0],It[1],It[2],It[3],It[4],It[5],It[6],It[7],It[8],It[9],It[10],It[11],It[12],It[13],It[14],It[15]),Lt=0;Lt<Vt;Lt+=1)s[Lt]=this.matrix.props[Lt];this.matrix.reset()}else for(this.matrix.reset(),Lt=0;Lt<Vt;Lt+=1)s[Lt]=this.matrix.props[Lt];Bt+=1,et-=1,a+=b}}else for(et=this._currentCopies,a=0,b=1;et;)i=this.elemsData[a].it,s=i[i.length-1].transform.mProps.v.props,i[i.length-1].transform.mProps._mdf=!1,i[i.length-1].transform.op._mdf=!1,et-=1,a+=b;return nt},RepeaterModifier.prototype.addShape=function(){};function RoundCornersModifier(){}extendPrototype([ShapeModifier],RoundCornersModifier),RoundCornersModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.rd=PropertyFactory.getProp(e,i.r,0,null,this),this._isAnimated=!!this.rd.effectsSequence.length},RoundCornersModifier.prototype.processPath=function(e,i){var s=shapePool.newElement();s.c=e.c;var a,b=e._length,et,nt,c,ct,pt,xt,St=0,Et,Rt,Nt,It,Gt,Dt;for(a=0;a<b;a+=1)et=e.v[a],c=e.o[a],nt=e.i[a],et[0]===c[0]&&et[1]===c[1]&&et[0]===nt[0]&&et[1]===nt[1]?(a===0||a===b-1)&&!e.c?(s.setTripleAt(et[0],et[1],c[0],c[1],nt[0],nt[1],St),St+=1):(a===0?ct=e.v[b-1]:ct=e.v[a-1],pt=Math.sqrt(Math.pow(et[0]-ct[0],2)+Math.pow(et[1]-ct[1],2)),xt=pt?Math.min(pt/2,i)/pt:0,Gt=et[0]+(ct[0]-et[0])*xt,Et=Gt,Dt=et[1]-(et[1]-ct[1])*xt,Rt=Dt,Nt=Et-(Et-et[0])*roundCorner,It=Rt-(Rt-et[1])*roundCorner,s.setTripleAt(Et,Rt,Nt,It,Gt,Dt,St),St+=1,a===b-1?ct=e.v[0]:ct=e.v[a+1],pt=Math.sqrt(Math.pow(et[0]-ct[0],2)+Math.pow(et[1]-ct[1],2)),xt=pt?Math.min(pt/2,i)/pt:0,Nt=et[0]+(ct[0]-et[0])*xt,Et=Nt,It=et[1]+(ct[1]-et[1])*xt,Rt=It,Gt=Et-(Et-et[0])*roundCorner,Dt=Rt-(Rt-et[1])*roundCorner,s.setTripleAt(Et,Rt,Nt,It,Gt,Dt,St),St+=1):(s.setTripleAt(e.v[a][0],e.v[a][1],e.o[a][0],e.o[a][1],e.i[a][0],e.i[a][1],St),St+=1);return s},RoundCornersModifier.prototype.processShapes=function(e){var i,s,a=this.shapes.length,b,et,nt=this.rd.v;if(nt!==0){var c,ct;for(s=0;s<a;s+=1){if(c=this.shapes[s],ct=c.localShapeCollection,!(!c.shape._mdf&&!this._mdf&&!e))for(ct.releaseShapes(),c.shape._mdf=!0,i=c.shape.paths.shapes,et=c.shape.paths._length,b=0;b<et;b+=1)ct.addShape(this.processPath(i[b],nt));c.shape.paths=c.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function floatEqual(e,i){return Math.abs(e-i)*1e5<=Math.min(Math.abs(e),Math.abs(i))}function floatZero(e){return Math.abs(e)<=1e-5}function lerp(e,i,s){return e*(1-s)+i*s}function lerpPoint(e,i,s){return[lerp(e[0],i[0],s),lerp(e[1],i[1],s)]}function quadRoots(e,i,s){if(e===0)return[];var a=i*i-4*e*s;if(a<0)return[];var b=-i/(2*e);if(a===0)return[b];var et=Math.sqrt(a)/(2*e);return[b-et,b+et]}function polynomialCoefficients(e,i,s,a){return[-e+3*i-3*s+a,3*e-6*i+3*s,-3*e+3*i,e]}function singlePoint(e){return new PolynomialBezier(e,e,e,e,!1)}function PolynomialBezier(e,i,s,a,b){b&&pointEqual(e,i)&&(i=lerpPoint(e,a,1/3)),b&&pointEqual(s,a)&&(s=lerpPoint(e,a,2/3));var et=polynomialCoefficients(e[0],i[0],s[0],a[0]),nt=polynomialCoefficients(e[1],i[1],s[1],a[1]);this.a=[et[0],nt[0]],this.b=[et[1],nt[1]],this.c=[et[2],nt[2]],this.d=[et[3],nt[3]],this.points=[e,i,s,a]}PolynomialBezier.prototype.point=function(e){return[((this.a[0]*e+this.b[0])*e+this.c[0])*e+this.d[0],((this.a[1]*e+this.b[1])*e+this.c[1])*e+this.d[1]]},PolynomialBezier.prototype.derivative=function(e){return[(3*e*this.a[0]+2*this.b[0])*e+this.c[0],(3*e*this.a[1]+2*this.b[1])*e+this.c[1]]},PolynomialBezier.prototype.tangentAngle=function(e){var i=this.derivative(e);return Math.atan2(i[1],i[0])},PolynomialBezier.prototype.normalAngle=function(e){var i=this.derivative(e);return Math.atan2(i[0],i[1])},PolynomialBezier.prototype.inflectionPoints=function(){var e=this.a[1]*this.b[0]-this.a[0]*this.b[1];if(floatZero(e))return[];var i=-.5*(this.a[1]*this.c[0]-this.a[0]*this.c[1])/e,s=i*i-1/3*(this.b[1]*this.c[0]-this.b[0]*this.c[1])/e;if(s<0)return[];var a=Math.sqrt(s);return floatZero(a)?a>0&&a<1?[i]:[]:[i-a,i+a].filter(function(b){return b>0&&b<1})},PolynomialBezier.prototype.split=function(e){if(e<=0)return[singlePoint(this.points[0]),this];if(e>=1)return[this,singlePoint(this.points[this.points.length-1])];var i=lerpPoint(this.points[0],this.points[1],e),s=lerpPoint(this.points[1],this.points[2],e),a=lerpPoint(this.points[2],this.points[3],e),b=lerpPoint(i,s,e),et=lerpPoint(s,a,e),nt=lerpPoint(b,et,e);return[new PolynomialBezier(this.points[0],i,b,nt,!0),new PolynomialBezier(nt,et,a,this.points[3],!0)]};function extrema(e,i){var s=e.points[0][i],a=e.points[e.points.length-1][i];if(s>a){var b=a;a=s,s=b}for(var et=quadRoots(3*e.a[i],2*e.b[i],e.c[i]),nt=0;nt<et.length;nt+=1)if(et[nt]>0&&et[nt]<1){var c=e.point(et[nt])[i];c<s?s=c:c>a&&(a=c)}return{min:s,max:a}}PolynomialBezier.prototype.bounds=function(){return{x:extrema(this,0),y:extrema(this,1)}},PolynomialBezier.prototype.boundingBox=function(){var e=this.bounds();return{left:e.x.min,right:e.x.max,top:e.y.min,bottom:e.y.max,width:e.x.max-e.x.min,height:e.y.max-e.y.min,cx:(e.x.max+e.x.min)/2,cy:(e.y.max+e.y.min)/2}};function intersectData(e,i,s){var a=e.boundingBox();return{cx:a.cx,cy:a.cy,width:a.width,height:a.height,bez:e,t:(i+s)/2,t1:i,t2:s}}function splitData(e){var i=e.bez.split(.5);return[intersectData(i[0],e.t1,e.t),intersectData(i[1],e.t,e.t2)]}function boxIntersect(e,i){return Math.abs(e.cx-i.cx)*2<e.width+i.width&&Math.abs(e.cy-i.cy)*2<e.height+i.height}function intersectsImpl(e,i,s,a,b,et){if(boxIntersect(e,i)){if(s>=et||e.width<=a&&e.height<=a&&i.width<=a&&i.height<=a){b.push([e.t,i.t]);return}var nt=splitData(e),c=splitData(i);intersectsImpl(nt[0],c[0],s+1,a,b,et),intersectsImpl(nt[0],c[1],s+1,a,b,et),intersectsImpl(nt[1],c[0],s+1,a,b,et),intersectsImpl(nt[1],c[1],s+1,a,b,et)}}PolynomialBezier.prototype.intersections=function(e,i,s){i===void 0&&(i=2),s===void 0&&(s=7);var a=[];return intersectsImpl(intersectData(this,0,1),intersectData(e,0,1),0,i,a,s),a},PolynomialBezier.shapeSegment=function(e,i){var s=(i+1)%e.length();return new PolynomialBezier(e.v[i],e.o[i],e.i[s],e.v[s],!0)},PolynomialBezier.shapeSegmentInverted=function(e,i){var s=(i+1)%e.length();return new PolynomialBezier(e.v[s],e.i[s],e.o[i],e.v[i],!0)};function crossProduct(e,i){return[e[1]*i[2]-e[2]*i[1],e[2]*i[0]-e[0]*i[2],e[0]*i[1]-e[1]*i[0]]}function lineIntersection(e,i,s,a){var b=[e[0],e[1],1],et=[i[0],i[1],1],nt=[s[0],s[1],1],c=[a[0],a[1],1],ct=crossProduct(crossProduct(b,et),crossProduct(nt,c));return floatZero(ct[2])?null:[ct[0]/ct[2],ct[1]/ct[2]]}function polarOffset(e,i,s){return[e[0]+Math.cos(i)*s,e[1]-Math.sin(i)*s]}function pointDistance(e,i){return Math.hypot(e[0]-i[0],e[1]-i[1])}function pointEqual(e,i){return floatEqual(e[0],i[0])&&floatEqual(e[1],i[1])}function ZigZagModifier(){}extendPrototype([ShapeModifier],ZigZagModifier),ZigZagModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.amplitude=PropertyFactory.getProp(e,i.s,0,null,this),this.frequency=PropertyFactory.getProp(e,i.r,0,null,this),this.pointsType=PropertyFactory.getProp(e,i.pt,0,null,this),this._isAnimated=this.amplitude.effectsSequence.length!==0||this.frequency.effectsSequence.length!==0||this.pointsType.effectsSequence.length!==0};function setPoint(e,i,s,a,b,et,nt){var c=s-Math.PI/2,ct=s+Math.PI/2,pt=i[0]+Math.cos(s)*a*b,xt=i[1]-Math.sin(s)*a*b;e.setTripleAt(pt,xt,pt+Math.cos(c)*et,xt-Math.sin(c)*et,pt+Math.cos(ct)*nt,xt-Math.sin(ct)*nt,e.length())}function getPerpendicularVector(e,i){var s=[i[0]-e[0],i[1]-e[1]],a=-Math.PI*.5,b=[Math.cos(a)*s[0]-Math.sin(a)*s[1],Math.sin(a)*s[0]+Math.cos(a)*s[1]];return b}function getProjectingAngle(e,i){var s=i===0?e.length()-1:i-1,a=(i+1)%e.length(),b=e.v[s],et=e.v[a],nt=getPerpendicularVector(b,et);return Math.atan2(0,1)-Math.atan2(nt[1],nt[0])}function zigZagCorner(e,i,s,a,b,et,nt){var c=getProjectingAngle(i,s),ct=i.v[s%i._length],pt=i.v[s===0?i._length-1:s-1],xt=i.v[(s+1)%i._length],St=et===2?Math.sqrt(Math.pow(ct[0]-pt[0],2)+Math.pow(ct[1]-pt[1],2)):0,Et=et===2?Math.sqrt(Math.pow(ct[0]-xt[0],2)+Math.pow(ct[1]-xt[1],2)):0;setPoint(e,i.v[s%i._length],c,nt,a,Et/((b+1)*2),St/((b+1)*2))}function zigZagSegment(e,i,s,a,b,et){for(var nt=0;nt<a;nt+=1){var c=(nt+1)/(a+1),ct=b===2?Math.sqrt(Math.pow(i.points[3][0]-i.points[0][0],2)+Math.pow(i.points[3][1]-i.points[0][1],2)):0,pt=i.normalAngle(c),xt=i.point(c);setPoint(e,xt,pt,et,s,ct/((a+1)*2),ct/((a+1)*2)),et=-et}return et}ZigZagModifier.prototype.processPath=function(e,i,s,a){var b=e._length,et=shapePool.newElement();if(et.c=e.c,e.c||(b-=1),b===0)return et;var nt=-1,c=PolynomialBezier.shapeSegment(e,0);zigZagCorner(et,e,0,i,s,a,nt);for(var ct=0;ct<b;ct+=1)nt=zigZagSegment(et,c,i,s,a,-nt),ct===b-1&&!e.c?c=null:c=PolynomialBezier.shapeSegment(e,(ct+1)%b),zigZagCorner(et,e,ct+1,i,s,a,nt);return et},ZigZagModifier.prototype.processShapes=function(e){var i,s,a=this.shapes.length,b,et,nt=this.amplitude.v,c=Math.max(0,Math.round(this.frequency.v)),ct=this.pointsType.v;if(nt!==0){var pt,xt;for(s=0;s<a;s+=1){if(pt=this.shapes[s],xt=pt.localShapeCollection,!(!pt.shape._mdf&&!this._mdf&&!e))for(xt.releaseShapes(),pt.shape._mdf=!0,i=pt.shape.paths.shapes,et=pt.shape.paths._length,b=0;b<et;b+=1)xt.addShape(this.processPath(i[b],nt,c,ct));pt.shape.paths=pt.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function linearOffset(e,i,s){var a=Math.atan2(i[0]-e[0],i[1]-e[1]);return[polarOffset(e,a,s),polarOffset(i,a,s)]}function offsetSegment(e,i){var s,a,b,et,nt,c,ct;ct=linearOffset(e.points[0],e.points[1],i),s=ct[0],a=ct[1],ct=linearOffset(e.points[1],e.points[2],i),b=ct[0],et=ct[1],ct=linearOffset(e.points[2],e.points[3],i),nt=ct[0],c=ct[1];var pt=lineIntersection(s,a,b,et);pt===null&&(pt=a);var xt=lineIntersection(nt,c,b,et);return xt===null&&(xt=nt),new PolynomialBezier(s,pt,xt,c)}function joinLines(e,i,s,a,b){var et=i.points[3],nt=s.points[0];if(a===3||pointEqual(et,nt))return et;if(a===2){var c=-i.tangentAngle(1),ct=-s.tangentAngle(0)+Math.PI,pt=lineIntersection(et,polarOffset(et,c+Math.PI/2,100),nt,polarOffset(nt,c+Math.PI/2,100)),xt=pt?pointDistance(pt,et):pointDistance(et,nt)/2,St=polarOffset(et,c,2*xt*roundCorner);return e.setXYAt(St[0],St[1],"o",e.length()-1),St=polarOffset(nt,ct,2*xt*roundCorner),e.setTripleAt(nt[0],nt[1],nt[0],nt[1],St[0],St[1],e.length()),nt}var Et=pointEqual(et,i.points[2])?i.points[0]:i.points[2],Rt=pointEqual(nt,s.points[1])?s.points[3]:s.points[1],Nt=lineIntersection(Et,et,nt,Rt);return Nt&&pointDistance(Nt,et)<b?(e.setTripleAt(Nt[0],Nt[1],Nt[0],Nt[1],Nt[0],Nt[1],e.length()),Nt):et}function getIntersection(e,i){var s=e.intersections(i);return s.length&&floatEqual(s[0][0],1)&&s.shift(),s.length?s[0]:null}function pruneSegmentIntersection(e,i){var s=e.slice(),a=i.slice(),b=getIntersection(e[e.length-1],i[0]);return b&&(s[e.length-1]=e[e.length-1].split(b[0])[0],a[0]=i[0].split(b[1])[1]),e.length>1&&i.length>1&&(b=getIntersection(e[0],i[i.length-1]),b)?[[e[0].split(b[0])[0]],[i[i.length-1].split(b[1])[1]]]:[s,a]}function pruneIntersections(e){for(var i,s=1;s<e.length;s+=1)i=pruneSegmentIntersection(e[s-1],e[s]),e[s-1]=i[0],e[s]=i[1];return e.length>1&&(i=pruneSegmentIntersection(e[e.length-1],e[0]),e[e.length-1]=i[0],e[0]=i[1]),e}function offsetSegmentSplit(e,i){var s=e.inflectionPoints(),a,b,et,nt;if(s.length===0)return[offsetSegment(e,i)];if(s.length===1||floatEqual(s[1],1))return et=e.split(s[0]),a=et[0],b=et[1],[offsetSegment(a,i),offsetSegment(b,i)];et=e.split(s[0]),a=et[0];var c=(s[1]-s[0])/(1-s[0]);return et=et[1].split(c),nt=et[0],b=et[1],[offsetSegment(a,i),offsetSegment(nt,i),offsetSegment(b,i)]}function OffsetPathModifier(){}extendPrototype([ShapeModifier],OffsetPathModifier),OffsetPathModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,i.a,0,null,this),this.miterLimit=PropertyFactory.getProp(e,i.ml,0,null,this),this.lineJoin=i.lj,this._isAnimated=this.amount.effectsSequence.length!==0},OffsetPathModifier.prototype.processPath=function(e,i,s,a){var b=shapePool.newElement();b.c=e.c;var et=e.length();e.c||(et-=1);var nt,c,ct,pt=[];for(nt=0;nt<et;nt+=1)ct=PolynomialBezier.shapeSegment(e,nt),pt.push(offsetSegmentSplit(ct,i));if(!e.c)for(nt=et-1;nt>=0;nt-=1)ct=PolynomialBezier.shapeSegmentInverted(e,nt),pt.push(offsetSegmentSplit(ct,i));pt=pruneIntersections(pt);var xt=null,St=null;for(nt=0;nt<pt.length;nt+=1){var Et=pt[nt];for(St&&(xt=joinLines(b,St,Et[0],s,a)),St=Et[Et.length-1],c=0;c<Et.length;c+=1)ct=Et[c],xt&&pointEqual(ct.points[0],xt)?b.setXYAt(ct.points[1][0],ct.points[1][1],"o",b.length()-1):b.setTripleAt(ct.points[0][0],ct.points[0][1],ct.points[1][0],ct.points[1][1],ct.points[0][0],ct.points[0][1],b.length()),b.setTripleAt(ct.points[3][0],ct.points[3][1],ct.points[3][0],ct.points[3][1],ct.points[2][0],ct.points[2][1],b.length()),xt=ct.points[3]}return pt.length&&joinLines(b,St,pt[0][0],s,a),b},OffsetPathModifier.prototype.processShapes=function(e){var i,s,a=this.shapes.length,b,et,nt=this.amount.v,c=this.miterLimit.v,ct=this.lineJoin;if(nt!==0){var pt,xt;for(s=0;s<a;s+=1){if(pt=this.shapes[s],xt=pt.localShapeCollection,!(!pt.shape._mdf&&!this._mdf&&!e))for(xt.releaseShapes(),pt.shape._mdf=!0,i=pt.shape.paths.shapes,et=pt.shape.paths._length,b=0;b<et;b+=1)xt.addShape(this.processPath(i[b],nt,ct,c));pt.shape.paths=pt.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function getFontProperties(e){for(var i=e.fStyle?e.fStyle.split(" "):[],s="normal",a="normal",b=i.length,et,nt=0;nt<b;nt+=1)switch(et=i[nt].toLowerCase(),et){case"italic":a="italic";break;case"bold":s="700";break;case"black":s="900";break;case"medium":s="500";break;case"regular":case"normal":s="400";break;case"light":case"thin":s="200";break}return{style:a,weight:e.fWeight||s}}var FontManager=function(){var e=5e3,i={w:0,size:0,shapes:[],data:{shapes:[]}},s=[];s=s.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var a=127988,b=917631,et=917601,nt=917626,c=65039,ct=8205,pt=127462,xt=127487,St=["d83cdffb","d83cdffc","d83cdffd","d83cdffe","d83cdfff"];function Et(xr){var gr=xr.split(","),rr,cr=gr.length,Hr=[];for(rr=0;rr<cr;rr+=1)gr[rr]!=="sans-serif"&&gr[rr]!=="monospace"&&Hr.push(gr[rr]);return Hr.join(",")}function Rt(xr,gr){var rr=createTag("span");rr.setAttribute("aria-hidden",!0),rr.style.fontFamily=gr;var cr=createTag("span");cr.innerText="giItT1WQy@!-/#",rr.style.position="absolute",rr.style.left="-10000px",rr.style.top="-10000px",rr.style.fontSize="300px",rr.style.fontVariant="normal",rr.style.fontStyle="normal",rr.style.fontWeight="normal",rr.style.letterSpacing="0",rr.appendChild(cr),document.body.appendChild(rr);var Hr=cr.offsetWidth;return cr.style.fontFamily=Et(xr)+", "+gr,{node:cr,w:Hr,parent:rr}}function Nt(){var xr,gr=this.fonts.length,rr,cr,Hr=gr;for(xr=0;xr<gr;xr+=1)this.fonts[xr].loaded?Hr-=1:this.fonts[xr].fOrigin==="n"||this.fonts[xr].origin===0?this.fonts[xr].loaded=!0:(rr=this.fonts[xr].monoCase.node,cr=this.fonts[xr].monoCase.w,rr.offsetWidth!==cr?(Hr-=1,this.fonts[xr].loaded=!0):(rr=this.fonts[xr].sansCase.node,cr=this.fonts[xr].sansCase.w,rr.offsetWidth!==cr&&(Hr-=1,this.fonts[xr].loaded=!0)),this.fonts[xr].loaded&&(this.fonts[xr].sansCase.parent.parentNode.removeChild(this.fonts[xr].sansCase.parent),this.fonts[xr].monoCase.parent.parentNode.removeChild(this.fonts[xr].monoCase.parent)));Hr!==0&&Date.now()-this.initTime<e?setTimeout(this.checkLoadedFontsBinded,20):setTimeout(this.setIsLoadedBinded,10)}function It(xr,gr){var rr=document.body&&gr?"svg":"canvas",cr,Hr=getFontProperties(xr);if(rr==="svg"){var $r=createNS("text");$r.style.fontSize="100px",$r.setAttribute("font-family",xr.fFamily),$r.setAttribute("font-style",Hr.style),$r.setAttribute("font-weight",Hr.weight),$r.textContent="1",xr.fClass?($r.style.fontFamily="inherit",$r.setAttribute("class",xr.fClass)):$r.style.fontFamily=xr.fFamily,gr.appendChild($r),cr=$r}else{var _n=new OffscreenCanvas(500,500).getContext("2d");_n.font=Hr.style+" "+Hr.weight+" 100px "+xr.fFamily,cr=_n}function fn(jn){return rr==="svg"?(cr.textContent=jn,cr.getComputedTextLength()):cr.measureText(jn).width}return{measureText:fn}}function Gt(xr,gr){if(!xr){this.isLoaded=!0;return}if(this.chars){this.isLoaded=!0,this.fonts=xr.list;return}if(!document.body){this.isLoaded=!0,xr.list.forEach(function(Nn){Nn.helper=It(Nn),Nn.cache={}}),this.fonts=xr.list;return}var rr=xr.list,cr,Hr=rr.length,$r=Hr;for(cr=0;cr<Hr;cr+=1){var _n=!0,fn,jn;if(rr[cr].loaded=!1,rr[cr].monoCase=Rt(rr[cr].fFamily,"monospace"),rr[cr].sansCase=Rt(rr[cr].fFamily,"sans-serif"),!rr[cr].fPath)rr[cr].loaded=!0,$r-=1;else if(rr[cr].fOrigin==="p"||rr[cr].origin===3){if(fn=document.querySelectorAll('style[f-forigin="p"][f-family="'+rr[cr].fFamily+'"], style[f-origin="3"][f-family="'+rr[cr].fFamily+'"]'),fn.length>0&&(_n=!1),_n){var vs=createTag("style");vs.setAttribute("f-forigin",rr[cr].fOrigin),vs.setAttribute("f-origin",rr[cr].origin),vs.setAttribute("f-family",rr[cr].fFamily),vs.type="text/css",vs.innerText="@font-face {font-family: "+rr[cr].fFamily+"; font-style: normal; src: url('"+rr[cr].fPath+"');}",gr.appendChild(vs)}}else if(rr[cr].fOrigin==="g"||rr[cr].origin===1){for(fn=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),jn=0;jn<fn.length;jn+=1)fn[jn].href.indexOf(rr[cr].fPath)!==-1&&(_n=!1);if(_n){var Cs=createTag("link");Cs.setAttribute("f-forigin",rr[cr].fOrigin),Cs.setAttribute("f-origin",rr[cr].origin),Cs.type="text/css",Cs.rel="stylesheet",Cs.href=rr[cr].fPath,document.body.appendChild(Cs)}}else if(rr[cr].fOrigin==="t"||rr[cr].origin===2){for(fn=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),jn=0;jn<fn.length;jn+=1)rr[cr].fPath===fn[jn].src&&(_n=!1);if(_n){var ns=createTag("link");ns.setAttribute("f-forigin",rr[cr].fOrigin),ns.setAttribute("f-origin",rr[cr].origin),ns.setAttribute("rel","stylesheet"),ns.setAttribute("href",rr[cr].fPath),gr.appendChild(ns)}}rr[cr].helper=It(rr[cr],gr),rr[cr].cache={},this.fonts.push(rr[cr])}$r===0?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}function Dt(xr){if(xr){this.chars||(this.chars=[]);var gr,rr=xr.length,cr,Hr=this.chars.length,$r;for(gr=0;gr<rr;gr+=1){for(cr=0,$r=!1;cr<Hr;)this.chars[cr].style===xr[gr].style&&this.chars[cr].fFamily===xr[gr].fFamily&&this.chars[cr].ch===xr[gr].ch&&($r=!0),cr+=1;$r||(this.chars.push(xr[gr]),Hr+=1)}}}function Bt(xr,gr,rr){for(var cr=0,Hr=this.chars.length;cr<Hr;){if(this.chars[cr].ch===xr&&this.chars[cr].style===gr&&this.chars[cr].fFamily===rr)return this.chars[cr];cr+=1}return(typeof xr=="string"&&xr.charCodeAt(0)!==13||!xr)&&console&&console.warn&&!this._warned&&(this._warned=!0,console.warn("Missing character from exported characters list: ",xr,gr,rr)),i}function Lt(xr,gr,rr){var cr=this.getFontByName(gr),Hr=xr;if(!cr.cache[Hr]){var $r=cr.helper;if(xr===" "){var _n=$r.measureText("|"+xr+"|"),fn=$r.measureText("||");cr.cache[Hr]=(_n-fn)/100}else cr.cache[Hr]=$r.measureText(xr)/100}return cr.cache[Hr]*rr}function Vt(xr){for(var gr=0,rr=this.fonts.length;gr<rr;){if(this.fonts[gr].fName===xr)return this.fonts[gr];gr+=1}return this.fonts[0]}function Zt(xr){var gr=0,rr=xr.charCodeAt(0);if(rr>=55296&&rr<=56319){var cr=xr.charCodeAt(1);cr>=56320&&cr<=57343&&(gr=(rr-55296)*1024+cr-56320+65536)}return gr}function nr(xr,gr){var rr=xr.toString(16)+gr.toString(16);return St.indexOf(rr)!==-1}function ur(xr){return xr===ct}function _r(xr){return xr===c}function Ur(xr){var gr=Zt(xr);return gr>=pt&&gr<=xt}function ln(xr){return Ur(xr.substr(0,2))&&Ur(xr.substr(2,2))}function an(xr){return s.indexOf(xr)!==-1}function Fr(xr,gr){var rr=Zt(xr.substr(gr,2));if(rr!==a)return!1;var cr=0;for(gr+=2;cr<5;){if(rr=Zt(xr.substr(gr,2)),rr<et||rr>nt)return!1;cr+=1,gr+=2}return Zt(xr.substr(gr,2))===b}function rn(){this.isLoaded=!0}var gn=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this._warned=!1,this.initTime=Date.now(),this.setIsLoadedBinded=this.setIsLoaded.bind(this),this.checkLoadedFontsBinded=this.checkLoadedFonts.bind(this)};gn.isModifier=nr,gn.isZeroWidthJoiner=ur,gn.isFlagEmoji=ln,gn.isRegionalCode=Ur,gn.isCombinedCharacter=an,gn.isRegionalFlag=Fr,gn.isVariationSelector=_r,gn.BLACK_FLAG_CODE_POINT=a;var _i={addChars:Dt,addFonts:Gt,getCharData:Bt,getFontByName:Vt,measureText:Lt,checkLoadedFonts:Nt,setIsLoaded:rn};return gn.prototype=_i,gn}();function SlotManager(e){this.animationData=e}SlotManager.prototype.getProp=function(e){return this.animationData.slots&&this.animationData.slots[e.sid]?Object.assign(e,this.animationData.slots[e.sid].p):e};function slotFactory(e){return new SlotManager(e)}function RenderableElement(){}RenderableElement.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(i){this.renderableComponents.indexOf(i)===-1&&this.renderableComponents.push(i)},removeRenderableComponent:function(i){this.renderableComponents.indexOf(i)!==-1&&this.renderableComponents.splice(this.renderableComponents.indexOf(i),1)},prepareRenderableFrame:function(i){this.checkLayerLimits(i)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(i){this.data.ip-this.data.st<=i&&this.data.op-this.data.st>i?this.isInRange!==!0&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):this.isInRange!==!1&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var i,s=this.renderableComponents.length;for(i=0;i<s;i+=1)this.renderableComponents[i].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return this.data.ty===5?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}};var getBlendMode=function(){var e={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"};return function(i){return e[i]||""}}();function SliderEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,0,0,s)}function AngleEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,0,0,s)}function ColorEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,1,0,s)}function PointEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,1,0,s)}function LayerIndexEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,0,0,s)}function MaskIndexEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,0,0,s)}function CheckboxEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,0,0,s)}function NoValueEffect(){this.p={}}function EffectsManager(e,i){var s=e.ef||[];this.effectElements=[];var a,b=s.length,et;for(a=0;a<b;a+=1)et=new GroupEffect(s[a],i),this.effectElements.push(et)}function GroupEffect(e,i){this.init(e,i)}extendPrototype([DynamicPropertyContainer],GroupEffect),GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties,GroupEffect.prototype.init=function(e,i){this.data=e,this.effectElements=[],this.initDynamicPropertyContainer(i);var s,a=this.data.ef.length,b,et=this.data.ef;for(s=0;s<a;s+=1){switch(b=null,et[s].ty){case 0:b=new SliderEffect(et[s],i,this);break;case 1:b=new AngleEffect(et[s],i,this);break;case 2:b=new ColorEffect(et[s],i,this);break;case 3:b=new PointEffect(et[s],i,this);break;case 4:case 7:b=new CheckboxEffect(et[s],i,this);break;case 10:b=new LayerIndexEffect(et[s],i,this);break;case 11:b=new MaskIndexEffect(et[s],i,this);break;case 5:b=new EffectsManager(et[s],i);break;default:b=new NoValueEffect(et[s]);break}b&&this.effectElements.push(b)}};function BaseElement(){}BaseElement.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var i=0,s=this.data.masksProperties.length;i<s;){if(this.data.masksProperties[i].mode!=="n"&&this.data.masksProperties[i].cl!==!1)return!0;i+=1}return!1},initExpressions:function(){var i=getExpressionInterfaces();if(i){var s=i("layer"),a=i("effects"),b=i("shape"),et=i("text"),nt=i("comp");this.layerInterface=s(this),this.data.hasMask&&this.maskManager&&this.layerInterface.registerMaskInterface(this.maskManager);var c=a.createEffectsInterface(this,this.layerInterface);this.layerInterface.registerEffectsInterface(c),this.data.ty===0||this.data.xt?this.compInterface=nt(this):this.data.ty===4?(this.layerInterface.shapeInterface=b(this.shapesData,this.itemsData,this.layerInterface),this.layerInterface.content=this.layerInterface.shapeInterface):this.data.ty===5&&(this.layerInterface.textInterface=et(this),this.layerInterface.text=this.layerInterface.textInterface)}},setBlendMode:function(){var i=getBlendMode(this.data.bm),s=this.baseElement||this.layerElement;s.style["mix-blend-mode"]=i},initBaseData:function(i,s,a){this.globalData=s,this.comp=a,this.data=i,this.layerId=createElementID(),this.data.sr||(this.data.sr=1),this.effectsManager=new EffectsManager(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}};function FrameElement(){}FrameElement.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(i,s){var a,b=this.dynamicProperties.length;for(a=0;a<b;a+=1)(s||this._isParent&&this.dynamicProperties[a].propType==="transform")&&(this.dynamicProperties[a].getValue(),this.dynamicProperties[a]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(i){this.dynamicProperties.indexOf(i)===-1&&this.dynamicProperties.push(i)}};function FootageElement(e,i,s){this.initFrame(),this.initRenderable(),this.assetData=i.getAssetData(e.refId),this.footageData=i.imageLoader.getAsset(this.assetData),this.initBaseData(e,i,s)}FootageElement.prototype.prepareFrame=function(){},extendPrototype([RenderableElement,BaseElement,FrameElement],FootageElement),FootageElement.prototype.getBaseElement=function(){return null},FootageElement.prototype.renderFrame=function(){},FootageElement.prototype.destroy=function(){},FootageElement.prototype.initExpressions=function(){var e=getExpressionInterfaces();if(e){var i=e("footage");this.layerInterface=i(this)}},FootageElement.prototype.getFootageData=function(){return this.footageData};function AudioElement(e,i,s){this.initFrame(),this.initRenderable(),this.assetData=i.getAssetData(e.refId),this.initBaseData(e,i,s),this._isPlaying=!1,this._canPlay=!1;var a=this.globalData.getAssetsPath(this.assetData);this.audio=this.globalData.audioController.createAudio(a),this._currentTime=0,this.globalData.audioController.addAudio(this),this._volumeMultiplier=1,this._volume=1,this._previousVolume=null,this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0},this.lv=PropertyFactory.getProp(this,e.au&&e.au.lv?e.au.lv:{k:[100]},1,.01,this)}AudioElement.prototype.prepareFrame=function(e){if(this.prepareRenderableFrame(e,!0),this.prepareProperties(e,!0),this.tm._placeholder)this._currentTime=e/this.data.sr;else{var i=this.tm.v;this._currentTime=i}this._volume=this.lv.v[0];var s=this._volume*this._volumeMultiplier;this._previousVolume!==s&&(this._previousVolume=s,this.audio.volume(s))},extendPrototype([RenderableElement,BaseElement,FrameElement],AudioElement),AudioElement.prototype.renderFrame=function(){this.isInRange&&this._canPlay&&(this._isPlaying?(!this.audio.playing()||Math.abs(this._currentTime/this.globalData.frameRate-this.audio.seek())>.1)&&this.audio.seek(this._currentTime/this.globalData.frameRate):(this.audio.play(),this.audio.seek(this._currentTime/this.globalData.frameRate),this._isPlaying=!0))},AudioElement.prototype.show=function(){},AudioElement.prototype.hide=function(){this.audio.pause(),this._isPlaying=!1},AudioElement.prototype.pause=function(){this.audio.pause(),this._isPlaying=!1,this._canPlay=!1},AudioElement.prototype.resume=function(){this._canPlay=!0},AudioElement.prototype.setRate=function(e){this.audio.rate(e)},AudioElement.prototype.volume=function(e){this._volumeMultiplier=e,this._previousVolume=e*this._volume,this.audio.volume(this._previousVolume)},AudioElement.prototype.getBaseElement=function(){return null},AudioElement.prototype.destroy=function(){},AudioElement.prototype.sourceRectAtTime=function(){},AudioElement.prototype.initExpressions=function(){};function BaseRenderer(){}BaseRenderer.prototype.checkLayers=function(e){var i,s=this.layers.length,a;for(this.completeLayers=!0,i=s-1;i>=0;i-=1)this.elements[i]||(a=this.layers[i],a.ip-a.st<=e-this.layers[i].st&&a.op-a.st>e-this.layers[i].st&&this.buildItem(i)),this.completeLayers=this.elements[i]?this.completeLayers:!1;this.checkPendingElements()},BaseRenderer.prototype.createItem=function(e){switch(e.ty){case 2:return this.createImage(e);case 0:return this.createComp(e);case 1:return this.createSolid(e);case 3:return this.createNull(e);case 4:return this.createShape(e);case 5:return this.createText(e);case 6:return this.createAudio(e);case 13:return this.createCamera(e);case 15:return this.createFootage(e);default:return this.createNull(e)}},BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},BaseRenderer.prototype.createAudio=function(e){return new AudioElement(e,this.globalData,this)},BaseRenderer.prototype.createFootage=function(e){return new FootageElement(e,this.globalData,this)},BaseRenderer.prototype.buildAllItems=function(){var e,i=this.layers.length;for(e=0;e<i;e+=1)this.buildItem(e);this.checkPendingElements()},BaseRenderer.prototype.includeLayers=function(e){this.completeLayers=!1;var i,s=e.length,a,b=this.layers.length;for(i=0;i<s;i+=1)for(a=0;a<b;){if(this.layers[a].id===e[i].id){this.layers[a]=e[i];break}a+=1}},BaseRenderer.prototype.setProjectInterface=function(e){this.globalData.projectInterface=e},BaseRenderer.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},BaseRenderer.prototype.buildElementParenting=function(e,i,s){for(var a=this.elements,b=this.layers,et=0,nt=b.length;et<nt;)b[et].ind==i&&(!a[et]||a[et]===!0?(this.buildItem(et),this.addPendingElement(e)):(s.push(a[et]),a[et].setAsParent(),b[et].parent!==void 0?this.buildElementParenting(e,b[et].parent,s):e.setHierarchy(s))),et+=1},BaseRenderer.prototype.addPendingElement=function(e){this.pendingElements.push(e)},BaseRenderer.prototype.searchExtraCompositions=function(e){var i,s=e.length;for(i=0;i<s;i+=1)if(e[i].xt){var a=this.createComp(e[i]);a.initExpressions(),this.globalData.projectInterface.registerComposition(a)}},BaseRenderer.prototype.getElementById=function(e){var i,s=this.elements.length;for(i=0;i<s;i+=1)if(this.elements[i].data.ind===e)return this.elements[i];return null},BaseRenderer.prototype.getElementByPath=function(e){var i=e.shift(),s;if(typeof i=="number")s=this.elements[i];else{var a,b=this.elements.length;for(a=0;a<b;a+=1)if(this.elements[a].data.nm===i){s=this.elements[a];break}}return e.length===0?s:s.getElementByPath(e)},BaseRenderer.prototype.setupGlobalData=function(e,i){this.globalData.fontManager=new FontManager,this.globalData.slotManager=slotFactory(e),this.globalData.fontManager.addChars(e.chars),this.globalData.fontManager.addFonts(e.fonts,i),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.audioController=this.animationItem.audioController,this.globalData.frameId=0,this.globalData.frameRate=e.fr,this.globalData.nm=e.nm,this.globalData.compSize={w:e.w,h:e.h}};var effectTypes={TRANSFORM_EFFECT:"transformEFfect"};function TransformElement(){}TransformElement.prototype={initTransform:function(){var i=new Matrix;this.finalTransform={mProp:this.data.ks?TransformPropertyFactory.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_localMatMdf:!1,_opMdf:!1,mat:i,localMat:i,localOpacity:1},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var i,s=this.finalTransform.mat,a=0,b=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;a<b;){if(this.hierarchy[a].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}a+=1}if(this.finalTransform._matMdf)for(i=this.finalTransform.mProp.v.props,s.cloneFromProps(i),a=0;a<b;a+=1)s.multiply(this.hierarchy[a].finalTransform.mProp.v)}(!this.localTransforms||this.finalTransform._matMdf)&&(this.finalTransform._localMatMdf=this.finalTransform._matMdf),this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v)},renderLocalTransform:function(){if(this.localTransforms){var i=0,s=this.localTransforms.length;if(this.finalTransform._localMatMdf=this.finalTransform._matMdf,!this.finalTransform._localMatMdf||!this.finalTransform._opMdf)for(;i<s;)this.localTransforms[i]._mdf&&(this.finalTransform._localMatMdf=!0),this.localTransforms[i]._opMdf&&!this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v,this.finalTransform._opMdf=!0),i+=1;if(this.finalTransform._localMatMdf){var a=this.finalTransform.localMat;for(this.localTransforms[0].matrix.clone(a),i=1;i<s;i+=1){var b=this.localTransforms[i].matrix;a.multiply(b)}a.multiply(this.finalTransform.mat)}if(this.finalTransform._opMdf){var et=this.finalTransform.localOpacity;for(i=0;i<s;i+=1)et*=this.localTransforms[i].opacity*.01;this.finalTransform.localOpacity=et}}},searchEffectTransforms:function(){if(this.renderableEffectsManager){var i=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT);if(i.length){this.localTransforms=[],this.finalTransform.localMat=new Matrix;var s=0,a=i.length;for(s=0;s<a;s+=1)this.localTransforms.push(i[s])}}},globalToLocal:function(i){var s=[];s.push(this.finalTransform);for(var a=!0,b=this.comp;a;)b.finalTransform?(b.data.hasMask&&s.splice(0,0,b.finalTransform),b=b.comp):a=!1;var et,nt=s.length,c;for(et=0;et<nt;et+=1)c=s[et].mat.applyToPointArray(0,0,0),i=[i[0]-c[0],i[1]-c[1],0];return i},mHelper:new Matrix};function MaskElement(e,i,s){this.data=e,this.element=i,this.globalData=s,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var a=this.globalData.defs,b,et=this.masksProperties?this.masksProperties.length:0;this.viewData=createSizedArray(et),this.solidPath="";var nt,c=this.masksProperties,ct=0,pt=[],xt,St,Et=createElementID(),Rt,Nt,It,Gt,Dt="clipPath",Bt="clip-path";for(b=0;b<et;b+=1)if((c[b].mode!=="a"&&c[b].mode!=="n"||c[b].inv||c[b].o.k!==100||c[b].o.x)&&(Dt="mask",Bt="mask"),(c[b].mode==="s"||c[b].mode==="i")&&ct===0?(Rt=createNS("rect"),Rt.setAttribute("fill","#ffffff"),Rt.setAttribute("width",this.element.comp.data.w||0),Rt.setAttribute("height",this.element.comp.data.h||0),pt.push(Rt)):Rt=null,nt=createNS("path"),c[b].mode==="n")this.viewData[b]={op:PropertyFactory.getProp(this.element,c[b].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,c[b],3),elem:nt,lastPath:""},a.appendChild(nt);else{ct+=1,nt.setAttribute("fill",c[b].mode==="s"?"#000000":"#ffffff"),nt.setAttribute("clip-rule","nonzero");var Lt;if(c[b].x.k!==0?(Dt="mask",Bt="mask",Gt=PropertyFactory.getProp(this.element,c[b].x,0,null,this.element),Lt=createElementID(),Nt=createNS("filter"),Nt.setAttribute("id",Lt),It=createNS("feMorphology"),It.setAttribute("operator","erode"),It.setAttribute("in","SourceGraphic"),It.setAttribute("radius","0"),Nt.appendChild(It),a.appendChild(Nt),nt.setAttribute("stroke",c[b].mode==="s"?"#000000":"#ffffff")):(It=null,Gt=null),this.storedData[b]={elem:nt,x:Gt,expan:It,lastPath:"",lastOperator:"",filterId:Lt,lastRadius:0},c[b].mode==="i"){St=pt.length;var Vt=createNS("g");for(xt=0;xt<St;xt+=1)Vt.appendChild(pt[xt]);var Zt=createNS("mask");Zt.setAttribute("mask-type","alpha"),Zt.setAttribute("id",Et+"_"+ct),Zt.appendChild(nt),a.appendChild(Zt),Vt.setAttribute("mask","url("+getLocationHref()+"#"+Et+"_"+ct+")"),pt.length=0,pt.push(Vt)}else pt.push(nt);c[b].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[b]={elem:nt,lastPath:"",op:PropertyFactory.getProp(this.element,c[b].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,c[b],3),invRect:Rt},this.viewData[b].prop.k||this.drawPath(c[b],this.viewData[b].prop.v,this.viewData[b])}for(this.maskElement=createNS(Dt),et=pt.length,b=0;b<et;b+=1)this.maskElement.appendChild(pt[b]);ct>0&&(this.maskElement.setAttribute("id",Et),this.element.maskedElement.setAttribute(Bt,"url("+getLocationHref()+"#"+Et+")"),a.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}MaskElement.prototype.getMaskProperty=function(e){return this.viewData[e].prop},MaskElement.prototype.renderFrame=function(e){var i=this.element.finalTransform.mat,s,a=this.masksProperties.length;for(s=0;s<a;s+=1)if((this.viewData[s].prop._mdf||e)&&this.drawPath(this.masksProperties[s],this.viewData[s].prop.v,this.viewData[s]),(this.viewData[s].op._mdf||e)&&this.viewData[s].elem.setAttribute("fill-opacity",this.viewData[s].op.v),this.masksProperties[s].mode!=="n"&&(this.viewData[s].invRect&&(this.element.finalTransform.mProp._mdf||e)&&this.viewData[s].invRect.setAttribute("transform",i.getInverseMatrix().to2dCSS()),this.storedData[s].x&&(this.storedData[s].x._mdf||e))){var b=this.storedData[s].expan;this.storedData[s].x.v<0?(this.storedData[s].lastOperator!=="erode"&&(this.storedData[s].lastOperator="erode",this.storedData[s].elem.setAttribute("filter","url("+getLocationHref()+"#"+this.storedData[s].filterId+")")),b.setAttribute("radius",-this.storedData[s].x.v)):(this.storedData[s].lastOperator!=="dilate"&&(this.storedData[s].lastOperator="dilate",this.storedData[s].elem.setAttribute("filter",null)),this.storedData[s].elem.setAttribute("stroke-width",this.storedData[s].x.v*2))}},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var e="M0,0 ";return e+=" h"+this.globalData.compSize.w,e+=" v"+this.globalData.compSize.h,e+=" h-"+this.globalData.compSize.w,e+=" v-"+this.globalData.compSize.h+" ",e},MaskElement.prototype.drawPath=function(e,i,s){var a=" M"+i.v[0][0]+","+i.v[0][1],b,et;for(et=i._length,b=1;b<et;b+=1)a+=" C"+i.o[b-1][0]+","+i.o[b-1][1]+" "+i.i[b][0]+","+i.i[b][1]+" "+i.v[b][0]+","+i.v[b][1];if(i.c&&et>1&&(a+=" C"+i.o[b-1][0]+","+i.o[b-1][1]+" "+i.i[0][0]+","+i.i[0][1]+" "+i.v[0][0]+","+i.v[0][1]),s.lastPath!==a){var nt="";s.elem&&(i.c&&(nt=e.inv?this.solidPath+a:a),s.elem.setAttribute("d",nt)),s.lastPath=a}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null};var filtersFactory=function(){var e={};e.createFilter=i,e.createAlphaToLuminanceFilter=s;function i(a,b){var et=createNS("filter");return et.setAttribute("id",a),b!==!0&&(et.setAttribute("filterUnits","objectBoundingBox"),et.setAttribute("x","0%"),et.setAttribute("y","0%"),et.setAttribute("width","100%"),et.setAttribute("height","100%")),et}function s(){var a=createNS("feColorMatrix");return a.setAttribute("type","matrix"),a.setAttribute("color-interpolation-filters","sRGB"),a.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),a}return e}(),featureSupport=function(){var e={maskType:!0,svgLumaHidden:!0,offscreenCanvas:typeof OffscreenCanvas<"u"};return(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(e.maskType=!1),/firefox/i.test(navigator.userAgent)&&(e.svgLumaHidden=!1),e}(),registeredEffects$1={},idPrefix="filter_result_";function SVGEffects(e){var i,s="SourceGraphic",a=e.data.ef?e.data.ef.length:0,b=createElementID(),et=filtersFactory.createFilter(b,!0),nt=0;this.filters=[];var c;for(i=0;i<a;i+=1){c=null;var ct=e.data.ef[i].ty;if(registeredEffects$1[ct]){var pt=registeredEffects$1[ct].effect;c=new pt(et,e.effectsManager.effectElements[i],e,idPrefix+nt,s),s=idPrefix+nt,registeredEffects$1[ct].countsAsEffect&&(nt+=1)}c&&this.filters.push(c)}nt&&(e.globalData.defs.appendChild(et),e.layerElement.setAttribute("filter","url("+getLocationHref()+"#"+b+")")),this.filters.length&&e.addRenderableComponent(this)}SVGEffects.prototype.renderFrame=function(e){var i,s=this.filters.length;for(i=0;i<s;i+=1)this.filters[i].renderFrame(e)},SVGEffects.prototype.getEffects=function(e){var i,s=this.filters.length,a=[];for(i=0;i<s;i+=1)this.filters[i].type===e&&a.push(this.filters[i]);return a};function registerEffect$1(e,i,s){registeredEffects$1[e]={effect:i,countsAsEffect:s}}function SVGBaseElement(){}SVGBaseElement.prototype={initRendererElement:function(){this.layerElement=createNS("g")},createContainerElements:function(){this.matteElement=createNS("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var i=null;if(this.data.td){this.matteMasks={};var s=createNS("g");s.setAttribute("id",this.layerId),s.appendChild(this.layerElement),i=s,this.globalData.defs.appendChild(s)}else this.data.tt?(this.matteElement.appendChild(this.layerElement),i=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.ty===0&&!this.data.hd){var a=createNS("clipPath"),b=createNS("path");b.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var et=createElementID();if(a.setAttribute("id",et),a.appendChild(b),this.globalData.defs.appendChild(a),this.checkMasks()){var nt=createNS("g");nt.setAttribute("clip-path","url("+getLocationHref()+"#"+et+")"),nt.appendChild(this.layerElement),this.transformedElement=nt,i?i.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+et+")")}this.data.bm!==0&&this.setBlendMode()},renderElement:function(){this.finalTransform._localMatMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.localMat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.localOpacity)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData),this.renderableEffectsManager=new SVGEffects(this),this.searchEffectTransforms()},getMatte:function(i){if(this.matteMasks||(this.matteMasks={}),!this.matteMasks[i]){var s=this.layerId+"_"+i,a,b,et,nt;if(i===1||i===3){var c=createNS("mask");c.setAttribute("id",s),c.setAttribute("mask-type",i===3?"luminance":"alpha"),et=createNS("use"),et.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),c.appendChild(et),this.globalData.defs.appendChild(c),!featureSupport.maskType&&i===1&&(c.setAttribute("mask-type","luminance"),a=createElementID(),b=filtersFactory.createFilter(a),this.globalData.defs.appendChild(b),b.appendChild(filtersFactory.createAlphaToLuminanceFilter()),nt=createNS("g"),nt.appendChild(et),c.appendChild(nt),nt.setAttribute("filter","url("+getLocationHref()+"#"+a+")"))}else if(i===2){var ct=createNS("mask");ct.setAttribute("id",s),ct.setAttribute("mask-type","alpha");var pt=createNS("g");ct.appendChild(pt),a=createElementID(),b=filtersFactory.createFilter(a);var xt=createNS("feComponentTransfer");xt.setAttribute("in","SourceGraphic"),b.appendChild(xt);var St=createNS("feFuncA");St.setAttribute("type","table"),St.setAttribute("tableValues","1.0 0.0"),xt.appendChild(St),this.globalData.defs.appendChild(b);var Et=createNS("rect");Et.setAttribute("width",this.comp.data.w),Et.setAttribute("height",this.comp.data.h),Et.setAttribute("x","0"),Et.setAttribute("y","0"),Et.setAttribute("fill","#ffffff"),Et.setAttribute("opacity","0"),pt.setAttribute("filter","url("+getLocationHref()+"#"+a+")"),pt.appendChild(Et),et=createNS("use"),et.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),pt.appendChild(et),featureSupport.maskType||(ct.setAttribute("mask-type","luminance"),b.appendChild(filtersFactory.createAlphaToLuminanceFilter()),nt=createNS("g"),pt.appendChild(Et),nt.appendChild(this.layerElement),pt.appendChild(nt)),this.globalData.defs.appendChild(ct)}this.matteMasks[i]=s}return this.matteMasks[i]},setMatte:function(i){this.matteElement&&this.matteElement.setAttribute("mask","url("+getLocationHref()+"#"+i+")")}};function HierarchyElement(){}HierarchyElement.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(i){this.hierarchy=i},setAsParent:function(){this._isParent=!0},checkParenting:function(){this.data.parent!==void 0&&this.comp.buildElementParenting(this,this.data.parent,[])}};function RenderableDOMElement(){}(function(){var e={initElement:function(s,a,b){this.initFrame(),this.initBaseData(s,a,b),this.initTransform(s,a,b),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){if(!this.hidden&&(!this.isInRange||this.isTransparent)){var s=this.baseElement||this.layerElement;s.style.display="none",this.hidden=!0}},show:function(){if(this.isInRange&&!this.isTransparent){if(!this.data.hd){var s=this.baseElement||this.layerElement;s.style.display="block"}this.hidden=!1,this._isFirstFrame=!0}},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(s){this._mdf=!1,this.prepareRenderableFrame(s),this.prepareProperties(s,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}};extendPrototype([RenderableElement,createProxyFunction(e)],RenderableDOMElement)})();function IImageElement(e,i,s){this.assetData=i.getAssetData(e.refId),this.assetData&&this.assetData.sid&&(this.assetData=i.slotManager.getProp(this.assetData)),this.initElement(e,i,s),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement),IImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData);this.innerElem=createNS("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.innerElem)},IImageElement.prototype.sourceRectAtTime=function(){return this.sourceRect};function ProcessedElement(e,i){this.elem=e,this.pos=i}function IShapeElement(){}IShapeElement.prototype={addShapeToModifiers:function(i){var s,a=this.shapeModifiers.length;for(s=0;s<a;s+=1)this.shapeModifiers[s].addShape(i)},isShapeInAnimatedModifiers:function(i){for(var s=0,a=this.shapeModifiers.length;s<a;)if(this.shapeModifiers[s].isAnimatedWithShape(i))return!0;return!1},renderModifiers:function(){if(this.shapeModifiers.length){var i,s=this.shapes.length;for(i=0;i<s;i+=1)this.shapes[i].sh.reset();s=this.shapeModifiers.length;var a;for(i=s-1;i>=0&&(a=this.shapeModifiers[i].processShapes(this._isFirstFrame),!a);i-=1);}},searchProcessedElement:function(i){for(var s=this.processedElements,a=0,b=s.length;a<b;){if(s[a].elem===i)return s[a].pos;a+=1}return 0},addProcessedElement:function(i,s){for(var a=this.processedElements,b=a.length;b;)if(b-=1,a[b].elem===i){a[b].pos=s;return}a.push(new ProcessedElement(i,s))},prepareFrame:function(i){this.prepareRenderableFrame(i),this.prepareProperties(i,this.isInRange)}};var lineCapEnum={1:"butt",2:"round",3:"square"},lineJoinEnum={1:"miter",2:"round",3:"bevel"};function SVGShapeData(e,i,s){this.caches=[],this.styles=[],this.transformers=e,this.lStr="",this.sh=s,this.lvl=i,this._isAnimated=!!s.k;for(var a=0,b=e.length;a<b;){if(e[a].mProps.dynamicProperties.length){this._isAnimated=!0;break}a+=1}}SVGShapeData.prototype.setAsAnimated=function(){this._isAnimated=!0};function SVGStyleData(e,i){this.data=e,this.type=e.ty,this.d="",this.lvl=i,this._mdf=!1,this.closed=e.hd===!0,this.pElem=createNS("path"),this.msElem=null}SVGStyleData.prototype.reset=function(){this.d="",this._mdf=!1};function DashProperty(e,i,s,a){this.elem=e,this.frameId=-1,this.dataProps=createSizedArray(i.length),this.renderer=s,this.k=!1,this.dashStr="",this.dashArray=createTypedArray("float32",i.length?i.length-1:0),this.dashoffset=createTypedArray("float32",1),this.initDynamicPropertyContainer(a);var b,et=i.length||0,nt;for(b=0;b<et;b+=1)nt=PropertyFactory.getProp(e,i[b].v,0,0,this),this.k=nt.k||this.k,this.dataProps[b]={n:i[b].n,p:nt};this.k||this.getValue(!0),this._isAnimated=this.k}DashProperty.prototype.getValue=function(e){if(!(this.elem.globalData.frameId===this.frameId&&!e)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||e,this._mdf)){var i=0,s=this.dataProps.length;for(this.renderer==="svg"&&(this.dashStr=""),i=0;i<s;i+=1)this.dataProps[i].n!=="o"?this.renderer==="svg"?this.dashStr+=" "+this.dataProps[i].p.v:this.dashArray[i]=this.dataProps[i].p.v:this.dashoffset[0]=this.dataProps[i].p.v}},extendPrototype([DynamicPropertyContainer],DashProperty);function SVGStrokeStyleData(e,i,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,i.o,0,.01,this),this.w=PropertyFactory.getProp(e,i.w,0,null,this),this.d=new DashProperty(e,i.d||{},"svg",this),this.c=PropertyFactory.getProp(e,i.c,1,255,this),this.style=s,this._isAnimated=!!this._isAnimated}extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData);function SVGFillStyleData(e,i,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,i.o,0,.01,this),this.c=PropertyFactory.getProp(e,i.c,1,255,this),this.style=s}extendPrototype([DynamicPropertyContainer],SVGFillStyleData);function SVGNoStyleData(e,i,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.style=s}extendPrototype([DynamicPropertyContainer],SVGNoStyleData);function GradientProperty(e,i,s){this.data=i,this.c=createTypedArray("uint8c",i.p*4);var a=i.k.k[0].s?i.k.k[0].s.length-i.p*4:i.k.k.length-i.p*4;this.o=createTypedArray("float32",a),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=a,this.initDynamicPropertyContainer(s),this.prop=PropertyFactory.getProp(e,i.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}GradientProperty.prototype.comparePoints=function(e,i){for(var s=0,a=this.o.length/2,b;s<a;){if(b=Math.abs(e[s*4]-e[i*4+s*2]),b>.01)return!1;s+=1}return!0},GradientProperty.prototype.checkCollapsable=function(){if(this.o.length/2!==this.c.length/4)return!1;if(this.data.k.k[0].s)for(var e=0,i=this.data.k.k.length;e<i;){if(!this.comparePoints(this.data.k.k[e].s,this.data.p))return!1;e+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},GradientProperty.prototype.getValue=function(e){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||e){var i,s=this.data.p*4,a,b;for(i=0;i<s;i+=1)a=i%4===0?100:255,b=Math.round(this.prop.v[i]*a),this.c[i]!==b&&(this.c[i]=b,this._cmdf=!e);if(this.o.length)for(s=this.prop.v.length,i=this.data.p*4;i<s;i+=1)a=i%2===0?100:1,b=i%2===0?Math.round(this.prop.v[i]*100):this.prop.v[i],this.o[i-this.data.p*4]!==b&&(this.o[i-this.data.p*4]=b,this._omdf=!e);this._mdf=!e}},extendPrototype([DynamicPropertyContainer],GradientProperty);function SVGGradientFillStyleData(e,i,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.initGradientData(e,i,s)}SVGGradientFillStyleData.prototype.initGradientData=function(e,i,s){this.o=PropertyFactory.getProp(e,i.o,0,.01,this),this.s=PropertyFactory.getProp(e,i.s,1,null,this),this.e=PropertyFactory.getProp(e,i.e,1,null,this),this.h=PropertyFactory.getProp(e,i.h||{k:0},0,.01,this),this.a=PropertyFactory.getProp(e,i.a||{k:0},0,degToRads,this),this.g=new GradientProperty(e,i.g,this),this.style=s,this.stops=[],this.setGradientData(s.pElem,i),this.setGradientOpacity(i,s),this._isAnimated=!!this._isAnimated},SVGGradientFillStyleData.prototype.setGradientData=function(e,i){var s=createElementID(),a=createNS(i.t===1?"linearGradient":"radialGradient");a.setAttribute("id",s),a.setAttribute("spreadMethod","pad"),a.setAttribute("gradientUnits","userSpaceOnUse");var b=[],et,nt,c;for(c=i.g.p*4,nt=0;nt<c;nt+=4)et=createNS("stop"),a.appendChild(et),b.push(et);e.setAttribute(i.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+s+")"),this.gf=a,this.cst=b},SVGGradientFillStyleData.prototype.setGradientOpacity=function(e,i){if(this.g._hasOpacity&&!this.g._collapsable){var s,a,b,et=createNS("mask"),nt=createNS("path");et.appendChild(nt);var c=createElementID(),ct=createElementID();et.setAttribute("id",ct);var pt=createNS(e.t===1?"linearGradient":"radialGradient");pt.setAttribute("id",c),pt.setAttribute("spreadMethod","pad"),pt.setAttribute("gradientUnits","userSpaceOnUse"),b=e.g.k.k[0].s?e.g.k.k[0].s.length:e.g.k.k.length;var xt=this.stops;for(a=e.g.p*4;a<b;a+=2)s=createNS("stop"),s.setAttribute("stop-color","rgb(255,255,255)"),pt.appendChild(s),xt.push(s);nt.setAttribute(e.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+c+")"),e.ty==="gs"&&(nt.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),nt.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),e.lj===1&&nt.setAttribute("stroke-miterlimit",e.ml)),this.of=pt,this.ms=et,this.ost=xt,this.maskId=ct,i.msElem=nt}},extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData);function SVGGradientStrokeStyleData(e,i,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.w=PropertyFactory.getProp(e,i.w,0,null,this),this.d=new DashProperty(e,i.d||{},"svg",this),this.initGradientData(e,i,s),this._isAnimated=!!this._isAnimated}extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);function ShapeGroupData(){this.it=[],this.prevViewData=[],this.gr=createNS("g")}function SVGTransformData(e,i,s){this.transform={mProps:e,op:i,container:s},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}var buildShapeString=function(i,s,a,b){if(s===0)return"";var et=i.o,nt=i.i,c=i.v,ct,pt=" M"+b.applyToPointStringified(c[0][0],c[0][1]);for(ct=1;ct<s;ct+=1)pt+=" C"+b.applyToPointStringified(et[ct-1][0],et[ct-1][1])+" "+b.applyToPointStringified(nt[ct][0],nt[ct][1])+" "+b.applyToPointStringified(c[ct][0],c[ct][1]);return a&&s&&(pt+=" C"+b.applyToPointStringified(et[ct-1][0],et[ct-1][1])+" "+b.applyToPointStringified(nt[0][0],nt[0][1])+" "+b.applyToPointStringified(c[0][0],c[0][1]),pt+="z"),pt},SVGElementsRenderer=function(){var e=new Matrix,i=new Matrix,s={createRenderFunction:a};function a(St){switch(St.ty){case"fl":return c;case"gf":return pt;case"gs":return ct;case"st":return xt;case"sh":case"el":case"rc":case"sr":return nt;case"tr":return b;case"no":return et;default:return null}}function b(St,Et,Rt){(Rt||Et.transform.op._mdf)&&Et.transform.container.setAttribute("opacity",Et.transform.op.v),(Rt||Et.transform.mProps._mdf)&&Et.transform.container.setAttribute("transform",Et.transform.mProps.v.to2dCSS())}function et(){}function nt(St,Et,Rt){var Nt,It,Gt,Dt,Bt,Lt,Vt=Et.styles.length,Zt=Et.lvl,nr,ur,_r,Ur;for(Lt=0;Lt<Vt;Lt+=1){if(Dt=Et.sh._mdf||Rt,Et.styles[Lt].lvl<Zt){for(ur=i.reset(),_r=Zt-Et.styles[Lt].lvl,Ur=Et.transformers.length-1;!Dt&&_r>0;)Dt=Et.transformers[Ur].mProps._mdf||Dt,_r-=1,Ur-=1;if(Dt)for(_r=Zt-Et.styles[Lt].lvl,Ur=Et.transformers.length-1;_r>0;)ur.multiply(Et.transformers[Ur].mProps.v),_r-=1,Ur-=1}else ur=e;if(nr=Et.sh.paths,It=nr._length,Dt){for(Gt="",Nt=0;Nt<It;Nt+=1)Bt=nr.shapes[Nt],Bt&&Bt._length&&(Gt+=buildShapeString(Bt,Bt._length,Bt.c,ur));Et.caches[Lt]=Gt}else Gt=Et.caches[Lt];Et.styles[Lt].d+=St.hd===!0?"":Gt,Et.styles[Lt]._mdf=Dt||Et.styles[Lt]._mdf}}function c(St,Et,Rt){var Nt=Et.style;(Et.c._mdf||Rt)&&Nt.pElem.setAttribute("fill","rgb("+bmFloor(Et.c.v[0])+","+bmFloor(Et.c.v[1])+","+bmFloor(Et.c.v[2])+")"),(Et.o._mdf||Rt)&&Nt.pElem.setAttribute("fill-opacity",Et.o.v)}function ct(St,Et,Rt){pt(St,Et,Rt),xt(St,Et,Rt)}function pt(St,Et,Rt){var Nt=Et.gf,It=Et.g._hasOpacity,Gt=Et.s.v,Dt=Et.e.v;if(Et.o._mdf||Rt){var Bt=St.ty==="gf"?"fill-opacity":"stroke-opacity";Et.style.pElem.setAttribute(Bt,Et.o.v)}if(Et.s._mdf||Rt){var Lt=St.t===1?"x1":"cx",Vt=Lt==="x1"?"y1":"cy";Nt.setAttribute(Lt,Gt[0]),Nt.setAttribute(Vt,Gt[1]),It&&!Et.g._collapsable&&(Et.of.setAttribute(Lt,Gt[0]),Et.of.setAttribute(Vt,Gt[1]))}var Zt,nr,ur,_r;if(Et.g._cmdf||Rt){Zt=Et.cst;var Ur=Et.g.c;for(ur=Zt.length,nr=0;nr<ur;nr+=1)_r=Zt[nr],_r.setAttribute("offset",Ur[nr*4]+"%"),_r.setAttribute("stop-color","rgb("+Ur[nr*4+1]+","+Ur[nr*4+2]+","+Ur[nr*4+3]+")")}if(It&&(Et.g._omdf||Rt)){var ln=Et.g.o;for(Et.g._collapsable?Zt=Et.cst:Zt=Et.ost,ur=Zt.length,nr=0;nr<ur;nr+=1)_r=Zt[nr],Et.g._collapsable||_r.setAttribute("offset",ln[nr*2]+"%"),_r.setAttribute("stop-opacity",ln[nr*2+1])}if(St.t===1)(Et.e._mdf||Rt)&&(Nt.setAttribute("x2",Dt[0]),Nt.setAttribute("y2",Dt[1]),It&&!Et.g._collapsable&&(Et.of.setAttribute("x2",Dt[0]),Et.of.setAttribute("y2",Dt[1])));else{var an;if((Et.s._mdf||Et.e._mdf||Rt)&&(an=Math.sqrt(Math.pow(Gt[0]-Dt[0],2)+Math.pow(Gt[1]-Dt[1],2)),Nt.setAttribute("r",an),It&&!Et.g._collapsable&&Et.of.setAttribute("r",an)),Et.s._mdf||Et.e._mdf||Et.h._mdf||Et.a._mdf||Rt){an||(an=Math.sqrt(Math.pow(Gt[0]-Dt[0],2)+Math.pow(Gt[1]-Dt[1],2)));var Fr=Math.atan2(Dt[1]-Gt[1],Dt[0]-Gt[0]),rn=Et.h.v;rn>=1?rn=.99:rn<=-1&&(rn=-.99);var gn=an*rn,_i=Math.cos(Fr+Et.a.v)*gn+Gt[0],xr=Math.sin(Fr+Et.a.v)*gn+Gt[1];Nt.setAttribute("fx",_i),Nt.setAttribute("fy",xr),It&&!Et.g._collapsable&&(Et.of.setAttribute("fx",_i),Et.of.setAttribute("fy",xr))}}}function xt(St,Et,Rt){var Nt=Et.style,It=Et.d;It&&(It._mdf||Rt)&&It.dashStr&&(Nt.pElem.setAttribute("stroke-dasharray",It.dashStr),Nt.pElem.setAttribute("stroke-dashoffset",It.dashoffset[0])),Et.c&&(Et.c._mdf||Rt)&&Nt.pElem.setAttribute("stroke","rgb("+bmFloor(Et.c.v[0])+","+bmFloor(Et.c.v[1])+","+bmFloor(Et.c.v[2])+")"),(Et.o._mdf||Rt)&&Nt.pElem.setAttribute("stroke-opacity",Et.o.v),(Et.w._mdf||Rt)&&(Nt.pElem.setAttribute("stroke-width",Et.w.v),Nt.msElem&&Nt.msElem.setAttribute("stroke-width",Et.w.v))}return s}();function SVGShapeElement(e,i,s){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(e,i,s),this.prevViewData=[]}extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement),SVGShapeElement.prototype.initSecondaryElement=function(){},SVGShapeElement.prototype.identityMatrix=new Matrix,SVGShapeElement.prototype.buildExpressionInterface=function(){},SVGShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},SVGShapeElement.prototype.filterUniqueShapes=function(){var e,i=this.shapes.length,s,a,b=this.stylesList.length,et,nt=[],c=!1;for(a=0;a<b;a+=1){for(et=this.stylesList[a],c=!1,nt.length=0,e=0;e<i;e+=1)s=this.shapes[e],s.styles.indexOf(et)!==-1&&(nt.push(s),c=s._isAnimated||c);nt.length>1&&c&&this.setShapesAsAnimated(nt)}},SVGShapeElement.prototype.setShapesAsAnimated=function(e){var i,s=e.length;for(i=0;i<s;i+=1)e[i].setAsAnimated()},SVGShapeElement.prototype.createStyleElement=function(e,i){var s,a=new SVGStyleData(e,i),b=a.pElem;if(e.ty==="st")s=new SVGStrokeStyleData(this,e,a);else if(e.ty==="fl")s=new SVGFillStyleData(this,e,a);else if(e.ty==="gf"||e.ty==="gs"){var et=e.ty==="gf"?SVGGradientFillStyleData:SVGGradientStrokeStyleData;s=new et(this,e,a),this.globalData.defs.appendChild(s.gf),s.maskId&&(this.globalData.defs.appendChild(s.ms),this.globalData.defs.appendChild(s.of),b.setAttribute("mask","url("+getLocationHref()+"#"+s.maskId+")"))}else e.ty==="no"&&(s=new SVGNoStyleData(this,e,a));return(e.ty==="st"||e.ty==="gs")&&(b.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),b.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),b.setAttribute("fill-opacity","0"),e.lj===1&&b.setAttribute("stroke-miterlimit",e.ml)),e.r===2&&b.setAttribute("fill-rule","evenodd"),e.ln&&b.setAttribute("id",e.ln),e.cl&&b.setAttribute("class",e.cl),e.bm&&(b.style["mix-blend-mode"]=getBlendMode(e.bm)),this.stylesList.push(a),this.addToAnimatedContents(e,s),s},SVGShapeElement.prototype.createGroupElement=function(e){var i=new ShapeGroupData;return e.ln&&i.gr.setAttribute("id",e.ln),e.cl&&i.gr.setAttribute("class",e.cl),e.bm&&(i.gr.style["mix-blend-mode"]=getBlendMode(e.bm)),i},SVGShapeElement.prototype.createTransformElement=function(e,i){var s=TransformPropertyFactory.getTransformProperty(this,e,this),a=new SVGTransformData(s,s.o,i);return this.addToAnimatedContents(e,a),a},SVGShapeElement.prototype.createShapeElement=function(e,i,s){var a=4;e.ty==="rc"?a=5:e.ty==="el"?a=6:e.ty==="sr"&&(a=7);var b=ShapePropertyFactory.getShapeProp(this,e,a,this),et=new SVGShapeData(i,s,b);return this.shapes.push(et),this.addShapeToModifiers(et),this.addToAnimatedContents(e,et),et},SVGShapeElement.prototype.addToAnimatedContents=function(e,i){for(var s=0,a=this.animatedContents.length;s<a;){if(this.animatedContents[s].element===i)return;s+=1}this.animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(e),element:i,data:e})},SVGShapeElement.prototype.setElementStyles=function(e){var i=e.styles,s,a=this.stylesList.length;for(s=0;s<a;s+=1)i.indexOf(this.stylesList[s])===-1&&!this.stylesList[s].closed&&i.push(this.stylesList[s])},SVGShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var e,i=this.itemsData.length;for(e=0;e<i;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),i=this.dynamicProperties.length,e=0;e<i;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers()},SVGShapeElement.prototype.searchShapes=function(e,i,s,a,b,et,nt){var c=[].concat(et),ct,pt=e.length-1,xt,St,Et=[],Rt=[],Nt,It,Gt;for(ct=pt;ct>=0;ct-=1){if(Gt=this.searchProcessedElement(e[ct]),Gt?i[ct]=s[Gt-1]:e[ct]._render=nt,e[ct].ty==="fl"||e[ct].ty==="st"||e[ct].ty==="gf"||e[ct].ty==="gs"||e[ct].ty==="no")Gt?i[ct].style.closed=e[ct].hd:i[ct]=this.createStyleElement(e[ct],b),e[ct]._render&&i[ct].style.pElem.parentNode!==a&&a.appendChild(i[ct].style.pElem),Et.push(i[ct].style);else if(e[ct].ty==="gr"){if(!Gt)i[ct]=this.createGroupElement(e[ct]);else for(St=i[ct].it.length,xt=0;xt<St;xt+=1)i[ct].prevViewData[xt]=i[ct].it[xt];this.searchShapes(e[ct].it,i[ct].it,i[ct].prevViewData,i[ct].gr,b+1,c,nt),e[ct]._render&&i[ct].gr.parentNode!==a&&a.appendChild(i[ct].gr)}else e[ct].ty==="tr"?(Gt||(i[ct]=this.createTransformElement(e[ct],a)),Nt=i[ct].transform,c.push(Nt)):e[ct].ty==="sh"||e[ct].ty==="rc"||e[ct].ty==="el"||e[ct].ty==="sr"?(Gt||(i[ct]=this.createShapeElement(e[ct],c,b)),this.setElementStyles(i[ct])):e[ct].ty==="tm"||e[ct].ty==="rd"||e[ct].ty==="ms"||e[ct].ty==="pb"||e[ct].ty==="zz"||e[ct].ty==="op"?(Gt?(It=i[ct],It.closed=!1):(It=ShapeModifiers.getModifier(e[ct].ty),It.init(this,e[ct]),i[ct]=It,this.shapeModifiers.push(It)),Rt.push(It)):e[ct].ty==="rp"&&(Gt?(It=i[ct],It.closed=!0):(It=ShapeModifiers.getModifier(e[ct].ty),i[ct]=It,It.init(this,e,ct,i),this.shapeModifiers.push(It),nt=!1),Rt.push(It));this.addProcessedElement(e[ct],ct+1)}for(pt=Et.length,ct=0;ct<pt;ct+=1)Et[ct].closed=!0;for(pt=Rt.length,ct=0;ct<pt;ct+=1)Rt[ct].closed=!0},SVGShapeElement.prototype.renderInnerContent=function(){this.renderModifiers();var e,i=this.stylesList.length;for(e=0;e<i;e+=1)this.stylesList[e].reset();for(this.renderShape(),e=0;e<i;e+=1)(this.stylesList[e]._mdf||this._isFirstFrame)&&(this.stylesList[e].msElem&&(this.stylesList[e].msElem.setAttribute("d",this.stylesList[e].d),this.stylesList[e].d="M0 0"+this.stylesList[e].d),this.stylesList[e].pElem.setAttribute("d",this.stylesList[e].d||"M0 0"))},SVGShapeElement.prototype.renderShape=function(){var e,i=this.animatedContents.length,s;for(e=0;e<i;e+=1)s=this.animatedContents[e],(this._isFirstFrame||s.element._isAnimated)&&s.data!==!0&&s.fn(s.data,s.element,this._isFirstFrame)},SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null};function LetterProps(e,i,s,a,b,et){this.o=e,this.sw=i,this.sc=s,this.fc=a,this.m=b,this.p=et,this._mdf={o:!0,sw:!!i,sc:!!s,fc:!!a,m:!0,p:!0}}LetterProps.prototype.update=function(e,i,s,a,b,et){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1,this._mdf.p=!1;var nt=!1;return this.o!==e&&(this.o=e,this._mdf.o=!0,nt=!0),this.sw!==i&&(this.sw=i,this._mdf.sw=!0,nt=!0),this.sc!==s&&(this.sc=s,this._mdf.sc=!0,nt=!0),this.fc!==a&&(this.fc=a,this._mdf.fc=!0,nt=!0),this.m!==b&&(this.m=b,this._mdf.m=!0,nt=!0),et.length&&(this.p[0]!==et[0]||this.p[1]!==et[1]||this.p[4]!==et[4]||this.p[5]!==et[5]||this.p[12]!==et[12]||this.p[13]!==et[13])&&(this.p=et,this._mdf.p=!0,nt=!0),nt};function TextProperty(e,i){this._frameId=initialDefaultFrame,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,i.d&&i.d.sid&&(i.d=e.globalData.slotManager.getProp(i.d)),this.data=i,this.elem=e,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}TextProperty.prototype.defaultBoxWidth=[0,0],TextProperty.prototype.copyData=function(e,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s]);return e},TextProperty.prototype.setCurrentData=function(e){e.__complete||this.completeTextData(e),this.currentData=e,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},TextProperty.prototype.searchProperty=function(){return this.searchKeyframes()},TextProperty.prototype.searchKeyframes=function(){return this.kf=this.data.d.k.length>1,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},TextProperty.prototype.addEffect=function(e){this.effectsSequence.push(e),this.elem.addDynamicProperty(this)},TextProperty.prototype.getValue=function(e){if(!((this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)&&!e)){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var i=this.currentData,s=this.keysIndex;if(this.lock){this.setCurrentData(this.currentData);return}this.lock=!0,this._mdf=!1;var a,b=this.effectsSequence.length,et=e||this.data.d.k[this.keysIndex].s;for(a=0;a<b;a+=1)s!==this.keysIndex?et=this.effectsSequence[a](et,et.t):et=this.effectsSequence[a](this.currentData,et.t);i!==et&&this.setCurrentData(et),this.v=this.currentData,this.pv=this.v,this.lock=!1,this.frameId=this.elem.globalData.frameId}},TextProperty.prototype.getKeyframeValue=function(){for(var e=this.data.d.k,i=this.elem.comp.renderedFrame,s=0,a=e.length;s<=a-1&&!(s===a-1||e[s+1].t>i);)s+=1;return this.keysIndex!==s&&(this.keysIndex=s),this.data.d.k[this.keysIndex].s},TextProperty.prototype.buildFinalText=function(e){for(var i=[],s=0,a=e.length,b,et,nt=!1,c=!1,ct="";s<a;)nt=c,c=!1,b=e.charCodeAt(s),ct=e.charAt(s),FontManager.isCombinedCharacter(b)?nt=!0:b>=55296&&b<=56319?FontManager.isRegionalFlag(e,s)?ct=e.substr(s,14):(et=e.charCodeAt(s+1),et>=56320&&et<=57343&&(FontManager.isModifier(b,et)?(ct=e.substr(s,2),nt=!0):FontManager.isFlagEmoji(e.substr(s,4))?ct=e.substr(s,4):ct=e.substr(s,2))):b>56319?(et=e.charCodeAt(s+1),FontManager.isVariationSelector(b)&&(nt=!0)):FontManager.isZeroWidthJoiner(b)&&(nt=!0,c=!0),nt?(i[i.length-1]+=ct,nt=!1):i.push(ct),s+=ct.length;return i},TextProperty.prototype.completeTextData=function(e){e.__complete=!0;var i=this.elem.globalData.fontManager,s=this.data,a=[],b,et,nt,c=0,ct,pt=s.m.g,xt=0,St=0,Et=0,Rt=[],Nt=0,It=0,Gt,Dt,Bt=i.getFontByName(e.f),Lt,Vt=0,Zt=getFontProperties(Bt);e.fWeight=Zt.weight,e.fStyle=Zt.style,e.finalSize=e.s,e.finalText=this.buildFinalText(e.t),et=e.finalText.length,e.finalLineHeight=e.lh;var nr=e.tr/1e3*e.finalSize,ur;if(e.sz)for(var _r=!0,Ur=e.sz[0],ln=e.sz[1],an,Fr;_r;){Fr=this.buildFinalText(e.t),an=0,Nt=0,et=Fr.length,nr=e.tr/1e3*e.finalSize;var rn=-1;for(b=0;b<et;b+=1)ur=Fr[b].charCodeAt(0),nt=!1,Fr[b]===" "?rn=b:(ur===13||ur===3)&&(Nt=0,nt=!0,an+=e.finalLineHeight||e.finalSize*1.2),i.chars?(Lt=i.getCharData(Fr[b],Bt.fStyle,Bt.fFamily),Vt=nt?0:Lt.w*e.finalSize/100):Vt=i.measureText(Fr[b],e.f,e.finalSize),Nt+Vt>Ur&&Fr[b]!==" "?(rn===-1?et+=1:b=rn,an+=e.finalLineHeight||e.finalSize*1.2,Fr.splice(b,rn===b?1:0,"\r"),rn=-1,Nt=0):(Nt+=Vt,Nt+=nr);an+=Bt.ascent*e.finalSize/100,this.canResize&&e.finalSize>this.minimumFontSize&&ln<an?(e.finalSize-=1,e.finalLineHeight=e.finalSize*e.lh/e.s):(e.finalText=Fr,et=e.finalText.length,_r=!1)}Nt=-nr,Vt=0;var gn=0,_i;for(b=0;b<et;b+=1)if(nt=!1,_i=e.finalText[b],ur=_i.charCodeAt(0),ur===13||ur===3?(gn=0,Rt.push(Nt),It=Nt>It?Nt:It,Nt=-2*nr,ct="",nt=!0,Et+=1):ct=_i,i.chars?(Lt=i.getCharData(_i,Bt.fStyle,i.getFontByName(e.f).fFamily),Vt=nt?0:Lt.w*e.finalSize/100):Vt=i.measureText(ct,e.f,e.finalSize),_i===" "?gn+=Vt+nr:(Nt+=Vt+nr+gn,gn=0),a.push({l:Vt,an:Vt,add:xt,n:nt,anIndexes:[],val:ct,line:Et,animatorJustifyOffset:0}),pt==2){if(xt+=Vt,ct===""||ct===" "||b===et-1){for((ct===""||ct===" ")&&(xt-=Vt);St<=b;)a[St].an=xt,a[St].ind=c,a[St].extra=Vt,St+=1;c+=1,xt=0}}else if(pt==3){if(xt+=Vt,ct===""||b===et-1){for(ct===""&&(xt-=Vt);St<=b;)a[St].an=xt,a[St].ind=c,a[St].extra=Vt,St+=1;xt=0,c+=1}}else a[c].ind=c,a[c].extra=0,c+=1;if(e.l=a,It=Nt>It?Nt:It,Rt.push(Nt),e.sz)e.boxWidth=e.sz[0],e.justifyOffset=0;else switch(e.boxWidth=It,e.j){case 1:e.justifyOffset=-e.boxWidth;break;case 2:e.justifyOffset=-e.boxWidth/2;break;default:e.justifyOffset=0}e.lineWidths=Rt;var xr=s.a,gr,rr;Dt=xr.length;var cr,Hr,$r=[];for(Gt=0;Gt<Dt;Gt+=1){for(gr=xr[Gt],gr.a.sc&&(e.strokeColorAnim=!0),gr.a.sw&&(e.strokeWidthAnim=!0),(gr.a.fc||gr.a.fh||gr.a.fs||gr.a.fb)&&(e.fillColorAnim=!0),Hr=0,cr=gr.s.b,b=0;b<et;b+=1)rr=a[b],rr.anIndexes[Gt]=Hr,(cr==1&&rr.val!==""||cr==2&&rr.val!==""&&rr.val!==" "||cr==3&&(rr.n||rr.val==" "||b==et-1)||cr==4&&(rr.n||b==et-1))&&(gr.s.rn===1&&$r.push(Hr),Hr+=1);s.a[Gt].s.totalChars=Hr;var _n=-1,fn;if(gr.s.rn===1)for(b=0;b<et;b+=1)rr=a[b],_n!=rr.anIndexes[Gt]&&(_n=rr.anIndexes[Gt],fn=$r.splice(Math.floor(Math.random()*$r.length),1)[0]),rr.anIndexes[Gt]=fn}e.yOffset=e.finalLineHeight||e.finalSize*1.2,e.ls=e.ls||0,e.ascent=Bt.ascent*e.finalSize/100},TextProperty.prototype.updateDocumentData=function(e,i){i=i===void 0?this.keysIndex:i;var s=this.copyData({},this.data.d.k[i].s);s=this.copyData(s,e),this.data.d.k[i].s=s,this.recalculate(i),this.setCurrentData(s),this.elem.addDynamicProperty(this)},TextProperty.prototype.recalculate=function(e){var i=this.data.d.k[e].s;i.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(i)},TextProperty.prototype.canResizeFont=function(e){this.canResize=e,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},TextProperty.prototype.setMinimumFontSize=function(e){this.minimumFontSize=Math.floor(e)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};var TextSelectorProp=function(){var e=Math.max,i=Math.min,s=Math.floor;function a(et,nt){this._currentTextLength=-1,this.k=!1,this.data=nt,this.elem=et,this.comp=et.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer(et),this.s=PropertyFactory.getProp(et,nt.s||{k:0},0,0,this),"e"in nt?this.e=PropertyFactory.getProp(et,nt.e,0,0,this):this.e={v:100},this.o=PropertyFactory.getProp(et,nt.o||{k:0},0,0,this),this.xe=PropertyFactory.getProp(et,nt.xe||{k:0},0,0,this),this.ne=PropertyFactory.getProp(et,nt.ne||{k:0},0,0,this),this.sm=PropertyFactory.getProp(et,nt.sm||{k:100},0,0,this),this.a=PropertyFactory.getProp(et,nt.a,0,.01,this),this.dynamicProperties.length||this.getValue()}a.prototype={getMult:function(nt){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var c=0,ct=0,pt=1,xt=1;this.ne.v>0?c=this.ne.v/100:ct=-this.ne.v/100,this.xe.v>0?pt=1-this.xe.v/100:xt=1+this.xe.v/100;var St=BezierFactory.getBezierEasing(c,ct,pt,xt).get,Et=0,Rt=this.finalS,Nt=this.finalE,It=this.data.sh;if(It===2)Nt===Rt?Et=nt>=Nt?1:0:Et=e(0,i(.5/(Nt-Rt)+(nt-Rt)/(Nt-Rt),1)),Et=St(Et);else if(It===3)Nt===Rt?Et=nt>=Nt?0:1:Et=1-e(0,i(.5/(Nt-Rt)+(nt-Rt)/(Nt-Rt),1)),Et=St(Et);else if(It===4)Nt===Rt?Et=0:(Et=e(0,i(.5/(Nt-Rt)+(nt-Rt)/(Nt-Rt),1)),Et<.5?Et*=2:Et=1-2*(Et-.5)),Et=St(Et);else if(It===5){if(Nt===Rt)Et=0;else{var Gt=Nt-Rt;nt=i(e(0,nt+.5-Rt),Nt-Rt);var Dt=-Gt/2+nt,Bt=Gt/2;Et=Math.sqrt(1-Dt*Dt/(Bt*Bt))}Et=St(Et)}else It===6?(Nt===Rt?Et=0:(nt=i(e(0,nt+.5-Rt),Nt-Rt),Et=(1+Math.cos(Math.PI+Math.PI*2*nt/(Nt-Rt)))/2),Et=St(Et)):(nt>=s(Rt)&&(nt-Rt<0?Et=e(0,i(i(Nt,1)-(Rt-nt),1)):Et=e(0,i(Nt-nt,1))),Et=St(Et));if(this.sm.v!==100){var Lt=this.sm.v*.01;Lt===0&&(Lt=1e-8);var Vt=.5-Lt*.5;Et<Vt?Et=0:(Et=(Et-Vt)/Lt,Et>1&&(Et=1))}return Et*this.a.v},getValue:function(nt){this.iterateDynamicProperties(),this._mdf=nt||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,nt&&this.data.r===2&&(this.e.v=this._currentTextLength);var c=this.data.r===2?1:100/this.data.totalChars,ct=this.o.v/c,pt=this.s.v/c+ct,xt=this.e.v/c+ct;if(pt>xt){var St=pt;pt=xt,xt=St}this.finalS=pt,this.finalE=xt}},extendPrototype([DynamicPropertyContainer],a);function b(et,nt,c){return new a(et,nt)}return{getTextSelectorProp:b}}();function TextAnimatorDataProperty(e,i,s){var a={propType:!1},b=PropertyFactory.getProp,et=i.a;this.a={r:et.r?b(e,et.r,0,degToRads,s):a,rx:et.rx?b(e,et.rx,0,degToRads,s):a,ry:et.ry?b(e,et.ry,0,degToRads,s):a,sk:et.sk?b(e,et.sk,0,degToRads,s):a,sa:et.sa?b(e,et.sa,0,degToRads,s):a,s:et.s?b(e,et.s,1,.01,s):a,a:et.a?b(e,et.a,1,0,s):a,o:et.o?b(e,et.o,0,.01,s):a,p:et.p?b(e,et.p,1,0,s):a,sw:et.sw?b(e,et.sw,0,0,s):a,sc:et.sc?b(e,et.sc,1,0,s):a,fc:et.fc?b(e,et.fc,1,0,s):a,fh:et.fh?b(e,et.fh,0,0,s):a,fs:et.fs?b(e,et.fs,0,.01,s):a,fb:et.fb?b(e,et.fb,0,.01,s):a,t:et.t?b(e,et.t,0,0,s):a},this.s=TextSelectorProp.getTextSelectorProp(e,i.s,s),this.s.t=i.s.t}function TextAnimatorProperty(e,i,s){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=e,this._renderType=i,this._elem=s,this._animatorsData=createSizedArray(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(s)}TextAnimatorProperty.prototype.searchProperties=function(){var e,i=this._textData.a.length,s,a=PropertyFactory.getProp;for(e=0;e<i;e+=1)s=this._textData.a[e],this._animatorsData[e]=new TextAnimatorDataProperty(this._elem,s,this);this._textData.p&&"m"in this._textData.p?(this._pathData={a:a(this._elem,this._textData.p.a,0,0,this),f:a(this._elem,this._textData.p.f,0,0,this),l:a(this._elem,this._textData.p.l,0,0,this),r:a(this._elem,this._textData.p.r,0,0,this),p:a(this._elem,this._textData.p.p,0,0,this),m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=a(this._elem,this._textData.m.a,1,0,this)},TextAnimatorProperty.prototype.getMeasures=function(e,i){if(this.lettersChangedFlag=i,!(!this._mdf&&!this._isFirstFrame&&!i&&(!this._hasMaskedPath||!this._pathData.m._mdf))){this._isFirstFrame=!1;var s=this._moreOptions.alignment.v,a=this._animatorsData,b=this._textData,et=this.mHelper,nt=this._renderType,c=this.renderedLetters.length,ct,pt,xt,St,Et=e.l,Rt,Nt,It,Gt,Dt,Bt,Lt,Vt,Zt,nr,ur,_r,Ur,ln,an;if(this._hasMaskedPath){if(an=this._pathData.m,!this._pathData.n||this._pathData._mdf){var Fr=an.v;this._pathData.r.v&&(Fr=Fr.reverse()),Rt={tLength:0,segments:[]},St=Fr._length-1;var rn;for(_r=0,xt=0;xt<St;xt+=1)rn=bez.buildBezierData(Fr.v[xt],Fr.v[xt+1],[Fr.o[xt][0]-Fr.v[xt][0],Fr.o[xt][1]-Fr.v[xt][1]],[Fr.i[xt+1][0]-Fr.v[xt+1][0],Fr.i[xt+1][1]-Fr.v[xt+1][1]]),Rt.tLength+=rn.segmentLength,Rt.segments.push(rn),_r+=rn.segmentLength;xt=St,an.v.c&&(rn=bez.buildBezierData(Fr.v[xt],Fr.v[0],[Fr.o[xt][0]-Fr.v[xt][0],Fr.o[xt][1]-Fr.v[xt][1]],[Fr.i[0][0]-Fr.v[0][0],Fr.i[0][1]-Fr.v[0][1]]),Rt.tLength+=rn.segmentLength,Rt.segments.push(rn),_r+=rn.segmentLength),this._pathData.pi=Rt}if(Rt=this._pathData.pi,Nt=this._pathData.f.v,Lt=0,Bt=1,Gt=0,Dt=!0,nr=Rt.segments,Nt<0&&an.v.c)for(Rt.tLength<Math.abs(Nt)&&(Nt=-Math.abs(Nt)%Rt.tLength),Lt=nr.length-1,Zt=nr[Lt].points,Bt=Zt.length-1;Nt<0;)Nt+=Zt[Bt].partialLength,Bt-=1,Bt<0&&(Lt-=1,Zt=nr[Lt].points,Bt=Zt.length-1);Zt=nr[Lt].points,Vt=Zt[Bt-1],It=Zt[Bt],ur=It.partialLength}St=Et.length,ct=0,pt=0;var gn=e.finalSize*1.2*.714,_i=!0,xr,gr,rr,cr,Hr;cr=a.length;var $r,_n=-1,fn,jn,vs,Cs=Nt,ns=Lt,Nn=Bt,ls=-1,ms,Ss,Ks,ws,ps,Rl,Qo,Vo,wo="",tu=this.defaultPropsArray,ou;if(e.j===2||e.j===1){var Sl=0,ru=0,Ll=e.j===2?-.5:-1,Jo=0,iu=!0;for(xt=0;xt<St;xt+=1)if(Et[xt].n){for(Sl&&(Sl+=ru);Jo<xt;)Et[Jo].animatorJustifyOffset=Sl,Jo+=1;Sl=0,iu=!0}else{for(rr=0;rr<cr;rr+=1)xr=a[rr].a,xr.t.propType&&(iu&&e.j===2&&(ru+=xr.t.v*Ll),gr=a[rr].s,$r=gr.getMult(Et[xt].anIndexes[rr],b.a[rr].s.totalChars),$r.length?Sl+=xr.t.v*$r[0]*Ll:Sl+=xr.t.v*$r*Ll);iu=!1}for(Sl&&(Sl+=ru);Jo<xt;)Et[Jo].animatorJustifyOffset=Sl,Jo+=1}for(xt=0;xt<St;xt+=1){if(et.reset(),ms=1,Et[xt].n)ct=0,pt+=e.yOffset,pt+=_i?1:0,Nt=Cs,_i=!1,this._hasMaskedPath&&(Lt=ns,Bt=Nn,Zt=nr[Lt].points,Vt=Zt[Bt-1],It=Zt[Bt],ur=It.partialLength,Gt=0),wo="",Vo="",Rl="",ou="",tu=this.defaultPropsArray;else{if(this._hasMaskedPath){if(ls!==Et[xt].line){switch(e.j){case 1:Nt+=_r-e.lineWidths[Et[xt].line];break;case 2:Nt+=(_r-e.lineWidths[Et[xt].line])/2;break}ls=Et[xt].line}_n!==Et[xt].ind&&(Et[_n]&&(Nt+=Et[_n].extra),Nt+=Et[xt].an/2,_n=Et[xt].ind),Nt+=s[0]*Et[xt].an*.005;var xa=0;for(rr=0;rr<cr;rr+=1)xr=a[rr].a,xr.p.propType&&(gr=a[rr].s,$r=gr.getMult(Et[xt].anIndexes[rr],b.a[rr].s.totalChars),$r.length?xa+=xr.p.v[0]*$r[0]:xa+=xr.p.v[0]*$r),xr.a.propType&&(gr=a[rr].s,$r=gr.getMult(Et[xt].anIndexes[rr],b.a[rr].s.totalChars),$r.length?xa+=xr.a.v[0]*$r[0]:xa+=xr.a.v[0]*$r);for(Dt=!0,this._pathData.a.v&&(Nt=Et[0].an*.5+(_r-this._pathData.f.v-Et[0].an*.5-Et[Et.length-1].an*.5)*_n/(St-1),Nt+=this._pathData.f.v);Dt;)Gt+ur>=Nt+xa||!Zt?(Ur=(Nt+xa-Gt)/It.partialLength,jn=Vt.point[0]+(It.point[0]-Vt.point[0])*Ur,vs=Vt.point[1]+(It.point[1]-Vt.point[1])*Ur,et.translate(-s[0]*Et[xt].an*.005,-(s[1]*gn)*.01),Dt=!1):Zt&&(Gt+=It.partialLength,Bt+=1,Bt>=Zt.length&&(Bt=0,Lt+=1,nr[Lt]?Zt=nr[Lt].points:an.v.c?(Bt=0,Lt=0,Zt=nr[Lt].points):(Gt-=It.partialLength,Zt=null)),Zt&&(Vt=It,It=Zt[Bt],ur=It.partialLength));fn=Et[xt].an/2-Et[xt].add,et.translate(-fn,0,0)}else fn=Et[xt].an/2-Et[xt].add,et.translate(-fn,0,0),et.translate(-s[0]*Et[xt].an*.005,-s[1]*gn*.01,0);for(rr=0;rr<cr;rr+=1)xr=a[rr].a,xr.t.propType&&(gr=a[rr].s,$r=gr.getMult(Et[xt].anIndexes[rr],b.a[rr].s.totalChars),(ct!==0||e.j!==0)&&(this._hasMaskedPath?$r.length?Nt+=xr.t.v*$r[0]:Nt+=xr.t.v*$r:$r.length?ct+=xr.t.v*$r[0]:ct+=xr.t.v*$r));for(e.strokeWidthAnim&&(Ks=e.sw||0),e.strokeColorAnim&&(e.sc?Ss=[e.sc[0],e.sc[1],e.sc[2]]:Ss=[0,0,0]),e.fillColorAnim&&e.fc&&(ws=[e.fc[0],e.fc[1],e.fc[2]]),rr=0;rr<cr;rr+=1)xr=a[rr].a,xr.a.propType&&(gr=a[rr].s,$r=gr.getMult(Et[xt].anIndexes[rr],b.a[rr].s.totalChars),$r.length?et.translate(-xr.a.v[0]*$r[0],-xr.a.v[1]*$r[1],xr.a.v[2]*$r[2]):et.translate(-xr.a.v[0]*$r,-xr.a.v[1]*$r,xr.a.v[2]*$r));for(rr=0;rr<cr;rr+=1)xr=a[rr].a,xr.s.propType&&(gr=a[rr].s,$r=gr.getMult(Et[xt].anIndexes[rr],b.a[rr].s.totalChars),$r.length?et.scale(1+(xr.s.v[0]-1)*$r[0],1+(xr.s.v[1]-1)*$r[1],1):et.scale(1+(xr.s.v[0]-1)*$r,1+(xr.s.v[1]-1)*$r,1));for(rr=0;rr<cr;rr+=1){if(xr=a[rr].a,gr=a[rr].s,$r=gr.getMult(Et[xt].anIndexes[rr],b.a[rr].s.totalChars),xr.sk.propType&&($r.length?et.skewFromAxis(-xr.sk.v*$r[0],xr.sa.v*$r[1]):et.skewFromAxis(-xr.sk.v*$r,xr.sa.v*$r)),xr.r.propType&&($r.length?et.rotateZ(-xr.r.v*$r[2]):et.rotateZ(-xr.r.v*$r)),xr.ry.propType&&($r.length?et.rotateY(xr.ry.v*$r[1]):et.rotateY(xr.ry.v*$r)),xr.rx.propType&&($r.length?et.rotateX(xr.rx.v*$r[0]):et.rotateX(xr.rx.v*$r)),xr.o.propType&&($r.length?ms+=(xr.o.v*$r[0]-ms)*$r[0]:ms+=(xr.o.v*$r-ms)*$r),e.strokeWidthAnim&&xr.sw.propType&&($r.length?Ks+=xr.sw.v*$r[0]:Ks+=xr.sw.v*$r),e.strokeColorAnim&&xr.sc.propType)for(ps=0;ps<3;ps+=1)$r.length?Ss[ps]+=(xr.sc.v[ps]-Ss[ps])*$r[0]:Ss[ps]+=(xr.sc.v[ps]-Ss[ps])*$r;if(e.fillColorAnim&&e.fc){if(xr.fc.propType)for(ps=0;ps<3;ps+=1)$r.length?ws[ps]+=(xr.fc.v[ps]-ws[ps])*$r[0]:ws[ps]+=(xr.fc.v[ps]-ws[ps])*$r;xr.fh.propType&&($r.length?ws=addHueToRGB(ws,xr.fh.v*$r[0]):ws=addHueToRGB(ws,xr.fh.v*$r)),xr.fs.propType&&($r.length?ws=addSaturationToRGB(ws,xr.fs.v*$r[0]):ws=addSaturationToRGB(ws,xr.fs.v*$r)),xr.fb.propType&&($r.length?ws=addBrightnessToRGB(ws,xr.fb.v*$r[0]):ws=addBrightnessToRGB(ws,xr.fb.v*$r))}}for(rr=0;rr<cr;rr+=1)xr=a[rr].a,xr.p.propType&&(gr=a[rr].s,$r=gr.getMult(Et[xt].anIndexes[rr],b.a[rr].s.totalChars),this._hasMaskedPath?$r.length?et.translate(0,xr.p.v[1]*$r[0],-xr.p.v[2]*$r[1]):et.translate(0,xr.p.v[1]*$r,-xr.p.v[2]*$r):$r.length?et.translate(xr.p.v[0]*$r[0],xr.p.v[1]*$r[1],-xr.p.v[2]*$r[2]):et.translate(xr.p.v[0]*$r,xr.p.v[1]*$r,-xr.p.v[2]*$r));if(e.strokeWidthAnim&&(Rl=Ks<0?0:Ks),e.strokeColorAnim&&(Qo="rgb("+Math.round(Ss[0]*255)+","+Math.round(Ss[1]*255)+","+Math.round(Ss[2]*255)+")"),e.fillColorAnim&&e.fc&&(Vo="rgb("+Math.round(ws[0]*255)+","+Math.round(ws[1]*255)+","+Math.round(ws[2]*255)+")"),this._hasMaskedPath){if(et.translate(0,-e.ls),et.translate(0,s[1]*gn*.01+pt,0),this._pathData.p.v){ln=(It.point[1]-Vt.point[1])/(It.point[0]-Vt.point[0]);var Il=Math.atan(ln)*180/Math.PI;It.point[0]<Vt.point[0]&&(Il+=180),et.rotate(-Il*Math.PI/180)}et.translate(jn,vs,0),Nt-=s[0]*Et[xt].an*.005,Et[xt+1]&&_n!==Et[xt+1].ind&&(Nt+=Et[xt].an/2,Nt+=e.tr*.001*e.finalSize)}else{switch(et.translate(ct,pt,0),e.ps&&et.translate(e.ps[0],e.ps[1]+e.ascent,0),e.j){case 1:et.translate(Et[xt].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[Et[xt].line]),0,0);break;case 2:et.translate(Et[xt].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[Et[xt].line])/2,0,0);break}et.translate(0,-e.ls),et.translate(fn,0,0),et.translate(s[0]*Et[xt].an*.005,s[1]*gn*.01,0),ct+=Et[xt].l+e.tr*.001*e.finalSize}nt==="html"?wo=et.toCSS():nt==="svg"?wo=et.to2dCSS():tu=[et.props[0],et.props[1],et.props[2],et.props[3],et.props[4],et.props[5],et.props[6],et.props[7],et.props[8],et.props[9],et.props[10],et.props[11],et.props[12],et.props[13],et.props[14],et.props[15]],ou=ms}c<=xt?(Hr=new LetterProps(ou,Rl,Qo,Vo,wo,tu),this.renderedLetters.push(Hr),c+=1,this.lettersChangedFlag=!0):(Hr=this.renderedLetters[xt],this.lettersChangedFlag=Hr.update(ou,Rl,Qo,Vo,wo,tu)||this.lettersChangedFlag)}}},TextAnimatorProperty.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},TextAnimatorProperty.prototype.mHelper=new Matrix,TextAnimatorProperty.prototype.defaultPropsArray=[],extendPrototype([DynamicPropertyContainer],TextAnimatorProperty);function ITextElement(){}ITextElement.prototype.initElement=function(e,i,s){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(e,i,s),this.textProperty=new TextProperty(this,e.t,this.dynamicProperties),this.textAnimator=new TextAnimatorProperty(e.t,this.renderType,this),this.initTransform(e,i,s),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},ITextElement.prototype.prepareFrame=function(e){this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange)},ITextElement.prototype.createPathShape=function(e,i){var s,a=i.length,b,et="";for(s=0;s<a;s+=1)i[s].ty==="sh"&&(b=i[s].ks.k,et+=buildShapeString(b,b.i.length,!0,e));return et},ITextElement.prototype.updateDocumentData=function(e,i){this.textProperty.updateDocumentData(e,i)},ITextElement.prototype.canResizeFont=function(e){this.textProperty.canResizeFont(e)},ITextElement.prototype.setMinimumFontSize=function(e){this.textProperty.setMinimumFontSize(e)},ITextElement.prototype.applyTextPropertiesToMatrix=function(e,i,s,a,b){switch(e.ps&&i.translate(e.ps[0],e.ps[1]+e.ascent,0),i.translate(0,-e.ls,0),e.j){case 1:i.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[s]),0,0);break;case 2:i.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[s])/2,0,0);break}i.translate(a,b,0)},ITextElement.prototype.buildColor=function(e){return"rgb("+Math.round(e[0]*255)+","+Math.round(e[1]*255)+","+Math.round(e[2]*255)+")"},ITextElement.prototype.emptyProp=new LetterProps,ITextElement.prototype.destroy=function(){},ITextElement.prototype.validateText=function(){(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)};var emptyShapeData={shapes:[]};function SVGTextLottieElement(e,i,s){this.textSpans=[],this.renderType="svg",this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextLottieElement),SVGTextLottieElement.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=createNS("text"))},SVGTextLottieElement.prototype.buildTextContents=function(e){for(var i=0,s=e.length,a=[],b="";i<s;)e[i]==="\r"||e[i]===""?(a.push(b),b=""):b+=e[i],i+=1;return a.push(b),a},SVGTextLottieElement.prototype.buildShapeData=function(e,i){if(e.shapes&&e.shapes.length){var s=e.shapes[0];if(s.it){var a=s.it[s.it.length-1];a.s&&(a.s.k[0]=i,a.s.k[1]=i)}}return e},SVGTextLottieElement.prototype.buildNewText=function(){this.addDynamicProperty(this);var e,i,s=this.textProperty.currentData;this.renderedLetters=createSizedArray(s?s.l.length:0),s.fc?this.layerElement.setAttribute("fill",this.buildColor(s.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),s.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(s.sc)),this.layerElement.setAttribute("stroke-width",s.sw)),this.layerElement.setAttribute("font-size",s.finalSize);var a=this.globalData.fontManager.getFontByName(s.f);if(a.fClass)this.layerElement.setAttribute("class",a.fClass);else{this.layerElement.setAttribute("font-family",a.fFamily);var b=s.fWeight,et=s.fStyle;this.layerElement.setAttribute("font-style",et),this.layerElement.setAttribute("font-weight",b)}this.layerElement.setAttribute("aria-label",s.t);var nt=s.l||[],c=!!this.globalData.fontManager.chars;i=nt.length;var ct,pt=this.mHelper,xt="",St=this.data.singleShape,Et=0,Rt=0,Nt=!0,It=s.tr*.001*s.finalSize;if(St&&!c&&!s.sz){var Gt=this.textContainer,Dt="start";switch(s.j){case 1:Dt="end";break;case 2:Dt="middle";break;default:Dt="start";break}Gt.setAttribute("text-anchor",Dt),Gt.setAttribute("letter-spacing",It);var Bt=this.buildTextContents(s.finalText);for(i=Bt.length,Rt=s.ps?s.ps[1]+s.ascent:0,e=0;e<i;e+=1)ct=this.textSpans[e].span||createNS("tspan"),ct.textContent=Bt[e],ct.setAttribute("x",0),ct.setAttribute("y",Rt),ct.style.display="inherit",Gt.appendChild(ct),this.textSpans[e]||(this.textSpans[e]={span:null,glyph:null}),this.textSpans[e].span=ct,Rt+=s.finalLineHeight;this.layerElement.appendChild(Gt)}else{var Lt=this.textSpans.length,Vt;for(e=0;e<i;e+=1){if(this.textSpans[e]||(this.textSpans[e]={span:null,childSpan:null,glyph:null}),!c||!St||e===0){if(ct=Lt>e?this.textSpans[e].span:createNS(c?"g":"text"),Lt<=e){if(ct.setAttribute("stroke-linecap","butt"),ct.setAttribute("stroke-linejoin","round"),ct.setAttribute("stroke-miterlimit","4"),this.textSpans[e].span=ct,c){var Zt=createNS("g");ct.appendChild(Zt),this.textSpans[e].childSpan=Zt}this.textSpans[e].span=ct,this.layerElement.appendChild(ct)}ct.style.display="inherit"}if(pt.reset(),St&&(nt[e].n&&(Et=-It,Rt+=s.yOffset,Rt+=Nt?1:0,Nt=!1),this.applyTextPropertiesToMatrix(s,pt,nt[e].line,Et,Rt),Et+=nt[e].l||0,Et+=It),c){Vt=this.globalData.fontManager.getCharData(s.finalText[e],a.fStyle,this.globalData.fontManager.getFontByName(s.f).fFamily);var nr;if(Vt.t===1)nr=new SVGCompElement(Vt.data,this.globalData,this);else{var ur=emptyShapeData;Vt.data&&Vt.data.shapes&&(ur=this.buildShapeData(Vt.data,s.finalSize)),nr=new SVGShapeElement(ur,this.globalData,this)}if(this.textSpans[e].glyph){var _r=this.textSpans[e].glyph;this.textSpans[e].childSpan.removeChild(_r.layerElement),_r.destroy()}this.textSpans[e].glyph=nr,nr._debug=!0,nr.prepareFrame(0),nr.renderFrame(),this.textSpans[e].childSpan.appendChild(nr.layerElement),Vt.t===1&&this.textSpans[e].childSpan.setAttribute("transform","scale("+s.finalSize/100+","+s.finalSize/100+")")}else St&&ct.setAttribute("transform","translate("+pt.props[12]+","+pt.props[13]+")"),ct.textContent=nt[e].val,ct.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}St&&ct&&ct.setAttribute("d",xt)}for(;e<this.textSpans.length;)this.textSpans[e].span.style.display="none",e+=1;this._sizeChanged=!0},SVGTextLottieElement.prototype.sourceRectAtTime=function(){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var e=this.layerElement.getBBox();this.bbox={top:e.y,left:e.x,width:e.width,height:e.height}}return this.bbox},SVGTextLottieElement.prototype.getValue=function(){var e,i=this.textSpans.length,s;for(this.renderedFrame=this.comp.renderedFrame,e=0;e<i;e+=1)s=this.textSpans[e].glyph,s&&(s.prepareFrame(this.comp.renderedFrame-this.data.st),s._mdf&&(this._mdf=!0))},SVGTextLottieElement.prototype.renderInnerContent=function(){if(this.validateText(),(!this.data.singleShape||this._mdf)&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){this._sizeChanged=!0;var e,i,s=this.textAnimator.renderedLetters,a=this.textProperty.currentData.l;i=a.length;var b,et,nt;for(e=0;e<i;e+=1)a[e].n||(b=s[e],et=this.textSpans[e].span,nt=this.textSpans[e].glyph,nt&&nt.renderFrame(),b._mdf.m&&et.setAttribute("transform",b.m),b._mdf.o&&et.setAttribute("opacity",b.o),b._mdf.sw&&et.setAttribute("stroke-width",b.sw),b._mdf.sc&&et.setAttribute("stroke",b.sc),b._mdf.fc&&et.setAttribute("fill",b.fc))}};function ISolidElement(e,i,s){this.initElement(e,i,s)}extendPrototype([IImageElement],ISolidElement),ISolidElement.prototype.createContent=function(){var e=createNS("rect");e.setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.layerElement.appendChild(e)};function NullElement(e,i,s){this.initFrame(),this.initBaseData(e,i,s),this.initFrame(),this.initTransform(e,i,s),this.initHierarchy()}NullElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},NullElement.prototype.renderFrame=function(){},NullElement.prototype.getBaseElement=function(){return null},NullElement.prototype.destroy=function(){},NullElement.prototype.sourceRectAtTime=function(){},NullElement.prototype.hide=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement);function SVGRendererBase(){}extendPrototype([BaseRenderer],SVGRendererBase),SVGRendererBase.prototype.createNull=function(e){return new NullElement(e,this.globalData,this)},SVGRendererBase.prototype.createShape=function(e){return new SVGShapeElement(e,this.globalData,this)},SVGRendererBase.prototype.createText=function(e){return new SVGTextLottieElement(e,this.globalData,this)},SVGRendererBase.prototype.createImage=function(e){return new IImageElement(e,this.globalData,this)},SVGRendererBase.prototype.createSolid=function(e){return new ISolidElement(e,this.globalData,this)},SVGRendererBase.prototype.configAnimation=function(e){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svgElement.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+e.w+" "+e.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",e.w),this.svgElement.setAttribute("height",e.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)",this.svgElement.style.contentVisibility=this.renderConfig.contentVisibility),this.renderConfig.width&&this.svgElement.setAttribute("width",this.renderConfig.width),this.renderConfig.height&&this.svgElement.setAttribute("height",this.renderConfig.height),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),this.renderConfig.focusable!==void 0&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var i=this.globalData.defs;this.setupGlobalData(e,i),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=e;var s=createNS("clipPath"),a=createNS("rect");a.setAttribute("width",e.w),a.setAttribute("height",e.h),a.setAttribute("x",0),a.setAttribute("y",0);var b=createElementID();s.setAttribute("id",b),s.appendChild(a),this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+b+")"),i.appendChild(s),this.layers=e.layers,this.elements=createSizedArray(e.layers.length)},SVGRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.layerElement=null,this.globalData.defs=null;var e,i=this.layers?this.layers.length:0;for(e=0;e<i;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},SVGRendererBase.prototype.updateContainerSize=function(){},SVGRendererBase.prototype.findIndexByInd=function(e){var i=0,s=this.layers.length;for(i=0;i<s;i+=1)if(this.layers[i].ind===e)return i;return-1},SVGRendererBase.prototype.buildItem=function(e){var i=this.elements;if(!(i[e]||this.layers[e].ty===99)){i[e]=!0;var s=this.createItem(this.layers[e]);if(i[e]=s,getExpressionsPlugin()&&(this.layers[e].ty===0&&this.globalData.projectInterface.registerComposition(s),s.initExpressions()),this.appendElementInPos(s,e),this.layers[e].tt){var a="tp"in this.layers[e]?this.findIndexByInd(this.layers[e].tp):e-1;if(a===-1)return;if(!this.elements[a]||this.elements[a]===!0)this.buildItem(a),this.addPendingElement(s);else{var b=i[a],et=b.getMatte(this.layers[e].tt);s.setMatte(et)}}}},SVGRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();if(e.checkParenting(),e.data.tt)for(var i=0,s=this.elements.length;i<s;){if(this.elements[i]===e){var a="tp"in e.data?this.findIndexByInd(e.data.tp):i-1,b=this.elements[a],et=b.getMatte(this.layers[i].tt);e.setMatte(et);break}i+=1}}},SVGRendererBase.prototype.renderFrame=function(e){if(!(this.renderedFrame===e||this.destroyed)){e===null?e=this.renderedFrame:this.renderedFrame=e,this.globalData.frameNum=e,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=e,this.globalData._mdf=!1;var i,s=this.layers.length;for(this.completeLayers||this.checkLayers(e),i=s-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&this.elements[i].prepareFrame(e-this.layers[i].st);if(this.globalData._mdf)for(i=0;i<s;i+=1)(this.completeLayers||this.elements[i])&&this.elements[i].renderFrame()}},SVGRendererBase.prototype.appendElementInPos=function(e,i){var s=e.getBaseElement();if(s){for(var a=0,b;a<i;)this.elements[a]&&this.elements[a]!==!0&&this.elements[a].getBaseElement()&&(b=this.elements[a].getBaseElement()),a+=1;b?this.layerElement.insertBefore(s,b):this.layerElement.appendChild(s)}},SVGRendererBase.prototype.hide=function(){this.layerElement.style.display="none"},SVGRendererBase.prototype.show=function(){this.layerElement.style.display="block"};function ICompElement(){}extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement),ICompElement.prototype.initElement=function(e,i,s){this.initFrame(),this.initBaseData(e,i,s),this.initTransform(e,i,s),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),(this.data.xt||!i.progressiveLoad)&&this.buildAllItems(),this.hide()},ICompElement.prototype.prepareFrame=function(e){if(this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange),!(!this.isInRange&&!this.data.xt)){if(this.tm._placeholder)this.renderedFrame=e/this.data.sr;else{var i=this.tm.v;i===this.data.op&&(i=this.data.op-1),this.renderedFrame=i}var s,a=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),s=a-1;s>=0;s-=1)(this.completeLayers||this.elements[s])&&(this.elements[s].prepareFrame(this.renderedFrame-this.layers[s].st),this.elements[s]._mdf&&(this._mdf=!0))}},ICompElement.prototype.renderInnerContent=function(){var e,i=this.layers.length;for(e=0;e<i;e+=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()},ICompElement.prototype.setElements=function(e){this.elements=e},ICompElement.prototype.getElements=function(){return this.elements},ICompElement.prototype.destroyElements=function(){var e,i=this.layers.length;for(e=0;e<i;e+=1)this.elements[e]&&this.elements[e].destroy()},ICompElement.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()};function SVGCompElement(e,i,s){this.layers=e.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,i,s),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0}}extendPrototype([SVGRendererBase,ICompElement,SVGBaseElement],SVGCompElement),SVGCompElement.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)};function SVGRenderer(e,i){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.svgElement=createNS("svg");var s="";if(i&&i.title){var a=createNS("title"),b=createElementID();a.setAttribute("id",b),a.textContent=i.title,this.svgElement.appendChild(a),s+=b}if(i&&i.description){var et=createNS("desc"),nt=createElementID();et.setAttribute("id",nt),et.textContent=i.description,this.svgElement.appendChild(et),s+=" "+nt}s&&this.svgElement.setAttribute("aria-labelledby",s);var c=createNS("defs");this.svgElement.appendChild(c);var ct=createNS("g");this.svgElement.appendChild(ct),this.layerElement=ct,this.renderConfig={preserveAspectRatio:i&&i.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:i&&i.contentVisibility||"visible",progressiveLoad:i&&i.progressiveLoad||!1,hideOnTransparent:!(i&&i.hideOnTransparent===!1),viewBoxOnly:i&&i.viewBoxOnly||!1,viewBoxSize:i&&i.viewBoxSize||!1,className:i&&i.className||"",id:i&&i.id||"",focusable:i&&i.focusable,filterSize:{width:i&&i.filterSize&&i.filterSize.width||"100%",height:i&&i.filterSize&&i.filterSize.height||"100%",x:i&&i.filterSize&&i.filterSize.x||"0%",y:i&&i.filterSize&&i.filterSize.y||"0%"},width:i&&i.width,height:i&&i.height,runExpressions:!i||i.runExpressions===void 0||i.runExpressions},this.globalData={_mdf:!1,frameNum:-1,defs:c,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}extendPrototype([SVGRendererBase],SVGRenderer),SVGRenderer.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)};function ShapeTransformManager(){this.sequences={},this.sequenceList=[],this.transform_key_count=0}ShapeTransformManager.prototype={addTransformSequence:function(i){var s,a=i.length,b="_";for(s=0;s<a;s+=1)b+=i[s].transform.key+"_";var et=this.sequences[b];return et||(et={transforms:[].concat(i),finalTransform:new Matrix,_mdf:!1},this.sequences[b]=et,this.sequenceList.push(et)),et},processSequence:function(i,s){for(var a=0,b=i.transforms.length,et=s;a<b&&!s;){if(i.transforms[a].transform.mProps._mdf){et=!0;break}a+=1}if(et)for(i.finalTransform.reset(),a=b-1;a>=0;a-=1)i.finalTransform.multiply(i.transforms[a].transform.mProps.v);i._mdf=et},processSequences:function(i){var s,a=this.sequenceList.length;for(s=0;s<a;s+=1)this.processSequence(this.sequenceList[s],i)},getNewKey:function(){return this.transform_key_count+=1,"_"+this.transform_key_count}};var lumaLoader=function(){var i="__lottie_element_luma_buffer",s=null,a=null,b=null;function et(){var ct=createNS("svg"),pt=createNS("filter"),xt=createNS("feColorMatrix");return pt.setAttribute("id",i),xt.setAttribute("type","matrix"),xt.setAttribute("color-interpolation-filters","sRGB"),xt.setAttribute("values","0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0"),pt.appendChild(xt),ct.appendChild(pt),ct.setAttribute("id",i+"_svg"),featureSupport.svgLumaHidden&&(ct.style.display="none"),ct}function nt(){s||(b=et(),document.body.appendChild(b),s=createTag("canvas"),a=s.getContext("2d"),a.filter="url(#"+i+")",a.fillStyle="rgba(0,0,0,0)",a.fillRect(0,0,1,1))}function c(ct){return s||nt(),s.width=ct.width,s.height=ct.height,a.filter="url(#"+i+")",s}return{load:nt,get:c}};function createCanvas(e,i){if(featureSupport.offscreenCanvas)return new OffscreenCanvas(e,i);var s=createTag("canvas");return s.width=e,s.height=i,s}var assetLoader=function(){return{loadLumaCanvas:lumaLoader.load,getLumaCanvas:lumaLoader.get,createCanvas}}(),registeredEffects={};function CVEffects(e){var i,s=e.data.ef?e.data.ef.length:0;this.filters=[];var a;for(i=0;i<s;i+=1){a=null;var b=e.data.ef[i].ty;if(registeredEffects[b]){var et=registeredEffects[b].effect;a=new et(e.effectsManager.effectElements[i],e)}a&&this.filters.push(a)}this.filters.length&&e.addRenderableComponent(this)}CVEffects.prototype.renderFrame=function(e){var i,s=this.filters.length;for(i=0;i<s;i+=1)this.filters[i].renderFrame(e)},CVEffects.prototype.getEffects=function(e){var i,s=this.filters.length,a=[];for(i=0;i<s;i+=1)this.filters[i].type===e&&a.push(this.filters[i]);return a};function registerEffect(e,i){registeredEffects[e]={effect:i}}function CVMaskElement(e,i){this.data=e,this.element=i,this.masksProperties=this.data.masksProperties||[],this.viewData=createSizedArray(this.masksProperties.length);var s,a=this.masksProperties.length,b=!1;for(s=0;s<a;s+=1)this.masksProperties[s].mode!=="n"&&(b=!0),this.viewData[s]=ShapePropertyFactory.getShapeProp(this.element,this.masksProperties[s],3);this.hasMasks=b,b&&this.element.addRenderableComponent(this)}CVMaskElement.prototype.renderFrame=function(){if(this.hasMasks){var e=this.element.finalTransform.mat,i=this.element.canvasContext,s,a=this.masksProperties.length,b,et,nt;for(i.beginPath(),s=0;s<a;s+=1)if(this.masksProperties[s].mode!=="n"){this.masksProperties[s].inv&&(i.moveTo(0,0),i.lineTo(this.element.globalData.compSize.w,0),i.lineTo(this.element.globalData.compSize.w,this.element.globalData.compSize.h),i.lineTo(0,this.element.globalData.compSize.h),i.lineTo(0,0)),nt=this.viewData[s].v,b=e.applyToPointArray(nt.v[0][0],nt.v[0][1],0),i.moveTo(b[0],b[1]);var c,ct=nt._length;for(c=1;c<ct;c+=1)et=e.applyToTriplePoints(nt.o[c-1],nt.i[c],nt.v[c]),i.bezierCurveTo(et[0],et[1],et[2],et[3],et[4],et[5]);et=e.applyToTriplePoints(nt.o[c-1],nt.i[0],nt.v[0]),i.bezierCurveTo(et[0],et[1],et[2],et[3],et[4],et[5])}this.element.globalData.renderer.save(!0),i.clip()}},CVMaskElement.prototype.getMaskProperty=MaskElement.prototype.getMaskProperty,CVMaskElement.prototype.destroy=function(){this.element=null};function CVBaseElement(){}var operationsMap={1:"source-in",2:"source-out",3:"source-in",4:"source-out"};CVBaseElement.prototype={createElements:function(){},initRendererElement:function(){},createContainerElements:function(){if(this.data.tt>=1){this.buffers=[];var i=this.globalData.canvasContext,s=assetLoader.createCanvas(i.canvas.width,i.canvas.height);this.buffers.push(s);var a=assetLoader.createCanvas(i.canvas.width,i.canvas.height);this.buffers.push(a),this.data.tt>=3&&!document._isProxy&&assetLoader.loadLumaCanvas()}this.canvasContext=this.globalData.canvasContext,this.transformCanvas=this.globalData.transformCanvas,this.renderableEffectsManager=new CVEffects(this),this.searchEffectTransforms()},createContent:function(){},setBlendMode:function(){var i=this.globalData;if(i.blendMode!==this.data.bm){i.blendMode=this.data.bm;var s=getBlendMode(this.data.bm);i.canvasContext.globalCompositeOperation=s}},createRenderableComponents:function(){this.maskManager=new CVMaskElement(this.data,this),this.transformEffects=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT)},hideElement:function(){!this.hidden&&(!this.isInRange||this.isTransparent)&&(this.hidden=!0)},showElement:function(){this.isInRange&&!this.isTransparent&&(this.hidden=!1,this._isFirstFrame=!0,this.maskManager._isFirstFrame=!0)},clearCanvas:function(i){i.clearRect(this.transformCanvas.tx,this.transformCanvas.ty,this.transformCanvas.w*this.transformCanvas.sx,this.transformCanvas.h*this.transformCanvas.sy)},prepareLayer:function(){if(this.data.tt>=1){var i=this.buffers[0],s=i.getContext("2d");this.clearCanvas(s),s.drawImage(this.canvasContext.canvas,0,0),this.currentTransform=this.canvasContext.getTransform(),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform)}},exitLayer:function(){if(this.data.tt>=1){var i=this.buffers[1],s=i.getContext("2d");this.clearCanvas(s),s.drawImage(this.canvasContext.canvas,0,0),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform);var a=this.comp.getElementById("tp"in this.data?this.data.tp:this.data.ind-1);if(a.renderFrame(!0),this.canvasContext.setTransform(1,0,0,1,0,0),this.data.tt>=3&&!document._isProxy){var b=assetLoader.getLumaCanvas(this.canvasContext.canvas),et=b.getContext("2d");et.drawImage(this.canvasContext.canvas,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.drawImage(b,0,0)}this.canvasContext.globalCompositeOperation=operationsMap[this.data.tt],this.canvasContext.drawImage(i,0,0),this.canvasContext.globalCompositeOperation="destination-over",this.canvasContext.drawImage(this.buffers[0],0,0),this.canvasContext.setTransform(this.currentTransform),this.canvasContext.globalCompositeOperation="source-over"}},renderFrame:function(i){if(!(this.hidden||this.data.hd)&&!(this.data.td===1&&!i)){this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.setBlendMode();var s=this.data.ty===0;this.prepareLayer(),this.globalData.renderer.save(s),this.globalData.renderer.ctxTransform(this.finalTransform.localMat.props),this.globalData.renderer.ctxOpacity(this.finalTransform.localOpacity),this.renderInnerContent(),this.globalData.renderer.restore(s),this.exitLayer(),this.maskManager.hasMasks&&this.globalData.renderer.restore(!0),this._isFirstFrame&&(this._isFirstFrame=!1)}},destroy:function(){this.canvasContext=null,this.data=null,this.globalData=null,this.maskManager.destroy()},mHelper:new Matrix},CVBaseElement.prototype.hide=CVBaseElement.prototype.hideElement,CVBaseElement.prototype.show=CVBaseElement.prototype.showElement;function CVShapeData(e,i,s,a){this.styledShapes=[],this.tr=[0,0,0,0,0,0];var b=4;i.ty==="rc"?b=5:i.ty==="el"?b=6:i.ty==="sr"&&(b=7),this.sh=ShapePropertyFactory.getShapeProp(e,i,b,e);var et,nt=s.length,c;for(et=0;et<nt;et+=1)s[et].closed||(c={transforms:a.addTransformSequence(s[et].transforms),trNodes:[]},this.styledShapes.push(c),s[et].elements.push(c))}CVShapeData.prototype.setAsAnimated=SVGShapeData.prototype.setAsAnimated;function CVShapeElement(e,i,s){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.itemsData=[],this.prevViewData=[],this.shapeModifiers=[],this.processedElements=[],this.transformsManager=new ShapeTransformManager,this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,CVBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableElement],CVShapeElement),CVShapeElement.prototype.initElement=RenderableDOMElement.prototype.initElement,CVShapeElement.prototype.transformHelper={opacity:1,_opMdf:!1},CVShapeElement.prototype.dashResetter=[],CVShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[])},CVShapeElement.prototype.createStyleElement=function(e,i){var s={data:e,type:e.ty,preTransforms:this.transformsManager.addTransformSequence(i),transforms:[],elements:[],closed:e.hd===!0},a={};if(e.ty==="fl"||e.ty==="st"?(a.c=PropertyFactory.getProp(this,e.c,1,255,this),a.c.k||(s.co="rgb("+bmFloor(a.c.v[0])+","+bmFloor(a.c.v[1])+","+bmFloor(a.c.v[2])+")")):(e.ty==="gf"||e.ty==="gs")&&(a.s=PropertyFactory.getProp(this,e.s,1,null,this),a.e=PropertyFactory.getProp(this,e.e,1,null,this),a.h=PropertyFactory.getProp(this,e.h||{k:0},0,.01,this),a.a=PropertyFactory.getProp(this,e.a||{k:0},0,degToRads,this),a.g=new GradientProperty(this,e.g,this)),a.o=PropertyFactory.getProp(this,e.o,0,.01,this),e.ty==="st"||e.ty==="gs"){if(s.lc=lineCapEnum[e.lc||2],s.lj=lineJoinEnum[e.lj||2],e.lj==1&&(s.ml=e.ml),a.w=PropertyFactory.getProp(this,e.w,0,null,this),a.w.k||(s.wi=a.w.v),e.d){var b=new DashProperty(this,e.d,"canvas",this);a.d=b,a.d.k||(s.da=a.d.dashArray,s.do=a.d.dashoffset[0])}}else s.r=e.r===2?"evenodd":"nonzero";return this.stylesList.push(s),a.style=s,a},CVShapeElement.prototype.createGroupElement=function(){var e={it:[],prevViewData:[]};return e},CVShapeElement.prototype.createTransformElement=function(e){var i={transform:{opacity:1,_opMdf:!1,key:this.transformsManager.getNewKey(),op:PropertyFactory.getProp(this,e.o,0,.01,this),mProps:TransformPropertyFactory.getTransformProperty(this,e,this)}};return i},CVShapeElement.prototype.createShapeElement=function(e){var i=new CVShapeData(this,e,this.stylesList,this.transformsManager);return this.shapes.push(i),this.addShapeToModifiers(i),i},CVShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var e,i=this.itemsData.length;for(e=0;e<i;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[]),i=this.dynamicProperties.length,e=0;e<i;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame)},CVShapeElement.prototype.addTransformToStyleList=function(e){var i,s=this.stylesList.length;for(i=0;i<s;i+=1)this.stylesList[i].closed||this.stylesList[i].transforms.push(e)},CVShapeElement.prototype.removeTransformFromStyleList=function(){var e,i=this.stylesList.length;for(e=0;e<i;e+=1)this.stylesList[e].closed||this.stylesList[e].transforms.pop()},CVShapeElement.prototype.closeStyles=function(e){var i,s=e.length;for(i=0;i<s;i+=1)e[i].closed=!0},CVShapeElement.prototype.searchShapes=function(e,i,s,a,b){var et,nt=e.length-1,c,ct,pt=[],xt=[],St,Et,Rt,Nt=[].concat(b);for(et=nt;et>=0;et-=1){if(St=this.searchProcessedElement(e[et]),St?i[et]=s[St-1]:e[et]._shouldRender=a,e[et].ty==="fl"||e[et].ty==="st"||e[et].ty==="gf"||e[et].ty==="gs")St?i[et].style.closed=!1:i[et]=this.createStyleElement(e[et],Nt),pt.push(i[et].style);else if(e[et].ty==="gr"){if(!St)i[et]=this.createGroupElement(e[et]);else for(ct=i[et].it.length,c=0;c<ct;c+=1)i[et].prevViewData[c]=i[et].it[c];this.searchShapes(e[et].it,i[et].it,i[et].prevViewData,a,Nt)}else e[et].ty==="tr"?(St||(Rt=this.createTransformElement(e[et]),i[et]=Rt),Nt.push(i[et]),this.addTransformToStyleList(i[et])):e[et].ty==="sh"||e[et].ty==="rc"||e[et].ty==="el"||e[et].ty==="sr"?St||(i[et]=this.createShapeElement(e[et])):e[et].ty==="tm"||e[et].ty==="rd"||e[et].ty==="pb"||e[et].ty==="zz"||e[et].ty==="op"?(St?(Et=i[et],Et.closed=!1):(Et=ShapeModifiers.getModifier(e[et].ty),Et.init(this,e[et]),i[et]=Et,this.shapeModifiers.push(Et)),xt.push(Et)):e[et].ty==="rp"&&(St?(Et=i[et],Et.closed=!0):(Et=ShapeModifiers.getModifier(e[et].ty),i[et]=Et,Et.init(this,e,et,i),this.shapeModifiers.push(Et),a=!1),xt.push(Et));this.addProcessedElement(e[et],et+1)}for(this.removeTransformFromStyleList(),this.closeStyles(pt),nt=xt.length,et=0;et<nt;et+=1)xt[et].closed=!0},CVShapeElement.prototype.renderInnerContent=function(){this.transformHelper.opacity=1,this.transformHelper._opMdf=!1,this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame),this.renderShape(this.transformHelper,this.shapesData,this.itemsData,!0)},CVShapeElement.prototype.renderShapeTransform=function(e,i){(e._opMdf||i.op._mdf||this._isFirstFrame)&&(i.opacity=e.opacity,i.opacity*=i.op.v,i._opMdf=!0)},CVShapeElement.prototype.drawLayer=function(){var e,i=this.stylesList.length,s,a,b,et,nt,c,ct=this.globalData.renderer,pt=this.globalData.canvasContext,xt,St;for(e=0;e<i;e+=1)if(St=this.stylesList[e],xt=St.type,!((xt==="st"||xt==="gs")&&St.wi===0||!St.data._shouldRender||St.coOp===0||this.globalData.currentGlobalAlpha===0)){for(ct.save(),nt=St.elements,xt==="st"||xt==="gs"?(ct.ctxStrokeStyle(xt==="st"?St.co:St.grd),ct.ctxLineWidth(St.wi),ct.ctxLineCap(St.lc),ct.ctxLineJoin(St.lj),ct.ctxMiterLimit(St.ml||0)):ct.ctxFillStyle(xt==="fl"?St.co:St.grd),ct.ctxOpacity(St.coOp),xt!=="st"&&xt!=="gs"&&pt.beginPath(),ct.ctxTransform(St.preTransforms.finalTransform.props),a=nt.length,s=0;s<a;s+=1){for((xt==="st"||xt==="gs")&&(pt.beginPath(),St.da&&(pt.setLineDash(St.da),pt.lineDashOffset=St.do)),c=nt[s].trNodes,et=c.length,b=0;b<et;b+=1)c[b].t==="m"?pt.moveTo(c[b].p[0],c[b].p[1]):c[b].t==="c"?pt.bezierCurveTo(c[b].pts[0],c[b].pts[1],c[b].pts[2],c[b].pts[3],c[b].pts[4],c[b].pts[5]):pt.closePath();(xt==="st"||xt==="gs")&&(ct.ctxStroke(),St.da&&pt.setLineDash(this.dashResetter))}xt!=="st"&&xt!=="gs"&&this.globalData.renderer.ctxFill(St.r),ct.restore()}},CVShapeElement.prototype.renderShape=function(e,i,s,a){var b,et=i.length-1,nt;for(nt=e,b=et;b>=0;b-=1)i[b].ty==="tr"?(nt=s[b].transform,this.renderShapeTransform(e,nt)):i[b].ty==="sh"||i[b].ty==="el"||i[b].ty==="rc"||i[b].ty==="sr"?this.renderPath(i[b],s[b]):i[b].ty==="fl"?this.renderFill(i[b],s[b],nt):i[b].ty==="st"?this.renderStroke(i[b],s[b],nt):i[b].ty==="gf"||i[b].ty==="gs"?this.renderGradientFill(i[b],s[b],nt):i[b].ty==="gr"?this.renderShape(nt,i[b].it,s[b].it):i[b].ty;a&&this.drawLayer()},CVShapeElement.prototype.renderStyledShape=function(e,i){if(this._isFirstFrame||i._mdf||e.transforms._mdf){var s=e.trNodes,a=i.paths,b,et,nt,c=a._length;s.length=0;var ct=e.transforms.finalTransform;for(nt=0;nt<c;nt+=1){var pt=a.shapes[nt];if(pt&&pt.v){for(et=pt._length,b=1;b<et;b+=1)b===1&&s.push({t:"m",p:ct.applyToPointArray(pt.v[0][0],pt.v[0][1],0)}),s.push({t:"c",pts:ct.applyToTriplePoints(pt.o[b-1],pt.i[b],pt.v[b])});et===1&&s.push({t:"m",p:ct.applyToPointArray(pt.v[0][0],pt.v[0][1],0)}),pt.c&&et&&(s.push({t:"c",pts:ct.applyToTriplePoints(pt.o[b-1],pt.i[0],pt.v[0])}),s.push({t:"z"}))}}e.trNodes=s}},CVShapeElement.prototype.renderPath=function(e,i){if(e.hd!==!0&&e._shouldRender){var s,a=i.styledShapes.length;for(s=0;s<a;s+=1)this.renderStyledShape(i.styledShapes[s],i.sh)}},CVShapeElement.prototype.renderFill=function(e,i,s){var a=i.style;(i.c._mdf||this._isFirstFrame)&&(a.co="rgb("+bmFloor(i.c.v[0])+","+bmFloor(i.c.v[1])+","+bmFloor(i.c.v[2])+")"),(i.o._mdf||s._opMdf||this._isFirstFrame)&&(a.coOp=i.o.v*s.opacity)},CVShapeElement.prototype.renderGradientFill=function(e,i,s){var a=i.style,b;if(!a.grd||i.g._mdf||i.s._mdf||i.e._mdf||e.t!==1&&(i.h._mdf||i.a._mdf)){var et=this.globalData.canvasContext,nt=i.s.v,c=i.e.v;if(e.t===1)b=et.createLinearGradient(nt[0],nt[1],c[0],c[1]);else{var ct=Math.sqrt(Math.pow(nt[0]-c[0],2)+Math.pow(nt[1]-c[1],2)),pt=Math.atan2(c[1]-nt[1],c[0]-nt[0]),xt=i.h.v;xt>=1?xt=.99:xt<=-1&&(xt=-.99);var St=ct*xt,Et=Math.cos(pt+i.a.v)*St+nt[0],Rt=Math.sin(pt+i.a.v)*St+nt[1];b=et.createRadialGradient(Et,Rt,0,nt[0],nt[1],ct)}var Nt,It=e.g.p,Gt=i.g.c,Dt=1;for(Nt=0;Nt<It;Nt+=1)i.g._hasOpacity&&i.g._collapsable&&(Dt=i.g.o[Nt*2+1]),b.addColorStop(Gt[Nt*4]/100,"rgba("+Gt[Nt*4+1]+","+Gt[Nt*4+2]+","+Gt[Nt*4+3]+","+Dt+")");a.grd=b}a.coOp=i.o.v*s.opacity},CVShapeElement.prototype.renderStroke=function(e,i,s){var a=i.style,b=i.d;b&&(b._mdf||this._isFirstFrame)&&(a.da=b.dashArray,a.do=b.dashoffset[0]),(i.c._mdf||this._isFirstFrame)&&(a.co="rgb("+bmFloor(i.c.v[0])+","+bmFloor(i.c.v[1])+","+bmFloor(i.c.v[2])+")"),(i.o._mdf||s._opMdf||this._isFirstFrame)&&(a.coOp=i.o.v*s.opacity),(i.w._mdf||this._isFirstFrame)&&(a.wi=i.w.v)},CVShapeElement.prototype.destroy=function(){this.shapesData=null,this.globalData=null,this.canvasContext=null,this.stylesList.length=0,this.itemsData.length=0};function CVTextElement(e,i,s){this.textSpans=[],this.yOffset=0,this.fillColorAnim=!1,this.strokeColorAnim=!1,this.strokeWidthAnim=!1,this.stroke=!1,this.fill=!1,this.justifyOffset=0,this.currentRender=null,this.renderType="canvas",this.values={fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",sWidth:0,fValue:""},this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement,ITextElement],CVTextElement),CVTextElement.prototype.tHelper=createTag("canvas").getContext("2d"),CVTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var i=!1;e.fc?(i=!0,this.values.fill=this.buildColor(e.fc)):this.values.fill="rgba(0,0,0,0)",this.fill=i;var s=!1;e.sc&&(s=!0,this.values.stroke=this.buildColor(e.sc),this.values.sWidth=e.sw);var a=this.globalData.fontManager.getFontByName(e.f),b,et,nt=e.l,c=this.mHelper;this.stroke=s,this.values.fValue=e.finalSize+"px "+this.globalData.fontManager.getFontByName(e.f).fFamily,et=e.finalText.length;var ct,pt,xt,St,Et,Rt,Nt,It,Gt,Dt,Bt=this.data.singleShape,Lt=e.tr*.001*e.finalSize,Vt=0,Zt=0,nr=!0,ur=0;for(b=0;b<et;b+=1){ct=this.globalData.fontManager.getCharData(e.finalText[b],a.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily),pt=ct&&ct.data||{},c.reset(),Bt&&nt[b].n&&(Vt=-Lt,Zt+=e.yOffset,Zt+=nr?1:0,nr=!1),Et=pt.shapes?pt.shapes[0].it:[],Nt=Et.length,c.scale(e.finalSize/100,e.finalSize/100),Bt&&this.applyTextPropertiesToMatrix(e,c,nt[b].line,Vt,Zt),Gt=createSizedArray(Nt-1);var _r=0;for(Rt=0;Rt<Nt;Rt+=1)if(Et[Rt].ty==="sh"){for(St=Et[Rt].ks.k.i.length,It=Et[Rt].ks.k,Dt=[],xt=1;xt<St;xt+=1)xt===1&&Dt.push(c.applyToX(It.v[0][0],It.v[0][1],0),c.applyToY(It.v[0][0],It.v[0][1],0)),Dt.push(c.applyToX(It.o[xt-1][0],It.o[xt-1][1],0),c.applyToY(It.o[xt-1][0],It.o[xt-1][1],0),c.applyToX(It.i[xt][0],It.i[xt][1],0),c.applyToY(It.i[xt][0],It.i[xt][1],0),c.applyToX(It.v[xt][0],It.v[xt][1],0),c.applyToY(It.v[xt][0],It.v[xt][1],0));Dt.push(c.applyToX(It.o[xt-1][0],It.o[xt-1][1],0),c.applyToY(It.o[xt-1][0],It.o[xt-1][1],0),c.applyToX(It.i[0][0],It.i[0][1],0),c.applyToY(It.i[0][0],It.i[0][1],0),c.applyToX(It.v[0][0],It.v[0][1],0),c.applyToY(It.v[0][0],It.v[0][1],0)),Gt[_r]=Dt,_r+=1}Bt&&(Vt+=nt[b].l,Vt+=Lt),this.textSpans[ur]?this.textSpans[ur].elem=Gt:this.textSpans[ur]={elem:Gt},ur+=1}},CVTextElement.prototype.renderInnerContent=function(){this.validateText();var e=this.canvasContext;e.font=this.values.fValue,this.globalData.renderer.ctxLineCap("butt"),this.globalData.renderer.ctxLineJoin("miter"),this.globalData.renderer.ctxMiterLimit(4),this.data.singleShape||this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag);var i,s,a,b,et,nt,c=this.textAnimator.renderedLetters,ct=this.textProperty.currentData.l;s=ct.length;var pt,xt=null,St=null,Et=null,Rt,Nt,It=this.globalData.renderer;for(i=0;i<s;i+=1)if(!ct[i].n){if(pt=c[i],pt&&(It.save(),It.ctxTransform(pt.p),It.ctxOpacity(pt.o)),this.fill){for(pt&&pt.fc?xt!==pt.fc&&(It.ctxFillStyle(pt.fc),xt=pt.fc):xt!==this.values.fill&&(xt=this.values.fill,It.ctxFillStyle(this.values.fill)),Rt=this.textSpans[i].elem,b=Rt.length,this.globalData.canvasContext.beginPath(),a=0;a<b;a+=1)for(Nt=Rt[a],nt=Nt.length,this.globalData.canvasContext.moveTo(Nt[0],Nt[1]),et=2;et<nt;et+=6)this.globalData.canvasContext.bezierCurveTo(Nt[et],Nt[et+1],Nt[et+2],Nt[et+3],Nt[et+4],Nt[et+5]);this.globalData.canvasContext.closePath(),It.ctxFill()}if(this.stroke){for(pt&&pt.sw?Et!==pt.sw&&(Et=pt.sw,It.ctxLineWidth(pt.sw)):Et!==this.values.sWidth&&(Et=this.values.sWidth,It.ctxLineWidth(this.values.sWidth)),pt&&pt.sc?St!==pt.sc&&(St=pt.sc,It.ctxStrokeStyle(pt.sc)):St!==this.values.stroke&&(St=this.values.stroke,It.ctxStrokeStyle(this.values.stroke)),Rt=this.textSpans[i].elem,b=Rt.length,this.globalData.canvasContext.beginPath(),a=0;a<b;a+=1)for(Nt=Rt[a],nt=Nt.length,this.globalData.canvasContext.moveTo(Nt[0],Nt[1]),et=2;et<nt;et+=6)this.globalData.canvasContext.bezierCurveTo(Nt[et],Nt[et+1],Nt[et+2],Nt[et+3],Nt[et+4],Nt[et+5]);this.globalData.canvasContext.closePath(),It.ctxStroke()}pt&&this.globalData.renderer.restore()}};function CVImageElement(e,i,s){this.assetData=i.getAssetData(e.refId),this.img=i.imageLoader.getAsset(this.assetData),this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVImageElement),CVImageElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVImageElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVImageElement.prototype.createContent=function(){if(this.img.width&&(this.assetData.w!==this.img.width||this.assetData.h!==this.img.height)){var e=createTag("canvas");e.width=this.assetData.w,e.height=this.assetData.h;var i=e.getContext("2d"),s=this.img.width,a=this.img.height,b=s/a,et=this.assetData.w/this.assetData.h,nt,c,ct=this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio;b>et&&ct==="xMidYMid slice"||b<et&&ct!=="xMidYMid slice"?(c=a,nt=c*et):(nt=s,c=nt/et),i.drawImage(this.img,(s-nt)/2,(a-c)/2,nt,c,0,0,this.assetData.w,this.assetData.h),this.img=e}},CVImageElement.prototype.renderInnerContent=function(){this.canvasContext.drawImage(this.img,0,0)},CVImageElement.prototype.destroy=function(){this.img=null};function CVSolidElement(e,i,s){this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVSolidElement),CVSolidElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVSolidElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVSolidElement.prototype.renderInnerContent=function(){this.globalData.renderer.ctxFillStyle(this.data.sc),this.globalData.renderer.ctxFillRect(0,0,this.data.sw,this.data.sh)};function CanvasRendererBase(){}extendPrototype([BaseRenderer],CanvasRendererBase),CanvasRendererBase.prototype.createShape=function(e){return new CVShapeElement(e,this.globalData,this)},CanvasRendererBase.prototype.createText=function(e){return new CVTextElement(e,this.globalData,this)},CanvasRendererBase.prototype.createImage=function(e){return new CVImageElement(e,this.globalData,this)},CanvasRendererBase.prototype.createSolid=function(e){return new CVSolidElement(e,this.globalData,this)},CanvasRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,CanvasRendererBase.prototype.ctxTransform=function(e){e[0]===1&&e[1]===0&&e[4]===0&&e[5]===1&&e[12]===0&&e[13]===0||this.canvasContext.transform(e[0],e[1],e[4],e[5],e[12],e[13])},CanvasRendererBase.prototype.ctxOpacity=function(e){this.canvasContext.globalAlpha*=e<0?0:e},CanvasRendererBase.prototype.ctxFillStyle=function(e){this.canvasContext.fillStyle=e},CanvasRendererBase.prototype.ctxStrokeStyle=function(e){this.canvasContext.strokeStyle=e},CanvasRendererBase.prototype.ctxLineWidth=function(e){this.canvasContext.lineWidth=e},CanvasRendererBase.prototype.ctxLineCap=function(e){this.canvasContext.lineCap=e},CanvasRendererBase.prototype.ctxLineJoin=function(e){this.canvasContext.lineJoin=e},CanvasRendererBase.prototype.ctxMiterLimit=function(e){this.canvasContext.miterLimit=e},CanvasRendererBase.prototype.ctxFill=function(e){this.canvasContext.fill(e)},CanvasRendererBase.prototype.ctxFillRect=function(e,i,s,a){this.canvasContext.fillRect(e,i,s,a)},CanvasRendererBase.prototype.ctxStroke=function(){this.canvasContext.stroke()},CanvasRendererBase.prototype.reset=function(){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}this.contextData.reset()},CanvasRendererBase.prototype.save=function(){this.canvasContext.save()},CanvasRendererBase.prototype.restore=function(e){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}e&&(this.globalData.blendMode="source-over"),this.contextData.restore(e)},CanvasRendererBase.prototype.configAnimation=function(e){if(this.animationItem.wrapper){this.animationItem.container=createTag("canvas");var i=this.animationItem.container.style;i.width="100%",i.height="100%";var s="0px 0px 0px";i.transformOrigin=s,i.mozTransformOrigin=s,i.webkitTransformOrigin=s,i["-webkit-transform"]=s,i.contentVisibility=this.renderConfig.contentVisibility,this.animationItem.wrapper.appendChild(this.animationItem.container),this.canvasContext=this.animationItem.container.getContext("2d"),this.renderConfig.className&&this.animationItem.container.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.animationItem.container.setAttribute("id",this.renderConfig.id)}else this.canvasContext=this.renderConfig.context;this.contextData.setContext(this.canvasContext),this.data=e,this.layers=e.layers,this.transformCanvas={w:e.w,h:e.h,sx:0,sy:0,tx:0,ty:0},this.setupGlobalData(e,document.body),this.globalData.canvasContext=this.canvasContext,this.globalData.renderer=this,this.globalData.isDashed=!1,this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.globalData.transformCanvas=this.transformCanvas,this.elements=createSizedArray(e.layers.length),this.updateContainerSize()},CanvasRendererBase.prototype.updateContainerSize=function(e,i){this.reset();var s,a;e?(s=e,a=i,this.canvasContext.canvas.width=s,this.canvasContext.canvas.height=a):(this.animationItem.wrapper&&this.animationItem.container?(s=this.animationItem.wrapper.offsetWidth,a=this.animationItem.wrapper.offsetHeight):(s=this.canvasContext.canvas.width,a=this.canvasContext.canvas.height),this.canvasContext.canvas.width=s*this.renderConfig.dpr,this.canvasContext.canvas.height=a*this.renderConfig.dpr);var b,et;if(this.renderConfig.preserveAspectRatio.indexOf("meet")!==-1||this.renderConfig.preserveAspectRatio.indexOf("slice")!==-1){var nt=this.renderConfig.preserveAspectRatio.split(" "),c=nt[1]||"meet",ct=nt[0]||"xMidYMid",pt=ct.substr(0,4),xt=ct.substr(4);b=s/a,et=this.transformCanvas.w/this.transformCanvas.h,et>b&&c==="meet"||et<b&&c==="slice"?(this.transformCanvas.sx=s/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=s/(this.transformCanvas.w/this.renderConfig.dpr)):(this.transformCanvas.sx=a/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.sy=a/(this.transformCanvas.h/this.renderConfig.dpr)),pt==="xMid"&&(et<b&&c==="meet"||et>b&&c==="slice")?this.transformCanvas.tx=(s-this.transformCanvas.w*(a/this.transformCanvas.h))/2*this.renderConfig.dpr:pt==="xMax"&&(et<b&&c==="meet"||et>b&&c==="slice")?this.transformCanvas.tx=(s-this.transformCanvas.w*(a/this.transformCanvas.h))*this.renderConfig.dpr:this.transformCanvas.tx=0,xt==="YMid"&&(et>b&&c==="meet"||et<b&&c==="slice")?this.transformCanvas.ty=(a-this.transformCanvas.h*(s/this.transformCanvas.w))/2*this.renderConfig.dpr:xt==="YMax"&&(et>b&&c==="meet"||et<b&&c==="slice")?this.transformCanvas.ty=(a-this.transformCanvas.h*(s/this.transformCanvas.w))*this.renderConfig.dpr:this.transformCanvas.ty=0}else this.renderConfig.preserveAspectRatio==="none"?(this.transformCanvas.sx=s/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=a/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.tx=0,this.transformCanvas.ty=0):(this.transformCanvas.sx=this.renderConfig.dpr,this.transformCanvas.sy=this.renderConfig.dpr,this.transformCanvas.tx=0,this.transformCanvas.ty=0);this.transformCanvas.props=[this.transformCanvas.sx,0,0,0,0,this.transformCanvas.sy,0,0,0,0,1,0,this.transformCanvas.tx,this.transformCanvas.ty,0,1],this.ctxTransform(this.transformCanvas.props),this.canvasContext.beginPath(),this.canvasContext.rect(0,0,this.transformCanvas.w,this.transformCanvas.h),this.canvasContext.closePath(),this.canvasContext.clip(),this.renderFrame(this.renderedFrame,!0)},CanvasRendererBase.prototype.destroy=function(){this.renderConfig.clearCanvas&&this.animationItem.wrapper&&(this.animationItem.wrapper.innerText="");var e,i=this.layers?this.layers.length:0;for(e=i-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.globalData.canvasContext=null,this.animationItem.container=null,this.destroyed=!0},CanvasRendererBase.prototype.renderFrame=function(e,i){if(!(this.renderedFrame===e&&this.renderConfig.clearCanvas===!0&&!i||this.destroyed||e===-1)){this.renderedFrame=e,this.globalData.frameNum=e-this.animationItem._isFirstFrame,this.globalData.frameId+=1,this.globalData._mdf=!this.renderConfig.clearCanvas||i,this.globalData.projectInterface.currentFrame=e;var s,a=this.layers.length;for(this.completeLayers||this.checkLayers(e),s=a-1;s>=0;s-=1)(this.completeLayers||this.elements[s])&&this.elements[s].prepareFrame(e-this.layers[s].st);if(this.globalData._mdf){for(this.renderConfig.clearCanvas===!0?this.canvasContext.clearRect(0,0,this.transformCanvas.w,this.transformCanvas.h):this.save(),s=a-1;s>=0;s-=1)(this.completeLayers||this.elements[s])&&this.elements[s].renderFrame();this.renderConfig.clearCanvas!==!0&&this.restore()}}},CanvasRendererBase.prototype.buildItem=function(e){var i=this.elements;if(!(i[e]||this.layers[e].ty===99)){var s=this.createItem(this.layers[e],this,this.globalData);i[e]=s,s.initExpressions()}},CanvasRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();e.checkParenting()}},CanvasRendererBase.prototype.hide=function(){this.animationItem.container.style.display="none"},CanvasRendererBase.prototype.show=function(){this.animationItem.container.style.display="block"};function CanvasContext(){this.opacity=-1,this.transform=createTypedArray("float32",16),this.fillStyle="",this.strokeStyle="",this.lineWidth="",this.lineCap="",this.lineJoin="",this.miterLimit="",this.id=Math.random()}function CVContextData(){this.stack=[],this.cArrPos=0,this.cTr=new Matrix;var e,i=15;for(e=0;e<i;e+=1){var s=new CanvasContext;this.stack[e]=s}this._length=i,this.nativeContext=null,this.transformMat=new Matrix,this.currentOpacity=1,this.currentFillStyle="",this.appliedFillStyle="",this.currentStrokeStyle="",this.appliedStrokeStyle="",this.currentLineWidth="",this.appliedLineWidth="",this.currentLineCap="",this.appliedLineCap="",this.currentLineJoin="",this.appliedLineJoin="",this.appliedMiterLimit="",this.currentMiterLimit=""}CVContextData.prototype.duplicate=function(){var e=this._length*2,i=0;for(i=this._length;i<e;i+=1)this.stack[i]=new CanvasContext;this._length=e},CVContextData.prototype.reset=function(){this.cArrPos=0,this.cTr.reset(),this.stack[this.cArrPos].opacity=1},CVContextData.prototype.restore=function(e){this.cArrPos-=1;var i=this.stack[this.cArrPos],s=i.transform,a,b=this.cTr.props;for(a=0;a<16;a+=1)b[a]=s[a];if(e){this.nativeContext.restore();var et=this.stack[this.cArrPos+1];this.appliedFillStyle=et.fillStyle,this.appliedStrokeStyle=et.strokeStyle,this.appliedLineWidth=et.lineWidth,this.appliedLineCap=et.lineCap,this.appliedLineJoin=et.lineJoin,this.appliedMiterLimit=et.miterLimit}this.nativeContext.setTransform(s[0],s[1],s[4],s[5],s[12],s[13]),(e||i.opacity!==-1&&this.currentOpacity!==i.opacity)&&(this.nativeContext.globalAlpha=i.opacity,this.currentOpacity=i.opacity),this.currentFillStyle=i.fillStyle,this.currentStrokeStyle=i.strokeStyle,this.currentLineWidth=i.lineWidth,this.currentLineCap=i.lineCap,this.currentLineJoin=i.lineJoin,this.currentMiterLimit=i.miterLimit},CVContextData.prototype.save=function(e){e&&this.nativeContext.save();var i=this.cTr.props;this._length<=this.cArrPos&&this.duplicate();var s=this.stack[this.cArrPos],a;for(a=0;a<16;a+=1)s.transform[a]=i[a];this.cArrPos+=1;var b=this.stack[this.cArrPos];b.opacity=s.opacity,b.fillStyle=s.fillStyle,b.strokeStyle=s.strokeStyle,b.lineWidth=s.lineWidth,b.lineCap=s.lineCap,b.lineJoin=s.lineJoin,b.miterLimit=s.miterLimit},CVContextData.prototype.setOpacity=function(e){this.stack[this.cArrPos].opacity=e},CVContextData.prototype.setContext=function(e){this.nativeContext=e},CVContextData.prototype.fillStyle=function(e){this.stack[this.cArrPos].fillStyle!==e&&(this.currentFillStyle=e,this.stack[this.cArrPos].fillStyle=e)},CVContextData.prototype.strokeStyle=function(e){this.stack[this.cArrPos].strokeStyle!==e&&(this.currentStrokeStyle=e,this.stack[this.cArrPos].strokeStyle=e)},CVContextData.prototype.lineWidth=function(e){this.stack[this.cArrPos].lineWidth!==e&&(this.currentLineWidth=e,this.stack[this.cArrPos].lineWidth=e)},CVContextData.prototype.lineCap=function(e){this.stack[this.cArrPos].lineCap!==e&&(this.currentLineCap=e,this.stack[this.cArrPos].lineCap=e)},CVContextData.prototype.lineJoin=function(e){this.stack[this.cArrPos].lineJoin!==e&&(this.currentLineJoin=e,this.stack[this.cArrPos].lineJoin=e)},CVContextData.prototype.miterLimit=function(e){this.stack[this.cArrPos].miterLimit!==e&&(this.currentMiterLimit=e,this.stack[this.cArrPos].miterLimit=e)},CVContextData.prototype.transform=function(e){this.transformMat.cloneFromProps(e);var i=this.cTr;this.transformMat.multiply(i),i.cloneFromProps(this.transformMat.props);var s=i.props;this.nativeContext.setTransform(s[0],s[1],s[4],s[5],s[12],s[13])},CVContextData.prototype.opacity=function(e){var i=this.stack[this.cArrPos].opacity;i*=e<0?0:e,this.stack[this.cArrPos].opacity!==i&&(this.currentOpacity!==e&&(this.nativeContext.globalAlpha=e,this.currentOpacity=e),this.stack[this.cArrPos].opacity=i)},CVContextData.prototype.fill=function(e){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fill(e)},CVContextData.prototype.fillRect=function(e,i,s,a){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fillRect(e,i,s,a)},CVContextData.prototype.stroke=function(){this.appliedStrokeStyle!==this.currentStrokeStyle&&(this.appliedStrokeStyle=this.currentStrokeStyle,this.nativeContext.strokeStyle=this.appliedStrokeStyle),this.appliedLineWidth!==this.currentLineWidth&&(this.appliedLineWidth=this.currentLineWidth,this.nativeContext.lineWidth=this.appliedLineWidth),this.appliedLineCap!==this.currentLineCap&&(this.appliedLineCap=this.currentLineCap,this.nativeContext.lineCap=this.appliedLineCap),this.appliedLineJoin!==this.currentLineJoin&&(this.appliedLineJoin=this.currentLineJoin,this.nativeContext.lineJoin=this.appliedLineJoin),this.appliedMiterLimit!==this.currentMiterLimit&&(this.appliedMiterLimit=this.currentMiterLimit,this.nativeContext.miterLimit=this.appliedMiterLimit),this.nativeContext.stroke()};function CVCompElement(e,i,s){this.completeLayers=!1,this.layers=e.layers,this.pendingElements=[],this.elements=createSizedArray(this.layers.length),this.initElement(e,i,s),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0}}extendPrototype([CanvasRendererBase,ICompElement,CVBaseElement],CVCompElement),CVCompElement.prototype.renderInnerContent=function(){var e=this.canvasContext;e.beginPath(),e.moveTo(0,0),e.lineTo(this.data.w,0),e.lineTo(this.data.w,this.data.h),e.lineTo(0,this.data.h),e.lineTo(0,0),e.clip();var i,s=this.layers.length;for(i=s-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&this.elements[i].renderFrame()},CVCompElement.prototype.destroy=function(){var e,i=this.layers.length;for(e=i-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy();this.layers=null,this.elements=null},CVCompElement.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)};function CanvasRenderer(e,i){this.animationItem=e,this.renderConfig={clearCanvas:i&&i.clearCanvas!==void 0?i.clearCanvas:!0,context:i&&i.context||null,progressiveLoad:i&&i.progressiveLoad||!1,preserveAspectRatio:i&&i.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:i&&i.contentVisibility||"visible",className:i&&i.className||"",id:i&&i.id||"",runExpressions:!i||i.runExpressions===void 0||i.runExpressions},this.renderConfig.dpr=i&&i.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=i&&i.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas",this.renderConfig.clearCanvas&&(this.ctxTransform=this.contextData.transform.bind(this.contextData),this.ctxOpacity=this.contextData.opacity.bind(this.contextData),this.ctxFillStyle=this.contextData.fillStyle.bind(this.contextData),this.ctxStrokeStyle=this.contextData.strokeStyle.bind(this.contextData),this.ctxLineWidth=this.contextData.lineWidth.bind(this.contextData),this.ctxLineCap=this.contextData.lineCap.bind(this.contextData),this.ctxLineJoin=this.contextData.lineJoin.bind(this.contextData),this.ctxMiterLimit=this.contextData.miterLimit.bind(this.contextData),this.ctxFill=this.contextData.fill.bind(this.contextData),this.ctxFillRect=this.contextData.fillRect.bind(this.contextData),this.ctxStroke=this.contextData.stroke.bind(this.contextData),this.save=this.contextData.save.bind(this.contextData))}extendPrototype([CanvasRendererBase],CanvasRenderer),CanvasRenderer.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)};function HBaseElement(){}HBaseElement.prototype={checkBlendMode:function(){},initRendererElement:function(){this.baseElement=createTag(this.data.tg||"div"),this.data.hasMask?(this.svgElement=createNS("svg"),this.layerElement=createNS("g"),this.maskedElement=this.layerElement,this.svgElement.appendChild(this.layerElement),this.baseElement.appendChild(this.svgElement)):this.layerElement=this.baseElement,styleDiv(this.baseElement)},createContainerElements:function(){this.renderableEffectsManager=new CVEffects(this),this.transformedElement=this.baseElement,this.maskedElement=this.layerElement,this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.bm!==0&&this.setBlendMode()},renderElement:function(){var i=this.transformedElement?this.transformedElement.style:{};if(this.finalTransform._matMdf){var s=this.finalTransform.mat.toCSS();i.transform=s,i.webkitTransform=s}this.finalTransform._opMdf&&(i.opacity=this.finalTransform.mProp.o.v)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},destroy:function(){this.layerElement=null,this.transformedElement=null,this.matteElement&&(this.matteElement=null),this.maskManager&&(this.maskManager.destroy(),this.maskManager=null)},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData)},addEffects:function(){},setMatte:function(){}},HBaseElement.prototype.getBaseElement=SVGBaseElement.prototype.getBaseElement,HBaseElement.prototype.destroyBaseElement=HBaseElement.prototype.destroy,HBaseElement.prototype.buildElementParenting=BaseRenderer.prototype.buildElementParenting;function HSolidElement(e,i,s){this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],HSolidElement),HSolidElement.prototype.createContent=function(){var e;this.data.hasMask?(e=createNS("rect"),e.setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.svgElement.setAttribute("width",this.data.sw),this.svgElement.setAttribute("height",this.data.sh)):(e=createTag("div"),e.style.width=this.data.sw+"px",e.style.height=this.data.sh+"px",e.style.backgroundColor=this.data.sc),this.layerElement.appendChild(e)};function HShapeElement(e,i,s){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.shapesContainer=createNS("g"),this.initElement(e,i,s),this.prevViewData=[],this.currentBBox={x:999999,y:-999999,h:0,w:0}}extendPrototype([BaseElement,TransformElement,HSolidElement,SVGShapeElement,HBaseElement,HierarchyElement,FrameElement,RenderableElement],HShapeElement),HShapeElement.prototype._renderShapeFrame=HShapeElement.prototype.renderInnerContent,HShapeElement.prototype.createContent=function(){var e;if(this.baseElement.style.fontSize=0,this.data.hasMask)this.layerElement.appendChild(this.shapesContainer),e=this.svgElement;else{e=createNS("svg");var i=this.comp.data?this.comp.data:this.globalData.compSize;e.setAttribute("width",i.w),e.setAttribute("height",i.h),e.appendChild(this.shapesContainer),this.layerElement.appendChild(e)}this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.shapesContainer,0,[],!0),this.filterUniqueShapes(),this.shapeCont=e},HShapeElement.prototype.getTransformedPoint=function(e,i){var s,a=e.length;for(s=0;s<a;s+=1)i=e[s].mProps.v.applyToPointArray(i[0],i[1],0);return i},HShapeElement.prototype.calculateShapeBoundingBox=function(e,i){var s=e.sh.v,a=e.transformers,b,et=s._length,nt,c,ct,pt;if(!(et<=1)){for(b=0;b<et-1;b+=1)nt=this.getTransformedPoint(a,s.v[b]),c=this.getTransformedPoint(a,s.o[b]),ct=this.getTransformedPoint(a,s.i[b+1]),pt=this.getTransformedPoint(a,s.v[b+1]),this.checkBounds(nt,c,ct,pt,i);s.c&&(nt=this.getTransformedPoint(a,s.v[b]),c=this.getTransformedPoint(a,s.o[b]),ct=this.getTransformedPoint(a,s.i[0]),pt=this.getTransformedPoint(a,s.v[0]),this.checkBounds(nt,c,ct,pt,i))}},HShapeElement.prototype.checkBounds=function(e,i,s,a,b){this.getBoundsOfCurve(e,i,s,a);var et=this.shapeBoundingBox;b.x=bmMin(et.left,b.x),b.xMax=bmMax(et.right,b.xMax),b.y=bmMin(et.top,b.y),b.yMax=bmMax(et.bottom,b.yMax)},HShapeElement.prototype.shapeBoundingBox={left:0,right:0,top:0,bottom:0},HShapeElement.prototype.tempBoundingBox={x:0,xMax:0,y:0,yMax:0,width:0,height:0},HShapeElement.prototype.getBoundsOfCurve=function(e,i,s,a){for(var b=[[e[0],a[0]],[e[1],a[1]]],et,nt,c,ct,pt,xt,St,Et=0;Et<2;++Et)nt=6*e[Et]-12*i[Et]+6*s[Et],et=-3*e[Et]+9*i[Et]-9*s[Et]+3*a[Et],c=3*i[Et]-3*e[Et],nt|=0,et|=0,c|=0,et===0&&nt===0||(et===0?(ct=-c/nt,ct>0&&ct<1&&b[Et].push(this.calculateF(ct,e,i,s,a,Et))):(pt=nt*nt-4*c*et,pt>=0&&(xt=(-nt+bmSqrt(pt))/(2*et),xt>0&&xt<1&&b[Et].push(this.calculateF(xt,e,i,s,a,Et)),St=(-nt-bmSqrt(pt))/(2*et),St>0&&St<1&&b[Et].push(this.calculateF(St,e,i,s,a,Et)))));this.shapeBoundingBox.left=bmMin.apply(null,b[0]),this.shapeBoundingBox.top=bmMin.apply(null,b[1]),this.shapeBoundingBox.right=bmMax.apply(null,b[0]),this.shapeBoundingBox.bottom=bmMax.apply(null,b[1])},HShapeElement.prototype.calculateF=function(e,i,s,a,b,et){return bmPow(1-e,3)*i[et]+3*bmPow(1-e,2)*e*s[et]+3*(1-e)*bmPow(e,2)*a[et]+bmPow(e,3)*b[et]},HShapeElement.prototype.calculateBoundingBox=function(e,i){var s,a=e.length;for(s=0;s<a;s+=1)e[s]&&e[s].sh?this.calculateShapeBoundingBox(e[s],i):e[s]&&e[s].it?this.calculateBoundingBox(e[s].it,i):e[s]&&e[s].style&&e[s].w&&this.expandStrokeBoundingBox(e[s].w,i)},HShapeElement.prototype.expandStrokeBoundingBox=function(e,i){var s=0;if(e.keyframes){for(var a=0;a<e.keyframes.length;a+=1){var b=e.keyframes[a].s;b>s&&(s=b)}s*=e.mult}else s=e.v*e.mult;i.x-=s,i.xMax+=s,i.y-=s,i.yMax+=s},HShapeElement.prototype.currentBoxContains=function(e){return this.currentBBox.x<=e.x&&this.currentBBox.y<=e.y&&this.currentBBox.width+this.currentBBox.x>=e.x+e.width&&this.currentBBox.height+this.currentBBox.y>=e.y+e.height},HShapeElement.prototype.renderInnerContent=function(){if(this._renderShapeFrame(),!this.hidden&&(this._isFirstFrame||this._mdf)){var e=this.tempBoundingBox,i=999999;if(e.x=i,e.xMax=-i,e.y=i,e.yMax=-i,this.calculateBoundingBox(this.itemsData,e),e.width=e.xMax<e.x?0:e.xMax-e.x,e.height=e.yMax<e.y?0:e.yMax-e.y,this.currentBoxContains(e))return;var s=!1;if(this.currentBBox.w!==e.width&&(this.currentBBox.w=e.width,this.shapeCont.setAttribute("width",e.width),s=!0),this.currentBBox.h!==e.height&&(this.currentBBox.h=e.height,this.shapeCont.setAttribute("height",e.height),s=!0),s||this.currentBBox.x!==e.x||this.currentBBox.y!==e.y){this.currentBBox.w=e.width,this.currentBBox.h=e.height,this.currentBBox.x=e.x,this.currentBBox.y=e.y,this.shapeCont.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h);var a=this.shapeCont.style,b="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";a.transform=b,a.webkitTransform=b}}};function HTextElement(e,i,s){this.textSpans=[],this.textPaths=[],this.currentBBox={x:999999,y:-999999,h:0,w:0},this.renderType="svg",this.isMasked=!1,this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],HTextElement),HTextElement.prototype.createContent=function(){if(this.isMasked=this.checkMasks(),this.isMasked){this.renderType="svg",this.compW=this.comp.data.w,this.compH=this.comp.data.h,this.svgElement.setAttribute("width",this.compW),this.svgElement.setAttribute("height",this.compH);var e=createNS("g");this.maskedElement.appendChild(e),this.innerElem=e}else this.renderType="html",this.innerElem=this.layerElement;this.checkParenting()},HTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var i=this.innerElem.style,s=e.fc?this.buildColor(e.fc):"rgba(0,0,0,0)";i.fill=s,i.color=s,e.sc&&(i.stroke=this.buildColor(e.sc),i.strokeWidth=e.sw+"px");var a=this.globalData.fontManager.getFontByName(e.f);if(!this.globalData.fontManager.chars)if(i.fontSize=e.finalSize+"px",i.lineHeight=e.finalSize+"px",a.fClass)this.innerElem.className=a.fClass;else{i.fontFamily=a.fFamily;var b=e.fWeight,et=e.fStyle;i.fontStyle=et,i.fontWeight=b}var nt,c,ct=e.l;c=ct.length;var pt,xt,St,Et=this.mHelper,Rt,Nt="",It=0;for(nt=0;nt<c;nt+=1){if(this.globalData.fontManager.chars?(this.textPaths[It]?pt=this.textPaths[It]:(pt=createNS("path"),pt.setAttribute("stroke-linecap",lineCapEnum[1]),pt.setAttribute("stroke-linejoin",lineJoinEnum[2]),pt.setAttribute("stroke-miterlimit","4")),this.isMasked||(this.textSpans[It]?(xt=this.textSpans[It],St=xt.children[0]):(xt=createTag("div"),xt.style.lineHeight=0,St=createNS("svg"),St.appendChild(pt),styleDiv(xt)))):this.isMasked?pt=this.textPaths[It]?this.textPaths[It]:createNS("text"):this.textSpans[It]?(xt=this.textSpans[It],pt=this.textPaths[It]):(xt=createTag("span"),styleDiv(xt),pt=createTag("span"),styleDiv(pt),xt.appendChild(pt)),this.globalData.fontManager.chars){var Gt=this.globalData.fontManager.getCharData(e.finalText[nt],a.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily),Dt;if(Gt?Dt=Gt.data:Dt=null,Et.reset(),Dt&&Dt.shapes&&Dt.shapes.length&&(Rt=Dt.shapes[0].it,Et.scale(e.finalSize/100,e.finalSize/100),Nt=this.createPathShape(Et,Rt),pt.setAttribute("d",Nt)),this.isMasked)this.innerElem.appendChild(pt);else{if(this.innerElem.appendChild(xt),Dt&&Dt.shapes){document.body.appendChild(St);var Bt=St.getBBox();St.setAttribute("width",Bt.width+2),St.setAttribute("height",Bt.height+2),St.setAttribute("viewBox",Bt.x-1+" "+(Bt.y-1)+" "+(Bt.width+2)+" "+(Bt.height+2));var Lt=St.style,Vt="translate("+(Bt.x-1)+"px,"+(Bt.y-1)+"px)";Lt.transform=Vt,Lt.webkitTransform=Vt,ct[nt].yOffset=Bt.y-1}else St.setAttribute("width",1),St.setAttribute("height",1);xt.appendChild(St)}}else if(pt.textContent=ct[nt].val,pt.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),this.isMasked)this.innerElem.appendChild(pt);else{this.innerElem.appendChild(xt);var Zt=pt.style,nr="translate3d(0,"+-e.finalSize/1.2+"px,0)";Zt.transform=nr,Zt.webkitTransform=nr}this.isMasked?this.textSpans[It]=pt:this.textSpans[It]=xt,this.textSpans[It].style.display="block",this.textPaths[It]=pt,It+=1}for(;It<this.textSpans.length;)this.textSpans[It].style.display="none",It+=1},HTextElement.prototype.renderInnerContent=function(){this.validateText();var e;if(this.data.singleShape){if(!this._isFirstFrame&&!this.lettersChangedFlag)return;if(this.isMasked&&this.finalTransform._matMdf){this.svgElement.setAttribute("viewBox",-this.finalTransform.mProp.p.v[0]+" "+-this.finalTransform.mProp.p.v[1]+" "+this.compW+" "+this.compH),e=this.svgElement.style;var i="translate("+-this.finalTransform.mProp.p.v[0]+"px,"+-this.finalTransform.mProp.p.v[1]+"px)";e.transform=i,e.webkitTransform=i}}if(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),!(!this.lettersChangedFlag&&!this.textAnimator.lettersChangedFlag)){var s,a,b=0,et=this.textAnimator.renderedLetters,nt=this.textProperty.currentData.l;a=nt.length;var c,ct,pt;for(s=0;s<a;s+=1)nt[s].n?b+=1:(ct=this.textSpans[s],pt=this.textPaths[s],c=et[b],b+=1,c._mdf.m&&(this.isMasked?ct.setAttribute("transform",c.m):(ct.style.webkitTransform=c.m,ct.style.transform=c.m)),ct.style.opacity=c.o,c.sw&&c._mdf.sw&&pt.setAttribute("stroke-width",c.sw),c.sc&&c._mdf.sc&&pt.setAttribute("stroke",c.sc),c.fc&&c._mdf.fc&&(pt.setAttribute("fill",c.fc),pt.style.color=c.fc));if(this.innerElem.getBBox&&!this.hidden&&(this._isFirstFrame||this._mdf)){var xt=this.innerElem.getBBox();this.currentBBox.w!==xt.width&&(this.currentBBox.w=xt.width,this.svgElement.setAttribute("width",xt.width)),this.currentBBox.h!==xt.height&&(this.currentBBox.h=xt.height,this.svgElement.setAttribute("height",xt.height));var St=1;if(this.currentBBox.w!==xt.width+St*2||this.currentBBox.h!==xt.height+St*2||this.currentBBox.x!==xt.x-St||this.currentBBox.y!==xt.y-St){this.currentBBox.w=xt.width+St*2,this.currentBBox.h=xt.height+St*2,this.currentBBox.x=xt.x-St,this.currentBBox.y=xt.y-St,this.svgElement.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h),e=this.svgElement.style;var Et="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";e.transform=Et,e.webkitTransform=Et}}}};function HCameraElement(e,i,s){this.initFrame(),this.initBaseData(e,i,s),this.initHierarchy();var a=PropertyFactory.getProp;if(this.pe=a(this,e.pe,0,0,this),e.ks.p.s?(this.px=a(this,e.ks.p.x,1,0,this),this.py=a(this,e.ks.p.y,1,0,this),this.pz=a(this,e.ks.p.z,1,0,this)):this.p=a(this,e.ks.p,1,0,this),e.ks.a&&(this.a=a(this,e.ks.a,1,0,this)),e.ks.or.k.length&&e.ks.or.k[0].to){var b,et=e.ks.or.k.length;for(b=0;b<et;b+=1)e.ks.or.k[b].to=null,e.ks.or.k[b].ti=null}this.or=a(this,e.ks.or,1,degToRads,this),this.or.sh=!0,this.rx=a(this,e.ks.rx,0,degToRads,this),this.ry=a(this,e.ks.ry,0,degToRads,this),this.rz=a(this,e.ks.rz,0,degToRads,this),this.mat=new Matrix,this._prevMat=new Matrix,this._isFirstFrame=!0,this.finalTransform={mProp:this}}extendPrototype([BaseElement,FrameElement,HierarchyElement],HCameraElement),HCameraElement.prototype.setup=function(){var e,i=this.comp.threeDElements.length,s,a,b;for(e=0;e<i;e+=1)if(s=this.comp.threeDElements[e],s.type==="3d"){a=s.perspectiveElem.style,b=s.container.style;var et=this.pe.v+"px",nt="0px 0px 0px",c="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";a.perspective=et,a.webkitPerspective=et,b.transformOrigin=nt,b.mozTransformOrigin=nt,b.webkitTransformOrigin=nt,a.transform=c,a.webkitTransform=c}},HCameraElement.prototype.createElements=function(){},HCameraElement.prototype.hide=function(){},HCameraElement.prototype.renderFrame=function(){var e=this._isFirstFrame,i,s;if(this.hierarchy)for(s=this.hierarchy.length,i=0;i<s;i+=1)e=this.hierarchy[i].finalTransform.mProp._mdf||e;if(e||this.pe._mdf||this.p&&this.p._mdf||this.px&&(this.px._mdf||this.py._mdf||this.pz._mdf)||this.rx._mdf||this.ry._mdf||this.rz._mdf||this.or._mdf||this.a&&this.a._mdf){if(this.mat.reset(),this.hierarchy)for(s=this.hierarchy.length-1,i=s;i>=0;i-=1){var a=this.hierarchy[i].finalTransform.mProp;this.mat.translate(-a.p.v[0],-a.p.v[1],a.p.v[2]),this.mat.rotateX(-a.or.v[0]).rotateY(-a.or.v[1]).rotateZ(a.or.v[2]),this.mat.rotateX(-a.rx.v).rotateY(-a.ry.v).rotateZ(a.rz.v),this.mat.scale(1/a.s.v[0],1/a.s.v[1],1/a.s.v[2]),this.mat.translate(a.a.v[0],a.a.v[1],a.a.v[2])}if(this.p?this.mat.translate(-this.p.v[0],-this.p.v[1],this.p.v[2]):this.mat.translate(-this.px.v,-this.py.v,this.pz.v),this.a){var b;this.p?b=[this.p.v[0]-this.a.v[0],this.p.v[1]-this.a.v[1],this.p.v[2]-this.a.v[2]]:b=[this.px.v-this.a.v[0],this.py.v-this.a.v[1],this.pz.v-this.a.v[2]];var et=Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)),nt=[b[0]/et,b[1]/et,b[2]/et],c=Math.sqrt(nt[2]*nt[2]+nt[0]*nt[0]),ct=Math.atan2(nt[1],c),pt=Math.atan2(nt[0],-nt[2]);this.mat.rotateY(pt).rotateX(-ct)}this.mat.rotateX(-this.rx.v).rotateY(-this.ry.v).rotateZ(this.rz.v),this.mat.rotateX(-this.or.v[0]).rotateY(-this.or.v[1]).rotateZ(this.or.v[2]),this.mat.translate(this.globalData.compSize.w/2,this.globalData.compSize.h/2,0),this.mat.translate(0,0,this.pe.v);var xt=!this._prevMat.equals(this.mat);if((xt||this.pe._mdf)&&this.comp.threeDElements){s=this.comp.threeDElements.length;var St,Et,Rt;for(i=0;i<s;i+=1)if(St=this.comp.threeDElements[i],St.type==="3d"){if(xt){var Nt=this.mat.toCSS();Rt=St.container.style,Rt.transform=Nt,Rt.webkitTransform=Nt}this.pe._mdf&&(Et=St.perspectiveElem.style,Et.perspective=this.pe.v+"px",Et.webkitPerspective=this.pe.v+"px")}this.mat.clone(this._prevMat)}}this._isFirstFrame=!1},HCameraElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},HCameraElement.prototype.destroy=function(){},HCameraElement.prototype.getBaseElement=function(){return null};function HImageElement(e,i,s){this.assetData=i.getAssetData(e.refId),this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,HBaseElement,HSolidElement,HierarchyElement,FrameElement,RenderableElement],HImageElement),HImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData),i=new Image;this.data.hasMask?(this.imageElem=createNS("image"),this.imageElem.setAttribute("width",this.assetData.w+"px"),this.imageElem.setAttribute("height",this.assetData.h+"px"),this.imageElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.imageElem),this.baseElement.setAttribute("width",this.assetData.w),this.baseElement.setAttribute("height",this.assetData.h)):this.layerElement.appendChild(i),i.crossOrigin="anonymous",i.src=e,this.data.ln&&this.baseElement.setAttribute("id",this.data.ln)};function HybridRendererBase(e,i){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:i&&i.className||"",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(i&&i.hideOnTransparent===!1),filterSize:{width:i&&i.filterSize&&i.filterSize.width||"400%",height:i&&i.filterSize&&i.filterSize.height||"400%",x:i&&i.filterSize&&i.filterSize.x||"-100%",y:i&&i.filterSize&&i.filterSize.y||"-100%"}},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([BaseRenderer],HybridRendererBase),HybridRendererBase.prototype.buildItem=SVGRenderer.prototype.buildItem,HybridRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();e.checkParenting()}},HybridRendererBase.prototype.appendElementInPos=function(e,i){var s=e.getBaseElement();if(s){var a=this.layers[i];if(!a.ddd||!this.supports3d)if(this.threeDElements)this.addTo3dContainer(s,i);else{for(var b=0,et,nt,c;b<i;)this.elements[b]&&this.elements[b]!==!0&&this.elements[b].getBaseElement&&(nt=this.elements[b],c=this.layers[b].ddd?this.getThreeDContainerByPos(b):nt.getBaseElement(),et=c||et),b+=1;et?(!a.ddd||!this.supports3d)&&this.layerElement.insertBefore(s,et):(!a.ddd||!this.supports3d)&&this.layerElement.appendChild(s)}else this.addTo3dContainer(s,i)}},HybridRendererBase.prototype.createShape=function(e){return this.supports3d?new HShapeElement(e,this.globalData,this):new SVGShapeElement(e,this.globalData,this)},HybridRendererBase.prototype.createText=function(e){return this.supports3d?new HTextElement(e,this.globalData,this):new SVGTextLottieElement(e,this.globalData,this)},HybridRendererBase.prototype.createCamera=function(e){return this.camera=new HCameraElement(e,this.globalData,this),this.camera},HybridRendererBase.prototype.createImage=function(e){return this.supports3d?new HImageElement(e,this.globalData,this):new IImageElement(e,this.globalData,this)},HybridRendererBase.prototype.createSolid=function(e){return this.supports3d?new HSolidElement(e,this.globalData,this):new ISolidElement(e,this.globalData,this)},HybridRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,HybridRendererBase.prototype.getThreeDContainerByPos=function(e){for(var i=0,s=this.threeDElements.length;i<s;){if(this.threeDElements[i].startPos<=e&&this.threeDElements[i].endPos>=e)return this.threeDElements[i].perspectiveElem;i+=1}return null},HybridRendererBase.prototype.createThreeDContainer=function(e,i){var s=createTag("div"),a,b;styleDiv(s);var et=createTag("div");if(styleDiv(et),i==="3d"){a=s.style,a.width=this.globalData.compSize.w+"px",a.height=this.globalData.compSize.h+"px";var nt="50% 50%";a.webkitTransformOrigin=nt,a.mozTransformOrigin=nt,a.transformOrigin=nt,b=et.style;var c="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";b.transform=c,b.webkitTransform=c}s.appendChild(et);var ct={container:et,perspectiveElem:s,startPos:e,endPos:e,type:i};return this.threeDElements.push(ct),ct},HybridRendererBase.prototype.build3dContainers=function(){var e,i=this.layers.length,s,a="";for(e=0;e<i;e+=1)this.layers[e].ddd&&this.layers[e].ty!==3?(a!=="3d"&&(a="3d",s=this.createThreeDContainer(e,"3d")),s.endPos=Math.max(s.endPos,e)):(a!=="2d"&&(a="2d",s=this.createThreeDContainer(e,"2d")),s.endPos=Math.max(s.endPos,e));for(i=this.threeDElements.length,e=i-1;e>=0;e-=1)this.resizerElem.appendChild(this.threeDElements[e].perspectiveElem)},HybridRendererBase.prototype.addTo3dContainer=function(e,i){for(var s=0,a=this.threeDElements.length;s<a;){if(i<=this.threeDElements[s].endPos){for(var b=this.threeDElements[s].startPos,et;b<i;)this.elements[b]&&this.elements[b].getBaseElement&&(et=this.elements[b].getBaseElement()),b+=1;et?this.threeDElements[s].container.insertBefore(e,et):this.threeDElements[s].container.appendChild(e);break}s+=1}},HybridRendererBase.prototype.configAnimation=function(e){var i=createTag("div"),s=this.animationItem.wrapper,a=i.style;a.width=e.w+"px",a.height=e.h+"px",this.resizerElem=i,styleDiv(i),a.transformStyle="flat",a.mozTransformStyle="flat",a.webkitTransformStyle="flat",this.renderConfig.className&&i.setAttribute("class",this.renderConfig.className),s.appendChild(i),a.overflow="hidden";var b=createNS("svg");b.setAttribute("width","1"),b.setAttribute("height","1"),styleDiv(b),this.resizerElem.appendChild(b);var et=createNS("defs");b.appendChild(et),this.data=e,this.setupGlobalData(e,b),this.globalData.defs=et,this.layers=e.layers,this.layerElement=this.resizerElem,this.build3dContainers(),this.updateContainerSize()},HybridRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.animationItem.container=null,this.globalData.defs=null;var e,i=this.layers?this.layers.length:0;for(e=0;e<i;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},HybridRendererBase.prototype.updateContainerSize=function(){var e=this.animationItem.wrapper.offsetWidth,i=this.animationItem.wrapper.offsetHeight,s=e/i,a=this.globalData.compSize.w/this.globalData.compSize.h,b,et,nt,c;a>s?(b=e/this.globalData.compSize.w,et=e/this.globalData.compSize.w,nt=0,c=(i-this.globalData.compSize.h*(e/this.globalData.compSize.w))/2):(b=i/this.globalData.compSize.h,et=i/this.globalData.compSize.h,nt=(e-this.globalData.compSize.w*(i/this.globalData.compSize.h))/2,c=0);var ct=this.resizerElem.style;ct.webkitTransform="matrix3d("+b+",0,0,0,0,"+et+",0,0,0,0,1,0,"+nt+","+c+",0,1)",ct.transform=ct.webkitTransform},HybridRendererBase.prototype.renderFrame=SVGRenderer.prototype.renderFrame,HybridRendererBase.prototype.hide=function(){this.resizerElem.style.display="none"},HybridRendererBase.prototype.show=function(){this.resizerElem.style.display="block"},HybridRendererBase.prototype.initItems=function(){if(this.buildAllItems(),this.camera)this.camera.setup();else{var e=this.globalData.compSize.w,i=this.globalData.compSize.h,s,a=this.threeDElements.length;for(s=0;s<a;s+=1){var b=this.threeDElements[s].perspectiveElem.style;b.webkitPerspective=Math.sqrt(Math.pow(e,2)+Math.pow(i,2))+"px",b.perspective=b.webkitPerspective}}},HybridRendererBase.prototype.searchExtraCompositions=function(e){var i,s=e.length,a=createTag("div");for(i=0;i<s;i+=1)if(e[i].xt){var b=this.createComp(e[i],a,this.globalData.comp,null);b.initExpressions(),this.globalData.projectInterface.registerComposition(b)}};function HCompElement(e,i,s){this.layers=e.layers,this.supports3d=!e.hasMask,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,i,s),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0}}extendPrototype([HybridRendererBase,ICompElement,HBaseElement],HCompElement),HCompElement.prototype._createBaseContainerElements=HCompElement.prototype.createContainerElements,HCompElement.prototype.createContainerElements=function(){this._createBaseContainerElements(),this.data.hasMask?(this.svgElement.setAttribute("width",this.data.w),this.svgElement.setAttribute("height",this.data.h),this.transformedElement=this.baseElement):this.transformedElement=this.layerElement},HCompElement.prototype.addTo3dContainer=function(e,i){for(var s=0,a;s<i;)this.elements[s]&&this.elements[s].getBaseElement&&(a=this.elements[s].getBaseElement()),s+=1;a?this.layerElement.insertBefore(e,a):this.layerElement.appendChild(e)},HCompElement.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)};function HybridRenderer(e,i){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:i&&i.className||"",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(i&&i.hideOnTransparent===!1),filterSize:{width:i&&i.filterSize&&i.filterSize.width||"400%",height:i&&i.filterSize&&i.filterSize.height||"400%",x:i&&i.filterSize&&i.filterSize.x||"-100%",y:i&&i.filterSize&&i.filterSize.y||"-100%"},runExpressions:!i||i.runExpressions===void 0||i.runExpressions},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([HybridRendererBase],HybridRenderer),HybridRenderer.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)};var CompExpressionInterface=function(){return function(e){function i(s){for(var a=0,b=e.layers.length;a<b;){if(e.layers[a].nm===s||e.layers[a].ind===s)return e.elements[a].layerInterface;a+=1}return null}return Object.defineProperty(i,"_name",{value:e.data.nm}),i.layer=i,i.pixelAspect=1,i.height=e.data.h||e.globalData.compSize.h,i.width=e.data.w||e.globalData.compSize.w,i.pixelAspect=1,i.frameDuration=1/e.globalData.frameRate,i.displayStartTime=0,i.numLayers=e.layers.length,i}}();function _typeof$2(e){"@babel/helpers - typeof";return _typeof$2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$2(e)}function seedRandom(e,i){var s=this,a=256,b=6,et=52,nt="random",c=i.pow(a,b),ct=i.pow(2,et),pt=ct*2,xt=a-1,St;function Et(Lt,Vt,Zt){var nr=[];Vt=Vt===!0?{entropy:!0}:Vt||{};var ur=Gt(It(Vt.entropy?[Lt,Bt(e)]:Lt===null?Dt():Lt,3),nr),_r=new Rt(nr),Ur=function(){for(var an=_r.g(b),Fr=c,rn=0;an<ct;)an=(an+rn)*a,Fr*=a,rn=_r.g(1);for(;an>=pt;)an/=2,Fr/=2,rn>>>=1;return(an+rn)/Fr};return Ur.int32=function(){return _r.g(4)|0},Ur.quick=function(){return _r.g(4)/4294967296},Ur.double=Ur,Gt(Bt(_r.S),e),(Vt.pass||Zt||function(ln,an,Fr,rn){return rn&&(rn.S&&Nt(rn,_r),ln.state=function(){return Nt(_r,{})}),Fr?(i[nt]=ln,an):ln})(Ur,ur,"global"in Vt?Vt.global:this==i,Vt.state)}i["seed"+nt]=Et;function Rt(Lt){var Vt,Zt=Lt.length,nr=this,ur=0,_r=nr.i=nr.j=0,Ur=nr.S=[];for(Zt||(Lt=[Zt++]);ur<a;)Ur[ur]=ur++;for(ur=0;ur<a;ur++)Ur[ur]=Ur[_r=xt&_r+Lt[ur%Zt]+(Vt=Ur[ur])],Ur[_r]=Vt;nr.g=function(ln){for(var an,Fr=0,rn=nr.i,gn=nr.j,_i=nr.S;ln--;)an=_i[rn=xt&rn+1],Fr=Fr*a+_i[xt&(_i[rn]=_i[gn=xt&gn+an])+(_i[gn]=an)];return nr.i=rn,nr.j=gn,Fr}}function Nt(Lt,Vt){return Vt.i=Lt.i,Vt.j=Lt.j,Vt.S=Lt.S.slice(),Vt}function It(Lt,Vt){var Zt=[],nr=_typeof$2(Lt),ur;if(Vt&&nr=="object")for(ur in Lt)try{Zt.push(It(Lt[ur],Vt-1))}catch{}return Zt.length?Zt:nr=="string"?Lt:Lt+"\0"}function Gt(Lt,Vt){for(var Zt=Lt+"",nr,ur=0;ur<Zt.length;)Vt[xt&ur]=xt&(nr^=Vt[xt&ur]*19)+Zt.charCodeAt(ur++);return Bt(Vt)}function Dt(){try{var Lt=new Uint8Array(a);return(s.crypto||s.msCrypto).getRandomValues(Lt),Bt(Lt)}catch{var Vt=s.navigator,Zt=Vt&&Vt.plugins;return[+new Date,s,Zt,s.screen,Bt(e)]}}function Bt(Lt){return String.fromCharCode.apply(0,Lt)}Gt(i.random(),e)}function initialize$2(e){seedRandom([],e)}var propTypes={SHAPE:"shape"};function _typeof$1(e){"@babel/helpers - typeof";return _typeof$1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$1(e)}var ExpressionManager=function(){var ob={},Math=BMMath,window=null,document=null,XMLHttpRequest=null,fetch=null,frames=null,_lottieGlobal={};initialize$2(BMMath);function resetFrame(){_lottieGlobal={}}function $bm_isInstanceOfArray(e){return e.constructor===Array||e.constructor===Float32Array}function isNumerable(e,i){return e==="number"||i instanceof Number||e==="boolean"||e==="string"}function $bm_neg(e){var i=_typeof$1(e);if(i==="number"||e instanceof Number||i==="boolean")return-e;if($bm_isInstanceOfArray(e)){var s,a=e.length,b=[];for(s=0;s<a;s+=1)b[s]=-e[s];return b}return e.propType?e.v:-e}var easeInBez=BezierFactory.getBezierEasing(.333,0,.833,.833,"easeIn").get,easeOutBez=BezierFactory.getBezierEasing(.167,.167,.667,1,"easeOut").get,easeInOutBez=BezierFactory.getBezierEasing(.33,0,.667,1,"easeInOut").get;function sum(e,i){var s=_typeof$1(e),a=_typeof$1(i);if(isNumerable(s,e)&&isNumerable(a,i)||s==="string"||a==="string")return e+i;if($bm_isInstanceOfArray(e)&&isNumerable(a,i))return e=e.slice(0),e[0]+=i,e;if(isNumerable(s,e)&&$bm_isInstanceOfArray(i))return i=i.slice(0),i[0]=e+i[0],i;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(i)){for(var b=0,et=e.length,nt=i.length,c=[];b<et||b<nt;)(typeof e[b]=="number"||e[b]instanceof Number)&&(typeof i[b]=="number"||i[b]instanceof Number)?c[b]=e[b]+i[b]:c[b]=i[b]===void 0?e[b]:e[b]||i[b],b+=1;return c}return 0}var add=sum;function sub(e,i){var s=_typeof$1(e),a=_typeof$1(i);if(isNumerable(s,e)&&isNumerable(a,i))return s==="string"&&(e=parseInt(e,10)),a==="string"&&(i=parseInt(i,10)),e-i;if($bm_isInstanceOfArray(e)&&isNumerable(a,i))return e=e.slice(0),e[0]-=i,e;if(isNumerable(s,e)&&$bm_isInstanceOfArray(i))return i=i.slice(0),i[0]=e-i[0],i;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(i)){for(var b=0,et=e.length,nt=i.length,c=[];b<et||b<nt;)(typeof e[b]=="number"||e[b]instanceof Number)&&(typeof i[b]=="number"||i[b]instanceof Number)?c[b]=e[b]-i[b]:c[b]=i[b]===void 0?e[b]:e[b]||i[b],b+=1;return c}return 0}function mul(e,i){var s=_typeof$1(e),a=_typeof$1(i),b;if(isNumerable(s,e)&&isNumerable(a,i))return e*i;var et,nt;if($bm_isInstanceOfArray(e)&&isNumerable(a,i)){for(nt=e.length,b=createTypedArray("float32",nt),et=0;et<nt;et+=1)b[et]=e[et]*i;return b}if(isNumerable(s,e)&&$bm_isInstanceOfArray(i)){for(nt=i.length,b=createTypedArray("float32",nt),et=0;et<nt;et+=1)b[et]=e*i[et];return b}return 0}function div(e,i){var s=_typeof$1(e),a=_typeof$1(i),b;if(isNumerable(s,e)&&isNumerable(a,i))return e/i;var et,nt;if($bm_isInstanceOfArray(e)&&isNumerable(a,i)){for(nt=e.length,b=createTypedArray("float32",nt),et=0;et<nt;et+=1)b[et]=e[et]/i;return b}if(isNumerable(s,e)&&$bm_isInstanceOfArray(i)){for(nt=i.length,b=createTypedArray("float32",nt),et=0;et<nt;et+=1)b[et]=e/i[et];return b}return 0}function mod(e,i){return typeof e=="string"&&(e=parseInt(e,10)),typeof i=="string"&&(i=parseInt(i,10)),e%i}var $bm_sum=sum,$bm_sub=sub,$bm_mul=mul,$bm_div=div,$bm_mod=mod;function clamp(e,i,s){if(i>s){var a=s;s=i,i=a}return Math.min(Math.max(e,i),s)}function radiansToDegrees(e){return e/degToRads}var radians_to_degrees=radiansToDegrees;function degreesToRadians(e){return e*degToRads}var degrees_to_radians=radiansToDegrees,helperLengthArray=[0,0,0,0,0,0];function length(e,i){if(typeof e=="number"||e instanceof Number)return i=i||0,Math.abs(e-i);i||(i=helperLengthArray);var s,a=Math.min(e.length,i.length),b=0;for(s=0;s<a;s+=1)b+=Math.pow(i[s]-e[s],2);return Math.sqrt(b)}function normalize(e){return div(e,length(e))}function rgbToHsl(e){var i=e[0],s=e[1],a=e[2],b=Math.max(i,s,a),et=Math.min(i,s,a),nt,c,ct=(b+et)/2;if(b===et)nt=0,c=0;else{var pt=b-et;switch(c=ct>.5?pt/(2-b-et):pt/(b+et),b){case i:nt=(s-a)/pt+(s<a?6:0);break;case s:nt=(a-i)/pt+2;break;case a:nt=(i-s)/pt+4;break}nt/=6}return[nt,c,ct,e[3]]}function hue2rgb(e,i,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+(i-e)*6*s:s<1/2?i:s<2/3?e+(i-e)*(2/3-s)*6:e}function hslToRgb(e){var i=e[0],s=e[1],a=e[2],b,et,nt;if(s===0)b=a,nt=a,et=a;else{var c=a<.5?a*(1+s):a+s-a*s,ct=2*a-c;b=hue2rgb(ct,c,i+1/3),et=hue2rgb(ct,c,i),nt=hue2rgb(ct,c,i-1/3)}return[b,et,nt,e[3]]}function linear(e,i,s,a,b){if((a===void 0||b===void 0)&&(a=i,b=s,i=0,s=1),s<i){var et=s;s=i,i=et}if(e<=i)return a;if(e>=s)return b;var nt=s===i?0:(e-i)/(s-i);if(!a.length)return a+(b-a)*nt;var c,ct=a.length,pt=createTypedArray("float32",ct);for(c=0;c<ct;c+=1)pt[c]=a[c]+(b[c]-a[c])*nt;return pt}function random(e,i){if(i===void 0&&(e===void 0?(e=0,i=1):(i=e,e=void 0)),i.length){var s,a=i.length;e||(e=createTypedArray("float32",a));var b=createTypedArray("float32",a),et=BMMath.random();for(s=0;s<a;s+=1)b[s]=e[s]+et*(i[s]-e[s]);return b}e===void 0&&(e=0);var nt=BMMath.random();return e+nt*(i-e)}function createPath(e,i,s,a){var b,et=e.length,nt=shapePool.newElement();nt.setPathData(!!a,et);var c=[0,0],ct,pt;for(b=0;b<et;b+=1)ct=i&&i[b]?i[b]:c,pt=s&&s[b]?s[b]:c,nt.setTripleAt(e[b][0],e[b][1],pt[0]+e[b][0],pt[1]+e[b][1],ct[0]+e[b][0],ct[1]+e[b][1],b,!0);return nt}function initiateExpression(elem,data,property){function noOp(e){return e}if(!elem.globalData.renderConfig.runExpressions)return noOp;var val=data.x,needsVelocity=/velocity(?![\w\d])/.test(val),_needsRandom=val.indexOf("random")!==-1,elemType=elem.data.ty,transform,$bm_transform,content,effect,thisProperty=property;thisProperty._name=elem.data.nm,thisProperty.valueAtTime=thisProperty.getValueAtTime,Object.defineProperty(thisProperty,"value",{get:function(){return thisProperty.v}}),elem.comp.frameDuration=1/elem.comp.globalData.frameRate,elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate,outPoint=elem.data.op/elem.comp.globalData.frameRate,width=elem.data.sw?elem.data.sw:0,height=elem.data.sh?elem.data.sh:0,name=elem.data.nm,loopIn,loop_in,loopOut,loop_out,smooth,toWorld,fromWorld,fromComp,toComp,fromCompToSurface,position,rotation,anchorPoint,scale,thisLayer,thisComp,mask,valueAtTime,velocityAtTime,scoped_bm_rt,expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}]")[0],numKeys=property.kf?data.k.length:0,active=!this.data||this.data.hd!==!0,wiggle=(function e(i,s){var a,b,et=this.pv.length?this.pv.length:1,nt=createTypedArray("float32",et);i=5;var c=Math.floor(time*i);for(a=0,b=0;a<c;){for(b=0;b<et;b+=1)nt[b]+=-s+s*2*BMMath.random();a+=1}var ct=time*i,pt=ct-Math.floor(ct),xt=createTypedArray("float32",et);if(et>1){for(b=0;b<et;b+=1)xt[b]=this.pv[b]+nt[b]+(-s+s*2*BMMath.random())*pt;return xt}return this.pv+nt[0]+(-s+s*2*BMMath.random())*pt}).bind(this);thisProperty.loopIn&&(loopIn=thisProperty.loopIn.bind(thisProperty),loop_in=loopIn),thisProperty.loopOut&&(loopOut=thisProperty.loopOut.bind(thisProperty),loop_out=loopOut),thisProperty.smooth&&(smooth=thisProperty.smooth.bind(thisProperty));function loopInDuration(e,i){return loopIn(e,i,!0)}function loopOutDuration(e,i){return loopOut(e,i,!0)}this.getValueAtTime&&(valueAtTime=this.getValueAtTime.bind(this)),this.getVelocityAtTime&&(velocityAtTime=this.getVelocityAtTime.bind(this));var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface);function lookAt(e,i){var s=[i[0]-e[0],i[1]-e[1],i[2]-e[2]],a=Math.atan2(s[0],Math.sqrt(s[1]*s[1]+s[2]*s[2]))/degToRads,b=-Math.atan2(s[1],s[2])/degToRads;return[b,a,0]}function easeOut(e,i,s,a,b){return applyEase(easeOutBez,e,i,s,a,b)}function easeIn(e,i,s,a,b){return applyEase(easeInBez,e,i,s,a,b)}function ease(e,i,s,a,b){return applyEase(easeInOutBez,e,i,s,a,b)}function applyEase(e,i,s,a,b,et){b===void 0?(b=s,et=a):i=(i-s)/(a-s),i>1?i=1:i<0&&(i=0);var nt=e(i);if($bm_isInstanceOfArray(b)){var c,ct=b.length,pt=createTypedArray("float32",ct);for(c=0;c<ct;c+=1)pt[c]=(et[c]-b[c])*nt+b[c];return pt}return(et-b)*nt+b}function nearestKey(e){var i,s=data.k.length,a,b;if(!data.k.length||typeof data.k[0]=="number")a=0,b=0;else if(a=-1,e*=elem.comp.globalData.frameRate,e<data.k[0].t)a=1,b=data.k[0].t;else{for(i=0;i<s-1;i+=1)if(e===data.k[i].t){a=i+1,b=data.k[i].t;break}else if(e>data.k[i].t&&e<data.k[i+1].t){e-data.k[i].t>data.k[i+1].t-e?(a=i+2,b=data.k[i+1].t):(a=i+1,b=data.k[i].t);break}a===-1&&(a=i+1,b=data.k[i].t)}var et={};return et.index=a,et.time=b/elem.comp.globalData.frameRate,et}function key(e){var i,s,a;if(!data.k.length||typeof data.k[0]=="number")throw new Error("The property has no keyframe at index "+e);e-=1,i={time:data.k[e].t/elem.comp.globalData.frameRate,value:[]};var b=Object.prototype.hasOwnProperty.call(data.k[e],"s")?data.k[e].s:data.k[e-1].e;for(a=b.length,s=0;s<a;s+=1)i[s]=b[s],i.value[s]=b[s];return i}function framesToTime(e,i){return i||(i=elem.comp.globalData.frameRate),e/i}function timeToFrames(e,i){return!e&&e!==0&&(e=time),i||(i=elem.comp.globalData.frameRate),e*i}function seedRandom(e){BMMath.seedrandom(randSeed+e)}function sourceRectAtTime(){return elem.sourceRectAtTime()}function substring(e,i){return typeof value=="string"?i===void 0?value.substring(e):value.substring(e,i):""}function substr(e,i){return typeof value=="string"?i===void 0?value.substr(e):value.substr(e,i):""}function posterizeTime(e){time=e===0?0:Math.floor(time*e)/e,value=valueAtTime(time)}var time,velocity,value,text,textIndex,textTotal,selectorValue,index=elem.data.ind,hasParent=!!(elem.hierarchy&&elem.hierarchy.length),parent,randSeed=Math.floor(Math.random()*1e6),globalData=elem.globalData;function executeExpression(e){return value=e,this.frameExpressionId===elem.globalData.frameId&&this.propType!=="textSelector"?value:(this.propType==="textSelector"&&(textIndex=this.textIndex,textTotal=this.textTotal,selectorValue=this.selectorValue),thisLayer||(text=elem.layerInterface.text,thisLayer=elem.layerInterface,thisComp=elem.comp.compInterface,toWorld=thisLayer.toWorld.bind(thisLayer),fromWorld=thisLayer.fromWorld.bind(thisLayer),fromComp=thisLayer.fromComp.bind(thisLayer),toComp=thisLayer.toComp.bind(thisLayer),mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null,fromCompToSurface=fromComp),transform||(transform=elem.layerInterface("ADBE Transform Group"),$bm_transform=transform,transform&&(anchorPoint=transform.anchorPoint)),elemType===4&&!content&&(content=thisLayer("ADBE Root Vectors Group")),effect||(effect=thisLayer(4)),hasParent=!!(elem.hierarchy&&elem.hierarchy.length),hasParent&&!parent&&(parent=elem.hierarchy[0].layerInterface),time=this.comp.renderedFrame/this.comp.globalData.frameRate,_needsRandom&&seedRandom(randSeed+time),needsVelocity&&(velocity=velocityAtTime(time)),expression_function(),this.frameExpressionId=elem.globalData.frameId,scoped_bm_rt=scoped_bm_rt.propType===propTypes.SHAPE?scoped_bm_rt.v:scoped_bm_rt,scoped_bm_rt)}return executeExpression.__preventDeadCodeRemoval=[$bm_transform,anchorPoint,time,velocity,inPoint,outPoint,width,height,name,loop_in,loop_out,smooth,toComp,fromCompToSurface,toWorld,fromWorld,mask,position,rotation,scale,thisComp,numKeys,active,wiggle,loopInDuration,loopOutDuration,comp,lookAt,easeOut,easeIn,ease,nearestKey,key,text,textIndex,textTotal,selectorValue,framesToTime,timeToFrames,sourceRectAtTime,substring,substr,posterizeTime,index,globalData],executeExpression}return ob.initiateExpression=initiateExpression,ob.__preventDeadCodeRemoval=[window,document,XMLHttpRequest,fetch,frames,$bm_neg,add,$bm_sum,$bm_sub,$bm_mul,$bm_div,$bm_mod,clamp,radians_to_degrees,degreesToRadians,degrees_to_radians,normalize,rgbToHsl,hslToRgb,linear,random,createPath,_lottieGlobal],ob.resetFrame=resetFrame,ob}(),Expressions=function(){var e={};e.initExpressions=i,e.resetFrame=ExpressionManager.resetFrame;function i(s){var a=0,b=[];function et(){a+=1}function nt(){a-=1,a===0&&ct()}function c(pt){b.indexOf(pt)===-1&&b.push(pt)}function ct(){var pt,xt=b.length;for(pt=0;pt<xt;pt+=1)b[pt].release();b.length=0}s.renderer.compInterface=CompExpressionInterface(s.renderer),s.renderer.globalData.projectInterface.registerComposition(s.renderer),s.renderer.globalData.pushExpression=et,s.renderer.globalData.popExpression=nt,s.renderer.globalData.registerExpressionProperty=c}return e}(),MaskManagerInterface=function(){function e(s,a){this._mask=s,this._data=a}Object.defineProperty(e.prototype,"maskPath",{get:function(){return this._mask.prop.k&&this._mask.prop.getValue(),this._mask.prop}}),Object.defineProperty(e.prototype,"maskOpacity",{get:function(){return this._mask.op.k&&this._mask.op.getValue(),this._mask.op.v*100}});var i=function(a){var b=createSizedArray(a.viewData.length),et,nt=a.viewData.length;for(et=0;et<nt;et+=1)b[et]=new e(a.viewData[et],a.masksProperties[et]);var c=function(pt){for(et=0;et<nt;){if(a.masksProperties[et].nm===pt)return b[et];et+=1}return null};return c};return i}(),ExpressionPropertyInterface=function(){var e={pv:0,v:0,mult:1},i={pv:[0,0,0],v:[0,0,0],mult:1};function s(nt,c,ct){Object.defineProperty(nt,"velocity",{get:function(){return c.getVelocityAtTime(c.comp.currentFrame)}}),nt.numKeys=c.keyframes?c.keyframes.length:0,nt.key=function(pt){if(!nt.numKeys)return 0;var xt="";"s"in c.keyframes[pt-1]?xt=c.keyframes[pt-1].s:"e"in c.keyframes[pt-2]?xt=c.keyframes[pt-2].e:xt=c.keyframes[pt-2].s;var St=ct==="unidimensional"?new Number(xt):Object.assign({},xt);return St.time=c.keyframes[pt-1].t/c.elem.comp.globalData.frameRate,St.value=ct==="unidimensional"?xt[0]:xt,St},nt.valueAtTime=c.getValueAtTime,nt.speedAtTime=c.getSpeedAtTime,nt.velocityAtTime=c.getVelocityAtTime,nt.propertyGroup=c.propertyGroup}function a(nt){(!nt||!("pv"in nt))&&(nt=e);var c=1/nt.mult,ct=nt.pv*c,pt=new Number(ct);return pt.value=ct,s(pt,nt,"unidimensional"),function(){return nt.k&&nt.getValue(),ct=nt.v*c,pt.value!==ct&&(pt=new Number(ct),pt.value=ct,pt[0]=ct,s(pt,nt,"unidimensional")),pt}}function b(nt){(!nt||!("pv"in nt))&&(nt=i);var c=1/nt.mult,ct=nt.data&&nt.data.l||nt.pv.length,pt=createTypedArray("float32",ct),xt=createTypedArray("float32",ct);return pt.value=xt,s(pt,nt,"multidimensional"),function(){nt.k&&nt.getValue();for(var St=0;St<ct;St+=1)xt[St]=nt.v[St]*c,pt[St]=xt[St];return pt}}function et(){return e}return function(nt){return nt?nt.propType==="unidimensional"?a(nt):b(nt):et}}(),TransformExpressionInterface=function(){return function(e){function i(nt){switch(nt){case"scale":case"Scale":case"ADBE Scale":case 6:return i.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return i.rotation;case"ADBE Rotate X":return i.xRotation;case"ADBE Rotate Y":return i.yRotation;case"position":case"Position":case"ADBE Position":case 2:return i.position;case"ADBE Position_0":return i.xPosition;case"ADBE Position_1":return i.yPosition;case"ADBE Position_2":return i.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return i.anchorPoint;case"opacity":case"Opacity":case 11:return i.opacity;default:return null}}Object.defineProperty(i,"rotation",{get:ExpressionPropertyInterface(e.r||e.rz)}),Object.defineProperty(i,"zRotation",{get:ExpressionPropertyInterface(e.rz||e.r)}),Object.defineProperty(i,"xRotation",{get:ExpressionPropertyInterface(e.rx)}),Object.defineProperty(i,"yRotation",{get:ExpressionPropertyInterface(e.ry)}),Object.defineProperty(i,"scale",{get:ExpressionPropertyInterface(e.s)});var s,a,b,et;return e.p?et=ExpressionPropertyInterface(e.p):(s=ExpressionPropertyInterface(e.px),a=ExpressionPropertyInterface(e.py),e.pz&&(b=ExpressionPropertyInterface(e.pz))),Object.defineProperty(i,"position",{get:function(){return e.p?et():[s(),a(),b?b():0]}}),Object.defineProperty(i,"xPosition",{get:ExpressionPropertyInterface(e.px)}),Object.defineProperty(i,"yPosition",{get:ExpressionPropertyInterface(e.py)}),Object.defineProperty(i,"zPosition",{get:ExpressionPropertyInterface(e.pz)}),Object.defineProperty(i,"anchorPoint",{get:ExpressionPropertyInterface(e.a)}),Object.defineProperty(i,"opacity",{get:ExpressionPropertyInterface(e.o)}),Object.defineProperty(i,"skew",{get:ExpressionPropertyInterface(e.sk)}),Object.defineProperty(i,"skewAxis",{get:ExpressionPropertyInterface(e.sa)}),Object.defineProperty(i,"orientation",{get:ExpressionPropertyInterface(e.or)}),i}}(),LayerExpressionInterface=function(){function e(pt){var xt=new Matrix;if(pt!==void 0){var St=this._elem.finalTransform.mProp.getValueAtTime(pt);St.clone(xt)}else{var Et=this._elem.finalTransform.mProp;Et.applyToMatrix(xt)}return xt}function i(pt,xt){var St=this.getMatrix(xt);return St.props[12]=0,St.props[13]=0,St.props[14]=0,this.applyPoint(St,pt)}function s(pt,xt){var St=this.getMatrix(xt);return this.applyPoint(St,pt)}function a(pt,xt){var St=this.getMatrix(xt);return St.props[12]=0,St.props[13]=0,St.props[14]=0,this.invertPoint(St,pt)}function b(pt,xt){var St=this.getMatrix(xt);return this.invertPoint(St,pt)}function et(pt,xt){if(this._elem.hierarchy&&this._elem.hierarchy.length){var St,Et=this._elem.hierarchy.length;for(St=0;St<Et;St+=1)this._elem.hierarchy[St].finalTransform.mProp.applyToMatrix(pt)}return pt.applyToPointArray(xt[0],xt[1],xt[2]||0)}function nt(pt,xt){if(this._elem.hierarchy&&this._elem.hierarchy.length){var St,Et=this._elem.hierarchy.length;for(St=0;St<Et;St+=1)this._elem.hierarchy[St].finalTransform.mProp.applyToMatrix(pt)}return pt.inversePoint(xt)}function c(pt){var xt=new Matrix;if(xt.reset(),this._elem.finalTransform.mProp.applyToMatrix(xt),this._elem.hierarchy&&this._elem.hierarchy.length){var St,Et=this._elem.hierarchy.length;for(St=0;St<Et;St+=1)this._elem.hierarchy[St].finalTransform.mProp.applyToMatrix(xt);return xt.inversePoint(pt)}return xt.inversePoint(pt)}function ct(){return[1,1,1,1]}return function(pt){var xt;function St(It){Rt.mask=new MaskManagerInterface(It,pt)}function Et(It){Rt.effect=It}function Rt(It){switch(It){case"ADBE Root Vectors Group":case"Contents":case 2:return Rt.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return xt;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return Rt.effect;case"ADBE Text Properties":return Rt.textInterface;default:return null}}Rt.getMatrix=e,Rt.invertPoint=nt,Rt.applyPoint=et,Rt.toWorld=s,Rt.toWorldVec=i,Rt.fromWorld=b,Rt.fromWorldVec=a,Rt.toComp=s,Rt.fromComp=c,Rt.sampleImage=ct,Rt.sourceRectAtTime=pt.sourceRectAtTime.bind(pt),Rt._elem=pt,xt=TransformExpressionInterface(pt.finalTransform.mProp);var Nt=getDescriptor(xt,"anchorPoint");return Object.defineProperties(Rt,{hasParent:{get:function(){return pt.hierarchy.length}},parent:{get:function(){return pt.hierarchy[0].layerInterface}},rotation:getDescriptor(xt,"rotation"),scale:getDescriptor(xt,"scale"),position:getDescriptor(xt,"position"),opacity:getDescriptor(xt,"opacity"),anchorPoint:Nt,anchor_point:Nt,transform:{get:function(){return xt}},active:{get:function(){return pt.isInRange}}}),Rt.startTime=pt.data.st,Rt.index=pt.data.ind,Rt.source=pt.data.refId,Rt.height=pt.data.ty===0?pt.data.h:100,Rt.width=pt.data.ty===0?pt.data.w:100,Rt.inPoint=pt.data.ip/pt.comp.globalData.frameRate,Rt.outPoint=pt.data.op/pt.comp.globalData.frameRate,Rt._name=pt.data.nm,Rt.registerMaskInterface=St,Rt.registerEffectsInterface=Et,Rt}}(),propertyGroupFactory=function(){return function(e,i){return function(s){return s=s===void 0?1:s,s<=0?e:i(s-1)}}}(),PropertyInterface=function(){return function(e,i){var s={_name:e};function a(b){return b=b===void 0?1:b,b<=0?s:i(b-1)}return a}}(),EffectsExpressionInterface=function(){var e={createEffectsInterface:i};function i(b,et){if(b.effectsManager){var nt=[],c=b.data.ef,ct,pt=b.effectsManager.effectElements.length;for(ct=0;ct<pt;ct+=1)nt.push(s(c[ct],b.effectsManager.effectElements[ct],et,b));var xt=b.data.ef||[],St=function(Rt){for(ct=0,pt=xt.length;ct<pt;){if(Rt===xt[ct].nm||Rt===xt[ct].mn||Rt===xt[ct].ix)return nt[ct];ct+=1}return null};return Object.defineProperty(St,"numProperties",{get:function(){return xt.length}}),St}return null}function s(b,et,nt,c){function ct(Rt){for(var Nt=b.ef,It=0,Gt=Nt.length;It<Gt;){if(Rt===Nt[It].nm||Rt===Nt[It].mn||Rt===Nt[It].ix)return Nt[It].ty===5?xt[It]:xt[It]();It+=1}throw new Error}var pt=propertyGroupFactory(ct,nt),xt=[],St,Et=b.ef.length;for(St=0;St<Et;St+=1)b.ef[St].ty===5?xt.push(s(b.ef[St],et.effectElements[St],et.effectElements[St].propertyGroup,c)):xt.push(a(et.effectElements[St],b.ef[St].ty,c,pt));return b.mn==="ADBE Color Control"&&Object.defineProperty(ct,"color",{get:function(){return xt[0]()}}),Object.defineProperties(ct,{numProperties:{get:function(){return b.np}},_name:{value:b.nm},propertyGroup:{value:pt}}),ct.enabled=b.en!==0,ct.active=ct.enabled,ct}function a(b,et,nt,c){var ct=ExpressionPropertyInterface(b.p);function pt(){return et===10?nt.comp.compInterface(b.p.v):ct()}return b.p.setGroupProperty&&b.p.setGroupProperty(PropertyInterface("",c)),pt}return e}(),ShapePathInterface=function(){return function(i,s,a){var b=s.sh;function et(c){return c==="Shape"||c==="shape"||c==="Path"||c==="path"||c==="ADBE Vector Shape"||c===2?et.path:null}var nt=propertyGroupFactory(et,a);return b.setGroupProperty(PropertyInterface("Path",nt)),Object.defineProperties(et,{path:{get:function(){return b.k&&b.getValue(),b}},shape:{get:function(){return b.k&&b.getValue(),b}},_name:{value:i.nm},ix:{value:i.ix},propertyIndex:{value:i.ix},mn:{value:i.mn},propertyGroup:{value:a}}),et}}(),ShapeExpressionInterface=function(){function e(Nt,It,Gt){var Dt=[],Bt,Lt=Nt?Nt.length:0;for(Bt=0;Bt<Lt;Bt+=1)Nt[Bt].ty==="gr"?Dt.push(s(Nt[Bt],It[Bt],Gt)):Nt[Bt].ty==="fl"?Dt.push(a(Nt[Bt],It[Bt],Gt)):Nt[Bt].ty==="st"?Dt.push(nt(Nt[Bt],It[Bt],Gt)):Nt[Bt].ty==="tm"?Dt.push(c(Nt[Bt],It[Bt],Gt)):Nt[Bt].ty==="tr"||(Nt[Bt].ty==="el"?Dt.push(pt(Nt[Bt],It[Bt],Gt)):Nt[Bt].ty==="sr"?Dt.push(xt(Nt[Bt],It[Bt],Gt)):Nt[Bt].ty==="sh"?Dt.push(ShapePathInterface(Nt[Bt],It[Bt],Gt)):Nt[Bt].ty==="rc"?Dt.push(St(Nt[Bt],It[Bt],Gt)):Nt[Bt].ty==="rd"?Dt.push(Et(Nt[Bt],It[Bt],Gt)):Nt[Bt].ty==="rp"?Dt.push(Rt(Nt[Bt],It[Bt],Gt)):Nt[Bt].ty==="gf"?Dt.push(b(Nt[Bt],It[Bt],Gt)):Dt.push(et(Nt[Bt],It[Bt])));return Dt}function i(Nt,It,Gt){var Dt,Bt=function(Zt){for(var nr=0,ur=Dt.length;nr<ur;){if(Dt[nr]._name===Zt||Dt[nr].mn===Zt||Dt[nr].propertyIndex===Zt||Dt[nr].ix===Zt||Dt[nr].ind===Zt)return Dt[nr];nr+=1}return typeof Zt=="number"?Dt[Zt-1]:null};Bt.propertyGroup=propertyGroupFactory(Bt,Gt),Dt=e(Nt.it,It.it,Bt.propertyGroup),Bt.numProperties=Dt.length;var Lt=ct(Nt.it[Nt.it.length-1],It.it[It.it.length-1],Bt.propertyGroup);return Bt.transform=Lt,Bt.propertyIndex=Nt.cix,Bt._name=Nt.nm,Bt}function s(Nt,It,Gt){var Dt=function(Zt){switch(Zt){case"ADBE Vectors Group":case"Contents":case 2:return Dt.content;default:return Dt.transform}};Dt.propertyGroup=propertyGroupFactory(Dt,Gt);var Bt=i(Nt,It,Dt.propertyGroup),Lt=ct(Nt.it[Nt.it.length-1],It.it[It.it.length-1],Dt.propertyGroup);return Dt.content=Bt,Dt.transform=Lt,Object.defineProperty(Dt,"_name",{get:function(){return Nt.nm}}),Dt.numProperties=Nt.np,Dt.propertyIndex=Nt.ix,Dt.nm=Nt.nm,Dt.mn=Nt.mn,Dt}function a(Nt,It,Gt){function Dt(Bt){return Bt==="Color"||Bt==="color"?Dt.color:Bt==="Opacity"||Bt==="opacity"?Dt.opacity:null}return Object.defineProperties(Dt,{color:{get:ExpressionPropertyInterface(It.c)},opacity:{get:ExpressionPropertyInterface(It.o)},_name:{value:Nt.nm},mn:{value:Nt.mn}}),It.c.setGroupProperty(PropertyInterface("Color",Gt)),It.o.setGroupProperty(PropertyInterface("Opacity",Gt)),Dt}function b(Nt,It,Gt){function Dt(Bt){return Bt==="Start Point"||Bt==="start point"?Dt.startPoint:Bt==="End Point"||Bt==="end point"?Dt.endPoint:Bt==="Opacity"||Bt==="opacity"?Dt.opacity:null}return Object.defineProperties(Dt,{startPoint:{get:ExpressionPropertyInterface(It.s)},endPoint:{get:ExpressionPropertyInterface(It.e)},opacity:{get:ExpressionPropertyInterface(It.o)},type:{get:function(){return"a"}},_name:{value:Nt.nm},mn:{value:Nt.mn}}),It.s.setGroupProperty(PropertyInterface("Start Point",Gt)),It.e.setGroupProperty(PropertyInterface("End Point",Gt)),It.o.setGroupProperty(PropertyInterface("Opacity",Gt)),Dt}function et(){function Nt(){return null}return Nt}function nt(Nt,It,Gt){var Dt=propertyGroupFactory(ur,Gt),Bt=propertyGroupFactory(nr,Dt);function Lt(_r){Object.defineProperty(nr,Nt.d[_r].nm,{get:ExpressionPropertyInterface(It.d.dataProps[_r].p)})}var Vt,Zt=Nt.d?Nt.d.length:0,nr={};for(Vt=0;Vt<Zt;Vt+=1)Lt(Vt),It.d.dataProps[Vt].p.setGroupProperty(Bt);function ur(_r){return _r==="Color"||_r==="color"?ur.color:_r==="Opacity"||_r==="opacity"?ur.opacity:_r==="Stroke Width"||_r==="stroke width"?ur.strokeWidth:null}return Object.defineProperties(ur,{color:{get:ExpressionPropertyInterface(It.c)},opacity:{get:ExpressionPropertyInterface(It.o)},strokeWidth:{get:ExpressionPropertyInterface(It.w)},dash:{get:function(){return nr}},_name:{value:Nt.nm},mn:{value:Nt.mn}}),It.c.setGroupProperty(PropertyInterface("Color",Dt)),It.o.setGroupProperty(PropertyInterface("Opacity",Dt)),It.w.setGroupProperty(PropertyInterface("Stroke Width",Dt)),ur}function c(Nt,It,Gt){function Dt(Lt){return Lt===Nt.e.ix||Lt==="End"||Lt==="end"?Dt.end:Lt===Nt.s.ix?Dt.start:Lt===Nt.o.ix?Dt.offset:null}var Bt=propertyGroupFactory(Dt,Gt);return Dt.propertyIndex=Nt.ix,It.s.setGroupProperty(PropertyInterface("Start",Bt)),It.e.setGroupProperty(PropertyInterface("End",Bt)),It.o.setGroupProperty(PropertyInterface("Offset",Bt)),Dt.propertyIndex=Nt.ix,Dt.propertyGroup=Gt,Object.defineProperties(Dt,{start:{get:ExpressionPropertyInterface(It.s)},end:{get:ExpressionPropertyInterface(It.e)},offset:{get:ExpressionPropertyInterface(It.o)},_name:{value:Nt.nm}}),Dt.mn=Nt.mn,Dt}function ct(Nt,It,Gt){function Dt(Lt){return Nt.a.ix===Lt||Lt==="Anchor Point"?Dt.anchorPoint:Nt.o.ix===Lt||Lt==="Opacity"?Dt.opacity:Nt.p.ix===Lt||Lt==="Position"?Dt.position:Nt.r.ix===Lt||Lt==="Rotation"||Lt==="ADBE Vector Rotation"?Dt.rotation:Nt.s.ix===Lt||Lt==="Scale"?Dt.scale:Nt.sk&&Nt.sk.ix===Lt||Lt==="Skew"?Dt.skew:Nt.sa&&Nt.sa.ix===Lt||Lt==="Skew Axis"?Dt.skewAxis:null}var Bt=propertyGroupFactory(Dt,Gt);return It.transform.mProps.o.setGroupProperty(PropertyInterface("Opacity",Bt)),It.transform.mProps.p.setGroupProperty(PropertyInterface("Position",Bt)),It.transform.mProps.a.setGroupProperty(PropertyInterface("Anchor Point",Bt)),It.transform.mProps.s.setGroupProperty(PropertyInterface("Scale",Bt)),It.transform.mProps.r.setGroupProperty(PropertyInterface("Rotation",Bt)),It.transform.mProps.sk&&(It.transform.mProps.sk.setGroupProperty(PropertyInterface("Skew",Bt)),It.transform.mProps.sa.setGroupProperty(PropertyInterface("Skew Angle",Bt))),It.transform.op.setGroupProperty(PropertyInterface("Opacity",Bt)),Object.defineProperties(Dt,{opacity:{get:ExpressionPropertyInterface(It.transform.mProps.o)},position:{get:ExpressionPropertyInterface(It.transform.mProps.p)},anchorPoint:{get:ExpressionPropertyInterface(It.transform.mProps.a)},scale:{get:ExpressionPropertyInterface(It.transform.mProps.s)},rotation:{get:ExpressionPropertyInterface(It.transform.mProps.r)},skew:{get:ExpressionPropertyInterface(It.transform.mProps.sk)},skewAxis:{get:ExpressionPropertyInterface(It.transform.mProps.sa)},_name:{value:Nt.nm}}),Dt.ty="tr",Dt.mn=Nt.mn,Dt.propertyGroup=Gt,Dt}function pt(Nt,It,Gt){function Dt(Vt){return Nt.p.ix===Vt?Dt.position:Nt.s.ix===Vt?Dt.size:null}var Bt=propertyGroupFactory(Dt,Gt);Dt.propertyIndex=Nt.ix;var Lt=It.sh.ty==="tm"?It.sh.prop:It.sh;return Lt.s.setGroupProperty(PropertyInterface("Size",Bt)),Lt.p.setGroupProperty(PropertyInterface("Position",Bt)),Object.defineProperties(Dt,{size:{get:ExpressionPropertyInterface(Lt.s)},position:{get:ExpressionPropertyInterface(Lt.p)},_name:{value:Nt.nm}}),Dt.mn=Nt.mn,Dt}function xt(Nt,It,Gt){function Dt(Vt){return Nt.p.ix===Vt?Dt.position:Nt.r.ix===Vt?Dt.rotation:Nt.pt.ix===Vt?Dt.points:Nt.or.ix===Vt||Vt==="ADBE Vector Star Outer Radius"?Dt.outerRadius:Nt.os.ix===Vt?Dt.outerRoundness:Nt.ir&&(Nt.ir.ix===Vt||Vt==="ADBE Vector Star Inner Radius")?Dt.innerRadius:Nt.is&&Nt.is.ix===Vt?Dt.innerRoundness:null}var Bt=propertyGroupFactory(Dt,Gt),Lt=It.sh.ty==="tm"?It.sh.prop:It.sh;return Dt.propertyIndex=Nt.ix,Lt.or.setGroupProperty(PropertyInterface("Outer Radius",Bt)),Lt.os.setGroupProperty(PropertyInterface("Outer Roundness",Bt)),Lt.pt.setGroupProperty(PropertyInterface("Points",Bt)),Lt.p.setGroupProperty(PropertyInterface("Position",Bt)),Lt.r.setGroupProperty(PropertyInterface("Rotation",Bt)),Nt.ir&&(Lt.ir.setGroupProperty(PropertyInterface("Inner Radius",Bt)),Lt.is.setGroupProperty(PropertyInterface("Inner Roundness",Bt))),Object.defineProperties(Dt,{position:{get:ExpressionPropertyInterface(Lt.p)},rotation:{get:ExpressionPropertyInterface(Lt.r)},points:{get:ExpressionPropertyInterface(Lt.pt)},outerRadius:{get:ExpressionPropertyInterface(Lt.or)},outerRoundness:{get:ExpressionPropertyInterface(Lt.os)},innerRadius:{get:ExpressionPropertyInterface(Lt.ir)},innerRoundness:{get:ExpressionPropertyInterface(Lt.is)},_name:{value:Nt.nm}}),Dt.mn=Nt.mn,Dt}function St(Nt,It,Gt){function Dt(Vt){return Nt.p.ix===Vt?Dt.position:Nt.r.ix===Vt?Dt.roundness:Nt.s.ix===Vt||Vt==="Size"||Vt==="ADBE Vector Rect Size"?Dt.size:null}var Bt=propertyGroupFactory(Dt,Gt),Lt=It.sh.ty==="tm"?It.sh.prop:It.sh;return Dt.propertyIndex=Nt.ix,Lt.p.setGroupProperty(PropertyInterface("Position",Bt)),Lt.s.setGroupProperty(PropertyInterface("Size",Bt)),Lt.r.setGroupProperty(PropertyInterface("Rotation",Bt)),Object.defineProperties(Dt,{position:{get:ExpressionPropertyInterface(Lt.p)},roundness:{get:ExpressionPropertyInterface(Lt.r)},size:{get:ExpressionPropertyInterface(Lt.s)},_name:{value:Nt.nm}}),Dt.mn=Nt.mn,Dt}function Et(Nt,It,Gt){function Dt(Vt){return Nt.r.ix===Vt||Vt==="Round Corners 1"?Dt.radius:null}var Bt=propertyGroupFactory(Dt,Gt),Lt=It;return Dt.propertyIndex=Nt.ix,Lt.rd.setGroupProperty(PropertyInterface("Radius",Bt)),Object.defineProperties(Dt,{radius:{get:ExpressionPropertyInterface(Lt.rd)},_name:{value:Nt.nm}}),Dt.mn=Nt.mn,Dt}function Rt(Nt,It,Gt){function Dt(Vt){return Nt.c.ix===Vt||Vt==="Copies"?Dt.copies:Nt.o.ix===Vt||Vt==="Offset"?Dt.offset:null}var Bt=propertyGroupFactory(Dt,Gt),Lt=It;return Dt.propertyIndex=Nt.ix,Lt.c.setGroupProperty(PropertyInterface("Copies",Bt)),Lt.o.setGroupProperty(PropertyInterface("Offset",Bt)),Object.defineProperties(Dt,{copies:{get:ExpressionPropertyInterface(Lt.c)},offset:{get:ExpressionPropertyInterface(Lt.o)},_name:{value:Nt.nm}}),Dt.mn=Nt.mn,Dt}return function(Nt,It,Gt){var Dt;function Bt(Vt){if(typeof Vt=="number")return Vt=Vt===void 0?1:Vt,Vt===0?Gt:Dt[Vt-1];for(var Zt=0,nr=Dt.length;Zt<nr;){if(Dt[Zt]._name===Vt)return Dt[Zt];Zt+=1}return null}function Lt(){return Gt}return Bt.propertyGroup=propertyGroupFactory(Bt,Lt),Dt=e(Nt,It,Bt.propertyGroup),Bt.numProperties=Dt.length,Bt._name="Contents",Bt}}(),TextExpressionInterface=function(){return function(e){var i;function s(a){switch(a){case"ADBE Text Document":return s.sourceText;default:return null}}return Object.defineProperty(s,"sourceText",{get:function(){e.textProperty.getValue();var b=e.textProperty.currentData.t;return(!i||b!==i.value)&&(i=new String(b),i.value=b||new String(b),Object.defineProperty(i,"style",{get:function(){return{fillColor:e.textProperty.currentData.fc}}})),i}}),s}}();function _typeof(e){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof(e)}var FootageInterface=function(){var e=function(a){var b="",et=a.getFootageData();function nt(){return b="",et=a.getFootageData(),c}function c(ct){if(et[ct])return b=ct,et=et[ct],_typeof(et)==="object"?c:et;var pt=ct.indexOf(b);if(pt!==-1){var xt=parseInt(ct.substr(pt+b.length),10);return et=et[xt],_typeof(et)==="object"?c:et}return""}return nt},i=function(a){function b(et){return et==="Outline"?b.outlineInterface():null}return b._name="Outline",b.outlineInterface=e(a),b};return function(s){function a(b){return b==="Data"?a.dataInterface:null}return a._name="Data",a.dataInterface=i(s),a}}(),interfaces={layer:LayerExpressionInterface,effects:EffectsExpressionInterface,comp:CompExpressionInterface,shape:ShapeExpressionInterface,text:TextExpressionInterface,footage:FootageInterface};function getInterface(e){return interfaces[e]||null}var expressionHelpers=function(){function e(nt,c,ct){c.x&&(ct.k=!0,ct.x=!0,ct.initiateExpression=ExpressionManager.initiateExpression,ct.effectsSequence.push(ct.initiateExpression(nt,c,ct).bind(ct)))}function i(nt){return nt*=this.elem.globalData.frameRate,nt-=this.offsetTime,nt!==this._cachingAtTime.lastFrame&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastFrame<nt?this._cachingAtTime.lastIndex:0,this._cachingAtTime.value=this.interpolateValue(nt,this._cachingAtTime),this._cachingAtTime.lastFrame=nt),this._cachingAtTime.value}function s(nt){var c=-.01,ct=this.getValueAtTime(nt),pt=this.getValueAtTime(nt+c),xt=0;if(ct.length){var St;for(St=0;St<ct.length;St+=1)xt+=Math.pow(pt[St]-ct[St],2);xt=Math.sqrt(xt)*100}else xt=0;return xt}function a(nt){if(this.vel!==void 0)return this.vel;var c=-.001,ct=this.getValueAtTime(nt),pt=this.getValueAtTime(nt+c),xt;if(ct.length){xt=createTypedArray("float32",ct.length);var St;for(St=0;St<ct.length;St+=1)xt[St]=(pt[St]-ct[St])/c}else xt=(pt-ct)/c;return xt}function b(){return this.pv}function et(nt){this.propertyGroup=nt}return{searchExpressions:e,getSpeedAtTime:s,getVelocityAtTime:a,getValueAtTime:i,getStaticValueAtTime:b,setGroupProperty:et}}();function addPropertyDecorator(){function e(Et,Rt,Nt){if(!this.k||!this.keyframes)return this.pv;Et=Et?Et.toLowerCase():"";var It=this.comp.renderedFrame,Gt=this.keyframes,Dt=Gt[Gt.length-1].t;if(It<=Dt)return this.pv;var Bt,Lt;Nt?(Rt?Bt=Math.abs(Dt-this.elem.comp.globalData.frameRate*Rt):Bt=Math.max(0,Dt-this.elem.data.ip),Lt=Dt-Bt):((!Rt||Rt>Gt.length-1)&&(Rt=Gt.length-1),Lt=Gt[Gt.length-1-Rt].t,Bt=Dt-Lt);var Vt,Zt,nr;if(Et==="pingpong"){var ur=Math.floor((It-Lt)/Bt);if(ur%2!==0)return this.getValueAtTime((Bt-(It-Lt)%Bt+Lt)/this.comp.globalData.frameRate,0)}else if(Et==="offset"){var _r=this.getValueAtTime(Lt/this.comp.globalData.frameRate,0),Ur=this.getValueAtTime(Dt/this.comp.globalData.frameRate,0),ln=this.getValueAtTime(((It-Lt)%Bt+Lt)/this.comp.globalData.frameRate,0),an=Math.floor((It-Lt)/Bt);if(this.pv.length){for(nr=new Array(_r.length),Zt=nr.length,Vt=0;Vt<Zt;Vt+=1)nr[Vt]=(Ur[Vt]-_r[Vt])*an+ln[Vt];return nr}return(Ur-_r)*an+ln}else if(Et==="continue"){var Fr=this.getValueAtTime(Dt/this.comp.globalData.frameRate,0),rn=this.getValueAtTime((Dt-.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(nr=new Array(Fr.length),Zt=nr.length,Vt=0;Vt<Zt;Vt+=1)nr[Vt]=Fr[Vt]+(Fr[Vt]-rn[Vt])*((It-Dt)/this.comp.globalData.frameRate)/5e-4;return nr}return Fr+(Fr-rn)*((It-Dt)/.001)}return this.getValueAtTime(((It-Lt)%Bt+Lt)/this.comp.globalData.frameRate,0)}function i(Et,Rt,Nt){if(!this.k)return this.pv;Et=Et?Et.toLowerCase():"";var It=this.comp.renderedFrame,Gt=this.keyframes,Dt=Gt[0].t;if(It>=Dt)return this.pv;var Bt,Lt;Nt?(Rt?Bt=Math.abs(this.elem.comp.globalData.frameRate*Rt):Bt=Math.max(0,this.elem.data.op-Dt),Lt=Dt+Bt):((!Rt||Rt>Gt.length-1)&&(Rt=Gt.length-1),Lt=Gt[Rt].t,Bt=Lt-Dt);var Vt,Zt,nr;if(Et==="pingpong"){var ur=Math.floor((Dt-It)/Bt);if(ur%2===0)return this.getValueAtTime(((Dt-It)%Bt+Dt)/this.comp.globalData.frameRate,0)}else if(Et==="offset"){var _r=this.getValueAtTime(Dt/this.comp.globalData.frameRate,0),Ur=this.getValueAtTime(Lt/this.comp.globalData.frameRate,0),ln=this.getValueAtTime((Bt-(Dt-It)%Bt+Dt)/this.comp.globalData.frameRate,0),an=Math.floor((Dt-It)/Bt)+1;if(this.pv.length){for(nr=new Array(_r.length),Zt=nr.length,Vt=0;Vt<Zt;Vt+=1)nr[Vt]=ln[Vt]-(Ur[Vt]-_r[Vt])*an;return nr}return ln-(Ur-_r)*an}else if(Et==="continue"){var Fr=this.getValueAtTime(Dt/this.comp.globalData.frameRate,0),rn=this.getValueAtTime((Dt+.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(nr=new Array(Fr.length),Zt=nr.length,Vt=0;Vt<Zt;Vt+=1)nr[Vt]=Fr[Vt]+(Fr[Vt]-rn[Vt])*(Dt-It)/.001;return nr}return Fr+(Fr-rn)*(Dt-It)/.001}return this.getValueAtTime((Bt-((Dt-It)%Bt+Dt))/this.comp.globalData.frameRate,0)}function s(Et,Rt){if(!this.k)return this.pv;if(Et=(Et||.4)*.5,Rt=Math.floor(Rt||5),Rt<=1)return this.pv;var Nt=this.comp.renderedFrame/this.comp.globalData.frameRate,It=Nt-Et,Gt=Nt+Et,Dt=Rt>1?(Gt-It)/(Rt-1):1,Bt=0,Lt=0,Vt;this.pv.length?Vt=createTypedArray("float32",this.pv.length):Vt=0;for(var Zt;Bt<Rt;){if(Zt=this.getValueAtTime(It+Bt*Dt),this.pv.length)for(Lt=0;Lt<this.pv.length;Lt+=1)Vt[Lt]+=Zt[Lt];else Vt+=Zt;Bt+=1}if(this.pv.length)for(Lt=0;Lt<this.pv.length;Lt+=1)Vt[Lt]/=Rt;else Vt/=Rt;return Vt}function a(Et){this._transformCachingAtTime||(this._transformCachingAtTime={v:new Matrix});var Rt=this._transformCachingAtTime.v;if(Rt.cloneFromProps(this.pre.props),this.appliedTransformations<1){var Nt=this.a.getValueAtTime(Et);Rt.translate(-Nt[0]*this.a.mult,-Nt[1]*this.a.mult,Nt[2]*this.a.mult)}if(this.appliedTransformations<2){var It=this.s.getValueAtTime(Et);Rt.scale(It[0]*this.s.mult,It[1]*this.s.mult,It[2]*this.s.mult)}if(this.sk&&this.appliedTransformations<3){var Gt=this.sk.getValueAtTime(Et),Dt=this.sa.getValueAtTime(Et);Rt.skewFromAxis(-Gt*this.sk.mult,Dt*this.sa.mult)}if(this.r&&this.appliedTransformations<4){var Bt=this.r.getValueAtTime(Et);Rt.rotate(-Bt*this.r.mult)}else if(!this.r&&this.appliedTransformations<4){var Lt=this.rz.getValueAtTime(Et),Vt=this.ry.getValueAtTime(Et),Zt=this.rx.getValueAtTime(Et),nr=this.or.getValueAtTime(Et);Rt.rotateZ(-Lt*this.rz.mult).rotateY(Vt*this.ry.mult).rotateX(Zt*this.rx.mult).rotateZ(-nr[2]*this.or.mult).rotateY(nr[1]*this.or.mult).rotateX(nr[0]*this.or.mult)}if(this.data.p&&this.data.p.s){var ur=this.px.getValueAtTime(Et),_r=this.py.getValueAtTime(Et);if(this.data.p.z){var Ur=this.pz.getValueAtTime(Et);Rt.translate(ur*this.px.mult,_r*this.py.mult,-Ur*this.pz.mult)}else Rt.translate(ur*this.px.mult,_r*this.py.mult,0)}else{var ln=this.p.getValueAtTime(Et);Rt.translate(ln[0]*this.p.mult,ln[1]*this.p.mult,-ln[2]*this.p.mult)}return Rt}function b(){return this.v.clone(new Matrix)}var et=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function(Et,Rt,Nt){var It=et(Et,Rt,Nt);return It.dynamicProperties.length?It.getValueAtTime=a.bind(It):It.getValueAtTime=b.bind(It),It.setGroupProperty=expressionHelpers.setGroupProperty,It};var nt=PropertyFactory.getProp;PropertyFactory.getProp=function(Et,Rt,Nt,It,Gt){var Dt=nt(Et,Rt,Nt,It,Gt);Dt.kf?Dt.getValueAtTime=expressionHelpers.getValueAtTime.bind(Dt):Dt.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(Dt),Dt.setGroupProperty=expressionHelpers.setGroupProperty,Dt.loopOut=e,Dt.loopIn=i,Dt.smooth=s,Dt.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(Dt),Dt.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(Dt),Dt.numKeys=Rt.a===1?Rt.k.length:0,Dt.propertyIndex=Rt.ix;var Bt=0;return Nt!==0&&(Bt=createTypedArray("float32",Rt.a===1?Rt.k[0].s.length:Rt.k.length)),Dt._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:Bt},expressionHelpers.searchExpressions(Et,Rt,Dt),Dt.k&&Gt.addDynamicProperty(Dt),Dt};function c(Et){return this._cachingAtTime||(this._cachingAtTime={shapeValue:shapePool.clone(this.pv),lastIndex:0,lastTime:initialDefaultFrame}),Et*=this.elem.globalData.frameRate,Et-=this.offsetTime,Et!==this._cachingAtTime.lastTime&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastTime<Et?this._caching.lastIndex:0,this._cachingAtTime.lastTime=Et,this.interpolateShape(Et,this._cachingAtTime.shapeValue,this._cachingAtTime)),this._cachingAtTime.shapeValue}var ct=ShapePropertyFactory.getConstructorFunction(),pt=ShapePropertyFactory.getKeyframedConstructorFunction();function xt(){}xt.prototype={vertices:function(Rt,Nt){this.k&&this.getValue();var It=this.v;Nt!==void 0&&(It=this.getValueAtTime(Nt,0));var Gt,Dt=It._length,Bt=It[Rt],Lt=It.v,Vt=createSizedArray(Dt);for(Gt=0;Gt<Dt;Gt+=1)Rt==="i"||Rt==="o"?Vt[Gt]=[Bt[Gt][0]-Lt[Gt][0],Bt[Gt][1]-Lt[Gt][1]]:Vt[Gt]=[Bt[Gt][0],Bt[Gt][1]];return Vt},points:function(Rt){return this.vertices("v",Rt)},inTangents:function(Rt){return this.vertices("i",Rt)},outTangents:function(Rt){return this.vertices("o",Rt)},isClosed:function(){return this.v.c},pointOnPath:function(Rt,Nt){var It=this.v;Nt!==void 0&&(It=this.getValueAtTime(Nt,0)),this._segmentsLength||(this._segmentsLength=bez.getSegmentsLength(It));for(var Gt=this._segmentsLength,Dt=Gt.lengths,Bt=Gt.totalLength*Rt,Lt=0,Vt=Dt.length,Zt=0,nr;Lt<Vt;){if(Zt+Dt[Lt].addedLength>Bt){var ur=Lt,_r=It.c&&Lt===Vt-1?0:Lt+1,Ur=(Bt-Zt)/Dt[Lt].addedLength;nr=bez.getPointInSegment(It.v[ur],It.v[_r],It.o[ur],It.i[_r],Ur,Dt[Lt]);break}else Zt+=Dt[Lt].addedLength;Lt+=1}return nr||(nr=It.c?[It.v[0][0],It.v[0][1]]:[It.v[It._length-1][0],It.v[It._length-1][1]]),nr},vectorOnPath:function(Rt,Nt,It){Rt==1?Rt=this.v.c:Rt==0&&(Rt=.999);var Gt=this.pointOnPath(Rt,Nt),Dt=this.pointOnPath(Rt+.001,Nt),Bt=Dt[0]-Gt[0],Lt=Dt[1]-Gt[1],Vt=Math.sqrt(Math.pow(Bt,2)+Math.pow(Lt,2));if(Vt===0)return[0,0];var Zt=It==="tangent"?[Bt/Vt,Lt/Vt]:[-Lt/Vt,Bt/Vt];return Zt},tangentOnPath:function(Rt,Nt){return this.vectorOnPath(Rt,Nt,"tangent")},normalOnPath:function(Rt,Nt){return this.vectorOnPath(Rt,Nt,"normal")},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime},extendPrototype([xt],ct),extendPrototype([xt],pt),pt.prototype.getValueAtTime=c,pt.prototype.initiateExpression=ExpressionManager.initiateExpression;var St=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function(Et,Rt,Nt,It,Gt){var Dt=St(Et,Rt,Nt,It,Gt);return Dt.propertyIndex=Rt.ix,Dt.lock=!1,Nt===3?expressionHelpers.searchExpressions(Et,Rt.pt,Dt):Nt===4&&expressionHelpers.searchExpressions(Et,Rt.ks,Dt),Dt.k&&Et.addDynamicProperty(Dt),Dt}}function initialize$1(){addPropertyDecorator()}function addDecorator(){function e(){return this.data.d.x?(this.calculateExpression=ExpressionManager.initiateExpression.bind(this)(this.elem,this.data.d,this),this.addEffect(this.getExpressionValue.bind(this)),!0):null}TextProperty.prototype.getExpressionValue=function(i,s){var a=this.calculateExpression(s);if(i.t!==a){var b={};return this.copyData(b,i),b.t=a.toString(),b.__complete=!1,b}return i},TextProperty.prototype.searchProperty=function(){var i=this.searchKeyframes(),s=this.searchExpressions();return this.kf=i||s,this.kf},TextProperty.prototype.searchExpressions=e}function initialize(){addDecorator()}function SVGComposableEffect(){}SVGComposableEffect.prototype={createMergeNode:function e(i,s){var a=createNS("feMerge");a.setAttribute("result",i);var b,et;for(et=0;et<s.length;et+=1)b=createNS("feMergeNode"),b.setAttribute("in",s[et]),a.appendChild(b),a.appendChild(b);return a}};var linearFilterValue="0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0";function SVGTintFilter(e,i,s,a,b){this.filterManager=i;var et=createNS("feColorMatrix");et.setAttribute("type","matrix"),et.setAttribute("color-interpolation-filters","linearRGB"),et.setAttribute("values",linearFilterValue+" 1 0"),this.linearFilter=et,et.setAttribute("result",a+"_tint_1"),e.appendChild(et),et=createNS("feColorMatrix"),et.setAttribute("type","matrix"),et.setAttribute("color-interpolation-filters","sRGB"),et.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),et.setAttribute("result",a+"_tint_2"),e.appendChild(et),this.matrixFilter=et;var nt=this.createMergeNode(a,[b,a+"_tint_1",a+"_tint_2"]);e.appendChild(nt)}extendPrototype([SVGComposableEffect],SVGTintFilter),SVGTintFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=this.filterManager.effectElements[0].p.v,s=this.filterManager.effectElements[1].p.v,a=this.filterManager.effectElements[2].p.v/100;this.linearFilter.setAttribute("values",linearFilterValue+" "+a+" 0"),this.matrixFilter.setAttribute("values",s[0]-i[0]+" 0 0 0 "+i[0]+" "+(s[1]-i[1])+" 0 0 0 "+i[1]+" "+(s[2]-i[2])+" 0 0 0 "+i[2]+" 0 0 0 1 0")}};function SVGFillFilter(e,i,s,a){this.filterManager=i;var b=createNS("feColorMatrix");b.setAttribute("type","matrix"),b.setAttribute("color-interpolation-filters","sRGB"),b.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),b.setAttribute("result",a),e.appendChild(b),this.matrixFilter=b}SVGFillFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=this.filterManager.effectElements[2].p.v,s=this.filterManager.effectElements[6].p.v;this.matrixFilter.setAttribute("values","0 0 0 0 "+i[0]+" 0 0 0 0 "+i[1]+" 0 0 0 0 "+i[2]+" 0 0 0 "+s+" 0")}};function SVGStrokeEffect(e,i,s){this.initialized=!1,this.filterManager=i,this.elem=s,this.paths=[]}SVGStrokeEffect.prototype.initialize=function(){var e=this.elem.layerElement.children||this.elem.layerElement.childNodes,i,s,a,b;for(this.filterManager.effectElements[1].p.v===1?(b=this.elem.maskManager.masksProperties.length,a=0):(a=this.filterManager.effectElements[0].p.v-1,b=a+1),s=createNS("g"),s.setAttribute("fill","none"),s.setAttribute("stroke-linecap","round"),s.setAttribute("stroke-dashoffset",1),a;a<b;a+=1)i=createNS("path"),s.appendChild(i),this.paths.push({p:i,m:a});if(this.filterManager.effectElements[10].p.v===3){var et=createNS("mask"),nt=createElementID();et.setAttribute("id",nt),et.setAttribute("mask-type","alpha"),et.appendChild(s),this.elem.globalData.defs.appendChild(et);var c=createNS("g");for(c.setAttribute("mask","url("+getLocationHref()+"#"+nt+")");e[0];)c.appendChild(e[0]);this.elem.layerElement.appendChild(c),this.masker=et,s.setAttribute("stroke","#fff")}else if(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2){if(this.filterManager.effectElements[10].p.v===2)for(e=this.elem.layerElement.children||this.elem.layerElement.childNodes;e.length;)this.elem.layerElement.removeChild(e[0]);this.elem.layerElement.appendChild(s),this.elem.layerElement.removeAttribute("mask"),s.setAttribute("stroke","#fff")}this.initialized=!0,this.pathMasker=s},SVGStrokeEffect.prototype.renderFrame=function(e){this.initialized||this.initialize();var i,s=this.paths.length,a,b;for(i=0;i<s;i+=1)if(this.paths[i].m!==-1&&(a=this.elem.maskManager.viewData[this.paths[i].m],b=this.paths[i].p,(e||this.filterManager._mdf||a.prop._mdf)&&b.setAttribute("d",a.lastPath),e||this.filterManager.effectElements[9].p._mdf||this.filterManager.effectElements[4].p._mdf||this.filterManager.effectElements[7].p._mdf||this.filterManager.effectElements[8].p._mdf||a.prop._mdf)){var et;if(this.filterManager.effectElements[7].p.v!==0||this.filterManager.effectElements[8].p.v!==100){var nt=Math.min(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,c=Math.max(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,ct=b.getTotalLength();et="0 0 0 "+ct*nt+" ";var pt=ct*(c-nt),xt=1+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01,St=Math.floor(pt/xt),Et;for(Et=0;Et<St;Et+=1)et+="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01+" ";et+="0 "+ct*10+" 0 0"}else et="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01;b.setAttribute("stroke-dasharray",et)}if((e||this.filterManager.effectElements[4].p._mdf)&&this.pathMasker.setAttribute("stroke-width",this.filterManager.effectElements[4].p.v*2),(e||this.filterManager.effectElements[6].p._mdf)&&this.pathMasker.setAttribute("opacity",this.filterManager.effectElements[6].p.v),(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2)&&(e||this.filterManager.effectElements[3].p._mdf)){var Rt=this.filterManager.effectElements[3].p.v;this.pathMasker.setAttribute("stroke","rgb("+bmFloor(Rt[0]*255)+","+bmFloor(Rt[1]*255)+","+bmFloor(Rt[2]*255)+")")}};function SVGTritoneFilter(e,i,s,a){this.filterManager=i;var b=createNS("feColorMatrix");b.setAttribute("type","matrix"),b.setAttribute("color-interpolation-filters","linearRGB"),b.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"),e.appendChild(b);var et=createNS("feComponentTransfer");et.setAttribute("color-interpolation-filters","sRGB"),et.setAttribute("result",a),this.matrixFilter=et;var nt=createNS("feFuncR");nt.setAttribute("type","table"),et.appendChild(nt),this.feFuncR=nt;var c=createNS("feFuncG");c.setAttribute("type","table"),et.appendChild(c),this.feFuncG=c;var ct=createNS("feFuncB");ct.setAttribute("type","table"),et.appendChild(ct),this.feFuncB=ct,e.appendChild(et)}SVGTritoneFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=this.filterManager.effectElements[0].p.v,s=this.filterManager.effectElements[1].p.v,a=this.filterManager.effectElements[2].p.v,b=a[0]+" "+s[0]+" "+i[0],et=a[1]+" "+s[1]+" "+i[1],nt=a[2]+" "+s[2]+" "+i[2];this.feFuncR.setAttribute("tableValues",b),this.feFuncG.setAttribute("tableValues",et),this.feFuncB.setAttribute("tableValues",nt)}};function SVGProLevelsFilter(e,i,s,a){this.filterManager=i;var b=this.filterManager.effectElements,et=createNS("feComponentTransfer");(b[10].p.k||b[10].p.v!==0||b[11].p.k||b[11].p.v!==1||b[12].p.k||b[12].p.v!==1||b[13].p.k||b[13].p.v!==0||b[14].p.k||b[14].p.v!==1)&&(this.feFuncR=this.createFeFunc("feFuncR",et)),(b[17].p.k||b[17].p.v!==0||b[18].p.k||b[18].p.v!==1||b[19].p.k||b[19].p.v!==1||b[20].p.k||b[20].p.v!==0||b[21].p.k||b[21].p.v!==1)&&(this.feFuncG=this.createFeFunc("feFuncG",et)),(b[24].p.k||b[24].p.v!==0||b[25].p.k||b[25].p.v!==1||b[26].p.k||b[26].p.v!==1||b[27].p.k||b[27].p.v!==0||b[28].p.k||b[28].p.v!==1)&&(this.feFuncB=this.createFeFunc("feFuncB",et)),(b[31].p.k||b[31].p.v!==0||b[32].p.k||b[32].p.v!==1||b[33].p.k||b[33].p.v!==1||b[34].p.k||b[34].p.v!==0||b[35].p.k||b[35].p.v!==1)&&(this.feFuncA=this.createFeFunc("feFuncA",et)),(this.feFuncR||this.feFuncG||this.feFuncB||this.feFuncA)&&(et.setAttribute("color-interpolation-filters","sRGB"),e.appendChild(et)),(b[3].p.k||b[3].p.v!==0||b[4].p.k||b[4].p.v!==1||b[5].p.k||b[5].p.v!==1||b[6].p.k||b[6].p.v!==0||b[7].p.k||b[7].p.v!==1)&&(et=createNS("feComponentTransfer"),et.setAttribute("color-interpolation-filters","sRGB"),et.setAttribute("result",a),e.appendChild(et),this.feFuncRComposed=this.createFeFunc("feFuncR",et),this.feFuncGComposed=this.createFeFunc("feFuncG",et),this.feFuncBComposed=this.createFeFunc("feFuncB",et))}SVGProLevelsFilter.prototype.createFeFunc=function(e,i){var s=createNS(e);return s.setAttribute("type","table"),i.appendChild(s),s},SVGProLevelsFilter.prototype.getTableValue=function(e,i,s,a,b){for(var et=0,nt=256,c,ct=Math.min(e,i),pt=Math.max(e,i),xt=Array.call(null,{length:nt}),St,Et=0,Rt=b-a,Nt=i-e;et<=256;)c=et/256,c<=ct?St=Nt<0?b:a:c>=pt?St=Nt<0?a:b:St=a+Rt*Math.pow((c-e)/Nt,1/s),xt[Et]=St,Et+=1,et+=256/(nt-1);return xt.join(" ")},SVGProLevelsFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i,s=this.filterManager.effectElements;this.feFuncRComposed&&(e||s[3].p._mdf||s[4].p._mdf||s[5].p._mdf||s[6].p._mdf||s[7].p._mdf)&&(i=this.getTableValue(s[3].p.v,s[4].p.v,s[5].p.v,s[6].p.v,s[7].p.v),this.feFuncRComposed.setAttribute("tableValues",i),this.feFuncGComposed.setAttribute("tableValues",i),this.feFuncBComposed.setAttribute("tableValues",i)),this.feFuncR&&(e||s[10].p._mdf||s[11].p._mdf||s[12].p._mdf||s[13].p._mdf||s[14].p._mdf)&&(i=this.getTableValue(s[10].p.v,s[11].p.v,s[12].p.v,s[13].p.v,s[14].p.v),this.feFuncR.setAttribute("tableValues",i)),this.feFuncG&&(e||s[17].p._mdf||s[18].p._mdf||s[19].p._mdf||s[20].p._mdf||s[21].p._mdf)&&(i=this.getTableValue(s[17].p.v,s[18].p.v,s[19].p.v,s[20].p.v,s[21].p.v),this.feFuncG.setAttribute("tableValues",i)),this.feFuncB&&(e||s[24].p._mdf||s[25].p._mdf||s[26].p._mdf||s[27].p._mdf||s[28].p._mdf)&&(i=this.getTableValue(s[24].p.v,s[25].p.v,s[26].p.v,s[27].p.v,s[28].p.v),this.feFuncB.setAttribute("tableValues",i)),this.feFuncA&&(e||s[31].p._mdf||s[32].p._mdf||s[33].p._mdf||s[34].p._mdf||s[35].p._mdf)&&(i=this.getTableValue(s[31].p.v,s[32].p.v,s[33].p.v,s[34].p.v,s[35].p.v),this.feFuncA.setAttribute("tableValues",i))}};function SVGDropShadowEffect(e,i,s,a,b){var et=i.container.globalData.renderConfig.filterSize,nt=i.data.fs||et;e.setAttribute("x",nt.x||et.x),e.setAttribute("y",nt.y||et.y),e.setAttribute("width",nt.width||et.width),e.setAttribute("height",nt.height||et.height),this.filterManager=i;var c=createNS("feGaussianBlur");c.setAttribute("in","SourceAlpha"),c.setAttribute("result",a+"_drop_shadow_1"),c.setAttribute("stdDeviation","0"),this.feGaussianBlur=c,e.appendChild(c);var ct=createNS("feOffset");ct.setAttribute("dx","25"),ct.setAttribute("dy","0"),ct.setAttribute("in",a+"_drop_shadow_1"),ct.setAttribute("result",a+"_drop_shadow_2"),this.feOffset=ct,e.appendChild(ct);var pt=createNS("feFlood");pt.setAttribute("flood-color","#00ff00"),pt.setAttribute("flood-opacity","1"),pt.setAttribute("result",a+"_drop_shadow_3"),this.feFlood=pt,e.appendChild(pt);var xt=createNS("feComposite");xt.setAttribute("in",a+"_drop_shadow_3"),xt.setAttribute("in2",a+"_drop_shadow_2"),xt.setAttribute("operator","in"),xt.setAttribute("result",a+"_drop_shadow_4"),e.appendChild(xt);var St=this.createMergeNode(a,[a+"_drop_shadow_4",b]);e.appendChild(St)}extendPrototype([SVGComposableEffect],SVGDropShadowEffect),SVGDropShadowEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){if((e||this.filterManager.effectElements[4].p._mdf)&&this.feGaussianBlur.setAttribute("stdDeviation",this.filterManager.effectElements[4].p.v/4),e||this.filterManager.effectElements[0].p._mdf){var i=this.filterManager.effectElements[0].p.v;this.feFlood.setAttribute("flood-color",rgbToHex(Math.round(i[0]*255),Math.round(i[1]*255),Math.round(i[2]*255)))}if((e||this.filterManager.effectElements[1].p._mdf)&&this.feFlood.setAttribute("flood-opacity",this.filterManager.effectElements[1].p.v/255),e||this.filterManager.effectElements[2].p._mdf||this.filterManager.effectElements[3].p._mdf){var s=this.filterManager.effectElements[3].p.v,a=(this.filterManager.effectElements[2].p.v-90)*degToRads,b=s*Math.cos(a),et=s*Math.sin(a);this.feOffset.setAttribute("dx",b),this.feOffset.setAttribute("dy",et)}}};var _svgMatteSymbols=[];function SVGMatte3Effect(e,i,s){this.initialized=!1,this.filterManager=i,this.filterElem=e,this.elem=s,s.matteElement=createNS("g"),s.matteElement.appendChild(s.layerElement),s.matteElement.appendChild(s.transformedElement),s.baseElement=s.matteElement}SVGMatte3Effect.prototype.findSymbol=function(e){for(var i=0,s=_svgMatteSymbols.length;i<s;){if(_svgMatteSymbols[i]===e)return _svgMatteSymbols[i];i+=1}return null},SVGMatte3Effect.prototype.replaceInParent=function(e,i){var s=e.layerElement.parentNode;if(s){for(var a=s.children,b=0,et=a.length;b<et&&a[b]!==e.layerElement;)b+=1;var nt;b<=et-2&&(nt=a[b+1]);var c=createNS("use");c.setAttribute("href","#"+i),nt?s.insertBefore(c,nt):s.appendChild(c)}},SVGMatte3Effect.prototype.setElementAsMask=function(e,i){if(!this.findSymbol(i)){var s=createElementID(),a=createNS("mask");a.setAttribute("id",i.layerId),a.setAttribute("mask-type","alpha"),_svgMatteSymbols.push(i);var b=e.globalData.defs;b.appendChild(a);var et=createNS("symbol");et.setAttribute("id",s),this.replaceInParent(i,s),et.appendChild(i.layerElement),b.appendChild(et);var nt=createNS("use");nt.setAttribute("href","#"+s),a.appendChild(nt),i.data.hd=!1,i.show()}e.setMatte(i.layerId)},SVGMatte3Effect.prototype.initialize=function(){for(var e=this.filterManager.effectElements[0].p.v,i=this.elem.comp.elements,s=0,a=i.length;s<a;)i[s]&&i[s].data.ind===e&&this.setElementAsMask(this.elem,i[s]),s+=1;this.initialized=!0},SVGMatte3Effect.prototype.renderFrame=function(){this.initialized||this.initialize()};function SVGGaussianBlurEffect(e,i,s,a){e.setAttribute("x","-100%"),e.setAttribute("y","-100%"),e.setAttribute("width","300%"),e.setAttribute("height","300%"),this.filterManager=i;var b=createNS("feGaussianBlur");b.setAttribute("result",a),e.appendChild(b),this.feGaussianBlur=b}SVGGaussianBlurEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=.3,s=this.filterManager.effectElements[0].p.v*i,a=this.filterManager.effectElements[1].p.v,b=a==3?0:s,et=a==2?0:s;this.feGaussianBlur.setAttribute("stdDeviation",b+" "+et);var nt=this.filterManager.effectElements[2].p.v==1?"wrap":"duplicate";this.feGaussianBlur.setAttribute("edgeMode",nt)}};function TransformEffect(){}TransformEffect.prototype.init=function(e){this.effectsManager=e,this.type=effectTypes.TRANSFORM_EFFECT,this.matrix=new Matrix,this.opacity=-1,this._mdf=!1,this._opMdf=!1},TransformEffect.prototype.renderFrame=function(e){if(this._opMdf=!1,this._mdf=!1,e||this.effectsManager._mdf){var i=this.effectsManager.effectElements,s=i[0].p.v,a=i[1].p.v,b=i[2].p.v===1,et=i[3].p.v,nt=b?et:i[4].p.v,c=i[5].p.v,ct=i[6].p.v,pt=i[7].p.v;this.matrix.reset(),this.matrix.translate(-s[0],-s[1],s[2]),this.matrix.scale(nt*.01,et*.01,1),this.matrix.rotate(-pt*degToRads),this.matrix.skewFromAxis(-c*degToRads,(ct+90)*degToRads),this.matrix.translate(a[0],a[1],0),this._mdf=!0,this.opacity!==i[8].p.v&&(this.opacity=i[8].p.v,this._opMdf=!0)}};function SVGTransformEffect(e,i){this.init(i)}extendPrototype([TransformEffect],SVGTransformEffect);function CVTransformEffect(e){this.init(e)}return extendPrototype([TransformEffect],CVTransformEffect),registerRenderer("canvas",CanvasRenderer),registerRenderer("html",HybridRenderer),registerRenderer("svg",SVGRenderer),ShapeModifiers.registerModifier("tm",TrimModifier),ShapeModifiers.registerModifier("pb",PuckerAndBloatModifier),ShapeModifiers.registerModifier("rp",RepeaterModifier),ShapeModifiers.registerModifier("rd",RoundCornersModifier),ShapeModifiers.registerModifier("zz",ZigZagModifier),ShapeModifiers.registerModifier("op",OffsetPathModifier),setExpressionsPlugin(Expressions),setExpressionInterfaces(getInterface),initialize$1(),initialize(),registerEffect$1(20,SVGTintFilter,!0),registerEffect$1(21,SVGFillFilter,!0),registerEffect$1(22,SVGStrokeEffect,!1),registerEffect$1(23,SVGTritoneFilter,!0),registerEffect$1(24,SVGProLevelsFilter,!0),registerEffect$1(25,SVGDropShadowEffect,!0),registerEffect$1(28,SVGMatte3Effect,!1),registerEffect$1(29,SVGGaussianBlurEffect,!0),registerEffect$1(35,SVGTransformEffect,!1),registerEffect(35,CVTransformEffect),lottie})})(lottie$1,lottie$1.exports);var lottieExports=lottie$1.exports;const lottie=getDefaultExportFromCjs(lottieExports);function _arrayLikeToArray(e,i){(i==null||i>e.length)&&(i=e.length);for(var s=0,a=Array(i);s<i;s++)a[s]=e[s];return a}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _defineProperty(e,i,s){return(i=_toPropertyKey(i))in e?Object.defineProperty(e,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[i]=s,e}function _iterableToArrayLimit(e,i){var s=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(s!=null){var a,b,et,nt,c=[],ct=!0,pt=!1;try{if(et=(s=s.call(e)).next,i!==0)for(;!(ct=(a=et.call(s)).done)&&(c.push(a.value),c.length!==i);ct=!0);}catch(xt){pt=!0,b=xt}finally{try{if(!ct&&s.return!=null&&(nt=s.return(),Object(nt)!==nt))return}finally{if(pt)throw b}}return c}}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ownKeys(e,i){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);i&&(a=a.filter(function(b){return Object.getOwnPropertyDescriptor(e,b).enumerable})),s.push.apply(s,a)}return s}function _objectSpread2(e){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?ownKeys(Object(s),!0).forEach(function(a){_defineProperty(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ownKeys(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}function _objectWithoutProperties(e,i){if(e==null)return{};var s,a,b=_objectWithoutPropertiesLoose(e,i);if(Object.getOwnPropertySymbols){var et=Object.getOwnPropertySymbols(e);for(a=0;a<et.length;a++)s=et[a],i.includes(s)||{}.propertyIsEnumerable.call(e,s)&&(b[s]=e[s])}return b}function _objectWithoutPropertiesLoose(e,i){if(e==null)return{};var s={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(i.includes(a))continue;s[a]=e[a]}return s}function _slicedToArray(e,i){return _arrayWithHoles(e)||_iterableToArrayLimit(e,i)||_unsupportedIterableToArray(e,i)||_nonIterableRest()}function _toPrimitive(e,i){if(typeof e!="object"||!e)return e;var s=e[Symbol.toPrimitive];if(s!==void 0){var a=s.call(e,i||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function _toPropertyKey(e){var i=_toPrimitive(e,"string");return typeof i=="symbol"?i:i+""}function _unsupportedIterableToArray(e,i){if(e){if(typeof e=="string")return _arrayLikeToArray(e,i);var s={}.toString.call(e).slice(8,-1);return s==="Object"&&e.constructor&&(s=e.constructor.name),s==="Map"||s==="Set"?Array.from(e):s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?_arrayLikeToArray(e,i):void 0}}var _excluded$1=["animationData","loop","autoplay","initialSegment","onComplete","onLoopComplete","onEnterFrame","onSegmentStart","onConfigReady","onDataReady","onDataFailed","onLoadedImages","onDOMLoaded","onDestroy","lottieRef","renderer","name","assetsPath","rendererSettings"],useLottie=function e(i,s){var a=i.animationData,b=i.loop,et=i.autoplay,nt=i.initialSegment,c=i.onComplete,ct=i.onLoopComplete,pt=i.onEnterFrame,xt=i.onSegmentStart,St=i.onConfigReady,Et=i.onDataReady,Rt=i.onDataFailed,Nt=i.onLoadedImages,It=i.onDOMLoaded,Gt=i.onDestroy;i.lottieRef,i.renderer,i.name,i.assetsPath,i.rendererSettings;var Dt=_objectWithoutProperties(i,_excluded$1),Bt=reactExports.useState(!1),Lt=_slicedToArray(Bt,2),Vt=Lt[0],Zt=Lt[1],nr=reactExports.useRef(),ur=reactExports.useRef(null),_r=function(){var _n;(_n=nr.current)===null||_n===void 0||_n.play()},Ur=function(){var _n;(_n=nr.current)===null||_n===void 0||_n.stop()},ln=function(){var _n;(_n=nr.current)===null||_n===void 0||_n.pause()},an=function(_n){var fn;(fn=nr.current)===null||fn===void 0||fn.setSpeed(_n)},Fr=function(_n,fn){var jn;(jn=nr.current)===null||jn===void 0||jn.goToAndPlay(_n,fn)},rn=function(_n,fn){var jn;(jn=nr.current)===null||jn===void 0||jn.goToAndStop(_n,fn)},gn=function(_n){var fn;(fn=nr.current)===null||fn===void 0||fn.setDirection(_n)},_i=function(_n,fn){var jn;(jn=nr.current)===null||jn===void 0||jn.playSegments(_n,fn)},xr=function(_n){var fn;(fn=nr.current)===null||fn===void 0||fn.setSubframe(_n)},gr=function(_n){var fn;return(fn=nr.current)===null||fn===void 0?void 0:fn.getDuration(_n)},rr=function(){var _n;(_n=nr.current)===null||_n===void 0||_n.destroy(),nr.current=void 0},cr=function(){var _n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},fn;if(ur.current){(fn=nr.current)===null||fn===void 0||fn.destroy();var jn=_objectSpread2(_objectSpread2(_objectSpread2({},i),_n),{},{container:ur.current});return nr.current=lottie.loadAnimation(jn),Zt(!!nr.current),function(){var vs;(vs=nr.current)===null||vs===void 0||vs.destroy(),nr.current=void 0}}};reactExports.useEffect(function(){var $r=cr();return function(){return $r==null?void 0:$r()}},[a,b]),reactExports.useEffect(function(){nr.current&&(nr.current.autoplay=!!et)},[et]),reactExports.useEffect(function(){if(nr.current){if(!nt){nr.current.resetSegments(!0);return}!Array.isArray(nt)||!nt.length||((nr.current.currentRawFrame<nt[0]||nr.current.currentRawFrame>nt[1])&&(nr.current.currentRawFrame=nt[0]),nr.current.setSegment(nt[0],nt[1]))}},[nt]),reactExports.useEffect(function(){var $r=[{name:"complete",handler:c},{name:"loopComplete",handler:ct},{name:"enterFrame",handler:pt},{name:"segmentStart",handler:xt},{name:"config_ready",handler:St},{name:"data_ready",handler:Et},{name:"data_failed",handler:Rt},{name:"loaded_images",handler:Nt},{name:"DOMLoaded",handler:It},{name:"destroy",handler:Gt}],_n=$r.filter(function(jn){return jn.handler!=null});if(_n.length){var fn=_n.map(function(jn){var vs;return(vs=nr.current)===null||vs===void 0||vs.addEventListener(jn.name,jn.handler),function(){var Cs;(Cs=nr.current)===null||Cs===void 0||Cs.removeEventListener(jn.name,jn.handler)}});return function(){fn.forEach(function(jn){return jn()})}}},[c,ct,pt,xt,St,Et,Rt,Nt,It,Gt]);var Hr=React.createElement("div",_objectSpread2({style:s,ref:ur},Dt));return{View:Hr,play:_r,stop:Ur,pause:ln,setSpeed:an,goToAndStop:rn,goToAndPlay:Fr,setDirection:gn,playSegments:_i,setSubframe:xr,getDuration:gr,destroy:rr,animationContainerRef:ur,animationLoaded:Vt,animationItem:nr.current}};function getContainerVisibility(e){var i=e.getBoundingClientRect(),s=i.top,a=i.height,b=window.innerHeight-s,et=window.innerHeight+a;return b/et}function getContainerCursorPosition(e,i,s){var a=e.getBoundingClientRect(),b=a.top,et=a.left,nt=a.width,c=a.height,ct=(i-et)/nt,pt=(s-b)/c;return{x:ct,y:pt}}var useInitInteractivity=function e(i){var s=i.wrapperRef,a=i.animationItem,b=i.mode,et=i.actions;reactExports.useEffect(function(){var nt=s.current;if(!(!nt||!a||!et.length)){a.stop();var c=function(){var xt=null,St=function(){var Rt=getContainerVisibility(nt),Nt=et.find(function(Gt){var Dt=Gt.visibility;return Dt&&Rt>=Dt[0]&&Rt<=Dt[1]});if(Nt){if(Nt.type==="seek"&&Nt.visibility&&Nt.frames.length===2){var It=Nt.frames[0]+Math.ceil((Rt-Nt.visibility[0])/(Nt.visibility[1]-Nt.visibility[0])*Nt.frames[1]);//! goToAndStop must be relative to the start of the current segment
a.goToAndStop(It-a.firstFrame-1,!0)}Nt.type==="loop"&&(xt===null||xt!==Nt.frames||a.isPaused)&&(a.playSegments(Nt.frames,!0),xt=Nt.frames),Nt.type==="play"&&a.isPaused&&(a.resetSegments(!0),a.play()),Nt.type==="stop"&&a.goToAndStop(Nt.frames[0]-a.firstFrame-1,!0)}};return document.addEventListener("scroll",St),function(){document.removeEventListener("scroll",St)}},ct=function(){var xt=function(Nt,It){var Gt=Nt,Dt=It;if(Gt!==-1&&Dt!==-1){var Bt=getContainerCursorPosition(nt,Gt,Dt);Gt=Bt.x,Dt=Bt.y}var Lt=et.find(function(nr){var ur=nr.position;return ur&&Array.isArray(ur.x)&&Array.isArray(ur.y)?Gt>=ur.x[0]&&Gt<=ur.x[1]&&Dt>=ur.y[0]&&Dt<=ur.y[1]:ur&&!Number.isNaN(ur.x)&&!Number.isNaN(ur.y)?Gt===ur.x&&Dt===ur.y:!1});if(Lt){if(Lt.type==="seek"&&Lt.position&&Array.isArray(Lt.position.x)&&Array.isArray(Lt.position.y)&&Lt.frames.length===2){var Vt=(Gt-Lt.position.x[0])/(Lt.position.x[1]-Lt.position.x[0]),Zt=(Dt-Lt.position.y[0])/(Lt.position.y[1]-Lt.position.y[0]);a.playSegments(Lt.frames,!0),a.goToAndStop(Math.ceil((Vt+Zt)/2*(Lt.frames[1]-Lt.frames[0])),!0)}Lt.type==="loop"&&a.playSegments(Lt.frames,!0),Lt.type==="play"&&(a.isPaused&&a.resetSegments(!1),a.playSegments(Lt.frames)),Lt.type==="stop"&&a.goToAndStop(Lt.frames[0],!0)}},St=function(Nt){xt(Nt.clientX,Nt.clientY)},Et=function(){xt(-1,-1)};return nt.addEventListener("mousemove",St),nt.addEventListener("mouseout",Et),function(){nt.removeEventListener("mousemove",St),nt.removeEventListener("mouseout",Et)}};switch(b){case"scroll":return c();case"cursor":return ct()}}},[b,a])},useLottieInteractivity=function e(i){var s=i.actions,a=i.mode,b=i.lottieObj,et=b.animationItem,nt=b.View,c=b.animationContainerRef;return useInitInteractivity({actions:s,animationItem:et,mode:a,wrapperRef:c}),nt},_excluded=["style","interactivity"],Lottie=function e(i){var s,a,b,et=i.style,nt=i.interactivity,c=_objectWithoutProperties(i,_excluded),ct=useLottie(c,et),pt=ct.View,xt=ct.play,St=ct.stop,Et=ct.pause,Rt=ct.setSpeed,Nt=ct.goToAndStop,It=ct.goToAndPlay,Gt=ct.setDirection,Dt=ct.playSegments,Bt=ct.setSubframe,Lt=ct.getDuration,Vt=ct.destroy,Zt=ct.animationContainerRef,nr=ct.animationLoaded,ur=ct.animationItem;return reactExports.useEffect(function(){i.lottieRef&&(i.lottieRef.current={play:xt,stop:St,pause:Et,setSpeed:Rt,goToAndPlay:It,goToAndStop:Nt,setDirection:Gt,playSegments:Dt,setSubframe:Bt,getDuration:Lt,destroy:Vt,animationContainerRef:Zt,animationLoaded:nr,animationItem:ur})},[(s=i.lottieRef)===null||s===void 0?void 0:s.current]),useLottieInteractivity({lottieObj:{View:pt,play:xt,stop:St,pause:Et,setSpeed:Rt,goToAndStop:Nt,goToAndPlay:It,setDirection:Gt,playSegments:Dt,setSubframe:Bt,getDuration:Lt,destroy:Vt,animationContainerRef:Zt,animationLoaded:nr,animationItem:ur},actions:(a=nt==null?void 0:nt.actions)!==null&&a!==void 0?a:[],mode:(b=nt==null?void 0:nt.mode)!==null&&b!==void 0?b:"scroll"})};const v$1="5.7.4",fr$1=29.9700012207031,ip$1=0,op$1=210.000008553475,w$1=1e3,h$1=1e3,nm$1="Order Prepare",ddd$1=0,assets$1=[],layers$1=[{ddd:0,ind:1,ty:4,nm:"food Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:180,ix:10},p:{a:0,k:[856,836,0],ix:2,l:2},a:{a:0,k:[11,10.5,0],ix:1,l:2},s:{a:0,k:[-946.729,-946.729,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-1.539,0],[0,0],[0,1.538],[0,0]],o:[[0,0],[1.538,0],[0,0],[0,1.538]],v:[[-5.348,1.393],[5.348,1.393],[8.133,-1.393],[-8.133,-1.393]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.463355449602,.325916963465,.232582466275,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[11.995,16.497],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.029,.024],[-.117,.028],[.022,.306],[-.008,.026],[-.002,.019],[-.035,-.117],[-.124,-.297],[-.007,.007],[-.012,.019],[-.034,.014],[-.055,-.043],[.018,-.051],[.104,-.071],[.077,-.005],[.02,.005],[.145,.068]],o:[[.101,-.082],[-.134,-.281],[-.015,-.024],[.007,-.017],[.03,-.135],[.095,.31],[.008,-.007],[-.004,-.018],[-.004,-.038],[.068,-.026],[.039,.03],[-.039,.116],[-.021,.059],[-.024,.001],[-.164,.049],[-.034,-.017]],v:[[-.465,.568],[-.128,.432],[-.402,-.468],[-.415,-.548],[-.402,-.6],[-.15,-.596],[.182,.308],[.206,.289],[.215,.234],[.264,.137],[.424,.175],[.477,.303],[.251,.585],[.1,.693],[.035,.686],[-.454,.665]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.490714069441,.535409665575,.431828487621,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[16.263,11.185],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.373,.43],[.729,-.144],[.325,-.221],[-.049,-.175],[-1.283,-.751],[-.455,.413],[.229,.919]],o:[[-.457,-.526],[-.291,.059],[-1.295,.885],[.048,.176],[1.283,.75],[.455,-.413],[-.146,-.584]],v:[[1.419,-2.015],[-.478,-2.648],[-1.408,-2.247],[-2.48,-.031],[-1.152,2.042],[1.413,1.921],[2.473,-.307]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.979146082261,.656308821136,.240585072835,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[17.199,13.517],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:2,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.037,.006],[-.116,-.034],[-.13,.277],[-.02,.017],[-.011,.013],[.026,-.12],[.036,-.32],[-.011,.003],[-.019,.01],[-.035,-.004],[-.027,-.064],[.041,-.038],[.126,-.01],[.069,.033],[.015,.013],[.093,.131]],o:[[.128,-.023],[.019,-.312],[-.002,-.028],[.014,-.012],[.091,-.105],[-.069,.316],[.01,-.002],[.004,-.017],[.015,-.035],[.073,.01],[.019,.045],[-.091,.081],[-.046,.042],[-.022,-.011],[-.168,-.037],[-.022,-.03]],v:[[-.467,.339],[-.105,.385],[.094,-.536],[.12,-.611],[.158,-.65],[.376,-.525],[.225,.426],[.255,.421],[.288,.378],[.38,.318],[.501,.428],[.484,.566],[.15,.701],[-.035,.723],[-.087,.686],[-.503,.428]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.490714069441,.535409665575,.431828487621,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[7.231,10.872],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:2,cix:2,bm:0,ix:4,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.116,.557],[.706,.229],[.391,-.036],[.043,-.178],[-.755,-1.281],[-.598,.138],[-.247,.914]],o:[[-.142,-.683],[-.282,-.09],[-1.563,.141],[-.044,.178],[.755,1.28],[.598,-.139],[.158,-.581]],v:[[2.365,-.979],[1.018,-2.456],[.012,-2.558],[-2.005,-1.146],[-1.857,1.31],[.443,2.456],[2.454,1.027]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.979146082261,.656308821136,.240585072835,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[6.983,13.344],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:2,cix:2,bm:0,ix:5,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.037,-.005],[-.1,-.067],[-.209,.224],[-.025,.012],[-.014,.01],[.062,-.107],[.132,-.294],[-.011,-.001],[-.021,.003],[-.032,-.015],[-.007,-.07],[.05,-.023],[.123,.028],[.056,.053],[.01,.018],[.049,.154]],o:[[.129,.018],[.114,-.29],[.007,-.028],[.016,-.006],[.119,-.071],[-.162,.28],[.01,.001],[.008,-.016],[.025,-.029],[.067,.031],[.004,.049],[-.111,.05],[-.057,.026],[-.017,-.018],[-.148,-.087],[-.012,-.036]],v:[[-.527,.128],[-.197,.283],[.275,-.531],[.324,-.596],[.37,-.62],[.54,-.434],[.104,.426],[.135,.43],[.18,.398],[.285,.37],[.367,.512],[.309,.637],[-.051,.663],[-.234,.628],[-.273,.576],[-.59,.202]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.390436269723,.426955608293,.342077846153,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[12.69,11.329],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 6",np:2,cix:2,bm:0,ix:6,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.061,.565],[.602,.433],[.382,.086],[.096,-.155],[-.325,-1.451],[-.612,-.052],[-.516,.794]],o:[[.074,-.693],[-.241,-.174],[-1.53,-.345],[-.096,.155],[.325,1.45],[.613,.051],[.328,-.504]],v:[[2.486,-.079],[1.657,-1.898],[.73,-2.305],[-1.623,-1.581],[-2.235,.803],[-.399,2.6],[1.954,1.857]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.817884677064,.28898043165,.265481268191,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[11.782,13.429],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 7",np:2,cix:2,bm:0,ix:7,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.124,0],[-1.312,.003],[.123,-.001],[1.312,-.003]],o:[[1.312,-.004],[.123,-.001],[-1.312,.003],[-.123,0]],v:[[-1.967,.1],[1.969,.092],[1.969,-.099],[-1.967,-.091]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.951655548694,.448623597388,.329247268976,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[6.905,3.499],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 8",np:2,cix:2,bm:0,ix:8,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.124,-.002],[-1.374,-.017],[.123,.001],[1.374,.016]],o:[[1.374,.016],[.123,.001],[-1.374,-.017],[-.123,-.002]],v:[[-2.061,.096],[2.062,.096],[2.062,-.095],[-2.061,-.095]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.951655548694,.448623597388,.329247268976,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[8.64,5.812],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 9",np:2,cix:2,bm:0,ix:9,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-3.229,-7.487],[-3.229,-6.941],[-1.277,-4.63],[-1.277,7.487],[3.229,7.487],[3.229,-4.63],[1.283,-6.941],[1.283,-7.487]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.986887254902,.735047942517,.48431486242,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[7.815,10.403],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 10",np:2,cix:2,bm:0,ix:10,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-.324,-7.214],[-2.467,-4.902],[-2.467,7.214],[2.467,7.214],[2.467,-4.902]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.958784335267,.52412516276,.43046913895,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[4.911,10.676],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 11",np:2,cix:2,bm:0,ix:11,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0},{ddd:0,ind:2,ty:4,nm:"kitchen Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[488,856,0],ix:2,l:2},a:{a:0,k:[44.5,23,0],ix:1,l:2},s:{a:0,k:[1259.236,1259.236,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.142,.004],[-4.785,.116],[.142,-.003],[4.785,-.116]],o:[[4.785,-.116],[.142,-.004],[-4.785,.117],[-.142,.004]],v:[[-7.178,.176],[7.178,.044],[7.178,-.177],[-7.178,-.045]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[1,.999998743394,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[24.813,25.109],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:4,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.362,0],[0,0],[0,-.361],[0,-.226],[-.002,-.108],[-.153,0],[-.043,-.18],[-.568,0],[0,0],[-.131,.552],[-.185,0],[0,0],[-.043,-.18],[-.568,0],[0,0],[-.131,.552],[-.185,0],[0,0],[-.043,-.18],[-.567,0],[0,0],[-.131,.552],[-.185,0],[-.101,.002],[.001,.055],[0,.123],[0,0]],o:[[0,0],[-.362,0],[0,.226],[0,.108],[.004,.235],[.185,0],[.131,.552],[0,0],[.567,0],[.043,-.18],[0,0],[.185,0],[.131,.552],[0,0],[.567,0],[.043,-.18],[0,0],[.185,0],[.131,.552],[0,0],[.567,0],[.043,-.18],[.102,0],[.047,-.001],[-.002,-.117],[0,0],[0,-.361]],v:[[7.191,-1.53],[-7.187,-1.53],[-7.842,-.875],[-7.846,-.198],[-7.844,.127],[-7.418,.28],[-7.029,.587],[-5.837,1.53],[-4.068,1.53],[-2.877,.587],[-2.488,.28],[-2.463,.28],[-2.074,.587],[-.882,1.53],[.887,1.53],[2.078,.587],[2.467,.28],[2.492,.28],[2.881,.587],[4.072,1.53],[5.842,1.53],[7.033,.587],[7.422,.28],[7.765,.28],[7.845,.227],[7.846,-.266],[7.846,-.875]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.357465945973,.368503884708,.606296015721,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[24.777,25.377],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:4,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,1.152],[-1.152,0],[0,-1.152],[1.152,0]],o:[[0,-1.152],[1.152,0],[0,1.152],[-1.152,0]],v:[[-2.087,.674],[.001,-2.76],[2.087,.674],[.001,2.76]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.947452859318,.905771651922,.884520227769,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[29.724,23.848],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:4,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,1.152],[-1.152,0],[0,-1.152],[1.152,0]],o:[[0,-1.152],[1.152,0],[0,1.152],[-1.152,0]],v:[[-2.087,.674],[.001,-2.76],[2.087,.674],[.001,2.76]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.947452859318,.905771651922,.884520227769,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[24.771,23.848],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:4,cix:2,bm:0,ix:4,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,1.152],[-1.152,0],[0,-1.152],[1.153,0]],o:[[0,-1.152],[1.153,0],[0,1.152],[-1.152,0]],v:[[-2.087,.674],[-.001,-2.76],[2.087,.674],[-.001,2.76]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.947452859318,.905771651922,.884520227769,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[19.818,23.848],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:4,cix:2,bm:0,ix:5,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-1.649,0],[0,0],[0,1.649],[0,0]],o:[[0,0],[1.649,0],[0,0],[0,1.649]],v:[[-5.734,1.493],[5.734,1.493],[8.721,-1.493],[-8.721,-1.493]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.914726526597,.817986462163,.791576071347,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[20.7,25.413],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 6",np:4,cix:2,bm:0,ix:6,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[4.002,-.297],[0,0],[2.52,-1.482],[0,0],[-.741,-2.075],[0,0]],o:[[0,0],[-4.002,.296],[0,0],[-2.519,1.482],[0,0],[.741,2.074],[0,0]],v:[[5.633,4.743],[3.26,-4.594],[.445,.001],[-3.41,-4.299],[-2.223,1.779],[-6.521,1.482],[-1.482,5.781]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.205477456486,.468678672641,.326348368327,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[16.21,19.711],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 7",np:4,cix:2,bm:0,ix:7,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[3.557,.444],[0,0],[3.408,.593],[0,0]],o:[[0,0],[-3.558,-.446],[0,0],[-3.409,-.593],[0,0]],v:[[.592,4.372],[2.372,-1.408],[-2.965,1.408],[-2.52,-4.372],[-5.337,4.965]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.662919646618,.737403959386,.547142238243,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[27.094,20.527],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 8",np:4,cix:2,bm:0,ix:8,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.152,-.06],[.2,-.129],[.205,-.146],[-.214,.13],[-.21,.141],[-.168,.17]],o:[[-.222,.087],[-.212,.138],[-.197,.14],[.216,-.13],[.197,-.13],[.102,-.104]],v:[[.598,-.587],[-.023,-.229],[-.656,.187],[-.462,.517],[.171,.1],[.751,-.325]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.849499511719,.431366355746,.265743719363,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[23.803,20.639],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 9",np:4,cix:2,bm:0,ix:9,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.164,-.094],[.272,-.186],[.233,-.205],[-.181,.104],[-.269,.188],[-.232,.207]],o:[[-.287,.162],[-.256,.174],[-.162,.143],[.284,-.164],[.255,-.176],[.146,-.13]],v:[[.699,-.697],[-.126,-.15],[-.889,.392],[-.661,.687],[.154,.123],[.904,-.431]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.849499511719,.431366355746,.265743719363,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[22.315,18.117],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 10",np:4,cix:2,bm:0,ix:10,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.131,-.029],[.266,-.164],[.293,-.182],[-.217,.136],[-.292,.185],[-.198,.245]],o:[[-.307,.069],[-.294,.181],[-.217,.134],[.292,-.183],[.265,-.166],[.078,-.097]],v:[[.872,-.719],[.021,-.275],[-.857,.271],[-.659,.612],[.219,.062],[.997,-.506]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.849499511719,.431366355746,.265743719363,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[20.644,16.034],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 11",np:4,cix:2,bm:0,ix:11,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.184,-.053],[.823,-.124],[-.248,.039],[-.709,.371]],o:[[-.779,.223],[-.25,.037],[.814,-.122],[.171,-.09]],v:[[1.032,-.712],[-1.083,.348],[-.978,.725],[1.162,-.402]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.849499511719,.431366355746,.265743719363,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[19.196,14.264],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 12",np:4,cix:2,bm:0,ix:12,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[1.436,-1.017],[-.442,-.499],[-.537,-1.014],[-.585,.211],[.238,1.763],[1.064,1.306]],o:[[0,0],[-1.436,1.017],[.442,.499],[.537,1.014],[.584,-.212],[-.239,-1.763],[-1.064,-1.304]],v:[[-1.186,-5.635],[-3.492,-5.848],[-3.574,-2.514],[1.419,3.148],[4.344,6.654],[4.245,3.975],[2.124,-1.029]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.963083543964,.543955485026,.24977164175,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[20.841,18.166],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 13",np:4,cix:2,bm:0,ix:13,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[.406,1.771],[.381,-.562],[-.375,-1.198],[0,0],[.902,.12],[-.306,-.454],[-.897,-1.155],[.657,-.907],[-1.423,-1.051],[0,0],[1.218,.798],[.188,-.618],[-1.528,-.587],[0,0]],o:[[0,0],[-.237,-1.034],[-.381,.56],[.302,.966],[0,0],[-.903,-.121],[1.021,1.514],[0,0],[-.657,.906],[1.091,.807],[0,0],[-1.834,-1.201],[-.256,.839],[3.404,1.308],[0,0]],v:[[4.495,4.184],[3.042,.309],[1.346,-4.762],[2.135,-.371],[3.456,3.479],[-.413,-2.473],[.516,.087],[3.115,3.74],[-3.837,-1.477],[-.02,1.755],[3.43,4.518],[1.874,3.154],[-3.342,1.113],[-.283,2.825],[3.516,5.324]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.231436187146,.400447022681,.341441554649,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[13.884,8.267],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 14",np:4,cix:2,bm:0,ix:14,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[-2.637,3.538],[2.637,-3.538]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[.800162221871,.915541884478,.902066518746,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:1.301,ix:5},lc:2,lj:1,ml:10,bm:0,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[22.509,13.632],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 15",np:2,cix:2,bm:0,ix:15,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[-3.013,3.938],[3.013,-3.938]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[.800162221871,.915541884478,.902066518746,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:1.301,ix:5},lc:2,lj:1,ml:10,bm:0,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[22.863,14.876],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 16",np:2,cix:2,bm:0,ix:16,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[3.462,5.095],[-3.463,5.095],[-3.463,-5.095],[3.462,-5.095]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.800162221871,.915541884478,.902066518746,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[22.898,18.724],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 17",np:4,cix:2,bm:0,ix:17,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-4,-7.738],[4,-7.738],[4,7.738],[-4,7.738]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.702359307981,.876050163718,.851058660769,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[22.898,16.471],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 18",np:4,cix:2,bm:0,ix:18,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[9.784,.202],[-9.784,.202],[-9.784,-.202],[9.784,-.202]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.85749021044,.941752893784,.95355164771,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[45.536,13.431],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 19",np:4,cix:2,bm:0,ix:19,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[5.337,0],[0,0],[0,5.338],[0,0],[0,0],[0,0]],o:[[0,0],[-5.337,0],[0,0],[0,0],[0,0],[0,5.338]],v:[[.001,5.782],[.001,5.782],[-9.665,-3.883],[-9.665,-5.782],[9.665,-5.782],[9.665,-3.883]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.589915017521,.776821420707,.782229554419,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[45.568,19.179],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 20",np:4,cix:2,bm:0,ix:20,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.043,-.046],[.318,-1.062],[0,0],[-1.019,.441],[-.063,.034],[-.059,.04],[-.058,.106],[.168,.124],[.253,-.036],[.212,-.049],[.02,.055],[-.846,.279],[-.263,.051],[-.172,-.005],[-.154,-.11],[-.036,-.2],[.097,-.167],[.311,-.134],[.819,-.138],[0,0],[0,0]],o:[[.043,.045],[0,0],[.77,-.183],[.078,-.032],[.07,-.031],[.116,-.081],[.13,-.21],[-.168,-.131],[-.247,.034],[-.846,.204],[-.019,-.049],[.212,-.067],[.137,-.023],[.163,.007],[.154,.107],[.038,.201],[-.19,.345],[-1.049,.453],[0,0],[0,0],[.421,-1.121]],v:[[-1.228,-.579],[-1.684,1.255],[-1.861,1.051],[.914,.113],[1.128,.014],[1.316,-.098],[1.59,-.38],[1.51,-.947],[.849,-1.027],[.159,-.893],[-1.228,-.579],[.084,-1.165],[.794,-1.352],[1.228,-1.4],[1.725,-1.245],[2.038,-.762],[1.929,-.186],[1.072,.479],[-1.805,1.359],[-2.076,1.406],[-1.982,1.154]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[56.21,15.794],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 21",np:4,cix:2,bm:0,ix:21,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.043,.045],[-.42,-1.121],[0,0],[0,0],[1.05,.454],[.19,.347],[-.04,.2],[-.155,.106],[-.163,.005],[0,0],[0,0],[-.065,-.005],[-.208,-.075],[-.222,-.109],[.022,-.017],[.223,.059],[.4,.117],[.247,.005],[.066,.002],[0,0],[0,0],[.081,-.066],[-.128,-.21],[-.296,-.125],[-.77,-.183],[0,0]],o:[[.043,-.046],[0,0],[0,0],[-.821,-.138],[-.313,-.135],[-.095,-.169],[.037,-.201],[.155,-.11],[0,0],[0,0],[.067,.005],[.272,.021],[.421,.154],[.237,.117],[-.022,.017],[-.262,-.077],[-.211,-.056],[-.064,-.002],[0,0],[0,0],[-.108,.009],[-.169,.122],[.122,.219],[1.02,.443],[0,0],[-.319,-1.062]],v:[[1.228,-.581],[1.981,1.152],[2.076,1.402],[1.805,1.357],[-1.076,.475],[-1.933,-.193],[-2.036,-.771],[-1.719,-1.253],[-1.22,-1.402],[-1.099,-1.4],[-1,-1.393],[-.802,-1.376],[-.067,-1.206],[.899,-.792],[1.228,-.581],[.844,-.646],[-.151,-.938],[-.824,-1.046],[-1.02,-1.053],[-1.123,-1.057],[-1.207,-1.053],[-1.507,-.952],[-1.593,-.385],[-.918,.109],[1.86,1.049],[1.684,1.253]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[34.619,15.796],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 22",np:4,cix:2,bm:0,ix:22,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-14.547,-.924],[14.547,-.924],[14.547,.924],[-14.547,.924]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[47.64,25.859],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 23",np:2,cix:2,bm:0,ix:23,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[35.501,.88],[-35.501,.88],[-35.501,-.881],[35.501,-.881]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.942020730411,.806368300494,.335119030522,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[46.752,27.61],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 24",np:2,cix:2,bm:0,ix:24,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0},{ddd:0,ind:3,ty:4,nm:"Shape Layer 6",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[482,520,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[41.54,30.042,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:16,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:40,s:[0]},{t:63.0000025660426,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:16.0000006516934,op:67.0000027289659,st:16.0000006516934,bm:0},{ddd:0,ind:4,ty:4,nm:"Shape Layer 5",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[482,520,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[41.54,30.042,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:133,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:157,s:[0]},{t:180.00000733155,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:133.000005417201,op:184.000007494474,st:133.000005417201,bm:0},{ddd:0,ind:5,ty:4,nm:"Shape Layer 4",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[534,652,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[58.824,42.542,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:114,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:138,s:[0]},{t:161.000006557664,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:114.000004643315,op:165.000006720588,st:114.000004643315,bm:0},{ddd:0,ind:6,ty:4,nm:"Shape Layer 3",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[462,690,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[82.353,59.559,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:84,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:108,s:[0]},{t:131.000005335739,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:84.0000034213901,op:135.000005498663,st:84.0000034213901,bm:0},{ddd:0,ind:7,ty:4,nm:"Shape Layer 7",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[534,520,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[48.453,35.042,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:42,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:66,s:[0]},{t:89.0000036250443,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:42.0000017106951,op:93.0000037879676,st:42.0000017106951,bm:0},{ddd:0,ind:8,ty:4,nm:"Shape Layer 2",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[552,676,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[58.824,42.542,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:30,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:54,s:[0]},{t:77.0000031362743,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:30.0000012219251,op:81.0000032991976,st:30.0000012219251,bm:0},{ddd:0,ind:9,ty:4,nm:"Shape Layer 1",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[462,690,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[82.353,59.559,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:0,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:24,s:[0]},{t:47.0000019143492,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:51.0000020772726,st:0,bm:0},{ddd:0,ind:10,ty:4,nm:"KC Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[496,670,0],ix:2,l:2},a:{a:0,k:[10.303,22.837,0],ix:1,l:2},s:{a:0,k:[1224.359,1224.359,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.023,.022],[.082,.457],[.72,.417],[.493,.095],[.594,.051],[.661,.192],[.551,.548],[.131,.362],[0,0],[0,0],[-.167,.043],[-.125,-.035],[-.101,-.097],[-.019,-.167],[.176,-.146],[.209,-.022],[.248,.176],[.211,.169],[.674,.391],[-.021,.112],[-.448,-.065],[-.739,-.358],[-.855,-.649],[-.32,.051],[-.05,.046],[-.007,.018],[-.002,.008],[-.002,.004],[0,0],[0,0],[.039,.002],[0,0],[0,0],[.024,-.013],[.012,.001],[.023,.007],[.006,.001],[.003,.009],[.009,.021],[-.091,-.028],[0,0],[-.222,-.221],[-.58,-.177],[-.59,-.073],[-.829,-.545],[-.01,-.552]],o:[[-.057,-.022],[-.082,-.445],[-.348,-.2],[-.498,-.096],[-.59,-.056],[-.653,-.191],[-.285,-.284],[0,0],[0,0],[.039,-.171],[.167,-.053],[.125,.037],[.101,.094],[.032,.309],[-.18,.146],[-.452,.028],[-.245,-.186],[-.824,-.672],[-1.348,-.791],[.004,-.038],[.448,.062],[.741,.355],[.424,.306],[.081,-.01],[.026,-.022],[.004,-.008],[0,-.004],[0,0],[0,0],[-.009,0],[0,0],[0,0],[.002,-.001],[-.026,.018],[-.009,-.009],[-.012,-.002],[-.003,-.001],[-.003,-.022],[-.026,-.078],[0,0],[.098,.265],[.425,.427],[.579,.179],[1.172,.129],[.811,.548],[.001,.564]],v:[[7.036,3.92],[7.035,3.175],[5.848,1.687],[4.546,1.251],[2.902,1.057],[1.003,.754],[-.881,-.289],[-1.525,-1.285],[-1.56,-1.383],[-1.532,-1.502],[-1.152,-1.895],[-.719,-1.897],[-.379,-1.702],[-.171,-1.297],[-.471,-.602],[-1.062,-.364],[-2.074,-.722],[-2.723,-1.245],[-4.969,-2.872],[-7.286,-3.878],[-6.583,-3.877],[-4.749,-3.286],[-2.34,-1.734],[-1.126,-1.03],[-.908,-1.122],[-.859,-1.184],[-.851,-1.208],[-.85,-1.22],[-.85,-1.222],[-.85,-1.223],[-.805,-1.222],[-.805,-1.221],[-.799,-1.221],[-.833,-1.207],[-.853,-1.204],[-.909,-1.233],[-.936,-1.237],[-.941,-1.24],[-.954,-1.299],[-.921,-1.325],[-.872,-1.525],[-.383,-.782],[1.199,.097],[2.971,.416],[6.109,1.268],[7.305,3.147]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[25.25,33.084],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.02,.082],[-1.456,.72],[-.294,.308],[-.057,.089],[-.018,.067],[.002,.004],[.085,.003],[.09,-.034],[.107,-.064],[.232,-.178],[.5,-.382],[.067,-.051],[0,0],[-.395,.944],[0,0],[-.008,.03],[-.001,-.006],[-.045,-.01],[.023,-.008],[.043,-.032],[.083,-.073],[.232,-.307],[.226,-.382],[.044,.019],[-.151,.424],[-.441,.701],[-.37,.339],[-.101,.083],[-.093,.04],[-.173,-.071],[-.012,-.129],[.02,-.089],[.021,-.064],[0,0],[.861,-.942],[0,0],[-.073,.056],[-.474,.359],[-.272,.15],[-.17,.062],[-.189,-.011],[-.169,-.215],[.066,-.167],[.084,-.12],[.099,-.094],[.388,-.165]],o:[[-.03,-.104],[.355,-.182],[.073,-.077],[.057,-.086],[.02,-.074],[.004,-.001],[-.084,-.003],[-.091,.037],[-.224,.131],[-.472,.362],[-.073,.056],[0,0],[.802,-.873],[0,0],[.024,-.06],[.012,-.036],[-.005,.003],[.055,.019],[-.021,.008],[-.091,.068],[-.34,.279],[-.462,.619],[-.223,.385],[-.043,-.02],[.154,-.422],[.222,-.349],[.089,-.088],[.051,-.042],[.09,-.039],[.163,.058],[.02,.133],[-.024,.095],[0,0],[-.387,1.025],[0,0],[.067,-.052],[.502,-.379],[.24,-.178],[.141,-.077],[.174,-.058],[.181,.018],[.165,.208],[-.063,.178],[-.084,.118],[-.4,.375],[-1.562,.628]],v:[[-2.026,2.324],[.383,1.201],[1.412,.495],[1.609,.247],[1.742,-.012],[1.74,-.096],[1.609,-.128],[1.332,-.079],[1.006,.085],[.328,.559],[-1.13,1.678],[-1.343,1.84],[-1.813,1.327],[-.025,-1.469],[.047,-1.646],[.105,-1.796],[.119,-1.861],[.197,-1.775],[.248,-1.768],[.154,-1.712],[-.112,-1.508],[-.961,-.605],[-1.952,.965],[-2.358,1.54],[-2.194,.852],[-1.361,-.883],[-.489,-1.939],[-.197,-2.189],[.022,-2.322],[.436,-2.335],[.727,-1.958],[.709,-1.641],[.639,-1.424],[.568,-1.232],[-1.297,1.799],[-1.766,1.285],[-1.553,1.122],[-.086,.014],[.676,-.495],[1.113,-.699],[1.65,-.771],[2.236,-.486],[2.327,.178],[2.099,.59],[1.82,.906],[.59,1.65]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[26.03,30.112],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.052,-.067],[.378,-.874],[.406,-1.445],[.194,.036],[-.812,2.916],[-.544,.882]],o:[[.075,.077],[-.393,.863],[-.803,2.881],[-.186,-.034],[.408,-1.445],[.53,-.889]],v:[[1.768,-5.097],[1.061,-3.693],[-.066,-.076],[-1.658,5.128],[-.74,-.264],[.622,-3.921]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[7.225,5.987],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,84.544],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:2,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.195,.027],[-.558,2.513],[-.181,-.056],[.547,-2.484]],o:[[-.187,-.025],[.554,-2.515],[.188,.058],[-.552,2.482]],v:[[-1,4.533],[-.501,-.096],[.999,-4.504],[.182,.055]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[17.624,6.314],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,85.892],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:2,cix:2,bm:0,ix:4,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-8.269,-16.731],[3.045,-16.953],[4.154,2.348],[11.919,16.768],[-11.919,16.953],[-11.027,4.783]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.308235318053,.185718865488,.029252067267,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 2",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"fl",c:{a:0,k:[.308235318053,.185718865488,.029252067267,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[13.684,27.153],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:3,cix:2,bm:0,ix:5,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0},{ddd:0,ind:11,ty:4,nm:"tshirt Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[556,604,0],ix:2,l:2},a:{a:0,k:[11.5,14,0],ix:1,l:2},s:{a:0,k:[1373.215,1457.36,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0],[.08,-.09],[.05,-.059],[0,0],[-.08,.02],[-.56,0],[-.17,-.01],[0,0],[-2.27,-.21],[-.045,.103],[0,0],[0,0],[0,0],[.19,.021]],o:[[0,0],[0,0],[0,0],[-.08,.09],[-.05,.05],[0,0],[.08,-.031],[.71,-.219],[.2,0],[0,0],[.22,.779],[1.59,.149],[0,0],[0,0],[0,0],[-.3,-.04],[0,0]],v:[[2.975,2.332],[10.153,19.034],[-12.271,19.906],[-12.882,19.586],[-7.296,.711],[-7.296,.711],[-7.933,-12.294],[-7.703,-12.365],[-6.47,-12.655],[-5.92,-12.635],[-3.693,-12.424],[-.859,-10.1],[2.611,-11.841],[4.155,-12.498],[7.063,-12.338],[2.935,1.952],[2.935,1.952]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.942710487515,.347555332558,.257082142549,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[9.953,14.526],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0},{ddd:0,ind:12,ty:4,nm:"hand1 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:1,k:[{i:{x:[.833],y:[1]},o:{x:[.167],y:[.167]},t:10,s:[0]},{i:{x:[.833],y:[.938]},o:{x:[.167],y:[0]},t:30,s:[-14]},{i:{x:[.833],y:[2.491]},o:{x:[.167],y:[1.464]},t:71,s:[0]},{i:{x:[.833],y:[1]},o:{x:[.167],y:[.06]},t:140,s:[0]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[0]},t:179,s:[-14]},{t:210.000008553475,s:[0]}],ix:10},p:{a:0,k:[448,460,0],ix:2,l:2},a:{a:0,k:[25.542,17.296,0],ix:1,l:2},s:{a:0,k:[694.636,694.636,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.018,.073],[-.433,.033],[-.118,.01],[-.039,-.012],[.021,-.047],[.075,-.033],[.209,-.021]],o:[[-.018,-.069],[.214,-.02],[.117,-.003],[.015,.008],[-.02,.049],[-.151,.067],[-.415,.032]],v:[[-.742,.121],[.008,-.123],[.533,-.145],[.738,-.182],[.738,-.098],[.585,.035],[.031,.142]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[9.865,15.034],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[.018,.923],[-.341,.196],[-.107,-.401],[0,0],[.605,-.7],[0,0],[.143,-.275],[0,0],[-.216,-1.579],[0,0]],o:[[-.379,-1.524],[-.016,-.814],[1.408,-.812],[.087,.328],[0,0],[-.323,.373],[0,0],[-.255,.488],[0,0],[.157,1.148],[0,0]],v:[[-2.528,3.295],[-2.953,-1.622],[-2.099,-2.986],[2.278,-3.985],[-.106,-2.857],[2.364,-2.663],[.313,-2.144],[2.046,-1.671],[.248,-1.25],[1.206,.953],[-.992,4.386]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.985606414197,.768474563898,.65874077292,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[10.351,16.075],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.11,.241],[-.286,-.306],[-1.49,-2.398],[0,0],[0,0],[2.32,2.076],[0,0],[3.391,2.803]],o:[[.174,-.381],[1.322,1.407],[2.112,3.399],[0,0],[0,0],[-1.756,-1.571],[0,0],[-.205,-.169]],v:[[-8.162,-9.56],[-7.198,-9.719],[-1.422,-2.374],[2.089,3.253],[8.272,8.593],[3.338,7.949],[.765,3.598],[-8.005,-8.867]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.436724404728,.356003615435,.281163144579,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[13.538,16.769],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:2,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.192,-.159],[-.003,.41],[.534,-.6]],o:[[.286,-.301],[.004,-.724],[.224,.143]],v:[[-.249,1.176],[.878,-.451],[-.883,.725]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.972558414235,.642884018842,.502590284161,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[10.793,11.983],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:2,cix:2,bm:0,ix:4,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.108,.028],[-.668,2.188],[-.101,-.037],[.663,-2.182]],o:[[-.105,-.026],[.666,-2.192],[.106,.037],[-.665,2.179]],v:[[-1.206,3.958],[-.268,-.077],[1.204,-3.95],[.113,.04]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[10.47,26.425],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:2,cix:2,bm:0,ix:5,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[.474,-1.203],[0,0],[0,0],[4.94,0],[-4.81,9.181],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[-.07,.101],[-1.15,1.42],[-.32,.38],[-.48,.51],[-1.37,-.12]],o:[[0,0],[1.29,.094],[0,0],[0,0],[-4.24,4.47],[-2.86,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[.08,-.1],[1.35,-1.75],[.35,-.41],[2.07,-2.52],[2.14,-2.231],[0,0]],v:[[11.266,-12.46],[11.266,-12.46],[12.91,-9.845],[10.229,-3.038],[8.516,.75],[-8.395,12.57],[-8.574,-3.731],[-7.895,-3.65],[-3.064,-3.061],[-2.514,-2.99],[-2.674,-2.44],[-2.674,-2.43],[-3.624,.95],[-3.395,.649],[.396,-4.13],[1.385,-5.32],[5.445,-10.08],[11.266,-12.45]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.980392216701,.654901960784,.239215701234,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[14.156,25.207],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 6",np:2,cix:2,bm:0,ix:6,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-2.505,2.066],[-.993,-2.624],[2.505,-1.432],[2.346,2.624]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.985606414197,.768474563898,.65874077292,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[8.745,19.546],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 7",np:2,cix:2,bm:0,ix:7,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0},{ddd:0,ind:13,ty:4,nm:"hand Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:1,k:[{i:{x:[.833],y:[1.012]},o:{x:[.167],y:[.167]},t:10,s:[0]},{i:{x:[.833],y:[1]},o:{x:[.167],y:[.013]},t:23,s:[-12]},{i:{x:[.833],y:[.989]},o:{x:[.167],y:[0]},t:40,s:[2]},{i:{x:[.833],y:[1]},o:{x:[.167],y:[-.015]},t:70,s:[-12]},{i:{x:[.833],y:[1.012]},o:{x:[.167],y:[0]},t:104,s:[0]},{i:{x:[.833],y:[.953]},o:{x:[.167],y:[.013]},t:117,s:[-12]},{i:{x:[.833],y:[.149]},o:{x:[.167],y:[-.673]},t:134,s:[2]},{i:{x:[.833],y:[1.009]},o:{x:[.167],y:[.053]},t:169,s:[0]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.016]},t:182,s:[-12]},{t:210.000008553475,s:[2]}],ix:10},p:{a:0,k:[618,468,0],ix:2,l:2},a:{a:0,k:[4.382,27.179,0],ix:1,l:2},s:{a:0,k:[690.078,690.078,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.08,-.07],[.78,.45],[0,.12],[0,0],[-.2,-.03],[-.51,-.301]],o:[[-.08,.08],[-.76,-.451],[0,0],[.01,-.04],[.31,.05],[.84,.489]],v:[[1.395,.83],[-.025,-.03],[-1.475,-.851],[-1.475,-.86],[-1.135,-.88],[.175,-.38]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[18.85,24.454],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.05,0],[.45,.931],[-.08,.08],[-.01,0],[-.23,-.22],[-.24,-.52],[-.01,-.37]],o:[[-.12,0],[-.43,-.96],[0,-.01],[.07,0],[.27,.25],[.23,.51],[.02,.37]],v:[[.795,1.74],[.155,-.071],[-.815,-1.73],[-.795,-1.74],[-.305,-1.41],[.525,-.24],[.875,1.15]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[17.509,25.384],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.08,-.07],[.78,.45],[0,.12],[-.11,.02],[-.51,-.301]],o:[[-.08,.08],[-.76,-.451],[.12,0],[.31,.05],[.84,.489]],v:[[1.395,.815],[-.025,-.045],[-1.475,-.866],[-1.135,-.895],[.175,-.395]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.942710487515,.347555332558,.257082142549,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[18.85,24.469],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:2,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.01,-.37],[.05,0],[.45,.931],[-.08,.08],[-.01,0],[-.23,-.219],[-.24,-.519]],o:[[.02,.37],[-.12,0],[-.43,-.96],[0,-.011],[.07,0],[.27,.25],[.23,.511]],v:[[.875,1.15],[.795,1.74],[.155,-.07],[-.815,-1.73],[-.795,-1.74],[-.305,-1.411],[.525,-.24]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.942710487515,.347555332558,.257082142549,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[17.509,25.384],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:2,cix:2,bm:0,ix:4,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-1.561,-1.339],[.512,-1.321],[3.378,-2.096],[4.406,.418],[.286,1.448],[0,0],[-2.639,.537],[-4.33,.151],[0,-.011],[-.431,-.96],[-.119,0],[.02,.37],[.23,.511],[.27,.25],[.071,0],[-.209,.021],[-.76,-.451],[-.08,.08],[.84,.489],[.31,.05],[-.549,.26],[-1.564,2.58]],o:[[1.075,.923],[-1.429,3.689],[-3.289,2.028],[-1.469,-.139],[0,0],[-1.85,-1.955],[2.009,-.09],[-.009,0],[-.08,.08],[.449,.931],[.05,0],[-.01,-.37],[-.241,-.519],[-.23,-.219],[.23,-.009],[0,.12],[.78,.45],[.079,-.07],[-.509,-.301],[.77,-.08],[2.082,-.978],[1.067,-1.758]],v:[[14.605,-8.695],[15.548,-4.958],[7.615,8.005],[-8.247,9.176],[-13.059,7.398],[-14.615,5.064],[-11.895,-1.865],[.654,-.546],[.635,-.535],[1.605,1.124],[2.245,2.936],[2.325,2.346],[1.975,.954],[1.146,-.215],[.654,-.546],[1.314,-.585],[2.764,.236],[4.186,1.096],[2.965,-.115],[1.654,-.615],[3.654,-1.105],[9.585,-7.906]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.980392216701,.654901960784,.239215701234,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[16.059,24.189],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:4,cix:2,bm:0,ix:5,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[6.865,-5.361],[2.371,-.85],[.445,2.622],[-1.907,1.299],[-.965,1.886],[-.048,.099],[0,0],[-.1,.299],[0,0],[-.093,-1.255],[0,0],[-.652,-.144],[.388,-.451],[0,0],[-.596,-.289],[.71,-.729],[0,0],[-.292,-.157],[.341,-.69],[-.095,-.445],[.873,-2.244],[.098,-.281],[0,0]],o:[[-1.942,1.516],[-.682,-2.58],[1.853,-.383],[2.898,-1.975],[.048,-.099],[0,0],[0,0],[.252,-.75],[0,0],[.092,1.256],[0,0],[.243,.055],[-.387,.449],[0,0],[0,0],[-.985,1.011],[0,0],[.486,.259],[0,0],[.091,.426],[-.065,.22],[0,0],[0,0]],v:[[-2.185,10.463],[-9.046,13.991],[-10.773,6.192],[-4.989,3.815],[2.732,-7.339],[2.877,-7.636],[2.87,-7.639],[3.718,-9.918],[4.277,-12.523],[4.918,-11.449],[5.227,-10.566],[8.155,-13.847],[7.762,-12.559],[6.974,-11.407],[9.79,-13.572],[9.376,-12.654],[7.744,-10.723],[10.287,-12.523],[8.152,-9.578],[9.932,-10.722],[7.226,-6.375],[6.982,-5.622],[6.983,-5.623]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.985606414197,.768474563898,.65874077292,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[25.793,18.914],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 6",np:2,cix:2,bm:0,ix:6,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0},{ddd:0,ind:14,ty:4,nm:"face Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:1,k:[{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:10,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:26,s:[-8]},{i:{x:[.833],y:[.667]},o:{x:[.167],y:[0]},t:56,s:[5]},{i:{x:[.667],y:[1]},o:{x:[.167],y:[.063]},t:109,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:125,s:[-8]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[0]},t:155,s:[5]},{t:183.000007453743,s:[0]}],ix:10},p:{a:0,k:[517.87,475.474,0],ix:2,l:2},a:{a:0,k:[8.573,24.351,0],ix:1,l:2},s:{a:0,k:[920.358,920.358,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.029,-3.684],[-4.085,2.337],[-3.963,2.856],[-.591,-.176],[0,0],[3.321,1.146]],o:[[0,0],[0,0],[0,0],[0,0],[0,0],[-3.32,-1.147]],v:[[-5.445,-1.27],[1.66,-2.955],[4.146,2.136],[5.288,1.89],[5.445,1.941],[1.903,-4.602]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[9.162,6.131],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.068,-.187],[.331,-.114],[.069,.187],[-.332,.114]],o:[[.068,.187],[-.332,.115],[-.068,-.188],[.331,-.115]],v:[[.6,-.208],[.124,.339],[-.6,.208],[-.123,-.339]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[4.026,5.924],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.03,-.196],[.348,.055],[-.03,.195],[-.348,-.055]],o:[[-.03,.195],[-.349,-.055],[.03,-.197],[.348,.055]],v:[[.63,.1],[-.055,.355],[-.631,-.098],[.055,-.355]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[8.83,6.348],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:2,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[-.02,-.239],[-.034,-.095],[-.025,.001],[-.08,.068],[-.074,.093],[-.131,.212],[0,0],[-.062,-.038],[.018,-.056],[.153,-.233],[.118,-.105],[.089,-.036],[.112,.034],[.057,.079],[.021,.076],[-.003,.139],[-.079,.26],[-.059,-.019],[.002,-.05]],o:[[-.009,.25],[.013,.119],[.034,.099],[.016,.009],[.08,-.063],[.146,-.189],[0,0],[.039,-.062],[.053,.033],[-.082,.26],[-.076,.117],[-.061,.052],[-.089,.037],[-.111,-.03],[-.058,-.08],[-.041,-.154],[.006,-.28],[.018,-.059],[.05,.014],[0,0]],v:[[-.447,-.758],[-.438,-.012],[-.374,.318],[-.268,.462],[-.102,.385],[.128,.139],[.544,-.478],[.548,-.482],[.73,-.525],[.786,-.372],[.445,.365],[.163,.699],[-.057,.837],[-.378,.859],[-.641,.674],[-.753,.437],[-.801,.001],[-.667,-.801],[-.527,-.874],[-.447,-.764]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[3.903,7.829],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:2,cix:2,bm:0,ix:4,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[-.04,-.248],[-.137,-.033],[-.176,.179],[-.15,.215],[0,0],[-.06,-.042],[.022,-.056],[.198,-.232],[.151,-.087],[.198,.074],[.065,.156],[.009,.151],[-.079,.281],[-.059,-.017],[.002,-.051]],o:[[-.008,.265],[.038,.249],[.122,.054],[.175,-.178],[0,0],[.042,-.061],[.052,.036],[-.108,.273],[-.099,.114],[-.146,.084],[-.196,-.069],[-.069,-.158],[-.017,-.303],[.017,-.06],[.051,.013],[0,0]],v:[[-.616,-.813],[-.578,-.025],[-.301,.482],[.208,.232],[.7,-.378],[.704,-.383],[.888,-.417],[.936,-.26],[.493,.497],[.129,.807],[-.436,.872],[-.837,.48],[-.941,.014],[-.836,-.852],[-.698,-.93],[-.616,-.818]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[8.288,8.359],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:2,cix:2,bm:0,ix:5,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.116,.336],[.045,-.175],[.088,-.156],[.273,-.235],[0,0],[-.269,-.25],[.322,.162],[0,0],[0,0],[-.104,.129],[-.095,.135]],o:[[.045,.175],[-.046,.178],[-.182,.312],[0,0],[.296,.206],[-.348,-.12],[0,0],[0,0],[.105,-.125],[.102,-.134],[.194,-.272]],v:[[.592,-1.156],[.57,-.617],[.358,-.117],[-.324,.701],[-.35,.486],[.505,1.156],[-.491,.721],[-.637,.648],[-.517,.505],[-.204,.115],[.098,-.285]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[5.41,8.245],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 6",np:2,cix:2,bm:0,ix:6,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.062,.195],[-.159,-.063],[-.138,.002],[-.152,.07],[-.176,.107],[.156,-.15],[.243,.002],[.153,.143]],o:[[.192,.083],[.157,.067],[.138,.001],[.151,-.071],[-.034,.205],[-.15,.152],[-.243,0],[-.162,-.139]],v:[[-.928,-.365],[-.421,-.122],[.019,-.014],[.448,-.124],[.928,-.404],[.638,.139],[.018,.402],[-.598,.148]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[6.174,13.211],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 7",np:2,cix:2,bm:0,ix:7,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.26,-.175],[-.094,.127],[-.167,.064],[-.15,-.085],[-.058,-.144],[.122,.012],[.105,-.041]],o:[[.015,-.16],[.095,-.129],[.168,-.062],[.157,.077],[-.156,-.047],[-.119,-.015],[-.213,.076]],v:[[-.704,.398],[-.529,-.035],[-.135,-.337],[.389,-.299],[.704,.059],[.303,-.055],[-.023,-.023]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[14.148,9.554],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 8",np:2,cix:2,bm:0,ix:8,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.198,-.815],[.815,-.198],[.198,.815],[-.815,.198]],o:[[.198,.815],[-.816,.197],[-.198,-.816],[.815,-.198]],v:[[1.477,-.358],[.359,1.477],[-1.477,.359],[-.359,-1.476]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.985606414197,.768474563898,.65874077292,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[14.149,9.528],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 9",np:2,cix:2,bm:0,ix:9,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[-3.818,2.373],[3.884,-1.285]],o:[[0,0],[0,0],[0,0]],v:[[-2.827,-.517],[3.015,-2.213],[-3.015,2.213]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.721688364066,.479523094028,.467095109528,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[8.539,17.076],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 12",np:2,cix:2,bm:0,ix:10,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.497,3.139],[-4.946,-2.877],[-.316,-1.715],[0,0],[.243,5.732],[0,0]],o:[[.443,-2.796],[1.556,.906],[.221,1.195],[-.419,4.708],[0,0],[-3.583,-1.151]],v:[[-5.204,-5.157],[2.969,-9.751],[5.503,-5.48],[5.301,7.464],[-2.432,7.557],[-2.141,3.632]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.985606414197,.768474563898,.65874077292,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[7.853,12.927],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 13",np:4,cix:2,bm:0,ix:11,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-9.867,-1.823],[2.523,7.152]],o:[[0,0],[-1.641,-4.654]],v:[[2.951,7.533],[4.393,-2.88]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[9.581,8.291],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 14",np:2,cix:2,bm:0,ix:12,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,-1.703],[1.526,0],[0,1.703],[-1.525,0]],o:[[0,1.703],[-1.525,0],[0,-1.703],[1.526,0]],v:[[2.762,-.001],[-.922,5.066],[-2.762,-.001],[-.001,-3.083]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[14.597,14.618],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 15",np:2,cix:2,bm:0,ix:13,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0}],markers$1=[],cookingAnimation={v:v$1,fr:fr$1,ip:ip$1,op:op$1,w:w$1,h:h$1,nm:nm$1,ddd:ddd$1,assets:assets$1,layers:layers$1,markers:markers$1};function LoadingAnimation({message:e="Cooking up something delicious...",className:i="",fullScreen:s=!0,speed:a=2}){const b=reactExports.useRef(null);reactExports.useEffect(()=>{b.current&&b.current.setSpeed(a)},[a]);const et=jsxRuntimeExports.jsxs("div",{className:`flex flex-col items-center justify-center ${i}`,children:[jsxRuntimeExports.jsx("div",{className:"w-64 h-64",children:jsxRuntimeExports.jsx(Lottie,{lottieRef:b,animationData:cookingAnimation,loop:!0})}),e&&jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mt-4 font-medium animate-pulse",children:e})]});return s?jsxRuntimeExports.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background safe-top safe-bottom",children:et}):et}function HomePage(){const{kitchens:e,loading:i,error:s}=useKitchens(),{user:a,loading:b}=useAuth(),{userLocation:et,locationLoading:nt,isInServiceArea:c,checkingZone:ct,currentFranchiseId:pt,refetchLocation:xt}=useLocationContext(),St=useNavigate(),[Et,Rt]=reactExports.useState("all"),[Nt,It]=reactExports.useState(""),[Gt,Dt]=reactExports.useState(!0),Bt=reactExports.useRef(0);reactExports.useEffect(()=>{const Vt=()=>{const Zt=window.scrollY;Zt<10?Dt(!0):Zt>Bt.current&&Zt>50?Dt(!1):Zt<Bt.current&&Dt(!0),Bt.current=Zt};return window.addEventListener("scroll",Vt,{passive:!0}),()=>window.removeEventListener("scroll",Vt)},[]),reactExports.useEffect(()=>{!b&&a&&(a.role==="amma"?St("/amma/dashboard"):a.role==="admin"?St("/admin"):a.role==="super_admin"?St("/super-admin"):a.role==="franchise_admin"&&a.franchiseId&&St("/admin"))},[a,b,St]);const Lt=e.filter(Vt=>{if(!Vt.isApproved||pt&&Vt.franchiseId!==pt||Et==="veg"&&!Vt.isVeg||Et==="open"&&!Vt.isOpen)return!1;if(Nt){const Zt=Nt.toLowerCase();return Vt.name.toLowerCase().includes(Zt)||Vt.specialties.some(nr=>nr.toLowerCase().includes(Zt))}return!0});return ct?jsxRuntimeExports.jsx(LoadingAnimation,{message:"Finding your location..."}):c?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsx(motion.header,{initial:{y:0},animate:{y:Gt?0:"-100%"},transition:{duration:.3},className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"px-4 py-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsxs(motion.button,{whileTap:{scale:.98},onClick:()=>St("/location-select"),className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:nt?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 text-primary animate-spin"}):jsxRuntimeExports.jsx(MapPin,{className:"w-5 h-5 text-primary"})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Deliver to"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-foreground max-w-[180px] truncate",children:nt?"Finding location...":(et==null?void 0:et.address)||"Set location"}),jsxRuntimeExports.jsx(ChevronDown,{className:"w-4 h-4 text-muted-foreground"})]})]})]}),jsxRuntimeExports.jsxs(Button,{variant:"ghost",size:"icon",className:"relative",children:[jsxRuntimeExports.jsx(Bell,{className:"w-5 h-5"}),jsxRuntimeExports.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 rounded-full bg-primary"})]})]}),jsxRuntimeExports.jsx(Link,{to:"/search",children:jsxRuntimeExports.jsxs(motion.div,{whileTap:{scale:.99},className:"relative",children:[jsxRuntimeExports.jsx(Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Search Biryani or Amma's Kitchen",value:Nt,onChange:Vt=>It(Vt.target.value),className:"w-full pl-12 pr-4 py-3 rounded-xl bg-secondary border-0 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20"})]})})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 pt-4 pb-2",children:jsxRuntimeExports.jsx(Categories,{onSelectCategory:Vt=>It(Vt),selectedCategory:Nt})}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4 flex gap-2 overflow-x-auto hide-scrollbar",children:[{id:"all",label:"All"},{id:"open",label:" Open Now"},{id:"veg",label:" Pure Veg"}].map(Vt=>jsxRuntimeExports.jsx(motion.button,{whileTap:{scale:.95},onClick:()=>Rt(Vt.id),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${Et===Vt.id?"gradient-primary text-primary-foreground":"bg-secondary text-secondary-foreground"}`,children:Vt.label},Vt.id))}),jsxRuntimeExports.jsxs("div",{className:"px-4 mb-3",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Kitchens Near You"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Order homemade food from loving Ammas"})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 space-y-4",children:[i?jsxRuntimeExports.jsx(LoadingAnimation,{fullScreen:!1,className:"py-12"}):s?jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsx("p",{className:"text-destructive",children:s})}):Lt.map((Vt,Zt)=>jsxRuntimeExports.jsx(KitchenCard,{kitchen:Vt,index:Zt},Vt.id)),Lt.length===0&&!i&&!s&&jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No kitchens found"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Be the first Amma to register your kitchen!"})]})]}),jsxRuntimeExports.jsx(BottomNav,{})]}):jsxRuntimeExports.jsx(OutOfZoneScreen,{})}function DishCard({dish:e,kitchenId:i,kitchenName:s}){const{cart:a,addToCart:b,updateQuantity:et,removeFromCart:nt}=useCart(),c=a.items.find(Et=>Et.dish.id===e.id),ct=(c==null?void 0:c.quantity)||0,pt=()=>{b(e,i,s)},xt=()=>{et(e.id,ct+1)},St=()=>{ct<=1?nt(e.id):et(e.id,ct-1)};return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"flex gap-4 p-4 bg-card rounded-xl shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[jsxRuntimeExports.jsx("div",{className:cn("w-4 h-4 border-2 rounded-sm flex items-center justify-center",e.isVeg?"border-veg":"border-non-veg"),children:jsxRuntimeExports.jsx("div",{className:cn("w-2 h-2 rounded-full",e.isVeg?"bg-veg":"bg-non-veg")})}),e.isVeg&&jsxRuntimeExports.jsx("span",{className:"text-xs text-veg font-medium",children:"Pure Veg"})]}),jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground text-base mb-1 truncate",children:e.name}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground text-sm mb-2 line-clamp-2",children:e.description}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"font-bold text-foreground",children:["",e.price]}),e.originalPrice&&e.originalPrice>e.price&&jsxRuntimeExports.jsxs("span",{className:"text-sm text-muted-foreground line-through",children:["",e.originalPrice]})]}),e.tags&&e.tags.length>0&&jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:e.tags.slice(0,2).map(Et=>jsxRuntimeExports.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-secondary text-secondary-foreground",children:Et},Et))})]}),jsxRuntimeExports.jsxs("div",{className:"relative flex-shrink-0",children:[jsxRuntimeExports.jsx("img",{src:e.image,alt:e.name,className:"w-24 h-24 rounded-xl object-cover",loading:"lazy"}),e.isAvailable?jsxRuntimeExports.jsx("div",{className:"absolute -bottom-3 left-1/2 -translate-x-1/2",children:jsxRuntimeExports.jsx(AnimatePresence,{mode:"wait",children:ct===0?jsxRuntimeExports.jsx(motion.div,{initial:{scale:.8},animate:{scale:1},exit:{scale:.8},children:jsxRuntimeExports.jsx(Button,{onClick:pt,size:"sm",className:"gradient-primary text-primary-foreground font-semibold px-6 rounded-lg shadow-soft",children:"ADD"})},"add"):jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.8},animate:{scale:1},exit:{scale:.8},className:"flex items-center gap-1 bg-primary rounded-lg shadow-soft",children:[jsxRuntimeExports.jsx(Button,{onClick:St,size:"icon",variant:"ghost",className:"h-8 w-8 text-primary-foreground hover:bg-primary/80",children:jsxRuntimeExports.jsx(Minus,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("span",{className:"font-bold text-primary-foreground px-2 min-w-[24px] text-center",children:ct}),jsxRuntimeExports.jsx(Button,{onClick:xt,size:"icon",variant:"ghost",className:"h-8 w-8 text-primary-foreground hover:bg-primary/80",children:jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4"})})]},"quantity")})}):jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-muted/90 text-muted-foreground text-xs text-center py-1 rounded-b-xl",children:"Sold Out"})]})]})}function KitchenPage(){var Lt;const{id:e}=useParams(),{kitchen:i,loading:s,error:a}=useKitchen(e),{dishes:b,loading:et}=useDishes(e),{cart:nt,getTotal:c,getItemCount:ct}=useCart(),{user:pt,toggleFavorite:xt}=useAuth(),{userLocation:St}=useLocationContext(),[Et,Rt]=reactExports.useState(!1),Nt=e&&((Lt=pt==null?void 0:pt.favorites)==null?void 0:Lt.includes(e));reactExports.useEffect(()=>{const Vt=()=>{Rt(window.scrollY>200)};return window.addEventListener("scroll",Vt),()=>window.removeEventListener("scroll",Vt)},[]);const It=async()=>{if(navigator.share)try{await navigator.share({title:i==null?void 0:i.name,text:`Check out ${i==null?void 0:i.name} on Amma Cheythi Vanta!`,url:window.location.href})}catch(Vt){console.error("Error sharing:",Vt)}else navigator.clipboard.writeText(window.location.href),alert("Link copied to clipboard!")},Gt=async Vt=>{if(Vt.stopPropagation(),!!e){if(!pt){alert("Please login to add favorites");return}await xt(e)}};if(s)return jsxRuntimeExports.jsx(LoadingAnimation,{});if(a||!i)return jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background px-4",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"Kitchen not found"}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Go Back Home"})})]});const Dt=St&&i.address.lat&&i.address.lng?calculateDistance(St.lat,St.lng,i.address.lat,i.address.lng):`${i.address.line1}, ${i.address.city}`,Bt=[...new Set(b.map(Vt=>Vt.category))];return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-32",children:[jsxRuntimeExports.jsx(AnimatePresence,{children:Et&&jsxRuntimeExports.jsxs(motion.div,{initial:{y:-100},animate:{y:0},exit:{y:-100},transition:{type:"spring",stiffness:300,damping:30},className:"fixed top-0 left-0 right-0 z-50 bg-background/95 backdrop-blur-md shadow-sm border-b border-border px-4 py-2 flex items-center justify-between safe-top",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",className:"h-9 w-9 -ml-2 rounded-full hover:bg-muted",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 text-foreground"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-foreground truncate max-w-[200px]",children:i.name})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full hover:bg-muted",onClick:It,children:jsxRuntimeExports.jsx(Share2,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full hover:bg-muted",onClick:Gt,children:jsxRuntimeExports.jsx(Heart,{className:cn("w-5 h-5",Nt?"fill-red-500 text-red-500":"")})})]})]})}),jsxRuntimeExports.jsxs("div",{className:"relative h-56",children:[jsxRuntimeExports.jsx("img",{src:i.coverImage||i.image,alt:i.name,className:"w-full h-full object-cover"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background via-transparent to-transparent"}),jsxRuntimeExports.jsxs("div",{className:"absolute top-4 left-4 right-4 flex justify-between z-10",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-card/90 backdrop-blur-sm flex items-center justify-center shadow-soft cursor-pointer",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(motion.button,{whileTap:{scale:.9},onClick:It,className:"w-10 h-10 rounded-full bg-card/90 backdrop-blur-sm flex items-center justify-center shadow-soft",children:jsxRuntimeExports.jsx(Share2,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx(motion.button,{whileTap:{scale:.9},onClick:Gt,className:"w-10 h-10 rounded-full bg-card/90 backdrop-blur-sm flex items-center justify-center shadow-soft",children:jsxRuntimeExports.jsx(Heart,{className:cn("w-5 h-5 transition-colors",Nt?"fill-red-500 text-red-500":"")})})]})]})]}),jsxRuntimeExports.jsx("div",{className:"px-4 -mt-8 relative z-10",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl p-4 shadow-elevated",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.isVeg&&jsxRuntimeExports.jsx("div",{className:"p-1 rounded-full bg-veg/10",children:jsxRuntimeExports.jsx(Leaf,{className:"w-3 h-3 text-veg"})}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold text-foreground",children:i.name})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:i.specialties.join("  ")})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 px-2.5 py-1 rounded-lg bg-gold-soft",children:[jsxRuntimeExports.jsx(Star,{className:"w-4 h-4 text-gold fill-gold"}),jsxRuntimeExports.jsx("span",{className:"font-bold text-foreground",children:i.rating}),jsxRuntimeExports.jsxs("span",{className:"text-muted-foreground text-sm",children:["(",i.totalRatings,")"]})]})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:i.description}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5 text-muted-foreground",children:[jsxRuntimeExports.jsx(Clock,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:i.cookingTime})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5 text-muted-foreground",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:Dt})]})]}),jsxRuntimeExports.jsx("div",{className:cn("mt-4 px-3 py-2 rounded-lg text-sm font-medium text-center",i.isOpen?"bg-accent/10 text-accent":"bg-muted text-muted-foreground"),children:i.isOpen?" Kitchen is open and cooking!":" Kitchen is closed"})]})}),jsxRuntimeExports.jsxs("div",{className:"px-4 mt-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-foreground mb-4",children:"Menu"}),et?jsxRuntimeExports.jsx(LoadingAnimation,{fullScreen:!1,className:"py-12"}):b.length===0?jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No dishes available yet"})}):Bt.map(Vt=>jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide mb-3",children:Vt}),jsxRuntimeExports.jsx("div",{className:"space-y-4",children:b.filter(Zt=>Zt.category===Vt).map(Zt=>jsxRuntimeExports.jsx(DishCard,{dish:Zt,kitchenId:i.id,kitchenName:i.name},Zt.id))})]},Vt))]}),nt.items.length>0&&nt.kitchenId===i.id&&jsxRuntimeExports.jsx(motion.div,{initial:{y:100},animate:{y:0},className:"fixed bottom-0 left-0 right-0 p-4 bg-card/95 backdrop-blur-lg border-t border-border safe-bottom",children:jsxRuntimeExports.jsx(Link,{to:"/cart",children:jsxRuntimeExports.jsx(Button,{className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl shadow-elevated",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between w-full",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"bg-primary-foreground/20 px-2 py-0.5 rounded-md text-sm",children:[ct()," items"]}),jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"View Cart"})]}),jsxRuntimeExports.jsxs("span",{className:"font-bold",children:["",c()]})]})})})})]})}const Textarea=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx("textarea",{className:cn("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...i}));Textarea.displayName="Textarea";function CartPage(){var Et,Rt;const{cart:e,updateQuantity:i,removeFromCart:s,clearCart:a,getTotal:b,getItemCount:et,updateCookingInstructions:nt}=useCart(),c=Nt=>{var Dt,Bt;const It=((Dt=e.cookingInstructions)==null?void 0:Dt.tags)||[],Gt=It.includes(Nt)?It.filter(Lt=>Lt!==Nt):[...It,Nt];if(Gt.length>3){ue.error("You can select up to 3 instructions");return}nt(Gt,((Bt=e.cookingInstructions)==null?void 0:Bt.note)||"")},ct=Nt=>{var It;nt(((It=e.cookingInstructions)==null?void 0:It.tags)||[],Nt)},pt=30,xt=5,St=b()+pt+xt;return e.items.length===0?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 rounded-full bg-secondary flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx(ChefHat,{className:"w-12 h-12 text-muted-foreground"})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Your cart is empty"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-6",children:"Add delicious homemade food from nearby Ammas"}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground px-8",children:"Explore Kitchens"})})]}),jsxRuntimeExports.jsx(BottomNav,{})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-32",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Your Cart"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground",children:["from ",e.kitchenName]})]}),jsxRuntimeExports.jsxs(Button,{onClick:a,variant:"outline",size:"sm",className:"text-destructive border-destructive hover:bg-destructive hover:text-destructive-foreground",children:[jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4 mr-1"}),"Clear"]})]})}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[jsxRuntimeExports.jsx(AnimatePresence,{children:e.items.map((Nt,It)=>jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:It*.05},className:"flex gap-4 py-4 border-b border-border",children:[jsxRuntimeExports.jsx("div",{className:cn("w-4 h-4 border-2 rounded-sm flex items-center justify-center mt-1 flex-shrink-0",Nt.dish.isVeg?"border-veg":"border-non-veg"),children:jsxRuntimeExports.jsx("div",{className:cn("w-2 h-2 rounded-full",Nt.dish.isVeg?"bg-veg":"bg-non-veg")})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground truncate",children:Nt.dish.name}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground",children:["",Nt.dish.price]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 bg-secondary rounded-lg",children:[jsxRuntimeExports.jsx(Button,{onClick:()=>i(Nt.dish.id,Nt.quantity-1),size:"icon",variant:"ghost",className:"h-8 w-8",children:Nt.quantity===1?jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4 text-destructive"}):jsxRuntimeExports.jsx(Minus,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("span",{className:"font-semibold text-foreground px-2 min-w-[24px] text-center",children:Nt.quantity}),jsxRuntimeExports.jsx(Button,{onClick:()=>i(Nt.dish.id,Nt.quantity+1),size:"icon",variant:"ghost",className:"h-8 w-8",children:jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4"})})]}),jsxRuntimeExports.jsxs("span",{className:"font-semibold text-foreground min-w-[60px] text-right",children:["",Nt.dish.price*Nt.quantity]})]})]},Nt.dish.id))}),jsxRuntimeExports.jsx(Link,{to:`/kitchen/${e.kitchenId}`,children:jsxRuntimeExports.jsx(Button,{variant:"ghost",className:"w-full mt-4 text-primary",children:"+ Add more items"})})]}),jsxRuntimeExports.jsx("div",{className:"px-4 mt-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-3",children:"Cooking Instructions"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:["Less Spicy","More Spicy","No Onions","Extra Cutlery","Leave at Door","Quick","Other"].map(Nt=>{var It;return jsxRuntimeExports.jsx("button",{onClick:()=>c(Nt),className:cn("px-3 py-1.5 rounded-full text-xs font-medium border transition-all",(((It=e.cookingInstructions)==null?void 0:It.tags)||[]).includes(Nt)?"bg-primary/10 border-primary text-primary":"bg-background border-border text-muted-foreground hover:border-primary/50"),children:Nt},Nt)})}),(((Et=e.cookingInstructions)==null?void 0:Et.tags)||[]).includes("Other")&&jsxRuntimeExports.jsx(Textarea,{placeholder:"Please type your custom instructions here...",value:((Rt=e.cookingInstructions)==null?void 0:Rt.note)||"",onChange:Nt=>ct(Nt.target.value),className:"bg-secondary border-0 resize-none animate-in fade-in slide-in-from-top-2",rows:2})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 mt-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Bill Details"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Item Total"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",b()]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Delivery Fee"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",pt]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Platform Fee"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",xt]})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-border pt-2 mt-2",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between font-semibold",children:[jsxRuntimeExports.jsx("span",{className:"text-foreground",children:"To Pay"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",St]})]})})]})]})}),jsxRuntimeExports.jsx(motion.div,{initial:{y:100},animate:{y:0},className:"fixed bottom-[74px] left-0 right-0 p-4 bg-card/95 backdrop-blur-lg border-t border-border z-40",children:jsxRuntimeExports.jsx(Link,{to:"/checkout",children:jsxRuntimeExports.jsx(Button,{className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl shadow-elevated",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between w-full",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Proceed to Checkout"}),jsxRuntimeExports.jsxs("span",{className:"font-bold",children:["",St]})]})})})}),jsxRuntimeExports.jsx(BottomNav,{})]})}const Input=reactExports.forwardRef(({className:e,type:i,...s},a)=>jsxRuntimeExports.jsx("input",{type:i,className:cn("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:a,...s}));Input.displayName="Input";const RAZORPAY_KEY_ID="rzp_live_HJl9NwyBSY9rwV";function loadRazorpayScript(){return new Promise(e=>{if(window.Razorpay){e(!0);return}const i=document.createElement("script");i.src="https://checkout.razorpay.com/v1/checkout.js",i.onload=()=>e(!0),i.onerror=()=>e(!1),document.body.appendChild(i)})}async function initiatePayment(e,i,s,a,b,et){if(!await loadRazorpayScript())throw new Error("Failed to load Razorpay SDK");const c={key:RAZORPAY_KEY_ID,amount:e*100,currency:"INR",name:"Amma Cheythi Vanta",description:"Homemade food order payment",prefill:{name:i,email:s,contact:a},theme:{color:"#D97706"},handler:b,modal:{ondismiss:et}};new window.Razorpay(c).open()}function CheckoutPage(){var gr,rr,cr,Hr,$r,_n;const{cart:e,getTotal:i,clearCart:s}=useCart(),{user:a}=useAuth(),{currentFranchise:b,userLocation:et}=useLocationContext(),nt=useNavigate(),[c,ct]=reactExports.useState(!1),[pt,xt]=reactExports.useState({line1:((gr=a==null?void 0:a.address)==null?void 0:gr.line1)||"",line2:((rr=a==null?void 0:a.address)==null?void 0:rr.line2)||"",city:((cr=a==null?void 0:a.address)==null?void 0:cr.city)||"",pincode:((Hr=a==null?void 0:a.address)==null?void 0:Hr.pincode)||"",landmark:(($r=a==null?void 0:a.address)==null?void 0:$r.landmark)||"",label:(_n=a==null?void 0:a.address)==null?void 0:_n.label}),[St,Et]=reactExports.useState(null);reactExports.useEffect(()=>{a!=null&&a.address&&(a.address.line1||a.address.city)&&(xt(a.address),a.address.lat&&a.address.lng&&Et({lat:a.address.lat,lng:a.address.lng}))},[a]);const[Rt,Nt]=reactExports.useState(!0),[It,Gt]=reactExports.useState(""),[Dt,Bt]=reactExports.useState(null),[Lt,Vt]=reactExports.useState(!1),[Zt,nr]=reactExports.useState(""),ur=30,_r=5,Ur=i(),an=(()=>{if(!Dt)return 0;if(Dt.code.toUpperCase()==="PA1")return Ur+ur+_r-1;if(Dt.discountType==="percentage"){const fn=Ur*Dt.discountValue/100;return Dt.maxDiscount?Math.min(fn,Dt.maxDiscount):fn}else{if(Dt.discountType==="fixed")return Math.min(Dt.discountValue,Ur);if(Dt.discountType==="final_price")return Ur+ur+_r-Dt.discountValue}return 0})(),Fr=Math.max(1,Ur+ur+_r-an),rn=async()=>{if(!It.trim()){nr("Please enter a coupon code");return}Vt(!0),nr("");try{if(It.toUpperCase()==="PA1"){const jn={id:"pa1-default",code:"PA1",kitchenId:"system",discountType:"final_price",discountValue:1,usedCount:0,isActive:!0,createdAt:Date.now()};Bt(jn),ue.success(" Special coupon applied! Final price: 1"),Vt(!1);return}const fn=await getCouponByCode(It);if(!fn){nr("Invalid coupon code"),Vt(!1);return}if(!fn.isActive){nr("This coupon is no longer active"),Vt(!1);return}if(fn.expiresAt&&fn.expiresAt<Date.now()){nr("This coupon has expired"),Vt(!1);return}if(fn.usageLimit&&fn.usedCount>=fn.usageLimit){nr("This coupon has reached its usage limit"),Vt(!1);return}if(fn.minOrderAmount&&Ur<fn.minOrderAmount){nr(`Minimum order amount is ${fn.minOrderAmount}`),Vt(!1);return}if(fn.kitchenId!==e.kitchenId&&fn.kitchenId!=="system"){nr("This coupon is not valid for this kitchen"),Vt(!1);return}Bt(fn),ue.success("Coupon applied successfully!")}catch{nr("Failed to apply coupon")}Vt(!1)},gn=()=>{Bt(null),Gt(""),nr("")},_i=()=>!pt.line1&&!pt.city?(ue.error("Please select a valid delivery address"),!1):!pt.pincode&&!pt.city?(ue.error("Address information is incomplete (missing city/pincode)"),!1):!0,xr=async()=>{if(!a){ue.error("Please login to continue"),nt("/auth");return}if(_i()){if(e.items.length===0){ue.error("Your cart is empty");return}ct(!0);try{await initiatePayment(Fr,a.name,a.email,a.phone||"",async fn=>{var jn,vs;try{const Cs=await createOrder({userId:a.id,kitchenId:e.kitchenId,kitchenName:e.kitchenName,items:e.items,status:"pending",totalAmount:Fr,deliveryAddress:pt,notes:[...((jn=e.cookingInstructions)==null?void 0:jn.tags)||[],(vs=e.cookingInstructions)==null?void 0:vs.note].filter(Boolean).join(", "),createdAt:Date.now(),updatedAt:Date.now(),estimatedDelivery:"30-45 mins"});ue.success("Order placed successfully!"),s(),nt("/order-success")}catch(Cs){console.error("Order creation failed:",Cs),ue.error("Failed to create order. Please contact support.")}ct(!1)},()=>{ct(!1)})}catch(fn){console.error("Payment initiation failed:",fn),ue.error("Payment failed. Please try again."),ct(!1)}}};return e.items.length===0?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"Your cart is empty"}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Explore Kitchens"})})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-32",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[jsxRuntimeExports.jsx(Link,{to:"/cart",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Checkout"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.items.length," items from ",e.kitchenName]})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-5 h-5 text-primary"}),jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:"Delivery Location"})]}),jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2",children:pt.city&&jsxRuntimeExports.jsx(Button,{variant:"link",size:"sm",onClick:()=>nt("/addresses"),className:"text-primary h-auto p-0 font-semibold",children:"Change"})})]}),pt.city?jsxRuntimeExports.jsxs("div",{className:"bg-secondary/30 rounded-xl p-4 border border-border",children:[jsxRuntimeExports.jsx("div",{className:"pt-1",children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-medium text-foreground mb-1 capitalize",children:pt.label||"Home"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground",children:[pt.line1?jsxRuntimeExports.jsx("span",{className:"block truncate max-w-[250px]",children:pt.line1}):jsxRuntimeExports.jsxs("span",{className:"block",children:[pt.pincode?`${pt.pincode}, `:"",pt.city]}),pt.line2&&jsxRuntimeExports.jsx("span",{className:"block",children:pt.line2})]})]})}),b&&Rt&&jsxRuntimeExports.jsxs("div",{className:"mt-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-xs text-green-600 font-medium",children:[jsxRuntimeExports.jsx(Check,{className:"w-3 h-3"}),"Deliverable address"]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground mt-1 ml-5",children:[b.name," Zone"]})]}),b&&!Rt&&jsxRuntimeExports.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-destructive font-medium",children:[jsxRuntimeExports.jsx(X,{className:"w-3 h-3"}),"Address outside delivery zone"]})]}):jsxRuntimeExports.jsxs("div",{className:"text-center py-6 bg-secondary/30 rounded-xl border border-dashed border-border",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"No delivery address found"}),jsxRuntimeExports.jsx(Button,{onClick:()=>nt("/addresses"),className:"gradient-primary text-primary-foreground",children:"Add Address"})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 mt-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[jsxRuntimeExports.jsx(Tag,{className:"w-5 h-5 text-primary"}),jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:"Apply Discount Coupon"})]}),Dt?jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between bg-veg/10 rounded-xl p-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Check,{className:"w-5 h-5 text-veg"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-semibold text-foreground",children:Dt.code}),jsxRuntimeExports.jsx("p",{className:"text-xs text-veg",children:Dt.code.toUpperCase()==="PA1"?"Special offer: Final price 1!":`Saving ${an}`})]})]}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",onClick:gn,className:"text-destructive",children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]}):jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Input,{placeholder:"Enter coupon code (try PA1)",value:It,onChange:fn=>{Gt(fn.target.value.toUpperCase()),nr("")},className:"bg-secondary border-0 uppercase"}),jsxRuntimeExports.jsx(Button,{onClick:rn,disabled:Lt,className:"gradient-primary text-primary-foreground",children:Lt?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}):"Apply"})]}),Zt&&jsxRuntimeExports.jsx("p",{className:"text-xs text-destructive",children:Zt})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 mt-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Order Summary"}),e.items.map(fn=>jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm py-2 border-b border-border",children:[jsxRuntimeExports.jsxs("span",{className:"text-muted-foreground",children:[fn.dish.name," x ",fn.quantity]}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",fn.dish.price*fn.quantity]})]},fn.dish.id)),jsxRuntimeExports.jsxs("div",{className:"space-y-2 text-sm mt-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Item Total"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",Ur]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Delivery Fee"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",ur]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Platform Fee"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",_r]})]}),Dt&&an>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-veg",children:[jsxRuntimeExports.jsxs("span",{children:["Discount (",Dt.code,")"]}),jsxRuntimeExports.jsxs("span",{children:["-",an]})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-border pt-2 mt-2",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between font-semibold text-base",children:[jsxRuntimeExports.jsx("span",{className:"text-foreground",children:"Total"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",Fr]})]})})]})]})}),jsxRuntimeExports.jsx(motion.div,{initial:{y:100},animate:{y:0},className:"fixed bottom-0 left-0 right-0 p-4 bg-card/95 backdrop-blur-lg border-t border-border safe-bottom",children:jsxRuntimeExports.jsx(Button,{onClick:xr,disabled:c||!Rt,className:`w-full py-6 rounded-xl shadow-elevated ${Rt?"gradient-primary text-primary-foreground":"bg-muted text-muted-foreground cursor-not-allowed"}`,children:c?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin"}),jsxRuntimeExports.jsx("span",{children:"Processing..."})]}):Rt?jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between w-full",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(CreditCard,{className:"w-5 h-5"}),jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Pay Now"})]}),jsxRuntimeExports.jsxs("span",{className:"font-bold",children:["",Fr]})]}):jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2",children:jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Delivery Not Available"})})})})]})}var NAME="Label",Label$2=reactExports.forwardRef((e,i)=>jsxRuntimeExports.jsx(Primitive.label,{...e,ref:i,onMouseDown:s=>{var b;s.target.closest("button, input, select, textarea")||((b=e.onMouseDown)==null||b.call(e,s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));Label$2.displayName=NAME;var Root$3=Label$2;const labelVariants=cva("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Label$1=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Root$3,{ref:s,className:cn(labelVariants(),e),...i}));Label$1.displayName=Root$3.displayName;function getDashboardRoute(e){switch(e){case"super_admin":return"/super-admin";case"franchise_admin":return"/franchise-admin";case"amma":return"/amma/dashboard";case"admin":return"/admin";default:return"/"}}function AuthPage(){const[e,i]=reactExports.useState("login"),[s,a]=reactExports.useState("user"),[b,et]=reactExports.useState(!1),[nt,c]=reactExports.useState(!1),[ct,pt]=reactExports.useState(!0),[xt,St]=reactExports.useState({email:"",password:"",name:"",phone:""}),{signIn:Et,signUp:Rt,updateUserLocation:Nt,user:It,loading:Gt}=useAuth(),Dt=useNavigate();if(reactExports.useEffect(()=>{if(!Gt&&It){const Vt=getDashboardRoute(It.role);Dt(Vt,{replace:!0})}else Gt||pt(!1)},[It,Gt,Dt]),ct||Gt)return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})});const Bt=async()=>{if(!navigator.geolocation){console.log("Geolocation not supported");return}try{const Vt=await new Promise((ur,_r)=>{navigator.geolocation.getCurrentPosition(ur,_r,{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}),{latitude:Zt,longitude:nr}=Vt.coords;await Nt(Zt,nr),ue.success("Location saved!",{icon:jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4"}),duration:2e3})}catch(Vt){console.log("Could not get location:",Vt)}},Lt=async Vt=>{Vt.preventDefault(),c(!0);try{if(e==="login"){let Zt=xt.email;xt.email==="admin"&&(Zt="admin@admin.com"),await Et(Zt,xt.password),ue.success("Welcome back!");const nr=auth.currentUser;if(nr){const ur=ref(database,`users/${nr.uid}`),_r=await get(ur);if(_r.exists()){const Ur=_r.val();if(Ur.role==="super_admin"){Dt("/super-admin");return}else if(Ur.role==="franchise_admin"){Dt("/franchise-admin");return}else if(Ur.role==="amma"){Dt("/amma/dashboard");return}else if(Ur.role==="admin"){Dt("/admin");return}}}Dt("/")}else await Rt(xt.email,xt.password,xt.name,xt.phone,s),ue.success("Account created successfully!"),Bt(),s==="amma"?(ue.info("Now register your kitchen to start selling!"),Dt("/amma/register")):Dt("/")}catch(Zt){console.error("Auth error:",Zt);let nr="Authentication failed";Zt.code==="auth/email-already-in-use"?nr="Email already registered. Please login instead.":Zt.code==="auth/weak-password"?nr="Password should be at least 6 characters":Zt.code==="auth/invalid-email"?nr="Invalid email address":(Zt.code==="auth/user-not-found"||Zt.code==="auth/wrong-password"||Zt.code==="auth/invalid-credential")&&(nr="Invalid email or password"),ue.error(nr)}finally{c(!1)}};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("div",{className:"gradient-hero px-6 pt-12 pb-8 text-primary-foreground",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-2xl bg-primary-foreground/20 flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx(ChefHat,{className:"w-8 h-8"})}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Amma Cheythi Vanta"}),jsxRuntimeExports.jsx("p",{className:"text-primary-foreground/80 text-sm",children:e==="login"?"Welcome back!":"Join our family of home cooks"})]})}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex-1 -mt-6 bg-card rounded-t-3xl px-6 pt-8",children:[jsxRuntimeExports.jsx("div",{className:"flex bg-secondary rounded-xl p-1 mb-6",children:["login","signup"].map(Vt=>jsxRuntimeExports.jsx("button",{onClick:()=>i(Vt),className:`flex-1 py-2.5 rounded-lg text-sm font-medium transition-all ${e===Vt?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:Vt==="login"?"Login":"Sign Up"},Vt))}),e==="signup"&&jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx(Label$1,{className:"text-sm font-medium text-foreground mb-3 block",children:"I am a..."}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs(motion.button,{whileTap:{scale:.98},onClick:()=>a("user"),className:`p-4 rounded-xl border-2 text-left transition-all ${s==="user"?"border-primary bg-primary/5":"border-border"}`,children:[jsxRuntimeExports.jsx("span",{className:"text-2xl mb-2 block",children:""}),jsxRuntimeExports.jsx("span",{className:"font-medium text-foreground block",children:"Food Lover"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"I want to order"})]}),jsxRuntimeExports.jsxs(motion.button,{whileTap:{scale:.98},onClick:()=>a("amma"),className:`p-4 rounded-xl border-2 text-left transition-all ${s==="amma"?"border-primary bg-primary/5":"border-border"}`,children:[jsxRuntimeExports.jsx("span",{className:"text-2xl mb-2 block",children:""}),jsxRuntimeExports.jsx("span",{className:"font-medium text-foreground block",children:"Home Cook"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"I want to sell"})]})]})]}),jsxRuntimeExports.jsxs("form",{onSubmit:Lt,className:"space-y-4",children:[e==="signup"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"name",className:"text-sm font-medium text-foreground",children:"Full Name"}),jsxRuntimeExports.jsx(Input,{id:"name",type:"text",placeholder:"Enter your name",value:xt.name,onChange:Vt=>St(Zt=>({...Zt,name:Vt.target.value})),className:"mt-1.5 bg-secondary border-0 py-6",required:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"phone",className:"text-sm font-medium text-foreground",children:"Phone Number"}),jsxRuntimeExports.jsx(Input,{id:"phone",type:"tel",placeholder:"Enter phone number",value:xt.phone,onChange:Vt=>St(Zt=>({...Zt,phone:Vt.target.value})),className:"mt-1.5 bg-secondary border-0 py-6",required:!0})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"email",className:"text-sm font-medium text-foreground",children:"Email"}),jsxRuntimeExports.jsx(Input,{id:"email",type:"email",placeholder:"Enter your email",value:xt.email,onChange:Vt=>St(Zt=>({...Zt,email:Vt.target.value})),className:"mt-1.5 bg-secondary border-0 py-6",required:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"password",className:"text-sm font-medium text-foreground",children:"Password"}),jsxRuntimeExports.jsxs("div",{className:"relative mt-1.5",children:[jsxRuntimeExports.jsx(Input,{id:"password",type:b?"text":"password",placeholder:"Enter password",value:xt.password,onChange:Vt=>St(Zt=>({...Zt,password:Vt.target.value})),className:"bg-secondary border-0 py-6 pr-12",required:!0}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>et(!b),className:"absolute right-4 top-1/2 -translate-y-1/2 text-muted-foreground",children:b?jsxRuntimeExports.jsx(EyeOff,{className:"w-5 h-5"}):jsxRuntimeExports.jsx(Eye,{className:"w-5 h-5"})})]})]}),jsxRuntimeExports.jsx(Button,{type:"submit",disabled:nt,className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl mt-6",children:nt?jsxRuntimeExports.jsx(motion.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1},className:"w-5 h-5 border-2 border-primary-foreground border-t-transparent rounded-full"}):jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[e==="login"?"Login":"Create Account",jsxRuntimeExports.jsx(ArrowRight,{className:"w-5 h-5"})]})})]}),jsxRuntimeExports.jsx("div",{className:"text-center mt-6",children:jsxRuntimeExports.jsx(Link,{to:"/",className:"text-sm text-muted-foreground",children:"Skip for now"})})]})]})}async function clearAllDataExceptSuperAdmin(){try{const e={},i=ref(database,"users"),s=await get(i);if(s.exists()){const a=s.val();Object.keys(a).forEach(b=>{a[b].role!=="super_admin"&&(e[`users/${b}`]=null)})}return e.franchises=null,e.kitchens=null,e.dishes=null,e.orders=null,e.coupons=null,e.reviews=null,await update(ref(database),e),console.log("Database cleared successfully! (Super Admin preserved)"),!0}catch(e){return console.error("Error clearing database:",e),!1}}function ProfilePage(){const{user:e,signOut:i}=useAuth(),s=useNavigate();reactExports.useState(!1);const a=async()=>{await i(),s("/")},b=[{icon:ShoppingBag,label:"My Orders",path:"/orders",color:"text-primary"},{icon:Heart,label:"Favorite Kitchens",path:"/favorites",color:"text-destructive"},{icon:MapPin,label:"Saved Addresses",path:"/addresses",color:"text-accent"},{icon:Settings,label:"Settings",path:"/settings",color:"text-muted-foreground"},{icon:CircleHelp,label:"Help & Support",path:"/help",color:"text-gold"},...(e==null?void 0:e.role)==="super_admin"||(e==null?void 0:e.role)==="admin"?[{icon:ShieldCheck,label:"Super Admin Panel",path:"/super-admin",color:"text-primary"}]:[]];return e?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsx("div",{className:"gradient-hero px-6 pt-12 pb-16 text-primary-foreground",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-primary-foreground/20 flex items-center justify-center",children:e.avatar?jsxRuntimeExports.jsx("img",{src:e.avatar,alt:e.name,className:"w-full h-full rounded-full object-cover"}):jsxRuntimeExports.jsx(User,{className:"w-8 h-8"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold",children:e.name}),jsxRuntimeExports.jsx("p",{className:"text-primary-foreground/80 text-sm",children:e.email}),jsxRuntimeExports.jsx("p",{className:"text-primary-foreground/60 text-xs mt-0.5",children:e.role==="amma"?" Home Cook":" Food Lover"})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 -mt-6",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[e.role==="amma"&&jsxRuntimeExports.jsx(Link,{to:"/amma/dashboard",children:jsxRuntimeExports.jsxs(motion.div,{whileTap:{scale:.98},className:"flex items-center gap-4 p-4 border-b border-border bg-gold-soft",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gold/20 flex items-center justify-center text-gold",children:jsxRuntimeExports.jsx(ChefHat,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-foreground block",children:"My Kitchen Dashboard"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Manage orders & menu"})]}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-muted-foreground"})]})}),b.map(et=>jsxRuntimeExports.jsx(Link,{to:et.path,children:jsxRuntimeExports.jsxs(motion.div,{whileTap:{scale:.98},className:"flex items-center gap-4 p-4 border-b border-border last:border-0",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-xl bg-secondary flex items-center justify-center ${et.color}`,children:jsxRuntimeExports.jsx(et.icon,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 font-medium text-foreground",children:et.label}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-muted-foreground"})]})},et.path)),jsxRuntimeExports.jsxs(motion.button,{whileTap:{scale:.98},onClick:a,className:"w-full flex items-center gap-4 p-4 text-destructive",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-destructive/10 flex items-center justify-center",children:jsxRuntimeExports.jsx(LogOut,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 font-medium text-left",children:"Logout"})]})]})}),jsxRuntimeExports.jsx(BottomNav,{})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsx("div",{className:"gradient-hero px-6 pt-12 pb-16 text-primary-foreground",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-primary-foreground/20 flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx(User,{className:"w-10 h-10"})}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold mb-2",children:"Welcome, Guest!"}),jsxRuntimeExports.jsx("p",{className:"text-primary-foreground/80 text-sm mb-4",children:"Login to order delicious homemade food"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"bg-primary-foreground text-primary px-8 py-5 rounded-xl font-semibold",children:"Login / Sign Up"})})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 -mt-6",children:jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:b.slice(3).map((et,nt)=>jsxRuntimeExports.jsx(Link,{to:et.path,children:jsxRuntimeExports.jsxs(motion.div,{whileTap:{scale:.98},className:"flex items-center gap-4 p-4 border-b border-border last:border-0",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-xl bg-secondary flex items-center justify-center ${et.color}`,children:jsxRuntimeExports.jsx(et.icon,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 font-medium text-foreground",children:et.label}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-muted-foreground"})]})},et.path))})}),jsxRuntimeExports.jsx(BottomNav,{})]})}function usePrevious(e){const i=reactExports.useRef({value:e,previous:e});return reactExports.useMemo(()=>(i.current.value!==e&&(i.current.previous=i.current.value,i.current.value=e),i.current.previous),[e])}var SWITCH_NAME="Switch",[createSwitchContext,createSwitchScope]=createContextScope(SWITCH_NAME),[SwitchProvider,useSwitchContext]=createSwitchContext(SWITCH_NAME),Switch$1=reactExports.forwardRef((e,i)=>{const{__scopeSwitch:s,name:a,checked:b,defaultChecked:et,required:nt,disabled:c,value:ct="on",onCheckedChange:pt,form:xt,...St}=e,[Et,Rt]=reactExports.useState(null),Nt=useComposedRefs$1(i,Lt=>Rt(Lt)),It=reactExports.useRef(!1),Gt=Et?xt||!!Et.closest("form"):!0,[Dt,Bt]=useControllableState({prop:b,defaultProp:et??!1,onChange:pt,caller:SWITCH_NAME});return jsxRuntimeExports.jsxs(SwitchProvider,{scope:s,checked:Dt,disabled:c,children:[jsxRuntimeExports.jsx(Primitive.button,{type:"button",role:"switch","aria-checked":Dt,"aria-required":nt,"data-state":getState$3(Dt),"data-disabled":c?"":void 0,disabled:c,value:ct,...St,ref:Nt,onClick:composeEventHandlers(e.onClick,Lt=>{Bt(Vt=>!Vt),Gt&&(It.current=Lt.isPropagationStopped(),It.current||Lt.stopPropagation())})}),Gt&&jsxRuntimeExports.jsx(SwitchBubbleInput,{control:Et,bubbles:!It.current,name:a,value:ct,checked:Dt,required:nt,disabled:c,form:xt,style:{transform:"translateX(-100%)"}})]})});Switch$1.displayName=SWITCH_NAME;var THUMB_NAME="SwitchThumb",SwitchThumb=reactExports.forwardRef((e,i)=>{const{__scopeSwitch:s,...a}=e,b=useSwitchContext(THUMB_NAME,s);return jsxRuntimeExports.jsx(Primitive.span,{"data-state":getState$3(b.checked),"data-disabled":b.disabled?"":void 0,...a,ref:i})});SwitchThumb.displayName=THUMB_NAME;var BUBBLE_INPUT_NAME$1="SwitchBubbleInput",SwitchBubbleInput=reactExports.forwardRef(({__scopeSwitch:e,control:i,checked:s,bubbles:a=!0,...b},et)=>{const nt=reactExports.useRef(null),c=useComposedRefs$1(nt,et),ct=usePrevious(s),pt=useSize(i);return reactExports.useEffect(()=>{const xt=nt.current;if(!xt)return;const St=window.HTMLInputElement.prototype,Rt=Object.getOwnPropertyDescriptor(St,"checked").set;if(ct!==s&&Rt){const Nt=new Event("click",{bubbles:a});Rt.call(xt,s),xt.dispatchEvent(Nt)}},[ct,s,a]),jsxRuntimeExports.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,...b,tabIndex:-1,ref:c,style:{...b.style,...pt,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});SwitchBubbleInput.displayName=BUBBLE_INPUT_NAME$1;function getState$3(e){return e?"checked":"unchecked"}var Root$2=Switch$1,Thumb=SwitchThumb;const Switch=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Root$2,{className:cn("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e),...i,ref:s,children:jsxRuntimeExports.jsx(Thumb,{className:cn("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Switch.displayName=Root$2.displayName;var AUTOFOCUS_ON_MOUNT="focusScope.autoFocusOnMount",AUTOFOCUS_ON_UNMOUNT="focusScope.autoFocusOnUnmount",EVENT_OPTIONS={bubbles:!1,cancelable:!0},FOCUS_SCOPE_NAME="FocusScope",FocusScope=reactExports.forwardRef((e,i)=>{const{loop:s=!1,trapped:a=!1,onMountAutoFocus:b,onUnmountAutoFocus:et,...nt}=e,[c,ct]=reactExports.useState(null),pt=useCallbackRef$1(b),xt=useCallbackRef$1(et),St=reactExports.useRef(null),Et=useComposedRefs$1(i,It=>ct(It)),Rt=reactExports.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;reactExports.useEffect(()=>{if(a){let It=function(Lt){if(Rt.paused||!c)return;const Vt=Lt.target;c.contains(Vt)?St.current=Vt:focus(St.current,{select:!0})},Gt=function(Lt){if(Rt.paused||!c)return;const Vt=Lt.relatedTarget;Vt!==null&&(c.contains(Vt)||focus(St.current,{select:!0}))},Dt=function(Lt){if(document.activeElement===document.body)for(const Zt of Lt)Zt.removedNodes.length>0&&focus(c)};document.addEventListener("focusin",It),document.addEventListener("focusout",Gt);const Bt=new MutationObserver(Dt);return c&&Bt.observe(c,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",It),document.removeEventListener("focusout",Gt),Bt.disconnect()}}},[a,c,Rt.paused]),reactExports.useEffect(()=>{if(c){focusScopesStack.add(Rt);const It=document.activeElement;if(!c.contains(It)){const Dt=new CustomEvent(AUTOFOCUS_ON_MOUNT,EVENT_OPTIONS);c.addEventListener(AUTOFOCUS_ON_MOUNT,pt),c.dispatchEvent(Dt),Dt.defaultPrevented||(focusFirst(removeLinks(getTabbableCandidates(c)),{select:!0}),document.activeElement===It&&focus(c))}return()=>{c.removeEventListener(AUTOFOCUS_ON_MOUNT,pt),setTimeout(()=>{const Dt=new CustomEvent(AUTOFOCUS_ON_UNMOUNT,EVENT_OPTIONS);c.addEventListener(AUTOFOCUS_ON_UNMOUNT,xt),c.dispatchEvent(Dt),Dt.defaultPrevented||focus(It??document.body,{select:!0}),c.removeEventListener(AUTOFOCUS_ON_UNMOUNT,xt),focusScopesStack.remove(Rt)},0)}}},[c,pt,xt,Rt]);const Nt=reactExports.useCallback(It=>{if(!s&&!a||Rt.paused)return;const Gt=It.key==="Tab"&&!It.altKey&&!It.ctrlKey&&!It.metaKey,Dt=document.activeElement;if(Gt&&Dt){const Bt=It.currentTarget,[Lt,Vt]=getTabbableEdges(Bt);Lt&&Vt?!It.shiftKey&&Dt===Vt?(It.preventDefault(),s&&focus(Lt,{select:!0})):It.shiftKey&&Dt===Lt&&(It.preventDefault(),s&&focus(Vt,{select:!0})):Dt===Bt&&It.preventDefault()}},[s,a,Rt.paused]);return jsxRuntimeExports.jsx(Primitive.div,{tabIndex:-1,...nt,ref:Et,onKeyDown:Nt})});FocusScope.displayName=FOCUS_SCOPE_NAME;function focusFirst(e,{select:i=!1}={}){const s=document.activeElement;for(const a of e)if(focus(a,{select:i}),document.activeElement!==s)return}function getTabbableEdges(e){const i=getTabbableCandidates(e),s=findVisible(i,e),a=findVisible(i.reverse(),e);return[s,a]}function getTabbableCandidates(e){const i=[],s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const b=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||b?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)i.push(s.currentNode);return i}function findVisible(e,i){for(const s of e)if(!isHidden(s,{upTo:i}))return s}function isHidden(e,{upTo:i}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(i!==void 0&&e===i)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function isSelectableInput(e){return e instanceof HTMLInputElement&&"select"in e}function focus(e,{select:i=!1}={}){if(e&&e.focus){const s=document.activeElement;e.focus({preventScroll:!0}),e!==s&&isSelectableInput(e)&&i&&e.select()}}var focusScopesStack=createFocusScopesStack();function createFocusScopesStack(){let e=[];return{add(i){const s=e[0];i!==s&&(s==null||s.pause()),e=arrayRemove(e,i),e.unshift(i)},remove(i){var s;e=arrayRemove(e,i),(s=e[0])==null||s.resume()}}}function arrayRemove(e,i){const s=[...e],a=s.indexOf(i);return a!==-1&&s.splice(a,1),s}function removeLinks(e){return e.filter(i=>i.tagName!=="A")}var count=0;function useFocusGuards(){reactExports.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??createFocusGuard()),document.body.insertAdjacentElement("beforeend",e[1]??createFocusGuard()),count++,()=>{count===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(i=>i.remove()),count--}},[])}function createFocusGuard(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var __assign=function(){return __assign=Object.assign||function(i){for(var s,a=1,b=arguments.length;a<b;a++){s=arguments[a];for(var et in s)Object.prototype.hasOwnProperty.call(s,et)&&(i[et]=s[et])}return i},__assign.apply(this,arguments)};function __rest(e,i){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&i.indexOf(a)<0&&(s[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,a=Object.getOwnPropertySymbols(e);b<a.length;b++)i.indexOf(a[b])<0&&Object.prototype.propertyIsEnumerable.call(e,a[b])&&(s[a[b]]=e[a[b]]);return s}function __spreadArray(e,i,s){if(s||arguments.length===2)for(var a=0,b=i.length,et;a<b;a++)(et||!(a in i))&&(et||(et=Array.prototype.slice.call(i,0,a)),et[a]=i[a]);return e.concat(et||Array.prototype.slice.call(i))}typeof SuppressedError=="function"&&SuppressedError;var zeroRightClassName="right-scroll-bar-position",fullWidthClassName="width-before-scroll-bar",noScrollbarsClassName="with-scroll-bars-hidden",removedBarSizeVariable="--removed-body-scroll-bar-size";function assignRef(e,i){return typeof e=="function"?e(i):e&&(e.current=i),e}function useCallbackRef(e,i){var s=reactExports.useState(function(){return{value:e,callback:i,facade:{get current(){return s.value},set current(a){var b=s.value;b!==a&&(s.value=a,s.callback(a,b))}}}})[0];return s.callback=i,s.facade}var useIsomorphicLayoutEffect=typeof window<"u"?reactExports.useLayoutEffect:reactExports.useEffect,currentValues=new WeakMap;function useMergeRefs(e,i){var s=useCallbackRef(null,function(a){return e.forEach(function(b){return assignRef(b,a)})});return useIsomorphicLayoutEffect(function(){var a=currentValues.get(s);if(a){var b=new Set(a),et=new Set(e),nt=s.current;b.forEach(function(c){et.has(c)||assignRef(c,null)}),et.forEach(function(c){b.has(c)||assignRef(c,nt)})}currentValues.set(s,e)},[e]),s}function ItoI(e){return e}function innerCreateMedium(e,i){i===void 0&&(i=ItoI);var s=[],a=!1,b={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:e},useMedium:function(et){var nt=i(et,a);return s.push(nt),function(){s=s.filter(function(c){return c!==nt})}},assignSyncMedium:function(et){for(a=!0;s.length;){var nt=s;s=[],nt.forEach(et)}s={push:function(c){return et(c)},filter:function(){return s}}},assignMedium:function(et){a=!0;var nt=[];if(s.length){var c=s;s=[],c.forEach(et),nt=s}var ct=function(){var xt=nt;nt=[],xt.forEach(et)},pt=function(){return Promise.resolve().then(ct)};pt(),s={push:function(xt){nt.push(xt),pt()},filter:function(xt){return nt=nt.filter(xt),s}}}};return b}function createSidecarMedium(e){e===void 0&&(e={});var i=innerCreateMedium(null);return i.options=__assign({async:!0,ssr:!1},e),i}var SideCar$1=function(e){var i=e.sideCar,s=__rest(e,["sideCar"]);if(!i)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=i.read();if(!a)throw new Error("Sidecar medium not found");return reactExports.createElement(a,__assign({},s))};SideCar$1.isSideCarExport=!0;function exportSidecar(e,i){return e.useMedium(i),SideCar$1}var effectCar=createSidecarMedium(),nothing=function(){},RemoveScroll=reactExports.forwardRef(function(e,i){var s=reactExports.useRef(null),a=reactExports.useState({onScrollCapture:nothing,onWheelCapture:nothing,onTouchMoveCapture:nothing}),b=a[0],et=a[1],nt=e.forwardProps,c=e.children,ct=e.className,pt=e.removeScrollBar,xt=e.enabled,St=e.shards,Et=e.sideCar,Rt=e.noRelative,Nt=e.noIsolation,It=e.inert,Gt=e.allowPinchZoom,Dt=e.as,Bt=Dt===void 0?"div":Dt,Lt=e.gapMode,Vt=__rest(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),Zt=Et,nr=useMergeRefs([s,i]),ur=__assign(__assign({},Vt),b);return reactExports.createElement(reactExports.Fragment,null,xt&&reactExports.createElement(Zt,{sideCar:effectCar,removeScrollBar:pt,shards:St,noRelative:Rt,noIsolation:Nt,inert:It,setCallbacks:et,allowPinchZoom:!!Gt,lockRef:s,gapMode:Lt}),nt?reactExports.cloneElement(reactExports.Children.only(c),__assign(__assign({},ur),{ref:nr})):reactExports.createElement(Bt,__assign({},ur,{className:ct,ref:nr}),c))});RemoveScroll.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};RemoveScroll.classNames={fullWidth:fullWidthClassName,zeroRight:zeroRightClassName};var getNonce=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function makeStyleTag(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var i=getNonce();return i&&e.setAttribute("nonce",i),e}function injectStyles(e,i){e.styleSheet?e.styleSheet.cssText=i:e.appendChild(document.createTextNode(i))}function insertStyleTag(e){var i=document.head||document.getElementsByTagName("head")[0];i.appendChild(e)}var stylesheetSingleton=function(){var e=0,i=null;return{add:function(s){e==0&&(i=makeStyleTag())&&(injectStyles(i,s),insertStyleTag(i)),e++},remove:function(){e--,!e&&i&&(i.parentNode&&i.parentNode.removeChild(i),i=null)}}},styleHookSingleton=function(){var e=stylesheetSingleton();return function(i,s){reactExports.useEffect(function(){return e.add(i),function(){e.remove()}},[i&&s])}},styleSingleton=function(){var e=styleHookSingleton(),i=function(s){var a=s.styles,b=s.dynamic;return e(a,b),null};return i},zeroGap={left:0,top:0,right:0,gap:0},parse=function(e){return parseInt(e||"",10)||0},getOffset=function(e){var i=window.getComputedStyle(document.body),s=i[e==="padding"?"paddingLeft":"marginLeft"],a=i[e==="padding"?"paddingTop":"marginTop"],b=i[e==="padding"?"paddingRight":"marginRight"];return[parse(s),parse(a),parse(b)]},getGapWidth=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return zeroGap;var i=getOffset(e),s=document.documentElement.clientWidth,a=window.innerWidth;return{left:i[0],top:i[1],right:i[2],gap:Math.max(0,a-s+i[2]-i[0])}},Style=styleSingleton(),lockAttribute="data-scroll-locked",getStyles=function(e,i,s,a){var b=e.left,et=e.top,nt=e.right,c=e.gap;return s===void 0&&(s="margin"),`
  .`.concat(noScrollbarsClassName,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(c,"px ").concat(a,`;
  }
  body[`).concat(lockAttribute,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([i&&"position: relative ".concat(a,";"),s==="margin"&&`
    padding-left: `.concat(b,`px;
    padding-top: `).concat(et,`px;
    padding-right: `).concat(nt,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(c,"px ").concat(a,`;
    `),s==="padding"&&"padding-right: ".concat(c,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(zeroRightClassName,` {
    right: `).concat(c,"px ").concat(a,`;
  }
  
  .`).concat(fullWidthClassName,` {
    margin-right: `).concat(c,"px ").concat(a,`;
  }
  
  .`).concat(zeroRightClassName," .").concat(zeroRightClassName,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(fullWidthClassName," .").concat(fullWidthClassName,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(lockAttribute,`] {
    `).concat(removedBarSizeVariable,": ").concat(c,`px;
  }
`)},getCurrentUseCounter=function(){var e=parseInt(document.body.getAttribute(lockAttribute)||"0",10);return isFinite(e)?e:0},useLockAttribute=function(){reactExports.useEffect(function(){return document.body.setAttribute(lockAttribute,(getCurrentUseCounter()+1).toString()),function(){var e=getCurrentUseCounter()-1;e<=0?document.body.removeAttribute(lockAttribute):document.body.setAttribute(lockAttribute,e.toString())}},[])},RemoveScrollBar=function(e){var i=e.noRelative,s=e.noImportant,a=e.gapMode,b=a===void 0?"margin":a;useLockAttribute();var et=reactExports.useMemo(function(){return getGapWidth(b)},[b]);return reactExports.createElement(Style,{styles:getStyles(et,!i,b,s?"":"!important")})},passiveSupported=!1;if(typeof window<"u")try{var options=Object.defineProperty({},"passive",{get:function(){return passiveSupported=!0,!0}});window.addEventListener("test",options,options),window.removeEventListener("test",options,options)}catch{passiveSupported=!1}var nonPassive=passiveSupported?{passive:!1}:!1,alwaysContainsScroll=function(e){return e.tagName==="TEXTAREA"},elementCanBeScrolled=function(e,i){if(!(e instanceof Element))return!1;var s=window.getComputedStyle(e);return s[i]!=="hidden"&&!(s.overflowY===s.overflowX&&!alwaysContainsScroll(e)&&s[i]==="visible")},elementCouldBeVScrolled=function(e){return elementCanBeScrolled(e,"overflowY")},elementCouldBeHScrolled=function(e){return elementCanBeScrolled(e,"overflowX")},locationCouldBeScrolled=function(e,i){var s=i.ownerDocument,a=i;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var b=elementCouldBeScrolled(e,a);if(b){var et=getScrollVariables(e,a),nt=et[1],c=et[2];if(nt>c)return!0}a=a.parentNode}while(a&&a!==s.body);return!1},getVScrollVariables=function(e){var i=e.scrollTop,s=e.scrollHeight,a=e.clientHeight;return[i,s,a]},getHScrollVariables=function(e){var i=e.scrollLeft,s=e.scrollWidth,a=e.clientWidth;return[i,s,a]},elementCouldBeScrolled=function(e,i){return e==="v"?elementCouldBeVScrolled(i):elementCouldBeHScrolled(i)},getScrollVariables=function(e,i){return e==="v"?getVScrollVariables(i):getHScrollVariables(i)},getDirectionFactor=function(e,i){return e==="h"&&i==="rtl"?-1:1},handleScroll=function(e,i,s,a,b){var et=getDirectionFactor(e,window.getComputedStyle(i).direction),nt=et*a,c=s.target,ct=i.contains(c),pt=!1,xt=nt>0,St=0,Et=0;do{if(!c)break;var Rt=getScrollVariables(e,c),Nt=Rt[0],It=Rt[1],Gt=Rt[2],Dt=It-Gt-et*Nt;(Nt||Dt)&&elementCouldBeScrolled(e,c)&&(St+=Dt,Et+=Nt);var Bt=c.parentNode;c=Bt&&Bt.nodeType===Node.DOCUMENT_FRAGMENT_NODE?Bt.host:Bt}while(!ct&&c!==document.body||ct&&(i.contains(c)||i===c));return(xt&&(Math.abs(St)<1||!b)||!xt&&(Math.abs(Et)<1||!b))&&(pt=!0),pt},getTouchXY=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},getDeltaXY=function(e){return[e.deltaX,e.deltaY]},extractRef=function(e){return e&&"current"in e?e.current:e},deltaCompare=function(e,i){return e[0]===i[0]&&e[1]===i[1]},generateStyle=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},idCounter=0,lockStack=[];function RemoveScrollSideCar(e){var i=reactExports.useRef([]),s=reactExports.useRef([0,0]),a=reactExports.useRef(),b=reactExports.useState(idCounter++)[0],et=reactExports.useState(styleSingleton)[0],nt=reactExports.useRef(e);reactExports.useEffect(function(){nt.current=e},[e]),reactExports.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(b));var It=__spreadArray([e.lockRef.current],(e.shards||[]).map(extractRef),!0).filter(Boolean);return It.forEach(function(Gt){return Gt.classList.add("allow-interactivity-".concat(b))}),function(){document.body.classList.remove("block-interactivity-".concat(b)),It.forEach(function(Gt){return Gt.classList.remove("allow-interactivity-".concat(b))})}}},[e.inert,e.lockRef.current,e.shards]);var c=reactExports.useCallback(function(It,Gt){if("touches"in It&&It.touches.length===2||It.type==="wheel"&&It.ctrlKey)return!nt.current.allowPinchZoom;var Dt=getTouchXY(It),Bt=s.current,Lt="deltaX"in It?It.deltaX:Bt[0]-Dt[0],Vt="deltaY"in It?It.deltaY:Bt[1]-Dt[1],Zt,nr=It.target,ur=Math.abs(Lt)>Math.abs(Vt)?"h":"v";if("touches"in It&&ur==="h"&&nr.type==="range")return!1;var _r=locationCouldBeScrolled(ur,nr);if(!_r)return!0;if(_r?Zt=ur:(Zt=ur==="v"?"h":"v",_r=locationCouldBeScrolled(ur,nr)),!_r)return!1;if(!a.current&&"changedTouches"in It&&(Lt||Vt)&&(a.current=Zt),!Zt)return!0;var Ur=a.current||Zt;return handleScroll(Ur,Gt,It,Ur==="h"?Lt:Vt,!0)},[]),ct=reactExports.useCallback(function(It){var Gt=It;if(!(!lockStack.length||lockStack[lockStack.length-1]!==et)){var Dt="deltaY"in Gt?getDeltaXY(Gt):getTouchXY(Gt),Bt=i.current.filter(function(Zt){return Zt.name===Gt.type&&(Zt.target===Gt.target||Gt.target===Zt.shadowParent)&&deltaCompare(Zt.delta,Dt)})[0];if(Bt&&Bt.should){Gt.cancelable&&Gt.preventDefault();return}if(!Bt){var Lt=(nt.current.shards||[]).map(extractRef).filter(Boolean).filter(function(Zt){return Zt.contains(Gt.target)}),Vt=Lt.length>0?c(Gt,Lt[0]):!nt.current.noIsolation;Vt&&Gt.cancelable&&Gt.preventDefault()}}},[]),pt=reactExports.useCallback(function(It,Gt,Dt,Bt){var Lt={name:It,delta:Gt,target:Dt,should:Bt,shadowParent:getOutermostShadowParent(Dt)};i.current.push(Lt),setTimeout(function(){i.current=i.current.filter(function(Vt){return Vt!==Lt})},1)},[]),xt=reactExports.useCallback(function(It){s.current=getTouchXY(It),a.current=void 0},[]),St=reactExports.useCallback(function(It){pt(It.type,getDeltaXY(It),It.target,c(It,e.lockRef.current))},[]),Et=reactExports.useCallback(function(It){pt(It.type,getTouchXY(It),It.target,c(It,e.lockRef.current))},[]);reactExports.useEffect(function(){return lockStack.push(et),e.setCallbacks({onScrollCapture:St,onWheelCapture:St,onTouchMoveCapture:Et}),document.addEventListener("wheel",ct,nonPassive),document.addEventListener("touchmove",ct,nonPassive),document.addEventListener("touchstart",xt,nonPassive),function(){lockStack=lockStack.filter(function(It){return It!==et}),document.removeEventListener("wheel",ct,nonPassive),document.removeEventListener("touchmove",ct,nonPassive),document.removeEventListener("touchstart",xt,nonPassive)}},[]);var Rt=e.removeScrollBar,Nt=e.inert;return reactExports.createElement(reactExports.Fragment,null,Nt?reactExports.createElement(et,{styles:generateStyle(b)}):null,Rt?reactExports.createElement(RemoveScrollBar,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function getOutermostShadowParent(e){for(var i=null;e!==null;)e instanceof ShadowRoot&&(i=e.host,e=e.host),e=e.parentNode;return i}const SideCar=exportSidecar(effectCar,RemoveScrollSideCar);var ReactRemoveScroll=reactExports.forwardRef(function(e,i){return reactExports.createElement(RemoveScroll,__assign({},e,{ref:i,sideCar:SideCar}))});ReactRemoveScroll.classNames=RemoveScroll.classNames;var getDefaultParent=function(e){if(typeof document>"u")return null;var i=Array.isArray(e)?e[0]:e;return i.ownerDocument.body},counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={},lockCount=0,unwrapHost=function(e){return e&&(e.host||unwrapHost(e.parentNode))},correctTargets=function(e,i){return i.map(function(s){if(e.contains(s))return s;var a=unwrapHost(s);return a&&e.contains(a)?a:(console.error("aria-hidden",s,"in not contained inside",e,". Doing nothing"),null)}).filter(function(s){return!!s})},applyAttributeToOthers=function(e,i,s,a){var b=correctTargets(i,Array.isArray(e)?e:[e]);markerMap[s]||(markerMap[s]=new WeakMap);var et=markerMap[s],nt=[],c=new Set,ct=new Set(b),pt=function(St){!St||c.has(St)||(c.add(St),pt(St.parentNode))};b.forEach(pt);var xt=function(St){!St||ct.has(St)||Array.prototype.forEach.call(St.children,function(Et){if(c.has(Et))xt(Et);else try{var Rt=Et.getAttribute(a),Nt=Rt!==null&&Rt!=="false",It=(counterMap.get(Et)||0)+1,Gt=(et.get(Et)||0)+1;counterMap.set(Et,It),et.set(Et,Gt),nt.push(Et),It===1&&Nt&&uncontrolledNodes.set(Et,!0),Gt===1&&Et.setAttribute(s,"true"),Nt||Et.setAttribute(a,"true")}catch(Dt){console.error("aria-hidden: cannot operate on ",Et,Dt)}})};return xt(i),c.clear(),lockCount++,function(){nt.forEach(function(St){var Et=counterMap.get(St)-1,Rt=et.get(St)-1;counterMap.set(St,Et),et.set(St,Rt),Et||(uncontrolledNodes.has(St)||St.removeAttribute(a),uncontrolledNodes.delete(St)),Rt||St.removeAttribute(s)}),lockCount--,lockCount||(counterMap=new WeakMap,counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={})}},hideOthers=function(e,i,s){s===void 0&&(s="data-aria-hidden");var a=Array.from(Array.isArray(e)?e:[e]),b=getDefaultParent(e);return b?(a.push.apply(a,Array.from(b.querySelectorAll("[aria-live]"))),applyAttributeToOthers(a,b,s,"aria-hidden")):function(){return null}},DIALOG_NAME="Dialog",[createDialogContext,createDialogScope]=createContextScope(DIALOG_NAME),[DialogProvider,useDialogContext]=createDialogContext(DIALOG_NAME),Dialog$1=e=>{const{__scopeDialog:i,children:s,open:a,defaultOpen:b,onOpenChange:et,modal:nt=!0}=e,c=reactExports.useRef(null),ct=reactExports.useRef(null),[pt,xt]=useControllableState({prop:a,defaultProp:b??!1,onChange:et,caller:DIALOG_NAME});return jsxRuntimeExports.jsx(DialogProvider,{scope:i,triggerRef:c,contentRef:ct,contentId:useId(),titleId:useId(),descriptionId:useId(),open:pt,onOpenChange:xt,onOpenToggle:reactExports.useCallback(()=>xt(St=>!St),[xt]),modal:nt,children:s})};Dialog$1.displayName=DIALOG_NAME;var TRIGGER_NAME$4="DialogTrigger",DialogTrigger$1=reactExports.forwardRef((e,i)=>{const{__scopeDialog:s,...a}=e,b=useDialogContext(TRIGGER_NAME$4,s),et=useComposedRefs$1(i,b.triggerRef);return jsxRuntimeExports.jsx(Primitive.button,{type:"button","aria-haspopup":"dialog","aria-expanded":b.open,"aria-controls":b.contentId,"data-state":getState$2(b.open),...a,ref:et,onClick:composeEventHandlers(e.onClick,b.onOpenToggle)})});DialogTrigger$1.displayName=TRIGGER_NAME$4;var PORTAL_NAME$2="DialogPortal",[PortalProvider,usePortalContext]=createDialogContext(PORTAL_NAME$2,{forceMount:void 0}),DialogPortal$1=e=>{const{__scopeDialog:i,forceMount:s,children:a,container:b}=e,et=useDialogContext(PORTAL_NAME$2,i);return jsxRuntimeExports.jsx(PortalProvider,{scope:i,forceMount:s,children:reactExports.Children.map(a,nt=>jsxRuntimeExports.jsx(Presence,{present:s||et.open,children:jsxRuntimeExports.jsx(Portal$2,{asChild:!0,container:b,children:nt})}))})};DialogPortal$1.displayName=PORTAL_NAME$2;var OVERLAY_NAME$1="DialogOverlay",DialogOverlay$1=reactExports.forwardRef((e,i)=>{const s=usePortalContext(OVERLAY_NAME$1,e.__scopeDialog),{forceMount:a=s.forceMount,...b}=e,et=useDialogContext(OVERLAY_NAME$1,e.__scopeDialog);return et.modal?jsxRuntimeExports.jsx(Presence,{present:a||et.open,children:jsxRuntimeExports.jsx(DialogOverlayImpl,{...b,ref:i})}):null});DialogOverlay$1.displayName=OVERLAY_NAME$1;var Slot$1=createSlot("DialogOverlay.RemoveScroll"),DialogOverlayImpl=reactExports.forwardRef((e,i)=>{const{__scopeDialog:s,...a}=e,b=useDialogContext(OVERLAY_NAME$1,s);return jsxRuntimeExports.jsx(ReactRemoveScroll,{as:Slot$1,allowPinchZoom:!0,shards:[b.contentRef],children:jsxRuntimeExports.jsx(Primitive.div,{"data-state":getState$2(b.open),...a,ref:i,style:{pointerEvents:"auto",...a.style}})})}),CONTENT_NAME$4="DialogContent",DialogContent$1=reactExports.forwardRef((e,i)=>{const s=usePortalContext(CONTENT_NAME$4,e.__scopeDialog),{forceMount:a=s.forceMount,...b}=e,et=useDialogContext(CONTENT_NAME$4,e.__scopeDialog);return jsxRuntimeExports.jsx(Presence,{present:a||et.open,children:et.modal?jsxRuntimeExports.jsx(DialogContentModal,{...b,ref:i}):jsxRuntimeExports.jsx(DialogContentNonModal,{...b,ref:i})})});DialogContent$1.displayName=CONTENT_NAME$4;var DialogContentModal=reactExports.forwardRef((e,i)=>{const s=useDialogContext(CONTENT_NAME$4,e.__scopeDialog),a=reactExports.useRef(null),b=useComposedRefs$1(i,s.contentRef,a);return reactExports.useEffect(()=>{const et=a.current;if(et)return hideOthers(et)},[]),jsxRuntimeExports.jsx(DialogContentImpl,{...e,ref:b,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:composeEventHandlers(e.onCloseAutoFocus,et=>{var nt;et.preventDefault(),(nt=s.triggerRef.current)==null||nt.focus()}),onPointerDownOutside:composeEventHandlers(e.onPointerDownOutside,et=>{const nt=et.detail.originalEvent,c=nt.button===0&&nt.ctrlKey===!0;(nt.button===2||c)&&et.preventDefault()}),onFocusOutside:composeEventHandlers(e.onFocusOutside,et=>et.preventDefault())})}),DialogContentNonModal=reactExports.forwardRef((e,i)=>{const s=useDialogContext(CONTENT_NAME$4,e.__scopeDialog),a=reactExports.useRef(!1),b=reactExports.useRef(!1);return jsxRuntimeExports.jsx(DialogContentImpl,{...e,ref:i,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:et=>{var nt,c;(nt=e.onCloseAutoFocus)==null||nt.call(e,et),et.defaultPrevented||(a.current||(c=s.triggerRef.current)==null||c.focus(),et.preventDefault()),a.current=!1,b.current=!1},onInteractOutside:et=>{var ct,pt;(ct=e.onInteractOutside)==null||ct.call(e,et),et.defaultPrevented||(a.current=!0,et.detail.originalEvent.type==="pointerdown"&&(b.current=!0));const nt=et.target;((pt=s.triggerRef.current)==null?void 0:pt.contains(nt))&&et.preventDefault(),et.detail.originalEvent.type==="focusin"&&b.current&&et.preventDefault()}})}),DialogContentImpl=reactExports.forwardRef((e,i)=>{const{__scopeDialog:s,trapFocus:a,onOpenAutoFocus:b,onCloseAutoFocus:et,...nt}=e,c=useDialogContext(CONTENT_NAME$4,s),ct=reactExports.useRef(null),pt=useComposedRefs$1(i,ct);return useFocusGuards(),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(FocusScope,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:b,onUnmountAutoFocus:et,children:jsxRuntimeExports.jsx(DismissableLayer,{role:"dialog",id:c.contentId,"aria-describedby":c.descriptionId,"aria-labelledby":c.titleId,"data-state":getState$2(c.open),...nt,ref:pt,onDismiss:()=>c.onOpenChange(!1)})}),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(TitleWarning,{titleId:c.titleId}),jsxRuntimeExports.jsx(DescriptionWarning$1,{contentRef:ct,descriptionId:c.descriptionId})]})]})}),TITLE_NAME$1="DialogTitle",DialogTitle$1=reactExports.forwardRef((e,i)=>{const{__scopeDialog:s,...a}=e,b=useDialogContext(TITLE_NAME$1,s);return jsxRuntimeExports.jsx(Primitive.h2,{id:b.titleId,...a,ref:i})});DialogTitle$1.displayName=TITLE_NAME$1;var DESCRIPTION_NAME$1="DialogDescription",DialogDescription$1=reactExports.forwardRef((e,i)=>{const{__scopeDialog:s,...a}=e,b=useDialogContext(DESCRIPTION_NAME$1,s);return jsxRuntimeExports.jsx(Primitive.p,{id:b.descriptionId,...a,ref:i})});DialogDescription$1.displayName=DESCRIPTION_NAME$1;var CLOSE_NAME="DialogClose",DialogClose=reactExports.forwardRef((e,i)=>{const{__scopeDialog:s,...a}=e,b=useDialogContext(CLOSE_NAME,s);return jsxRuntimeExports.jsx(Primitive.button,{type:"button",...a,ref:i,onClick:composeEventHandlers(e.onClick,()=>b.onOpenChange(!1))})});DialogClose.displayName=CLOSE_NAME;function getState$2(e){return e?"open":"closed"}var TITLE_WARNING_NAME="DialogTitleWarning",[WarningProvider,useWarningContext]=createContext2(TITLE_WARNING_NAME,{contentName:CONTENT_NAME$4,titleName:TITLE_NAME$1,docsSlug:"dialog"}),TitleWarning=({titleId:e})=>{const i=useWarningContext(TITLE_WARNING_NAME),s=`\`${i.contentName}\` requires a \`${i.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${i.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${i.docsSlug}`;return reactExports.useEffect(()=>{e&&(document.getElementById(e)||console.error(s))},[s,e]),null},DESCRIPTION_WARNING_NAME="DialogDescriptionWarning",DescriptionWarning$1=({contentRef:e,descriptionId:i})=>{const a=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${useWarningContext(DESCRIPTION_WARNING_NAME).contentName}}.`;return reactExports.useEffect(()=>{var et;const b=(et=e.current)==null?void 0:et.getAttribute("aria-describedby");i&&b&&(document.getElementById(i)||console.warn(a))},[a,e,i]),null},Root$1=Dialog$1,Trigger$2=DialogTrigger$1,Portal$1=DialogPortal$1,Overlay=DialogOverlay$1,Content$1=DialogContent$1,Title=DialogTitle$1,Description=DialogDescription$1,Close=DialogClose,ROOT_NAME="AlertDialog",[createAlertDialogContext,createAlertDialogScope]=createContextScope(ROOT_NAME,[createDialogScope]),useDialogScope=createDialogScope(),AlertDialog$1=e=>{const{__scopeAlertDialog:i,...s}=e,a=useDialogScope(i);return jsxRuntimeExports.jsx(Root$1,{...a,...s,modal:!0})};AlertDialog$1.displayName=ROOT_NAME;var TRIGGER_NAME$3="AlertDialogTrigger",AlertDialogTrigger$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,...a}=e,b=useDialogScope(s);return jsxRuntimeExports.jsx(Trigger$2,{...b,...a,ref:i})});AlertDialogTrigger$1.displayName=TRIGGER_NAME$3;var PORTAL_NAME$1="AlertDialogPortal",AlertDialogPortal$1=e=>{const{__scopeAlertDialog:i,...s}=e,a=useDialogScope(i);return jsxRuntimeExports.jsx(Portal$1,{...a,...s})};AlertDialogPortal$1.displayName=PORTAL_NAME$1;var OVERLAY_NAME="AlertDialogOverlay",AlertDialogOverlay$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,...a}=e,b=useDialogScope(s);return jsxRuntimeExports.jsx(Overlay,{...b,...a,ref:i})});AlertDialogOverlay$1.displayName=OVERLAY_NAME;var CONTENT_NAME$3="AlertDialogContent",[AlertDialogContentProvider,useAlertDialogContentContext]=createAlertDialogContext(CONTENT_NAME$3),Slottable=createSlottable("AlertDialogContent"),AlertDialogContent$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,children:a,...b}=e,et=useDialogScope(s),nt=reactExports.useRef(null),c=useComposedRefs$1(i,nt),ct=reactExports.useRef(null);return jsxRuntimeExports.jsx(WarningProvider,{contentName:CONTENT_NAME$3,titleName:TITLE_NAME,docsSlug:"alert-dialog",children:jsxRuntimeExports.jsx(AlertDialogContentProvider,{scope:s,cancelRef:ct,children:jsxRuntimeExports.jsxs(Content$1,{role:"alertdialog",...et,...b,ref:c,onOpenAutoFocus:composeEventHandlers(b.onOpenAutoFocus,pt=>{var xt;pt.preventDefault(),(xt=ct.current)==null||xt.focus({preventScroll:!0})}),onPointerDownOutside:pt=>pt.preventDefault(),onInteractOutside:pt=>pt.preventDefault(),children:[jsxRuntimeExports.jsx(Slottable,{children:a}),jsxRuntimeExports.jsx(DescriptionWarning,{contentRef:nt})]})})})});AlertDialogContent$1.displayName=CONTENT_NAME$3;var TITLE_NAME="AlertDialogTitle",AlertDialogTitle$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,...a}=e,b=useDialogScope(s);return jsxRuntimeExports.jsx(Title,{...b,...a,ref:i})});AlertDialogTitle$1.displayName=TITLE_NAME;var DESCRIPTION_NAME="AlertDialogDescription",AlertDialogDescription$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,...a}=e,b=useDialogScope(s);return jsxRuntimeExports.jsx(Description,{...b,...a,ref:i})});AlertDialogDescription$1.displayName=DESCRIPTION_NAME;var ACTION_NAME="AlertDialogAction",AlertDialogAction$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,...a}=e,b=useDialogScope(s);return jsxRuntimeExports.jsx(Close,{...b,...a,ref:i})});AlertDialogAction$1.displayName=ACTION_NAME;var CANCEL_NAME="AlertDialogCancel",AlertDialogCancel$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,...a}=e,{cancelRef:b}=useAlertDialogContentContext(CANCEL_NAME,s),et=useDialogScope(s),nt=useComposedRefs$1(i,b);return jsxRuntimeExports.jsx(Close,{...et,...a,ref:nt})});AlertDialogCancel$1.displayName=CANCEL_NAME;var DescriptionWarning=({contentRef:e})=>{const i=`\`${CONTENT_NAME$3}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${CONTENT_NAME$3}\` by passing a \`${DESCRIPTION_NAME}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${CONTENT_NAME$3}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return reactExports.useEffect(()=>{var a;document.getElementById((a=e.current)==null?void 0:a.getAttribute("aria-describedby"))||console.warn(i)},[i,e]),null},Root2$2=AlertDialog$1,Trigger2$1=AlertDialogTrigger$1,Portal2=AlertDialogPortal$1,Overlay2=AlertDialogOverlay$1,Content2$2=AlertDialogContent$1,Action=AlertDialogAction$1,Cancel=AlertDialogCancel$1,Title2=AlertDialogTitle$1,Description2=AlertDialogDescription$1;const AlertDialog=Root2$2,AlertDialogTrigger=Trigger2$1,AlertDialogPortal=Portal2,AlertDialogOverlay=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Overlay2,{className:cn("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...i,ref:s}));AlertDialogOverlay.displayName=Overlay2.displayName;const AlertDialogContent=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsxs(AlertDialogPortal,{children:[jsxRuntimeExports.jsx(AlertDialogOverlay,{}),jsxRuntimeExports.jsx(Content2$2,{ref:s,className:cn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...i})]}));AlertDialogContent.displayName=Content2$2.displayName;const AlertDialogHeader=({className:e,...i})=>jsxRuntimeExports.jsx("div",{className:cn("flex flex-col space-y-2 text-center sm:text-left",e),...i});AlertDialogHeader.displayName="AlertDialogHeader";const AlertDialogFooter=({className:e,...i})=>jsxRuntimeExports.jsx("div",{className:cn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...i});AlertDialogFooter.displayName="AlertDialogFooter";const AlertDialogTitle=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Title2,{ref:s,className:cn("text-lg font-semibold",e),...i}));AlertDialogTitle.displayName=Title2.displayName;const AlertDialogDescription=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Description2,{ref:s,className:cn("text-sm text-muted-foreground",e),...i}));AlertDialogDescription.displayName=Description2.displayName;const AlertDialogAction=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Action,{ref:s,className:cn(buttonVariants(),e),...i}));AlertDialogAction.displayName=Action.displayName;const AlertDialogCancel=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Cancel,{ref:s,className:cn(buttonVariants({variant:"outline"}),"mt-2 sm:mt-0",e),...i}));AlertDialogCancel.displayName=Cancel.displayName;function SettingsPage(){const[e,i]=reactExports.useState(!0),[s,a]=reactExports.useState(!0),[b,et]=reactExports.useState(!1),[nt,c]=reactExports.useState(!1),ct=()=>{ue.success("Account deletion request submitted")};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card border-b border-border px-4 py-4 flex items-center gap-4 sticky top-0 z-10",children:[jsxRuntimeExports.jsx(Link,{to:"/profile",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"p-2 -ml-2",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-6 h-6 text-foreground"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-bold text-foreground",children:"Settings"})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center text-primary",children:jsxRuntimeExports.jsx(Bell,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Notifications"})]})}),jsxRuntimeExports.jsxs("div",{className:"divide-y divide-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Push Notifications"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive push notifications"})]}),jsxRuntimeExports.jsx(Switch,{checked:e,onCheckedChange:i})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Order Updates"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified about order status"})]}),jsxRuntimeExports.jsx(Switch,{checked:s,onCheckedChange:a})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Promotions"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive offers and discounts"})]}),jsxRuntimeExports.jsx(Switch,{checked:b,onCheckedChange:et})]})]})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:jsxRuntimeExports.jsx(Moon,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Appearance"})]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Dark Mode"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Switch to dark theme"})]}),jsxRuntimeExports.jsx(Switch,{checked:nt,onCheckedChange:c})]})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-accent/10 flex items-center justify-center text-accent",children:jsxRuntimeExports.jsx(Globe,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Language & Region"})]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Language"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"English (India)"})]}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-muted-foreground"})]})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gold/10 flex items-center justify-center text-gold",children:jsxRuntimeExports.jsx(Lock,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Security"})]})}),jsxRuntimeExports.jsxs("div",{className:"divide-y divide-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Change Password"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Update your password"})]}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-muted-foreground"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Two-Factor Authentication"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Add extra security"})]}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-muted-foreground"})]})]})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:jsxRuntimeExports.jsx(Smartphone,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"App Info"})]})}),jsxRuntimeExports.jsx("div",{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"Version"}),jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"1.0.0"})]})})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-card rounded-2xl shadow-elevated overflow-hidden border border-destructive/20",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-destructive/10 flex items-center justify-center text-destructive",children:jsxRuntimeExports.jsx(Trash2,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"font-semibold text-destructive",children:"Danger Zone"})]})}),jsxRuntimeExports.jsx("div",{className:"p-4",children:jsxRuntimeExports.jsxs(AlertDialog,{children:[jsxRuntimeExports.jsx(AlertDialogTrigger,{asChild:!0,children:jsxRuntimeExports.jsx(Button,{variant:"destructive",className:"w-full",children:"Delete Account"})}),jsxRuntimeExports.jsxs(AlertDialogContent,{children:[jsxRuntimeExports.jsxs(AlertDialogHeader,{children:[jsxRuntimeExports.jsx(AlertDialogTitle,{children:"Are you absolutely sure?"}),jsxRuntimeExports.jsx(AlertDialogDescription,{children:"This action cannot be undone. This will permanently delete your account and remove all your data from our servers."})]}),jsxRuntimeExports.jsxs(AlertDialogFooter,{children:[jsxRuntimeExports.jsx(AlertDialogCancel,{children:"Cancel"}),jsxRuntimeExports.jsx(AlertDialogAction,{onClick:ct,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete Account"})]})]})]})})]})]}),jsxRuntimeExports.jsx(BottomNav,{})]})}var COLLAPSIBLE_NAME="Collapsible",[createCollapsibleContext,createCollapsibleScope]=createContextScope(COLLAPSIBLE_NAME),[CollapsibleProvider,useCollapsibleContext]=createCollapsibleContext(COLLAPSIBLE_NAME),Collapsible=reactExports.forwardRef((e,i)=>{const{__scopeCollapsible:s,open:a,defaultOpen:b,disabled:et,onOpenChange:nt,...c}=e,[ct,pt]=useControllableState({prop:a,defaultProp:b??!1,onChange:nt,caller:COLLAPSIBLE_NAME});return jsxRuntimeExports.jsx(CollapsibleProvider,{scope:s,disabled:et,contentId:useId(),open:ct,onOpenToggle:reactExports.useCallback(()=>pt(xt=>!xt),[pt]),children:jsxRuntimeExports.jsx(Primitive.div,{"data-state":getState$1(ct),"data-disabled":et?"":void 0,...c,ref:i})})});Collapsible.displayName=COLLAPSIBLE_NAME;var TRIGGER_NAME$2="CollapsibleTrigger",CollapsibleTrigger=reactExports.forwardRef((e,i)=>{const{__scopeCollapsible:s,...a}=e,b=useCollapsibleContext(TRIGGER_NAME$2,s);return jsxRuntimeExports.jsx(Primitive.button,{type:"button","aria-controls":b.contentId,"aria-expanded":b.open||!1,"data-state":getState$1(b.open),"data-disabled":b.disabled?"":void 0,disabled:b.disabled,...a,ref:i,onClick:composeEventHandlers(e.onClick,b.onOpenToggle)})});CollapsibleTrigger.displayName=TRIGGER_NAME$2;var CONTENT_NAME$2="CollapsibleContent",CollapsibleContent=reactExports.forwardRef((e,i)=>{const{forceMount:s,...a}=e,b=useCollapsibleContext(CONTENT_NAME$2,e.__scopeCollapsible);return jsxRuntimeExports.jsx(Presence,{present:s||b.open,children:({present:et})=>jsxRuntimeExports.jsx(CollapsibleContentImpl,{...a,ref:i,present:et})})});CollapsibleContent.displayName=CONTENT_NAME$2;var CollapsibleContentImpl=reactExports.forwardRef((e,i)=>{const{__scopeCollapsible:s,present:a,children:b,...et}=e,nt=useCollapsibleContext(CONTENT_NAME$2,s),[c,ct]=reactExports.useState(a),pt=reactExports.useRef(null),xt=useComposedRefs$1(i,pt),St=reactExports.useRef(0),Et=St.current,Rt=reactExports.useRef(0),Nt=Rt.current,It=nt.open||c,Gt=reactExports.useRef(It),Dt=reactExports.useRef(void 0);return reactExports.useEffect(()=>{const Bt=requestAnimationFrame(()=>Gt.current=!1);return()=>cancelAnimationFrame(Bt)},[]),useLayoutEffect2(()=>{const Bt=pt.current;if(Bt){Dt.current=Dt.current||{transitionDuration:Bt.style.transitionDuration,animationName:Bt.style.animationName},Bt.style.transitionDuration="0s",Bt.style.animationName="none";const Lt=Bt.getBoundingClientRect();St.current=Lt.height,Rt.current=Lt.width,Gt.current||(Bt.style.transitionDuration=Dt.current.transitionDuration,Bt.style.animationName=Dt.current.animationName),ct(a)}},[nt.open,a]),jsxRuntimeExports.jsx(Primitive.div,{"data-state":getState$1(nt.open),"data-disabled":nt.disabled?"":void 0,id:nt.contentId,hidden:!It,...et,ref:xt,style:{"--radix-collapsible-content-height":Et?`${Et}px`:void 0,"--radix-collapsible-content-width":Nt?`${Nt}px`:void 0,...e.style},children:It&&b})});function getState$1(e){return e?"open":"closed"}var Root=Collapsible,Trigger$1=CollapsibleTrigger,Content=CollapsibleContent,DirectionContext=reactExports.createContext(void 0);function useDirection(e){const i=reactExports.useContext(DirectionContext);return e||i||"ltr"}var ACCORDION_NAME="Accordion",ACCORDION_KEYS=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[Collection$1,useCollection$1,createCollectionScope$1]=createCollection(ACCORDION_NAME),[createAccordionContext,createAccordionScope]=createContextScope(ACCORDION_NAME,[createCollectionScope$1,createCollapsibleScope]),useCollapsibleScope=createCollapsibleScope(),Accordion$1=React.forwardRef((e,i)=>{const{type:s,...a}=e,b=a,et=a;return jsxRuntimeExports.jsx(Collection$1.Provider,{scope:e.__scopeAccordion,children:s==="multiple"?jsxRuntimeExports.jsx(AccordionImplMultiple,{...et,ref:i}):jsxRuntimeExports.jsx(AccordionImplSingle,{...b,ref:i})})});Accordion$1.displayName=ACCORDION_NAME;var[AccordionValueProvider,useAccordionValueContext]=createAccordionContext(ACCORDION_NAME),[AccordionCollapsibleProvider,useAccordionCollapsibleContext]=createAccordionContext(ACCORDION_NAME,{collapsible:!1}),AccordionImplSingle=React.forwardRef((e,i)=>{const{value:s,defaultValue:a,onValueChange:b=()=>{},collapsible:et=!1,...nt}=e,[c,ct]=useControllableState({prop:s,defaultProp:a??"",onChange:b,caller:ACCORDION_NAME});return jsxRuntimeExports.jsx(AccordionValueProvider,{scope:e.__scopeAccordion,value:React.useMemo(()=>c?[c]:[],[c]),onItemOpen:ct,onItemClose:React.useCallback(()=>et&&ct(""),[et,ct]),children:jsxRuntimeExports.jsx(AccordionCollapsibleProvider,{scope:e.__scopeAccordion,collapsible:et,children:jsxRuntimeExports.jsx(AccordionImpl,{...nt,ref:i})})})}),AccordionImplMultiple=React.forwardRef((e,i)=>{const{value:s,defaultValue:a,onValueChange:b=()=>{},...et}=e,[nt,c]=useControllableState({prop:s,defaultProp:a??[],onChange:b,caller:ACCORDION_NAME}),ct=React.useCallback(xt=>c((St=[])=>[...St,xt]),[c]),pt=React.useCallback(xt=>c((St=[])=>St.filter(Et=>Et!==xt)),[c]);return jsxRuntimeExports.jsx(AccordionValueProvider,{scope:e.__scopeAccordion,value:nt,onItemOpen:ct,onItemClose:pt,children:jsxRuntimeExports.jsx(AccordionCollapsibleProvider,{scope:e.__scopeAccordion,collapsible:!0,children:jsxRuntimeExports.jsx(AccordionImpl,{...et,ref:i})})})}),[AccordionImplProvider,useAccordionContext]=createAccordionContext(ACCORDION_NAME),AccordionImpl=React.forwardRef((e,i)=>{const{__scopeAccordion:s,disabled:a,dir:b,orientation:et="vertical",...nt}=e,c=React.useRef(null),ct=useComposedRefs$1(c,i),pt=useCollection$1(s),St=useDirection(b)==="ltr",Et=composeEventHandlers(e.onKeyDown,Rt=>{var _r;if(!ACCORDION_KEYS.includes(Rt.key))return;const Nt=Rt.target,It=pt().filter(Ur=>{var ln;return!((ln=Ur.ref.current)!=null&&ln.disabled)}),Gt=It.findIndex(Ur=>Ur.ref.current===Nt),Dt=It.length;if(Gt===-1)return;Rt.preventDefault();let Bt=Gt;const Lt=0,Vt=Dt-1,Zt=()=>{Bt=Gt+1,Bt>Vt&&(Bt=Lt)},nr=()=>{Bt=Gt-1,Bt<Lt&&(Bt=Vt)};switch(Rt.key){case"Home":Bt=Lt;break;case"End":Bt=Vt;break;case"ArrowRight":et==="horizontal"&&(St?Zt():nr());break;case"ArrowDown":et==="vertical"&&Zt();break;case"ArrowLeft":et==="horizontal"&&(St?nr():Zt());break;case"ArrowUp":et==="vertical"&&nr();break}const ur=Bt%Dt;(_r=It[ur].ref.current)==null||_r.focus()});return jsxRuntimeExports.jsx(AccordionImplProvider,{scope:s,disabled:a,direction:b,orientation:et,children:jsxRuntimeExports.jsx(Collection$1.Slot,{scope:s,children:jsxRuntimeExports.jsx(Primitive.div,{...nt,"data-orientation":et,ref:ct,onKeyDown:a?void 0:Et})})})}),ITEM_NAME$1="AccordionItem",[AccordionItemProvider,useAccordionItemContext]=createAccordionContext(ITEM_NAME$1),AccordionItem$1=React.forwardRef((e,i)=>{const{__scopeAccordion:s,value:a,...b}=e,et=useAccordionContext(ITEM_NAME$1,s),nt=useAccordionValueContext(ITEM_NAME$1,s),c=useCollapsibleScope(s),ct=useId(),pt=a&&nt.value.includes(a)||!1,xt=et.disabled||e.disabled;return jsxRuntimeExports.jsx(AccordionItemProvider,{scope:s,open:pt,disabled:xt,triggerId:ct,children:jsxRuntimeExports.jsx(Root,{"data-orientation":et.orientation,"data-state":getState(pt),...c,...b,ref:i,disabled:xt,open:pt,onOpenChange:St=>{St?nt.onItemOpen(a):nt.onItemClose(a)}})})});AccordionItem$1.displayName=ITEM_NAME$1;var HEADER_NAME="AccordionHeader",AccordionHeader=React.forwardRef((e,i)=>{const{__scopeAccordion:s,...a}=e,b=useAccordionContext(ACCORDION_NAME,s),et=useAccordionItemContext(HEADER_NAME,s);return jsxRuntimeExports.jsx(Primitive.h3,{"data-orientation":b.orientation,"data-state":getState(et.open),"data-disabled":et.disabled?"":void 0,...a,ref:i})});AccordionHeader.displayName=HEADER_NAME;var TRIGGER_NAME$1="AccordionTrigger",AccordionTrigger$1=React.forwardRef((e,i)=>{const{__scopeAccordion:s,...a}=e,b=useAccordionContext(ACCORDION_NAME,s),et=useAccordionItemContext(TRIGGER_NAME$1,s),nt=useAccordionCollapsibleContext(TRIGGER_NAME$1,s),c=useCollapsibleScope(s);return jsxRuntimeExports.jsx(Collection$1.ItemSlot,{scope:s,children:jsxRuntimeExports.jsx(Trigger$1,{"aria-disabled":et.open&&!nt.collapsible||void 0,"data-orientation":b.orientation,id:et.triggerId,...c,...a,ref:i})})});AccordionTrigger$1.displayName=TRIGGER_NAME$1;var CONTENT_NAME$1="AccordionContent",AccordionContent$1=React.forwardRef((e,i)=>{const{__scopeAccordion:s,...a}=e,b=useAccordionContext(ACCORDION_NAME,s),et=useAccordionItemContext(CONTENT_NAME$1,s),nt=useCollapsibleScope(s);return jsxRuntimeExports.jsx(Content,{role:"region","aria-labelledby":et.triggerId,"data-orientation":b.orientation,...nt,...a,ref:i,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...e.style}})});AccordionContent$1.displayName=CONTENT_NAME$1;function getState(e){return e?"open":"closed"}var Root2$1=Accordion$1,Item$1=AccordionItem$1,Header=AccordionHeader,Trigger2=AccordionTrigger$1,Content2$1=AccordionContent$1;const Accordion=Root2$1,AccordionItem=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Item$1,{ref:s,className:cn("border-b",e),...i}));AccordionItem.displayName="AccordionItem";const AccordionTrigger=reactExports.forwardRef(({className:e,children:i,...s},a)=>jsxRuntimeExports.jsx(Header,{className:"flex",children:jsxRuntimeExports.jsxs(Trigger2,{ref:a,className:cn("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",e),...s,children:[i,jsxRuntimeExports.jsx(ChevronDown,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));AccordionTrigger.displayName=Trigger2.displayName;const AccordionContent=reactExports.forwardRef(({className:e,children:i,...s},a)=>jsxRuntimeExports.jsx(Content2$1,{ref:a,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...s,children:jsxRuntimeExports.jsx("div",{className:cn("pb-4 pt-0",e),children:i})}));AccordionContent.displayName=Content2$1.displayName;const faqs=[{question:"How do I place an order?",answer:"Browse kitchens near you, select dishes from the menu, add them to your cart, and proceed to checkout. You can pay using various payment methods including UPI, cards, and cash on delivery."},{question:"How can I track my order?",answer:"Once your order is placed, you can track it in real-time from the 'My Orders' section. You'll receive notifications at each stage - from acceptance to delivery."},{question:"What if I want to cancel my order?",answer:"You can cancel your order before it's accepted by the kitchen. Go to 'My Orders', select the order, and tap 'Cancel Order'. Once accepted, please contact support for cancellation."},{question:"How do refunds work?",answer:"Refunds are processed within 5-7 business days to your original payment method. For wallet credits, refunds are instant."},{question:"How do I become an Amma (Home Cook)?",answer:"Go to your Profile, tap 'Become an Amma', and follow the registration process. You'll need to provide your kitchen details, FSSAI license (if applicable), and complete verification."},{question:"What areas do you serve?",answer:"We currently serve in select cities. Enter your location on the home page to check if we deliver to your area. We're expanding rapidly!"},{question:"How do I apply a coupon?",answer:"At checkout, enter your coupon code in the 'Apply Discount Coupon' section and tap 'Apply'. Valid coupons will be applied to your order total."}],contactOptions=[{icon:MessageCircle,title:"Live Chat",subtitle:"Chat with our support team",action:"Start Chat",color:"text-primary",bgColor:"bg-primary/10"},{icon:Phone,title:"Call Us",subtitle:"+91 1800-XXX-XXXX",action:"Call Now",color:"text-green-600",bgColor:"bg-green-100"},{icon:Mail,title:"Email Support",subtitle:"support@ammacheythivanta.com",action:"Send Email",color:"text-gold",bgColor:"bg-gold/10"}];function HelpSupportPage(){return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card border-b border-border px-4 py-4 flex items-center gap-4 sticky top-0 z-10",children:[jsxRuntimeExports.jsx(Link,{to:"/profile",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"p-2 -ml-2",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-6 h-6 text-foreground"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-bold text-foreground",children:"Help & Support"})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-border",children:[jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Contact Us"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"We're here to help 24/7"})]}),jsxRuntimeExports.jsx("div",{className:"divide-y divide-border",children:contactOptions.map((e,i)=>jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:i*.1},className:"flex items-center gap-4 p-4",children:[jsxRuntimeExports.jsx("div",{className:`w-12 h-12 rounded-xl ${e.bgColor} flex items-center justify-center ${e.color}`,children:jsxRuntimeExports.jsx(e.icon,{className:"w-6 h-6"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:e.title}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:e.subtitle})]}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",className:"rounded-xl",children:e.action})]},e.title))})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-border",children:[jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Frequently Asked Questions"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Quick answers to common questions"})]}),jsxRuntimeExports.jsx(Accordion,{type:"single",collapsible:!0,className:"px-4",children:faqs.map((e,i)=>jsxRuntimeExports.jsxs(AccordionItem,{value:`item-${i}`,children:[jsxRuntimeExports.jsx(AccordionTrigger,{className:"text-left text-foreground hover:text-primary",children:e.question}),jsxRuntimeExports.jsx(AccordionContent,{className:"text-muted-foreground",children:e.answer})]},i))})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Quick Links"})}),jsxRuntimeExports.jsxs("div",{className:"divide-y divide-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 p-4",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:jsxRuntimeExports.jsx(FileText,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 font-medium text-foreground",children:"Terms & Conditions"}),jsxRuntimeExports.jsx(ExternalLink,{className:"w-5 h-5 text-muted-foreground"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 p-4",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:jsxRuntimeExports.jsx(FileText,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 font-medium text-foreground",children:"Privacy Policy"}),jsxRuntimeExports.jsx(ExternalLink,{className:"w-5 h-5 text-muted-foreground"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 p-4",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:jsxRuntimeExports.jsx(FileText,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 font-medium text-foreground",children:"Refund Policy"}),jsxRuntimeExports.jsx(ExternalLink,{className:"w-5 h-5 text-muted-foreground"})]})]})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-gradient-to-br from-primary/10 to-gold/10 rounded-2xl p-6 text-center",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-2",children:"Love our app?"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Rate us on the Play Store and help us improve!"}),jsxRuntimeExports.jsx(Button,{className:"rounded-xl px-6",children:"Rate Now "})]})]}),jsxRuntimeExports.jsx(BottomNav,{})]})}function SavedAddressesPage(){const{user:e,loading:i,updateUserLocation:s,deleteAddress:a}=useAuth(),b=useNavigate(),et=reactExports.useRef(null),nt=(pt,xt)=>{et.current=setTimeout(()=>{window.confirm("Delete this saved address?")&&a(pt,xt)},800)},c=()=>{et.current&&(clearTimeout(et.current),et.current=null)},ct=async pt=>{try{await s(pt.lat,pt.lng,pt.line1||pt.city,pt.label)}catch(xt){console.error("Failed to set default address:",xt)}};return i?jsxRuntimeExports.jsx(LoadingAnimation,{}):e?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background safe-top pb-32",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},onClick:()=>b(-1),className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center cursor-pointer",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Saved Addresses"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage your delivery locations"})]})]})}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[e.savedAddresses&&e.savedAddresses.length>0?e.savedAddresses.map((pt,xt)=>{var St,Et,Rt,Nt;return jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:xt*.1},className:"bg-card rounded-xl p-4 shadow-sm border border-border select-none",onTouchStart:()=>nt(pt.lat,pt.lng),onTouchEnd:c,onMouseDown:()=>nt(pt.lat,pt.lng),onMouseUp:c,onMouseLeave:c,onContextMenu:It=>It.preventDefault(),children:jsxRuntimeExports.jsxs("div",{className:"flex gap-4",onClick:()=>ct(pt),children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center shrink-0 cursor-pointer",children:pt.label==="work"?jsxRuntimeExports.jsx(Briefcase,{className:"w-5 h-5 text-primary"}):pt.label==="other"?jsxRuntimeExports.jsx(MapPin,{className:"w-5 h-5 text-primary"}):jsxRuntimeExports.jsx(House,{className:"w-5 h-5 text-primary"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 cursor-pointer",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground capitalize",children:pt.label||(pt.line1?"Home":"Saved Location")}),((St=e.address)==null?void 0:St.lat)===pt.lat&&((Et=e.address)==null?void 0:Et.lng)===pt.lng&&jsxRuntimeExports.jsx("div",{className:"px-2 py-0.5 rounded text-[10px] font-bold bg-primary/10 text-primary uppercase tracking-wide",children:"Selected"})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[pt.line1?jsxRuntimeExports.jsx("span",{className:"block",children:pt.line1}):jsxRuntimeExports.jsxs("span",{className:"block",children:[pt.pincode?`${pt.pincode}, `:"",pt.city]}),pt.line2&&jsxRuntimeExports.jsx("span",{className:"block",children:pt.line2})]}),((Rt=e.address)==null?void 0:Rt.lat)===pt.lat&&((Nt=e.address)==null?void 0:Nt.lng)===pt.lng&&jsxRuntimeExports.jsxs("div",{className:"mt-4 pt-4 border-t border-border",onClick:It=>It.stopPropagation(),children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Tag this location"}),jsxRuntimeExports.jsx("div",{className:"flex gap-2",children:["home","work","other"].map(It=>jsxRuntimeExports.jsxs("button",{onClick:()=>s(pt.lat,pt.lng,pt.line1||pt.city,It),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full border text-xs transition-all ${pt.label===It?"bg-primary text-primary-foreground border-primary":"bg-background border-border text-muted-foreground hover:border-primary/50"}`,children:[It==="home"&&jsxRuntimeExports.jsx(House,{className:"w-3 h-3"}),It==="work"&&jsxRuntimeExports.jsx(Briefcase,{className:"w-3 h-3"}),It==="other"&&jsxRuntimeExports.jsx(MapPin,{className:"w-3 h-3"}),jsxRuntimeExports.jsx("span",{className:"capitalize",children:It})]},It))})]})]})]})},xt)}):e.address?jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card rounded-xl p-4 shadow-sm border border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:jsxRuntimeExports.jsx(House,{className:"w-5 h-5 text-primary"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:"Home"}),jsxRuntimeExports.jsx("div",{className:"px-2 py-0.5 rounded text-[10px] font-bold bg-primary/10 text-primary uppercase tracking-wide",children:"Default"})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[e.address.line1?jsxRuntimeExports.jsx("span",{className:"block",children:e.address.line1}):jsxRuntimeExports.jsxs("span",{className:"block",children:[e.address.pincode?`${e.address.pincode}, `:"",e.address.city]}),e.address.line2&&jsxRuntimeExports.jsx("span",{className:"block",children:e.address.line2})]})]})]})}):jsxRuntimeExports.jsxs("div",{className:"text-center py-12 bg-card rounded-xl border border-dashed border-border",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-10 h-10 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"No saved addresses found"}),jsxRuntimeExports.jsx(Button,{onClick:()=>b("/location-select"),children:"Add Address"})]}),jsxRuntimeExports.jsxs(Button,{variant:"ghost",className:"w-full flex items-center justify-center gap-2 py-6 border border-dashed border-border rounded-xl text-muted-foreground hover:text-primary hover:border-primary/50 hover:bg-primary/5 transition-all",onClick:()=>b("/location-select"),children:[jsxRuntimeExports.jsx(Plus,{className:"w-5 h-5"}),jsxRuntimeExports.jsx("span",{children:"Add New Address"})]})]})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background px-4",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-16 h-16 text-muted-foreground mb-4"}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold mb-2",children:"Login Required"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground text-center mb-6",children:"Please login to manage your saved addresses"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Login Now"})})]})}function FavoritesPage(){const{user:e,loading:i}=useAuth(),{kitchens:s,loading:a}=useKitchens();if(useLocationContext(),i||a)return jsxRuntimeExports.jsx(LoadingAnimation,{});if(!e)return jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background px-4",children:[jsxRuntimeExports.jsx(Heart,{className:"w-16 h-16 text-muted-foreground mb-4"}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold mb-2",children:"Login Required"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground text-center mb-6",children:"Please login to view your favorite kitchens"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Login Now"})})]});const b=s.filter(et=>{var nt;return(nt=e.favorites)==null?void 0:nt.includes(et.id)});return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background safe-top pb-24",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-40 bg-background/80 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",className:"h-10 w-10 -ml-2 rounded-full hover:bg-muted",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-6 h-6"})})}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold text-foreground",children:"My Favorites"})]})}),jsxRuntimeExports.jsx("div",{className:"p-4",children:b.length>0?jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.map((et,nt)=>jsxRuntimeExports.jsx(KitchenCard,{kitchen:et,index:nt},et.id))}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-muted flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(Heart,{className:"w-8 h-8 text-muted-foreground"})}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-foreground mb-2",children:"No favorites yet"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-6 max-w-xs",children:"Start exploring kitchens and save your favorites here for quick access!"}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground shadow-elevated",children:"Explore Kitchens"})})]})})]})}function SearchPage(){const[e,i]=reactExports.useState(""),[s,a]=reactExports.useState(null),{kitchens:b,loading:et}=useKitchens(),nt=[{id:"veg",label:"Veg",icon:Leaf},{id:"biryani",label:"Biryani",emoji:""},{id:"tiffin",label:"Tiffins",emoji:""},{id:"meals",label:"Meals",emoji:""},{id:"sweets",label:"Sweets",emoji:""}],c=b.filter(ct=>{const pt=!e||ct.name.toLowerCase().includes(e.toLowerCase())||ct.specialties.some(St=>St.toLowerCase().includes(e.toLowerCase())),xt=!s||s==="veg"&&ct.isVeg||ct.specialties.some(St=>St.toLowerCase().includes(s.toLowerCase()));return pt&&xt});return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),jsxRuntimeExports.jsx("input",{type:"text",value:e,onChange:ct=>i(ct.target.value),placeholder:"Search dishes, kitchens...",className:"w-full pl-12 pr-4 py-3 rounded-xl bg-secondary border-0 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20",autoFocus:!0})]}),jsxRuntimeExports.jsx("div",{className:"flex gap-2 mt-4 overflow-x-auto hide-scrollbar",children:nt.map(ct=>jsxRuntimeExports.jsxs(motion.button,{whileTap:{scale:.95},onClick:()=>a(s===ct.id?null:ct.id),className:`flex items-center gap-1.5 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${s===ct.id?"gradient-primary text-primary-foreground":"bg-secondary text-secondary-foreground"}`,children:[ct.icon?jsxRuntimeExports.jsx(ct.icon,{className:"w-4 h-4"}):jsxRuntimeExports.jsx("span",{children:ct.emoji}),ct.label]},ct.id))})]}),!e&&jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide mb-3",children:"Popular Searches"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:["Biryani","Idli Dosa","Thali","Chicken Curry","Pickles"].map(ct=>jsxRuntimeExports.jsx(motion.button,{whileTap:{scale:.95},onClick:()=>i(ct),className:"px-4 py-2 rounded-full bg-secondary text-secondary-foreground text-sm",children:ct},ct))})]}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4",children:et?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-12",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):c.length===0?jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No kitchens found"})}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:[c.length," kitchens found"]}),jsxRuntimeExports.jsx("div",{className:"space-y-4",children:c.map((ct,pt)=>jsxRuntimeExports.jsx(KitchenCard,{kitchen:ct,index:pt},ct.id))})]})}),jsxRuntimeExports.jsx(BottomNav,{})]})}const statusConfig$1={pending:{label:"Order Placed",color:"text-muted-foreground",icon:Clock},accepted:{label:"Accepted",color:"text-gold",icon:Check},cooking:{label:"Cooking",color:"text-primary",icon:ChefHat},packed:{label:"Ready",color:"text-accent",icon:Package},out_for_delivery:{label:"On the way",color:"text-accent",icon:Truck},delivered:{label:"Delivered",color:"text-accent",icon:Check},cancelled:{label:"Cancelled",color:"text-destructive",icon:Clock}};function OrdersPage(){const{user:e}=useAuth(),{orders:i,loading:s,error:a}=useUserOrders(e==null?void 0:e.id),[b,et]=reactExports.useState("active"),nt=i.filter(ct=>!["delivered","cancelled"].includes(ct.status)),c=i.filter(ct=>["delivered","cancelled"].includes(ct.status));return e?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border px-4 py-4",children:[jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold text-foreground",children:"My Orders"}),jsxRuntimeExports.jsx("div",{className:"flex bg-secondary rounded-xl p-1 mt-4",children:["active","past"].map(ct=>jsxRuntimeExports.jsx("button",{onClick:()=>et(ct),className:`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${b===ct?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:ct==="active"?"Active":"Past Orders"},ct))})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-4 space-y-4",children:[s?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-12",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):a?jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsx("p",{className:"text-destructive",children:a})}):(b==="active"?nt:c).map((ct,pt)=>{const xt=statusConfig$1[ct.status],St=xt.icon;return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:pt*.1},className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:ct.kitchenName}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",ct.id.slice(-8)]})]}),jsxRuntimeExports.jsxs("div",{className:cn("flex items-center gap-1 px-2 py-1 rounded-full bg-secondary",xt.color),children:[jsxRuntimeExports.jsx(St,{className:"w-3 h-3"}),jsxRuntimeExports.jsx("span",{className:"text-xs font-medium",children:xt.label})]})]}),jsxRuntimeExports.jsx("div",{className:"text-sm text-muted-foreground mb-3",children:ct.items.map((Et,Rt)=>jsxRuntimeExports.jsxs("span",{children:[Et.dish.name," x",Et.quantity,Rt<ct.items.length-1&&", "]},Rt))}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-border",children:[jsxRuntimeExports.jsxs("span",{className:"font-semibold text-foreground",children:["",ct.totalAmount]}),ct.estimatedDelivery&&jsxRuntimeExports.jsxs("span",{className:"text-sm text-muted-foreground",children:["ETA: ",ct.estimatedDelivery]})]}),!["delivered","cancelled"].includes(ct.status)&&jsxRuntimeExports.jsx("div",{className:"mt-4 pt-4 border-t border-border",children:jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between",children:["accepted","cooking","packed","out_for_delivery"].map((Et,Rt)=>{const Nt=statusConfig$1[Et],It=Nt.icon,Gt=["pending","accepted","cooking","packed","out_for_delivery"],Dt=Gt.indexOf(ct.status),Bt=Gt.indexOf(Et),Lt=Dt>=Bt;return jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center gap-1",children:[jsxRuntimeExports.jsx("div",{className:cn("w-8 h-8 rounded-full flex items-center justify-center transition-all",Lt?"bg-primary text-primary-foreground":"bg-secondary text-muted-foreground"),children:jsxRuntimeExports.jsx(It,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("span",{className:cn("text-[10px]",Lt?"text-foreground":"text-muted-foreground"),children:Nt.label})]},Et)})})})]},ct.id)}),!s&&(b==="active"?nt:c).length===0&&jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Package,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:b==="active"?"No active orders":"No past orders"})]})]}),jsxRuntimeExports.jsx(BottomNav,{})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4 pb-24",children:[jsxRuntimeExports.jsx(Package,{className:"w-16 h-16 text-muted-foreground mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"Please login to view orders"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Login"})}),jsxRuntimeExports.jsx(BottomNav,{})]})}function useAmmaKitchens(e){const[i,s]=reactExports.useState([]),[a,b]=reactExports.useState(!0),[et,nt]=reactExports.useState(null);return reactExports.useEffect(()=>{if(!e){b(!1);return}const c=ref(database,"kitchens"),ct=onValue(c,pt=>{try{const xt=pt.val();if(xt){const St=Object.entries(xt).map(([Et,Rt])=>({...Rt,id:Et})).filter(Et=>Et.ownerId===e);s(St)}else s([]);b(!1)}catch{nt("Failed to fetch kitchens"),b(!1)}});return()=>ct()},[e]),{kitchens:i,loading:a,error:et}}function useKitchenOrders(e){const[i,s]=reactExports.useState([]),[a,b]=reactExports.useState(!0),[et,nt]=reactExports.useState(null);return reactExports.useEffect(()=>{if(!e){b(!1);return}const c=ref(database,"orders"),ct=onValue(c,pt=>{try{const xt=pt.val();if(xt){const St=Object.entries(xt).map(([Et,Rt])=>({...Rt,id:Et})).filter(Et=>Et.kitchenId===e).sort((Et,Rt)=>Rt.createdAt-Et.createdAt);s(St)}else s([]);b(!1)}catch{nt("Failed to fetch orders"),b(!1)}});return()=>ct()},[e]),{orders:i,loading:a,error:et}}function useAllKitchens(){const[e,i]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[b,et]=reactExports.useState(null);return reactExports.useEffect(()=>{const nt=ref(database,"kitchens"),c=onValue(nt,ct=>{try{const pt=ct.val();if(pt){const xt=Object.entries(pt).map(([St,Et])=>({...Et,id:St}));i(xt)}else i([]);a(!1)}catch{et("Failed to fetch kitchens"),a(!1)}});return()=>c()},[]),{kitchens:e,loading:s,error:b}}function useAllOrders(){const[e,i]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[b,et]=reactExports.useState(null);return reactExports.useEffect(()=>{const nt=ref(database,"orders"),c=onValue(nt,ct=>{try{const pt=ct.val();if(pt){const xt=Object.entries(pt).map(([St,Et])=>({...Et,id:St})).sort((St,Et)=>Et.createdAt-St.createdAt);i(xt)}else i([]);a(!1)}catch{et("Failed to fetch orders"),a(!1)}});return()=>c()},[]),{orders:e,loading:s,error:b}}function useAllUsers(){const[e,i]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[b,et]=reactExports.useState(null);return reactExports.useEffect(()=>{const nt=ref(database,"users"),c=onValue(nt,ct=>{try{const pt=ct.val();if(pt){const xt=Object.entries(pt).map(([St,Et])=>({...Et,id:St}));i(xt)}else i([]);a(!1)}catch{et("Failed to fetch users"),a(!1)}});return()=>c()},[]),{users:e,loading:s,error:b}}async function approveKitchen(e){const i=ref(database,`kitchens/${e}`);await update(i,{isApproved:!0})}async function rejectKitchen(e){const i=ref(database,`kitchens/${e}`);await remove(i)}async function deleteUser(e){const i=ref(database,`users/${e}`);await remove(i)}async function updateUserRole(e,i,s){const a=ref(database,`users/${e}`);if(s&&s!==i){if(s==="amma"){const b=ref(database,"kitchens"),nt=(await new Promise((c,ct)=>{onValue(b,c,{onlyOnce:!0})})).val();if(nt){const c=[];Object.entries(nt).forEach(([ct,pt])=>{pt.ownerId===e&&(c.push(remove(ref(database,`kitchens/${ct}`))),c.push(deleteKitchenDishes(ct)))}),await Promise.all(c)}}if(s==="franchise_admin"){const b=ref(database,"franchises"),nt=(await new Promise((c,ct)=>{onValue(b,c,{onlyOnce:!0})})).val();if(nt){const c=[];Object.entries(nt).forEach(([ct,pt])=>{pt.adminId===e&&c.push(update(ref(database,`franchises/${ct}`),{adminId:"",adminName:"",adminEmail:""}))}),await Promise.all(c)}await update(a,{franchiseId:null})}}await update(a,{role:i})}async function deleteKitchenDishes(e){const i=ref(database,"dishes"),a=(await new Promise((b,et)=>{onValue(i,b,{onlyOnce:!0})})).val();if(a){const b=[];Object.entries(a).forEach(([et,nt])=>{nt.kitchenId===e&&b.push(remove(ref(database,`dishes/${et}`)))}),await Promise.all(b)}}const statusConfig={pending:{label:"New Order",color:"bg-gold text-foreground",nextStatus:"accepted"},accepted:{label:"Accepted",color:"bg-primary text-primary-foreground",nextStatus:"cooking"},cooking:{label:"Cooking",color:"bg-accent text-accent-foreground",nextStatus:"packed"},packed:{label:"Ready",color:"bg-veg text-primary-foreground",nextStatus:"out_for_delivery"},out_for_delivery:{label:"Out for Delivery",color:"bg-accent text-accent-foreground",nextStatus:"delivered"},delivered:{label:"Delivered",color:"bg-muted text-muted-foreground"},cancelled:{label:"Cancelled",color:"bg-destructive text-destructive-foreground"}};function AmmaDashboard(){const{user:e,signOut:i}=useAuth(),s=useNavigate(),{kitchens:a,loading:b}=useAmmaKitchens(e==null?void 0:e.id),[et,nt]=reactExports.useState(null),{orders:c,loading:ct}=useKitchenOrders(et||void 0),{dishes:pt}=useDishes(et||void 0),{coupons:xt}=useKitchenCoupons(et||void 0),[St,Et]=reactExports.useState("orders"),[Rt,Nt]=reactExports.useState(!1),[It,Gt]=reactExports.useState({code:"",discountType:"percentage",discountValue:10,minOrderAmount:0,maxDiscount:0}),[Dt,Bt]=reactExports.useState(!1);reactExports.useEffect(()=>{a.length>0&&!et&&nt(a[0].id)},[a,et]);const Lt=a.find(Fr=>Fr.id===et),Vt=c.filter(Fr=>!["delivered","cancelled"].includes(Fr.status)),Zt=c.filter(Fr=>{const rn=new Date;return new Date(Fr.createdAt).toDateString()===rn.toDateString()}),nr=Zt.reduce((Fr,rn)=>Fr+rn.totalAmount,0),ur=async(Fr,rn)=>{try{await updateOrderStatus(Fr,rn),ue.success(`Order ${rn==="cancelled"?"cancelled":"updated"}!`)}catch{ue.error("Failed to update order")}},_r=async()=>{if(!(!et||!Lt))try{await updateKitchen(et,{isOpen:!Lt.isOpen}),ue.success(Lt.isOpen?"Kitchen closed":"Kitchen opened")}catch{ue.error("Failed to update kitchen status")}},Ur=async()=>{if(!et||!It.code.trim()){ue.error("Please enter a coupon code");return}Bt(!0);try{await createCoupon({code:It.code.toUpperCase(),kitchenId:et,discountType:It.discountType,discountValue:It.discountValue,minOrderAmount:It.minOrderAmount||void 0,maxDiscount:It.maxDiscount||void 0,usedCount:0,isActive:!0,createdAt:Date.now()}),ue.success("Coupon created!"),Nt(!1),Gt({code:"",discountType:"percentage",discountValue:10,minOrderAmount:0,maxDiscount:0})}catch{ue.error("Failed to create coupon")}Bt(!1)},ln=async Fr=>{try{await deleteCoupon(Fr),ue.success("Coupon deleted")}catch{ue.error("Failed to delete coupon")}},an=async Fr=>{try{await updateCoupon(Fr.id,{isActive:!Fr.isActive}),ue.success(Fr.isActive?"Coupon deactivated":"Coupon activated")}catch{ue.error("Failed to update coupon")}};return!e||e.role!=="amma"?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[jsxRuntimeExports.jsx(ChefHat,{className:"w-16 h-16 text-muted-foreground mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"You need to be registered as an Amma to access this"}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Go Home"})})]}):b?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):a.length===0?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"My Kitchen"}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:async()=>{await i(),s("/auth")},className:"text-destructive",children:jsxRuntimeExports.jsx(LogOut,{className:"w-5 h-5"})})]})}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center px-4 py-16",children:[jsxRuntimeExports.jsx(ChefHat,{className:"w-20 h-20 text-muted-foreground mb-4"}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"No Kitchen Yet"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground text-center mb-6",children:"Start your home kitchen journey and share your delicious food with the community!"}),jsxRuntimeExports.jsx(Link,{to:"/amma/register",children:jsxRuntimeExports.jsxs(Button,{className:"gradient-primary text-primary-foreground",children:[jsxRuntimeExports.jsx(Plus,{className:"w-5 h-5 mr-2"})," Register Your Kitchen"]})})]})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:Lt==null?void 0:Lt.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Kitchen Dashboard"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Button,{onClick:_r,variant:"outline",size:"sm",className:cn("rounded-full",Lt!=null&&Lt.isOpen?"border-veg text-veg":"border-destructive text-destructive"),children:Lt!=null&&Lt.isOpen?" Open":" Closed"}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:()=>s(`/amma/edit-kitchen/${et}`),title:"Edit Kitchen",children:jsxRuntimeExports.jsx(Settings,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:async()=>{await i(),s("/auth")},className:"text-destructive",children:jsxRuntimeExports.jsx(LogOut,{className:"w-5 h-5"})})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-2 px-4 pb-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-secondary rounded-xl p-3 text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-lg font-bold text-foreground",children:Vt.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Active"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-secondary rounded-xl p-3 text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-lg font-bold text-foreground",children:Zt.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Today"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-secondary rounded-xl p-3 text-center",children:[jsxRuntimeExports.jsxs("p",{className:"text-lg font-bold text-primary",children:["",nr]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Earnings"})]})]}),jsxRuntimeExports.jsx("div",{className:"flex bg-secondary mx-4 rounded-xl p-1 mb-4",children:["orders","menu","coupons","stats"].map(Fr=>jsxRuntimeExports.jsx("button",{onClick:()=>Et(Fr),className:`flex-1 py-2 rounded-lg text-xs font-medium transition-all capitalize ${St===Fr?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:Fr},Fr))})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[St==="orders"&&jsxRuntimeExports.jsx("div",{className:"space-y-4",children:ct?jsxRuntimeExports.jsx("div",{className:"flex justify-center py-8",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):Vt.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Package,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No active orders"})]}):jsxRuntimeExports.jsx(AnimatePresence,{children:Vt.map((Fr,rn)=>jsxRuntimeExports.jsx(OrderCard,{order:Fr,index:rn,onStatusUpdate:ur},Fr.id))})}),St==="menu"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-foreground",children:["Your Dishes (",pt.length,")"]}),jsxRuntimeExports.jsx(Link,{to:"/amma/add-dish",children:jsxRuntimeExports.jsxs(Button,{size:"sm",className:"gradient-primary text-primary-foreground",children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4 mr-1"})," Add"]})})]}),pt.length===0?jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No dishes yet. Add your first dish!"})}):pt.map(Fr=>jsxRuntimeExports.jsxs(motion.div,{className:"bg-card rounded-xl p-4 shadow-card flex gap-4",children:[jsxRuntimeExports.jsx("img",{src:Fr.image,alt:Fr.name,className:"w-20 h-20 rounded-lg object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:Fr.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:Fr.category}),jsxRuntimeExports.jsxs("p",{className:"text-primary font-semibold",children:["",Fr.price]})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-2",children:[jsxRuntimeExports.jsx(Button,{size:"icon",variant:"ghost",children:jsxRuntimeExports.jsx(SquarePen,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(Button,{size:"icon",variant:"ghost",className:"text-destructive",onClick:()=>{deleteDish(Fr.id),ue.success("Dish deleted")},children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]})]},Fr.id))]}),St==="coupons"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-foreground",children:["Your Coupons (",xt.length,")"]}),jsxRuntimeExports.jsxs(Button,{size:"sm",className:"gradient-primary text-primary-foreground",onClick:()=>Nt(!Rt),children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4 mr-1"})," Create"]})]}),Rt&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"bg-card rounded-xl p-4 shadow-card space-y-3",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:"Create New Coupon"}),jsxRuntimeExports.jsx(Input,{placeholder:"Coupon Code (e.g., SAVE20)",value:It.code,onChange:Fr=>Gt({...It,code:Fr.target.value.toUpperCase()}),className:"bg-secondary border-0 uppercase"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("select",{value:It.discountType,onChange:Fr=>Gt({...It,discountType:Fr.target.value}),className:"bg-secondary rounded-md px-3 py-2 text-sm text-foreground",children:[jsxRuntimeExports.jsx("option",{value:"percentage",children:"% Off"}),jsxRuntimeExports.jsx("option",{value:"fixed",children:" Fixed Off"}),jsxRuntimeExports.jsx("option",{value:"final_price",children:"Final Price"})]}),jsxRuntimeExports.jsx(Input,{type:"number",placeholder:It.discountType==="percentage"?"% value":" amount",value:It.discountValue,onChange:Fr=>Gt({...It,discountValue:Number(Fr.target.value)}),className:"bg-secondary border-0"})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(Input,{type:"number",placeholder:"Min Order  (optional)",value:It.minOrderAmount||"",onChange:Fr=>Gt({...It,minOrderAmount:Number(Fr.target.value)}),className:"bg-secondary border-0"}),It.discountType==="percentage"&&jsxRuntimeExports.jsx(Input,{type:"number",placeholder:"Max Discount  (optional)",value:It.maxDiscount||"",onChange:Fr=>Gt({...It,maxDiscount:Number(Fr.target.value)}),className:"bg-secondary border-0"})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Button,{onClick:Ur,disabled:Dt,className:"flex-1 gradient-primary text-primary-foreground",children:Dt?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}):"Create Coupon"}),jsxRuntimeExports.jsx(Button,{variant:"outline",onClick:()=>Nt(!1),children:"Cancel"})]})]}),xt.length===0&&!Rt?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Tag,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No coupons yet. Create your first coupon!"})]}):xt.map(Fr=>jsxRuntimeExports.jsx(motion.div,{className:"bg-card rounded-xl p-4 shadow-card",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:cn("w-12 h-12 rounded-lg flex items-center justify-center",Fr.isActive?"bg-veg/10":"bg-muted"),children:jsxRuntimeExports.jsx(Percent,{className:cn("w-6 h-6",Fr.isActive?"text-veg":"text-muted-foreground")})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-bold text-foreground",children:Fr.code}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:[Fr.discountType==="percentage"&&`${Fr.discountValue}% off`,Fr.discountType==="fixed"&&`${Fr.discountValue} off`,Fr.discountType==="final_price"&&`Final price: ${Fr.discountValue}`,Fr.minOrderAmount?`  Min ${Fr.minOrderAmount}`:""]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:["Used: ",Fr.usedCount," times"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Button,{size:"icon",variant:"ghost",onClick:()=>an(Fr),className:Fr.isActive?"text-veg":"text-muted-foreground",children:Fr.isActive?jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"}):jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(Button,{size:"icon",variant:"ghost",className:"text-destructive",onClick:()=>ln(Fr.id),children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]})]})},Fr.id))]}),St==="stats"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Today's Summary"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-secondary rounded-xl p-4",children:[jsxRuntimeExports.jsx(DollarSign,{className:"w-6 h-6 text-primary mb-2"}),jsxRuntimeExports.jsxs("p",{className:"text-2xl font-bold text-foreground",children:["",nr]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Earnings"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-secondary rounded-xl p-4",children:[jsxRuntimeExports.jsx(ShoppingBag,{className:"w-6 h-6 text-accent mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:Zt.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Orders Completed"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Kitchen Info"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Rating"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground font-medium",children:[" ",Lt==null?void 0:Lt.rating]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Total Reviews"}),jsxRuntimeExports.jsx("span",{className:"text-foreground font-medium",children:Lt==null?void 0:Lt.totalRatings})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Menu Items"}),jsxRuntimeExports.jsx("span",{className:"text-foreground font-medium",children:pt.length})]})]})]})]})]})]})}function OrderCard({order:e,index:i,onStatusUpdate:s}){const a=statusConfig[e.status];return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-100},transition:{delay:i*.05},className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",e.id.slice(-8)]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(e.createdAt).toLocaleTimeString()})]}),jsxRuntimeExports.jsx("span",{className:cn("px-3 py-1 rounded-full text-xs font-medium",a.color),children:a.label})]}),jsxRuntimeExports.jsx("div",{className:"space-y-1 mb-3",children:e.items.map((b,et)=>jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:[b.dish.name," x",b.quantity]}),jsxRuntimeExports.jsxs("span",{className:"text-muted-foreground",children:["",b.dish.price*b.quantity]})]},et))}),e.notes&&jsxRuntimeExports.jsx("div",{className:"bg-secondary rounded-lg p-2 mb-3",children:jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:["Note: ",e.notes]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-3",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-3 h-3"}),jsxRuntimeExports.jsxs("span",{children:[e.deliveryAddress.line1,", ",e.deliveryAddress.city]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-border",children:[jsxRuntimeExports.jsxs("span",{className:"font-bold text-foreground",children:["",e.totalAmount]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[e.status!=="cancelled"&&a.nextStatus&&jsxRuntimeExports.jsxs(Button,{size:"sm",className:"gradient-primary text-primary-foreground",onClick:()=>s(e.id,a.nextStatus),children:[jsxRuntimeExports.jsx(Check,{className:"w-4 h-4 mr-1"}),a.nextStatus==="accepted"?"Accept":"Next"]}),e.status==="pending"&&jsxRuntimeExports.jsx(Button,{size:"sm",variant:"outline",className:"text-destructive border-destructive",onClick:()=>s(e.id,"cancelled"),children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]})]})]})}const IMGBB_API_KEY="271837f4240842ef12577a95dbae3e88",IMGBB_ENDPOINT="https://api.imgbb.com/1/upload";async function uploadImage(e){const i=new FormData;i.append("key",IMGBB_API_KEY),i.append("image",e);const s=await fetch(IMGBB_ENDPOINT,{method:"POST",body:i});if(!s.ok)throw new Error("Failed to upload image");return s.json()}async function uploadToImgBB(e){try{return(await uploadImage(e)).data}catch(i){return console.error("ImgBB upload error:",i),null}}var mapboxGl={exports:{}};(function(e,i){(function(s,a){e.exports=a()})(commonjsGlobal,function(){var s,a,b;function et(c,ct){if(!s)s=ct;else if(!a)a=ct;else{var pt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+a+")(sharedChunk); self.onerror = null;",xt={};s(xt),b=ct(xt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(b.workerUrl=window.URL.createObjectURL(new Blob([pt],{type:"text/javascript"})))}}et(["exports"],function(c){var ct=1e-6,pt=typeof Float32Array<"u"?Float32Array:Array;function xt(_,o){var g=o[0],_e=o[1],rt=o[2],ot=o[3],at=g*ot-rt*_e;return at?(_[0]=ot*(at=1/at),_[1]=-_e*at,_[2]=-rt*at,_[3]=g*at,_):null}function St(){var _=new pt(9);return pt!=Float32Array&&(_[1]=0,_[2]=0,_[3]=0,_[5]=0,_[6]=0,_[7]=0),_[0]=1,_[4]=1,_[8]=1,_}function Et(_,o){var g=o[0],_e=o[1],rt=o[2],ot=o[3],at=o[4],ut=o[5],ft=o[6],gt=o[7],Ct=o[8];return _[0]=at*Ct-ut*gt,_[1]=rt*gt-_e*Ct,_[2]=_e*ut-rt*at,_[3]=ut*ft-ot*Ct,_[4]=g*Ct-rt*ft,_[5]=rt*ot-g*ut,_[6]=ot*gt-at*ft,_[7]=_e*ft-g*gt,_[8]=g*at-_e*ot,_}function Rt(_,o,g){var _e=o[0],rt=o[1],ot=o[2],at=o[3],ut=o[4],ft=o[5],gt=o[6],Ct=o[7],At=o[8],kt=g[0],zt=g[1],Ut=g[2],Kt=g[3],er=g[4],Jt=g[5],or=g[6],lr=g[7],pr=g[8];return _[0]=kt*_e+zt*at+Ut*gt,_[1]=kt*rt+zt*ut+Ut*Ct,_[2]=kt*ot+zt*ft+Ut*At,_[3]=Kt*_e+er*at+Jt*gt,_[4]=Kt*rt+er*ut+Jt*Ct,_[5]=Kt*ot+er*ft+Jt*At,_[6]=or*_e+lr*at+pr*gt,_[7]=or*rt+lr*ut+pr*Ct,_[8]=or*ot+lr*ft+pr*At,_}function Nt(){var _=new pt(16);return pt!=Float32Array&&(_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=0,_[12]=0,_[13]=0,_[14]=0),_[0]=1,_[5]=1,_[10]=1,_[15]=1,_}function It(_){var o=new pt(16);return o[0]=_[0],o[1]=_[1],o[2]=_[2],o[3]=_[3],o[4]=_[4],o[5]=_[5],o[6]=_[6],o[7]=_[7],o[8]=_[8],o[9]=_[9],o[10]=_[10],o[11]=_[11],o[12]=_[12],o[13]=_[13],o[14]=_[14],o[15]=_[15],o}function Gt(_){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_}function Dt(_,o){var g=o[0],_e=o[1],rt=o[2],ot=o[3],at=o[4],ut=o[5],ft=o[6],gt=o[7],Ct=o[8],At=o[9],kt=o[10],zt=o[11],Ut=o[12],Kt=o[13],er=o[14],Jt=o[15],or=g*ut-_e*at,lr=g*ft-rt*at,pr=g*gt-ot*at,Sr=_e*ft-rt*ut,br=_e*gt-ot*ut,Rr=rt*gt-ot*ft,Mr=Ct*Kt-At*Ut,Lr=Ct*er-kt*Ut,Jr=Ct*Jt-zt*Ut,zr=At*er-kt*Kt,sn=At*Jt-zt*Kt,dn=kt*Jt-zt*er,pn=or*dn-lr*sn+pr*zr+Sr*Jr-br*Lr+Rr*Mr;return pn?(_[0]=(ut*dn-ft*sn+gt*zr)*(pn=1/pn),_[1]=(rt*sn-_e*dn-ot*zr)*pn,_[2]=(Kt*Rr-er*br+Jt*Sr)*pn,_[3]=(kt*br-At*Rr-zt*Sr)*pn,_[4]=(ft*Jr-at*dn-gt*Lr)*pn,_[5]=(g*dn-rt*Jr+ot*Lr)*pn,_[6]=(er*pr-Ut*Rr-Jt*lr)*pn,_[7]=(Ct*Rr-kt*pr+zt*lr)*pn,_[8]=(at*sn-ut*Jr+gt*Mr)*pn,_[9]=(_e*Jr-g*sn-ot*Mr)*pn,_[10]=(Ut*br-Kt*pr+Jt*or)*pn,_[11]=(At*pr-Ct*br-zt*or)*pn,_[12]=(ut*Lr-at*zr-ft*Mr)*pn,_[13]=(g*zr-_e*Lr+rt*Mr)*pn,_[14]=(Kt*lr-Ut*Sr-er*or)*pn,_[15]=(Ct*Sr-At*lr+kt*or)*pn,_):null}function Bt(_,o,g){var _e=o[0],rt=o[1],ot=o[2],at=o[3],ut=o[4],ft=o[5],gt=o[6],Ct=o[7],At=o[8],kt=o[9],zt=o[10],Ut=o[11],Kt=o[12],er=o[13],Jt=o[14],or=o[15],lr=g[0],pr=g[1],Sr=g[2],br=g[3];return _[0]=lr*_e+pr*ut+Sr*At+br*Kt,_[1]=lr*rt+pr*ft+Sr*kt+br*er,_[2]=lr*ot+pr*gt+Sr*zt+br*Jt,_[3]=lr*at+pr*Ct+Sr*Ut+br*or,_[4]=(lr=g[4])*_e+(pr=g[5])*ut+(Sr=g[6])*At+(br=g[7])*Kt,_[5]=lr*rt+pr*ft+Sr*kt+br*er,_[6]=lr*ot+pr*gt+Sr*zt+br*Jt,_[7]=lr*at+pr*Ct+Sr*Ut+br*or,_[8]=(lr=g[8])*_e+(pr=g[9])*ut+(Sr=g[10])*At+(br=g[11])*Kt,_[9]=lr*rt+pr*ft+Sr*kt+br*er,_[10]=lr*ot+pr*gt+Sr*zt+br*Jt,_[11]=lr*at+pr*Ct+Sr*Ut+br*or,_[12]=(lr=g[12])*_e+(pr=g[13])*ut+(Sr=g[14])*At+(br=g[15])*Kt,_[13]=lr*rt+pr*ft+Sr*kt+br*er,_[14]=lr*ot+pr*gt+Sr*zt+br*Jt,_[15]=lr*at+pr*Ct+Sr*Ut+br*or,_}function Lt(_,o,g){var _e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt,Ut,Kt=g[0],er=g[1],Jt=g[2];return o===_?(_[12]=o[0]*Kt+o[4]*er+o[8]*Jt+o[12],_[13]=o[1]*Kt+o[5]*er+o[9]*Jt+o[13],_[14]=o[2]*Kt+o[6]*er+o[10]*Jt+o[14],_[15]=o[3]*Kt+o[7]*er+o[11]*Jt+o[15]):(rt=o[1],ot=o[2],at=o[3],ut=o[4],ft=o[5],gt=o[6],Ct=o[7],At=o[8],kt=o[9],zt=o[10],Ut=o[11],_[0]=_e=o[0],_[1]=rt,_[2]=ot,_[3]=at,_[4]=ut,_[5]=ft,_[6]=gt,_[7]=Ct,_[8]=At,_[9]=kt,_[10]=zt,_[11]=Ut,_[12]=_e*Kt+ut*er+At*Jt+o[12],_[13]=rt*Kt+ft*er+kt*Jt+o[13],_[14]=ot*Kt+gt*er+zt*Jt+o[14],_[15]=at*Kt+Ct*er+Ut*Jt+o[15]),_}function Vt(_,o,g){var _e=g[0],rt=g[1],ot=g[2];return _[0]=o[0]*_e,_[1]=o[1]*_e,_[2]=o[2]*_e,_[3]=o[3]*_e,_[4]=o[4]*rt,_[5]=o[5]*rt,_[6]=o[6]*rt,_[7]=o[7]*rt,_[8]=o[8]*ot,_[9]=o[9]*ot,_[10]=o[10]*ot,_[11]=o[11]*ot,_[12]=o[12],_[13]=o[13],_[14]=o[14],_[15]=o[15],_}function Zt(_,o,g){var _e=Math.sin(g),rt=Math.cos(g),ot=o[4],at=o[5],ut=o[6],ft=o[7],gt=o[8],Ct=o[9],At=o[10],kt=o[11];return o!==_&&(_[0]=o[0],_[1]=o[1],_[2]=o[2],_[3]=o[3],_[12]=o[12],_[13]=o[13],_[14]=o[14],_[15]=o[15]),_[4]=ot*rt+gt*_e,_[5]=at*rt+Ct*_e,_[6]=ut*rt+At*_e,_[7]=ft*rt+kt*_e,_[8]=gt*rt-ot*_e,_[9]=Ct*rt-at*_e,_[10]=At*rt-ut*_e,_[11]=kt*rt-ft*_e,_}function nr(_,o,g){var _e=Math.sin(g),rt=Math.cos(g),ot=o[0],at=o[1],ut=o[2],ft=o[3],gt=o[8],Ct=o[9],At=o[10],kt=o[11];return o!==_&&(_[4]=o[4],_[5]=o[5],_[6]=o[6],_[7]=o[7],_[12]=o[12],_[13]=o[13],_[14]=o[14],_[15]=o[15]),_[0]=ot*rt-gt*_e,_[1]=at*rt-Ct*_e,_[2]=ut*rt-At*_e,_[3]=ft*rt-kt*_e,_[8]=ot*_e+gt*rt,_[9]=at*_e+Ct*rt,_[10]=ut*_e+At*rt,_[11]=ft*_e+kt*rt,_}function ur(_,o,g){var _e=Math.sin(g),rt=Math.cos(g),ot=o[0],at=o[1],ut=o[2],ft=o[3],gt=o[4],Ct=o[5],At=o[6],kt=o[7];return o!==_&&(_[8]=o[8],_[9]=o[9],_[10]=o[10],_[11]=o[11],_[12]=o[12],_[13]=o[13],_[14]=o[14],_[15]=o[15]),_[0]=ot*rt+gt*_e,_[1]=at*rt+Ct*_e,_[2]=ut*rt+At*_e,_[3]=ft*rt+kt*_e,_[4]=gt*rt-ot*_e,_[5]=Ct*rt-at*_e,_[6]=At*rt-ut*_e,_[7]=kt*rt-ft*_e,_}function _r(_,o){return _[0]=o[0],_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=o[1],_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=o[2],_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_}function Ur(_,o,g){var _e,rt,ot,at=g[0],ut=g[1],ft=g[2],gt=Math.sqrt(at*at+ut*ut+ft*ft);return gt<ct?null:(at*=gt=1/gt,ut*=gt,ft*=gt,_e=Math.sin(o),rt=Math.cos(o),_[0]=at*at*(ot=1-rt)+rt,_[1]=ut*at*ot+ft*_e,_[2]=ft*at*ot-ut*_e,_[3]=0,_[4]=at*ut*ot-ft*_e,_[5]=ut*ut*ot+rt,_[6]=ft*ut*ot+at*_e,_[7]=0,_[8]=at*ft*ot+ut*_e,_[9]=ut*ft*ot-at*_e,_[10]=ft*ft*ot+rt,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_)}function ln(_,o){var g=o[0],_e=o[1],rt=o[2],ot=o[4],at=o[5],ut=o[6],ft=o[8],gt=o[9],Ct=o[10];return _[0]=Math.sqrt(g*g+_e*_e+rt*rt),_[1]=Math.sqrt(ot*ot+at*at+ut*ut),_[2]=Math.sqrt(ft*ft+gt*gt+Ct*Ct),_}function an(_,o){var g=o[0],_e=o[1],rt=o[2],ot=o[3],at=g+g,ut=_e+_e,ft=rt+rt,gt=g*at,Ct=_e*at,At=_e*ut,kt=rt*at,zt=rt*ut,Ut=rt*ft,Kt=ot*at,er=ot*ut,Jt=ot*ft;return _[0]=1-At-Ut,_[1]=Ct+Jt,_[2]=kt-er,_[3]=0,_[4]=Ct-Jt,_[5]=1-gt-Ut,_[6]=zt+Kt,_[7]=0,_[8]=kt+er,_[9]=zt-Kt,_[10]=1-gt-At,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_}var Fr=Bt;function rn(){var _=new pt(3);return pt!=Float32Array&&(_[0]=0,_[1]=0,_[2]=0),_}function gn(_){var o=new pt(3);return o[0]=_[0],o[1]=_[1],o[2]=_[2],o}function _i(_){var o=_[0],g=_[1],_e=_[2];return Math.sqrt(o*o+g*g+_e*_e)}function xr(_,o,g){var _e=new pt(3);return _e[0]=_,_e[1]=o,_e[2]=g,_e}function gr(_,o,g,_e){return _[0]=o,_[1]=g,_[2]=_e,_}function rr(_,o,g){return _[0]=o[0]+g[0],_[1]=o[1]+g[1],_[2]=o[2]+g[2],_}function cr(_,o,g){return _[0]=o[0]-g[0],_[1]=o[1]-g[1],_[2]=o[2]-g[2],_}function Hr(_,o,g){return _[0]=o[0]*g[0],_[1]=o[1]*g[1],_[2]=o[2]*g[2],_}function $r(_,o,g){return _[0]=Math.min(o[0],g[0]),_[1]=Math.min(o[1],g[1]),_[2]=Math.min(o[2],g[2]),_}function _n(_,o,g){return _[0]=Math.max(o[0],g[0]),_[1]=Math.max(o[1],g[1]),_[2]=Math.max(o[2],g[2]),_}function fn(_,o,g){return _[0]=o[0]*g,_[1]=o[1]*g,_[2]=o[2]*g,_}function jn(_,o,g,_e){return _[0]=o[0]+g[0]*_e,_[1]=o[1]+g[1]*_e,_[2]=o[2]+g[2]*_e,_}function vs(_,o){var g=o[0]-_[0],_e=o[1]-_[1],rt=o[2]-_[2];return Math.sqrt(g*g+_e*_e+rt*rt)}function Cs(_,o){var g=o[0]-_[0],_e=o[1]-_[1],rt=o[2]-_[2];return g*g+_e*_e+rt*rt}function ns(_){var o=_[0],g=_[1],_e=_[2];return o*o+g*g+_e*_e}function Nn(_,o){return _[0]=-o[0],_[1]=-o[1],_[2]=-o[2],_}function ls(_,o){var g=o[0],_e=o[1],rt=o[2],ot=g*g+_e*_e+rt*rt;return ot>0&&(ot=1/Math.sqrt(ot)),_[0]=o[0]*ot,_[1]=o[1]*ot,_[2]=o[2]*ot,_}function ms(_,o){return _[0]*o[0]+_[1]*o[1]+_[2]*o[2]}function Ss(_,o,g){var _e=o[0],rt=o[1],ot=o[2],at=g[0],ut=g[1],ft=g[2];return _[0]=rt*ft-ot*ut,_[1]=ot*at-_e*ft,_[2]=_e*ut-rt*at,_}function Ks(_,o,g,_e){var rt=o[0],ot=o[1],at=o[2];return _[0]=rt+_e*(g[0]-rt),_[1]=ot+_e*(g[1]-ot),_[2]=at+_e*(g[2]-at),_}function ws(_,o,g){var _e=o[0],rt=o[1],ot=o[2],at=g[3]*_e+g[7]*rt+g[11]*ot+g[15];return _[0]=(g[0]*_e+g[4]*rt+g[8]*ot+g[12])/(at=at||1),_[1]=(g[1]*_e+g[5]*rt+g[9]*ot+g[13])/at,_[2]=(g[2]*_e+g[6]*rt+g[10]*ot+g[14])/at,_}function ps(_,o,g){var _e=o[0],rt=o[1],ot=o[2];return _[0]=_e*g[0]+rt*g[3]+ot*g[6],_[1]=_e*g[1]+rt*g[4]+ot*g[7],_[2]=_e*g[2]+rt*g[5]+ot*g[8],_}function Rl(_,o,g){var _e=g[0],rt=g[1],ot=g[2],at=g[3],ut=o[0],ft=o[1],gt=o[2],Ct=rt*gt-ot*ft,At=ot*ut-_e*gt,kt=_e*ft-rt*ut;return _[0]=ut+at*(Ct+=Ct)+rt*(kt+=kt)-ot*(At+=At),_[1]=ft+at*At+ot*Ct-_e*kt,_[2]=gt+at*kt+_e*At-rt*Ct,_}function Qo(_){return _[0]=0,_[1]=0,_[2]=0,_}function Vo(_,o){return _[0]===o[0]&&_[1]===o[1]&&_[2]===o[2]}var wo=cr,tu=Hr,ou=_i;function Sl(){var _=new pt(4);return pt!=Float32Array&&(_[0]=0,_[1]=0,_[2]=0,_[3]=0),_}function ru(_,o,g){return _[0]=o[0]*g,_[1]=o[1]*g,_[2]=o[2]*g,_[3]=o[3]*g,_}function Ll(_,o){var g=o[0],_e=o[1],rt=o[2],ot=o[3],at=g*g+_e*_e+rt*rt+ot*ot;return at>0&&(at=1/Math.sqrt(at)),_[0]=g*at,_[1]=_e*at,_[2]=rt*at,_[3]=ot*at,_}function Jo(_,o,g){var _e=o[0],rt=o[1],ot=o[2],at=o[3];return _[0]=g[0]*_e+g[4]*rt+g[8]*ot+g[12]*at,_[1]=g[1]*_e+g[5]*rt+g[9]*ot+g[13]*at,_[2]=g[2]*_e+g[6]*rt+g[10]*ot+g[14]*at,_[3]=g[3]*_e+g[7]*rt+g[11]*ot+g[15]*at,_}function iu(){var _=new pt(4);return pt!=Float32Array&&(_[0]=0,_[1]=0,_[2]=0),_[3]=1,_}function xa(_){return _[0]=0,_[1]=0,_[2]=0,_[3]=1,_}function Il(_,o,g){g*=.5;var _e=o[0],rt=o[1],ot=o[2],at=o[3],ut=Math.sin(g),ft=Math.cos(g);return _[0]=_e*ft+at*ut,_[1]=rt*ft+ot*ut,_[2]=ot*ft-rt*ut,_[3]=at*ft-_e*ut,_}function Eu(_,o,g){g*=.5;var _e=o[0],rt=o[1],ot=o[2],at=o[3],ut=Math.sin(g),ft=Math.cos(g);return _[0]=_e*ft-ot*ut,_[1]=rt*ft+at*ut,_[2]=ot*ft+_e*ut,_[3]=at*ft-rt*ut,_}rn(),Sl();var $l,xu,Kp,Rp=Ll,Ip=($l=rn(),xu=xr(1,0,0),Kp=xr(0,1,0),function(_,o,g){var _e=ms(o,g);return _e<-.999999?(Ss($l,xu,o),ou($l)<1e-6&&Ss($l,Kp,o),ls($l,$l),function(rt,ot,at){at*=.5;var ut=Math.sin(at);rt[0]=ut*ot[0],rt[1]=ut*ot[1],rt[2]=ut*ot[2],rt[3]=Math.cos(at)}(_,$l,Math.PI),_):_e>.999999?(_[0]=0,_[1]=0,_[2]=0,_[3]=1,_):(Ss($l,o,g),_[0]=$l[0],_[1]=$l[1],_[2]=$l[2],_[3]=1+_e,Rp(_,_))});function Cl(){var _=new pt(2);return pt!=Float32Array&&(_[0]=0,_[1]=0),_}function hu(_,o){var g=new pt(2);return g[0]=_,g[1]=o,g}function _d(_,o,g){return _[0]=o,_[1]=g,_}function Pp(_,o,g){return _[0]=o[0]+g[0],_[1]=o[1]+g[1],_}function ep(_,o,g){return _[0]=o[0]-g[0],_[1]=o[1]-g[1],_}function tp(_,o,g){return _[0]=o[0]*g,_[1]=o[1]*g,_}function Bu(_){var o=_[0],g=_[1];return Math.sqrt(o*o+g*g)}function Wm(_,o){var g=o[0],_e=o[1],rt=g*g+_e*_e;return rt>0&&(rt=1/Math.sqrt(rt)),_[0]=o[0]*rt,_[1]=o[1]*rt,_}function mp(_,o){return _[0]*o[0]+_[1]*o[1]}iu(),iu(),St();var To,Kl,lo=ep;function Oo(_){return _&&_.__esModule&&Object.prototype.hasOwnProperty.call(_,"default")?_.default:_}Cl();var jo=function(){if(Kl)return To;function _(o,g,_e,rt){this.cx=3*o,this.bx=3*(_e-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*g,this.by=3*(rt-g)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=g,this.p2x=_e,this.p2y=rt}return Kl=1,To=_,_.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,g){if(g===void 0&&(g=1e-6),o<0)return 0;if(o>1)return 1;for(var _e=o,rt=0;rt<8;rt++){var ot=this.sampleCurveX(_e)-o;if(Math.abs(ot)<g)return _e;var at=this.sampleCurveDerivativeX(_e);if(Math.abs(at)<1e-6)break;_e-=ot/at}var ut=0,ft=1;for(_e=o,rt=0;rt<20&&(ot=this.sampleCurveX(_e),!(Math.abs(ot-o)<g));rt++)o>ot?ut=_e:ft=_e,_e=.5*(ft-ut)+ut;return _e},solve:function(o,g){return this.sampleCurveY(this.solveCurveX(o,g))}},To}(),Tu=Oo(jo);function mn(_,o){this.x=_,this.y=o}function du(_,o){if(Array.isArray(_)){if(!Array.isArray(o)||_.length!==o.length)return!1;for(let g=0;g<_.length;g++)if(!du(_[g],o[g]))return!1;return!0}if(typeof _=="object"&&_!==null&&o!==null){if(typeof o!="object"||Object.keys(_).length!==Object.keys(o).length)return!1;for(const g in _)if(!du(_[g],o[g]))return!1;return!0}return _===o}mn.prototype={clone(){return new mn(this.x,this.y)},add(_){return this.clone()._add(_)},sub(_){return this.clone()._sub(_)},multByPoint(_){return this.clone()._multByPoint(_)},divByPoint(_){return this.clone()._divByPoint(_)},mult(_){return this.clone()._mult(_)},div(_){return this.clone()._div(_)},rotate(_){return this.clone()._rotate(_)},rotateAround(_,o){return this.clone()._rotateAround(_,o)},matMult(_){return this.clone()._matMult(_)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(_){return this.x===_.x&&this.y===_.y},dist(_){return Math.sqrt(this.distSqr(_))},distSqr(_){const o=_.x-this.x,g=_.y-this.y;return o*o+g*g},angle(){return Math.atan2(this.y,this.x)},angleTo(_){return Math.atan2(this.y-_.y,this.x-_.x)},angleWith(_){return this.angleWithSep(_.x,_.y)},angleWithSep(_,o){return Math.atan2(this.x*o-this.y*_,this.x*_+this.y*o)},_matMult(_){const o=_[2]*this.x+_[3]*this.y;return this.x=_[0]*this.x+_[1]*this.y,this.y=o,this},_add(_){return this.x+=_.x,this.y+=_.y,this},_sub(_){return this.x-=_.x,this.y-=_.y,this},_mult(_){return this.x*=_,this.y*=_,this},_div(_){return this.x/=_,this.y/=_,this},_multByPoint(_){return this.x*=_.x,this.y*=_.y,this},_divByPoint(_){return this.x/=_.x,this.y/=_.y,this},_unit(){return this._div(this.mag()),this},_perp(){const _=this.y;return this.y=this.x,this.x=-_,this},_rotate(_){const o=Math.cos(_),g=Math.sin(_),_e=g*this.x+o*this.y;return this.x=o*this.x-g*this.y,this.y=_e,this},_rotateAround(_,o){const g=Math.cos(_),_e=Math.sin(_),rt=o.y+_e*(this.x-o.x)+g*(this.y-o.y);return this.x=o.x+g*(this.x-o.x)-_e*(this.y-o.y),this.y=rt,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:mn},mn.convert=function(_){if(_ instanceof mn)return _;if(Array.isArray(_))return new mn(+_[0],+_[1]);if(_.x!==void 0&&_.y!==void 0)return new mn(+_.x,+_.y);throw new Error("Expected [x, y] or {x, y} point format")};const gp=Math.PI/180,au=180/Math.PI;function Fs(_){return _*gp}function vu(_){return _*au}const rv=[[0,0],[1,0],[1,1],[0,1]];function qm(_){if(_<=0)return 0;if(_>=1)return 1;const o=_*_,g=o*_;return 4*(_<.5?g:3*(_-o)+g-.75)}function o_(_,o,g,_e){const rt=new Tu(_,o,g,_e);return function(ot){return rt.solve(ot)}}const Wr=o_(.25,.1,.25,1);function tr(_,o,g){return Math.min(g,Math.max(o,_))}function ar(_,o,g){return(g=tr((g-_)/(o-_),0,1))*g*(3-2*g)}function yr(_,o,g){const _e=g-o,rt=((_-o)%_e+_e)%_e+o;return rt===o?g:rt}function Dr(_,o,g){if(!_.length)return g(null,[]);let _e=_.length;const rt=new Array(_.length);let ot=null;_.forEach((at,ut)=>{o(at,(ft,gt)=>{ft&&(ot=ft),rt[ut]=gt,--_e==0&&g(ot,rt)})})}let kr=1;function jr(){return kr++}function Zr(_){return _<=1?1:Math.pow(2,Math.ceil(Math.log2(_)))}function Vr(_,o){_.forEach(g=>{o[g]&&(o[g]=o[g].bind(o))})}function Xr(_,o,g){const _e={};for(const rt in _)_e[rt]=o.call(this,_[rt],rt,_);return _e}function Sn(_,o,g){const _e={};for(const rt in _)o.call(this,_[rt],rt,_)&&(_e[rt]=_[rt]);return _e}function hn(_){return Array.isArray(_)?_.map(hn):typeof _=="object"&&_?Xr(_,hn):_}function Wn(_,o){for(let g=0;g<_.length;g++)if(o.indexOf(_[g])>=0)return!0;return!1}const os={};function $n(_){os[_]||(typeof console<"u"&&console.warn(_),os[_]=!0)}function ks(_,o,g){return(g.y-_.y)*(o.x-_.x)>(o.y-_.y)*(g.x-_.x)}function Is(_){let o=0;for(let g,_e,rt=0,ot=_.length,at=ot-1;rt<ot;at=rt++)g=_[rt],_e=_[at],o+=(_e.x-g.x)*(g.y+_e.y);return o}function As([_,o,g]){const _e=Fs(o+90),rt=Fs(g);return{x:_*Math.cos(_e)*Math.sin(rt),y:_*Math.sin(_e)*Math.sin(rt),z:_*Math.cos(rt),azimuthal:o,polar:g}}function Xs(_){return(typeof self<"u"||_!==void 0)&&typeof WorkerGlobalScope<"u"&&(_!==void 0?_:self)instanceof WorkerGlobalScope}function na(_){const o={};if(_.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(g,_e,rt,ot)=>{const at=rt||ot;return o[_e]=!at||at.toLowerCase(),""}),o["max-age"]){const g=parseInt(o["max-age"],10);isNaN(g)?delete o["max-age"]:o["max-age"]=g}return o}let Pl=null;function ba(_,o){return[_[4*o],_[4*o+1],_[4*o+2],_[4*o+3]]}function Ol(_,o,g,_e){for(;o<g;){const rt=o+g>>1;_[rt]<_e?o=rt+1:g=rt}return o}function Ko(_,o,g,_e){for(;o<g;){const rt=o+g>>1;_[rt]<=_e?o=rt+1:g=rt}return o}function Js(_){return _>0?1/(1.001-_):1+_}function Xo(_){return _>0?1-1/(1.001-_):-_}function Ro(_,o,g){return(_-o.min)*(g.max-g.min)/(o.max-o.min)+g.min}const Us={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Us.API_URL)return null;try{const _=new URL(Us.API_URL);return _.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":_.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function $a(_){return Us.API_URL_REGEX.test(_)}function lu(_){return Us.API_SPRITE_REGEX.test(_)}let pu,Mu,Km,Jl,Hu,bu;function kp(){return pu==null&&(pu=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),pu}const Xl={now:()=>Jl!==void 0?Jl:performance.now(),setNow(_){Jl=_},restoreNow(){Jl=void 0},frame(_){const o=requestAnimationFrame(_);return{cancel:()=>cancelAnimationFrame(o)}},getImageData(_,o=0){const{width:g,height:_e}=_;Hu||(Hu=document.createElement("canvas"));const rt=Hu.getContext("2d",{willReadFrequently:!0});if(!rt)throw new Error("failed to create canvas 2d context");return(g>Hu.width||_e>Hu.height)&&(Hu.width=g,Hu.height=_e),rt.clearRect(-o,-o,g+2*o,_e+2*o),rt.drawImage(_,0,0,g,_e),rt.getImageData(-o,-o,g+2*o,_e+2*o)},resolveURL:_=>(Mu||(Mu=document.createElement("a")),Mu.href=_,Mu.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Km==null&&(Km=window.matchMedia("(prefers-reduced-motion: reduce)")),Km.matches)},hasCanvasFingerprintNoise(){if(bu!==void 0)return bu;if(!kp())return bu=!1,!1;const _=new OffscreenCanvas(85,1),o=_.getContext("2d",{willReadFrequently:!0});let g=0;for(let rt=0;rt<_.width;++rt)o.fillStyle=`rgba(${g++},${g++},${g++}, 255)`,o.fillRect(rt,0,1,1);const _e=o.getImageData(0,0,_.width,_.height);g=0;for(let rt=0;rt<_e.data.length;++rt)if(rt%4!=3&&g++!==_e.data[rt])return bu=!0,!0;return bu=!1,!1}};function Xm(_,o){const g=_.indexOf("?");if(g<0)return`${_}?${new URLSearchParams(o).toString()}`;const _e=new URLSearchParams(_.slice(g));for(const rt in o)_e.set(rt,o[rt]);return`${_.slice(0,g)}?${_e.toString()}`}function v0(_,o={persistentParams:[]}){const g=_.indexOf("?");if(g<0)return _;const _e=new URLSearchParams,rt=new URLSearchParams(_.slice(g));for(const at of o.persistentParams){const ut=rt.get(at);ut&&_e.set(at,ut)}const ot=_e.toString();return`${_.slice(0,g)}${ot.length>0?`?${ot}`:""}`}const ay="mapbox-tiles";let ly=500,cy=50;const a_=["language","worldview","jobid"];let Mp,Du;function _p(){try{return caches}catch{}}function yp(){const _=_p();_&&Mp==null&&(Mp=_.open(ay))}let rp=1/0;const Dp={supported:!1,testSupport:function(_){!uy&&Zm&&(Ym?J1(_):bm=_)}};let bm,Zm,uy=!1,Ym=!1;const hy=typeof self<"u"?self:{};function J1(_){const o=_.createTexture();_.bindTexture(_.TEXTURE_2D,o);try{if(_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,Zm),_.isContextLost())return;Dp.supported=!0}catch{}_.deleteTexture(o),uy=!0}hy.document&&(Zm=hy.document.createElement("img"),Zm.onload=function(){bm&&J1(bm),bm=null,Ym=!0},Zm.onerror=function(){uy=!0,bm=null},Zm.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const l_={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(l_);class zu extends Error{constructor(o,g,_e){g===401&&$a(_e)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=g,this.url=_e}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const dy=Xs()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Qm=function(_,o){if(!(/^file:/.test(g=_.url)||/^file:/.test(dy())&&!/^\w+:/.test(g))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(_e,rt){const ot=new AbortController,at=new Request(_e.url,{method:_e.method||"GET",body:_e.body,credentials:_e.credentials,headers:_e.headers,referrer:dy(),referrerPolicy:_e.referrerPolicy,signal:ot.signal});let ut=!1,ft=!1;const gt=(Ct=at.url).indexOf("sku=")>0&&$a(Ct);var Ct;_e.type==="json"&&at.headers.set("Accept","application/json");const At=(zt,Ut,Kt)=>{if(ft)return;if(zt&&zt.message!=="SecurityError"&&$n(zt.toString()),Ut&&Kt)return kt(Ut);const er=Date.now();fetch(at).then(Jt=>{if(Jt.ok){const or=gt?Jt.clone():null;return kt(Jt,or,er)}return rt(new zu(Jt.statusText,Jt.status,_e.url))}).catch(Jt=>{Jt.name!=="AbortError"&&rt(new Error(`${Jt.message} ${_e.url}`))})},kt=(zt,Ut,Kt)=>{(_e.type==="arrayBuffer"?zt.arrayBuffer():_e.type==="json"?zt.json():zt.text()).then(er=>{ft||(Ut&&Kt&&function(Jt,or,lr){if(yp(),Mp==null)return;const pr=na(or.headers.get("Cache-Control")||"");if(pr["no-store"])return;const Sr={status:or.status,statusText:or.statusText,headers:new Headers};or.headers.forEach((Mr,Lr)=>Sr.headers.set(Lr,Mr)),pr["max-age"]&&Sr.headers.set("Expires",new Date(lr+1e3*pr["max-age"]).toUTCString());const br=Sr.headers.get("Expires");if(!br||new Date(br).getTime()-lr<42e4)return;let Rr=v0(Jt.url,{persistentParams:a_});if(or.status===206){const Mr=Jt.headers.get("Range");if(!Mr)return;Sr.status=200,Rr=Xm(Rr,{range:Mr})}(function(Mr,Lr){if(Du===void 0)try{new Response(new ReadableStream),Du=!0}catch{Du=!1}Du?Lr(Mr.body):Mr.blob().then(Lr).catch(Jr=>$n(Jr.message))})(or,Mr=>{const Lr=new Response((Jr=or.status)!==200&&Jr!==404&&[101,103,204,205,304].includes(Jr)?null:Mr,Sr);var Jr;yp(),Mp!=null&&Mp.then(zr=>zr.put(Rr,Lr)).catch(zr=>$n(zr.message))})}(at,Ut,Kt),ut=!0,rt(null,er,zt.headers))}).catch(er=>{ft||rt(new Error(er.message))})};return gt?function(zt,Ut){if(yp(),Mp==null)return Ut(null);Mp.then(Kt=>{let er=v0(zt.url,{persistentParams:a_});const Jt=zt.headers.get("Range");Jt&&(er=Xm(er,{range:Jt})),Kt.match(er).then(or=>{const lr=function(pr){if(!pr)return!1;const Sr=new Date(pr.headers.get("Expires")||0),br=na(pr.headers.get("Cache-Control")||"");return Number(Sr)>Date.now()&&!br["no-cache"]}(or);Kt.delete(er).catch(Ut),lr&&Kt.put(er,or.clone()).catch(Ut),Ut(null,or,lr)}).catch(Ut)}).catch(Ut)}(at,At):At(null,null),{cancel:()=>{ft=!0,ut||ot.abort()}}}(_,o);if(Xs(self)&&self.worker.actor)return self.worker.actor.send("getResource",_,o,void 0,!0)}var g;return function(_e,rt){const ot=new XMLHttpRequest;ot.open(_e.method||"GET",_e.url,!0),_e.type==="arrayBuffer"&&(ot.responseType="arraybuffer");for(const at in _e.headers)ot.setRequestHeader(at,_e.headers[at]);return _e.type==="json"&&(ot.responseType="text",ot.setRequestHeader("Accept","application/json")),ot.withCredentials=_e.credentials==="include",ot.onerror=()=>{rt(new Error(ot.statusText))},ot.onload=()=>{if((ot.status>=200&&ot.status<300||ot.status===0)&&ot.response!==null){let at=ot.response;if(_e.type==="json")try{at=JSON.parse(ot.response)}catch(ft){return rt(ft)}const ut=new Headers;ot.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(ft=>{const gt=ft.split(": "),Ct=gt.shift(),At=gt.join(": ");ut.append(Ct,At)}),rt(null,at,ut)}else rt(new zu(ot.statusText,ot.status,_e.url))},ot.send(_e.body),{cancel:()=>ot.abort()}}(_,o)},Xp=function(_,o){return Qm(Object.assign(_,{type:"arrayBuffer"}),o)};function YE(_){const o=document.createElement("a");return o.href=_,o.protocol===location.protocol&&o.host===location.host}const _b="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let c_,eo;c_=[],eo=0;const py=function(_,o){if(Dp.supported&&(_.headers||(_.headers={}),_.headers.accept="image/webp,*/*"),eo>=Us.MAX_PARALLEL_IMAGE_REQUESTS){const ot={requestParameters:_,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return c_.push(ot),ot}eo++;let g=!1;const _e=()=>{if(!g)for(g=!0,eo--;c_.length&&eo<Us.MAX_PARALLEL_IMAGE_REQUESTS;){const ot=c_.shift(),{requestParameters:at,callback:ut,cancelled:ft}=ot;ft||(ot.cancel=py(at,ut).cancel)}},rt=Xp(_,(ot,at,ut)=>{_e(),ot?o(ot):at&&(self.createImageBitmap?function(ft,gt){const Ct=new Blob([new Uint8Array(ft)],{type:"image/png"});createImageBitmap(Ct).then(At=>{gt(null,At)}).catch(At=>{gt(new Error(`Could not load image because of ${At.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(at,(ft,gt)=>o(ft,gt,ut)):function(ft,gt){const Ct=new Image;Ct.onload=()=>{gt(null,Ct),URL.revokeObjectURL(Ct.src),Ct.onload=null,requestAnimationFrame(()=>{Ct.src=_b})},Ct.onerror=()=>gt(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const At=new Blob([new Uint8Array(ft)],{type:"image/png"});Ct.src=ft.byteLength?URL.createObjectURL(At):_b}(at,(ft,gt)=>o(ft,gt,ut)))});return{cancel:()=>{rt.cancel(),_e()}}};var iv,ew,tw,wm={exports:{}},u_={exports:{}},h_={exports:{}},nv=function(){if(tw)return wm.exports;tw=1;var _=(iv||(iv=1,u_.exports=function(g,_e){var rt,ot,at,ut,ft,gt,Ct,At;for(ot=g.length-(rt=3&g.length),at=_e,ft=3432918353,gt=461845907,At=0;At<ot;)Ct=255&g.charCodeAt(At)|(255&g.charCodeAt(++At))<<8|(255&g.charCodeAt(++At))<<16|(255&g.charCodeAt(++At))<<24,++At,at=27492+(65535&(ut=5*(65535&(at=(at^=Ct=(65535&(Ct=(Ct=(65535&Ct)*ft+(((Ct>>>16)*ft&65535)<<16)&4294967295)<<15|Ct>>>17))*gt+(((Ct>>>16)*gt&65535)<<16)&4294967295)<<13|at>>>19))+((5*(at>>>16)&65535)<<16)&4294967295))+((58964+(ut>>>16)&65535)<<16);switch(Ct=0,rt){case 3:Ct^=(255&g.charCodeAt(At+2))<<16;case 2:Ct^=(255&g.charCodeAt(At+1))<<8;case 1:at^=Ct=(65535&(Ct=(Ct=(65535&(Ct^=255&g.charCodeAt(At)))*ft+(((Ct>>>16)*ft&65535)<<16)&4294967295)<<15|Ct>>>17))*gt+(((Ct>>>16)*gt&65535)<<16)&4294967295}return at^=g.length,at=2246822507*(65535&(at^=at>>>16))+((2246822507*(at>>>16)&65535)<<16)&4294967295,at=3266489909*(65535&(at^=at>>>13))+((3266489909*(at>>>16)&65535)<<16)&4294967295,(at^=at>>>16)>>>0}),u_.exports),o=(ew||(ew=1,h_.exports=function(g,_e){for(var rt,ot=g.length,at=_e^ot,ut=0;ot>=4;)rt=1540483477*(65535&(rt=255&g.charCodeAt(ut)|(255&g.charCodeAt(++ut))<<8|(255&g.charCodeAt(++ut))<<16|(255&g.charCodeAt(++ut))<<24))+((1540483477*(rt>>>16)&65535)<<16),at=1540483477*(65535&at)+((1540483477*(at>>>16)&65535)<<16)^(rt=1540483477*(65535&(rt^=rt>>>24))+((1540483477*(rt>>>16)&65535)<<16)),ot-=4,++ut;switch(ot){case 3:at^=(255&g.charCodeAt(ut+2))<<16;case 2:at^=(255&g.charCodeAt(ut+1))<<8;case 1:at=1540483477*(65535&(at^=255&g.charCodeAt(ut)))+((1540483477*(at>>>16)&65535)<<16)}return at=1540483477*(65535&(at^=at>>>13))+((1540483477*(at>>>16)&65535)<<16),(at^=at>>>15)>>>0}),h_.exports);return wm.exports=_,wm.exports.murmur3=_,wm.exports.murmur2=o,wm.exports}(),fy=Oo(nv);class Np{constructor(o,...g){Object.assign(this,g[0]||{}),this.type=o}}class d_ extends Np{constructor(o,g={}){super("error",Object.assign({error:o},g))}}function sv(_,o,g){g[_]&&g[_].indexOf(o)!==-1||(g[_]=g[_]||[],g[_].push(o))}function Em(_,o,g){if(g&&g[_]){const _e=g[_].indexOf(o);_e!==-1&&g[_].splice(_e,1)}}class Jm{on(o,g){return this._listeners=this._listeners||{},sv(o,g,this._listeners),this}off(o,g){return Em(o,g,this._listeners),Em(o,g,this._oneTimeListeners),this}once(o,g){return g?(this._oneTimeListeners=this._oneTimeListeners||{},sv(o,g,this._oneTimeListeners),this):new Promise(_e=>{this.once(o,_e)})}fire(o,g){const _e=typeof o=="string"?new Np(o,g):o,rt=_e.type;if(this.listens(rt)){_e.target=this;const ot=this._listeners&&this._listeners[rt]?this._listeners[rt].slice():[];for(const ft of ot)ft.call(this,_e);const at=this._oneTimeListeners&&this._oneTimeListeners[rt]?this._oneTimeListeners[rt].slice():[];for(const ft of at)Em(rt,ft,this._oneTimeListeners),ft.call(this,_e);const ut=this._eventedParent;if(ut){const ft=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(_e,ft),ut.fire(_e)}}else _e instanceof d_&&console.error(_e.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,g){return this._eventedParent=o,this._eventedParentData=g,this}}class wu{constructor(o){typeof o=="string"?this.name=o:(this.name=o.name,this.iconsetId=o.iconsetId)}static from(o){return new wu(o)}static toString(o){return o.iconsetId?`${o.name}${o.iconsetId}`:o.name}static parse(o){const[g,_e]=o.split("");return new wu({name:g,iconsetId:_e})}static isEqual(o,g){return o.name===g.name&&o.iconsetId===g.iconsetId}toString(){return wu.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var my,p_={},np=function(){if(my)return p_;my=1;var _={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(ot){return(ot=Math.round(ot))<0?0:ot>255?255:ot}function g(ot){return o(ot[ot.length-1]==="%"?parseFloat(ot)/100*255:parseInt(ot))}function _e(ot){return(at=ot[ot.length-1]==="%"?parseFloat(ot)/100:parseFloat(ot))<0?0:at>1?1:at;var at}function rt(ot,at,ut){return ut<0?ut+=1:ut>1&&(ut-=1),6*ut<1?ot+(at-ot)*ut*6:2*ut<1?at:3*ut<2?ot+(at-ot)*(2/3-ut)*6:ot}try{p_.parseCSSColor=function(ot){var at,ut=ot.replace(/ /g,"").toLowerCase();if(ut in _)return _[ut].slice();if(ut[0]==="#")return ut.length===4?(at=parseInt(ut.substr(1),16))>=0&&at<=4095?[(3840&at)>>4|(3840&at)>>8,240&at|(240&at)>>4,15&at|(15&at)<<4,1]:null:ut.length===7&&(at=parseInt(ut.substr(1),16))>=0&&at<=16777215?[(16711680&at)>>16,(65280&at)>>8,255&at,1]:null;var ft=ut.indexOf("("),gt=ut.indexOf(")");if(ft!==-1&&gt+1===ut.length){var Ct=ut.substr(0,ft),At=ut.substr(ft+1,gt-(ft+1)).split(","),kt=1;switch(Ct){case"rgba":if(At.length!==4)return null;kt=_e(At.pop());case"rgb":return At.length!==3?null:[g(At[0]),g(At[1]),g(At[2]),kt];case"hsla":if(At.length!==4)return null;kt=_e(At.pop());case"hsl":if(At.length!==3)return null;var zt=(parseFloat(At[0])%360+360)%360/360,Ut=_e(At[1]),Kt=_e(At[2]),er=Kt<=.5?Kt*(Ut+1):Kt+Ut-Kt*Ut,Jt=2*Kt-er;return[o(255*rt(Jt,er,zt+1/3)),o(255*rt(Jt,er,zt)),o(255*rt(Jt,er,zt-1/3)),kt];default:return null}}return null}}catch{}return p_}();class fo{constructor(o,g,_e,rt=1){this.r=o,this.g=g,this.b=_e,this.a=rt}static parse(o){if(!o)return;if(o instanceof fo)return o;if(typeof o!="string")return;const g=np.parseCSSColor(o);return g?new fo(g[0]/255,g[1]/255,g[2]/255,g[3]):void 0}toString(){const[o,g,_e,rt]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*o)},${Math.round(255*g)},${Math.round(255*_e)},${rt})`}toNonPremultipliedRenderColor(o){const{r:g,g:_e,b:rt,a:ot}=this;return new iw(o,g,_e,rt,ot)}toPremultipliedRenderColor(o){const{r:g,g:_e,b:rt,a:ot}=this;return new nw(o,g*ot,_e*ot,rt*ot,ot)}clone(){return new fo(this.r,this.g,this.b,this.a)}}class rw{constructor(o,g,_e,rt,ot,at=!1){if(this.premultiplied=!1,this.premultiplied=at,o){const ut=o.image.height,ft=ut*ut;this.premultiplied?(g=ot===0?0:g/ot*(ut-1),_e=ot===0?0:_e/ot*(ut-1),rt=ot===0?0:rt/ot*(ut-1)):(g*=ut-1,_e*=ut-1,rt*=ut-1);const gt=Math.floor(g),Ct=Math.floor(_e),At=Math.floor(rt),kt=Math.ceil(g),zt=Math.ceil(_e),Ut=Math.ceil(rt),Kt=g-gt,er=_e-Ct,Jt=rt-At,or=o.image.data,lr=4*(gt+Ct*ft+At*ut),pr=4*(gt+Ct*ft+Ut*ut),Sr=4*(gt+zt*ft+At*ut),br=4*(gt+zt*ft+Ut*ut),Rr=4*(kt+Ct*ft+At*ut),Mr=4*(kt+Ct*ft+Ut*ut),Lr=4*(kt+zt*ft+At*ut),Jr=4*(kt+zt*ft+Ut*ut);if(lr<0||Jr>=or.length)throw new Error("out of range");this.r=fs(fs(fs(or[lr],or[pr],Jt),fs(or[Sr],or[br],Jt),er),fs(fs(or[Rr],or[Mr],Jt),fs(or[Lr],or[Jr],Jt),er),Kt)/255*(this.premultiplied?ot:1),this.g=fs(fs(fs(or[lr+1],or[pr+1],Jt),fs(or[Sr+1],or[br+1],Jt),er),fs(fs(or[Rr+1],or[Mr+1],Jt),fs(or[Lr+1],or[Jr+1],Jt),er),Kt)/255*(this.premultiplied?ot:1),this.b=fs(fs(fs(or[lr+2],or[pr+2],Jt),fs(or[Sr+2],or[br+2],Jt),er),fs(fs(or[Rr+2],or[Mr+2],Jt),fs(or[Lr+2],or[Jr+2],Jt),er),Kt)/255*(this.premultiplied?ot:1),this.a=ot}else this.r=g,this.g=_e,this.b=rt,this.a=ot}toArray(){const{r:o,g,b:_e,a:rt}=this;return[255*o,255*g,255*_e,rt]}toHslaArray(){let{r:o,g,b:_e,a:rt}=this;if(this.premultiplied){if(rt===0)return[0,0,0,0];const Ut=1/rt;o*=Ut,g*=Ut,_e*=Ut}const ot=Math.min(Math.max(o,0),1),at=Math.min(Math.max(g,0),1),ut=Math.min(Math.max(_e,0),1),ft=Math.min(ot,at,ut),gt=Math.max(ot,at,ut),Ct=gt-ft,At=.5*(ft+gt);if(Ct===0)return[0,0,100*At,rt];const kt=At>.5?Ct/(2-gt-ft):Ct/(gt+ft);let zt;switch(gt){case ot:zt=60*((at-ut)/Ct+(at<ut?6:0));break;case at:zt=60*((ut-ot)/Ct+2);break;default:zt=60*((ot-at)/Ct+4)}return[zt,100*kt,100*At,rt]}toArray01(){const{r:o,g,b:_e,a:rt}=this;return[o,g,_e,rt]}toArray01Scaled(o){const{r:g,g:_e,b:rt}=this;return[g*o,_e*o,rt*o]}toArray01Linear(){const{r:o,g,b:_e,a:rt}=this;return[Math.pow(o,2.2),Math.pow(g,2.2),Math.pow(_e,2.2),rt]}}class iw extends rw{constructor(o,g,_e,rt,ot){super(o,g,_e,rt,ot,!1)}}class nw extends rw{constructor(o,g,_e,rt,ot){super(o,g,_e,rt,ot,!0)}}function fs(_,o,g){return _*(1-g)+o*g}function ov(_,o,g){return _.map((_e,rt)=>fs(_e,o[rt],g))}fo.black=new fo(0,0,0,1),fo.white=new fo(1,1,1,1),fo.transparent=new fo(0,0,0,0),fo.red=new fo(1,0,0,1),fo.blue=new fo(0,0,1,1);var f_=Object.freeze({__proto__:null,array:ov,color:function(_,o,g){return new fo(fs(_.r,o.r,g),fs(_.g,o.g,g),fs(_.b,o.b,g),fs(_.a,o.a,g))},number:fs});class sp extends Error{constructor(o,g){super(g),this.message=g,this.key=o}}class b0{constructor(o,g=[]){this.parent=o,this.bindings={};for(const[_e,rt]of g)this.bindings[_e]=rt}concat(o){return new b0(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const xp={kind:"null"},is={kind:"number"},qs={kind:"string"},yo={kind:"boolean"},Nu={kind:"color"},Lp={kind:"object"},po={kind:"value"},gy={kind:"collator"},m_={kind:"formatted"},g_={kind:"resolvedImage"};function fu(_,o){return{kind:"array",itemType:_,N:o}}function Ml(_){if(_.kind==="array"){const o=Ml(_.itemType);return typeof _.N=="number"?`array<${o}, ${_.N}>`:_.itemType.kind==="value"?"array":`array<${o}>`}return _.kind}const QE=[xp,is,qs,yo,Nu,m_,Lp,fu(po),g_];function Tm(_,o){if(o.kind==="error")return null;if(_.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Tm(_.itemType,o.itemType))&&(typeof _.N!="number"||_.N===o.N))return null}else{if(_.kind===o.kind)return null;if(_.kind==="value"){for(const g of QE)if(!Tm(g,o))return null}}return`Expected ${Ml(_)} but found ${Ml(o)} instead.`}function av(_,o){return o.some(g=>g.kind===_.kind)}function __(_,o){return o.some(g=>g==="null"?_===null:g==="array"?Array.isArray(_):g==="object"?_&&!Array.isArray(_)&&typeof _=="object":g===typeof _)}function _y(_,o){return _.kind==="array"&&o.kind==="array"?_.N===o.N&&_y(_.itemType,o.itemType):_.kind===o.kind}class lv{constructor(o,g,_e){this.sensitivity=o?g?"variant":"case":g?"accent":"base",this.locale=_e,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,g){return this.collator.compare(o,g)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yy{constructor(o,g,_e,rt,ot){this.text=o.normalize?o.normalize():o,this.image=g,this.scale=_e,this.fontStack=rt,this.textColor=ot}}class Su{constructor(o){this.sections=o}static fromString(o){return new Su([new yy(o,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||!!o.image&&o.image.hasPrimary())}static factory(o){return o instanceof Su?o:Su.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const g of this.sections){if(g.image){const rt=g.image.getPrimary().id.toString();o.push(["image",rt]);continue}o.push(g.text);const _e={};g.fontStack&&(_e["text-font"]=["literal",g.fontStack.split(",")]),g.scale&&(_e["font-scale"]=g.scale),g.textColor&&(_e["text-color"]=["rgba"].concat(g.textColor.toNonPremultipliedRenderColor(null).toArray())),o.push(_e)}return o}}class Zp{constructor(o,g={}){this.id=wu.from(o),this.params=g.params,this.sx=g.sx||1,this.sy=g.sy||1}toString(){return JSON.stringify(this)}static parse(o){let g,_e,rt,ot;try{({id:g,params:_e,sx:rt,sy:ot}=JSON.parse(o)||{})}catch{return null}return g?new Zp(g,{params:_e,sx:rt,sy:ot}):null}scaleSelf(o,g=o){return this.sx*=o,this.sy*=g,this}}class Cu{constructor(o,g,_e,rt,ot=!1){this.primaryId=wu.from(o),this.primaryOptions=g,_e&&(this.secondaryId=wu.from(_e)),this.secondaryOptions=rt,this.available=ot}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Zp(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Zp(this.secondaryId,this.secondaryOptions):null}static from(o){return typeof o=="string"?Cu.build({name:o}):o}static build(o,g,_e,rt){return!o||typeof o=="object"&&!("name"in o)?null:new Cu(o,_e,g,rt)}}function _g(_,o,g,_e){return typeof _=="number"&&_>=0&&_<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof g=="number"&&g>=0&&g<=255?_e===void 0||typeof _e=="number"&&_e>=0&&_e<=1?null:`Invalid rgba value [${[_,o,g,_e].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof _e=="number"?[_,o,g,_e]:[_,o,g]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function w0(_){if(_===null||typeof _=="string"||typeof _=="boolean"||typeof _=="number"||_ instanceof fo||_ instanceof lv||_ instanceof Su||_ instanceof Cu)return!0;if(Array.isArray(_)){for(const o of _)if(!w0(o))return!1;return!0}if(typeof _=="object"){for(const o in _)if(!w0(_[o]))return!1;return!0}return!1}function Zl(_){if(_===null)return xp;if(typeof _=="string")return qs;if(typeof _=="boolean")return yo;if(typeof _=="number")return is;if(_ instanceof fo)return Nu;if(_ instanceof lv)return gy;if(_ instanceof Su)return m_;if(_ instanceof Cu)return g_;if(Array.isArray(_)){const o=_.length;let g;for(const _e of _){const rt=Zl(_e);if(g){if(g===rt)continue;g=po;break}g=rt}return fu(g||po,o)}return Lp}function ap(_){const o=typeof _;return _===null?"":o==="string"||o==="number"||o==="boolean"?String(_):_ instanceof Su||_ instanceof Cu||_ instanceof fo?_.toString():JSON.stringify(_)}class Yp{constructor(o,g){this.type=o,this.value=g}static parse(o,g){if(o.length!==2)return g.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!w0(o[1]))return g.error("invalid value");const _e=o[1];let rt=Zl(_e);const ot=g.expectedType;return rt.kind!=="array"||rt.N!==0||!ot||ot.kind!=="array"||typeof ot.N=="number"&&ot.N!==0||(rt=ot),new Yp(rt,_e)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof fo?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Su?this.value.serialize():this.value}}class Gl{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const cv={string:qs,number:is,boolean:yo,object:Lp};class vp{constructor(o,g){this.type=o,this.args=g}static parse(o,g){if(o.length<2)return g.error("Expected at least one argument.");let _e,rt=1;const ot=o[0];if(ot==="array"){let ut,ft;if(o.length>2){const gt=o[1];if(typeof gt!="string"||!(gt in cv)||gt==="object")return g.error('The item type argument of "array" must be one of string, number, boolean',1);ut=cv[gt],rt++}else ut=po;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return g.error('The length argument to "array" must be a positive integer literal',2);ft=o[2],rt++}_e=fu(ut,ft)}else _e=cv[ot];const at=[];for(;rt<o.length;rt++){const ut=g.parse(o[rt],rt,po);if(!ut)return null;at.push(ut)}return new vp(_e,at)}evaluate(o){for(let g=0;g<this.args.length;g++){const _e=this.args[g].evaluate(o);if(!Tm(this.type,Zl(_e)))return _e;if(g===this.args.length-1)throw new Gl(`The expression ${JSON.stringify(this.args[g].serialize())} evaluated to ${Ml(Zl(_e))} but was expected to be of type ${Ml(this.type)}.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,g=[o.kind];if(o.kind==="array"){const _e=o.itemType;if(_e.kind==="string"||_e.kind==="number"||_e.kind==="boolean"){g.push(_e.kind);const rt=o.N;(typeof rt=="number"||this.args.length>1)&&g.push(rt)}}return g.concat(this.args.map(_e=>_e.serialize()))}}class Op{constructor(o){this.type=m_,this.sections=o}static parse(o,g){if(o.length<2)return g.error("Expected at least one argument.");const _e=o[1];if(!Array.isArray(_e)&&typeof _e=="object")return g.error("First argument must be an image or text section.");const rt=[];let ot=!1;for(let at=1;at<=o.length-1;++at){const ut=o[at];if(ot&&typeof ut=="object"&&!Array.isArray(ut)){ot=!1;let ft=null;if(ut["font-scale"]&&(ft=g.parseObjectValue(ut["font-scale"],at,"font-scale",is),!ft))return null;let gt=null;if(ut["text-font"]&&(gt=g.parseObjectValue(ut["text-font"],at,"text-font",fu(qs)),!gt))return null;let Ct=null;if(ut["text-color"]&&(Ct=g.parseObjectValue(ut["text-color"],at,"text-color",Nu),!Ct))return null;const At=rt[rt.length-1];At.scale=ft,At.font=gt,At.textColor=Ct}else{const ft=g.parse(o[at],at,po);if(!ft)return null;const gt=ft.type.kind;if(gt!=="string"&&gt!=="value"&&gt!=="null"&&gt!=="resolvedImage")return g.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");ot=!0,rt.push({content:ft,scale:null,font:null,textColor:null})}}return new Op(rt)}evaluate(o){return new Su(this.sections.map(g=>{const _e=g.content.evaluate(o);return _y(Zl(_e),g_)?new yy("",_e,null,null,null):new yy(ap(_e),null,g.scale?g.scale.evaluate(o):null,g.font?g.font.evaluate(o).join(","):null,g.textColor?g.textColor.evaluate(o):null)}))}eachChild(o){for(const g of this.sections)o(g.content),g.scale&&o(g.scale),g.font&&o(g.font),g.textColor&&o(g.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const g of this.sections){o.push(g.content.serialize());const _e={};g.scale&&(_e["font-scale"]=g.scale.serialize()),g.font&&(_e["text-font"]=g.font.serialize()),g.textColor&&(_e["text-color"]=g.textColor.serialize()),o.push(_e)}return o}}class Ps{constructor(o,g,_e,rt){this._imageWarnHistory={},this.type=g_,this.namePrimary=o,this.nameSecondary=g,_e&&(this.paramsPrimary=_e.params,this.iconsetIdPrimary=_e.iconset?_e.iconset.id:void 0),rt&&(this.paramsSecondary=rt.params,this.iconsetIdSecondary=rt.iconset?rt.iconset.id:void 0)}static parse(o,g){if(o.length<2)return g.error("Expected two or more arguments.");let _e=1;const rt=[];function ot(){if(_e<o.length){const ut=g.parse(o[_e],_e++,qs);return ut?(rt.push({image:ut,options:{}}),!0):(g.error(rt.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function at(){if(_e<o.length){const ft=o[_e];if((ut=ft)===null||typeof ut!="object"||Array.isArray(ut))return!0;const gt=ft.params,Ct=ft.iconset,At=g.concat(_e);if(!gt&&!Ct)return _e++,!0;if(gt){if(typeof gt!="object"||gt.constructor!==Object)return At.error('Image options "params" should be an object'),!1;const kt={},zt=At.concat(void 0,"params");for(const Ut in gt){if(!Ut)return zt.error("Image parameter name should be non-empty"),!1;const Kt=zt.concat(void 0,Ut).parse(gt[Ut],void 0,Nu,void 0,{typeAnnotation:"coerce"});if(!Kt)return!1;kt[Ut]=Kt}rt[rt.length-1].options.params=kt}if(Ct){if(typeof Ct!="object"||Ct.constructor!==Object)return At.error('Image options "iconset" should be an object'),!1;if(!Ct.id)return At.error('Image options "iconset" should have an "id" property'),!1;rt[rt.length-1].options.iconset=Ct}return _e++,!0}var ut;return!0}for(let ut=0;ut<2;ut++)if(!ot()||!at())return;return new Ps(rt[0].image,rt[1]?rt[1].image:void 0,rt[0].options,rt[1]?rt[1].options:void 0)}evaluateParams(o,g){const _e={};if(g){for(const rt in g)if(g[rt])try{_e[rt]=g[rt].evaluate(o)}catch{continue}if(Object.keys(_e).length!==0)return{params:_e}}}evaluate(o){const g={name:this.namePrimary.evaluate(o),iconsetId:this.iconsetIdPrimary},_e=this.nameSecondary?{name:this.nameSecondary.evaluate(o),iconsetId:this.iconsetIdSecondary}:void 0,rt=Cu.build(g,_e,this.paramsPrimary?this.evaluateParams(o,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(o,this.paramsSecondary):void 0);if(rt&&o.availableImages){const ot=rt.getPrimary().id;if(rt.available=o.availableImages.some(at=>wu.isEqual(at,ot)),rt.available){const at=rt.getSecondary()?rt.getSecondary().id:null;at&&(rt.available=o.availableImages.some(ut=>wu.isEqual(ut,at)))}}return rt}eachChild(o){if(o(this.namePrimary),this.paramsPrimary)for(const g in this.paramsPrimary)this.paramsPrimary[g]&&o(this.paramsPrimary[g]);if(this.nameSecondary&&(o(this.nameSecondary),this.paramsSecondary))for(const g in this.paramsSecondary)this.paramsSecondary[g]&&o(this.paramsSecondary[g])}outputDefined(){return!1}serializeOptions(o,g){const _e={};if(g&&(_e.iconset={id:g}),o){_e.params={};for(const rt in o)o[rt]&&(_e.params[rt]=o[rt].serialize())}return Object.keys(_e).length>0?_e:void 0}serialize(){const o=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const g=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);g&&o.push(g)}if(this.nameSecondary&&(o.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const g=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);g&&o.push(g)}return o}}function es(_){return _s(_)?"string":E0(_)?"number":vy(_)?"boolean":Array.isArray(_)?"array":_===null?"null":xy(_)?"object":typeof _}function xy(_){return _!=null&&!Array.isArray(_)&&typeof _!="function"&&!(_ instanceof String||_ instanceof Number||_ instanceof Boolean)&&typeof _=="object"}function _s(_){return typeof _=="string"||_ instanceof String}function E0(_){return typeof _=="number"||_ instanceof Number}function vy(_){return typeof _=="boolean"||_ instanceof Boolean}const gs={"to-boolean":yo,"to-color":Nu,"to-number":is,"to-string":qs};class jp{constructor(o,g){this.type=o,this.args=g}static parse(o,g){if(o.length<2)return g.error("Expected at least one argument.");const _e=o[0],rt=[];let ot=xp;if(_e==="to-array"){if(!Array.isArray(o[1]))return null;const at=o[1].length;if(g.expectedType){if(g.expectedType.kind!=="array")return g.error(`Expected ${g.expectedType.kind} but found array.`);ot=fu(g.expectedType.itemType,at)}else{if(!(at>0&&w0(o[1][0])))return null;ot=fu(Zl(o[1][0]),at)}for(let ut=0;ut<at;ut++){const ft=o[1][ut];let gt;if(Array.isArray(ft))gt=g.parse(ft,void 0,ot.itemType);else{const Ct=es(ft);if(Ct!==ot.itemType.kind)return g.error(`Expected ${ot.itemType.kind} but found ${Ct}.`);gt=g.registry.literal.parse(["literal",ft===void 0?null:ft],g)}if(!gt)return null;rt.push(gt)}}else{if((_e==="to-boolean"||_e==="to-string")&&o.length!==2)return g.error("Expected one argument.");ot=gs[_e];for(let at=1;at<o.length;at++){const ut=g.parse(o[at],at,po);if(!ut)return null;rt.push(ut)}}return new jp(ot,rt)}evaluate(o){if(this.type.kind==="boolean")return!!this.args[0].evaluate(o);if(this.type.kind==="color"){let g,_e;for(const rt of this.args){if(g=rt.evaluate(o),_e=null,g instanceof fo)return g;if(typeof g=="string"){const ot=o.parseColor(g);if(ot)return ot}else if(Array.isArray(g)&&(_e=g.length<3||g.length>4?`Invalid rbga value ${JSON.stringify(g)}: expected an array containing either three or four numeric values.`:_g(g[0],g[1],g[2],g[3]),!_e))return new fo(g[0]/255,g[1]/255,g[2]/255,g[3])}throw new Gl(_e||`Could not parse color from value '${typeof g=="string"?g:String(JSON.stringify(g))}'`)}if(this.type.kind==="number"){let g=null;for(const _e of this.args){if(g=_e.evaluate(o),g===null)return 0;const rt=Number(g);if(!isNaN(rt))return rt}throw new Gl(`Could not convert ${JSON.stringify(g)} to number.`)}return this.type.kind==="formatted"?Su.fromString(ap(this.args[0].evaluate(o))):this.type.kind==="resolvedImage"?Cu.build(ap(this.args[0].evaluate(o))):this.type.kind==="array"?this.args.map(g=>g.evaluate(o)):ap(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Op([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ps(this.args[0]).serialize();const o=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(g=>{o.push(g.serialize())}),o}}const uv=["Unknown","Point","LineString","Polygon"];class by{constructor(o,g,_e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=o,this.options=g,this.iconImageUseTheme=_e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?uv[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(o){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,g=this.featureDistanceData.scale,{x:_e,y:rt}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(_e*g-o[0])+this.featureDistanceData.bearing[1]*(rt*g-o[1])}return 0}parseColor(o){let g=this._parseColorCache[o];return g||(g=this._parseColorCache[o]=fo.parse(o)),g}getConfig(o){return this.options?this.options.get(o):null}}class Au{constructor(o,g,_e,rt,ot){this.name=o,this.type=g,this._evaluate=_e,this.args=rt,this._overloadIndex=ot}evaluate(o){if(!this._evaluate){const g=Au.definitions[this.name];this._evaluate=Array.isArray(g)?g[2]:g.overloads[this._overloadIndex][1]}return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,g){const _e=o[0],rt=Au.definitions[_e];if(!rt)return g.error(`Unknown expression "${_e}". If you wanted a literal array, use ["literal", [...]].`,0);const ot=Array.isArray(rt)?rt[0]:rt.type,at=Array.isArray(rt)?[[rt[1],rt[2]]]:rt.overloads,ut=[];let ft=null,gt=-1;for(const[Ct,At]of at){if(Array.isArray(Ct)&&Ct.length!==o.length-1)continue;ut.push(Ct),gt++,ft=new Dy(g.registry,g.path,null,g.scope,void 0,g._scope,g.options,g.iconImageUseTheme);const kt=[];let zt=!1;for(let Ut=1;Ut<o.length;Ut++){const Kt=o[Ut],er=Array.isArray(Ct)?Ct[Ut-1]:Ct.type,Jt=ft.parse(Kt,1+kt.length,er);if(!Jt){zt=!0;break}kt.push(Jt)}if(!zt)if(Array.isArray(Ct)&&Ct.length!==kt.length)ft.error(`Expected ${Ct.length} arguments, but found ${kt.length} instead.`);else{for(let Ut=0;Ut<kt.length;Ut++){const Kt=Array.isArray(Ct)?Ct[Ut]:Ct.type,er=kt[Ut];ft.concat(Ut+1).checkSubtype(Kt,er.type)}if(ft.errors.length===0)return new Au(_e,ot,At,kt,gt)}}if(ut.length===1)g.errors.push(...ft.errors);else{const Ct=(ut.length?ut:at.map(([kt])=>kt)).map(wy).join(" | "),At=[];for(let kt=1;kt<o.length;kt++){const zt=g.parse(o[kt],1+At.length);if(!zt)return null;At.push(Ml(zt.type))}g.error(`Expected arguments of type ${Ct}, but found (${At.join(", ")}) instead.`)}return null}static register(o,g){Au.definitions=g;for(const _e in g)o[_e]=Au}}function wy(_){return Array.isArray(_)?`(${_.map(Ml).join(", ")})`:`(${Ml(_.type)}...)`}class _c{constructor(o,g,_e){this.type=gy,this.locale=_e,this.caseSensitive=o,this.diacriticSensitive=g}static parse(o,g){if(o.length!==2)return g.error("Expected one argument.");const _e=o[1];if(typeof _e!="object"||Array.isArray(_e))return g.error("Collator options argument must be an object.");const rt=_e["case-sensitive"]===void 0?g.parse(!1,1,yo):g.parseObjectValue(_e["case-sensitive"],1,"case-sensitive",yo);if(!rt)return null;const ot=_e["diacritic-sensitive"]===void 0?g.parse(!1,1,yo):g.parseObjectValue(_e["diacritic-sensitive"],1,"diacritic-sensitive",yo);if(!ot)return null;let at=null;return _e.locale&&(at=g.parseObjectValue(_e.locale,1,"locale",qs),!at)?null:new _c(rt,ot,at)}evaluate(o){return new lv(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}function Ey(_,o,g=0,_e=_.length-1,rt=hv){for(;_e>g;){if(_e-g>600){const ft=_e-g+1,gt=o-g+1,Ct=Math.log(ft),At=.5*Math.exp(2*Ct/3),kt=.5*Math.sqrt(Ct*At*(ft-At)/ft)*(gt-ft/2<0?-1:1);Ey(_,o,Math.max(g,Math.floor(o-gt*At/ft+kt)),Math.min(_e,Math.floor(o+(ft-gt)*At/ft+kt)),rt)}const ot=_[o];let at=g,ut=_e;for(bp(_,g,o),rt(_[_e],ot)>0&&bp(_,g,_e);at<ut;){for(bp(_,at,ut),at++,ut--;rt(_[at],ot)<0;)at++;for(;rt(_[ut],ot)>0;)ut--}rt(_[g],ot)===0?bp(_,g,ut):(ut++,bp(_,ut,_e)),ut<=o&&(g=ut+1),o<=ut&&(_e=ut-1)}}function bp(_,o,g){const _e=_[o];_[o]=_[g],_[g]=_e}function hv(_,o){return _<o?-1:_>o?1:0}function Sm(_){let o=0;for(let g,_e,rt=0,ot=_.length,at=ot-1;rt<ot;at=rt++)g=_[rt],_e=_[at],o+=(_e.x-g.x)*(g.y+_e.y);return o}function lp(_,o){_[0]=Math.min(_[0],o[0]),_[1]=Math.min(_[1],o[1]),_[2]=Math.max(_[2],o[0]),_[3]=Math.max(_[3],o[1])}function y_(_,o){return!(_[0]<=o[0]||_[2]>=o[2]||_[1]<=o[1]||_[3]>=o[3])}function JE(_,o,g){const _e=_[0]-o[0],rt=_[1]-o[1],ot=_[0]-g[0],at=_[1]-g[1];return _e*at-ot*rt==0&&_e*ot<=0&&rt*at<=0}function T0(_,o,g=!1){let _e=!1;for(let ut=0,ft=o.length;ut<ft;ut++){const gt=o[ut];for(let Ct=0,At=gt.length,kt=At-1;Ct<At;kt=Ct++){const zt=gt[kt],Ut=gt[Ct];if(JE(_,zt,Ut))return g;(ot=zt)[1]>(rt=_)[1]!=(at=Ut)[1]>rt[1]&&rt[0]<(at[0]-ot[0])*(rt[1]-ot[1])/(at[1]-ot[1])+ot[0]&&(_e=!_e)}}var rt,ot,at;return _e}function x_(_,o,g,_e){const rt=_e[0]-g[0],ot=_e[1]-g[1],at=(_[0]-g[0])*ot-rt*(_[1]-g[1]),ut=(o[0]-g[0])*ot-rt*(o[1]-g[1]);return at>0&&ut<0||at<0&&ut>0}function v_(_,o,g,_e){return(rt=[_e[0]-g[0],_e[1]-g[1]])[0]*(ot=[o[0]-_[0],o[1]-_[1]])[1]-rt[1]*ot[0]!=0&&!(!x_(_,o,g,_e)||!x_(g,_e,_,o));var rt,ot}function Qp(_){const o=new mn(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),g=new mn(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const _e of _[0])o.x>_e.x&&(o.x=_e.x),o.y>_e.y&&(o.y=_e.y),g.x<_e.x&&(g.x=_e.x),g.y<_e.y&&(g.y=_e.y);return{min:o,max:g}}const Cm=8192;function eT(_,o){const g=(180+_[0])/360,_e=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+_[1]*Math.PI/360)))/360,rt=Math.pow(2,o.z);return[Math.round(g*rt*Cm),Math.round(_e*rt*Cm)]}function dv(_,o){for(let g=0;g<o.length;g++)if(T0(_,o[g]))return!0;return!1}function tT(_,o,g){for(const _e of g)for(let rt=0,ot=_e.length,at=ot-1;rt<ot;at=rt++)if(v_(_,o,_e[at],_e[rt]))return!0;return!1}function sw(_,o){for(let g=0;g<_.length;++g)if(!T0(_[g],o))return!1;for(let g=0;g<_.length-1;++g)if(tT(_[g],_[g+1],o))return!1;return!0}function ow(_,o){for(let g=0;g<o.length;g++)if(sw(_,o[g]))return!0;return!1}function pv(_,o,g){const _e=[];for(let rt=0;rt<_.length;rt++){const ot=[];for(let at=0;at<_[rt].length;at++){const ut=eT(_[rt][at],g);lp(o,ut),ot.push(ut)}_e.push(ot)}return _e}function Am(_,o,g){const _e=[];for(let rt=0;rt<_.length;rt++){const ot=pv(_[rt],o,g);_e.push(ot)}return _e}function aw(_,o,g,_e){if(_[0]<g[0]||_[0]>g[2]){const rt=.5*_e;let ot=_[0]-g[0]>rt?-_e:g[0]-_[0]>rt?_e:0;ot===0&&(ot=_[0]-g[2]>rt?-_e:g[2]-_[0]>rt?_e:0),_[0]+=ot}lp(o,_)}function lw(_,o,g,_e){const rt=Math.pow(2,_e.z)*Cm,ot=[_e.x*Cm,_e.y*Cm],at=[];if(!_)return at;for(const ut of _)for(const ft of ut){const gt=[ft.x+ot[0],ft.y+ot[1]];aw(gt,o,g,rt),at.push(gt)}return at}function Ty(_,o,g,_e){const rt=Math.pow(2,_e.z)*Cm,ot=[_e.x*Cm,_e.y*Cm],at=[];if(!_)return at;for(const ft of _){const gt=[];for(const Ct of ft){const At=[Ct.x+ot[0],Ct.y+ot[1]];lp(o,At),gt.push(At)}at.push(gt)}if(o[2]-o[0]<=rt/2){(ut=o)[0]=ut[1]=1/0,ut[2]=ut[3]=-1/0;for(const ft of at)for(const gt of ft)aw(gt,o,g,rt)}var ut;return at}class Rm{constructor(o,g){this.type=yo,this.geojson=o,this.geometries=g}static parse(o,g){if(o.length!==2)return g.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(w0(o[1])){const _e=o[1];if(_e.type==="FeatureCollection")for(let rt=0;rt<_e.features.length;++rt){const ot=_e.features[rt].geometry.type;if(ot==="Polygon"||ot==="MultiPolygon")return new Rm(_e,_e.features[rt].geometry)}else if(_e.type==="Feature"){const rt=_e.geometry.type;if(rt==="Polygon"||rt==="MultiPolygon")return new Rm(_e,_e.geometry)}else if(_e.type==="Polygon"||_e.type==="MultiPolygon")return new Rm(_e,_e)}return g.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(g,_e){const rt=[1/0,1/0,-1/0,-1/0],ot=[1/0,1/0,-1/0,-1/0],at=g.canonicalID();if(!at)return!1;if(_e.type==="Polygon"){const ut=pv(_e.coordinates,ot,at),ft=lw(g.geometry(),rt,ot,at);if(!y_(rt,ot))return!1;for(const gt of ft)if(!T0(gt,ut))return!1}if(_e.type==="MultiPolygon"){const ut=Am(_e.coordinates,ot,at),ft=lw(g.geometry(),rt,ot,at);if(!y_(rt,ot))return!1;for(const gt of ft)if(!dv(gt,ut))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(g,_e){const rt=[1/0,1/0,-1/0,-1/0],ot=[1/0,1/0,-1/0,-1/0],at=g.canonicalID();if(!at)return!1;if(_e.type==="Polygon"){const ut=pv(_e.coordinates,ot,at),ft=Ty(g.geometry(),rt,ot,at);if(!y_(rt,ot))return!1;for(const gt of ft)if(!sw(gt,ut))return!1}if(_e.type==="MultiPolygon"){const ut=Am(_e.coordinates,ot,at),ft=Ty(g.geometry(),rt,ot,at);if(!y_(rt,ot))return!1;for(const gt of ft)if(!ow(gt,ut))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const b_={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},cp=1/298.257223563,cw=cp*(2-cp),S0=Math.PI/180;class C0{static fromTile(o,g,_e){const rt=Math.PI*(1-2*(o+.5)/Math.pow(2,g)),ot=Math.atan(.5*(Math.exp(rt)-Math.exp(-rt)))/S0;return new C0(ot,_e)}static get units(){return b_}constructor(o,g){if(o===void 0)throw new Error("No latitude given.");if(g&&!b_[g])throw new Error(`Unknown unit ${g}. Use one of: ${Object.keys(b_).join(", ")}`);const _e=6378.137*S0*(g?b_[g]:1),rt=Math.cos(o*S0),ot=1/(1-cw*(1-rt*rt)),at=Math.sqrt(ot);this.kx=_e*at*rt,this.ky=_e*at*ot*(1-cw)}distance(o,g){const _e=Wu(o[0]-g[0])*this.kx,rt=(o[1]-g[1])*this.ky;return Math.sqrt(_e*_e+rt*rt)}bearing(o,g){const _e=Wu(g[0]-o[0])*this.kx;return Math.atan2(_e,(g[1]-o[1])*this.ky)/S0}destination(o,g,_e){const rt=_e*S0;return this.offset(o,Math.sin(rt)*g,Math.cos(rt)*g)}offset(o,g,_e){return[o[0]+g/this.kx,o[1]+_e/this.ky]}lineDistance(o){let g=0;for(let _e=0;_e<o.length-1;_e++)g+=this.distance(o[_e],o[_e+1]);return g}area(o){let g=0;for(let _e=0;_e<o.length;_e++){const rt=o[_e];for(let ot=0,at=rt.length,ut=at-1;ot<at;ut=ot++)g+=Wu(rt[ot][0]-rt[ut][0])*(rt[ot][1]+rt[ut][1])*(_e?-1:1)}return Math.abs(g)/2*this.kx*this.ky}along(o,g){let _e=0;if(g<=0)return o[0];for(let rt=0;rt<o.length-1;rt++){const ot=o[rt],at=o[rt+1],ut=this.distance(ot,at);if(_e+=ut,_e>g)return Sy(ot,at,(g-(_e-ut))/ut)}return o[o.length-1]}pointToSegmentDistance(o,g,_e){let[rt,ot]=g,at=Wu(_e[0]-rt)*this.kx,ut=(_e[1]-ot)*this.ky;if(at!==0||ut!==0){const ft=(Wu(o[0]-rt)*this.kx*at+(o[1]-ot)*this.ky*ut)/(at*at+ut*ut);ft>1?(rt=_e[0],ot=_e[1]):ft>0&&(rt+=at/this.kx*ft,ot+=ut/this.ky*ft)}return at=Wu(o[0]-rt)*this.kx,ut=(o[1]-ot)*this.ky,Math.sqrt(at*at+ut*ut)}pointOnLine(o,g){let _e=1/0,rt=o[0][0],ot=o[0][1],at=0,ut=0;for(let ft=0;ft<o.length-1;ft++){let gt=o[ft][0],Ct=o[ft][1],At=Wu(o[ft+1][0]-gt)*this.kx,kt=(o[ft+1][1]-Ct)*this.ky,zt=0;At===0&&kt===0||(zt=(Wu(g[0]-gt)*this.kx*At+(g[1]-Ct)*this.ky*kt)/(At*At+kt*kt),zt>1?(gt=o[ft+1][0],Ct=o[ft+1][1]):zt>0&&(gt+=At/this.kx*zt,Ct+=kt/this.ky*zt)),At=Wu(g[0]-gt)*this.kx,kt=(g[1]-Ct)*this.ky;const Ut=At*At+kt*kt;Ut<_e&&(_e=Ut,rt=gt,ot=Ct,at=ft,ut=zt)}return{point:[rt,ot],index:at,t:Math.max(0,Math.min(1,ut))}}lineSlice(o,g,_e){let rt=this.pointOnLine(_e,o),ot=this.pointOnLine(_e,g);if(rt.index>ot.index||rt.index===ot.index&&rt.t>ot.t){const gt=rt;rt=ot,ot=gt}const at=[rt.point],ut=rt.index+1,ft=ot.index;!fv(_e[ut],at[0])&&ut<=ft&&at.push(_e[ut]);for(let gt=ut+1;gt<=ft;gt++)at.push(_e[gt]);return fv(_e[ft],ot.point)||at.push(ot.point),at}lineSliceAlong(o,g,_e){let rt=0;const ot=[];for(let at=0;at<_e.length-1;at++){const ut=_e[at],ft=_e[at+1],gt=this.distance(ut,ft);if(rt+=gt,rt>o&&ot.length===0&&ot.push(Sy(ut,ft,(o-(rt-gt))/gt)),rt>=g)return ot.push(Sy(ut,ft,(g-(rt-gt))/gt)),ot;rt>o&&ot.push(ft)}return ot}bufferPoint(o,g){const _e=g/this.ky,rt=g/this.kx;return[o[0]-rt,o[1]-_e,o[0]+rt,o[1]+_e]}bufferBBox(o,g){const _e=g/this.ky,rt=g/this.kx;return[o[0]-rt,o[1]-_e,o[2]+rt,o[3]+_e]}insideBBox(o,g){return Wu(o[0]-g[0])>=0&&Wu(o[0]-g[2])<=0&&o[1]>=g[1]&&o[1]<=g[3]}}function fv(_,o){return _[0]===o[0]&&_[1]===o[1]}function Sy(_,o,g){const _e=Wu(o[0]-_[0]);return[_[0]+_e*g,_[1]+(o[1]-_[1])*g]}function Wu(_){for(;_<-180;)_+=360;for(;_>180;)_-=360;return _}class Cy{constructor(o=[],g=(_e,rt)=>_e<rt?-1:_e>rt?1:0){if(this.data=o,this.length=this.data.length,this.compare=g,this.length>0)for(let _e=(this.length>>1)-1;_e>=0;_e--)this._down(_e)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],g=this.data.pop();return--this.length>0&&(this.data[0]=g,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:g,compare:_e}=this,rt=g[o];for(;o>0;){const ot=o-1>>1,at=g[ot];if(_e(rt,at)>=0)break;g[o]=at,o=ot}g[o]=rt}_down(o){const{data:g,compare:_e}=this,rt=this.length>>1,ot=g[o];for(;o<rt;){let at=1+(o<<1);const ut=at+1;if(ut<this.length&&_e(g[ut],g[at])<0&&(at=ut),_e(g[at],ot)>=0)break;g[o]=g[at],o=at}g[o]=ot}}var Mn=8192;function mv(_,o){return o.dist-_.dist}const Ay=100,Ry=50;function gv(_){const o=[1/0,1/0,-1/0,-1/0];if(o.length!==_.length)return!1;for(let g=0;g<o.length;g++)if(o[g]!==_[g])return!1;return!0}function w_(_){return _[1]-_[0]+1}function Fp(_,o){const g=_[1]>=_[0]&&_[1]<o;return g||console.warn("Distance Expression: Index is out of range"),g}function _v(_,o){if(_[0]>_[1])return[null,null];const g=w_(_);if(o){if(g===2)return[_,null];const _e=Math.floor(g/2);return[[_[0],_[0]+_e],[_[0]+_e,_[1]]]}{if(g===1)return[_,null];const _e=Math.floor(g/2)-1;return[[_[0],_[0]+_e],[_[0]+_e+1,_[1]]]}}function e0(_,o){const g=[1/0,1/0,-1/0,-1/0];if(!Fp(o,_.length))return g;for(let _e=o[0];_e<=o[1];++_e)lp(g,_[_e]);return g}function t0(_){const o=[1/0,1/0,-1/0,-1/0];for(let g=0;g<_.length;++g)for(let _e=0;_e<_[g].length;++_e)lp(o,_[g][_e]);return o}function Im(_,o,g){if(gv(_)||gv(o))return NaN;let _e=0,rt=0;return _[2]<o[0]&&(_e=o[0]-_[2]),_[0]>o[2]&&(_e=_[0]-o[2]),_[1]>o[3]&&(rt=_[1]-o[3]),_[3]<o[1]&&(rt=o[1]-_[3]),g.distance([0,0],[_e,rt])}function Iy(_){return 360*_-180}function uw(_){return 360/Math.PI*Math.atan(Math.exp((180-360*_)*Math.PI/180))-90}function Py(_,o){const g=Math.pow(2,o.z),_e=(_.y/Mn+o.y)/g;return[Iy((_.x/Mn+o.x)/g),uw(_e)]}function rT(_,o){const g=[];for(let _e=0;_e<_.length;++_e)g.push(Py(_[_e],o));return g}function hw(_,o,g){const _e=g.pointOnLine(o,_).point;return g.distance(_,_e)}function yv(_,o,g,_e,rt){const ot=g.slice(_e[0],_e[1]+1);let at=1/0;for(let ut=o[0];ut<=o[1];++ut)if((at=Math.min(at,hw(_[ut],ot,rt)))===0)return 0;return at}function Pm(_,o,g,_e,rt){const ot=Math.min(rt.pointToSegmentDistance(_,g,_e),rt.pointToSegmentDistance(o,g,_e)),at=Math.min(rt.pointToSegmentDistance(g,_,o),rt.pointToSegmentDistance(_e,_,o));return Math.min(ot,at)}function Zs(_,o,g,_e,rt){if(!Fp(o,_.length)||!Fp(_e,g.length))return NaN;let ot=1/0;for(let at=o[0];at<o[1];++at)for(let ut=_e[0];ut<_e[1];++ut){if(v_(_[at],_[at+1],g[ut],g[ut+1]))return 0;ot=Math.min(ot,Pm(_[at],_[at+1],g[ut],g[ut+1],rt))}return ot}function iT(_,o,g,_e,rt){if(!Fp(o,_.length)||!Fp(_e,g.length))return NaN;let ot=1/0;for(let at=o[0];at<=o[1];++at)for(let ut=_e[0];ut<=_e[1];++ut)if((ot=Math.min(ot,rt.distance(_[at],g[ut])))===0)return ot;return ot}function nT(_,o,g){if(T0(_,o,!0))return 0;let _e=1/0;for(const rt of o){const ot=rt.length;if(ot<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(rt[0]!==rt[ot-1]&&(_e=Math.min(_e,g.pointToSegmentDistance(_,rt[ot-1],rt[0])))===0||(_e=Math.min(_e,hw(_,rt,g)))===0)return _e}return _e}function sT(_,o,g,_e){if(!Fp(o,_.length))return NaN;for(let ot=o[0];ot<=o[1];++ot)if(T0(_[ot],g,!0))return 0;let rt=1/0;for(let ot=o[0];ot<o[1];++ot)for(const at of g)for(let ut=0,ft=at.length,gt=ft-1;ut<ft;gt=ut++){if(v_(_[ot],_[ot+1],at[gt],at[ut]))return 0;rt=Math.min(rt,Pm(_[ot],_[ot+1],at[gt],at[ut],_e))}return rt}function xv(_,o){for(const g of _)for(let _e=0;_e<=g.length-1;++_e)if(T0(g[_e],o,!0))return!0;return!1}function oT(_,o,g,_e=1/0){const rt=t0(_),ot=t0(o);if(_e!==1/0&&Im(rt,ot,g)>=_e)return _e;if(y_(rt,ot)){if(xv(_,o))return 0}else if(xv(o,_))return 0;let at=_e;for(const ut of _)for(let ft=0,gt=ut.length,Ct=gt-1;ft<gt;Ct=ft++)for(const At of o)for(let kt=0,zt=At.length,Ut=zt-1;kt<zt;Ut=kt++){if(v_(ut[Ct],ut[ft],At[Ut],At[kt]))return 0;at=Math.min(at,Pm(ut[Ct],ut[ft],At[Ut],At[kt],g))}return at}function Uo(_,o,g,_e,rt,ot,at){if(ot===null||at===null)return;const ut=Im(e0(_e,ot),e0(rt,at),g);ut<o&&_.push({dist:ut,range1:ot,range2:at})}function aT(_,o,g,_e,rt=1/0){let ot=Math.min(_e.distance(_[0],g[0][0]),rt);if(ot===0)return ot;const at=new Cy([{dist:0,range1:[0,_.length-1],range2:[0,0]}],mv),ut=o?Ry:Ay,ft=t0(g);for(;at.length;){const gt=at.pop();if(gt.dist>=ot)continue;const Ct=gt.range1;if(w_(Ct)<=ut){if(!Fp(Ct,_.length))return NaN;if(o){const At=sT(_,Ct,g,_e);if((ot=Math.min(ot,At))===0)return ot}else for(let At=Ct[0];At<=Ct[1];++At){const kt=nT(_[At],g,_e);if((ot=Math.min(ot,kt))===0)return ot}}else{const At=_v(Ct,o);if(At[0]!==null){const kt=Im(e0(_,At[0]),ft,_e);kt<ot&&at.push({dist:kt,range1:At[0],range2:[0,0]})}if(At[1]!==null){const kt=Im(e0(_,At[1]),ft,_e);kt<ot&&at.push({dist:kt,range1:At[1],range2:[0,0]})}}}return ot}function dw(_,o,g,_e,rt,ot=1/0){let at=Math.min(ot,rt.distance(_[0],g[0]));if(at===0)return at;const ut=new Cy([{dist:0,range1:[0,_.length-1],range2:[0,g.length-1]}],mv),ft=o?Ry:Ay,gt=_e?Ry:Ay;for(;ut.length;){const Ct=ut.pop();if(Ct.dist>=at)continue;const At=Ct.range1,kt=Ct.range2;if(w_(At)<=ft&&w_(kt)<=gt){if(!Fp(At,_.length)||!Fp(kt,g.length))return NaN;if(o&&_e?at=Math.min(at,Zs(_,At,g,kt,rt)):o||_e?o&&!_e?at=Math.min(at,yv(g,kt,_,At,rt)):!o&&_e&&(at=Math.min(at,yv(_,At,g,kt,rt))):at=Math.min(at,iT(_,At,g,kt,rt)),at===0)return at}else{const zt=_v(At,o),Ut=_v(kt,_e);Uo(ut,at,rt,_,g,zt[0],Ut[0]),Uo(ut,at,rt,_,g,zt[0],Ut[1]),Uo(ut,at,rt,_,g,zt[1],Ut[0]),Uo(ut,at,rt,_,g,zt[1],Ut[1])}}return at}function vv(_,o,g,_e,rt=1/0){let ot=rt;const at=e0(_,[0,_.length-1]);for(const ut of g)if(!(ot!==1/0&&Im(at,e0(ut,[0,ut.length-1]),_e)>=ot)&&(ot=Math.min(ot,dw(_,o,ut,!0,_e,ot)),ot===0))return ot;return ot}function ky(_,o,g,_e,rt=1/0){let ot=rt;const at=e0(_,[0,_.length-1]);for(const ut of g){if(ot!==1/0&&Im(at,t0(ut),_e)>=ot)continue;const ft=aT(_,o,ut,_e,ot);if(isNaN(ft))return ft;if((ot=Math.min(ot,ft))===0)return ot}return ot}function bv(_){return _==="Point"||_==="MultiPoint"||_==="LineString"||_==="MultiLineString"||_==="Polygon"||_==="MultiPolygon"}class r0{constructor(o,g){this.type=is,this.geojson=o,this.geometries=g}static parse(o,g){if(o.length!==2)return g.error(`'distance' expression requires either one argument, but found ' ${o.length-1} instead.`);if(w0(o[1])){const _e=o[1];if(_e.type==="FeatureCollection"){for(let rt=0;rt<_e.features.length;++rt)if(bv(_e.features[rt].geometry.type))return new r0(_e,_e.features[rt].geometry)}else if(_e.type==="Feature"){if(bv(_e.geometry.type))return new r0(_e,_e.geometry)}else if(bv(_e.type))return new r0(_e,_e)}return g.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(o){const g=o.geometry(),_e=o.canonicalID();if(g!=null&&_e!=null){if(o.geometryType()==="Point")return function(rt,ot,at){const ut=[];for(const gt of rt)for(const Ct of gt)ut.push(Py(Ct,ot));const ft=new C0(ut[0][1],"meters");return at.type==="Point"||at.type==="MultiPoint"||at.type==="LineString"?dw(ut,!1,at.type==="Point"?[at.coordinates]:at.coordinates,at.type==="LineString",ft):at.type==="MultiLineString"?vv(ut,!1,at.coordinates,ft):at.type==="Polygon"||at.type==="MultiPolygon"?ky(ut,!1,at.type==="Polygon"?[at.coordinates]:at.coordinates,ft):null}(g,_e,this.geometries);if(o.geometryType()==="LineString")return function(rt,ot,at){const ut=[];for(const gt of rt){const Ct=[];for(const At of gt)Ct.push(Py(At,ot));ut.push(Ct)}const ft=new C0(ut[0][0][1],"meters");if(at.type==="Point"||at.type==="MultiPoint"||at.type==="LineString")return vv(at.type==="Point"?[at.coordinates]:at.coordinates,at.type==="LineString",ut,ft);if(at.type==="MultiLineString"){let gt=1/0;for(let Ct=0;Ct<at.coordinates.length;Ct++){const At=vv(at.coordinates[Ct],!0,ut,ft,gt);if(isNaN(At))return At;if((gt=Math.min(gt,At))===0)return gt}return gt}if(at.type==="Polygon"||at.type==="MultiPolygon"){let gt=1/0;for(let Ct=0;Ct<ut.length;Ct++){const At=ky(ut[Ct],!0,at.type==="Polygon"?[at.coordinates]:at.coordinates,ft,gt);if(isNaN(At))return At;if((gt=Math.min(gt,At))===0)return gt}return gt}return null}(g,_e,this.geometries);if(o.geometryType()==="Polygon")return function(rt,ot,at){const ut=[];for(const gt of function(Ct,At){const kt=Ct.length;if(kt<=1)return[Ct];const zt=[];let Ut,Kt;for(let er=0;er<kt;er++){const Jt=Sm(Ct[er]);Jt!==0&&(Ct[er].area=Math.abs(Jt),Kt===void 0&&(Kt=Jt<0),Kt===Jt<0?(Ut&&zt.push(Ut),Ut=[Ct[er]]):Ut.push(Ct[er]))}return Ut&&zt.push(Ut),zt}(rt)){const Ct=[];for(let At=0;At<gt.length;++At)Ct.push(rT(gt[At],ot));ut.push(Ct)}const ft=new C0(ut[0][0][0][1],"meters");if(at.type==="Point"||at.type==="MultiPoint"||at.type==="LineString")return ky(at.type==="Point"?[at.coordinates]:at.coordinates,at.type==="LineString",ut,ft);if(at.type==="MultiLineString"){let gt=1/0;for(let Ct=0;Ct<at.coordinates.length;Ct++){const At=ky(at.coordinates[Ct],!0,ut,ft,gt);if(isNaN(At))return At;if((gt=Math.min(gt,At))===0)return gt}return gt}return at.type==="Polygon"||at.type==="MultiPolygon"?function(gt,Ct,At){let kt=1/0;for(const zt of gt)for(const Ut of Ct){const Kt=oT(zt,Ut,At,kt);if(isNaN(Kt))return Kt;if((kt=Math.min(kt,Kt))===0)return kt}return kt}(at.type==="Polygon"?[at.coordinates]:at.coordinates,ut,ft):null}(g,_e,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function A0(_){if(_ instanceof Au&&(_.name==="get"&&_.args.length===1||_.name==="feature-state"||_.name==="has"&&_.args.length===1||_.name==="properties"||_.name==="geometry-type"||_.name==="id"||/^filter-/.test(_.name))||_ instanceof Rm||_ instanceof r0)return!1;if(_ instanceof I0)return _.featureConstant;let o=!0;return _.eachChild(g=>{o&&!A0(g)&&(o=!1)}),o}function E_(_){if(_ instanceof Au&&_.name==="feature-state")return!1;let o=!0;return _.eachChild(g=>{o&&!E_(g)&&(o=!1)}),o}function R0(_,o){if(_ instanceof Au&&o.indexOf(_.name)>=0)return!1;let g=!0;return _.eachChild(_e=>{g&&!R0(_e,o)&&(g=!1)}),g}function pw(_,o,g){return[_,o,g].filter(Boolean).join("")}function wv(_,o){switch(_){case"string":return ap(o);case"number":return+o;case"boolean":return!!o;case"color":return fo.parse(o);case"formatted":return Su.fromString(ap(o));case"resolvedImage":return Cu.build(ap(o))}return o}function fw(_,o,g,_e){return _e!==void 0&&(_=_e*Math.round(_/_e)),o!==void 0&&_<o&&(_=o),g!==void 0&&_>g&&(_=g),_}class I0{constructor(o,g,_e,rt=!1){this.type=o,this.key=g,this.scope=_e,this.featureConstant=rt}static parse(o,g){let _e=g.expectedType;if(_e==null&&(_e=po),o.length<2||o.length>3)return g.error("Invalid number of arguments for 'config' expression.");const rt=g.parse(o[1],1);if(!(rt instanceof Yp))return g.error("Key name of 'config' expression must be a string literal.");let ot,at=!0;const ut=ap(rt.value);if(o.length>=3){const ft=g.parse(o[2],2);if(!(ft instanceof Yp))return g.error("Scope of 'config' expression must be a string literal.");ot=ap(ft.value)}if(g.options){const ft=pw(ut,ot,g._scope),gt=g.options.get(ft);gt&&(at=A0(gt.value||gt.default))}return new I0(_e,ut,ot,at)}evaluate(o){const g=pw(this.key,this.scope,o.scope),_e=o.getConfig(g);if(!_e)return null;const{type:rt,value:ot,values:at,minValue:ut,maxValue:ft,stepValue:gt}=_e,Ct=_e.default.evaluate(o);let At=Ct;if(ot){const kt=o.scope;o.scope=(kt||"").split("").slice(1).join(""),At=ot.evaluate(o),o.scope=kt}return rt&&(At=wv(rt,At)),At===void 0||ut===void 0&&ft===void 0&&gt===void 0||(typeof At=="number"?At=fw(At,ut,ft,gt):Array.isArray(At)&&(At=At.map(kt=>typeof kt=="number"?fw(kt,ut,ft,gt):kt))),ot!==void 0&&At!==void 0&&at&&!at.includes(At)&&(At=Ct,rt&&(At=wv(rt,At))),(rt&&rt!==this.type||At!==void 0&&!_y(Zl(At),this.type))&&(At=wv(this.type.kind,At)),At}eachChild(){}outputDefined(){return!1}serialize(){const o=["config",this.key];return this.scope&&o.concat(this.scope),o}}class My{constructor(o,g){this.type=g.type,this.name=o,this.boundExpression=g}static parse(o,g){if(o.length!==2||typeof o[1]!="string")return g.error("'var' expression requires exactly one string literal argument.");const _e=o[1];return g.scope.has(_e)?new My(_e,g.scope.get(_e)):g.error(`Unknown variable "${_e}". Make sure "${_e}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Dy{constructor(o,g=[],_e,rt=new b0,ot=[],at,ut,ft){this.registry=o,this.path=g,this.key=g.map(gt=>typeof gt=="string"?`['${gt}']`:`[${gt}]`).join(""),this.scope=rt,this.errors=ot,this.expectedType=_e,this._scope=at,this.options=ut,this.iconImageUseTheme=ft}parse(o,g,_e,rt,ot={}){return g||_e?this.concat(g,null,_e,rt)._parse(o,ot):this._parse(o,ot)}parseObjectValue(o,g,_e,rt,ot,at={}){return this.concat(g,_e,rt,ot)._parse(o,at)}_parse(o,g){function _e(rt,ot,at){return at==="assert"?new vp(ot,[rt]):at==="coerce"?new jp(ot,[rt]):rt}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const rt=typeof o[0]=="string"?this.registry[o[0]]:void 0;if(rt){let ot=rt.parse(o,this);if(!ot)return null;if(this.expectedType){const at=this.expectedType,ut=ot.type;if(at.kind!=="string"&&at.kind!=="number"&&at.kind!=="boolean"&&at.kind!=="object"&&at.kind!=="array"||ut.kind!=="value")if(at.kind!=="color"&&at.kind!=="formatted"&&at.kind!=="resolvedImage"||ut.kind!=="value"&&ut.kind!=="string"){if(this.checkSubtype(at,ut))return null}else ot=_e(ot,at,g.typeAnnotation||"coerce");else ot=_e(ot,at,g.typeAnnotation||"assert")}if(!(ot instanceof Yp)&&ot.type.kind!=="resolvedImage"&&Ev(ot)){const at=new by(this._scope,this.options,this.iconImageUseTheme);try{ot=new Yp(ot.type,ot.evaluate(at))}catch(ut){return this.error(ut.message),null}}return ot}return jp.parse(["to-array",o],this)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,g,_e,rt){let ot=typeof o=="number"?this.path.concat(o):this.path;ot=typeof g=="string"?ot.concat(g):ot;const at=rt?this.scope.concat(rt):this.scope;return new Dy(this.registry,ot,_e||null,at,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(o,...g){const _e=`${this.key}${g.map(rt=>`[${rt}]`).join("")}`;this.errors.push(new sp(_e,o))}checkSubtype(o,g){const _e=Tm(o,g);return _e&&this.error(_e),_e}}function Ev(_){if(_ instanceof My)return Ev(_.boundExpression);if(_ instanceof Au&&_.name==="error"||_ instanceof _c||_ instanceof Rm||_ instanceof r0||_ instanceof I0)return!1;const o=_ instanceof jp||_ instanceof vp;let g=!0;return _.eachChild(_e=>{g=o?g&&Ev(_e):g&&_e instanceof Yp}),!!g&&A0(_)&&R0(_,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ny(_,o){const g=_.length-1;let _e,rt,ot=0,at=g,ut=0;for(;ot<=at;)if(ut=Math.floor((ot+at)/2),_e=_[ut],rt=_[ut+1],_e<=o){if(ut===g||o<rt)return ut;ot=ut+1}else{if(!(_e>o))throw new Gl("Input is not a number.");at=ut-1}return 0}class T_{constructor(o,g,_e){this.type=o,this.input=g,this.labels=[],this.outputs=[];for(const[rt,ot]of _e)this.labels.push(rt),this.outputs.push(ot)}static parse(o,g){if(o.length-1<4)return g.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return g.error("Expected an even number of arguments.");const _e=g.parse(o[1],1,is);if(!_e)return null;const rt=[];let ot=null;g.expectedType&&g.expectedType.kind!=="value"&&(ot=g.expectedType);for(let at=1;at<o.length;at+=2){const ut=at===1?-1/0:o[at],ft=o[at+1],gt=at,Ct=at+1;if(typeof ut!="number")return g.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',gt);if(rt.length&&rt[rt.length-1][0]>=ut)return g.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',gt);const At=g.parse(ft,Ct,ot);if(!At)return null;ot=ot||At.type,rt.push([ut,At])}return new T_(ot,_e,rt)}evaluate(o){const g=this.labels,_e=this.outputs;if(g.length===1)return _e[0].evaluate(o);const rt=this.input.evaluate(o);if(rt<=g[0])return _e[0].evaluate(o);const ot=g.length;return rt>=g[ot-1]?_e[ot-1].evaluate(o):_e[Ny(g,rt)].evaluate(o)}eachChild(o){o(this.input);for(const g of this.outputs)o(g)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let g=0;g<this.labels.length;g++)g>0&&o.push(this.labels[g]),o.push(this.outputs[g].serialize());return o}}const mw=.95047,gw=1.08883,_w=4/29,P0=6/29,yw=3*P0*P0,lT=P0*P0*P0,cT=Math.PI/180,uT=180/Math.PI;function Tv(_){return _>lT?Math.pow(_,1/3):_/yw+_w}function Sv(_){return _>P0?_*_*_:yw*(_-_w)}function Cv(_){return 255*(_<=.0031308?12.92*_:1.055*Math.pow(_,1/2.4)-.055)}function Av(_){return(_/=255)<=.04045?_/12.92:Math.pow((_+.055)/1.055,2.4)}function xw(_){const o=Av(_.r),g=Av(_.g),_e=Av(_.b),rt=Tv((.4124564*o+.3575761*g+.1804375*_e)/mw),ot=Tv((.2126729*o+.7151522*g+.072175*_e)/1);return{l:116*ot-16,a:500*(rt-ot),b:200*(ot-Tv((.0193339*o+.119192*g+.9503041*_e)/gw)),alpha:_.a}}function Ly(_){let o=(_.l+16)/116,g=isNaN(_.a)?o:o+_.a/500,_e=isNaN(_.b)?o:o-_.b/200;return o=1*Sv(o),g=mw*Sv(g),_e=gw*Sv(_e),new fo(Cv(3.2404542*g-1.5371385*o-.4985314*_e),Cv(-.969266*g+1.8760108*o+.041556*_e),Cv(.0556434*g-.2040259*o+1.0572252*_e),_.alpha)}function Oy(_,o,g){const _e=o-_;return _+g*(_e>180||_e<-180?_e-360*Math.round(_e/360):_e)}const k0={forward:xw,reverse:Ly,interpolate:function(_,o,g){return{l:fs(_.l,o.l,g),a:fs(_.a,o.a,g),b:fs(_.b,o.b,g),alpha:fs(_.alpha,o.alpha,g)}}},S_={forward:function(_){const{l:o,a:g,b:_e}=xw(_),rt=Math.atan2(_e,g)*uT;return{h:rt<0?rt+360:rt,c:Math.sqrt(g*g+_e*_e),l:o,alpha:_.a}},reverse:function(_){const o=_.h*cT,g=_.c;return Ly({l:_.l,a:Math.cos(o)*g,b:Math.sin(o)*g,alpha:_.alpha})},interpolate:function(_,o,g){return{h:Oy(_.h,o.h,g),c:fs(_.c,o.c,g),l:fs(_.l,o.l,g),alpha:fs(_.alpha,o.alpha,g)}}};var bw=Object.freeze({__proto__:null,hcl:S_,lab:k0});class qu{constructor(o,g,_e,rt,ot){this.type=o,this.operator=g,this.interpolation=_e,this.input=rt,this.labels=[],this.outputs=[];for(const[at,ut]of ot)this.labels.push(at),this.outputs.push(ut)}static interpolationFactor(o,g,_e,rt){let ot=0;if(o.name==="exponential")ot=jy(g,o.base,_e,rt);else if(o.name==="linear")ot=jy(g,1,_e,rt);else if(o.name==="cubic-bezier"){const at=o.controlPoints;ot=new Tu(at[0],at[1],at[2],at[3]).solve(jy(g,1,_e,rt))}return ot}static parse(o,g){let[_e,rt,ot,...at]=o;if(!Array.isArray(rt)||rt.length===0)return g.error("Expected an interpolation type expression.",1);if(rt[0]==="linear")rt={name:"linear"};else if(rt[0]==="exponential"){const gt=rt[1];if(typeof gt!="number")return g.error("Exponential interpolation requires a numeric base.",1,1);rt={name:"exponential",base:gt}}else{if(rt[0]!=="cubic-bezier")return g.error(`Unknown interpolation type ${String(rt[0])}`,1,0);{const gt=rt.slice(1);if(gt.length!==4||gt.some(Ct=>typeof Ct!="number"||Ct<0||Ct>1))return g.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);rt={name:"cubic-bezier",controlPoints:gt}}}if(o.length-1<4)return g.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length-1>3&&(o.length-1)%2!=0)return g.error("Expected an even number of arguments.");if(ot=g.parse(ot,2,is),!ot)return null;const ut=[];let ft=null;_e==="interpolate-hcl"||_e==="interpolate-lab"?ft=Nu:g.expectedType&&g.expectedType.kind!=="value"&&(ft=g.expectedType);for(let gt=0;gt<at.length;gt+=2){const Ct=at[gt],At=at[gt+1],kt=gt+3,zt=gt+4;if(typeof Ct!="number")return g.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',kt);if(ut.length&&ut[ut.length-1][0]>=Ct)return g.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',kt);const Ut=g.parse(At,zt,ft);if(!Ut)return null;ft=ft||Ut.type,ut.push([Ct,Ut])}return ft.kind==="number"||ft.kind==="color"||ft.kind==="array"&&ft.itemType.kind==="number"&&typeof ft.N=="number"?new qu(ft,_e,rt,ot,ut):g.error(`Type ${Ml(ft)} is not interpolatable.`)}evaluate(o){const g=this.labels,_e=this.outputs;if(g.length===1)return _e[0].evaluate(o);const rt=this.input.evaluate(o);if(rt<=g[0])return _e[0].evaluate(o);const ot=g.length;if(rt>=g[ot-1])return _e[ot-1].evaluate(o);const at=Ny(g,rt),ut=qu.interpolationFactor(this.interpolation,rt,g[at],g[at+1]),ft=_e[at].evaluate(o),gt=_e[at+1].evaluate(o);return this.operator==="interpolate"?f_[this.type.kind.toLowerCase()](ft,gt,ut):this.operator==="interpolate-hcl"?S_.reverse(S_.interpolate(S_.forward(ft),S_.forward(gt),ut)):k0.reverse(k0.interpolate(k0.forward(ft),k0.forward(gt),ut))}eachChild(o){o(this.input);for(const g of this.outputs)o(g)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const g=[this.operator,o,this.input.serialize()];for(let _e=0;_e<this.labels.length;_e++)g.push(this.labels[_e],this.outputs[_e].serialize());return g}}function jy(_,o,g,_e){const rt=_e-g,ot=_-g;return rt===0?0:o===1?ot/rt:(Math.pow(o,ot)-1)/(Math.pow(o,rt)-1)}class C_{constructor(o,g){this.type=o,this.args=g}static parse(o,g){if(o.length<2)return g.error("Expectected at least one argument.");let _e=null;const rt=g.expectedType;rt&&rt.kind!=="value"&&(_e=rt);const ot=[];for(const ut of o.slice(1)){const ft=g.parse(ut,1+ot.length,_e,void 0,{typeAnnotation:"omit"});if(!ft)return null;_e=_e||ft.type,ot.push(ft)}const at=rt&&ot.some(ut=>Tm(rt,ut.type));return new C_(at?po:_e,ot)}evaluate(o){let g,_e=null,rt=0;for(const ot of this.args){if(rt++,_e=ot.evaluate(o),_e&&_e instanceof Cu&&!_e.available&&(g||(g=_e),_e=null,rt===this.args.length))return g;if(_e!==null)break}return _e}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(g=>{o.push(g.serialize())}),o}}class Jp{constructor(o,g){this.type=g.type,this.bindings=[].concat(o),this.result=g}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const g of this.bindings)o(g[1]);o(this.result)}static parse(o,g){if(o.length<4)return g.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const _e=[];for(let ot=1;ot<o.length-1;ot+=2){const at=o[ot];if(typeof at!="string")return g.error(`Expected string, but found ${typeof at} instead.`,ot);if(/[^a-zA-Z0-9_]/.test(at))return g.error("Variable names must contain only alphanumeric characters or '_'.",ot);const ut=g.parse(o[ot+1],ot+1);if(!ut)return null;_e.push([at,ut])}const rt=g.parse(o[o.length-1],o.length-1,g.expectedType,_e);return rt?new Jp(_e,rt):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[g,_e]of this.bindings)o.push(g,_e.serialize());return o.push(this.result.serialize()),o}}class Fy{constructor(o,g,_e){this.type=o,this.index=g,this.input=_e}static parse(o,g){if(o.length!==3)return g.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const _e=g.parse(o[1],1,is),rt=g.parse(o[2],2,fu(g.expectedType||po));return _e&&rt?new Fy(rt.type.itemType,_e,rt):null}evaluate(o){const g=this.index.evaluate(o),_e=this.input.evaluate(o);if(g<0)throw new Gl("Array index out of bounds: negative index");if(g>=_e.length)throw new Gl("Array index out of bounds: index exceeds array size");if(g!==Math.floor(g))throw new Gl("Array index must be an integer. Use at-interpolated for fractional indices");return _e[g]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class By{constructor(o,g,_e){this.type=o,this.index=g,this.input=_e}static parse(o,g){if(o.length!==3)return g.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const _e=g.parse(o[1],1,is),rt=g.parse(o[2],2,fu(g.expectedType||po));return _e&&rt?new By(rt.type.itemType,_e,rt):null}evaluate(o){const g=this.index.evaluate(o),_e=this.input.evaluate(o);if(g<0)throw new Gl(`Array index out of bounds: ${g} < 0.`);if(g>_e.length-1)throw new Gl(`Array index out of bounds: ${g} > ${_e.length-1}.`);if(g===Math.floor(g))return _e[g];const rt=Math.floor(g),ot=Math.ceil(g),at=_e[rt],ut=_e[ot];if(typeof at!="number"||typeof ut!="number")throw new Gl(`Cannot interpolate between non-number values at index ${g}.`);const ft=g-rt;return at*(1-ft)+ut*ft}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Rv{constructor(o,g){this.type=yo,this.needle=o,this.haystack=g}static parse(o,g){if(o.length!==3)return g.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const _e=g.parse(o[1],1,po),rt=g.parse(o[2],2,po);return _e&&rt?av(_e.type,[yo,qs,is,xp,po])?new Rv(_e,rt):g.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ml(_e.type)} instead`):null}evaluate(o){const g=this.needle.evaluate(o),_e=this.haystack.evaluate(o);if(_e==null)return!1;if(!__(g,["boolean","string","number","null"]))throw new Gl(`Expected first argument to be of type boolean, string, number or null, but found ${Ml(Zl(g))} instead.`);if(!__(_e,["string","array"]))throw new Gl(`Expected second argument to be of type array or string, but found ${Ml(Zl(_e))} instead.`);return _e.indexOf(g)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class M0{constructor(o,g,_e){this.type=is,this.needle=o,this.haystack=g,this.fromIndex=_e}static parse(o,g){if(o.length<=2||o.length>=5)return g.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const _e=g.parse(o[1],1,po),rt=g.parse(o[2],2,po);if(!_e||!rt)return null;if(!av(_e.type,[yo,qs,is,xp,po]))return g.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ml(_e.type)} instead`);if(o.length===4){const ot=g.parse(o[3],3,is);return ot?new M0(_e,rt,ot):null}return new M0(_e,rt)}evaluate(o){const g=this.needle.evaluate(o),_e=this.haystack.evaluate(o);if(!__(g,["boolean","string","number","null"]))throw new Gl(`Expected first argument to be of type boolean, string, number or null, but found ${Ml(Zl(g))} instead.`);if(!__(_e,["string","array"]))throw new Gl(`Expected second argument to be of type array or string, but found ${Ml(Zl(_e))} instead.`);if(this.fromIndex){const rt=this.fromIndex.evaluate(o);return _e.indexOf(g,rt)}return _e.indexOf(g)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class A_{constructor(o,g,_e,rt,ot,at){this.inputType=o,this.type=g,this.input=_e,this.cases=rt,this.outputs=ot,this.otherwise=at}static parse(o,g){if(o.length<5)return g.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return g.error("Expected an even number of arguments.");let _e,rt;g.expectedType&&g.expectedType.kind!=="value"&&(rt=g.expectedType);const ot={},at=[];for(let gt=2;gt<o.length-1;gt+=2){let Ct=o[gt];const At=o[gt+1];Array.isArray(Ct)||(Ct=[Ct]);const kt=g.concat(gt);if(Ct.length===0)return kt.error("Expected at least one branch label.");for(const Ut of Ct){if(typeof Ut!="number"&&typeof Ut!="string")return kt.error("Branch labels must be numbers or strings.");if(typeof Ut=="number"&&Math.abs(Ut)>Number.MAX_SAFE_INTEGER)return kt.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Ut=="number"&&Math.floor(Ut)!==Ut)return kt.error("Numeric branch labels must be integer values.");if(_e){if(kt.checkSubtype(_e,Zl(Ut)))return null}else _e=Zl(Ut);if(ot[String(Ut)]!==void 0)return kt.error("Branch labels must be unique.");ot[String(Ut)]=at.length}const zt=g.parse(At,gt,rt);if(!zt)return null;rt=rt||zt.type,at.push(zt)}const ut=g.parse(o[1],1,po);if(!ut)return null;const ft=g.parse(o[o.length-1],o.length-1,rt);return ft?ut.type.kind!=="value"&&g.concat(1).checkSubtype(_e,ut.type)?null:new A_(_e,rt,ut,ot,at,ft):null}evaluate(o){const g=this.input.evaluate(o);return(_y(Zl(g),this.inputType)&&this.outputs[this.cases[g]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],g=Object.keys(this.cases).sort(),_e=[],rt={};for(const at of g){const ut=rt[this.cases[at]];ut===void 0?(rt[this.cases[at]]=_e.length,_e.push([this.cases[at],[at]])):_e[ut][1].push(at)}const ot=at=>this.inputType.kind==="number"?Number(at):at;for(const[at,ut]of _e)o.push(ut.length===1?ot(ut[0]):ut.map(ot)),o.push(this.outputs[at].serialize());return o.push(this.otherwise.serialize()),o}}class R_{constructor(o,g,_e){this.type=o,this.branches=g,this.otherwise=_e}static parse(o,g){if(o.length<4)return g.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return g.error("Expected an odd number of arguments.");let _e;g.expectedType&&g.expectedType.kind!=="value"&&(_e=g.expectedType);const rt=[];for(let at=1;at<o.length-1;at+=2){const ut=g.parse(o[at],at,yo);if(!ut)return null;const ft=g.parse(o[at+1],at+1,_e);if(!ft)return null;rt.push([ut,ft]),_e=_e||ft.type}const ot=g.parse(o[o.length-1],o.length-1,_e);return ot?new R_(_e,rt,ot):null}evaluate(o){for(const[g,_e]of this.branches)if(g.evaluate(o))return _e.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[g,_e]of this.branches)o(g),o(_e);o(this.otherwise)}outputDefined(){return this.branches.every(([o,g])=>g.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(g=>{o.push(g.serialize())}),o}}class zy{constructor(o,g,_e,rt){this.type=o,this.input=g,this.beginIndex=_e,this.endIndex=rt}static parse(o,g){if(o.length<=2||o.length>=5)return g.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const _e=g.parse(o[1],1,po),rt=g.parse(o[2],2,is);if(!_e||!rt)return null;if(!av(_e.type,[fu(po),qs,po]))return g.error(`Expected first argument to be of type array or string, but found ${Ml(_e.type)} instead`);if(o.length===4){const ot=g.parse(o[3],3,is);return ot?new zy(_e.type,_e,rt,ot):null}return new zy(_e.type,_e,rt)}evaluate(o){const g=this.input.evaluate(o),_e=this.beginIndex.evaluate(o);if(!__(g,["string","array"]))throw new Gl(`Expected first argument to be of type array or string, but found ${Ml(Zl(g))} instead.`);if(this.endIndex){const rt=this.endIndex.evaluate(o);return g.slice(_e,rt)}return g.slice(_e)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Iv{constructor(o,g){this.type=fu(qs),this.str=o,this.delimiter=g}static parse(o,g){if(o.length!==3)return g.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const _e=g.parse(o[1],1,qs),rt=g.parse(o[2],2,qs);return _e&&rt?new Iv(_e,rt):void 0}evaluate(o){const g=this.str.evaluate(o),_e=this.delimiter.evaluate(o);return g.split(_e)}eachChild(o){o(this.str),o(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Pv(_,o){return _==="=="||_==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function kv(_,o,g,_e){return _e.compare(o,g)===0}function D0(_,o,g){const _e=_!=="=="&&_!=="!=";return class rI{constructor(ot,at,ut){this.type=yo,this.lhs=ot,this.rhs=at,this.collator=ut,this.hasUntypedArgument=ot.type.kind==="value"||at.type.kind==="value"}static parse(ot,at){if(ot.length!==3&&ot.length!==4)return at.error("Expected two or three arguments.");const ut=ot[0];let ft=at.parse(ot[1],1,po);if(!ft)return null;if(!Pv(ut,ft.type))return at.concat(1).error(`"${ut}" comparisons are not supported for type '${Ml(ft.type)}'.`);let gt=at.parse(ot[2],2,po);if(!gt)return null;if(!Pv(ut,gt.type))return at.concat(2).error(`"${ut}" comparisons are not supported for type '${Ml(gt.type)}'.`);if(ft.type.kind!==gt.type.kind&&ft.type.kind!=="value"&&gt.type.kind!=="value")return at.error(`Cannot compare types '${Ml(ft.type)}' and '${Ml(gt.type)}'.`);_e&&(ft.type.kind==="value"&&gt.type.kind!=="value"?ft=new vp(gt.type,[ft]):ft.type.kind!=="value"&&gt.type.kind==="value"&&(gt=new vp(ft.type,[gt])));let Ct=null;if(ot.length===4){if(ft.type.kind!=="string"&&gt.type.kind!=="string"&&ft.type.kind!=="value"&&gt.type.kind!=="value")return at.error("Cannot use collator to compare non-string types.");if(Ct=at.parse(ot[3],3,gy),!Ct)return null}return new rI(ft,gt,Ct)}evaluate(ot){const at=this.lhs.evaluate(ot),ut=this.rhs.evaluate(ot);if(_e&&this.hasUntypedArgument){const ft=Zl(at),gt=Zl(ut);if(ft.kind!==gt.kind||ft.kind!=="string"&&ft.kind!=="number")throw new Gl(`Expected arguments for "${_}" to be (string, string) or (number, number), but found (${ft.kind}, ${gt.kind}) instead.`)}if(this.collator&&!_e&&this.hasUntypedArgument){const ft=Zl(at),gt=Zl(ut);if(ft.kind!=="string"||gt.kind!=="string")return o(ot,at,ut)}return this.collator?g(ot,at,ut,this.collator.evaluate(ot)):o(ot,at,ut)}eachChild(ot){ot(this.lhs),ot(this.rhs),this.collator&&ot(this.collator)}outputDefined(){return!0}serialize(){const ot=[_];return this.eachChild(at=>{ot.push(at.serialize())}),ot}}}const hT=D0("==",function(_,o,g){return o===g},kv),dT=D0("!=",function(_,o,g){return o!==g},function(_,o,g,_e){return!kv(0,o,g,_e)}),ww=D0("<",function(_,o,g){return o<g},function(_,o,g,_e){return _e.compare(o,g)<0}),Ew=D0(">",function(_,o,g){return o>g},function(_,o,g,_e){return _e.compare(o,g)>0}),Vy=D0("<=",function(_,o,g){return o<=g},function(_,o,g,_e){return _e.compare(o,g)<=0}),pT=D0(">=",function(_,o,g){return o>=g},function(_,o,g,_e){return _e.compare(o,g)>=0});class Uy{constructor(o,g,_e,rt,ot,at){this.type=qs,this.number=o,this.locale=g,this.currency=_e,this.unit=rt,this.minFractionDigits=ot,this.maxFractionDigits=at}static parse(o,g){if(o.length!==3)return g.error("Expected two arguments.");const _e=g.parse(o[1],1,is);if(!_e)return null;const rt=o[2];if(typeof rt!="object"||Array.isArray(rt))return g.error("NumberFormat options argument must be an object.");let ot=null;if(rt.locale&&(ot=g.parseObjectValue(rt.locale,2,"locale",qs),!ot))return null;let at=null;if(rt.currency&&(at=g.parseObjectValue(rt.currency,2,"currency",qs),!at))return null;let ut=null;if(rt.unit&&(ut=g.parseObjectValue(rt.unit,2,"unit",qs),!ut))return null;let ft=null;if(rt["min-fraction-digits"]&&(ft=g.parseObjectValue(rt["min-fraction-digits"],2,"min-fraction-digits",is),!ft))return null;let gt=null;return rt["max-fraction-digits"]&&(gt=g.parseObjectValue(rt["max-fraction-digits"],2,"max-fraction-digits",is),!gt)?null:new Uy(_e,ot,at,ut,ft,gt)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class Mv{constructor(o){this.type=is,this.input=o}static parse(o,g){if(o.length!==2)return g.error(`Expected 1 argument, but found ${o.length-1} instead.`);const _e=g.parse(o[1],1);return _e?_e.type.kind!=="array"&&_e.type.kind!=="string"&&_e.type.kind!=="value"?g.error(`Expected argument of type string or array, but found ${Ml(_e.type)} instead.`):new Mv(_e):null}evaluate(o){const g=this.input.evaluate(o);if(typeof g=="string"||Array.isArray(g))return g.length;throw new Gl(`Expected value to be of type string or array, but found ${Ml(Zl(g))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(g=>{o.push(g.serialize())}),o}}function Tw(_){return function(){_=1831565813+(_|=0)|0;let o=Math.imul(_^_>>>15,1|_);return o=o+Math.imul(o^o>>>7,61|o)^o,((o^o>>>14)>>>0)/4294967296}}const N0={"==":hT,"!=":dT,">":Ew,"<":ww,">=":pT,"<=":Vy,array:vp,at:Fy,"at-interpolated":By,boolean:vp,case:R_,coalesce:C_,collator:_c,format:Op,image:Ps,in:Rv,"index-of":M0,interpolate:qu,"interpolate-hcl":qu,"interpolate-lab":qu,length:Mv,let:Jp,literal:Yp,match:A_,number:vp,"number-format":Uy,object:vp,slice:zy,step:T_,string:vp,"to-boolean":jp,"to-color":jp,"to-number":jp,"to-string":jp,var:My,within:Rm,distance:r0,config:I0,split:Iv};function Dv(_,[o,g,_e,rt]){o=o.evaluate(_),g=g.evaluate(_),_e=_e.evaluate(_);const ot=rt?rt.evaluate(_):1,at=_g(o,g,_e,ot);if(at)throw new Gl(at);return new fo(o/255,g/255,_e/255,ot)}function Nv(_,[o,g,_e,rt]){o=o.evaluate(_),g=g.evaluate(_),_e=_e.evaluate(_);const ot=rt?rt.evaluate(_):1,at=function(gt,Ct,At,kt){return typeof gt=="number"&&gt>=0&&gt<=360?typeof Ct=="number"&&Ct>=0&&Ct<=100&&typeof At=="number"&&At>=0&&At<=100?kt===void 0||typeof kt=="number"&&kt>=0&&kt<=1?null:`Invalid hsla value [${[gt,Ct,At,kt].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof kt=="number"?[gt,Ct,At,kt]:[gt,Ct,At]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof kt=="number"?[gt,Ct,At,kt]:[gt,Ct,At]).join(", ")}]: 'h' must be between 0 and 360.`}(o,g,_e,ot);if(at)throw new Gl(at);const ut=`hsla(${o}, ${g}%, ${_e}%, ${ot})`,ft=fo.parse(ut);if(!ft)throw new Gl(`Failed to parse HSLA color: ${ut}`);return ft}function Sw(_,o){return _ in o}function Lv(_,o){const g=o[_];return g===void 0?null:g}function km(_){return{type:_}}function i0(_){if(_ instanceof I0)return new Set([_.key]);let o=new Set;return _.eachChild(g=>{o=new Set([...o,...i0(g)])}),o}function $y(_){if(_ instanceof Au&&_.name==="is-active-floor")return!0;let o=!1;return _.eachChild(g=>{!o&&$y(g)&&(o=!0)}),o}function Cw(_){return{result:"success",value:_}}function Mm(_){return{result:"error",value:_}}function Ov(_,o){return!!_&&!!_.parameters&&_.parameters.indexOf(o)>-1}function I_(_){return _["property-type"]==="data-driven"}function Aw(_){return Ov(_.expression,"measure-light")}function Rw(_){return Ov(_.expression,"zoom")}function Gy(_){return!!_.expression&&_.expression.interpolated}function Hy(_){return typeof _=="object"&&_!==null&&!Array.isArray(_)}function Iw(_){return _}function Pw(_,o){const g=o.type==="color",_e=_.stops&&typeof _.stops[0][0]=="object",rt=_e||!(_e||_.property!==void 0),ot=_.type||(Gy(o)?"exponential":"interval");if(g&&((_=Object.assign({},_)).stops&&(_.stops=_.stops.map(gt=>[gt[0],fo.parse(gt[1])])),_.default=fo.parse(_.default?_.default:o.default)),_.colorSpace&&_.colorSpace!=="rgb"&&!bw[_.colorSpace])throw new Error(`Unknown color space: ${_.colorSpace}`);let at,ut,ft;if(ot==="exponential")at=kw;else if(ot==="interval")at=mT;else if(ot==="categorical"){at=fT,ut=Object.create(null);for(const gt of _.stops)ut[gt[0]]=gt[1];ft=typeof _.stops[0][0]}else{if(ot!=="identity")throw new Error(`Unknown function type "${ot}"`);at=Mw}if(_e){const gt={},Ct=[];for(let zt=0;zt<_.stops.length;zt++){const Ut=_.stops[zt],Kt=Ut[0].zoom;gt[Kt]===void 0&&(gt[Kt]={zoom:Kt,type:_.type,property:_.property,default:_.default,stops:[]},Ct.push(Kt)),gt[Kt].stops.push([Ut[0].value,Ut[1]])}const At=[];for(const zt of Ct)At.push([gt[zt].zoom,Pw(gt[zt],o)]);const kt={name:"linear"};return{kind:"composite",interpolationType:kt,interpolationFactor:qu.interpolationFactor.bind(void 0,kt),zoomStops:At.map(zt=>zt[0]),evaluate:({zoom:zt},Ut)=>kw({stops:At,base:_.base},o,zt).evaluate(zt,Ut)}}if(rt){const gt=ot==="exponential"?{name:"exponential",base:_.base!==void 0?_.base:1}:null;return{kind:"camera",interpolationType:gt,interpolationFactor:qu.interpolationFactor.bind(void 0,gt),zoomStops:_.stops.map(Ct=>Ct[0]),evaluate:({zoom:Ct})=>at(_,o,Ct,ut,ft)}}return{kind:"source",evaluate(gt,Ct){const At=Ct&&Ct.properties?Ct.properties[_.property]:void 0;return At===void 0?Bp(_.default,o.default):at(_,o,At,ut,ft)}}}function Bp(_,o,g){return _!==void 0?_:o!==void 0?o:g!==void 0?g:void 0}function fT(_,o,g,_e,rt){return Bp(typeof g===rt?_e[g]:void 0,_.default,o.default)}function mT(_,o,g){if(!E0(g))return Bp(_.default,o.default);const _e=_.stops.length;if(_e===1||g<=_.stops[0][0])return _.stops[0][1];if(g>=_.stops[_e-1][0])return _.stops[_e-1][1];const rt=Ny(_.stops.map(ot=>ot[0]),g);return _.stops[rt][1]}function kw(_,o,g){const _e=_.base!==void 0?_.base:1;if(!E0(g))return Bp(_.default,o.default);const rt=_.stops.length;if(rt===1||g<=_.stops[0][0])return _.stops[0][1];if(g>=_.stops[rt-1][0])return _.stops[rt-1][1];const ot=Ny(_.stops.map(Ct=>Ct[0]),g),at=function(Ct,At,kt,zt){const Ut=zt-kt,Kt=Ct-kt;return Ut===0?0:At===1?Kt/Ut:(Math.pow(At,Kt)-1)/(Math.pow(At,Ut)-1)}(g,_e,_.stops[ot][0],_.stops[ot+1][0]),ut=_.stops[ot][1],ft=_.stops[ot+1][1];let gt=f_[o.type]||Iw;if(_.colorSpace&&_.colorSpace!=="rgb"){const Ct=bw[_.colorSpace];gt=(At,kt)=>Ct.reverse(Ct.interpolate(Ct.forward(At),Ct.forward(kt),at))}return typeof ut.evaluate=="function"?{evaluate(...Ct){const At=ut.evaluate.apply(void 0,Ct),kt=ft.evaluate.apply(void 0,Ct);if(At!==void 0&&kt!==void 0)return gt(At,kt,at)}}:gt(ut,ft,at)}function Mw(_,o,g){return o.type==="color"?g=fo.parse(g):o.type==="formatted"?g=Su.fromString(g.toString()):o.type==="resolvedImage"?g=Cu.build(g.toString()):es(g)===o.type||o.type==="enum"&&o.values[g]||(g=void 0),Bp(g,_.default,o.default)}Au.register(N0,{error:[{kind:"error"},[qs],(_,[o])=>{throw new Gl(o.evaluate(_))}],typeof:[qs,[po],(_,[o])=>Ml(Zl(o.evaluate(_)))],"to-rgba":[fu(is,4),[Nu],(_,[o])=>o.evaluate(_).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[fu(is,4),[Nu],(_,[o])=>o.evaluate(_).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Nu,[is,is,is],Dv],rgba:[Nu,[is,is,is,is],Dv],hsl:[Nu,[is,is,is],Nv],hsla:[Nu,[is,is,is,is],Nv],has:{type:yo,overloads:[[[qs],(_,[o])=>Sw(o.evaluate(_),_.properties())],[[qs,Lp],(_,[o,g])=>Sw(o.evaluate(_),g.evaluate(_))]]},get:{type:po,overloads:[[[qs],(_,[o])=>Lv(o.evaluate(_),_.properties())],[[qs,Lp],(_,[o,g])=>Lv(o.evaluate(_),g.evaluate(_))]]},"feature-state":[po,[qs],(_,[o])=>Lv(o.evaluate(_),_.featureState||{})],properties:[Lp,[],_=>_.properties()],"geometry-type":[qs,[],_=>_.geometryType()],worldview:[qs,[],_=>_.globals.worldview||""],"is-active-floor":[yo,km(qs),(_,o)=>{if(!(_.globals.activeFloors&&_.globals.activeFloors.size>0))return!1;const g=_.globals.activeFloors;return o.some(_e=>{const rt=_e.evaluate(_);return g.has(rt)})}],id:[po,[],_=>_.id()],zoom:[is,[],_=>_.globals.zoom],pitch:[is,[],_=>_.globals.pitch||0],"distance-from-center":[is,[],_=>_.distanceFromCenter()],"measure-light":[is,[qs],(_,[o])=>_.measureLight(o.evaluate(_))],"heatmap-density":[is,[],_=>_.globals.heatmapDensity||0],"line-progress":[is,[],_=>_.globals.lineProgress||0],"raster-value":[is,[],_=>_.globals.rasterValue||0],"raster-particle-speed":[is,[],_=>_.globals.rasterParticleSpeed||0],"sky-radial-progress":[is,[],_=>_.globals.skyRadialProgress||0],accumulated:[po,[],_=>_.globals.accumulated===void 0?null:_.globals.accumulated],"+":[is,km(is),(_,o)=>{let g=0;for(const _e of o)g+=_e.evaluate(_);return g}],"*":[is,km(is),(_,o)=>{let g=1;for(const _e of o)g*=_e.evaluate(_);return g}],"-":{type:is,overloads:[[[is,is],(_,[o,g])=>o.evaluate(_)-g.evaluate(_)],[[is],(_,[o])=>-o.evaluate(_)]]},"/":[is,[is,is],(_,[o,g])=>o.evaluate(_)/g.evaluate(_)],"%":[is,[is,is],(_,[o,g])=>o.evaluate(_)%g.evaluate(_)],ln2:[is,[],()=>Math.LN2],pi:[is,[],()=>Math.PI],e:[is,[],()=>Math.E],"^":[is,[is,is],(_,[o,g])=>Math.pow(o.evaluate(_),g.evaluate(_))],sqrt:[is,[is],(_,[o])=>Math.sqrt(o.evaluate(_))],log10:[is,[is],(_,[o])=>Math.log(o.evaluate(_))/Math.LN10],ln:[is,[is],(_,[o])=>Math.log(o.evaluate(_))],log2:[is,[is],(_,[o])=>Math.log2(o.evaluate(_))],sin:[is,[is],(_,[o])=>Math.sin(o.evaluate(_))],cos:[is,[is],(_,[o])=>Math.cos(o.evaluate(_))],tan:[is,[is],(_,[o])=>Math.tan(o.evaluate(_))],asin:[is,[is],(_,[o])=>Math.asin(o.evaluate(_))],acos:[is,[is],(_,[o])=>Math.acos(o.evaluate(_))],atan:[is,[is],(_,[o])=>Math.atan(o.evaluate(_))],min:[is,km(is),(_,o)=>Math.min(...o.map(g=>g.evaluate(_)))],max:[is,km(is),(_,o)=>Math.max(...o.map(g=>g.evaluate(_)))],abs:[is,[is],(_,[o])=>Math.abs(o.evaluate(_))],round:[is,[is],(_,[o])=>{const g=o.evaluate(_);return g<0?-Math.round(-g):Math.round(g)}],floor:[is,[is],(_,[o])=>Math.floor(o.evaluate(_))],ceil:[is,[is],(_,[o])=>Math.ceil(o.evaluate(_))],"filter-==":[yo,[qs,po],(_,[o,g])=>_.properties()[o.value]===g.value],"filter-id-==":[yo,[po],(_,[o])=>_.id()===o.value],"filter-type-==":[yo,[qs],(_,[o])=>_.geometryType()===o.value],"filter-<":[yo,[qs,po],(_,[o,g])=>{const _e=_.properties()[o.value],rt=g.value;return typeof _e==typeof rt&&_e<rt}],"filter-id-<":[yo,[po],(_,[o])=>{const g=_.id(),_e=o.value;return typeof g==typeof _e&&g<_e}],"filter->":[yo,[qs,po],(_,[o,g])=>{const _e=_.properties()[o.value],rt=g.value;return typeof _e==typeof rt&&_e>rt}],"filter-id->":[yo,[po],(_,[o])=>{const g=_.id(),_e=o.value;return typeof g==typeof _e&&g>_e}],"filter-<=":[yo,[qs,po],(_,[o,g])=>{const _e=_.properties()[o.value],rt=g.value;return typeof _e==typeof rt&&_e<=rt}],"filter-id-<=":[yo,[po],(_,[o])=>{const g=_.id(),_e=o.value;return typeof g==typeof _e&&g<=_e}],"filter->=":[yo,[qs,po],(_,[o,g])=>{const _e=_.properties()[o.value],rt=g.value;return typeof _e==typeof rt&&_e>=rt}],"filter-id->=":[yo,[po],(_,[o])=>{const g=_.id(),_e=o.value;return typeof g==typeof _e&&g>=_e}],"filter-has":[yo,[po],(_,[o])=>o.value in _.properties()],"filter-has-id":[yo,[],_=>_.id()!==null&&_.id()!==void 0],"filter-type-in":[yo,[fu(qs)],(_,[o])=>o.value.indexOf(_.geometryType())>=0],"filter-id-in":[yo,[fu(po)],(_,[o])=>o.value.indexOf(_.id())>=0],"filter-in-small":[yo,[qs,fu(po)],(_,[o,g])=>g.value.indexOf(_.properties()[o.value])>=0],"filter-in-large":[yo,[qs,fu(po)],(_,[o,g])=>function(_e,rt,ot,at){for(;ot<=at;){const ut=ot+at>>1;if(rt[ut]===_e)return!0;rt[ut]>_e?at=ut-1:ot=ut+1}return!1}(_.properties()[o.value],g.value,0,g.value.length-1)],all:{type:yo,overloads:[[[yo,yo],(_,[o,g])=>o.evaluate(_)&&g.evaluate(_)],[km(yo),(_,o)=>{for(const g of o)if(!g.evaluate(_))return!1;return!0}]]},any:{type:yo,overloads:[[[yo,yo],(_,[o,g])=>o.evaluate(_)||g.evaluate(_)],[km(yo),(_,o)=>{for(const g of o)if(g.evaluate(_))return!0;return!1}]]},"!":[yo,[yo],(_,[o])=>!o.evaluate(_)],"is-supported-script":[yo,[qs],(_,[o])=>{const g=_.globals&&_.globals.isSupportedScript;return!g||g(o.evaluate(_))}],upcase:[qs,[qs],(_,[o])=>o.evaluate(_).toUpperCase()],downcase:[qs,[qs],(_,[o])=>o.evaluate(_).toLowerCase()],concat:[qs,km(po),(_,o)=>o.map(g=>ap(g.evaluate(_))).join("")],"resolved-locale":[qs,[gy],(_,[o])=>o.evaluate(_).resolvedLocale()],random:[is,[is,is,po],(_,o)=>{const[g,_e,rt]=o.map(at=>at.evaluate(_));if(g>_e||g===_e)return g;let ot;if(typeof rt=="string")ot=function(at){let ut=0;if(at.length===0)return ut;for(let ft=0;ft<at.length;ft++)ut=(ut<<5)-ut+at.charCodeAt(ft),ut|=0;return ut}(rt);else{if(typeof rt!="number")throw new Gl(`Invalid seed input: ${rt}`);ot=rt}return g+Tw(ot)()*(_e-g)}]});class Wy{constructor(o,g,_e,rt,ot){this.expression=o,this._warningHistory={},this._scope=_e,this._options=rt,this._iconImageUseTheme=ot,this._evaluator=new by(_e,rt,ot),this._defaultValue=g?function(at){return at.type==="color"&&(Hy(at.default)||Array.isArray(at.default))?new fo(0,0,0,0):at.type==="color"?fo.parse(at.default)||null:at.default===void 0?null:at.default}(g):null,this._enumValues=g&&g.type==="enum"?g.values:null,this.configDependencies=i0(o),this.isIndoorDependent=$y(o)}evaluateWithoutErrorHandling(o,g,_e,rt,ot,at,ut,ft){return this._evaluator.globals=o,this._evaluator.feature=g,this._evaluator.featureState=_e,this._evaluator.canonical=rt||null,this._evaluator.availableImages=ot||null,this._evaluator.formattedSection=at,this._evaluator.featureTileCoord=ut||null,this._evaluator.featureDistanceData=ft||null,this.expression.evaluate(this._evaluator)}evaluate(o,g,_e,rt,ot,at,ut,ft,gt){this._evaluator||(this._evaluator=new by(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=o,this._evaluator.feature=g||null,this._evaluator.featureState=_e||null,this._evaluator.canonical=rt||null,this._evaluator.availableImages=ot||null,this._evaluator.formattedSection=at||null,this._evaluator.featureTileCoord=ut||null,this._evaluator.featureDistanceData=ft||null,this._evaluator.iconImageUseTheme=gt||null;try{const Ct=this.expression.evaluate(this._evaluator);if(Ct==null||typeof Ct=="number"&&Ct!=Ct)return this._defaultValue;if(this._enumValues&&!(Ct in this._enumValues))throw new Gl(`Expected value to be one of ${Object.keys(this._enumValues).map(At=>JSON.stringify(At)).join(", ")}, but found ${JSON.stringify(Ct)} instead.`);return Ct}catch(Ct){const At=Ct;return this._warningHistory[At.message]||(this._warningHistory[At.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${At.message}`)),this._defaultValue}}}function P_(_){return Array.isArray(_)&&_.length>0&&typeof _[0]=="string"&&_[0]in N0}function Dm(_,o,g,_e,rt){const ot=new Dy(N0,[],o?function(ut){const ft={color:Nu,string:qs,number:is,enum:qs,boolean:yo,formatted:m_,resolvedImage:g_};return ut.type==="array"?fu(ft[ut.value]||po,ut.length):ft[ut.type]}(o):void 0,void 0,void 0,g,_e,rt),at=ot.parse(_,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return at?Cw(new Wy(at,o,g,_e,rt)):Mm(ot.errors)}class L0{constructor(o,g,_e,rt){this.kind=o,this._styleExpression=g,this.isLightConstant=_e,this.isLineProgressConstant=rt,this.isStateDependent=o!=="constant"&&!E_(g.expression),this.configDependencies=i0(g.expression),this.isIndoorDependent=$y(g.expression)}evaluateWithoutErrorHandling(o,g,_e,rt,ot,at){return this._styleExpression.evaluateWithoutErrorHandling(o,g,_e,rt,ot,at)}evaluate(o,g,_e,rt,ot,at,ut){return this._styleExpression.evaluate(o,g,_e,rt,ot,at,void 0,void 0,ut)}}class n0{constructor(o,g,_e,rt,ot,at){this.kind=o,this.zoomStops=_e,this._styleExpression=g,this.isStateDependent=o!=="camera"&&!E_(g.expression),this.isIndoorDependent=$y(g.expression),this.isLightConstant=ot,this.isLineProgressConstant=at,this.configDependencies=i0(g.expression),this.interpolationType=rt}evaluateWithoutErrorHandling(o,g,_e,rt,ot,at){return this._styleExpression.evaluateWithoutErrorHandling(o,g,_e,rt,ot,at)}evaluate(o,g,_e,rt,ot,at){return this._styleExpression.evaluate(o,g,_e,rt,ot,at)}interpolationFactor(o,g,_e){return this.interpolationType?qu.interpolationFactor(this.interpolationType,o,g,_e):0}}function jv(_,o,g,_e,rt){if((_=Dm(_,o,g,_e,rt)).result==="error")return _;const ot=_.value.expression,at=A0(ot);if(!at&&!I_(o))return Mm([new sp("","data expressions not supported")]);const ut=R0(ot,["zoom","pitch","distance-from-center"]);if(!ut&&!Rw(o))return Mm([new sp("","zoom expressions not supported")]);const ft=R0(ot,["measure-light"]);if(!ft&&!Aw(o))return Mm([new sp("","measure-light expression not supported")]);const gt=R0(ot,["line-progress"]);if(!gt&&!function(kt){return Ov(kt.expression,"line-progress")}(o))return Mm([new sp("","line-progress expression not supported")]);const Ct=o.expression&&o.expression.relaxZoomRestriction,At=wp(ot);return At||ut||Ct?At instanceof sp?Mm([At]):At instanceof qu&&!Gy(o)?Mm([new sp("",'"interpolate" expressions cannot be used with this property')]):Cw(At?new n0(at&&gt?"camera":"composite",_.value,At.labels,At instanceof qu?At.interpolation:void 0,ft,gt):new L0(at&&gt?"constant":"source",_.value,ft,gt)):Mm([new sp("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class qy{constructor(o,g){this._parameters=o,this._specification=g,Object.assign(this,Pw(this._parameters,this._specification))}static deserialize(o){return new qy(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function wp(_){let o=null;if(_ instanceof Jp)o=wp(_.result);else if(_ instanceof C_){for(const g of _.args)if(o=wp(g),o)break}else(_ instanceof T_||_ instanceof qu)&&_.input instanceof Au&&_.input.name==="zoom"&&(o=_);return o instanceof sp||_.eachChild(g=>{const _e=wp(g);_e instanceof sp?o=_e:o&&_e&&o!==_e&&(o=new sp("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}var Fv,Dw,Nw=function(){if(Dw)return Fv;Dw=1,Fv=o;var _=3;function o(g,_e,rt){var ot=this.cells=[];if(g instanceof ArrayBuffer){this.arrayBuffer=g;var at=new Int32Array(this.arrayBuffer);g=at[0],this.d=(_e=at[1])+2*(rt=at[2]);for(var ut=0;ut<this.d*this.d;ut++){var ft=at[_+ut],gt=at[_+ut+1];ot.push(ft===gt?null:at.subarray(ft,gt))}var Ct=at[_+ot.length+1];this.keys=at.subarray(at[_+ot.length],Ct),this.bboxes=at.subarray(Ct),this.insert=this._insertReadonly}else{this.d=_e+2*rt;for(var At=0;At<this.d*this.d;At++)ot.push([]);this.keys=[],this.bboxes=[]}this.n=_e,this.extent=g,this.padding=rt,this.scale=_e/g,this.uid=0;var kt=rt/_e*g;this.min=-kt,this.max=g+kt}return o.prototype.insert=function(g,_e,rt,ot,at){this._forEachCell(_e,rt,ot,at,this._insertCell,this.uid++),this.keys.push(g),this.bboxes.push(_e),this.bboxes.push(rt),this.bboxes.push(ot),this.bboxes.push(at)},o.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},o.prototype._insertCell=function(g,_e,rt,ot,at,ut){this.cells[at].push(ut)},o.prototype.query=function(g,_e,rt,ot,at){var ut=this.min,ft=this.max;if(g<=ut&&_e<=ut&&ft<=rt&&ft<=ot&&!at)return Array.prototype.slice.call(this.keys);var gt=[];return this._forEachCell(g,_e,rt,ot,this._queryCell,gt,{},at),gt},o.prototype._queryCell=function(g,_e,rt,ot,at,ut,ft,gt){var Ct=this.cells[at];if(Ct!==null)for(var At=this.keys,kt=this.bboxes,zt=0;zt<Ct.length;zt++){var Ut=Ct[zt];if(ft[Ut]===void 0){var Kt=4*Ut;(gt?gt(kt[Kt+0],kt[Kt+1],kt[Kt+2],kt[Kt+3]):g<=kt[Kt+2]&&_e<=kt[Kt+3]&&rt>=kt[Kt+0]&&ot>=kt[Kt+1])?(ft[Ut]=!0,ut.push(At[Ut])):ft[Ut]=!1}}},o.prototype._forEachCell=function(g,_e,rt,ot,at,ut,ft,gt){for(var Ct=this._convertToCellCoord(g),At=this._convertToCellCoord(_e),kt=this._convertToCellCoord(rt),zt=this._convertToCellCoord(ot),Ut=Ct;Ut<=kt;Ut++)for(var Kt=At;Kt<=zt;Kt++){var er=this.d*Kt+Ut;if((!gt||gt(this._convertFromCellCoord(Ut),this._convertFromCellCoord(Kt),this._convertFromCellCoord(Ut+1),this._convertFromCellCoord(Kt+1)))&&at.call(this,g,_e,rt,ot,er,ut,ft,gt))return}},o.prototype._convertFromCellCoord=function(g){return(g-this.padding)/this.scale},o.prototype._convertToCellCoord=function(g){return Math.max(0,Math.min(this.d-1,Math.floor(g*this.scale)+this.padding))},o.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var g=this.cells,_e=_+this.cells.length+1+1,rt=0,ot=0;ot<this.cells.length;ot++)rt+=this.cells[ot].length;var at=new Int32Array(_e+rt+this.keys.length+this.bboxes.length);at[0]=this.extent,at[1]=this.n,at[2]=this.padding;for(var ut=_e,ft=0;ft<g.length;ft++){var gt=g[ft];at[_+ft]=ut,at.set(gt,ut),ut+=gt.length}return at[_+g.length]=ut,at.set(this.keys,ut),at[_+g.length+1]=ut+=this.keys.length,at.set(this.bboxes,ut),ut+=this.bboxes.length,at.buffer},Fv}(),O0=Oo(Nw);const s0={};function qn(_,o,g={}){Object.defineProperty(_,"_classRegistryKey",{value:o,writable:!1}),s0[o]={klass:_,omit:g.omit||[]}}qn(Object,"Object"),O0.serialize=function(_,o){const g=_.toArrayBuffer();return o&&o.add(g),{buffer:g}},O0.deserialize=function(_){return new O0(_.buffer)},Object.defineProperty(O0,"name",{value:"Grid"}),qn(O0,"Grid"),delete mn.prototype.constructor,qn(fo,"Color"),qn(Error,"Error"),qn(Su,"Formatted"),qn(yy,"FormattedSection"),qn(zu,"AJAXError"),qn(Cu,"ResolvedImage"),qn(qy,"StylePropertyFunction"),qn(Wy,"StyleExpression",{omit:["_evaluator"]}),qn(wu,"ImageId"),qn(Zp,"ImageVariant"),qn(n0,"ZoomDependentExpression"),qn(L0,"ZoomConstantExpression"),qn(Au,"CompoundExpression",{omit:["_evaluate"]});for(const _ in N0)s0[N0[_]._classRegistryKey]||qn(N0[_],`Expression${_}`);function k_(_){return _&&(_ instanceof ArrayBuffer||_.constructor&&_.constructor.name==="ArrayBuffer")}function _f(_,o){if(_==null||typeof _=="boolean"||typeof _=="number"||typeof _=="string"||_ instanceof Boolean||_ instanceof Number||_ instanceof String||_ instanceof Date||_ instanceof RegExp)return _;if(k_(_)||_ instanceof ImageBitmap)return o&&o.add(_),_;if(ArrayBuffer.isView(_))return o&&o.add(_.buffer),_;if(_ instanceof ImageData)return o&&o.add(_.data.buffer),_;if(Array.isArray(_)){const g=[];for(const _e of _)g.push(_f(_e,o));return g}if(_ instanceof Map){const g={$name:"Map",entries:[]};for(const[_e,rt]of _.entries())g.entries.push(_f(_e),_f(rt,o));return g}if(_ instanceof Set){const g={$name:"Set"};let _e=0;for(const rt of _.values())g[++_e]=_f(rt);return g}if(typeof _=="bigint")return{$name:"BigInt",value:_.toString()};if(typeof _=="object"){const g=_.constructor,_e=g._classRegistryKey;if(!_e)throw new Error(`Can't serialize object of unregistered class "${g.name}".`);const rt=g.serialize?g.serialize(_,o):{};if(!g.serialize){for(const ot in _)_.hasOwnProperty(ot)&&(s0[_e].omit.indexOf(ot)>=0||(rt[ot]=_f(_[ot],o)));_ instanceof Error&&(rt.message=_.message)}if(rt.$name)throw new Error("$name property is reserved for worker serialization logic.");return _e!=="Object"&&(rt.$name=_e),rt}throw new Error("can't serialize object of type "+typeof _)}function Nm(_){if(_==null||typeof _=="boolean"||typeof _=="number"||typeof _=="string"||_ instanceof Boolean||_ instanceof Number||_ instanceof String||_ instanceof Date||_ instanceof RegExp||k_(_)||_ instanceof ImageBitmap||ArrayBuffer.isView(_)||_ instanceof ImageData)return _;if(Array.isArray(_))return _.map(Nm);if(typeof _=="object"){const o=_.$name||"Object";if(o==="Map"){const rt=_.entries||[],ot=new Map;for(let at=0;at<rt.length;at+=2)ot.set(Nm(rt[at]),Nm(rt[at+1]));return ot}if(o==="Set"){const rt=new Set;for(const ot of Object.keys(_))ot!=="$name"&&rt.add(Nm(_[ot]));return rt}if(o==="BigInt")return BigInt(_.value);const{klass:g}=s0[o];if(!g)throw new Error(`Can't deserialize unregistered class "${o}".`);if(g.deserialize)return g.deserialize(_);const _e=Object.create(g.prototype);for(const rt of Object.keys(_))rt!=="$name"&&(_e[rt]=Nm(_[rt]));return _e}throw new Error("can't deserialize object of type "+typeof _)}const cs={"Latin-1 Supplement":_=>_>=128&&_<=255,Arabic:_=>_>=1536&&_<=1791,"Arabic Supplement":_=>_>=1872&&_<=1919,"Arabic Extended-A":_=>_>=2208&&_<=2303,"Hangul Jamo":_=>_>=4352&&_<=4607,"Unified Canadian Aboriginal Syllabics":_=>_>=5120&&_<=5759,Khmer:_=>_>=6016&&_<=6143,"Unified Canadian Aboriginal Syllabics Extended":_=>_>=6320&&_<=6399,"General Punctuation":_=>_>=8192&&_<=8303,"Letterlike Symbols":_=>_>=8448&&_<=8527,"Number Forms":_=>_>=8528&&_<=8591,"Miscellaneous Technical":_=>_>=8960&&_<=9215,"Control Pictures":_=>_>=9216&&_<=9279,"Optical Character Recognition":_=>_>=9280&&_<=9311,"Enclosed Alphanumerics":_=>_>=9312&&_<=9471,"Geometric Shapes":_=>_>=9632&&_<=9727,"Miscellaneous Symbols":_=>_>=9728&&_<=9983,"Miscellaneous Symbols and Arrows":_=>_>=11008&&_<=11263,"CJK Radicals Supplement":_=>_>=11904&&_<=12031,"Kangxi Radicals":_=>_>=12032&&_<=12255,"Ideographic Description Characters":_=>_>=12272&&_<=12287,"CJK Symbols and Punctuation":_=>_>=12288&&_<=12351,Hiragana:_=>_>=12352&&_<=12447,Katakana:_=>_>=12448&&_<=12543,Bopomofo:_=>_>=12544&&_<=12591,"Hangul Compatibility Jamo":_=>_>=12592&&_<=12687,Kanbun:_=>_>=12688&&_<=12703,"Bopomofo Extended":_=>_>=12704&&_<=12735,"CJK Strokes":_=>_>=12736&&_<=12783,"Katakana Phonetic Extensions":_=>_>=12784&&_<=12799,"Enclosed CJK Letters and Months":_=>_>=12800&&_<=13055,"CJK Compatibility":_=>_>=13056&&_<=13311,"CJK Unified Ideographs Extension A":_=>_>=13312&&_<=19903,"Yijing Hexagram Symbols":_=>_>=19904&&_<=19967,"CJK Unified Ideographs":_=>_>=19968&&_<=40959,"Yi Syllables":_=>_>=40960&&_<=42127,"Yi Radicals":_=>_>=42128&&_<=42191,"Hangul Jamo Extended-A":_=>_>=43360&&_<=43391,"Hangul Syllables":_=>_>=44032&&_<=55215,"Hangul Jamo Extended-B":_=>_>=55216&&_<=55295,"Private Use Area":_=>_>=57344&&_<=63743,"CJK Compatibility Ideographs":_=>_>=63744&&_<=64255,"Arabic Presentation Forms-A":_=>_>=64336&&_<=65023,"Vertical Forms":_=>_>=65040&&_<=65055,"CJK Compatibility Forms":_=>_>=65072&&_<=65103,"Small Form Variants":_=>_>=65104&&_<=65135,"Arabic Presentation Forms-B":_=>_>=65136&&_<=65279,"Halfwidth and Fullwidth Forms":_=>_>=65280&&_<=65519,Osage:_=>_>=66736&&_<=66815,"CJK Unified Ideographs Extension B":_=>_>=131072&&_<=173791};function M_(_){for(const o of _)if(Ky(o.charCodeAt(0)))return!0;return!1}function Bv(_){for(const o of _)if(!Lw(o.charCodeAt(0)))return!1;return!0}function Lw(_){return!(cs.Arabic(_)||cs["Arabic Supplement"](_)||cs["Arabic Extended-A"](_)||cs["Arabic Presentation Forms-A"](_)||cs["Arabic Presentation Forms-B"](_))}function Ky(_){return!(_!==746&&_!==747&&(_<4352||!(cs["Bopomofo Extended"](_)||cs.Bopomofo(_)||cs["CJK Compatibility Forms"](_)&&!(_>=65097&&_<=65103)||cs["CJK Compatibility Ideographs"](_)||cs["CJK Compatibility"](_)||cs["CJK Radicals Supplement"](_)||cs["CJK Strokes"](_)||!(!cs["CJK Symbols and Punctuation"](_)||_>=12296&&_<=12305||_>=12308&&_<=12319||_===12336)||cs["CJK Unified Ideographs Extension A"](_)||cs["CJK Unified Ideographs"](_)||cs["Enclosed CJK Letters and Months"](_)||cs["Hangul Compatibility Jamo"](_)||cs["Hangul Jamo Extended-A"](_)||cs["Hangul Jamo Extended-B"](_)||cs["Hangul Jamo"](_)||cs["Hangul Syllables"](_)||cs.Hiragana(_)||cs["Ideographic Description Characters"](_)||cs.Kanbun(_)||cs["Kangxi Radicals"](_)||cs["Katakana Phonetic Extensions"](_)||cs.Katakana(_)&&_!==12540||!(!cs["Halfwidth and Fullwidth Forms"](_)||_===65288||_===65289||_===65293||_>=65306&&_<=65310||_===65339||_===65341||_===65343||_>=65371&&_<=65503||_===65507||_>=65512&&_<=65519)||!(!cs["Small Form Variants"](_)||_>=65112&&_<=65118||_>=65123&&_<=65126)||cs["Unified Canadian Aboriginal Syllabics"](_)||cs["Unified Canadian Aboriginal Syllabics Extended"](_)||cs["Vertical Forms"](_)||cs["Yijing Hexagram Symbols"](_)||cs["Yi Syllables"](_)||cs["Yi Radicals"](_))))}function Xy(_){return!(Ky(_)||function(o){return!!(cs["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||cs["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||cs["Letterlike Symbols"](o)||cs["Number Forms"](o)||cs["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||cs["Control Pictures"](o)&&o!==9251||cs["Optical Character Recognition"](o)||cs["Enclosed Alphanumerics"](o)||cs["Geometric Shapes"](o)||cs["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||cs["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||cs["CJK Symbols and Punctuation"](o)||cs.Katakana(o)||cs["Private Use Area"](o)||cs["CJK Compatibility Forms"](o)||cs["Small Form Variants"](o)||cs["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(_))}function Zy(_){return cs.Arabic(_)||cs["Arabic Supplement"](_)||cs["Arabic Extended-A"](_)||cs["Arabic Presentation Forms-A"](_)||cs["Arabic Presentation Forms-B"](_)}function zv(_){return _>=1424&&_<=2303||cs["Arabic Presentation Forms-A"](_)||cs["Arabic Presentation Forms-B"](_)}function em(_,o){return!(!o&&zv(_)||_>=2304&&_<=3583||_>=3840&&_<=4255||cs.Khmer(_))}function gT(_){for(const o of _)if(zv(o.charCodeAt(0)))return!0;return!1}const Vu={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Vv=null,Ru=Vu.unavailable,tm=null;const D_=function(_){_&&typeof _=="string"&&_.indexOf("NetworkError")>-1&&(Ru=Vu.error),Vv&&Vv(_)};function Yy(){Qy.fire(new Np("pluginStateChange",{pluginStatus:Ru,pluginURL:tm}))}const Qy=new Jm,N_=function(){return Ru},Ow=function(){if(Ru!==Vu.deferred||!tm)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ru=Vu.loading,Yy(),tm&&Xp({url:tm},_=>{_?D_(_):(Ru=Vu.loaded,Yy())})},rm={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ru===Vu.loaded||rm.applyArabicShaping!=null,isLoading:()=>Ru===Vu.loading,setState(_){Ru=_.pluginStatus,tm=_.pluginURL},isParsing:()=>Ru===Vu.parsing,isParsed:()=>Ru===Vu.parsed,getPluginURL:()=>tm};class Do{constructor(o,g){this.zoom=o,g?(this.now=g.now,this.fadeDuration=g.fadeDuration,this.transition=g.transition,this.pitch=g.pitch,this.brightness=g.brightness,this.worldview=g.worldview,this.activeFloors=g.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(o){return function(g,_e){for(const rt of g)if(!em(rt.charCodeAt(0),_e))return!1;return!0}(o,rm.isLoaded())}}class Jy{constructor(o,g,_e,rt,ot){this.property=o,this.value=g,this.expression=function(at,ut,ft,gt,Ct){if(Hy(at))return new qy(at,ut);if(P_(at)||Array.isArray(at)&&at.length>0){const At=jv(at,ut,ft,gt,Ct);if(At.result==="error")throw new Error(At.value.map(kt=>`${kt.key}: ${kt.message}`).join(", "));return At.value}{let At=at;return typeof at=="string"&&ut.type==="color"&&(At=fo.parse(at)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>At}}}(g===void 0?o.specification.default:g,o.specification,_e,rt,ot)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,g,_e,rt){return this.property.possiblyEvaluate(this,o,g,_e,rt)}}class Uv{constructor(o,g,_e,rt){this.property=o,this.value=new Jy(o,void 0,g,_e,rt)}transitioned(o,g){return new Fw(this.property,this.value,g,Object.assign({},o.transition,this.transition),o.now)}untransitioned(){return new Fw(this.property,this.value,null,{},0)}}class jw{constructor(o,g,_e,rt){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues),this._scope=g,this._options=_e,this._iconImageUseTheme=rt,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(o){return hn(this._values[o].value.value)}setValue(o,g){this._values.hasOwnProperty(o)||(this._values[o]=new Uv(this._values[o].property,this._scope,this._options,this._iconImageUseTheme)),this._values[o].value=new Jy(this._values[o].property,g===null?void 0:hn(g),this._scope,this._options,this._iconImageUseTheme),this._values[o].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[o].value.isIndoorDependent())}setTransitionOrValue(o,g){g&&(this._options=g);const _e=this._properties.properties;if(o)for(const rt in o){const ot=o[rt];if(rt.endsWith("-transition")){const at=rt.slice(0,-11);_e[at]&&this.setTransition(at,ot)}else _e.hasOwnProperty(rt)&&this.setValue(rt,ot)}}getTransition(o){return hn(this._values[o].transition)}setTransition(o,g){this._values.hasOwnProperty(o)||(this._values[o]=new Uv(this._values[o].property)),this._values[o].transition=hn(g)||void 0}serialize(){const o={};for(const g of Object.keys(this._values)){const _e=this.getValue(g);_e!==void 0&&(o[g]=_e);const rt=this.getTransition(g);rt!==void 0&&(o[`${g}-transition`]=rt)}return o}transitioned(o,g){const _e=new Bw(this._properties);for(const rt of Object.keys(this._values))_e._values[rt]=this._values[rt].transitioned(o,g._values[rt]);return _e}untransitioned(){const o=new Bw(this._properties);for(const g of Object.keys(this._values))o._values[g]=this._values[g].untransitioned();return o}isIndoorDependent(){return this._isIndoorDependent}}class Fw{constructor(o,g,_e,rt,ot){const at=rt.delay||0,ut=rt.duration||0;ot=ot||0,this.property=o,this.value=g,this.begin=ot+at,this.end=this.begin+ut,o.specification.transition&&(rt.delay||rt.duration)&&(this.prior=_e)}possiblyEvaluate(o,g,_e){const rt=o.now||0,ot=this.value.possiblyEvaluate(o,g,_e),at=this.prior;if(at){if(rt>this.end)return this.prior=null,ot;if(this.value.isDataDriven())return this.prior=null,ot;if(rt<this.begin)return at.possiblyEvaluate(o,g,_e);{const ut=(rt-this.begin)/(this.end-this.begin);return this.property.interpolate(at.possiblyEvaluate(o,g,_e),ot,qm(ut))}}return ot}}class Bw{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,g,_e){const rt=new a0(this._properties);for(const ot of Object.keys(this._values))rt._values[ot]=this._values[ot].possiblyEvaluate(o,g,_e);return rt}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class zw{constructor(o,g,_e,rt){this._properties=o,this._values=Object.create(o.defaultPropertyValues),this._scope=g,this._options=_e,this._iconImageUseTheme=rt,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(o){return hn(this._values[o].value)}setValue(o,g){this._values[o]=new Jy(this._values[o].property,g===null?void 0:hn(g),this._scope,this._options,this._iconImageUseTheme),this._values[o].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[o].isIndoorDependent())}serialize(){const o={};for(const g of Object.keys(this._values)){const _e=this.getValue(g);_e!==void 0&&(o[g]=_e)}return o}possiblyEvaluate(o,g,_e,rt){const ot=new a0(this._properties);for(const at of Object.keys(this._values))ot._values[at]=this._values[at].possiblyEvaluate(o,g,_e,rt);return ot}isIndoorDependent(){return this._isIndoorDependent}}class o0{constructor(o,g,_e,rt){this.property=o,this.value=g,this.parameters=_e,this.iconImageUseTheme=rt}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,g,_e,rt){return this.property.evaluate(this.value,this.parameters,o,g,_e,rt,this.iconImageUseTheme)}}class a0{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class Pn{constructor(o){this.specification=o}possiblyEvaluate(o,g){return o.expression.evaluate(g)}interpolate(o,g,_e){const rt=f_[this.specification.type];return rt?rt(o,g,_e):o}}class On{constructor(o,g){this.specification=o,this.overrides=g}possiblyEvaluate(o,g,_e,rt,ot){return o.expression.kind==="constant"||o.expression.kind==="camera"?new o0(this,{kind:"constant",value:o.expression.evaluate(g,null,{},_e,rt,void 0,ot)},g):new o0(this,o.expression,g,ot)}interpolate(o,g,_e){if(o.value.kind!=="constant"||g.value.kind!=="constant")return o;if(o.value.value===void 0||g.value.value===void 0)return new o0(this,{kind:"constant",value:void 0},o.parameters);const rt=f_[this.specification.type];return rt?new o0(this,{kind:"constant",value:rt(o.value.value,g.value.value,_e)},o.parameters):o}evaluate(o,g,_e,rt,ot,at,ut){return o.kind==="constant"?o.value:o.evaluate(g,_e,rt,ot,at,void 0,ut)}}class l0{constructor(o){this.specification=o}possiblyEvaluate(o,g,_e,rt){return!!o.expression.evaluate(g,null,{},_e,rt)}interpolate(){return!1}}class ga{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const g=new Do(0,{});for(const _e in o){const rt=o[_e];rt.specification.overridable&&this.overridableProperties.push(_e);const ot=this.defaultPropertyValues[_e]=new Jy(rt,void 0),at=this.defaultTransitionablePropertyValues[_e]=new Uv(rt);this.defaultTransitioningPropertyValues[_e]=at.untransitioned(),this.defaultPossiblyEvaluatedValues[_e]=ot.possiblyEvaluate(g)}}}qn(On,"DataDrivenProperty"),qn(Pn,"DataConstantProperty"),qn(l0,"ColorRampProperty");var Gr=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Vw(_){return _ instanceof Number||_ instanceof String||_ instanceof Boolean?_.valueOf():_}function ex(_){if(Array.isArray(_))return _.map(ex);if(_ instanceof Object&&!(_ instanceof Number||_ instanceof String||_ instanceof Boolean)){const o={};for(const g in _)o[g]=ex(_[g]);return o}return Vw(_)}function zp(_){if(_===!0||_===!1)return!0;if(!Array.isArray(_)||_.length===0)return!1;switch(_[0]){case"has":return _.length>=2&&_[1]!=="$id"&&_[1]!=="$type";case"in":return _.length>=3&&(typeof _[1]!="string"||Array.isArray(_[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return _.length!==3||Array.isArray(_[1])||Array.isArray(_[2]);case"any":case"all":for(const o of _.slice(1))if(!zp(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}function tx(_,o="",g=null,_e="fill"){if(_==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};zp(_)||(_=rx(_));const rt=_;let ot=!0;try{ot=function(Ct){if(!j0(Ct))return Ct;let At=ex(Ct);return Uw(At),At=c0(At),At}(rt)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(rt,null,2)}
        `)}let at=null,ut=null;if(_e!=="background"&&_e!=="sky"&&_e!=="slot"){ut=Gr[`filter_${_e}`];const Ct=Dm(ot,ut,o,g);if(Ct.result==="error")throw new Error(Ct.value.map(At=>`${At.key}: ${At.message}`).join(", "));at=(At,kt,zt)=>Ct.value.evaluate(At,kt,{},zt)}let ft=null,gt=null;if(ot!==rt){const Ct=Dm(rt,ut,o,g);if(Ct.result==="error")throw new Error(Ct.value.map(At=>`${At.key}: ${At.message}`).join(", "));ft=(At,kt,zt,Ut,Kt)=>Ct.value.evaluate(At,kt,{},zt,void 0,void 0,Ut,Kt),gt=!A0(Ct.value.expression)}return{filter:at,dynamicFilter:ft||void 0,needGeometry:$w(ot),needFeature:!!gt}}function c0(_){if(!Array.isArray(_))return _;const o=function(g){if(_T.has(g[0])){for(let _e=1;_e<g.length;_e++)if(j0(g[_e]))return!0}return g}(_);return o===!0?o:o.map(g=>c0(g))}function Uw(_){let o=!1;const g=[];if(_[0]==="case"){for(let _e=1;_e<_.length-1;_e+=2)o=o||j0(_[_e]),g.push(_[_e+1]);g.push(_[_.length-1])}else if(_[0]==="match"){o=o||j0(_[1]);for(let _e=2;_e<_.length-1;_e+=2)g.push(_[_e+1]);g.push(_[_.length-1])}else if(_[0]==="step"){o=o||j0(_[1]);for(let _e=1;_e<_.length-1;_e+=2)g.push(_[_e+1])}o&&(_.length=0,_.push("any",...g));for(let _e=1;_e<_.length;_e++)Uw(_[_e])}function j0(_){if(!Array.isArray(_))return!1;if((o=_[0])==="pitch"||o==="distance-from-center")return!0;var o;for(let g=1;g<_.length;g++)if(j0(_[g]))return!0;return!1}const _T=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function yT(_,o){return _<o?-1:_>o?1:0}function $w(_){if(!Array.isArray(_))return!1;if(_[0]==="within"||_[0]==="distance")return!0;for(let o=1;o<_.length;o++)if($w(_[o]))return!0;return!1}function rx(_){if(!_)return!0;const o=_[0];return _.length<=1?o!=="any":o==="=="?ix(_[1],_[2],"=="):o==="!="?L_(ix(_[1],_[2],"==")):o==="<"||o===">"||o==="<="||o===">="?ix(_[1],_[2],o):o==="any"?(g=_.slice(1),["any"].concat(g.map(rx))):o==="all"?["all"].concat(_.slice(1).map(rx)):o==="none"?["all"].concat(_.slice(1).map(rx).map(L_)):o==="in"?nx(_[1],_.slice(2)):o==="!in"?L_(nx(_[1],_.slice(2))):o==="has"?sx(_[1]):o!=="!has"||L_(sx(_[1]));var g}function ix(_,o,g){switch(_){case"$type":return[`filter-type-${g}`,o];case"$id":return[`filter-id-${g}`,o];default:return[`filter-${g}`,_,o]}}function nx(_,o){if(o.length===0)return!1;switch(_){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(g=>typeof g!=typeof o[0])?["filter-in-large",_,["literal",o.sort(yT)]]:["filter-in-small",_,["literal",o]]}}function sx(_){switch(_){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",_]}}function L_(_){return["!",_]}const u0="";function Ep(_,o){return o?`${_}${u0}${o}`:_}let Gw;const Hw=()=>Gw||(Gw=new ga({"icon-size":new On(Gr.layout_symbol["icon-size"]),"icon-image":new On(Gr.layout_symbol["icon-image"]),"icon-rotate":new On(Gr.layout_symbol["icon-rotate"]),"icon-offset":new On(Gr.layout_symbol["icon-offset"]),"text-size":new On(Gr.layout_symbol["text-size"]),"text-rotate":new On(Gr.layout_symbol["text-rotate"]),"text-offset":new On(Gr.layout_symbol["text-offset"])}));class Ww{constructor(o,g,_e,rt,ot,at){const ut=Dm(o,Gr.appearance.condition);if(ut.result==="success"&&(this.condition=ut.value),this.name=g,_e){this.properties=new a0(Hw()),this.unevaluatedLayout=new zw(Hw(),rt,ot,at);for(const ft in _e)this.unevaluatedLayout.setValue(ft,_e[ft])}}isActive(o){return!(this.condition||!o.isHidden||this.name!=="hidden")||this.condition.evaluate(o.globals,o.feature,o.featureState,o.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(o){return this.properties.get(o)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(o){return this.unevaluatedLayout._values[o]}recalculate(o,g,_e){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(o,void 0,g,_e))}serialize(){const o={};return o.condition=this.condition.expression.serialize(),this.name&&(o.name=this.name),this.unevaluatedLayout&&(o.properties=this.unevaluatedLayout.serialize()),o}hasIconProperties(){const o=this.hasProperty("icon-image"),g=this.hasProperty("icon-size"),_e=this.hasProperty("icon-offset"),rt=this.hasProperty("icon-rotate");return o||g||_e||rt}hasTextProperties(){const o=this.hasProperty("text-size"),g=this.hasProperty("text-offset"),_e=this.hasProperty("text-rotate");return o||g||_e}hasProperty(o){return this.getUnevaluatedProperty(o).value!==void 0}}const qw="-transition",Vp=new Set(["fill","line","background","hillshade","raster"]);class Iu extends Jm{constructor(o,g,_e,rt,ot,at){if(super(),this.id=o.id,this.fqid=Ep(this.id,_e),this.type=o.type,this.scope=_e,this.lut=rt,this.options=ot,this.iconImageUseTheme=at,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},o.type!=="custom"){if(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type&&o.type!=="background"&&o.type!=="sky"&&o.type!=="slot"){this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter;const ut=Dm(this.filter,Gr[`filter_${o.type}`]);ut.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...ut.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||ut.value.isIndoorDependent)}if(o.slot&&(this.slot=o.slot),o.appearances&&this.setAppearances(o.appearances),g.layout&&(this._unevaluatedLayout=new zw(g.layout,this.scope,ot,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),g.paint){this._transitionablePaint=new jw(g.paint,this.scope,ot);for(const ut in o.paint)this.setPaintProperty(ut,o.paint[ut]);for(const ut in o.layout)this.setLayoutProperty(ut,o.layout[ut]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new a0(g.paint)}}}onAdd(o){}onRemove(o){}isDraped(o){return!this.is3D(!0)&&Vp.has(this.type)}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,g){if(this.type==="custom"&&o==="visibility")return void(this.visibility=g);const _e=this._unevaluatedLayout;_e._properties.properties[o]&&(_e.setValue(o,g),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,..._e.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||_e.isIndoorDependent(),o==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(o){this.appearances=[],o.forEach(g=>{this.appearances.push(new Ww(g.condition,g.name,g.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(o){return o.endsWith(qw)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}isPaintProperty(o){return!!this._transitionablePaint._properties.properties[o]}setPaintProperty(o,g){const _e=this._transitionablePaint,rt=_e._properties.properties;if(o.endsWith(qw)){const At=o.slice(0,-11);return rt[At]&&_e.setTransition(At,g||void 0),!1}if(!rt[o])return!1;const ot=_e._values[o],at=ot.value.isDataDriven(),ut=ot.value;_e.setValue(o,g),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,..._e.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||_e.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(o);const ft=_e._values[o].value,gt=ft.isDataDriven(),Ct=o.endsWith("pattern")||o==="line-dasharray";return gt||at||Ct||this._handleOverridablePaintPropertyUpdate(o,ut,ft)}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getDefaultProgramParams(o,g,_e){return null}_handleOverridablePaintPropertyUpdate(o,g,_e){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,g){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,g,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,g)}serialize(){const o={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(o.appearances=this.appearances.map(g=>g.serialize())),Sn(o,(g,_e)=>!(g===void 0||_e==="layout"&&!Object.keys(g).length||_e==="paint"&&!Object.keys(g).length))}is3D(o){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const o in this.paint._values){const g=this.paint.get(o);if(g instanceof o0&&I_(g.property.specification)&&(g.value.kind==="source"||g.value.kind==="composite")&&g.value.isStateDependent)return!0}for(const o of this.appearances)if(!E_(o.condition.expression))return!0;return!1}compileFilter(o){this._filterCompiled||(this._featureFilter=tx(this.filter,this.scope,o),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(o){this._stats&&(o.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(o,g,_e){return{}}queryRadius(o){}queryIntersectsFeature(o,g,_e,rt,ot,at,ut,ft,gt){}}const Kw={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class O_{constructor(o,g){this._structArray=o,this._pos1=g*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const xT=new ArrayBuffer(0);class Fo{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(o,g){return o._trim(),g&&o.arrayBuffer&&g.add(o.arrayBuffer),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const g=Object.create(this.prototype);return g.arrayBuffer=o.arrayBuffer,g.length=o.length,o.arrayBuffer?g.capacity=o.arrayBuffer.byteLength/g.bytesPerElement:(g.capacity=0,g.arrayBuffer=xT),g._refreshViews(),g}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this._reallocCount++,this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const g=this.uint8;this._refreshViews(),g&&this.uint8.set(g)}}reserveForAdditional(o){this.reserve(this.length+o)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...o){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...o){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Bs(_,o=1){let g=0,_e=0;return{members:_.map(rt=>{const ot=Kw[rt.type].BYTES_PER_ELEMENT,at=g=Xw(g,Math.max(o,ot)),ut=rt.components||1;return _e=Math.max(_e,ot),g+=ot*ut,{name:rt.name,type:rt.type,components:ut,offset:at}}),size:Xw(g,Math.max(_e,o)),alignment:o}}function Xw(_,o){return Math.ceil(_/o)*o}class Lm extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g){const _e=this.length;return this.resize(_e+1),this.emplace(_e,o,g)}emplace(o,g,_e){const rt=2*o;return this.int16[rt+0]=g,this.int16[rt+1]=_e,o}}Lm.prototype.bytesPerElement=4,qn(Lm,"StructArrayLayout2i4");class F0 extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,_e){const rt=this.length;return this.resize(rt+1),this.emplace(rt,o,g,_e)}emplace(o,g,_e,rt){const ot=3*o;return this.int16[ot+0]=g,this.int16[ot+1]=_e,this.int16[ot+2]=rt,o}}F0.prototype.bytesPerElement=6,qn(F0,"StructArrayLayout3i6");class B0 extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt){const ot=this.length;return this.resize(ot+1),this.emplace(ot,o,g,_e,rt)}emplace(o,g,_e,rt,ot){const at=4*o;return this.int16[at+0]=g,this.int16[at+1]=_e,this.int16[at+2]=rt,this.int16[at+3]=ot,o}}B0.prototype.bytesPerElement=8,qn(B0,"StructArrayLayout4i8");class im extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const g=this.length;return this.resize(g+1),this.emplace(g,o)}emplace(o,g){return this.float32[1*o+0]=g,o}}im.prototype.bytesPerElement=4,qn(im,"StructArrayLayout1f4");class $v extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e){const rt=this.length;return this.resize(rt+1),this.emplace(rt,o,g,_e)}emplace(o,g,_e,rt){const ot=4*o,at=2*o;return this.int16[ot+0]=g,this.int16[ot+1]=_e,this.float32[at+1]=rt,o}}$v.prototype.bytesPerElement=8,qn($v,"StructArrayLayout2i1f8");class Gv extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,_e){const rt=this.length;return this.resize(rt+1),this.emplace(rt,o,g,_e)}emplace(o,g,_e,rt){const ot=4*o;return this.int16[ot+0]=g,this.int16[ot+1]=_e,this.int16[ot+2]=rt,o}}Gv.prototype.bytesPerElement=8,qn(Gv,"StructArrayLayout3i8");class Hv extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot){const at=this.length;return this.resize(at+1),this.emplace(at,o,g,_e,rt,ot)}emplace(o,g,_e,rt,ot,at){const ut=5*o;return this.int16[ut+0]=g,this.int16[ut+1]=_e,this.int16[ut+2]=rt,this.int16[ut+3]=ot,this.int16[ut+4]=at,o}}Hv.prototype.bytesPerElement=10,qn(Hv,"StructArrayLayout5i10");class ox extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut){const ft=this.length;return this.resize(ft+1),this.emplace(ft,o,g,_e,rt,ot,at,ut)}emplace(o,g,_e,rt,ot,at,ut,ft){const gt=6*o,Ct=12*o,At=3*o;return this.int16[gt+0]=g,this.int16[gt+1]=_e,this.uint8[Ct+4]=rt,this.uint8[Ct+5]=ot,this.uint8[Ct+6]=at,this.uint8[Ct+7]=ut,this.float32[At+2]=ft,o}}ox.prototype.bytesPerElement=12,qn(ox,"StructArrayLayout2i4ub1f12");class Ku extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e){const rt=this.length;return this.resize(rt+1),this.emplace(rt,o,g,_e)}emplace(o,g,_e,rt){const ot=3*o;return this.float32[ot+0]=g,this.float32[ot+1]=_e,this.float32[ot+2]=rt,o}}Ku.prototype.bytesPerElement=12,qn(Ku,"StructArrayLayout3f12");class Lu extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot){const at=this.length;return this.resize(at+1),this.emplace(at,o,g,_e,rt,ot)}emplace(o,g,_e,rt,ot,at){const ut=6*o,ft=3*o;return this.uint16[ut+0]=g,this.uint16[ut+1]=_e,this.uint16[ut+2]=rt,this.uint16[ut+3]=ot,this.float32[ft+2]=at,o}}Lu.prototype.bytesPerElement=12,qn(Lu,"StructArrayLayout4ui1f12");class h0 extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt){const ot=this.length;return this.resize(ot+1),this.emplace(ot,o,g,_e,rt)}emplace(o,g,_e,rt,ot){const at=4*o;return this.uint16[at+0]=g,this.uint16[at+1]=_e,this.uint16[at+2]=rt,this.uint16[at+3]=ot,o}}h0.prototype.bytesPerElement=8,qn(h0,"StructArrayLayout4ui8");class ax extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at){const ut=this.length;return this.resize(ut+1),this.emplace(ut,o,g,_e,rt,ot,at)}emplace(o,g,_e,rt,ot,at,ut){const ft=6*o;return this.int16[ft+0]=g,this.int16[ft+1]=_e,this.int16[ft+2]=rt,this.int16[ft+3]=ot,this.int16[ft+4]=at,this.int16[ft+5]=ut,o}}ax.prototype.bytesPerElement=12,qn(ax,"StructArrayLayout6i12");class Wv extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt){const zt=this.length;return this.resize(zt+1),this.emplace(zt,o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt)}emplace(o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt){const Ut=12*o;return this.int16[Ut+0]=g,this.int16[Ut+1]=_e,this.int16[Ut+2]=rt,this.int16[Ut+3]=ot,this.uint16[Ut+4]=at,this.uint16[Ut+5]=ut,this.uint16[Ut+6]=ft,this.uint16[Ut+7]=gt,this.int16[Ut+8]=Ct,this.int16[Ut+9]=At,this.int16[Ut+10]=kt,this.int16[Ut+11]=zt,o}}Wv.prototype.bytesPerElement=24,qn(Wv,"StructArrayLayout4i4ui4i24");class qv extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at){const ut=this.length;return this.resize(ut+1),this.emplace(ut,o,g,_e,rt,ot,at)}emplace(o,g,_e,rt,ot,at,ut){const ft=10*o,gt=5*o;return this.int16[ft+0]=g,this.int16[ft+1]=_e,this.int16[ft+2]=rt,this.float32[gt+2]=ot,this.float32[gt+3]=at,this.float32[gt+4]=ut,o}}qv.prototype.bytesPerElement=20,qn(qv,"StructArrayLayout3i3f20");class Om extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt){const ot=this.length;return this.resize(ot+1),this.emplace(ot,o,g,_e,rt)}emplace(o,g,_e,rt,ot){const at=4*o;return this.float32[at+0]=g,this.float32[at+1]=_e,this.float32[at+2]=rt,this.float32[at+3]=ot,o}}Om.prototype.bytesPerElement=16,qn(Om,"StructArrayLayout4f16");class lx extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const g=this.length;return this.resize(g+1),this.emplace(g,o)}emplace(o,g){return this.uint32[1*o+0]=g,o}}lx.prototype.bytesPerElement=4,qn(lx,"StructArrayLayout1ul4");class Xu extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,g){const _e=this.length;return this.resize(_e+1),this.emplace(_e,o,g)}emplace(o,g,_e){const rt=2*o;return this.uint16[rt+0]=g,this.uint16[rt+1]=_e,o}}Xu.prototype.bytesPerElement=4,qn(Xu,"StructArrayLayout2ui4");class ux extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt){const Ut=this.length;return this.resize(Ut+1),this.emplace(Ut,o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt)}emplace(o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt,Ut){const Kt=20*o,er=10*o;return this.int16[Kt+0]=g,this.int16[Kt+1]=_e,this.int16[Kt+2]=rt,this.int16[Kt+3]=ot,this.int16[Kt+4]=at,this.float32[er+3]=ut,this.float32[er+4]=ft,this.float32[er+5]=gt,this.float32[er+6]=Ct,this.int16[Kt+14]=At,this.uint32[er+8]=kt,this.uint16[Kt+18]=zt,this.uint16[Kt+19]=Ut,o}}ux.prototype.bytesPerElement=40,qn(ux,"StructArrayLayout5i4f1i1ul2ui40");class hx extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut){const ft=this.length;return this.resize(ft+1),this.emplace(ft,o,g,_e,rt,ot,at,ut)}emplace(o,g,_e,rt,ot,at,ut,ft){const gt=8*o;return this.int16[gt+0]=g,this.int16[gt+1]=_e,this.int16[gt+2]=rt,this.int16[gt+4]=ot,this.int16[gt+5]=at,this.int16[gt+6]=ut,this.int16[gt+7]=ft,o}}hx.prototype.bytesPerElement=16,qn(hx,"StructArrayLayout3i2i2i16");class dx extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot){const at=this.length;return this.resize(at+1),this.emplace(at,o,g,_e,rt,ot)}emplace(o,g,_e,rt,ot,at){const ut=4*o,ft=8*o;return this.float32[ut+0]=g,this.float32[ut+1]=_e,this.float32[ut+2]=rt,this.int16[ft+6]=ot,this.int16[ft+7]=at,o}}dx.prototype.bytesPerElement=16,qn(dx,"StructArrayLayout2f1f2i16");class Kv extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at){const ut=this.length;return this.resize(ut+1),this.emplace(ut,o,g,_e,rt,ot,at)}emplace(o,g,_e,rt,ot,at,ut){const ft=20*o,gt=5*o;return this.uint8[ft+0]=g,this.uint8[ft+1]=_e,this.float32[gt+1]=rt,this.float32[gt+2]=ot,this.float32[gt+3]=at,this.float32[gt+4]=ut,o}}Kv.prototype.bytesPerElement=20,qn(Kv,"StructArrayLayout2ub4f20");class Fl extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,g,_e){const rt=this.length;return this.resize(rt+1),this.emplace(rt,o,g,_e)}emplace(o,g,_e,rt){const ot=3*o;return this.uint16[ot+0]=g,this.uint16[ot+1]=_e,this.uint16[ot+2]=rt,o}}Fl.prototype.bytesPerElement=6,qn(Fl,"StructArrayLayout3ui6");class z0 extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt,Ut,Kt,er,Jt,or,lr,pr,Sr){const br=this.length;return this.resize(br+1),this.emplace(br,o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt,Ut,Kt,er,Jt,or,lr,pr,Sr)}emplace(o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt,Ut,Kt,er,Jt,or,lr,pr,Sr,br){const Rr=30*o,Mr=15*o,Lr=60*o;return this.int16[Rr+0]=g,this.int16[Rr+1]=_e,this.int16[Rr+2]=rt,this.float32[Mr+2]=ot,this.float32[Mr+3]=at,this.uint16[Rr+8]=ut,this.uint16[Rr+9]=ft,this.uint32[Mr+5]=gt,this.uint32[Mr+6]=Ct,this.uint32[Mr+7]=At,this.uint16[Rr+16]=kt,this.uint16[Rr+17]=zt,this.uint16[Rr+18]=Ut,this.float32[Mr+10]=Kt,this.float32[Mr+11]=er,this.uint8[Lr+48]=Jt,this.uint8[Lr+49]=or,this.uint8[Lr+50]=lr,this.uint32[Mr+13]=pr,this.int16[Rr+28]=Sr,this.uint8[Lr+58]=br,o}}z0.prototype.bytesPerElement=60,qn(z0,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Xv extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt,Ut,Kt,er,Jt,or,lr,pr,Sr,br,Rr,Mr,Lr,Jr,zr,sn,dn,pn,wn,Tn,xn){const vn=this.length;return this.resize(vn+1),this.emplace(vn,o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt,Ut,Kt,er,Jt,or,lr,pr,Sr,br,Rr,Mr,Lr,Jr,zr,sn,dn,pn,wn,Tn,xn)}emplace(o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt,Ut,Kt,er,Jt,or,lr,pr,Sr,br,Rr,Mr,Lr,Jr,zr,sn,dn,pn,wn,Tn,xn,vn){const nn=20*o,en=40*o,bn=80*o;return this.float32[nn+0]=g,this.float32[nn+1]=_e,this.int16[en+4]=rt,this.int16[en+5]=ot,this.int16[en+6]=at,this.int16[en+7]=ut,this.int16[en+8]=ft,this.int16[en+9]=gt,this.int16[en+10]=Ct,this.int16[en+11]=At,this.int16[en+12]=kt,this.uint16[en+13]=zt,this.uint16[en+14]=Ut,this.uint16[en+15]=Kt,this.uint16[en+16]=er,this.uint16[en+17]=Jt,this.uint16[en+18]=or,this.uint16[en+19]=lr,this.uint16[en+20]=pr,this.uint16[en+21]=Sr,this.uint16[en+22]=br,this.uint16[en+23]=Rr,this.uint16[en+24]=Mr,this.uint16[en+25]=Lr,this.uint16[en+26]=Jr,this.uint16[en+27]=zr,this.uint32[nn+14]=sn,this.float32[nn+15]=dn,this.float32[nn+16]=pn,this.float32[nn+17]=wn,this.float32[nn+18]=Tn,this.uint8[bn+76]=xn,this.uint16[en+39]=vn,o}}Xv.prototype.bytesPerElement=80,qn(Xv,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Zv extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at){const ut=this.length;return this.resize(ut+1),this.emplace(ut,o,g,_e,rt,ot,at)}emplace(o,g,_e,rt,ot,at,ut){const ft=6*o;return this.float32[ft+0]=g,this.float32[ft+1]=_e,this.float32[ft+2]=rt,this.float32[ft+3]=ot,this.float32[ft+4]=at,this.float32[ft+5]=ut,o}}Zv.prototype.bytesPerElement=24,qn(Zv,"StructArrayLayout6f24");class d0 extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot){const at=this.length;return this.resize(at+1),this.emplace(at,o,g,_e,rt,ot)}emplace(o,g,_e,rt,ot,at){const ut=5*o;return this.float32[ut+0]=g,this.float32[ut+1]=_e,this.float32[ut+2]=rt,this.float32[ut+3]=ot,this.float32[ut+4]=at,o}}d0.prototype.bytesPerElement=20,qn(d0,"StructArrayLayout5f20");class Yv extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut){const ft=this.length;return this.resize(ft+1),this.emplace(ft,o,g,_e,rt,ot,at,ut)}emplace(o,g,_e,rt,ot,at,ut,ft){const gt=7*o;return this.float32[gt+0]=g,this.float32[gt+1]=_e,this.float32[gt+2]=rt,this.float32[gt+3]=ot,this.float32[gt+4]=at,this.float32[gt+5]=ut,this.float32[gt+6]=ft,o}}Yv.prototype.bytesPerElement=28,qn(Yv,"StructArrayLayout7f28");class Qv extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut,ft,gt,Ct,At){const kt=this.length;return this.resize(kt+1),this.emplace(kt,o,g,_e,rt,ot,at,ut,ft,gt,Ct,At)}emplace(o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt){const zt=11*o;return this.float32[zt+0]=g,this.float32[zt+1]=_e,this.float32[zt+2]=rt,this.float32[zt+3]=ot,this.float32[zt+4]=at,this.float32[zt+5]=ut,this.float32[zt+6]=ft,this.float32[zt+7]=gt,this.float32[zt+8]=Ct,this.float32[zt+9]=At,this.float32[zt+10]=kt,o}}Qv.prototype.bytesPerElement=44,qn(Qv,"StructArrayLayout11f44");class V0 extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut,ft,gt){const Ct=this.length;return this.resize(Ct+1),this.emplace(Ct,o,g,_e,rt,ot,at,ut,ft,gt)}emplace(o,g,_e,rt,ot,at,ut,ft,gt,Ct){const At=9*o;return this.float32[At+0]=g,this.float32[At+1]=_e,this.float32[At+2]=rt,this.float32[At+3]=ot,this.float32[At+4]=at,this.float32[At+5]=ut,this.float32[At+6]=ft,this.float32[At+7]=gt,this.float32[At+8]=Ct,o}}V0.prototype.bytesPerElement=36,qn(V0,"StructArrayLayout9f36");class Up extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g){const _e=this.length;return this.resize(_e+1),this.emplace(_e,o,g)}emplace(o,g,_e){const rt=2*o;return this.float32[rt+0]=g,this.float32[rt+1]=_e,o}}Up.prototype.bytesPerElement=8,qn(Up,"StructArrayLayout2f8");class Ou extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt){const ot=this.length;return this.resize(ot+1),this.emplace(ot,o,g,_e,rt)}emplace(o,g,_e,rt,ot){const at=6*o;return this.uint32[3*o+0]=g,this.uint16[at+2]=_e,this.uint16[at+3]=rt,this.uint16[at+4]=ot,o}}Ou.prototype.bytesPerElement=12,qn(Ou,"StructArrayLayout1ul3ui12");class jm extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const g=this.length;return this.resize(g+1),this.emplace(g,o)}emplace(o,g){return this.uint16[1*o+0]=g,o}}jm.prototype.bytesPerElement=2,qn(jm,"StructArrayLayout1ui2");class Jv extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt,Ut,Kt,er){const Jt=this.length;return this.resize(Jt+1),this.emplace(Jt,o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt,Ut,Kt,er)}emplace(o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt,Ut,Kt,er,Jt){const or=16*o;return this.float32[or+0]=g,this.float32[or+1]=_e,this.float32[or+2]=rt,this.float32[or+3]=ot,this.float32[or+4]=at,this.float32[or+5]=ut,this.float32[or+6]=ft,this.float32[or+7]=gt,this.float32[or+8]=Ct,this.float32[or+9]=At,this.float32[or+10]=kt,this.float32[or+11]=zt,this.float32[or+12]=Ut,this.float32[or+13]=Kt,this.float32[or+14]=er,this.float32[or+15]=Jt,o}}Jv.prototype.bytesPerElement=64,qn(Jv,"StructArrayLayout16f64");class fx extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut){const ft=this.length;return this.resize(ft+1),this.emplace(ft,o,g,_e,rt,ot,at,ut)}emplace(o,g,_e,rt,ot,at,ut,ft){const gt=10*o,Ct=5*o;return this.uint16[gt+0]=g,this.uint16[gt+1]=_e,this.uint16[gt+2]=rt,this.uint16[gt+3]=ot,this.float32[Ct+2]=at,this.float32[Ct+3]=ut,this.float32[Ct+4]=ft,o}}fx.prototype.bytesPerElement=20,qn(fx,"StructArrayLayout4ui3f20");class e1 extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o){const g=this.length;return this.resize(g+1),this.emplace(g,o)}emplace(o,g){return this.int16[1*o+0]=g,o}}e1.prototype.bytesPerElement=2,qn(e1,"StructArrayLayout1i2");class mx extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(o){const g=this.length;return this.resize(g+1),this.emplace(g,o)}emplace(o,g){return this.uint8[1*o+0]=g,o}}mx.prototype.bytesPerElement=1,qn(mx,"StructArrayLayout1ub1");class gx extends O_{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}gx.prototype.size=40;class Zw extends ux{get(o){return new gx(this,o)}}qn(Zw,"CollisionBoxArray");class _x extends O_{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}_x.prototype.size=60;class Yw extends z0{get(o){return new _x(this,o)}}qn(Yw,"PlacedSymbolArray");class Qw extends O_{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(o){this._structArray.uint32[this._pos4+14]=o}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(o){this._structArray.float32[this._pos4+18]=o}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Qw.prototype.size=80;class t1 extends Xv{get(o){return new Qw(this,o)}}qn(t1,"SymbolInstanceArray");class yx extends im{getoffsetX(o){return this.float32[1*o+0]}}qn(yx,"GlyphOffsetArray");class Jw extends Lm{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}qn(Jw,"SymbolLineVertexArray");class r1 extends O_{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}r1.prototype.size=12;class i1 extends Ou{get(o){return new r1(this,o)}}qn(i1,"FeatureIndexArray");class eE extends Xu{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}qn(eE,"FillExtrusionCentroidArray");class xx extends O_{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}xx.prototype.size=6;class j_ extends F0{get(o){return new xx(this,o)}}qn(j_,"FillExtrusionWallArray");const tE=Bs([{name:"a_pos",components:2,type:"Int16"}],4),vT=Bs([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),rE=Bs([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Go{constructor(o=[]){this.segments=o}_prepareSegment(o,g,_e,rt){let ot=this.segments[this.segments.length-1];return o>Go.MAX_VERTEX_ARRAY_LENGTH&&$n(`Max vertices per segment is ${Go.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!ot||ot.vertexLength+o>Go.MAX_VERTEX_ARRAY_LENGTH||ot.sortKey!==rt)&&(ot={vertexOffset:g,primitiveOffset:_e,vertexLength:0,primitiveLength:0},rt!==void 0&&(ot.sortKey=rt),this.segments.push(ot)),ot}prepareSegment(o,g,_e,rt){return this._prepareSegment(o,g.length,_e.length,rt)}get(){return this.segments}destroy(){for(const o of this.segments)for(const g in o.vaos)o.vaos[g].destroy()}static simpleSegment(o,g,_e,rt){return new Go([{vertexOffset:o,primitiveOffset:g,vertexLength:_e,primitiveLength:rt,vaos:{},sortKey:0}])}}function vx(_,o){return 256*(_=tr(Math.floor(_),0,255))+tr(Math.floor(o),0,255)}Go.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qn(Go,"SegmentVector");const bT=Bs([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),wT=Bs([{name:"a_pattern_b",components:4,type:"Uint16"}]),ET=Bs([{name:"a_dash",components:4,type:"Uint16"}]);class F_{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(o,g,_e,rt){this.ids.push(n1(o)),this.positions.push(g,_e,rt)}eachPosition(o,g){const _e=n1(o);let rt=0,ot=this.ids.length-1;for(;rt<ot;){const at=rt+ot>>1;this.ids[at]>=_e?ot=at:rt=at+1}for(;this.ids[rt]===_e;)g(this.positions[3*rt],this.positions[3*rt+1],this.positions[3*rt+2]),rt++}static serialize(o,g){const _e=new Float64Array(o.ids),rt=new Uint32Array(o.positions);return s1(_e,rt,0,_e.length-1),g&&(g.add(_e.buffer),g.add(rt.buffer)),{ids:_e,positions:rt}}static deserialize(o){const g=new F_;let _e;g.ids=o.ids,g.positions=o.positions;for(const rt of g.ids)rt!==_e&&g.uniqueIds.push(rt),_e=rt;return g.indexed=!0,g}}function n1(_){const o=+_;return Number.isSafeInteger(o)?o:fy(String(_))}function s1(_,o,g,_e){for(;g<_e;){const rt=_[g+_e>>1];let ot=g-1,at=_e+1;for(;;){do ot++;while(_[ot]<rt);do at--;while(_[at]>rt);if(ot>=at)break;bx(_,ot,at),bx(o,3*ot,3*at),bx(o,3*ot+1,3*at+1),bx(o,3*ot+2,3*at+2)}at-g<_e-at?(s1(_,o,g,at),g=at+1):(s1(_,o,at+1,_e),_e=at)}}function bx(_,o,g){const _e=_[o];_[o]=_[g],_[g]=_e}qn(F_,"FeaturePositionMap");class sm{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,g){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,g),this.initialized=!0),!!this.location}set(o,g,_e){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class wx extends sm{constructor(o){super(o),this.current=0}set(o,g,_e){this.fetchUniformLocation(o,g)&&this.current!==_e&&(this.current=_e,this.gl.uniform1i(this.location,_e))}}class Bl extends sm{constructor(o){super(o),this.current=0}set(o,g,_e){this.fetchUniformLocation(o,g)&&this.current!==_e&&(this.current=_e,this.gl.uniform1f(this.location,_e))}}class $p extends sm{constructor(o){super(o),this.current=[0,0]}set(o,g,_e){this.fetchUniformLocation(o,g)&&(_e[0]===this.current[0]&&_e[1]===this.current[1]||(this.current=_e,this.gl.uniform2f(this.location,_e[0],_e[1])))}}class B_ extends sm{constructor(o){super(o),this.current=[0,0,0]}set(o,g,_e){this.fetchUniformLocation(o,g)&&(_e[0]===this.current[0]&&_e[1]===this.current[1]&&_e[2]===this.current[2]||(this.current=_e,this.gl.uniform3f(this.location,_e[0],_e[1],_e[2])))}}class Ex extends sm{constructor(o){super(o),this.current=[0,0,0,0]}set(o,g,_e){this.fetchUniformLocation(o,g)&&(_e[0]===this.current[0]&&_e[1]===this.current[1]&&_e[2]===this.current[2]&&_e[3]===this.current[3]||(this.current=_e,this.gl.uniform4f(this.location,_e[0],_e[1],_e[2],_e[3])))}}class z_ extends sm{constructor(o){super(o),this.current=fo.transparent.toPremultipliedRenderColor(null)}set(o,g,_e){this.fetchUniformLocation(o,g)&&(_e.r===this.current.r&&_e.g===this.current.g&&_e.b===this.current.b&&_e.a===this.current.a||(this.current=_e,this.gl.uniform4f(this.location,_e.r,_e.g,_e.b,_e.a)))}}const TT=new Float32Array(16);class V_ extends sm{constructor(o){super(o),this.current=TT}set(o,g,_e){if(this.fetchUniformLocation(o,g)){if(_e[12]!==this.current[12]||_e[0]!==this.current[0])return this.current=_e,void this.gl.uniformMatrix4fv(this.location,!1,_e);for(let rt=1;rt<16;rt++)if(_e[rt]!==this.current[rt]){this.current=_e,this.gl.uniformMatrix4fv(this.location,!1,_e);break}}}}const Tx=new Float32Array(9),ST=new Float32Array(4);class Sx extends sm{constructor(o){super(o),this.current=ST}set(o,g,_e){if(this.fetchUniformLocation(o,g)){for(let rt=0;rt<4;rt++)if(_e[rt]!==this.current[rt]){this.current=_e,this.gl.uniformMatrix2fv(this.location,!1,_e);break}}}}function o1(_){return[vx(255*_.r,255*_.g),vx(255*_.b,255*_.a)]}function U_(_,o,g,_e,rt,ot,at,ut){return!!_&&(_.kind==="composite"||_.kind==="source"?_.evaluate(new Do(0,{brightness:ot,worldview:ut}),o,g,rt,_e,at)==="none":_.value==="none")}class $_{constructor(o,g,_e,rt){this.value=o,this.uniformNames=g.map(ot=>`u_${ot}`),this.type=_e,this.context=rt}setUniform(o,g,_e,rt,ot){const at=rt.constantOr(this.value);g.set(o,ot,at instanceof fo?at.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):at)}getBinding(o,g){return this.type==="color"?new z_(o):new Bl(o)}}class U0{constructor(o,g){this.uniformNames=g.map(_e=>`u_${_e}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(o,g){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br),this.patternTransition=g?g.tl.concat(g.br):this.pattern}setUniform(o,g,_e,rt,ot){let at=null;ot!=="u_pattern"&&ot!=="u_dash"||(at=this.pattern),ot==="u_pattern_b"&&(at=this.patternTransition),ot==="u_pixel_ratio"&&(at=this.pixelRatio),at&&g.set(o,ot,at)}getBinding(o,g){return g==="u_pattern"||g==="u_pattern_b"||g==="u_dash"?new Ex(o):new Bl(o)}}class om{constructor(o,g,_e,rt){this.expression=o,this.type=_e,this.maxValue=0,this.paintVertexAttributes=g.map(ot=>({name:`a_${ot}`,type:"Float32",components:_e==="color"?2:1,offset:0})),this.paintVertexArray=new rt}populatePaintArray(o,g,_e,rt,ot,at,ut,ft){const gt=this.paintVertexArray.length,Ct=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Do(0,{brightness:at,worldview:ft}),g,{},ot,rt,ut):this.expression.kind==="constant"&&this.expression.value,At=U_(this.lutExpression,g,{},rt,ot,at,ut,ft);this.paintVertexArray.resize(o),this._setPaintValue(gt,o,Ct,At?null:this.context.lut)}updatePaintArray(o,g,_e,rt,ot,at,ut,ft){const gt=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:ut,worldview:ft},_e,rt,void 0,ot):this.expression.kind==="constant"&&this.expression.value,Ct=U_(this.lutExpression,_e,rt,ot,void 0,ut,void 0,ft);this._setPaintValue(o,g,gt,Ct?null:this.context.lut)}_setPaintValue(o,g,_e,rt){if(this.type==="color"){const ot=o1(_e.toPremultipliedRenderColor(rt));for(let at=o;at<g;at++)this.paintVertexArray.emplace(at,ot[0],ot[1])}else{for(let ot=o;ot<g;ot++)this.paintVertexArray.emplace(ot,_e);this.maxValue=Math.max(this.maxValue,Math.abs(_e))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class am{constructor(o,g,_e,rt,ot,at){this.expression=o,this.uniformNames=g.map(ut=>`u_${ut}_t`),this.type=_e,this.useIntegerZoom=rt,this.context=ot,this.maxValue=0,this.paintVertexAttributes=g.map(ut=>({name:`a_${ut}`,type:"Float32",components:_e==="color"?4:2,offset:0})),this.paintVertexArray=new at}populatePaintArray(o,g,_e,rt,ot,at,ut,ft){const gt=this.expression.evaluate(new Do(this.context.zoom,{brightness:at,worldview:ft}),g,{},ot,rt,ut),Ct=this.expression.evaluate(new Do(this.context.zoom+1,{brightness:at,worldview:ft}),g,{},ot,rt,ut),At=U_(this.lutExpression,g,{},rt,ot,at,ut,ft),kt=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(kt,o,gt,Ct,At?null:this.context.lut)}updatePaintArray(o,g,_e,rt,ot,at,ut,ft){const gt=this.expression.evaluate({zoom:this.context.zoom,brightness:ut,worldview:ft},_e,rt,void 0,ot),Ct=this.expression.evaluate({zoom:this.context.zoom+1,brightness:ut,worldview:ft},_e,rt,void 0,ot),At=U_(this.lutExpression,_e,rt,ot,void 0,ut,void 0,ft);this._setPaintValue(o,g,gt,Ct,At?null:this.context.lut)}_setPaintValue(o,g,_e,rt,ot){if(this.type==="color"){const at=o1(_e.toPremultipliedRenderColor(ot)),ut=o1(_e.toPremultipliedRenderColor(ot));for(let ft=o;ft<g;ft++)this.paintVertexArray.emplace(ft,at[0],at[1],ut[0],ut[1])}else{for(let at=o;at<g;at++)this.paintVertexArray.emplace(at,_e,rt);this.maxValue=Math.max(this.maxValue,Math.abs(_e),Math.abs(rt))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,g,_e,rt,ot){const at=this.useIntegerZoom?Math.floor(_e.zoom):_e.zoom,ut=tr(this.expression.interpolationFactor(at,this.context.zoom,this.context.zoom+1),0,1);g.set(o,ot,ut)}getBinding(o,g){return new Bl(o)}}class lm{constructor(o,g,_e,rt,ot){this.expression=o,this.layerId=ot,this.paintVertexAttributes=(_e==="array"?ET:bT).members;for(let at=0;at<g.length;++at);this.paintVertexArray=new rt,this.paintTransitionVertexArray=new h0}populatePaintArray(o,g,_e,rt){const ot=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(ot,o,g.patterns&&g.patterns[this.layerId],_e)}updatePaintArray(o,g,_e,rt,ot,at,ut){this._setPaintValues(o,g,_e.patterns&&_e.patterns[this.layerId],at)}_setPaintValues(o,g,_e,rt){if(!rt||!_e)return;const ot=rt[_e[0]],at=rt[_e[1]];if(ot){if(ot){const{tl:ut,br:ft,pixelRatio:gt}=ot;for(let Ct=o;Ct<g;Ct++)this.paintVertexArray.emplace(Ct,ut[0],ut[1],ft[0],ft[1],gt)}if(at){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:ut,br:ft}=at;for(let gt=o;gt<g;gt++)this.paintTransitionVertexArray.emplace(gt,ut[0],ut[1],ft[0],ft[1])}}}upload(o){const g=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,g)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=o.createVertexBuffer(this.paintTransitionVertexArray,wT.members,g))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Fm{constructor(o,g,_e=()=>!0){this.binders={},this._buffers=[],this.context=g;const rt=[];for(const ot in o.paint._values){const at=o.paint.get(ot);if(ot.endsWith("-use-theme")||!_e(ot)||!(at instanceof o0&&I_(at.property.specification)))continue;const ut=AT(ot,o.type),ft=at.value,gt=at.property.specification.type,Ct=!!at.property.useIntegerZoom,At=ot==="line-dasharray"||ot.endsWith("pattern"),kt=o.paint.get(`${ot}-use-theme`),zt=ot==="line-dasharray"&&o.layout.get("line-cap").value.kind!=="constant"||kt&&kt.value.kind!=="constant";if(ft.kind!=="constant"||zt)if(ft.kind==="source"||zt||At){const Ut=a1(ot,gt,"source");this.binders[ot]=At?new lm(ft,ut,gt,Ut,o.id):new om(ft,ut,gt,Ut),rt.push(`/a_${ot}`)}else{const Ut=a1(ot,gt,"composite");this.binders[ot]=new am(ft,ut,gt,Ct,g,Ut),rt.push(`/z_${ot}`)}else this.binders[ot]=At?new U0(ft.value,ut):new $_(ft.value,ut,gt,g),rt.push(`/u_${ot}`);kt&&(this.binders[ot].lutExpression=kt.value)}this.cacheKey=rt.sort().join("")}getMaxValue(o){const g=this.binders[o];return g instanceof om||g instanceof am?g.maxValue:0}populatePaintArrays(o,g,_e,rt,ot,at,ut,ft){for(const gt in this.binders){const Ct=this.binders[gt];Ct.context=this.context,(Ct instanceof om||Ct instanceof am||Ct instanceof lm)&&Ct.populatePaintArray(o,g,_e,rt,ot,at,ut,ft)}}setConstantPatternPositions(o,g){for(const _e in this.binders){const rt=this.binders[_e];rt instanceof U0&&rt.setConstantPatternPositions(o,g)}}getPatternTransitionVertexBuffer(o){const g=this.binders[o];return g instanceof lm?g.paintTransitionVertexBuffer:null}updatePaintArrays(o,g,_e,rt,ot,at,ut,ft,gt,Ct){let At=!1;const kt=Object.keys(o),zt=kt.length!==0&&!ft,Ut=zt?kt:g.uniqueIds;this.context.lut=ot.lut;for(const Kt in this.binders){const er=this.binders[Kt];if(er.context=this.context,(er instanceof om||er instanceof am||er instanceof lm)&&er.expression&&er.expression.kind&&er.expression.kind!=="constant"&&(er.expression.isStateDependent===!0||er.expression.isLightConstant===!1)){const Jt=ot.paint.get(Kt);er.expression=Jt.value;for(const or of Ut){const lr=o[or.toString()];g.eachPosition(or,(pr,Sr,br)=>{const Rr=rt.feature(pr);er.updatePaintArray(Sr,br,Rr,lr,at,ut,gt,Ct)})}if(!zt)for(const or of _e.uniqueIds){const lr=o[or.toString()];_e.eachPosition(or,(pr,Sr,br)=>{const Rr=rt.feature(pr);er.updatePaintArray(Sr,br,Rr,lr,at,ut,gt,Ct)})}At=!0}}return At}defines(){const o=[];for(const g in this.binders){const _e=this.binders[g];(_e instanceof $_||_e instanceof U0)&&o.push(..._e.uniformNames.map(rt=>`#define HAS_UNIFORM_${rt}`))}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const g=[];for(const _e in this.binders){const rt=this.binders[_e];if(rt instanceof $_||rt instanceof U0||rt instanceof am)for(const ot of rt.uniformNames)g.push({name:ot,property:_e,binding:rt.getBinding(o,ot)})}return g}setUniforms(o,g,_e,rt,ot){for(const{name:at,property:ut,binding:ft}of _e)this.binders[ut].setUniform(o,ft,ot,rt.get(ut),at)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const g=this.binders[o];(g instanceof om||g instanceof am||g instanceof lm)&&g.paintVertexBuffer&&this._buffers.push(g.paintVertexBuffer),g instanceof lm&&g.paintTransitionVertexBuffer&&this._buffers.push(g.paintTransitionVertexBuffer)}}upload(o){for(const g in this.binders){const _e=this.binders[g];(_e instanceof om||_e instanceof am||_e instanceof lm)&&_e.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const g=this.binders[o];(g instanceof om||g instanceof am||g instanceof lm)&&g.destroy()}}}class Tp{constructor(o,g,_e=()=>!0){this.programConfigurations={};for(const rt of o)this.programConfigurations[rt.id]=new Fm(rt,g,_e);this.needsUpload=!1,this._featureMap=new F_,this._featureMapWithoutIds=new F_,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(o,g,_e,rt,ot,at,ut,ft,gt){for(const Ct in this.programConfigurations)this.programConfigurations[Ct].populatePaintArrays(o,g,rt,ot,at,ut,ft,gt);g.id!==void 0?this._featureMap.add(g.id,_e,this._bufferOffset,o):(this._featureMapWithoutIds.add(this._idlessCounter,_e,this._bufferOffset,o),this._idlessCounter+=1),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,g,_e,rt,ot,at,ut,ft){for(const gt of _e)this.needsUpload=this.programConfigurations[gt.id].updatePaintArrays(o,this._featureMap,this._featureMapWithoutIds,g,gt,rt,ot,at,ut||0,ft)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const g in this.programConfigurations)this.programConfigurations[g].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const CT={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function AT(_,o){return CT[_]||[_.replace(`${o}-`,"").replace(/-/g,"_")]}const RT={"line-pattern":{source:Lu,composite:Lu},"fill-pattern":{source:Lu,composite:Lu},"fill-extrusion-pattern":{source:Lu,composite:Lu},"line-dasharray":{source:h0,composite:h0}},IT={color:{source:Up,composite:Om},number:{source:im,composite:Up}};function a1(_,o,g){const _e=RT[_];return _e&&_e[g]||IT[o][g]}qn($_,"ConstantBinder"),qn(U0,"PatternConstantBinder"),qn(om,"SourceExpressionBinder"),qn(lm,"PatternCompositeBinder"),qn(am,"CompositeExpressionBinder"),qn(Fm,"ProgramConfiguration",{omit:["_buffers"]}),qn(Tp,"ProgramConfigurationSet");const mu=Mn/Math.PI/2,up=5,Cx=6,PT=16383,$0=64,l1=[$0,32,16],hp=-mu,dp=mu;function p0(_,o,g,_e=mu){return g=Fs(g),[_*Math.sin(g)*_e,-o*_e,_*Math.cos(g)*_e]}function G0(_,o,g){return p0(Math.cos(Fs(_)),Math.sin(Fs(_)),o,g)}const it=63710088e-1,d=2*Math.PI*it;class ${constructor(o,g){if(isNaN(o)||isNaN(g))throw new Error(`Invalid LngLat object: (${o}, ${g})`);if(this.lng=+o,this.lat=+g,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new $(yr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const g=Math.PI/180,_e=this.lat*g,rt=o.lat*g,ot=Math.sin(_e)*Math.sin(rt)+Math.cos(_e)*Math.cos(rt)*Math.cos((o.lng-this.lng)*g);return it*Math.acos(Math.min(ot,1))}toBounds(o=0){const g=360*o/40075017,_e=g/Math.cos(Math.PI/180*this.lat);return new st({lng:this.lng-_e,lat:this.lat-g},{lng:this.lng+_e,lat:this.lat+g})}toEcef(o){return G0(this.lat,this.lng,mu+o*mu/it)}static convert(o){if(o instanceof $)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new $(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new $(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class st{constructor(o,g){o&&(g?this.setSouthWest(o).setNorthEast(g):Array.isArray(o)&&o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof $?new $(o.lng,o.lat):$.convert(o),this}setSouthWest(o){return this._sw=o instanceof $?new $(o.lng,o.lat):$.convert(o),this}extend(o){const g=this._sw,_e=this._ne;let rt,ot;if(o instanceof $)rt=o,ot=o;else{if(!(o instanceof st))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(st.convert(o)):this.extend($.convert(o)):typeof o=="object"&&o!==null&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend($.convert(o)):this;if(rt=o._sw,ot=o._ne,!rt||!ot)return this}return g||_e?(g.lng=Math.min(rt.lng,g.lng),g.lat=Math.min(rt.lat,g.lat),_e.lng=Math.max(ot.lng,_e.lng),_e.lat=Math.max(ot.lat,_e.lat)):(this._sw=new $(rt.lng,rt.lat),this._ne=new $(ot.lng,ot.lat)),this}getCenter(){return new $((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new $(this.getWest(),this.getNorth())}getSouthEast(){return new $(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:g,lat:_e}=$.convert(o);let rt=this._sw.lng<=g&&g<=this._ne.lng;return this._sw.lng>this._ne.lng&&(rt=this._sw.lng>=g&&g>=this._ne.lng),this._sw.lat<=_e&&_e<=this._ne.lat&&rt}static convert(o){if(o)return o instanceof st?o:new st(o)}}const lt=0,ht=25.5;function dt(_){return d*Math.cos(_*Math.PI/180)}function mt(_){return(180+_)/360}function Tt(_){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+_*Math.PI/360)))/360}function Pt(_,o){return _/dt(o)}function Mt(_){return 360*_-180}function Ht(_){return 360/Math.PI*Math.atan(Math.exp((180-360*_)*Math.PI/180))-90}function $t(_,o){return _*dt(Ht(o))}const qt=85.051129;function Qt(_){return Math.cos(Fs(tr(_,-qt,qt)))}function Xt(_,o){const g=tr(o,lt,ht),_e=Math.pow(2,g);return Qt(_)*d/(512*_e)}function sr(_){return 1/Math.cos(_*Math.PI/180)}function ir(_,o=0){const g=Math.exp(Math.PI*(1-(_.y+o/Mn)/(1<<_.z)*2));return 80150034*g/(g*g+1)/Mn/(1<<_.z)}class hr{constructor(o,g,_e=0){this.x=+o,this.y=+g,this.z=+_e}static fromLngLat(o,g=0){const _e=$.convert(o);return new hr(mt(_e.lng),Tt(_e.lat),Pt(g,_e.lat))}toLngLat(){return new $(Mt(this.x),Ht(this.y))}toAltitude(){return $t(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/d*sr(Ht(this.y))}}function mr(_,o,g,_e,rt,ot,at,ut,ft){const gt=(o+_e)/2,Ct=(g+rt)/2,At=new mn(gt,Ct);ut(At),function(kt,zt,Ut,Kt,er,Jt){const or=Ut-er,lr=Kt-Jt;return Math.abs((Kt-zt)*or-(Ut-kt)*lr)/Math.hypot(or,lr)}(At.x,At.y,ot.x,ot.y,at.x,at.y)>=ft?(mr(_,o,g,gt,Ct,ot,At,ut,ft),mr(_,gt,Ct,_e,rt,At,at,ut,ft)):_.push(at)}function dr(_,o,g){let _e=_[0],rt=_e.x,ot=_e.y;o(_e);const at=[_e];for(let ut=1;ut<_.length;ut++){const ft=_[ut],{x:gt,y:Ct}=ft;o(ft),mr(at,rt,ot,gt,Ct,_e,ft,o,g),rt=gt,ot=Ct,_e=ft}return at}function Ir(_,o,g,_e){if(_e(o,g)){const rt=o.add(g)._mult(.5);Ir(_,o,rt,_e),Ir(_,rt,g,_e)}else _.push(g)}function Tr(_,o){let g=_[0];const _e=[g];for(let rt=1;rt<_.length;rt++){const ot=_[rt];Ir(_e,g,ot,o),g=ot}return _e}const Ar=Math.pow(2,14)-1,Er=-Ar-1;function vr(_,o){const g=Math.round(_.x*o),_e=Math.round(_.y*o);return _.x=tr(g,Er,Ar),_.y=tr(_e,Er,Ar),(g<_.x||g>_.x+1||_e<_.y||_e>_.y+1)&&$n("Geometry exceeds allowed extent, reduce your vector tile buffer size"),_}function Pr(_,o,g){const _e=_.loadGeometry(),rt=_.extent,ot=Mn/rt;if(o&&g&&g.projection.isReprojectedInTileSpace){const at=1<<o.z,{scale:ut,x:ft,y:gt,projection:Ct}=g,At=kt=>{const zt=Mt((o.x+kt.x/rt)/at),Ut=Ht((o.y+kt.y/rt)/at),Kt=Ct.project(zt,Ut);kt.x=(Kt.x*ut-ft)*rt,kt.y=(Kt.y*ut-gt)*rt};for(let kt=0;kt<_e.length;kt++)if(_.type!==1)_e[kt]=dr(_e[kt],At,1);else{const zt=[];for(const Ut of _e[kt])Ut.x<0||Ut.x>=rt||Ut.y<0||Ut.y>=rt||(At(Ut),zt.push(Ut));_e[kt]=zt}}for(const at of _e)for(const ut of at)vr(ut,ot);return _e}function Br(_,o){return{type:_.type,id:_.id,properties:_.properties,geometry:o?Pr(_):[]}}class Or{constructor(o,g,_e,rt,ot){this.properties={},this.extent=_e,this.type=0,this.id=void 0,this._pbf=o,this._geometry=-1,this._keys=rt,this._values=ot,o.readFields(Yr,this,g)}loadGeometry(){const o=this._pbf;o.pos=this._geometry;const g=o.readVarint()+o.pos,_e=[];let rt,ot=1,at=0,ut=0,ft=0;for(;o.pos<g;){if(at<=0){const gt=o.readVarint();ot=7&gt,at=gt>>3}if(at--,ot===1||ot===2)ut+=o.readSVarint(),ft+=o.readSVarint(),ot===1&&(rt&&_e.push(rt),rt=[]),rt&&rt.push(new mn(ut,ft));else{if(ot!==7)throw new Error(`unknown command ${ot}`);rt&&rt.push(rt[0].clone())}}return rt&&_e.push(rt),_e}bbox(){const o=this._pbf;o.pos=this._geometry;const g=o.readVarint()+o.pos;let _e=1,rt=0,ot=0,at=0,ut=1/0,ft=-1/0,gt=1/0,Ct=-1/0;for(;o.pos<g;){if(rt<=0){const At=o.readVarint();_e=7&At,rt=At>>3}if(rt--,_e===1||_e===2)ot+=o.readSVarint(),at+=o.readSVarint(),ot<ut&&(ut=ot),ot>ft&&(ft=ot),at<gt&&(gt=at),at>Ct&&(Ct=at);else if(_e!==7)throw new Error(`unknown command ${_e}`)}return[ut,gt,ft,Ct]}toGeoJSON(o,g,_e){const rt=this.extent*Math.pow(2,_e),ot=this.extent*o,at=this.extent*g,ut=this.loadGeometry();function ft(kt){return[360*(kt.x+ot)/rt-180,360/Math.PI*Math.atan(Math.exp((1-2*(kt.y+at)/rt)*Math.PI))-90]}function gt(kt){return kt.map(ft)}let Ct;if(this.type===1){const kt=[];for(const Ut of ut)kt.push(Ut[0]);const zt=gt(kt);Ct=kt.length===1?{type:"Point",coordinates:zt[0]}:{type:"MultiPoint",coordinates:zt}}else if(this.type===2){const kt=ut.map(gt);Ct=kt.length===1?{type:"LineString",coordinates:kt[0]}:{type:"MultiLineString",coordinates:kt}}else{if(this.type!==3)throw new Error("unknown feature type");{const kt=function(Ut){const Kt=Ut.length;if(Kt<=1)return[Ut];const er=[];let Jt,or;for(let lr=0;lr<Kt;lr++){const pr=Qr(Ut[lr]);pr!==0&&(or===void 0&&(or=pr<0),or===pr<0?(Jt&&er.push(Jt),Jt=[Ut[lr]]):Jt&&Jt.push(Ut[lr]))}return Jt&&er.push(Jt),er}(ut),zt=[];for(const Ut of kt)zt.push(Ut.map(gt));Ct=zt.length===1?{type:"Polygon",coordinates:zt[0]}:{type:"MultiPolygon",coordinates:zt}}}const At={type:"Feature",geometry:Ct,properties:this.properties};return this.id!=null&&(At.id=this.id),At}}function Yr(_,o,g){_===1?o.id=g.readVarint():_===2?function(_e,rt){const ot=_e.readVarint()+_e.pos;for(;_e.pos<ot;){const at=rt._keys[_e.readVarint()],ut=rt._values[_e.readVarint()];rt.properties[at]=ut}}(g,o):_===3?o.type=g.readVarint():_===4&&(o._geometry=g.pos)}function Qr(_){let o=0;for(let g,_e,rt=0,ot=_.length,at=ot-1;rt<ot;at=rt++)g=_[rt],_e=_[at],o+=(_e.x-g.x)*(g.y+_e.y);return o}Or.types=["Unknown","Point","LineString","Polygon"];class un{constructor(o,g){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(Cn,this,g),this.length=this._features.length}feature(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];const g=this._pbf.readVarint()+this._pbf.pos;return new Or(this._pbf,g,this.extent,this._keys,this._values)}}function Cn(_,o,g){_===15?o.version=g.readVarint():_===1?o.name=g.readString():_===5?o.extent=g.readVarint():_===2?o._features.push(g.pos):_===3?o._keys.push(g.readString()):_===4&&o._values.push(function(_e){let rt=null;const ot=_e.readVarint()+_e.pos;for(;_e.pos<ot;){const at=_e.readVarint()>>3;rt=at===1?_e.readString():at===2?_e.readFloat():at===3?_e.readDouble():at===4?_e.readVarint64():at===5?_e.readVarint():at===6?_e.readSVarint():at===7?_e.readBoolean():null}if(rt==null)throw new Error("unknown feature value");return rt}(g))}class qr{constructor(o,g){this.layers=o.readFields(Nr,{},g)}}function Nr(_,o,g){if(_===3){const _e=new un(g,g.readVarint()+g.pos);_e.length&&(o[_e.name]=_e)}}const tn="3d_elevation_id",Kr="level";class yn{constructor(){this._valid=!1}reset(o){return this.feature=o,this._valid=!0,this._geometry=o.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(o,g){return this._valid&&o(g(this._geometry)),this}require(o,g,_e){return this.get(o,!0,g,_e)}optional(o,g,_e){return this.get(o,!1,g,_e)}success(){return this._valid}get(o,g,_e,rt){const ot=this.feature.properties.hasOwnProperty(o)?+this.feature.properties[o]:void 0;return this._valid&&ot!==void 0&&!Number.isNaN(ot)?_e(rt?rt(ot):ot):g&&(this._valid=!1),this}}class Ln{constructor(o,g){this.featureFunc=o,this.vertexFunc=g}parseFeature(o,g,_e){return this.featureFunc(o,g,_e)}parseVertex(o,g,_e){return this.vertexFunc(o,g,_e)}}const Un=new Ln((_,o,g)=>_.reset(o).require(tn,_e=>{g.id=_e}).optional("fixed_height_relative",_e=>{g.constantHeight=_e},An.decodeRelativeHeight).geometry(_e=>{g.bounds=_e},Qp).success(),(_,o,g)=>_.reset(o).require(tn,_e=>{g.id=_e}).require("elevation_idx",_e=>{g.idx=_e}).require("extent",_e=>{g.extent=_e}).require("height_relative",_e=>{g.height=_e},An.decodeRelativeHeight).geometry(_e=>{g.position=_e},An.getPoint).success()),kn=new Ln((_,o,g)=>_.reset(o).require(tn,_e=>{g.id=_e}).optional("fixed_height",_e=>{g.constantHeight=_e},An.decodeMetricHeight).geometry(_e=>{g.bounds=_e},Qp).success(),(_,o,g)=>_.reset(o).require(tn,_e=>{g.id=_e}).require("elevation_idx",_e=>{g.idx=_e}).require("extent",_e=>{g.extent=_e}).require("height",_e=>{g.height=_e},An.decodeMetricHeight).geometry(_e=>{g.position=_e},An.getPoint).success());class An{static getPoint(o){return hu(o[0][0].x,o[0][0].y)}static decodeRelativeHeight(o){return 1e-4*o*5}static decodeMetricHeight(o){return 1e-4*o}static getVersionSchema(o){return o?o==="1.0.1"?kn:void 0:Un}static parse(o){const g=[],_e=[],rt=o.length,ot=new yn;for(let at=0;at<rt;at++){const ut=o.feature(at),ft=ut.properties.version,gt=An.getVersionSchema(ft);if(gt===void 0){$n(`Unknown elevation feature version number ${ft||"(unknown)"}`);continue}const Ct=ut.properties.type;if(!Ct)continue;const At=Or.types[ut.type];if(At==="Point"&&Ct==="curve_point"){const kt={};gt.parseVertex(ot,ut,kt)&&g.push(kt)}else if(At==="Polygon"&&Ct==="curve_meta"){const kt={};gt.parseFeature(ot,ut,kt)&&_e.push(kt)}}return{vertices:g,features:_e}}}class Qn{constructor(o,g){this.pos=o,this.dir=g}intersectsPlane(o,g,_e){const rt=mp(g,this.dir);if(Math.abs(rt)<1e-6)return!1;const ot=((o[0]-this.pos[0])*g[0]+(o[1]-this.pos[1])*g[1])/rt;return _e[0]=this.pos[0]+this.dir[0]*ot,_e[1]=this.pos[1]+this.dir[1]*ot,!0}}class Kn{constructor(o,g){this.pos=o,this.dir=g}intersectsPlane(o,g,_e){const rt=ms(g,this.dir);if(Math.abs(rt)<1e-6)return!1;const ot=((o[0]-this.pos[0])*g[0]+(o[1]-this.pos[1])*g[1]+(o[2]-this.pos[2])*g[2])/rt;return _e[0]=this.pos[0]+this.dir[0]*ot,_e[1]=this.pos[1]+this.dir[1]*ot,_e[2]=this.pos[2]+this.dir[2]*ot,!0}closestPointOnSphere(o,g,_e){if(function(zt,Ut){var Kt=zt[0],er=zt[1],Jt=zt[2],or=Ut[0],lr=Ut[1],pr=Ut[2];return Math.abs(Kt-or)<=ct*Math.max(1,Math.abs(Kt),Math.abs(or))&&Math.abs(er-lr)<=ct*Math.max(1,Math.abs(er),Math.abs(lr))&&Math.abs(Jt-pr)<=ct*Math.max(1,Math.abs(Jt),Math.abs(pr))}(this.pos,o)||g===0)return _e[0]=_e[1]=_e[2]=0,!1;const[rt,ot,at]=this.dir,ut=this.pos[0]-o[0],ft=this.pos[1]-o[1],gt=this.pos[2]-o[2],Ct=rt*rt+ot*ot+at*at,At=2*(ut*rt+ft*ot+gt*at),kt=At*At-4*Ct*(ut*ut+ft*ft+gt*gt-g*g);if(kt<0){const zt=Math.max(-At/2,0),Ut=ut+rt*zt,Kt=ft+ot*zt,er=gt+at*zt,Jt=Math.hypot(Ut,Kt,er);return _e[0]=Ut*g/Jt,_e[1]=Kt*g/Jt,_e[2]=er*g/Jt,!1}{const zt=(-At-Math.sqrt(kt))/(2*Ct);if(zt<0){const Ut=Math.hypot(ut,ft,gt);return _e[0]=ut*g/Ut,_e[1]=ft*g/Ut,_e[2]=gt*g/Ut,!1}return _e[0]=ut+rt*zt,_e[1]=ft+ot*zt,_e[2]=gt+at*zt,!0}}}class zn{constructor(o,g,_e,rt,ot){this.TL=o,this.TR=g,this.BR=_e,this.BL=rt,this.horizon=ot}static fromInvProjectionMatrix(o,g,_e){const rt=[-1,1,1],ot=[1,1,1],at=[1,-1,1],ut=[-1,-1,1],ft=ws(rt,rt,o),gt=ws(ot,ot,o),Ct=ws(at,at,o),At=ws(ut,ut,o);return new zn(ft,gt,Ct,At,g/_e)}}function Gn(_,o,g){let _e=1/0,rt=-1/0;const ot=[];for(const at of _){wo(ot,at,o);const ut=ms(ot,g);_e=Math.min(_e,ut),rt=Math.max(rt,ut)}return[_e,rt]}function as(_,o){let g=!0;for(let _e=0;_e<_.planes.length;_e++){const rt=_.planes[_e];let ot=0;for(let at=0;at<o.length;at++)ot+=+(ms(rt,o[at])+rt[3]>=0);if(ot===0)return 0;ot!==o.length&&(g=!1)}return g?2:1}function Es(_,o){for(const g of _.projections){const _e=Gn(o,_.points[0],g.axis);if(g.projection[1]<_e[0]||g.projection[0]>_e[1])return 0}return 1}function $s(_,o){let g=0;const _e=[0,0,0,0];for(let at=0;at<_.length;at++)_e[0]=_[at][0],_e[1]=_[at][1],_e[2]=_[at][2],_e[3]=1,(rt=_e)[0]*(ot=o)[0]+rt[1]*ot[1]+rt[2]*ot[2]+rt[3]*ot[3]>=0&&g++;var rt,ot;return g}class so{constructor(o,g){this.points=o||new Array(8).fill([0,0,0]),this.planes=g||new Array(6).fill([0,0,0,0]),this.bounds=Jn.fromPoints(this.points),this.projections=[],this.frustumEdges=[wo([],this.points[2],this.points[3]),wo([],this.points[0],this.points[3]),wo([],this.points[4],this.points[0]),wo([],this.points[5],this.points[1]),wo([],this.points[6],this.points[2]),wo([],this.points[7],this.points[3])];for(const _e of this.frustumEdges){const rt=[0,-_e[2],_e[1]],ot=[_e[2],0,-_e[0]];this.projections.push({axis:rt,projection:Gn(this.points,this.points[0],rt)}),this.projections.push({axis:ot,projection:Gn(this.points,this.points[0],ot)})}}static fromInvProjectionMatrix(o,g,_e,rt){const ot=Math.pow(2,_e),at=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(gt=>{const Ct=Jo([],gt,o),At=1/Ct[3]/g*ot;return(kt=Ct)[0]=(zt=Ct)[0]*(Ut=[At,At,rt?1/Ct[3]:At,At])[0],kt[1]=zt[1]*Ut[1],kt[2]=zt[2]*Ut[2],kt[3]=zt[3]*Ut[3],kt;var kt,zt,Ut}),ut=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(gt=>{const Ct=ls([],Ss([],wo([],at[gt[0]],at[gt[1]]),wo([],at[gt[2]],at[gt[1]]))),At=-ms(Ct,at[gt[1]]);return Ct.concat(At)}),ft=[];for(let gt=0;gt<at.length;gt++)ft.push([at[gt][0],at[gt][1],at[gt][2]]);return new so(ft,ut)}intersectsPrecise(o,g,_e){for(let rt=0;rt<g.length;rt++)if(!$s(o,g[rt]))return 0;for(let rt=0;rt<this.planes.length;rt++)if(!$s(o,this.planes[rt]))return 0;for(const rt of _e)for(const ot of this.frustumEdges){const at=Ss([],rt,ot),ut=_i(at);if(ut===0)continue;fn(at,at,1/ut);const ft=Gn(this.points,this.points[0],at),gt=Gn(o,this.points[0],at);if(ft[0]>gt[1]||gt[0]>ft[1])return 0}return 1}containsPoint(o){for(const g of this.planes){const _e=g[3];if(ms([g[0],g[1],g[2]],o)+_e<0)return!1}return!0}}class Jn{static fromPoints(o){const g=[1/0,1/0,1/0],_e=[-1/0,-1/0,-1/0];for(const rt of o)$r(g,g,rt),_n(_e,_e,rt);return new Jn(g,_e)}static fromTileIdAndHeight(o,g,_e){const rt=1<<o.canonical.z,ot=o.canonical.x,at=o.canonical.y;return new Jn([ot/rt,at/rt,g],[(ot+1)/rt,(at+1)/rt,_e])}static applyTransform(o,g){const _e=o.getCorners();for(let rt=0;rt<_e.length;++rt)ws(_e[rt],_e[rt],g);return Jn.fromPoints(_e)}static applyTransformFast(o,g){const _e=[g[12],g[13],g[14]],rt=[..._e];for(let ot=0;ot<3;ot++)for(let at=0;at<3;at++){const ut=g[4*at+ot],ft=ut*o.min[at],gt=ut*o.max[at];_e[ot]+=Math.min(ft,gt),rt[ot]+=Math.max(ft,gt)}return new Jn(_e,rt)}static projectAabbCorners(o,g){const _e=o.getCorners();for(let rt=0;rt<_e.length;++rt)ws(_e[rt],_e[rt],g);return _e}constructor(o,g){this.min=o,this.max=g,this.center=fn([],rr([],this.min,this.max),.5)}quadrant(o){const g=[o%2==0,o<2],_e=gn(this.min),rt=gn(this.max);for(let ot=0;ot<g.length;ot++)_e[ot]=g[ot]?this.min[ot]:this.center[ot],rt[ot]=g[ot]?this.center[ot]:this.max[ot];return rt[2]=this.max[2],new Jn(_e,rt)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,g=this.max;return[[o[0],o[1],o[2]],[g[0],o[1],o[2]],[g[0],g[1],o[2]],[o[0],g[1],o[2]],[o[0],o[1],g[2]],[g[0],o[1],g[2]],[g[0],g[1],g[2]],[o[0],g[1],g[2]]]}intersects(o){return this.intersectsAabb(o.bounds)?as(o,this.getCorners()):0}intersectsFlat(o){return this.intersectsAabb(o.bounds)?as(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(o,g){return g||this.intersects(o)?Es(o,this.getCorners()):0}intersectsPreciseFlat(o,g){return g||this.intersectsFlat(o)?Es(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(o){for(let g=0;g<3;++g)if(this.min[g]>o.max[g]||o.min[g]>this.max[g])return!1;return!0}intersectsAabbXY(o){return!(this.min[0]>o.max[0]||o.min[0]>this.max[0]||this.min[1]>o.max[1]||o.min[1]>this.max[1])}encapsulate(o){for(let g=0;g<3;g++)this.min[g]=Math.min(this.min[g],o.min[g]),this.max[g]=Math.max(this.max[g],o.max[g])}encapsulatePoint(o){for(let g=0;g<3;g++)this.min[g]=Math.min(this.min[g],o[g]),this.max[g]=Math.max(this.max[g],o[g])}closestPoint(o){return[Math.max(Math.min(this.max[0],o[0]),this.min[0]),Math.max(Math.min(this.max[1],o[1]),this.min[1]),Math.max(Math.min(this.max[2],o[2]),this.min[2])]}}qn(Jn,"Aabb");class ro{constructor(o,g){this.feature=o,this.metersToTile=g,this.index=0}get(){const o=this.feature.vertices[this.index],g=this.feature.vertexProps[this.index].dir,_e=g[1],rt=-g[0],ot=(o.extent+1)*this.metersToTile;return[new mn(Math.trunc(o.position[0]+_e*ot),Math.trunc(o.position[1]+rt*ot)),new mn(Math.trunc(o.position[0]-_e*ot),Math.trunc(o.position[1]-rt*ot))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class bs{constructor(o,g,_e,rt,ot,at){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Cl(),Cl(),Cl(),Cl(),Cl(),Cl(),Cl()],this.id=o,this.heightRange={min:_e,max:_e},this.safeArea=g,this.constantHeight=_e,this.constantHeight==null&&(this.constantHeight!=null||rt.length!==0)){this.vertices=rt,this.edges=ot,this.edges=this.edges.filter(ut=>{return ut.a<this.vertices.length&&ut.b<this.vertices.length&&!((ft=this.vertices[ut.a].position)[0]===(gt=this.vertices[ut.b].position)[0]&&ft[1]===gt[1]);var ft,gt}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const ut of this.vertices)this.vertexProps.push({dir:hu(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,ut.height),this.heightRange.max=Math.max(this.heightRange.max,ut.height);for(const ut of this.edges){const ft=this.vertices[ut.a].position,gt=this.vertices[ut.b].position,Ct=ep(Cl(),gt,ft),At=Bu(Ct),kt=tp(Cl(),Ct,1/At);this.edgeProps.push({vec:Ct,dir:kt,len:At});const zt=this.vertexProps[ut.a].dir,Ut=this.vertexProps[ut.b].dir;Pp(zt,zt,kt),Pp(Ut,Ut,kt)}for(const ut of this.vertexProps)ut.dir[0]===0&&ut.dir[1]===0||Wm(ut.dir,ut.dir);this.tessellate(at)}}pointElevation(o){if(this.constantHeight!=null)return this.constantHeight;const g=this.getClosestEdge(o);if(g==null)return 0;const[_e,rt]=g;return fs(this.vertices[this.edges[_e].a].height,this.vertices[this.edges[_e].b].height,rt)}computeSlopeNormal(o,g){const _e=this.getClosestEdge(o);if(!_e)return xr(0,0,1);const rt=_e[0],ot=this.edges[rt],at=this.edgeProps[rt].vec,ut=xr(at[0],at[1],(this.vertices[ot.b].height-this.vertices[ot.a].height)*g),ft=xr(ut[1],-ut[0],0);Ss(ft,ft,ut);const gt=_i(ft);return gt>0?fn(ft,ft,1/gt):gr(ft,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(o){if(this.edges.length===0)return;let g=0,_e=Number.POSITIVE_INFINITY,rt=0;const[ot,at,ut,ft,gt,Ct,At]=this._tmpVec2;_d(At,o.x,o.y);const kt=new Qn(At,null);for(let zt=0;zt<this.edges.length;zt++){const Ut=this.edges[zt],Kt=this.edgeProps[zt].dir;kt.dir=Kt;const er=this.vertices[Ut.a].position,Jt=this.vertices[Ut.b].position,or=kt.intersectsPlane(er,this.vertexProps[Ut.a].dir,ot),lr=kt.intersectsPlane(Jt,this.vertexProps[Ut.b].dir,at);if(!or||!lr)continue;ep(ut,at,ot),ep(ft,At,ot);const pr=mp(ut,ut),Sr=pr>0?mp(ft,ut)/pr:0,br=tr(Sr,0,1),Rr=Math.abs((Sr-br)*this.edgeProps[zt].len);ep(gt,At,er),_d(Ct,Kt[1],-Kt[0]);const Mr=Rr+Math.abs(mp(gt,Ct));Mr<_e&&(g=zt,_e=Mr,rt=br)}return[g,rt]}tessellate(o){const g=rn(),_e=rn(),rt=rn(),ot=rn();for(let at=this.edges.length-1;at>=0;--at){const ut=this.edges[at].a,ft=this.edges[at].b,{position:gt,height:Ct,extent:At}=this.vertices[ut],{position:kt,height:zt,extent:Ut}=this.vertices[ft],Kt=this.vertexProps[ut].dir,er=this.vertexProps[ft].dir;if(gr(g,gt[0]/o,gt[1]/o,Ct),gr(_e,kt[0]/o,kt[1]/o,zt),gr(rt,Kt[1],-Kt[0],0),fn(rt,rt,At),gr(ot,er[1],-er[0],0),fn(ot,ot,Ut),this.distSqLines(xr(g[0]+.5*rt[0],g[1]+.5*rt[1],g[2]+.5*rt[2]),xr(_e[0]-.5*ot[0],_e[1]-.5*ot[1],_e[2]-.5*ot[2]),xr(g[0]-.5*rt[0],g[1]-.5*rt[1],g[2]-.5*rt[2]),xr(_e[0]+.5*ot[0],_e[1]+.5*ot[1],_e[2]+.5*ot[2]))<=.0025000000000000005)continue;const Jt=this.vertices.length,or=Pp(Cl(),gt,kt);this.vertices.push({position:tp(or,or,.5),height:.5*(Ct+zt),extent:.5*(At+Ut)});const lr=Pp(Cl(),Kt,er);this.vertexProps.push({dir:Wm(lr,lr)}),this.edges.splice(at,1),this.edgeProps.splice(at,1),this.edges.push({a:ut,b:Jt}),this.edges.push({a:Jt,b:ft});const pr=ep(Cl(),this.vertices[Jt].position,gt),Sr=Bu(pr),br={vec:pr,dir:tp(Cl(),pr,1/Sr),len:Sr};this.edgeProps.push(br),this.edgeProps.push(br)}}distSqLines(o,g,_e,rt){const ot=cr(rn(),g,o),at=cr(rn(),rt,_e),ut=cr(rn(),o,_e),ft=ms(ot,ot),gt=ms(ot,at),Ct=ms(ot,ut),At=ms(at,at),kt=ms(at,ut),zt=ft*At-gt*gt;if(zt===0)return Cs(Ks(ot,_e,rt,ms(ut,at)/ms(at,at)),o);const Ut=(ft*kt-gt*Ct)/zt;return Cs(Ks(ot,o,g,(gt*kt-Ct*At)/zt),Ks(at,_e,rt,Ut))}}class co{static parseFrom(o,g){const _e=An.parse(o);if(!_e)return[];let{vertices:rt,features:ot}=_e;const at=1/ir(g);ot.sort((Ct,At)=>Ct.id-At.id),rt.sort((Ct,At)=>Ct.id-At.id||Ct.idx-At.idx),rt=rt.filter((Ct,At,kt)=>At===kt.findIndex(zt=>zt.id===Ct.id&&zt.idx===Ct.idx));const ut=new Array;let ft=0;const gt=rt.length;for(const Ct of ot){if(Ct.constantHeight){ut.push(new bs(Ct.id,Ct.bounds,Ct.constantHeight));continue}for(;ft!==gt&&rt[ft].id<Ct.id;)ft++;if(ft===gt||rt[ft].id!==Ct.id)continue;const At=new Array,kt=new Array,zt=ft;for(;ft!==gt&&rt[ft].id===Ct.id;){const Ut=rt[ft];if(At.push({position:Ut.position,height:Ut.height,extent:Ut.extent}),ft!==zt&&rt[ft-1].idx===Ut.idx-1){const Kt=ft-zt;kt.push({a:Kt-1,b:Kt})}ft++}ut.push(new bs(Ct.id,Ct.bounds,void 0,At,kt,at))}return ut}static getElevationFeature(o,g){if(!g)return;const _e=+o.properties[tn];return Number.isNaN(_e)?void 0:g.find(rt=>rt.id===_e)}}class xo{constructor(o,g){this.zScale=1,this.xOffset=0,this.yOffset=0,o.equals(g)||(this.zScale=Math.pow(2,g.z-o.z),this.xOffset=(o.x*this.zScale-g.x)*Mn,this.yOffset=(o.y*this.zScale-g.y)*Mn)}constantElevation(o,g){if(o.constantHeight!=null)return this.computeBiasedHeight(o.constantHeight,g)}pointElevation(o,g,_e){const rt=this.constantElevation(g,_e);return rt??(o.x=o.x*this.zScale+this.xOffset,o.y=o.y*this.zScale+this.yOffset,this.computeBiasedHeight(g.pointElevation(o),_e))}computeBiasedHeight(o,g){return g<=0?o:o+g*ar(0,g,o>=0?o:Math.abs(.5*o))}}qn(bs,"ElevationFeature");class mo{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new Lm,this.indexArray=new Fl,this.segments=new Go,this.programConfigurations=new Tp(o.layers,{zoom:o.zoom,lut:o.lut}),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new im),this.worldview=o.worldview,this.hasAppearances=null}updateFootprints(o,g){}updateAppearances(o,g,_e,rt){}populate(o,g,_e,rt){const ot=this.layers[0],at=[];let ut=null;ot.type==="circle"&&(ut=ot.layout.get("circle-sort-key"));for(const{feature:gt,id:Ct,index:At,sourceLayerIndex:kt}of o){const zt=this.layers[0]._featureFilter.needGeometry,Ut=Br(gt,zt);if(!this.layers[0]._featureFilter.filter(new Do(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),Ut,_e))continue;const Kt=ut?ut.evaluate(Ut,{},_e):void 0,er={id:Ct,properties:gt.properties,type:gt.type,sourceLayerIndex:kt,index:At,geometry:zt?Ut.geometry:Pr(gt,_e,rt),patterns:{},sortKey:Kt};at.push(er)}ut&&at.sort((gt,Ct)=>gt.sortKey-Ct.sortKey);let ft=null;rt.projection.name==="globe"&&(this.globeExtVertexArray=new ax,ft=rt.projection);for(const gt of at){const{geometry:Ct,index:At,sourceLayerIndex:kt}=gt,zt=o[At].feature;this.addFeature(gt,Ct,At,g.availableImages,_e,ft,g.brightness,g.elevationFeatures),g.featureIndex.insert(zt,Ct,At,kt,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(o,g,_e,rt,ot,at,ut){this.programConfigurations.updatePaintArrays(o,g,ot,_e,rt,at,ut,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,tE.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,rE.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=o.createVertexBuffer(this.elevatedLayoutVertexArray,vT.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(o,g,_e,rt,ot,at,ut,ft){let gt;this.elevationMode!=="none"&&(gt=co.getElevationFeature(o,ft));for(const Ct of g)for(const At of Ct){const kt=At.x,zt=At.y;if(kt<0||kt>=Mn||zt<0||zt>=Mn)continue;if(at){const er=at.projectTilePoint(kt,zt,ot),Jt=at.upVector(ot,kt,zt);this.addGlobeExtVertex(er,Jt),this.addGlobeExtVertex(er,Jt),this.addGlobeExtVertex(er,Jt),this.addGlobeExtVertex(er,Jt)}const Ut=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),Kt=Ut.vertexLength;if(this.addCircleVertex(kt,zt,-1,-1),this.addCircleVertex(kt,zt,1,-1),this.addCircleVertex(kt,zt,1,1),this.addCircleVertex(kt,zt,-1,1),this.elevationMode!=="none"){const er=gt?gt.pointElevation(new mn(kt,zt)):0;this.hasElevation=this.hasElevation||er!==0;for(let Jt=0;Jt<4;Jt++)this.elevatedLayoutVertexArray.emplaceBack(er)}this.indexArray.emplaceBack(Kt,Kt+1,Kt+2),this.indexArray.emplaceBack(Kt,Kt+2,Kt+3),Ut.vertexLength+=4,Ut.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,_e,{},rt,ot,ut,void 0,this.worldview)}addCircleVertex(o,g,_e,rt){this.layoutVertexArray.emplaceBack(2*o+(_e+1)/2,2*g+(rt+1)/2)}addGlobeExtVertex(o,g){this.globeExtVertexArray.emplaceBack(o.x,o.y,o.z,g[0]*16384,g[1]*16384,g[2]*16384)}}function to(_,o){for(let g=0;g<_.length;g++)if(So(o,_[g]))return!0;for(let g=0;g<o.length;g++)if(So(_,o[g]))return!0;return!!Bo(_,o)}function Ms(_,o,g){return!!So(_,o)||!!Lo(o,_,g)}function ao(_,o){if(_.length===1)return Ho(o,_[0]);for(let g=0;g<o.length;g++){const _e=o[g];for(let rt=0;rt<_e.length;rt++)if(So(_,_e[rt]))return!0}for(let g=0;g<_.length;g++)if(Ho(o,_[g]))return!0;for(let g=0;g<o.length;g++)if(Bo(_,o[g]))return!0;return!1}function Zo(_,o,g){if(_.length>1){if(Bo(_,o))return!0;for(let _e=0;_e<o.length;_e++)if(Lo(o[_e],_,g))return!0}for(let _e=0;_e<_.length;_e++)if(Lo(_[_e],o,g))return!0;return!1}function Bo(_,o){if(_.length===0||o.length===0)return!1;for(let g=0;g<_.length-1;g++){const _e=_[g],rt=_[g+1];for(let ot=0;ot<o.length-1;ot++)if(uo(_e,rt,o[ot],o[ot+1]))return!0}return!1}function uo(_,o,g,_e){return ks(_,g,_e)!==ks(o,g,_e)&&ks(_,o,g)!==ks(_,o,_e)}function Ys(_,o,g){return(_.x-g.x)*(o.y-g.y)-(_.y-g.y)*(o.x-g.x)}function Ds(_,o,g,_e){const rt=Ys(_,o,_e),ot=Ys(_,o,g);if(Math.sign(rt)===Math.sign(ot))return;const at=Ys(g,_e,_),ut=at+ot-rt;return Math.sign(at)!==Math.sign(ut)?[at/(at-ut),ot/(ot-rt)]:void 0}function Lo(_,o,g){const _e=g*g;if(o.length===1)return _.distSqr(o[0])<_e;for(let rt=1;rt<o.length;rt++)if(_l(_,o[rt-1],o[rt])<_e)return!0;return!1}function _l(_,o,g){const _e=o.distSqr(g);if(_e===0)return _.distSqr(o);const rt=((_.x-o.x)*(g.x-o.x)+(_.y-o.y)*(g.y-o.y))/_e;return _.distSqr(rt<0?o:rt>1?g:g.sub(o)._mult(rt)._add(o))}function Ho(_,o){let g,_e,rt,ot=!1;for(let at=0;at<_.length;at++){g=_[at];for(let ut=0,ft=g.length-1;ut<g.length;ft=ut++)_e=g[ut],rt=g[ft],_e.y>o.y!=rt.y>o.y&&o.x<(rt.x-_e.x)*(o.y-_e.y)/(rt.y-_e.y)+_e.x&&(ot=!ot)}return ot}function So(_,o){let g=!1;for(let _e=0,rt=_.length-1;_e<_.length;rt=_e++){const ot=_[_e],at=_[rt];ot.y>o.y!=at.y>o.y&&o.x<(at.x-ot.x)*(o.y-ot.y)/(at.y-ot.y)+ot.x&&(g=!g)}return g}function Pu(_,o,g,_e,rt){for(const at of _)if(o<=at.x&&g<=at.y&&_e>=at.x&&rt>=at.y)return!0;const ot=[new mn(o,g),new mn(o,rt),new mn(_e,rt),new mn(_e,g)];if(_.length>2){for(const at of ot)if(So(_,at))return!0}for(let at=0;at<_.length-1;at++)if(cu(_[at],_[at+1],ot))return!0;return!1}function cu(_,o,g){const _e=g[0],rt=g[2];if(_.x<_e.x&&o.x<_e.x||_.x>rt.x&&o.x>rt.x||_.y<_e.y&&o.y<_e.y||_.y>rt.y&&o.y>rt.y)return!1;const ot=ks(_,o,g[0]);return ot!==ks(_,o,g[1])||ot!==ks(_,o,g[2])||ot!==ks(_,o,g[3])}function zl(_,o,g,_e,rt,ot){let at=o.y-_.y,ut=_.x-o.x;if(ot=ot||0){const ft=at*at+ut*ut;if(ft===0)return!0;const gt=Math.sqrt(ft);at/=gt,ut/=gt}return!((g.x-_.x)*at+(g.y-_.y)*ut-ot<0||(_e.x-_.x)*at+(_e.y-_.y)*ut-ot<0||(rt.x-_.x)*at+(rt.y-_.y)*ut-ot<0)}function gu(_,o,g,_e,rt,ot,at){return!(zl(_,o,_e,rt,ot,at)||zl(o,g,_e,rt,ot,at)||zl(g,_,_e,rt,ot,at)||zl(_e,rt,_,o,g,at)||zl(rt,ot,_,o,g,at)||zl(ot,_e,_,o,g,at))}function _u(_,o,g){const _e=o.paint.get(_).value;return _e.kind==="constant"?_e.value:g.programConfigurations.get(o.id).getMaxValue(_)}function nu(_){return Math.sqrt(_[0]*_[0]+_[1]*_[1])}function Zu(_,o,g,_e,rt){if(!o[0]&&!o[1])return _;const ot=mn.convert(o)._mult(rt);g==="viewport"&&ot._rotate(-_e);const at=[];for(let ut=0;ut<_.length;ut++)at.push(_[ut].sub(ot));return at}function pp(_,o,g,_e){const rt=mn.convert(_)._mult(_e);return o==="viewport"&&rt._rotate(-g),rt}let ju,_a;function wl(_,o,g){var _e=2*Math.PI*6378137/256/Math.pow(2,g);return[_*_e-2*Math.PI*6378137/2,o*_e-2*Math.PI*6378137/2]}qn(mo,"CircleBucket",{omit:["layers"]});class Co{constructor(o,g,_e){this.z=o,this.x=g,this.y=_e,this.key=Wo(0,o,o,g,_e)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}isChildOf(o){const g=this.z-o.z;return o.z===0||o.z<this.z&&o.x===this.x>>g&&o.y===this.y>>g}url(o,g){const _e=function(ot,at,ut){var ft=wl(256*ot,256*(at=Math.pow(2,ut)-at-1),ut),gt=wl(256*(ot+1),256*(at+1),ut);return ft[0]+","+ft[1]+","+gt[0]+","+gt[1]}(this.x,this.y,this.z),rt=function(ot,at,ut){let ft,gt="";for(let Ct=ot;Ct>0;Ct--)ft=1<<Ct-1,gt+=(at&ft?1:0)+(ut&ft?2:0);return gt}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(g==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",rt).replace("{bbox-epsg-3857}",_e)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Al{constructor(o,g){this.wrap=o,this.canonical=g,this.key=Wo(o,g.z,g.z,g.x,g.y)}}class Yo{constructor(o,g,_e,rt,ot){this.overscaledZ=o,this.wrap=g,this.canonical=new Co(_e,+rt,+ot),this.key=g===0&&o===_e?this.canonical.key:Wo(g,o,_e,rt,ot)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const g=this.canonical.z-o;return o>this.canonical.z?new Yo(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Yo(o,this.wrap,o,this.canonical.x>>g,this.canonical.y>>g)}calculateScaledKey(o,g=!0){if(this.overscaledZ===o&&g)return this.key;if(o>this.canonical.z)return Wo(this.wrap*+g,o,this.canonical.z,this.canonical.x,this.canonical.y);{const _e=this.canonical.z-o;return Wo(this.wrap*+g,o,o,this.canonical.x>>_e,this.canonical.y>>_e)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const g=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.z<this.canonical.z&&o.canonical.x===this.canonical.x>>g&&o.canonical.y===this.canonical.y>>g}children(o){if(this.overscaledZ>=o)return[new Yo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const g=this.canonical.z+1,_e=2*this.canonical.x,rt=2*this.canonical.y;return[new Yo(g,this.wrap,g,_e,rt),new Yo(g,this.wrap,g,_e+1,rt),new Yo(g,this.wrap,g,_e,rt+1),new Yo(g,this.wrap,g,_e+1,rt+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Yo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Yo(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Al(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Wo(_,o,g,_e,rt){const ot=1<<Math.min(g,22);let at=ot*(rt%ot)+_e%ot;return _&&g<22&&(at+=ot*ot*((_<0?-2*_-1:2*_)%(1<<2*(22-g)))),16*(32*at+g)+(o-g)}const fp=[_=>{let o=_.canonical.x-1,g=_.wrap;return o<0&&(o=(1<<_.canonical.z)-1,g--),new Yo(_.overscaledZ,g,_.canonical.z,o,_.canonical.y)},_=>{let o=_.canonical.x+1,g=_.wrap;return o===1<<_.canonical.z&&(o=0,g++),new Yo(_.overscaledZ,g,_.canonical.z,o,_.canonical.y)},_=>new Yo(_.overscaledZ,_.wrap,_.canonical.z,_.canonical.x,(_.canonical.y===0?1<<_.canonical.z:_.canonical.y)-1),_=>new Yo(_.overscaledZ,_.wrap,_.canonical.z,_.canonical.x,_.canonical.y===(1<<_.canonical.z)-1?0:_.canonical.y+1)];qn(Co,"CanonicalTileID"),qn(Yo,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const G_=Bs([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Sp}=G_,H_=Bs([{name:"a_pos_3",components:3,type:"Int16"}]);var H0=Bs([{name:"a_pos",type:"Int16",components:2}]);function Gp(_){return _*mu/it}const cm=[new Jn([hp,hp,hp],[dp,dp,dp]),new Jn([hp,hp,hp],[0,0,dp]),new Jn([0,hp,hp],[dp,0,dp]),new Jn([hp,0,hp],[0,dp,dp]),new Jn([0,0,hp],[dp,dp,dp])];function W0(_,o,g,_e=!0){const rt=fn([],_._camera.position,_.worldSize),ot=[o,g,1,1];Jo(ot,ot,_.pixelMatrixInverse),ru(ot,ot,1/ot[3]);const at=ls([],wo([],ot,rt)),ut=_.globeMatrix,ft=[ut[12],ut[13],ut[14]],gt=wo([],ft,rt),Ct=_i(gt),At=ls([],gt),kt=_.worldSize/(2*Math.PI),zt=ms(At,at),Ut=Math.asin(kt/Ct);if(Ut<Math.acos(zt)){if(!_e)return null;const Jr=[],zr=[];fn(Jr,at,Ct/zt),ls(zr,wo(zr,Jr,gt)),ls(at,rr(at,gt,fn(at,zr,Math.tan(Ut)*Ct)))}const Kt=[];new Kn(rt,at).closestPointOnSphere(ft,kt,Kt);const er=ls([],ba(ut,0)),Jt=ls([],ba(ut,1)),or=ls([],ba(ut,2)),lr=ms(er,Kt),pr=ms(Jt,Kt),Sr=ms(or,Kt),br=vu(Math.asin(-pr/kt));let Rr=vu(Math.atan2(lr,Sr));Rr=_.center.lng+function(Jr,zr){const sn=(zr-Jr+180)%360-180;return sn<-180?sn+360:sn}(_.center.lng,Rr);const Mr=mt(Rr),Lr=tr(Tt(br),0,1);return new hr(Mr,Lr)}class Bm{constructor(o,g,_e){this.a=wo([],o,_e),this.b=wo([],g,_e),this.center=_e;const rt=ls([],this.a),ot=ls([],this.b);this.angle=Math.acos(ms(rt,ot))}}function um(_,o){if(_.angle===0)return null;let g;return g=_.a[o]===0?1/_.angle*.5*Math.PI:1/_.angle*Math.atan(_.b[o]/_.a[o]/Math.sin(_.angle)-1/Math.tan(_.angle)),g<0||g>1?null:function(_e,rt,ot,at){const ut=Math.sin(ot);return _e*(Math.sin((1-at)*ot)/ut)+rt*(Math.sin(at*ot)/ut)}(_.a[o],_.b[o],_.angle,tr(g,0,1))+_.center[o]}function Cp(_){if(_.z<=1)return cm[_.z+2*_.y+_.x];const o=kT(iE(_));return Jn.fromPoints(o)}function hm(_,o,g){return fn(_,_,1-g),jn(_,_,o,g)}function YS(_,o,g){for(const _e of _)ws(_e,_e,o),fn(_e,_e,g)}function QS(_,o,g,_e){const rt=o/_.worldSize,ot=_.globeMatrix;if(g.z<=1){const Lr=Cp(g).getCorners();return YS(Lr,ot,rt),Jn.fromPoints(Lr)}const at=iE(g,_e),ut=kT(at,mu+Gp(_._tileCoverLift));YS(ut,ot,rt);const ft=Number.MAX_VALUE,gt=[-ft,-ft,-ft],Ct=[ft,ft,ft];if(at.contains(_.center)){for(const zr of ut)$r(Ct,Ct,zr),_n(gt,gt,zr);gt[2]=0;const Lr=_.point,Jr=[Lr.x*rt,Lr.y*rt,0];return $r(Ct,Ct,Jr),_n(gt,gt,Jr),new Jn(Ct,gt)}if(_._tileCoverLift>0){for(const Lr of ut)$r(Ct,Ct,Lr),_n(gt,gt,Lr);return new Jn(Ct,gt)}const At=[ot[12]*rt,ot[13]*rt,ot[14]*rt],kt=at.getCenter(),zt=tr(_.center.lat,-qt,qt),Ut=tr(kt.lat,-qt,qt),Kt=mt(_.center.lng),er=Tt(zt);let Jt=Kt-mt(kt.lng);const or=er-Tt(Ut);Jt>.5?Jt-=1:Jt<-.5&&(Jt+=1);let lr=0;Math.abs(Jt)>Math.abs(or)?lr=Jt>=0?1:3:(lr=or>=0?0:2,jn(At,At,[ot[4]*rt,ot[5]*rt,ot[6]*rt],-Math.sin(Fs(or>=0?at.getSouth():at.getNorth()))*mu));const pr=ut[lr],Sr=ut[(lr+1)%4],br=new Bm(pr,Sr,At),Rr=[um(br,0)||pr[0],um(br,1)||pr[1],um(br,2)||pr[2]],Mr=q0(_.zoom);if(Mr>0){const Lr=function({x:zr,y:sn,z:dn},pn,wn,Tn,xn){const vn=1/(1<<dn);let nn=zr*vn,en=nn+vn,bn=sn*vn,Dn=bn+vn,Rn=0;const ts=(nn+en)/2-Tn;return ts>.5?Rn=-1:ts<-.5&&(Rn=1),nn=((nn+Rn)*pn-(Tn*=pn))*wn+Tn,en=((en+Rn)*pn-Tn)*wn+Tn,bn=(bn*pn-(xn*=pn))*wn+xn,Dn=(Dn*pn-xn)*wn+xn,[[nn,Dn,0],[en,Dn,0],[en,bn,0],[nn,bn,0]]}(g,o,_._pixelsPerMercatorPixel,Kt,er);for(let zr=0;zr<ut.length;zr++)hm(ut[zr],Lr[zr],Mr);const Jr=rr([],Lr[lr],Lr[(lr+1)%4]);fn(Jr,Jr,.5),hm(Rr,Jr,Mr)}for(const Lr of ut)$r(Ct,Ct,Lr),_n(gt,gt,Lr);return Ct[2]=Math.min(pr[2],Sr[2]),$r(Ct,Ct,Rr),_n(gt,gt,Rr),new Jn(Ct,gt)}function iE({x:_,y:o,z:g},_e=!1){const rt=1/(1<<g),ot=new $(Mt(_*rt),o===(1<<g)-1&&_e?-90:Ht((o+1)*rt)),at=new $(Mt((_+1)*rt),o===0&&_e?90:Ht(o*rt));return new st(ot,at)}function kT(_,o=mu){const g=Fs(_.getNorth()),_e=Fs(_.getSouth()),rt=Math.cos(g),ot=Math.cos(_e),at=Math.sin(g),ut=Math.sin(_e),ft=_.getWest(),gt=_.getEast();return[p0(ot,ut,ft,o),p0(ot,ut,gt,o),p0(rt,at,gt,o),p0(rt,at,ft,o)]}function c1(_,o,g,_e){const rt=1<<g.z,ot=(_/Mn+g.x)/rt;return G0(Ht((o/Mn+g.y)/rt),Mt(ot),_e)}function nE({min:_,max:o}){return PT/Math.max(o[0]-_[0],o[1]-_[1],o[2]-_[2])}const JS=new Float64Array(16);function sE(_){const o=nE(_),g=_r(JS,[o,o,o]);return Lt(g,g,Nn([],_.min))}function MT(_){const o=(_e=_.min,(g=JS)[0]=1,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=1,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=1,g[11]=0,g[12]=_e[0],g[13]=_e[1],g[14]=_e[2],g[15]=1,g);var g,_e;const rt=1/nE(_);return Vt(o,o,[rt,rt,rt])}function DT(_){const o=Mn/(2*Math.PI);return _/(2*Math.PI)/o}function eC(_,o){return Mn/(512*Math.pow(2,_))*nE(Cp(o))}function tC(_,o,g,_e,rt){const ot=DT(g),at=[_,o,-g/(2*Math.PI)],ut=Gt(new Float64Array(16));return Lt(ut,ut,at),Vt(ut,ut,[ot,ot,ot]),Zt(ut,ut,Fs(-rt)),nr(ut,ut,Fs(-_e)),ut}function q0(_){return ar(up,Cx,_)}function rC(_,o){const g=G0(o.lat,o.lng),_e=function(Ut){const Kt=G0(Ut._center.lat,Ut._center.lng);let er=Ss([],xr(0,1,0),Kt);const Jt=Ur([],-Ut.angle,Kt);er=ws(er,er,Jt),Ur(Jt,-Ut._pitch,er);const or=ls([],Kt);return fn(or,or,Gp(Ut.cameraToCenterDistance/Ut.pixelsPerMeter)),ws(or,or,Jt),rr([],Kt,or)}(_);return at=(rt=cr([],_e,g))[0],ut=rt[1],ft=rt[2],gt=(ot=g)[0],Ct=ot[1],At=ot[2],zt=(kt=Math.sqrt((at*at+ut*ut+ft*ft)*(gt*gt+Ct*Ct+At*At)))&&ms(rt,ot)/kt,Math.acos(Math.min(Math.max(zt,-1),1));var rt,ot,at,ut,ft,gt,Ct,At,kt,zt}function NT(_,o){return rC(_,o)>Math.PI/2*1.01}const iC=Fs(85),iI=Math.cos(iC),nI=Math.sin(iC),sI=Nt(),nC=_=>{const o=[];return _.paint.get("circle-pitch-alignment")==="map"&&o.push("PITCH_WITH_MAP"),_.paint.get("circle-pitch-scale")==="map"&&o.push("SCALE_WITH_MAP"),o};function sC(_,o,g,_e,rt,ot,at,ut,ft){if(ot&&_.queryGeometry.isAboveHorizon)return!1;ot&&(ft*=_.pixelToTileUnitsFactor);const gt=_.tileID.canonical,Ct=g.projection.upVectorScale(gt,g.center.lat,g.worldSize).metersToTile;for(const At of o)for(const kt of At){const zt=kt.add(ut),Ut=rt&&g.elevation?g.elevation.exaggeration()*rt.getElevationAt(zt.x,zt.y,!0):0,Kt=g.projection.projectTilePoint(zt.x,zt.y,gt);if(Ut>0){const lr=g.projection.upVector(gt,zt.x,zt.y);Kt.x+=lr[0]*Ct*Ut,Kt.y+=lr[1]*Ct*Ut,Kt.z+=lr[2]*Ct*Ut}const er=ot?zt:oI(Kt.x,Kt.y,Kt.z,_e),Jt=ot?_.tilespaceRays.map(lr=>lI(lr,Ut)):_.queryGeometry.screenGeometry,or=Jo([],[Kt.x,Kt.y,Kt.z,1],_e);if(!at&&ot?ft*=or[3]/g.cameraToCenterDistance:at&&!ot&&(ft*=g.cameraToCenterDistance/or[3]),ot){const lr=Ht((kt.y/Mn+gt.y)/(1<<gt.z));ft/=g.projection.pixelsPerMeter(lr,1)/Pt(1,lr)}if(Ms(Jt,er,ft))return!0}return!1}function oI(_,o,g,_e){const rt=Jo([],[_,o,g,1],_e);return new mn(rt[0]/rt[3],rt[1]/rt[3])}const oC=xr(0,0,0),aI=xr(0,0,1);function lI(_,o){const g=rn();return oC[2]=o,_.intersectsPlane(oC,aI,g),new mn(g[0],g[1])}class aC extends mo{}let lC,cC,uC,hC;function dC(_,{width:o,height:g},_e,rt){if(rt){if(rt instanceof Uint8ClampedArray)rt=new Uint8Array(rt.buffer);else if(rt.length!==o*g*_e)throw new RangeError("mismatched image size")}else rt=new Uint8Array(o*g*_e);return _.width=o,_.height=g,_.data=rt,_}function pC(_,o,g){const{width:_e,height:rt}=o;_e===_.width&&rt===_.height||(LT(_,o,{x:0,y:0},{x:0,y:0},{width:Math.min(_.width,_e),height:Math.min(_.height,rt)},g,null),_.width=_e,_.height=rt,_.data=o.data)}function LT(_,o,g,_e,rt,ot,at,ut){if(rt.width===0||rt.height===0)return o;if(rt.width>_.width||rt.height>_.height||g.x>_.width-rt.width||g.y>_.height-rt.height)throw new RangeError("out of range source coordinates for image copy");if(rt.width>o.width||rt.height>o.height||_e.x>o.width-rt.width||_e.y>o.height-rt.height)throw new RangeError("out of range destination coordinates for image copy");const ft=_.data,gt=o.data,Ct=ot===4&&ut;for(let At=0;At<rt.height;At++){const kt=((g.y+At)*_.width+g.x)*ot,zt=((_e.y+At)*o.width+_e.x)*ot;if(Ct)for(let Ut=0;Ut<rt.width;Ut++){const Kt=kt+Ut*ot+3,er=zt+Ut*ot;gt[er+0]=255,gt[er+1]=255,gt[er+2]=255,gt[er+3]=ft[Kt]}else if(at)for(let Ut=0;Ut<rt.width;Ut++){const Kt=kt+Ut*ot,er=zt+Ut*ot,Jt=new fo(ft[Kt+0]/255,ft[Kt+1]/255,ft[Kt+2]/255,ft[Kt+3]).toNonPremultipliedRenderColor(at).toArray();gt[er+0]=Jt[0],gt[er+1]=Jt[1],gt[er+2]=Jt[2],gt[er+3]=Jt[3]}else for(let Ut=0;Ut<rt.width*ot;Ut++)gt[zt+Ut]=ft[kt+Ut]}return o}qn(aC,"HeatmapBucket",{omit:["layers"]});class K0{constructor(o,g){dC(this,o,1,g)}resize(o){pC(this,new K0(o),1)}clone(){return new K0({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,g,_e,rt,ot){LT(o,g,_e,rt,ot,1,null)}}class yu{constructor(o,g){dC(this,o,4,g)}resize(o){pC(this,new yu(o),4)}replace(o,g){g?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new yu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,g,_e,rt,ot,at,ut){LT(o,g,_e,rt,ot,4,at,ut)}}class fC{constructor(o,g){this.width=o.width,this.height=o.height,this.data=g instanceof Uint8Array?new Float32Array(g.buffer):g}}function u1(_){const o={},g=_.resolution||256,_e=_.clips?_.clips.length:1,rt=_.image||new yu({width:g,height:_e}),ot=(at,ut,ft)=>{o[_.evaluationKey]=ft;const gt=_.expression.evaluate(o),Ct=gt?gt.toNonPremultipliedRenderColor(null):null;Ct&&(rt.data[at+ut+0]=Math.floor(255*Ct.r),rt.data[at+ut+1]=Math.floor(255*Ct.g),rt.data[at+ut+2]=Math.floor(255*Ct.b),rt.data[at+ut+3]=Math.floor(255*Ct.a))};if(_.clips)for(let at=0,ut=0;at<_e;++at,ut+=4*g)for(let ft=0,gt=0;ft<g;ft++,gt+=4){const Ct=ft/(g-1),{start:At,end:kt}=_.clips[at];ot(ut,gt,At*(1-Ct)+kt*Ct)}else for(let at=0,ut=0;at<g;at++,ut+=4)ot(0,ut,at/(g-1));return rt}qn(K0,"AlphaImage"),qn(yu,"RGBAImage");const cI=Bs([{name:"a_pos",components:2,type:"Int16"}],4),uI=Bs([{name:"a_road_z_offset",components:1,type:"Float32"}],4),hI=Bs([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),dI=Bs([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Ax(_,o,g=2){const _e=o&&o.length,rt=_e?o[0]*g:_.length;let ot=mC(_,0,rt,g,!0);const at=[];if(!ot||ot.next===ot.prev)return at;let ut,ft,gt;if(_e&&(ot=function(Ct,At,kt,zt){const Ut=[];for(let Kt=0,er=At.length;Kt<er;Kt++){const Jt=mC(Ct,At[Kt]*zt,Kt<er-1?At[Kt+1]*zt:Ct.length,zt,!1);Jt===Jt.next&&(Jt.steiner=!0),Ut.push(vI(Jt))}Ut.sort(_I);for(let Kt=0;Kt<Ut.length;Kt++)kt=yI(Ut[Kt],kt);return kt}(_,o,ot,g)),_.length>80*g){ut=_[0],ft=_[1];let Ct=ut,At=ft;for(let kt=g;kt<rt;kt+=g){const zt=_[kt],Ut=_[kt+1];zt<ut&&(ut=zt),Ut<ft&&(ft=Ut),zt>Ct&&(Ct=zt),Ut>At&&(At=Ut)}gt=Math.max(Ct-ut,At-ft),gt=gt!==0?32767/gt:0}return h1(ot,at,g,ut,ft,gt,0),at}function mC(_,o,g,_e,rt){let ot;if(rt===function(at,ut,ft,gt){let Ct=0;for(let At=ut,kt=ft-gt;At<ft;At+=gt)Ct+=(at[kt]-at[At])*(at[At+1]+at[kt+1]),kt=At;return Ct}(_,o,g,_e)>0)for(let at=o;at<g;at+=_e)ot=xC(at/_e|0,_[at],_[at+1],ot);else for(let at=g-_e;at>=o;at-=_e)ot=xC(at/_e|0,_[at],_[at+1],ot);return ot&&Rx(ot,ot.next)&&(f1(ot),ot=ot.next),ot}function W_(_,o){if(!_)return _;o||(o=_);let g,_e=_;do if(g=!1,_e.steiner||!Rx(_e,_e.next)&&eu(_e.prev,_e,_e.next)!==0)_e=_e.next;else{if(f1(_e),_e=o=_e.prev,_e===_e.next)break;g=!0}while(g||_e!==o);return o}function h1(_,o,g,_e,rt,ot,at){if(!_)return;!at&&ot&&function(ft,gt,Ct,At){let kt=ft;do kt.z===0&&(kt.z=OT(kt.x,kt.y,gt,Ct,At)),kt.prevZ=kt.prev,kt.nextZ=kt.next,kt=kt.next;while(kt!==ft);kt.prevZ.nextZ=null,kt.prevZ=null,function(zt){let Ut,Kt=1;do{let er,Jt=zt;zt=null;let or=null;for(Ut=0;Jt;){Ut++;let lr=Jt,pr=0;for(let br=0;br<Kt&&(pr++,lr=lr.nextZ,lr);br++);let Sr=Kt;for(;pr>0||Sr>0&&lr;)pr!==0&&(Sr===0||!lr||Jt.z<=lr.z)?(er=Jt,Jt=Jt.nextZ,pr--):(er=lr,lr=lr.nextZ,Sr--),or?or.nextZ=er:zt=er,er.prevZ=or,or=er;Jt=lr}or.nextZ=null,Kt*=2}while(Ut>1)}(kt)}(_,_e,rt,ot);let ut=_;for(;_.prev!==_.next;){const ft=_.prev,gt=_.next;if(ot?fI(_,_e,rt,ot):pI(_))o.push(ft.i,_.i,gt.i),f1(_),_=gt.next,ut=gt.next;else if((_=gt)===ut){at?at===1?h1(_=mI(W_(_),o),o,g,_e,rt,ot,2):at===2&&gI(_,o,g,_e,rt,ot):h1(W_(_),o,g,_e,rt,ot,1);break}}}function pI(_){const o=_.prev,g=_,_e=_.next;if(eu(o,g,_e)>=0)return!1;const rt=o.x,ot=g.x,at=_e.x,ut=o.y,ft=g.y,gt=_e.y,Ct=Math.min(rt,ot,at),At=Math.min(ut,ft,gt),kt=Math.max(rt,ot,at),zt=Math.max(ut,ft,gt);let Ut=_e.next;for(;Ut!==o;){if(Ut.x>=Ct&&Ut.x<=kt&&Ut.y>=At&&Ut.y<=zt&&d1(rt,ut,ot,ft,at,gt,Ut.x,Ut.y)&&eu(Ut.prev,Ut,Ut.next)>=0)return!1;Ut=Ut.next}return!0}function fI(_,o,g,_e){const rt=_.prev,ot=_,at=_.next;if(eu(rt,ot,at)>=0)return!1;const ut=rt.x,ft=ot.x,gt=at.x,Ct=rt.y,At=ot.y,kt=at.y,zt=Math.min(ut,ft,gt),Ut=Math.min(Ct,At,kt),Kt=Math.max(ut,ft,gt),er=Math.max(Ct,At,kt),Jt=OT(zt,Ut,o,g,_e),or=OT(Kt,er,o,g,_e);let lr=_.prevZ,pr=_.nextZ;for(;lr&&lr.z>=Jt&&pr&&pr.z<=or;){if(lr.x>=zt&&lr.x<=Kt&&lr.y>=Ut&&lr.y<=er&&lr!==rt&&lr!==at&&d1(ut,Ct,ft,At,gt,kt,lr.x,lr.y)&&eu(lr.prev,lr,lr.next)>=0||(lr=lr.prevZ,pr.x>=zt&&pr.x<=Kt&&pr.y>=Ut&&pr.y<=er&&pr!==rt&&pr!==at&&d1(ut,Ct,ft,At,gt,kt,pr.x,pr.y)&&eu(pr.prev,pr,pr.next)>=0))return!1;pr=pr.nextZ}for(;lr&&lr.z>=Jt;){if(lr.x>=zt&&lr.x<=Kt&&lr.y>=Ut&&lr.y<=er&&lr!==rt&&lr!==at&&d1(ut,Ct,ft,At,gt,kt,lr.x,lr.y)&&eu(lr.prev,lr,lr.next)>=0)return!1;lr=lr.prevZ}for(;pr&&pr.z<=or;){if(pr.x>=zt&&pr.x<=Kt&&pr.y>=Ut&&pr.y<=er&&pr!==rt&&pr!==at&&d1(ut,Ct,ft,At,gt,kt,pr.x,pr.y)&&eu(pr.prev,pr,pr.next)>=0)return!1;pr=pr.nextZ}return!0}function mI(_,o){let g=_;do{const _e=g.prev,rt=g.next.next;!Rx(_e,rt)&&_C(_e,g,g.next,rt)&&p1(_e,rt)&&p1(rt,_e)&&(o.push(_e.i,g.i,rt.i),f1(g),f1(g.next),g=_=rt),g=g.next}while(g!==_);return W_(g)}function gI(_,o,g,_e,rt,ot){let at=_;do{let ut=at.next.next;for(;ut!==at.prev;){if(at.i!==ut.i&&bI(at,ut)){let ft=yC(at,ut);return at=W_(at,at.next),ft=W_(ft,ft.next),h1(at,o,g,_e,rt,ot,0),void h1(ft,o,g,_e,rt,ot,0)}ut=ut.next}at=at.next}while(at!==_)}function _I(_,o){let g=_.x-o.x;return g===0&&(g=_.y-o.y,g===0)&&(g=(_.next.y-_.y)/(_.next.x-_.x)-(o.next.y-o.y)/(o.next.x-o.x)),g}function yI(_,o){const g=function(rt,ot){let at=ot;const ut=rt.x,ft=rt.y;let gt,Ct=-1/0;if(Rx(rt,at))return at;do{if(Rx(rt,at.next))return at.next;if(ft<=at.y&&ft>=at.next.y&&at.next.y!==at.y){const Kt=at.x+(ft-at.y)*(at.next.x-at.x)/(at.next.y-at.y);if(Kt<=ut&&Kt>Ct&&(Ct=Kt,gt=at.x<at.next.x?at:at.next,Kt===ut))return gt}at=at.next}while(at!==ot);if(!gt)return null;const At=gt,kt=gt.x,zt=gt.y;let Ut=1/0;at=gt;do{if(ut>=at.x&&at.x>=kt&&ut!==at.x&&gC(ft<zt?ut:Ct,ft,kt,zt,ft<zt?Ct:ut,ft,at.x,at.y)){const Kt=Math.abs(ft-at.y)/(ut-at.x);p1(at,rt)&&(Kt<Ut||Kt===Ut&&(at.x>gt.x||at.x===gt.x&&xI(gt,at)))&&(gt=at,Ut=Kt)}at=at.next}while(at!==At);return gt}(_,o);if(!g)return o;const _e=yC(g,_);return W_(_e,_e.next),W_(g,g.next)}function xI(_,o){return eu(_.prev,_,o.prev)<0&&eu(o.next,_,_.next)<0}function OT(_,o,g,_e,rt){return(_=1431655765&((_=858993459&((_=252645135&((_=16711935&((_=(_-g)*rt|0)|_<<8))|_<<4))|_<<2))|_<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-_e)*rt|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function vI(_){let o=_,g=_;do(o.x<g.x||o.x===g.x&&o.y<g.y)&&(g=o),o=o.next;while(o!==_);return g}function gC(_,o,g,_e,rt,ot,at,ut){return(rt-at)*(o-ut)>=(_-at)*(ot-ut)&&(_-at)*(_e-ut)>=(g-at)*(o-ut)&&(g-at)*(ot-ut)>=(rt-at)*(_e-ut)}function d1(_,o,g,_e,rt,ot,at,ut){return!(_===at&&o===ut)&&gC(_,o,g,_e,rt,ot,at,ut)}function bI(_,o){return _.next.i!==o.i&&_.prev.i!==o.i&&!function(g,_e){let rt=g;do{if(rt.i!==g.i&&rt.next.i!==g.i&&rt.i!==_e.i&&rt.next.i!==_e.i&&_C(rt,rt.next,g,_e))return!0;rt=rt.next}while(rt!==g);return!1}(_,o)&&(p1(_,o)&&p1(o,_)&&function(g,_e){let rt=g,ot=!1;const at=(g.x+_e.x)/2,ut=(g.y+_e.y)/2;do rt.y>ut!=rt.next.y>ut&&rt.next.y!==rt.y&&at<(rt.next.x-rt.x)*(ut-rt.y)/(rt.next.y-rt.y)+rt.x&&(ot=!ot),rt=rt.next;while(rt!==g);return ot}(_,o)&&(eu(_.prev,_,o.prev)||eu(_,o.prev,o))||Rx(_,o)&&eu(_.prev,_,_.next)>0&&eu(o.prev,o,o.next)>0)}function eu(_,o,g){return(o.y-_.y)*(g.x-o.x)-(o.x-_.x)*(g.y-o.y)}function Rx(_,o){return _.x===o.x&&_.y===o.y}function _C(_,o,g,_e){const rt=aE(eu(_,o,g)),ot=aE(eu(_,o,_e)),at=aE(eu(g,_e,_)),ut=aE(eu(g,_e,o));return rt!==ot&&at!==ut||!(rt!==0||!oE(_,g,o))||!(ot!==0||!oE(_,_e,o))||!(at!==0||!oE(g,_,_e))||!(ut!==0||!oE(g,o,_e))}function oE(_,o,g){return o.x<=Math.max(_.x,g.x)&&o.x>=Math.min(_.x,g.x)&&o.y<=Math.max(_.y,g.y)&&o.y>=Math.min(_.y,g.y)}function aE(_){return _>0?1:_<0?-1:0}function p1(_,o){return eu(_.prev,_,_.next)<0?eu(_,o,_.next)>=0&&eu(_,_.prev,o)>=0:eu(_,o,_.prev)<0||eu(_,_.next,o)<0}function yC(_,o){const g=jT(_.i,_.x,_.y),_e=jT(o.i,o.x,o.y),rt=_.next,ot=o.prev;return _.next=o,o.prev=_,g.next=rt,rt.prev=g,_e.next=g,g.prev=_e,ot.next=_e,_e.prev=ot,_e}function xC(_,o,g,_e){const rt=jT(_,o,g);return _e?(rt.next=_e.next,rt.prev=_e,_e.next.prev=rt,_e.next=rt):(rt.prev=rt,rt.next=rt),rt}function f1(_){_.next.prev=_.prev,_.prev.next=_.next,_.prevZ&&(_.prevZ.nextZ=_.nextZ),_.nextZ&&(_.nextZ.prevZ=_.prevZ)}function jT(_,o,g){return{i:_,x:o,y:g,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function m1(_,o){const g=_.length;if(g<=1)return[_];const _e=[];let rt,ot;for(let at=0;at<g;at++){const ut=Is(_[at]);ut!==0&&(_[at].area=Math.abs(ut),ot===void 0&&(ot=ut<0),ot===ut<0?(rt&&_e.push(rt),rt=[_[at]]):rt.push(_[at]))}if(rt&&_e.push(rt),o>1)for(let at=0;at<_e.length;at++)_e[at].length<=o||(Ey(_e[at],o,1,_e[at].length-1,wI),_e[at]=_e[at].slice(0,o));return _e}function wI(_,o){return o.area-_.area}function vC(_,o,g=1){if(!_)return null;const _e=typeof _=="string"?Cu.from(_).getPrimary():_.getPrimary(),rt=typeof _=="string"?null:_.getSecondary();for(const ot of[_e,rt]){if(!ot)continue;const at=ot.id.toString();o.has(at)||o.set(at,[]),ot.scaleSelf(g),o.get(at).push(ot)}return{primary:_e.toString(),secondary:rt?rt.toString():null}}function FT(_,o,g,_e){const rt=_e.patternDependencies;let ot=!1;for(const at of o){const ut=at.paint.get(`${_}-pattern`);ut.isConstant()||(ot=!0),vC(ut.constantOr(null),rt,g)&&(ot=!0)}return ot}function BT(_,o,g,_e,rt,ot){const at=ot.patternDependencies;for(const ut of o){const ft=ut.paint.get(`${_}-pattern`).value;if(ft.kind!=="constant"){let gt=ft.evaluate({zoom:_e},g,{},ot.availableImages);gt=gt&&gt.name?gt.name:gt;const Ct=vC(gt,at,rt);if(!Ct)continue;const{primary:At,secondary:kt}=Ct;At&&(g.patterns[ut.id]=[At,kt].filter(Boolean))}}return g}class bC{constructor(){this.polygons=new Map}add(o,...g){const _e=this.polygons.get(o);_e?_e.push(...g):this.polygons.set(o,g)}merge(o){for(const[g,_e]of o.polygons)this.add(g,..._e)}}class f0{constructor(){this.portals=[]}static isOnBorder(o,g){return o<=0&&g<=0||o>=Mn&&g>=Mn}static evaluate(o){if(o.length===0)return new f0;let g=[];for(const ft of o)g.push(...ft.portals);if(g.length===0)return new f0;for(const ft of g){const gt=ft.va,Ct=ft.vb;(f0.isOnBorder(gt.x,Ct.x)||f0.isOnBorder(gt.y,Ct.y))&&(ft.type="border")}const _e=g.filter(ft=>ft.type!=="unevaluated"),rt=g.filter(ft=>ft.type==="unevaluated");if(rt.length===0)return new f0;rt.sort((ft,gt)=>ft.hash===gt.hash?ft.isTunnel===gt.isTunnel?0:ft.isTunnel?-1:1:ft.hash<gt.hash?1:-1),g=_e.concat(rt);let ot=_e.length,at=ot,ut=ot;do if(at++,at===g.length||g[ot].hash!==g[at].hash){if(at-ot==2){ut<ot&&(g[ut]=g[ot],g[ot]=null);const ft=g[ut],gt=g[at-1];ft.type=ft.isTunnel!==gt.isTunnel?"tunnel":"polygon",ft.connection={a:ft.connection.a,b:gt.connection.a},ut++}ot=at}while(ot!==g.length);return g.splice(ut),g.sort((ft,gt)=>ft.hash<gt.hash?1:-1),{portals:g}}}qn(f0,"ElevationPortalGraph"),qn(bC,"ElevationPolygons");class EI{constructor(o,g,_e){this.outPositions=o,this.outNormals=g,this.outIndices=_e,this.vertexLookup=new Map}addVertex(o,g,_e){let rt=o[2];_e!=null&&(rt*=_e);const ot=`${o[0]},${o[1]},${o[2]},${g[0]},${g[1]},${g[2]}`,at=this.vertexLookup.get(ot);if(at!=null)return at;const ut=this.outPositions.length;this.vertexLookup.set(ot,ut);const ft=Math.trunc(16384*g[0]),gt=Math.trunc(16384*g[1]),Ct=Math.trunc(16384*g[2]);return this.outPositions.emplaceBack(o[0],o[1],rt),this.outNormals.emplaceBack(ft,gt,Ct),ut}addTriangle(o,g,_e){this.outIndices.emplaceBack(o,g,_e)}addTriangles(o,g,_e){if(o.length===0)return;const rt=_e.length===1,ot=rn(),at=rn();for(let ut=0;ut<o.length;ut+=3){const ft=g[o[ut+0]],gt=g[o[ut+1]],Ct=g[o[ut+2]],At=rt?_e[0]:_e[o[ut+1]],kt=rt?_e[0]:_e[o[ut+2]];gr(ot,ft.x,ft.y,rt?_e[0]:_e[o[ut+0]]);const zt=this.addVertex(ot,at);gr(ot,gt.x,gt.y,At);const Ut=this.addVertex(ot,at);gr(ot,Ct.x,Ct.y,kt);const Kt=this.addVertex(ot,at);this.outIndices.emplaceBack(zt,Ut,Kt)}}addQuad(o,g,_e,rt,ot,at){const ut=this.addVertex(o,ot,at),ft=this.addVertex(g,ot,at),gt=this.addVertex(_e,ot,at),Ct=this.addVertex(rt,ot,at);this.addTriangle(ut,ft,gt),this.addTriangle(gt,Ct,ut)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Yu{constructor(o,g,_e,rt){this.unevaluatedPortals=new f0,this.portalPolygons=new bC,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new $v,this.vertexNormals=new Gv,this.indexArray=new Fl,this.tileToMeters=ir(o),this.bridgeProgramConfigurations=new Tp(g,{zoom:_e,lut:rt},ot=>ot!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Tp(g,{zoom:_e,lut:rt},ot=>ot!=="fill-bridge-guard-rail-color")}addVertices(o,g){const _e=this.unevalVertices.length;for(let rt=0;rt<o.length;rt++)this.unevalVertices.push(o[rt]),this.unevalHeights.push(g[rt]);return _e}addTriangles(o,g,_e){const rt=_e?this.unevalTunnelTriangles:this.unevalTriangles;for(const ot of o)rt.push(ot+g)}addRenderableRing(o,g,_e,rt,ot,at){const ut=[new mn(ot.min.x,ot.min.y),new mn(ot.max.x,ot.min.y),new mn(ot.max.x,ot.max.y),new mn(ot.min.x,ot.max.y)];for(let ft=0;ft<_e-1;ft++){const gt=g+ft,Ct=gt+1,At=this.unevalVertices[gt],kt=this.unevalVertices[Ct];if(!(At.x>=ot.min.x&&At.x<=ot.max.x&&At.y>=ot.min.y&&At.y<=ot.max.y||kt.x>=ot.min.x&&kt.x<=ot.max.x&&kt.y>=ot.min.y&&kt.y<=ot.max.y||cu(At,kt,ut))||this.isOnBorder(At.x,kt.x)||this.isOnBorder(At.y,kt.y))continue;const zt=Yu.computeEdgeHash(this.unevalVertices[gt],this.unevalVertices[Ct]);let Ut,Kt=this.vertexHashLookup.get(Yu.computePosHash(At));Kt!=null?Ut=Kt.next:(Kt=this.vertexHashLookup.get(Yu.computePosHash(kt)),Ut=Kt!=null?Kt.prev:zt),this.unevalEdges.push({polygonIdx:o,a:gt,b:Ct,hash:zt,portalHash:Ut,isTunnel:rt,type:"unevaluated",featureInfo:at})}}addPortalCandidates(o,g,_e,rt,ot){if(g.length===0)return;this.portalPolygons.add(o,{geometry:g,zLevel:ot});const at=g[0];this.vertexHashLookup.clear();let ut=Yu.computeEdgeHash(at[at.length-2],at[at.length-1]);for(let ft=0;ft<at.length-1;ft++){const gt=at[ft+0],Ct=at[ft+1],At=hu(Ct.x-gt.x,Ct.y-gt.y),kt=Bu(At);if(kt===0)continue;let zt="unevaluated";const Ut=rt.pointElevation(gt),Kt=rt.pointElevation(Ct);Math.abs(Ut)<.01&&Math.abs(Kt)<.01?zt="entrance":(this.isOnBorder(gt.x,Ct.x)||this.isOnBorder(gt.y,Ct.y))&&(zt="border");const er=Yu.computeEdgeHash(gt,Ct);this.unevaluatedPortals.portals.push({connection:{a:o,b:void 0},va:gt,vb:Ct,vab:At,length:kt,hash:er,isTunnel:_e,type:zt});const Jt=Yu.computePosHash(gt);this.vertexHashLookup.set(Jt,{prev:ut,next:er}),ut=er}}construct(o){if(this.unevalVertices.length===0)return;const g=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),_e=kt=>{kt.primitiveLength=this.indexArray.length-kt.primitiveOffset},rt=new EI(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(o.portals,this.unevalEdges);const ot=g(),at=g(),ut=g(),ft=(kt,zt)=>{kt.sort((Kt,er)=>Kt.type===zt&&er.type!==zt?-1:Kt.type!==zt&&er.type===zt?1:0);const Ut=kt.findIndex(Kt=>Kt.type!==zt);return Ut>=0?Ut:kt.length};let gt=0;this.unevalEdges.length>0&&(gt=ft(this.unevalEdges,"none"),this.constructBridgeStructures(rt,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:gt},this.tileToMeters)),_e(ut);const Ct=g(),At=g();if(this.unevalEdges.length>0){const kt=this.unevalEdges.splice(gt),zt=ft(kt,"tunnel")+gt;this.unevalEdges.push(...kt),this.constructTunnelStructures(rt,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:gt},{min:gt,max:zt})}_e(Ct),rt.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),_e(At),rt.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),_e(at),rt.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),_e(ot),this.maskSegments=Go.simpleSegment(0,At.primitiveOffset,0,At.primitiveLength),this.depthSegments=Go.simpleSegment(0,at.primitiveOffset,0,at.primitiveLength),this.renderableBridgeSegments=Go.simpleSegment(0,ut.primitiveOffset,0,ut.primitiveLength),this.renderableTunnelSegments=Go.simpleSegment(0,Ct.primitiveOffset,0,Ct.primitiveLength),this.shadowCasterSegments=Go.simpleSegment(0,ot.primitiveOffset,0,ot.primitiveLength)}update(o,g,_e,rt,ot,at,ut,ft){this.bridgeProgramConfigurations.updatePaintArrays(o,g,ot,_e,rt,at,ut,ft),this.tunnelProgramConfigurations.updatePaintArrays(o,g,ot,_e,rt,at,ut,ft)}upload(o){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=o.createVertexBuffer(this.vertexPositions,hI.members),this.vertexBufferNormal=o.createVertexBuffer(this.vertexNormals,dI.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(o),this.tunnelProgramConfigurations.upload(o))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(o,g,_e,rt,ot){const at=(ut,ft)=>{for(let gt=0;gt<ft.length-1;gt++){const Ct=ft[gt].featureIndex,At=ft[gt+1].vertexStart,kt=o.feature(Ct);ut.populatePaintArrays(At,kt,Ct,{},_e,g,rt,void 0,ot)}};at(this.bridgeProgramConfigurations,this.bridgeFeatureSections),at(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(o,g,_e,rt,ot){const at=new Map;for(let ut=rt;ut<ot;ut++){const ft=_e[ut],gt=ft.a,Ct=ft.b,At=Yu.computePosHash(o[gt]),kt=Yu.computePosHash(o[Ct]);let zt=at.get(At);zt||(zt={},at.set(At,zt));let Ut=at.get(kt);Ut||(Ut={},at.set(kt,Ut)),g[gt]<=0&&g[Ct]<=0||(zt.to=Ct,Ut.from=gt)}return at}isTerminalVertex(o,g){const _e=Yu.computePosHash(this.unevalVertices[o]),rt=g.get(_e);return!rt||!rt.from||!rt.to}constructBridgeStructures(o,g,_e,rt,ot,at){o.clearVertexLookup();const ut=this.computeVertexConnections(g,_e,rt,ot.min,ot.max),ft=1/at,gt=.5*ft,Ct=(wn,Tn)=>gr(wn,g[Tn].x,g[Tn].y,_e[Tn]*ft),At=rn(),kt=rn(),zt=rn(),Ut=rn(),Kt=rn(),er=(wn,Tn)=>{const xn=ut.get(Yu.computePosHash(g[Tn])),vn=xn.from,nn=xn.to;if(!vn||!nn)return;Ct(At,vn),Ct(kt,Tn),Ct(zt,nn),Qo(Ut),Vo(At,kt)||(wo(Kt,kt,At),ls(Ut,Kt)),Vo(zt,kt)||(wo(Kt,zt,kt),rr(Ut,Ut,ls(Kt,Kt)));const en=ou(Ut);return en>0?fn(wn,Ut,1/en):void 0};let Jt=Number.POSITIVE_INFINITY;this.sortSubarray(rt,ot.min,ot.max,(wn,Tn)=>wn.featureInfo.featureIndex-Tn.featureInfo.featureIndex);const or=rn(),lr=rn(),pr=rn(),Sr=rn(),br=rn(),Rr=rn(),Mr=rn(),Lr=rn(),Jr=rn(),zr=[rn(),rn(),rn(),rn()],sn=[rn(),rn(),rn(),rn()],dn=[{coord:new mn(0,0),height:0},{coord:new mn(0,0),height:0}],pn=(wn,Tn)=>wn>Tn;for(let wn=ot.min;wn<ot.max;wn++){const Tn=rt[wn];if(!Tn.featureInfo.guardRailEnabled||!this.prepareEdgePoints(dn,g,_e,Tn,pn))continue;const[xn,vn]=dn;if(gr(or,xn.coord.x,xn.coord.y,ft*xn.height),gr(lr,vn.coord.x,vn.coord.y,ft*vn.height),Vo(or,lr))continue;wo(pr,lr,or),ls(pr,pr);const nn=er(Lr,Tn.a)||pr,en=er(Jr,Tn.b)||pr;gr(Sr,nn[1],-nn[0],0),ls(Sr,Sr),gr(br,en[1],-en[0],0),ls(br,br),Ss(Lr,Sr,nn),ls(Rr,Lr),Ss(Lr,br,en),ls(Mr,Lr),rr(zr[0],or,fn(Lr,wo(Lr,Sr,Rr),gt)),rr(zr[1],or,fn(Lr,rr(Lr,Sr,Rr),gt)),rr(zr[2],or,fn(Lr,Rr,gt)),zr[3]=or,rr(sn[0],lr,fn(Lr,wo(Lr,br,Mr),gt)),rr(sn[1],lr,fn(Lr,rr(Lr,br,Mr),gt)),rr(sn[2],lr,fn(Lr,Mr,gt)),sn[3]=lr,Jt=this.addFeatureSection(Tn.featureInfo.featureIndex,Jt,this.bridgeFeatureSections,o);const bn=o.addVertex(zr[0],Sr,at),Dn=o.addVertex(zr[1],Sr,at),Rn=o.addVertex(sn[0],br,at),ts=o.addVertex(sn[1],br,at);o.addTriangle(bn,Dn,Rn),o.addTriangle(Dn,ts,Rn);const Vn=o.addVertex(zr[1],Rr,at),Hn=o.addVertex(zr[2],Rr,at),Zn=o.addVertex(sn[1],Mr,at),js=o.addVertex(sn[2],Mr,at);o.addTriangle(Vn,Hn,Zn),o.addTriangle(Hn,js,Zn),Nn(Sr,Sr),Nn(br,br);const In=o.addVertex(zr[2],Sr,at),Yn=o.addVertex(zr[3],Sr,at),xs=o.addVertex(sn[2],br,at),Gs=o.addVertex(sn[3],br,at);o.addTriangle(In,Yn,xs),o.addTriangle(Yn,Gs,xs);const Ws=this.isTerminalVertex(Tn.a,ut),Rs=this.isTerminalVertex(Tn.b,ut);xn.height<.01&&Ws&&o.addQuad(zr[3],zr[2],zr[1],zr[0],Nn(nn,nn),at),vn.height<.01&&Rs&&o.addQuad(sn[0],sn[1],sn[2],sn[3],en,at)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:o.getVertexCount()})}constructTunnelStructures(o,g,_e,rt,ot,at){o.clearVertexLookup();let ut=Number.POSITIVE_INFINITY;const ft=(Jt,or)=>Jt.featureInfo.featureIndex-or.featureInfo.featureIndex;this.sortSubarray(rt,ot.min,ot.max,ft),this.sortSubarray(rt,at.min,at.max,ft);const gt=Jt=>ls(Jt,Jt),Ct=[{coord:new mn(0,0),height:0},{coord:new mn(0,0),height:0}],At=(Jt,or)=>Jt<or,kt=rn(),zt=rn(),Ut=rn(),Kt=rn(),er=rn();for(let Jt=ot.min;Jt<ot.max;Jt++){if(!this.prepareEdgePoints(Ct,g,_e,rt[Jt],At))continue;const[or,lr]=Ct,pr=gt(gr(er,-(lr.coord.y-or.coord.y),lr.coord.x-or.coord.x,0));ut=this.addFeatureSection(rt[Jt].featureInfo.featureIndex,ut,this.tunnelFeatureSections,o),o.addQuad(gr(kt,or.coord.x,or.coord.y,or.height),gr(zt,lr.coord.x,lr.coord.y,lr.height),gr(Ut,lr.coord.x,lr.coord.y,rt[Jt].isTunnel?-.1:0),gr(Kt,or.coord.x,or.coord.y,rt[Jt].isTunnel?-.1:0),pr)}for(let Jt=at.min;Jt<at.max;Jt++){const or=rt[Jt];or.isTunnel&&([or.a,or.b]=[or.b,or.a]);const lr=g[or.a],pr=g[or.b],Sr=gt(gr(er,-(pr.y-lr.y),pr.x-lr.x,0));ut=this.addFeatureSection(or.featureInfo.featureIndex,ut,this.tunnelFeatureSections,o),o.addQuad(gr(kt,pr.x,pr.y,0),gr(zt,lr.x,lr.y,0),gr(Ut,lr.x,lr.y,_e[or.a]+4),gr(Kt,pr.x,pr.y,_e[or.b]+4),Sr),o.addQuad(gr(kt,lr.x,lr.y,0),gr(zt,pr.x,pr.y,0),gr(Ut,pr.x,pr.y,_e[or.b]+4),gr(Kt,lr.x,lr.y,_e[or.a]+4),Sr)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:o.getVertexCount()})}setElevatedPoint(o,g,_e,rt){o.coord.x=g,o.coord.y=_e,o.height=rt}prepareEdgePoints(o,g,_e,rt,ot){let at=g[rt.a].x,ut=g[rt.a].y,ft=g[rt.b].x,gt=g[rt.b].y,Ct=_e[rt.a],At=_e[rt.b];const kt=ot(Ct,0),zt=ot(At,0);if(kt&&zt)return this.setElevatedPoint(o[0],at,ut,Ct),this.setElevatedPoint(o[1],ft,gt,At),!0;if(!kt&&!zt)return!1;if(kt){if(!zt){const Ut=At/(At-Ct);ft=fs(ft,at,Ut),gt=fs(gt,ut,Ut),At=fs(At,Ct,Ut)}}else{const Ut=Ct/(Ct-At);at=fs(at,ft,Ut),ut=fs(ut,gt,Ut),Ct=fs(Ct,At,Ut)}return this.setElevatedPoint(o[0],at,ut,Ct),this.setElevatedPoint(o[1],ft,gt,At),!0}prepareEdges(o,g){if(g.length===0)return;g.sort((ut,ft)=>ut.hash===ft.hash?ft.polygonIdx-ut.polygonIdx:ft.hash>ut.hash?1:-1);let _e=0,rt=0,ot=0,at=g[_e].polygonIdx;do rt++,(rt===g.length||g[_e].hash!==g[rt].hash)&&((rt-_e==1||g[rt-1].polygonIdx!==at)&&(ot<_e&&(g[ot]=g[_e],g[_e]=null),g[ot].type="none",ot++),_e=rt,_e!==g.length&&(at=g[_e].polygonIdx));while(_e!==g.length);if(g.splice(ot),g.length!==0&&o.length!==0){g.sort((gt,Ct)=>gt.portalHash<Ct.portalHash?1:-1);let ut=0,ft=0;for(;ut!==g.length&&ft!==o.length;){const gt=g[ut],Ct=o[ft];gt.portalHash>Ct.hash?ut++:Ct.hash>gt.portalHash?ft++:(gt.type=Ct.type,ut++)}}}isOnBorder(o,g){return o<=0&&g<=0||o>=Mn&&g>=Mn}addFeatureSection(o,g,_e,rt){return o!==g&&(g=o,_e.push({featureIndex:o,vertexStart:rt.getVertexCount()}),rt.clearVertexLookup()),g}sortSubarray(o,g,_e,rt){const ot=o.slice(g,_e);ot.sort(rt),o.splice(g,ot.length,...ot)}static computeEdgeHash(o,g){return(o.y===g.y&&o.x>g.x||o.y>g.y)&&([o,g]=[g,o]),BigInt(Yu.computePosHash(o))<<32n|BigInt(Yu.computePosHash(g))}static computePosHash(o){return((65535&o.x)<<16|65535&o.y)>>>0}}var wC,EC={exports:{}},TC=(wC||(wC=1,function(_){function o(wr,Cr){return wr>Cr?1:wr<Cr?-1:0}var g=function(wr,Cr){wr===void 0&&(wr=o),Cr===void 0&&(Cr=!1),this._compare=wr,this._root=null,this._size=0,this._noDuplicates=!!Cr},_e={size:{configurable:!0}};function rt(wr,Cr,on,En,Fn){var Bn=Fn-En;if(Bn>0){var rs=En+Math.floor(Bn/2),ss={key:Cr[rs],data:on[rs],parent:wr};return ss.left=rt(ss,Cr,on,En,rs),ss.right=rt(ss,Cr,on,rs+1,Fn),ss}return null}function ot(wr,Cr,on,En,Fn){if(!(on>=En)){for(var Bn=wr[on+En>>1],rs=on-1,ss=En+1;;){do rs++;while(Fn(wr[rs],Bn)<0);do ss--;while(Fn(wr[ss],Bn)>0);if(rs>=ss)break;var Ts=wr[rs];wr[rs]=wr[ss],wr[ss]=Ts,Ts=Cr[rs],Cr[rs]=Cr[ss],Cr[ss]=Ts}ot(wr,Cr,on,ss,Fn),ot(wr,Cr,ss+1,En,Fn)}}g.prototype.rotateLeft=function(wr){var Cr=wr.right;Cr&&(wr.right=Cr.left,Cr.left&&(Cr.left.parent=wr),Cr.parent=wr.parent),wr.parent?wr===wr.parent.left?wr.parent.left=Cr:wr.parent.right=Cr:this._root=Cr,Cr&&(Cr.left=wr),wr.parent=Cr},g.prototype.rotateRight=function(wr){var Cr=wr.left;Cr&&(wr.left=Cr.right,Cr.right&&(Cr.right.parent=wr),Cr.parent=wr.parent),wr.parent?wr===wr.parent.left?wr.parent.left=Cr:wr.parent.right=Cr:this._root=Cr,Cr&&(Cr.right=wr),wr.parent=Cr},g.prototype._splay=function(wr){for(;wr.parent;){var Cr=wr.parent;Cr.parent?Cr.left===wr&&Cr.parent.left===Cr?(this.rotateRight(Cr.parent),this.rotateRight(Cr)):Cr.right===wr&&Cr.parent.right===Cr?(this.rotateLeft(Cr.parent),this.rotateLeft(Cr)):Cr.left===wr&&Cr.parent.right===Cr?(this.rotateRight(Cr),this.rotateLeft(Cr)):(this.rotateLeft(Cr),this.rotateRight(Cr)):Cr.left===wr?this.rotateRight(Cr):this.rotateLeft(Cr)}},g.prototype.splay=function(wr){for(var Cr,on,En,Fn,Bn;wr.parent;)(on=(Cr=wr.parent).parent)&&on.parent?((En=on.parent).left===on?En.left=wr:En.right=wr,wr.parent=En):(wr.parent=null,this._root=wr),Fn=wr.left,Bn=wr.right,wr===Cr.left?(on&&(on.left===Cr?(Cr.right?(on.left=Cr.right,on.left.parent=on):on.left=null,Cr.right=on,on.parent=Cr):(Fn?(on.right=Fn,Fn.parent=on):on.right=null,wr.left=on,on.parent=wr)),Bn?(Cr.left=Bn,Bn.parent=Cr):Cr.left=null,wr.right=Cr,Cr.parent=wr):(on&&(on.right===Cr?(Cr.left?(on.right=Cr.left,on.right.parent=on):on.right=null,Cr.left=on,on.parent=Cr):(Bn?(on.left=Bn,Bn.parent=on):on.left=null,wr.right=on,on.parent=wr)),Fn?(Cr.right=Fn,Fn.parent=Cr):Cr.right=null,wr.left=Cr,Cr.parent=wr)},g.prototype.replace=function(wr,Cr){wr.parent?wr===wr.parent.left?wr.parent.left=Cr:wr.parent.right=Cr:this._root=Cr,Cr&&(Cr.parent=wr.parent)},g.prototype.minNode=function(wr){if(wr===void 0&&(wr=this._root),wr)for(;wr.left;)wr=wr.left;return wr},g.prototype.maxNode=function(wr){if(wr===void 0&&(wr=this._root),wr)for(;wr.right;)wr=wr.right;return wr},g.prototype.insert=function(wr,Cr){var on=this._root,En=null,Fn=this._compare;if(this._noDuplicates)for(;on;){if(En=on,Fn(on.key,wr)===0)return;on=Fn(on.key,wr)<0?on.right:on.left}else for(;on;)En=on,on=Fn(on.key,wr)<0?on.right:on.left;return on={key:wr,data:Cr,left:null,right:null,parent:En},En?Fn(En.key,on.key)<0?En.right=on:En.left=on:this._root=on,this.splay(on),this._size++,on},g.prototype.find=function(wr){for(var Cr=this._root,on=this._compare;Cr;){var En=on(Cr.key,wr);if(En<0)Cr=Cr.right;else{if(!(En>0))return Cr;Cr=Cr.left}}return null},g.prototype.contains=function(wr){for(var Cr=this._root,on=this._compare;Cr;){var En=on(wr,Cr.key);if(En===0)return!0;Cr=En<0?Cr.left:Cr.right}return!1},g.prototype.remove=function(wr){var Cr=this.find(wr);if(!Cr)return!1;if(this.splay(Cr),Cr.left)if(Cr.right){var on=this.minNode(Cr.right);on.parent!==Cr&&(this.replace(on,on.right),on.right=Cr.right,on.right.parent=on),this.replace(Cr,on),on.left=Cr.left,on.left.parent=on}else this.replace(Cr,Cr.left);else this.replace(Cr,Cr.right);return this._size--,!0},g.prototype.removeNode=function(wr){if(!wr)return!1;if(this.splay(wr),wr.left)if(wr.right){var Cr=this.minNode(wr.right);Cr.parent!==wr&&(this.replace(Cr,Cr.right),Cr.right=wr.right,Cr.right.parent=Cr),this.replace(wr,Cr),Cr.left=wr.left,Cr.left.parent=Cr}else this.replace(wr,wr.left);else this.replace(wr,wr.right);return this._size--,!0},g.prototype.erase=function(wr){var Cr=this.find(wr);if(Cr){this.splay(Cr);var on=Cr.left,En=Cr.right,Fn=null;on&&(on.parent=null,Fn=this.maxNode(on),this.splay(Fn),this._root=Fn),En&&(on?Fn.right=En:this._root=En,En.parent=Fn),this._size--}},g.prototype.pop=function(){var wr=this._root,Cr=null;if(wr){for(;wr.left;)wr=wr.left;Cr={key:wr.key,data:wr.data},this.remove(wr.key)}return Cr},g.prototype.next=function(wr){var Cr=wr;if(Cr)if(Cr.right)for(Cr=Cr.right;Cr&&Cr.left;)Cr=Cr.left;else for(Cr=wr.parent;Cr&&Cr.right===wr;)wr=Cr,Cr=Cr.parent;return Cr},g.prototype.prev=function(wr){var Cr=wr;if(Cr)if(Cr.left)for(Cr=Cr.left;Cr&&Cr.right;)Cr=Cr.right;else for(Cr=wr.parent;Cr&&Cr.left===wr;)wr=Cr,Cr=Cr.parent;return Cr},g.prototype.forEach=function(wr){for(var Cr=this._root,on=[],En=!1,Fn=0;!En;)Cr?(on.push(Cr),Cr=Cr.left):on.length>0?(wr(Cr=on.pop(),Fn++),Cr=Cr.right):En=!0;return this},g.prototype.range=function(wr,Cr,on,En){for(var Fn=[],Bn=this._compare,rs=this._root;Fn.length!==0||rs;)if(rs)Fn.push(rs),rs=rs.left;else{if(Bn((rs=Fn.pop()).key,Cr)>0)break;if(Bn(rs.key,wr)>=0&&on.call(En,rs))return this;rs=rs.right}return this},g.prototype.keys=function(){for(var wr=this._root,Cr=[],on=[],En=!1;!En;)wr?(Cr.push(wr),wr=wr.left):Cr.length>0?(wr=Cr.pop(),on.push(wr.key),wr=wr.right):En=!0;return on},g.prototype.values=function(){for(var wr=this._root,Cr=[],on=[],En=!1;!En;)wr?(Cr.push(wr),wr=wr.left):Cr.length>0?(wr=Cr.pop(),on.push(wr.data),wr=wr.right):En=!0;return on},g.prototype.at=function(wr){for(var Cr=this._root,on=[],En=!1,Fn=0;!En;)if(Cr)on.push(Cr),Cr=Cr.left;else if(on.length>0){if(Cr=on.pop(),Fn===wr)return Cr;Fn++,Cr=Cr.right}else En=!0;return null},g.prototype.load=function(wr,Cr,on){if(wr===void 0&&(wr=[]),Cr===void 0&&(Cr=[]),on===void 0&&(on=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var En=wr.length;return on&&ot(wr,Cr,0,En-1,this._compare),this._root=rt(null,wr,Cr,0,En),this._size=En,this},g.prototype.min=function(){var wr=this.minNode(this._root);return wr?wr.key:null},g.prototype.max=function(){var wr=this.maxNode(this._root);return wr?wr.key:null},g.prototype.isEmpty=function(){return this._root===null},_e.size.get=function(){return this._size},g.createTree=function(wr,Cr,on,En,Fn){return new g(on,Fn).load(wr,Cr,En)},Object.defineProperties(g.prototype,_e);var at=0,ut=1,ft=2,gt=3,Ct=0,At=1,kt=2,zt=3;function Ut(wr,Cr,on){Cr===null?(wr.inOut=!1,wr.otherInOut=!0):(wr.isSubject===Cr.isSubject?(wr.inOut=!Cr.inOut,wr.otherInOut=Cr.otherInOut):(wr.inOut=!Cr.otherInOut,wr.otherInOut=Cr.isVertical()?!Cr.inOut:Cr.inOut),Cr&&(wr.prevInResult=!Kt(Cr,on)||Cr.isVertical()?Cr.prevInResult:Cr));var En=Kt(wr,on);wr.resultTransition=En?function(Fn,Bn){var rs,ss=!Fn.inOut,Ts=!Fn.otherInOut;switch(Bn){case Ct:rs=ss&&Ts;break;case At:rs=ss||Ts;break;case zt:rs=ss^Ts;break;case kt:rs=Fn.isSubject?ss&&!Ts:Ts&&!ss}return rs?1:-1}(wr,on):0}function Kt(wr,Cr){switch(wr.type){case at:switch(Cr){case Ct:return!wr.otherInOut;case At:return wr.otherInOut;case kt:return wr.isSubject&&wr.otherInOut||!wr.isSubject&&!wr.otherInOut;case zt:return!0}break;case ft:return Cr===Ct||Cr===At;case gt:return Cr===kt;case ut:return!1}return!1}var er=function(wr,Cr,on,En,Fn){this.left=Cr,this.point=wr,this.otherEvent=on,this.isSubject=En,this.type=Fn||at,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},Jt={inResult:{configurable:!0}};function or(wr,Cr){return wr[0]===Cr[0]&&wr[1]===Cr[1]}er.prototype.isBelow=function(wr){var Cr=this.point,on=this.otherEvent.point;return this.left?(Cr[0]-wr[0])*(on[1]-wr[1])-(on[0]-wr[0])*(Cr[1]-wr[1])>0:(on[0]-wr[0])*(Cr[1]-wr[1])-(Cr[0]-wr[0])*(on[1]-wr[1])>0},er.prototype.isAbove=function(wr){return!this.isBelow(wr)},er.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},Jt.inResult.get=function(){return this.resultTransition!==0},er.prototype.clone=function(){var wr=new er(this.point,this.left,this.otherEvent,this.isSubject,this.type);return wr.contourId=this.contourId,wr.resultTransition=this.resultTransition,wr.prevInResult=this.prevInResult,wr.isExteriorRing=this.isExteriorRing,wr.inOut=this.inOut,wr.otherInOut=this.otherInOut,wr},Object.defineProperties(er.prototype,Jt);var lr=11102230246251565e-32,pr=134217729,Sr=(3+8*lr)*lr;function br(wr,Cr,on,En,Fn){var Bn,rs,ss,Ts,Ns=Cr[0],Os=En[0],zs=0,ds=0;Os>Ns==Os>-Ns?(Bn=Ns,Ns=Cr[++zs]):(Bn=Os,Os=En[++ds]);var ys=0;if(zs<wr&&ds<on)for(Os>Ns==Os>-Ns?(ss=Bn-((rs=Ns+Bn)-Ns),Ns=Cr[++zs]):(ss=Bn-((rs=Os+Bn)-Os),Os=En[++ds]),Bn=rs,ss!==0&&(Fn[ys++]=ss);zs<wr&&ds<on;)Os>Ns==Os>-Ns?(ss=Bn-((rs=Bn+Ns)-(Ts=rs-Bn))+(Ns-Ts),Ns=Cr[++zs]):(ss=Bn-((rs=Bn+Os)-(Ts=rs-Bn))+(Os-Ts),Os=En[++ds]),Bn=rs,ss!==0&&(Fn[ys++]=ss);for(;zs<wr;)ss=Bn-((rs=Bn+Ns)-(Ts=rs-Bn))+(Ns-Ts),Ns=Cr[++zs],Bn=rs,ss!==0&&(Fn[ys++]=ss);for(;ds<on;)ss=Bn-((rs=Bn+Os)-(Ts=rs-Bn))+(Os-Ts),Os=En[++ds],Bn=rs,ss!==0&&(Fn[ys++]=ss);return Bn===0&&ys!==0||(Fn[ys++]=Bn),ys}function Rr(wr){return new Float64Array(wr)}var Mr=33306690738754716e-32,Lr=22204460492503146e-32,Jr=11093356479670487e-47,zr=Rr(4),sn=Rr(8),dn=Rr(12),pn=Rr(16),wn=Rr(4);function Tn(wr,Cr,on){var En=function(Fn,Bn,rs,ss,Ts,Ns){var Os=(Bn-Ns)*(rs-Ts),zs=(Fn-Ts)*(ss-Ns),ds=Os-zs;if(Os===0||zs===0||Os>0!=zs>0)return ds;var ys=Math.abs(Os+zs);return Math.abs(ds)>=Mr*ys?ds:-function(Qs,io,no,go,Ao,bo,oo){var ho,Ls,Hs,$o,us,Vs,Eo,Io,No,El,ko,hs,qo,_o,zo,Vl,Ql,Dl,Nl=Qs-Ao,Wl=no-Ao,Fu=io-bo,Mo=go-bo;zr[0]=(zo=(Io=Nl-(Eo=(Vs=pr*Nl)-(Vs-Nl)))*(El=Mo-(No=(Vs=pr*Mo)-(Vs-Mo)))-((_o=Nl*Mo)-Eo*No-Io*No-Eo*El))-((ko=zo-(Ql=(Io=Fu-(Eo=(Vs=pr*Fu)-(Vs-Fu)))*(El=Wl-(No=(Vs=pr*Wl)-(Vs-Wl)))-((Vl=Fu*Wl)-Eo*No-Io*No-Eo*El)))+(us=zo-ko))+(us-Ql),zr[1]=(qo=_o-((hs=_o+ko)-(us=hs-_o))+(ko-us))-((ko=qo-Vl)+(us=qo-ko))+(us-Vl),zr[2]=hs-((Dl=hs+ko)-(us=Dl-hs))+(ko-us),zr[3]=Dl;var yl=function(Um,uu){for(var ku=uu[0],Ju=1;Ju<4;Ju++)ku+=uu[Ju];return ku}(0,zr),Tl=Lr*oo;if(yl>=Tl||-yl>=Tl||(ho=Qs-(Nl+(us=Qs-Nl))+(us-Ao),Hs=no-(Wl+(us=no-Wl))+(us-Ao),Ls=io-(Fu+(us=io-Fu))+(us-bo),$o=go-(Mo+(us=go-Mo))+(us-bo),ho===0&&Ls===0&&Hs===0&&$o===0)||(Tl=Jr*oo+Sr*Math.abs(yl),(yl+=Nl*$o+Mo*ho-(Fu*Hs+Wl*Ls))>=Tl||-yl>=Tl))return yl;wn[0]=(zo=(Io=ho-(Eo=(Vs=pr*ho)-(Vs-ho)))*(El=Mo-(No=(Vs=pr*Mo)-(Vs-Mo)))-((_o=ho*Mo)-Eo*No-Io*No-Eo*El))-((ko=zo-(Ql=(Io=Ls-(Eo=(Vs=pr*Ls)-(Vs-Ls)))*(El=Wl-(No=(Vs=pr*Wl)-(Vs-Wl)))-((Vl=Ls*Wl)-Eo*No-Io*No-Eo*El)))+(us=zo-ko))+(us-Ql),wn[1]=(qo=_o-((hs=_o+ko)-(us=hs-_o))+(ko-us))-((ko=qo-Vl)+(us=qo-ko))+(us-Vl),wn[2]=hs-((Dl=hs+ko)-(us=Dl-hs))+(ko-us),wn[3]=Dl;var Uu=br(4,zr,4,wn,sn);wn[0]=(zo=(Io=Nl-(Eo=(Vs=pr*Nl)-(Vs-Nl)))*(El=$o-(No=(Vs=pr*$o)-(Vs-$o)))-((_o=Nl*$o)-Eo*No-Io*No-Eo*El))-((ko=zo-(Ql=(Io=Fu-(Eo=(Vs=pr*Fu)-(Vs-Fu)))*(El=Hs-(No=(Vs=pr*Hs)-(Vs-Hs)))-((Vl=Fu*Hs)-Eo*No-Io*No-Eo*El)))+(us=zo-ko))+(us-Ql),wn[1]=(qo=_o-((hs=_o+ko)-(us=hs-_o))+(ko-us))-((ko=qo-Vl)+(us=qo-ko))+(us-Vl),wn[2]=hs-((Dl=hs+ko)-(us=Dl-hs))+(ko-us),wn[3]=Dl;var Ul=br(Uu,sn,4,wn,dn);wn[0]=(zo=(Io=ho-(Eo=(Vs=pr*ho)-(Vs-ho)))*(El=$o-(No=(Vs=pr*$o)-(Vs-$o)))-((_o=ho*$o)-Eo*No-Io*No-Eo*El))-((ko=zo-(Ql=(Io=Ls-(Eo=(Vs=pr*Ls)-(Vs-Ls)))*(El=Hs-(No=(Vs=pr*Hs)-(Vs-Hs)))-((Vl=Ls*Hs)-Eo*No-Io*No-Eo*El)))+(us=zo-ko))+(us-Ql),wn[1]=(qo=_o-((hs=_o+ko)-(us=hs-_o))+(ko-us))-((ko=qo-Vl)+(us=qo-ko))+(us-Vl),wn[2]=hs-((Dl=hs+ko)-(us=Dl-hs))+(ko-us),wn[3]=Dl;var Wp=br(Ul,dn,4,wn,pn);return pn[Wp-1]}(Fn,Bn,rs,ss,Ts,Ns,ys)}(wr[0],wr[1],Cr[0],Cr[1],on[0],on[1]);return En>0?-1:En<0?1:0}function xn(wr,Cr){var on=wr.point,En=Cr.point;return on[0]>En[0]?1:on[0]<En[0]?-1:on[1]!==En[1]?on[1]>En[1]?1:-1:function(Fn,Bn,rs,ss){return Fn.left!==Bn.left?Fn.left?1:-1:Tn(rs,Fn.otherEvent.point,Bn.otherEvent.point)!==0?Fn.isBelow(Bn.otherEvent.point)?-1:1:!Fn.isSubject&&Bn.isSubject?1:-1}(wr,Cr,on)}function vn(wr,Cr,on){var En=new er(Cr,!1,wr,wr.isSubject),Fn=new er(Cr,!0,wr.otherEvent,wr.isSubject);return or(wr.point,wr.otherEvent.point)&&console.warn("what is that, a collapsed segment?",wr),En.contourId=Fn.contourId=wr.contourId,xn(Fn,wr.otherEvent)>0&&(wr.otherEvent.left=!0,Fn.left=!1),wr.otherEvent.otherEvent=Fn,wr.otherEvent=En,on.push(Fn),on.push(En),on}function nn(wr,Cr){return wr[0]*Cr[1]-wr[1]*Cr[0]}function en(wr,Cr){return wr[0]*Cr[0]+wr[1]*Cr[1]}function bn(wr,Cr,on){var En=function(Ts,Ns,Os,zs,ds){var ys=[Ns[0]-Ts[0],Ns[1]-Ts[1]],Qs=[zs[0]-Os[0],zs[1]-Os[1]];function io(Vs,Eo,Io){return[Vs[0]+Eo*Io[0],Vs[1]+Eo*Io[1]]}var no=[Os[0]-Ts[0],Os[1]-Ts[1]],go=nn(ys,Qs),Ao=go*go,bo=en(ys,ys);if(Ao>0){var oo=nn(no,Qs)/go;if(oo<0||oo>1)return null;var ho=nn(no,ys)/go;return ho<0||ho>1?null:oo===0||oo===1?[io(Ts,oo,ys)]:ho===0||ho===1?[io(Os,ho,Qs)]:[io(Ts,oo,ys)]}if((Ao=(go=nn(no,ys))*go)>0)return null;var Ls=en(ys,no)/bo,Hs=Ls+en(ys,Qs)/bo,$o=Math.min(Ls,Hs),us=Math.max(Ls,Hs);return $o<=1&&us>=0?$o===1?[io(Ts,$o>0?$o:0,ys)]:us===0?[io(Ts,us<1?us:1,ys)]:[io(Ts,$o>0?$o:0,ys),io(Ts,us<1?us:1,ys)]:null}(wr.point,wr.otherEvent.point,Cr.point,Cr.otherEvent.point),Fn=En?En.length:0;if(Fn===0||Fn===1&&(or(wr.point,Cr.point)||or(wr.otherEvent.point,Cr.otherEvent.point))||Fn===2&&wr.isSubject===Cr.isSubject)return 0;if(Fn===1)return or(wr.point,En[0])||or(wr.otherEvent.point,En[0])||vn(wr,En[0],on),or(Cr.point,En[0])||or(Cr.otherEvent.point,En[0])||vn(Cr,En[0],on),1;var Bn=[],rs=!1,ss=!1;return or(wr.point,Cr.point)?rs=!0:xn(wr,Cr)===1?Bn.push(Cr,wr):Bn.push(wr,Cr),or(wr.otherEvent.point,Cr.otherEvent.point)?ss=!0:xn(wr.otherEvent,Cr.otherEvent)===1?Bn.push(Cr.otherEvent,wr.otherEvent):Bn.push(wr.otherEvent,Cr.otherEvent),rs&&ss||rs?(Cr.type=ut,wr.type=Cr.inOut===wr.inOut?ft:gt,rs&&!ss&&vn(Bn[1].otherEvent,Bn[0].point,on),2):ss?(vn(Bn[0],Bn[1].point,on),3):Bn[0]!==Bn[3].otherEvent?(vn(Bn[0],Bn[1].point,on),vn(Bn[1],Bn[2].point,on),3):(vn(Bn[0],Bn[1].point,on),vn(Bn[3].otherEvent,Bn[2].point,on),3)}function Dn(wr,Cr){if(wr===Cr)return 0;if(Tn(wr.point,wr.otherEvent.point,Cr.point)!==0||Tn(wr.point,wr.otherEvent.point,Cr.otherEvent.point)!==0)return or(wr.point,Cr.point)?wr.isBelow(Cr.otherEvent.point)?-1:1:wr.point[0]===Cr.point[0]?wr.point[1]<Cr.point[1]?-1:1:xn(wr,Cr)===1?Cr.isAbove(wr.point)?-1:1:wr.isBelow(Cr.point)?-1:1;if(wr.isSubject!==Cr.isSubject)return wr.isSubject?-1:1;var on=wr.point,En=Cr.point;return on[0]===En[0]&&on[1]===En[1]?(on=wr.otherEvent.point)[0]===(En=Cr.otherEvent.point)[0]&&on[1]===En[1]?0:wr.contourId>Cr.contourId?1:-1:xn(wr,Cr)===1?1:-1}var Rn=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function ts(wr,Cr,on,En){var Fn,Bn=wr+1,rs=Cr[wr].point,ss=Cr.length;for(Bn<ss&&(Fn=Cr[Bn].point);Bn<ss&&Fn[0]===rs[0]&&Fn[1]===rs[1];){if(!on[Bn])return Bn;++Bn<ss&&(Fn=Cr[Bn].point)}for(Bn=wr-1;on[Bn]&&Bn>En;)Bn--;return Bn}Rn.prototype.isExterior=function(){return this.holeOf==null};var Vn=Zn,Hn=Zn;function Zn(wr,Cr){if(!(this instanceof Zn))return new Zn(wr,Cr);if(this.data=wr||[],this.length=this.data.length,this.compare=Cr||js,this.length>0)for(var on=(this.length>>1)-1;on>=0;on--)this._down(on)}function js(wr,Cr){return wr<Cr?-1:wr>Cr?1:0}Zn.prototype={push:function(wr){this.data.push(wr),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var wr=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),wr}},peek:function(){return this.data[0]},_up:function(wr){for(var Cr=this.data,on=this.compare,En=Cr[wr];wr>0;){var Fn=wr-1>>1,Bn=Cr[Fn];if(on(En,Bn)>=0)break;Cr[wr]=Bn,wr=Fn}Cr[wr]=En},_down:function(wr){for(var Cr=this.data,on=this.compare,En=this.length>>1,Fn=Cr[wr];wr<En;){var Bn=1+(wr<<1),rs=Bn+1,ss=Cr[Bn];if(rs<this.length&&on(Cr[rs],ss)<0&&(Bn=rs,ss=Cr[rs]),on(ss,Fn)>=0)break;Cr[wr]=ss,wr=Bn}Cr[wr]=Fn}},Vn.default=Hn;var In=Math.max,Yn=Math.min,xs=0;function Gs(wr,Cr,on,En,Fn,Bn){var rs,ss,Ts,Ns,Os,zs;for(rs=0,ss=wr.length-1;rs<ss;rs++)if(Ns=wr[rs+1],Os=new er(Ts=wr[rs],!1,void 0,Cr),zs=new er(Ns,!1,Os,Cr),Os.otherEvent=zs,Ts[0]!==Ns[0]||Ts[1]!==Ns[1]){Os.contourId=zs.contourId=on,Bn||(Os.isExteriorRing=!1,zs.isExteriorRing=!1),xn(Os,zs)>0?zs.left=!0:Os.left=!0;var ds=Ts[0],ys=Ts[1];Fn[0]=Yn(Fn[0],ds),Fn[1]=Yn(Fn[1],ys),Fn[2]=In(Fn[2],ds),Fn[3]=In(Fn[3],ys),En.push(Os),En.push(zs)}}var Ws=[];function Rs(wr,Cr,on){typeof wr[0][0][0]=="number"&&(wr=[wr]),typeof Cr[0][0][0]=="number"&&(Cr=[Cr]);var En=function(ys,Qs,io){var no=null;return ys.length*Qs.length==0&&(io===Ct?no=Ws:io===kt?no=ys:io!==At&&io!==zt||(no=ys.length===0?Qs:ys)),no}(wr,Cr,on);if(En)return En===Ws?null:En;var Fn=[1/0,1/0,-1/0,-1/0],Bn=[1/0,1/0,-1/0,-1/0],rs=function(ys,Qs,io,no,go){var Ao,bo,oo,ho,Ls,Hs,$o=new Vn(null,xn);for(oo=0,ho=ys.length;oo<ho;oo++)for(Ls=0,Hs=(Ao=ys[oo]).length;Ls<Hs;Ls++)(bo=Ls===0)&&xs++,Gs(Ao[Ls],!0,xs,$o,io,bo);for(oo=0,ho=Qs.length;oo<ho;oo++)for(Ls=0,Hs=(Ao=Qs[oo]).length;Ls<Hs;Ls++)bo=Ls===0,go===kt&&(bo=!1),bo&&xs++,Gs(Ao[Ls],!1,xs,$o,no,bo);return $o}(wr,Cr,Fn,Bn,on);if(En=function(ys,Qs,io,no,go){var Ao=null;return(io[0]>no[2]||no[0]>io[2]||io[1]>no[3]||no[1]>io[3])&&(go===Ct?Ao=Ws:go===kt?Ao=ys:go!==At&&go!==zt||(Ao=ys.concat(Qs))),Ao}(wr,Cr,Fn,Bn,on))return En===Ws?null:En;for(var ss=function(ys){var Qs,io,no=function(oo){var ho,Ls,Hs,$o,us=[];for(Ls=0,Hs=oo.length;Ls<Hs;Ls++)((ho=oo[Ls]).left&&ho.inResult||!ho.left&&ho.otherEvent.inResult)&&us.push(ho);for(var Vs=!1;!Vs;)for(Vs=!0,Ls=0,Hs=us.length;Ls<Hs;Ls++)Ls+1<Hs&&xn(us[Ls],us[Ls+1])===1&&($o=us[Ls],us[Ls]=us[Ls+1],us[Ls+1]=$o,Vs=!1);for(Ls=0,Hs=us.length;Ls<Hs;Ls++)(ho=us[Ls]).otherPos=Ls;for(Ls=0,Hs=us.length;Ls<Hs;Ls++)(ho=us[Ls]).left||($o=ho.otherPos,ho.otherPos=ho.otherEvent.otherPos,ho.otherEvent.otherPos=$o);return us}(ys),go={},Ao=[],bo=function(){if(!go[Qs]){var oo=Ao.length,ho=function(us,Vs,Eo){var Io=new Rn;if(us.prevInResult!=null){var No=us.prevInResult,El=No.outputContourId;if(No.resultTransition>0){var ko=Vs[El];if(ko.holeOf!=null){var hs=ko.holeOf;Vs[hs].holeIds.push(Eo),Io.holeOf=hs,Io.depth=Vs[El].depth}else Vs[El].holeIds.push(Eo),Io.holeOf=El,Io.depth=Vs[El].depth+1}else Io.holeOf=null,Io.depth=Vs[El].depth}else Io.holeOf=null,Io.depth=0;return Io}(no[Qs],Ao,oo),Ls=function(us){go[us]=!0,us<no.length&&no[us]&&(no[us].outputContourId=oo)},Hs=Qs,$o=Qs;for(ho.points.push(no[Qs].point);Ls(Hs),Ls(Hs=no[Hs].otherPos),ho.points.push(no[Hs].point),!((Hs=ts(Hs,no,go,$o))==$o||Hs>=no.length)&&no[Hs];);Ao.push(ho)}};for(Qs=0,io=no.length;Qs<io;Qs++)bo();return Ao}(function(ys,Qs,io,no,go,Ao){for(var bo,oo,ho,Ls=new g(Dn),Hs=[],$o=Math.min(no[2],go[2]);ys.length!==0;){var us=ys.pop();if(Hs.push(us),Ao===Ct&&us.point[0]>$o||Ao===kt&&us.point[0]>no[2])break;if(us.left){oo=bo=Ls.insert(us),bo=bo!==(ho=Ls.minNode())?Ls.prev(bo):null,oo=Ls.next(oo);var Vs=bo?bo.key:null;if(Ut(us,Vs,Ao),oo&&bn(us,oo.key,ys)===2&&(Ut(us,Vs,Ao),Ut(oo.key,us,Ao)),bo&&bn(bo.key,us,ys)===2){var Eo=bo;Ut(Vs,(Eo=Eo!==ho?Ls.prev(Eo):null)?Eo.key:null,Ao),Ut(us,Vs,Ao)}}else oo=bo=Ls.find(us=us.otherEvent),bo&&oo&&(bo=bo!==ho?Ls.prev(bo):null,oo=Ls.next(oo),Ls.remove(us),oo&&bo&&bn(bo.key,oo.key,ys))}return Hs}(rs,0,0,Fn,Bn,on)),Ts=[],Ns=0;Ns<ss.length;Ns++){var Os=ss[Ns];if(Os.isExterior()){for(var zs=[Os.points],ds=0;ds<Os.holeIds.length;ds++)zs.push(ss[Os.holeIds[ds]].points);Ts.push(zs)}}return Ts}var vo={UNION:At,DIFFERENCE:kt,INTERSECTION:Ct,XOR:zt};_.diff=function(wr,Cr){return Rs(wr,Cr,kt)},_.intersection=function(wr,Cr){return Rs(wr,Cr,Ct)},_.operations=vo,_.union=function(wr,Cr){return Rs(wr,Cr,At)},_.xor=function(wr,Cr){return Rs(wr,Cr,zt)},Object.defineProperty(_,"__esModule",{value:!0})}(EC.exports)),EC.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function lE(_,o,g,_e){const rt=[],ot=_e===0?(at,ut,ft,gt,Ct,At)=>{at.push(new mn(At,ft+(At-ut)/(gt-ut)*(Ct-ft)))}:(at,ut,ft,gt,Ct,At)=>{at.push(new mn(ut+(At-ft)/(Ct-ft)*(gt-ut),At))};for(const at of _){const ut=[];for(const ft of at){if(ft.length<=2)continue;const gt=[];for(let kt=0;kt<ft.length-1;kt++){const zt=ft[kt].x,Ut=ft[kt].y,Kt=ft[kt+1].x,er=ft[kt+1].y,Jt=_e===0?zt:Ut,or=_e===0?Kt:er;Jt<o?or>o&&ot(gt,zt,Ut,Kt,er,o):Jt>g?or<g&&ot(gt,zt,Ut,Kt,er,g):gt.push(ft[kt]),or<o&&Jt>=o&&ot(gt,zt,Ut,Kt,er,o),or>g&&Jt<=g&&ot(gt,zt,Ut,Kt,er,g)}let Ct=ft[ft.length-1];const At=_e===0?Ct.x:Ct.y;At>=o&&At<=g&&gt.push(Ct),gt.length&&(Ct=gt[gt.length-1],gt[0].x===Ct.x&&gt[0].y===Ct.y||gt.push(gt[0]),ut.push(gt))}ut.length&&rt.push(ut)}return rt}function TI(_,o){const g=zT(_),_e=zT([o]),rt=TC.intersection(g,_e);return rt==null?[]:SC(rt)}function SI(_,o){let _e=zT(_,65536);const rt=[];for(;o.valid();o.next()){const[ot,at]=o.get(),ut=ot.x*65536,ft=ot.y*65536,gt=at.x*65536,Ct=at.y*65536,At=gt-ut,kt=Ct-ft,zt=Math.hypot(At,kt);if(zt===0)continue;const Ut=Math.trunc(kt/zt*3),Kt=-Math.trunc(At/zt*3);rt.push([[[ut,ft],[gt,Ct],[gt+Ut,Ct+Kt],[ut+Ut,ft+Kt],[ut,ft]]])}return rt.length>0&&(_e=TC.diff(_e,rt)),SC(_e,1/65536)}function zT(_,o=1){return[_.map(g=>g.map(_e=>[_e.x*o,_e.y*o]))]}function SC(_,o=1){return _.map(g=>g.map((_e,rt)=>{const ot=_e.map(at=>new mn(at[0]*o,at[1]*o).round());return rt>0&&ot.reverse(),ot}))}class VT{constructor(o,g){this.layoutVertexArray=new Lm,this.indexArray=new Fl,this.lineIndexArray=new Xu,this.triangleSegments=new Go,this.lineSegments=new Go,this.programConfigurations=new Tp(o.layers,{zoom:o.zoom,lut:o.lut}),this.uploaded=!1,g&&(this.elevatedLayoutVertexArray=new im)}update(o,g,_e,rt,ot,at,ut,ft){this.programConfigurations.updatePaintArrays(o,g,ot,_e,rt,at,ut,ft)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,cI.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.lineIndexBuffer=o.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=o.createVertexBuffer(this.elevatedLayoutVertexArray,uI.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(o,g,_e,rt,ot,at,ut){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,g,_e,rt,ot,at,void 0,ut)}}class UT{constructor(o){this.zoom=o.zoom,this.pixelRatio=o.pixelRatio,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=o.lut,this.bufferData=new VT(o,!1),this.elevationBufferData=new VT(o,!0),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.projection=o.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=o.sourceLayerIndex,this.worldview=o.worldview,this.hasAppearances=null}updateFootprints(o,g){}updateAppearances(o,g,_e,rt){}populate(o,g,_e,rt){this.hasPattern=FT("fill",this.layers,this.pixelRatio,g);const ot=this.layers[0].layout.get("fill-sort-key"),at=[];for(const{feature:ut,id:ft,index:gt,sourceLayerIndex:Ct}of o){const At=this.layers[0]._featureFilter.needGeometry,kt=Br(ut,At);if(!this.layers[0]._featureFilter.filter(new Do(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),kt,_e))continue;const zt=ot?ot.evaluate(kt,{},_e,g.availableImages):void 0,Ut={id:ft,properties:ut.properties,type:ut.type,sourceLayerIndex:Ct,index:gt,geometry:At?kt.geometry:Pr(ut,_e,rt),patterns:{},sortKey:zt};at.push(Ut)}ot&&at.sort((ut,ft)=>ut.sortKey-ft.sortKey);for(const ut of at){const{geometry:ft,index:gt,sourceLayerIndex:Ct}=ut;if(this.hasPattern){const At=BT("fill",this.layers,ut,this.zoom,this.pixelRatio,g);this.patternFeatures.push(At)}else this.addFeature(ut,ft,gt,_e,{},g.availableImages,g.brightness,g.elevationFeatures);g.featureIndex.insert(o[gt].feature,ft,gt,Ct,this.index)}}update(o,g,_e,rt,ot,at,ut){this.bufferData.update(o,g,_e,rt,ot,at,ut,this.worldview),this.elevationBufferData.update(o,g,_e,rt,ot,at,ut,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(o,g,_e,rt,ot,at,ut,this.worldview)}addFeatures(o,g,_e,rt,ot,at){for(const ut of this.patternFeatures)this.addFeature(ut,ut.geometry,ut.index,g,_e,rt,at,o.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(o){this.bufferData.upload(o),this.elevationBufferData.upload(o),this.elevatedStructures&&this.elevatedStructures.upload(o)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(o,g,_e,rt,ot,at=[],ut,ft){const gt=m1(g,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(o,gt,rt,_e,ft):this.addGeometry(gt,this.bufferData),this.bufferData.populatePaintArrays(o,_e,ot,at,rt,ut,this.worldview),this.elevationBufferData.populatePaintArrays(o,_e,ot,at,rt,ut,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(o,g,_e,rt,ot){this.elevatedStructures&&(this.elevatedStructures.construct(o),this.elevatedStructures.populatePaintArrays(g,_e,rt,ot,this.worldview))}addElevatedRoadFeature(o,g,_e,rt,ot){const at=new Array,ut=co.getElevationFeature(o,ot);if(!ut)return void this.addGeometry(g,this.bufferData);{const gt=this.clipPolygonsToTile(g,1);gt.length>0&&at.push({polygons:gt,elevationFeature:ut,elevationTileID:_e})}const ft={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(o,{},_e),featureIndex:rt};for(const gt of at)if(gt.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Yu(gt.elevationTileID,this.layers,this.zoom,this.lut));const At=gt.elevationFeature.isTunnel();let kt=0;o.properties.hasOwnProperty(Kr)&&(kt=+o.properties[Kr]);for(const zt of gt.polygons)this.elevatedStructures.addPortalCandidates(gt.elevationFeature.id,zt,At,gt.elevationFeature,kt)}gt.elevationFeature.constantHeight==null&&(gt.polygons=this.prepareElevatedPolygons(gt.polygons,gt.elevationFeature,gt.elevationTileID));const Ct=new xo(_e,gt.elevationTileID);this.addElevatedGeometry(gt.polygons,Ct,gt.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,rt,ft)}}addElevatedGeometry(o,g,_e,rt,ot,at){const ut={elevation:_e,elevationSampler:g,bias:rt,index:ot,featureInfo:at},[ft,gt]=this.addGeometry(o,this.elevationBufferData,ut);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:ft,max:gt}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,ft),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,gt))}addGeometry(o,g,_e){let rt=Number.POSITIVE_INFINITY,ot=Number.NEGATIVE_INFINITY,at=null;_e&&(at=_e.elevationSampler.constantElevation(_e.elevation,_e.bias),at!=null&&(rt=at,ot=at));const ut=(ft,gt,Ct)=>{if(_e!=null)if(gt.push(ft),at!=null)g.elevatedLayoutVertexArray.emplaceBack(at),Ct.push(at);else{const At=_e.elevationSampler.pointElevation(ft,_e.elevation,_e.bias);g.elevatedLayoutVertexArray.emplaceBack(At),Ct.push(At),rt=Math.min(rt,At),ot=Math.max(ot,At)}};for(const ft of o){let gt=0;for(const lr of ft)gt+=lr.length;const Ct=g.triangleSegments.prepareSegment(gt,g.layoutVertexArray,g.indexArray),At=Ct.vertexLength,kt=[],zt=[],Ut=[],Kt=[],er=[],Jt=g.layoutVertexArray.length;for(const lr of ft){if(lr.length===0)continue;lr!==ft[0]&&zt.push(kt.length/2);const pr=g.lineSegments.prepareSegment(lr.length,g.layoutVertexArray,g.lineIndexArray),Sr=pr.vertexLength;_e&&er.push(g.layoutVertexArray.length-Jt),ut(lr[0],Ut,Kt),g.layoutVertexArray.emplaceBack(lr[0].x,lr[0].y),g.lineIndexArray.emplaceBack(Sr+lr.length-1,Sr),kt.push(lr[0].x),kt.push(lr[0].y);for(let br=1;br<lr.length;br++)ut(lr[br],Ut,Kt),g.layoutVertexArray.emplaceBack(lr[br].x,lr[br].y),g.lineIndexArray.emplaceBack(Sr+br-1,Sr+br),kt.push(lr[br].x),kt.push(lr[br].y);pr.vertexLength+=lr.length,pr.primitiveLength+=lr.length}const or=Ax(kt,zt);for(let lr=0;lr<or.length;lr+=3)g.indexArray.emplaceBack(At+or[lr],At+or[lr+1],At+or[lr+2]);if(or.length>0&&_e&&this.elevationMode==="hd-road-base"){const lr=_e.elevation.isTunnel(),pr=_e.elevation.safeArea,Sr=this.elevatedStructures.addVertices(Ut,Kt);this.elevatedStructures.addTriangles(or,Sr,lr);const br=er.length;if(br>0){for(let Rr=0;Rr<br-1;Rr++)this.elevatedStructures.addRenderableRing(_e.index,er[Rr]+Sr,er[Rr+1]-er[Rr],lr,pr,_e.featureInfo);this.elevatedStructures.addRenderableRing(_e.index,er[br-1]+Sr,Ut.length-er[br-1],lr,pr,_e.featureInfo)}}Ct.vertexLength+=gt,Ct.primitiveLength+=or.length/3}return[rt,ot]}prepareElevatedPolygons(o,g,_e){const rt=1/ir(_e),ot=[];for(const at of o){const ut=SI(at,new ro(g,rt));ot.push(...ut)}return ot}clipPolygonsToTile(o,g){const _e=-g,rt=-g,ot=Mn+g,at=Mn+g;let ut=0;const ft=[],gt=[];for(;ut<o.length;ut++){const kt=o[ut],zt=Qp(kt);(zt.min.x>=_e&&zt.max.x<=ot&&zt.min.y>=rt&&zt.max.y<=at?ft:gt).push(kt)}if(ft.length===o.length)return o;const Ct=[new mn(_e,rt),new mn(ot,rt),new mn(ot,at),new mn(_e,at),new mn(_e,rt)],At=ft;for(const kt of gt)At.push(...TI(kt,Ct));return At}}let CC,AC,RC,IC;qn(UT,"FillBucket",{omit:["layers","patternFeatures"]}),qn(VT,"FillBufferData"),qn(Yu,"ElevatedStructures");class cE{constructor(o,g,_e,rt){if(this.triangleCount=g.length/3,this.min=new mn(0,0),this.max=new mn(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||o.length===0)return;const[ot,at]=[o[0].clone(),o[0].clone()];for(let At=1;At<o.length;++At){const kt=o[At];ot.x=Math.min(ot.x,kt.x),ot.y=Math.min(ot.y,kt.y),at.x=Math.max(at.x,kt.x),at.y=Math.max(at.y,kt.y)}if(rt){const At=Math.ceil(Math.max(at.x-ot.x,at.y-ot.y)/rt);_e=Math.max(_e,At)}if(_e===0)return;this.min=ot,this.max=at;const ut=this.max.sub(this.min);ut.x=Math.max(ut.x,1),ut.y=Math.max(ut.y,1);const ft=Math.max(ut.x,ut.y)/_e;this.cellsX=Math.max(1,Math.ceil(ut.x/ft)),this.cellsY=Math.max(1,Math.ceil(ut.y/ft)),this.xScale=1/ft,this.yScale=1/ft;const gt=[];for(let At=0;At<this.triangleCount;At++){const kt=o[g[3*At+0]].sub(this.min),zt=o[g[3*At+1]].sub(this.min),Ut=o[g[3*At+2]].sub(this.min),Kt=zm(Math.floor(Math.min(kt.x,zt.x,Ut.x)),this.xScale,this.cellsX),er=zm(Math.floor(Math.max(kt.x,zt.x,Ut.x)),this.xScale,this.cellsX),Jt=zm(Math.floor(Math.min(kt.y,zt.y,Ut.y)),this.yScale,this.cellsY),or=zm(Math.floor(Math.max(kt.y,zt.y,Ut.y)),this.yScale,this.cellsY),lr=new mn(0,0),pr=new mn(0,0),Sr=new mn(0,0),br=new mn(0,0);for(let Rr=Jt;Rr<=or;++Rr){lr.y=pr.y=Rr*ft,Sr.y=br.y=(Rr+1)*ft;for(let Mr=Kt;Mr<=er;++Mr)lr.x=Sr.x=Mr*ft,pr.x=br.x=(Mr+1)*ft,(gu(kt,zt,Ut,lr,pr,br)||gu(kt,zt,Ut,lr,br,Sr))&&gt.push({cellIdx:Rr*this.cellsX+Mr,triIdx:At})}}if(gt.length===0)return;gt.sort((At,kt)=>At.cellIdx-kt.cellIdx||At.triIdx-kt.triIdx);let Ct=0;for(;Ct<gt.length;){const At=gt[Ct].cellIdx,kt={start:this.payload.length,len:0};for(;Ct<gt.length&&gt[Ct].cellIdx===At;)++kt.len,this.payload.push(gt[Ct++].triIdx);this.cells[At]=kt}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(o,g){if(this.triangleCount===0||this.cells.length===0||o.x>this.max.x||this.min.x>o.x||o.y>this.max.y||this.min.y>o.y)return;const _e=zm(o.x-this.min.x,this.xScale,this.cellsX),rt=zm(o.y-this.min.y,this.yScale,this.cellsY),ot=this.cells[rt*this.cellsX+_e];if(ot){this._lazyInitLookup();for(let at=0;at<ot.len;at++){const ut=this.payload[ot.start+at],ft=Math.floor(ut/8),gt=1<<ut%8;if(!(this.lookup[ft]&gt)&&(this.lookup[ft]|=gt,g.push(ut),g.length===this.triangleCount))return}}}query(o,g,_e){if(this.triangleCount===0||this.cells.length===0||o.x>this.max.x||this.min.x>g.x||o.y>this.max.y||this.min.y>g.y)return;this._lazyInitLookup();const rt=zm(o.x-this.min.x,this.xScale,this.cellsX),ot=zm(g.x-this.min.x,this.xScale,this.cellsX),at=zm(o.y-this.min.y,this.yScale,this.cellsY),ut=zm(g.y-this.min.y,this.yScale,this.cellsY);for(let ft=at;ft<=ut;ft++)for(let gt=rt;gt<=ot;gt++){const Ct=this.cells[ft*this.cellsX+gt];if(Ct)for(let At=0;At<Ct.len;At++){const kt=this.payload[Ct.start+At],zt=Math.floor(kt/8),Ut=1<<kt%8;if(!(this.lookup[zt]&Ut)&&(this.lookup[zt]|=Ut,_e.push(kt),_e.length===this.triangleCount))return}}}}function zm(_,o,g){return Math.max(0,Math.min(g-1,Math.floor(_*o)))}qn(cE,"TriangleGridIndex");class PC{constructor(o){this.zoom=o.zoom,this.layers=o.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=o.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.footprints=[],this.worldview=o.worldview,this.hasAppearances=null}updateFootprints(o,g){for(const _e of this.footprints)g.push({footprint:_e,id:o})}updateAppearances(o,g,_e,rt){}populate(o,g,_e,rt){const ot=[];for(const{feature:at,id:ut,index:ft,sourceLayerIndex:gt}of o){const Ct=this.layers[0]._featureFilter.needGeometry,At=Br(at,Ct);if(!this.layers[0]._featureFilter.filter(new Do(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),At,_e))continue;const kt={id:ut,properties:at.properties,type:at.type,sourceLayerIndex:gt,index:ft,geometry:Ct?At.geometry:Pr(at,_e,rt),patterns:{}};ot.push(kt)}for(const at of ot){const{geometry:ut,index:ft,sourceLayerIndex:gt}=at;this.addFeature(at,ut,ft,_e,{},g.availableImages,g.brightness),g.featureIndex.insert(o[ft].feature,ut,ft,gt,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(o){}update(o,g,_e,rt,ot,at,ut){}destroy(){}addFeature(o,g,_e,rt,ot,at=[],ut){for(const ft of m1(g,2)){const gt=[],Ct=[],At=[],kt=new mn(1/0,1/0),zt=new mn(-1/0,-1/0);for(const er of ft)if(er.length!==0){er!==ft[0]&&At.push(Ct.length/2);for(let Jt=0;Jt<er.length;Jt++)Ct.push(er[Jt].x),Ct.push(er[Jt].y),gt.push(er[Jt]),kt.x=Math.min(kt.x,er[Jt].x),kt.y=Math.min(kt.y,er[Jt].y),zt.x=Math.max(zt.x,er[Jt].x),zt.y=Math.max(zt.y,er[Jt].y)}const Ut=Ax(Ct,At),Kt=new cE(gt,Ut,8,256);this.footprints.push({vertices:gt,indices:Ut,grid:Kt,min:kt,max:zt})}}}qn(PC,"ClipBucket",{omit:["layers"]});const CI=Bs([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),AI=Bs([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),RI=Bs([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),II=Bs([{name:"a_centroid_pos",components:2,type:"Uint16"}]),PI=Bs([{name:"a_join_normal_inside",components:3,type:"Int16"}]),kI=Bs([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),MI=Bs([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:DI}=CI,g1=Number.MAX_SAFE_INTEGER,kC=g1-1;function MC(_,o,g,_e){return _.order<o||_.order===g1||!(_.clipMask&g)||function(rt,ot){return ot.length!==0&&ot.find(at=>at===rt)===void 0}(_e,_.clipScope)}function uE(_,o){return _.x-o.x||_.y-o.y}function DC(_,o){return uE(_.min,o.min)===0&&uE(_.max,o.max)===0}function $T(_,o){return!(_.min.x>o.max.x||_.max.x<o.min.x||_.min.y>o.max.y||_.max.y<o.min.y)}function hE(_,o){if(_.length!==o.length)return!1;for(let g=0;g<_.length;g++)if(_[g].sourceId!==o[g].sourceId||!DC(_[g],o[g])||_[g].order!==o[g].order||_[g].clipMask!==o[g].clipMask||!du(_[g].clipScope,o[g].clipScope))return!1;return!0}function NC(_,o,g){const _e=1/Mn,rt=1/(1<<g.canonical.z),ot=(o.x*_e+g.canonical.x)*rt+g.wrap,at=(o.y*_e+g.canonical.y)*rt;return{min:new mn((_.x*_e+g.canonical.x)*rt+g.wrap,(_.y*_e+g.canonical.y)*rt),max:new mn(ot,at)}}function NI(_,o,g){const _e=1<<g.canonical.z,rt=((o.x-g.wrap)*_e-g.canonical.x)*Mn,ot=(o.y*_e-g.canonical.y)*Mn;return{min:new mn(((_.x-g.wrap)*_e-g.canonical.x)*Mn,(_.y*_e-g.canonical.y)*Mn),max:new mn(rt,ot)}}function GT(_,o,g,_e,rt,ot,at){const ut=_.indices,ft=_.vertices,gt=[];for(let Ct=_e;Ct<_e+rt;Ct+=3){const At=o[g[Ct+0]+ot],kt=o[g[Ct+1]+ot],zt=o[g[Ct+2]+ot],Ut=Math.min(At.x,kt.x,zt.x),Kt=Math.max(At.x,kt.x,zt.x),er=Math.min(At.y,kt.y,zt.y),Jt=Math.max(At.y,kt.y,zt.y);gt.length=0,_.grid.query(new mn(Ut,er),new mn(Kt,Jt),gt);for(let or=0;or<gt.length;or++){const lr=gt[or];if(gu(ft[ut[3*lr+0]],ft[ut[3*lr+1]],ft[ut[3*lr+2]],At,kt,zt,at))return!0}}return!1}function LC(_,o,g,_e){if(!_||!g)return!1;let rt=_.vertices;if(!o.canonical.equals(_e.canonical)||o.wrap!==_e.wrap){if(g.vertices.length<_.vertices.length)return LC(g,_e,_,o);const ot=o.canonical,at=_e.canonical,ut=Math.pow(2,at.z-ot.z);rt=_.vertices.map(ft=>new mn((ft.x+ot.x*Mn)*ut-at.x*Mn,(ft.y+ot.y*Mn)*ut-at.y*Mn))}return GT(g,rt,_.indices,0,_.indices.length,0,0)}function OC(_,o,g,_e){const rt=Math.pow(2,_e.z-g.z);return new mn((_+g.x*Mn)*rt-_e.x*Mn,(o+g.y*Mn)*rt-_e.y*Mn)}function jC(_,o){const g=[];o.grid.queryPoint(_,g);const _e=o.indices,rt=o.vertices;for(let ot=0;ot<g.length;ot++){const at=g[ot];if(So([rt[_e[3*at+0]],rt[_e[3*at+1]],rt[_e[3*at+2]]],_))return!0}return!1}const HT=[new mn(0,0),new mn(Mn,0),new mn(Mn,Mn),new mn(0,Mn)];function FC(_,o){const g=[];let _e=[];if(!o||_.length<2)return[_];if(_.length===2)return cu(_[0],_[1],HT)?[_]:[];for(let rt=0;rt<_.length+2;rt++){const ot=_[rt%_.length],at=_[(rt+1)%_.length],ut=cu(rt===0?_[_.length-1]:_[(rt-1)%_.length],ot,HT),ft=cu(ot,at,HT),gt=ut||ft;gt&&_e.push(ot),gt&&ft||_e.length>0&&(_e.length>1&&g.push(_e),_e=[])}return _e.length>1&&g.push(_e),g}const WT=Or.types,LI=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],OI=["fill-extrusion-flood-light-ground-radius"],jI=Math.pow(2,13),FI=Math.pow(2,15)-1,BC=new mn(0,1),m0=2147483648,zC=7,VC=450;function _1(_,o,g,_e,rt,ot,at,ut){_.emplaceBack((o<<1)+at,(g<<1)+ot,(Math.floor(_e*jI)<<1)+rt,Math.round(ut))}function y1(_,o,g){_.emplaceBack(o.x*Mn,o.y*Mn,g?1:0)}function dE(_,o,g,_e,rt,ot){_.emplaceBack(o.x,o.y,(g.x<<1)+_e,(g.y<<1)+rt,ot)}function x1(_,o,g){_.emplaceBack(o.x,o.y,o.z,g[0]*16384,g[1]*16384,g[2]*16384)}class UC{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class $C{constructor(){this.centroidXY=new mn(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new mn(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new mn(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new mn(this.max.x-this.min.x,this.max.y-this.min.y)}}class GC{constructor(){this.acc=new mn(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(o,g){o.min.x===Number.MAX_VALUE&&(o.min.x=o.max.x=g.x,o.min.y=o.max.y=g.y)}appendEdge(o,g,_e){this.accCount++,this.acc._add(g);let rt=!!this.borders;g.x<o.min.x?(o.min.x=g.x,rt=!0):g.x>o.max.x&&(o.max.x=g.x,rt=!0),g.y<o.min.y?(o.min.y=g.y,rt=!0):g.y>o.max.y&&(o.max.y=g.y,rt=!0),((g.x===0||g.x===Mn)&&g.x===_e.x)!=((g.y===0||g.y===Mn)&&g.y===_e.y)&&this.processBorderOverlap(g,_e),rt&&this.checkBorderIntersection(g,_e)}checkBorderIntersection(o,g){g.x<0!=o.x<0&&this.addBorderIntersection(0,fs(g.y,o.y,(0-g.x)/(o.x-g.x))),g.x>Mn!=o.x>Mn&&this.addBorderIntersection(1,fs(g.y,o.y,(Mn-g.x)/(o.x-g.x))),g.y<0!=o.y<0&&this.addBorderIntersection(2,fs(g.x,o.x,(0-g.y)/(o.y-g.y))),g.y>Mn!=o.y>Mn&&this.addBorderIntersection(3,fs(g.x,o.x,(Mn-g.y)/(o.y-g.y)))}addBorderIntersection(o,g){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const _e=this.borders[o];g<_e[0]&&(_e[0]=g),g>_e[1]&&(_e[1]=g)}processBorderOverlap(o,g){if(o.x===g.x){if(o.y===g.y)return;const _e=o.x===0?0:1;this.addBorderIntersection(_e,g.y),this.addBorderIntersection(_e,o.y)}else{const _e=o.y===0?2:3;this.addBorderIntersection(_e,g.x),this.addBorderIntersection(_e,o.x)}}centroid(){return this.accCount===0?new mn(0,0):new mn(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((o,g)=>o+ +(g[0]!==Number.MAX_VALUE),0):0}}function HC(_,o){const g=_.add(o)._unit(),_e=tr(_.x*g.x+_.y*g.y,-1,1);var rt,ot,at;return rt=Math.acos(_e),Math.min(4,Math.max(-4,Math.tan(rt)))/4*FI*((ot=_).x*(at=o).y-ot.y*at.x<0?-1:1)}const BI=[_=>_.x<0,_=>_.x>Mn,_=>_.y<0,_=>_.y>Mn];function zI(_,o,g,_e){const rt=[4];if(_e===0)return rt;g._mult(_e);const ot=_.sub(g),at=o.sub(g),ut=[_,o,ot,at];for(let ft=0;ft<4;ft++)for(const gt of ut)if(BI[ft](gt)){rt.push(ft);break}return rt}class qT{constructor(o){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new Hv,this.indexArray=new Fl,this.programConfigurations=new Tp(o.layers,{zoom:o.zoom,lut:o.lut},g=>OI.includes(g)),this._segments=new Go,this.hiddenByLandmarkVertexArray=new mx,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Go}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(o,g,_e,rt=!1){const ot=o.length;if(ot>2){let at=Math.max(0,this._segments.get().length-1);const ut=this._segments._prepareSegment(4*ot,this.vertexArray.length,2*this._segmentToGroundQuads[at].length);let ft;at!==this._segments.get().length-1&&(at++,this._segmentToGroundQuads[at]=[],this._segmentToRegionTriCounts[at]=[0,0,0,0,0]);{const gt=o[0],Ct=o[1];ft=HC(gt.sub(o[ot-1])._perp()._unit(),Ct.sub(gt)._perp()._unit())}for(let gt=0;gt<ot;gt++){const Ct=gt===ot-1?0:gt+1,At=o[gt],kt=o[Ct],zt=o[Ct===ot-1?0:Ct+1],Ut=kt.sub(At)._perp()._unit(),Kt=HC(Ut,zt.sub(kt)._perp()._unit()),er=ft,Jt=Kt;if(KT(At,kt,g)||rt&&KC(At,g)&&KC(kt,g)){ft=Kt;continue}const or=ut.vertexLength;dE(this.vertexArray,At,kt,1,1,er),dE(this.vertexArray,At,kt,1,0,er),dE(this.vertexArray,At,kt,0,1,Jt),dE(this.vertexArray,At,kt,0,0,Jt),ut.vertexLength+=4;const lr=zI(At,kt,Ut,_e);for(const pr of lr)this._segmentToGroundQuads[at].push({id:or,region:pr}),this._segmentToRegionTriCounts[at][pr]+=2,ut.primitiveLength+=2;ft=Kt}}}prepareBorderSegments(){if(!this.hasData())return;const o=this._segments.get(),g=o.length;for(let _e=0;_e<g;_e++)this._segmentToGroundQuads[_e].sort((rt,ot)=>rt.region-ot.region);for(let _e=0;_e<g;_e++){const rt=this._segmentToGroundQuads[_e],ot=o[_e],at=this._segmentToRegionTriCounts[_e];at.reduce((ft,gt)=>ft+gt,0);let ut=0;for(let ft=0;ft<=4;ft++){const gt=at[ft];if(gt!==0){let Ct=this.regionSegments[ft];Ct||(Ct=this.regionSegments[ft]=new Go);const At={vertexOffset:ot.vertexOffset,primitiveOffset:ot.primitiveOffset+ut,vertexLength:ot.vertexLength,primitiveLength:gt};Ct.get().push(At)}ut+=gt}for(let ft=0;ft<rt.length;ft++){const gt=rt[ft].id;this.indexArray.emplaceBack(gt,gt+1,gt+3),this.indexArray.emplaceBack(gt,gt+3,gt+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(o,g,_e,rt,ot,at,ut){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,o,g,_e,rt,ot,at,void 0,ut)}upload(o){this.hasData()&&(this.vertexBuffer=o.createVertexBuffer(this.vertexArray,AI.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=o.createVertexBuffer(this.groundRadiusArray,RI.members)))}uploadPaintProperties(o){this.hasData()&&this.programConfigurations.upload(o)}update(o,g,_e,rt,ot,at,ut,ft){this.hasData()&&this.programConfigurations.updatePaintArrays(o,g,_e,rt,ot,at,ut,ft)}updateHiddenByLandmark(o){this.updateHiddenByLandmarkRange(o.groundVertexArrayOffset,o.groundVertexCount,!!(o.flags&m0))}updateHiddenByLandmarkRange(o,g,_e){if(!this.hasData())return;const rt=g+o;if(g!==0){for(let ot=o;ot<rt;++ot)this.hiddenByLandmarkVertexArray.emplace(ot,_e?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(o){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=o.createVertexBuffer(this.hiddenByLandmarkVertexArray,kI.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let o=0;o<=4;o++){const g=this.regionSegments[o];g&&g.destroy()}}}}class pE{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.pixelRatio=o.pixelRatio,this.layerIds=this.layers.map(g=>g.fqid),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Fl,this.footprintVertices=new Lm,this.footprintSegments=[],this.layoutVertexArray=new B0,this.centroidVertexArray=new eE,this.wallVertexArray=new j_,this.indexArray=new Fl,this.programConfigurations=new Tp(o.layers,{zoom:o.zoom,lut:o.lut},g=>LI.includes(g)),this.segments=new Go,this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.groundEffect=new qT(o),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=o.worldview,this.hasAppearances=null}updateFootprints(o,g){}updateAppearances(o,g,_e,rt){}populate(o,g,_e,rt){this.features=[],this.hasPattern=FT("fill-extrusion",this.layers,this.pixelRatio,g),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=ir(_e),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:ot,id:at,index:ut,sourceLayerIndex:ft}of o){const gt=this.layers[0]._featureFilter.needGeometry,Ct=Br(ot,gt);if(!this.layers[0]._featureFilter.filter(new Do(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),Ct,_e))continue;const At={id:at,sourceLayerIndex:ft,index:ut,geometry:gt?Ct.geometry:Pr(ot,_e,rt),properties:ot.properties,type:ot.type,patterns:{}},kt=this.layoutVertexArray.length,zt=WT[At.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:ot.id,feature:BT("fill-extrusion",this.layers,At,this.zoom,this.pixelRatio,g)});else if(this.wallMode)for(const Ut of At.geometry)for(const Kt of FC(Ut,zt))this.addFeature(ot.id,At,[Kt],ut,_e,{},g.availableImages,rt,g.brightness);else this.addFeature(ot.id,At,At.geometry,ut,_e,{},g.availableImages,rt,g.brightness);g.featureIndex.insert(ot,At.geometry,ut,ft,this.index,kt)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(o,g,_e,rt,ot,at){for(const{featureId:ut,feature:ft}of this.features){const gt=WT[ft.type]==="Polygon",{geometry:Ct}=ft;if(this.wallMode)for(const At of Ct)for(const kt of FC(At,gt))this.addFeature(ut,ft,[kt],ft.index,g,_e,rt,ot,at);else this.addFeature(ut,ft,Ct,ft.index,g,_e,rt,ot,at)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(o,g,_e,rt,ot,at,ut){this.programConfigurations.updatePaintArrays(o,g,ot,_e,rt,at,ut,this.worldview),this.groundEffect.update(o,g,ot,_e,rt,at,ut,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,DI),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.wallVertexBuffer=o.createVertexBuffer(this.wallVertexArray,PI.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,MI.members,!0)),this.groundEffect.upload(o)),this.groundEffect.uploadPaintProperties(o),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){this.groundEffect.uploadHiddenByLandmark(o),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,II.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,g,_e,rt,ot,at,ut,ft,gt){const Ct=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(g,{})/this.tileToMeter,At=[new mn(0,0),new mn(Mn,Mn)],kt=ft.projection,zt=kt.name==="globe",Ut=this.wallMode||WT[g.type]==="Polygon",Kt=new GC;Kt.centroidDataIndex=this.centroidData.length;const er=new $C;er.buildingId=o,g.properties&&g.properties.hasOwnProperty("building_id")&&(er.buildingId=g.properties.building_id);const Jt=this.layers[0].paint.get("fill-extrusion-base").evaluate(g,{},ot)<=0,or=this.layers[0].paint.get("fill-extrusion-height").evaluate(g,{},ot);let lr;if(er.height=or,er.vertexArrayOffset=this.layoutVertexArray.length,er.groundVertexArrayOffset=this.groundEffect.vertexArray.length,zt&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ax),this.wallMode){if(zt)return void $n("Non zero fill-extrusion-line-width is not yet supported on globe.");if(_e.length!==1)return;lr=function(zr){const sn=zr[0].x===zr[zr.length-1].x&&zr[0].y===zr[zr.length-1].y;(function(Hn){let Zn=0;const js=Hn.length;for(let In=0;In<js;In++)Zn+=(Hn[(In+1)%js].x-Hn[In].x)*(Hn[(In+1)%js].y+Hn[In].y);return Zn>=0})(zr)||(zr=zr.reverse());const pn={geometry:[],joinNormals:[],indices:[]},wn=[],Tn=[],xn=[];let vn=zr.length;for(;vn>=2&&zr[vn-1].equals(zr[vn-2]);)vn--;if(vn<(sn?3:2))return pn;let nn,en,bn,Dn,Rn,ts=0;for(;ts<vn-1&&zr[ts].equals(zr[ts+1]);)ts++;sn&&(nn=zr[vn-2],Rn=zr[ts].sub(nn)._unit()._perp());for(let Hn=ts;Hn<vn;Hn++){if(bn=Hn===vn-1?sn?zr[ts+1]:void 0:zr[Hn+1],bn&&zr[Hn].equals(bn))continue;Rn&&(Dn=Rn),nn&&(en=nn),nn=zr[Hn],Rn=bn?bn.sub(nn)._unit()._perp():Dn,Dn=Dn||Rn;let Zn=Dn.add(Rn);Zn.x===0&&Zn.y===0||Zn._unit();const js=Zn.x*Rn.x+Zn.y*Rn.y,In=js!==0?1/js:1/0,Yn=Dn.x*Rn.y-Dn.y*Rn.x>0;let xs="miter";const Gs=2;xs==="miter"&&In>Gs&&(xs="bevel"),xs==="bevel"&&(In>100&&(xs="flipbevel"),In<Gs&&(xs="miter"));const Ws=(Rs,vo,wr,Cr)=>{const on=new mn(Rs.x,Rs.y),En=new mn(Rs.x,Rs.y);on.x+=vo.x*Cr,on.y+=vo.y*Cr,En.x-=vo.x*Math.max(wr,1),En.y-=vo.y*Math.max(wr,1),xn.push(vo),wn.push(on),Tn.push(En)};if(xs==="miter")Zn._mult(In),Ws(nn,Zn,0,0);else if(xs==="flipbevel")Zn=Rn.mult(-1),Ws(nn,Zn,0,0),Ws(nn,Zn.mult(-1),0,0);else{const Rs=-Math.sqrt(In*In-1),vo=Yn?Rs:0,wr=Yn?0:Rs;en&&Ws(nn,Dn,vo,wr),bn&&Ws(nn,Rn,vo,wr)}}pn.geometry=[...wn,...Tn.reverse(),wn[0]],pn.joinNormals=[...xn,...xn.reverse(),xn[xn.length-1]];const Vn=pn.geometry.length-1;for(let Hn=0;Hn<Vn/2;Hn++)if(Hn+1<Vn/2){let Zn=Hn,js=Hn+1,In=Vn-1-Hn,Yn=Vn-2-Hn;Zn=Zn===0?Vn-1:Zn-1,js=js===0?Vn-1:js-1,In=In===0?Vn-1:In-1,Yn=Yn===0?Vn-1:Yn-1,pn.indices.push(In),pn.indices.push(js),pn.indices.push(Zn),pn.indices.push(In),pn.indices.push(Yn),pn.indices.push(js)}return pn}(_e[0]),_e=[lr.geometry]}const pr=(zr,sn)=>zr<(sn.length-1)/2||zr===sn.length-1,Sr=this.wallMode?[_e]:m1(_e,500);for(let zr=Sr.length-1;zr>=0;zr--){const sn=Sr[zr];(sn.length===0||(br=sn[0]).every(dn=>dn.x<=0)||br.every(dn=>dn.x>=Mn)||br.every(dn=>dn.y<=0)||br.every(dn=>dn.y>=Mn))&&Sr.splice(zr,1)}var br;let Rr;if(zt)Rr=QC(Sr,At,ot);else{Rr=[];for(const zr of Sr)Rr.push({polygon:zr,bounds:At})}const Mr=Ut?this.edgeRadius:0,Lr=Mr>0&&this.zoom<17,Jr=(zr,sn)=>{if(zr.length===0)return!1;const dn=zr[zr.length-1];return sn.x===dn.x&&sn.y===dn.y};for(const{polygon:zr,bounds:sn}of Rr){let dn=0,pn=0;for(const vn of zr)Ut&&!vn[0].equals(vn[vn.length-1])&&vn.push(vn[0]),pn+=Ut?vn.length-1:vn.length;const wn=this.segments.prepareSegment((Ut?5:4)*pn,this.layoutVertexArray,this.indexArray);er.footprintSegIdx<0&&(er.footprintSegIdx=this.footprintSegments.length),er.polygonSegIdx<0&&(er.polygonSegIdx=this.polygonSegments.length);const Tn={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},xn=new UC;if(xn.vertexOffset=this.footprintVertices.length,xn.indexOffset=3*this.footprintIndices.length,xn.ringIndices=[],Ut){const vn=[],nn=[];dn=wn.vertexLength;for(let bn=0;bn<zr.length;bn++){const Dn=zr[bn];Dn.length&&bn!==0&&nn.push(vn.length/2);const Rn=[];let ts,Vn;ts=Dn[1].sub(Dn[0])._perp()._unit(),xn.ringIndices.push(Dn.length-1);for(let Hn=1;Hn<Dn.length;Hn++){const Zn=Dn[Hn],js=Dn[Hn===Dn.length-1?1:Hn+1],In=Zn.clone();if(Mr){Vn=js.sub(Zn)._perp()._unit();const Yn=ts.add(Vn)._unit(),xs=Mr*Math.min(4,1/(ts.x*Yn.x+ts.y*Yn.y));In.x+=xs*Yn.x,In.y+=xs*Yn.y,In.x=Math.round(In.x),In.y=Math.round(In.y),ts=Vn}if(!Jt||Mr!==0&&!Lr||Jr(Rn,In)||Rn.push(In),_1(this.layoutVertexArray,In.x,In.y,0,0,1,1,0),this.wallMode){const Yn=pr(Hn,Dn);y1(this.wallVertexArray,lr.joinNormals[Hn],!Yn)}wn.vertexLength++,this.footprintVertices.emplaceBack(Zn.x,Zn.y),vn.push(Zn.x,Zn.y),zt&&x1(this.layoutVertexExtArray,kt.projectTilePoint(In.x,In.y,ot),kt.upVector(ot,In.x,In.y))}Jt&&(Mr===0||Lr)&&(Rn.length!==0&&Jr(Rn,Rn[0])&&Rn.pop(),this.groundEffect.addData(Rn,sn,Ct))}const en=this.wallMode?lr.indices:Ax(vn,nn);for(let bn=0;bn<en.length;bn+=3)this.footprintIndices.emplaceBack(xn.vertexOffset+en[bn+0],xn.vertexOffset+en[bn+1],xn.vertexOffset+en[bn+2]),this.indexArray.emplaceBack(dn+en[bn],dn+en[bn+2],dn+en[bn+1]),wn.primitiveLength++;xn.indexCount+=en.length,xn.vertexCount+=this.footprintVertices.length-xn.vertexOffset}for(let vn=0;vn<zr.length;vn++){const nn=zr[vn];Kt.startRing(er,nn[0]);let en=nn.length>4&&XC(nn[nn.length-2],nn[0],nn[1]),bn=Mr?VI(nn[nn.length-2],nn[0],nn[1],Mr):0;const Dn=[];let Rn,ts,Vn;ts=nn[1].sub(nn[0])._perp()._unit();let Hn=!0;for(let Zn=1,js=0;Zn<nn.length;Zn++){let In=nn[Zn-1],Yn=nn[Zn];const xs=nn[Zn===nn.length-1?1:Zn+1];if(Kt.appendEdge(er,Yn,In),KT(Yn,In,sn)){Mr&&(ts=xs.sub(Yn)._perp()._unit(),Hn=!Hn);continue}const Gs=Yn.sub(In)._perp(),Ws=Gs.x/(Math.abs(Gs.x)+Math.abs(Gs.y)),Rs=Gs.y>0?1:0,vo=In.dist(Yn);if(js+vo>32768&&(js=0),Mr){Vn=xs.sub(Yn)._perp()._unit();let En=qC(In,Yn,xs,WC(ts,Vn),Mr);isNaN(En)&&(En=0);const Fn=Yn.sub(In)._unit();In=In.add(Fn.mult(bn))._round(),Yn=Yn.add(Fn.mult(-En))._round(),bn=En,ts=Vn,Jt&&this.zoom>=17&&(Jr(Dn,In)||Dn.push(In),Jr(Dn,Yn)||Dn.push(Yn))}const wr=wn.vertexLength,Cr=nn.length>4&&XC(In,Yn,xs);let on=ZC(js,en,Hn);if(_1(this.layoutVertexArray,In.x,In.y,Ws,Rs,0,0,on),_1(this.layoutVertexArray,In.x,In.y,Ws,Rs,0,1,on),this.wallMode){const En=pr(Zn-1,nn),Fn=lr.joinNormals[Zn-1];y1(this.wallVertexArray,Fn,En),y1(this.wallVertexArray,Fn,En)}if(js+=vo,on=ZC(js,Cr,!Hn),en=Cr,_1(this.layoutVertexArray,Yn.x,Yn.y,Ws,Rs,0,0,on),_1(this.layoutVertexArray,Yn.x,Yn.y,Ws,Rs,0,1,on),this.wallMode){const En=pr(Zn,nn),Fn=lr.joinNormals[Zn];y1(this.wallVertexArray,Fn,En),y1(this.wallVertexArray,Fn,En)}if(wn.vertexLength+=4,this.indexArray.emplaceBack(wr+0,wr+1,wr+2),this.indexArray.emplaceBack(wr+1,wr+3,wr+2),wn.primitiveLength+=2,Mr){const En=dn+(Zn===1?nn.length-2:Zn-2),Fn=Zn===1?dn:En+1;if(this.indexArray.emplaceBack(wr+1,En,wr+3),this.indexArray.emplaceBack(En,Fn,wr+3),wn.primitiveLength+=2,Rn===void 0&&(Rn=wr),!KT(xs,nn[Zn],sn)){const Bn=Zn===nn.length-1?Rn:wn.vertexLength;this.indexArray.emplaceBack(wr+2,wr+3,Bn),this.indexArray.emplaceBack(wr+3,Bn+1,Bn),this.indexArray.emplaceBack(wr+3,Fn,Bn+1),wn.primitiveLength+=3}Hn=!Hn}if(zt){const En=this.layoutVertexExtArray,Fn=kt.projectTilePoint(In.x,In.y,ot),Bn=kt.projectTilePoint(Yn.x,Yn.y,ot),rs=kt.upVector(ot,In.x,In.y),ss=kt.upVector(ot,Yn.x,Yn.y);x1(En,Fn,rs),x1(En,Fn,rs),x1(En,Bn,ss),x1(En,Bn,ss)}}Ut&&(dn+=nn.length-1),Jt&&Mr&&this.zoom>=17&&(Dn.length!==0&&Jr(Dn,Dn[0])&&Dn.pop(),this.groundEffect.addData(Dn,sn,Ct,Mr>0))}this.footprintSegments.push(xn),Tn.triangleCount=this.indexArray.length-Tn.triangleArrayOffset,this.polygonSegments.push(Tn),++er.footprintSegLen,++er.polygonSegLen}if(er.vertexCount=this.layoutVertexArray.length-er.vertexArrayOffset,er.groundVertexCount=this.groundEffect.vertexArray.length-er.groundVertexArrayOffset,er.vertexCount!==0){if(er.centroidXY=Kt.borders?BC:this.encodeCentroid(Kt,er),this.centroidData.push(er),Kt.borders){this.featuresOnBorder.push(Kt);const zr=this.featuresOnBorder.length-1;for(let sn=0;sn<Kt.borders.length;sn++)Kt.borders[sn][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[sn].push(zr)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,g,rt,at,ut,ot,gt,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(g,rt,at,ut,ot,gt,this.worldview),this.maxHeight=Math.max(this.maxHeight,or)}}sortBorders(){for(let o=0;o<this.borderFeatureIndices.length;o++)this.borderFeatureIndices[o].sort((g,_e)=>this.featuresOnBorder[g].borders[o][0]-this.featuresOnBorder[_e].borders[o][0])}splitToSubtiles(){const o=[];for(let ut=0;ut<this.centroidData.length;ut++){const ft=this.centroidData[ut],gt=+(ft.min.y+ft.max.y>Mn),Ct=2*gt+(+(ft.min.x+ft.max.x>Mn)^gt);for(let At=0;At<ft.polygonSegLen;At++){const kt=ft.polygonSegIdx+At;o.push({centroidIdx:ut,subtile:Ct,polygonSegmentIdx:kt,triangleSegmentIdx:this.polygonSegments[kt].triangleSegIdx})}}const g=new Fl;o.sort((ut,ft)=>ut.triangleSegmentIdx===ft.triangleSegmentIdx?ut.subtile-ft.subtile:ut.triangleSegmentIdx-ft.triangleSegmentIdx);let _e=0,rt=0,ot=0;for(const ut of o){if(ut.triangleSegmentIdx!==_e)break;ot++}const at=o.length;for(;rt!==o.length;){_e=o[rt].triangleSegmentIdx;let ut=0,ft=rt,gt=rt;for(let Ct=ft;Ct<ot&&o[Ct].subtile===ut;Ct++)gt++;for(;ft!==ot;){const Ct=o[ft];ut=Ct.subtile;const At=this.centroidData[Ct.centroidIdx].min.clone(),kt=this.centroidData[Ct.centroidIdx].max.clone(),zt={vertexOffset:this.segments.segments[_e].vertexOffset,primitiveOffset:g.length,vertexLength:this.segments.segments[_e].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let Ut=ft;Ut<gt;Ut++){const Kt=o[Ut],er=this.polygonSegments[Kt.polygonSegmentIdx],Jt=this.centroidData[Kt.centroidIdx].min,or=this.centroidData[Kt.centroidIdx].max,lr=this.indexArray.uint16;for(let pr=er.triangleArrayOffset;pr<er.triangleArrayOffset+er.triangleCount;pr++)g.emplaceBack(lr[3*pr],lr[3*pr+1],lr[3*pr+2]);zt.primitiveLength+=er.triangleCount,At.x=Math.min(At.x,Jt.x),At.y=Math.min(At.y,Jt.y),kt.x=Math.max(kt.x,or.x),kt.y=Math.max(kt.y,or.y)}zt.primitiveLength>0&&this.triangleSubSegments.push({segment:zt,min:At,max:kt}),ft=gt;for(let Ut=ft;Ut<ot&&o[Ut].subtile===o[ft].subtile;Ut++)gt++}rt=ot;for(let Ct=rt;Ct<at&&o[Ct].triangleSegmentIdx===o[rt].triangleSegmentIdx;Ct++)ot++}g._trim(),this.indexArray=g}getVisibleSegments(o,g,_e){const rt=new Go;if(this.wallMode){for(const Kt of this.triangleSubSegments)rt.segments.push(Kt.segment);return rt}let ot=0,at=0;const ut=1<<o.canonical.z;if(g){const Kt=g.getMinMaxForTile(o);Kt&&(ot=Kt.min,at=Kt.max)}at+=this.maxHeight;const ft=o.toUnwrapped();let gt;const Ct=[ft.canonical.x/ut+ft.wrap,ft.canonical.y/ut],At=[(ft.canonical.x+1)/ut+ft.wrap,(ft.canonical.y+1)/ut],kt=(Kt,er,Jt)=>[Kt[0]*(1-Jt[0])+er[0]*Jt[0],Kt[1]*(1-Jt[1])+er[1]*Jt[1]],zt=[],Ut=[];for(const Kt of this.triangleSubSegments){zt[0]=Kt.min.x/Mn,zt[1]=Kt.min.y/Mn,Ut[0]=Kt.max.x/Mn,Ut[1]=Kt.max.y/Mn;const er=kt(Ct,At,zt),Jt=kt(Ct,At,Ut);if(new Jn([er[0],er[1],ot],[Jt[0],Jt[1],at]).intersectsPrecise(_e)===0){gt&&(rt.segments.push(gt),gt=void 0);continue}const or=Kt.segment;gt&&gt.vertexOffset!==or.vertexOffset&&(rt.segments.push(gt),gt=void 0),gt?(gt.vertexLength+=or.vertexLength,gt.primitiveLength+=or.primitiveLength):gt={vertexOffset:or.vertexOffset,primitiveLength:or.primitiveLength,vertexLength:or.vertexLength,primitiveOffset:or.primitiveOffset,sortKey:void 0,vaos:{}}}return gt&&rt.segments.push(gt),rt}encodeCentroid(o,g){const _e=o.centroid(),rt=g.span(),ot=Math.min(7,Math.round(rt.x*this.tileToMeter/10)),at=Math.min(7,Math.round(rt.y*this.tileToMeter/10));return new mn(tr(_e.x,1,Mn-1)<<3|ot,tr(_e.y,1,Mn-1)<<3|at)}encodeBorderCentroid(o){if(!o.borders)return new mn(0,0);const g=o.borders,_e=Number.MAX_VALUE;if(g[0][0]!==_e||g[1][0]!==_e){const rt=g[0][0]!==_e?0:1;return new mn(6|(g[0][0]!==_e?0:65528),(g[rt][0]+g[rt][1])/2<<3|6)}{const rt=g[2][0]!==_e?2:3;return new mn((g[rt][0]+g[rt][1])/2<<3|6,6|(g[2][0]!==_e?0:65528))}}showCentroid(o){const g=this.centroidData[o.centroidDataIndex];g.flags&=2147483647,g.centroidXY.x=0,g.centroidXY.y=0,this.writeCentroidToBuffer(g)}writeCentroidToBuffer(o){this.groundEffect.updateHiddenByLandmark(o);const g=o.vertexArrayOffset,_e=o.vertexCount+o.vertexArrayOffset,rt=o.flags&m0?BC:o.centroidXY,ot=this.centroidVertexArray.geta_centroid_pos0(g);if(this.centroidVertexArray.geta_centroid_pos1(g)!==rt.y||ot!==rt.x){for(let at=g;at<_e;++at)this.centroidVertexArray.emplace(at,rt.x,rt.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const o of this.centroidData)this.writeCentroidToBuffer(o)}updateReplacement(o,g,_e){if(g.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=g.updateTime;const rt=g.getReplacementRegionsForTile(o.toUnwrapped());if(hE(this.activeReplacements,rt))return;if(this.activeReplacements=rt,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const at of this.centroidData)at.flags&=2147483647;const ot=[];for(const at of this.activeReplacements){if(at.order<_e)continue;const ut=Math.max(1,Math.pow(2,at.footprintTileId.canonical.z-o.canonical.z));if(at.footprint.buildingIds)for(const ft of this.centroidData)ft.flags&m0||at.min.x>ft.max.x||ft.min.x>at.max.x||at.min.y>ft.max.y||ft.min.y>at.max.y||at.footprint.buildingIds.has(ft.buildingId)&&(ft.flags|=m0);else for(const ft of this.centroidData)if(!(ft.flags&m0||at.min.x>ft.max.x||ft.min.x>at.max.x||at.min.y>ft.max.y||ft.min.y>at.max.y))for(let gt=0;gt<ft.footprintSegLen;gt++){const Ct=this.footprintSegments[ft.footprintSegIdx+gt];if(ot.length=0,UI(this.footprintVertices,Ct.vertexOffset,Ct.vertexCount,at.footprintTileId.canonical,o.canonical,ot),GT(at.footprint,ot,this.footprintIndices.uint16,Ct.indexOffset,Ct.indexCount,-Ct.vertexOffset,-ut)){ft.flags|=m0;break}}}for(const at of this.centroidData)this.writeCentroidToBuffer(at);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(o,g,_e){let rt=!1;for(let ot=0;ot<_e.footprintSegLen;ot++){const at=this.footprintSegments[_e.footprintSegIdx+ot];let ut=0;for(const ft of at.ringIndices){for(let gt=ut,Ct=ft+ut-1;gt<ft+ut;Ct=gt++){const At=this.footprintVertices.int16[2*(gt+at.vertexOffset)+0],kt=this.footprintVertices.int16[2*(gt+at.vertexOffset)+1],zt=this.footprintVertices.int16[2*(Ct+at.vertexOffset)+1];kt>g!=zt>g&&o<(this.footprintVertices.int16[2*(Ct+at.vertexOffset)+0]-At)*(g-kt)/(zt-kt)+At&&(rt=!rt)}ut=ft}}return rt}getHeightAtTileCoord(o,g){let _e=Number.NEGATIVE_INFINITY,rt=!0;const ot=4*(o+Mn)*Mn+(g+Mn);if(this.partLookup.hasOwnProperty(ot)){const at=this.partLookup[ot];return at?{height:at.height,hidden:!!(at.flags&m0)}:void 0}for(const at of this.centroidData)o>at.max.x||at.min.x>o||g>at.max.y||at.min.y>g||at.height<=_e||this.footprintContainsPoint(o,g,at)&&(_e=at.height,this.partLookup[ot]=at,rt=!!(at.flags&m0));if(_e!==Number.NEGATIVE_INFINITY)return{height:_e,hidden:rt};this.partLookup[ot]=void 0}}function WC(_,o){const g=_.add(o)._unit();return _.x*g.x+_.y*g.y}function VI(_,o,g,_e){const rt=o.sub(_)._perp()._unit(),ot=g.sub(o)._perp()._unit();return qC(_,o,g,WC(rt,ot),_e)}function qC(_,o,g,_e,rt){const ot=Math.sqrt(1-_e*_e);return Math.min(_.dist(o)/3,o.dist(g)/3,rt*ot/_e)}function KT(_,o,g){return _.x<g[0].x&&o.x<g[0].x||_.x>g[1].x&&o.x>g[1].x||_.y<g[0].y&&o.y<g[0].y||_.y>g[1].y&&o.y>g[1].y}function KC(_,o){return _.x<o[0].x||_.x>o[1].x||_.y<o[0].y||_.y>o[1].y}function XC(_,o,g){if(_.x<0||_.x>=Mn||o.x<0||o.x>=Mn||g.x<0||g.x>=Mn)return!1;const _e=g.sub(o),rt=_e.perp(),ot=_.sub(o);return(_e.x*ot.x+_e.y*ot.y)/Math.sqrt((_e.x*_e.x+_e.y*_e.y)*(ot.x*ot.x+ot.y*ot.y))>-.866&&rt.x*ot.x+rt.y*ot.y<0}function ZC(_,o,g){const _e=o?2|_:-3&_;return g?1|_e:-2&_e}function YC(){const _=Math.PI/32,o=Math.tan(_),g=it;return g*Math.sqrt(1+2*o*o)-g}function QC(_,o,g){const _e=1<<g.z,rt=Mt(g.x/_e),ot=Mt((g.x+1)/_e),at=Ht(g.y/_e),ut=Ht((g.y+1)/_e);return function(ft,gt,Ct,At,kt=0,zt){const Ut=[];if(!ft.length||!Ct||!At)return Ut;const Kt=(br,Rr)=>{for(const Mr of br)Ut.push({polygon:Mr,bounds:Rr})},er=Math.ceil(Math.log2(Ct)),Jt=Math.ceil(Math.log2(At)),or=er-Jt,lr=[];for(let br=0;br<Math.abs(or);br++)lr.push(or>0?0:1);for(let br=0;br<Math.min(er,Jt);br++)lr.push(0),lr.push(1);let pr=ft;if(pr=lE(pr,gt[0].y-kt,gt[1].y+kt,1),pr=lE(pr,gt[0].x-kt,gt[1].x+kt,0),!pr.length)return Ut;const Sr=[];for(lr.length?Sr.push({polygons:pr,bounds:gt,depth:0}):Kt(pr,gt);Sr.length;){const br=Sr.pop(),Rr=br.depth,Mr=lr[Rr],Lr=br.bounds[0],Jr=br.bounds[1],zr=Mr===0?Lr.x:Lr.y,sn=Mr===0?Jr.x:Jr.y,dn=zt?zt(Mr,zr,sn):.5*(zr+sn),pn=lE(br.polygons,zr-kt,dn+kt,Mr),wn=lE(br.polygons,dn-kt,sn+kt,Mr);if(pn.length){const Tn=[Lr,new mn(Mr===0?dn:Jr.x,Mr===1?dn:Jr.y)];lr.length>Rr+1?Sr.push({polygons:pn,bounds:Tn,depth:Rr+1}):Kt(pn,Tn)}if(wn.length){const Tn=[new mn(Mr===0?dn:Lr.x,Mr===1?dn:Lr.y),Jr];lr.length>Rr+1?Sr.push({polygons:wn,bounds:Tn,depth:Rr+1}):Kt(wn,Tn)}}return Ut}(_,o,Math.ceil((ot-rt)/11.25),Math.ceil((at-ut)/11.25),1,(ft,gt,Ct)=>{if(ft===0)return .5*(gt+Ct);{const At=Ht((g.y+gt/Mn)/_e);return(Tt(.5*(Ht((g.y+Ct/Mn)/_e)+At))*_e-g.y)*Mn}})}function UI(_,o,g,_e,rt,ot){const at=Math.pow(2,_e.z-rt.z);for(let ut=0;ut<g;ut++){let ft=_.int16[2*(ut+o)+0],gt=_.int16[2*(ut+o)+1];ft=(ft+rt.x*Mn)*at-_e.x*Mn,gt=(gt+rt.y*Mn)*at-_e.y*Mn,ot.push(new mn(ft,gt))}}let JC,eA;qn(pE,"FillExtrusionBucket",{omit:["layers","features"]}),qn($C,"PartData"),qn(UC,"FootprintSegment"),qn(GC,"BorderCentroidData"),qn(qT,"GroundEffect");class q_ extends mn{constructor(o,g,_e){super(o,g),this.z=_e}}class tA extends q_{constructor(o,g,_e,rt){super(o,g,_e),this.w=rt}}function rA(_,o,g,_e){const rt=g==="x"?"y":"x",ot=(_e-_[g])/(o[g]-_[g]);_[rt]=Math.round(_[rt]+(o[rt]-_[rt])*ot),_[g]=_e,_.hasOwnProperty("z")&&(_.z=fs(_.z,o.z,ot)),_.hasOwnProperty("w")&&(_.w=fs(_.w,o.w,ot))}function iA(_,o,g,_e){const rt=g,ot=_e;for(const at of["x","y"]){let ut=_,ft=o;ut[at]>=ft[at]&&(ut=o,ft=_),ut[at]<rt&&ft[at]>rt&&rA(ut,ft,at,rt),ut[at]<ot&&ft[at]>ot&&rA(ft,ut,at,ot)}}function fE(_,o,g,_e,rt,ot){const at=[];for(let ut=0;ut<_.length;ut++){const ft=_[ut];let gt;const Ct=at.length;let At=0;for(let kt=0;kt<ft.length-1;kt++){let zt=ft[kt],Ut=ft[kt+1],Kt=0;const er=At;let Jt,or;ot&&(Kt=Math.hypot(Ut.x-zt.x,Ut.y-zt.y),At+=Kt,Jt=zt,or=Ut),zt.x<o&&Ut.x<o||(zt.x<o?zt=new mn(o,zt.y+(o-zt.x)/(Ut.x-zt.x)*(Ut.y-zt.y))._round():Ut.x<o&&(Ut=new mn(o,zt.y+(o-zt.x)/(Ut.x-zt.x)*(Ut.y-zt.y))._round()),zt.y<g&&Ut.y<g||(zt.y<g?zt=new mn(zt.x+(g-zt.y)/(Ut.y-zt.y)*(Ut.x-zt.x),g)._round():Ut.y<g&&(Ut=new mn(zt.x+(g-zt.y)/(Ut.y-zt.y)*(Ut.x-zt.x),g)._round()),zt.x>=_e&&Ut.x>=_e||(zt.x>=_e?zt=new mn(_e,zt.y+(_e-zt.x)/(Ut.x-zt.x)*(Ut.y-zt.y))._round():Ut.x>=_e&&(Ut=new mn(_e,zt.y+(_e-zt.x)/(Ut.x-zt.x)*(Ut.y-zt.y))._round()),zt.y>=rt&&Ut.y>=rt||(zt.y>=rt?zt=new mn(zt.x+(rt-zt.y)/(Ut.y-zt.y)*(Ut.x-zt.x),rt)._round():Ut.y>=rt&&(Ut=new mn(zt.x+(rt-zt.y)/(Ut.y-zt.y)*(Ut.x-zt.x),rt)._round()),gt&&zt.equals(gt[gt.length-1])||(gt=[zt],at.push(gt),ot&&ot.push({progress:{min:er+nA(Jt,or,zt)*Kt,max:1},parentIndex:ut,prevPoint:Jt,nextPoint:or})),gt.push(Ut),ot&&(ot[ot.length-1].progress.max=er+nA(Jt,or,Ut)*Kt,ot[ot.length-1].nextPoint=or)))))}if(ot&&At>0)for(let kt=Ct;kt<at.length;kt++)ot[kt].progress.min/=At,ot[kt].progress.max/=At}return at}function $I(_,o,g,_e,rt){if(_.length<2)return void _e.push(_);const ot=[];for(;o.valid();){const[gt,Ct]=o.get();for(let At=0;At<_.length-1;At++){const kt=_[At],zt=_[At+1],Ut=Ds(kt,zt,gt,Ct);if(Ut){const[Kt]=Ut,er=new mn(fs(kt.x,zt.x,Kt),fs(kt.y,zt.y,Kt));ot.push({t:At+Kt,distance:0,point:er})}}o.next()}if(ot.length===0)return void _e.push(_);ot.sort((gt,Ct)=>gt.t-Ct.t);let at=0,ut=0,ft=[];for(_e.push(ft);at!==_.length;){if(ut===ot.length){for(;at!==_.length;)ft.length!==0&&ft[ft.length-1].equals(_[at])||ft.push(_[at]),at++;break}ot[ut].t<=at?(ft.length!==0&&ft[ft.length-1].equals(ot[ut].point)||ft.push(ot[ut].point),Math.trunc(ot[ut].t),ut++):(ft.length!==0&&ft[ft.length-1].equals(_[at])||ft.push(_[at]),at++)}}function nA(_,o,g){return _.x!==o.x?(g.x-_.x)/(o.x-_.x):_.y!==o.y?(g.y-_.y)/(o.y-_.y):0}function v1(_,o){return _.x*o.x+_.y*o.y}function sA(_,o){if(_.length===1){let g=0;const _e=o[g++];let rt;for(;!rt||_e.equals(rt);)if(rt=o[g++],!rt)return 1/0;for(;g<o.length;g++){const ot=o[g],at=_[0],ut=rt.sub(_e),ft=ot.sub(_e),gt=at.sub(_e),Ct=v1(ut,ut),At=v1(ut,ft),kt=v1(ft,ft),zt=v1(gt,ut),Ut=v1(gt,ft),Kt=Ct*kt-At*At,er=(kt*zt-At*Ut)/Kt,Jt=(Ct*Ut-At*zt)/Kt,or=_e.z*(1-er-Jt)+rt.z*er+ot.z*Jt;if(isFinite(or))return or}return 1/0}{let g=1/0;for(const _e of o)g=Math.min(g,_e.z);return g}}function oA(_,o,g){let _e=1/0;ao(g,o)&&(_e=sA(g,o[0]));for(let rt=0;rt<o.length;rt++){const ot=o[rt],at=_[rt];for(let ut=0;ut<ot.length-1;ut++){const ft=ot[ut],gt=[ft,ot[ut+1],at[ut+1],at[ut],ft];to(g,gt)&&(_e=Math.min(_e,sA(g,gt)))}}return _e!==1/0&&_e}function aA(_,o,g,_e,rt,ot,at,ut,ft,gt,Ct){return _.projection.name==="globe"?function(At,kt,zt,Ut,Kt,er,Jt,or,lr,pr,Sr){const br=[],Rr=[],Mr=At.projection.upVectorScale(Sr,At.center.lat,At.worldSize).metersToTile,Lr=[0,0,0,1],Jr=[0,0,0,1],zr=(dn,pn,wn,Tn)=>{dn[0]=pn,dn[1]=wn,dn[2]=Tn,dn[3]=1},sn=YC();zt>0&&(zt+=sn),Ut+=sn;for(const dn of kt){const pn=[],wn=[];for(const Tn of dn){const xn=Tn.x+Kt.x,vn=Tn.y+Kt.y,nn=At.projection.projectTilePoint(xn,vn,Sr),en=At.projection.upVector(Sr,Tn.x,Tn.y);let bn=zt,Dn=Ut;if(Jt){const Rn=lA(xn,vn,zt,Ut,Jt,or,lr,pr);bn+=Rn.base,Dn+=Rn.top}zt!==0?zr(Lr,nn.x+en[0]*Mr*bn,nn.y+en[1]*Mr*bn,nn.z+en[2]*Mr*bn):zr(Lr,nn.x,nn.y,nn.z),zr(Jr,nn.x+en[0]*Mr*Dn,nn.y+en[1]*Mr*Dn,nn.z+en[2]*Mr*Dn),ws(Lr,Lr,er),ws(Jr,Jr,er),pn.push(new q_(Lr[0],Lr[1],Lr[2])),wn.push(new q_(Jr[0],Jr[1],Jr[2]))}br.push(pn),Rr.push(wn)}return[br,Rr]}(_,o,g,_e,rt,ot,at,ut,ft,gt,Ct):at?function(At,kt,zt,Ut,Kt,er,Jt,or,lr){const pr=[],Sr=[],br=[0,0,0,1];for(const Rr of At){const Mr=[],Lr=[];for(const Jr of Rr){const zr=Jr.x+Ut.x,sn=Jr.y+Ut.y,dn=lA(zr,sn,kt,zt,er,Jt,or,lr);br[0]=zr,br[1]=sn,br[2]=dn.base,br[3]=1,Jo(br,br,Kt),br[3]=Math.max(br[3],1e-5);const pn=new q_(br[0]/br[3],br[1]/br[3],br[2]/br[3]);br[0]=zr,br[1]=sn,br[2]=dn.top,br[3]=1,Jo(br,br,Kt),br[3]=Math.max(br[3],1e-5);const wn=new q_(br[0]/br[3],br[1]/br[3],br[2]/br[3]);Mr.push(pn),Lr.push(wn)}pr.push(Mr),Sr.push(Lr)}return[pr,Sr]}(o,g,_e,rt,ot,at,ut,ft,gt):function(At,kt,zt,Ut,Kt){const er=[],Jt=[],or=Kt[8]*kt,lr=Kt[9]*kt,pr=Kt[10]*kt,Sr=Kt[11]*kt,br=Kt[8]*zt,Rr=Kt[9]*zt,Mr=Kt[10]*zt,Lr=Kt[11]*zt;for(const Jr of At){const zr=[],sn=[];for(const dn of Jr){const pn=dn.x+Ut.x,wn=dn.y+Ut.y,Tn=Kt[0]*pn+Kt[4]*wn+Kt[12],xn=Kt[1]*pn+Kt[5]*wn+Kt[13],vn=Kt[2]*pn+Kt[6]*wn+Kt[14],nn=Kt[3]*pn+Kt[7]*wn+Kt[15],en=Tn+or,bn=xn+lr,Dn=vn+pr,Rn=Math.max(nn+Sr,1e-5),ts=Tn+br,Vn=xn+Rr,Hn=vn+Mr,Zn=Math.max(nn+Lr,1e-5);zr.push(new q_(en/Rn,bn/Rn,Dn/Rn)),sn.push(new q_(ts/Zn,Vn/Zn,Hn/Zn))}er.push(zr),Jt.push(sn)}return[er,Jt]}(o,g,_e,rt,ot)}function lA(_,o,g,_e,rt,ot,at,ut){const ft=at*rt.getElevationAt(_,o,!0,!0),gt=ot[0]!==0,Ct=gt?ot[1]===0?at*(ot[0]/zC-VC):at*function(At,kt,zt){const Ut=Math.floor(kt[0]/8),Kt=Math.floor(kt[1]/8),er=10*(kt[0]-8*Ut),Jt=10*(kt[1]-8*Kt),or=At.getElevationAt(Ut,Kt,!0,!0),lr=At.getMeterToDEM(zt),pr=Math.floor(.5*(er*lr-1)),Sr=Math.floor(.5*(Jt*lr-1)),br=At.tileCoordToPixel(Ut,Kt),Rr=2*pr+1,Mr=2*Sr+1,Lr=function(wn,Tn,xn,vn,nn){return[wn.getElevationAtPixel(Tn,xn,!0),wn.getElevationAtPixel(Tn+nn,xn,!0),wn.getElevationAtPixel(Tn,xn+nn,!0),wn.getElevationAtPixel(Tn+vn,xn+nn,!0)]}(At,br.x-pr,br.y-Sr,Rr,Mr),Jr=Math.abs(Lr[0]-Lr[1]),zr=Math.abs(Lr[2]-Lr[3]),sn=Math.abs(Lr[0]-Lr[2])+Math.abs(Lr[1]-Lr[3]),dn=Math.min(.25,.5*lr*(Jr+zr)/Rr),pn=Math.min(.25,.5*lr*sn/Mr);return or+Math.max(dn*er,pn*Jt)}(rt,ot,ut):ft;return{base:ft+(g===0?-1:g),top:gt?Math.max(Ct+_e,ft+g+2):ft+_e}}class GI{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class HI{constructor(){this.tasks={},this.taskQueue=[],Vr(["process"],this),this.invoker=new GI(this.process),this.nextId=0}add(o,g){const _e=this.nextId++,rt=function({type:ot,isSymbolTile:at,zoom:ut}){return ut=ut||0,ot==="message"?0:ot!=="maybePrepare"||at?ot!=="parseTile"||at?ot==="parseTile"&&at?300-ut:ot==="maybePrepare"&&at?400-ut:500:200-ut:100-ut}(g);if(rt===0){try{o()}finally{}return null}return this.tasks[_e]={fn:o,metadata:g,priority:rt,id:_e},this.taskQueue.push(_e),this.invoker.trigger(),{cancel:()=>{delete this.tasks[_e]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(_e=>!!this.tasks[_e]),!this.taskQueue.length)return;const o=this.pick();if(o===null)return;const g=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!g)return;g.fn()}finally{}}pick(){let o=null,g=1/0;for(let rt=0;rt<this.taskQueue.length;rt++){const ot=this.tasks[this.taskQueue[rt]];ot.priority<g&&(g=ot.priority,o=rt)}if(o===null)return null;const _e=this.taskQueue[o];return this.taskQueue.splice(o,1),_e}remove(){this.invoker.remove()}}class cA{constructor(o,g,_e){this.target=o,this.parent=g,this.mapId=_e,this.callbacks={},this.cancelCallbacks={},Vr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new HI}send(o,g,_e,rt,ot=!1,at){const ut=Math.round(1e18*Math.random()).toString(36).substring(0,10);_e&&(_e.metadata=at,this.callbacks[ut]=_e);const ft=new Set;return this.target.postMessage({id:ut,type:o,hasCallback:!!_e,targetMapId:rt,mustQueue:ot,sourceMapId:this.mapId,data:_f(g,ft)},ft),{cancel:()=>{_e&&delete this.callbacks[ut],this.target.postMessage({id:ut,type:"<cancel>",targetMapId:rt,sourceMapId:this.mapId})}}}receive(o){const g=o.data;if(!g)return;const _e=g.id;if(_e&&(!g.targetMapId||this.mapId===g.targetMapId))if(g.type==="<cancel>"){const rt=this.cancelCallbacks[_e];delete this.cancelCallbacks[_e],rt&&rt.cancel()}else if(g.mustQueue||Xs(self)){const rt=this.callbacks[_e],ot=this.scheduler.add(()=>this.processTask(_e,g),rt&&rt.metadata||{type:"message"});ot&&(this.cancelCallbacks[_e]=ot)}else this.processTask(_e,g)}processTask(o,g){if(delete this.cancelCallbacks[o],g.type==="<response>"){const _e=this.callbacks[o];delete this.callbacks[o],_e&&(g.error?_e(Nm(g.error)):_e(null,Nm(g.data)))}else{const _e=new Set,rt=g.hasCallback?(at,ut)=>{this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:at?_f(at):null,data:_f(ut,_e)},_e)}:()=>{},ot=Nm(g.data);if(this.parent[g.type])this.parent[g.type](g.sourceMapId,ot,rt);else if(this.parent.getWorkerSource){const at=g.type.split("."),{source:ut,scope:ft}=ot;this.parent.getWorkerSource(g.sourceMapId,at[0],ut,ft)[at[1]](ot,rt)}else rt(new Error(`Could not find function ${g.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var b1={workerUrl:"",workerClass:null,workerParams:void 0};const XT="mapboxgl_preloaded_worker_pool";class K_{constructor(o){this.active={},this.name=o}acquire(o,g=K_.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<g;){const rt=(_e=`${this.name||""}WorkerPool: ${o}-${this.workers.length}`,b1.workerClass!=null?new b1.workerClass:new self.Worker(b1.workerUrl,Object.assign({name:_e},b1.workerParams)));this.workers.push(rt)}var _e;return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.workers&&this.numActive()===0&&(this.workers.forEach(g=>{g.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[XT]}numActive(){return Object.keys(this.active).length}}K_.workerCount=2;class Ix{constructor(o,g,_e="Worker",rt=K_.workerCount){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=jr();const ot=this.workerPool.acquire(this.id,rt);for(let at=0;at<ot.length;at++){const ut=new Ix.Actor(ot[at],g,this.id);ut.name=`${_e} ${at}`,this.actors.push(ut)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,g,_e){Dr(this.actors,(rt,ot)=>{rt.send(o,g,ot)},_e=_e||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}let w1,ZT;function mE(){return w1||(w1=new K_),w1}Ix.Actor=cA;const YT=4096;class WI{constructor(o){this.module=o,this.memoryStack=this.module.malloc(YT),this.memoryStackNextFree=this.memoryStack}createIntArray(o){const g=this.memoryStackNextFree;return this.memoryStackNextFree+=o.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>YT?-1:(new Int32Array(this.module.heap32.buffer,g,o.length).set(o),g)}createFloatArray(o){const g=this.memoryStackNextFree;return this.memoryStackNextFree+=o.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>YT?-1:(new Float32Array(this.module.heapF32.buffer,g,o.length).set(o),g)}readStringBuffer(o){let g="";for(;this.module.heapU8[o]!==0;)g+=String.fromCharCode(this.module.heapU8[o]),++o;return g}setStyle(o){const g=o.normalScale;this.module.setStyle(g[0],g[1],g[2],o.tileToMeters)}setAOOptions(o,g){this.module.setAOOptions(o?1:0,g)}setMetricOptions(o,g){this.module.setMetricOptions(o?1:0,g)}setStructuralOptions(o){this.module.setStructuralOptions(o?1:0)}setFacadeOptions(o,g){this.module.setFacadeOptions(o,g?1:0)}setFauxFacadeOptions(o,g,_e){this.module.setFauxFacadeOptions(o?1:0,g?1:0,_e)}setFacadeClassifierOptions(o){this.module.setFacadeClassifierOptions(o)}generateMesh(o,g){this.memoryStackNextFree=this.memoryStack;for(const ut of o){const ft=this.createIntArray(ut.ringIndices),gt=this.createFloatArray(ut.coordinates);if(ft===-1||gt===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(ut.id,ut.sourceId,ut.minHeight,ut.height,ut.roofType,gt,ft,ut.ringIndices.length-1)}for(const ut of g){let ft;ft=ut.entrances?JSON.parse(ut.entrances):[];const gt=this.createFloatArray(ft),Ct=this.createFloatArray(ut.coordinates);if(gt===-1||Ct===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(ut.sourceId,ut.crossPerc,ut.distanceToRoad,gt,ft.length,Ct,ut.coordinates.length)}if(!this.module.generateMesh()){const ut=this.module.getLastError();return this.readStringBuffer(ut)}const _e=this.module.getMeshCount(),rt=new Array(_e);for(let ut=0;ut<_e;ut++){const ft=this.module.getPositionsPtr(ut),gt=this.module.getPositionsLength(ut),Ct=new Float32Array(this.module.heapF32.buffer,ft,gt),At=this.module.getNormalsPtr(ut),kt=this.module.getNormalsLength(ut),zt=new Float32Array(this.module.heapF32.buffer,At,kt),Ut=this.module.getAOPtr(ut),Kt=this.module.getAOLength(ut),er=new Float32Array(this.module.heapF32.buffer,Ut,Kt),Jt=this.module.getUVPtr(ut),or=this.module.getUVLength(ut),lr=new Float32Array(this.module.heapF32.buffer,Jt,or),pr=this.module.getFauxFacadePtr(ut),Sr=this.module.getFauxFacadeLength(ut),br=new Uint8Array(this.module.heapU8.buffer,pr,Sr),Rr=this.module.getIndicesPtr(ut),Mr=this.module.getIndicesLength(ut),Lr=new Int16Array(this.module.heap16.buffer,Rr,Mr),Jr=this.module.getBuildingPart(ut);rt[ut]={positions:Ct,normals:zt,ao:er,uv:lr,isFauxFacade:br,indices:Lr,buildingPart:Jr}}const ot=this.module.getRingCount(),at=[];for(let ut=0;ut<ot;ut++){const ft=this.module.getRingPtr(ut),gt=this.module.getRingLength(ut),Ct=new Float32Array(this.module.heapF32.buffer,ft,gt);at.push(Ct)}return{meshes:rt,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:at}}}let E1,QT,dm,Px,JT,kx=null,Mx=null,uA=null,gE=null;function hA(){return Xs(self)&&self.worker.dracoUrl?self.worker.dracoUrl:QT||Us.DRACO_URL}function dA(){if(Xs(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Px)return Px;const _=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Px=WebAssembly.validate(_)?Us.MESHOPT_SIMD_URL:Us.MESHOPT_URL,Px}function qI(){return gE}const _E={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},KI={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},T1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function pA(_,o,g){const _e=g.json.bufferViews.length,rt=g.buffers.length;o.bufferView=_e,g.json.bufferViews[_e]={buffer:rt,byteLength:_.byteLength},g.buffers[rt]=_}const eS="KHR_draco_mesh_compression";function XI(_,o){const g=_.extensions&&_.extensions[eS];if(!g)return;const _e=new dm.Decoder,rt=_A(o,g.bufferView),ot=new dm.Mesh;if(!_e.DecodeArrayToMesh(rt,rt.byteLength,ot))throw new Error("Failed to decode Draco mesh");const at=o.json.accessors[_.indices],ut=_E[at.componentType],ft=at.count*ut.BYTES_PER_ELEMENT,gt=dm._malloc(ft);ut===Uint16Array?_e.GetTrianglesUInt16Array(ot,ft,gt):_e.GetTrianglesUInt32Array(ot,ft,gt),pA(dm.memory.buffer.slice(gt,gt+ft),at,o),dm._free(gt);for(const Ct of Object.keys(g.attributes)){const At=_e.GetAttributeByUniqueId(ot,g.attributes[Ct]),kt=o.json.accessors[_.attributes[Ct]],zt=KI[kt.componentType],Ut=kt.count*T1[kt.type]*_E[kt.componentType].BYTES_PER_ELEMENT,Kt=dm._malloc(Ut);_e.GetAttributeDataArrayForAllPoints(ot,At,dm[zt],Ut,Kt),pA(dm.memory.buffer.slice(Kt,Kt+Ut),kt,o),dm._free(Kt)}_e.destroy(),ot.destroy(),delete _.extensions[eS]}const yE="EXT_meshopt_compression";function ZI(_,o){if(!_.extensions||!_.extensions[yE])return;const g=_.extensions[yE],_e=new Uint8Array(o.buffers[g.buffer],g.byteOffset||0,g.byteLength||0),rt=new Uint8Array(g.count*g.byteStride);JT.decodeGltfBuffer(rt,g.count,g.byteStride,_e,g.mode,g.filter),_.buffer=o.buffers.length,_.byteOffset=0,o.buffers[_.buffer]=rt.buffer,delete _.extensions[yE]}const fA=1179937895,mA=new TextDecoder("utf8");function gA(_,o){return new URL(_,o).href}function YI(_,o,g,_e){return fetch(gA(_.uri,_e)).then(rt=>rt.arrayBuffer()).then(rt=>{o.buffers[g]=rt})}function _A(_,o){const g=_.json.bufferViews[o];return new Uint8Array(_.buffers[g.buffer],g.byteOffset||0,g.byteLength)}function QI(_,o,g,_e){if(_.uri){const rt=gA(_.uri,_e);return fetch(rt).then(ot=>ot.blob()).then(ot=>createImageBitmap(ot)).then(ot=>{o.images[g]=ot})}if(_.bufferView!==void 0){const rt=_A(o,_.bufferView),ot=new Blob([rt],{type:_.mimeType});return createImageBitmap(ot).then(at=>{o.images[g]=at})}}function yA(_,o=0,g){const _e={json:null,images:[],buffers:[]};if(new Uint32Array(_,o,1)[0]===fA){const Ct=new Uint32Array(_,o);let At=2;const kt=(Ct[At++]>>2)-3,zt=Ct[At++]>>2;if(At++,_e.json=JSON.parse(mA.decode(Ct.subarray(At,At+zt))),At+=zt,At<kt){const Ut=Ct[At++];At++;const Kt=o+(At<<2);_e.buffers[0]=_.slice(Kt,Kt+Ut)}}else _e.json=JSON.parse(mA.decode(new Uint8Array(_,o)));const{buffers:rt,images:ot,meshes:at,extensionsUsed:ut,bufferViews:ft}=_e.json;let gt=Promise.resolve();if(rt){const Ct=[];for(let At=0;At<rt.length;At++){const kt=rt[At];kt.uri?Ct.push(YI(kt,_e,At,g)):_e.buffers[At]||(_e.buffers[At]=null)}gt=Promise.all(Ct)}return gt.then(()=>{const Ct=[],At=ut&&ut.includes(eS),kt=ut&&ut.includes(yE);if(At&&Ct.push(function(){if(!dm)return E1??(E1=function(zt){let Ut,Kt=null;function er(){Ut=new Uint8Array(Kt.buffer)}function Jt(){throw new Error("Unexpected Draco error.")}const or={a:{a:Jt,d:function(lr,pr,Sr){return Ut.copyWithin(lr,pr,pr+Sr)},c:function(lr){const pr=Ut.length,Sr=Math.max(lr>>>0,Math.ceil(1.2*pr)),br=Math.ceil((Sr-pr)/65536);try{return Kt.grow(br),er(),!0}catch{return!1}},b:Jt}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(zt,or):zt.then(lr=>lr.arrayBuffer()).then(lr=>WebAssembly.instantiate(lr,or))).then(lr=>{const{Rb:pr,Qb:Sr,P:br,T:Rr,X:Mr,Ja:Lr,La:Jr,Qa:zr,Va:sn,Wa:dn,eb:pn,jb:wn,f:Tn,e:xn,yb:vn,zb:nn,Ab:en,Bb:bn,Db:Dn,Gb:Rn}=lr.instance.exports;Kt=xn;const ts=(()=>{let Vn=0,Hn=0,Zn=0,js=0;return In=>{Zn&&(pr(js),pr(Vn),Hn+=Zn,Zn=Vn=0),Vn||(Hn+=128,Vn=Sr(Hn));const Yn=In.length+7&-8;let xs=Vn;Yn>=Hn&&(Zn=Yn,xs=js=Sr(Yn));for(let Gs=0;Gs<In.length;Gs++)Ut[xs+Gs]=In[Gs];return xs}})();return er(),Tn(),{memory:xn,_free:pr,_malloc:Sr,Mesh:class{constructor(){this.ptr=br()}destroy(){Rr(this.ptr)}},Decoder:class{constructor(){this.ptr=Lr()}destroy(){wn(this.ptr)}DecodeArrayToMesh(Vn,Hn,Zn){const js=ts(Vn),In=Jr(this.ptr,js,Hn,Zn.ptr);return!!Mr(In)}GetAttributeByUniqueId(Vn,Hn){return{ptr:zr(this.ptr,Vn.ptr,Hn)}}GetTrianglesUInt16Array(Vn,Hn,Zn){sn(this.ptr,Vn.ptr,Hn,Zn)}GetTrianglesUInt32Array(Vn,Hn,Zn){dn(this.ptr,Vn.ptr,Hn,Zn)}GetAttributeDataArrayForAllPoints(Vn,Hn,Zn,js,In){pn(this.ptr,Vn.ptr,Hn.ptr,Zn,js,In)}},DT_INT8:vn(),DT_UINT8:nn(),DT_INT16:en(),DT_UINT16:bn(),DT_UINT32:Dn(),DT_FLOAT32:Rn()}})}(fetch(hA())),E1.then(zt=>{dm=zt,E1=void 0}))}()),kt&&Ct.push(function(){if(JT)return;const zt=function(Ut){let Kt;const er=WebAssembly.instantiateStreaming(Ut,{}).then(lr=>{Kt=lr.instance,Kt.exports.__wasm_call_ctors()}),Jt={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},or={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:er,supported:!0,decodeGltfBuffer(lr,pr,Sr,br,Rr,Mr){(function(Lr,Jr,zr,sn,dn,pn,wn){const Tn=Lr.exports.sbrk,xn=sn+3&-4,vn=Tn(xn*dn),nn=Tn(pn.length),en=new Uint8Array(Lr.exports.memory.buffer);en.set(pn,nn);const bn=Jr(vn,sn,dn,nn,pn.length);if(bn===0&&wn&&wn(vn,xn,dn),zr.set(en.subarray(vn,vn+sn*dn)),Tn(vn-Tn(0)),bn!==0)throw new Error(`Malformed buffer data: ${bn}`)})(Kt,Kt.exports[or[Rr]],lr,pr,Sr,br,Kt.exports[Jt[Mr]])}}}(fetch(dA()));return zt.ready.then(()=>{JT=zt})}()),ot)for(let zt=0;zt<ot.length;zt++)Ct.push(QI(ot[zt],_e,zt,g));return(Ct.length?Promise.all(Ct):Promise.resolve()).then(()=>{if(At&&at)for(const{primitives:zt}of at)for(const Ut of zt)XI(Ut,_e);if(kt&&at&&ft)for(const zt of ft)ZI(zt,_e);return _e})})}function xA(_){return fetch(_).then(o=>o.arrayBuffer()).then(o=>yA(o,0,_))}function tS(_){switch(_){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function rS(_){switch(_){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class iS{constructor(o,g,_e,rt){this.context=o,this.format=_e,this.useMipmap=rt&&rt.useMipmap,this.texture=o.gl.createTexture(),this.update(g,{premultiply:rt&&rt.premultiply})}update(o,g){const _e=o&&o instanceof HTMLVideoElement&&o.width===0?o.videoWidth:o.width,rt=o&&o instanceof HTMLVideoElement&&o.height===0?o.videoHeight:o.height,{context:ot}=this,{gl:at}=ot,{x:ut,y:ft}=g&&g.position?g.position:{x:0,y:0},gt=ut+_e,Ct=ft+rt;!this.size||this.size[0]===gt&&this.size[1]===Ct||(at.bindTexture(at.TEXTURE_2D,null),at.deleteTexture(this.texture),this.texture=at.createTexture(),this.size=null),at.bindTexture(at.TEXTURE_2D,this.texture),ot.pixelStoreUnpackFlipY.set(!1),ot.pixelStoreUnpack.set(1),ot.pixelStoreUnpackPremultiplyAlpha.set(this.format===at.RGBA8&&(!g||g.premultiply!==!1));const At=o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||ImageBitmap&&o instanceof ImageBitmap;if(!this.size&&gt>0&&Ct>0){const kt=this.useMipmap?Math.floor(Math.log2(Math.max(gt,Ct)))+1:1;at.texStorage2D(at.TEXTURE_2D,kt,this.format,gt,Ct),this.size=[gt,Ct]}this.size&&(At?at.texSubImage2D(at.TEXTURE_2D,0,ut,ft,tS(this.format),rS(this.format),o):"data"in o&&o.data&&at.texSubImage2D(at.TEXTURE_2D,0,ut,ft,_e,rt,tS(this.format),rS(this.format),o.data)),this.useMipmap&&at.generateMipmap(at.TEXTURE_2D)}bind(o,g,_e=!1){const{context:rt}=this,{gl:ot}=rt;ot.bindTexture(ot.TEXTURE_2D,this.texture),o!==this.minFilter&&(ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_MAG_FILTER,o),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_MIN_FILTER,this.useMipmap&&!_e?o===ot.NEAREST?ot.NEAREST_MIPMAP_NEAREST:ot.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),g!==this.wrapS&&(ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_WRAP_S,g),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_WRAP_T,g),this.wrapS=g)}bindExtraParam(o,g,_e,rt,ot){const{context:at}=this,{gl:ut}=at;ut.bindTexture(ut.TEXTURE_2D,this.texture),g!==this.magFilter&&(ut.texParameteri(ut.TEXTURE_2D,ut.TEXTURE_MAG_FILTER,g),this.magFilter=g),o!==this.minFilter&&(ut.texParameteri(ut.TEXTURE_2D,ut.TEXTURE_MIN_FILTER,this.useMipmap?o===ut.NEAREST?ut.NEAREST_MIPMAP_NEAREST:ut.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),_e!==this.wrapS&&(ut.texParameteri(ut.TEXTURE_2D,ut.TEXTURE_WRAP_S,_e),this.wrapS=_e),rt!==this.wrapT&&(ut.texParameteri(ut.TEXTURE_2D,ut.TEXTURE_WRAP_T,rt),this.wrapT=rt),ot!==this.compareMode&&(ot?(ut.texParameteri(ut.TEXTURE_2D,ut.TEXTURE_COMPARE_MODE,ut.COMPARE_REF_TO_TEXTURE),ut.texParameteri(ut.TEXTURE_2D,ut.TEXTURE_COMPARE_FUNC,ot)):ut.texParameteri(ut.TEXTURE_2D,ut.TEXTURE_COMPARE_MODE,ut.NONE),this.compareMode=ot)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class S1{constructor(o,g){this.context=o,this.texture=g}bind(o,g){const{context:_e}=this,{gl:rt}=_e;rt.bindTexture(rt.TEXTURE_2D,this.texture),o!==this.minFilter&&(rt.texParameteri(rt.TEXTURE_2D,rt.TEXTURE_MAG_FILTER,o),rt.texParameteri(rt.TEXTURE_2D,rt.TEXTURE_MIN_FILTER,o),this.minFilter=o),g!==this.wrapS&&(rt.texParameteri(rt.TEXTURE_2D,rt.TEXTURE_WRAP_S,g),rt.texParameteri(rt.TEXTURE_2D,rt.TEXTURE_WRAP_T,g),this.wrapS=g)}}const JI=Bs([{name:"a_pos_3f",components:3,type:"Float32"}]),eP=Bs([{name:"a_color_3f",components:3,type:"Float32"}]),tP=Bs([{name:"a_color_4f",components:4,type:"Float32"}]),rP=Bs([{name:"a_uv_2f",components:2,type:"Float32"}]),iP=Bs([{name:"a_normal_3f",components:3,type:"Float32"}]),nP=Bs([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),sP=Bs([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function vA(_,o){const g=xE(_.projection,_.zoom,_.width,_.height),_e=function(ot,at,ut,ft,gt){const Ct=new $(ut.lng-180*X0,ut.lat),At=new $(ut.lng+180*X0,ut.lat),kt=ot.project(Ct.lng,Ct.lat),zt=ot.project(At.lng,At.lat),Ut=-Math.atan2(zt.y-kt.y,zt.x-kt.x),Kt=hr.fromLngLat(ut);Kt.y=tr(Kt.y,-1+X0,1-X0);const er=Kt.toLngLat(),Jt=ot.project(er.lng,er.lat),or=hr.fromLngLat(er);or.x+=X0;const lr=or.toLngLat(),pr=ot.project(lr.lng,lr.lat),Sr=wA(pr.x-Jt.x,pr.y-Jt.y,Ut),br=hr.fromLngLat(er);br.y+=X0;const Rr=br.toLngLat(),Mr=ot.project(Rr.lng,Rr.lat),Lr=wA(Mr.x-Jt.x,Mr.y-Jt.y,Ut),Jr=Math.abs(Sr.x)/Math.abs(Lr.y),zr=Gt([]);ur(zr,zr,-Ut*(1-(gt?0:ft)));const sn=Gt([]);return Vt(sn,sn,[1,1-(1-Jr)*ft,1]),sn[4]=-Lr.x/Lr.y*ft,ur(sn,sn,Ut),Bt(sn,zr,sn),sn}(_.projection,0,_.center,g,o),rt=bA(_);return Vt(_e,_e,[rt,rt,1]),_e}function bA(_){const o=_.projection,g=xE(_.projection,_.zoom,_.width,_.height),_e=nS(o,_.center),rt=nS(o,$.convert(o.center));return Math.pow(2,_e*g+(1-g)*rt)}function xE(_,o,g,_e,rt=1/0){const ot=_.range;if(!ot)return 0;const at=Math.min(rt,Math.max(g,_e)),ut=Math.log2(at/1024);return ar(ot[0]+ut,ot[1]+ut,o)}const X0=1/4e4;function nS(_,o){const g=tr(o.lat,-qt,qt),_e=new $(o.lng-180*X0,g),rt=new $(o.lng+180*X0,g),ot=_.project(_e.lng,g),at=_.project(rt.lng,g),ut=hr.fromLngLat(_e),ft=hr.fromLngLat(rt),gt=at.x-ot.x,Ct=at.y-ot.y,At=ft.x-ut.x,kt=ft.y-ut.y,zt=Math.sqrt((At*At+kt*kt)/(gt*gt+Ct*Ct));return Math.log2(zt)}function wA(_,o,g){const _e=Math.cos(g),rt=Math.sin(g);return{x:_*_e-o*rt,y:_*rt+o*_e}}function EA(_,o,g){Gt(_),ur(_,_,Fs(o[2])),Zt(_,_,Fs(o[0])),nr(_,_,Fs(o[1])),Vt(_,_,g),Bt(_,_,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function vE(_,o,g,_e,rt,ot,at,ut){const ft=[g[0]-o[0],g[1]-o[1],0],gt=[_e[0]-o[0],_e[1]-o[1],0];if(_i(ft)<1e-12||_i(gt)<1e-12)return xa(_);const Ct=Ss([],ft,gt);ls(Ct,Ct),cr(gt,_e,o),ft[2]=(ot-rt)*ut,gt[2]=(at-rt)*ut;const At=ft;return Ss(At,ft,gt),ls(At,At),Ip(_,Ct,At)}function bE(_,o,g=!1){const _e=q0(o.zoom),rt=function(ot,at,ut){const ft=at.worldSize,gt=[ot[12],ot[13],ot[14]],Ct=Ht(gt[1]/ft),At=Mt(gt[0]/ft),kt=Gt([]),zt=Pt(1,Ct)*ft,Ut=Pt(1,0)*ft*Xt(Ct,at.zoom),Kt=1/DT(ft);let er=Ut*Kt;if(ut){const pr=xE(at.projection,at.zoom,at.width,at.height,1024);er=Kt*at.projection.pixelSpaceConversion(at.center.lat,ft,pr)}const Jt=G0(Ct,At);rr(Jt,Jt,fn([],ls([],Jt),zt*er*gt[2]));const or=function(pr){const Sr=[pr[0],pr[1],pr[2]];let br=[0,1,0];const Rr=Ss([],br,Sr);return Ss(br,Sr,Rr),ns(br)===0&&(br=[0,1,0],Ss(Rr,Sr,br)),ls(Rr,Rr),ls(br,br),ls(Sr,Sr),[Rr[0],Rr[1],Rr[2],0,br[0],br[1],br[2],0,Sr[0],Sr[1],Sr[2],0,pr[0],pr[1],pr[2],1]}(Jt);Vt(kt,kt,[er,er,er*zt]),Lt(kt,kt,[-gt[0],-gt[1],-gt[2]]);const lr=Bt([],at.globeMatrix,or);return Bt(lr,lr,kt),Bt(lr,lr,ot),lr}(_,o,g);if(_e>0){const ot=function(at,ut){const ft=ut.worldSize,gt=Pt(1,0)*ft*Xt(ut.center.lat,ut.zoom)/DT(ft),Ct=Pt(1,ut.center.lat)*ft,At=Gt([]);nr(At,At,Fs(ut.center.lng)),Zt(At,At,Fs(ut.center.lat)),Lt(At,At,[0,0,mu]),Vt(At,At,[gt,gt,gt*Ct]);const kt=ut.point;return Lt(At,At,[-kt.x,-kt.y,0]),Bt(At,At,at),Bt(At,ut.globeMatrix,At)}(_,o);return function(at,ut,ft){const gt=(Ut,Kt,er)=>{const Jt=_i(Ut),or=_i(Kt),lr=hm(Ut,Kt,er);return fn(lr,lr,1/_i(lr)*fs(Jt,or,er))},Ct=gt([at[0],at[1],at[2]],[ut[0],ut[1],ut[2]],ft),At=gt([at[4],at[5],at[6]],[ut[4],ut[5],ut[6]],ft),kt=gt([at[8],at[9],at[10]],[ut[8],ut[9],ut[10]],ft),zt=hm([at[12],at[13],at[14]],[ut[12],ut[13],ut[14]],ft);return[Ct[0],Ct[1],Ct[2],0,At[0],At[1],At[2],0,kt[0],kt[1],kt[2],0,zt[0],zt[1],zt[2],1]}(rt,ot,_e)}return rt}function sS(_,o,g,_e){const rt=Jn.projectAabbCorners(_e,g);let ot=Number.MAX_VALUE;for(let ut=0;ut<rt.length;++ut){const ft=rt[ut];ft[0]=(.5*ft[0]+.5)*o.width,ft[1]=(.5-.5*ft[1])*o.height,ft[2]<ot&&(ot=ft[2])}const at=function(ut){const ft=[];let gt=0;for(let zt=1;zt<ut.length;zt++)(ut[zt][0]<ut[gt][0]||ut[zt][0]===ut[gt][0]&&ut[zt][1]<ut[gt][1])&&(gt=zt);let Ct,At=gt;const kt=new Uint8Array(ut.length);do{if(kt[At])break;ft.push(new mn(ut[At][0],ut[At][1])),kt[At]=1,Ct=(At+1)%ut.length;for(let zt=0;zt<ut.length;zt++){if(ut[zt][0]===ut[Ct][0]&&ut[zt][1]===ut[Ct][1]||ut[zt][0]===ut[At][0]&&ut[zt][1]===ut[At][1])continue;const Ut=[ut[zt][0]-ut[At][0],ut[zt][1]-ut[At][1]],Kt=[ut[Ct][0]-ut[At][0],ut[Ct][1]-ut[At][1]],er=Ut[0]*Kt[1]-Ut[1]*Kt[0];(er>0||er===0&&Ut[0]*Kt[0]+Ut[1]*Kt[1]>=0&&Ut[0]*Ut[0]+Ut[1]*Ut[1]>Kt[0]*Kt[0]+Kt[1]*Kt[1])&&(Ct=zt)}At=Ct}while(At!==gt);return ft.length>0&&ft.push(ft[0]),ft}(rt);if(to(_,at))return ot}const X_=64,Dx={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function wE(_,o,g,_e,rt,ot,at,ut,ft,gt=!1){const Ct=g.zoom,At=g.project(_e),kt=Xt(_e.lat,Ct),zt=1/kt;Gt(_),Lt(_,_,[At.x+at[0]*zt,At.y+at[1]*zt,at[2]]);let Ut=1,Kt=1;const er=g.worldSize;if(gt){if(g.projection.name==="mercator"){let pr=0;g.elevation&&(pr=g.elevation.getAtPointOrZero(new hr(At.x/er,At.y/er),0));const Sr=Jo([],[At.x,At.y,pr,1],g.projMatrix)[3]/g.cameraToCenterDistance;Ut=Sr,Kt=Sr*Xt(g.center.lat,Ct)}else if(g.projection.name==="globe"){const pr=bE(_,g),Sr=[0,0,0,1];Jo(Sr,Sr,Bt([],g.projMatrix,pr));const br=Sr[3]/g.cameraToCenterDistance,Rr=q0(Ct),Mr=g.projection.pixelsPerMeter(_e.lat,er)*Xt(_e.lat,Ct),Lr=g.projection.pixelsPerMeter(g.center.lat,er)*Xt(g.center.lat,Ct);Ut=br/fs(Mr,Qt(g.center.lat),Rr),Kt=br*kt/Mr,Ut*=Lr,Kt*=Lr}}else Ut=zt;Vt(_,_,[Ut,Ut,Kt]);const Jt=[..._],or=o.orientation,lr=[];if(EA(lr,[or[0]+(rt?rt[0]:0),or[1]+(rt?rt[1]:0),or[2]+(rt?rt[2]:0)],ot),Bt(_,Jt,lr),ut&&g.elevation){let pr=0;const Sr=[];if(ft&&g.elevation){pr=function(Rr,Mr,Lr,Jr,zr){const sn=Mr.elevation;if(!sn)return 0;const dn=Jn.projectAabbCorners(Lr,Jr),pn=Pt(1,zr.lat)*Mr.worldSize,wn=function(Hn,Zn){const js=[0,0,1],In=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Yn of In){const xs=Hn[Yn.corners[0]],Gs=Hn[Yn.corners[1]],Ws=Hn[Yn.corners[2]],Rs=[Gs[0]-xs[0],Gs[1]-xs[1],Zn*(Gs[2]-xs[2])],vo=Ss(Rs,Rs,[Ws[0]-xs[0],Ws[1]-xs[1],Zn*(Ws[2]-xs[2])]);ls(vo,vo),Yn.dotProductWithUp=ms(vo,js)}return In.sort((Yn,xs)=>Yn.dotProductWithUp-xs.dotProductWithUp),In[0].corners}(dn,pn),Tn=dn[wn[0]],xn=dn[wn[1]],vn=dn[wn[2]],nn=dn[wn[3]],en=sn.getAtPointOrZero(new hr(Tn[0]/Mr.worldSize,Tn[1]/Mr.worldSize),0),bn=sn.getAtPointOrZero(new hr(xn[0]/Mr.worldSize,xn[1]/Mr.worldSize),0),Dn=sn.getAtPointOrZero(new hr(vn[0]/Mr.worldSize,vn[1]/Mr.worldSize),0),Rn=sn.getAtPointOrZero(new hr(nn[0]/Mr.worldSize,nn[1]/Mr.worldSize),0),ts=(en+Rn)/2,Vn=(bn+Dn)/2;return ts>Vn?bn<Dn?vE(Rr,xn,nn,Tn,bn,Rn,en,pn):vE(Rr,vn,Tn,nn,Dn,en,Rn,pn):en<Rn?vE(Rr,Tn,xn,vn,en,bn,Dn,pn):vE(Rr,nn,vn,xn,Rn,Dn,bn,pn),Math.max(ts,Vn)}(Sr,g,o.aabb,_,_e);const br=Bt([],an([],Sr),lr);Bt(_,Jt,br)}else pr=g.elevation.getAtPointOrZero(new hr(At.x/er,At.y/er),0);pr!==0&&(_[14]+=pr)}}class TA{constructor(o,g,_e,rt,ot){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=o,this.uri=g,this.position=_e!=null?new $(_e[0],_e[1]):new $(0,0),this.orientation=rt??[0,0,0],this.nodes=ot,this.uploaded=!1,this.aabb=new Jn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(o,g){Bt(o.globalMatrix,g,o.localMatrix);const _e=this.nodeOverrides.get(o.name);if(_e!==void 0){const at=[];ot=_e.orientation,Gt(rt=at),nr(rt,rt,Fs(ot[1])),ur(rt,rt,Fs(ot[2])),Zt(rt,rt,Fs(ot[0])),Bt(o.globalMatrix,o.globalMatrix,at)}var rt,ot;if(o.meshes)for(const at of o.meshes){const ut=Jn.applyTransformFast(at.aabb,o.globalMatrix);this.aabb.encapsulate(ut)}if(o.children)for(const at of o.children)this._applyTransformations(at,o.globalMatrix)}computeBoundsAndApplyParent(){const o=Gt([]);this.aabb=new Jn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const g of this.nodes)this._applyTransformations(g,o)}computeModelMatrix(o,g,_e,rt,ot,at,ut=!1){wE(this.matrix,this,o.transform,this.position,g,_e,rt,ot,at,ut)}upload(o){if(!this.uploaded){for(const g of this.nodes)oS(g,o);for(const g of this.nodes)EE(g);this.uploaded=!0}}destroy(){for(const o of this.nodes)aS(o)}}function C1(_,o,g=!1){_.uploaded||(_.gfxTexture=new iS(o,_.image,g?o.gl.R8:o.gl.RGBA8,{useMipmap:_.sampler.minFilter>=o.gl.NEAREST_MIPMAP_NEAREST}),_.uploaded=!0,_.image=null)}function oP(_,o,g){_.indexBuffer=o.createIndexBuffer(_.indexArray,!1,!0),_.vertexBuffer=o.createVertexBuffer(_.vertexArray,JI.members,!1,!0),_.normalArray&&(_.normalBuffer=o.createVertexBuffer(_.normalArray,iP.members,!1,!0)),_.texcoordArray&&(_.texcoordBuffer=o.createVertexBuffer(_.texcoordArray,rP.members,!1,!0)),_.colorArray&&(_.colorBuffer=o.createVertexBuffer(_.colorArray,(_.colorArray.bytesPerElement===12?eP:tP).members,!1,!0)),_.featureArray&&(_.pbrBuffer=o.createVertexBuffer(_.featureArray,sP.members,!0)),_.segments=Go.simpleSegment(0,0,_.vertexArray.length,_.indexArray.length);const _e=_.material;_e.pbrMetallicRoughness.baseColorTexture&&C1(_e.pbrMetallicRoughness.baseColorTexture,o),_e.pbrMetallicRoughness.metallicRoughnessTexture&&C1(_e.pbrMetallicRoughness.metallicRoughnessTexture,o),_e.normalTexture&&C1(_e.normalTexture,o),_e.occlusionTexture&&C1(_e.occlusionTexture,o,g),_e.emissionTexture&&C1(_e.emissionTexture,o)}function oS(_,o,g){if(_.meshes)for(const _e of _.meshes)oP(_e,o,g);if(_.children)for(const _e of _.children)oS(_e,o,g)}function EE(_){if(_.meshes)for(const o of _.meshes)o.indexArray.destroy(),o.vertexArray.destroy(),o.colorArray&&o.colorArray.destroy(),o.normalArray&&o.normalArray.destroy(),o.texcoordArray&&o.texcoordArray.destroy(),o.featureArray&&o.featureArray.destroy();if(_.children)for(const o of _.children)EE(o)}function aS(_){if(_.meshes)for(const g of _.meshes)g.vertexBuffer&&(g.vertexBuffer.destroy(),g.indexBuffer.destroy(),g.normalBuffer&&g.normalBuffer.destroy(),g.texcoordBuffer&&g.texcoordBuffer.destroy(),g.colorBuffer&&g.colorBuffer.destroy(),g.pbrBuffer&&g.pbrBuffer.destroy(),g.segments.destroy(),g.material&&((o=g.material).pbrMetallicRoughness.baseColorTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),o.pbrMetallicRoughness.metallicRoughnessTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),o.normalTexture&&o.normalTexture.gfxTexture&&o.normalTexture.gfxTexture.destroy(),o.emissionTexture&&o.emissionTexture.gfxTexture&&o.emissionTexture.gfxTexture.destroy(),o.occlusionTexture&&o.occlusionTexture.gfxTexture&&o.occlusionTexture.gfxTexture.destroy()));var o;if(_.children)for(const g of _.children)aS(g)}function Z_(_,o){const g=_.json.bufferViews[o.bufferView],_e=_E[o.componentType];return new _e(_.buffers[g.buffer],(o.byteOffset||0)+(g.byteOffset||0),o.count*(g.byteStride&&g.byteStride!==T1[o.type]*_e.BYTES_PER_ELEMENT?g.byteStride/_e.BYTES_PER_ELEMENT:T1[o.type]))}function lS(_,o,g,_e){const rt=_E[o.componentType],ot=function(Ct){switch(Ct){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(rt),at=_.json.bufferViews[o.bufferView],ut=at.byteStride?at.byteStride/rt.BYTES_PER_ELEMENT:T1[o.type],ft=g.float32,gt=ft.length/g.capacity;for(let Ct=0,At=0;Ct<o.count*ut;Ct+=ut,At+=gt)for(let kt=0;kt<gt;kt++)ft[At+kt]=_e[Ct+kt]*ot;g._trim()}function aP(_,o,g){const _e=_.indices,rt=_.attributes,ot={};ot.indexArray=new Fl;const at=o.json.accessors[_e],ut=at.count/3;ot.indexArray.reserve(ut);const ft=Z_(o,at);for(let kt=0;kt<ut;kt++)ot.indexArray.emplaceBack(ft[3*kt],ft[3*kt+1],ft[3*kt+2]);ot.indexArray._trim(),ot.vertexArray=new Ku;const gt=o.json.accessors[rt.POSITION];ot.vertexArray.reserve(gt.count);const Ct=Z_(o,gt);for(let kt=0;kt<gt.count;kt++)ot.vertexArray.emplaceBack(Ct[3*kt],Ct[3*kt+1],Ct[3*kt+2]);if(ot.vertexArray._trim(),ot.aabb=new Jn(gt.min,gt.max),ot.centroid=function(kt,zt){const Ut=[0,0,0],Kt=kt.length;if(Kt>0){for(let er=0;er<Kt;er++){const Jt=3*kt[er];Ut[0]+=zt[Jt],Ut[1]+=zt[Jt+1],Ut[2]+=zt[Jt+2]}Ut[0]/=Kt,Ut[1]/=Kt,Ut[2]/=Kt}return Ut}(ft,Ct),rt.COLOR_0!==void 0){const kt=o.json.accessors[rt.COLOR_0],zt=T1[kt.type],Ut=Z_(o,kt);ot.colorArray=zt===3?new Ku:new Om,ot.colorArray.resize(kt.count),lS(o,kt,ot.colorArray,Ut)}if(rt.NORMAL!==void 0){ot.normalArray=new Ku;const kt=o.json.accessors[rt.NORMAL];ot.normalArray.resize(kt.count);const zt=Z_(o,kt);lS(o,kt,ot.normalArray,zt)}if(rt.TEXCOORD_0!==void 0&&g.length>0){ot.texcoordArray=new Up;const kt=o.json.accessors[rt.TEXCOORD_0];ot.texcoordArray.resize(kt.count);const zt=Z_(o,kt);lS(o,kt,ot.texcoordArray,zt)}if(rt._FEATURE_ID_RGBA4444!==void 0){const kt=o.json.accessors[rt._FEATURE_ID_RGBA4444];o.json.extensionsUsed&&o.json.extensionsUsed.includes("EXT_meshopt_compression")&&(ot.featureData=Z_(o,kt))}rt._FEATURE_RGBA4444!==void 0&&(ot.featureData=new Uint32Array(Z_(o,o.json.accessors[rt._FEATURE_RGBA4444]).buffer));const At=_.material;return ot.material=function(kt,zt){const{emissiveFactor:Ut=[0,0,0],alphaMode:Kt="OPAQUE",alphaCutoff:er=.5,normalTexture:Jt,occlusionTexture:or,emissiveTexture:lr,doubleSided:pr,name:Sr}=kt,{baseColorFactor:br=[1,1,1,1],metallicFactor:Rr=1,roughnessFactor:Mr=1,baseColorTexture:Lr,metallicRoughnessTexture:Jr}=kt.pbrMetallicRoughness||{},zr=or?zt[or.index]:void 0;if(or&&or.extensions&&or.extensions.KHR_texture_transform&&zr){const sn=or.extensions.KHR_texture_transform;zr.offsetScale=[sn.offset[0],sn.offset[1],sn.scale[0],sn.scale[1]]}return{name:Sr,pbrMetallicRoughness:{baseColorFactor:new fo(...br),metallicFactor:Rr,roughnessFactor:Mr,baseColorTexture:Lr?zt[Lr.index]:void 0,metallicRoughnessTexture:Jr?zt[Jr.index]:void 0},doubleSided:pr,emissiveFactor:new fo(...Ut),alphaMode:Kt,alphaCutoff:er,normalTexture:Jt?zt[Jt.index]:void 0,occlusionTexture:zr,emissionTexture:lr?zt[lr.index]:void 0,defined:kt.defined===void 0}}(At!==void 0?o.json.materials[At]:{defined:!1},g),ot}function SA(_,o,g){const{matrix:_e,rotation:rt,translation:ot,scale:at,mesh:ut,extras:ft,children:gt,name:Ct}=_,At={};if(At.name=Ct,At.localMatrix=_e||function(kt,zt,Ut,Kt){var er=zt[0],Jt=zt[1],or=zt[2],lr=zt[3],pr=er+er,Sr=Jt+Jt,br=or+or,Rr=er*pr,Mr=er*Sr,Lr=er*br,Jr=Jt*Sr,zr=Jt*br,sn=or*br,dn=lr*pr,pn=lr*Sr,wn=lr*br,Tn=Kt[0],xn=Kt[1],vn=Kt[2];return kt[0]=(1-(Jr+sn))*Tn,kt[1]=(Mr+wn)*Tn,kt[2]=(Lr-pn)*Tn,kt[3]=0,kt[4]=(Mr-wn)*xn,kt[5]=(1-(Rr+sn))*xn,kt[6]=(zr+dn)*xn,kt[7]=0,kt[8]=(Lr+pn)*vn,kt[9]=(zr-dn)*vn,kt[10]=(1-(Rr+Jr))*vn,kt[11]=0,kt[12]=Ut[0],kt[13]=Ut[1],kt[14]=Ut[2],kt[15]=1,kt}([],rt||[0,0,0,1],ot||[0,0,0],at||[1,1,1]),At.globalMatrix=It(At.localMatrix),ut!==void 0){At.meshes=g[ut];const kt=At.anchor=[0,0];for(const zt of At.meshes){const{min:Ut,max:Kt}=zt.aabb;kt[0]+=Ut[0]+Kt[0],kt[1]+=Ut[1]+Kt[1]}kt[0]=Math.floor(kt[0]/At.meshes.length/2),kt[1]=Math.floor(kt[1]/At.meshes.length/2)}if(ft&&(ft.id&&(At.id=ft.id),ft.lights&&(At.lights=function(kt){if(!kt.length)return[];const zt=function(or){const lr=atob(or),pr=new Uint8Array(lr.length);for(let Sr=0;Sr<lr.length;Sr++)pr[Sr]=lr.codePointAt(Sr);return pr}(kt),Ut=[],Kt=zt.length/24,er=new Uint16Array(zt.buffer),Jt=new Float32Array(zt.buffer);for(let or=0;or<Kt;or++){const lr=er[2*or*6]/30,pr=er[2*or*6+1]/30,Sr=er[2*or*6+10]/100,br=Jt[6*or+1],Rr=Jt[6*or+2],Mr=Jt[6*or+3],Lr=Jt[6*or+4],Jr=Mr-br,zr=Lr-Rr,sn=Math.hypot(Jr,zr);Ut.push({pos:[br+.5*Jr,Rr+.5*zr,pr],normal:[zr/sn,-Jr/sn,0],width:sn,height:lr,depth:Sr,points:[br,Rr,Mr,Lr]})}return Ut}(ft.lights)),ft.MAPBOX_geometry_bloom&&(At.isGeometryBloom=ft.MAPBOX_geometry_bloom)),gt){const kt=[];for(const zt of gt)kt.push(SA(o.json.nodes[zt],o,g));At.children=kt}return At}function lP(_){if(_.vertices.length===0||_.indices.length===0)return null;const o=new cE(_.vertices,_.indices,8,256),[g,_e]=[o.min.clone(),o.max.clone()];return{vertices:_.vertices,indices:_.indices,grid:o,min:g,max:_e}}function cP(_){if(!_.extras||!_.extras.ground)return null;const o=_.extras.ground;if(!o||!Array.isArray(o)||o.length===0)return null;const g=o[0];if(!g||!Array.isArray(g)||g.length===0)return null;const _e=[];for(const at of g){if(!Array.isArray(at)||at.length!==2)continue;const ut=at[0],ft=at[1];typeof ut=="number"&&typeof ft=="number"&&_e.push(new mn(ut,ft))}if(_e.length<3)return null;_e.length>1&&_e[_e.length-1].equals(_e[0])&&_e.pop();let rt=0;for(let at=0;at<_e.length;at++){const ut=_e[at],ft=_e[(at+1)%_e.length],gt=_e[(at+2)%_e.length];rt+=(ut.x-ft.x)*(gt.y-ft.y)-(gt.x-ft.x)*(ut.y-ft.y)}rt>0&&_e.reverse();const ot=Ax(_e.flatMap(at=>[at.x,at.y]),[]);return ot.length===0?null:{vertices:_e,indices:ot}}function uP(_,o){const g=[],_e=[];let rt=0;const ot=[];for(const at of _){rt=g.length;const ut=at.vertexArray.float32,ft=at.indexArray.uint16;for(let gt=0;gt<at.vertexArray.length;gt++)ot[0]=ut[3*gt+0],ot[1]=ut[3*gt+1],ot[2]=ut[3*gt+2],ws(ot,ot,o),g.push(new mn(ot[0],ot[1]));for(let gt=0;gt<3*at.indexArray.length;gt++)_e.push(ft[gt]+rt)}if(_e.length%3!=0)return null;for(let at=0;at<_e.length;at+=3){const ut=g[_e[at+0]],ft=g[_e[at+1]],gt=g[_e[at+2]];(ut.x-ft.x)*(gt.y-ft.y)-(gt.x-ft.x)*(ut.y-ft.y)>0&&([_e[at+1],_e[at+2]]=[_e[at+2],_e[at+1]])}return{vertices:g,indices:_e}}function cS(_){const o=function(ft,gt){const Ct=[],At=WebGL2RenderingContext;if(ft.json.textures)for(const kt of ft.json.textures){const zt={magFilter:At.LINEAR,minFilter:At.NEAREST,wrapS:At.REPEAT,wrapT:At.REPEAT};kt.sampler!==void 0&&Object.assign(zt,ft.json.samplers[kt.sampler]),Ct.push({image:gt[kt.source],sampler:zt,uploaded:!1})}return Ct}(_,_.images),g=function(ft,gt){const Ct=[];for(const At of ft.json.meshes){const kt=[];for(const zt of At.primitives)kt.push(aP(zt,ft,gt));Ct.push(kt)}return Ct}(_,o),{scenes:_e,scene:rt,nodes:ot}=_.json,at=_e?_e[rt||0].nodes:[...ot.keys()],ut=[];for(const ft of at)ut.push(SA(ot[ft],_,g));return function(ft,gt,Ct){const At={},kt=new Set;for(let zt=0;zt<ft.length;zt++){const Ut=Ct[gt[zt]];if(!Ut.extras)continue;const Kt=Ut.extras["mapbox:footprint:version"],er=Ut.extras["mapbox:footprint:id"];(Kt||er)&&kt.add(zt),Kt==="1.0.0"&&er&&(At[er]=zt)}for(let zt=0;zt<ft.length;zt++){if(kt.has(zt))continue;const Ut=ft[zt],Kt=Ct[gt[zt]];if(!Kt.extras)continue;let er=null;Ut.id in At&&(er=uP(ft[At[Ut.id]].meshes,Ut.localMatrix)),er||(er=cP(Kt)),er&&(Ut.footprint=lP(er))}if(kt.size>0){const zt=Array.from(kt.values()).sort((Ut,Kt)=>Ut-Kt);for(let Ut=zt.length-1;Ut>=0;Ut--)ft.splice(zt[Ut],1)}}(ut,at,_.json.nodes),ut}function hP(_){_.heightmap=new Float32Array(4096),_.heightmap.fill(-1);const o=_.vertexArray.float32,g=_.aabb.min[0]-1,_e=_.aabb.min[1]-1,rt=X_/(_.aabb.max[0]-g+2),ot=X_/(_.aabb.max[1]-_e+2);for(let at=0;at<o.length;at+=3){const ut=o[at+2],ft=(o[at+0]-g)*rt|0,gt=(o[at+1]-_e)*ot|0;ut>_.heightmap[gt*X_+ft]&&(_.heightmap[gt*X_+ft]=ut)}}function CA(_,o,g,_e,rt){g.reserve(g.length+4*_.length),_e.reserve(_e.length+10*_.length),rt.reserve(rt.length+10*_.length);let ot=_e.length;for(const at of _){const ut=Math.min(10,Math.max(4,1.3*at.height))*o,ft=[-at.normal[1],at.normal[0],0],gt=Math.min(.29,.1*at.width/at.depth),Ct=at.width-2*at.depth*o*(gt+.01),At=jn([],at.pos,ft,Ct/2),kt=jn([],at.pos,ft,-Ct/2),zt=[At[0],At[1],At[2]+at.height],Ut=[kt[0],kt[1],kt[2]+at.height],Kt=jn([],at.normal,ft,gt);fn(Kt,Kt,ut);const er=jn([],at.normal,ft,-gt);fn(er,er,ut),rr(Kt,At,Kt),rr(er,kt,er),At[2]+=.1,kt[2]+=.1,_e.emplaceBack(Kt[0],Kt[1],Kt[2]),_e.emplaceBack(er[0],er[1],er[2]),_e.emplaceBack(At[0],At[1],At[2]),_e.emplaceBack(kt[0],kt[1],kt[2]),_e.emplaceBack(zt[0],zt[1],zt[2]),_e.emplaceBack(Ut[0],Ut[1],Ut[2]),_e.emplaceBack(At[0],At[1],At[2]),_e.emplaceBack(kt[0],kt[1],kt[2]),_e.emplaceBack(Kt[0],Kt[1],Kt[2]),_e.emplaceBack(er[0],er[1],er[2]);const Jt=Ct/ut/2;rt.emplaceBack(-Jt-gt,-1,Jt,.8),rt.emplaceBack(Jt+gt,-1,Jt,.8),rt.emplaceBack(-Jt,0,Jt,1.3),rt.emplaceBack(Jt,0,Jt,1.3),rt.emplaceBack(Jt+gt,-.8,Jt,.7),rt.emplaceBack(Jt+gt,-.8,Jt,.7),rt.emplaceBack(0,0,Jt,1.3),rt.emplaceBack(0,0,Jt,1.3),rt.emplaceBack(Jt+gt,-1.2,Jt,.8),rt.emplaceBack(Jt+gt,-1.2,Jt,.8),g.emplaceBack(6+ot,4+ot,8+ot),g.emplaceBack(7+ot,9+ot,5+ot),g.emplaceBack(0+ot,1+ot,2+ot),g.emplaceBack(1+ot,3+ot,2+ot),ot+=10}}function dP(_,o){const g={};g.indexArray=new Fl,g.vertexArray=new Ku,g.colorArray=new Om,CA(_,o,g.indexArray,g.vertexArray,g.colorArray);const _e={defined:!0};_e.emissiveFactor=fo.black;const rt={};return rt.baseColorFactor=fo.white,_e.pbrMetallicRoughness=rt,g.material=_e,g.aabb=new Jn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),g}const AA=Bs([{name:"a_pos_3f",components:3,type:"Float32"}]),pP=Bs([{name:"a_normal_3",components:3,type:"Int16"}]),fP=Bs([{name:"a_centroid_3",components:3,type:"Int16"}]),RA=Bs([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),mP=Bs([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),gP=Bs([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),_P=Bs([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),yP=Bs([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),xP=Bs([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),IA=Or.types,TE=32767;function vP(_,o){const g=Mn+o;for(const _e of _)for(const rt of _e)if(rt.x<-o||rt.x>g||rt.y<-o||rt.y>g)return!1;return!0}function bP(_){switch(_){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${_}`)}}class uS{constructor(){this.layoutVertexArray=new Ku,this.layoutAttenuationArray=new Om,this.layoutColorArray=new Xu,this.indexArray=new Fl,this.indexArrayForConflation=new Fl,this.segmentsBucket=new Go}}class hS{constructor(o){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new Go,this.entranceBloom=new uS;const g=66560;this.layoutVertexArray=new Ku,this.layoutVertexArray.reserve(g),this.layoutNormalArray=new F0,this.layoutNormalArray.reserve(g),this.layoutCentroidArray=new F0,this.layoutCentroidArray.reserve(g),this.layoutColorArray=new Xu,this.layoutColorArray.reserve(g),this.layoutFloodLightDataArray=new jm,this.layoutFloodLightDataArray.reserve(g),this.layoutAOArray=new mx,this.layoutAOArray.reserve(g),this.indexArray=new Fl,this.indexArray.reserve(66560),this.indexArrayForConflation=new Fl,this.segmentsBucket=new Go,this.entranceBloom=new uS,o&&(this.layoutFacadePaintArray=new Xu,this.layoutFacadeDataArray=new h0,this.layoutFacadeVerticalRangeArray=new Xu)}reserve(o,g,_e){this.layoutVertexArray.reserveForAdditional(o),this.layoutCentroidArray.reserveForAdditional(o),this.layoutFloodLightDataArray.reserveForAdditional(o),this.layoutNormalArray.reserveForAdditional(o),this.layoutAOArray.reserveForAdditional(o),this.layoutColorArray.reserveForAdditional(o),this.indexArray.reserveForAdditional(g),_e&&(this.layoutFacadePaintArray.reserveForAdditional(o),this.layoutFacadeDataArray.reserveForAdditional(o),this.layoutFacadeVerticalRangeArray.reserveForAdditional(o))}}class PA{constructor(o){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Up,this.footprintsIndices=new jm,this.footprintsMin=new mn(1/0,1/0),this.footprintsMax=new mn(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new hS(!1),this.buildingWithFacade=new hS(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=o.zoom,this.canonical=o.canonical,this.layers=o.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=o.index,this.hasPattern=!1,this.worldview=o.worldview,this.lut=o.lut,this.programConfigurations=new Tp(o.layers,{zoom:o.zoom,lut:o.lut}),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.projection=o.projection,this.groundEffect=new qT(o),this.groundEffect.groundRadiusArray=new im,this.hasAppearances=null}updateFootprints(o,g){const _e=new cE([],[],1),rt={vertices:[],indices:new Uint32Array(0),grid:_e,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};g.push({footprint:rt,id:o})}updateAppearances(o,g,_e,rt){}prepare(){return function(){if(gE!=null||uA!=null)return null;if(Mx!=null)return Mx;const o=fetch(Us.BUILDING_GEN_URL);return Mx=function(g){let _e,rt,ot,at,ut;function ft(){_e=new Uint8Array(ut.buffer),rt=new Int16Array(ut.buffer),ot=new Int32Array(ut.buffer),at=new Float32Array(ut.buffer)}function gt(){throw new Error("Unexpected BuildingGen error.")}const Ct=()=>{},At={a:{a:gt,f:function(kt){const zt=_e.length,Ut=Math.max(kt>>>0,Math.ceil(1.2*zt)),Kt=Math.ceil((Ut-zt)/65536);try{return ut.grow(Kt),ft(),!0}catch{return!1}},g:gt,b:Ct,c:Ct,d:Ct,e:Ct}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(g,At):g.then(kt=>kt.arrayBuffer()).then(kt=>WebAssembly.instantiate(kt,At))).then(kt=>{const zt=kt.instance.exports;return(0,zt.g)(),ut=zt.f,ft(),new WI({setStyle:zt.h,setAOOptions:zt.i,setMetricOptions:zt.j,setStructuralOptions:zt.k,setFacadeOptions:zt.l,setFauxFacadeOptions:zt.m,setFacadeClassifierOptions:zt.n,addFeature:zt.o,addFacade:zt.p,generateMesh:zt.q,getLastError:zt.r,getOuterRingLength:zt.s,getMeshCount:zt.t,getPositionsPtr:zt.u,getPositionsLength:zt.v,getNormalsPtr:zt.w,getNormalsLength:zt.x,getAOPtr:zt.y,getAOLength:zt.z,getUVPtr:zt.A,getUVLength:zt.B,getFauxFacadePtr:zt.C,getFauxFacadeLength:zt.D,getIndicesPtr:zt.E,getIndicesLength:zt.F,getBuildingPart:zt.G,getRingCount:zt.H,getRingPtr:zt.I,getRingLength:zt.J,malloc:zt.K,free:zt.L,heapU8:_e,heap16:rt,heap32:ot,heapF32:at})})}(o).then(g=>(Mx=null,gE=g,gE)).catch(g=>{$n("Could not load building-gen"),Mx=null,uA=g}),Mx}()}populate(o,g,_e,rt){const ot=qI();if(!ot)return;const at=ir(_e);this.tileToMeter=at,this.brightness=g.brightness,ot.setStyle({normalScale:[1,-1,at],tileToMeters:at}),ot.setAOOptions(!1,.3),ot.setMetricOptions(!1,16),ot.setStructuralOptions(!0),ot.setFacadeClassifierOptions(3);const ut=new Map,ft=new Map;let gt=0;for(const{feature:Jt}of o){if(IA[Jt.type]!=="LineString"){ut.set(Jt.id,Jt.properties.source_id);continue}const or=this.layers[0]._featureFilter.needGeometry;if(or&&!this.layers[0]._featureFilter.filter(new Do(this.zoom),Jt,_e))continue;const lr=Br(Jt,or);if(!or&&!this.layers[0]._featureFilter.filter(new Do(this.zoom),lr,_e))continue;const pr=or?lr.geometry:Pr(Jt,_e,rt),Sr=[];for(const Lr of pr)for(const Jr of Lr)Sr.push(Jr.x),Sr.push(Jr.y);const br={coordinates:Sr,crossPerc:Jt.properties.cross_perc,distanceToRoad:Jt.properties.distance_to_road,entrances:Jt.properties.entrances,sourceId:0},Rr=Jt.properties.source_id;let Mr=ft.get(Rr);Mr||(Mr=[],ft.set(Rr,Mr)),Mr.push(br),++gt}this.maxHeight=0;const Ct=new Array,At=new Set,kt=Jt=>{Jt!=null&&At.add(Jt)},zt=(Jt,or)=>{Jt!=null&&Ct.push({buildingId:Jt,footprintIndex:or})},Ut=64*(o.length-gt),Kt=Ut/2;this.buildingWithFacade.reserve(Ut,Kt,!0),this.buildingWithoutFacade.reserve(2*Ut,2*Kt,!1),this.footprintsIndices.reserve(16*(o.length-gt)),this.footprintsVertices.reserve(8*(o.length-gt));for(const{feature:Jt,id:or,index:lr,sourceLayerIndex:pr}of o){if(IA[Jt.type]==="LineString")continue;const Sr=this.layers[0]._featureFilter.needGeometry;if(Sr&&!this.layers[0]._featureFilter.filter(new Do(this.zoom),Jt,_e))continue;let br=null;if(Jt.properties&&Jt.properties.hasOwnProperty("building_id")&&(br=Jt.properties.building_id,At.has(br)))continue;const Rr=Br(Jt,Sr);if(!Sr&&!this.layers[0]._featureFilter.filter(new Do(this.zoom),Rr,_e))continue;const Mr=Sr?Rr.geometry:Pr(Jt,_e,rt),Lr=m1(Mr,500);let Jr=!1;for(const hs of Lr)if(hs.length!==1){Jr=!0;break}if(Jr){kt(br);continue}if(!vP(Mr,163)){kt(br);continue}const zr=this.layers[0],sn=bP(zr.layout.get("building-roof-shape").evaluate(Jt,{},_e)),dn=zr.layout.get("building-base").evaluate(Jt,{},_e),pn=zr.layout.get("building-height").evaluate(Jt,{},_e),wn=zr.layout.get("building-flood-light-ground-radius").evaluate(Jt,{},_e),Tn=zr.paint.get("building-ambient-occlusion-intensity"),xn=wn/this.tileToMeter;Jt.properties["building-part"]="roof";const vn=zr.paint.get("building-color").evaluate(Jt,{},this.canonical).toPremultipliedRenderColor(this.lut),nn=zr.paint.get("building-emissive-strength").evaluate(Jt,{},this.canonical);Jt.properties["building-part"]="wall";const en=zr.paint.get("building-color").evaluate(Jt,{},this.canonical).toPremultipliedRenderColor(this.lut),bn=zr.paint.get("building-emissive-strength").evaluate(Jt,{},this.canonical);Jt.properties["building-part"]="window";const Dn=zr.paint.get("building-color").evaluate(Jt,{},this.canonical).toPremultipliedRenderColor(this.lut),Rn=zr.paint.get("building-emissive-strength").evaluate(Jt,{},this.canonical);Jt.properties["building-part"]="door";const ts=zr.paint.get("building-color").evaluate(Jt,{},this.canonical).toPremultipliedRenderColor(this.lut),Vn=zr.paint.get("building-emissive-strength").evaluate(Jt,{},this.canonical);let Hn=zr.layout.get("building-flood-light-wall-radius").evaluate(Jt,{},_e);Hn=tr(Hn,0,2048);const Zn=Hn/2048*TE,js=ut.get(or),In=ft.get(js)||[],Yn=In.length!==0&&zr.layout.get("building-facade").evaluate(Jt,{},_e);ot.setFacadeOptions(4,!0),ot.setFauxFacadeOptions(Yn,!1,1);let xs=0,Gs=0,Ws=0,Rs=0,vo=0,wr=0,Cr=0,on=0,En=0,Fn=0,Bn=0;if(Yn){let hs=Math.round(zr.layout.get("building-facade-floors").evaluate(Jt,{},_e));if(dn===0){hs=Math.max(1,hs-(In.length>0?1:0));let _o=4;if(pn>100){const zo=[10,13,15];_o=zo[Jt.id?Jt.id%zo.length:0]}else pn<=10&&(_o=3);ot.setFacadeOptions(_o,!0),vo=(pn<15?1.3:1.61803)*_o/at}else vo=dn/at;wr=pn/at,vo=Math.min(vo,wr),Ws=zr.layout.get("building-facade-unit-width").evaluate(Jt,{},_e)/at,Rs=(wr-vo)/hs,ot.setFauxFacadeOptions(!0,!0,Ws);const qo=zr.layout.get("building-facade-window").evaluate(Jt,{},_e);xs=qo[0],Gs=qo[1],Cr=Math.floor(65535*Math.min(1,vo/Mn)),on=Math.floor(65535*Math.min(1,wr/Mn)),En=Math.floor(255*xs)<<8|Math.floor(255*Gs),Fn=Math.floor(65535*Math.min(1,Ws/Mn)),Bn=Math.floor(65535*Math.min(1,Rs/Mn))}const rs=Array(Lr.length),ss={x:1/0,y:1/0},Ts={x:-1/0,y:-1/0},Ns={x:0,y:0};let Os=0;for(let hs=0;hs<Lr.length;hs++){const qo=Lr[hs];if(qo.length>0){const _o=[],zo=Array(qo.length+1);zo[0]=0;for(let Vl=0;Vl<qo.length;Vl++){const Ql=qo[Vl];for(let Dl=0;Dl<Ql.length;Dl++){const Nl=Ql[Ql.length-Dl-1];ss.x=Math.min(ss.x,Nl.x),ss.y=Math.min(ss.y,Nl.y),Ts.x=Math.max(Ts.x,Nl.x),Ts.y=Math.max(Ts.y,Nl.y),Ns.x+=Nl.x,Ns.y+=Nl.y,Os++,_o.push(Nl.x),_o.push(Nl.y)}zo[Vl+1]=_o.length}rs[hs]={id:Jt.id?Jt.id:0,height:pn,minHeight:dn,sourceId:0,roofType:sn,coordinates:_o,ringIndices:zo}}}Ns.x/=Os||1,Ns.y/=Os||1;const zs=ot.generateMesh(rs,In);if(typeof zs=="string"){$n(`Unable to generate building ${Jt.id}: ${zs}`),kt(br);continue}if(zs.meshes.length===0||zs.modifiedPolygonRings.length===0){kt(br);continue}const ds=Yn?this.buildingWithFacade:this.buildingWithoutFacade;let ys=0;for(const hs of zs.meshes)ys+=hs.positions.length/3;const Qs=ds.segmentsBucket.prepareSegment(ys,ds.layoutVertexArray,ds.indexArray),io=[];let no=null,go=0,Ao=-1;const bo=ds.layoutVertexArray.length,oo=bo+ys;ds.layoutVertexArray.resize(oo),ds.layoutCentroidArray.resize(oo),ds.layoutNormalArray.resize(oo),ds.layoutAOArray.resize(oo),ds.layoutColorArray.resize(oo),ds.layoutFloodLightDataArray.resize(oo),Yn&&(ds.layoutFacadePaintArray.resize(oo),ds.layoutFacadeDataArray.resize(oo),ds.layoutFacadeVerticalRangeArray.resize(oo));const ho=ds.indexArray.length;let Ls=0,Hs=bo;for(const hs of zs.meshes){let qo,_o;if(hs.buildingPart===1)qo=vn,_o=nn;else if(hs.buildingPart===0)qo=en,_o=bn;else if(hs.buildingPart===2)qo=Dn,_o=Rn;else{if(hs.buildingPart!==3)continue;qo=ts,_o=Vn}if(_o=tr(_o,0,1),hs.buildingPart===3){const Mo=new Array;for(let Ul=0;Ul<hs.positions.length;Ul+=12){const Wp=hs.positions[Ul+0],Um=hs.positions[Ul+1],uu=hs.positions[Ul+3],ku=hs.positions[Ul+4],Ju=hs.positions[Ul+2],J0=hs.positions[Ul+8]-Ju,Wx=1,_m=uu-Wp,ym=ku-Um,Z1=Math.hypot(_m,ym);Mo.push({pos:[Wp+.5*_m,Um+.5*ym,Ju],normal:[ym/Z1,-_m/Z1,0],width:Z1,height:J0,depth:Wx,points:[Wp,Um,uu,ku]})}const yl=ds.entranceBloom.segmentsBucket.prepareSegment(10*Mo.length,ds.entranceBloom.layoutVertexArray,ds.entranceBloom.indexArray),Tl=ds.entranceBloom.layoutVertexArray.length;go=ds.entranceBloom.indexArray.length,CA(Mo,.5/this.tileToMeter,ds.entranceBloom.indexArray,ds.entranceBloom.layoutVertexArray,ds.entranceBloom.layoutAttenuationArray);const Uu=ds.entranceBloom.layoutVertexArray.length-Tl;Ao=ds.entranceBloom.indexArray.length-go;for(let Ul=0;Ul<Uu;Ul++)ds.entranceBloom.layoutColorArray.emplaceBack(255*ts.r<<8|255*ts.g,255*ts.b<<8|51*Vn);yl.vertexLength+=Uu,yl.primitiveLength+=Ao,no={part:hs.buildingPart,vertexOffset:Tl,vertexLength:Uu}}ds.layoutVertexArray.float32.set(hs.positions,3*Hs);const zo=hs.positions.length/3;for(let Mo=0;Mo<zo;++Mo){const yl=3*Mo;Ls=Math.max(Ls,hs.positions[yl+2]);const Tl=hs.normals[yl+1]*TE,Uu=hs.normals[yl+2]*TE,Ul=3*(Hs+Mo);ds.layoutNormalArray.int16[Ul]=hs.normals[yl]*TE,ds.layoutNormalArray.int16[Ul+1]=Tl,ds.layoutNormalArray.int16[Ul+2]=Uu;const Wp=hs.ao[Mo];ds.layoutAOArray.uint8[Hs+Mo]=255*Wp;const Um=1+(Wp-1)*Tn,uu=255*qo.b*Um<<8|255*_o;ds.layoutColorArray.uint16[2*(Hs+Mo)]=255*qo.r*Um<<8|255*qo.g*Um,ds.layoutColorArray.uint16[2*(Hs+Mo)+1]=uu}const Vl=Math.floor(Ns.x),Ql=Math.floor(Ns.y),Dl=Math.floor(pn);for(let Mo=0;Mo<zo;++Mo){const yl=3*(Hs+Mo);ds.layoutCentroidArray.int16[yl]=Vl,ds.layoutCentroidArray.int16[yl+1]=Ql,ds.layoutCentroidArray.int16[yl+2]=Dl}if(ds.layoutFloodLightDataArray.uint16.fill(hs.buildingPart===0?Zn:0,Hs,Hs+zo),Yn){const Mo=255*Dn.r<<8|255*Dn.g,yl=255*Dn.b<<8|255*Rn;for(let Tl=0;Tl<zo;++Tl){const Uu=2*(Hs+Tl);ds.layoutFacadePaintArray.uint16[Uu]=Mo,ds.layoutFacadePaintArray.uint16[Uu+1]=yl}for(let Tl=0;Tl<zo;++Tl)if(hs.isFauxFacade[Tl]){const Uu=Math.min(65535,Math.floor(hs.uv[2*Tl]*zs.outerRingLength));ds.layoutFacadeDataArray.emplace(Hs+Tl,1|Uu,En,Fn,Bn),ds.layoutFacadeVerticalRangeArray.emplace(Hs+Tl,Cr,on)}else ds.layoutFacadeDataArray.emplace(Hs+Tl,0,0,0,0),ds.layoutFacadeVerticalRangeArray.emplace(Hs+Tl,0,0)}const Nl=Qs.vertexLength,Wl=hs.indices.length/3,Fu=ds.indexArray.length;ds.indexArray.resize(Fu+Wl);for(let Mo=0;Mo<Wl;++Mo){const yl=3*Mo,Tl=3*Fu+yl;ds.indexArray.uint16[Tl]=Nl+hs.indices[yl],ds.indexArray.uint16[Tl+1]=Nl+hs.indices[yl+1],ds.indexArray.uint16[Tl+2]=Nl+hs.indices[yl+2]}hs.buildingPart!==1&&hs.buildingPart!==0&&hs.buildingPart!==2&&hs.buildingPart!==3||io.push({part:hs.buildingPart,vertexOffset:Hs,vertexLength:hs.positions.length/3}),Hs+=zo,Qs.vertexLength+=zo,Qs.primitiveLength+=hs.indices.length/3}this.maxHeight=Math.max(this.maxHeight,Ls);const $o=ds.indexArray.length-ho,us=this.footprintsIndices.length,Vs=this.footprintsVertices.length,Eo=[],Io=new mn(1/0,1/0),No=new mn(-1/0,-1/0),El=this.groundEffect.vertexArray.length;for(const hs of zs.modifiedPolygonRings){const qo=[],_o=new mn(1/0,1/0),zo=new mn(-1/0,-1/0);for(let Vl=0;Vl<hs.length;Vl+=2){const Ql=hs.length-Vl-2;_o.x=Math.min(_o.x,hs[Ql]),_o.y=Math.min(_o.y,hs[Ql+1]),zo.x=Math.max(zo.x,hs[Ql]),zo.y=Math.max(zo.y,hs[Ql+1]);const Dl=new mn(hs[Ql],hs[Ql+1]);qo.push(Dl),Eo.push(Dl.x,Dl.y),this.footprintsVertices.emplaceBack(Dl.x,Dl.y)}Io.x=Math.min(Io.x,_o.x),Io.y=Math.min(Io.y,_o.y),No.x=Math.max(No.x,zo.x),No.y=Math.max(No.y,zo.y),this.groundEffect.addData(qo,[_o,zo],xn)}const ko=this.groundEffect.vertexArray.length-El;this.groundEffect.groundRadiusArray.reserveForAdditional(ko);for(let hs=0;hs<ko;hs++)this.groundEffect.groundRadiusArray.emplaceBack(wn);(ss.x<0||Ts.x>Mn||ss.y<0||Ts.y>Mn)&&this.featuresOnBorder.push({featureId:Jt.id,footprintIndex:this.footprints.length});{const hs=Ax(Eo,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+hs.length),this.footprintsIndices.uint16.set(hs,us),this.buildingIds.add(br??Jt.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,Io.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,Io.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,No.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,No.y);const qo={footprintVertexOffset:Vs,footprintVertexLength:this.footprintsVertices.length-Vs,footprintIndexOffset:us,footprintIndexLength:this.footprintsIndices.length-us,min:Io,max:No,hiddenFlags:0,indicesOffset:ho,indicesLength:$o,bloomIndicesOffset:go,bloomIndicesLength:Ao,groundEffectVertexOffset:El,groundEffectVertexLength:ko,hasFauxFacade:Yn,height:Ls,promoteId:or,feature:Rr,parts:io,buildingBloom:no},_o=this.footprints.length;Jt.id!==void 0&&this.featureFootprintLookup.set(Jt.id,_o),zt(br,_o),this.footprints.push(qo)}this.programConfigurations.populatePaintArrays(ds.layoutVertexArray.length,Jt,lr,{},g.availableImages,_e,g.brightness),this.groundEffect.addPaintPropertiesData(Jt,lr,{},g.availableImages,_e,g.brightness),g.featureIndex.insert(Jt,Mr,lr,pr,this.index,bo)}Ct.forEach(({buildingId:Jt,footprintIndex:or})=>{At.has(Jt)&&(this.footprints[or].hiddenFlags|=4)});const er=new Set;this.buildingIds.forEach((Jt,or,lr)=>{At.has(Jt)||er.add(Jt)}),this.buildingIds=er,this.groundEffect.prepareBorderSegments()}update(o,g,_e,rt,ot,at,ut){this.programConfigurations.updatePaintArrays(o,g,ot,_e,rt,at,ut),this.groundEffect.update(o,g,ot,_e,rt,at,ut),this.evaluate(this.layers[0],o),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(o){const g=_e=>{_e.layoutVertexBuffer=o.createVertexBuffer(_e.layoutVertexArray,AA.members),_e.layoutNormalBuffer=o.createVertexBuffer(_e.layoutNormalArray,pP.members),_e.layoutCentroidBuffer=o.createVertexBuffer(_e.layoutCentroidArray,fP.members),_e.layoutFloodLightDataBuffer=o.createVertexBuffer(_e.layoutFloodLightDataArray,xP.members),_e.layoutFacadeDataArray&&_e.layoutFacadeDataArray.length&&(_e.layoutFacadeDataBuffer=o.createVertexBuffer(_e.layoutFacadeDataArray,gP.members)),_e.layoutFacadeVerticalRangeArray&&_e.layoutFacadeVerticalRangeArray.length&&(_e.layoutFacadeVerticalRangeBuffer=o.createVertexBuffer(_e.layoutFacadeVerticalRangeArray,_P.members)),_e.entranceBloom.layoutVertexArray.length&&(_e.entranceBloom.layoutVertexBuffer=o.createVertexBuffer(_e.entranceBloom.layoutVertexArray,AA.members),_e.entranceBloom.layoutAttenuationBuffer=o.createVertexBuffer(_e.entranceBloom.layoutAttenuationArray,yP.members)),this.uploadUpdatedColorBuffer(o),this.uploadUpdatedIndexBuffer(o)};this.uploaded||(g(this.buildingWithoutFacade),g(this.buildingWithFacade),this.groundEffect.upload(o)),this.groundEffect.uploadPaintProperties(o),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){const o=g=>{g.layoutVertexBuffer&&(g.layoutVertexBuffer.destroy(),g.layoutNormalBuffer.destroy(),g.layoutColorBuffer.destroy(),g.segmentsBucket.destroy(),g.indexBuffer&&g.indexBuffer.destroy(),g.entranceBloom.layoutVertexBuffer&&(g.entranceBloom.layoutVertexBuffer.destroy(),g.entranceBloom.layoutColorBuffer.destroy(),g.entranceBloom.layoutAttenuationBuffer.destroy(),g.entranceBloom.indexBuffer.destroy(),g.entranceBloom.segmentsBucket.destroy()))};o(this.buildingWithoutFacade),o(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(o,g,_e=!0){let rt=!1;const ot=_e?g:0,at=0|(_e?-1:~g);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const ut of o){const ft=this.footprints[ut],gt=ft.hiddenFlags&at|ot;ft.hiddenFlags!==gt&&(ft.hiddenFlags=gt,rt=!0,this.groundEffect.updateHiddenByLandmarkRange(ft.groundEffectVertexOffset,ft.groundEffectVertexLength,ft.hiddenFlags!==0))}return rt&&(this.indexArrayForConflationUploaded=!1),rt}uploadUpdatedIndexBuffer(o){if(this.groundEffect.uploadHiddenByLandmark(o),this.indexArrayForConflationUploaded)return;const g=rt=>{rt.indexArray.length!==0&&(rt.indexArrayForConflation.resize(rt.indexArray.length),rt.indexArrayForConflation.uint16.set(rt.indexArray.uint16),rt.entranceBloom.indexArrayForConflation.resize(rt.entranceBloom.indexArray.length),rt.entranceBloom.indexArrayForConflation.uint16.set(rt.entranceBloom.indexArray.uint16))};g(this.buildingWithoutFacade),g(this.buildingWithFacade);for(const rt of this.footprints){const ot=rt.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,at=rt.indicesOffset+rt.indicesLength;if(rt.hiddenFlags!==0){for(let ft=rt.indicesOffset;ft<at;ft++)ot.indexArrayForConflation.uint16[3*ft+0]=0,ot.indexArrayForConflation.uint16[3*ft+1]=0,ot.indexArrayForConflation.uint16[3*ft+2]=0;const ut=rt.bloomIndicesOffset+rt.bloomIndicesLength;for(let ft=rt.bloomIndicesOffset;ft<ut;ft++)ot.entranceBloom.indexArrayForConflation.uint16[3*ft+0]=0,ot.entranceBloom.indexArrayForConflation.uint16[3*ft+1]=0,ot.entranceBloom.indexArrayForConflation.uint16[3*ft+2]=0}}const _e=rt=>{rt.indexArray.length!==0&&(rt.indexBuffer?rt.indexBuffer.updateData(rt.indexArrayForConflation):rt.indexBuffer=o.createIndexBuffer(rt.indexArrayForConflation,!0),rt.entranceBloom.indexBuffer?rt.entranceBloom.indexBuffer.updateData(rt.entranceBloom.indexArrayForConflation):rt.entranceBloom.indexBuffer=o.createIndexBuffer(rt.entranceBloom.indexArrayForConflation,!0))};_e(this.buildingWithoutFacade),_e(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(o){const g=_e=>{_e.layoutColorBuffer?_e.layoutColorBuffer.updateData(_e.layoutColorArray):_e.layoutColorBuffer=o.createVertexBuffer(_e.layoutColorArray,RA.members,!0),_e.layoutFacadePaintArray&&(_e.layoutFacadePaintBuffer?_e.layoutFacadePaintBuffer.updateData(_e.layoutFacadePaintArray):_e.layoutFacadePaintBuffer=o.createVertexBuffer(_e.layoutFacadePaintArray,mP.members,!0)),_e.entranceBloom.layoutColorBuffer?_e.entranceBloom.layoutColorBuffer.updateData(_e.entranceBloom.layoutColorArray):_e.entranceBloom.layoutColorBuffer=o.createVertexBuffer(_e.entranceBloom.layoutColorArray,RA.members,!0)};g(this.buildingWithoutFacade),g(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(o,g){const _e=o.paint.get("building-ambient-occlusion-intensity");for(const rt of this.footprints){if(4&rt.hiddenFlags)continue;const ot=g[rt.promoteId],at=rt.feature;at.properties["building-part"]="roof";const ut=o.paint.get("building-color").evaluate(at,ot,this.canonical).toPremultipliedRenderColor(this.lut),ft=o.paint.get("building-emissive-strength").evaluate(at,ot,this.canonical);at.properties["building-part"]="wall";const gt=o.paint.get("building-color").evaluate(at,ot,this.canonical).toPremultipliedRenderColor(this.lut),Ct=o.paint.get("building-emissive-strength").evaluate(at,ot,this.canonical);at.properties["building-part"]="window";const At=o.paint.get("building-color").evaluate(at,ot,this.canonical).toPremultipliedRenderColor(this.lut),kt=o.paint.get("building-emissive-strength").evaluate(at,ot,this.canonical);at.properties["building-part"]="door";const zt=o.paint.get("building-color").evaluate(at,ot,this.canonical).toPremultipliedRenderColor(this.lut),Ut=o.paint.get("building-emissive-strength").evaluate(at,ot,this.canonical),Kt=rt.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const Jt of rt.parts){let or,lr=ut;Jt.part===1?(lr=ut,or=ft):Jt.part===0?(lr=gt,or=Ct):Jt.part===2?(lr=At,or=kt):Jt.part===3&&(lr=zt,or=Ut),or=tr(or,0,1);for(let pr=0;pr<Jt.vertexLength;pr++){const Sr=Jt.vertexOffset+pr,br=1+(Kt.layoutAOArray.uint8[Sr]/255-1)*_e;Kt.layoutColorArray.emplace(Sr,lr.r*br*255<<8|lr.g*br*255,lr.b*br*255<<8|255*or),rt.hasFauxFacade&&Kt.layoutFacadePaintArray.emplace(Sr,255*At.r<<8|255*At.g,255*At.b<<8|255*kt)}}const er=rt.buildingBloom;if(er)for(let Jt=0;Jt<er.vertexLength;Jt++)Kt.entranceBloom.layoutColorArray.emplace(er.vertexOffset+Jt,255*zt.r<<8|255*zt.g,255*zt.b<<8|51*Ut)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(o,g,_e){if(g.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=g.updateTime;const rt=g.getReplacementRegionsForTile(o.toUnwrapped());if(hE(this.activeReplacements,rt))return;this.activeReplacements=rt;for(const at of this.footprints)at.hiddenFlags&=-2;const ot=[];for(const at of this.activeReplacements){if(at.order<=kC)continue;const ut=Math.max(1,Math.pow(2,at.footprintTileId.canonical.z-o.canonical.z));for(const ft of this.footprints)ft.min.x>at.max.x||ft.max.x<at.min.x||ft.min.y>at.max.y||ft.max.y<at.min.y||(ot.length=0,EP(this.footprintsVertices,ft.footprintVertexOffset,ft.footprintVertexLength,at.footprintTileId.canonical,o.canonical,ot),GT(at.footprint,ot,this.footprintsIndices.uint16,ft.footprintIndexOffset,ft.footprintIndexLength,0,-ut)&&(ft.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const at of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(at.groundEffectVertexOffset,at.groundEffectVertexLength,at.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(o){if(o.id!==void 0){const g=this.featureFootprintLookup.get(o.id);return this.footprints[g]}return null}getHeightAtTileCoord(o,g){let _e=Number.NEGATIVE_INFINITY,rt=!0;const ot=4*(o+Mn)*Mn+(g+Mn);if(this.footprintLookup.hasOwnProperty(ot)){const ut=this.footprintLookup[ot];return ut?{height:ut.height,hidden:ut.hiddenFlags!==0}:void 0}const at=new mn(o,g);for(const ut of this.footprints)o>ut.max.x||ut.min.x>o||g>ut.max.y||ut.min.y>g||ut.height<=_e||wP(at,this.footprintsVertices.float32.subarray(2*ut.footprintVertexOffset,2*(ut.footprintVertexOffset+ut.footprintVertexLength)),this.footprintsIndices.uint16.subarray(ut.footprintIndexOffset,ut.footprintIndexOffset+ut.footprintIndexLength))&&(_e=ut.height,this.footprintLookup[ot]=ut,rt=ut.hiddenFlags!==0);if(_e!==Number.NEGATIVE_INFINITY)return{height:_e,hidden:rt};this.footprintLookup[ot]=void 0}}function wP(_,o,g){for(let _e=0;_e<g.length;_e+=3){const rt=g[_e],ot=g[_e+1],at=g[_e+2],ut=o[2*rt+0],ft=o[2*rt+1],gt=o[2*ot+0],Ct=o[2*ot+1],At=o[2*at+0],kt=o[2*at+1],zt=(ut-At)*(_.y-kt)-(ft-kt)*(_.x-At),Ut=(gt-ut)*(_.y-ft)-(Ct-ft)*(_.x-ut);if(zt<0!=Ut<0&&zt!==0&&Ut!==0)continue;const Kt=(At-gt)*(_.y-Ct)-(kt-Ct)*(_.x-gt);if(Kt===0||Kt<0==zt+Ut<=0)return!0}return!1}function EP(_,o,g,_e,rt,ot){const at=Math.pow(2,_e.z-rt.z);for(let ut=0;ut<g;ut++){let ft=_.float32[2*(ut+o)+0],gt=_.float32[2*(ut+o)+1];ft=(ft+rt.x*Mn)*at-_e.x*Mn,gt=(gt+rt.y*Mn)*at-_e.y*Mn,ot.push(new mn(ft,gt))}}let kA,MA;qn(PA,"BuildingBucket",{omit:["layers"]}),qn(hS,"BuildingGeometry"),qn(uS,"BuildingBloomGeometry");const TP=Bs([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),SP=Bs([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:CP}=TP,AP=Bs([{name:"a_packed",components:3,type:"Float32"}]),{members:RP}=AP,IP=Bs([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:PP}=IP;class DA{constructor(o,g){this.width=o,this.height=g,this.nextRow=0,this.image=new K0({width:o,height:g}),this.positions={},this.uploaded=!1}getDash(o,g){const _e=this.getKey(o,g);return this.positions[_e]}trim(){const o=this.width,g=this.height=Zr(this.nextRow);this.image.resize({width:o,height:g})}getKey(o,g){return o.join(",")+g}getDashRanges(o,g,_e){const rt=[];let ot=o.length%2==1?-o[o.length-1]*_e:0,at=o[0]*_e,ut=!0;rt.push({left:ot,right:at,isDash:ut,zeroLength:o[0]===0});let ft=o[0];for(let gt=1;gt<o.length;gt++){ut=!ut;const Ct=o[gt];ot=ft*_e,ft+=Ct,at=ft*_e,rt.push({left:ot,right:at,isDash:ut,zeroLength:Ct===0})}return rt}addRoundDash(o,g,_e){const rt=g/2;for(let ot=-_e;ot<=_e;ot++){const at=this.width*(this.nextRow+_e+ot);let ut=0,ft=o[ut];for(let gt=0;gt<this.width;gt++){gt/ft.right>1&&(ft=o[++ut]);const Ct=Math.abs(gt-ft.left),At=Math.abs(gt-ft.right),kt=Math.min(Ct,At);let zt;const Ut=ot/_e*(rt+1);if(ft.isDash){const Kt=rt-Math.abs(Ut);zt=Math.sqrt(kt*kt+Kt*Kt)}else zt=rt-Math.sqrt(kt*kt+Ut*Ut);this.image.data[at+gt]=Math.max(0,Math.min(255,zt+128))}}}addRegularDash(o,g){for(let ft=o.length-1;ft>=0;--ft){const gt=o[ft],Ct=o[ft+1];gt.zeroLength?o.splice(ft,1):Ct&&Ct.isDash===gt.isDash&&(Ct.left=gt.left,o.splice(ft,1))}const _e=o[0],rt=o[o.length-1];_e.isDash===rt.isDash&&(_e.left=rt.left-this.width,rt.right=_e.right+this.width);const ot=this.width*this.nextRow;let at=0,ut=o[at];for(let ft=0;ft<this.width;ft++){ft/ut.right>1&&(ut=o[++at]);const gt=Math.abs(ft-ut.left),Ct=Math.abs(ft-ut.right),At=Math.min(gt,Ct);this.image.data[ot+ft]=Math.max(0,Math.min(255,(ut.isDash?At:-At)+g+128))}}addDash(o,g){const _e=this.getKey(o,g);if(this.positions[_e])return this.positions[_e];const rt=g==="round",ot=rt?7:0,at=2*ot+1;if(this.nextRow+at>this.height)return $n("LineAtlas out of space"),null;o.length===0&&o.push(1);let ut=0;for(let Ct=0;Ct<o.length;Ct++)o[Ct]<0&&($n("Negative value is found in line dasharray, replacing values with 0"),o[Ct]=0),ut+=o[Ct];if(ut!==0){const Ct=this.width/ut,At=this.getDashRanges(o,this.width,Ct);rt?this.addRoundDash(At,Ct,ot):this.addRegularDash(At,g==="square"?.5*Ct:0)}const ft=this.nextRow+ot;this.nextRow+=at;const gt={tl:[ft,ot],br:[ut,0]};return this.positions[_e]=gt,gt}}qn(DA,"LineAtlas");const kP=Or.types,MP=Math.cos(Math.PI/180*37.5),DP=Math.cos(Math.PI/180*5);class dS{constructor(o){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=o.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=o.overscaling,this.pixelRatio=o.pixelRatio,this.layers=o.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(g=>{this.gradients[g.id]={}}),this.layoutVertexArray=new ox,this.layoutVertexArray2=new Ku,this.patternVertexArray=new Ku,this.indexArray=new Fl,this.programConfigurations=new Tp(o.layers,{zoom:o.zoom,lut:o.lut}),this.segments=new Go,this.maxLineLength=0,this.zOffsetVertexArray=new Ku,this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.tessellationStep=o.tessellationStep?o.tessellationStep:Mn/64,this.worldview=o.worldview,this.hasAppearances=null}updateFootprints(o,g){}updateAppearances(o,g,_e,rt){}populate(o,g,_e,rt){this.hasPattern=FT("line",this.layers,this.pixelRatio,g);const ot=this.layers[0].layout.get("line-sort-key");this.tileToMeter=ir(_e);const at=this.layers[0].layout.get("line-elevation-reference");if(at==="hd-road-markup")this.elevationType="road";else{const kt=this.layers[0].layout.get("line-z-offset"),zt=kt.isConstant()&&!kt.constantOr(0);this.elevationType=at!=="sea"&&at!=="ground"&&zt?"none":"offset",this.elevationType==="offset"&&at==="none"&&$n(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const ut=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&ut!==void 0;const ft=[];for(const{feature:kt,id:zt,index:Ut,sourceLayerIndex:Kt}of o){const er=this.layers[0]._featureFilter.needGeometry,Jt=Br(kt,er);if(!this.layers[0]._featureFilter.filter(new Do(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),Jt,_e))continue;const or=ot?ot.evaluate(Jt,{},_e):void 0,lr={id:zt,properties:kt.properties,type:kt.type,sourceLayerIndex:Kt,index:Ut,geometry:er?Jt.geometry:Pr(kt,_e,rt),patterns:{},sortKey:or};ft.push(lr)}ot&&ft.sort((kt,zt)=>kt.sortKey-zt.sortKey);const{lineAtlas:gt,featureIndex:Ct}=g,At=this.addConstantDashes(gt);for(const kt of ft){const{geometry:zt,index:Ut,sourceLayerIndex:Kt}=kt;if(At&&this.addFeatureDashes(kt,gt),this.hasPattern){const er=BT("line",this.layers,kt,this.zoom,this.pixelRatio,g);this.patternFeatures.push(er)}else this.addFeature(kt,zt,Ut,_e,gt.positions,g.availableImages,g.brightness,g.elevationFeatures);Ct.insert(o[Ut].feature,zt,Ut,Kt,this.index)}}addConstantDashes(o){let g=!1;for(const _e of this.layers){const rt=_e.paint.get("line-dasharray").value,ot=_e.layout.get("line-cap").value;if(rt.kind!=="constant"||ot.kind!=="constant")g=!0;else{const at=ot.value,ut=rt.value;if(!ut)continue;o.addDash(ut,at)}}return g}addFeatureDashes(o,g){const _e=this.zoom;for(const rt of this.layers){const ot=rt.paint.get("line-dasharray").value,at=rt.layout.get("line-cap").value;if(ot.kind==="constant"&&at.kind==="constant")continue;let ut,ft;if(ot.kind==="constant"){if(ut=ot.value,!ut)continue}else ut=ot.evaluate({zoom:_e},o);ft=at.kind==="constant"?at.value:at.evaluate({zoom:_e},o),g.addDash(ut,ft),o.patterns[rt.id]=[g.getKey(ut,ft)]}}update(o,g,_e,rt,ot,at,ut,ft){this.programConfigurations.updatePaintArrays(o,g,ot,_e,rt,at,ut,ft)}addFeatures(o,g,_e,rt,ot,at){for(const ut of this.patternFeatures)this.addFeature(ut,ut.geometry,ut.index,g,_e,rt,at,o.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,RP)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=o.createVertexBuffer(this.patternVertexArray,PP)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,SP.members,!0)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,CP),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o,g){let _e,rt;if(g&&g>0?(_e=`mapbox_clip_start_${g}`,rt=`mapbox_clip_end_${g}`):(_e="mapbox_clip_start",rt="mapbox_clip_end"),o.properties&&o.properties.hasOwnProperty(_e)&&o.properties.hasOwnProperty(rt))return{start:+o.properties[_e],end:+o.properties[rt]}}addFeature(o,g,_e,rt,ot,at,ut,ft){const gt=this.layers[0].layout,Ct=gt.get("line-join").evaluate(o,{}),At=gt.get("line-cap").evaluate(o,{}),kt=gt.get("line-miter-limit"),zt=gt.get("line-round-limit");this.lineClips=this.lineFeatureClips(o),this.lineFeature=o;const Ut=!(!o.properties||!o.properties.hasOwnProperty("mapbox_line_metrics"))&&o.properties.mapbox_line_metrics;this.zOffsetValue=gt.get("line-z-offset").value;const Kt=this.layers[0].paint.get("line-width").value;if(Kt.kind!=="constant"&&Kt.isLineProgressConstant===!1&&(this.variableWidthValue=Kt),this.elevationType==="road"){const er=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(o,g,rt,ft,Ct,At,kt,zt)){const[Jt,or]=this.clipRuntimeLinesToTile(g,1);for(let lr=0;lr<Jt.length;lr++){const pr=Jt[lr],Sr=or[lr],br={progress:{min:Sr.progress.min,max:Sr.progress.max},nextDir:this.computeSegNextDir(Sr,pr),prevDir:this.computeSegPrevDir(Sr,pr)};this.addLine(pr,o,rt,Ct,At,kt,zt,br,Ut&&Sr.parentIndex>0?Sr.parentIndex:null)}this.fillNonElevatedRoadSegment(er)}}else for(let er=0;er<g.length;er++)this.addLine(g[er],o,rt,Ct,At,kt,zt,void 0,Ut&&er>0?er:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,_e,ot,at,rt,ut,void 0,this.worldview)}computeSegNextDir(o,g){return o.nextPoint.sub(g.at(-2)).unit()}computeSegPrevDir(o,g){return g[1].sub(o.prevPoint).unit()}clipLinesToTile(o,g){return fE(o,-g,-g,Mn+g,Mn+g)}clipRuntimeLinesToTile(o,g){const _e=[];return[fE(o,-g,-g,Mn+g,Mn+g,_e),_e]}addElevatedRoadFeature(o,g,_e,rt,ot,at,ut,ft){const gt=[],Ct=co.getElevationFeature(o,rt);if(Ct){const At=this.clipLinesToTile(g,1),kt=this.prepareElevatedLines(At,Ct,_e);for(const zt of kt)gt.push({geometry:zt,elevation:Ct,elevationTileID:_e,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(gt.length===0)return!1;for(const At of gt){const kt=this.layoutVertexArray.length;this.addLine(At.geometry,o,_e,ot,at,ut,ft);const zt=new xo(_e,At.elevationTileID);if(At.elevation)for(let Ut=kt;Ut<this.layoutVertexArray.length;Ut++){const Kt=new mn(this.layoutVertexArray.int16[6*Ut]>>1,this.layoutVertexArray.int16[6*Ut+1]>>1),er=zt.pointElevation(Kt,At.elevation,.05);this.updateHeightRange(er),this.zOffsetVertexArray.emplaceBack(er,0,0)}else this.fillNonElevatedRoadSegment(kt)}return!0}prepareElevatedLines(o,g,_e){if(g.constantHeight!=null)return o;const rt=[],ot=1/ir(_e);for(const at of o)$I(at,new ro(g,ot),0,rt);return rt}fillNonElevatedRoadSegment(o){for(let g=o;g<this.layoutVertexArray.length;g++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(o){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,o),this.heightRange.max=Math.max(this.heightRange.max,o)):this.heightRange={min:o,max:o}}addLine(o,g,_e,rt,ot,at,ut,ft,gt){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=gt?this.lineFeatureClips(g,gt):this.lineClips;const Ct=rt==="none";this.patternJoinNone=this.hasPattern&&Ct,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const At=ft&&ft.progress.min>0,kt=ft&&ft.progress.max<1;if(this.lineClips){let Lr={min:this.lineClips.start,max:this.lineClips.end},Jr=1;if(ft){const dn=this.lineClips.end-this.lineClips.start;Lr=function(pn,wn,Tn){return{min:Ro(pn.min,wn,Tn),max:Ro(pn.max,wn,Tn)}}(ft.progress,{min:0,max:1},Lr),dn>0&&(Jr=(Lr.max-Lr.min)/dn)}const zr=+g.properties.mapbox_clip_feature_len,sn=+g.properties.mapbox_clip_seg_len;if(Number.isNaN(zr)||Number.isNaN(sn)){for(let pn=0;pn<o.length-1;pn++)this.totalDistance+=o[pn].dist(o[pn+1]);const dn=this.totalDistance/(Lr.max-Lr.min);this.totalFeatureLength=Number.isFinite(dn)?dn:0,this.lineClips.start=Lr.min,this.lineClips.end=Lr.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=zr,this.distance=sn*Jr,this.lineClips.start=Lr.min,this.lineClips.end=Lr.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const zt=kP[g.type]==="Polygon";let Ut=o.length;for(;Ut>=2&&o[Ut-1].equals(o[Ut-2]);)Ut--;let Kt=0;for(;Kt<Ut-1&&o[Kt].equals(o[Kt+1]);)Kt++;if(Ut<(zt?3:2))return;rt==="bevel"&&(at=1.05);const er=this.segments.prepareSegment(10*Ut,this.layoutVertexArray,this.indexArray);let Jt,or,lr,pr,Sr,br,Rr,Mr;ft&&ft.prevDir&&(br=ft.prevDir.perp()),ft&&ft.nextDir&&(Rr=ft.nextDir.perp()),this.e1=this.e2=-1,zt&&(Jt=o[Ut-2],Sr=o[Kt].sub(Jt)._unit()._perp());for(let Lr=Kt;Lr<Ut;Lr++){if(lr=Lr===Ut-1?zt?o[Kt+1]:void 0:o[Lr+1],lr&&o[Lr].equals(lr))continue;Sr&&(pr=Sr),Jt&&(or=Jt),Jt=o[Lr],Mr=this.evaluateLineProgressFeatures(or?or.dist(Jt):0),Sr=lr?lr.sub(Jt)._unit()._perp():pr,pr=pr||Sr;const Jr=or&&lr;let zr=Jr?rt:zt||Ct?"butt":ot;const sn=pr.x*Sr.x+pr.y*Sr.y;if(Ct){const en=function(bn){if(bn.patternJoinNone){const Dn=bn.segmentPoints.length/2,Rn=bn.lineSoFar-bn.segmentStart;for(let ts=0;ts<Dn;++ts){const Vn=bn.segmentPoints[2*ts+1],Hn=Math.round(bn.segmentPoints[2*ts])+.5+.25*Vn;bn.patternVertexArray.emplaceBack(Hn,Rn,bn.segmentStart),bn.patternVertexArray.emplaceBack(Hn,Rn,bn.segmentStart)}bn.segmentPoints.length=0}bn.e1=bn.e2=-1};if(Jr&&sn<DP){this.updateDistance(or,Jt),this.addCurrentVertex(Jt,pr,1,1,er,Mr),en(this),this.addCurrentVertex(Jt,Sr,-1,-1,er,Mr);continue}if(or){if(!lr){this.updateDistance(or,Jt),this.addCurrentVertex(Jt,pr,1,1,er,Mr),en(this);continue}zr="miter"}}let dn=pr.add(Sr);dn.x===0&&dn.y===0||dn._unit();const pn=dn.x*Sr.x+dn.y*Sr.y,wn=pn!==0?1/pn:1/0,Tn=2*Math.sqrt(2-2*pn),xn=pn<MP&&or&&lr,vn=pr.x*Sr.y-pr.y*Sr.x>0,nn=this.overscaling<=16?15*Mn/(512*this.overscaling):0;if(Jr&&zr==="round"){if(wn<ut)zr="miter";else if(wn<=2){const en=pS(Jt,-10,Mn+10);zr=this.elevationType==="offset"&&(en||this.hasCrossSlope)?"miter":"fakeround"}}if(zr==="miter"&&wn>at&&(zr="bevel"),zr==="bevel"&&(wn>2&&(zr="flipbevel"),wn<at&&(zr="miter")),or&&!(zr==="miter"&&xn)&&this.updateDistance(or,Jt),zr==="miter")if(xn){const en=Jt.dist(or);if(en>2*nn){const Dn=Jt.sub(Jt.sub(or)._mult(nn/en)._round());this.updateDistance(or,Dn),this.addCurrentVertex(Dn,pr,0,0,er,Mr),or=Dn}this.updateDistance(or,Jt),dn._mult(wn),this.addCurrentVertex(Jt,dn,0,0,er,Mr);const bn=Jt.dist(lr);if(bn>2*nn){const Dn=Jt.add(lr.sub(Jt)._mult(nn/bn)._round());this.updateDistance(Jt,Dn),this.addCurrentVertex(Dn,Sr,0,0,er,Mr),Jt=Dn}}else dn._mult(wn),this.addCurrentVertex(Jt,dn,0,0,er,Mr);else if(zr==="flipbevel"){if(wn>100)dn=Sr.mult(-1);else{const en=wn*pr.add(Sr).mag()/pr.sub(Sr).mag();dn._perp()._mult(en*(vn?-1:1))}this.addCurrentVertex(Jt,dn,0,0,er,Mr),this.addCurrentVertex(Jt,dn.mult(-1),0,0,er,Mr)}else if(zr==="bevel"||zr==="fakeround"){Mr!=null&&or&&this.addCurrentVertex(Jt,Rr||pr,-1,-1,er,Mr);const en=Jt.dist(or)<=2*nn&&zr!=="bevel",bn=dn.mult(vn?1:-1);bn._mult(wn);const Dn=Sr.mult(vn?-1:1),Rn=pr.mult(vn?-1:1),ts=this.evaluateLineProgressFeatures(this.distance);if(Mr==null&&(this.addHalfVertex(Jt,bn.x,bn.y,!1,!vn,0,er,ts),en||this.addHalfVertex(Jt,bn.x+2*Rn.x,bn.y+2*Rn.y,!1,vn,0,er,ts)),zr==="fakeround"){const Vn=Math.round(180*Tn/Math.PI/20);this.addHalfVertex(Jt,Rn.x,Rn.y,!1,vn,0,er,ts);for(let Hn=0;Hn<Vn;Hn++){let Zn=Hn/Vn;if(Zn!==.5){const In=Zn-.5;Zn+=Zn*In*(Zn-1)*((1.0904+sn*(sn*(3.55645-1.43519*sn)-3.2452))*In*In+(.848013+sn*(.215638*sn-1.06021)))}const js=Dn.sub(Rn)._mult(Zn)._add(Rn)._unit();this.addHalfVertex(Jt,js.x,js.y,!1,vn,0,er,ts)}this.addHalfVertex(Jt,Dn.x,Dn.y,!1,vn,0,er,ts)}en||Mr!=null||this.addHalfVertex(Jt,bn.x+2*Dn.x,bn.y+2*Dn.y,!1,vn,0,er,ts),Mr!=null&&lr&&this.addCurrentVertex(Jt,br||Sr,1,1,er,Mr)}else if(zr==="butt")this.addCurrentVertex(Jt,dn,0,0,er,Mr);else if(zr==="square"){if(!or){const en=At?0:-1;this.addCurrentVertex(Jt,dn,en,en,er,Mr)}if(this.addCurrentVertex(Jt,dn,0,0,er,Mr),or){const en=kt?0:1;this.addCurrentVertex(Jt,dn,en,en,er,Mr)}}else if(zr==="round"){if(or){const en=!Jr&&Rr?Rr:pr;this.addCurrentVertex(Jt,en,0,0,er,Mr),!Jr&&kt||this.addCurrentVertex(Jt,en,1,1,er,Mr,!0)}if(lr){const en=!Jr&&br?br:Sr;!Jr&&At||this.addCurrentVertex(Jt,en,-1,-1,er,Mr,!0),this.addCurrentVertex(Jt,en,0,0,er,Mr)}}}}addVerticesTo(o,g,_e,rt,ot,at,ut,ft,gt,Ct){const At=(g.w-o.w)/this.tessellationStep|0;let kt=0;const zt=this.scaledDistance;if(At>1){this.lineSoFar=o.w;const Kt=(g.x-o.x)/At,er=(g.y-o.y)/At,Jt=(g.z-o.z)/At,or=(g.w-o.w)/At;for(let lr=1;lr<At;++lr){o.x+=Kt,o.y+=er,o.z+=Jt,this.lineSoFar+=or,kt+=or;const pr=this.evaluateLineProgressFeatures(this.prevDistance+kt);this.scaledDistance=(this.prevDistance+kt)/this.totalDistance,this.addHalfVertex(o,_e,rt,Ct,!1,ut,gt,pr),this.addHalfVertex(o,ot,at,Ct,!0,-ft,gt,pr)}}this.lineSoFar=g.w,this.scaledDistance=zt;const Ut=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(g,_e,rt,Ct,!1,ut,gt,Ut),this.addHalfVertex(g,ot,at,Ct,!0,-ft,gt,Ut)}evaluateLineProgressFeatures(o){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+o)/this.totalFeatureLength):$n(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let g=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(g=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:g}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:g}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:g}}addCurrentVertex(o,g,_e,rt,ot,at,ut=!1){const ft=g.x+g.y*_e,gt=g.y-g.x*_e,Ct=g.y*rt-g.x,At=-g.y-g.x*rt;if(at!=null){const kt=this.elevationType==="offset",zt=-10,Ut=Mn+10,Kt=at.zOffset,er=new tA(o.x,o.y,Kt,this.lineSoFar),Jt=!!kt&&pS(o,zt,Ut),or=this.lineSoFar,lr=this.distance;if(this.currentVertex)if(Jt){const pr=this.currentVertexIsOutside,Sr=this.currentVertex,br=new tA(o.x,o.y,Kt,this.lineSoFar);if(iA(Sr,br,zt,Ut),!pS(br,zt,Ut)){if(pr){this.e1=this.e2=-1,this.distance-=Sr.dist(er),this.lineSoFar=Sr.w;const Rr=this.evaluateLineProgressFeatures(Sr.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Sr,ft,gt,ut,!1,_e,ot,Rr),this.addHalfVertex(Sr,Ct,At,ut,!0,-rt,ot,Rr),this.prevDistance=this.distance}this.distance=this.prevDistance+Sr.dist(br),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Sr,br,ft,gt,Ct,At,_e,rt,ot,ut),this.distance=lr,this.scaledDistance=this.distance/this.totalDistance}}else{const pr=this.currentVertex;if(this.currentVertexIsOutside){iA(pr,er,zt,Ut),this.e1=this.e2=-1,this.distance-=pr.dist(er),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=pr.w;const Sr=this.evaluateLineProgressFeatures(pr.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(pr,ft,gt,ut,!1,_e,ot,Sr),this.addHalfVertex(pr,Ct,At,ut,!0,-rt,ot,Sr),this.prevDistance=this.distance,this.distance=lr,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(pr,er,ft,gt,Ct,At,_e,rt,ot,ut)}else Jt||(this.addHalfVertex(o,ft,gt,ut,!1,_e,ot,at),this.addHalfVertex(o,Ct,At,ut,!0,-rt,ot,at));this.currentVertex=er,this.currentVertexIsOutside=Jt,this.lineSoFar=or}else this.addHalfVertex(o,ft,gt,ut,!1,_e,ot,at),this.addHalfVertex(o,Ct,At,ut,!0,-rt,ot,at)}addHalfVertex({x:o,y:g},_e,rt,ot,at,ut,ft,gt){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),at||this.segmentPoints.push(this.lineSoFar-this.segmentStart,ut)),this.layoutVertexArray.emplaceBack((o<<1)+(ot?1:0),(g<<1)+(at?1:0),Math.round(63*_e)+128,Math.round(63*rt)+128,1+(ut===0?0:ut<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const At=fs(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,At)}const Ct=ft.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Ct),ft.primitiveLength++),at?this.e2=Ct:this.e1=Ct,gt!=null&&this.zOffsetVertexArray.emplaceBack(gt.zOffset,gt.variableWidth,gt.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(o,g){this.prevDistance=this.distance,this.distance+=o.dist(g),this.updateScaledDistance()}}function pS(_,o,g){return _.x<o||_.x>g||_.y<o||_.y>g}let NA,LA;function OA(_,o,g){return o*(Mn/(_.tileSize*Math.pow(2,g-_.tileID.overscaledZ)))}qn(dS,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const jA=(_,o,g)=>(1-g)*_+g*o;function FA(_,o){return 1/OA(_,1,o.tileZoom)}function BA(_,o,g,_e){return _.translatePosMatrix(_e||o.tileID.projMatrix,o,g.paint.get("line-translate"),g.paint.get("line-translate-anchor"))}const zA=_=>{const o=[];VA(_)&&o.push("RENDER_LINE_DASH"),_.paint.get("line-gradient")&&o.push("RENDER_LINE_GRADIENT");const g=_.paint.get("line-trim-offset");g[0]===0&&g[1]===0||o.push("RENDER_LINE_TRIM_OFFSET"),_.paint.get("line-border-width").constantOr(1)!==0&&o.push("RENDER_LINE_BORDER");const _e=_.layout.get("line-join").constantOr("miter")==="none",rt=!!_.paint.get("line-pattern").constantOr(1);return _e&&rt&&o.push("LINE_JOIN_NONE"),o};function VA(_){const o=_.paint.get("line-dasharray").value;return o.kind!=="constant"||o.value}let fS;const UA=()=>fS||(fS={layout:NA||(NA=new ga({"line-cap":new On(Gr.layout_line["line-cap"]),"line-join":new On(Gr.layout_line["line-join"]),"line-miter-limit":new Pn(Gr.layout_line["line-miter-limit"]),"line-round-limit":new Pn(Gr.layout_line["line-round-limit"]),"line-sort-key":new On(Gr.layout_line["line-sort-key"]),"line-z-offset":new On(Gr.layout_line["line-z-offset"]),"line-elevation-reference":new Pn(Gr.layout_line["line-elevation-reference"]),"line-cross-slope":new Pn(Gr.layout_line["line-cross-slope"]),visibility:new Pn(Gr.layout_line.visibility),"line-width-unit":new Pn(Gr.layout_line["line-width-unit"])})),paint:LA||(LA=new ga({"line-opacity":new On(Gr.paint_line["line-opacity"]),"line-color":new On(Gr.paint_line["line-color"]),"line-translate":new Pn(Gr.paint_line["line-translate"]),"line-translate-anchor":new Pn(Gr.paint_line["line-translate-anchor"]),"line-width":new On(Gr.paint_line["line-width"]),"line-gap-width":new On(Gr.paint_line["line-gap-width"]),"line-offset":new On(Gr.paint_line["line-offset"]),"line-blur":new On(Gr.paint_line["line-blur"]),"line-dasharray":new On(Gr.paint_line["line-dasharray"]),"line-pattern":new On(Gr.paint_line["line-pattern"]),"line-pattern-cross-fade":new Pn(Gr.paint_line["line-pattern-cross-fade"]),"line-gradient":new l0(Gr.paint_line["line-gradient"]),"line-trim-offset":new Pn(Gr.paint_line["line-trim-offset"]),"line-trim-fade-range":new Pn(Gr.paint_line["line-trim-fade-range"]),"line-trim-color":new Pn(Gr.paint_line["line-trim-color"]),"line-emissive-strength":new On(Gr.paint_line["line-emissive-strength"]),"line-border-width":new On(Gr.paint_line["line-border-width"]),"line-border-color":new On(Gr.paint_line["line-border-color"]),"line-occlusion-opacity":new Pn(Gr.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new On({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"})}))},fS);class NP extends On{possiblyEvaluate(o,g){return g=new Do(Math.floor(g.zoom),{now:g.now,fadeDuration:g.fadeDuration,transition:g.transition,worldview:g.worldview}),super.possiblyEvaluate(o,g)}evaluate(o,g,_e,rt){return g=Object.assign({},g,{zoom:Math.floor(g.zoom)}),super.evaluate(o,g,_e,rt)}}let A1;function $A(_,o){return o>0?o+2*_:_}const LP=Bs([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),OP=Bs([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),jP=Bs([{name:"a_projected_pos",components:4,type:"Float32"}],4);Bs([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const FP=Bs([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),BP=Bs([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),zP=Bs([{name:"a_texb",components:2,type:"Uint16"}]),VP=Bs([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),UP=Bs([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Bs([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const GA=Bs([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$P=Bs([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Bs([{name:"triangle",components:3,type:"Uint16"}]),Bs([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Bs([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Bs([{type:"Float32",name:"offsetX"}]),Bs([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Yl=24;function GP(_,o,g){return _.sections.forEach(_e=>{_e.text=function(rt,ot,at){const ut=ot.layout.get("text-transform").evaluate(at,{});return ut==="uppercase"?rt=rt.toLocaleUpperCase():ut==="lowercase"&&(rt=rt.toLocaleLowerCase()),rm.applyArabicShaping&&(rt=rm.applyArabicShaping(rt)),rt}(_e.text,o,g)}),_}const R1={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function HP(_){return _===""||_===""||_===""||_===""||_===""||_===""||_===""||_===""||_===""||_===""||_===""||_===""||_===""||_===""||_===""||_===""||_===""}function WP(_){return _===""||_===""||_===""||_===""||_===""||_===""||_===""||_===""||_===""||_===""}const mS=4294967296,HA=1/mS,WA=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let SE=class{constructor(_=new Uint8Array(16)){this.buf=ArrayBuffer.isView(_)?_:new Uint8Array(_),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(_,o,g=this.length){for(;this.pos<g;){const _e=this.readVarint(),rt=_e>>3,ot=this.pos;this.type=7&_e,_(rt,o,this),this.pos===ot&&this.skip(_e)}return o}readMessage(_,o){return this.readFields(_,o,this.readVarint()+this.pos)}readFixed32(){const _=this.dataView.getUint32(this.pos,!0);return this.pos+=4,_}readSFixed32(){const _=this.dataView.getInt32(this.pos,!0);return this.pos+=4,_}readFixed64(){const _=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*mS;return this.pos+=8,_}readSFixed64(){const _=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*mS;return this.pos+=8,_}readFloat(){const _=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,_}readDouble(){const _=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,_}readVarint(_){const o=this.buf;let g,_e;return _e=o[this.pos++],g=127&_e,_e<128?g:(_e=o[this.pos++],g|=(127&_e)<<7,_e<128?g:(_e=o[this.pos++],g|=(127&_e)<<14,_e<128?g:(_e=o[this.pos++],g|=(127&_e)<<21,_e<128?g:(_e=o[this.pos],g|=(15&_e)<<28,function(rt,ot,at){const ut=at.buf;let ft,gt;if(gt=ut[at.pos++],ft=(112&gt)>>4,gt<128||(gt=ut[at.pos++],ft|=(127&gt)<<3,gt<128)||(gt=ut[at.pos++],ft|=(127&gt)<<10,gt<128)||(gt=ut[at.pos++],ft|=(127&gt)<<17,gt<128)||(gt=ut[at.pos++],ft|=(127&gt)<<24,gt<128)||(gt=ut[at.pos++],ft|=(1&gt)<<31,gt<128))return Nx(rt,ft,ot);throw new Error("Expected varint not more than 10 bytes")}(g,_,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const _=this.readVarint();return _%2==1?(_+1)/-2:_/2}readBoolean(){return!!this.readVarint()}readString(){const _=this.readVarint()+this.pos,o=this.pos;return this.pos=_,_-o>=12&&WA?WA.decode(this.buf.subarray(o,_)):function(g,_e,rt){let ot="",at=_e;for(;at<rt;){const ut=g[at];let ft,gt,Ct,At=null,kt=ut>239?4:ut>223?3:ut>191?2:1;if(at+kt>rt)break;kt===1?ut<128&&(At=ut):kt===2?(ft=g[at+1],(192&ft)==128&&(At=(31&ut)<<6|63&ft,At<=127&&(At=null))):kt===3?(ft=g[at+1],gt=g[at+2],(192&ft)==128&&(192&gt)==128&&(At=(15&ut)<<12|(63&ft)<<6|63&gt,(At<=2047||At>=55296&&At<=57343)&&(At=null))):kt===4&&(ft=g[at+1],gt=g[at+2],Ct=g[at+3],(192&ft)==128&&(192&gt)==128&&(192&Ct)==128&&(At=(15&ut)<<18|(63&ft)<<12|(63&gt)<<6|63&Ct,(At<=65535||At>=1114112)&&(At=null))),At===null?(At=65533,kt=1):At>65535&&(At-=65536,ot+=String.fromCharCode(At>>>10&1023|55296),At=56320|1023&At),ot+=String.fromCharCode(At),at+=kt}return ot}(this.buf,o,_)}readBytes(){const _=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,_);return this.pos=_,o}readPackedVarint(_=[],o){const g=this.readPackedEnd();for(;this.pos<g;)_.push(this.readVarint(o));return _}readPackedSVarint(_=[]){const o=this.readPackedEnd();for(;this.pos<o;)_.push(this.readSVarint());return _}readPackedBoolean(_=[]){const o=this.readPackedEnd();for(;this.pos<o;)_.push(this.readBoolean());return _}readPackedFloat(_=[]){const o=this.readPackedEnd();for(;this.pos<o;)_.push(this.readFloat());return _}readPackedDouble(_=[]){const o=this.readPackedEnd();for(;this.pos<o;)_.push(this.readDouble());return _}readPackedFixed32(_=[]){const o=this.readPackedEnd();for(;this.pos<o;)_.push(this.readFixed32());return _}readPackedSFixed32(_=[]){const o=this.readPackedEnd();for(;this.pos<o;)_.push(this.readSFixed32());return _}readPackedFixed64(_=[]){const o=this.readPackedEnd();for(;this.pos<o;)_.push(this.readFixed64());return _}readPackedSFixed64(_=[]){const o=this.readPackedEnd();for(;this.pos<o;)_.push(this.readSFixed64());return _}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(_){const o=7&_;if(o===0)for(;this.buf[this.pos++]>127;);else if(o===2)this.pos=this.readVarint()+this.pos;else if(o===5)this.pos+=4;else{if(o!==1)throw new Error(`Unimplemented type: ${o}`);this.pos+=8}}writeTag(_,o){this.writeVarint(_<<3|o)}realloc(_){let o=this.length||16;for(;o<this.pos+_;)o*=2;if(o!==this.length){const g=new Uint8Array(o);g.set(this.buf),this.buf=g,this.dataView=new DataView(g.buffer),this.length=o}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(_){this.realloc(4),this.dataView.setInt32(this.pos,_,!0),this.pos+=4}writeSFixed32(_){this.realloc(4),this.dataView.setInt32(this.pos,_,!0),this.pos+=4}writeFixed64(_){this.realloc(8),this.dataView.setInt32(this.pos,-1&_,!0),this.dataView.setInt32(this.pos+4,Math.floor(_*HA),!0),this.pos+=8}writeSFixed64(_){this.realloc(8),this.dataView.setInt32(this.pos,-1&_,!0),this.dataView.setInt32(this.pos+4,Math.floor(_*HA),!0),this.pos+=8}writeVarint(_){(_=+_||0)>268435455||_<0?function(o,g){let _e,rt;if(o>=0?(_e=o%4294967296|0,rt=o/4294967296|0):(_e=~(-o%4294967296),rt=~(-o/4294967296),4294967295^_e?_e=_e+1|0:(_e=0,rt=rt+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");g.realloc(10),function(ot,at,ut){ut.buf[ut.pos++]=127&ot|128,ot>>>=7,ut.buf[ut.pos++]=127&ot|128,ot>>>=7,ut.buf[ut.pos++]=127&ot|128,ot>>>=7,ut.buf[ut.pos++]=127&ot|128,ut.buf[ut.pos]=127&(ot>>>=7)}(_e,0,g),function(ot,at){const ut=(7&ot)<<4;at.buf[at.pos++]|=ut|((ot>>>=3)?128:0),ot&&(at.buf[at.pos++]=127&ot|((ot>>>=7)?128:0),ot&&(at.buf[at.pos++]=127&ot|((ot>>>=7)?128:0),ot&&(at.buf[at.pos++]=127&ot|((ot>>>=7)?128:0),ot&&(at.buf[at.pos++]=127&ot|((ot>>>=7)?128:0),ot&&(at.buf[at.pos++]=127&ot)))))}(rt,g)}(_,this):(this.realloc(4),this.buf[this.pos++]=127&_|(_>127?128:0),_<=127||(this.buf[this.pos++]=127&(_>>>=7)|(_>127?128:0),_<=127||(this.buf[this.pos++]=127&(_>>>=7)|(_>127?128:0),_<=127||(this.buf[this.pos++]=_>>>7&127))))}writeSVarint(_){this.writeVarint(_<0?2*-_-1:2*_)}writeBoolean(_){this.writeVarint(+_)}writeString(_){_=String(_),this.realloc(4*_.length),this.pos++;const o=this.pos;this.pos=function(_e,rt,ot){for(let at,ut,ft=0;ft<rt.length;ft++){if(at=rt.charCodeAt(ft),at>55295&&at<57344){if(!ut){at>56319||ft+1===rt.length?(_e[ot++]=239,_e[ot++]=191,_e[ot++]=189):ut=at;continue}if(at<56320){_e[ot++]=239,_e[ot++]=191,_e[ot++]=189,ut=at;continue}at=ut-55296<<10|at-56320|65536,ut=null}else ut&&(_e[ot++]=239,_e[ot++]=191,_e[ot++]=189,ut=null);at<128?_e[ot++]=at:(at<2048?_e[ot++]=at>>6|192:(at<65536?_e[ot++]=at>>12|224:(_e[ot++]=at>>18|240,_e[ot++]=at>>12&63|128),_e[ot++]=at>>6&63|128),_e[ot++]=63&at|128)}return ot}(this.buf,_,this.pos);const g=this.pos-o;g>=128&&qA(o,g,this),this.pos=o-1,this.writeVarint(g),this.pos+=g}writeFloat(_){this.realloc(4),this.dataView.setFloat32(this.pos,_,!0),this.pos+=4}writeDouble(_){this.realloc(8),this.dataView.setFloat64(this.pos,_,!0),this.pos+=8}writeBytes(_){const o=_.length;this.writeVarint(o),this.realloc(o);for(let g=0;g<o;g++)this.buf[this.pos++]=_[g]}writeRawMessage(_,o){this.pos++;const g=this.pos;_(o,this);const _e=this.pos-g;_e>=128&&qA(g,_e,this),this.pos=g-1,this.writeVarint(_e),this.pos+=_e}writeMessage(_,o,g){this.writeTag(_,2),this.writeRawMessage(o,g)}writePackedVarint(_,o){o.length&&this.writeMessage(_,qP,o)}writePackedSVarint(_,o){o.length&&this.writeMessage(_,KP,o)}writePackedBoolean(_,o){o.length&&this.writeMessage(_,YP,o)}writePackedFloat(_,o){o.length&&this.writeMessage(_,XP,o)}writePackedDouble(_,o){o.length&&this.writeMessage(_,ZP,o)}writePackedFixed32(_,o){o.length&&this.writeMessage(_,QP,o)}writePackedSFixed32(_,o){o.length&&this.writeMessage(_,JP,o)}writePackedFixed64(_,o){o.length&&this.writeMessage(_,_k,o)}writePackedSFixed64(_,o){o.length&&this.writeMessage(_,eM,o)}writeBytesField(_,o){this.writeTag(_,2),this.writeBytes(o)}writeFixed32Field(_,o){this.writeTag(_,5),this.writeFixed32(o)}writeSFixed32Field(_,o){this.writeTag(_,5),this.writeSFixed32(o)}writeFixed64Field(_,o){this.writeTag(_,1),this.writeFixed64(o)}writeSFixed64Field(_,o){this.writeTag(_,1),this.writeSFixed64(o)}writeVarintField(_,o){this.writeTag(_,0),this.writeVarint(o)}writeSVarintField(_,o){this.writeTag(_,0),this.writeSVarint(o)}writeStringField(_,o){this.writeTag(_,2),this.writeString(o)}writeFloatField(_,o){this.writeTag(_,5),this.writeFloat(o)}writeDoubleField(_,o){this.writeTag(_,1),this.writeDouble(o)}writeBooleanField(_,o){this.writeVarintField(_,+o)}};function Nx(_,o,g){return g?4294967296*o+(_>>>0):4294967296*(o>>>0)+(_>>>0)}function qA(_,o,g){const _e=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));g.realloc(_e);for(let rt=g.pos-1;rt>=_;rt--)g.buf[rt+_e]=g.buf[rt]}function qP(_,o){for(let g=0;g<_.length;g++)o.writeVarint(_[g])}function KP(_,o){for(let g=0;g<_.length;g++)o.writeSVarint(_[g])}function XP(_,o){for(let g=0;g<_.length;g++)o.writeFloat(_[g])}function ZP(_,o){for(let g=0;g<_.length;g++)o.writeDouble(_[g])}function YP(_,o){for(let g=0;g<_.length;g++)o.writeBoolean(_[g])}function QP(_,o){for(let g=0;g<_.length;g++)o.writeFixed32(_[g])}function JP(_,o){for(let g=0;g<_.length;g++)o.writeSFixed32(_[g])}function _k(_,o){for(let g=0;g<_.length;g++)o.writeFixed64(_[g])}function eM(_,o){for(let g=0;g<_.length;g++)o.writeSFixed64(_[g])}const gS=3;function tM(_,o,g){o.glyphs=[],_===1&&g.readMessage(rM,o)}function rM(_,o,g){if(_===3){const{id:_e,bitmap:rt,width:ot,height:at,left:ut,top:ft,advance:gt}=g.readMessage(iM,{});o.glyphs.push({id:_e,bitmap:new K0({width:ot+2*gS,height:at+2*gS},rt),metrics:{width:ot,height:at,left:ut,top:ft,advance:gt}})}else _===4?o.ascender=g.readSVarint():_===5&&(o.descender=g.readSVarint())}function iM(_,o,g){_===1?o.id=g.readVarint():_===2?o.bitmap=g.readBytes():_===3?o.width=g.readVarint():_===4?o.height=g.readVarint():_===5?o.left=g.readSVarint():_===6?o.top=g.readSVarint():_===7&&(o.advance=g.readVarint())}const KA=gS,Qu={horizontal:1,vertical:2,horizontalOnly:3};class I1{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(o,g){const _e=new I1;return _e.scale=o||1,_e.fontStack=g,_e}static forImage(o){const g=new I1;return g.image=o,g}}class Lx{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,g,_e){const rt=new Lx;for(let ot=0;ot<o.sections.length;ot++){const at=o.sections[ot];at.image?rt.addImageSection(at,_e):rt.addTextSection(at,g)}return rt}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCodePoint(o){return this.text.codePointAt(o)}verticalizePunctuation(o){this.text=function(g,_e){let rt="";for(let ot=0;ot<g.length;ot++){const at=g.charCodeAt(ot+1)||null,ut=g.charCodeAt(ot-1)||null;rt+=!_e&&(at&&Xy(at)&&!R1[g[ot+1]]||ut&&Xy(ut)&&!R1[g[ot-1]])||!R1[g[ot]]?g[ot]:R1[g[ot]]}return rt}(this.text,o)}trim(){let o=0;for(let _e=0;_e<this.text.length&&CE[this.text.charCodeAt(_e)];_e++)o++;let g=this.text.length;for(let _e=this.text.length-1;_e>=0&&_e>=o&&CE[this.text.charCodeAt(_e)];_e--)g--;this.text=this.text.substring(o,g),this.sectionIndex=this.sectionIndex.slice(o,g)}substring(o,g){const _e=new Lx;return _e.text=this.text.substring(o,g),_e.sectionIndex=this.sectionIndex.slice(o,g),_e.sections=this.sections,_e}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,g)=>Math.max(o,this.sections[g].scale),0)}addTextSection(o,g){this.text+=o.text,this.sections.push(I1.forText(o.scale,o.fontStack||g));const _e=this.sections.length-1;for(let rt=0;rt<o.text.length;++rt)this.sectionIndex.push(_e)}addImageSection(o,g){const _e=o.image?o.image.getPrimary():null;if(!_e)return void $n("Can't add FormattedSection with an empty image.");_e.scaleSelf(g);const rt=this.getNextImageSectionCharCode();rt?(this.text+=String.fromCodePoint(rt),this.sections.push(I1.forImage(_e)),this.sectionIndex.push(this.sections.length-1)):$n("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _S(_,o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt,Ut,Kt=1){const er=Lx.fromFeature(_,rt,Kt);At===Qu.vertical&&er.verticalizePunctuation(kt);let Jt=[];const or=function(Rr,Mr,Lr,Jr,zr,sn){if(!Rr)return[];const dn=[],pn=function(vn,nn,en,bn,Dn,Rn){let ts=0;for(let Vn=0;Vn<vn.length();Vn++){const Hn=vn.getSection(Vn);ts+=XA(vn.getCodePoint(Vn),Hn,bn,Dn,nn,Rn)}return ts/Math.max(1,Math.ceil(ts/en))}(Rr,Mr,Lr,Jr,zr,sn),wn=Rr.text.indexOf("")>=0;let Tn=0;for(let vn=0;vn<Rr.length();vn++){const nn=Rr.getSection(vn),en=Rr.getCodePoint(vn);if(CE[en]||(Tn+=XA(en,nn,Jr,zr,Mr,sn)),vn<Rr.length()-1){const bn=!((xn=en)<11904||!(cs["Bopomofo Extended"](xn)||cs.Bopomofo(xn)||cs["CJK Compatibility Forms"](xn)||cs["CJK Compatibility Ideographs"](xn)||cs["CJK Compatibility"](xn)||cs["CJK Radicals Supplement"](xn)||cs["CJK Strokes"](xn)||cs["CJK Symbols and Punctuation"](xn)||cs["CJK Unified Ideographs Extension A"](xn)||cs["CJK Unified Ideographs"](xn)||cs["Enclosed CJK Letters and Months"](xn)||cs["Halfwidth and Fullwidth Forms"](xn)||cs.Hiragana(xn)||cs["Ideographic Description Characters"](xn)||cs["Kangxi Radicals"](xn)||cs["Katakana Phonetic Extensions"](xn)||cs.Katakana(xn)||cs["Vertical Forms"](xn)||cs["Yi Radicals"](xn)||cs["Yi Syllables"](xn)));(nM[en]||bn||nn.image)&&dn.push(YA(vn+1,Tn,pn,dn,sM(en,Rr.getCodePoint(vn+1),bn&&wn),!1))}}var xn;return QA(YA(Rr.length(),Tn,pn,dn,0,!0))}(er,gt,ot,o,_e,zt),{processBidirectionalText:lr,processStyledBidirectionalText:pr}=rm;if(lr&&er.sections.length===1){const Rr=lr(er.toString(),or);for(const Mr of Rr){const Lr=new Lx;Lr.text=Mr,Lr.sections=er.sections;for(let Jr=0;Jr<Mr.length;Jr++)Lr.sectionIndex.push(0);Jt.push(Lr)}}else if(pr){const Rr=pr(er.text,er.sectionIndex,or);for(const Mr of Rr){const Lr=new Lx;Lr.text=Mr[0],Lr.sectionIndex=Mr[1],Lr.sections=er.sections,Jt.push(Lr)}}else Jt=function(Rr,Mr){const Lr=[],Jr=Rr.text;let zr=0;for(const sn of Mr)Lr.push(Rr.substring(zr,sn)),zr=sn;return zr<Jr.length&&Lr.push(Rr.substring(zr,Jr.length)),Lr}(er,or);const Sr=[],br={positionedLines:Sr,text:er.toString(),top:Ct[1],bottom:Ct[1],left:Ct[0],right:Ct[0],writingMode:At,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Rr,Mr,Lr,Jr,zr,sn,dn,pn,wn,Tn,xn,vn){let nn=0,en=0,bn=0;const Dn=pn==="right"?1:pn==="left"?0:.5;let Rn=!1;for(const In of zr){const Yn=In.getSections();for(const xs of Yn){if(xs.image)continue;const Gs=Mr[xs.fontStack];if(Gs&&(Rn=Gs.ascender!==void 0&&Gs.descender!==void 0,!Rn))break}if(!Rn)break}let ts=0;for(const In of zr){In.trim();const Yn=In.getMaxScale(),xs=(Yn-1)*Yl,Gs={positionedGlyphs:[],lineOffset:0};Rr.positionedLines[ts]=Gs;const Ws=Gs.positionedGlyphs;let Rs=0;if(!In.length()){en+=sn,++ts;continue}let vo=0,wr=0;for(let on=0;on<In.length();on++){const En=In.getSection(on),Fn=In.getSectionIndex(on),Bn=In.getCodePoint(on);let rs=En.scale,ss=null,Ts=null,Ns=null,Os=Yl,zs=0,ds=wn;ds===Qu.vertical&&((Vn=Bn)===12312||Vn===12313||Vn===12316||Vn===12540||Vn===12448)&&(ds=Qu.horizontal);const ys=!(ds===Qu.horizontal||!xn&&!Ky(Bn)||xn&&(CE[Bn]||Zy(Bn)));if(En.image){const Qs=Jr.get(En.image.toString());if(!Qs)continue;Ns=En.image,Rr.iconsInText=Rr.iconsInText||!0,Ts=Qs.paddedRect;const io=Qs.displaySize;rs=rs*Yl/vn,ss={width:io[0],height:io[1],left:0,top:-KA,advance:ys?io[1]:io[0],localGlyph:!1},zs=Rn?-ss.height*rs:Yn*Yl-17-io[1]*rs,Os=ss.advance;const no=(ys?io[0]:io[1])*rs-Yl*Yn;no>0&&no>Rs&&(Rs=no)}else{const Qs=Lr[En.fontStack];if(!Qs)continue;Qs[Bn]&&(Ts=Qs[Bn]);const io=Mr[En.fontStack];if(!io)continue;const no=io.glyphs[Bn];if(!no)continue;if(ss=no.metrics,Os=Bn!==8203?Yl:0,Rn){const go=io.ascender!==void 0?Math.abs(io.ascender):0,Ao=io.descender!==void 0?Math.abs(io.descender):0,bo=(go+Ao)*rs;vo<bo&&(vo=bo,wr=(go-Ao)/2*rs),zs=-go*rs}else zs=(Yn-rs)*Yl-17}ys?(Rr.verticalizable=!0,Ws.push({glyph:Bn,image:Ns,x:nn,y:en+zs,vertical:ys,scale:rs,localGlyph:ss.localGlyph,fontStack:En.fontStack,sectionIndex:Fn,metrics:ss,rect:Ts}),nn+=Os*rs+Tn):(Ws.push({glyph:Bn,image:Ns,x:nn,y:en+zs,vertical:ys,scale:rs,localGlyph:ss.localGlyph,fontStack:En.fontStack,sectionIndex:Fn,metrics:ss,rect:Ts}),nn+=ss.advance*rs+Tn)}Ws.length!==0&&(bn=Math.max(nn-Tn,bn),Rn?JA(Ws,Dn,Rs,wr,sn*Yn/2):JA(Ws,Dn,Rs,0,sn/2)),nn=0;const Cr=sn*Yn+Rs;Gs.lineOffset=Math.max(Rs,xs),en+=Cr,++ts}var Vn;const Hn=en,{horizontalAlign:Zn,verticalAlign:js}=yS(dn);(function(In,Yn,xs,Gs,Ws,Rs){const vo=(Yn-xs)*Ws,wr=-Rs*Gs;for(const Cr of In)for(const on of Cr.positionedGlyphs)on.x+=vo,on.y+=wr})(Rr.positionedLines,Dn,Zn,js,bn,Hn),Rr.top+=-js*Hn,Rr.bottom=Rr.top+Hn,Rr.left+=-Zn*bn,Rr.right=Rr.left+bn,Rr.hasBaseline=Rn}(br,o,g,_e,Jt,at,ut,ft,At,gt,kt,Ut),!function(Rr){for(const Mr of Rr)if(Mr.positionedGlyphs.length!==0)return!1;return!0}(Sr))return br}const CE={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},nM={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function XA(_,o,g,_e,rt,ot){if(o.image){const at=_e.get(o.image.toString());return at?at.displaySize[0]*o.scale*Yl/ot+rt:0}{const at=g[o.fontStack],ut=at&&at.glyphs[_];return ut?ut.metrics.advance*o.scale+rt:0}}function ZA(_,o,g,_e){const rt=Math.pow(_-o,2);return _e?_<o?rt/2:2*rt:rt+Math.abs(g)*g}function sM(_,o,g){let _e=0;return _===10&&(_e-=1e4),g&&(_e+=150),_!==40&&_!==65288||(_e+=50),o!==41&&o!==65289||(_e+=50),_e}function YA(_,o,g,_e,rt,ot){let at=null,ut=ZA(o,g,rt,ot);for(const ft of _e){const gt=ZA(o-ft.x,g,rt,ot)+ft.badness;gt<=ut&&(at=ft,ut=gt)}return{index:_,x:o,priorBreak:at,badness:ut}}function QA(_){return _?QA(_.priorBreak).concat(_.index):[]}function yS(_){let o=.5,g=.5;switch(_){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(_){case"bottom":case"bottom-right":case"bottom-left":g=1;break;case"top":case"top-right":case"top-left":g=0}return{horizontalAlign:o,verticalAlign:g}}function JA(_,o,g,_e,rt){if(!(o||g||_e||rt))return;const ot=_.length-1,at=_[ot],ut=(at.x+at.metrics.advance*at.scale)*o;for(let ft=0;ft<=ot;ft++)_[ft].x-=ut,_[ft].y+=g+_e+rt}function xS(_){return _.imagePrimary!==void 0&&_.top!==void 0&&_.bottom!==void 0&&_.left!==void 0&&_.right!==void 0}function AE(_,o,g,_e){const{horizontalAlign:rt,verticalAlign:ot}=yS(_e),at=g[0]-_.displaySize[0]*rt,ut=g[1]-_.displaySize[1]*ot;return{imagePrimary:_,imageSecondary:o,top:ut,bottom:ut+_.displaySize[1],left:at,right:at+_.displaySize[0]}}function vS(_,o,g,_e,rt,ot){const at=_.imagePrimary;let ut;if(at.content){const er=at.content,Jt=at.pixelRatio||1;ut=[er[0]/Jt,er[1]/Jt,at.displaySize[0]-er[2]/Jt,at.displaySize[1]-er[3]/Jt]}const ft=o.left*ot,gt=o.right*ot;let Ct,At,kt,zt;g==="width"||g==="both"?(zt=rt[0]+ft-_e[3],At=rt[0]+gt+_e[1]):(zt=rt[0]+(ft+gt-at.displaySize[0])/2,At=zt+at.displaySize[0]);const Ut=o.top*ot,Kt=o.bottom*ot;return g==="height"||g==="both"?(Ct=rt[1]+Ut-_e[0],kt=rt[1]+Kt+_e[2]):(Ct=rt[1]+(Ut+Kt-at.displaySize[1])/2,kt=Ct+at.displaySize[1]),{imagePrimary:at,imageSecondary:void 0,top:Ct,right:At,bottom:kt,left:zt,collisionPadding:ut}}function e2(_){return!_.imagePrimary.stretchX}function t2(_){return!_.imagePrimary.stretchY}function r2(_){return{width:_.right-_.left,height:_.bottom-_.top}}const pm=128;function Ox(_,o,g){const{expression:_e}=o;if(_e.kind==="constant")return{kind:"constant",layoutSize:_e.evaluate(new Do(_+1,{worldview:g}))};if(_e.kind==="source")return{kind:"source"};{const{zoomStops:rt,interpolationType:ot}=_e;let at=0;for(;at<rt.length&&rt[at]<=_;)at++;at=Math.max(0,at-1);let ut=at;for(;ut<rt.length&&rt[ut]<_+1;)ut++;ut=Math.min(rt.length-1,ut);const ft=rt[at],gt=rt[ut];return _e.kind==="composite"?{kind:"composite",minZoom:ft,maxZoom:gt,interpolationType:ot}:{kind:"camera",minZoom:ft,maxZoom:gt,minSize:_e.evaluate(new Do(ft,{worldview:g})),maxSize:_e.evaluate(new Do(gt,{worldview:g})),interpolationType:ot}}}function bS(_,{uSize:o,uSizeT:g},{lowerSize:_e,upperSize:rt}){return _.kind==="source"?_e/pm:_.kind==="composite"?fs(_e/pm,rt/pm,g):o}function jx(_,o,g=1){let _e=0,rt=0;if(_.kind==="constant")rt=_.layoutSize*g;else if(_.kind!=="source"){const{interpolationType:ot,minZoom:at,maxZoom:ut}=_,ft=ot?tr(qu.interpolationFactor(ot,o,at,ut),0,1):0;_.kind==="camera"?rt=fs(_.minSize,_.maxSize,ft)*g:_e=ft*g}return{uSizeT:_e,uSize:rt}}class g0 extends mn{constructor(o,g,_e,rt,ot){super(o,g),this.angle=rt,this.z=_e,ot!==void 0&&(this.segment=ot)}clone(){return new g0(this.x,this.y,this.z,this.angle,this.segment)}}function i2(_,o,g,_e,rt){if(o.segment===void 0)return!0;let ot=o,at=o.segment+1,ut=0;for(;ut>-g/2;){if(at--,at<0)return!1;ut-=_[at].dist(ot),ot=_[at]}ut+=_[at].dist(_[at+1]),at++;const ft=[];let gt=0;for(;ut<g/2;){const Ct=_[at],At=_[at+1];if(!At)return!1;let kt=_[at-1].angleTo(Ct)-Ct.angleTo(At);for(kt=Math.abs((kt+3*Math.PI)%(2*Math.PI)-Math.PI),ft.push({distance:ut,angleDelta:kt}),gt+=kt;ut-ft[0].distance>_e;)gt-=ft.shift().angleDelta;if(gt>rt)return!1;at++,ut+=Ct.dist(At)}return!0}function n2(_){let o=0;for(let g=0;g<_.length-1;g++)o+=_[g].dist(_[g+1]);return o}function s2(_,o,g){return _?.6*o*g:0}function o2(_,o){return Math.max(_?_.right-_.left:0,o?o.right-o.left:0)}function oM(_,o,g,_e,rt,ot){const at=s2(g,rt,ot),ut=o2(g,_e)*ot;let ft=0;const gt=n2(_)/2;for(let Ct=0;Ct<_.length-1;Ct++){const At=_[Ct],kt=_[Ct+1],zt=At.dist(kt);if(ft+zt>gt){const Ut=(gt-ft)/zt,Kt=fs(At.x,kt.x,Ut),er=fs(At.y,kt.y,Ut),Jt=new g0(Kt,er,0,kt.angleTo(At),Ct);return!at||i2(_,Jt,ut,at,o)?Jt:void 0}ft+=zt}}function aM(_,o,g,_e,rt,ot,at,ut,ft){const gt=s2(_e,ot,at),Ct=o2(_e,rt),At=Ct*at,kt=_[0].x===0||_[0].x===ft||_[0].y===0||_[0].y===ft;return o-At<o/4&&(o=At+o/4),a2(_,kt?o/2*ut%o:(Ct/2+2*ot)*at*ut%o,o,gt,g,At,kt,!1,ft)}function a2(_,o,g,_e,rt,ot,at,ut,ft){const gt=ot/2,Ct=n2(_);let At=0,kt=o-g,zt=[];for(let Ut=0;Ut<_.length-1;Ut++){const Kt=_[Ut],er=_[Ut+1],Jt=Kt.dist(er),or=er.angleTo(Kt);for(;kt+g<At+Jt;){kt+=g;const lr=(kt-At)/Jt,pr=fs(Kt.x,er.x,lr),Sr=fs(Kt.y,er.y,lr);if(pr>=0&&pr<ft&&Sr>=0&&Sr<ft&&kt-gt>=0&&kt+gt<=Ct){const br=new g0(pr,Sr,0,or,Ut);_e&&!i2(_,br,ot,_e,rt)||zt.push(br)}}At+=Jt}return ut||zt.length||at||(zt=a2(_,At/2,g,_e,rt,ot,at,!0,ft)),zt}function l2(_){let o=0,g=0;for(const at of _)o+=at.w*at.h,g=Math.max(g,at.w);_.sort((at,ut)=>ut.h-at.h);const _e=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),g),h:1/0}];let rt=0,ot=0;for(const at of _)for(let ut=_e.length-1;ut>=0;ut--){const ft=_e[ut];if(!(at.w>ft.w||at.h>ft.h)){if(at.x=ft.x,at.y=ft.y,ot=Math.max(ot,at.y+at.h),rt=Math.max(rt,at.x+at.w),at.w===ft.w&&at.h===ft.h){const gt=_e.pop();gt&&ut<_e.length&&(_e[ut]=gt)}else at.h===ft.h?(ft.x+=at.w,ft.w-=at.w):at.w===ft.w?(ft.y+=at.h,ft.h-=at.h):(_e.push({x:ft.x+at.w,y:ft.y,w:ft.w-at.w,h:at.h}),ft.y+=at.h,ft.h-=at.h);break}}return{w:rt,h:ot,fill:o/(rt*ot)||0}}qn(g0,"Anchor");const Y_=1;class P1{static getImagePositionScale(o,g,_e){if(g&&o){const{sx:rt,sy:ot}=o;return{x:rt,y:ot}}return{x:_e,y:_e}}constructor(o,g,_e,rt){this.paddedRect=o;const{pixelRatio:ot,version:at,stretchX:ut,stretchY:ft,content:gt,sdf:Ct,usvg:At}=g;this.pixelRatio=ot,this.stretchX=ut,this.stretchY=ft,this.content=gt,this.version=at,this.padding=_e,this.sdf=Ct,this.usvg=At,this.scale=P1.getImagePositionScale(rt,At,ot)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function wS(_,o,g){const _e=Zp.parse(_),rt=function(ot,at,ut=[1,1]){return{x:0,y:0,w:(ot.data?ot.data.width:ot.width*ut[0])+2*at,h:(ot.data?ot.data.height:ot.height*ut[1])+2*at}}(o,g,[_e.sx,_e.sy]);return{bin:rt,imagePosition:new P1(rt,o,g,_e),imageVariant:_e}}class c2{constructor(o,g,_e){const rt=new Map,ot=new Map;this.haveRenderCallbacks=[];const at=[];this.addImages(o,rt,Y_,at),this.addImages(g,ot,2,at);const{w:ut,h:ft}=l2(at),gt=new yu({width:ut||1,height:ft||1});for(const[Ct,At]of o.entries()){const kt=rt.get(Ct).paddedRect;yu.copy(At.data,gt,{x:0,y:0},{x:kt.x+Y_,y:kt.y+Y_},At.data,null,At.sdf)}for(const[Ct,At]of g.entries()){const kt=ot.get(Ct),zt=kt.paddedRect;let Ut=kt.padding;const Kt=zt.x+Ut,er=zt.y+Ut,Jt=At.data.width,or=At.data.height;Ut=Ut>1?Ut-1:Ut,yu.copy(At.data,gt,{x:0,y:0},{x:Kt,y:er},At.data,_e),yu.copy(At.data,gt,{x:0,y:or-Ut},{x:Kt,y:er-Ut},{width:Jt,height:Ut},_e),yu.copy(At.data,gt,{x:0,y:0},{x:Kt,y:er+or},{width:Jt,height:Ut},_e),yu.copy(At.data,gt,{x:Jt-Ut,y:0},{x:Kt-Ut,y:er},{width:Ut,height:or},_e),yu.copy(At.data,gt,{x:0,y:0},{x:Kt+Jt,y:er},{width:Ut,height:or},_e),yu.copy(At.data,gt,{x:Jt-Ut,y:or-Ut},{x:Kt-Ut,y:er-Ut},{width:Ut,height:Ut},_e),yu.copy(At.data,gt,{x:0,y:or-Ut},{x:Kt+Jt,y:er-Ut},{width:Ut,height:Ut},_e),yu.copy(At.data,gt,{x:0,y:0},{x:Kt+Jt,y:er+or},{width:Ut,height:Ut},_e),yu.copy(At.data,gt,{x:Jt-Ut,y:0},{x:Kt-Ut,y:er+or},{width:Ut,height:Ut},_e)}this.lut=_e,this.image=gt,this.iconPositions=rt,this.patternPositions=ot}addImages(o,g,_e,rt){for(const[ot,at]of o.entries()){const{bin:ut,imagePosition:ft,imageVariant:gt}=wS(ot,at,_e);g.set(ot,ft),rt.push(ut),at.hasRenderCallback&&this.haveRenderCallbacks.push(gt.id)}}patchUpdatedImages(o,g,_e){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(rt=>o.hasImage(rt,_e)),o.dispatchRenderCallbacks(this.haveRenderCallbacks,_e);for(const rt of o.getUpdatedImages(_e)){for(const ot of this.iconPositions.keys()){const at=Zp.parse(ot);if(wu.isEqual(at.id,rt)){const ut=o.getImage(rt,_e);this.patchUpdatedImage(this.iconPositions.get(ot),ut,g,null)}}for(const ot of this.patternPositions.keys()){const at=Zp.parse(ot);if(wu.isEqual(at.id,rt)){const ut=o.getImage(rt,_e);this.patchUpdatedImage(this.patternPositions.get(ot),ut,g,this.lut)}}}}patchUpdatedImage(o,g,_e,rt=null){if(!o||!g||o.version===g.version)return;o.version=g.version;const[ot,at]=o.tl,ut=o.sdf;if(this.lut||ut){const ft={width:g.data.width,height:g.data.height},gt=new yu(ft);yu.copy(g.data,gt,{x:0,y:0},{x:0,y:0},ft,rt,ut),_e.update(gt,{position:{x:ot,y:at}})}else _e.update(g.data,{position:{x:ot,y:at}})}}qn(P1,"ImagePosition"),qn(c2,"ImageAtlas");const k1=1e20;function u2(_,o,g,_e,rt,ot,at,ut,ft){for(let gt=o;gt<o+_e;gt++)h2(_,g*ot+gt,ot,rt,at,ut,ft);for(let gt=g;gt<g+rt;gt++)h2(_,gt*ot+o,1,_e,at,ut,ft)}function h2(_,o,g,_e,rt,ot,at){ot[0]=0,at[0]=-k1,at[1]=k1,rt[0]=_[o];for(let ut=1,ft=0,gt=0;ut<_e;ut++){rt[ut]=_[o+ut*g];const Ct=ut*ut;do{const At=ot[ft];gt=(rt[ut]-rt[At]+Ct-At*At)/(ut-At)/2}while(gt<=at[ft]&&--ft>-1);ft++,ot[ft]=ut,at[ft]=gt,at[ft+1]=k1}for(let ut=0,ft=0;ut<_e;ut++){for(;at[ft+1]<ut;)ft++;const gt=ot[ft],Ct=ut-gt;_[o+ut*g]=rt[gt]+Ct*Ct}}const fm=2,ES={none:0,ideographs:1,all:2};class Fx{constructor(o,g,_e){this.requestManager=o,this.localGlyphMode=g,this.localFontFamily=_e,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o){this.url=o}getGlyphs(o,g){const _e=[],rt=this.url||Us.GLYPHS_URL;for(const ot in o)for(const at of o[ot])_e.push({stack:ot,id:at});Dr(_e,({stack:ot,id:at},ut)=>{let ft=this.entries[ot];ft||(ft=this.entries[ot]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let gt=ft.glyphs[at];if(gt!==void 0)return void ut(null,{stack:ot,id:at,glyph:gt});if(gt=this._tinySDF(ft,ot,at),gt)return ft.glyphs[at]=gt,void ut(null,{stack:ot,id:at,glyph:gt});const Ct=Math.floor(at/256);if(256*Ct>65535)return $n("glyphs > 65535 not supported"),void ut(null,{stack:ot,id:at,glyph:gt});if(ft.ranges[Ct])return void ut(null,{stack:ot,id:at,glyph:gt});let At=ft.requests[Ct];At||(At=ft.requests[Ct]=[],Fx.loadGlyphRange(ot,Ct,rt,this.requestManager,(kt,zt)=>{if(zt){ft.ascender=zt.ascender,ft.descender=zt.descender;for(const Ut in zt.glyphs)this._doesCharSupportLocalGlyph(+Ut)||(ft.glyphs[+Ut]=zt.glyphs[+Ut]);ft.ranges[Ct]=!0}for(const Ut of At)Ut(kt,zt);delete ft.requests[Ct]})),At.push((kt,zt)=>{kt?ut(kt):zt&&ut(null,{stack:ot,id:at,glyph:zt.glyphs[at]||null})})},(ot,at)=>{if(ot)g(ot);else if(at){const ut={};for(const{stack:ft,id:gt,glyph:Ct}of at)ut[ft]===void 0&&(ut[ft]={}),ut[ft].glyphs===void 0&&(ut[ft].glyphs={}),ut[ft].glyphs[gt]=Ct&&{id:Ct.id,bitmap:Ct.bitmap.clone(),metrics:Ct.metrics},ut[ft].ascender=this.entries[ft].ascender,ut[ft].descender=this.entries[ft].descender;g(null,ut)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==ES.none&&(this.localGlyphMode===ES.all?!!this.localFontFamily:!!this.localFontFamily&&(cs["CJK Unified Ideographs"](o)||cs["Hangul Syllables"](o)||cs.Hiragana(o)||cs.Katakana(o)||cs["CJK Symbols and Punctuation"](o)||cs["CJK Unified Ideographs Extension A"](o)||cs["CJK Unified Ideographs Extension B"](o)||cs.Osage(o)))}_tinySDF(o,g,_e){const rt=this.localFontFamily;if(!rt||!this._doesCharSupportLocalGlyph(_e))return;let ot=o.tinySDF;if(!ot){let Kt="400";/bold/i.test(g)?Kt="900":/medium/i.test(g)?Kt="500":/light/i.test(g)&&(Kt="200"),ot=o.tinySDF=new Fx.TinySDF({fontFamily:rt,fontWeight:Kt,fontSize:24*fm,buffer:3*fm,radius:8*fm}),ot.fontWeight=Kt}if(this.localGlyphs[ot.fontWeight][_e])return this.localGlyphs[ot.fontWeight][_e];const at=String.fromCodePoint(_e),{data:ut,width:ft,height:gt,glyphWidth:Ct,glyphHeight:At,glyphLeft:kt,glyphTop:zt,glyphAdvance:Ut}=ot.draw(at);return this.localGlyphs[ot.fontWeight][_e]={id:_e,bitmap:new K0({width:ft,height:gt},ut),metrics:{width:Ct/fm,height:At/fm,left:kt/fm,top:zt/fm-27,advance:Ut/fm,localGlyph:!0}}}}Fx.loadGlyphRange=function(_,o,g,_e,rt){const ot=256*o,at=ot+255,ut=_e.transformRequest(_e.normalizeGlyphsURL(g).replace("{fontstack}",_).replace("{range}",`${ot}-${at}`),l_.Glyphs);Xp(ut,(ft,gt)=>{if(ft)rt(ft);else if(gt){const Ct={},At=function(kt){return new SE(kt).readFields(tM,{})}(gt);for(const kt of At.glyphs)Ct[kt.id]=kt;rt(null,{glyphs:Ct,ascender:At.ascender,descender:At.descender})}})},Fx.TinySDF=class{constructor({fontSize:_=24,buffer:o=3,radius:g=8,cutoff:_e=.25,fontFamily:rt="sans-serif",fontWeight:ot="normal",fontStyle:at="normal",lang:ut=null}={}){this.buffer=o,this.cutoff=_e,this.radius=g,this.lang=ut;const ft=this.size=_+4*o,gt=this._createCanvas(ft),Ct=this.ctx=gt.getContext("2d",{willReadFrequently:!0});Ct.font=`${at} ${ot} ${_}px ${rt}`,Ct.textBaseline="alphabetic",Ct.textAlign="left",Ct.fillStyle="black",this.gridOuter=new Float64Array(ft*ft),this.gridInner=new Float64Array(ft*ft),this.f=new Float64Array(ft),this.z=new Float64Array(ft+1),this.v=new Uint16Array(ft)}_createCanvas(_){const o=document.createElement("canvas");return o.width=o.height=_,o}draw(_){const{width:o,actualBoundingBoxAscent:g,actualBoundingBoxDescent:_e,actualBoundingBoxLeft:rt,actualBoundingBoxRight:ot}=this.ctx.measureText(_),at=Math.ceil(g),ut=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(ot-rt))),ft=Math.min(this.size-this.buffer,at+Math.ceil(_e)),gt=ut+2*this.buffer,Ct=ft+2*this.buffer,At=Math.max(gt*Ct,0),kt=new Uint8ClampedArray(At),zt={data:kt,width:gt,height:Ct,glyphWidth:ut,glyphHeight:ft,glyphTop:at,glyphLeft:0,glyphAdvance:o};if(ut===0||ft===0)return zt;const{ctx:Ut,buffer:Kt,gridInner:er,gridOuter:Jt}=this;this.lang&&(Ut.lang=this.lang),Ut.clearRect(Kt,Kt,ut,ft),Ut.fillText(_,Kt,Kt+at);const or=Ut.getImageData(Kt,Kt,ut,ft);Jt.fill(k1,0,At),er.fill(0,0,At);for(let lr=0;lr<ft;lr++)for(let pr=0;pr<ut;pr++){const Sr=or.data[4*(lr*ut+pr)+3]/255;if(Sr===0)continue;const br=(lr+Kt)*gt+pr+Kt;if(Sr===1)Jt[br]=0,er[br]=k1;else{const Rr=.5-Sr;Jt[br]=Rr>0?Rr*Rr:0,er[br]=Rr<0?Rr*Rr:0}}u2(Jt,0,0,gt,Ct,gt,this.f,this.v,this.z),u2(er,Kt,Kt,ut,ft,gt,this.f,this.v,this.z);for(let lr=0;lr<At;lr++){const pr=Math.sqrt(Jt[lr])-Math.sqrt(er[lr]);kt[lr]=Math.round(255-255*(pr/this.radius+this.cutoff))}return zt}};const Vm=Y_;function d2(_,o){return _+o[1]-o[0]}function TS(_,o,g,_e,rt=1){const ot=[],at=_.imagePrimary,ut=at.pixelRatio,ft=at.paddedRect.w-2*Vm,gt=at.paddedRect.h-2*Vm,Ct=(_.right-_.left)*rt,At=(_.bottom-_.top)*rt,kt=at.stretchX||[[0,ft]],zt=at.stretchY||[[0,gt]],Ut=kt.reduce(d2,0),Kt=zt.reduce(d2,0),er=ft-Ut,Jt=gt-Kt;let or=0,lr=Ut,pr=0,Sr=Kt,br=0,Rr=er,Mr=0,Lr=Jt;if(at.content&&_e){const zr=at.content;or=RE(kt,0,zr[0]),pr=RE(zt,0,zr[1]),lr=RE(kt,zr[0],zr[2]),Sr=RE(zt,zr[1],zr[3]),br=zr[0]-or,Mr=zr[1]-pr,Rr=zr[2]-zr[0]-lr,Lr=zr[3]-zr[1]-Sr}const Jr=(zr,sn,dn,pn)=>{const wn=IE(zr.stretch-or,lr,Ct,_.left*rt),Tn=PE(zr.fixed-br,Rr,zr.stretch,Ut),xn=IE(sn.stretch-pr,Sr,At,_.top*rt),vn=PE(sn.fixed-Mr,Lr,sn.stretch,Kt),nn=IE(dn.stretch-or,lr,Ct,_.left*rt),en=PE(dn.fixed-br,Rr,dn.stretch,Ut),bn=IE(pn.stretch-pr,Sr,At,_.top*rt),Dn=PE(pn.fixed-Mr,Lr,pn.stretch,Kt),Rn=new mn(wn,xn),ts=new mn(nn,xn),Vn=new mn(nn,bn),Hn=new mn(wn,bn),Zn=new mn(Tn/ut,vn/ut),js=new mn(en/ut,Dn/ut),In=o*Math.PI/180;if(In){const vo=Math.sin(In),wr=Math.cos(In),Cr=[wr,-vo,vo,wr];Rn._matMult(Cr),ts._matMult(Cr),Hn._matMult(Cr),Vn._matMult(Cr)}const Yn=zr.stretch+zr.fixed,xs=dn.stretch+dn.fixed,Gs=sn.stretch+sn.fixed,Ws=pn.stretch+pn.fixed,Rs=_.imageSecondary;return{tl:Rn,tr:ts,bl:Hn,br:Vn,texPrimary:{x:at.paddedRect.x+Vm+Yn,y:at.paddedRect.y+Vm+Gs,w:xs-Yn,h:Ws-Gs},texSecondary:Rs?{x:Rs.paddedRect.x+Vm+Yn,y:Rs.paddedRect.y+Vm+Gs,w:xs-Yn,h:Ws-Gs}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zn,pixelOffsetBR:js,minFontScaleX:Rr/ut/Ct,minFontScaleY:Lr/ut/At,isSDF:g}};if(_e&&(at.stretchX||at.stretchY)){const zr=p2(kt,er,Ut),sn=p2(zt,Jt,Kt);for(let dn=0;dn<zr.length-1;dn++){const pn=zr[dn],wn=zr[dn+1];for(let Tn=0;Tn<sn.length-1;Tn++)ot.push(Jr(pn,sn[Tn],wn,sn[Tn+1]))}}else ot.push(Jr({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:ft+1},{fixed:0,stretch:gt+1}));return ot}function lM(_,o){const g=_.stretchY||[[0,_.paddedRect.h-2*Vm]];return o&&(_.stretchX||_.stretchY)?f2(_.stretchX||[[0,_.paddedRect.w-2*Vm]])*f2(g):1}function RE(_,o,g){let _e=0;for(const rt of _)_e+=Math.max(o,Math.min(g,rt[1]))-Math.max(o,Math.min(g,rt[0]));return _e}function p2(_,o,g){const _e=[{fixed:-Vm,stretch:0}];for(const[rt,ot]of _){const at=_e[_e.length-1];_e.push({fixed:rt-at.stretch,stretch:at.stretch}),_e.push({fixed:rt-at.stretch,stretch:at.stretch+(ot-rt)})}return _e.push({fixed:o+Vm,stretch:g}),_e}function f2(_){return 2*_.length+1}function IE(_,o,g,_e){return _/o*g+_e}function PE(_,o,g,_e){return _-o*g/_e}function cM(_,o,g,_e){const rt=o+_.positionedLines[_e].lineOffset;return _e===0?g+rt/2:g+(rt+(o+_.positionedLines[_e-1].lineOffset))/2}function uM(_,o=1,g=!1){let _e=1/0,rt=1/0,ot=-1/0,at=-1/0;const ut=_[0];for(let zt=0;zt<ut.length;zt++){const Ut=ut[zt];(!zt||Ut.x<_e)&&(_e=Ut.x),(!zt||Ut.y<rt)&&(rt=Ut.y),(!zt||Ut.x>ot)&&(ot=Ut.x),(!zt||Ut.y>at)&&(at=Ut.y)}const ft=Math.min(ot-_e,at-rt);let gt=ft/2;const Ct=new Cy([],hM);if(ft===0)return new mn(_e,rt);for(let zt=_e;zt<ot;zt+=ft)for(let Ut=rt;Ut<at;Ut+=ft)Ct.push(new Bx(zt+gt,Ut+gt,gt,_));let At=function(zt){let Ut=0,Kt=0,er=0;const Jt=zt[0];for(let or=0,lr=Jt.length,pr=lr-1;or<lr;pr=or++){const Sr=Jt[or],br=Jt[pr],Rr=Sr.x*br.y-br.x*Sr.y;Kt+=(Sr.x+br.x)*Rr,er+=(Sr.y+br.y)*Rr,Ut+=3*Rr}return new Bx(Kt/Ut,er/Ut,0,zt)}(_),kt=Ct.length;for(;Ct.length;){const zt=Ct.pop();(zt.d>At.d||!At.d)&&(At=zt,g&&console.log("found best %d after %d probes",Math.round(1e4*zt.d)/1e4,kt)),zt.max-At.d<=o||(gt=zt.h/2,Ct.push(new Bx(zt.p.x-gt,zt.p.y-gt,gt,_)),Ct.push(new Bx(zt.p.x+gt,zt.p.y-gt,gt,_)),Ct.push(new Bx(zt.p.x-gt,zt.p.y+gt,gt,_)),Ct.push(new Bx(zt.p.x+gt,zt.p.y+gt,gt,_)),kt+=4)}return g&&(console.log(`num probes: ${kt}`),console.log(`best distance: ${At.d}`)),At.p}function hM(_,o){return o.max-_.max}class Bx{constructor(o,g,_e,rt){this.p=new mn(o,g),this.h=_e,this.d=function(ot,at){let ut=!1,ft=1/0;for(let gt=0;gt<at.length;gt++){const Ct=at[gt];for(let At=0,kt=Ct.length,zt=kt-1;At<kt;zt=At++){const Ut=Ct[At],Kt=Ct[zt];Ut.y>ot.y!=Kt.y>ot.y&&ot.x<(Kt.x-Ut.x)*(ot.y-Ut.y)/(Kt.y-Ut.y)+Ut.x&&(ut=!ut),ft=Math.min(ft,_l(ot,Ut,Kt))}}return(ut?1:-1)*Math.sqrt(ft)}(this.p,rt),this.max=this.d+this.h*Math.SQRT2}}const dM=Object.keys,SS=Number.POSITIVE_INFINITY,pM=Math.sqrt(2);function Z0(_,o,g,_e,rt){const ot=xS(_)&&_.collisionPadding?_.collisionPadding:[0,0,0,0],at={top:_.top-ot[1],bottom:_.bottom+ot[3],left:_.left-ot[0],right:_.right+ot[2],scaled:!1};return _e!==void 0&&function(ut,ft){ut.top*=ft,ut.bottom*=ft,ut.left*=ft,ut.right*=ft,ut.scaled=!0}(at,_e),g&&function(ut,ft){if(!ft)return;const gt=Fs(ft),Ct=new mn(ut.left,ut.top),At=new mn(ut.right,ut.top),kt=new mn(ut.left,ut.bottom),zt=new mn(ut.right,ut.bottom),Ut=new mn(0,0);Ct._rotateAround(gt,Ut),At._rotateAround(gt,Ut),kt._rotateAround(gt,Ut),zt._rotateAround(gt,Ut),ut.left=Math.min(Ct.x,At.x,kt.x,zt.x),ut.right=Math.max(Ct.x,At.x,kt.x,zt.x),ut.top=Math.min(Ct.y,At.y,kt.y,zt.y),ut.bottom=Math.max(Ct.y,At.y,kt.y,zt.y)}(at,g),rt&&(at.left+=rt[0],at.right+=rt[0],at.top+=rt[1],at.bottom+=rt[1]),o?{top:Math.min(o.top,at.top),bottom:Math.max(o.bottom,at.bottom),left:Math.min(o.left,at.left),right:Math.max(o.right,at.right),scaled:o.scaled||at.scaled}:at}function m2(_,[o,g]){let _e=0,rt=0;if(g===SS){o<0&&(o=0);const ot=o/pM;switch(_){case"top-right":case"top-left":rt=ot-7;break;case"bottom-right":case"bottom-left":rt=7-ot;break;case"bottom":rt=7-o;break;case"top":rt=o-7}switch(_){case"top-right":case"bottom-right":_e=-ot;break;case"top-left":case"bottom-left":_e=ot;break;case"left":_e=o;break;case"right":_e=-o}}else{switch(o=Math.abs(o),g=Math.abs(g),_){case"top-right":case"top-left":case"top":rt=g-7;break;case"bottom-right":case"bottom-left":case"bottom":rt=7-g}switch(_){case"top-right":case"bottom-right":case"right":_e=-o;break;case"top-left":case"bottom-left":case"left":_e=o}}return[_e,rt]}function fM(_,o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt){const Ut=_.layers[0],Kt=Ut.appearances;if(Kt.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const er={iconBBox:null,iconVerticalBBox:null},Jt={textBBox:null,textVerticalBBox:null},{baseIconRotate:or,baseTextRotate:lr,iconScaleFactor:pr}=function(br,Rr,Mr){const Lr=br.get("icon-rotate").evaluate(Rr,{},Mr),Jr=br.get("text-rotate").evaluate(Rr,{},Mr),[zr,sn]=br.get("icon-size-scale-range");return{baseIconRotate:Lr,baseTextRotate:Jr,iconScaleFactor:tr(1,zr,sn)}}(_e,rt,ot);o&&(er.iconBBox=Z0(o,er.iconBBox,or,at),g)&&(er.iconVerticalBBox=Z0(g,er.iconVerticalBBox,or+90,at));const Sr=ME(At.horizontal);Sr&&(Jt.textBBox=Z0(Sr,Jt.textBBox,lr,1,zt)),At.vertical&&(Jt.textVerticalBBox=Z0(At.vertical,Jt.textVerticalBBox,lr+90,1,zt));for(const br of Kt)br.hasIconProperties()&&mM(er,_,Ut,br,rt,ot,ut,or,at,ft,o,gt,pr,Ct),br.hasTextProperties()&&gM(Jt,Ut,br,rt,ot,zt,lr,kt,Sr,At.vertical);return{iconBBox:er.iconBBox,iconVerticalBBox:er.iconVerticalBBox,textBBox:Jt.textBBox,textVerticalBBox:Jt.textVerticalBBox}}function mM(_,o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt){const{appearanceIconOffset:Ut,appearanceIconRotate:Kt,appearanceIconSize:er}=function(pr,Sr,br,Rr,Mr,Lr,Jr,zr){const sn=pr.hasProperty("icon-offset")?Sr.getAppearanceValueAndResolveTokens(pr,"icon-offset",br,Rr,[]):null,dn=sn&&Array.isArray(sn)?sn:Mr,pn=pr.hasProperty("icon-rotate")?Sr.getAppearanceValueAndResolveTokens(pr,"icon-rotate",br,Rr,[]):null,wn=typeof pn=="number"?pn:Lr,Tn=pr.hasProperty("icon-size")?Sr.getAppearanceValueAndResolveTokens(pr,"icon-size",br,Rr,[]):null;return{appearanceIconOffset:dn,appearanceIconRotate:wn,appearanceIconSize:typeof Tn=="number"?Tn*zr.iconScaleFactor:Jr}}(_e,g,rt,ot,at,ut,ft,gt);let Jt=null,or=null,lr=null;_e.hasProperty("icon-image")?lr=function(pr,Sr,br,Rr,Mr,Lr,Jr){let zr=null;const sn=Sr.getAppearanceValueAndResolveTokens(br,"icon-image",Rr,Mr,[]);if(sn){const dn=pr.getResolvedImageFromTokens(sn),pn=br.getUnevaluatedProperty("icon-size"),wn=M1(dn,Ox(pr.zoom,pn,pr.worldview),pn,Mr,pr.zoom,Rr,pr.pixelRatio,Jr,pr.worldview);zr=Lr.get(wn.iconPrimary.toString())}return zr}(o,g,_e,rt,ot,At,kt):Ct&&(lr=Ct.imagePrimary),lr&&(Jt=AE(lr,null,Ut,zt),o.allowVerticalPlacement&&(or=AE(lr,null,Ut,zt))),Jt&&(_.iconBBox=Z0(Jt,_.iconBBox,Kt,er)),or&&(_.iconVerticalBBox=Z0(or,_.iconVerticalBBox,Kt+90,er))}function gM(_,o,g,_e,rt,ot,at,ut,ft,gt){const{appearanceTextOffset:Ct,appearanceTextRotate:At,appearanceTextSize:kt}=function(Ut,Kt,er,Jt,or,lr,pr){const Sr=Ut.hasProperty("text-offset")?Kt.getAppearanceValueAndResolveTokens(Ut,"text-offset",er,Jt,[]):null,br=Sr&&Array.isArray(Sr)?[Sr[0]*Yl,Sr[1]*Yl]:or,Rr=Ut.hasProperty("text-rotate")?Kt.getAppearanceValueAndResolveTokens(Ut,"text-rotate",er,Jt,[]):null,Mr=typeof Rr=="number"?Rr:lr,Lr=Ut.hasProperty("text-size")?Kt.getAppearanceValueAndResolveTokens(Ut,"text-size",er,Jt,[]):null;return{appearanceTextOffset:br,appearanceTextRotate:Mr,appearanceTextSize:typeof Lr=="number"?Lr:pr}}(g,o,_e,rt,ot,at,ut),zt=kt/ut;ft&&(_.textBBox=Z0(ft,_.textBBox,At,zt,Ct)),gt&&(_.textVerticalBBox=Z0(gt,_.textVerticalBBox,At+90,zt,Ct))}function kE(_,o,g,_e,rt,ot,at,ut,ft){if(!o||!o.usvg)return;const gt=r2(_e),Ct=r2(rt),At=ot!=="both"&&ot!=="width"||!e2(_e)?1:Ct.width/gt.width,kt=ot!=="both"&&ot!=="height"||!t2(_e)?1:Ct.height/gt.height;g.scaleSelf(At,kt);const zt=g.toString();at.set(zt,g),ut.set(zt,o);const{imagePosition:Ut}=wS(zt,o,Y_);ft.set(zt,Ut)}function g2(_,o,g,_e,rt,ot,at,ut,ft){if(!_)return;const gt=function(Ct,At,kt,zt,Ut,Kt){if(Ct.kind==="camera")return Ct.maxSize;if(Ct.kind==="composite"){const er=At.possiblyEvaluate(new Do(Ct.maxZoom,{worldview:Kt}),kt).evaluate(Ut,{},kt),Jt=At.possiblyEvaluate(new Do(Ct.minZoom,{worldview:Kt}),kt).evaluate(Ut,{},kt);return Math.max(er,Jt)}return At.possiblyEvaluate(new Do(zt,{worldview:Kt})).evaluate(Ut,{},kt)}(o,g,_e,rt,ot,ft);return _.scaleSelf(gt*ut*at)}function M1(_,o,g,_e,rt,ot,at,ut,ft){return{iconPrimary:g2(_.getPrimary(),o,g,_e,rt,ot,at,ut,ft),iconSecondary:g2(_.getSecondary(),o,g,_e,rt,ot,at,ut,ft)}}function _M(_,o,g){if(!o)return;const _e=g.get(_.toString()),rt=g.get(o.toString());_e&&rt&&(_e.paddedRect.w===rt.paddedRect.w&&_e.paddedRect.h===rt.paddedRect.h||$n(`Mismatch in icon variant sizes: ${_.toString()} and ${o.toString()}`),_e.usvg!==rt.usvg&&$n(`Mismatch in icon variant image types: ${_.id} and ${o.id}`))}function _2(_,o,g,_e){if(!_)return;const rt=o.get(g.toString());if(_.imagePrimary=rt,_e){const ot=o.get(_e.toString());_.imageSecondary=ot}}function yM(_,o){for(const g in _.horizontal)y2(_.horizontal[g],o);y2(_.vertical,o)}function y2(_,o){if(_){for(const g of _.positionedLines)for(const _e of g.positionedGlyphs)if(_e.image!==null){const rt=_e.image.toString();_e.rect=o.get(rt).paddedRect}}}function CS(_){switch(_){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function xM(_,o,g,_e,rt,ot,at,ut,ft){const gt=ME(ot.horizontal)||ot.vertical,Ct=g.get("icon-text-fit-padding").evaluate(_e,{},rt);let At,kt=o;return o&&ft!=="none"&&(_.allowVerticalPlacement&&ot.vertical&&(At=vS(o,ot.vertical,ft,Ct,ut,at)),gt&&(kt=vS(o,gt,ft,Ct,ut,at))),{defaultShapedIcon:kt,verticallyShapedIcon:At}}function vM(_,o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt,Ut,Kt,er,Jt,or,lr,pr,Sr,br,Rr){let Mr=at.textMaxSize.evaluate(o,{},kt);Mr===void 0?Mr=ut*at.textScaleFactor:Mr*=at.textScaleFactor;const Lr=_.layers[0].layout,Jr=Yl,zr=ut*at.textScaleFactor/Jr,sn=ME(g.horizontal)||g.vertical;if(er!=="none"&&_.appearanceFeatureData&&o.index<_.appearanceFeatureData.length){const Vn=_.appearanceFeatureData[o.index];Vn&&(Vn.textShaping=sn,Vn.iconTextFitPadding=Lr.get("icon-text-fit-padding").evaluate(o,{},kt),Vn.fontScale=zr)}const dn=zt.name==="globe",pn=_.tilePixelRatio*Mr/Jr,wn=(bn=_.overscaling,_.zoom>18&&bn>2&&(bn>>=1),Math.max(Mn/(512*bn),1)*Lr.get("symbol-spacing")),Tn=Lr.get("text-padding")*_.tilePixelRatio,xn=Lr.get("icon-padding")*_.tilePixelRatio,vn=Fs(Lr.get("text-max-angle")),nn=Lr.get("icon-rotation-alignment")==="map"&&lr!=="point",en=wn/2;var bn;_.hasAnyIconTextFit===!1&&er!=="none"&&(_.hasAnyIconTextFit=!0);const Dn=o.properties?+o.properties[tn]:null,Rn=Dn&&_.elevationFeatureIdToIndex?_.elevationFeatureIdToIndex.get(Dn):65535,ts=(Vn,Hn,Zn)=>{if(Hn.x<0||Hn.x>=Mn||Hn.y<0||Hn.y>=Mn)return;let js=null;if(dn){const{x:In,y:Yn,z:xs}=zt.projectTilePoint(Hn.x,Hn.y,Zn);js={anchor:new g0(In,Yn,xs,0,void 0),up:zt.upVector(Zn,Hn.x,Hn.y)}}(function(In,Yn,xs,Gs,Ws,Rs,vo,wr,Cr,on,En,Fn,Bn,rs,ss,Ts,Ns,Os,zs,ds,ys,Qs,io,no,go,Ao,bo,oo,ho,Ls,Hs,$o,us){const Vs=In.addToLineVertexArray(Yn,Gs);let Eo,Io,No,El,ko,hs,qo,_o=0,zo=0,Vl=0,Ql=0,Dl=-1,Nl=-1;const Wl={};let Fu=fy("");const Mo=xs?xs.anchor:Yn,yl=oo!=="none";let Tl=0,Uu=0;if(Cr._unevaluatedLayout.getValue("text-radial-offset")===void 0){const uu=Cr.layout.get("text-offset").evaluate(ys,{},go);Tl=uu[0]*Yl,Uu=uu[1]*Yl}else Tl=Cr.layout.get("text-radial-offset").evaluate(ys,{},go)*Yl,Uu=SS;if(In.allowVerticalPlacement&&Ws.vertical){const uu=Ws.vertical;if(ss)hs=AS(uu),wr&&(qo=AS(wr));else{const ku=Cr.layout.get("text-rotate").evaluate(ys,{},go)+90;No=DE(on,Mo,Yn,En,Fn,Bn,uu,rs,ku,Ts,$o),wr&&(El=DE(on,Mo,Yn,En,Fn,Bn,wr,Os,ku,null,Hs))}}if(Rs){const uu=In.iconSizeData,ku=Cr.layout.get("icon-rotate").evaluate(ys,{},go),Ju=TS(Rs,ku,io,yl,Qs.iconScaleFactor),J0=wr?TS(wr,ku,io,yl,Qs.iconScaleFactor):void 0;Io=DE(on,Mo,Yn,En,Fn,Bn,Rs,Os,ku,null,Ls);const Wx=function(ym,Z1,jR,MD,FR,BR,DD,ND){const zR=ym.layers[0],VR=zR.appearances;let qx=Z1.length;if(jR&&(qx=Math.max(qx,jR.length)),VR.length===0)return qx;const[LD,OD]=MD.get("icon-size-scale-range"),jD=tr(1,LD,OD);for(const UR of VR){const $R=UR.getUnevaluatedProperties();if($R._values["icon-image"].value!==void 0){const GR=zR.getAppearanceValueAndResolveTokens(UR,"icon-image",FR,BR,[]);if(GR){const HR=ym.getResolvedImageFromTokens(GR);if(HR){const WR=$R._values["icon-size"],FD=M1(HR,Ox(ym.zoom,WR,ym.worldview),WR,BR,ym.zoom,FR,ym.pixelRatio,jD,ym.worldview),BD=DD.get(FD.iconPrimary.toString());qx=Math.max(qx,lM(BD,ND))}}}}return qx}(In,Ju,J0,Cr.layout,ys,go,In.iconAtlasPositions,yl);_o=4*Wx;let _m=null;uu.kind==="source"?(_m=[pm*Cr.layout.get("icon-size").evaluate(ys,{},go)*Qs.iconScaleFactor],_m[0]>_0&&$n(`${In.layerIds[0]}: Value for "icon-size" is >= ${D1}. Reduce your "icon-size".`)):uu.kind==="composite"&&(_m=[pm*Qs.compositeIconSizes[0].evaluate(ys,{},go)*Qs.iconScaleFactor,pm*Qs.compositeIconSizes[1].evaluate(ys,{},go)*Qs.iconScaleFactor],(_m[0]>_0||_m[1]>_0)&&$n(`${In.layerIds[0]}: Value for "icon-size" is >= ${D1}. Reduce your "icon-size".`)),In.addSymbols(In.icon,Ju,_m,ds,zs,ys,void 0,xs,Yn,Vs.lineStartIndex,Vs.lineLength,-1,no,go,Ao,bo,In.symbolInstances.length,Wx),Dl=In.icon.placedSymbolArray.length-1,J0&&(zo=4*Wx,In.addSymbols(In.icon,J0,_m,ds,zs,ys,Qu.vertical,xs,Yn,Vs.lineStartIndex,Vs.lineLength,-1,no,go,Ao,bo,In.symbolInstances.length,Wx),Nl=In.icon.placedSymbolArray.length-1)}for(const uu in Ws.horizontal){const ku=uu,Ju=Ws.horizontal[ku];Eo||(Fu=fy(Ju.text),ss?ko=AS(Ju):Eo=DE(on,Mo,Yn,En,Fn,Bn,Ju,rs,Cr.layout.get("text-rotate").evaluate(ys,{},go),Ts,$o));const J0=Ju.positionedLines.length===1;if(Vl+=x2(In,xs,Yn,Ju,vo,Cr,ss,ys,Ts,Vs,Ws.vertical?Qu.horizontal:Qu.horizontalOnly,J0?dM(Ws.horizontal):[ku],Wl,Dl,Qs,no,go,In.symbolInstances.length,Ao),J0)break}Ws.vertical&&(Ql+=x2(In,xs,Yn,Ws.vertical,vo,Cr,ss,ys,Ts,Vs,Qu.vertical,["vertical"],Wl,Nl,Qs,no,go,In.symbolInstances.length,Ao));let Ul=-1;const Wp=(uu,ku)=>uu?Math.max(uu,ku):ku;Ul=Wp(ko,Ul),Ul=Wp(hs,Ul),Ul=Wp(qo,Ul);const Um=Ul>-1?1:0;In.glyphOffsetArray.length>=65535&&$n("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ys.sortKey!==void 0&&In.addToSortKeyRanges(In.symbolInstances.length,ys.sortKey),In.symbolInstances.emplaceBack(Yn.x,Yn.y,Mo.x,Mo.y,Mo.z,Wl.right>=0?Wl.right:-1,Wl.center>=0?Wl.center:-1,Wl.left>=0?Wl.left:-1,Wl.vertical>=0?Wl.vertical:-1,Dl,Nl,Fu,Eo!==void 0?Eo:In.collisionBoxArray.length,Eo!==void 0?Eo+1:In.collisionBoxArray.length,No!==void 0?No:In.collisionBoxArray.length,No!==void 0?No+1:In.collisionBoxArray.length,Io!==void 0?Io:In.collisionBoxArray.length,Io!==void 0?Io+1:In.collisionBoxArray.length,El||In.collisionBoxArray.length,El?El+1:In.collisionBoxArray.length,En,Vl,Ql,_o,zo,Um,0,Tl,Uu,Ul,0,yl?1:0,ho)})(_,Hn,js,Vn,g,_e,ot,rt,_.layers[0],_.collisionBoxArray,o.index,o.sourceLayerIndex,_.index,Tn,or,gt,0,xn,nn,Jt,o,at,Ct,At,kt,Ut,Kt,er,Rn,pr,Sr,br)};if(lr==="line")for(const Vn of fE(o.geometry,0,0,Mn,Mn)){const Hn=aM(Vn,wn,vn,g.vertical||sn,_e,Jr,pn,_.overscaling,Mn);for(const Zn of Hn)sn&&bM(_,sn.text,en,Zn)||ts(Vn,Zn,kt)}else if(lr==="line-center"){for(const Vn of o.geometry)if(Vn.length>1){const Hn=oM(Vn,vn,g.vertical||sn,_e,Jr,pn);Hn&&ts(Vn,Hn,kt)}}else if(o.type==="Polygon")for(const Vn of m1(o.geometry,0)){const Hn=uM(Vn,16);ts(Vn[0],new g0(Hn.x,Hn.y,0,0,void 0),kt)}else if(o.type==="LineString")for(const Vn of o.geometry)ts(Vn,new g0(Vn[0].x,Vn[0].y,0,0,void 0),kt);else if(o.type==="Point")for(const Vn of o.geometry)for(const Hn of Vn)ts([Hn],new g0(Hn.x,Hn.y,0,0,void 0),kt)}const D1=255,_0=D1*pm;function x2(_,o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt,Ut,Kt,er,Jt,or){const lr=function(br,Rr,Mr,Lr,Jr,zr,sn,dn){const pn=[];if(Rr.positionedLines.length===0)return pn;const wn=Lr.layout.get("text-rotate").evaluate(zr,{})*Math.PI/180,Tn=function(bn){const Dn=bn[0],Rn=bn[1],ts=Dn*Rn;return ts>0?[Dn,-Rn]:ts<0?[-Dn,Rn]:Dn===0?[Rn,Dn]:[Rn,-Dn]}(Mr);let xn=Math.abs(Rr.top-Rr.bottom);for(const bn of Rr.positionedLines)xn-=bn.lineOffset;const vn=Rr.positionedLines.length,nn=xn/vn;let en=Rr.top-Mr[1];for(let bn=0;bn<vn;++bn){const Dn=Rr.positionedLines[bn];en=cM(Rr,nn,en,bn);for(const Rn of Dn.positionedGlyphs){if(!Rn.rect)continue;const ts=Rn.rect||{};let Vn=KA+1,Hn=!0,Zn=1,js=0;if(Rn.image){const Ns=sn.get(Rn.image.toString());if(!Ns)continue;if(Ns.sdf){$n("SDF images are not supported in formatted text and will be ignored.");continue}Hn=!1,Zn=Ns.pixelRatio,Vn=Y_/Zn}const In=(Jr||dn)&&Rn.vertical,Yn=Rn.metrics.advance*Rn.scale/2,xs=Rn.metrics,Gs=Rn.rect;if(Gs===null)continue;dn&&Rr.verticalizable&&(js=Rn.image?Yn-Rn.metrics.width*Rn.scale/2:0);const Ws=Jr?[Rn.x+Yn,Rn.y]:[0,0];let Rs=[0,0],vo=[0,0],wr=!1;Jr||(In?(vo=[Rn.x+Yn+Tn[0],Rn.y+Tn[1]-js],wr=!0):Rs=[Rn.x+Yn+Mr[0],Rn.y+Mr[1]-js]);const Cr=Gs.w*Rn.scale/(Zn*(Rn.localGlyph?fm:1)),on=Gs.h*Rn.scale/(Zn*(Rn.localGlyph?fm:1));let En,Fn,Bn,rs;if(In){const Ns=Rn.y-en,Os=new mn(-Yn,Yn-Ns),zs=-Math.PI/2,ds=new mn(...vo);En=new mn(-Yn+Rs[0],Rs[1]),En._rotateAround(zs,Os)._add(ds),En.x+=-Ns+Yn,En.y-=(xs.left-Vn)*Rn.scale;const ys=Rn.image?xs.advance*Rn.scale:Yl*Rn.scale,Qs=String.fromCodePoint(Rn.glyph);HP(Qs)?En.x+=(1-Vn)*Rn.scale:WP(Qs)?En.x+=ys-xs.height*Rn.scale+(-Vn-1)*Rn.scale:En.x+=Rn.image||xs.width+2*Vn===Gs.w&&xs.height+2*Vn===Gs.h?(ys-on)/2:(ys-(xs.height+2*Vn)*Rn.scale)/2,Fn=new mn(En.x,En.y-Cr),Bn=new mn(En.x+on,En.y),rs=new mn(En.x+on,En.y-Cr)}else{const Ns=(xs.left-Vn)*Rn.scale-Yn+Rs[0],Os=(-xs.top-Vn)*Rn.scale+Rs[1],zs=Ns+Cr,ds=Os+on;En=new mn(Ns,Os),Fn=new mn(zs,Os),Bn=new mn(Ns,ds),rs=new mn(zs,ds)}if(wn){let Ns;Ns=Jr?new mn(0,0):wr?new mn(Tn[0],Tn[1]):new mn(Mr[0],Mr[1]),En._rotateAround(wn,Ns),Fn._rotateAround(wn,Ns),Bn._rotateAround(wn,Ns),rs._rotateAround(wn,Ns)}const ss=new mn(0,0),Ts=new mn(0,0);pn.push({tl:En,tr:Fn,bl:Bn,br:rs,texPrimary:ts,texSecondary:void 0,writingMode:Rr.writingMode,glyphOffset:Ws,sectionIndex:Rn.sectionIndex,isSDF:Hn,pixelOffsetTL:ss,pixelOffsetBR:Ts,minFontScaleX:0,minFontScaleY:0})}}return pn}(0,_e,ft,ot,at,ut,rt,_.allowVerticalPlacement),pr=_.textSizeData;let Sr=null;pr.kind==="source"?(Sr=[pm*ot.layout.get("text-size").evaluate(ut,{},er)*Ut.textScaleFactor],Sr[0]>_0&&$n(`${_.layerIds[0]}: Value for "text-size" is >= ${D1}. Reduce your "text-size".`)):pr.kind==="composite"&&(Sr=[pm*Ut.compositeTextSizes[0].evaluate(ut,{},er)*Ut.textScaleFactor,pm*Ut.compositeTextSizes[1].evaluate(ut,{},er)*Ut.textScaleFactor],(Sr[0]>_0||Sr[1]>_0)&&$n(`${_.layerIds[0]}: Value for "text-size" is >= ${D1}. Reduce your "text-size".`)),_.addSymbols(_.text,lr,Sr,ft,at,ut,Ct,o,g,gt.lineStartIndex,gt.lineLength,zt,Kt,er,or,!1,Jt,lr.length);for(const br of At)kt[br]=_.text.placedSymbolArray.length-1;return 4*lr.length}function ME(_){for(const o in _)return _[o];return null}function DE(_,o,g,_e,rt,ot,at,ut,ft,gt,Ct){let At,kt,zt,Ut;if(At=Ct?Ct.top:at.top,kt=Ct?Ct.bottom:at.bottom,zt=Ct?Ct.left:at.left,Ut=Ct?Ct.right:at.right,xS(at)&&at.collisionPadding){const Kt=at.collisionPadding;zt-=Kt[0],At-=Kt[1],Ut+=Kt[2],kt+=Kt[3]}if(ft){const Kt=new mn(zt,At),er=new mn(Ut,At),Jt=new mn(zt,kt),or=new mn(Ut,kt),lr=Fs(ft);let pr=new mn(0,0);gt&&(pr=new mn(gt[0],gt[1])),Kt._rotateAround(lr,pr),er._rotateAround(lr,pr),Jt._rotateAround(lr,pr),or._rotateAround(lr,pr),zt=Math.min(Kt.x,er.x,Jt.x,or.x),Ut=Math.max(Kt.x,er.x,Jt.x,or.x),At=Math.min(Kt.y,er.y,Jt.y,or.y),kt=Math.max(Kt.y,er.y,Jt.y,or.y)}return _.emplaceBack(o.x,o.y,o.z,g.x,g.y,zt,At,Ut,kt,ut,_e,rt,ot),_.length-1}function AS(_){xS(_)&&_.collisionPadding&&(_.top-=_.collisionPadding[1],_.bottom+=_.collisionPadding[3]);const o=_.bottom-_.top;return o>0?Math.max(10,o):null}function bM(_,o,g,_e){const rt=_.compareText;if(o in rt){const ot=rt[o];for(let at=ot.length-1;at>=0;at--)if(_e.dist(ot[at])<g)return!0}else rt[o]=[];return rt[o].push(_e),!1}function v2(_,o){const g=_.fovAboveCenter,_e=_.elevation?_.elevation.getMinElevationBelowMSL()*o:0,rt=(_._camera.position[2]*_.worldSize-_e)/Math.cos(_._pitch),ot=Math.sin(g)*rt/Math.sin(Math.max(Math.PI/2-_._pitch-g,.01));let at=Math.sin(_._pitch)*ot+rt;const ut=rt*(1/_._horizonShift);if(!_.elevation||_.elevation.exaggeration()===0){let ft=Math.max(_.zoom-17,0);_.isOrthographic&&(ft/=10),at*=1+ft}return Math.min(1.01*at,ut)}function N1(_,o){if(!o.isReprojectedInTileSpace)return{scale:1<<_.z,x:_.x,y:_.y,x2:_.x+1,y2:_.y+1,projection:o};const g=Math.pow(2,-_.z),_e=_.x*g,rt=(_.x+1)*g,ot=_.y*g,at=(_.y+1)*g,ut=Mt(_e),ft=Mt(rt),gt=Ht(ot),Ct=Ht(at),At=o.project(ut,gt),kt=o.project(ft,gt),zt=o.project(ft,Ct),Ut=o.project(ut,Ct);let Kt=Math.min(At.x,kt.x,zt.x,Ut.x),er=Math.min(At.y,kt.y,zt.y,Ut.y),Jt=Math.max(At.x,kt.x,zt.x,Ut.x),or=Math.max(At.y,kt.y,zt.y,Ut.y);const lr=g/16;function pr(br,Rr,Mr,Lr,Jr,zr){const sn=(Mr+Jr)/2,dn=(Lr+zr)/2,pn=o.project(Mt(sn),Ht(dn)),wn=Math.max(0,Kt-pn.x,er-pn.y,pn.x-Jt,pn.y-or);Kt=Math.min(Kt,pn.x),Jt=Math.max(Jt,pn.x),er=Math.min(er,pn.y),or=Math.max(or,pn.y),wn>lr&&(pr(br,pn,Mr,Lr,sn,dn),pr(pn,Rr,sn,dn,Jr,zr))}pr(At,kt,_e,ot,rt,ot),pr(kt,zt,rt,ot,rt,at),pr(zt,Ut,rt,at,_e,at),pr(Ut,At,_e,at,_e,ot),Kt-=lr,er-=lr,Jt+=lr,or+=lr;const Sr=1/Math.max(Jt-Kt,or-er);return{scale:Sr,x:Kt*Sr,y:er*Sr,x2:Jt*Sr,y2:or*Sr,projection:o}}function b2(_,{x:o,y:g},_e=0){return new mn(((o-_e)*_.scale-_.x)*Mn,(g*_.scale-_.y)*Mn)}const wM=Gt(new Float32Array(16));class Y0{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,g){return{x:0,y:0,z:0}}unproject(o,g){return new $(0,0)}projectTilePoint(o,g,_e){return{x:o,y:g,z:0}}locationPoint(o,g,_e,rt=!0){return o._coordinatePoint(o.locationCoordinate(g,_e),rt)}pixelsPerMeter(o,g){return Pt(1,o)*g}pixelSpaceConversion(o,g,_e){return 1}farthestPixelDistance(o){return v2(o,o.pixelsPerMeter)}pointCoordinate(o,g,_e,rt){const ot=o.horizonLineFromTop(!1),at=new mn(g,Math.max(ot,_e));return o.rayIntersectionCoordinate(o.pointRayIntersection(at,rt))}pointCoordinate3D(o,g,_e){const rt=new mn(g,_e);if(o.elevation)return o.elevation.pointCoordinate(rt);{const ot=this.pointCoordinate(o,rt.x,rt.y,0);return[ot.x,ot.y,ot.z]}}isPointAboveHorizon(o,g){if(o.elevation&&o.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(o,g.x,g.y);const _e=o.horizonLineFromTop();return g.y<_e}createInversionMatrix(o,g){return wM}createTileMatrix(o,g,_e){let rt,ot,at;const ut=_e.canonical,ft=Gt(new Float64Array(16));if(this.isReprojectedInTileSpace){const gt=N1(ut,this);rt=1,ot=gt.x+_e.wrap*gt.scale,at=gt.y,Vt(ft,ft,[rt/gt.scale,rt/gt.scale,o.pixelsPerMeter/g])}else rt=g/o.zoomScale(ut.z),ot=(ut.x+Math.pow(2,ut.z)*_e.wrap)*rt,at=ut.y*rt;return Lt(ft,ft,[ot,at,0]),Vt(ft,ft,[rt/Mn,rt/Mn,1]),ft}upVector(o,g,_e){return[0,0,1]}upVectorScale(o,g,_e){return{metersToTile:1}}}class EM extends Y0{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[g,_e]=this.parallels=o.parallels||[29.5,45.5],rt=Math.sin(Fs(g));this.n=(rt+Math.sin(Fs(_e)))/2,this.c=1+rt*(2*this.n-rt),this.r0=Math.sqrt(this.c)/this.n}project(o,g){const{n:_e,c:rt,r0:ot}=this,at=Fs(o-this.center[0]),ut=Fs(g),ft=Math.sqrt(rt-2*_e*Math.sin(ut))/_e;return{x:ft*Math.sin(at*_e),y:ft*Math.cos(at*_e)-ot,z:0}}unproject(o,g){const{n:_e,c:rt,r0:ot}=this,at=ot+g;let ut=Math.atan2(o,Math.abs(at))*Math.sign(at);at*_e<0&&(ut-=Math.PI*Math.sign(o)*Math.sign(at));const ft=Fs(this.center[0])*_e;ut=yr(ut,-Math.PI-ft,Math.PI-ft);const gt=tr(vu(ut/_e)+this.center[0],-180,180),Ct=Math.asin(tr((rt-(o*o+at*at)*_e*_e)/(2*_e),-1,1)),At=tr(vu(Ct),-qt,qt);return new $(gt,At)}}const L1=1.340264,O1=-.081106,j1=893e-6,F1=.003796,NE=Math.sqrt(3)/2;class TM extends Y0{project(o,g){g=g/180*Math.PI,o=o/180*Math.PI;const _e=Math.asin(NE*Math.sin(g)),rt=_e*_e,ot=rt*rt*rt;return{x:.5*(o*Math.cos(_e)/(NE*(L1+3*O1*rt+ot*(7*j1+9*F1*rt)))/Math.PI+.5),y:1-.5*(_e*(L1+O1*rt+ot*(j1+F1*rt))/Math.PI+1),z:0}}unproject(o,g){o=(2*o-.5)*Math.PI;let _e=g=(2*(1-g)-1)*Math.PI,rt=_e*_e,ot=rt*rt*rt;for(let Ct,At,kt,zt=0;zt<12&&(At=_e*(L1+O1*rt+ot*(j1+F1*rt))-g,kt=L1+3*O1*rt+ot*(7*j1+9*F1*rt),Ct=At/kt,_e=tr(_e-Ct,-Math.PI/3,Math.PI/3),rt=_e*_e,ot=rt*rt*rt,!(Math.abs(Ct)<1e-12));++zt);const at=NE*o*(L1+3*O1*rt+ot*(7*j1+9*F1*rt))/Math.cos(_e),ut=Math.asin(Math.sin(_e)/NE),ft=tr(180*at/Math.PI,-180,180),gt=tr(180*ut/Math.PI,-qt,qt);return new $(ft,gt)}}class SM extends Y0{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,g){return{x:.5+o/360,y:.5-g/360,z:0}}unproject(o,g){const _e=360*(o-.5),rt=tr(360*(.5-g),-qt,qt);return new $(_e,rt)}}const zx=Math.PI/2;function LE(_){return Math.tan((zx+_)/2)}class CM extends Y0{constructor(o){super(o),this.center=o.center||[0,30];const[g,_e]=this.parallels=o.parallels||[30,30];let rt=Fs(g),ot=Fs(_e);this.southernCenter=rt+ot<0,this.southernCenter&&(rt=-rt,ot=-ot);const at=Math.cos(rt),ut=LE(rt);this.n=rt===ot?Math.sin(rt):Math.log(at/Math.cos(ot))/Math.log(LE(ot)/ut),this.f=at*Math.pow(LE(rt),this.n)/this.n}project(o,g){g=Fs(g),this.southernCenter&&(g=-g),o=Fs(o-this.center[0]);const _e=1e-6,{n:rt,f:ot}=this;ot>0?g<-zx+_e&&(g=-zx+_e):g>zx-_e&&(g=zx-_e);const at=ot/Math.pow(LE(g),rt);let ut=at*Math.sin(rt*o),ft=ot-at*Math.cos(rt*o);return ut=.5*(ut/Math.PI+.5),ft=.5*(ft/Math.PI+.5),{x:ut,y:this.southernCenter?ft:1-ft,z:0}}unproject(o,g){o=(2*o-.5)*Math.PI,this.southernCenter&&(g=1-g),g=(2*(1-g)-.5)*Math.PI;const{n:_e,f:rt}=this,ot=rt-g,at=Math.sign(ot),ut=Math.sign(_e)*Math.sqrt(o*o+ot*ot);let ft=Math.atan2(o,Math.abs(ot))*at;ot*_e<0&&(ft-=Math.PI*Math.sign(o)*at);const gt=tr(vu(ft/_e)+this.center[0],-180,180),Ct=tr(vu(2*Math.atan(Math.pow(rt/ut,1/_e))-zx),-qt,qt);return new $(gt,this.southernCenter?-Ct:Ct)}}class w2 extends Y0{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,g){return{x:mt(o),y:Tt(g),z:0}}unproject(o,g){const _e=Mt(o),rt=Ht(g);return new $(_e,rt)}}const E2=Fs(qt);class AM extends Y0{project(o,g){const _e=(g=Fs(g))*g,rt=_e*_e;return{x:.5*((o=Fs(o))*(.8707-.131979*_e+rt*(rt*(.003971*_e-.001529*rt)-.013791))/Math.PI+.5),y:1-.5*(g*(1.007226+_e*(.015085+rt*(.028874*_e-.044475-.005916*rt)))/Math.PI+1),z:0}}unproject(o,g){o=(2*o-.5)*Math.PI;let _e=g=(2*(1-g)-1)*Math.PI,rt=25,ot=0,at=_e*_e;do{at=_e*_e;const gt=at*at;ot=(_e*(1.007226+at*(.015085+gt*(.028874*at-.044475-.005916*gt)))-g)/(1.007226+at*(.045255+gt*(.259866*at-.311325-.005916*11*gt))),_e=tr(_e-ot,-E2,E2)}while(Math.abs(ot)>1e-6&&--rt>0);at=_e*_e;const ut=tr(vu(o/(.8707+at*(at*(at*at*at*(.003971-.001529*at)-.013791)-.131979))),-180,180),ft=vu(_e);return new $(ut,ft)}}const T2=Fs(qt);class RM extends Y0{project(o,g){g=Fs(g),o=Fs(o);const _e=Math.cos(g),rt=2/Math.PI,ot=Math.acos(_e*Math.cos(o/2)),at=Math.sin(ot)/ot,ut=.5*(o*rt+2*_e*Math.sin(o/2)/at)||0,ft=.5*(g+Math.sin(g)/at)||0;return{x:.5*(ut/Math.PI+.5),y:1-.5*(ft/Math.PI+1),z:0}}unproject(o,g){let _e=o=(2*o-.5)*Math.PI,rt=g=(2*(1-g)-1)*Math.PI,ot=25;const at=1e-6;let ut=0,ft=0;do{const gt=Math.cos(rt),Ct=Math.sin(rt),At=2*Ct*gt,kt=Ct*Ct,zt=gt*gt,Ut=Math.cos(_e/2),Kt=Math.sin(_e/2),er=2*Ut*Kt,Jt=Kt*Kt,or=1-zt*Ut*Ut,lr=or?1/or:0,pr=or?Math.acos(gt*Ut)*Math.sqrt(1/or):0,Sr=.5*(2*pr*gt*Kt+2*_e/Math.PI)-o,br=.5*(pr*Ct+rt)-g,Rr=.5*lr*(zt*Jt+pr*gt*Ut*kt)+1/Math.PI,Mr=lr*(er*At/4-pr*Ct*Kt),Lr=.125*lr*(At*Kt-pr*Ct*zt*er),Jr=.5*lr*(kt*Ut+pr*Jt*gt)+.5,zr=Mr*Lr-Jr*Rr;ut=(br*Mr-Sr*Jr)/zr,ft=(Sr*Lr-br*Rr)/zr,_e=tr(_e-ut,-Math.PI,Math.PI),rt=tr(rt-ft,-T2,T2)}while((Math.abs(ut)>at||Math.abs(ft)>at)&&--ot>0);return new $(vu(_e),vu(rt))}}class S2 extends Y0{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Fs(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,g){const{scale:_e,cosPhi:rt}=this;return{x:Fs(o)*rt*_e+.5,y:-Math.sin(Fs(g))/rt*_e+.5,z:0}}unproject(o,g){const{scale:_e,cosPhi:rt}=this,ot=-(g-.5)/_e,at=tr(vu((o-.5)/_e)/rt,-180,180),ut=Math.asin(tr(ot*rt,-1,1)),ft=tr(vu(ut),-qt,qt);return new $(at,ft)}}class IM extends w2{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,g,_e){const rt=c1(o,g,_e);return ws(rt,rt,sE(Cp(_e))),{x:rt[0],y:rt[1],z:rt[2]}}locationPoint(o,g,_e){const rt=G0(g.lat,g.lng),ot=ls([],rt),at=_e?o._centerAltitude+_e:o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(g),o._centerAltitude):o._centerAltitude;jn(rt,rt,ot,Pt(1,0)*Mn*at);const ut=Gt(new Float64Array(16));return Bt(ut,o.pixelMatrix,o.globeMatrix),ws(rt,rt,ut),new mn(rt[0],rt[1])}pixelsPerMeter(o,g){return Pt(1,0)*g}pixelSpaceConversion(o,g,_e){const rt=Pt(1,o)*g,ot=fs(Pt(1,45)*g,rt,_e);return this.pixelsPerMeter(o,g)/ot}createTileMatrix(o,g,_e){const rt=MT(Cp(_e.canonical));return Bt(new Float64Array(16),o.globeMatrix,rt)}createInversionMatrix(o,g){const{center:_e}=o,rt=sE(Cp(g));return nr(rt,rt,Fs(_e.lng)),Zt(rt,rt,Fs(_e.lat)),Vt(rt,rt,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(rt)}pointCoordinate(o,g,_e,rt){return W0(o,g,_e,!0)||new hr(0,0)}pointCoordinate3D(o,g,_e){const rt=this.pointCoordinate(o,g,_e,0);return[rt.x,rt.y,rt.z]}isPointAboveHorizon(o,g){return!W0(o,g.x,g.y,!1)}farthestPixelDistance(o){const g=function(rt,ot){const at=rt.cameraToCenterDistance,ut=rt._centerAltitude*ot,ft=rt._camera,gt=rt._camera.forward(),Ct=rr([],fn([],gt,-at),[0,0,ut]),At=rt.worldSize/(2*Math.PI),kt=[0,0,-At],zt=rt.width/rt.height,Ut=Math.tan(rt.fovAboveCenter),Kt=fn([],ft.up(),Ut),er=fn([],ft.right(),Ut*zt),Jt=ls([],rr([],rr([],gt,Kt),er)),or=[];let lr;if(new Kn(Ct,Jt).closestPointOnSphere(kt,At,or)){const pr=rr([],or,kt),Sr=wo([],pr,Ct);lr=Math.cos(rt.fovAboveCenter)*_i(Sr)}else{const pr=wo([],Ct,kt),Sr=wo([],kt,Ct);ls(Sr,Sr);const br=_i(pr)-At;lr=Math.sqrt(br*(br+2*At));const Rr=Math.acos(lr/(At+br))-Math.acos(ms(gt,Sr));lr*=Math.cos(Rr)}return 1.01*lr}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),_e=q0(o.zoom);if(_e>0){const rt=v2(o,Pt(1,o.center.lat)*o.worldSize),ot=o.worldSize/(2*Math.PI),at=Math.max(o.width,o.height)/o.worldSize*Math.PI;return fs(g,rt+ot*(1-Math.cos(at)),Math.pow(_e,10))}return g}upVector(o,g,_e){return c1(g,_e,o,1)}upVectorScale(o){return{metersToTile:Gp(nE(Cp(o)))}}}function C2(_){const o=_.parallels,g=!!o&&Math.abs(o[0]+o[1])<.01;switch(_.name){case"mercator":return new w2(_);case"equirectangular":return new SM(_);case"naturalEarth":return new AM(_);case"equalEarth":return new TM(_);case"winkelTripel":return new RM(_);case"albers":return g?new S2(_):new EM(_);case"lambertConformalConic":return g?new S2(_):new CM(_);case"globe":return new IM(_)}throw new Error(`Invalid projection name: ${_.name}`)}const PM=Or.types,kM=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function B1(_,o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt){const zt=ut?Math.min(_0,Math.round(ut[0])):0,Ut=ut?Math.min(_0,Math.round(ut[1])):0;_.emplaceBack(o,g,Math.round(32*_e),Math.round(32*rt),ot,at,(zt<<1)+(ft?1:0),0+(Ut<<1),16*gt,16*Ct,256*At,256*kt)}function z1(_,o,g){_.emplaceBack(o,g)}function V1(_,o,g,_e,rt,ot,at){_.emplaceBack(o,g,_e,rt,ot,at)}const OE=(_,o,g,_e)=>{for(let rt=0;rt<o;rt++)_.emplaceBack(g[0],g[1],g[2],_e[0],_e[1],_e[2])};function Vx(_,o,g,_e,rt){_.emplaceBack(o,g,_e,rt),_.emplaceBack(o,g,_e,rt),_.emplaceBack(o,g,_e,rt),_.emplaceBack(o,g,_e,rt)}function MM(_){for(const o of _.sections)if(gT(o.text))return!0;return!1}class RS{constructor(o){this.layoutVertexArray=new Wv,this.indexArray=new Fl,this.programConfigurations=o,this.segments=new Go,this.dynamicLayoutVertexArray=new Om,this.opacityVertexArray=new lx,this.placedSymbolArray=new Yw,this.iconTransitioningVertexArray=new Xu,this.globeExtVertexArray=new qv,this.zOffsetVertexArray=new im,this.orientationVertexArray=new Zv,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(o,g){const _e=[],rt=this.layoutVertexArray.uint16;for(let ot=0;ot<g;++ot){const at=12*(o+ot);_e.push(...rt.slice(at,at+12))}return _e}updateIconVertexData(o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt){const Ut=this.layoutVertexArray.uint16,Kt=12*o;Ut[Kt]=g,Ut[Kt+1]=_e,Ut[Kt+2]=rt,Ut[Kt+3]=ot,Ut[Kt+4]=at,Ut[Kt+5]=ut,Ut[Kt+6]=ft,Ut[Kt+7]=gt,Ut[Kt+8]=Ct,Ut[Kt+9]=At,Ut[Kt+10]=kt,Ut[Kt+11]=zt}upload(o,g,_e,rt,ot,at){this.isEmpty()||(_e&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,LP.members,!!at),this.indexBuffer=o.createIndexBuffer(this.indexArray,g),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,jP.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,kM,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=o.createVertexBuffer(this.iconTransitioningVertexArray,zP.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,OP.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||ot)&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,FP.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=o.createVertexBuffer(this.orientationVertexArray,BP.members,!0)),this.opacityVertexBuffer.itemSize=1),(_e||rt)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}qn(RS,"SymbolBuffers");class IS{constructor(o,g,_e){this.layoutVertexArray=new o,this.layoutAttributes=g,this.indexArray=new _e,this.segments=new Go,this.collisionVertexArray=new Kv,this.collisionVertexArrayExt=new Om}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,VP.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,UP.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}qn(IS,"CollisionBuffers");class jE{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(at=>at.fqid),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Gt([]),this.placementViewportMatrix=Gt([]);const g=this.layers[0]._unevaluatedLayout._values;this.worldview=o.worldview,this.localizable=o.localizable,this.textSizeData=Ox(this.zoom,g["text-size"],this.worldview),this.iconSizeData=Ox(this.zoom,g["icon-size"],this.worldview);const _e=this.layers[0].layout,rt=_e.get("symbol-sort-key"),ot=_e.get("symbol-z-order");this.lut=o.lut,this.canOverlap=_e.get("text-allow-overlap")||_e.get("icon-allow-overlap")||_e.get("text-ignore-placement")||_e.get("icon-ignore-placement"),this.sortFeaturesByKey=ot!=="viewport-y"&&rt.constantOr(1)!==void 0,this.sortFeaturesByY=(ot==="viewport-y"||ot==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=_e.get("text-writing-mode").map(at=>Qu[at]),this.stateDependentLayerIds=this.layers.filter(at=>at.isStateDependent()).map(at=>at.id),this.sourceID=o.sourceID,this.projection=o.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(o){const g=this.layers[0].getAppearances();return!(!g||g.length===0)&&g.some(_e=>_e.getProperty(o)!=null)}createArrays(){this.text=new RS(new Tp(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("text")||o.startsWith("symbol"))),this.icon=new RS(new Tp(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("icon")||o.startsWith("symbol"))),this.glyphOffsetArray=new yx,this.lineVertexArray=new Jw,this.symbolInstances=new t1}calculateGlyphDependencies(o,g,_e,rt,ot){for(const at of o){const ut=at.codePointAt(0);if(ut===void 0)break;if(g[ut]=!0,rt&&ot&&ut<=65535){const ft=R1[at];ft&&(g[ft.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(o,g,_e,rt,ot,at){let ut=1;const ft=o.getUnevaluatedProperties()._values["icon-size"],gt=Ox(this.zoom,ft,this.worldview),Ct=jx(gt,g);if(gt.kind!=="constant"&&gt.kind!=="camera"||(ut=Ct.uSize),gt.kind==="composite"){const{minZoom:At,maxZoom:kt}=gt,zt=ft.possiblyEvaluate(new Do(At,{worldview:this.worldview}),rt),Ut=ft.possiblyEvaluate(new Do(kt,{worldview:this.worldview}),rt),Kt=zt.evaluate(_e,{},rt,ot);ut=Kt+(Ut.evaluate(_e,{},rt,ot)-Kt)*Ct.uSizeT}return gt.kind==="source"&&(ut=ft.possiblyEvaluate(new Do(this.zoom,{worldview:this.worldview}),rt).evaluate(_e,{},rt,ot)),ut*at}updateFootprints(o,g){}updateReplacement(o,g){if(g.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=g.updateTime;const _e=g.getReplacementRegionsForTile(o.toUnwrapped(),!0);return!hE(this.activeReplacements,_e)&&(this.activeReplacements=_e,!0)}getResolvedImageFromTokens(o){return typeof o=="string"?Cu.build(o):o}populate(o,g,_e,rt){const ot=this.layers[0],at=ot.layout,ut=this.projection.name==="globe",ft=at.get("text-font"),gt=at.get("text-field"),Ct=at.get("icon-image"),[At,kt]=at.get("icon-size-scale-range"),zt=tr(g.scaleFactor||1,At,kt),Ut=(gt.value.kind!=="constant"||gt.value.value instanceof Su&&!gt.value.value.isEmpty()||gt.value.value.toString().length>0)&&(ft.value.kind!=="constant"||ft.value.value.length>0),Kt=Ct.value.kind!=="constant"||!!Ct.value.value||Object.keys(Ct.parameters).length>0,er=this.hasAnyAppearanceProperty("icon-image"),Jt=at.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!Ut&&!Kt&&!er)return;const or=g.iconDependencies,lr=g.glyphDependencies,pr=g.availableImages,Sr=new Do(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),br=Rr=>{const Mr=Rr.id.toString();or.has(Mr)?or.get(Mr).push(Rr):or.set(Mr,[Rr])};for(const Rr of o){const{feature:Mr,id:Lr,index:Jr,sourceLayerIndex:zr}=Rr,sn=ot._featureFilter.needGeometry,dn=Br(Mr,sn);if(!ot._featureFilter.filter(Sr,dn,_e))continue;if(sn||(dn.geometry=Pr(Mr,_e,rt)),ut&&Mr.type!==1&&_e.z<=5){const bn=dn.geometry,Dn=.98078528056,Rn=(ts,Vn)=>ms(c1(ts.x,ts.y,_e,1),c1(Vn.x,Vn.y,_e,1))<Dn;for(let ts=0;ts<bn.length;ts++)bn[ts]=Tr(bn[ts],Rn)}let pn,wn;if(Ut){const bn=ot.getValueAndResolveTokens("text-field",dn,_e,pr),Dn=Su.factory(bn);MM(Dn)&&(this.hasRTLText=!0),(!this.hasRTLText||N_()==="unavailable"||this.hasRTLText&&rm.isParsed())&&(pn=GP(Dn,ot,dn))}if(Kt){const bn=ot.getValueAndResolveTokens("icon-image",dn,_e,pr);wn=this.getResolvedImageFromTokens(bn)}const Tn=this.layers[0];let xn=!1;if(!wn&&er){const bn=Tn.getAppearances();for(const Dn of bn)if(Dn.getProperty("icon-image")){const Rn=Tn.getAppearanceValueAndResolveTokens(Dn,"icon-image",dn,_e,pr);if(Rn){wn=this.getResolvedImageFromTokens(Rn),xn=!0;break}}}if(!pn&&!wn)continue;const vn=this.sortFeaturesByKey?Jt.evaluate(dn,{},_e):void 0,nn={id:Lr,text:pn,icon:wn,index:Jr,sourceLayerIndex:zr,geometry:dn.geometry,properties:Mr.properties,type:PM[Mr.type],sortKey:vn};if(this.features.push(nn),this.featureToAppearanceIndex[Jr]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:Lr,properties:Mr.properties,usesAppearanceIconAsPlaceholder:xn,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),wn){const bn=Tn._unevaluatedLayout._values,{iconPrimary:Dn,iconSecondary:Rn}=M1(wn,this.iconSizeData,bn["icon-size"],_e,this.zoom,nn,this.pixelRatio,zt,this.worldview);br(Dn),Rn&&(this.hasAnySecondaryIcon=!0,br(Rn))}const en=Tn.getAppearances();if(en.length!==0&&en.forEach(bn=>{if(!bn.getProperty("icon-image"))return;const Dn=this.getCombinedIconPrimary(bn,Tn,dn,_e,pr,nn,zt);Dn&&br(Dn)}),pn){const bn=ft.evaluate(dn,{},_e).join(","),Dn=at.get("text-rotation-alignment")==="map"&&at.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Qu.vertical)>=0;for(const Rn of pn.sections)if(Rn.image){const ts=Rn.image.getPrimary().scaleSelf(this.pixelRatio),Vn=ts.id.toString(),Hn=or.get(Vn)||[];Hn.push(ts),or.set(Vn,Hn)}else{const ts=M_(pn.toString()),Vn=Rn.fontStack||bn,Hn=lr[Vn]=lr[Vn]||{};this.calculateGlyphDependencies(Rn.text,Hn,Dn,this.allowVerticalPlacement,ts)}}}if(at.get("symbol-placement")==="line"&&(this.features=function(Rr){const Mr={},Lr={},Jr=[];let zr=0;function sn(Tn){Jr.push(Rr[Tn]),zr++}function dn(Tn,xn,vn){const nn=Lr[Tn];return delete Lr[Tn],Lr[xn]=nn,Jr[nn].geometry[0].pop(),Jr[nn].geometry[0]=Jr[nn].geometry[0].concat(vn[0]),nn}function pn(Tn,xn,vn){const nn=Mr[xn];return delete Mr[xn],Mr[Tn]=nn,Jr[nn].geometry[0].shift(),Jr[nn].geometry[0]=vn[0].concat(Jr[nn].geometry[0]),nn}function wn(Tn,xn,vn){const nn=vn?xn[0][xn[0].length-1]:xn[0][0];return`${Tn}:${nn.x}:${nn.y}`}for(let Tn=0;Tn<Rr.length;Tn++){const xn=Rr[Tn],vn=xn.geometry,nn=xn.text?xn.text.toString():null;if(!nn){sn(Tn);continue}const en=wn(nn,vn),bn=wn(nn,vn,!0);if(en in Lr&&bn in Mr&&Lr[en]!==Mr[bn]){const Dn=pn(en,bn,vn),Rn=dn(en,bn,Jr[Dn].geometry);delete Mr[en],delete Lr[bn],Lr[wn(nn,Jr[Rn].geometry,!0)]=Rn,Jr[Dn].geometry=null}else en in Lr?dn(en,bn,vn):bn in Mr?pn(en,bn,vn):(sn(Tn),Mr[en]=zr-1,Lr[bn]=zr-1)}return Jr.filter(Tn=>Tn.geometry)}(this.features)),at.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",g.elevationFeatures){!this.elevationFeatures&&g.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Rr of g.elevationFeatures)this.elevationFeatureIdToIndex.set(Rr.id,this.elevationFeatures.length),this.elevationFeatures.push(Rr)}}else at.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Rr,Mr)=>Rr.sortKey-Mr.sortKey)}getCombinedIconPrimary(o,g,_e,rt,ot,at,ut){let ft,gt;const Ct=o.getUnevaluatedProperties();if(Ct._values["icon-image"].value!==void 0){const At=g.getAppearanceValueAndResolveTokens(o,"icon-image",_e,rt,ot);ft=this.getResolvedImageFromTokens(At)}else{const At=g.getValueAndResolveTokens("icon-image",_e,rt,ot);ft=this.getResolvedImageFromTokens(At)}if(ft){const At=Ct._values["icon-size"]||g._unevaluatedLayout._values["icon-size"];gt=M1(ft,Ox(this.zoom,At,this.worldview),At,rt,this.zoom,at,this.pixelRatio,ut,this.worldview).iconPrimary}return gt}updateAppearanceBasedIconTextures(o,g,_e,rt){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const ot=this.layers[0];let at=!1,ut=0;const ft=ot.layout,[gt,Ct]=ft.get("icon-size-scale-range"),At=tr(1,gt,Ct);for(let kt=0;kt<this.symbolInstances.length;kt++){const zt=this.symbolInstances.get(kt),Ut=this.featureToAppearanceIndex[zt.featureIndex],Kt=Ut!==void 0?this.appearanceFeatureData[Ut]:void 0;if(Kt&&zt.placedIconSymbolIndex>=0){const er=Kt.id,Jt=g&&er!==void 0?g[String(er)]:void 0,or={type:"Point",id:Kt.id,properties:Kt.properties,geometry:[]},lr=this.layers[0].appearances&&this.layers[0].appearances.find(pr=>pr.isActive({globals:rt,feature:or,canonical:o,featureState:Jt}));if(Kt.activeAppearance===lr){ut+=zt.numIconVertices;continue}if(lr){Kt.activeAppearance=lr;const pr=this.getCombinedIconPrimary(lr,ot,or,o,_e,{sortKey:void 0,text:void 0,icon:null,index:zt.featureIndex,sourceLayerIndex:zt.featureIndex,geometry:[],properties:Kt.properties,type:"Point",id:Kt.id},At);if(!pr)continue;const Sr=pr.toString(),br=this.iconAtlasPositions&&this.iconAtlasPositions.get(Sr);if(br){const Rr=ot.getAppearanceValueAndResolveTokens(lr,"icon-offset",or,o,_e),Mr=Rr&&Array.isArray(Rr)?Rr:[0,0];let Lr=AE(br,void 0,Mr,ot.layout.get("icon-anchor").evaluate(or,{},o));const Jr=ot.getAppearanceValueAndResolveTokens(lr,"icon-rotate",or,o,_e),zr=typeof Jr=="number"?Jr:0,sn=br.sdf,dn=ot.layout.get("icon-text-fit").constantOr("none");dn!=="none"&&Kt.textShaping&&Kt.iconTextFitPadding&&Kt.fontScale&&(Lr=vS(Lr,Kt.textShaping,dn,Kt.iconTextFitPadding,Mr,Kt.fontScale));const pn=this.calculateEffectiveAppearanceIconSize(lr,rt.zoom,or,o,_e,At),wn=0,Tn=1+(Math.min(_0,Math.round(pn*pm))<<1),xn=TS(Lr,zr,sn,dn!=="none",At);Kt.isUsingAppearanceVertexData||(Kt.isUsingAppearanceVertexData=!0,Kt.layoutBasedVertexData=this.icon.getIconVertexData(ut,zt.numIconVertices));for(let nn=0;nn<xn.length;++nn){const en=xn[nn],bn=Kt.layoutBasedVertexData[0]||zt.tileAnchorX,Dn=Kt.layoutBasedVertexData[1]||zt.tileAnchorY,Rn=16*en.pixelOffsetTL.x,ts=16*en.pixelOffsetTL.y,Vn=16*en.pixelOffsetBR.x,Hn=16*en.pixelOffsetBR.y,Zn=16*en.minFontScaleX,js=16*en.minFontScaleY;this.icon.updateIconVertexData(ut,bn,Dn,Math.round(32*en.tl.x),Math.round(32*en.tl.y),en.texPrimary.x,en.texPrimary.y,wn,Tn,Rn,ts,Zn,js),this.icon.updateIconVertexData(ut+1,bn,Dn,Math.round(32*en.tr.x),Math.round(32*en.tr.y),en.texPrimary.x+en.texPrimary.w,en.texPrimary.y,wn,Tn,Vn,ts,Zn,js),this.icon.updateIconVertexData(ut+2,bn,Dn,Math.round(32*en.bl.x),Math.round(32*en.bl.y),en.texPrimary.x,en.texPrimary.y+en.texPrimary.h,wn,Tn,Rn,Hn,Zn,js),this.icon.updateIconVertexData(ut+3,bn,Dn,Math.round(32*en.br.x),Math.round(32*en.br.y),en.texPrimary.x+en.texPrimary.w,en.texPrimary.y+en.texPrimary.h,wn,Tn,Vn,Hn,Zn,js),ut+=4}const vn=zt.numIconVertices-4*xn.length;for(let nn=0;nn<vn;++nn)this.icon.updateIconVertexData(ut+nn,0,0,0,0,0,0,0,0,0,0,0,0);at=!0}else ut+=zt.numIconVertices}else if(Kt.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(ut,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(ut+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(ut+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(ut+3,0,0,0,0,0,0,0,0,0,0,0,0),at=!0),ut+=zt.numIconVertices,Kt.activeAppearance=null;else if(Kt.isUsingAppearanceVertexData){const Sr=Kt.layoutBasedVertexData.length/12;for(let br=0;br<Sr;++br){const Rr=br*12;this.icon.updateIconVertexData(ut+br,Kt.layoutBasedVertexData[Rr+0],Kt.layoutBasedVertexData[Rr+1],Kt.layoutBasedVertexData[Rr+2],Kt.layoutBasedVertexData[Rr+3],Kt.layoutBasedVertexData[Rr+4],Kt.layoutBasedVertexData[Rr+5],Kt.layoutBasedVertexData[Rr+6],Kt.layoutBasedVertexData[Rr+7],Kt.layoutBasedVertexData[Rr+8],Kt.layoutBasedVertexData[Rr+9],Kt.layoutBasedVertexData[Rr+10],Kt.layoutBasedVertexData[Rr+11])}ut+=Sr,Kt.isUsingAppearanceVertexData=!1,Kt.activeAppearance=null,at=!0}else ut+=zt.numIconVertices,Kt.activeAppearance=null}}return at}update(o,g,_e,rt,ot,at,ut){this.text.programConfigurations.updatePaintArrays(o,g,ot,_e,rt,at,ut,this.worldview),this.icon.programConfigurations.updatePaintArrays(o,g,ot,_e,rt,at,ut,this.worldview)}updateRoadElevation(o){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let g=!1;const _e=ir(o),rt=1/_e;let ot=!1,at=!1;for(let ut=0;ut<this.symbolInstances.length;ut++){const ft=this.symbolInstances.get(ut),gt=xr(1,0,0),Ct=xr(0,1,0),{numHorizontalGlyphVertices:At,numVerticalGlyphVertices:kt,numIconVertices:zt,numVerticalIconVertices:Ut}=ft,Kt=At>0||kt>0,er=zt>0,Jt=this.elevationFeatures[ft.elevationFeatureIndex];if(Jt){const or=new mn(ft.tileAnchorX,ft.tileAnchorY),lr=.075+Jt.pointElevation(or);ft.zOffset!==lr&&(g=!0,ft.zOffset=lr),lr!==0&&(this.hasAnyZOffset=!0);const pr=Jt.computeSlopeNormal(or,rt),Sr=Ip(iu(),xr(0,0,1),pr);Rl(gt,gt,Sr),Rl(Ct,Ct,Sr),gt[2]*=_e,Ct[2]*=_e,gt[0]===1&&gt[1]===0&&gt[2]===0&&Ct[0]===0&&Ct[1]===1&&Ct[2]===0||(ot=ot||Kt,at=at||er)}if(Kt&&(OE(this.text.orientationVertexArray,At,gt,Ct),OE(this.text.orientationVertexArray,kt,gt,Ct)),er){const{placedIconSymbolIndex:or,verticalPlacedIconSymbolIndex:lr}=ft;or>=0&&OE(this.icon.orientationVertexArray,zt,gt,Ct),lr>=0&&OE(this.icon.orientationVertexArray,Ut,gt,Ct)}}ot||(this.text.orientationVertexArray=void 0),at||(this.icon.orientationVertexArray=void 0),g&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const o=(ot,at,ut)=>{_e+=at,_e>ot.length&&ot.resize(_e);for(let ft=-at;ft<0;ft++)ot.emplace(ft+_e,ut)},g=(ot,at,ut)=>{rt+=at,rt>ot.length&&ot.resize(rt);for(let ft=-at;ft<0;ft++)ot.emplace(ft+rt,ut)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let _e=0,rt=0;for(let ot=0;ot<this.symbolInstances.length;ot++){const at=this.symbolInstances.get(ot),{numHorizontalGlyphVertices:ut,numVerticalGlyphVertices:ft,numIconVertices:gt}=at,Ct=at.zOffset,At=gt>0;if((ut>0||ft>0)&&(o(this.text.zOffsetVertexArray,ut,Ct),o(this.text.zOffsetVertexArray,ft,Ct)),At){const{placedIconSymbolIndex:kt,verticalPlacedIconSymbolIndex:zt}=at;kt>=0&&g(this.icon.zOffsetVertexArray,gt,Ct),zt>=0&&g(this.icon.zOffsetVertexArray,at.numVerticalIconVertices,Ct)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o,g,_e,rt,ot){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(at=>at.appearances&&at.appearances.length>0)),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(o,g,_e,rt){return!!(o&&g&&_e)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(o,g,_e,rt)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=C2(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,g){const _e=this.lineVertexArray.length;if(o.segment!==void 0)for(const{x:rt,y:ot}of g)this.lineVertexArray.emplaceBack(rt,ot);return{lineStartIndex:_e,lineLength:this.lineVertexArray.length-_e}}addSymbols(o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt,Ut,Kt,er,Jt,or){const lr=o.indexArray,pr=o.layoutVertexArray,Sr=o.globeExtVertexArray,br=o.segments.prepareSegment(4*or,pr,lr,this.canOverlap?at.sortKey:void 0),Rr=this.glyphOffsetArray.length,Mr=br.vertexLength,Lr=this.allowVerticalPlacement&&ut===Qu.vertical?Math.PI/2:0,Jr=at.text&&at.text.sections;for(let dn=0;dn<g.length;dn++){const{tl:pn,tr:wn,bl:Tn,br:xn,texPrimary:vn,texSecondary:nn,pixelOffsetTL:en,pixelOffsetBR:bn,minFontScaleX:Dn,minFontScaleY:Rn,glyphOffset:ts,isSDF:Vn,sectionIndex:Hn}=g[dn],Zn=br.vertexLength,js=ts[1];if(B1(pr,gt.x,gt.y,pn.x,js+pn.y,vn.x,vn.y,_e,Vn,en.x,en.y,Dn,Rn),B1(pr,gt.x,gt.y,wn.x,js+wn.y,vn.x+vn.w,vn.y,_e,Vn,bn.x,en.y,Dn,Rn),B1(pr,gt.x,gt.y,Tn.x,js+Tn.y,vn.x,vn.y+vn.h,_e,Vn,en.x,bn.y,Dn,Rn),B1(pr,gt.x,gt.y,xn.x,js+xn.y,vn.x+vn.w,vn.y+vn.h,_e,Vn,bn.x,bn.y,Dn,Rn),ft){const{x:In,y:Yn,z:xs}=ft.anchor,[Gs,Ws,Rs]=ft.up;V1(Sr,In,Yn,xs,Gs,Ws,Rs),V1(Sr,In,Yn,xs,Gs,Ws,Rs),V1(Sr,In,Yn,xs,Gs,Ws,Rs),V1(Sr,In,Yn,xs,Gs,Ws,Rs),Vx(o.dynamicLayoutVertexArray,In,Yn,xs,Lr)}else Vx(o.dynamicLayoutVertexArray,gt.x,gt.y,gt.z,Lr);if(er){const In=nn||vn;z1(o.iconTransitioningVertexArray,In.x,In.y),z1(o.iconTransitioningVertexArray,In.x+In.w,In.y),z1(o.iconTransitioningVertexArray,In.x,In.y+In.h),z1(o.iconTransitioningVertexArray,In.x+In.w,In.y+In.h)}lr.emplaceBack(Zn,Zn+1,Zn+2),lr.emplaceBack(Zn+1,Zn+2,Zn+3),br.vertexLength+=4,br.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ts[0]),dn!==g.length-1&&Hn===g[dn+1].sectionIndex||o.programConfigurations.populatePaintArrays(pr.length,at,at.index,{},zt,Ut,Kt,Jr&&Jr[Hn],this.worldview)}const zr=or-g.length;zr!==0&&this._addNullVertices(zr,pr,_e,ft,Sr,o,er,br,lr);const sn=ft?ft.anchor:gt;o.placedSymbolArray.emplaceBack(sn.x,sn.y,sn.z,gt.x,gt.y,Rr,this.glyphOffsetArray.length-Rr,Mr,Ct,At,gt.segment,_e?_e[0]:0,_e?_e[1]:0,rt[0],rt[1],ut,0,0,0,kt,0),o.symbolInstanceIndices.push(Jt)}_addNullVertices(o,g,_e,rt,ot,at,ut,ft,gt){for(let Ct=0;Ct<o;Ct++){for(let kt=0;kt<4;kt++)B1(g,0,0,0,0,0,0,_e,!1,0,0,0,0),rt&&V1(ot,0,0,0,0,0,0),Vx(at.dynamicLayoutVertexArray,0,0,0,0),ut&&z1(at.iconTransitioningVertexArray,0,0);const At=ft.vertexLength;gt.emplaceBack(At,At+1,At+2),gt.emplaceBack(At+1,At+2,At+3),ft.vertexLength+=4,ft.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(o,g,_e,rt,ot,at,ut){o.emplaceBack(g,_e,rt,ot,at,Math.round(ut.x),Math.round(ut.y))}_addCollisionDebugVertices(o,g,_e,rt,ot,at,ut){const ft=_e.segments.prepareSegment(4,_e.layoutVertexArray,_e.indexArray),gt=ft.vertexLength,Ct=ut.tileAnchorX,At=ut.tileAnchorY;for(let zt=0;zt<4;zt++)_e.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(_e.collisionVertexArrayExt,g,o.padding,ut.zOffset),this._commitLayoutVertex(_e.layoutVertexArray,rt,ot,at,Ct,At,new mn(o.x1,o.y1)),this._commitLayoutVertex(_e.layoutVertexArray,rt,ot,at,Ct,At,new mn(o.x2,o.y1)),this._commitLayoutVertex(_e.layoutVertexArray,rt,ot,at,Ct,At,new mn(o.x2,o.y2)),this._commitLayoutVertex(_e.layoutVertexArray,rt,ot,at,Ct,At,new mn(o.x1,o.y2)),ft.vertexLength+=4;const kt=_e.indexArray;kt.emplaceBack(gt,gt+1),kt.emplaceBack(gt+1,gt+2),kt.emplaceBack(gt+2,gt+3),kt.emplaceBack(gt+3,gt),ft.primitiveLength+=4}_addTextDebugCollisionBoxes(o,g,_e,rt,ot,at){for(let ut=rt;ut<ot;ut++){const ft=_e.get(ut),gt=this.getSymbolInstanceTextSize(o,at,g,ut);this._addCollisionDebugVertices(ft,gt,this.textCollisionBox,ft.projectedAnchorX,ft.projectedAnchorY,ft.projectedAnchorZ,at)}}_addIconDebugCollisionBoxes(o,g,_e,rt,ot,at){for(let ut=rt;ut<ot;ut++){const ft=_e.get(ut),gt=this.getSymbolInstanceIconSize(o,g,at.placedIconSymbolIndex);this._addCollisionDebugVertices(ft,gt,this.iconCollisionBox,ft.projectedAnchorX,ft.projectedAnchorY,ft.projectedAnchorZ,at)}}generateCollisionDebugBuffers(o,g,_e){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new IS(hx,GA.members,Xu),this.iconCollisionBox=new IS(hx,GA.members,Xu);const rt=jx(this.iconSizeData,o),ot=jx(this.textSizeData,o,_e);for(let at=0;at<this.symbolInstances.length;at++){const ut=this.symbolInstances.get(at);this._addTextDebugCollisionBoxes(ot,o,g,ut.textBoxStartIndex,ut.textBoxEndIndex,ut),this._addTextDebugCollisionBoxes(ot,o,g,ut.verticalTextBoxStartIndex,ut.verticalTextBoxEndIndex,ut),this._addIconDebugCollisionBoxes(rt,o,g,ut.iconBoxStartIndex,ut.iconBoxEndIndex,ut),this._addIconDebugCollisionBoxes(rt,o,g,ut.verticalIconBoxStartIndex,ut.verticalIconBoxEndIndex,ut)}}getSymbolInstanceTextSize(o,g,_e,rt){const ot=this.text.placedSymbolArray.get(g.rightJustifiedTextSymbolIndex>=0?g.rightJustifiedTextSymbolIndex:g.centerJustifiedTextSymbolIndex>=0?g.centerJustifiedTextSymbolIndex:g.leftJustifiedTextSymbolIndex>=0?g.leftJustifiedTextSymbolIndex:g.verticalPlacedTextSymbolIndex>=0?g.verticalPlacedTextSymbolIndex:rt),at=bS(this.textSizeData,o,ot)/Yl;return this.tilePixelRatio*at}getSymbolInstanceIconSize(o,g,_e){const rt=this.icon.placedSymbolArray.get(_e),ot=bS(this.iconSizeData,o,rt);return this.tilePixelRatio*ot}_commitDebugCollisionVertexUpdate(o,g,_e,rt){o.emplaceBack(g,-_e,-_e,rt),o.emplaceBack(g,_e,-_e,rt),o.emplaceBack(g,_e,_e,rt),o.emplaceBack(g,-_e,_e,rt)}_updateTextDebugCollisionBoxes(o,g,_e,rt,ot,at,ut){for(let ft=rt;ft<ot;ft++){const gt=_e.get(ft),Ct=this.getSymbolInstanceTextSize(o,at,g,ft);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,Ct,gt.padding,at.zOffset)}}_updateIconDebugCollisionBoxes(o,g,_e,rt,ot,at,ut){for(let ft=rt;ft<ot;ft++){const gt=_e.get(ft),Ct=this.getSymbolInstanceIconSize(o,g,at.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,Ct,gt.padding,at.zOffset)}}updateCollisionDebugBuffers(o,g,_e,rt){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const ot=jx(this.iconSizeData,o,rt),at=jx(this.textSizeData,o,_e);for(let ut=0;ut<this.symbolInstances.length;ut++){const ft=this.symbolInstances.get(ut);this._updateTextDebugCollisionBoxes(at,o,g,ft.textBoxStartIndex,ft.textBoxEndIndex,ft,_e),this._updateTextDebugCollisionBoxes(at,o,g,ft.verticalTextBoxStartIndex,ft.verticalTextBoxEndIndex,ft,_e),this._updateIconDebugCollisionBoxes(ot,o,g,ft.iconBoxStartIndex,ft.iconBoxEndIndex,ft,rt),this._updateIconDebugCollisionBoxes(ot,o,g,ft.verticalIconBoxStartIndex,ft.verticalIconBoxEndIndex,ft,rt)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,g,_e,rt,ot,at,ut,ft,gt){const Ct={};if(g<_e){const{x1:At,y1:kt,x2:zt,y2:Ut,padding:Kt,projectedAnchorX:er,projectedAnchorY:Jt,projectedAnchorZ:or,tileAnchorX:lr,tileAnchorY:pr,featureIndex:Sr}=o.get(g);Ct.textBox={x1:At,y1:kt,x2:zt,y2:Ut,padding:Kt,projectedAnchorX:er,projectedAnchorY:Jt,projectedAnchorZ:or,tileAnchorX:lr,tileAnchorY:pr},Ct.textFeatureIndex=Sr}if(rt<ot){const{x1:At,y1:kt,x2:zt,y2:Ut,padding:Kt,projectedAnchorX:er,projectedAnchorY:Jt,projectedAnchorZ:or,tileAnchorX:lr,tileAnchorY:pr,featureIndex:Sr}=o.get(rt);Ct.verticalTextBox={x1:At,y1:kt,x2:zt,y2:Ut,padding:Kt,projectedAnchorX:er,projectedAnchorY:Jt,projectedAnchorZ:or,tileAnchorX:lr,tileAnchorY:pr},Ct.verticalTextFeatureIndex=Sr}if(at<ut){const{x1:At,y1:kt,x2:zt,y2:Ut,padding:Kt,projectedAnchorX:er,projectedAnchorY:Jt,projectedAnchorZ:or,tileAnchorX:lr,tileAnchorY:pr,featureIndex:Sr}=o.get(at);Ct.iconBox={x1:At,y1:kt,x2:zt,y2:Ut,padding:Kt,projectedAnchorX:er,projectedAnchorY:Jt,projectedAnchorZ:or,tileAnchorX:lr,tileAnchorY:pr},Ct.iconFeatureIndex=Sr}if(ft<gt){const{x1:At,y1:kt,x2:zt,y2:Ut,padding:Kt,projectedAnchorX:er,projectedAnchorY:Jt,projectedAnchorZ:or,tileAnchorX:lr,tileAnchorY:pr,featureIndex:Sr}=o.get(ft);Ct.verticalIconBox={x1:At,y1:kt,x2:zt,y2:Ut,padding:Kt,projectedAnchorX:er,projectedAnchorY:Jt,projectedAnchorZ:or,tileAnchorX:lr,tileAnchorY:pr},Ct.verticalIconFeatureIndex=Sr}return Ct}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let g=0;g<this.symbolInstances.length;g++){const _e=this.symbolInstances.get(g);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,_e.textBoxStartIndex,_e.textBoxEndIndex,_e.verticalTextBoxStartIndex,_e.verticalTextBoxEndIndex,_e.iconBoxStartIndex,_e.iconBoxEndIndex,_e.verticalIconBoxStartIndex,_e.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(o,g){const _e=o.placedSymbolArray.get(g),rt=_e.vertexStartIndex+4*_e.numGlyphs;for(let ot=_e.vertexStartIndex;ot<rt;ot+=4)o.indexArray.emplaceBack(ot,ot+1,ot+2),o.indexArray.emplaceBack(ot+1,ot+2,ot+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const g=Math.sin(o),_e=Math.cos(o),rt=[],ot=[],at=[];for(let ut=0;ut<this.symbolInstances.length;++ut){at.push(ut);const ft=this.symbolInstances.get(ut);rt.push(0|Math.round(g*ft.tileAnchorX+_e*ft.tileAnchorY)),ot.push(ft.featureIndex)}return at.sort((ut,ft)=>rt[ut]-rt[ft]||ot[ft]-ot[ut]),at}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let o=0;o<this.symbolInstances.length;++o)this.symbolInstanceIndexesSortedZOffset.push(o)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((o,g)=>this.symbolInstances.get(g).zOffset-this.symbolInstances.get(o).zOffset)}addToSortKeyRanges(o,g){const _e=this.sortKeyRanges[this.sortKeyRanges.length-1];_e&&_e.sortKey===g?_e.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:g,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const g of this.symbolInstanceIndexes){const _e=this.symbolInstances.get(g);this.featureSortOrder.push(_e.featureIndex);const{rightJustifiedTextSymbolIndex:rt,centerJustifiedTextSymbolIndex:ot,leftJustifiedTextSymbolIndex:at,verticalPlacedTextSymbolIndex:ut,placedIconSymbolIndex:ft,verticalPlacedIconSymbolIndex:gt}=_e;rt>=0&&this.addIndicesForPlacedSymbol(this.text,rt),ot>=0&&ot!==rt&&this.addIndicesForPlacedSymbol(this.text,ot),at>=0&&at!==ot&&at!==rt&&this.addIndicesForPlacedSymbol(this.text,at),ut>=0&&this.addIndicesForPlacedSymbol(this.text,ut),ft>=0&&this.addIndicesForPlacedSymbol(this.icon,ft),gt>=0&&this.addIndicesForPlacedSymbol(this.icon,gt)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(o){const g=this.symbolInstances.get(this.text.symbolInstanceIndices[o]).elevationFeatureIndex;let _e;return this.elevationFeatures&&g<this.elevationFeatures.length&&(_e=this.elevationFeatures[g]),_e}}function A2(_,o){return o.replace(/{([^{}]+)}/g,(g,_e)=>_e in _?String(_[_e]):"")}let R2,I2,PS;qn(jE,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),jE.addDynamicAttributes=Vx;class P2{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:xp,this.defaultValue=o}evaluate(o){if(o.formattedSection){const g=this.defaultValue.property.overrides;if(g&&g.hasOverride(o.formattedSection))return g.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qn(P2,"FormatSectionOverride",{omit:["defaultValue"]});const kS=()=>PS||(PS={layout:R2||(R2=new ga({"symbol-placement":new Pn(Gr.layout_symbol["symbol-placement"]),"symbol-spacing":new Pn(Gr.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Pn(Gr.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new On(Gr.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Pn(Gr.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Pn(Gr.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Pn(Gr.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Pn(Gr.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Pn(Gr.layout_symbol["icon-ignore-placement"]),"icon-optional":new Pn(Gr.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Pn(Gr.layout_symbol["icon-rotation-alignment"]),"icon-size":new On(Gr.layout_symbol["icon-size"]),"icon-size-scale-range":new Pn(Gr.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new On(Gr.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new On(Gr.layout_symbol["icon-text-fit-padding"]),"icon-image":new On(Gr.layout_symbol["icon-image"]),"icon-image-use-theme":new Pn({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new On(Gr.layout_symbol["icon-rotate"]),"icon-padding":new Pn(Gr.layout_symbol["icon-padding"]),"icon-keep-upright":new Pn(Gr.layout_symbol["icon-keep-upright"]),"icon-offset":new On(Gr.layout_symbol["icon-offset"]),"icon-anchor":new On(Gr.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Pn(Gr.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Pn(Gr.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Pn(Gr.layout_symbol["text-rotation-alignment"]),"text-field":new On(Gr.layout_symbol["text-field"]),"text-font":new On(Gr.layout_symbol["text-font"]),"text-size":new On(Gr.layout_symbol["text-size"]),"text-size-scale-range":new Pn(Gr.layout_symbol["text-size-scale-range"]),"text-max-width":new On(Gr.layout_symbol["text-max-width"]),"text-line-height":new On(Gr.layout_symbol["text-line-height"]),"text-letter-spacing":new On(Gr.layout_symbol["text-letter-spacing"]),"text-justify":new On(Gr.layout_symbol["text-justify"]),"text-radial-offset":new On(Gr.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Pn(Gr.layout_symbol["text-variable-anchor"]),"text-anchor":new On(Gr.layout_symbol["text-anchor"]),"text-max-angle":new Pn(Gr.layout_symbol["text-max-angle"]),"text-writing-mode":new Pn(Gr.layout_symbol["text-writing-mode"]),"text-rotate":new On(Gr.layout_symbol["text-rotate"]),"text-padding":new Pn(Gr.layout_symbol["text-padding"]),"text-keep-upright":new Pn(Gr.layout_symbol["text-keep-upright"]),"text-transform":new On(Gr.layout_symbol["text-transform"]),"text-offset":new On(Gr.layout_symbol["text-offset"]),"text-allow-overlap":new Pn(Gr.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Pn(Gr.layout_symbol["text-ignore-placement"]),"text-optional":new Pn(Gr.layout_symbol["text-optional"]),visibility:new Pn(Gr.layout_symbol.visibility)})),paint:I2||(I2=new ga({"icon-opacity":new On(Gr.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new On(Gr.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new On(Gr.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new On(Gr.paint_symbol["text-emissive-strength"]),"icon-color":new On(Gr.paint_symbol["icon-color"]),"icon-halo-color":new On(Gr.paint_symbol["icon-halo-color"]),"icon-halo-width":new On(Gr.paint_symbol["icon-halo-width"]),"icon-halo-blur":new On(Gr.paint_symbol["icon-halo-blur"]),"icon-translate":new Pn(Gr.paint_symbol["icon-translate"]),"icon-translate-anchor":new Pn(Gr.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Pn(Gr.paint_symbol["icon-image-cross-fade"]),"text-opacity":new On(Gr.paint_symbol["text-opacity"]),"text-occlusion-opacity":new On(Gr.paint_symbol["text-occlusion-opacity"]),"text-color":new On(Gr.paint_symbol["text-color"],{runtimeType:Nu,getOverride:_=>_.textColor,hasOverride:_=>!!_.textColor}),"text-halo-color":new On(Gr.paint_symbol["text-halo-color"]),"text-halo-width":new On(Gr.paint_symbol["text-halo-width"]),"text-halo-blur":new On(Gr.paint_symbol["text-halo-blur"]),"text-translate":new Pn(Gr.paint_symbol["text-translate"]),"text-translate-anchor":new Pn(Gr.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Pn(Gr.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Pn(Gr.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Pn(Gr.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Pn(Gr.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new On(Gr.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"})}))},PS);class FE extends Iu{constructor(o,g,_e,rt){super(o,kS(),g,_e,rt,o.layout?o.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=Gt([]),this.hasOcclusionOpacityProperties=o.paint!==void 0&&("icon-occlusion-opacity"in o.paint||"text-occlusion-opacity"in o.paint)}_handleSpecialPaintPropertyUpdate(o){o!=="icon-occlusion-opacity"&&o!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(o,g){super.recalculate(o,g),this.appearances&&this.appearances.forEach(rt=>{rt.recalculate(o,g,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const _e=this.layout.get("text-writing-mode");if(_e){const rt=[];for(const ot of _e)rt.indexOf(ot)<0&&rt.push(ot);this.layout._values["text-writing-mode"]=rt}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(o,g,_e,rt){return this._saturation===o&&this._contrast===g&&this._brightnessMin===_e&&this._brightnessMax===rt||(this._colorAdjustmentMatrix=function(ot,at,ut,ft){ot=Xo(ot),at=Js(at);const gt=Nt(),Ct=ot/3,At=1-2*Ct,kt=[At,Ct,Ct,0,Ct,At,Ct,0,Ct,Ct,At,0,0,0,0,1],zt=.5-.5*at,Ut=ft-ut;return Bt(gt,[Ut,0,0,0,0,Ut,0,0,0,0,Ut,0,ut,ut,ut,1],[at,0,0,0,0,at,0,0,0,0,at,0,zt,zt,zt,1]),Bt(gt,gt,kt),gt}(o,g,_e,rt),this._saturation=o,this._contrast=g,this._brightnessMin=_e,this._brightnessMax=rt),this._colorAdjustmentMatrix}getValueAndResolveTokens(o,g,_e,rt){const ot=this.layout.get(o).evaluate(g,{},_e,rt),at=this._unevaluatedLayout._values[o];return at.isDataDriven()||P_(at.value)||!ot?ot:A2(g.properties,ot)}getAppearanceValueAndResolveTokens(o,g,_e,rt,ot){const at=o.getProperty(g);if(!at)return;const ut=at.evaluate(_e,{},rt,ot),ft=o.getUnevaluatedProperties()._values[g];return ft.isDataDriven()||P_(ft.value)||!ut||typeof ut!="string"?ut:A2(_e.properties,ut)}createBucket(o){return new jE(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of kS().paint.overridableProperties){if(!FE.hasPaintOverride(this.layout,o))continue;const g=this.paint.get(o),_e=new P2(g),rt=new Wy(_e,g.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let ot=null;ot=g.value.kind==="constant"||g.value.kind==="source"?new L0("source",rt):new n0("composite",rt,g.value.zoomStops,g.value.interpolationType),this.paint._values[o]=new o0(g.property,ot,g.parameters)}}_handleOverridablePaintPropertyUpdate(o,g,_e){return!(!this.layout||g.isDataDriven()||_e.isDataDriven())&&FE.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,g){const _e=o.get("text-field"),rt=kS().paint.properties[g];let ot=!1;const at=ut=>{for(const ft of ut)if(rt.overrides&&rt.overrides.hasOverride(ft))return void(ot=!0)};if(_e.value.kind==="constant"&&_e.value.value instanceof Su)at(_e.value.value.sections);else if(_e.value.kind==="source"){const ut=gt=>{ot||(gt instanceof Yp&&Zl(gt.value)===m_?at(gt.value.sections):gt instanceof Op?at(gt.sections):gt.eachChild(ut))},ft=_e.value;ft._styleExpression&&ut(ft._styleExpression.expression)}return ot}getProgramIds(){return["symbol"]}getDefaultProgramParams(o,g,_e){return{config:new Fm(this,{zoom:g,lut:_e}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let k2,M2,D2,N2;var MS=Bs([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function BE(_,o,g,_e,rt,ot,at,ut){const ft=[_,o,1,g,_e,1,rt,ot,1],gt=[at,ut,1],Ct=Et([],ft),[At,kt,zt]=ps(gt,gt,Ct);return Rt(ft,ft,[At,0,0,0,kt,0,0,0,zt])}function L2(_,o,g,_e,rt,ot,at,ut){const ft=function(gt,Ct,At,kt,zt,Ut,Kt,er){const Jt=BE(0,0,1,0,1,1,0,1),or=BE(gt,Ct,At,kt,zt,Ut,Kt,er);return Rt(or,or,Et([],Jt))}(_,o,g,_e,rt,ot,at,ut);return[ft[2]/ft[8]/Mn,ft[5]/ft[8]/Mn]}function zE(_){return[_[0],Math.min(Math.max(_[1],-qt),qt)]}class O2 extends Jm{constructor(o,g,_e,rt){super(),this.id=o,this.dispatcher=_e,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(rt),this.options=g,this._dirty=!1}load(o,g){if(this._loaded=g||!1,this.fire(new Np("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return o&&(this.coordinates=o),this._loaded=!0,void this._finishLoading();this._imageRequest=py(this.map._requestManager.transformRequest(this.url,l_.Image),(_e,rt)=>{this._imageRequest=null,this._loaded=!0,_e?this.fire(new d_(_e)):rt&&(this.image=rt instanceof HTMLImageElement?Xl.getImageData(rt):rt,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return o.url?(this._imageRequest&&o.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=o.url,this.load(o.coordinates,this._loaded),this):this}setTexture(o){if(!(o.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new S1(this.map.painter.context,o.handle),this.width=o.dimensions[0],this.height=o.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Np("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(o){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof S1||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(o){if(this.coordinates=o,this._boundsArray=void 0,this._unsupportedCoords=!1,!o.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let g=o[0][1],_e=o[0][1];for(const ot of o)ot[1]>_e&&(_e=ot[1]),ot[1]<g&&(g=ot[1]);const rt=(_e+g)/2;if(rt>qt?this.onNorthPole=!0:rt<-qt&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const ot=o.map(hr.fromLngLat);this.tileID=function(at){let ut=1/0,ft=1/0,gt=-1/0,Ct=-1/0;for(const Kt of at)ut=Math.min(ut,Kt.x),ft=Math.min(ft,Kt.y),gt=Math.max(gt,Kt.x),Ct=Math.max(Ct,Kt.y);const At=Math.max(gt-ut,Ct-ft),kt=Math.max(0,Math.floor(-Math.log2(At))),zt=Math.pow(2,kt);let Ut=Math.floor((ut+gt)/2*zt);return Ut>1&&(Ut-=1),new Co(kt,Ut,Math.floor((ft+Ct)/2*zt))}(ot),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Np("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof S1||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(o){for(const Jt in this.tiles){const or=this.tiles[Jt];or.state!=="loaded"&&(or.state="loaded",or.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const g=N1(new Co(0,0,0),this.map.transform.projection),_e=[g.projection.project(this.coordinates[0][0],this.coordinates[0][1]),g.projection.project(this.coordinates[1][0],this.coordinates[1][1]),g.projection.project(this.coordinates[2][0],this.coordinates[2][1]),g.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(Jt){const or=Jt[1].x-Jt[0].x,lr=Jt[1].y-Jt[0].y,pr=Jt[2].x-Jt[1].x,Sr=Jt[2].y-Jt[1].y,br=Jt[3].x-Jt[2].x,Rr=Jt[3].y-Jt[2].y,Mr=Jt[0].x-Jt[3].x,Lr=Jt[0].y-Jt[3].y,Jr=or*Sr-pr*lr,zr=pr*Rr-br*Sr,sn=br*Lr-Mr*Rr,dn=Mr*lr-or*Lr;return Jr>0&&zr>0&&sn>0&&dn>0||Jr<0&&zr<0&&sn<0&&dn<0}(_e))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const rt=N1(this.tileID,this.map.transform.projection),[ot,at,ut,ft]=this.coordinates.map(Jt=>{const or=rt.projection.project(Jt[0],Jt[1]);return b2(rt,or)._round()});this.perspectiveTransform=L2(ot.x,ot.y,at.x,at.y,ut.x,ut.y,ft.x,ft.y);const gt=this._boundsArray=new B0;gt.emplaceBack(ot.x,ot.y,0,0),gt.emplaceBack(at.x,at.y,Mn,0),gt.emplaceBack(ft.x,ft.y,0,Mn),gt.emplaceBack(ut.x,ut.y,Mn,Mn),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=o.createVertexBuffer(gt,MS.members),this.boundsSegments=Go.simpleSegment(0,0,4,2);const Ct=[],At=[zE((kt=this.coordinates)[0]),zE(kt[1]),zE(kt[2]),zE(kt[3])];var kt;const[zt,Ut,Kt,er]=function(Jt){let or=Jt[0][0],lr=or,pr=Jt[0][1],Sr=pr;for(let br=1;br<Jt.length;br++)Jt[br][0]<or?or=Jt[br][0]:Jt[br][0]>lr&&(lr=Jt[br][0]),Jt[br][1]<pr?pr=Jt[br][1]:Jt[br][1]>Sr&&(Sr=Jt[br][1]);return[or,pr,lr-or,Sr-pr]}(At);{const Jt=new B0,[or,lr,pr,Sr]=function(xn){let vn=xn[0].x,nn=vn,en=xn[0].y,bn=en;for(let Dn=1;Dn<xn.length;Dn++)xn[Dn].x<vn?vn=xn[Dn].x:xn[Dn].x>nn&&(nn=xn[Dn].x),xn[Dn].y<en?en=xn[Dn].y:xn[Dn].y>bn&&(bn=xn[Dn].y);return[vn,en,nn-vn,bn-en]}(_e),br=xn=>[(xn.x-or)/pr,(xn.y-lr)/Sr],[Rr,Mr,Lr,Jr]=_e.map(br),zr=function(xn,vn,nn,en,bn,Dn,Rn,ts){const Vn=BE(0,0,1,0,1,1,0,1);return Rt(Vn,Vn,Et([],BE(xn,vn,nn,en,bn,Dn,Rn,ts)))}(Rr[0],Rr[1],Mr[0],Mr[1],Lr[0],Lr[1],Jr[0],Jr[1]);this.elevatedGlobePerspectiveTransform=L2(Rr[0],Rr[1],Mr[0],Mr[1],Lr[0],Lr[1],Jr[0],Jr[1]);const sn=(xn,vn)=>{Ct.push(xn.lng);const nn=Math.round((xn.lng-zt)/Kt*Mn),en=Math.round((xn.lat-Ut)/er*Mn),bn=br(vn),Dn=ps([],[bn[0],bn[1],1],zr),Rn=Math.round(Dn[0]/Dn[2]*Mn),ts=Math.round(Dn[1]/Dn[2]*Mn);Jt.emplaceBack(nn,en,Rn,ts)},dn=_e[3].x-_e[0].x,pn=_e[3].y-_e[0].y,wn=_e[2].x-_e[1].x,Tn=_e[2].y-_e[1].y;for(let xn=0;xn<65;xn++){const vn=xn/64,nn=[_e[0].x+vn*dn,_e[0].y+vn*pn],en=[_e[1].x+vn*wn,_e[1].y+vn*Tn],bn=en[0]-nn[0],Dn=en[1]-nn[1];for(let Rn=0;Rn<65;Rn++){const ts=Rn/64,Vn={x:nn[0]+bn*ts,y:nn[1]+Dn*ts};sn(g.projection.unproject(Vn.x,Vn.y),Vn)}}this.elevatedGlobeVertexBuffer=o.createVertexBuffer(Jt,MS.members)}{this.maxLongitudeTriangleSize=0;let Jt=[],or=new Fl;const lr=(pr,Sr,br)=>{or.emplaceBack(pr,Sr,br);const Rr=Ct[pr],Mr=Ct[Sr],Lr=Ct[br],Jr=Math.min(Math.min(Rr,Mr),Lr),zr=Math.max(Math.max(Rr,Mr),Lr)-Jr;zr>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=zr),Jt.push(Jr+zr/2)};for(let pr=0;pr<64;pr++)for(let Sr=0;Sr<64;Sr++){const br=65*pr+Sr,Rr=br+1,Mr=br+65,Lr=Mr+1;lr(br,Mr,Rr),lr(Rr,Mr,Lr)}[Jt,or]=function(pr,Sr){const br=Array.from({length:pr.length},(Lr,Jr)=>Jr);br.sort((Lr,Jr)=>pr[Lr]-pr[Jr]);const Rr=[],Mr=new Fl;for(let Lr=0;Lr<br.length;Lr++){const Jr=br[Lr];Rr.push(pr[Jr]);const zr=3*Jr,sn=zr+1;Mr.emplaceBack(Sr.uint16[zr],Sr.uint16[sn],Sr.uint16[sn+1])}return[Rr,Mr]}(Jt,or),this.elevatedGlobeTrianglesCenterLongitudes=Jt,this.elevatedGlobeIndexBuffer=o.createIndexBuffer(or)}this.elevatedGlobeSegments=Go.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,Kt/Mn,0,er/Mn,0,0,Ut,zt,0])}prepare(){const o=Object.keys(this.tiles).length!==0;if(this.tileID&&!o)return;const g=this.map.painter.context,_e=g.gl;!this._dirty||this.texture instanceof S1||(this.texture?this.texture.update(this.image):(this.texture=new iS(g,this.image,_e.RGBA8),this.texture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)),this._dirty=!1),o&&this._prepareData(g)}loadTile(o,g){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},g(null)):(o.state="errored",g(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(o){const g=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!g)return null;const _e=this.elevatedGlobeTrianglesCenterLongitudes;let rt=(ot=o+180)+360*Math.round((_e[0]-ot)/360);var ot;const at=new Go,ut=(At,kt)=>{at.segments.push({vertexOffset:0,primitiveOffset:At,vertexLength:g.segments[0].vertexLength,primitiveLength:kt,sortKey:void 0,vaos:{}})},ft=.51*this.maxLongitudeTriangleSize;if(Math.abs(_e[0]-rt)<=ft){const At=Ko(_e,0,_e.length,rt+ft);return At===_e.length||ut(At,Ol(_e,At+1,_e.length,rt+360-ft)-At),at}rt<_e[0]&&(rt+=360);const gt=Ol(_e,0,_e.length,rt-ft);if(gt===_e.length)return ut(0,_e.length),at;ut(0,gt-0);const Ct=Ko(_e,gt+1,_e.length,rt+ft);return Ct!==_e.length&&ut(Ct,_e.length-Ct),at}}const DM=(Math.pow(256,2)-1)/16907520;class j2 extends Iu{constructor(o,g,_e,rt){super(o,{layout:D2||(D2=new ga({visibility:new Pn(Gr.layout_raster.visibility)})),paint:N2||(N2=new ga({"raster-opacity":new Pn(Gr.paint_raster["raster-opacity"]),"raster-color":new l0(Gr.paint_raster["raster-color"]),"raster-color-mix":new Pn(Gr.paint_raster["raster-color-mix"]),"raster-color-range":new Pn(Gr.paint_raster["raster-color-range"]),"raster-hue-rotate":new Pn(Gr.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Pn(Gr.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Pn(Gr.paint_raster["raster-brightness-max"]),"raster-saturation":new Pn(Gr.paint_raster["raster-saturation"]),"raster-contrast":new Pn(Gr.paint_raster["raster-contrast"]),"raster-resampling":new Pn(Gr.paint_raster["raster-resampling"]),"raster-fade-duration":new Pn(Gr.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Pn(Gr.paint_raster["raster-emissive-strength"]),"raster-array-band":new Pn(Gr.paint_raster["raster-array-band"]),"raster-elevation":new Pn(Gr.paint_raster["raster-elevation"]),"raster-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"})}))},g,_e,rt),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(o){return!(o&&o._source instanceof O2&&(o._source.onNorthPole||o._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(o){o!=="raster-color"&&o!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(o){if(!this.hasColorMap()||!this._curRampRange)return;const g=this._transitionablePaint._values["raster-color"].value.expression,[_e,rt]=o||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(_e)&&isNaN(rt)||_e===this._curRampRange[0]&&rt===this._curRampRange[1]||(this.colorRamp=u1({expression:g,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:_e,end:rt}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[_e,rt])}}let F2,B2,z2,V2,U2;class $2 extends Iu{constructor(o,g,_e,rt){super(o,{layout:F2||(F2=new ga({visibility:new Pn(Gr["layout_raster-particle"].visibility)})),paint:B2||(B2=new ga({"raster-particle-array-band":new Pn(Gr["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Pn(Gr["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new l0(Gr["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Pn(Gr["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Pn(Gr["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Pn(Gr["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Pn(Gr["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Pn(Gr["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"})}))},g,_e,rt),this._updateColorRamp(),this.lastInvalidatedAt=Xl.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(o){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(o){return!1}_handleSpecialPaintPropertyUpdate(o){o!=="raster-particle-color"&&o!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),o==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const o=this._transitionablePaint._values["raster-particle-color"].value.expression,g=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=u1({expression:o,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:g}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Xl.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class NM extends Iu{constructor(o,g){super(o,{},g,null),this.implementation=o,o.slot&&(this.slot=o.slot)}is3D(o){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(o){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}function DS(_,o,g){const _e=[0,0,1],rt=xa([]);return Eu(rt,rt,g?-Fs(_)+Math.PI:Fs(_)),Il(rt,rt,-Fs(o)),Rl(_e,_e,rt),ls(_e,_e)}const G2={None:0,Model:1,Symbol:2,FillExtrusion:4};class VE{constructor(o,g,_e,rt){this.message=(o?`${o}: `:"")+_e,rt&&(this.identifier=rt),g!=null&&g.__line__&&(this.line=g.__line__)}}function NS(_,o){const g=_.indexOf("://")===-1;try{return new URL(_,g&&o?"http://example.com":void 0),!0}catch{return!1}}class H2{constructor(o,g){this.feature=o,this.instancedDataOffset=g,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class W2{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Jv,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(o){const g=16*o,_e=this.instancedDataArray.float32;let rt=Math.floor(_e[g+2]);const ot=1.05*(_e[g+2]-rt);return rt/=100,[_e[g]%1*1.05,_e[g+1]%1*1.05,ot,rt]}tileCoordinatesForInstance(o){const g=16*o,_e=this.instancedDataArray.float32;let rt=_e[g+0];return rt=rt>Mn?rt-Mn:rt,new mn(Math.trunc(rt),Math.trunc(_e[g+1]))}translationForInstance(o){const g=16*o,_e=this.instancedDataArray.float32;return[_e[g+4],_e[g+5],_e[g+6]]}rotationScaleForInstance(o){const g=16*o,_e=this.instancedDataArray.float32;return[_e[g+7],_e[g+8],_e[g+9],_e[g+10],_e[g+11],_e[g+12],_e[g+13],_e[g+14],_e[g+15]]}transformForInstance(o){const g=16*o,_e=this.instancedDataArray.float32;return[_e[g+7],_e[g+8],_e[g+9],_e[g+4],_e[g+10],_e[g+11],_e[g+12],_e[g+5],_e[g+13],_e[g+14],_e[g+15],_e[g+6],0,0,0,1]}}class LS{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaledZ=this.canonical.z+Math.log2(o.overscaling),this.layers=o.layers,this.layerIds=this.layers.map(g=>g.fqid),this.projection=o.projection,this.index=o.index,this.worldview=o.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=o.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(o,g){}updateAppearances(o,g,_e,rt){}populate(o,g,_e,rt){this.tileToMeter=ir(_e);const ot=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:at,id:ut,index:ft,sourceLayerIndex:gt}of o){const Ct=ut??(at.properties&&at.properties.hasOwnProperty("id")?at.properties.id:void 0),At=Br(at,ot);if(!this.layers[0]._featureFilter.filter(new Do(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),At,_e))continue;const kt={id:Ct,sourceLayerIndex:gt,index:ft,geometry:ot?At.geometry:Pr(at,_e,rt),properties:at.properties,type:at.type,patterns:{}},zt=this.addFeature(kt,kt.geometry,At);zt&&g.featureIndex.insert(at,kt.geometry,ft,gt,this.index,this.instancesPerModel[zt].instancedDataArray.length,Mn/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const o=this.layers[0].modelManager,g=this.layers[0].scope;let _e=0;for(const rt of this.modelUris){const ot=o.getModel(rt,g);if(!ot)continue;const at=this.instancesPerModel[rt];if(at){const ut=.5*vs(ot.aabb.max,ot.aabb.min)*at.maxScale+at.maxXYTranslationDistance,ft=Math.min(Mn,Math.max(ut/this.tileToMeter,Mn/32));_e=Math.max(ft,_e)}}return _e}update(o,g,_e,rt){for(const ot in this.instancesPerModel){const at=this.instancesPerModel[ot];for(const ut in o)at.idToFeaturesIndex.hasOwnProperty(ut)&&(this.evaluate(at.features[at.idToFeaturesIndex[ut]],o[ut],at,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let o=!1;for(const g in this.instancesPerModel){const _e=this.instancesPerModel[g];for(const rt of _e.features){const ot=this.layers[0],at=rt.feature,ut=this.canonical,ft=ot.paint.get("model-rotation").evaluate(at,{},ut),gt=ot.paint.get("model-scale").evaluate(at,{},ut),Ct=ot.paint.get("model-translation").evaluate(at,{},ut);Vo(rt.rotation,ft)&&Vo(rt.scale,gt)&&Vo(rt.translation,Ct)||(this.evaluate(rt,rt.featureStates,_e,!0),o=!0)}}return o}updateReplacement(o,g,_e,rt){if(g.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=g.updateTime;const ot=g.getReplacementRegionsForTile(o.toUnwrapped(),!0);if(hE(this.activeReplacements,ot))return!1;this.activeReplacements=ot;let at=!1;for(const ut in this.instancesPerModel){const ft=this.instancesPerModel[ut],gt=ft.instancedDataArray;for(const Ct of ft.features){const At=Ct.instancedDataOffset,kt=Ct.instancedDataCount;for(let zt=0;zt<kt;zt++){const Ut=16*(zt+At);let Kt=gt.float32[Ut+0];const er=Kt>Mn;Kt=er?Kt-Mn:Kt;const Jt=Math.floor(Kt),or=Math.floor(gt.float32[Ut+1]);let lr=!1;for(const pr of this.activeReplacements)if(!MC(pr,_e,G2.Model,rt)&&!(pr.min.x>Jt||Jt>pr.max.x||pr.min.y>or||or>pr.max.y)&&(lr=jC(OC(Jt,or,o.canonical,pr.footprintTileId.canonical),pr.footprint),lr))break;gt.float32[Ut]=lr?Kt+Mn:Kt,at=at||lr!==er}}}return at}isEmpty(){for(const o in this.instancesPerModel)if(this.instancesPerModel[o].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(o){if(!this.uploaded)for(const g in this.instancesPerModel){const _e=this.instancesPerModel[g];_e.instancedDataArray.length<0||_e.instancedDataArray.length===0||(_e.instancedDataBuffer?_e.instancedDataBuffer.updateData(_e.instancedDataArray):_e.instancedDataBuffer=o.createVertexBuffer(_e.instancedDataArray,nP.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(o){for(const _e in this.instancesPerModel){const rt=this.instancesPerModel[_e];rt.instancedDataArray.length!==0&&rt.instancedDataBuffer&&rt.instancedDataBuffer.destroy()}const g=this.layers[0].modelManager;if(o&&g&&this.modelUris&&this.modelsRequested)for(const _e of this.modelUris)g.removeModel(_e,"",!0)}addFeature(o,g,_e){const rt=this.layers[0],ot=rt.layout.get("model-id").evaluate(_e,{},this.canonical);if(!ot)return $n(`modelId is not evaluated for layer ${rt.id} and it is not going to get rendered.`),ot;(NS(ot,!1)||this.styleDefinedModelURLs[ot]!==void 0)&&(this.modelUris.includes(ot)||this.modelUris.push(ot)),this.instancesPerModel[ot]||(this.instancesPerModel[ot]=new W2);const at=this.instancesPerModel[ot],ut=at.instancedDataArray,ft=new H2(_e,ut.length);for(const gt of g)for(const Ct of gt){if(Ct.x<0||Ct.x>=Mn||Ct.y<0||Ct.y>=Mn)continue;if(this.lookupDim!==0){const kt=(this.lookupDim-1)/Mn,zt=this.lookupDim*(Ct.y*kt|0)+Ct.x*kt|0;if(this.lookup){if(this.lookup[zt]!==0)continue;this.lookup[zt]=1}}this.instanceCount++;const At=ut.length;ut.resize(At+1),at.instancesEvaluatedElevation.push(0),ut.float32[16*At]=Ct.x,ut.float32[16*At+1]=Ct.y}return ft.instancedDataCount=at.instancedDataArray.length-ft.instancedDataOffset,ft.instancedDataCount>0&&(o.id&&(at.idToFeaturesIndex[o.id]=at.features.length),at.features.push(ft),this.evaluate(ft,{},at,!1)),ot}getModelUris(){return this.modelUris}evaluate(o,g,_e,rt){const ot=this.layers[0],at=o.feature,ut=this.canonical,ft=o.rotation=ot.paint.get("model-rotation").evaluate(at,g,ut),gt=o.scale=ot.paint.get("model-scale").evaluate(at,g,ut),Ct=o.translation=ot.paint.get("model-translation").evaluate(at,g,ut),At=Object.assign({},ot.paint.get("model-color").evaluate(at,g,ut));At.a=ot.paint.get("model-color-mix-intensity").evaluate(at,g,ut);const kt=[];this.maxVerticalOffset<Ct[2]&&(this.maxVerticalOffset=Ct[2]);const zt=Ct[0]*Ct[0]+Ct[1]*Ct[1],Ut=zt>0?Math.sqrt(zt):0;_e.maxScale=Math.max(Math.max(_e.maxScale,gt[0]),Math.max(gt[1],gt[2])),_e.maxXYTranslationDistance=Math.max(_e.maxXYTranslationDistance,Ut),this.maxScale=Math.max(Math.max(this.maxScale,gt[0]),Math.max(gt[1],gt[2])),EA(kt,ft,gt);const Kt=Math.round(100*At.a)+At.b/1.05;for(let er=0;er<o.instancedDataCount;++er){const Jt=o.instancedDataOffset+er,or=16*Jt,lr=_e.instancedDataArray.float32;let pr=0;rt&&(pr=lr[or+6]-_e.instancesEvaluatedElevation[Jt]);const Sr=0|lr[or+1];lr[or]=(0|lr[or])+At.r/1.05,lr[or+1]=Sr+At.g/1.05,lr[or+2]=Kt,lr[or+3]=1/(ut.z>10?this.tileToMeter:ir(ut,Sr)),lr[or+4]=Ct[0],lr[or+5]=Ct[1],lr[or+6]=Ct[2]+pr,lr[or+7]=kt[0],lr[or+8]=kt[1],lr[or+9]=kt[2],lr[or+10]=kt[4],lr[or+11]=kt[5],lr[or+12]=kt[6],lr[or+13]=kt[8],lr[or+14]=kt[9],lr[or+15]=kt[10],_e.instancesEvaluatedElevation[Jt]=Ct[2]}}}let q2,K2;qn(LS,"ModelBucket",{omit:["layers"]}),qn(W2,"PerModelAttributes"),qn(H2,"ModelFeature");class Ux{constructor(o,g,_e){this._demTile=o,this._dem=this._demTile.dem,this._scale=g,this._offset=_e}static create(o,g,_e){const rt=_e||o.findDEMTileFor(g);if(!rt||!rt.dem)return;const ot=rt.dem,at=rt.tileID,ut=1<<g.canonical.z-at.canonical.z;return new Ux(rt,ot.dim/Mn/ut,[(g.canonical.x/ut-at.canonical.x)*ot.dim,(g.canonical.y/ut-at.canonical.y)*ot.dim])}tileCoordToPixel(o,g){const _e=g*this._scale+this._offset[1];return new mn(Math.floor(o*this._scale+this._offset[0]),Math.floor(_e))}getElevationAt(o,g,_e,rt){const ot=o*this._scale+this._offset[0],at=g*this._scale+this._offset[1],ut=Math.floor(ot),ft=Math.floor(at),gt=this._dem;return rt=!!rt,_e?fs(fs(gt.get(ut,ft,rt),gt.get(ut,ft+1,rt),at-ft),fs(gt.get(ut+1,ft,rt),gt.get(ut+1,ft+1,rt),at-ft),ot-ut):gt.get(ut,ft,rt)}getElevationAtPixel(o,g,_e){return this._dem.get(o,g,!!_e)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*Pt(1,o)*this._dem.stride}}const OS=new Float32Array(262144),Q_=new Uint8Array(262144);function X2(_){let o=0;if(_.meshes)for(const g of _.meshes)o=Math.max(o,g.aabb.max[2]);if(_.children)for(const g of _.children)o=Math.max(o,X2(g));return o}function Z2(_,o,g){if(_.meshes)for(const _e of _.meshes){if(_e.aabb.min[0]===1/0)continue;const rt=Jn.applyTransform(_e.aabb,_.globalMatrix);g.insert(o,rt.min[0],rt.min[1],rt.max[0],rt.max[1])}if(_.children)for(const _e of _.children)Z2(_e,o,g)}const Y2=["","wall","door","roof","window","lamp","logo"];class Q2{constructor(o){this.node=o,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:o.id,geometry:[],properties:{height:X2(o)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Jn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let o=0;const g=new Jn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const _e of this.node.meshes)this.node.lightMeshIndex!==o&&(_e.transformedAabb=Jn.applyTransformFast(_e.aabb,this.node.globalMatrix),g.encapsulate(_e.transformedAabb)),o++;this.aabb=g}return this.aabb}}class UE{constructor(o,g,_e,rt,ot,at,ut,ft){this.id=_e,this.layers=o,this.layerIds=this.layers.map(gt=>gt.fqid),this.stateDependentLayerIds=this.layers.filter(gt=>gt.isStateDependent()).map(gt=>gt.id),this.modelTraits|=Dx.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,rt&&(this.modelTraits|=Dx.HasMapboxMeshFeatures),ot&&(this.modelTraits|=Dx.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=at,this.worldview=ft,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const gt of g)this.nodesInfo.push(new Q2(gt)),Z2(gt,ut.featureIndexArray.length,ut.grid),ut.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,ut.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(o,g){for(const _e of this.getNodesInfo()){const rt=_e.node;rt.footprint&&g.push({footprint:rt.footprint,id:o})}}updateAppearances(o,g,_e,rt){}update(o){const g=Object.keys(o).length!==0;if(g&&!this.stateDependentLayers.length)return;const _e=g?this.stateDependentLayers:this.layers;if(!du(o,this.states))for(const rt of _e)this.evaluate(rt,o);this.states=structuredClone(o)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(o){if(!this.needsUpload)return;const g=this.getNodesInfo();for(const _e of g){const rt=_e.node;this.uploaded?this.updatePbrBuffer(rt):oS(rt,o,!0)}for(const _e of g)EE(_e.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(o){let g=!1;if(!o.meshes)return g;for(const _e of o.meshes)_e.pbrBuffer&&(_e.pbrBuffer.updateData(_e.featureArray),g=!0);return g}needsReEvaluation(o,g,_e){const rt=o.transform.projectionOptions,ot=o.style.getBrightness(),at=this.brightness!==ot;if(!this.uploaded||this.dirty||rt.name!==this.projection.name||U1(_e.paint.get("model-color").value,at)||U1(_e.paint.get("model-color-mix-intensity").value,at)||U1(_e.paint.get("model-roughness").value,at)||U1(_e.paint.get("model-emissive-strength").value,at)||U1(_e.paint.get("model-height-based-emissive-strength-multiplier").value,at)){this.projection=rt,this.brightness=ot;const ut=this.getNodesInfo();for(const ft of ut)ft.state=null;return!0}return!1}evaluateTransform(o,g){if(o.transform.zoom===this.zoom)return;this.zoom=o.transform.zoom;const _e=this.getNodesInfo(),rt=this.id.canonical;for(const ot of _e){const at=ot.feature;ot.evaluatedTranslation=g.paint.get("model-translation").evaluate(at,{},rt),ot.evaluatedScale=g.paint.get("model-scale").evaluate(at,{},rt)}}evaluate(o,g){const _e=this.getNodesInfo();for(const rt of _e){if(!rt.node.meshes)continue;const ot=rt.feature,at=g&&g[ot.id];if(du(at,rt.state))continue;rt.state=structuredClone(at);const ut=rt.node.meshes&&rt.node.meshes[0].featureData,ft=rt.evaluatedColor[2],gt=rt.evaluatedRMEA[2],Ct=this.id.canonical;if(rt.hasTranslucentParts=!1,ut){for(let At=0;At<Y2.length;At++){const kt=Y2[At];kt.length&&(ot.properties.part=kt);const zt=o.paint.get("model-color").evaluate(ot,at,Ct).toPremultipliedRenderColor(null),Ut=o.paint.get("model-color-mix-intensity").evaluate(ot,at,Ct);rt.evaluatedColor[At]=[zt.r,zt.g,zt.b,Ut],rt.evaluatedRMEA[At][0]=o.paint.get("model-roughness").evaluate(ot,at,Ct),rt.evaluatedRMEA[At][2]=o.paint.get("model-emissive-strength").evaluate(ot,at,Ct),rt.evaluatedRMEA[At][3]=zt.a,rt.emissionHeightBasedParams[At]=o.paint.get("model-height-based-emissive-strength-multiplier").evaluate(ot,at,Ct),!rt.hasTranslucentParts&&zt.a<1&&(rt.hasTranslucentParts=!0)}delete ot.properties.part,OM(rt,ft!==rt.evaluatedColor[2]||gt!==rt.evaluatedRMEA[2],this.modelTraits)}else rt.evaluatedRMEA[0][2]=o.paint.get("model-emissive-strength").evaluate(ot,at,Ct);rt.evaluatedTranslation=o.paint.get("model-translation").evaluate(ot,at,Ct),rt.evaluatedScale=o.paint.get("model-scale").evaluate(ot,at,Ct),this.updatePbrBuffer(rt.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(o,g,_e,rt){const ot=o.findDEMTileFor(_e);if(ot&&(ot.tileID.canonical!==this.terrainTile||g!==this.terrainExaggeration)){if(ot.dem&&ot.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=ot.tileID.overscaledZ;const at=Ux.create(o,_e,ot);if(!at)return;this.modelTraits&Dx.HasMapboxMeshFeatures&&this.updateDEM(o,at,_e,rt);for(const ut of this.getNodesInfo()){const ft=ut.node;if(!ft.footprint||!ft.footprint.vertices||!ft.footprint.vertices.length)continue;const gt=ft.footprint.vertices;let Ct=at.getElevationAt(gt[0].x,gt[0].y,!0,!0);for(let At=1;At<gt.length;At++)Ct=Math.min(Ct,at.getElevationAt(gt[At].x,gt[At].y,!0,!0));ft.elevation=Ct}}this.terrainTile=ot.tileID.canonical,this.terrainExaggeration=g}}updateDEM(o,g,_e,rt){let ot=g._dem._modifiedForSources[rt];if(ot===void 0&&(g._dem._modifiedForSources[rt]=[],ot=g._dem._modifiedForSources[rt]),ot.includes(_e.canonical))return;const at=g._dem.dim;ot.push(_e.canonical);let ut=!1;for(const ft of this.getNodesInfo()){const gt=ft.node;if(!gt.footprint||!gt.footprint.grid)continue;const Ct=gt.footprint.grid,At=g.tileCoordToPixel(Ct.min.x,Ct.min.y),kt=g.tileCoordToPixel(Ct.max.x,Ct.max.y),zt=Math.min(Math.min(at-kt.y,At.x),Math.min(At.y,at-kt.x));if(zt<0)continue;const Ut=tr(zt,2,5);let Kt=Math.max(0,At.x-Ut),er=Math.max(0,At.y-Ut),Jt=Math.min(kt.x+Ut,at-1),or=Math.min(kt.y+Ut,at-1);for(let br=er;br<=or;++br)for(let Rr=Kt;Rr<=Jt;++Rr)Q_[br*at+Rr]=255;let lr=0,pr=0;for(let br=0;br<Ct.cellsY;++br)for(let Rr=0;Rr<Ct.cellsX;++Rr){if(!Ct.cells[br*Ct.cellsX+Rr])continue;const Mr=g.tileCoordToPixel(Ct.min.x+Rr/Ct.xScale,Ct.min.y+br/Ct.yScale),Lr=g.tileCoordToPixel(Ct.min.x+(Rr+1)/Ct.xScale,Ct.min.y+(br+1)/Ct.yScale);for(let Jr=Mr.y;Jr<=Math.min(Lr.y+1,at-1);++Jr)for(let zr=Mr.x;zr<=Math.min(Lr.x+1,at-1);++zr)Q_[Jr*at+zr]===255&&(Q_[Jr*at+zr]=0,lr+=g.getElevationAtPixel(zr,Jr),pr++)}const Sr=lr/pr;Kt=Math.max(1,At.x-Ut),er=Math.max(1,At.y-Ut),Jt=Math.min(kt.x+Ut,at-2),or=Math.min(kt.y+Ut,at-2),ut=!0;for(let br=er;br<=or;++br)for(let Rr=Kt;Rr<=Jt;++Rr)Q_[br*at+Rr]===0&&(OS[br*at+Rr]=g._dem.set(Rr,br,Sr));for(let br=1;br<Ut;++br){Kt=Math.max(1,At.x-br),er=Math.max(1,At.y-br),Jt=Math.min(kt.x+br,at-2),or=Math.min(kt.y+br,at-2);for(let Rr=er;Rr<=or;++Rr)for(let Mr=Kt;Mr<=Jt;++Mr){const Lr=Rr*at+Mr;if(Q_[Lr]===255){let Jr=0,zr=0,sn=-1,dn=-1;for(let pn=-1;pn<=1;++pn)for(let wn=-1;wn<=1;++wn){const Tn=(Rr+pn)*at+Mr+wn;if(Q_[Tn]>=br)continue;const xn=OS[Tn],vn=Math.abs(xn);vn>zr&&(Jr=xn,zr=vn,sn=wn,dn=pn)}if(zr>.1){const pn=1-(br+.5*Math.abs(sn*dn))/Ut;let wn=g._dem.get(Mr,Rr)+Jr*pn;const Tn=g._dem.get(Mr+sn,Rr+dn),xn=g._dem.get(Mr-sn,Rr-dn,!0);(wn-Tn)*(wn-xn)>0&&(wn=(Tn+xn)/2),OS[Lr]=g._dem.set(Mr,Rr,wn),Q_[Lr]=br}}}}}ut&&(g._demTile.needsDEMTextureUpload=!0,g._dem._timestamp=Xl.now())}setFilter(o){this.filter=o?tx(o):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(o=>this.filter.filter(new Do(this.id.overscaledZ,{worldview:this.worldview}),o.feature,this.id.canonical)):this.nodesInfo}destroy(){const o=this.getNodesInfo();for(const g of o)EE(g.node),aS(g.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(o,g){if(g.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=g.updateTime;const _e=g.getReplacementRegionsForTile(o.toUnwrapped());for(const rt of this.getNodesInfo()){const ot=rt.node.footprint;rt.hiddenByReplacement=!!ot&&!_e.find(at=>at.footprint===ot)}}getHeightAtTileCoord(o,g){const _e=[],rt=[0,0,0],ot=Gt([]);for(const at of this.getNodesInfo()){const ut=at.node.meshes[0],ft=ut.transformedAabb;if(o<ft.min[0]||g<ft.min[1]||o>ft.max[0]||g>ft.max[1])continue;if(at.node.hidden===!0)return{height:1/0,maxHeight:at.feature.properties.height,hidden:!1,verticalScale:at.evaluatedScale[2]};Dt(ot,at.node.globalMatrix),rt[0]=o,rt[1]=g,ws(rt,rt,ot);const gt=(rt[0]-ut.aabb.min[0])/(ut.aabb.max[0]-ut.aabb.min[0])*X_|0,Ct=Math.min(63,(rt[1]-ut.aabb.min[1])/(ut.aabb.max[1]-ut.aabb.min[1])*X_|0)*X_+Math.min(63,gt),At=ut.heightmap[Ct];if(!(At<0&&at.node.footprint))return at.hiddenByReplacement?void 0:{height:At,maxHeight:at.feature.properties.height,hidden:!1,verticalScale:at.evaluatedScale[2]};if(at.node.footprint.grid.query(new mn(o,g),new mn(o,g),_e),_e.length>0)return{height:void 0,maxHeight:at.feature.properties.height,hidden:at.hiddenByReplacement,verticalScale:at.evaluatedScale[2]}}}}function U1(_,o){return _ instanceof L0&&!_.isLightConstant&&o}function LM(_,o,g,_e,rt,ot,at,ut){let ft=(61440&o|(61440&o)>>4)>>8,gt=(3840&o|(3840&o)>>4)>>4,Ct=240&o|(240&o)>>4;g[3]>0&&(ft=fs(ft,255*g[0],g[3]),gt=fs(gt,255*g[1],g[3]),Ct=fs(Ct,255*g[2],g[3]));const At=ft<<8|gt,kt=Ct<<8|Math.floor(255*_e[3]),zt=function(br){const Rr=tr(br,0,2);return Math.min(Math.round(.5*Rr*255),255)}(_e[2])<<8|15*_e[0]<<4|15*_e[1],Ut=tr(rt[0],0,1),Kt=tr(rt[1],0,1),er=tr(rt[2],0,1),Jt=tr(rt[3],0,1);let or,lr,pr,Sr;if(Ut!==Kt&&at!==ot&&Kt!==Ut){const br=at-ot;lr=1/(br*(Kt-Ut)),pr=-(ot+br*Ut)/(br*(Kt-Ut));const Rr=tr(rt[4],-1,1);Sr=Math.pow(10,Rr),or=255*er<<8|255*Jt}else or=65535,lr=0,pr=1,Sr=1;if(_.emplaceBack(At,kt,zt,or,lr,pr,Sr),ut){const br=ut.length;ut.clear();for(let Rr=0;Rr<br;Rr++)ut.emplaceBack(At,kt,zt,or,lr,pr,Sr)}}function OM(_,o,g){const _e=_.node;let rt=0;const ot=g&Dx.HasMeshoptCompression;for(const at of _e.meshes){if(_e.lights&&_e.lightMeshIndex===rt||!at.featureData)continue;at.featureArray=new fx,at.featureArray.reserve(at.featureData.length);let ut=o;for(const ft of at.featureData){const gt=ot?65535&ft:ft>>16&65535,Ct=ot?ft>>16&65535:65535&ft,At=(15&Ct)<8?15&Ct:0,kt=_.evaluatedRMEA[At],zt=_.evaluatedColor[At],Ut=_.emissionHeightBasedParams[At];let Kt;if(ut&&At===2&&_e.lights&&(Kt=new fx,Kt.resize(10*_e.lights.length)),LM(at.featureArray,gt,zt,kt,Ut,at.aabb.min[2],at.aabb.max[2],Kt),Kt&&ut){ut=!1;const er=_e.meshes[_e.lightMeshIndex];er.featureArray=Kt,er.featureArray._trim()}}at.featureArray._trim(),rt++}}qn(UE,"Tiled3dModelBucket",{omit:["layers"]}),qn(Q2,"Tiled3dModelFeature");const jM=["id","tile","layer","source","sourceLayer","state"];class J_{constructor(o,g,_e,rt,ot){this.type="Feature",this._vectorTileFeature=o,this._z=g,this._x=_e,this._y=rt,this.properties=o?o.properties:{},this.id=ot}clone(){const o=new J_(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(o.state=Object.assign({},this.state)),this.layer&&(o.layer=Object.assign({},this.layer)),this.source&&(o.source=this.source),this.sourceLayer&&(o.sourceLayer=this.sourceLayer),o}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const g of jM)this[g]!==void 0&&(o[g]=this[g]);return o}}class ey extends Jm{constructor(o,g,_e,rt){super(),this.id=o,this.type="model",this.models=[],this._loaded=!1,this._options=g,this._modelsInfo=new Map}load(){const o=[];for(const g in this._options.models){const _e=this._options.models[g],rt=this._modelsInfo.get(g);if(rt){const ot=rt.model;ot.position=_e.position!=null?new $(_e.position[0],_e.position[1]):new $(0,0),ot.orientation=_e.orientation!=null?_e.orientation:[0,0,0],rt.modelSpec=_e,ey.applyModelSpecification(ot,_e),ot.computeBoundsAndApplyParent(),this.models.push(ot)}else{const ot=xA(this.map._requestManager.transformRequest(_e.uri,l_.Model).url).then(at=>{if(!at)return;const ut=cS(at),ft=new TA(g,_e.uri,_e.position,_e.orientation,ut);ey.applyModelSpecification(ft,_e),ft.computeBoundsAndApplyParent(),this.models.push(ft),this._modelsInfo.set(g,{modelSpec:_e,model:ft})}).catch(at=>{this.fire(new d_(new Error(`Could not load model ${g} from ${_e.uri}: ${at.message}`)))});o.push(ot)}}Promise.allSettled(o).then(()=>{this._loaded=!0,this.fire(new Np("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(g=>{this._loaded=!0,this.fire(new d_(new Error(`Could not load models: ${g.message}`)))})}static applyModelSpecification(o,g){g.nodeOverrides&&ey.convertNodeOverrides(o,g.nodeOverrides),g.materialOverrides&&ey.convertMaterialOverrides(o,g.materialOverrides),g.nodeOverrideNames&&(o.nodeOverrideNames=[...g.nodeOverrideNames]),g.materialOverrideNames&&(o.materialOverrideNames=[...g.materialOverrideNames]),g.featureProperties&&(o.featureProperties=g.featureProperties)}static convertNodeOverrides(o,g){if(Array.isArray(g)&&g.every(_e=>typeof _e=="string")){o.nodeOverrideNames=[];for(const _e of g)o.nodeOverrideNames.push(_e)}else Object.entries(g).forEach(([_e,rt])=>{const ot={orientation:[0,0,0]};if(rt.hasOwnProperty("orientation")){const at=rt.orientation;at&&(ot.orientation=at)}o.nodeOverrides.set(_e,ot)})}static convertMaterialOverrides(o,g){if(Array.isArray(g)&&g.every(_e=>typeof _e=="string")){o.materialOverrideNames=[];for(const _e of g)o.materialOverrideNames.push(_e)}else Object.entries(g).forEach(([_e,rt])=>{const ot={color:new fo(1,1,1),colorMix:0,emissionStrength:0,opacity:1},at=rt["model-color"];at!==void 0&&(ot.color.r=at[0],ot.color.g=at[1],ot.color.b=at[2]);const ut=rt["model-color-mix-intensity"];ut!==void 0&&(ot.colorMix=ut);const ft=rt["model-emissive-strength"];ft!==void 0&&(ot.emissionStrength=ft);const gt=rt["model-opacity"];gt!==void 0&&(ot.opacity=gt),o.materialOverrides.set(_e,ot)})}onAdd(o){this.map=o,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(o,g){}serialize(){return this._options}setProperty(o,g){return!1}reload(){const o=Ep(this.id,this.scope);this.map.style.clearSource(o),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(o){this.models=[];const g=new Map;for(const _e in o){const rt=o[_e];if(this._modelsInfo.has(_e)){const ot=this._modelsInfo.get(_e);ot&&ot.modelSpec.uri===rt.uri&&g.set(_e,ot)}}this._modelsInfo=g,this._options.models=o,this._loaded=!1,this.load()}}function jS(_,o,g,_e){const rt=1<<_.z;o.lat=Ht((_e/Mn+_.y)/rt),o.lng=Mt((g/Mn+_.x)/rt)}function FM(_,o,g,_e){const rt=_.getNodesInfo()[o];if(!rt||rt.hiddenByReplacement||!rt.node.meshes)return;let ot=Number.MAX_VALUE;const at=rt.node,ut=g.tile,ft=_e.calculatePosMatrix(ut.tileID.toUnwrapped(),_e.worldSize),gt=rt.evaluatedScale;let Ct=0;_e.elevation&&at.elevation&&(Ct=at.elevation*_e.elevation.exaggeration()),Lt(ft,ft,[(at.anchor?at.anchor[0]:0)*(gt[0]-1),(at.anchor?at.anchor[1]:0)*(gt[1]-1),Ct]),Vt(ft,ft,gt);const At=g.queryGeometry,kt=At.isPointQuery()?At.screenBounds:At.screenGeometry,zt=function(Kt){const er=Bt([],ft,Kt.globalMatrix);Bt(er,_e.expandedFarZProjMatrix,er);for(let Jt=0;Jt<Kt.meshes.length;++Jt){const or=Kt.meshes[Jt];if(Jt===Kt.lightMeshIndex)continue;const lr=sS(kt,_e,er,or.aabb);lr!=null&&(ot=Math.min(lr,ot))}if(Kt.children)for(const Jt of Kt.children)zt(Jt)};if(zt(at),ot===Number.MAX_VALUE)return;const Ut=new $(0,0);return jS(ut.tileID.canonical,Ut,rt.node.anchor[0],rt.node.anchor[1]),{intersectionZ:ot,position:Ut,feature:rt.feature}}const BM={circle:class extends Iu{constructor(_,o,g,_e){super(_,{layout:ju||(ju=new ga({"circle-sort-key":new On(Gr.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Pn(Gr.layout_circle["circle-elevation-reference"]),visibility:new Pn(Gr.layout_circle.visibility)})),paint:_a||(_a=new ga({"circle-radius":new On(Gr.paint_circle["circle-radius"]),"circle-color":new On(Gr.paint_circle["circle-color"]),"circle-blur":new On(Gr.paint_circle["circle-blur"]),"circle-opacity":new On(Gr.paint_circle["circle-opacity"]),"circle-translate":new Pn(Gr.paint_circle["circle-translate"]),"circle-translate-anchor":new Pn(Gr.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Pn(Gr.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Pn(Gr.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new On(Gr.paint_circle["circle-stroke-width"]),"circle-stroke-color":new On(Gr.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new On(Gr.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Pn(Gr.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"})}))},o,g,_e)}createBucket(_){return new mo(_)}queryRadius(_){const o=_;return _u("circle-radius",this,o)+_u("circle-stroke-width",this,o)+nu(this.paint.get("circle-translate"))}queryIntersectsFeature(_,o,g,_e,rt,ot,at,ut){const ft=pp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),ot.angle,_.pixelToTileUnitsFactor),gt=this.paint.get("circle-radius").evaluate(o,g)+this.paint.get("circle-stroke-width").evaluate(o,g);return sC(_,_e,ot,at,ut,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",ft,gt)}getProgramIds(){return["circle"]}getDefaultProgramParams(_,o,g){const _e=nC(this);return{config:new Fm(this,{zoom:o,lut:g}),defines:_e,overrideFog:!1}}is3D(_){return!_&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Iu{createBucket(_){return new aC(_)}constructor(_,o,g,_e){super(_,{layout:lC||(lC=new ga({visibility:new Pn(Gr.layout_heatmap.visibility)})),paint:cC||(cC=new ga({"heatmap-radius":new On(Gr.paint_heatmap["heatmap-radius"]),"heatmap-weight":new On(Gr.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Pn(Gr.paint_heatmap["heatmap-intensity"]),"heatmap-color":new l0(Gr.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Pn(Gr.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"})}))},o,g,_e),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(_){_==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=u1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(_){return _u("heatmap-radius",this,_)}queryIntersectsFeature(_,o,g,_e,rt,ot,at,ut){const ft=this.paint.get("heatmap-radius").evaluate(o,g);return sC(_,_e,ot,at,ut,!0,!0,new mn(0,0),ft)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(_,o,g){return _==="heatmap"?{config:new Fm(this,{zoom:o,lut:g}),overrideFog:!1}:{}}},hillshade:class extends Iu{constructor(_,o,g,_e){super(_,{layout:uC||(uC=new ga({visibility:new Pn(Gr.layout_hillshade.visibility)})),paint:hC||(hC=new ga({"hillshade-illumination-direction":new Pn(Gr.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Pn(Gr.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Pn(Gr.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Pn(Gr.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Pn(Gr.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Pn(Gr.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Pn(Gr.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"})}))},o,g,_e)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(_,o,g){return{overrideFog:!1}}},fill:class extends Iu{constructor(_,o,g,_e){super(_,{layout:CC||(CC=new ga({"fill-sort-key":new On(Gr.layout_fill["fill-sort-key"]),visibility:new Pn(Gr.layout_fill.visibility),"fill-elevation-reference":new Pn(Gr.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new On(Gr.layout_fill["fill-construct-bridge-guard-rail"])})),paint:AC||(AC=new ga({"fill-antialias":new Pn(Gr.paint_fill["fill-antialias"]),"fill-opacity":new On(Gr.paint_fill["fill-opacity"]),"fill-color":new On(Gr.paint_fill["fill-color"]),"fill-outline-color":new On(Gr.paint_fill["fill-outline-color"]),"fill-translate":new Pn(Gr.paint_fill["fill-translate"]),"fill-translate-anchor":new Pn(Gr.paint_fill["fill-translate-anchor"]),"fill-pattern":new On(Gr.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Pn(Gr.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Pn(Gr.paint_fill["fill-emissive-strength"]),"fill-z-offset":new On(Gr.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new On(Gr.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new On(Gr.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"})}))},o,g,_e)}getProgramIds(){const _=this.paint.get("fill-pattern"),o=_&&_.constantOr(1),g=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&g.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),g}getDefaultProgramParams(_,o,g){return{config:new Fm(this,{zoom:o,lut:g}),overrideFog:!1}}recalculate(_,o){super.recalculate(_,o);const g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(_){return new UT(_)}queryRadius(){return nu(this.paint.get("fill-translate"))}queryIntersectsFeature(_,o,g,_e,rt,ot){return!_.queryGeometry.isAboveHorizon&&ao(Zu(_.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),ot.angle,_.pixelToTileUnitsFactor),_e)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(_){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const o=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return _!=null?o&&!_:o}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Iu{constructor(_,o,g,_e){super(_,{layout:JC||(JC=new ga({visibility:new Pn(Gr["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Pn(Gr["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:eA||(eA=new ga({"fill-extrusion-opacity":new Pn(Gr["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new On(Gr["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Pn(Gr["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Pn(Gr["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new On(Gr["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Pn(Gr["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new On(Gr["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new On(Gr["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Pn(Gr["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Pn(Gr["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Pn(Gr["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Pn(Gr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Pn(Gr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Pn(Gr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Pn(Gr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Pn(Gr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Pn(Gr["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Pn(Gr["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new On(Gr["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new On(Gr["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Pn(Gr["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Pn(Gr["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Pn(Gr["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Pn(Gr["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new On(Gr["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new On(Gr["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Pn(Gr["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"})}))},o,g,_e),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(_){return new pE(_)}queryRadius(){return nu(this.paint.get("fill-extrusion-translate"))}is3D(_){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(_,o,g,_e,rt,ot,at,ut,ft){const gt=pp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),ot.angle,_.pixelToTileUnitsFactor),Ct=this.paint.get("fill-extrusion-height").evaluate(o,g),At=this.paint.get("fill-extrusion-base").evaluate(o,g),kt=[0,0],zt=ut&&ot.elevation,Ut=ot.elevation?ot.elevation.exaggeration():1,Kt=_.tile.getBucket(this);if(zt&&Kt instanceof pE){const pr=Kt.centroidVertexArray,Sr=ft+1;Sr<pr.length&&(kt[0]=pr.geta_centroid_pos0(Sr),kt[1]=pr.geta_centroid_pos1(Sr))}if(kt[0]===0&&kt[1]===1)return!1;ot.projection.name==="globe"&&(_e=QC([_e],[new mn(0,0),new mn(Mn,Mn)],_.tileID.canonical).map(pr=>pr.polygon).flat());const er=zt?ut:null,[Jt,or]=aA(ot,_e,At,Ct,gt,at,er,kt,Ut,ot.center.lat,_.tileID.canonical),lr=_.queryGeometry;return oA(Jt,or,lr.isPointQuery()?lr.screenBounds:lr.screenGeometry)}},building:class extends Iu{constructor(_,o,g,_e){super(_,{layout:kA||(kA=new ga({visibility:new Pn(Gr.layout_building.visibility),"building-facade":new On(Gr.layout_building["building-facade"]),"building-facade-floors":new On(Gr.layout_building["building-facade-floors"]),"building-facade-unit-width":new On(Gr.layout_building["building-facade-unit-width"]),"building-facade-window":new On(Gr.layout_building["building-facade-window"]),"building-roof-shape":new On(Gr.layout_building["building-roof-shape"]),"building-height":new On(Gr.layout_building["building-height"]),"building-base":new On(Gr.layout_building["building-base"]),"building-flood-light-wall-radius":new On(Gr.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new On(Gr.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new On(Gr.layout_building["building-flip-roof-orientation"])})),paint:MA||(MA=new ga({"building-opacity":new Pn(Gr.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Pn(Gr.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Pn(Gr.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Pn(Gr.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Pn(Gr.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Pn(Gr.paint_building["building-vertical-scale"]),"building-cast-shadows":new Pn(Gr.paint_building["building-cast-shadows"]),"building-color":new On(Gr.paint_building["building-color"]),"building-emissive-strength":new On(Gr.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Pn(Gr.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Pn(Gr.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Pn(Gr.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Pn(Gr.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Pn(Gr.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"})}))},o,g,_e),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(_){return new PA(_)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(_){return!0}queryRadius(_){return 0}queryIntersectsFeature(_,o,g,_e,rt,ot,at,ut,ft){let gt=this.layout.get("building-height").evaluate(o,g);const Ct=this.layout.get("building-base").evaluate(o,g),At=_.tile.getBucket(this).getFootprint(o);if(At){if(At.hiddenFlags!==0)return!1;gt=At.height}const[kt,zt]=aA(ot,_e,Ct,gt,new mn(0,0),at,null,[0,0],1,ot.center.lat,_.tileID.canonical),Ut=_.queryGeometry;return oA(kt,zt,Ut.isPointQuery()?Ut.screenBounds:Ut.screenGeometry)}},line:class extends Iu{constructor(_,o,g,_e){const rt=UA();super(_,rt,o,g,_e),rt.layout&&(this.layout=new a0(rt.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(_){if(_==="line-gradient"){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof T_,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(_,o){super.recalculate(_,o),this.paint._values["line-floorwidth"]=(()=>{if(A1)return A1;const g=UA();return A1=new NP(g.paint.properties["line-width"].specification),A1.useIntegerZoom=!0,A1})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,_)}createBucket(_){return new dS(_)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(_,o,g){const _e=zA(this);return{config:new Fm(this,{zoom:o,lut:g}),defines:_e,overrideFog:!1}}queryRadius(_){const o=_,g=$A(_u("line-width",this,o),_u("line-gap-width",this,o)),_e=_u("line-offset",this,o);return g/2+Math.abs(_e)+nu(this.paint.get("line-translate"))}queryIntersectsFeature(_,o,g,_e,rt,ot){if(_.queryGeometry.isAboveHorizon)return!1;const at=Zu(_.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),ot.angle,_.pixelToTileUnitsFactor),ut=_.pixelToTileUnitsFactor/2*$A(this.paint.get("line-width").evaluate(o,g),this.paint.get("line-gap-width").evaluate(o,g)),ft=this.paint.get("line-offset").evaluate(o,g);return ft&&(_e=function(gt,Ct){const At=[],kt=new mn(0,0);for(let zt=0;zt<gt.length;zt++){const Ut=gt[zt],Kt=[];for(let er=0;er<Ut.length;er++){const Jt=Ut[er],or=Ut[er+1],lr=er===0?kt:Jt.sub(Ut[er-1])._unit()._perp(),pr=er===Ut.length-1?kt:or.sub(Jt)._unit()._perp(),Sr=lr._add(pr)._unit();Sr._mult(1/(Sr.x*pr.x+Sr.y*pr.y)),Kt.push(Sr._mult(Ct)._add(Jt))}At.push(Kt)}return At}(_e,ft*_.pixelToTileUnitsFactor)),function(gt,Ct,At){for(let kt=0;kt<Ct.length;kt++){const zt=Ct[kt];if(gt.length>=3){for(let Ut=0;Ut<zt.length;Ut++)if(So(gt,zt[Ut]))return!0}if(Zo(gt,zt,At))return!0}return!1}(at,_e,ut)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(_){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:FE,background:class extends Iu{constructor(_,o,g,_e){super(_,{layout:k2||(k2=new ga({visibility:new Pn(Gr.layout_background.visibility)})),paint:M2||(M2=new ga({"background-pitch-alignment":new Pn(Gr.paint_background["background-pitch-alignment"]),"background-color":new Pn(Gr.paint_background["background-color"]),"background-pattern":new Pn(Gr.paint_background["background-pattern"]),"background-opacity":new Pn(Gr.paint_background["background-opacity"]),"background-emissive-strength":new Pn(Gr.paint_background["background-emissive-strength"]),"background-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"})}))},o,g,_e)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(_,o,g){return{overrideFog:!1}}is3D(_){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:j2,"raster-particle":$2,sky:class extends Iu{constructor(_,o,g,_e){super(_,{layout:z2||(z2=new ga({visibility:new Pn(Gr.layout_sky.visibility)})),paint:V2||(V2=new ga({"sky-type":new Pn(Gr.paint_sky["sky-type"]),"sky-atmosphere-sun":new Pn(Gr.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Pn(Gr.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Pn(Gr.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Pn(Gr.paint_sky["sky-gradient-radius"]),"sky-gradient":new l0(Gr.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Pn(Gr.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Pn(Gr.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Pn(Gr.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new On({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"})}))},o,g,_e),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(_){_==="sky-gradient"?this._updateColorRamp():_!=="sky-atmosphere-sun"&&_!=="sky-atmosphere-halo-color"&&_!=="sky-atmosphere-color"&&_!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=u1({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(_){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=_.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(_,o){if(this.paint.get("sky-type")==="atmosphere"){const _e=this.paint.get("sky-atmosphere-sun"),rt=!_e,ot=_.style.light,at=ot.properties.get("position");return rt&&ot.properties.get("anchor")==="viewport"&&$n("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),rt?DS(at.azimuthal,90-at.polar,o):DS(_e[0],90-_e[1],o)}const g=this.paint.get("sky-gradient-center");return DS(g[0],90-g[1],o)}isSky(){return!0}markSkyboxValid(_){this._skyboxInvalidated=!1,this._lightPosition=_.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const _=this.paint.get("sky-type");return _==="atmosphere"?["skyboxCapture","skybox"]:_==="gradient"?["skyboxGradient"]:null}},slot:class extends Iu{constructor(_,o,g,_e){super(_,{paint:U2||(U2=new ga({}))},o,null)}},model:class extends Iu{constructor(_,o,g,_e){super(_,{layout:q2||(q2=new ga({visibility:new Pn(Gr.layout_model.visibility),"model-id":new On(Gr.layout_model["model-id"])})),paint:K2||(K2=new ga({"model-opacity":new On(Gr.paint_model["model-opacity"]),"model-rotation":new On(Gr.paint_model["model-rotation"]),"model-scale":new On(Gr.paint_model["model-scale"]),"model-translation":new On(Gr.paint_model["model-translation"]),"model-color":new On(Gr.paint_model["model-color"]),"model-color-mix-intensity":new On(Gr.paint_model["model-color-mix-intensity"]),"model-type":new Pn(Gr.paint_model["model-type"]),"model-cast-shadows":new Pn(Gr.paint_model["model-cast-shadows"]),"model-receive-shadows":new Pn(Gr.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Pn(Gr.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new On(Gr.paint_model["model-emissive-strength"]),"model-roughness":new On(Gr.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new On(Gr.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Pn(Gr.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Pn(Gr.paint_model["model-front-cutoff"]),"model-elevation-reference":new Pn(Gr.paint_model["model-elevation-reference"]),"model-color-use-theme":new On({type:"string",default:"default","property-type":"data-driven"})}))},o,g,_e),this.layer=_,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(_){return new LS(_)}getProgramIds(){return["model"]}is3D(_){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(_){return _ instanceof UE?Mn-1:0}queryRenderedFeatures(_,o,g){const _e=o.getSource();if(!(_e&&_e instanceof ey))return{};const rt=_e,ot={};ot[this.id]=[];const at=ot[this.id];let ut=0;for(const ft of rt.models){const gt=o.getFeatureState(this.sourceLayer,ft.id),Ct={type:"Unknown",id:ft.id,properties:ft.featureProperties},At=this.paint.get("model-rotation").evaluate(Ct,gt),kt=this.paint.get("model-scale").evaluate(Ct,gt),zt=this.paint.get("model-translation").evaluate(Ct,gt),Ut=this.paint.get("model-elevation-reference");let Kt=[];wE(Kt,ft,g,ft.position,At,kt,zt,Ut==="ground",Ut==="ground",!1),g.projection.name==="globe"&&(Kt=bE(Kt,g));const er=Bt([],g.projMatrix,Kt),Jt=sS(_.isPointQuery()?_.screenBounds:_.screenGeometry,g,er,ft.aabb);if(Jt!=null){const or=new J_(void 0,0,0,0,ft.id);or.layer=this.layer,or.properties=structuredClone(ft.featureProperties),or.properties.layer=this.id,or.properties.uri=ft.uri,or.properties.orientation=ft.orientation,or.sourceLayer=this.sourceLayer,or.geometry={type:"Point",coordinates:[ft.position.lng,ft.position.lat]},or.state=gt,or.source=this.source,at.push({featureIndex:ut,feature:or,intersectionZ:Jt})}++ut}return ot}queryIntersectsFeature(_,o,g,_e,rt,ot){if(!this.modelManager)return!1;const at=this.modelManager,ut=_.tile.getBucket(this);if(!(ut&&ut instanceof LS))return!1;for(const ft in ut.instancesPerModel){const gt=ut.instancesPerModel[ft],Ct=o.id!==void 0?o.id:o.properties&&o.properties.hasOwnProperty("id")?o.properties.id:void 0;if(gt.idToFeaturesIndex.hasOwnProperty(Ct)){const At=gt.features[gt.idToFeaturesIndex[Ct]],kt=at.getModel(ft,this.scope);if(!kt)return!1;let zt=[];const Ut=new $(0,0),Kt=ut.canonical;let er=Number.MAX_VALUE;for(let Jt=0;Jt<At.instancedDataCount;++Jt){const or=16*(At.instancedDataOffset+Jt),lr=gt.instancedDataArray.float32,pr=[lr[or+4],lr[or+5],lr[or+6]];jS(Kt,Ut,Math.floor(lr[or]),Math.floor(lr[or+1])),wE(zt,kt,ot,Ut,At.rotation,At.scale,pr,!1,!1,!1),ot.projection.name==="globe"&&(zt=bE(zt,ot));const Sr=Bt([],ot.projMatrix,zt),br=_.queryGeometry,Rr=sS(br.isPointQuery()?br.screenBounds:br.screenGeometry,ot,Sr,kt.aabb);Rr!=null&&(er=Math.min(Rr,er))}return er!==Number.MAX_VALUE&&er}}return!1}_handleOverridablePaintPropertyUpdate(_,o,g){return!(!this.layout||o.isDataDriven()||g.isDataDriven()||_!=="model-color"&&_!=="model-color-mix-intensity"&&_!=="model-rotation"&&_!=="model-scale"&&_!=="model-translation"&&_!=="model-emissive-strength")}_isPropertyZoomDependent(_){const o=this._transitionablePaint._values[_];return o!=null&&o.value!=null&&o.value.expression!=null&&o.value.expression instanceof n0}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Iu{constructor(_,o,g,_e){super(_,{layout:RC||(RC=new ga({"clip-layer-types":new Pn(Gr.layout_clip["clip-layer-types"]),"clip-layer-scope":new Pn(Gr.layout_clip["clip-layer-scope"])})),paint:IC||(IC=new ga({}))},o,g,_e)}recalculate(_,o){super.recalculate(_,o)}createBucket(_){return new PC(_)}is3D(_){return!0}}},FS=new fo(0,0,0),BS={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},zS={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},$E={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},zM={PAINT_ORDER_FILL_AND_STROKE:1},$1={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},J2={MASK_TYPE_LUMINANCE:1};function VM(_,o,g){_===1&&o.icons.push(function(_e,rt){return function(ot){if(ot.usvg_tree.height||(ot.usvg_tree.height=ot.usvg_tree.width),!ot.metadata)return ot;const{metadata:at}=ot;if(at.content_area){const{content_area:ut}=at;ut.left==null&&(ut.left=0),ut.top==null&&(ut.top=ut.left),ut.width==null&&(ut.width=ot.usvg_tree.width),ut.height==null&&(ut.height=ut.width)}if(at.text_placeholder){const{text_placeholder:ut}=at;ut.top==null&&(ut.top=ut.left),ut.height==null&&(ut.height=ut.width)}return at.stretch_x&&at.stretch_x.length&&eR(at,"x"),at.stretch_y&&at.stretch_y.length&&eR(at,"y"),ot}(_e.readFields(UM,{name:void 0},rt))}(g,g.readVarint()+g.pos))}function eR(_,o){const g=[],_e=_[`stretch_${o}`];let rt=null;for(let ot=0;ot<_e.length;ot++)rt===null?rt=g.length===0?_e[0]:g[g.length-1][1]+_e[ot]:(g.push([rt,rt+_e[ot]]),rt=null);_[`stretch_${o}_areas`]=g}function UM(_,o,g){_===1?o.name=g.readString():_===2?o.metadata=function(_e,rt){return _e.readFields($M,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},rt)}(g,g.readVarint()+g.pos):_===3&&(o.usvg_tree=function(_e,rt){return _e.readFields(WM,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},rt)}(g,g.readVarint()+g.pos),o.data="usvg_tree")}function $M(_,o,g){_===1?o.stretch_x=g.readPackedVarint():_===2?o.stretch_y=g.readPackedVarint():_===3?o.content_area=tR(g,g.readVarint()+g.pos):_===4?o.variables.push(function(_e,rt){return _e.readFields(HM,{name:void 0},rt)}(g,g.readVarint()+g.pos)):_===5&&(o.text_placeholder=tR(g,g.readVarint()+g.pos))}function tR(_,o){return _.readFields(GM,{},o)}function GM(_,o,g){_===1?o.left=g.readVarint():_===2?o.width=g.readVarint():_===3?o.top=g.readVarint():_===4&&(o.height=g.readVarint())}function HM(_,o,g){_===1?o.name=g.readString():_===2&&(o.rgb_color=WE(g.readVarint()),o.value="rgb_color")}function WM(_,o,g){_===1?o.width=o.height=g.readVarint():_===2?o.height=g.readVarint():_===3?o.children.push(GE(g,g.readVarint()+g.pos)):_===4?o.linear_gradients.push(function(_e,rt){return _e.readFields(JM,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},rt)}(g,g.readVarint()+g.pos)):_===5?o.radial_gradients.push(function(_e,rt){return _e.readFields(tD,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},rt)}(g,g.readVarint()+g.pos)):_===7?o.clip_paths.push(function(_e,rt){return _e.readFields(rD,{children:[]},rt)}(g,g.readVarint()+g.pos)):_===8&&o.masks.push(function(_e,rt){const ot=_e.readFields(iD,{left:0,width:20,mask_type:J2.MASK_TYPE_LUMINANCE,children:[]},rt);return ot.height==null&&(ot.height=ot.width),ot.top==null&&(ot.top=ot.left),ot}(g,g.readVarint()+g.pos))}function GE(_,o){return _.readFields(qM,{},o)}function qM(_,o,g){_===1?(o.group=function(_e,rt){return _e.readFields(KM,{opacity:255,children:[]},rt)}(g,g.readVarint()+g.pos),o.node="group"):_===2&&(o.path=function(_e,rt){return _e.readFields(ZM,{paint_order:1,commands:[],step:1,diffs:[],rule:BS.PATH_RULE_NON_ZERO},rt)}(g,g.readVarint()+g.pos),o.node="path")}function KM(_,o,g){_===1?o.transform=HE(g,g.readVarint()+g.pos):_===2?o.opacity=g.readVarint():_===5?o.clip_path_idx=g.readVarint():_===6?o.mask_idx=g.readVarint():_===7&&o.children.push(GE(g,g.readVarint()+g.pos))}function HE(_,o){return _.readFields(XM,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},o)}function XM(_,o,g){_===1?o.sx=g.readFloat():_===2?o.ky=g.readFloat():_===3?o.kx=g.readFloat():_===4?o.sy=g.readFloat():_===5?o.tx=g.readFloat():_===6&&(o.ty=g.readFloat())}function ZM(_,o,g){_===1?o.fill=function(_e,rt){return _e.readFields(YM,{rgb_color:FS,paint:"rgb_color",opacity:255},rt)}(g,g.readVarint()+g.pos):_===2?o.stroke=function(_e,rt){return _e.readFields(QM,{rgb_color:FS,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},rt)}(g,g.readVarint()+g.pos):_===3?o.paint_order=g.readVarint():_===5?g.readPackedVarint(o.commands):_===6?o.step=g.readFloat():_===7?g.readPackedSVarint(o.diffs):_===8&&(o.rule=g.readVarint())}function YM(_,o,g){_===1?(o.rgb_color=WE(g.readVarint()),o.paint="rgb_color"):_===2?(o.linear_gradient_idx=g.readVarint(),o.paint="linear_gradient_idx"):_===3?(o.radial_gradient_idx=g.readVarint(),o.paint="radial_gradient_idx"):_===5&&(o.opacity=g.readVarint())}function WE(_){return new fo((_>>16&255)/255,(_>>8&255)/255,(255&_)/255,1)}function QM(_,o,g){_===1?(o.rgb_color=WE(g.readVarint()),o.paint="rgb_color"):_===2?(o.linear_gradient_idx=g.readVarint(),o.paint="linear_gradient_idx"):_===3?(o.radial_gradient_idx=g.readVarint(),o.paint="radial_gradient_idx"):_===5?g.readPackedFloat(o.dasharray):_===6?o.dashoffset=g.readFloat():_===7?o.miterlimit=g.readFloat():_===8?o.opacity=g.readVarint():_===9?o.width=g.readFloat():_===10?o.linecap=g.readVarint():_===11&&(o.linejoin=g.readVarint())}function JM(_,o,g){_===1?o.transform=HE(g,g.readVarint()+g.pos):_===2?o.spread_method=g.readVarint():_===3?o.stops.push(rR(g,g.readVarint()+g.pos)):_===4?o.x1=g.readFloat():_===5?o.y1=g.readFloat():_===6?o.x2=g.readFloat():_===7&&(o.y2=g.readFloat())}function rR(_,o){return _.readFields(eD,{offset:0,opacity:255,rgb_color:FS},o)}function eD(_,o,g){_===1?o.offset=g.readFloat():_===2?o.opacity=g.readVarint():_===3&&(o.rgb_color=WE(g.readVarint()))}function tD(_,o,g){_===1?o.transform=HE(g,g.readVarint()+g.pos):_===2?o.spread_method=g.readVarint():_===3?o.stops.push(rR(g,g.readVarint()+g.pos)):_===4?o.cx=g.readFloat():_===5?o.cy=g.readFloat():_===6?o.r=g.readFloat():_===7?o.fx=g.readFloat():_===8?o.fy=g.readFloat():_===9&&(o.fr=g.readFloat())}function rD(_,o,g){_===1?o.transform=HE(g,g.readVarint()+g.pos):_===2?o.clip_path_idx=g.readVarint():_===3&&o.children.push(GE(g,g.readVarint()+g.pos))}function iD(_,o,g){_===1?o.left=o.top=g.readFloat():_===2?o.width=o.height=g.readFloat():_===3?o.top=g.readFloat():_===4?o.height=g.readFloat():_===5?o.mask_type=g.readVarint():_===6?o.mask_idx=g.readVarint():_===7&&o.children.push(GE(g,g.readVarint()+g.pos))}class nD{static calculate(o={},g=[]){const _e=new Map,rt=new Map;if(Object.keys(o).length===0)return _e;g.forEach(ot=>{rt.set(ot.name,ot.rgb_color||new fo(0,0,0))});for(const[ot,at]of Object.entries(o))rt.has(ot)?_e.set(rt.get(ot).toString(),at):console.warn(`Ignoring unknown image variable "${ot}"`);return _e}}function $x(_,o=255,g){const _e=o/255,rt=_.toString(),ot=g.has(rt)?g.get(rt).clone():_.clone();return ot.a*=_e,ot.toString()}function G1(_,o){if(!kp()){const g=document.createElement("canvas");return g.width=_,g.height=o,g}return new OffscreenCanvas(_,o)}let VS,H1=null;function US(_,o,g,_e,rt){for(const ot of _e.children)iR(_,o,g,ot,rt)}function iR(_,o,g,_e,rt){_e.group?(_.save(),function(ot,at,ut,ft,gt){const Ct=ft.mask_idx!=null?ut.masks[ft.mask_idx]:null,At=ft.clip_path_idx!=null?ut.clip_paths[ft.clip_path_idx]:null;if(ft.transform&&(at=Gx(ft.transform).preMultiplySelf(at)),!function(Ut,Kt,er){return Ut.opacity!==255||Kt||er}(ft,At!=null,Ct!=null))return void US(ot,at,ut,ft,gt);const kt=G1(ot.canvas.width,ot.canvas.height),zt=kt.getContext("2d");US(zt,at,ut,ft,gt),At&&uR(zt,at,ut,At),Ct&&hR(zt,at,ut,Ct,gt),ot.globalAlpha=ft.opacity/255,ot.drawImage(kt,0,0)}(_,o,g,_e.group,rt),_.restore()):_e.path&&(_.save(),function(ot,at,ut,ft,gt){ot.setTransform(at),ft.paint_order===zM.PAINT_ORDER_FILL_AND_STROKE?(nR(ot,ut,ft,gt),oR(ot,ut,ft,gt)):(oR(ot,ut,ft,gt),nR(ot,ut,ft,gt))}(_,o,g,_e.path,rt),_.restore())}function nR(_,o,g,_e){const rt=g.fill;if(!rt)return;const ot=rt.opacity/255;switch(_.save(),_.beginPath(),dR(g,_),rt.paint){case"rgb_color":_.fillStyle=$x(rt.rgb_color,rt.opacity,_e);break;case"linear_gradient_idx":{const at=o.linear_gradients[rt.linear_gradient_idx];at.transform&&_.setTransform(Gx(at.transform).preMultiplySelf(_.getTransform())),_.fillStyle=aR(_,at,ot,_e);break}case"radial_gradient_idx":{const at=o.radial_gradients[rt.radial_gradient_idx];at.transform&&_.setTransform(Gx(at.transform).preMultiplySelf(_.getTransform())),_.fillStyle=lR(_,at,ot,_e)}}_.fill(sR(g)),_.restore()}function sR(_){return _.rule===BS.PATH_RULE_NON_ZERO?"nonzero":_.rule===BS.PATH_RULE_EVEN_ODD?"evenodd":void 0}function oR(_,o,g,_e){const rt=g.stroke;if(!rt)return;const ot=pR(g);_.lineWidth=rt.width,_.miterLimit=rt.miterlimit,_.setLineDash(rt.dasharray),_.lineDashOffset=rt.dashoffset;const at=rt.opacity/255;switch(rt.paint){case"rgb_color":_.strokeStyle=$x(rt.rgb_color,rt.opacity,_e);break;case"linear_gradient_idx":_.strokeStyle=aR(_,o.linear_gradients[rt.linear_gradient_idx],at,_e,!0);break;case"radial_gradient_idx":_.strokeStyle=lR(_,o.radial_gradients[rt.radial_gradient_idx],at,_e,!0)}switch(rt.linejoin){case $E.LINE_JOIN_MITER_CLIP:case $E.LINE_JOIN_MITER:_.lineJoin="miter";break;case $E.LINE_JOIN_ROUND:_.lineJoin="round";break;case $E.LINE_JOIN_BEVEL:_.lineJoin="bevel"}switch(rt.linecap){case zS.LINE_CAP_BUTT:_.lineCap="butt";break;case zS.LINE_CAP_ROUND:_.lineCap="round";break;case zS.LINE_CAP_SQUARE:_.lineCap="square"}_.stroke(ot)}function aR(_,o,g,_e,rt=!1){if(o.stops.length===1){const kt=o.stops[0];return $x(kt.rgb_color,kt.opacity*g,_e)}const{x1:ot,y1:at,x2:ut,y2:ft}=o;let gt=new DOMPoint(ot,at),Ct=new DOMPoint(ut,ft);if(rt){const kt=Gx(o.transform);gt=kt.transformPoint(gt),Ct=kt.transformPoint(Ct)}const At=_.createLinearGradient(gt.x,gt.y,Ct.x,Ct.y);for(const kt of o.stops)At.addColorStop(kt.offset,$x(kt.rgb_color,kt.opacity*g,_e));return At}function lR(_,o,g,_e,rt=!1){if(o.stops.length===1){const Jt=o.stops[0];return $x(Jt.rgb_color,Jt.opacity*g,_e)}const ot=Gx(o.transform),{fx:at,fy:ut,fr:ft,cx:gt,cy:Ct,r:At}=o;let kt=new DOMPoint(at,ut),zt=new DOMPoint(gt,Ct),Ut=ft,Kt=At;if(rt){kt=ot.transformPoint(kt),zt=ot.transformPoint(zt);const Jt=(ot.a+ot.d)/2;Ut=ft*Jt,Kt=o.r*Jt}const er=_.createRadialGradient(kt.x,kt.y,Ut,zt.x,zt.y,Kt);for(const Jt of o.stops)er.addColorStop(Jt.offset,$x(Jt.rgb_color,Jt.opacity*g,_e));return er}function cR(_,o,g,_e){const rt=_e.transform?Gx(_e.transform).preMultiplySelf(o):o,ot=G1(_.canvas.width,_.canvas.height),at=ot.getContext("2d");for(const ft of _e.children)if(ft.group)cR(at,rt,g,ft.group);else if(ft.path){const gt=ft.path,Ct=new Path2D;Ct.addPath(pR(gt),rt),at.fill(Ct,sR(gt))}const ut=_e.clip_path_idx!=null?g.clip_paths[_e.clip_path_idx]:null;ut&&uR(at,rt,g,ut),_.globalCompositeOperation="source-over",_.drawImage(ot,0,0)}function uR(_,o,g,_e){const rt=G1(_.canvas.width,_.canvas.height);cR(rt.getContext("2d"),o,g,_e),_.globalCompositeOperation="destination-in",_.drawImage(rt,0,0)}function hR(_,o,g,_e,rt){if(_e.children.length===0)return;const ot=_e.mask_idx!=null?g.masks[_e.mask_idx]:null;ot&&hR(_,o,g,ot,rt);const at=_.canvas.width,ut=_.canvas.height,ft=G1(at,ut),gt=ft.getContext("2d"),Ct=_e.width,At=_e.height,kt=_e.left,zt=_e.top,Ut=new Path2D,Kt=new Path2D;Kt.rect(kt,zt,Ct,At),Ut.addPath(Kt,o),gt.clip(Ut);for(const or of _e.children)iR(gt,o,g,or,rt);const er=gt.getImageData(0,0,at,ut),Jt=er.data;if(_e.mask_type===J2.MASK_TYPE_LUMINANCE)for(let or=0;or<Jt.length;or+=4)Jt[or+3]=Jt[or+3]/255*(.2126*Jt[or]+.7152*Jt[or+1]+.0722*Jt[or+2]);gt.putImageData(er,0,0),_.globalCompositeOperation="destination-in",_.drawImage(ft,0,0)}function Gx(_){return _?new DOMMatrix([_.sx,_.ky,_.kx,_.sy,_.tx,_.ty]):new DOMMatrix}function dR(_,o){const g=_.step;let _e=_.diffs[0]*g,rt=_.diffs[1]*g;o.moveTo(_e,rt);for(let ot=0,at=2;ot<_.commands.length;ot++)switch(_.commands[ot]){case $1.PATH_COMMAND_MOVE:_e+=_.diffs[at++]*g,rt+=_.diffs[at++]*g,o.moveTo(_e,rt);break;case $1.PATH_COMMAND_LINE:_e+=_.diffs[at++]*g,rt+=_.diffs[at++]*g,o.lineTo(_e,rt);break;case $1.PATH_COMMAND_QUAD:{const ut=_e+_.diffs[at++]*g,ft=rt+_.diffs[at++]*g;_e=ut+_.diffs[at++]*g,rt=ft+_.diffs[at++]*g,o.quadraticCurveTo(ut,ft,_e,rt);break}case $1.PATH_COMMAND_CUBIC:{const ut=_e+_.diffs[at++]*g,ft=rt+_.diffs[at++]*g,gt=ut+_.diffs[at++]*g,Ct=ft+_.diffs[at++]*g;_e=gt+_.diffs[at++]*g,rt=Ct+_.diffs[at++]*g,o.bezierCurveTo(ut,ft,gt,Ct,_e,rt);break}case $1.PATH_COMMAND_CLOSE:o.closePath()}return o}function pR(_){return dR(_,new Path2D)}class qE{constructor(o){this.capacity=o,this.cache=new Map}get(o){if(!this.cache.has(o))return;const g=this.cache.get(o);return this.cache.delete(o),this.cache.set(o,g),g}put(o,g){this.cache.has(o)?this.cache.delete(o):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(o,g)}delete(o){this.cache.delete(o)}}qn(qE,"LRUCache");class $S{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(o){return new yu(o,o.data)}getFromCache(o,g,_e){return this.cacheMap.has(_e)||this.cacheMap.set(_e,new qE(150)),this.cacheMap.get(_e).get(Ep(o.toString(),g))}setInCache(o,g,_e,rt){this.cacheDependenciesMap.has(rt)||this.cacheDependenciesMap.set(rt,new Map),this.cacheMap.has(rt)||this.cacheMap.set(rt,new qE(150));const ot=this.cacheDependenciesMap.get(rt),at=Ep(o.id.toString(),_e);ot.get(at)||ot.set(at,new Set);const ut=this.cacheMap.get(rt),ft=o.toString();ot.get(at).add(ft),ut.put(Ep(o.toString(),_e),g)}removeImagesFromCacheByIds(o,g,_e=0){if(!this.cacheMap.has(_e)||!this.cacheDependenciesMap.has(_e))return;const rt=this.cacheMap.get(_e),ot=this.cacheDependenciesMap.get(_e);for(const at of o){const ut=Ep(at.toString(),g);if(ot.has(ut)){for(const ft of ot.get(ut))rt.delete(ft);ot.delete(ut)}}}rasterize(o,g,_e,rt){const ot=this.getFromCache(o,_e,rt);if(ot)return ot.clone();const at=function(ft,gt){const Ct=nD.calculate(gt.params,ft.metadata?ft.metadata.variables:[]),At=ft.usvg_tree,kt=At.width,zt=At.height,Ut=Math.max(1,Math.round(kt*gt.sx)),Kt=Math.max(1,Math.round(zt*gt.sy)),er=new DOMMatrix([Ut/kt,0,0,Kt/zt,0,0]);return H1===null&&(H1=G1(10,10),VS=H1.getContext("2d",{willReadFrequently:!0})),H1.width=Ut,H1.height=Kt,US(VS,er,At,At,Ct),VS.getImageData(0,0,Ut,Kt)}(g.icon,o),ut=$S._getImage(at);return this.setInCache(o,ut,_e,rt),ut.clone()}}class fR{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,g){const _e=this.toIdx(o,g);return{min:this.minimums[_e],max:this.maximums[_e]}}isLeaf(o,g){return this.leaves[this.toIdx(o,g)]}toIdx(o,g){return g*this.size+o}}function mR(_,o,g,_e){let rt=0,ot=Number.MAX_VALUE;for(let at=0;at<3;at++)if(Math.abs(_e[at])<1e-15){if(g[at]<_[at]||g[at]>o[at])return null}else{const ut=1/_e[at];let ft=(_[at]-g[at])*ut,gt=(o[at]-g[at])*ut;if(ft>gt){const Ct=ft;ft=gt,gt=Ct}if(ft>rt&&(rt=ft),gt<ot&&(ot=gt),rt>ot)return null}return rt}function gR(_,o,g,_e,rt,ot,at,ut,ft,gt,Ct){const At=_e-_,kt=rt-o,zt=ot-g,Ut=at-_,Kt=ut-o,er=ft-g,Jt=Ct[1]*er-Ct[2]*Kt,or=Ct[2]*Ut-Ct[0]*er,lr=Ct[0]*Kt-Ct[1]*Ut,pr=At*Jt+kt*or+zt*lr;if(Math.abs(pr)<1e-15)return null;const Sr=1/pr,br=gt[0]-_,Rr=gt[1]-o,Mr=gt[2]-g,Lr=(br*Jt+Rr*or+Mr*lr)*Sr;if(Lr<0||Lr>1)return null;const Jr=Rr*zt-Mr*kt,zr=Mr*At-br*zt,sn=br*kt-Rr*At,dn=(Ct[0]*Jr+Ct[1]*zr+Ct[2]*sn)*Sr;return dn<0||Lr+dn>1?null:(Ut*Jr+Kt*zr+er*sn)*Sr}function _R(_,o,g){return(_-o)/(g-o)}function yR(_,o,g,_e,rt,ot,at,ut,ft){const gt=1<<g,Ct=ot-_e,At=at-rt,kt=(_+1)/gt*Ct+_e,zt=(o+0)/gt*At+rt,Ut=(o+1)/gt*At+rt;ut[0]=(_+0)/gt*Ct+_e,ut[1]=zt,ft[0]=kt,ft[1]=Ut}class xR{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const g=function(ot){const at=Math.ceil(Math.log2(ot.dim/8)),ut=[];let ft=Math.ceil(Math.pow(2,at));const gt=1/ft,Ct=(zt,Ut,Kt,er,Jt)=>{const or=er?1:0,lr=(zt+1)*Kt-or,pr=Ut*Kt,Sr=(Ut+1)*Kt-or;Jt[0]=zt*Kt,Jt[1]=pr,Jt[2]=lr,Jt[3]=Sr};let At=new fR(ft);const kt=[];for(let zt=0;zt<ft*ft;zt++){Ct(zt%ft,Math.floor(zt/ft),gt,!1,kt);const Ut=Q0(kt[0],kt[1],ot),Kt=Q0(kt[2],kt[1],ot),er=Q0(kt[2],kt[3],ot),Jt=Q0(kt[0],kt[3],ot);At.minimums.push(Math.min(Ut,Kt,er,Jt)),At.maximums.push(Math.max(Ut,Kt,er,Jt)),At.leaves.push(1)}for(ut.push(At),ft/=2;ft>=1;ft/=2){const zt=ut[ut.length-1];At=new fR(ft);for(let Ut=0;Ut<ft*ft;Ut++){Ct(Ut%ft,Math.floor(Ut/ft),2,!0,kt);const Kt=zt.getElevation(kt[0],kt[1]),er=zt.getElevation(kt[2],kt[1]),Jt=zt.getElevation(kt[2],kt[3]),or=zt.getElevation(kt[0],kt[3]),lr=zt.isLeaf(kt[0],kt[1]),pr=zt.isLeaf(kt[2],kt[1]),Sr=zt.isLeaf(kt[2],kt[3]),br=zt.isLeaf(kt[0],kt[3]),Rr=Math.min(Kt.min,er.min,Jt.min,or.min),Mr=Math.max(Kt.max,er.max,Jt.max,or.max),Lr=lr&&pr&&Sr&&br;At.maximums.push(Mr),At.minimums.push(Rr),At.leaves.push(Mr-Rr<=5&&Lr?1:0)}ut.push(At)}return ut}(this.dem),_e=g.length-1,rt=g[_e];this._addNode(rt.minimums[0],rt.maximums[0],rt.leaves[0]),this._construct(g,0,0,_e,0)}raycastRoot(o,g,_e,rt,ot,at,ut=1){return mR([o,g,-100],[_e,rt,this.maximums[0]*ut],ot,at)}raycast(o,g,_e,rt,ot,at,ut=1){if(!this.nodeCount)return null;const ft=this.raycastRoot(o,g,_e,rt,ot,at,ut);if(ft==null)return null;const gt=[],Ct=[],At=[],kt=[],zt=[{idx:0,t:ft,nodex:0,nodey:0,depth:0}];for(;zt.length>0;){const{idx:Ut,t:Kt,nodex:er,nodey:Jt,depth:or}=zt.pop();if(this.leaves[Ut]){yR(er,Jt,or,o,g,_e,rt,At,kt);const pr=1<<or,Sr=(er+0)/pr,br=(er+1)/pr,Rr=(Jt+0)/pr,Mr=(Jt+1)/pr,Lr=Q0(Sr,Rr,this.dem)*ut,Jr=Q0(br,Rr,this.dem)*ut,zr=Q0(br,Mr,this.dem)*ut,sn=Q0(Sr,Mr,this.dem)*ut,dn=gR(At[0],At[1],Lr,kt[0],At[1],Jr,kt[0],kt[1],zr,ot,at),pn=gR(kt[0],kt[1],zr,At[0],kt[1],sn,At[0],At[1],Lr,ot,at),wn=Math.min(dn!==null?dn:Number.MAX_VALUE,pn!==null?pn:Number.MAX_VALUE);if(wn!==Number.MAX_VALUE)return wn;{const Tn=jn([],ot,at,Kt);if(vR(Lr,Jr,sn,zr,_R(Tn[0],At[0],kt[0]),_R(Tn[1],At[1],kt[1]))>=Tn[2])return Kt}continue}let lr=0;for(let pr=0;pr<this._siblingOffset.length;pr++){yR((er<<1)+this._siblingOffset[pr][0],(Jt<<1)+this._siblingOffset[pr][1],or+1,o,g,_e,rt,At,kt),At[2]=-100,kt[2]=this.maximums[this.childOffsets[Ut]+pr]*ut;const Sr=mR(At,kt,ot,at);if(Sr!=null){const br=Sr;gt[pr]=br;let Rr=!1;for(let Mr=0;Mr<lr&&!Rr;Mr++)br>=gt[Ct[Mr]]&&(Ct.splice(Mr,0,pr),Rr=!0);Rr||(Ct[lr]=pr),lr++}}for(let pr=0;pr<lr;pr++){const Sr=Ct[pr];zt.push({idx:this.childOffsets[Ut]+Sr,t:gt[Sr],nodex:(er<<1)+this._siblingOffset[Sr][0],nodey:(Jt<<1)+this._siblingOffset[Sr][1],depth:or+1})}}return null}_addNode(o,g,_e){return this.minimums.push(o),this.maximums.push(g),this.leaves.push(_e),this.childOffsets.push(0),this.nodeCount++}_construct(o,g,_e,rt,ot){if(o[rt].isLeaf(g,_e)===1)return;this.childOffsets[ot]||(this.childOffsets[ot]=this.nodeCount);const at=rt-1,ut=o[at];let ft=0,gt=0;for(let Ct=0;Ct<this._siblingOffset.length;Ct++){const At=2*g+this._siblingOffset[Ct][0],kt=2*_e+this._siblingOffset[Ct][1],zt=ut.getElevation(At,kt),Ut=ut.isLeaf(At,kt),Kt=this._addNode(zt.min,zt.max,Ut);Ut&&(ft|=1<<Ct),gt||(gt=Kt)}for(let Ct=0;Ct<this._siblingOffset.length;Ct++)ft&1<<Ct||this._construct(o,2*g+this._siblingOffset[Ct][0],2*_e+this._siblingOffset[Ct][1],at,gt+Ct)}}function vR(_,o,g,_e,rt,ot){return fs(fs(_,g,ot),fs(o,_e,ot),rt)}function Q0(_,o,g){const _e=g.dim,rt=tr(_*_e-.5,0,_e-1),ot=tr(o*_e-.5,0,_e-1),at=Math.floor(rt),ut=Math.floor(ot),ft=Math.min(at+1,_e-1),gt=Math.min(ut+1,_e-1);return vR(g.get(at,ut),g.get(ft,ut),g.get(at,gt),g.get(ft,gt),rt-at,ot-ut)}const sD={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function oD(_,o,g){return(256*_*256+256*o+g)/10-1e4}function aD(_,o,g){return 256*_+o+g/256-32768}class KE{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,g,_e,rt=!1){if(this.uid=o,g.height!==g.width)throw new RangeError("DEM tiles must be square");if(_e&&_e!=="mapbox"&&_e!=="terrarium")return void $n(`"${_e}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=g.height;const ot=this.dim=g.height-2,at=new Uint32Array(g.data.buffer);if(this.pixels=new Uint8Array(g.data.buffer),this.floatView=new Float32Array(g.data.buffer),this.borderReady=rt,this._modifiedForSources={},!rt){for(let ft=0;ft<ot;ft++)at[this._idx(-1,ft)]=at[this._idx(0,ft)],at[this._idx(ot,ft)]=at[this._idx(ot-1,ft)],at[this._idx(ft,-1)]=at[this._idx(ft,0)],at[this._idx(ft,ot)]=at[this._idx(ft,ot-1)];at[this._idx(-1,-1)]=at[this._idx(0,0)],at[this._idx(ot,-1)]=at[this._idx(ot-1,0)],at[this._idx(-1,ot)]=at[this._idx(0,ot-1)],at[this._idx(ot,ot)]=at[this._idx(ot-1,ot-1)]}const ut=_e==="terrarium"?aD:oD;for(let ft=0;ft<at.length;++ft){const gt=4*ft;this.floatView[ft]=ut(this.pixels[gt],this.pixels[gt+1],this.pixels[gt+2])}this._timestamp=Xl.now()}_buildQuadTree(){this._tree=new xR(this)}get(o,g,_e=!1){_e&&(o=tr(o,-1,this.dim),g=tr(g,-1,this.dim));const rt=this._idx(o,g);return this.floatView[rt]}set(o,g,_e){const rt=this._idx(o,g),ot=this.floatView[rt];return this.floatView[rt]=_e,_e-ot}static getUnpackVector(o){return sD[o]}_idx(o,g){if(o<-1||o>=this.dim+1||g<-1||g>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(g+1)*this.stride+(o+1)}static pack(o,g){const _e=[0,0,0,0],rt=KE.getUnpackVector(g);let ot=Math.floor((o+rt[3])/rt[2]);return _e[2]=ot%256,ot=Math.floor(ot/256),_e[1]=ot%256,ot=Math.floor(ot/256),_e[0]=ot,_e}getPixels(){return new fC({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,g,_e){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let rt=g*this.dim,ot=g*this.dim+this.dim,at=_e*this.dim,ut=_e*this.dim+this.dim;switch(g){case-1:rt=ot-1;break;case 1:ot=rt+1}switch(_e){case-1:at=ut-1;break;case 1:ut=at+1}const ft=-g*this.dim,gt=-_e*this.dim;for(let Ct=at;Ct<ut;Ct++)for(let At=rt;At<ot;At++){const kt=4*this._idx(At,Ct),zt=4*this._idx(At+ft,Ct+gt);this.pixels[kt+0]=o.pixels[zt+0],this.pixels[kt+1]=o.pixels[zt+1],this.pixels[kt+2]=o.pixels[zt+2],this.pixels[kt+3]=o.pixels[zt+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function lD(_,o,g){_===1?o.headerLength=g.readFixed32():_===2?o.x=g.readVarint():_===3?o.y=g.readVarint():_===4?o.z=g.readVarint():_===5&&o.layers.push(function(_e,rt){return _e.readFields(pD,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},rt)}(g,g.readVarint()+g.pos))}function cD(_,o,g){_===1?(o.delta_filter=function(_e,rt){return _e.readFields(uD,{blockSize:0},rt)}(g,g.readVarint()+g.pos),o.filter="delta_filter"):_===2?(g.readVarint(),o.filter="zigzag_filter"):_===3?(g.readVarint(),o.filter="bitshuffle_filter"):_===4&&(g.readVarint(),o.filter="byteshuffle_filter")}function uD(_,o,g){_===1&&(o.blockSize=g.readVarint())}function hD(_,o,g){_===1?(g.readVarint(),o.codec="gzip_data"):_===2?(g.readVarint(),o.codec="jpeg_image"):_===3?(g.readVarint(),o.codec="webp_image"):_===4&&(g.readVarint(),o.codec="png_image")}function dD(_,o,g){let _e=0,rt=0;_===1?o.firstByte=g.readFixed64():_===2?o.lastByte=g.readFixed64():_===3?o.filters.push(function(ot,at){return ot.readFields(cD,{},at)}(g,g.readVarint()+g.pos)):_===4?o.codec=function(ot,at){return ot.readFields(hD,{},at)}(g,g.readVarint()+g.pos):_===5?rt=g.readFloat():_===6?_e=g.readFloat():_===7?o.bands.push(g.readString()):_===8?o.offset=g.readDouble():_===9&&(o.scale=g.readDouble()),o.offset===0&&(o.offset=rt),o.scale===0&&(o.scale=_e)}function pD(_,o,g){_===1?o.version=g.readVarint():_===2?o.name=g.readString():_===3?o.units=g.readString():_===4?o.tileSize=g.readVarint():_===5?o.buffer=g.readVarint():_===6?o.pixelFormat=g.readVarint():_===7&&o.dataIndex.push(function(_e,rt){return _e.readFields(dD,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},rt)}(g,g.readVarint()+g.pos))}function fD(_,o,g){if(_===2)(function(_e,rt,ot){_e.readFields(mD,ot,rt)})(g,g.readVarint()+g.pos,o);else if(_===3)throw new Error("Not implemented")}function mD(_,o,g){if(_===1){let _e=0;const rt=g.readVarint()+g.pos;for(;g.pos<rt;)o[_e++]=g.readVarint()}}function gD(_,o){if(o.length!==4)throw new Error(`Expected data of dimension 4 but got ${o.length}.`);let g=o[3];for(let _e=2;_e>=1;_e--){const rt=_e===1?1:0,ot=_e===2?1:0;for(let at=0;at<o[0];at++){const ut=o[1]*at;for(let ft=rt;ft<o[1];ft++){const gt=o[2]*(ft+ut);for(let Ct=ot;Ct<o[2];Ct++){const At=o[3]*(Ct+gt);for(let kt=0;kt<o[3];kt++){const zt=At+kt;_[zt]+=_[zt-g]}}}}g*=o[_e]}return _}function _D(_){for(let o=0,g=_.length;o<g;o++)_[o]=_[o]>>>1^-(1&_[o]);return _}function yD(_,o){switch(o){case"uint32":return _;case"uint16":for(let g=0;g<_.length;g+=2){const _e=_[g],rt=_[g+1];_[g]=(240&_e)>>4|(61440&_e)>>8|(240&rt)<<4|61440&rt,_[g+1]=15&_e|(3840&_e)>>4|(15&rt)<<8|(3840&rt)<<4}return _;case"uint8":for(let g=0;g<_.length;g+=4){const _e=_[g],rt=_[g+1],ot=_[g+2],at=_[g+3];_[g+0]=(192&_e)>>6|(192&rt)>>4|(192&ot)>>2|192&at,_[g+1]=(48&_e)>>4|(48&rt)>>2|48&ot|(48&at)<<2,_[g+2]=(12&_e)>>2|12&rt|(12&ot)<<2|(12&at)<<4,_[g+3]=3&_e|(3&rt)<<2|(3&ot)<<4|(3&at)<<6}return _;default:throw new Error(`Invalid pixel format, "${o}"`)}}qn(KE,"DEMData"),qn(xR,"DemMinMaxQuadTree",{omit:["dem"]});var Ap=Uint8Array,W1=Uint16Array,xD=Int32Array,bR=new Ap([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),wR=new Ap([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),vD=new Ap([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ER=function(_,o){for(var g=new W1(31),_e=0;_e<31;++_e)g[_e]=o+=1<<_[_e-1];var rt=new xD(g[30]);for(_e=1;_e<30;++_e)for(var ot=g[_e];ot<g[_e+1];++ot)rt[ot]=ot-g[_e]<<5|_e;return{b:g,r:rt}},TR=ER(bR,2),SR=TR.b,bD=TR.r;SR[28]=258,bD[258]=28;for(var wD=ER(wR,0).b,CR=new W1(32768),Hl=0;Hl<32768;++Hl){var Hx=(43690&Hl)>>1|(21845&Hl)<<1;CR[Hl]=((65280&(Hx=(61680&(Hx=(52428&Hx)>>2|(13107&Hx)<<2))>>4|(3855&Hx)<<4))>>8|(255&Hx)<<8)>>1}var q1=function(_,o,g){for(var _e=_.length,rt=0,ot=new W1(o);rt<_e;++rt)_[rt]&&++ot[_[rt]-1];var at,ut=new W1(o);for(rt=1;rt<o;++rt)ut[rt]=ut[rt-1]+ot[rt-1]<<1;at=new W1(1<<o);var ft=15-o;for(rt=0;rt<_e;++rt)if(_[rt])for(var gt=rt<<4|_[rt],Ct=o-_[rt],At=ut[_[rt]-1]++<<Ct,kt=At|(1<<Ct)-1;At<=kt;++At)at[CR[At]>>ft]=gt;return at},K1=new Ap(288);for(Hl=0;Hl<144;++Hl)K1[Hl]=8;for(Hl=144;Hl<256;++Hl)K1[Hl]=9;for(Hl=256;Hl<280;++Hl)K1[Hl]=7;for(Hl=280;Hl<288;++Hl)K1[Hl]=8;var AR=new Ap(32);for(Hl=0;Hl<32;++Hl)AR[Hl]=5;var ED=q1(K1,9),TD=q1(AR,5),GS=function(_){for(var o=_[0],g=1;g<_.length;++g)_[g]>o&&(o=_[g]);return o},mm=function(_,o,g){var _e=o/8|0;return(_[_e]|_[_e+1]<<8)>>(7&o)&g},HS=function(_,o){var g=o/8|0;return(_[g]|_[g+1]<<8|_[g+2]<<16)>>(7&o)},SD=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],gm=function(_,o,g){var _e=new Error(o||SD[_]);if(_e.code=_,Error.captureStackTrace&&Error.captureStackTrace(_e,gm),!g)throw _e;return _e},CD=new Ap(0),AD=typeof TextDecoder<"u"&&new TextDecoder;try{AD.decode(CD,{stream:!0})}catch{}const RD={gzip_data:"gzip"};class Hp extends Error{constructor(o){super(o),this.name="MRTError"}}const ID={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},RR={uint32:1,uint16:2,uint8:4},PD={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let WS;class XE{constructor(o=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=o}getLayer(o){const g=this.layers[o];if(!g)throw new Hp(`Layer '${o}' not found`);return g}getHeaderLength(o){const g=new Uint8Array(o),_e=new DataView(o);if(g[0]!==13)throw new Hp("File is not a valid MRT.");return _e.getUint32(1,!0)}parseHeader(o){const g=new Uint8Array(o),_e=this.getHeaderLength(o);if(g.length<_e)throw new Hp(`Expected header with length >= ${_e} but got buffer of length ${g.length}`);const rt=new WS(g.subarray(0,_e)).readFields(lD,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==rt.x||this.y!==rt.y||this.z!==rt.z))throw new Hp(`Invalid attempt to parse header ${rt.z}/${rt.x}/${rt.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=rt.x,this.y=rt.y,this.z=rt.z;for(const ot of rt.layers)this.layers[ot.name]=new IR(ot,{cacheSize:this._cacheSize});return this}createDecodingTask(o){const g=[],_e=this.getLayer(o.layerName);for(let rt of o.blockIndices){const ot=_e.dataIndex[rt],at=ot.firstByte-o.firstByte,ut=ot.lastByte-o.firstByte;if(_e._blocksInProgress.has(rt))continue;const ft={layerName:_e.name,firstByte:at,lastByte:ut,pixelFormat:_e.pixelFormat,blockIndex:rt,blockShape:[ot.bands.length].concat(_e.bandShape),buffer:_e.buffer,codec:ot.codec.codec,filters:ot.filters.map(gt=>gt.filter)};_e._blocksInProgress.add(rt),g.push(ft)}return new PR(g,()=>{g.forEach(rt=>_e._blocksInProgress.delete(rt.blockIndex))},(rt,ot)=>{if(g.forEach(at=>_e._blocksInProgress.delete(at.blockIndex)),rt)throw rt;ot.forEach(at=>{this.getLayer(at.layerName).processDecodedData(at)})})}}class IR{constructor({version:o,name:g,units:_e,tileSize:rt,pixelFormat:ot,buffer:at,dataIndex:ut},ft){if(this.version=o,this.version!==1)throw new Hp(`Cannot parse raster layer encoded with MRT version ${o}`);this.name=g,this.units=_e,this.tileSize=rt,this.buffer=at,this.pixelFormat=ID[ot],this.dataIndex=ut,this.bandShape=[rt+2*at,rt+2*at,RR[this.pixelFormat]],this._decodedBlocks=new qE(ft?ft.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return RR[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:o})=>o).flat()}processDecodedData(o){const g=o.blockIndex.toString();this._decodedBlocks.get(g)||this._decodedBlocks.put(g,o.data)}getBlockForBand(o){let g=0;switch(typeof o){case"string":for(const[_e,rt]of this.dataIndex.entries()){for(const[ot,at]of rt.bands.entries())if(at===o)return{bandIndex:g+ot,blockIndex:_e,blockBandIndex:ot};g+=rt.bands.length}break;case"number":for(const[_e,rt]of this.dataIndex.entries()){if(o>=g&&o<g+rt.bands.length)return{bandIndex:o,blockIndex:_e,blockBandIndex:o-g};g+=rt.bands.length}break;default:throw new Hp(`Invalid band \`${JSON.stringify(o)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(o){let g=1/0,_e=-1/0;const rt=[],ot=new Set;for(const at of o){const{blockIndex:ut}=this.getBlockForBand(at);if(ut<0)throw new Hp(`Invalid band: ${JSON.stringify(at)}`);const ft=this.dataIndex[ut];rt.includes(ut)||rt.push(ut),ot.add(ut),g=Math.min(g,ft.firstByte),_e=Math.max(_e,ft.lastByte)}if(ot.size>this.cacheSize)throw new Hp(`Number of blocks to decode (${ot.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:g,lastByte:_e,blockIndices:rt}}hasBand(o){const{blockIndex:g}=this.getBlockForBand(o);return g>=0}hasDataForBand(o){const{blockIndex:g}=this.getBlockForBand(o);return g>=0&&!!this._decodedBlocks.get(g.toString())}getBandView(o){const{blockIndex:g,blockBandIndex:_e}=this.getBlockForBand(o);if(g<0)throw new Hp(`Band not found: ${JSON.stringify(o)}`);const rt=this._decodedBlocks.get(g.toString());if(!rt)throw new Hp(`Data for band ${JSON.stringify(o)} of layer "${this.name}" not decoded.`);const ot=this.dataIndex[g],at=this.bandShape.reduce((gt,Ct)=>gt*Ct,1),ut=_e*at,ft=rt.subarray(ut,ut+at);return{data:ft,bytes:new Uint8Array(ft.buffer).subarray(ft.byteOffset,ft.byteOffset+ft.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:ot.offset,scale:ot.scale}}}XE.setPbf=function(_){WS=_};class PR{constructor(o,g,_e){this.tasks=o,this._onCancel=g,this._onComplete=_e,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(o,g){this._finalized||(this._onComplete(o,g),this._finalized=!0)}}XE.performDecoding=function(_,o){const g=new Uint8Array(_);return Promise.all(o.tasks.map(_e=>{const{layerName:rt,firstByte:ot,lastByte:at,pixelFormat:ut,blockShape:ft,blockIndex:gt,filters:Ct,codec:At}=_e,kt=g.subarray(ot,at+1),zt=new Uint32Array(ft[0]*ft[1]*ft[2]);let Ut;if(At!=="gzip_data")throw new Hp(`Unhandled codec: ${At}`);return Ut=function(Kt,er){if(!globalThis.DecompressionStream&&er==="gzip_data")return Promise.resolve(((pr=function(Rr){Rr[0]==31&&Rr[1]==139&&Rr[2]==8||gm(6,"invalid gzip data");var Mr=Rr[3],Lr=10;4&Mr&&(Lr+=2+(Rr[10]|Rr[11]<<8));for(var Jr=(Mr>>3&1)+(Mr>>4&1);Jr>0;Jr-=!Rr[Lr++]);return Lr+(2&Mr)}(lr=Kt))+8>lr.length&&gm(6,"invalid gzip data"),function(Rr,Mr,Lr,Jr){var zr=Rr.length;if(!zr||Mr.f&&!Mr.l)return Lr||new Ap(0);var sn=!Lr,dn=sn||Mr.i!=2,pn=Mr.i;sn&&(Lr=new Ap(3*zr));var wn,Tn,xn=function(bo){var oo=Lr.length;if(bo>oo){var ho=new Ap(Math.max(2*oo,bo));ho.set(Lr),Lr=ho}},vn=Mr.f||0,nn=Mr.p||0,en=Mr.b||0,bn=Mr.l,Dn=Mr.d,Rn=Mr.m,ts=Mr.n,Vn=8*zr;do{if(!bn){vn=mm(Rr,nn,1);var Hn=mm(Rr,nn+1,3);if(nn+=3,!Hn){var Zn=Rr[(on=4+((nn+7)/8|0))-4]|Rr[on-3]<<8,js=on+Zn;if(js>zr){pn&&gm(0);break}dn&&xn(en+Zn),Lr.set(Rr.subarray(on,js),en),Mr.b=en+=Zn,Mr.p=nn=8*js,Mr.f=vn;continue}if(Hn==1)bn=ED,Dn=TD,Rn=9,ts=5;else if(Hn==2){var In=mm(Rr,nn,31)+257,Yn=mm(Rr,nn+10,15)+4,xs=In+mm(Rr,nn+5,31)+1;nn+=14;for(var Gs=new Ap(xs),Ws=new Ap(19),Rs=0;Rs<Yn;++Rs)Ws[vD[Rs]]=mm(Rr,nn+3*Rs,7);nn+=3*Yn;var vo=GS(Ws),wr=(1<<vo)-1,Cr=q1(Ws,vo);for(Rs=0;Rs<xs;){var on,En=Cr[mm(Rr,nn,wr)];if(nn+=15&En,(on=En>>4)<16)Gs[Rs++]=on;else{var Fn=0,Bn=0;for(on==16?(Bn=3+mm(Rr,nn,3),nn+=2,Fn=Gs[Rs-1]):on==17?(Bn=3+mm(Rr,nn,7),nn+=3):on==18&&(Bn=11+mm(Rr,nn,127),nn+=7);Bn--;)Gs[Rs++]=Fn}}var rs=Gs.subarray(0,In),ss=Gs.subarray(In);Rn=GS(rs),ts=GS(ss),bn=q1(rs,Rn),Dn=q1(ss,ts)}else gm(1);if(nn>Vn){pn&&gm(0);break}}dn&&xn(en+131072);for(var Ts=(1<<Rn)-1,Ns=(1<<ts)-1,Os=nn;;Os=nn){var zs=(Fn=bn[HS(Rr,nn)&Ts])>>4;if((nn+=15&Fn)>Vn){pn&&gm(0);break}if(Fn||gm(2),zs<256)Lr[en++]=zs;else{if(zs==256){Os=nn,bn=null;break}var ds=zs-254;zs>264&&(ds=mm(Rr,nn,(1<<(io=bR[Rs=zs-257]))-1)+SR[Rs],nn+=io);var ys=Dn[HS(Rr,nn)&Ns],Qs=ys>>4;if(ys||gm(3),nn+=15&ys,ss=wD[Qs],Qs>3){var io=wR[Qs];ss+=HS(Rr,nn)&(1<<io)-1,nn+=io}if(nn>Vn){pn&&gm(0);break}dn&&xn(en+131072);var no=en+ds;if(en<ss){var go=0-ss,Ao=Math.min(ss,no);for(go+en<0&&gm(3);en<Ao;++en)Lr[en]=(void 0)[go+en]}for(;en<no;++en)Lr[en]=Lr[en-ss]}}Mr.l=bn,Mr.p=Os,Mr.b=en,Mr.f=vn,bn&&(vn=1,Mr.m=Rn,Mr.d=Dn,Mr.n=ts)}while(!vn);return en!=Lr.length&&sn?(wn=Lr,((Tn=en)==null||Tn>wn.length)&&(Tn=wn.length),new Ap(wn.subarray(0,Tn))):Lr.subarray(0,en)}(lr.subarray(pr,-8),{i:2},new Ap(((Jt=lr)[(or=Jt.length)-4]|Jt[or-3]<<8|Jt[or-2]<<16|Jt[or-1]<<24)>>>0))));var Jt,or,lr,pr;const Sr=RD[er];if(!Sr)throw new Error(`Unhandled codec: ${er}`);const br=new globalThis.DecompressionStream(Sr);return new Response(new Blob([Kt]).stream().pipeThrough(br)).arrayBuffer().then(Rr=>new Uint8Array(Rr))}(kt,At).then(Kt=>(function(er,Jt){er.readFields(fD,Jt)}(new WS(Kt),zt),new PD[ut](zt.buffer))),Ut.then(Kt=>{for(let er=Ct.length-1;er>=0;er--)switch(Ct[er]){case"delta_filter":gD(Kt,ft);break;case"zigzag_filter":_D(Kt);break;case"bitshuffle_filter":yD(Kt,ut);break;default:throw new Hp(`Unhandled filter "${Ct[er]}"`)}return{layerName:rt,blockIndex:gt,data:Kt}}).catch(Kt=>{throw Kt})}))},qn(PR,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),qn(XE,"MapboxRasterTile"),qn(IR,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class kR{constructor(o){this._stringToNumber={},this._numberToString=[];for(let g=0;g<o.length;g++){const _e=o[g];this._stringToNumber[_e]=g,this._numberToString[g]=_e}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}class MR{constructor(o,g){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new O0(Mn,16,0),this.featureIndexArray=new i1,this.promoteId=g,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(o,g,_e,rt,ot,at=0,ut=0){const ft=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(_e,rt,ot,at);const gt=this.grid;for(let Ct=0;Ct<g.length;Ct++){const At=g[Ct],kt=[1/0,1/0,-1/0,-1/0];for(let zt=0;zt<At.length;zt++){const Ut=At[zt];kt[0]=Math.min(kt[0],Ut.x),kt[1]=Math.min(kt[1],Ut.y),kt[2]=Math.max(kt[2],Ut.x),kt[3]=Math.max(kt[3],Ut.y)}ut!==0&&(kt[0]-=ut,kt[1]-=ut,kt[2]+=ut,kt[3]+=ut),kt[0]<Mn&&kt[1]<Mn&&kt[2]>=0&&kt[3]>=0&&gt.insert(ft,kt[0],kt[1],kt[2],kt[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new qr(new SE(this.rawTileData)).layers,this.sourceLayerCoder=new kR(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,g){const{tilespaceGeometry:_e,transform:rt,tileTransform:ot,pixelPosMatrix:at,availableImages:ut,worldview:ft}=g;this.loadVTLayers(),this.serializedLayersCache.clear();const gt=g.queryRadius?g.queryRadius:0,Ct=_e.bufferedTilespaceBounds,At=this.grid.query(Ct.min.x,Ct.min.y,Ct.max.x,Ct.max.y,(Kt,er,Jt,or)=>Pu(_e.bufferedTilespaceGeometry,Kt-gt,er-gt,Jt+gt,or+gt));At.sort(kD);let kt=null;rt.elevation&&At.length>0&&(kt=Ux.create(rt.elevation,this.tileID));const zt={};let Ut;for(let Kt=0;Kt<At.length;Kt++){const er=At[Kt];if(er===Ut)continue;Ut=er;const Jt=this.featureIndexArray.get(er);let or=null;this.is3DTile?this.loadMatchingModelFeature(zt,Jt,o,_e,rt,ft):this.loadMatchingFeature(zt,Jt,o,ut,ft,(lr,pr,Sr,br=0)=>(or||(or=Pr(lr,this.tileID.canonical,ot)),pr.queryIntersectsFeature(_e,lr,Sr,or,this.z,rt,at,kt,br)))}return zt}loadMatchingFeature(o,g,_e,rt,ot,at){const{featureIndex:ut,bucketIndex:ft,sourceLayerIndex:gt,layoutVertexArrayOffset:Ct}=g,At=this.bucketLayerIDs[ft],kt=_e.layers,zt=Object.keys(kt);if(zt.length&&!Wn(zt,At))return;const Ut=_e.sourceCache,Kt=this.sourceLayerCoder.decode(gt),er=this.vtLayers[Kt].feature(ut),Jt=this.getId(er,Kt);for(let or=0;or<At.length;or++){const lr=At[or];if(!kt[lr])continue;const{styleLayer:pr,targets:Sr}=kt[lr];let br={};Jt!==void 0&&(br=Ut.getFeatureState(pr.sourceLayer,Jt));const Rr=!at||at(er,pr,br,Ct);if(!Rr)continue;const Mr=new J_(er,this.z,this.x,this.y,Jt);Mr.tile=this.tileID.canonical,Mr.state=br;let Lr=this.serializedLayersCache.get(lr);Lr||(Lr=pr.serialize(),Lr.id=lr,this.serializedLayersCache.set(lr,Lr)),Mr.source=Lr.source,Mr.sourceLayer=Lr["source-layer"],Mr.layer=Object.assign({},Lr),Mr.layer.paint=DR(Lr.paint,pr.paint,er,br,rt),Mr.layer.layout=DR(Lr.layout,pr.layout,er,br,rt);let Jr=!1;for(const zr of Sr){this.updateFeatureProperties(Mr,zr);const{filter:sn}=zr;if(sn){if(er.properties=Mr.properties,sn.needGeometry){const dn=Br(er,!0);if(!sn.filter(new Do(this.tileID.overscaledZ,{worldview:ot}),dn,this.tileID.canonical))continue}else if(!sn.filter(new Do(this.tileID.overscaledZ,{worldview:ot}),er))continue}Jr=!0,zr.targetId&&this.addFeatureVariant(Mr,zr)}Jr&&this.appendToResult(o,lr,ut,Mr,Rr)}}loadMatchingModelFeature(o,g,_e,rt,ot,at){const{featureIndex:ut,bucketIndex:ft}=g,gt=this.bucketLayerIDs[ft],Ct=_e.layers,At=Object.keys(Ct);if(!At.length||Wn(At,gt))for(let kt=0;kt<gt.length;kt++){const zt=gt[kt],{styleLayer:Ut,targets:Kt}=Ct[zt];if(Ut.type!=="model")continue;const er=rt.tile,Jt=er.getBucket(Ut);if(!(Jt&&Jt instanceof UE))continue;const or=FM(Jt,ut,rt,ot);if(!or)continue;const{z:lr,x:pr,y:Sr}=er.tileID.canonical,{feature:br,intersectionZ:Rr,position:Mr}=or;let Lr={};br.id!==void 0&&(Lr=_e.sourceCache.getFeatureState(Ut.sourceLayer,br.id));const Jr=new J_({},lr,pr,Sr,br.id);Jr.tile=this.tileID.canonical,Jr.state=Lr,Jr.properties=br.properties,Jr.geometry={type:"Point",coordinates:[Mr.lng,Mr.lat]};let zr=this.serializedLayersCache.get(zt);zr||(zr=Ut.serialize(),zr.id=zt,this.serializedLayersCache.set(zt,zr)),Jr.source=zr.source,Jr.sourceLayer=zr["source-layer"],Jr.layer=Object.assign({},zr);let sn=!1;for(const dn of Kt){this.updateFeatureProperties(Jr,dn);const{filter:pn}=dn;if(pn){if(br.properties=Jr.properties,pn.needGeometry){if(!pn.filter(new Do(this.tileID.overscaledZ,{worldview:at}),br,this.tileID.canonical))continue}else if(!pn.filter(new Do(this.tileID.overscaledZ,{worldview:at}),br))continue}sn=!0,dn.targetId&&this.addFeatureVariant(Jr,dn)}sn&&this.appendToResult(o,zt,ut,Jr,Rr)}}updateFeatureProperties(o,g,_e){if(g.properties){const rt={};for(const ot in g.properties){const at=g.properties[ot].evaluate({zoom:this.z},o._vectorTileFeature,o.state,o.tile,_e);at!=null&&(rt[ot]=at)}o.properties=rt}}addFeatureVariant(o,g,_e){const rt={target:g.target,namespace:g.namespace,uniqueFeatureID:g.uniqueFeatureID};g.properties&&(rt.properties=o.properties),o.variants=o.variants||{},o.variants[g.targetId]=o.variants[g.targetId]||[],o.variants[g.targetId].push(rt)}appendToResult(o,g,_e,rt,ot){let at=o[g];at===void 0&&(at=o[g]=[]),at.push({featureIndex:_e,feature:rt,intersectionZ:ot})}lookupSymbolFeatures(o,g,_e,rt,ot,at){const ut={};this.loadVTLayers();for(const ft of o)this.loadMatchingFeature(ut,{bucketIndex:g,sourceLayerIndex:_e,featureIndex:ft,layoutVertexArrayOffset:0},rt,ot,at);return ut}loadFeature(o){const{featureIndex:g,sourceLayerIndex:_e}=o;this.loadVTLayers();const rt=this.sourceLayerCoder.decode(_e),ot=this.vtFeatures[rt];if(ot[g])return ot[g];const at=this.vtLayers[rt].feature(g);return ot[g]=at,at}hasLayer(o){for(const g of this.bucketLayerIDs)for(const _e of g)if(o===_e)return!0;return!1}getId(o,g){let _e=o.id;if(this.promoteId){const rt=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[g];if(rt!=null)if(Array.isArray(rt)){if(!this.promoteIdExpression){const ot=Dm(rt);if(ot.result!=="success"){const at=ot.value.map(ut=>`${ut.key}: ${ut.message}`).join(", ");return void $n(`Failed to create expression for promoteId: ${at}`)}this.promoteIdExpression=ot.value}_e=this.promoteIdExpression.evaluate({zoom:0},o)}else _e=o.properties[rt];typeof _e=="boolean"&&(_e=Number(_e))}return _e}}function DR(_,o,g,_e,rt){return Xr(_,(ot,at)=>{const ut=o instanceof a0?o.get(at):null;return ut&&ut.evaluate?ut.evaluate(g,_e,void 0,rt):ut})}function kD(_,o){return o-_}qn(MR,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const NR=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class qS{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[g,_e]=new Uint8Array(o,0,2);if(g!==219)throw new Error("Data does not appear to be in a KDBush format.");const rt=_e>>4;if(rt!==1)throw new Error(`Got v${rt} data when expected v1.`);const ot=NR[15&_e];if(!ot)throw new Error("Unrecognized array type.");const[at]=new Uint16Array(o,2,1),[ut]=new Uint32Array(o,4,1);return new qS(ut,at,ot,o)}constructor(o,g=64,_e=Float64Array,rt){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+g,2),65535),this.ArrayType=_e,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const ot=NR.indexOf(this.ArrayType),at=2*o*this.ArrayType.BYTES_PER_ELEMENT,ut=o*this.IndexArrayType.BYTES_PER_ELEMENT,ft=(8-ut%8)%8;if(ot<0)throw new Error(`Unexpected typed array class: ${_e}.`);rt&&rt instanceof ArrayBuffer?(this.data=rt,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+ut+ft,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+at+ut+ft),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+ut+ft,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+ot]),new Uint16Array(this.data,2,1)[0]=g,new Uint32Array(this.data,4,1)[0]=o)}add(o,g){const _e=this._pos>>1;return this.ids[_e]=_e,this.coords[this._pos++]=o,this.coords[this._pos++]=g,_e}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return KS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,g,_e,rt){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:ot,coords:at,nodeSize:ut}=this,ft=[0,ot.length-1,0],gt=[];for(;ft.length;){const Ct=ft.pop()||0,At=ft.pop()||0,kt=ft.pop()||0;if(At-kt<=ut){for(let er=kt;er<=At;er++){const Jt=at[2*er],or=at[2*er+1];Jt>=o&&Jt<=_e&&or>=g&&or<=rt&&gt.push(ot[er])}continue}const zt=kt+At>>1,Ut=at[2*zt],Kt=at[2*zt+1];Ut>=o&&Ut<=_e&&Kt>=g&&Kt<=rt&&gt.push(ot[zt]),(Ct===0?o<=Ut:g<=Kt)&&(ft.push(kt),ft.push(zt-1),ft.push(1-Ct)),(Ct===0?_e>=Ut:rt>=Kt)&&(ft.push(zt+1),ft.push(At),ft.push(1-Ct))}return gt}within(o,g,_e){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:rt,coords:ot,nodeSize:at}=this,ut=[0,rt.length-1,0],ft=[],gt=_e*_e;for(;ut.length;){const Ct=ut.pop()||0,At=ut.pop()||0,kt=ut.pop()||0;if(At-kt<=at){for(let er=kt;er<=At;er++)OR(ot[2*er],ot[2*er+1],o,g)<=gt&&ft.push(rt[er]);continue}const zt=kt+At>>1,Ut=ot[2*zt],Kt=ot[2*zt+1];OR(Ut,Kt,o,g)<=gt&&ft.push(rt[zt]),(Ct===0?o-_e<=Ut:g-_e<=Kt)&&(ut.push(kt),ut.push(zt-1),ut.push(1-Ct)),(Ct===0?o+_e>=Ut:g+_e>=Kt)&&(ut.push(zt+1),ut.push(At),ut.push(1-Ct))}return ft}}function KS(_,o,g,_e,rt,ot){if(rt-_e<=g)return;const at=_e+rt>>1;LR(_,o,at,_e,rt,ot),KS(_,o,g,_e,at-1,1-ot),KS(_,o,g,at+1,rt,1-ot)}function LR(_,o,g,_e,rt,ot){for(;rt>_e;){if(rt-_e>600){const gt=rt-_e+1,Ct=g-_e+1,At=Math.log(gt),kt=.5*Math.exp(2*At/3),zt=.5*Math.sqrt(At*kt*(gt-kt)/gt)*(Ct-gt/2<0?-1:1);LR(_,o,g,Math.max(_e,Math.floor(g-Ct*kt/gt+zt)),Math.min(rt,Math.floor(g+(gt-Ct)*kt/gt+zt)),ot)}const at=o[2*g+ot];let ut=_e,ft=rt;for(X1(_,o,_e,g),o[2*rt+ot]>at&&X1(_,o,_e,rt);ut<ft;){for(X1(_,o,ut,ft),ut++,ft--;o[2*ut+ot]<at;)ut++;for(;o[2*ft+ot]>at;)ft--}o[2*_e+ot]===at?X1(_,o,_e,ft):(ft++,X1(_,o,ft,rt)),ft<=g&&(_e=ft+1),g<=ft&&(rt=ft-1)}}function X1(_,o,g,_e){XS(_,g,_e),XS(o,2*g,2*_e),XS(o,2*g+1,2*_e+1)}function XS(_,o,g){const _e=_[o];_[o]=_[g],_[g]=_e}function OR(_,o,g,_e){const rt=_-g,ot=o-_e;return rt*rt+ot*ot}c.$=vy,c.A=Zp,c.B=Ep,c.C=2,c.D=Ix,c.E=Jm,c.F=P1,c.G=l2,c.H=xy,c.I=wu,c.J=Vw,c.K=es,c.L=E0,c.M=Gy,c.N=I_,c.O=Rw,c.P=mn,c.Q=P_,c.R=l_,c.S=ex,c.T=iS,c.U=Dm,c.V=VE,c.W=jv,c.X=R0,c.Y=A0,c.Z=E_,c._=Au,c.a=function(_){return Us.API_CDN_URL_REGEX.test(_)},c.a$=Ht,c.a0=_s,c.a1=np,c.a2=zp,c.a3=class extends VE{},c.a4=Hy,c.a5=Aw,c.a6=Gr,c.a7=function(_){const o=_.value;return o?_s(o)?NS(o,!0)?[]:[new VE(_.key,o,`invalid url "${o}"`)]:[new VE(_.key,o,`string expected, "${es(o)}" found`)]:[]},c.a8=jw,c.a9=ga,c.aA=tr,c.aB=Bt,c.aC=Jo,c.aD=mu,c.aE=So,c.aF=mt,c.aG=dr,c.aH=function(_,o){const g={};for(let _e=0;_e<o.length;_e++){const rt=o[_e];rt in _&&(g[rt]=_[rt])}return g},c.aI=st,c.aJ=Tt,c.aK=class{constructor(_){this.entries={},this.scheduler=_}request(_,o,g,_e){const rt=this.entries[_]=this.entries[_]||{callbacks:[]};if(rt.result){const[ot,at]=rt.result;return this.scheduler?this.scheduler.add(()=>{_e(ot,at)},o):_e(ot,at),()=>{}}return rt.callbacks.push(_e),rt.cancel||(rt.cancel=g((ot,at)=>{rt.result=[ot,at];for(const ut of rt.callbacks)this.scheduler?this.scheduler.add(()=>{ut(ot,at)},o):ut(ot,at);setTimeout(()=>delete this.entries[_],3e3)})),()=>{rt.result||(rt.callbacks=rt.callbacks.filter(ot=>ot!==_e),rt.callbacks.length||(rt.cancel(),delete this.entries[_]))}}},c.aL=function(_,o,g){const _e=JSON.stringify(_.request);return _.data&&(this.deduped.entries[_e]={result:[null,_.data]}),this.deduped.request(_e,{type:"parseTile",isSymbolTile:_.isSymbolTile,zoom:_.tileZoom},rt=>{const ot=Xp(_.request,(at,ut,ft)=>{at?rt(at):ut&&rt(null,{rawData:ut,vectorTile:g?void 0:new qr(new SE(ut)),responseHeaders:new Map(ft.entries())})});return()=>{ot.cancel(),rt()}},o)},c.aM=function(_){return _?{cacheControl:_.get("Cache-Control"),expires:_.get("Expires")}:{cacheControl:void 0,expires:void 0}},c.aN=zu,c.aO=function(_){rp++,rp>cy&&(_.getActor().send("enforceCacheSizeLimit",ly),rp=0)},c.aP=function(_){return _<=1?1:Math.pow(2,Math.floor(Math.log2(_)))},c.aQ=Yo,c.aR=j2,c.aS=$2,c.aT=$,c.aU=O2,c.aV=function(_,o){const g=document.createElement("video");g.muted=!0,g.onloadstart=function(){o(null,g)};for(let _e=0;_e<_.length;_e++){const rt=document.createElement("source");YE(_[_e])||(g.crossOrigin="Anonymous"),rt.src=_[_e],g.appendChild(rt)}return{cancel:()=>{}}},c.aW=S1,c.aX=ey,c.aY=Vr,c.aZ=N1,c.a_=Mt,c.aa=Pn,c.ab=class{constructor(_){this.specification=_}possiblyEvaluate(_,o){return As(_.expression.evaluate(o))}interpolate(_,o,g){return{x:fs(_.x,o.x,g),y:fs(_.y,o.y,g),z:fs(_.z,o.z,g),azimuthal:fs(_.azimuthal,o.azimuthal,g),polar:fs(_.polar,o.polar,g)}}},c.ac=Do,c.ad=n0,c.ae=hr,c.af=ws,c.ag=_i,c.ah=ar,c.ai=a0,c.aj=q0,c.ak=fs,c.al=Mn,c.am=ov,c.an=Fs,c.ao=fo,c.ap=class{constructor(_){this.specification=_}possiblyEvaluate(_,o){return function([g,_e]){const rt=As([1,g,_e]);return{x:rt.x,y:rt.y,z:rt.z}}(_.expression.evaluate(o))}interpolate(_,o,g){return{x:fs(_.x,o.x,g),y:fs(_.y,o.y,g),z:fs(_.z,o.z,g)}}},c.aq=function(_,o,g=0,_e=!0){const rt=new mn(g,g),ot=_.sub(rt),at=o.add(rt),ut=[ot,new mn(at.x,ot.y),at,new mn(ot.x,at.y)];return _e&&ut.push(ot.clone()),ut},c.ar=function(_,o){const g=[];for(let _e=0;_e<_.length;_e++){const rt=yr(_e-1,-1,_.length-1),ot=yr(_e+1,-1,_.length-1),at=_[_e],ut=_[ot],ft=_[rt].sub(at).unit(),gt=ut.sub(at).unit(),Ct=gt.angleWithSep(ft.x,ft.y),At=ft.add(gt).unit().mult(-1*o/Math.sin(Ct/2));g.push(at.add(At))}return g},c.as=b2,c.at=Pu,c.au=function(_,o,g=0){return xr(((o.x-g)*_.scale-_.x)*Mn,(o.y*_.scale-_.y)*Mn,$t(o.z,o.y))},c.av=wo,c.aw=ls,c.ax=Kn,c.ay=OA,c.az=function(_){let o=1/0,g=1/0,_e=-1/0,rt=-1/0;for(const ot of _)o=Math.min(o,ot.x),g=Math.min(g,ot.y),_e=Math.max(_e,ot.x),rt=Math.max(rt,ot.y);return{min:new mn(o,g),max:new mn(_e,rt)}},c.b=function(_){return Us.API_FONTS_REGEX.test(_)},c.b$=OC,c.b0=Fl,c.b1=B0,c.b2=jr,c.b3=Zw,c.b4=jE,c.b5=function(){rm.isLoading()||rm.isLoaded()||N_()!=="deferred"||Ow()},c.b6=tx,c.b7=Br,c.b8=J_,c.b9=na,c.bA=Gt,c.bB=ur,c.bC=Nt,c.bD=function(_,o){const{x:g,y:_e}=_.point,rt=tC(g,_e,_.worldSize/_._pixelsPerMercatorPixel,0,0);return Bt(rt,rt,MT(Cp(o)))},c.bE=xt,c.bF=Qo,c.bG=vs,c.bH=jn,c.bI=Ss,c.bJ=ms,c.bK=jx,c.bL=Qu,c.bM=bS,c.bN=function(_,o,g,_e,rt){const ot=5*o+2;_.float32[ot+0]=g,_.float32[ot+1]=_e,_.float32[ot+2]=rt},c.bO=Vx,c.bP=hu,c.bQ=tp,c.bR=Pp,c.bS=lo,c.bT=yr,c.bU=function(_,o,g,_e){var rt=new pt(4);return rt[0]=_,rt[1]=o,rt[2]=g,rt[3]=_e,rt},c.bV=class{isDataAvailableAtPoint(_){const o=this._source();if(this.isUsingMockSource()||!o||_.y<0||_.y>1)return!1;const g=o.getSource().maxzoom,_e=1<<g,rt=Math.floor(_.x),ot=Math.floor((_.x-rt)*_e),at=Math.floor(_.y*_e),ut=this.findDEMTileFor(new Yo(g,rt,g,ot,at));return!(!ut||!ut.dem)}getAtPointOrZero(_,o=0){return this.getAtPoint(_,o)||0}getAtPoint(_,o,g=!0){if(this.isUsingMockSource())return null;o==null&&(o=null);const _e=this._source();if(!_e||_.y<0||_.y>1)return o;const rt=_e.getSource().maxzoom,ot=1<<rt,at=Math.floor(_.x),ut=_.x-at,ft=new Yo(rt,at,rt,Math.floor(ut*ot),Math.floor(_.y*ot)),gt=this.findDEMTileFor(ft);if(!gt||!gt.dem)return o;const Ct=gt.dem,At=1<<gt.tileID.canonical.z,kt=(ut*At-gt.tileID.canonical.x)*Ct.dim,zt=(_.y*At-gt.tileID.canonical.y)*Ct.dim,Ut=Math.floor(kt),Kt=Math.floor(zt);return(g?this.exaggeration():1)*fs(fs(Ct.get(Ut,Kt),Ct.get(Ut,Kt+1),zt-Kt),fs(Ct.get(Ut+1,Kt),Ct.get(Ut+1,Kt+1),zt-Kt),kt-Ut)}static getAtTileOffset(_,o,g,_e){const rt=1<<_.canonical.z;return _e?_e.pointElevation(o):g?g.getAtPointOrZero(new hr(_.wrap+(_.canonical.x+o.x/Mn)/rt,(_.canonical.y+o.y/Mn)/rt)):0}static getAtTileOffsetFunc(_,o,g,_e){return(rt,ot,at)=>{const ut=this.getAtTileOffset(_,rt,ot,at),ft=_e.upVector(_.canonical,rt.x,rt.y);return fn(ft,ft,ut*_e.upVectorScale(_.canonical,o,g).metersToTile),ft}}getForTilePoints(_,o,g,_e){if(this.isUsingMockSource())return!1;const rt=Ux.create(this,_,_e);return!!rt&&(o.forEach(ot=>{ot[2]=this.exaggeration()*rt.getElevationAt(ot[0],ot[1],g)}),!0)}getMinMaxForTile(_){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(_);if(!o||!o.dem)return null;const g=o.dem.tree,_e=o.tileID,rt=1<<_.canonical.z-_e.canonical.z;let ot=_.canonical.x/rt-_e.canonical.x,at=_.canonical.y/rt-_e.canonical.y,ut=0;for(let ft=0;ft<_.canonical.z-_e.canonical.z&&!g.leaves[ut];ft++){ot*=2,at*=2;const gt=2*Math.floor(at)+Math.floor(ot);ut=g.childOffsets[ut]+gt,ot%=1,at%=1}return{min:this.exaggeration()*g.minimums[ut],max:this.exaggeration()*g.maximums[ut]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(_,o,g){throw new Error("Pure virtual method called.")}pointCoordinate(_){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(_){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const _=this.visibleDemTiles;if(_.length===0)return null;let o=!1,g=Number.MAX_VALUE,_e=Number.MIN_VALUE;for(const rt of _){const ot=this.getMinMaxForTile(rt.tileID);ot&&(g=Math.min(g,ot.min),_e=Math.max(_e,ot.max),o=!0)}return o?{min:g,max:_e}:null}},c.bW=fE,c.bX=to,c.bY=Yl,c.bZ=MC,c.b_=G2,c.ba=dS,c.bb=UT,c.bc=Pr,c.bd=Lm,c.be=jm,c.bf=H0,c.bg=Go,c.bh=Ax,c.bi=MS,c.bj=function(_,o){const g=q0(o.zoom);if(g===0)return Cp(_);const _e=iE(_),rt=kT(_e),ot=mt(_e.getWest())*o.worldSize,at=mt(_e.getEast())*o.worldSize,ut=Tt(_e.getNorth())*o.worldSize,ft=Tt(_e.getSouth())*o.worldSize,gt=[ot,ut,0],Ct=[at,ut,0],At=[ot,ft,0],kt=[at,ft,0],zt=Dt([],o.globeMatrix);return ws(gt,gt,zt),ws(Ct,Ct,zt),ws(At,At,zt),ws(kt,kt,zt),rt[0]=hm(rt[0],At,g),rt[1]=hm(rt[1],kt,g),rt[2]=hm(rt[2],Ct,g),rt[3]=hm(rt[3],gt,g),Jn.fromPoints(rt)},c.bk=sE,c.bl=Dt,c.bm=c1,c.bn=hm,c.bo=F0,c.bp=H_,c.bq=_r,c.br=Lt,c.bs=XE,c.bt=SE,c.bu=Xp,c.bv=function(_,o){const g=[];for(const _e in _)_e in o||g.push(_e);return g},c.bw=Dr,c.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],c.by=du,c.bz=It,c.c=lu,c.c$=function(_,o,g){let _e=0;for(let rt=0;rt<2;++rt)_[rt]>0&&(_e+=(_[rt]-0)*(_[rt]-0)),o[rt]<0&&(_e+=(0-o[rt])*(0-o[rt]));return _e},c.c0=jC,c.c1=yS,c.c2=m2,c.c3=CS,c.c4=qS,c.c5=fn,c.c6=ou,c.c7=xa,c.c8=function(_,o,g){g*=.5;var _e=o[0],rt=o[1],ot=o[2],at=o[3],ut=Math.sin(g),ft=Math.cos(g);return _[0]=_e*ft+rt*ut,_[1]=rt*ft-_e*ut,_[2]=ot*ft+at*ut,_[3]=at*ft-ot*ut,_},c.c9=Il,c.cA=rn,c.cB=so,c.cC=bA,c.cD=Co,c.cE=QS,c.cF=function(_,o,g,_e,rt,ot,at,ut,ft){if(ft.name==="globe")return QS(_,o,new Co(g,_e,rt),!1);const gt=N1({z:g,x:_e,y:rt},ft);return new Jn([(ot+gt.x/gt.scale)*o,o*(gt.y/gt.scale),at],[(ot+gt.x2/gt.scale)*o,o*(gt.y2/gt.scale),ut])},c.cG=function(_,o,g){return _[0]=Math.min(o[0],g[0]),_[1]=Math.min(o[1],g[1]),_[2]=Math.min(o[2],g[2]),_[3]=Math.min(o[3],g[3]),_},c.cH=function(_,o,g){return _[0]=Math.max(o[0],g[0]),_[1]=Math.max(o[1],g[1]),_[2]=Math.max(o[2],g[2]),_[3]=Math.max(o[3],g[3]),_},c.cI=function(_){const o=Math.round((_+45+360)%360/90)%4;return rv[o]},c.cJ=qt,c.cK=ru,c.cL=Cx,c.cM=function(_){const o=Gt(new Float64Array(16));Bt(o,_.pixelMatrix,_.globeMatrix);const g=[0,hp,0],_e=[0,dp,0];return ws(g,g,o),ws(_e,_e,o),[g[0]>0&&g[0]<=_.width&&g[1]>0&&g[1]<=_.height&&!NT(_,new $(_.center.lat,90)),_e[0]>0&&_e[0]<=_.width&&_e[1]>0&&_e[1]<=_.height&&!NT(_,new $(_.center.lat,-90))]},c.cN=function(_,o){const{scale:g}=_.tileTransform,_e=g*Mn/(_.tileSize*Math.pow(2,o.zoom-_.tileID.overscaledZ+_.tileID.canonical.z));return function(rt,ot,at){var ut=ot[1],ft=ot[2],gt=ot[3],Ct=at[0],At=at[1];return rt[0]=ot[0]*Ct,rt[1]=ut*Ct,rt[2]=ft*At,rt[3]=gt*At,rt}(new Float32Array(4),o.inverseAdjustmentMatrix,[_e,_e])},c.cO=xE,c.cP=Fr,c.cQ=vA,c.cR=function(_){const o=vA(_,!0);return xt([],[o[0],o[1],o[4],o[5]])},c.cS=Vt,c.cT=zn,c.cU=Zt,c.cV=function(_){const{x:o,y:g}=_.point,{lng:_e,lat:rt}=_._center;return tC(o,g,_.worldSize,_e,rt)},c.cW=Hr,c.cX=vu,c.cY=Wo,c.cZ=cu,c.c_=up,c.ca=ba,c.cb=function(_,o){return _[0]=-o[0],_[1]=-o[1],_[2]=-o[2],_[3]=o[3],_},c.cc=an,c.cd=function(_,o,g,_e,rt){var ot=1/Math.tan(o/2);if(_[0]=ot/g,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=ot,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,rt!=null&&rt!==1/0){var at=1/(_e-rt);_[10]=(rt+_e)*at,_[14]=2*rt*_e*at}else _[10]=-1,_[14]=-2*_e;return _},c.ce=function(_,o,g,_e,rt,ot,at){var ut=1/(o-g),ft=1/(_e-rt),gt=1/(ot-at);return _[0]=-2*ut,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*ft,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=2*gt,_[11]=0,_[12]=(o+g)*ut,_[13]=(rt+_e)*ft,_[14]=(at+ot)*gt,_[15]=1,_},c.cf=Pt,c.cg=function(_,o,g){_[4*o+0]=g[0],_[4*o+1]=g[1],_[4*o+2]=g[2],_[4*o+3]=g[3]},c.ch=wx,c.ci=B_,c.cj=Bl,c.ck=$p,c.cl=V_,c.cm=C2,c.cn=function(){var _=new pt(4);return pt!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_},c.co=function(_,o,g){var _e=o[0],rt=o[1],ot=o[2],at=o[3],ut=Math.sin(g),ft=Math.cos(g);return _[0]=_e*ft+ot*ut,_[1]=rt*ft+at*ut,_[2]=_e*-ut+ot*ft,_[3]=rt*-ut+at*ft,_},c.cp=function(_,o){return _[0]===o[0]&&_[1]===o[1]&&_[2]===o[2]&&_[3]===o[3]},c.cq=Vo,c.cr=function(_){var o=_[0],g=_[1],_e=_[2],rt=_[3];return Math.sqrt(o*o+g*g+_e*_e+rt*rt)},c.cs=Rp,c.ct=Rl,c.cu=Al,c.cv=3,c.cw=2,c.cx=7,c.cy=6,c.cz=Ks,c.d=function(_){return Us.API_TILEJSON_REGEX.test(_)},c.d$=class{constructor(_,o,g,_e){this.context=_,this.format=_e,this.size=g,this.texture=_.gl.createTexture();const[rt,ot,at]=this.size,{gl:ut}=_;ut.bindTexture(ut.TEXTURE_3D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in o&&o.data&&ut.texImage3D(ut.TEXTURE_3D,0,this.format,rt,ot,at,0,tS(this.format),rS(this.format),o.data)}bind(_,o){const{context:g}=this,{gl:_e}=g;_e.bindTexture(_e.TEXTURE_3D,this.texture),_!==this.minFilter&&(_e.texParameteri(_e.TEXTURE_3D,_e.TEXTURE_MAG_FILTER,_),_e.texParameteri(_e.TEXTURE_3D,_e.TEXTURE_MIN_FILTER,_),this.minFilter=_),o!==this.wrapS&&(_e.texParameteri(_e.TEXTURE_3D,_e.TEXTURE_WRAP_S,o),_e.texParameteri(_e.TEXTURE_3D,_e.TEXTURE_WRAP_T,o),this.wrapS=o)}destroy(){const{gl:_}=this.context;_.deleteTexture(this.texture),this.texture=null}},c.d0=function(_){return _*_*_*_*_},c.d1=dt,c.d2=45,c.d3=Ex,c.d4=function(_,o,g){const _e=Math.sqrt(_*_+o*o+g*g),rt=_e>0?Math.acos(g/_e)*au:0;let ot=_!==0||o!==0?Math.atan2(-o,-_)*au+90:0;return ot<0&&(ot+=360),[_e,ot,rt]},c.d5=xr,c.d6=As,c.d7=ir,c.d8=rr,c.d9=Jn,c.dA=function(_){return _({pluginStatus:Ru,pluginURL:tm}),Qy.on("pluginStateChange",_),_},c.dB=z_,c.dC=class extends sm{constructor(_){super(_),this.current=Tx}set(_,o,g){if(this.fetchUniformLocation(_,o)){for(let _e=0;_e<9;_e++)if(g[_e]!==this.current[_e]){this.current=g,this.gl.uniformMatrix3fv(this.location,!1,g);break}}}},c.dD=qm,c.dE=function(_,o,g){const _e=q0(g.zoom),rt=_.style.map._antialias,ot=_.terrain&&_.terrain.exaggeration()>0;return _e===0&&!rt&&!ot},c.dF=function(_){const o=_.pixelsPerMeter,g=o/Pt(1,_.center.lat),_e=Gt(new Float64Array(16));return Lt(_e,_e,[_.point.x,_.point.y,0]),Vt(_e,_e,[g,g,o]),Float32Array.from(_e)},c.dG=iE,c.dH=function(_){const o=qt-5;_=tr(_,-o,o)/o*90;const g=Math.pow(Math.abs(Math.sin(Fs(_))),3);return Math.round(g*(l1.length-1))},c.dI=function(_,o,g,_e){const rt=o.getNorth(),ot=o.getSouth(),at=o.getWest(),ut=o.getEast(),ft=1<<_.z,gt=ut-at,Ct=rt-ot,At=gt/$0,kt=-Ct/l1[g],zt=[0,At,0,kt,0,0,rt,at,0];if(_.z>0){const Ut=180/_e;Rt(zt,zt,[Ut/gt+1,0,0,0,Ut/Ct+1,0,-.5*Ut/At,.5*Ut/kt,1])}return zt[2]=ft,zt[5]=_.x,zt[8]=_.y,zt},c.dJ=Cp,c.dK=function(_,o,g){const _e=Gt(new Float64Array(16)),rt=(o/(1<<_)-.5)*Math.PI*2;return nr(_e,g.globeMatrix,rt),Float32Array.from(_e)},c.dL=fC,c.dM=Gp,c.dN=function(_,o){return[Math.pow(_[0],2.2)*o,Math.pow(_[1],2.2)*o,Math.pow(_[2],2.2)*o]},c.dO=St,c.dP=function(_,o){var g=Math.sin(o),_e=Math.cos(o);return _[0]=_e,_[1]=g,_[2]=0,_[3]=-g,_[4]=_e,_[5]=0,_[6]=0,_[7]=0,_[8]=1,_},c.dQ=ps,c.dR=eC,c.dS=Js,c.dT=Xo,c.dU=256,c.dV=function(_,o){const g=[0,0,0];return ws(g,g,sE(Cp(o.canonical))),ws(g,g,_),g},c.dW=_=>({u_matrix:new V_(_),u_texsize:new $p(_),u_pixels_to_tile_units:new Sx(_),u_device_pixel_ratio:new Bl(_),u_width_scale:new Bl(_),u_floor_width_scale:new Bl(_),u_image:new wx(_),u_units_to_pixels:new $p(_),u_tile_units_to_pixels:new Bl(_),u_alpha_discard_threshold:new Bl(_),u_trim_offset:new $p(_),u_trim_fade_range:new $p(_),u_trim_color:new Ex(_),u_zbias_factor:new Bl(_),u_tile_to_meter:new Bl(_),u_ground_shadow_factor:new B_(_),u_pattern_transition:new Bl(_)}),c.dX=_=>({u_matrix:new V_(_),u_pixels_to_tile_units:new Sx(_),u_device_pixel_ratio:new Bl(_),u_width_scale:new Bl(_),u_floor_width_scale:new Bl(_),u_units_to_pixels:new $p(_),u_dash_image:new wx(_),u_gradient_image:new wx(_),u_image_height:new Bl(_),u_texsize:new $p(_),u_tile_units_to_pixels:new Bl(_),u_alpha_discard_threshold:new Bl(_),u_trim_offset:new $p(_),u_trim_fade_range:new $p(_),u_trim_color:new Ex(_),u_zbias_factor:new Bl(_),u_tile_to_meter:new Bl(_),u_ground_shadow_factor:new B_(_)}),c.dY=_=>({u_camera_to_center_distance:new Bl(_),u_extrude_scale:new Sx(_),u_device_pixel_ratio:new Bl(_),u_matrix:new V_(_),u_inv_rot_matrix:new V_(_),u_merc_center:new $p(_),u_tile_id:new B_(_),u_zoom_transition:new Bl(_),u_up_dir:new B_(_),u_emissive_strength:new Bl(_)}),c.dZ=dx,c.d_=$P,c.da=cr,c.db=function(_){return[Math.pow(_[0],1/2.2),Math.pow(_[1],1/2.2),Math.pow(_[2],1/2.2)]},c.dc=xA,c.dd=cS,c.de=TA,c.df=NS,c.dg=function(_,o){return _.readFields(VM,{icons:[]},o)},c.dh=mE,c.di=Fx,c.dj=ES,c.dk=dy,c.dl=D_,c.dm=v0,c.dn=fy,c.dp=hn,c.dq=function(_){const o=_.indexOf(u0);return o>=0?_.slice(0,o):_},c.dr=function(_){return _.indexOf(u0)>=0},c.ds=function(_){const o=_.lastIndexOf(u0);return o>=0?_.slice(o+1):""},c.dt=function(_){const o=[],g=_.id;return g===void 0&&o.push({message:`layers.${g}: missing required property "id"`}),_.render===void 0&&o.push({message:`layers.${g}: missing required method "render"`}),_.renderingMode&&_.renderingMode!=="2d"&&_.renderingMode!=="3d"&&o.push({message:`layers.${g}: property "renderingMode" must be either "2d" or "3d"`}),o},c.du=function(_,o,g,_e){return _.type==="custom"?new NM(_,o):new BM[_.type](_,o,g,_e)},c.dv=Sn,c.dw=function(_){const o=_.indexOf(u0);return o>=0?_.slice(o+1):""},c.dx=class extends J_{constructor(_,o){super(_._vectorTileFeature,_._z,_._x,_._y,_.id),_.state&&(this.state=Object.assign({},_.state)),this.target=o.target,this.namespace=o.namespace,o.properties&&(this.properties=o.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=_.source,this.sourceLayer=_.sourceLayer,this.layer=_.layer)}toJSON(){const _=super.toJSON();return _.target=this.target,_.namespace=this.namespace,_}},c.dy=Qy,c.dz=Qm,c.e=Us,c.e$=gr,c.e0=nC,c.e1=(_,o,g,_e,rt,ot)=>{const at=_.transform,ut=at.projection.name==="globe";let ft;if(ot.paint.get("circle-pitch-alignment")==="map")if(ut){const Ct=eC(at.zoom,o.canonical)*at._pixelsPerMercatorPixel;ft=Float32Array.from([Ct,0,0,Ct])}else ft=at.calculatePixelsToTileUnitsMatrix(g);else ft=new Float32Array([at.pixelsToGLUnits[0],0,0,at.pixelsToGLUnits[1]]);const gt={u_camera_to_center_distance:_.transform.getCameraToCenterDistance(at.projection),u_matrix:_.translatePosMatrix(o.projMatrix,g,ot.paint.get("circle-translate"),ot.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Xl.devicePixelRatio,u_extrude_scale:ft,u_inv_rot_matrix:sI,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:ot.paint.get("circle-emissive-strength")};if(ut){gt.u_inv_rot_matrix=_e,gt.u_merc_center=rt,gt.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],gt.u_zoom_transition=q0(at.zoom);const Ct=rt[0]*Mn,At=rt[1]*Mn;gt.u_up_dir=at.projection.upVector(new Co(0,0,0),Ct,At)}return gt},c.e2=zA,c.e3=Cu,c.e4=(_,o,g,_e,rt,ot,at,ut,ft,gt)=>{const Ct=_.transform,At=Ct.pitch<15?jA(.07,.7,tr((14-Ct.zoom)/5,0,1)):.07,kt=g.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:BA(_,o,g,_e),u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:Ct.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:rt,u_width_scale:ot,u_floor_width_scale:at,u_image:0,u_tile_units_to_pixels:FA(o,Ct),u_units_to_pixels:[1/Ct.pixelsToGLUnits[0],1/Ct.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:ut,u_trim_fade_range:g.paint.get("line-trim-fade-range"),u_trim_color:g.paint.get("line-trim-color").toPremultipliedRenderColor(kt?null:g.lut).toArray01(),u_zbias_factor:At,u_tile_to_meter:ir(o.tileID.canonical,0),u_ground_shadow_factor:ft,u_pattern_transition:gt}},c.e5=(_,o,g,_e,rt,ot,at,ut,ft,gt)=>{const Ct=_.transform,At=Ct.calculatePixelsToTileUnitsMatrix(o),kt=g.paint.get("line-trim-color-use-theme").constantOr("default")==="none",zt=Ct.pitch<15?jA(.07,.7,tr((14-Ct.zoom)/5,0,1)):.07;return{u_matrix:BA(_,o,g,_e),u_pixels_to_tile_units:At,u_device_pixel_ratio:ot,u_width_scale:at,u_floor_width_scale:ut,u_units_to_pixels:[1/Ct.pixelsToGLUnits[0],1/Ct.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:rt,u_texsize:VA(g)&&o.lineAtlasTexture?o.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:FA(o,_.transform),u_alpha_discard_threshold:0,u_trim_offset:ft,u_trim_fade_range:g.paint.get("line-trim-fade-range"),u_trim_color:g.paint.get("line-trim-color").toPremultipliedRenderColor(kt?null:g.lut).toArray01(),u_zbias_factor:zt,u_tile_to_meter:ir(o.tileID.canonical,0),u_ground_shadow_factor:gt}},c.e6=Zr,c.e7=u1,c.e8=$t,c.e9=fp,c.eA=function(_,o){var g=2*Math.acos(o[3]),_e=Math.sin(g/2);return _e>ct?(_[0]=o[0]/_e,_[1]=o[1]/_e,_[2]=o[2]/_e):(_[0]=1,_[1]=0,_[2]=0),g},c.eB=jS,c.eC=wE,c.eD=bE,c.eE=[1,1,1],c.eF=Ux,c.eG=Sl,c.eH=function(_,o,g,_e){var rt=o[0],ot=o[1],at=o[2],ut=o[3];return _[0]=rt+_e*(g[0]-rt),_[1]=ot+_e*(g[1]-ot),_[2]=at+_e*(g[2]-at),_[3]=ut+_e*(g[3]-ut),_},c.eI=Dx,c.eJ=Xu,c.eK=Up,c.eL=function(_,o,g,_e,rt,ot,at,ut,ft,gt,Ct,At,kt,zt,Ut,Kt){var er=new pt(16);return er[0]=_,er[1]=o,er[2]=g,er[3]=_e,er[4]=rt,er[5]=ot,er[6]=at,er[7]=ut,er[8]=ft,er[9]=gt,er[10]=Ct,er[11]=At,er[12]=kt,er[13]=zt,er[14]=Ut,er[15]=Kt,er},c.eM=it,c.eN=V0,c.eO=Qv,c.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new mn(1/0,1/0),max:new mn(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(_,o=!1){const g=NC(new mn(0,0),new mn(Mn,Mn),_),_e=[];if(o&&!$T(g,this._globalClipBounds))return _e;for(const rt of this._activeRegions){if(rt.hiddenByOverlap||!$T(g,rt))continue;const ot=NI(rt.min,rt.max,_);_e.push({min:ot.min,max:ot.max,sourceId:this._sourceIds[rt.priority],footprint:rt.footprint,footprintTileId:rt.tileId,order:rt.order,clipMask:rt.clipMask,clipScope:rt.clipScope})}return _e}setSources(_){this._setSources(_.map(o=>({getSourceId:()=>o.cache.id,getFootprints:()=>{const g=[];for(const _e of o.cache.getVisibleCoordinates()){const rt=o.cache.getTile(_e).buckets[o.layer];rt&&rt.updateFootprints(_e.toUnwrapped(),g)}return g},getOrder:()=>o.order,getClipMask:()=>o.clipMask,getClipScope:()=>o.clipScope})))}_addSource(_){const o=_.getFootprints();if(o.length===0)return;const g=_.getOrder(),_e=_.getClipMask(),rt=_.getClipScope();for(const ot of o){if(!ot.footprint)continue;const at=NC(ot.footprint.min,ot.footprint.max,ot.id);this._activeRegions.push({min:at.min,max:at.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:ot.id,footprint:ot.footprint,order:g,clipMask:_e,clipScope:rt})}this._sourceIds.push(_.getSourceId())}_computeReplacement(){this._activeRegions.sort((o,g)=>o.priority-g.priority||uE(o.min,g.min)||uE(o.max,g.max)||o.order-g.order||o.clipMask-g.clipMask||function(_e,rt){const ot=(at,ut)=>at+ut;return _e.length-rt.length||_e.reduce(ot,"").localeCompare(rt.reduce(ot,""))}(o.clipScope,g.clipScope));let _=this._activeRegions.length!==this._prevRegions.length;if(!_){let o=0;for(;!_&&o!==this._activeRegions.length;){const g=this._activeRegions[o],_e=this._prevRegions[o];_=g.priority!==_e.priority||!DC(g,_e)||g.order!==_e.order||g.clipMask!==_e.clipMask||!du(g.clipScope,_e.clipScope),this._activeRegions[o].hiddenByOverlap=_e.hiddenByOverlap,++o}}if(_){++this._updateTime;for(const g of this._activeRegions)g.order!==g1&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,g.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,g.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,g.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,g.max.y));const o=g=>{const _e=this._activeRegions;if(g>=_e.length)return g;const rt=_e[g].priority;for(;g<_e.length&&_e[g].priority===rt;)++g;return g};if(this._sourceIds.length>1){let g=0,_e=o(g);for(;g!==_e;){let rt=g;const ot=g;for(;rt!==_e;){const at=this._activeRegions[rt];at.hiddenByOverlap=!1;for(let ut=0;ut<ot;ut++){const ft=this._activeRegions[ut];if(!ft.hiddenByOverlap&&at.order===g1&&$T(at,ft)&&(at.hiddenByOverlap=LC(at.footprint,at.tileId,ft.footprint,ft.tileId),at.hiddenByOverlap))break}++rt}g=_e,_e=o(g)}}}}_setSources(_){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let o=_.length-1;o>=0;o--)this._addSource(_[o]);this._computeReplacement()}},c.eQ=g1,c.eR=class{constructor(_){this._createGrid(_),this._createPoles(_)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const _ of this._poleSegments)_.destroy();for(const _ of this._gridSegments)_.withSkirts.destroy(),_.withoutSkirts.destroy()}_fillGridMeshWithLods(_,o){const g=new Lm,_e=new Fl,rt=[],ot=_+1+2,at=o[0]+1,ut=o[0]+1+(1+o.length),ft=(gt,Ct,At)=>{let kt=gt===ot-1?gt-2:gt===0?gt:gt-1;return kt+=At?24575:0,[kt,Ct]};for(let gt=0;gt<ot;++gt)g.emplaceBack(...ft(gt,0,!0));for(let gt=0;gt<at;++gt)for(let Ct=0;Ct<ot;++Ct)g.emplaceBack(...ft(Ct,gt,(Ct===0||Ct===ot-1)&&!0));for(let gt=0;gt<o.length;++gt){const Ct=o[gt];for(let At=0;At<ot;++At)g.emplaceBack(...ft(At,Ct,!0))}for(let gt=0;gt<o.length;++gt){const Ct=_e.length,At=o[gt]+1+2,kt=new Fl;for(let Kt=0;Kt<At-1;Kt++){const er=Kt===At-2,Jt=er?ot*(ut-o.length+gt-Kt):ot;for(let or=0;or<ot-1;or++){const lr=Kt*ot+or;Kt===0||er||or===0||or===ot-2?(kt.emplaceBack(lr+1,lr,lr+Jt),kt.emplaceBack(lr+Jt,lr+Jt+1,lr+1)):(_e.emplaceBack(lr+1,lr,lr+Jt),_e.emplaceBack(lr+Jt,lr+Jt+1,lr+1))}}const zt=Go.simpleSegment(0,Ct,g.length,_e.length-Ct);for(let Kt=0;Kt<kt.uint16.length;Kt+=3)_e.emplaceBack(kt.uint16[Kt],kt.uint16[Kt+1],kt.uint16[Kt+2]);const Ut=Go.simpleSegment(0,Ct,g.length,_e.length-Ct);rt.push({withoutSkirts:zt,withSkirts:Ut})}return{vertices:g,indices:_e,segments:rt}}_createGrid(_){const o=this._fillGridMeshWithLods($0,l1);this._gridSegments=o.segments,this._gridBuffer=_.createVertexBuffer(o.vertices,H0.members),this._gridIndexBuffer=_.createIndexBuffer(o.indices,!0)}_createPoles(_){const o=new Fl;for(let at=0;at<=$0;at++)o.emplaceBack(0,at+1,at+2);this._poleIndexBuffer=_.createIndexBuffer(o,!0);const g=new d0,_e=new d0,rt=new d0,ot=new d0;this._poleSegments=[];for(let at=0,ut=0;at<up;at++){const ft=360/(1<<at);g.emplaceBack(0,-mu,0,.5,0),_e.emplaceBack(0,-mu,0,.5,1),rt.emplaceBack(0,-mu,0,.5,.5),ot.emplaceBack(0,-mu,0,.5,.5);for(let gt=0;gt<=$0;gt++){let Ct=gt/$0,At=0;const kt=fs(0,ft,Ct),[zt,Ut,Kt]=p0(iI,nI,kt,mu);g.emplaceBack(zt,Ut,Kt,Ct,At),_e.emplaceBack(zt,Ut,Kt,Ct,1-At);const er=Fs(kt);Ct=.5+.5*Math.sin(er),At=.5+.5*Math.cos(er),rt.emplaceBack(zt,Ut,Kt,Ct,At),ot.emplaceBack(zt,Ut,Kt,Ct,1-At)}this._poleSegments.push(Go.simpleSegment(ut,0,66,64)),ut+=66}this._poleNorthVertexBuffer=_.createVertexBuffer(g,Sp,!1),this._poleSouthVertexBuffer=_.createVertexBuffer(_e,Sp,!1),this._texturedPoleNorthVertexBuffer=_.createVertexBuffer(rt,Sp,!1),this._texturedPoleSouthVertexBuffer=_.createVertexBuffer(ot,Sp,!1)}getGridBuffers(_,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[_].withSkirts:this._gridSegments[_].withoutSkirts]}getPoleBuffers(_,o){return[o?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,o?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[_]]}},c.eS=kC,c.eT=o_,c.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},c.eV=Wr,c.eW=sr,c.eX=function(_,o,g){return _[0]=o[0]/g[0],_[1]=o[1]/g[1],_[2]=o[2]/g[2],_},c.eY=tu,c.eZ=G0,c.e_=ns,c.ea=pE,c.eb=YC,c.ec=m0,c.ed=VC,c.ee=zC,c.ef=Xt,c.eg=function(_,o){if(_===o){var g=o[1],_e=o[2],rt=o[3],ot=o[6],at=o[7],ut=o[11];_[1]=o[4],_[2]=o[8],_[3]=o[12],_[4]=g,_[6]=o[9],_[7]=o[13],_[8]=_e,_[9]=ot,_[11]=o[14],_[12]=rt,_[13]=at,_[14]=ut}else _[0]=o[0],_[1]=o[4],_[2]=o[8],_[3]=o[12],_[4]=o[1],_[5]=o[5],_[6]=o[9],_[7]=o[13],_[8]=o[2],_[9]=o[6],_[10]=o[10],_[11]=o[14],_[12]=o[3],_[13]=o[7],_[14]=o[11],_[15]=o[15];return _},c.eh=DM,c.ei=Bs,c.ej=e1,c.ek=256,c.el=MT,c.em=Ku,c.en=nr,c.eo=function(_,o){return _[0]=o[0],_[1]=o[1],_[2]=o[2],_[3]=o[4],_[4]=o[5],_[5]=o[6],_[6]=o[8],_[7]=o[9],_[8]=o[10],_},c.ep=d0,c.eq=Tw,c.er=Yv,c.es=function(_,o,g,_e,rt){return tr((_-o)/(g-o)*(rt-_e)+_e,_e,rt)},c.et=Eu,c.eu=function(_,o){var g=o[0],_e=o[1],rt=o[2],ot=o[3],at=o[4],ut=o[5],ft=o[6],gt=o[7],Ct=o[8],At=Ct*at-ut*gt,kt=-Ct*ot+ut*ft,zt=gt*ot-at*ft,Ut=g*At+_e*kt+rt*zt;return Ut?(_[0]=At*(Ut=1/Ut),_[1]=(-Ct*_e+rt*gt)*Ut,_[2]=(ut*_e-rt*at)*Ut,_[3]=kt*Ut,_[4]=(Ct*g-rt*ft)*Ut,_[5]=(-ut*g+rt*ot)*Ut,_[6]=zt*Ut,_[7]=(-gt*g+_e*ft)*Ut,_[8]=(at*g-_e*ot)*Ut,_):null},c.ev=2,c.ew=Nn,c.ex=iu,c.ey=ln,c.ez=function(_,o){var g=new pt(3);ln(g,o);var _e=1/g[0],rt=1/g[1],ot=1/g[2],at=o[0]*_e,ut=o[1]*rt,ft=o[2]*ot,gt=o[4]*_e,Ct=o[5]*rt,At=o[6]*ot,kt=o[8]*_e,zt=o[9]*rt,Ut=o[10]*ot,Kt=at+Ct+Ut,er=0;return Kt>0?(er=2*Math.sqrt(Kt+1),_[3]=.25*er,_[0]=(At-zt)/er,_[1]=(kt-ft)/er,_[2]=(ut-gt)/er):at>Ct&&at>Ut?(er=2*Math.sqrt(1+at-Ct-Ut),_[3]=(At-zt)/er,_[0]=.25*er,_[1]=(ut+gt)/er,_[2]=(kt+ft)/er):Ct>Ut?(er=2*Math.sqrt(1+Ct-at-Ut),_[3]=(kt-ft)/er,_[0]=(ut+gt)/er,_[1]=.25*er,_[2]=(At+zt)/er):(er=2*Math.sqrt(1+Ut-at-Ct),_[3]=(ut-gt)/er,_[0]=(kt+ft)/er,_[1]=(At+zt)/er,_[2]=.25*er),_},c.f=function(_){return btoa(encodeURIComponent(_).replace(/%([0-9A-F]{2})/g,(o,g)=>String.fromCharCode(+("0x"+g))))},c.f0=function([_,o,g]){const _e=Math.hypot(_,o,g),rt=Math.atan2(_,g),ot=.5*Math.PI-Math.acos(-o/_e);return new $(vu(rt),vu(ot))},c.f1=Ll,c.f2=nS,c.f3=function(_){const o=_.navigator?_.navigator.userAgent:null;return!!function(g){if(Pl==null){const _e=g.navigator?g.navigator.userAgent:null;Pl=!!g.safari||!(!_e||!(/\b(iPad|iPhone|iPod)\b/.test(_e)||_e.match("Safari")&&!_e.match("Chrome")))}return Pl}(_)&&!(!o||!(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},c.f4=function(_,o){ly=_,cy=o},c.f5=NT,c.f6=rC,c.f7=function(_){const o=[0,0,0],g=Gt(new Float64Array(16));return Bt(g,_.pixelMatrix,_.globeMatrix),ws(o,o,g),new mn(o[0],o[1])},c.f8=function(){const _=w1;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(XT),w1=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.f9=function(){mE().acquire(XT)},c.fA=KE,c.fB=Or,c.fC=function(_){let o=0;if(new Uint32Array(_,0,1)[0]!==fA){const g=new Uint32Array(_,0,7),[,,_e,rt,ot,at]=g;o=g.byteLength+rt+ot+at+ot,(_e!==_.byteLength||o>=_.byteLength)&&$n("Invalid b3dm header information.")}return yA(_,o)},c.fD=function(_,o){const g=cS(_);for(const _e of g){for(const rt of _e.meshes)hP(rt);_e.lights&&(_e.lightMeshIndex=_e.meshes.length,_e.meshes.push(dP(_e.lights,o)))}return g},c.fE=UE,c.fF=Xs,c.fG=cA,c.fH=rm,c.fI=Vu,c.fJ=function(_){yp(),Mp!=null&&Mp.then(o=>{o.keys().then(g=>{for(let _e=0;_e<g.length-_;_e++)o.delete(g[_e]).catch(rt=>$n(rt.message))}).catch(g=>$n(g.message))}).catch(o=>$n(o.message))},c.fa=N_,c.fb=function(_,o,g=!1){if(Ru===Vu.deferred||Ru===Vu.loading||Ru===Vu.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");tm=Xl.resolveURL(_),Ru=Vu.deferred,Vv=o,Yy(),g||Ow()},c.fc=function(_){Px=Xl.resolveURL(_),kx||(kx=new Ix(mE(),new Jm)),kx.broadcast("setMeshoptUrl",Px)},c.fd=dA,c.fe=function(_){QT=Xl.resolveURL(_),kx||(kx=new Ix(mE(),new Jm)),kx.broadcast("setDracoUrl",QT)},c.ff=hA,c.fg=b1,c.fh=function(_){const o=_p();if(!o)return;const g=o.delete(ay);_&&g.then(()=>_()).catch(_)},c.fi=K_,c.fj=qn,c.fk=K0,c.fl=fm,c.fm=kR,c.fn=MR,c.fo=DA,c.fp=tn,c.fq="hd_road_elevation",c.fr=co,c.fs=Xr,c.ft=f0,c.fu=wS,c.fv=Y_,c.fw=function(_,o,g,_e,rt,ot,at,ut=1,ft,gt,Ct){_.createArrays(),_.tilePixelRatio=Mn/(512*_.overscaling),_.compareText={},_.iconsNeedLinear=!1;const At=_.layers[0].layout,kt=_.layers[0]._unevaluatedLayout._values,zt={};zt.scaleFactor=ut,zt.textSizeScaleRange=At.get("text-size-scale-range"),zt.iconSizeScaleRange=At.get("icon-size-scale-range");const[Ut,Kt]=zt.textSizeScaleRange,[er,Jt]=zt.iconSizeScaleRange;zt.textScaleFactor=tr(zt.scaleFactor,Ut,Kt),zt.iconScaleFactor=tr(zt.scaleFactor,er,Jt);const or=kt["text-size"],lr=kt["icon-size"];if(_.textSizeData.kind==="composite"){const{minZoom:Lr,maxZoom:Jr}=_.textSizeData;zt.compositeTextSizes=[or.possiblyEvaluate(new Do(Lr,{worldview:Ct}),ot),or.possiblyEvaluate(new Do(Jr,{worldview:Ct}),ot)]}if(_.iconSizeData.kind==="composite"){const{minZoom:Lr,maxZoom:Jr}=_.iconSizeData;zt.compositeIconSizes=[lr.possiblyEvaluate(new Do(Lr,{worldview:Ct}),ot),lr.possiblyEvaluate(new Do(Jr,{worldview:Ct}),ot)]}zt.layoutTextSize=or.possiblyEvaluate(new Do(at+1,{worldview:Ct}),ot),zt.layoutIconSize=lr.possiblyEvaluate(new Do(at+1,{worldview:Ct}),ot),zt.textMaxSize=or.possiblyEvaluate(new Do(18,{worldview:Ct}),ot);const pr=At.get("symbol-placement"),Sr=At.get("text-rotation-alignment")==="map"&&pr!=="point",br=At.get("text-size");let Rr=!1;const Mr=[];for(const Lr of _.features){const Jr=At.get("text-font").evaluate(Lr,{},ot).join(","),zr=br.evaluate(Lr,{},ot)*zt.textScaleFactor,sn=zt.layoutTextSize.evaluate(Lr,{},ot)*zt.textScaleFactor,dn=zt.layoutIconSize.evaluate(Lr,{},ot)*zt.iconScaleFactor,pn={horizontal:{},vertical:void 0},wn=Lr.text;let Tn,xn=[0,0];if(wn){const Rs=wn.toString(),vo=At.get("text-letter-spacing").evaluate(Lr,{},ot)*Yl,wr=At.get("text-line-height").evaluate(Lr,{},ot)*Yl,Cr=Bv(Rs)?vo:0,on=At.get("text-anchor").evaluate(Lr,{},ot),En=At.get("text-variable-anchor");if(!En){const Ts=At.get("text-radial-offset").evaluate(Lr,{},ot);if(Ts)xn=m2(on,[Ts*Yl,SS]);else{const Ns=At.get("text-offset").evaluate(Lr,{},ot);xn=[Ns[0]*Yl,Ns[1]*Yl]}}let Fn=Sr?"center":At.get("text-justify").evaluate(Lr,{},ot);const Bn=pr==="point",rs=Bn?At.get("text-max-width").evaluate(Lr,{},ot)*Yl:1/0,ss=Ts=>{_.allowVerticalPlacement&&M_(Rs)&&(pn.vertical=_S(wn,o,g,rt,Jr,rs,wr,on,Ts,Cr,xn,Qu.vertical,!0,sn,zr,ft))};if(!Sr&&En){const Ts=Fn==="auto"?En.map(Os=>CS(Os)):[Fn];let Ns=!1;for(let Os=0;Os<Ts.length;Os++){const zs=Ts[Os];if(!pn.horizontal[zs])if(Ns)pn.horizontal[zs]=pn.horizontal[0];else{const ds=_S(wn,o,g,rt,Jr,rs,wr,"center",zs,Cr,xn,Qu.horizontal,!1,sn,zr,ft);ds&&(pn.horizontal[zs]=ds,Ns=ds.positionedLines.length===1)}}ss("left")}else{if(Fn==="auto"&&(Fn=CS(on)),Bn||At.get("text-writing-mode").indexOf("horizontal")>=0||!M_(Rs)){const Ts=_S(wn,o,g,rt,Jr,rs,wr,on,Fn,Cr,xn,Qu.horizontal,!1,sn,zr,ft);Ts&&(pn.horizontal[Fn]=Ts)}ss(Bn?"left":Fn)}}let vn,nn,en,bn,Dn,Rn,ts=!1;const Vn=At.get("icon-text-fit").evaluate(Lr,{},ot);if(Lr.icon&&Lr.icon.hasPrimary()){const Rs=M1(Lr.icon,_.iconSizeData,kt["icon-size"],ot,_.zoom,Lr,ft,zt.iconScaleFactor,Ct);vn=Rs.iconPrimary,en=Rs.iconSecondary;const vo=vn.toString();if(nn=_e.get(vo),nn&&(Dn=At.get("icon-offset").evaluate(Lr,{},ot),Rn=At.get("icon-anchor").evaluate(Lr,{},ot),Tn=AE(rt.get(vo),en?rt.get(en.toString()):void 0,Dn,Rn),ts=nn.sdf,_.sdfIcons===void 0?_.sdfIcons=nn.sdf:_.sdfIcons!==nn.sdf&&$n("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(nn.pixelRatio!==_.pixelRatio||At.get("icon-rotate").constantOr(1)!==0)&&(_.iconsNeedLinear=!0)),en){const wr=en.toString();bn=_e.get(wr)}}Rr=Rr||!(!Lr.icon||!Lr.icon.hasSecondary());const Hn=ME(pn.horizontal)||pn.vertical;_.iconsInText||(_.iconsInText=!!Hn&&Hn.iconsInText);const Zn=sn*zt.textScaleFactor/Yl,{defaultShapedIcon:js,verticallyShapedIcon:In}=xM(_,Tn,At,Lr,ot,pn,Zn,Dn,Vn);Vn!=="none"&&Tn&&(e2(Tn)||t2(Tn))&&(kE(0,nn,vn,Tn,js,Vn,gt,_e,rt),kE(0,bn,en,Tn,js,Vn,gt,_e,rt),In&&(kE(0,nn,vn,Tn,In,Vn,gt,_e,rt),kE(0,bn,en,Tn,In,Vn,gt,_e,rt))),Tn=js;const{iconBBox:Yn,iconVerticalBBox:xs,textBBox:Gs,textVerticalBBox:Ws}=fM(_,Tn,In,At,Lr,ot,dn,Dn,zt,rt,Rn,pn,sn,xn);Mr.push({feature:Lr,shapedTextOrientations:pn,shapedText:Hn,shapedIcon:Tn,iconPrimary:vn,iconSecondary:en,iconOffset:Dn,iconAnchor:Rn,verticallyShapedIcon:In,layoutTextSize:sn,layoutIconSize:dn,textOffset:xn,isSDFIcon:ts,iconTextFit:Vn,iconCollisionBounds:Yn,iconVerticalCollisionBounds:xs,textCollisionBounds:Gs,textVerticalCollisionBounds:Ws})}return{featureData:Mr,sizes:zt,hasAnySecondaryIcon:Rr,textAlongLine:Sr,symbolPlacement:pr}},c.fx=c2,c.fy=function(_,o,g,_e,rt,ot,at,ut,ft,gt){_.iconAtlasPositions=gt.iconPositions;const{featureData:Ct,hasAnySecondaryIcon:At,sizes:kt,textAlongLine:zt,symbolPlacement:Ut}=o;for(const Kt of Ct){const{shapedIcon:er,verticallyShapedIcon:Jt,feature:or,shapedTextOrientations:lr,shapedText:pr,layoutTextSize:Sr,textOffset:br,isSDFIcon:Rr,iconPrimary:Mr,iconSecondary:Lr,iconTextFit:Jr,iconOffset:zr,iconCollisionBounds:sn,iconVerticalCollisionBounds:dn,textCollisionBounds:pn}=Kt;_2(er,gt.iconPositions,Mr,Lr),_2(Jt,gt.iconPositions,Mr,Lr),yM(lr,gt.iconPositions),_M(Mr,Lr,gt.iconPositions),(pr||er)&&vM(_,or,lr,er,Jt,ft,kt,Sr,0,br,Rr,_e,rt,at,ut,At,Jr,zr,zt,Ut,sn,dn,pn)}g&&_.generateCollisionDebugBuffers(ot,_.collisionBoxArray,kt.textScaleFactor)},c.fz=qr,c.g=function(_,o){return Qm(Object.assign(_,{method:"GET"}),o)},c.h=function(_){return _.indexOf("mapbox:")===0},c.i=function(_){return Us.API_STYLE_REGEX.test(_)&&!lu(_)},c.j=$a,c.k=Dp,c.l=function(_){return decodeURIComponent(atob(_).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join(""))},c.m=function(_,o){return Qm(Object.assign(_,{type:"json"}),o)},c.n=py,c.o=Xl,c.p=function(_,o){return Qm(Object.assign(_,{method:"POST"}),o)},c.q=yu,c.r=kp,c.s=function(_){try{const o=self[_];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch{return!1}},c.t=function(){return ZT||(ZT=new K_("ImageRasterizer")),ZT},c.u=function(){return function _(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,_)}()},c.v=function(_){return!!_&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(_)},c.w=$n,c.x=$S,c.y=d_,c.z=Np}),et(["./shared"],function(c){function ct(Wr){const tr=Wr?Wr.url.toString():void 0;return tr?performance.getEntriesByName(tr):[]}function pt(Wr){if(typeof Wr=="number"||typeof Wr=="boolean"||typeof Wr=="string"||Wr==null)return JSON.stringify(Wr);if(Array.isArray(Wr)){let ar="[";for(const yr of Wr)ar+=`${pt(yr)},`;return`${ar}]`}let tr="{";for(const ar of Object.keys(Wr).sort())tr+=`${ar}:${pt(Wr[ar])},`;return`${tr}}`}function xt(Wr){let tr="";for(const ar of c.bx)tr+=`/${pt(Wr[ar])}`;return tr}class St{constructor(tr){this.keyCache={},this._layers={},this._layerConfigs={},tr&&this.replace(tr)}replace(tr,ar){this._layerConfigs={},this._layers={},this.update(tr,[],ar)}update(tr,ar,yr){this._options=yr;for(const kr of tr)this._layerConfigs[kr.id]=kr,(this._layers[kr.id]=c.du(kr,this.scope,null,this._options)).compileFilter(yr),this.keyCache[kr.id]&&delete this.keyCache[kr.id];for(const kr of ar)delete this.keyCache[kr],delete this._layerConfigs[kr],delete this._layers[kr];this.familiesBySource={};const Dr=function(kr,jr){const Zr={};for(let Xr=0;Xr<kr.length;Xr++){const Sn=kr[Xr];let hn=jr&&jr[Sn.id];hn||(Sn.type==="symbol"?hn=Sn.id:(hn=xt(Sn),Sn.type==="line"&&Sn.paint&&function os($n){return typeof $n=="string"&&$n==="line-progress"||(Array.isArray($n)?$n.some(os):!(!$n||typeof $n!="object")&&Object.values($n).some(os))}(Sn.paint["line-width"])&&(hn+=`/${pt(Sn.paint["line-width"])}`))),jr&&(jr[Sn.id]=hn);let Wn=Zr[hn];Wn||(Wn=Zr[hn]=[]),Wn.push(Sn)}const Vr=[];for(const Xr in Zr)Vr.push(Zr[Xr]);return Vr}(Object.values(this._layerConfigs),this.keyCache);for(const kr of Dr){const jr=kr.map(Wn=>this._layers[Wn.id]),Zr=jr[0];if(Zr.visibility==="none")continue;const Vr=Zr.source||"";let Xr=this.familiesBySource[Vr];Xr||(Xr=this.familiesBySource[Vr]={});const Sn=Zr.sourceLayer||"_geojsonTileLayer";let hn=Xr[Sn];hn||(hn=Xr[Sn]=[]),hn.push(jr)}}}const Et=1*c.fl;class Rt{constructor(tr){const ar={},yr=[];for(const Zr in tr){const Vr=tr[Zr],Xr=ar[Zr]={};for(const Sn in Vr.glyphs){const hn=Vr.glyphs[+Sn];if(!hn||hn.bitmap.width===0||hn.bitmap.height===0)continue;const Wn=hn.metrics.localGlyph?Et:1,os={x:0,y:0,w:hn.bitmap.width+2*Wn,h:hn.bitmap.height+2*Wn};yr.push(os),Xr[Sn]=os}}const{w:Dr,h:kr}=c.G(yr),jr=new c.fk({width:Dr||1,height:kr||1});for(const Zr in tr){const Vr=tr[Zr];for(const Xr in Vr.glyphs){const Sn=Vr.glyphs[+Xr];if(!Sn||Sn.bitmap.width===0||Sn.bitmap.height===0)continue;const hn=ar[Zr][Xr],Wn=Sn.metrics.localGlyph?Et:1;c.fk.copy(Sn.bitmap,jr,{x:0,y:0},{x:hn.x+Wn,y:hn.y+Wn},Sn.bitmap)}}this.image=jr,this.positions=ar}}function Nt(Wr,tr,ar){Wr[tr]?ar&&(Wr[tr].center=ar):Wr[tr]={floorIds:new Set,center:ar||[0,0],floors:{}}}function It(Wr,tr,ar,yr){for(const Dr of tr)Nt(Wr,Dr),Wr[Dr].floors[ar]=yr,Wr[Dr].floorIds.add(ar)}function Gt(Wr){return{id:Wr.properties.id.toString(),center:Wr.properties.center.toString().split(";").map(Number)}}function Dt(Wr){return{id:Wr.properties.id.toString(),isDefault:!!Wr.properties.is_default&&Wr.properties.is_default,connections:Wr.properties.connected_floor_ids?new Set(Wr.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Wr.properties.conflicted_floor_ids?new Set(Wr.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Wr.properties.building_ids?new Set(Wr.properties.building_ids.toString().split(";")):new Set,name:Wr.properties.name.toString(),zIndex:Wr.properties.z_index}}function Bt(Wr,tr){return tr.every(ar=>Wr.properties&&Wr.properties[ar]!=null)}function Lt(Wr){return Bt(Wr,["type","id","name"])&&Wr.properties.type==="building"}function Vt(Wr){return Bt(Wr,["type","id","name","z_index"])&&Wr.properties.type==="floor"}c.fj(Rt,"GlyphAtlas");class Zt{constructor(tr){this.tileID=new c.aQ(tr.tileID.overscaledZ,tr.tileID.wrap,tr.tileID.canonical.z,tr.tileID.canonical.x,tr.tileID.canonical.y),this.tileZoom=tr.tileZoom,this.uid=tr.uid,this.zoom=tr.zoom,this.lut=tr.lut,this.canonical=tr.tileID.canonical,this.pixelRatio=tr.pixelRatio,this.tileSize=tr.tileSize,this.source=tr.source,this.scope=tr.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=tr.showCollisionBoxes,this.collectResourceTiming=!!tr.request&&tr.request.collectResourceTiming,this.promoteId=tr.promoteId,this.isSymbolTile=tr.isSymbolTile,this.tileTransform=c.aZ(tr.tileID.canonical,tr.projection),this.projection=tr.projection,this.worldview=tr.worldview,this.localizableLayerIds=tr.localizableLayerIds,this.brightness=tr.brightness,this.extraShadowCaster=!!tr.extraShadowCaster,this.tessellationStep=tr.tessellationStep,this.scaleFactor=tr.scaleFactor,this.worldview=tr.worldview,this.indoor=tr.indoor}parse(tr,ar,yr,Dr,kr,jr){this.status="parsing",this.data=tr,this.collisionBoxArray=new c.b3;const Zr=new c.fm(Object.keys(tr.layers).sort()),Vr=new c.fn(this.tileID,this.promoteId);Vr.bucketLayerIDs=[];const Xr={},Sn=new c.fo(256,256),hn={featureIndex:Vr,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Sn,availableImages:yr,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const ks=this.indoor.indoorState.activeFloorsVisible,Is=function(As,Xs,na){const Pl=function(Ko,Js){if(!Ko)return c.w("No source layers defined in indoor specification"),Js;if(Ko.size===0)return Js;const Xo=Ko.difference(Js);for(const Ro of Xo)c.w(`Missing source layer required in indoor specification: ${Ro}`);return Js.intersection(Js)}(Xs.sourceLayers,new Set(Object.keys(As.layers))),ba=Xs.indoorState,Ol=function(Ko,Js,Xo,Ro){const Us=new Set,$a=new Set,lu=new Set,pu=new Map,Mu={},Km=Jl=>{const Hu=pu.get(Jl)||new Set;for(const bu of Us)if((pu.get(bu)||new Set).has(Jl)||Hu.has(bu))return!0;return!1};for(const Jl of Js){const Hu=Ko.layers[Jl];if(Hu)for(let bu=0;bu<Hu.length;bu++){const kp=Hu.feature(bu);if(Lt(kp)){const{id:Xl,center:Xm}=Gt(kp);Nt(Mu,Xl,Xm),Us.add(Xl)}else if(Vt(kp)){const{id:Xl,isDefault:Xm,connections:v0,conflicts:ay,buildings:ly,name:cy,zIndex:a_}=Dt(kp);It(Mu,ly,Xl,{name:cy,zIndex:a_}),pu.set(Xl,ay),(Xl===Ro||v0.has(Ro))&&Us.add(Xl),$a.add(Xl),Xm&&lu.add(Xl)}}else c.w(`indoor source layer not found: ${Jl}`)}if(Xo)for(const Jl of Xo)$a.has(Jl)&&(Km(Jl)||Us.add(Jl));for(const Jl of lu)Us.has(Jl)||Km(Jl)||Us.add(Jl);return{buildings:Mu,activeFloors:Us}}(As,Pl,ba.lastActiveFloors,ba.selectedFloorId);return na.send("setIndoorData",Ol),Ol}(tr,this.indoor,kr);hn.activeFloors=ks?Is.activeFloors:void 0}const Wn=[],os=ar.familiesBySource[this.source];for(const ks in os){const Is=tr.layers[ks];if(!Is)continue;let As=!1,Xs=!1,na=!1;for(const Js of os[ks])Js[0].type==="symbol"?As=!0:Xs=!0,Js[0].is3D()&&Js[0].type!=="model"&&(na=!0);if(this.extraShadowCaster&&!na||this.isSymbolTile===!0&&!As||this.isSymbolTile===!1&&!Xs)continue;Is.version===1&&c.w(`Vector tile source "${this.source}" layer "${ks}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Pl=Zr.encode(ks),ba=[],Ol=this.localizableLayerIds&&this.localizableLayerIds.has(ks);let Ko=!1;for(let Js=0,Xo=0;Js<Is.length;Js++){const Ro=Is.feature(Js),Us=Vr.getId(Ro,ks),$a=Ro.properties?Ro.properties.worldview:null;if(Ol&&this.worldview&&typeof $a=="string")if($a==="all")Ro.properties.$localized=!0;else{if(!$a.split(",").includes(this.worldview))continue;Ro.properties.$localized=!0,Ro.properties.worldview=this.worldview}!Ko&&Ro.properties&&Ro.properties.hasOwnProperty(c.fp)&&(Ko=!0),ba.push({feature:Ro,id:Us,index:Xo,sourceLayerIndex:Pl}),Xo++}Ko&&!hn.elevationFeatures&&tr.layers.hasOwnProperty(c.fq)&&(hn.elevationFeatures=c.fr.parseFrom(tr.layers[c.fq],this.canonical));for(const Js of os[ks]){const Xo=Js[0];if(this.extraShadowCaster&&(!Xo.is3D()||Xo.type==="model")||this.isSymbolTile!==void 0&&Xo.type==="symbol"!==this.isSymbolTile||Xo.minzoom&&this.zoom<Math.floor(Xo.minzoom)||Xo.maxzoom&&this.zoom>=Xo.maxzoom||Xo.visibility==="none")continue;nr(Js,this.zoom,hn.brightness,yr,this.worldview);const Ro=Xr[Xo.id]=Xo.createBucket({index:Vr.bucketLayerIDs.length,layers:Js,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Pl,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Dr,worldview:this.worldview,localizable:Ol});Vr.bucketLayerIDs.push(Js.map($a=>c.B($a.id,$a.scope)));let Us=Ro.prepare?Ro.prepare():null;Us!=null?(Us=Us.then(()=>Ro.populate(ba,hn,this.tileID.canonical,this.tileTransform)),Wn.push(Us)):Ro.populate(ba,hn,this.tileID.canonical,this.tileTransform)}}const $n=()=>{let ks,Is,As,Xs,na,Pl;Sn.trim();const ba={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ol=()=>{if(ks)return this.status="done",jr(ks);if(this.extraShadowCaster)this.status="done",jr(null,{buckets:Object.values(Xr).filter(Js=>!Js.isEmpty()),featureIndex:Vr,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:hn.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Is&&As&&Xs){const Js=new Rt(Is),Xo=new Map;for(const[$a,lu]of As.entries()){const{imagePosition:pu}=c.fu($a,lu,c.fv);Xo.set($a,pu)}const Ro={};for(const $a in Xr){const lu=Xr[$a];lu instanceof c.b4&&(nr(lu.layers,this.zoom,hn.brightness,yr,this.worldview),Ro[$a]=c.fw(lu,Is,Js.positions,As,Xo,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,na,this.worldview))}const Us={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(kr,As,na,()=>{Us.iconsPending=!1,Ko(Ro,Js,Us)}),this.rasterizeIfNeeded(kr,Xs,Pl,()=>{Us.patternsPending=!1,Ko(Ro,Js,Us)})}},Ko=(Js,Xo,Ro,Us)=>{if(Ro.iconsPending||Ro.patternsPending)return;const $a=new c.fx(As,Xs,this.lut);for(const lu in Xr){const pu=Xr[lu];if(lu in Js)c.fy(pu,Js[lu],this.showCollisionBoxes,yr,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,As,$a);else if(pu.hasPattern&&(pu instanceof c.ba||pu instanceof c.bb||pu instanceof c.ea)){nr(pu.layers,this.zoom,hn.brightness,yr,this.worldview);const Mu=Object.fromEntries($a.patternPositions);pu.addFeatures(hn,this.tileID.canonical,Mu,yr,this.tileTransform,this.brightness)}}this.status="done",jr(null,{buckets:Object.values(Xr).filter(lu=>!lu.isEmpty()),featureIndex:Vr,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Xo.image,lineAtlas:Sn,imageAtlas:$a,brightness:hn.brightness})};if(!this.extraShadowCaster){const Js=c.fs(hn.glyphDependencies,Us=>Object.keys(Us).map(Number));Object.keys(Js).length?kr.send("getGlyphs",{uid:this.uid,stacks:Js},(Us,$a)=>{ks||(ks=Us,Is=$a,Ol())},void 0,!1,ba):Is={};const Xo=Array.from(hn.iconDependencies.keys()).map(Us=>c.I.parse(Us));Xo.length?kr.send("getImages",{images:Xo,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Us,$a)=>{ks||(ks=Us,As=new Map,na=this.updateImageMapAndGetImageTaskQueue(As,$a,hn.iconDependencies),Ol())},void 0,!1,ba):(As=new Map,na=new Map);const Ro=Array.from(hn.patternDependencies.keys()).map(Us=>c.I.parse(Us));Ro.length?kr.send("getImages",{images:Ro,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Us,$a)=>{ks||(ks=Us,Xs=new Map,Pl=this.updateImageMapAndGetImageTaskQueue(Xs,$a,hn.patternDependencies),Ol())},void 0,!1,ba):(Xs=new Map,Pl=new Map)}if(hn.elevationFeatures&&hn.elevationFeatures.length>0){const Js=[];for(const Ro of Object.values(Xr))if(Ro instanceof c.bb){const Us=Ro.getUnevaluatedPortalGraph();Us&&Js.push(Us)}const Xo=c.ft.evaluate(Js);for(const Ro of Object.values(Xr))if(Ro instanceof c.bb){const Us=tr.layers[Zr.decode(Ro.sourceLayerIndex)];Ro.setEvaluatedPortalGraph(Xo,Us,this.tileID.canonical,hn.availableImages,hn.brightness)}}Ol()};Wn.length>0?Promise.allSettled(Wn).then($n).catch(jr):$n()}updateParameters(tr){this.scaleFactor=tr.scaleFactor,this.showCollisionBoxes=tr.showCollisionBoxes,this.projection=tr.projection,this.brightness=tr.brightness,this.tileTransform=c.aZ(tr.tileID.canonical,tr.projection),this.extraShadowCaster=tr.extraShadowCaster,this.lut=tr.lut,this.worldview=tr.worldview,this.indoor=tr.indoor}rasterizeIfNeeded(tr,ar,yr,Dr){Array.from(ar.values()).some(kr=>kr.usvg)?this.rasterize(tr,ar,yr,Dr):Dr()}updateImageMapAndGetImageTaskQueue(tr,ar,yr){const Dr=new Map;for(const kr of ar.keys()){const jr=yr.get(kr)||[];for(const Zr of jr){const Vr=Zr.toString(),Xr=ar.get(Zr.id.toString());Xr.usvg?Dr.has(Vr)||(Dr.set(Vr,Zr),tr.set(Vr,Object.assign({},Xr))):tr.set(Vr,Xr)}}return Dr}rasterize(tr,ar,yr,Dr){this.rasterizeTask=tr.send("rasterizeImages",{scope:this.scope,tasks:yr},(kr,jr)=>{if(!kr)for(const[Zr,Vr]of jr.entries()){const Xr=Object.assign(ar.get(Zr),{data:Vr});ar.set(Zr,Xr)}Dr()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function nr(Wr,tr,ar,yr,Dr){const kr=new c.ac(tr,{brightness:ar,worldview:Dr});for(const jr of Wr)jr.recalculate(kr,yr)}class ur extends c.E{constructor(tr,ar,yr,Dr,kr,jr,Zr){super(),this.actor=tr,this.layerIndex=ar,this.availableImages=yr,this.availableModels=Dr,this.loadVectorData=jr||c.aL,this.loading={},this.loaded={},this.deduped=new c.aK(tr.scheduler),this.isSpriteLoaded=kr,this.scheduler=tr.scheduler,this.brightness=Zr}loadTile(tr,ar){const yr=tr.uid,Dr=tr&&tr.request,kr=Dr&&Dr.collectResourceTiming,jr=this.loading[yr]=new Zt(tr);jr.abort=this.loadVectorData(tr,(Zr,Vr)=>{const Xr=!this.loading[yr];if(delete this.loading[yr],jr.cancelRasterize(),Xr||Zr||!Vr)return jr.status="done",Xr||(this.loaded[yr]=jr),ar(Zr);const Sn=Vr.rawData,hn={},Wn=c.aM(Vr.responseHeaders);Wn&&Wn.expires&&(hn.expires=Wn.expires),Wn&&Wn.cacheControl&&(hn.cacheControl=Wn.cacheControl),jr.vectorTile=Vr.vectorTile||new c.fz(new c.bt(Sn));const os=()=>{jr.parse(jr.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,($n,ks)=>{if($n||!ks)return ar($n);const Is={};if(kr){const As=ct(Dr);As.length>0&&(Is.resourceTiming=JSON.parse(JSON.stringify(As)))}ar(null,Object.assign({rawTileData:Sn.slice(0),responseHeaders:Vr.responseHeaders},ks,hn,Is))})};this.isSpriteLoaded?os():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(os,{type:"parseTile",isSymbolTile:tr.isSymbolTile,zoom:tr.tileZoom}):os()}),this.loaded=this.loaded||{},this.loaded[yr]=jr})}reloadTile(tr,ar){const yr=this.loaded,Dr=tr.uid;if(yr&&yr[Dr]){const kr=yr[Dr];kr.updateParameters(tr);const jr=(Zr,Vr)=>{const Xr=kr.reloadCallback;Xr&&(delete kr.reloadCallback,kr.parse(kr.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Xr)),ar(Zr,Vr)};kr.status==="parsing"?kr.reloadCallback=jr:kr.status==="done"&&(kr.vectorTile?kr.parse(kr.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,jr):jr())}else ar(null,void 0)}abortTile(tr,ar){const yr=tr.uid,Dr=this.loading[yr];Dr&&(Dr.abort&&Dr.abort(),delete this.loading[yr]),ar()}removeTile(tr,ar){const yr=this.loaded,Dr=tr.uid;yr&&yr[Dr]&&delete yr[Dr],ar()}}class _r{loadTile(tr,ar){const{uid:yr,encoding:Dr,rawImageData:kr,padding:jr}=tr,Zr=ImageBitmap&&kr instanceof ImageBitmap?this.getImageData(kr,jr):kr;ar(null,new c.fA(yr,Zr,Dr,jr<1))}reloadTile(tr,ar){ar(null,null)}abortTile(tr,ar){ar()}removeTile(tr,ar){ar()}getImageData(tr,ar){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(tr.width,tr.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=tr.width,this.offscreenCanvas.height=tr.height,this.offscreenCanvasContext.drawImage(tr,0,0,tr.width,tr.height);const yr=this.offscreenCanvasContext.getImageData(-ar,-ar,tr.width+2*ar,tr.height+2*ar);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),yr}}c.bs.setPbf(c.bt);class Ur{constructor(tr){this._mrt=new c.bs(tr.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=tr.uid,this.tileID=tr.tileID,this.source=tr.source}parse(tr,ar){const yr=this._mrt;this.status="parsing",this._entireBuffer=tr;try{yr.parseHeader(tr),this._isHeaderLoaded=!0;const Dr=[];for(const kr in yr.layers){const jr=yr.getLayer(kr),Zr=jr.getDataRange(jr.getBandList()),Vr=yr.createDecodingTask(Zr),Xr=tr.slice(Zr.firstByte,Zr.lastByte+1),Sn=c.bs.performDecoding(Xr,Vr).then(hn=>Vr.complete(null,hn)).catch(hn=>Vr.complete(hn,null));Dr.push(Sn)}Promise.allSettled(Dr).then(()=>ar(null,yr)).catch(kr=>ar(kr))}catch(Dr){ar(Dr)}}}class ln{constructor(tr){this.actor=tr,this.loading={},this.loaded={}}loadTile(tr,ar){const yr=tr.uid,Dr=tr.request,kr=this.loading[yr]=new Ur(tr),{cancel:jr}=c.bu(Dr,(Zr,Vr,Xr)=>{const Sn=!this.loading[yr];if(delete this.loading[yr],Sn||Zr||!Vr)return kr.status="done",Sn||(this.loaded[yr]=kr),ar(Zr);kr.parse(Vr,(hn,Wn)=>{if(hn||!Wn)return ar(hn);ar(null,Wn,Xr)}),this.loaded[yr]=kr});kr.abort=jr}reloadTile(tr,ar){ar(null,void 0)}abortTile(tr,ar){const yr=tr.uid,Dr=this.loading[yr];Dr&&(Dr.abort&&Dr.abort(),delete this.loading[yr]),ar()}removeTile(tr,ar){const yr=tr.uid;this.loaded[yr]&&delete this.loaded[yr],ar()}decodeRasterArray(tr,ar){c.bs.performDecoding(tr.buffer,tr.task).then(yr=>ar(null,yr)).catch(yr=>ar(yr))}}const an=c.fB.prototype.toGeoJSON;class Fr{constructor(tr){this._feature=tr,this.extent=c.al,this.type=tr.type,this.properties=tr.tags,"id"in tr&&!isNaN(tr.id)&&(this.id=parseInt(tr.id,10))}loadGeometry(){if(this._feature.type===1){const tr=[];for(const ar of this._feature.geometry)tr.push([new c.P(ar[0],ar[1])]);return tr}{const tr=[];for(const ar of this._feature.geometry){const yr=[];for(const Dr of ar)yr.push(new c.P(Dr[0],Dr[1]));tr.push(yr)}return tr}}toGeoJSON(tr,ar,yr){return an.call(this,tr,ar,yr)}}class rn{constructor(tr,ar){this.name=tr,this.extent=c.al,this.length=ar.length,this._jsonFeatures=ar}feature(tr){return new Fr(this._jsonFeatures[tr])}}class gn{constructor(tr){this.layers={},this.extent=c.al;for(const ar of Object.keys(tr))this.layers[ar]=new rn(ar,tr[ar])}}const _i=64/4096,xr=128;class gr{constructor(){this.features=new Map}clear(){this.features.clear()}load(tr=[],ar){for(const yr of tr){const Dr=yr.id;if(Dr==null)continue;let kr=this.features.get(Dr);kr&&this.updateCache(kr,ar),yr.geometry?(kr=cr(yr),this.updateCache(kr,ar),this.features.set(Dr,kr)):this.features.delete(Dr),this.updateCache(kr,ar)}}updateCache(tr,ar){for(const{canonical:yr,uid:Dr}of Object.values(ar)){const{z:kr,x:jr,y:Zr}=yr;rr(tr,Math.pow(2,kr),jr,Zr)&&delete ar[Dr]}}getTile(tr,ar,yr){const Dr=Math.pow(2,tr),kr=[];for(const jr of this.features.values())rr(jr,Dr,ar,yr)&&kr.push(fn(jr,Dr,ar,yr));return{features:kr}}getFeatures(){return[...this.features.values()]}}function rr({minX:Wr,minY:tr,maxX:ar,maxY:yr},Dr,kr,jr){return Wr<(kr+1+_i)/Dr&&tr<(jr+1+_i)/Dr&&ar>(kr-_i)/Dr&&yr>(jr-_i)/Dr}function cr(Wr){const{id:tr,geometry:ar,properties:yr}=Wr;if(!ar)return;if(ar.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Dr,coordinates:kr}=ar,jr={id:tr,type:1,geometry:[],tags:yr,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Zr=jr.geometry;if(Dr==="Point")Hr(kr,Zr,jr);else if(Dr==="MultiPoint")for(const Vr of kr)Hr(Vr,Zr,jr);else if(Dr==="LineString")jr.type=2,$r(kr,Zr,jr);else if(Dr==="MultiLineString")jr.type=2,_n(kr,Zr,jr);else if(Dr==="Polygon")jr.type=3,_n(kr,Zr,jr,!0);else{if(Dr!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");jr.type=3;for(const Vr of kr)_n(Vr,Zr,jr,!0)}return jr}function Hr([Wr,tr],ar,yr){const Dr=c.aF(Wr);let kr=c.aJ(tr);kr=kr<0?0:kr>1?1:kr,ar.push(Dr,kr),yr.minX=Math.min(yr.minX,Dr),yr.minY=Math.min(yr.minY,kr),yr.maxX=Math.max(yr.maxX,Dr),yr.maxY=Math.max(yr.maxY,kr)}function $r(Wr,tr,ar,yr=!1,Dr=!1){const kr=[];for(const jr of Wr)Hr(jr,kr,ar);tr.push(kr),yr&&function(jr,Zr){let Vr=0;for(let Xr=0,Sn=jr.length,hn=Sn-2;Xr<Sn;hn=Xr,Xr+=2)Vr+=(jr[Xr]-jr[hn])*(jr[Xr+1]+jr[hn+1]);if(Vr>0===Zr)for(let Xr=0,Sn=jr.length;Xr<Sn/2;Xr+=2){const hn=jr[Xr],Wn=jr[Xr+1];jr[Xr]=jr[Sn-2-Xr],jr[Xr+1]=jr[Sn-1-Xr],jr[Sn-2-Xr]=hn,jr[Sn-1-Xr]=Wn}}(kr,Dr)}function _n(Wr,tr,ar,yr=!1){for(let Dr=0;Dr<Wr.length;Dr++)$r(Wr[Dr],tr,ar,yr,Dr===0)}function fn(Wr,tr,ar,yr){const{id:Dr,type:kr,geometry:jr,tags:Zr}=Wr,Vr=[];if(kr===1)(function(Xr,Sn,hn,Wn,os){for(let $n=0;$n<Xr.length;$n+=2){const ks=Math.round(c.al*(Xr[$n+0]*Sn-hn)),Is=Math.round(c.al*(Xr[$n+1]*Sn-Wn));os.push([ks,Is])}})(jr,tr,ar,yr,Vr);else if(kr===2)for(const Xr of jr)jn(Xr,tr,ar,yr,Vr);else if(kr===3)for(const Xr of jr)vs(Xr,tr,ar,yr,Vr);return{id:Dr,type:kr,geometry:Vr,tags:Zr}}function jn(Wr,tr,ar,yr,Dr){const kr=-xr,jr=c.al+xr;let Zr;for(let Vr=0;Vr<Wr.length-2;Vr+=2){let Xr=Math.round(c.al*(Wr[Vr+0]*tr-ar)),Sn=Math.round(c.al*(Wr[Vr+1]*tr-yr)),hn=Math.round(c.al*(Wr[Vr+2]*tr-ar)),Wn=Math.round(c.al*(Wr[Vr+3]*tr-yr));const os=hn-Xr,$n=Wn-Sn;Xr<kr&&hn<kr||(Xr<kr?(Sn+=Math.round($n*((kr-Xr)/os)),Xr=kr):hn<kr&&(Wn=Sn+Math.round($n*((kr-Xr)/os)),hn=kr),Sn<kr&&Wn<kr||(Sn<kr?(Xr+=Math.round(os*((kr-Sn)/$n)),Sn=kr):Wn<kr&&(hn=Xr+Math.round(os*((kr-Sn)/$n)),Wn=kr),Xr>=jr&&hn>=jr||(Xr>=jr?(Sn+=Math.round($n*((jr-Xr)/os)),Xr=jr):hn>=jr&&(Wn=Sn+Math.round($n*((jr-Xr)/os)),hn=jr),Sn>=jr&&Wn>=jr||(Sn>=jr?(Xr+=Math.round(os*((jr-Sn)/$n)),Sn=jr):Wn>=jr&&(hn=Xr+Math.round(os*((jr-Sn)/$n)),Wn=jr),Zr&&Xr===Zr[Zr.length-1][0]&&Sn===Zr[Zr.length-1][1]||(Zr=[[Xr,Sn]],Dr.push(Zr)),Zr.push([hn,Wn])))))}}function vs(Wr,tr,ar,yr,Dr){const kr=(ar-_i)/tr,jr=(yr-_i)/tr,Zr=(ar+1+_i)/tr,Vr=(yr+1+_i)/tr;function Xr(Wn,os){let $n=0;return Wn<kr?$n|=1:Wn>Zr&&($n|=2),os<jr?$n|=4:os>Vr&&($n|=8),$n}let Sn=[];for(let Wn=1;Wn<=8;Wn*=2){let os=Wr[Wr.length-2],$n=Wr[Wr.length-1],ks=!(Xr(os,$n)&Wn);for(let Is=0;Is<Wr.length;Is+=2){const As=Wr[Is],Xs=Wr[Is+1],na=!(Xr(As,Xs)&Wn);na!==ks&&(8&Wn?Sn.push(os+(As-os)*(Vr-$n)/(Xs-$n),Vr):4&Wn?Sn.push(os+(As-os)*(jr-$n)/(Xs-$n),jr):2&Wn?Sn.push(Zr,$n+(Xs-$n)*(Zr-os)/(As-os)):1&Wn&&Sn.push(kr,$n+(Xs-$n)*(kr-os)/(As-os))),na&&Sn.push(As,Xs),os=As,$n=Xs,ks=na}if(!(Wr=Sn).length||Wn===8)break;Sn=[]}const hn=[];for(let Wn=0;Wn<Sn.length;Wn+=2)hn.push([Math.round(c.al*(Sn[Wn]*tr-ar)),Math.round(c.al*(Sn[Wn+1]*tr-yr))]);Dr.push(hn)}function Cs({name:Wr,features:tr},ar){ar.writeStringField(1,Wr),ar.writeVarintField(5,c.al);const yr=new Map,Dr=new Map,kr={keys:yr,values:Dr,feature:null};for(const jr of tr)kr.feature=jr,ar.writeMessage(2,ns,kr);for(const jr of yr.keys())ar.writeStringField(3,jr);for(const jr of Dr.keys())ar.writeMessage(4,Ks,jr)}function ns(Wr,tr){const ar=Wr.feature;ar.id!==void 0&&Number.isSafeInteger(+ar.id)&&tr.writeVarintField(1,+ar.id),ar.tags&&tr.writeMessage(2,Nn,Wr),tr.writeVarintField(3,ar.type),tr.writeMessage(4,Ss,ar)}function Nn({keys:Wr,values:tr,feature:ar},yr){for(const Dr of Object.keys(ar.tags)){let kr=ar.tags[Dr];if(kr===null)continue;let jr=Wr.get(Dr);jr===void 0&&(jr=Wr.size,Wr.set(Dr,jr)),yr.writeVarint(jr);const Zr=typeof kr;Zr!=="string"&&Zr!=="boolean"&&Zr!=="number"&&(kr=JSON.stringify(kr));let Vr=tr.get(kr);Vr===void 0&&(Vr=tr.size,tr.set(kr,Vr)),yr.writeVarint(Vr)}}function ls(Wr,tr){return(tr<<3)+(7&Wr)}function ms(Wr){return Wr<<1^Wr>>31}function Ss(Wr,tr){const{geometry:ar,type:yr}=Wr;let Dr=0,kr=0;if(yr===1){tr.writeVarint(ls(1,ar.length));for(const jr of ar){const Zr=jr[0]-Dr,Vr=jr[1]-kr;tr.writeVarint(ms(Zr)),tr.writeVarint(ms(Vr)),Dr+=Zr,kr+=Vr}}else for(const jr of ar){tr.writeVarint(ls(1,1));const Zr=jr.length-(yr===3?1:0);for(let Vr=0;Vr<Zr;Vr++){Vr===1&&tr.writeVarint(ls(2,Zr-1));const Xr=jr[Vr][0]-Dr,Sn=jr[Vr][1]-kr;tr.writeVarint(ms(Xr)),tr.writeVarint(ms(Sn)),Dr+=Xr,kr+=Sn}yr===3&&tr.writeVarint(ls(7,1))}}function Ks(Wr,tr){const ar=typeof Wr;ar==="string"?tr.writeStringField(1,Wr):ar==="boolean"?tr.writeBooleanField(7,Wr):ar==="number"&&(Wr%1!=0?tr.writeDoubleField(3,Wr):Wr<0?tr.writeSVarintField(6,Wr):tr.writeVarintField(5,Wr))}const ws={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Wr=>Wr},ps=Math.fround||(Rl=new Float32Array(1),Wr=>(Rl[0]=+Wr,Rl[0]));var Rl;const Qo=3,Vo=5,wo=6;class tu{constructor(tr){this.options=Object.assign(Object.create(ws),tr),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(tr){const{log:ar,minZoom:yr,maxZoom:Dr}=this.options;ar&&console.time("total time");const kr=`prepare ${tr.length} points`;ar&&console.time(kr),this.points=tr;const jr=[];for(let Vr=0;Vr<tr.length;Vr++){const Xr=tr[Vr];if(!Xr.geometry)continue;const[Sn,hn]=Xr.geometry.coordinates,Wn=ps(ru(Sn)),os=ps(Ll(hn));jr.push(Wn,os,1/0,Vr,-1,1),this.options.reduce&&jr.push(0)}let Zr=this.trees[Dr+1]=this._createTree(jr);ar&&console.timeEnd(kr);for(let Vr=Dr;Vr>=yr;Vr--){const Xr=+Date.now();Zr=this.trees[Vr]=this._createTree(this._cluster(Zr,Vr)),ar&&console.log("z%d: %d clusters in %dms",Vr,Zr.numItems,+Date.now()-Xr)}return ar&&console.timeEnd("total time"),this}getClusters(tr,ar){let yr=((tr[0]+180)%360+360)%360-180;const Dr=Math.max(-90,Math.min(90,tr[1]));let kr=tr[2]===180?180:((tr[2]+180)%360+360)%360-180;const jr=Math.max(-90,Math.min(90,tr[3]));if(tr[2]-tr[0]>=360)yr=-180,kr=180;else if(yr>kr){const hn=this.getClusters([yr,Dr,180,jr],ar),Wn=this.getClusters([-180,Dr,kr,jr],ar);return hn.concat(Wn)}const Zr=this.trees[this._limitZoom(ar)],Vr=Zr.range(ru(yr),Ll(jr),ru(kr),Ll(Dr)),Xr=Zr.data,Sn=[];for(const hn of Vr){const Wn=this.stride*hn;Sn.push(Xr[Wn+Vo]>1?ou(Xr,Wn,this.clusterProps):this.points[Xr[Wn+Qo]])}return Sn}getChildren(tr){const ar=this._getOriginId(tr),yr=this._getOriginZoom(tr),Dr="No cluster with the specified id.",kr=this.trees[yr];if(!kr)throw new Error(Dr);const jr=kr.data;if(ar*this.stride>=jr.length)throw new Error(Dr);const Zr=this.options.radius/(this.options.extent*Math.pow(2,yr-1)),Vr=kr.within(jr[ar*this.stride],jr[ar*this.stride+1],Zr),Xr=[];for(const Sn of Vr){const hn=Sn*this.stride;jr[hn+4]===tr&&Xr.push(jr[hn+Vo]>1?ou(jr,hn,this.clusterProps):this.points[jr[hn+Qo]])}if(Xr.length===0)throw new Error(Dr);return Xr}getLeaves(tr,ar,yr){const Dr=[];return this._appendLeaves(Dr,tr,ar=ar||10,yr=yr||0,0),Dr}getTile(tr,ar,yr){const Dr=this.trees[this._limitZoom(tr)],kr=Math.pow(2,tr),{extent:jr,radius:Zr}=this.options,Vr=Zr/jr,Xr=(yr-Vr)/kr,Sn=(yr+1+Vr)/kr,hn={features:[]};return this._addTileFeatures(Dr.range((ar-Vr)/kr,Xr,(ar+1+Vr)/kr,Sn),Dr.data,ar,yr,kr,hn),ar===0&&this._addTileFeatures(Dr.range(1-Vr/kr,Xr,1,Sn),Dr.data,kr,yr,kr,hn),ar===kr-1&&this._addTileFeatures(Dr.range(0,Xr,Vr/kr,Sn),Dr.data,-1,yr,kr,hn),hn.features.length?hn:null}getClusterExpansionZoom(tr){let ar=this._getOriginZoom(tr)-1;for(;ar<=this.options.maxZoom;){const yr=this.getChildren(tr);if(ar++,yr.length!==1)break;tr=yr[0].properties.cluster_id}return ar}_appendLeaves(tr,ar,yr,Dr,kr){const jr=this.getChildren(ar);for(const Zr of jr){const Vr=Zr.properties;if(Vr&&Vr.cluster?kr+Vr.point_count<=Dr?kr+=Vr.point_count:kr=this._appendLeaves(tr,Vr.cluster_id,yr,Dr,kr):kr<Dr?kr++:tr.push(Zr),tr.length===yr)break}return kr}_createTree(tr){const ar=new c.c4(tr.length/this.stride|0,this.options.nodeSize,Float32Array);for(let yr=0;yr<tr.length;yr+=this.stride)ar.add(tr[yr],tr[yr+1]);return ar.finish(),ar.data=tr,ar}_addTileFeatures(tr,ar,yr,Dr,kr,jr){for(const Zr of tr){const Vr=Zr*this.stride,Xr=ar[Vr+Vo]>1;let Sn,hn,Wn;if(Xr)Sn=Sl(ar,Vr,this.clusterProps),hn=ar[Vr],Wn=ar[Vr+1];else{const ks=this.points[ar[Vr+Qo]];Sn=ks.properties;const[Is,As]=ks.geometry.coordinates;hn=ru(Is),Wn=Ll(As)}const os={type:1,geometry:[[Math.round(this.options.extent*(hn*kr-yr)),Math.round(this.options.extent*(Wn*kr-Dr))]],tags:Sn};let $n;$n=Xr||this.options.generateId?ar[Vr+Qo]:this.points[ar[Vr+Qo]].id,$n!==void 0&&(os.id=$n),jr.features.push(os)}}_limitZoom(tr){return Math.max(this.options.minZoom,Math.min(Math.floor(+tr),this.options.maxZoom+1))}_cluster(tr,ar){const{radius:yr,extent:Dr,reduce:kr,minPoints:jr}=this.options,Zr=yr/(Dr*Math.pow(2,ar)),Vr=tr.data,Xr=[],Sn=this.stride;for(let hn=0;hn<Vr.length;hn+=Sn){if(Vr[hn+2]<=ar)continue;Vr[hn+2]=ar;const Wn=Vr[hn],os=Vr[hn+1],$n=tr.within(Vr[hn],Vr[hn+1],Zr),ks=Vr[hn+Vo];let Is=ks;for(const As of $n){const Xs=As*Sn;Vr[Xs+2]>ar&&(Is+=Vr[Xs+Vo])}if(Is>ks&&Is>=jr){let As,Xs=Wn*ks,na=os*ks,Pl=-1;const ba=(hn/Sn<<5)+(ar+1)+this.points.length;for(const Ol of $n){const Ko=Ol*Sn;if(Vr[Ko+2]<=ar)continue;Vr[Ko+2]=ar;const Js=Vr[Ko+Vo];Xs+=Vr[Ko]*Js,na+=Vr[Ko+1]*Js,Vr[Ko+4]=ba,kr&&(As||(As=this._map(Vr,hn,!0),Pl=this.clusterProps.length,this.clusterProps.push(As)),kr(As,this._map(Vr,Ko)))}Vr[hn+4]=ba,Xr.push(Xs/Is,na/Is,1/0,ba,-1,Is),kr&&Xr.push(Pl)}else{for(let As=0;As<Sn;As++)Xr.push(Vr[hn+As]);if(Is>1)for(const As of $n){const Xs=As*Sn;if(!(Vr[Xs+2]<=ar)){Vr[Xs+2]=ar;for(let na=0;na<Sn;na++)Xr.push(Vr[Xs+na])}}}}return Xr}_getOriginId(tr){return tr-this.points.length>>5}_getOriginZoom(tr){return(tr-this.points.length)%32}_map(tr,ar,yr){if(tr[ar+Vo]>1){const jr=this.clusterProps[tr[ar+wo]];return yr?Object.assign({},jr):jr}const Dr=this.points[tr[ar+Qo]].properties,kr=this.options.map(Dr);return yr&&kr===Dr?Object.assign({},kr):kr}}function ou(Wr,tr,ar){return{type:"Feature",id:Wr[tr+Qo],properties:Sl(Wr,tr,ar),geometry:{type:"Point",coordinates:[(yr=Wr[tr],360*(yr-.5)),Jo(Wr[tr+1])]}};var yr}function Sl(Wr,tr,ar){const yr=Wr[tr+Vo],Dr=yr>=1e4?`${Math.round(yr/1e3)}k`:yr>=1e3?Math.round(yr/100)/10+"k":yr,kr=Wr[tr+wo],jr=kr===-1?{}:Object.assign({},ar[kr]);return Object.assign(jr,{cluster:!0,cluster_id:Wr[tr+Qo],point_count:yr,point_count_abbreviated:Dr})}function ru(Wr){return Wr/360+.5}function Ll(Wr){const tr=Math.sin(Wr*Math.PI/180),ar=.5-.25*Math.log((1+tr)/(1-tr))/Math.PI;return ar<0?0:ar>1?1:ar}function Jo(Wr){const tr=(180-360*Wr)*Math.PI/180;return 360*Math.atan(Math.exp(tr))/Math.PI-90}function iu(Wr,tr,ar,yr){let Dr=yr;const kr=tr+(ar-tr>>1);let jr,Zr=ar-tr;const Vr=Wr[tr],Xr=Wr[tr+1],Sn=Wr[ar],hn=Wr[ar+1];for(let Wn=tr+3;Wn<ar;Wn+=3){const os=xa(Wr[Wn],Wr[Wn+1],Vr,Xr,Sn,hn);if(os>Dr)jr=Wn,Dr=os;else if(os===Dr){const $n=Math.abs(Wn-kr);$n<Zr&&(jr=Wn,Zr=$n)}}Dr>yr&&(jr-tr>3&&iu(Wr,tr,jr,yr),Wr[jr+2]=Dr,ar-jr>3&&iu(Wr,jr,ar,yr))}function xa(Wr,tr,ar,yr,Dr,kr){let jr=Dr-ar,Zr=kr-yr;if(jr!==0||Zr!==0){const Vr=((Wr-ar)*jr+(tr-yr)*Zr)/(jr*jr+Zr*Zr);Vr>1?(ar=Dr,yr=kr):Vr>0&&(ar+=jr*Vr,yr+=Zr*Vr)}return jr=Wr-ar,Zr=tr-yr,jr*jr+Zr*Zr}function Il(Wr,tr,ar,yr){const Dr={id:Wr??null,type:tr,geometry:ar,tags:yr,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(tr==="Point"||tr==="MultiPoint"||tr==="LineString")Eu(Dr,ar);else if(tr==="Polygon")Eu(Dr,ar[0]);else if(tr==="MultiLineString")for(const kr of ar)Eu(Dr,kr);else if(tr==="MultiPolygon")for(const kr of ar)Eu(Dr,kr[0]);return Dr}function Eu(Wr,tr){for(let ar=0;ar<tr.length;ar+=3)Wr.minX=Math.min(Wr.minX,tr[ar]),Wr.minY=Math.min(Wr.minY,tr[ar+1]),Wr.maxX=Math.max(Wr.maxX,tr[ar]),Wr.maxY=Math.max(Wr.maxY,tr[ar+1])}function $l(Wr,tr,ar,yr){if(!tr.geometry)return;const Dr=tr.geometry.coordinates;if(Dr&&Dr.length===0)return;const kr=tr.geometry.type,jr=Math.pow(ar.tolerance/((1<<ar.maxZoom)*ar.extent),2);let Zr=[],Vr=tr.id;if(ar.promoteId?Vr=tr.properties[ar.promoteId]:ar.generateId&&(Vr=yr||0),kr==="Point")xu(Dr,Zr);else if(kr==="MultiPoint")for(const Xr of Dr)xu(Xr,Zr);else if(kr==="LineString")Kp(Dr,Zr,jr,!1);else if(kr==="MultiLineString"){if(ar.lineMetrics){for(const Xr of Dr)Zr=[],Kp(Xr,Zr,jr,!1),Wr.push(Il(Vr,"LineString",Zr,tr.properties));return}Rp(Dr,Zr,jr,!1)}else if(kr==="Polygon")Rp(Dr,Zr,jr,!0);else{if(kr!=="MultiPolygon"){if(kr==="GeometryCollection"){for(const Xr of tr.geometry.geometries)$l(Wr,{id:Vr,geometry:Xr,properties:tr.properties},ar,yr);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Xr of Dr){const Sn=[];Rp(Xr,Sn,jr,!0),Zr.push(Sn)}}Wr.push(Il(Vr,kr,Zr,tr.properties))}function xu(Wr,tr){tr.push(Ip(Wr[0]),Cl(Wr[1]),0)}function Kp(Wr,tr,ar,yr){let Dr,kr,jr=0;for(let Vr=0;Vr<Wr.length;Vr++){const Xr=Ip(Wr[Vr][0]),Sn=Cl(Wr[Vr][1]);tr.push(Xr,Sn,0),Vr>0&&(jr+=yr?(Dr*Sn-Xr*kr)/2:Math.sqrt(Math.pow(Xr-Dr,2)+Math.pow(Sn-kr,2))),Dr=Xr,kr=Sn}const Zr=tr.length-3;tr[2]=1,iu(tr,0,Zr,ar),tr[Zr+2]=1,tr.size=Math.abs(jr),tr.start=0,tr.end=tr.size}function Rp(Wr,tr,ar,yr){for(let Dr=0;Dr<Wr.length;Dr++){const kr=[];Kp(Wr[Dr],kr,ar,yr),tr.push(kr)}}function Ip(Wr){return Wr/360+.5}function Cl(Wr){const tr=Math.sin(Wr*Math.PI/180),ar=.5-.25*Math.log((1+tr)/(1-tr))/Math.PI;return ar<0?0:ar>1?1:ar}function hu(Wr,tr,ar,yr,Dr,kr,jr,Zr){if(yr/=tr,kr>=(ar/=tr)&&jr<yr)return Wr;if(jr<ar||kr>=yr)return null;const Vr=[];for(const Xr of Wr){const Sn=Xr.geometry;let hn=Xr.type;const Wn=Dr===0?Xr.minX:Xr.minY,os=Dr===0?Xr.maxX:Xr.maxY;if(Wn>=ar&&os<yr){Vr.push(Xr);continue}if(os<ar||Wn>=yr)continue;let $n=[];if(hn==="Point"||hn==="MultiPoint")_d(Sn,$n,ar,yr,Dr);else if(hn==="LineString")Pp(Sn,$n,ar,yr,Dr,!1,Zr.lineMetrics);else if(hn==="MultiLineString")tp(Sn,$n,ar,yr,Dr,!1);else if(hn==="Polygon")tp(Sn,$n,ar,yr,Dr,!0);else if(hn==="MultiPolygon")for(const ks of Sn){const Is=[];tp(ks,Is,ar,yr,Dr,!0),Is.length&&$n.push(Is)}if($n.length){if(Zr.lineMetrics&&hn==="LineString"){for(const ks of $n)Vr.push(Il(Xr.id,hn,ks,Xr.tags));continue}hn!=="LineString"&&hn!=="MultiLineString"||($n.length===1?(hn="LineString",$n=$n[0]):hn="MultiLineString"),hn!=="Point"&&hn!=="MultiPoint"||(hn=$n.length===3?"Point":"MultiPoint"),Vr.push(Il(Xr.id,hn,$n,Xr.tags))}}return Vr.length?Vr:null}function _d(Wr,tr,ar,yr,Dr){for(let kr=0;kr<Wr.length;kr+=3){const jr=Wr[kr+Dr];jr>=ar&&jr<=yr&&Bu(tr,Wr[kr],Wr[kr+1],Wr[kr+2])}}function Pp(Wr,tr,ar,yr,Dr,kr,jr){let Zr=ep(Wr);const Vr=Dr===0?Wm:mp;let Xr,Sn,hn=Wr.start;for(let Is=0;Is<Wr.length-3;Is+=3){const As=Wr[Is],Xs=Wr[Is+1],na=Wr[Is+2],Pl=Wr[Is+3],ba=Wr[Is+4],Ol=Dr===0?As:Xs,Ko=Dr===0?Pl:ba;let Js=!1;jr&&(Xr=Math.sqrt(Math.pow(As-Pl,2)+Math.pow(Xs-ba,2))),Ol<ar?Ko>ar&&(Sn=Vr(Zr,As,Xs,Pl,ba,ar),jr&&(Zr.start=hn+Xr*Sn)):Ol>yr?Ko<yr&&(Sn=Vr(Zr,As,Xs,Pl,ba,yr),jr&&(Zr.start=hn+Xr*Sn)):Bu(Zr,As,Xs,na),Ko<ar&&Ol>=ar&&(Sn=Vr(Zr,As,Xs,Pl,ba,ar),Js=!0),Ko>yr&&Ol<=yr&&(Sn=Vr(Zr,As,Xs,Pl,ba,yr),Js=!0),!kr&&Js&&(jr&&(Zr.end=hn+Xr*Sn),tr.push(Zr),Zr=ep(Wr)),jr&&(hn+=Xr)}let Wn=Wr.length-3;const os=Wr[Wn],$n=Wr[Wn+1],ks=Dr===0?os:$n;ks>=ar&&ks<=yr&&Bu(Zr,os,$n,Wr[Wn+2]),Wn=Zr.length-3,kr&&Wn>=3&&(Zr[Wn]!==Zr[0]||Zr[Wn+1]!==Zr[1])&&Bu(Zr,Zr[0],Zr[1],Zr[2]),Zr.length&&tr.push(Zr)}function ep(Wr){const tr=[];return tr.size=Wr.size,tr.start=Wr.start,tr.end=Wr.end,tr}function tp(Wr,tr,ar,yr,Dr,kr){for(const jr of Wr)Pp(jr,tr,ar,yr,Dr,kr,!1)}function Bu(Wr,tr,ar,yr){Wr.push(tr,ar,yr)}function Wm(Wr,tr,ar,yr,Dr,kr){const jr=(kr-tr)/(yr-tr);return Bu(Wr,kr,ar+(Dr-ar)*jr,1),jr}function mp(Wr,tr,ar,yr,Dr,kr){const jr=(kr-ar)/(Dr-ar);return Bu(Wr,tr+(yr-tr)*jr,kr,1),jr}function To(Wr,tr){const ar=[];for(let yr=0;yr<Wr.length;yr++){const Dr=Wr[yr],kr=Dr.type;let jr;if(kr==="Point"||kr==="MultiPoint"||kr==="LineString")jr=Kl(Dr.geometry,tr);else if(kr==="MultiLineString"||kr==="Polygon"){jr=[];for(const Zr of Dr.geometry)jr.push(Kl(Zr,tr))}else if(kr==="MultiPolygon"){jr=[];for(const Zr of Dr.geometry){const Vr=[];for(const Xr of Zr)Vr.push(Kl(Xr,tr));jr.push(Vr)}}ar.push(Il(Dr.id,kr,jr,Dr.tags))}return ar}function Kl(Wr,tr){const ar=[];ar.size=Wr.size,Wr.start!==void 0&&(ar.start=Wr.start,ar.end=Wr.end);for(let yr=0;yr<Wr.length;yr+=3)ar.push(Wr[yr]+tr,Wr[yr+1],Wr[yr+2]);return ar}function lo(Wr,tr){if(Wr.transformed)return Wr;const ar=1<<Wr.z,yr=Wr.x,Dr=Wr.y;for(const kr of Wr.features){const jr=kr.geometry,Zr=kr.type;if(kr.geometry=[],Zr===1)for(let Vr=0;Vr<jr.length;Vr+=2)kr.geometry.push(Oo(jr[Vr],jr[Vr+1],tr,ar,yr,Dr));else for(let Vr=0;Vr<jr.length;Vr++){const Xr=[];for(let Sn=0;Sn<jr[Vr].length;Sn+=2)Xr.push(Oo(jr[Vr][Sn],jr[Vr][Sn+1],tr,ar,yr,Dr));kr.geometry.push(Xr)}}return Wr.transformed=!0,Wr}function Oo(Wr,tr,ar,yr,Dr,kr){return[Math.round(ar*(Wr*yr-Dr)),Math.round(ar*(tr*yr-kr))]}function jo(Wr,tr,ar,yr,Dr){const kr=tr===Dr.maxZoom?0:Dr.tolerance/((1<<tr)*Dr.extent),jr={features:[],numPoints:0,numSimplified:0,numFeatures:Wr.length,source:null,x:ar,y:yr,z:tr,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Zr of Wr)Tu(jr,Zr,kr,Dr);return jr}function Tu(Wr,tr,ar,yr){const Dr=tr.geometry,kr=tr.type,jr=[];if(Wr.minX=Math.min(Wr.minX,tr.minX),Wr.minY=Math.min(Wr.minY,tr.minY),Wr.maxX=Math.max(Wr.maxX,tr.maxX),Wr.maxY=Math.max(Wr.maxY,tr.maxY),kr==="Point"||kr==="MultiPoint")for(let Zr=0;Zr<Dr.length;Zr+=3)jr.push(Dr[Zr],Dr[Zr+1]),Wr.numPoints++,Wr.numSimplified++;else if(kr==="LineString")mn(jr,Dr,Wr,ar,!1,!1);else if(kr==="MultiLineString"||kr==="Polygon")for(let Zr=0;Zr<Dr.length;Zr++)mn(jr,Dr[Zr],Wr,ar,kr==="Polygon",Zr===0);else if(kr==="MultiPolygon")for(let Zr=0;Zr<Dr.length;Zr++){const Vr=Dr[Zr];for(let Xr=0;Xr<Vr.length;Xr++)mn(jr,Vr[Xr],Wr,ar,!0,Xr===0)}if(jr.length){let Zr=tr.tags||null;if(kr==="LineString"&&yr.lineMetrics){Zr={};for(const Xr in tr.tags)Zr[Xr]=tr.tags[Xr];Zr.mapbox_clip_start=Dr.start/Dr.size,Zr.mapbox_clip_end=Dr.end/Dr.size}const Vr={geometry:jr,type:kr==="Polygon"||kr==="MultiPolygon"?3:kr==="LineString"||kr==="MultiLineString"?2:1,tags:Zr};tr.id!==null&&(Vr.id=tr.id),Wr.features.push(Vr)}}function mn(Wr,tr,ar,yr,Dr,kr){const jr=yr*yr;if(yr>0&&tr.size<(Dr?jr:yr))return void(ar.numPoints+=tr.length/3);const Zr=[];for(let Vr=0;Vr<tr.length;Vr+=3)(yr===0||tr[Vr+2]>jr)&&(ar.numSimplified++,Zr.push(tr[Vr],tr[Vr+1])),ar.numPoints++;Dr&&function(Vr,Xr){let Sn=0;for(let hn=0,Wn=Vr.length,os=Wn-2;hn<Wn;os=hn,hn+=2)Sn+=(Vr[hn]-Vr[os])*(Vr[hn+1]+Vr[os+1]);if(Sn>0===Xr)for(let hn=0,Wn=Vr.length;hn<Wn/2;hn+=2){const os=Vr[hn],$n=Vr[hn+1];Vr[hn]=Vr[Wn-2-hn],Vr[hn+1]=Vr[Wn-1-hn],Vr[Wn-2-hn]=os,Vr[Wn-1-hn]=$n}}(Zr,kr),Wr.push(Zr)}const du={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class gp{constructor(tr,ar){const yr=(ar=this.options=function(kr,jr){for(const Zr in jr)kr[Zr]=jr[Zr];return kr}(Object.create(du),ar)).debug;if(yr&&console.time("preprocess data"),ar.maxZoom<0||ar.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ar.promoteId&&ar.generateId)throw new Error("promoteId and generateId cannot be used together.");let Dr=function(kr,jr){const Zr=[];if(kr.type==="FeatureCollection")for(let Vr=0;Vr<kr.features.length;Vr++)$l(Zr,kr.features[Vr],jr,Vr);else $l(Zr,kr.type==="Feature"?kr:{geometry:kr},jr);return Zr}(tr,ar);this.tiles={},this.tileCoords=[],yr&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ar.indexMaxZoom,ar.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Dr=function(kr,jr){const Zr=jr.buffer/jr.extent;let Vr=kr;const Xr=hu(kr,1,-1-Zr,Zr,0,-1,2,jr),Sn=hu(kr,1,1-Zr,2+Zr,0,-1,2,jr);return(Xr||Sn)&&(Vr=hu(kr,1,-Zr,1+Zr,0,-1,2,jr)||[],Xr&&(Vr=To(Xr,1).concat(Vr)),Sn&&(Vr=Vr.concat(To(Sn,-1)))),Vr}(Dr,ar),Dr.length&&this.splitTile(Dr,0,0,0),yr&&(Dr.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(tr,ar,yr,Dr,kr,jr,Zr){const Vr=[tr,ar,yr,Dr],Xr=this.options,Sn=Xr.debug;for(;Vr.length;){Dr=Vr.pop(),yr=Vr.pop(),ar=Vr.pop(),tr=Vr.pop();const hn=1<<ar,Wn=au(ar,yr,Dr);let os=this.tiles[Wn];if(!os&&(Sn>1&&console.time("creation"),os=this.tiles[Wn]=jo(tr,ar,yr,Dr,Xr),this.tileCoords.push({z:ar,x:yr,y:Dr}),Sn)){Sn>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ar,yr,Dr,os.numFeatures,os.numPoints,os.numSimplified),console.timeEnd("creation"));const Js=`z${ar}`;this.stats[Js]=(this.stats[Js]||0)+1,this.total++}if(os.source=tr,kr==null){if(ar===Xr.indexMaxZoom||os.numPoints<=Xr.indexMaxPoints)continue}else{if(ar===Xr.maxZoom||ar===kr)continue;if(kr!=null){const Js=kr-ar;if(yr!==jr>>Js||Dr!==Zr>>Js)continue}}if(os.source=null,tr.length===0)continue;Sn>1&&console.time("clipping");const $n=.5*Xr.buffer/Xr.extent,ks=.5-$n,Is=.5+$n,As=1+$n;let Xs=null,na=null,Pl=null,ba=null,Ol=hu(tr,hn,yr-$n,yr+Is,0,os.minX,os.maxX,Xr),Ko=hu(tr,hn,yr+ks,yr+As,0,os.minX,os.maxX,Xr);tr=null,Ol&&(Xs=hu(Ol,hn,Dr-$n,Dr+Is,1,os.minY,os.maxY,Xr),na=hu(Ol,hn,Dr+ks,Dr+As,1,os.minY,os.maxY,Xr),Ol=null),Ko&&(Pl=hu(Ko,hn,Dr-$n,Dr+Is,1,os.minY,os.maxY,Xr),ba=hu(Ko,hn,Dr+ks,Dr+As,1,os.minY,os.maxY,Xr),Ko=null),Sn>1&&console.timeEnd("clipping"),Vr.push(Xs||[],ar+1,2*yr,2*Dr),Vr.push(na||[],ar+1,2*yr,2*Dr+1),Vr.push(Pl||[],ar+1,2*yr+1,2*Dr),Vr.push(ba||[],ar+1,2*yr+1,2*Dr+1)}}getTile(tr,ar,yr){tr=+tr,ar=+ar,yr=+yr;const Dr=this.options,{extent:kr,debug:jr}=Dr;if(tr<0||tr>24)return null;const Zr=1<<tr,Vr=au(tr,ar=ar+Zr&Zr-1,yr);if(this.tiles[Vr])return lo(this.tiles[Vr],kr);jr>1&&console.log("drilling down to z%d-%d-%d",tr,ar,yr);let Xr,Sn=tr,hn=ar,Wn=yr;for(;!Xr&&Sn>0;)Sn--,hn>>=1,Wn>>=1,Xr=this.tiles[au(Sn,hn,Wn)];return Xr&&Xr.source?(jr>1&&(console.log("found parent tile z%d-%d-%d",Sn,hn,Wn),console.time("drilling down")),this.splitTile(Xr.source,Sn,hn,Wn,tr,ar,yr),jr>1&&console.timeEnd("drilling down"),this.tiles[Vr]?lo(this.tiles[Vr],kr):null):null}}function au(Wr,tr,ar){return 32*((1<<Wr)*ar+tr)+Wr}function Fs(Wr,tr){const ar=Wr.tileID.canonical;if(!this._geoJSONIndex)return void tr(null,null);const yr=this._geoJSONIndex.getTile(ar.z,ar.x,ar.y);if(!yr)return void tr(null,null);const Dr=Xr=>Xr.tags&&"3d_elevation_id"in Xr.tags&&"source"in Xr.tags&&Xr.tags.source==="elevation",kr=yr.features.filter(Xr=>Dr(Xr));let jr={_geojsonTileLayer:yr.features};kr.length>0&&(jr={_geojsonTileLayer:yr.features.filter(Xr=>!Dr(Xr)),hd_road_elevation:kr});const Zr=new gn(jr),Vr=function(Xr){const Sn=new c.bt;for(const hn of Object.keys(Xr))Sn.writeMessage(3,Cs,{name:hn,features:Xr[hn]});return Sn.finish()}(jr).buffer;tr(null,{vectorTile:Zr,rawData:Vr})}class vu extends ur{constructor(tr,ar,yr,Dr,kr,jr,Zr){super(tr,ar,yr,Dr,kr,Fs,Zr),jr&&(this.loadGeoJSON=jr),this._dynamicIndex=new gr}loadData(tr,ar){const yr=tr&&tr.request,Dr=yr&&yr.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(tr,(kr,jr)=>{if(kr||!jr)return ar(kr);if(typeof jr!="object")return ar(new Error(`Input data given to '${tr.source}' is not a valid GeoJSON object.`));{try{if(tr.filter){const Vr=c.U(tr.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Vr.result==="error")throw new Error(Vr.value.map(Xr=>`${Xr.key}: ${Xr.message}`).join(", "));jr.features=jr.features.filter(Xr=>Vr.value.evaluate({zoom:0},Xr))}tr.dynamic?(jr.type==="Feature"&&(jr={type:"FeatureCollection",features:[jr]}),tr.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(jr.features,this.loaded),tr.cluster&&(jr.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=tr.cluster?new tu(function({superclusterOptions:Vr,clusterProperties:Xr}){if(!Xr||!Vr)return Vr;const Sn={},hn={},Wn={accumulated:null,zoom:0},os={properties:null},$n=Object.keys(Xr);for(const ks of $n){const[Is,As]=Xr[ks],Xs=c.U(As),na=c.U(typeof Is=="string"?[Is,["accumulated"],["get",ks]]:Is);Sn[ks]=Xs.value,hn[ks]=na.value}return Vr.map=ks=>{os.properties=ks;const Is={};for(const As of $n)Is[As]=Sn[As].evaluate(Wn,os);return Is},Vr.reduce=(ks,Is)=>{os.properties=Is;for(const As of $n)Wn.accumulated=ks[As],ks[As]=hn[As].evaluate(Wn,os)},Vr}(tr)).load(jr.features):tr.dynamic?this._dynamicIndex:function(Vr,Xr){return new gp(Vr,Xr)}(jr,tr.geojsonVtOptions)}catch(Vr){return ar(Vr)}const Zr={};if(Dr){const Vr=ct(yr);Vr&&(Zr.resourceTiming={},Zr.resourceTiming[tr.source]=JSON.parse(JSON.stringify(Vr)))}ar(null,Zr)}})}reloadTile(tr,ar){const yr=this.loaded;return yr&&yr[tr.uid]?tr.partial?ar(null,void 0):super.reloadTile(tr,ar):this.loadTile(tr,ar)}loadGeoJSON(tr,ar){if(tr.request)c.m(tr.request,ar);else{if(typeof tr.data!="string")return ar(new Error(`Input data given to '${tr.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ar(null,JSON.parse(tr.data))}catch{return ar(new Error(`Input data given to '${tr.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(tr,ar){try{ar(null,this._geoJSONIndex.getClusterExpansionZoom(tr.clusterId))}catch(yr){ar(yr)}}getClusterChildren(tr,ar){try{ar(null,this._geoJSONIndex.getChildren(tr.clusterId))}catch(yr){ar(yr)}}getClusterLeaves(tr,ar){try{ar(null,this._geoJSONIndex.getLeaves(tr.clusterId,tr.limit,tr.offset))}catch(yr){ar(yr)}}}class rv{constructor(tr,ar,yr){this.tileID=new c.aQ(tr.tileID.overscaledZ,tr.tileID.wrap,tr.tileID.canonical.z,tr.tileID.canonical.x,tr.tileID.canonical.y),this.tileZoom=tr.tileZoom,this.uid=tr.uid,this.zoom=tr.zoom,this.canonical=tr.tileID.canonical,this.pixelRatio=tr.pixelRatio,this.tileSize=tr.tileSize,this.source=tr.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=tr.projection,this.brightness=ar,this.worldview=yr}parse(tr,ar,yr,Dr){this.status="parsing";const kr=new c.aQ(yr.tileID.overscaledZ,yr.tileID.wrap,yr.tileID.canonical.z,yr.tileID.canonical.x,yr.tileID.canonical.y),jr=[],Zr=ar.familiesBySource[yr.source],Vr=new c.fn(kr,yr.promoteId);Vr.bucketLayerIDs=[],Vr.is3DTile=!0,c.fC(tr).then(Xr=>{if(!Xr)return Dr(new Error("Could not parse tile"));const Sn=Xr.json.extensionsUsed&&Xr.json.extensionsUsed.includes("MAPBOX_mesh_features")||Xr.json.asset.extras&&Xr.json.asset.extras.MAPBOX_mesh_features,hn=Xr.json.extensionsUsed&&Xr.json.extensionsUsed.includes("EXT_meshopt_compression"),Wn=new c.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const os in Zr)for(const $n of Zr[os]){const ks=$n[0];Vr.bucketLayerIDs.push($n.map(Xs=>c.B(Xs.id,Xs.scope))),ks.recalculate(Wn,[]);const Is=c.fD(Xr,1/c.d7(yr.tileID.canonical)),As=new c.fE($n,Is,kr,Sn,hn,this.brightness,Vr,this.worldview);Sn||(As.needsUpload=!0),jr.push(As),As.evaluate(ks)}this.status="done",Dr(null,{buckets:jr,featureIndex:Vr,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Xr=>Dr(new Error(Xr.message)))}}class qm{constructor(tr,ar,yr,Dr,kr,jr,Zr,Vr){this.actor=tr,this.layerIndex=ar,this.availableImages=yr,this.availableModels=Dr,this.brightness=Zr,this.loading={},this.loaded={},this.worldview=Vr}loadTile(tr,ar){const yr=tr.uid,Dr=this.loading[yr]=new rv(tr,this.brightness,this.worldview);c.bu(tr.request,(kr,jr)=>{const Zr=!this.loading[yr];return delete this.loading[yr],Zr||kr?(Dr.status="done",Zr||(this.loaded[yr]=Dr),ar(kr)):jr&&jr.byteLength!==0?void Dr.parse(jr,this.layerIndex,tr,(Vr,Xr)=>{Dr.status="done",this.loaded=this.loaded||{},this.loaded[yr]=Dr,Vr||!Xr?ar(Vr):ar(null,Xr)}):(Dr.status="done",this.loaded[yr]=Dr,ar())})}reloadTile(tr,ar){const yr=this.loaded,Dr=tr.uid;if(yr&&yr[Dr]){const kr=yr[Dr];kr.projection=tr.projection,kr.brightness=tr.brightness;const jr=(Zr,Vr)=>{kr.reloadCallback&&(delete kr.reloadCallback,this.loadTile(tr,ar)),ar(Zr,Vr)};kr.status==="parsing"?kr.reloadCallback=jr:kr.status==="done"&&this.loadTile(tr,ar)}}abortTile(tr,ar){const yr=tr.uid;this.loading[yr]&&delete this.loading[yr],ar()}removeTile(tr,ar){const yr=this.loaded,Dr=tr.uid;yr&&yr[Dr]&&delete yr[Dr],ar()}}class o_{constructor(tr){this.self=tr,this.actor=new c.fG(tr,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new c.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=c.cm({name:"mercator"}),this.workerSourceTypes={vector:ur,geojson:vu,"raster-dem":_r,"raster-array":ln,"batched-model":qm},this.workerSources={},this.self.registerWorkerSource=(ar,yr)=>{if(this.workerSourceTypes[ar])throw new Error(`Worker source with name "${ar}" already registered.`);this.workerSourceTypes[ar]=yr},this.self.registerRTLTextPlugin=ar=>{if(c.fH.isParsed())throw new Error("RTL text plugin already registered.");c.fH.setState({pluginStatus:c.fI.parsed,pluginURL:c.fH.getPluginURL()}),c.fH.applyArabicShaping=ar.applyArabicShaping,c.fH.processBidirectionalText=ar.processBidirectionalText,c.fH.processStyledBidirectionalText=ar.processStyledBidirectionalText;for(const yr of this.rtlPluginParsingListeners)yr(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(tr,ar,yr){delete this.layerIndexes[tr],delete this.availableImages[tr],delete this.availableModels[tr],delete this.workerSources[tr],yr()}checkIfReady(tr,ar,yr){yr()}setReferrer(tr,ar){this.referrer=ar}spriteLoaded(tr,ar){this.isSpriteLoaded[tr]||(this.isSpriteLoaded[tr]={});const{scope:yr,isLoaded:Dr}=ar;if(this.isSpriteLoaded[tr][yr]=Dr,this.workerSources[tr]&&this.workerSources[tr][yr])for(const kr in this.workerSources[tr][yr]){const jr=this.workerSources[tr][yr][kr];for(const Zr in jr){const Vr=jr[Zr];Vr instanceof ur&&(Vr.isSpriteLoaded=Dr,Vr.fire(new c.z("isSpriteLoaded")))}}}setImages(tr,ar,yr){this.availableImages[tr]||(this.availableImages[tr]={});const{scope:Dr,images:kr}=ar;if(this.availableImages[tr][Dr]=kr,this.workerSources[tr]&&this.workerSources[tr][Dr]){for(const jr in this.workerSources[tr][Dr]){const Zr=this.workerSources[tr][Dr][jr];for(const Vr in Zr)Zr[Vr].availableImages=kr}yr()}else yr()}setModels(tr,{scope:ar,models:yr},Dr){if(this.availableModels[tr]||(this.availableModels[tr]={}),this.availableModels[tr][ar]=yr,this.workerSources[tr]&&this.workerSources[tr][ar]){for(const kr in this.workerSources[tr][ar]){const jr=this.workerSources[tr][ar][kr];for(const Zr in jr)jr[Zr].availableModels=yr}Dr()}else Dr()}setProjection(tr,ar){this.projections[tr]=c.cm(ar)}setBrightness(tr,ar,yr){this.brightness=ar,yr()}setWorldview(tr,ar,yr){this.worldview=ar,yr()}setLayers(tr,ar,yr){this.getLayerIndex(tr,ar.scope).replace(ar.layers,ar.options),yr()}updateLayers(tr,ar,yr){this.getLayerIndex(tr,ar.scope).update(ar.layers,ar.removedIds,ar.options),yr()}loadTile(tr,ar,yr){ar.projection=this.projections[tr]||this.defaultProjection,this.getWorkerSource(tr,ar.type,ar.source,ar.scope).loadTile(ar,yr)}decodeRasterArray(tr,ar,yr){this.getWorkerSource(tr,ar.type,ar.source,ar.scope).decodeRasterArray(ar,yr)}reloadTile(tr,ar,yr){ar.projection=this.projections[tr]||this.defaultProjection,this.getWorkerSource(tr,ar.type,ar.source,ar.scope).reloadTile(ar,yr)}abortTile(tr,ar,yr){this.getWorkerSource(tr,ar.type,ar.source,ar.scope).abortTile(ar,yr)}removeTile(tr,ar,yr){this.getWorkerSource(tr,ar.type,ar.source,ar.scope).removeTile(ar,yr)}removeSource(tr,ar,yr){if(!(this.workerSources[tr]&&this.workerSources[tr][ar.scope]&&this.workerSources[tr][ar.scope][ar.type]&&this.workerSources[tr][ar.scope][ar.type][ar.source]))return;const Dr=this.workerSources[tr][ar.scope][ar.type][ar.source];delete this.workerSources[tr][ar.scope][ar.type][ar.source],Dr.removeSource!==void 0?Dr.removeSource(ar,yr):yr()}loadWorkerSource(tr,ar,yr){try{this.self.importScripts(ar.url),yr()}catch(Dr){yr(Dr)}}syncRTLPluginState(tr,ar,yr){if(c.fH.isParsed())yr(null,!0);else if(c.fH.isParsing())this.rtlPluginParsingListeners.push(yr);else try{c.fH.setState(ar);const Dr=c.fH.getPluginURL();!c.fH.isLoaded()||c.fH.isParsed()||c.fH.isParsing()||Dr==null||(c.fH.setState({pluginStatus:c.fI.parsing,pluginURL:c.fH.getPluginURL()}),this.self.importScripts(Dr),c.fH.isParsed()?yr(null,!0):this.rtlPluginParsingListeners.push(yr))}catch(Dr){yr(Dr)}}setDracoUrl(tr,ar){this.dracoUrl=ar}getAvailableImages(tr,ar){this.availableImages[tr]||(this.availableImages[tr]={});let yr=this.availableImages[tr][ar];return yr||(yr=[]),yr}getAvailableModels(tr,ar){this.availableModels[tr]||(this.availableModels[tr]={});let yr=this.availableModels[tr][ar];return yr||(yr={}),yr}getLayerIndex(tr,ar){this.layerIndexes[tr]||(this.layerIndexes[tr]={});let yr=this.layerIndexes[tr][ar];return yr||(yr=this.layerIndexes[tr][ar]=new St,yr.scope=ar),yr}getWorkerSource(tr,ar,yr,Dr){const kr=this.workerSources;return kr[tr]||(kr[tr]={}),kr[tr][Dr]||(kr[tr][Dr]={}),kr[tr][Dr][ar]||(kr[tr][Dr][ar]={}),this.isSpriteLoaded[tr]||(this.isSpriteLoaded[tr]={}),kr[tr][Dr][ar][yr]||(kr[tr][Dr][ar][yr]=new this.workerSourceTypes[ar]({send:(jr,Zr,Vr,Xr,Sn,hn)=>this.actor.send(jr,Zr,Vr,tr,Sn,hn),scheduler:this.actor.scheduler},this.getLayerIndex(tr,Dr),this.getAvailableImages(tr,Dr),this.getAvailableModels(tr,Dr),this.isSpriteLoaded[tr][Dr],void 0,this.brightness,this.worldview)),kr[tr][Dr][ar][yr]}rasterizeImagesWorker(tr,ar,yr){const Dr=new Map;for(const[kr,{image:jr,imageVariant:Zr}]of ar.tasks.entries()){const Vr=this.imageRasterizer.rasterize(Zr,jr,ar.scope,tr);Dr.set(kr,Vr)}yr(void 0,Dr)}removeRasterizedImages(tr,ar,yr){this.imageRasterizer.removeImagesFromCacheByIds(ar.imageIds,ar.scope,tr),yr()}enforceCacheSizeLimit(tr,ar){c.fJ(ar)}getWorkerPerformanceMetrics(tr,ar,yr){yr(void 0,void 0)}}return c.fF(self)&&(self.worker=new o_(self)),o_}),et(["./shared"],function(c){var ct="3.17.0";const pt={create:"create",load:"load",fullLoad:"fullLoad"},xt={mark(it){performance.mark(it)},measure(it,d,$){performance.measure(it,d,$)}};function St(it){const d=it.name.split("?")[0];return c.a(d)&&d.includes("mapbox-gl.js")?"javascript":c.a(d)&&d.includes("mapbox-gl.css")?"css":c.b(d)?"fontRange":c.c(d)?"sprite":c.i(d)?"style":c.d(d)?"tilejson":"other"}var Et,Rt={},Nt=function(){if(Et)return Rt;function it(st){return!d(st)}function d(st){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var ht,dt,mt=new Blob([""],{type:"text/javascript"}),Tt=URL.createObjectURL(mt);try{dt=new Worker(Tt),ht=!0}catch{ht=!1}return dt&&dt.terminate(),URL.revokeObjectURL(Tt),ht}()?function(){var ht=document.createElement("canvas");ht.width=ht.height=1;var dt=ht.getContext("2d");if(!dt)return!1;var mt=dt.getImageData(0,0,1,1);return mt&&mt.width===ht.width}()?($[lt=st&&st.failIfMajorPerformanceCaveat]===void 0&&($[lt]=function(ht){var dt,mt=function(Tt){var Pt=document.createElement("canvas"),Mt=Object.create(it.webGLContextAttributes);return Mt.failIfMajorPerformanceCaveat=Tt,Pt.getContext("webgl2",Mt)}(ht);if(!mt)return!1;try{dt=mt.createShader(mt.VERTEX_SHADER)}catch{return!1}return!(!dt||mt.isContextLost())&&(mt.shaderSource(dt,"void main() {}"),mt.compileShader(dt),mt.getShaderParameter(dt,mt.COMPILE_STATUS)===!0)}(lt)),$[lt]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var lt}Et=1,Rt.supported=it,Rt.notSupportedReason=d;var $={};return it.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Rt}();function It(it,d,$){const st=document.createElement(it);return d!=null&&(st.className=d),$&&$.appendChild(st),st}function Gt(it,d,$){const st=document.createElementNS("http://www.w3.org/2000/svg",it);for(const lt of Object.keys(d))st.setAttributeNS(null,lt,String(d[lt]));return $&&$.appendChild(st),st}const Dt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Bt=Dt&&Dt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Lt;function Vt(){Dt&&Bt&&(Lt=Dt[Bt],Dt[Bt]="none")}function Zt(){Dt&&Bt&&(Dt[Bt]=Lt)}function nr(it){it.preventDefault(),it.stopPropagation(),window.removeEventListener("click",nr,!0)}function ur(){window.addEventListener("click",nr,!0),window.setTimeout(()=>{window.removeEventListener("click",nr,!0)},0)}function _r(it,d){const $=it.getBoundingClientRect();return an(it,$,d)}function Ur(it,d){const $=it.getBoundingClientRect(),st=[];for(let lt=0;lt<d.length;lt++)st.push(an(it,$,d[lt]));return st}function ln(it){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&it.button===2&&it.ctrlKey?0:it.button}function an(it,d,$){const st=it.offsetWidth===d.width?1:it.offsetWidth/d.width;return new c.P(($.clientX-d.left)*st,($.clientY-d.top)*st)}const Fr="01",rn="NO_ACCESS_TOKEN";class gn{constructor(d,$,st){this._transformRequestFn=d,this._customAccessToken=$,this._silenceAuthErrors=!!st,this._createSkuToken()}_createSkuToken(){const d=function(){let $="";for(let st=0;st<10;st++)$+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Fr,$].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=d.token,this._skuTokenExpiresAt=d.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(d,$){return this._transformRequestFn&&this._transformRequestFn(d,$)||{url:d}}normalizeStyleURL(d,$){if(!c.h(d))return d;const st=xr(d);return st.params.push(`sdk=js-${ct}`),st.path=`/styles/v1${st.path}`,this._makeAPIURL(st,this._customAccessToken||$)}normalizeGlyphsURL(d,$){if(!c.h(d))return d;const st=xr(d);return st.path=`/fonts/v1${st.path}`,this._makeAPIURL(st,this._customAccessToken||$)}normalizeModelURL(d,$){if(!c.h(d))return d;const st=xr(d);return st.path=`/models/v1${st.path}`,this._makeAPIURL(st,this._customAccessToken||$)}normalizeSourceURL(d,$,st,lt){if(!c.h(d))return d;const ht=xr(d);return ht.path=`/v4/${ht.authority}.json`,ht.params.push("secure"),st&&ht.params.push(`language=${st}`),lt&&ht.params.push(`worldview=${lt}`),this._makeAPIURL(ht,this._customAccessToken||$)}normalizeIconsetURL(d,$){const st=xr(d);return c.h(d)?(st.path=`/styles/v1${st.path}/iconset.pbf`,this._makeAPIURL(st,this._customAccessToken||$)):gr(st)}normalizeSpriteURL(d,$,st,lt){const ht=xr(d);return c.h(d)?(ht.path=`/styles/v1${ht.path}/sprite${$}${st}`,this._makeAPIURL(ht,this._customAccessToken||lt)):(ht.path+=`${$}${st}`,gr(ht))}normalizeTileURL(d,$,st){if(this._isSkuTokenExpired()&&this._createSkuToken(),d&&!c.h(d))return d;const lt=xr(d);lt.path=lt.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${$||st&&lt.authority!=="raster"&&st===512?"@2x":""}${c.k.supported?".webp":"$1"}`),lt.authority==="raster"?lt.path=`/${c.e.RASTER_URL_PREFIX}${lt.path}`:lt.authority==="rasterarrays"?lt.path=`/${c.e.RASTERARRAYS_URL_PREFIX}${lt.path}`:lt.authority==="3dtiles"?lt.path=`/${c.e.TILES3D_URL_PREFIX}${lt.path}`:(lt.path=lt.path.replace(/^.+\/v4\//,"/"),lt.path=`/${c.e.TILE_URL_VERSION}${lt.path}`);const ht=this._customAccessToken||function(dt){for(const mt of dt){const Tt=mt.match(/^access_token=(.*)$/);if(Tt)return Tt[1]}return null}(lt.params)||c.e.ACCESS_TOKEN;return c.e.REQUIRE_ACCESS_TOKEN&&ht&&this._skuToken&&lt.params.push(`sku=${this._skuToken}`),this._makeAPIURL(lt,ht)}canonicalizeTileURL(d,$){const st=xr(d);if(!st.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!st.path.match(/\.[\w]+$/))return d;let lt="mapbox://";st.path.match(/^\/raster\/v1\//)?lt+=`raster/${st.path.replace(`/${c.e.RASTER_URL_PREFIX}/`,"")}`:st.path.match(/^\/rasterarrays\/v1\//)?lt+=`rasterarrays/${st.path.replace(`/${c.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:lt+=`tiles/${st.path.replace(`/${c.e.TILE_URL_VERSION}/`,"")}`;let ht=st.params;return $&&(ht=ht.filter(dt=>!dt.match(/^access_token=/))),ht.length&&(lt+=`?${ht.join("&")}`),lt}canonicalizeTileset(d,$){const st=!!$&&c.h($),lt=[];for(const ht of d.tiles||[])c.j(ht)?lt.push(this.canonicalizeTileURL(ht,st)):lt.push(ht);return lt}_makeAPIURL(d,$){const st="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",lt=xr(c.e.API_URL);if(d.protocol=lt.protocol,d.authority=lt.authority,d.protocol==="http"){const ht=d.params.indexOf("secure");ht>=0&&d.params.splice(ht,1)}if(lt.path!=="/"&&(d.path=`${lt.path}${d.path}`),!c.e.REQUIRE_ACCESS_TOKEN)return gr(d);if($=$||c.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!$)throw new Error(`An API access token is required to use Mapbox GL. ${st}`);if($[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${st}`)}return d.params=d.params.filter(ht=>ht.indexOf("access_token")===-1),d.params.push(`access_token=${$||""}`),gr(d)}}const _i=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function xr(it){const d=it.match(_i);if(!d)throw new Error("Unable to parse URL object");return{protocol:d[1],authority:d[2],path:d[3]||"/",params:d[4]?d[4].split("&"):[]}}function gr(it){const d=it.params.length?`?${it.params.join("&")}`:"";return`${it.protocol}://${it.authority}${it.path}${d}`}const rr="mapbox.eventData";function cr(it){if(!it)return null;const d=it.split(".");if(!d||d.length!==3)return null;try{return JSON.parse(c.l(d[1]))}catch{return null}}class Hr{constructor(d){this.type=d,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(d){const $=cr(c.e.ACCESS_TOKEN);let st="";return st=$&&$.u?c.f($.u):c.e.ACCESS_TOKEN||"",d?`${rr}.${d}:${st}`:`${rr}:${st}`}fetchEventData(){const d=c.s("localStorage"),$=this.getStorageKey(),st=this.getStorageKey("uuid"),lt=this.getStorageKey("uuidTimestamp");if(d)try{const ht=localStorage.getItem($);ht&&(this.eventData=JSON.parse(ht));const dt=localStorage.getItem(st);dt&&(this.anonId=dt);const mt=localStorage.getItem(lt);mt&&(this.anonIdTimestamp=Number(mt));const Tt=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<Tt)&&this.refreshUUID()}catch{c.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=c.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const d=c.s("localStorage"),$=this.getStorageKey(),st=this.getStorageKey("uuid"),lt=this.getStorageKey("uuidTimestamp"),ht=this.anonId,dt=this.anonIdTimestamp;if(d&&ht)try{localStorage.setItem(st,ht),Object.keys(this.eventData).length>=1&&localStorage.setItem($,JSON.stringify(this.eventData)),dt&&localStorage.setItem(lt,dt.toString())}catch{c.w("Unable to write to LocalStorage")}}processRequests(d){}postEvent(d,$,st,lt){if(!c.e.EVENTS_URL)return;const ht=xr(c.e.EVENTS_URL);ht.params.push(`access_token=${lt||c.e.ACCESS_TOKEN||""}`);const dt={event:this.type,created:new Date(d).toISOString()},mt=$?Object.assign(dt,$):dt,Tt={url:gr(ht),headers:{"Content-Type":"text/plain"},body:JSON.stringify([mt])};this.pendingRequest=c.p(Tt,Pt=>{this.pendingRequest=null,st(Pt),this.saveEventData(),this.processRequests(lt)})}queueRequest(d,$){this.queue.push(d),this.processRequests($)}}class $r extends Hr{constructor(d){super("metrics"),d&&(this.data=d)}postMetricsEvent(d){if(!c.e.EVENTS_URL||!d&&!c.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),c.v(this.anonId)||this.refreshUUID();const $=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:$},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:$,payload:st}=this.queue.shift();this.postEvent($,st,()=>{},d)}}const _n=new class extends Hr{constructor(it){super("appUserTurnstile"),this._customAccessToken=it}postTurnstileEvent(it,d){c.e.EVENTS_URL&&c.e.ACCESS_TOKEN&&Array.isArray(it)&&it.some($=>c.h($)||c.j($))&&this.queueRequest(Date.now(),d)}processRequests(it){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const d=cr(c.e.ACCESS_TOKEN),$=d?d.u:c.e.ACCESS_TOKEN;let st=$!==this.eventData.tokenU;c.v(this.anonId)||(this.refreshUUID(),st=!0);const lt=this.queue.shift();if(this.eventData.lastSuccess){const ht=new Date(this.eventData.lastSuccess),dt=new Date(lt),mt=(lt-this.eventData.lastSuccess)/864e5;st=st||mt>=1||mt<-1||ht.getDate()!==dt.getDate()}else st=!0;st?this.postEvent(lt,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ct,skuId:Fr,"enabled.telemetry":!1,userId:this.anonId},ht=>{ht||(this.eventData.lastSuccess=lt,this.eventData.tokenU=$)},it):this.processRequests()}},fn=_n.postTurnstileEvent.bind(_n),jn=new class extends Hr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(it,d,$,st){this.skuToken=d,this.errorCb=st,c.e.EVENTS_URL&&($||c.e.ACCESS_TOKEN?this.queueRequest({id:it,timestamp:Date.now()},$):this.errorCb(new Error(rn)))}processRequests(it){if(this.pendingRequest||this.queue.length===0)return;const{id:d,timestamp:$}=this.queue.shift();d&&this.success[d]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),c.v(this.anonId)||this.refreshUUID(),this.postEvent($,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ct,skuId:Fr,skuToken:this.skuToken,userId:this.anonId},st=>{st?this.errorCb(st):d&&(this.success[d]=!0)},it))}remove(){this.errorCb=null}},vs=jn.postMapLoadEvent.bind(jn),Cs=new class extends Hr{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(it){let d=this.mapInstanceIdMap.get(it);return d||(d=c.u(),this.mapInstanceIdMap.set(it,d)),d}getEventId(it){const d=this.eventIdPerMapInstanceMap.get(it)||0;return this.eventIdPerMapInstanceMap.set(it,d+1),d}postStyleLoadEvent(it,d){const{map:$,style:st,importedStyles:lt}=d;if(!c.e.EVENTS_URL||!it&&!c.e.ACCESS_TOKEN)return;const ht=this.getMapInstanceId($),dt={mapInstanceId:ht,eventId:this.getEventId(ht),style:st};lt.length&&(dt.importedStyles=lt),this.queueRequest({timestamp:Date.now(),payload:dt},it)}processRequests(it){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:d,payload:$}=this.queue.shift();this.postEvent(d,$,()=>{},it)}},ns=Cs.postStyleLoadEvent.bind(Cs),Nn=new $r({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),ls=Nn.postMetricsEvent.bind(Nn),ms=new $r({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),Ss=ms.postMetricsEvent.bind(ms),Ks=new class extends Hr{constructor(){super("gljs.performance")}postPerformanceEvent(it,d){c.e.EVENTS_URL&&(it||c.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:d},it)}processRequests(it){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:d,performanceData:$}=this.queue.shift(),st=function(lt){const ht=performance.getEntriesByType("resource"),dt=performance.getEntriesByType("mark"),mt=function(qt){const Qt={};if(qt){for(const Xt in qt)if(Xt!=="other")for(const sr of qt[Xt]){const ir=`${Xt}ResolveRangeMin`,hr=`${Xt}ResolveRangeMax`,mr=`${Xt}RequestCount`,dr=`${Xt}RequestCachedCount`;Qt[ir]=Math.min(Qt[ir]||1/0,sr.startTime),Qt[hr]=Math.max(Qt[hr]||-1/0,sr.responseEnd);const Ir=Tr=>{Qt[Tr]===void 0&&(Qt[Tr]=0),++Qt[Tr]};sr.transferSize!==void 0&&sr.transferSize===0&&Ir(dr),Ir(mr)}}return Qt}(function(qt,Qt){const Xt={};if(qt)for(const sr of qt){const ir=Qt(sr);Xt[ir]===void 0&&(Xt[ir]=[]),Xt[ir].push(sr)}return Xt}(ht,St)),Tt=window.devicePixelRatio,Pt=navigator.connection||navigator.mozConnection||navigator.webkitConnection,Mt=Pt?Pt.effectiveType:void 0,Ht={counters:[],metadata:[],attributes:[]},$t=(qt,Qt,Xt)=>{Xt!=null&&qt.push({name:Qt,value:Xt.toString()})};for(const qt in mt)$t(Ht.counters,qt,mt[qt]);if(lt.interactionRange[0]!==1/0&&lt.interactionRange[1]!==-1/0&&($t(Ht.counters,"interactionRangeMin",lt.interactionRange[0]),$t(Ht.counters,"interactionRangeMax",lt.interactionRange[1])),dt)for(const qt of Object.values(pt)){const Qt=dt.find(Xt=>Xt.name===qt);Qt&&$t(Ht.counters,qt,Qt.startTime)}return $t(Ht.counters,"visibilityHidden",lt.visibilityHidden),$t(Ht.attributes,"style",function(qt){if(qt)for(const Qt of qt){const Xt=Qt.name.split("?")[0];if(c.i(Xt)){const sr=Xt.split("/").slice(-2);if(sr.length===2)return`mapbox://styles/${sr[0]}/${sr[1]}`}}}(ht)),$t(Ht.attributes,"terrainEnabled",lt.terrainEnabled?"true":"false"),$t(Ht.attributes,"fogEnabled",lt.fogEnabled?"true":"false"),$t(Ht.attributes,"projection",lt.projection),$t(Ht.attributes,"zoom",lt.zoom),$t(Ht.metadata,"devicePixelRatio",Tt),$t(Ht.metadata,"connectionEffectiveType",Mt),$t(Ht.metadata,"navigatorUserAgent",navigator.userAgent),$t(Ht.metadata,"screenWidth",window.screen.width),$t(Ht.metadata,"screenHeight",window.screen.height),$t(Ht.metadata,"windowWidth",window.innerWidth),$t(Ht.metadata,"windowHeight",window.innerHeight),$t(Ht.metadata,"mapWidth",lt.width/Tt),$t(Ht.metadata,"mapHeight",lt.height/Tt),$t(Ht.metadata,"webglRenderer",lt.renderer),$t(Ht.metadata,"webglVendor",lt.vendor),$t(Ht.metadata,"sdkVersion",ct),$t(Ht.metadata,"sdkIdentifier","mapbox-gl-js"),Ht}($);for(const lt of st.metadata);for(const lt of st.counters);for(const lt of st.attributes);this.postEvent(d,st,()=>{},it)}},ws=Ks.postPerformanceEvent.bind(Ks),ps=new class extends Hr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(it,d,$,st){if(!c.e.API_URL||!c.e.SESSION_PATH)return;const lt=xr(c.e.API_URL+c.e.SESSION_PATH);lt.params.push(`sku=${d||""}`),lt.params.push(`access_token=${st||c.e.ACCESS_TOKEN||""}`);const ht={url:gr(lt),headers:{"Content-Type":"text/plain"}};this.pendingRequest=c.g(ht,dt=>{this.pendingRequest=null,$(dt),this.saveEventData(),this.processRequests(st)})}getSessionAPI(it,d,$,st){this.skuToken=d,this.errorCb=st,c.e.SESSION_PATH&&c.e.API_URL&&($||c.e.ACCESS_TOKEN?this.queueRequest({id:it,timestamp:Date.now()},$):this.errorCb(new Error(rn)))}processRequests(it){if(this.pendingRequest||this.queue.length===0)return;const{id:d,timestamp:$}=this.queue.shift();d&&this.success[d]||this.getSession($,this.skuToken,st=>{st?this.errorCb(st):d&&(this.success[d]=!0)},it)}remove(){this.errorCb=null}},Rl=ps.getSessionAPI.bind(ps),Qo=new Set;function Vo(it,d){d?Qo.add(it):Qo.delete(it)}class wo{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(d,$){this._updatedSourceCaches[d]=$,this.setDirty()}discardSourceCacheUpdate(d){delete this._updatedSourceCaches[d]}updateLayer(d){const $=d.scope;this._updatedLayers[$]=this._updatedLayers[$]||new Set,this._updatedLayers[$].add(d.id),this.setDirty()}removeLayer(d){const $=d.scope;this._removedLayers[$]=this._removedLayers[$]||{},this._updatedLayers[$]=this._updatedLayers[$]||new Set,this._removedLayers[$][d.id]=d,this._updatedLayers[$].delete(d.id),this._updatedPaintProps.delete(d.fqid),this.setDirty()}getRemovedLayer(d){return this._removedLayers[d.scope]?this._removedLayers[d.scope][d.id]:null}discardLayerRemoval(d){this._removedLayers[d.scope]&&delete this._removedLayers[d.scope][d.id]}getLayerUpdatesByScope(){const d={};for(const $ in this._updatedLayers)d[$]=d[$]||{},d[$].updatedIds=Array.from(this._updatedLayers[$].values());for(const $ in this._removedLayers)d[$]=d[$]||{},d[$].removedIds=Object.keys(this._removedLayers[$]);return d}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(d){this._updatedPaintProps.add(d.fqid),this.setDirty()}getUpdatedImages(d){return this._updatedImages[d]?Array.from(this._updatedImages[d].values()):[]}updateImage(d,$){this._updatedImages[$]=this._updatedImages[$]||new Set,this._updatedImages[$].add(c.I.toString(d)),this.setDirty()}resetUpdatedImages(d){this._updatedImages[d]&&this._updatedImages[d].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function tu(it){const{userImage:d}=it;return!!(d&&d.render&&d.render())&&(it.data.replace(new Uint8Array(d.data.buffer)),!0)}class ou extends c.E{constructor(d){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=d,d!=="raster"&&c.r()&&(this.imageRasterizerDispatcher=new c.D(c.t(),this,"Image Rasterizer Worker",1))}addScope(d){this.loaded.set(d,!1),this.imageProviders.set(d,new Map),this.images.set(d,new Map),this.updatedImages.set(d,new Set),this.callbackDispatchedThisFrame.set(d,new Set),this.patterns.set(d,new Map),this.atlasImage.set(d,new c.q({width:1,height:1}))}removeScope(d){this.loaded.delete(d),this.imageProviders.delete(d),this.images.delete(d),this.updatedImages.delete(d),this.callbackDispatchedThisFrame.delete(d),this.patterns.delete(d),this.atlasImage.delete(d);const $=this.atlasTexture.get(d);$&&($.destroy(),this.atlasTexture.delete(d))}addImageProvider(d,$){this.imageProviders.has($)||this.imageProviders.set($,new Map),this.imageProviders.get($).set(d.id,d)}removeImageProvider(d,$){this.imageProviders.has($)&&this.imageProviders.get($).delete(d)}getPendingImageProviders(){const d=[];for(const $ of this.imageProviders.values())for(const st of $.values())st.hasPendingRequests()&&d.push(st);return d}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new c.x),this._imageRasterizer}isLoaded(){for(const d of this.loaded.keys())if(!this.loaded.get(d))return!1;return!0}setLoaded(d,$){if(this.loaded.get($)!==d&&(this.loaded.set($,d),d)){for(const{ids:st,callback:lt}of this.requestors)this._notify(st,$,lt);this.requestors=[]}}hasImage(d,$){return!!this.getImage(d,$)}getImage(d,$){return this.images.get($).get(d.toString())}addImage(d,$,st){this._validate(d,st)&&this.images.get($).set(d.toString(),st)}_validate(d,$){let st=!0;return this._validateStretch($.stretchX,$.data&&$.data.width)||(this.fire(new c.y(new Error(`Image "${d.name}" has invalid "stretchX" value`))),st=!1),this._validateStretch($.stretchY,$.data&&$.data.height)||(this.fire(new c.y(new Error(`Image "${d.name}" has invalid "stretchY" value`))),st=!1),this._validateContent($.content,$)||(this.fire(new c.y(new Error(`Image "${d.name}" has invalid "content" value`))),st=!1),st}_validateStretch(d,$){if(!d)return!0;let st=0;for(const lt of d){if(lt[0]<st||lt[1]<lt[0]||$<lt[1])return!1;st=lt[1]}return!0}_validateContent(d,$){return d?d.length!==4||!$.usvg&&(d[0]<0||$.data.width<d[0]||d[1]<0||$.data.height<d[1]||d[2]<0||$.data.width<d[2]||d[3]<0||$.data.height<d[3])?!1:!(d[2]<d[0]||d[3]<d[1]):!0}updateImage(d,$,st){const lt=this.images.get($).get(d.toString());st.version=lt.version+1,this.images.get($).set(d.toString(),st),this.updatedImages.get($).add(d),this.removeFromImageRasterizerCache(d,$)}clearUpdatedImages(d){this.updatedImages.get(d).clear()}removeFromImageRasterizerCache(d,$){this.spriteFormat!=="raster"&&(c.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[d],scope:$}):this.imageRasterizer.removeImagesFromCacheByIds([d],$))}removeImage(d,$){const st=this.images.get($),lt=st.get(d.toString());st.delete(d.toString()),this.patterns.get($).delete(d.toString()),this.removeFromImageRasterizerCache(d,$),lt.userImage&&lt.userImage.onRemove&&lt.userImage.onRemove()}listImages(d){return Array.from(this.images.get(d).keys()).map($=>c.I.from($))}getImages(d,$,st){const lt=[],ht=[],dt=this.imageProviders.get($);for(const Mt of d){if(!Mt.iconsetId){lt.push(Mt);continue}const Ht=dt.get(Mt.iconsetId);Ht&&(this.getImage(Mt,$)?ht.push(Mt):Ht.addPendingRequest(Mt))}if(lt.length===0)return void this._notify(ht,$,st);let mt=!0;const Tt=!!this.loaded.get($),Pt=this.images.get($);if(!Tt)for(const Mt of lt)Pt.has(Mt.toString())||(mt=!1);Tt||mt?this._notify(lt,$,st):this.requestors.push({ids:lt,scope:$,callback:st})}rasterizeImages(d,$){const st=new Map,{tasks:lt,scope:ht}=d;for(const[dt,mt]of lt.entries()){const Tt=this.getImage(mt.id,ht);Tt&&st.set(dt,{image:Tt,imageVariant:mt})}this._rasterizeImages(ht,st,$)}_rasterizeImages(d,$,st){if(c.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:$,scope:d},st);else{const lt=new Map;for(const[ht,{image:dt,imageVariant:mt}]of $.entries())lt.set(ht,this.imageRasterizer.rasterize(mt,dt,d,0));st(void 0,lt)}}getUpdatedImages(d){return this.updatedImages.get(d)||new Set}_notify(d,$,st){const lt=this.images.get($),ht=new Map;for(const dt of d){if(!lt.get(dt.toString())){if(dt.iconsetId)continue;this.fire(new c.z("styleimagemissing",{id:dt.name}))}const mt=lt.get(dt.toString());if(!mt){c.w(`Image "${dt.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const Tt={data:mt.usvg?null:mt.data.clone(),pixelRatio:mt.pixelRatio,sdf:mt.sdf,usvg:mt.usvg,version:mt.version,stretchX:mt.stretchX,stretchY:mt.stretchY,content:mt.content,hasRenderCallback:!!(mt.userImage&&mt.userImage.render)};mt.usvg&&Object.assign(Tt,{width:mt.icon.usvg_tree.width,height:mt.icon.usvg_tree.height}),ht.set(c.I.toString(dt),Tt)}st(null,ht)}getPixelSize(d){const{width:$,height:st}=this.atlasImage.get(d);return{width:$,height:st}}getPattern(d,$,st){const lt=d.toString(),ht=this.patterns.get($),dt=ht.get(lt),mt=this.getImage(d,$);if(!mt)return null;if(dt){if(dt.position.version===mt.version)return dt.position;dt.position.version=mt.version}else{if(mt.usvg&&!mt.data){const Tt=this.getPatternInFlightId(lt,$);if(this.patternsInFlight.has(Tt))return null;this.patternsInFlight.add(Tt);const Pt=new c.A(d).scaleSelf(c.o.devicePixelRatio),Mt=new Map([[Pt.toString(),{image:mt,imageVariant:Pt}]]);return this._rasterizeImages($,Mt,(Ht,$t)=>this.storePatternImage(Pt,$,mt,st,$t)),null}this.storePattern(d,$,mt)}return this._updatePatternAtlas($,st),ht.get(lt).position}getPatternInFlightId(d,$){return c.B(d,$)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(d,$,st,lt,ht){const dt=d.toString(),mt=ht?ht.get(dt):void 0;mt&&(st.data=mt,this.storePattern(d.id,$,st),this._updatePatternAtlas($,lt),this.patternsInFlight.delete(this.getPatternInFlightId(d.id.toString(),$)))}storePattern(d,$,st){const lt={w:st.data.width+2*c.C,h:st.data.height+2*c.C,x:0,y:0},ht=new c.F(lt,st,c.C);this.patterns.get($).set(d.toString(),{bin:lt,position:ht})}destroyAtlasTextures(){for(const d of this.atlasTexture.values())d&&d.destroy();this.atlasTexture.clear()}bind(d,$){const st=d.gl;let lt=this.atlasTexture.get($);lt?this.dirty&&(lt.update(this.atlasImage.get($)),this.dirty=!1):(lt=new c.T(d,this.atlasImage.get($),st.RGBA8),this.atlasTexture.set($,lt)),lt.bind(st.LINEAR,st.CLAMP_TO_EDGE)}_updatePatternAtlas(d,$){const st=this.patterns.get(d),lt=Array.from(st.values()).map(({bin:Pt})=>Pt),{w:ht,h:dt}=c.G(lt),mt=this.atlasImage.get(d);mt.resize({width:ht||1,height:dt||1});const Tt=this.images.get(d);for(const[Pt,{bin:Mt,position:Ht}]of st.entries()){let $t=Ht.padding;const qt=Mt.x+$t,Qt=Mt.y+$t,Xt=Tt.get(Pt).data,sr=Xt.width,ir=Xt.height;$t=$t>1?$t-1:$t,c.q.copy(Xt,mt,{x:0,y:0},{x:qt,y:Qt},{width:sr,height:ir},$),c.q.copy(Xt,mt,{x:0,y:ir-$t},{x:qt,y:Qt-$t},{width:sr,height:$t},$),c.q.copy(Xt,mt,{x:0,y:0},{x:qt,y:Qt+ir},{width:sr,height:$t},$),c.q.copy(Xt,mt,{x:sr-$t,y:0},{x:qt-$t,y:Qt},{width:$t,height:ir},$),c.q.copy(Xt,mt,{x:0,y:0},{x:qt+sr,y:Qt},{width:$t,height:ir},$),c.q.copy(Xt,mt,{x:sr-$t,y:ir-$t},{x:qt-$t,y:Qt-$t},{width:$t,height:$t},$),c.q.copy(Xt,mt,{x:0,y:ir-$t},{x:qt+sr,y:Qt-$t},{width:$t,height:$t},$),c.q.copy(Xt,mt,{x:0,y:0},{x:qt+sr,y:Qt+ir},{width:$t,height:$t},$),c.q.copy(Xt,mt,{x:sr-$t,y:0},{x:qt-$t,y:Qt+ir},{width:$t,height:$t},$)}this.dirty=!0}beginFrame(){for(const d of this.images.keys())this.callbackDispatchedThisFrame.set(d,new Set)}dispatchRenderCallbacks(d,$){const st=this.images.get($);for(const lt of d){if(this.callbackDispatchedThisFrame.get($).has(lt.toString()))continue;this.callbackDispatchedThisFrame.get($).add(lt.toString());const ht=st.get(lt.toString());tu(ht)&&this.updateImage(lt,$,ht)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Sl(it){const d=it.value,$=it.valueSpec,st=it.style,lt=it.styleSpec,ht=it.key,dt=it.arrayElementValidator||To;if(!Array.isArray(d))return[new c.V(ht,d,`array expected, ${c.K(d)} found`)];if($.length&&d.length!==$.length)return[new c.V(ht,d,`array length ${$.length} expected, length ${d.length} found`)];if($["min-length"]&&d.length<$["min-length"])return[new c.V(ht,d,`array length at least ${$["min-length"]} expected, length ${d.length} found`)];let mt={type:$.value,values:$.values,minimum:$.minimum,maximum:$.maximum,function:void 0};lt.$version<7&&(mt.function=$.function),c.H($.value)&&(mt=$.value);let Tt=[];for(let Pt=0;Pt<d.length;Pt++)Tt=Tt.concat(dt({array:d,arrayIndex:Pt,value:d[Pt],valueSpec:mt,style:st,styleSpec:lt,key:`${ht}[${Pt}]`},!0));return Tt}function ru(it){const d=it.key,$=it.value,st=it.valueSpec;if(!c.L($))return[new c.V(d,$,`number expected, ${c.K($)} found`)];if($!=$)return[new c.V(d,$,"number expected, NaN found")];if("minimum"in st){let lt=st.minimum;if(Array.isArray(st.minimum)&&(lt=st.minimum[it.arrayIndex]),$<lt)return[new c.V(d,$,`${$} is less than the minimum value ${lt}`)]}if("maximum"in st){let lt=st.maximum;if(Array.isArray(st.maximum)&&(lt=st.maximum[it.arrayIndex]),$>lt)return[new c.V(d,$,`${$} is greater than the maximum value ${lt}`)]}return[]}function Ll(it){const d=it.key,$=it.value;if(!c.H($))return[new c.V(d,$,`object expected, ${c.K($)} found`)];const st=it.valueSpec,lt=c.J($.type);let ht,dt,mt,Tt={};const Pt=lt!=="categorical"&&$.property===void 0,Mt=!Pt,Ht=function(Xt){const sr=Xt.stops;return Array.isArray(sr)&&Array.isArray(sr[0])&&c.H(sr[0][0])}($),$t=Kl({key:it.key,value:it.value,valueSpec:it.styleSpec.function,style:it.style,styleSpec:it.styleSpec,objectElementValidators:{stops:function(Xt){if(lt==="identity")return[new c.V(Xt.key,Xt.value,'identity function may not have a "stops" property')];let sr=[];const ir=Xt.value;return sr=sr.concat(Sl({key:Xt.key,value:ir,valueSpec:Xt.valueSpec,style:Xt.style,styleSpec:Xt.styleSpec,arrayElementValidator:qt})),Array.isArray(ir)&&ir.length===0&&sr.push(new c.V(Xt.key,ir,"array must have at least one stop")),sr},default:function(Xt){return To({key:Xt.key,value:Xt.value,valueSpec:st,style:Xt.style,styleSpec:Xt.styleSpec})}}});return lt==="identity"&&Pt&&$t.push(new c.V(it.key,it.value,'missing required property "property"')),lt==="identity"||$.stops||$t.push(new c.V(it.key,it.value,'missing required property "stops"')),lt==="exponential"&&st.expression&&!c.M(st)&&$t.push(new c.V(it.key,it.value,"exponential functions not supported")),it.styleSpec.$version>=8&&(Mt&&!c.N(st)?$t.push(new c.V(it.key,it.value,"property functions not supported")):Pt&&!c.O(st)&&$t.push(new c.V(it.key,it.value,"zoom functions not supported"))),lt!=="categorical"&&!Ht||$.property!==void 0||$t.push(new c.V(it.key,it.value,'"property" property is required')),$t;function qt(Xt){let sr=[];const ir=Xt.value,hr=Xt.key;if(!Array.isArray(ir))return[new c.V(hr,ir,`array expected, ${c.K(ir)} found`)];if(ir.length!==2)return[new c.V(hr,ir,`array length 2 expected, length ${ir.length} found`)];if(Ht){if(!c.H(ir[0]))return[new c.V(hr,ir,`object expected, ${c.K(ir[0])} found`)];const mr=ir[0];if(mr.zoom===void 0)return[new c.V(hr,ir,"object stop key must have zoom")];if(mr.value===void 0)return[new c.V(hr,ir,"object stop key must have value")];const dr=c.J(mr.zoom);if(typeof dr!="number")return[new c.V(hr,mr.zoom,"stop zoom values must be numbers")];if(mt&&mt>dr)return[new c.V(hr,mr.zoom,"stop zoom values must appear in ascending order")];dr!==mt&&(mt=dr,dt=void 0,Tt={}),sr=sr.concat(Kl({key:`${hr}[0]`,value:ir[0],valueSpec:{zoom:{}},style:Xt.style,styleSpec:Xt.styleSpec,objectElementValidators:{zoom:ru,value:Qt}}))}else sr=sr.concat(Qt({key:`${hr}[0]`,value:ir[0],style:Xt.style,styleSpec:Xt.styleSpec},ir));return c.Q(c.S(ir[1]))?sr.concat([new c.V(`${hr}[1]`,ir[1],"expressions are not allowed in function stops.")]):sr.concat(To({key:`${hr}[1]`,value:ir[1],valueSpec:st,style:Xt.style,styleSpec:Xt.styleSpec}))}function Qt(Xt,sr){const ir=c.K(Xt.value),hr=c.J(Xt.value),mr=Xt.value!==null?Xt.value:sr;if(ht){if(ir!==ht)return[new c.V(Xt.key,mr,`${ir} stop domain type must match previous stop domain type ${ht}`)]}else ht=ir;if(ir!=="number"&&ir!=="string"&&ir!=="boolean"&&typeof hr!="number"&&typeof hr!="string"&&typeof hr!="boolean")return[new c.V(Xt.key,mr,"stop domain value must be a number, string, or boolean")];if(ir!=="number"&&lt!=="categorical"){let dr=`number expected, ${ir} found`;return c.N(st)&&lt===void 0&&(dr+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new c.V(Xt.key,mr,dr)]}return lt!=="categorical"||ir!=="number"||typeof hr=="number"&&isFinite(hr)&&Math.floor(hr)===hr?lt!=="categorical"&&ir==="number"&&typeof hr=="number"&&typeof dt=="number"&&dt!==void 0&&hr<dt?[new c.V(Xt.key,mr,"stop domain values must appear in ascending order")]:(dt=hr,lt==="categorical"&&hr in Tt?[new c.V(Xt.key,mr,"stop domain values must be unique")]:(Tt[hr]=!0,[])):[new c.V(Xt.key,mr,`integer expected, found ${String(hr)}`)]}}function Jo(it){const d=(it.expressionContext==="property"?c.W:c.U)(c.S(it.value),it.valueSpec);if(d.result==="error")return d.value.map(st=>new c.V(`${it.key}${st.key}`,it.value,st.message));const $=d.value.expression||d.value._styleExpression.expression;if(it.expressionContext==="property"&&it.propertyKey==="text-font"&&!$.outputDefined())return[new c.V(it.key,it.value,`Invalid data expression for "${it.propertyKey}". Output values must be contained as literals within the expression.`)];if(it.expressionContext==="property"&&it.propertyType==="layout"&&!c.Z($))return[new c.V(it.key,it.value,'"feature-state" data expressions are not supported with layout properties.')];if(it.expressionContext==="filter")return iu($,it);if(it.expressionContext==="appearance")return xa($,it);if(it.expressionContext&&it.expressionContext.indexOf("cluster")===0){if(!c.X($,["zoom","feature-state"]))return[new c.V(it.key,it.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(it.expressionContext==="cluster-initial"&&!c.Y($))return[new c.V(it.key,it.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function iu(it,d){const $=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(d.valueSpec&&d.valueSpec.expression)for(const lt of d.valueSpec.expression.parameters)$.delete(lt);if($.size===0)return[];const st=[];return it instanceof c._&&$.has(it.name)?[new c.V(d.key,d.value,`["${it.name}"] expression is not supported in a filter for a ${d.object.type} layer with id: ${d.object.id}`)]:(it.eachChild(lt=>{st.push(...iu(lt,d))}),st)}function xa(it,d){const $=new Set;if(d.valueSpec&&d.valueSpec.expression)for(const lt of d.valueSpec.expression.parameters)$.add(lt);if($.size===0)return[];const st=[];return it instanceof c._&&!$.has(it.name)?[new c.V(d.key,d.value,`["${it.name}"] is not an allowed parameter`)]:(it.eachChild(lt=>{st.push(...xa(lt,d))}),st)}function Il(it){const d=it.key,$=it.value,st=it.valueSpec,lt=[];return Array.isArray(st.values)?st.values.indexOf(c.J($))===-1&&lt.push(new c.V(d,$,`expected one of [${st.values.join(", ")}], ${JSON.stringify($)} found`)):Object.keys(st.values).indexOf(c.J($))===-1&&lt.push(new c.V(d,$,`expected one of [${Object.keys(st.values).join(", ")}], ${JSON.stringify($)} found`)),lt}function Eu(it){return c.a2(c.S(it.value))?Jo(Object.assign({},it,{expressionContext:"filter",valueSpec:it.styleSpec[`filter_${it.layerType||"fill"}`]})):$l(it)}function $l(it){const d=it.value,$=it.key;if(!Array.isArray(d))return[new c.V($,d,`array expected, ${c.K(d)} found`)];if(d.length<1)return[new c.V($,d,"filter array must have at least 1 element")];const st=it.styleSpec;let lt=Il({key:`${$}[0]`,value:d[0],valueSpec:st.filter_operator});const ht=()=>{d.length>=2&&(c.a0(d[1])||lt.push(new c.V(`${$}[1]`,d[1],`string expected, ${c.K(d[1])} found`)));for(let dt=2;dt<d.length;dt++)c.J(d[1])==="$type"?lt=lt.concat(Il({key:`${$}[${dt}]`,value:d[dt],valueSpec:st.geometry_type})):c.a0(d[dt])||c.L(d[dt])||c.$(d[dt])||lt.push(new c.V(`${$}[${dt}]`,d[dt],`string, number, or boolean expected, ${c.K(d[dt])} found.`))};switch(c.J(d[0])){case"<":case"<=":case">":case">=":d.length>=2&&c.J(d[1])==="$type"&&lt.push(new c.V($,d,`"$type" cannot be use with operator "${d[0]}"`)),d.length!==3&&lt.push(new c.V($,d,`filter array for operator "${d[0]}" must have 3 elements`)),ht();break;case"==":case"!=":d.length!==3&&lt.push(new c.V($,d,`filter array for operator "${d[0]}" must have 3 elements`)),ht();break;case"in":case"!in":ht();break;case"any":case"all":case"none":for(let dt=1;dt<d.length;dt++)lt=lt.concat($l({key:`${$}[${dt}]`,value:d[dt],style:it.style,styleSpec:it.styleSpec}));break;case"has":case"!has":d.length!==2?lt.push(new c.V($,d,`filter array for "${d[0]}" operator must have 2 elements`)):c.a0(d[1])||lt.push(new c.V(`${$}[1]`,d[1],`string expected, ${c.K(d[1])} found`))}return lt}function xu(it,d){const $=it.key,st=it.style,lt=it.layer,ht=it.styleSpec,dt=it.value,mt=it.objectKey,Tt=ht[`${d}_${it.layerType}`];if(!Tt)return[];const Pt=mt.match(/^(.*)-use-theme$/);if(Pt&&Tt[Pt[1]])return c.Q(c.S(dt))?[].concat(To({key:$,value:dt,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:st,styleSpec:ht,expressionContext:"property",propertyType:d,propertyKey:mt})):To({key:$,value:dt,valueSpec:{type:"string"},style:st,styleSpec:ht});const Mt=mt.match(/^(.*)-transition$/);if(d==="paint"&&Mt&&Tt[Mt[1]]&&Tt[Mt[1]].transition)return To({key:$,value:dt,valueSpec:ht.transition,style:st,styleSpec:ht});const Ht=it.valueSpec||Tt[mt];if(!Ht)return[new c.a3($,dt,`unknown property "${mt}"`)];let $t;if(c.a0(dt)&&c.N(Ht)&&!Ht.tokens&&($t=/^{([^}]+)}$/.exec(dt))){const Qt=`\`{ "type": "identity", "property": ${$t?JSON.stringify($t[1]):'"_"'} }\``;return[new c.V($,dt,`"${mt}" does not support interpolation syntax
Use an identity property function instead: ${Qt}.`)]}const qt=[];if(it.layerType==="symbol")mt!=="text-field"||!st||st.glyphs||st.imports||qt.push(new c.V($,dt,'use of "text-field" requires a style "glyphs" property')),mt==="text-font"&&c.a4(c.S(dt))&&c.J(dt.type)==="identity"&&qt.push(new c.V($,dt,'"text-font" does not support identity functions'));else if(it.layerType==="model"&&d==="paint"&&lt&&lt.layout&&lt.layout.hasOwnProperty("model-id")&&c.N(Ht)&&(c.a5(Ht)||c.O(Ht))){const Qt=c.W(c.S(dt),Ht).value,Xt="expression"in Qt&&Qt.expression||"_styleExpression"in Qt&&Qt._styleExpression&&Qt._styleExpression.expression;Xt&&!c.X(Xt,["measure-light"])&&(mt==="model-emissive-strength"&&c.Y(Xt)&&c.Z(Xt)||qt.push(new c.V($,dt,`${mt} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return qt.concat(To({key:it.key,value:dt,valueSpec:Ht,style:st,styleSpec:ht,expressionContext:"property",propertyType:d,propertyKey:mt}))}function Kp(it){return xu(it,"paint")}function Rp(it){return xu(it,"layout")}function Ip(it){let d=[];const $=it.value,st=it.key,lt=it.style,ht=it.styleSpec;if(!c.H($))return[new c.V(st,$,"object expected")];$.type||$.ref||d.push(new c.V(st,$,'either "type" or "ref" is required'));let dt=c.J($.type);const mt=c.J($.ref);if($.id){const Tt=c.J($.id);for(let Pt=0;Pt<it.arrayIndex;Pt++){const Mt=lt.layers[Pt];c.J(Mt.id)===Tt&&d.push(new c.V(st,$.id,`duplicate layer id "${Tt}", previously used at line ${Mt.id.__line__}`))}}if("ref"in $){let Tt;["type","source","source-layer","filter","layout"].forEach(Pt=>{Pt in $&&d.push(new c.V(st,$[Pt],`"${Pt}" is prohibited for ref layers`))}),lt.layers.forEach(Pt=>{c.J(Pt.id)===mt&&(Tt=Pt)}),Tt?Tt.ref?d.push(new c.V(st,$.ref,"ref cannot reference another ref layer")):dt=c.J(Tt.type):typeof mt=="string"&&d.push(new c.V(st,$.ref,`ref layer "${mt}" not found`))}else if(dt!=="background"&&dt!=="sky"&&dt!=="slot")if($.source)if(c.a0($.source)){const Tt=lt.sources&&lt.sources[$.source],Pt=Tt&&c.J(Tt.type);Tt?Pt==="vector"&&dt==="raster"?d.push(new c.V(st,$.source,`layer "${$.id}" requires a raster source`)):Pt==="raster"&&dt!=="raster"?d.push(new c.V(st,$.source,`layer "${$.id}" requires a vector source`)):Pt!=="vector"||$["source-layer"]?Pt==="raster-dem"&&dt!=="hillshade"?d.push(new c.V(st,$.source,"raster-dem source can only be used with layer type 'hillshade'.")):Pt!=="raster-array"||["raster","raster-particle"].includes(dt)?dt==="line"&&$.paint&&($.paint["line-gradient"]||$.paint["line-trim-offset"])&&Pt==="geojson"&&!Tt.lineMetrics?d.push(new c.V(st,$,`layer "${$.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):dt==="raster-particle"&&Pt!=="raster-array"&&d.push(new c.V(st,$.source,`layer "${$.id}" requires a 'raster-array' source.`)):d.push(new c.V(st,$.source,"raster-array source can only be used with layer type 'raster'.")):d.push(new c.V(st,$,`layer "${$.id}" must specify a "source-layer"`)):d.push(new c.V(st,$.source,`source "${$.source}" not found`))}else d.push(new c.V(`${st}.source`,$.source,'"source" must be a string'));else d.push(new c.V(st,$,'missing required property "source"'));return d=d.concat(Kl({key:st,value:$,valueSpec:ht.layer,style:it.style,styleSpec:it.styleSpec,objectElementValidators:{"*":()=>[],type:()=>To({key:`${st}.type`,value:$.type,valueSpec:ht.layer.type,style:it.style,styleSpec:it.styleSpec,object:$,objectKey:"type"}),filter:Tt=>Eu(Object.assign({layerType:dt},Tt)),layout:Tt=>Kl({layer:$,key:Tt.key,value:Tt.value,valueSpec:{},style:Tt.style,styleSpec:Tt.styleSpec,objectElementValidators:{"*":Pt=>Rp(Object.assign({layerType:dt},Pt))}}),paint:Tt=>Kl({layer:$,key:Tt.key,value:Tt.value,valueSpec:{},style:Tt.style,styleSpec:Tt.styleSpec,objectElementValidators:{"*":Pt=>Kp(Object.assign({layerType:dt,layer:$},Pt))}}),appearances(Tt){const Pt=Sl({key:Tt.key,value:Tt.value,valueSpec:Tt.valueSpec,style:Tt.style,styleSpec:Tt.styleSpec,arrayElementValidator:$t=>function(qt){const{key:Qt,layer:Xt,layerType:sr}=qt,ir=c.J(qt.value),hr=c.J(ir.name),mr=c.J(ir.condition),dr=Kl({key:Qt,value:ir,valueSpec:qt.styleSpec.appearance,style:qt.style,styleSpec:qt.styleSpec,objectElementValidators:{condition:Ir=>function(Tr){const Ar=[];return Ar.push(...Jo({key:Tr.key,value:Tr.object.condition,valueSpec:c.a6.appearance.condition,expressionContext:"appearance"})),Ar}(Object.assign({layer:Xt,layerType:sr},Ir)),properties:Ir=>function(Tr){const Ar=[],{styleSpec:Er,layer:vr,layerType:Pr}=Tr,Br=Er[`paint_${Pr}`],Or=Er[`layout_${Pr}`],Yr=Tr.object[Tr.objectKey];for(const Qr in Yr){const un=Qr in Br?"paint":Qr in Or?"layout":void 0;if(!un){Ar.push(new c.V(Tr.key,Qr,`unknown property "${Qr}" for layer type "${Pr}"`));continue}const Cn=Object.assign({},Tr,{key:`${Tr.key}.${Qr}`,object:Yr,objectKey:Qr,layer:vr,layerType:Pr,value:Yr[Qr],valueSpec:un==="paint"?Br[Qr]:Or[Qr]});Ar.push(...xu(Cn,un))}return Ar}(Object.assign({layer:Xt,layerType:sr},Ir))}});return hr!=="hidden"&&mr===void 0&&dr.push(new c.V(qt.key,"name",'Appearance with name different than "hidden" must have a condition')),dr}(Object.assign({layerType:dt,layer:$},$t))}),Mt=Array.isArray(Tt.value)?Tt.value:[],Ht=new Set;return Mt.forEach(($t,qt)=>{const Qt=c.J($t.name);if(Qt)if(Ht.has(Qt)){const Xt=c.J($.id);Pt.push(new c.V(Tt.key,Qt,`Duplicated appearance name "${Qt}" for layer "${Xt}"`))}else Ht.add(Qt)}),Pt}}})),d}function Cl({key:it,value:d}){return c.a0(d)?[]:[new c.V(it,d,`string expected, ${c.K(d)} found`)]}const hu={promoteId:function it({key:d,value:$}){if(c.a0($))return Cl({key:d,value:$});if(Array.isArray($)){const lt=[],ht=c.S($),dt=c.U(ht);return dt.result==="error"&&dt.value.forEach(mt=>{lt.push(new c.V(`${d}${mt.key}`,null,`${mt.message}`))}),c.X(dt.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||lt.push(new c.V(`${d}`,null,"promoteId expression should be only feature dependent")),lt}if(!c.H($))return[new c.V(d,$,`string, expression or object expected, "${c.K($)}" found`)];const st=[];for(const lt in $)st.push(...it({key:`${d}.${lt}`,value:$[lt]}));return st}};function _d(it){const d=it.value,$=it.key,st=it.styleSpec,lt=it.style;if(!c.H(d))return[new c.V($,d,`object expected, ${c.K(d)} found`)];if(!("type"in d))return[new c.V($,d,'"type" is required')];const ht=c.J(d.type);let dt=[];switch(["vector","raster","raster-dem","raster-array"].includes(ht)&&("url"in d||"tiles"in d||dt.push(new c.a3($,d,'Either "url" or "tiles" is required.'))),ht){case"vector":case"raster":case"raster-dem":case"raster-array":return dt=dt.concat(Kl({key:$,value:d,valueSpec:st[`source_${ht.replace("-","_")}`],style:it.style,styleSpec:st,objectElementValidators:hu})),dt;case"geojson":if(dt=Kl({key:$,value:d,valueSpec:st.source_geojson,style:lt,styleSpec:st,objectElementValidators:hu}),"cluster"in d&&"clusterProperties"in d){if(!c.H(d.clusterProperties))return[new c.V(`${$}.clusterProperties`,d,`object expected, ${c.K(d)} found`)];for(const mt in d.clusterProperties){const Tt=d.clusterProperties[mt];if(!Array.isArray(Tt))return[new c.V(`${$}.clusterProperties.${mt}`,Tt,"array expected")];const[Pt,Mt]=Tt,Ht=typeof Pt=="string"?[Pt,["accumulated"],["get",mt]]:Pt;dt.push(...Jo({key:`${$}.${mt}.map`,value:Mt,expressionContext:"cluster-map"})),dt.push(...Jo({key:`${$}.${mt}.reduce`,value:Ht,expressionContext:"cluster-reduce"}))}}return dt;case"video":return Kl({key:$,value:d,valueSpec:st.source_video,style:lt,styleSpec:st});case"image":return Kl({key:$,value:d,valueSpec:st.source_image,style:lt,styleSpec:st});case"canvas":return[new c.V($,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Il({key:`${$}.type`,value:d.type,valueSpec:{values:Pp(st)}})}}function Pp(it){return it.source.reduce((d,$)=>{const st=it[$];return st.type.type==="enum"&&(d=d.concat(Object.keys(st.type.values||{}))),d},[])}function ep(it){const d=it.value,$=it.styleSpec,st=$.light,lt=it.style;if(d===void 0)return[];if(!c.H(d))return[new c.V("light",d,`object expected, ${c.K(d)} found`)];let ht=[];for(const dt in d){const mt=dt.match(/^(.*)-transition$/),Tt=dt.match(/^(.*)-use-theme$/);ht=ht.concat(Tt&&st[Tt[1]]?To({key:dt,value:d[dt],valueSpec:{type:"string"},style:lt,styleSpec:$}):mt&&st[mt[1]]&&st[mt[1]].transition?To({key:dt,value:d[dt],valueSpec:$.transition,style:lt,styleSpec:$}):st[dt]?To({key:dt,value:d[dt],valueSpec:st[dt],style:lt,styleSpec:$}):[new c.V(dt,d[dt],`unknown property "${dt}"`)])}return ht}function tp(it){const d=it.value;if(!d)return[];const $=it.key;if(!c.H(d))return[new c.V($,d,`object expected, ${c.K(d)} found`)];let st=[];const lt=it.styleSpec,ht=lt["light-3d"],dt=it.style,mt=it.style.lights;for(const Mt of["type","id"])if(!(Mt in d))return st=st.concat([new c.V($,d,`missing property "${Mt}"`)]),st;if(!c.a0(d.type))return st=st.concat([new c.V(`${$}.type`,d.type,"string expected")]),st;if(mt)for(let Mt=0;Mt<it.arrayIndex;Mt++){const Ht=c.J(d.type),$t=mt[Mt];c.J($t.type)===Ht&&st.push(new c.V($,d.id,`duplicate light type "${d.type}", previously defined at line ${$t.id.__line__}`))}const Tt=`properties_light_${d.type}`;if(!(Tt in lt))return st=st.concat([new c.V(`${$}.type`,d,`Invalid light type ${d.type}`)]),st;const Pt=lt[Tt];for(const Mt in d)if(Mt==="properties"){const Ht=d[Mt];if(!c.H(Ht))return st=st.concat([new c.V("properties",Ht,`object expected, ${c.K(Ht)} found`)]),st;for(const $t in Ht){const qt=$t.match(/^(.*)-transition$/),Qt=$t.match(/^(.*)-use-theme$/);st=st.concat(Qt&&Pt[Qt[1]]?To({key:Mt,value:Ht[$t],valueSpec:{type:"string"},style:dt,styleSpec:lt}):qt&&Pt[qt[1]]&&Pt[qt[1]].transition?To({key:Mt,value:d[Mt],valueSpec:lt.transition,style:dt,styleSpec:lt}):Pt[$t]?To({key:$t,value:Ht[$t],valueSpec:Pt[$t],style:dt,styleSpec:lt}):[new c.a3(it.key,Ht[$t],`unknown property "${$t}"`)])}}else st=st.concat(ht[Mt]?To({key:Mt,value:d[Mt],valueSpec:ht[Mt],style:dt,styleSpec:lt}):[new c.a3(Mt,d[Mt],`unknown property "${Mt}"`)]);return st}function Bu(it){const d=it.value,$=it.key,st=it.style,lt=it.styleSpec,ht=lt.terrain;if(d==null)return[];if(!c.H(d))return[new c.V("terrain",d,`object expected, ${c.K(d)} found`)];let dt=[];for(const mt in d){const Tt=mt.match(/^(.*)-transition$/),Pt=mt.match(/^(.*)-use-theme$/);dt=dt.concat(Pt&&ht[Pt[1]]?To({key:mt,value:d[mt],valueSpec:{type:"string"},style:st,styleSpec:lt}):Tt&&ht[Tt[1]]&&ht[Tt[1]].transition?To({key:mt,value:d[mt],valueSpec:lt.transition,style:st,styleSpec:lt}):ht[mt]?To({key:mt,value:d[mt],valueSpec:ht[mt],style:st,styleSpec:lt}):[new c.a3(mt,d[mt],`unknown property "${mt}"`)])}if(d.source)if(c.a0(d.source)){const mt=st.sources&&st.sources[d.source],Tt=mt&&c.J(mt.type);mt?Tt!=="raster-dem"&&dt.push(new c.V(`${$}.source`,d.source,`terrain cannot be used with a source of type ${Tt}, it only be used with a "raster-dem" source type`)):dt.push(new c.V(`${$}.source`,d.source,`source "${d.source}" not found`))}else dt.push(new c.V(`${$}.source`,d.source,"source must be a string"));else dt.push(new c.V($,d,'terrain is missing required property "source"'));return dt}function Wm(it){const d=it.value,$=it.style,st=it.styleSpec,lt=st.fog;if(d===void 0)return[];if(!c.H(d))return[new c.V("fog",d,`object expected, ${c.K(d)} found`)];let ht=[];for(const dt in d){const mt=dt.match(/^(.*)-transition$/),Tt=dt.match(/^(.*)-use-theme$/);ht=ht.concat(Tt&&lt[Tt[1]]?To({key:dt,value:d[dt],valueSpec:{type:"string"},style:$,styleSpec:st}):mt&&lt[mt[1]]&&lt[mt[1]].transition?To({key:dt,value:d[dt],valueSpec:st.transition,style:$,styleSpec:st}):lt[dt]?To({key:dt,value:d[dt],valueSpec:lt[dt],style:$,styleSpec:st}):[new c.a3(dt,d[dt],`unknown property "${dt}"`)])}return ht}const mp={"*":()=>[],array:Sl,boolean:function(it){const d=it.value,$=it.key;return c.$(d)?[]:[new c.V($,d,`boolean expected, ${c.K(d)} found`)]},number:ru,color:function({key:it,value:d}){return c.a0(d)?c.a1.parseCSSColor(d)===null?[new c.V(it,d,`color expected, "${d}" found`)]:[]:[new c.V(it,d,`color expected, ${c.K(d)} found`)]},enum:Il,filter:Eu,function:Ll,layer:Ip,object:Kl,source:_d,model:c.a7,light:ep,"light-3d":tp,terrain:Bu,fog:Wm,string:Cl,formatted:function(it){return Cl(it).length===0?[]:Jo(it)},resolvedImage:function(it){return Cl(it).length===0?[]:Jo(it)},projection:function(it){const d=it.value,$=it.styleSpec,st=$.projection,lt=it.style;if(c.H(d)){let ht=[];for(const dt in d)ht=ht.concat(To({key:dt,value:d[dt],valueSpec:st[dt],style:lt,styleSpec:$}));return ht}return c.a0(d)?[]:[new c.V("projection",d,`object or string expected, ${c.K(d)} found`)]},import:function(it){const d=it.key,{value:$,styleSpec:st}=it;if(!c.H($))return[new c.V(d,$,"import must be an object")];const{data:lt,...ht}=$;Object.defineProperty(ht,"__line__",{value:$.__line__,enumerable:!1});let dt=Kl(Object.assign({},it,{value:ht,valueSpec:st.import}));return c.J(ht.id)===""&&dt.push(new c.V(`${it.key}.id`,ht,"import id can't be an empty string")),lt&&(dt=dt.concat(Oo(lt,st,{key:`${it.key}.data`}))),dt},iconset:function(it){const d=it.value,$=it.key,st=it.styleSpec,lt=it.style;if(!c.H(d))return[new c.V($,d,"object expected")];if(!d.type)return[new c.V($,d,'"type" is required')];const ht=c.J(d.type);let dt=[];if(dt=dt.concat(Kl({key:$,value:d,valueSpec:st[`iconset_${ht}`],style:lt,styleSpec:st})),function(mt,Tt){return!(mt!=="source"||!Tt.source)}(ht,d)){const mt=lt.sources&&lt.sources[d.source],Tt=mt&&c.J(mt.type);mt?Tt!=="raster-array"&&dt.push(new c.V($,d.source,`iconset cannot be used with a source of type ${String(Tt)}, it only be used with a "raster-array" source type`)):dt.push(new c.V($,d.source,`source "${d.source}" not found`))}return dt}};function To(it,d=!1){const $=it.value,st=it.valueSpec,lt=it.styleSpec;if(st.expression){if(c.a4(c.J($)))return Ll(it);if(c.Q(c.S($)))return Jo(it)}if(st.type&&mp[st.type]){const ht=mp[st.type](it);return d===!0&&ht.length>0&&Array.isArray(it.value)?Jo(it):ht}return Kl(Object.assign({},it,{valueSpec:st.type?lt[st.type]:st}))}function Kl(it){const d=it.key,$=it.value,st=it.valueSpec||{},lt=it.objectElementValidators||{},ht=it.style,dt=it.styleSpec;if(!c.H($))return[new c.V(d,$,`object expected, ${c.K($)} found`)];let mt=[];for(const Tt in $){const Pt=Tt.split(".")[0];let Mt;lt[Pt]?Mt=lt[Pt]:st[Pt]?Mt=To:lt["*"]?Mt=lt["*"]:st["*"]&&(Mt=To),Mt?mt=mt.concat(Mt({key:(d&&`${d}.`)+Tt,value:$[Tt],valueSpec:st[Pt]||st["*"],style:ht,styleSpec:dt,object:$,objectKey:Tt},$)):mt.push(new c.a3(d,$[Tt],`unknown property "${Tt}"`))}for(const Tt in st){if(lt[Tt])continue;const Pt=st[Tt];Pt.required&&Pt.default===void 0&&$[Tt]===void 0&&mt.push(new c.V(d,$,`missing required property "${Tt}"`))}return mt}function lo({key:it,value:d}){const $=Cl({key:it,value:d});if($.length)return $;const st=d;return st.indexOf("{fontstack}")===-1&&$.push(new c.V(it,d,'"glyphs" url must include a "{fontstack}" token')),st.indexOf("{range}")===-1&&$.push(new c.V(it,d,'"glyphs" url must include a "{range}" token')),$}function Oo(it,d=c.a6,$={}){return Kl({key:$.key||"",value:it,valueSpec:Object.assign(d.$root,{"*":{type:"*"}}),styleSpec:d,style:it,objectElementValidators:{glyphs:lo}})}function jo(it,d=c.a6){return ar(Oo(it,d))}const Tu=it=>ar(_d(it)),mn=it=>ar(ep(it)),du=it=>ar(tp(it)),gp=it=>ar(Bu(it)),au=it=>ar(Wm(it)),Fs=it=>ar(function(d){const $=d.value,st=d.style,lt=d.styleSpec,ht=lt.snow;if($===void 0)return[];if(!c.H($))return[new c.V("snow",$,`object expected, ${c.K($)} found`)];let dt=[];for(const mt in $){const Tt=mt.match(/^(.*)-transition$/);dt=dt.concat(Tt&&ht[Tt[1]]&&ht[Tt[1]].transition?To({key:mt,value:$[mt],valueSpec:lt.transition,style:st,styleSpec:lt}):ht[mt]?To({key:mt,value:$[mt],valueSpec:ht[mt],style:st,styleSpec:lt}):[new c.a3(mt,$[mt],`unknown property "${mt}"`)])}return dt}(it)),vu=it=>ar(function(d){const $=d.value,st=d.style,lt=d.styleSpec,ht=lt.rain;if($===void 0)return[];if(!c.H($))return[new c.V("rain",$,`object expected, ${c.K($)} found`)];let dt=[];for(const mt in $){const Tt=mt.match(/^(.*)-transition$/);dt=dt.concat(Tt&&ht[Tt[1]]&&ht[Tt[1]].transition?To({key:mt,value:$[mt],valueSpec:lt.transition,style:st,styleSpec:lt}):ht[mt]?To({key:mt,value:$[mt],valueSpec:ht[mt],style:st,styleSpec:lt}):[new c.a3(mt,$[mt],`unknown property "${mt}"`)])}return dt}(it)),rv=it=>ar(Ip(it)),qm=it=>ar(Eu(it)),o_=it=>ar(Kp(it)),Wr=it=>ar(Rp(it)),tr=it=>ar(c.a7(it));function ar(it){return it.slice().sort((d,$)=>d.line&&$.line?d.line-$.line:0)}function yr(it,d){let $=!1;if(d&&d.length)for(const st of d)st instanceof c.a3?c.w(st.message):(it.fire(new c.y(new Error(st.message))),$=!0);return $}const Dr=c.a6.light;let kr;class jr extends c.E{constructor(d,$="flat"){super(),this._transitionable=new c.a8(kr||(kr=new c.a9({anchor:new c.aa(Dr.anchor),position:new c.ab(Dr.position),color:new c.aa(Dr.color),intensity:new c.aa(Dr.intensity)}))),this.setLight(d,$),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(d,$,st={}){this._validate(mn,d,st)||(this._transitionable.setTransitionOrValue(d),this.id=$)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,$,st){return(!st||st.validate!==!1)&&yr(this,d.call(jo,Object.assign({value:$,style:{glyphs:!0,sprite:!0},styleSpec:c.a6})))}}const Zr=c.a6.terrain;let Vr=class extends c.E{constructor(it,d,$,st,lt){super(),this.scope=$,this._transitionable=new c.a8(new c.a9({source:new c.aa(Zr.source),exaggeration:new c.aa(Zr.exaggeration)}),$,st),this._transitionable.setTransitionOrValue(it,st),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=d,this.worldview=lt}get(){return this._transitionable.serialize()}set(it,d){this._transitionable.setTransitionOrValue(it,d)}updateTransitions(it){this._transitioning=this._transitionable.transitioned(it,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(it){this.properties=this._transitioning.possiblyEvaluate(it)}getExaggeration(it){return this._transitioning.possiblyEvaluate(new c.ac(it,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const it=this._transitionable._values.exaggeration;if(!it)return null;const d=it.value.expression;if(!d)return null;let $=-1,st=-1,lt=1;for(const ht of d.zoomStops)lt=d.evaluate(new c.ac(ht,{worldview:this.worldview})),lt>.01?($=ht,st=-1):st=ht;return lt<.01&&$>0&&st>$?[$,st]:null}isZoomDependent(){const it=this._transitionable._values.exaggeration;return it!=null&&it.value!=null&&it.value.expression!=null&&it.value.expression instanceof c.ad}};const Xr=45,Sn=65,hn=.05;function Wn(it,d,$,st){const lt=c.ah(Xr,Sn,$),[ht,dt]=os(it,st);let mt=1-Math.min(1,Math.exp((d-ht)/(dt-ht)*-6));return mt*=mt*mt,mt=Math.min(1,1.00747*mt),mt*lt*it.alpha}function os(it,d){const $=.5/Math.tan(.5*d);return[it.range[0]+$,it.range[1]+$]}function $n(it,d,$,st,lt){const ht=c.af([],[d,$,st],lt.mercatorFogMatrix);return Wn(it,c.ag(ht),lt.pitch,lt._fov)}function ks(it,d,$,st,lt,ht,dt){const mt=[[$,st,0],[lt,st,0],[lt,ht,0],[$,ht,0]];let Tt=Number.MAX_VALUE,Pt=-Number.MAX_VALUE;for(const Mt of mt){const Ht=c.af([],Mt,d),$t=c.ag(Ht);Tt=Math.min(Tt,$t),Pt=Math.max(Pt,$t)}return[Wn(it,Tt,dt.pitch,dt._fov),Wn(it,Pt,dt.pitch,dt._fov)]}const Is=c.a6.fog;class As extends c.E{constructor(d,$,st,lt){super();const ht=new c.a9({range:new c.aa(Is.range),color:new c.aa(Is.color),"color-use-theme":new c.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new c.aa(Is["high-color"]),"high-color-use-theme":new c.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new c.aa(Is["space-color"]),"space-color-use-theme":new c.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new c.aa(Is["horizon-blend"]),"star-intensity":new c.aa(Is["star-intensity"]),"vertical-range":new c.aa(Is["vertical-range"])});this._transitionable=new c.a8(ht,st,new Map(lt)),this.set(d,lt),this._transitioning=this._transitionable.untransitioned(),this._transform=$,this.properties=new c.ai(ht),this.scope=st}get state(){const d=this._transform,$=d.projection.name==="globe",st=c.aj(d.zoom),lt=this.properties.get("range"),ht=[.5,3];return{range:$?[c.ak(ht[0],lt[0],st),c.ak(ht[1],lt[1],st)]:lt,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(d,$,st={}){if(this._validate(au,d,st))return;const lt=Object.assign({},d);for(const ht of Object.keys(Is))lt[ht]===void 0&&(lt[ht]=Is[ht].default);this._options=lt,this._transitionable.setTransitionOrValue(this._options,$)}getOpacity(d){if(!this._transform.projection.supportsFog)return 0;const $=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:c.ah(Xr,Sn,d))*$.a}getOpacityAtLatLng(d,$){return this._transform.projection.supportsFog?function(st,lt,ht){const dt=c.ae.fromLngLat(lt),mt=ht.elevation?ht.elevation.getAtPointOrZero(dt):0;return $n(st,dt.x,dt.y,mt,ht)}(this.state,d,$):0}getOpacityForTile(d){if(!this._transform.projection.supportsFog)return[1,1];const $=this._transform.calculateFogTileMatrix(d.toUnwrapped());return ks(this.state,$,0,0,c.al,c.al,this._transform)}getOpacityForBounds(d,$,st,lt,ht){return this._transform.projection.supportsFog?ks(this.state,d,$,st,lt,ht,this._transform):[1,1]}getFovAdjustedRange(d){return this._transform.projection.supportsFog?os(this.state,d):[0,1]}isVisibleOnFrustum(d){if(!this._transform.projection.supportsFog)return!1;const $=[4,5,6,7];for(const st of $){const lt=d.points[st];let ht;if(lt[2]>=0)ht=lt;else{const dt=d.points[st-4];ht=c.am(dt,lt,dt[2]/(dt[2]-lt[2]))}if($n(this.state,ht[0],ht[1],0,this._transform)>=hn)return!0}return!1}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,$,st){return(!st||st.validate!==!1)&&yr(this,d.call(jo,Object.assign({value:$,style:{glyphs:!0,sprite:!0},styleSpec:c.a6})))}}let Xs,na,Pl,ba,Ol=class extends c.E{constructor(it,d,$,st){super();const lt=Xs||(Xs=new c.a9({density:new c.aa(c.a6.snow.density),intensity:new c.aa(c.a6.snow.intensity),color:new c.aa(c.a6.snow.color),opacity:new c.aa(c.a6.snow.opacity),vignette:new c.aa(c.a6.snow.vignette),"vignette-color":new c.aa(c.a6.snow["vignette-color"]),"center-thinning":new c.aa(c.a6.snow["center-thinning"]),direction:new c.aa(c.a6.snow.direction),"flake-size":new c.aa(c.a6.snow["flake-size"])}));this._transitionable=new c.a8(lt,$,new Map(st)),this.set(it,st),this._transitioning=this._transitionable.untransitioned(),this.properties=new c.ai(lt),this.scope=$}get state(){const it=this.properties.get("opacity"),d=this.properties.get("color"),$=this.properties.get("direction"),st=c.an($[0]),lt=-Math.max(c.an($[1]),.01),ht=[Math.cos(st)*Math.cos(lt),Math.sin(st)*Math.cos(lt),Math.sin(lt)],dt=this.properties.get("vignette"),mt=this.properties.get("vignette-color");return mt.a=dt,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new c.ao(d.r,d.g,d.b,d.a*it),direction:ht,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:mt}}get(){return this._transitionable.serialize()}set(it,d,$={}){if(this._validate(Fs,it,$))return;const st=Object.assign({},it),lt=c.a6.snow;for(const ht of Object.keys(lt))st[ht]===void 0&&(st[ht]=lt[ht].default);this._options=st,this._transitionable.setTransitionOrValue(this._options,d)}updateConfig(it){this._transitionable.setTransitionOrValue(this._options,new Map(it))}updateTransitions(it){this._transitioning=this._transitionable.transitioned(it,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(it){this.properties=this._transitioning.possiblyEvaluate(it)}_validate(it,d,$){return(!$||$.validate!==!1)&&yr(this,it.call(jo,Object.assign({value:d,style:{glyphs:!0,sprite:!0},styleSpec:c.a6})))}},Ko=class extends c.E{constructor(it,d,$,st){super();const lt=na||(na=new c.a9({density:new c.aa(c.a6.rain.density),intensity:new c.aa(c.a6.rain.intensity),color:new c.aa(c.a6.rain.color),opacity:new c.aa(c.a6.rain.opacity),vignette:new c.aa(c.a6.rain.vignette),"vignette-color":new c.aa(c.a6.rain["vignette-color"]),"center-thinning":new c.aa(c.a6.rain["center-thinning"]),direction:new c.aa(c.a6.rain.direction),"droplet-size":new c.aa(c.a6.rain["droplet-size"]),"distortion-strength":new c.aa(c.a6.rain["distortion-strength"])}));this._transitionable=new c.a8(lt,$,new Map(st)),this.set(it,st),this._transitioning=this._transitionable.untransitioned(),this.properties=new c.ai(lt),this.scope=$}get state(){const it=this.properties.get("opacity"),d=this.properties.get("color"),$=this.properties.get("direction"),st=c.an($[0]),lt=-Math.max(c.an($[1]),.01),ht=[Math.cos(st)*Math.cos(lt),Math.sin(st)*Math.cos(lt),Math.sin(lt)],dt=this.properties.get("vignette-color");return dt.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new c.ao(d.r,d.g,d.b,d.a*it),direction:ht,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:dt}}get(){return this._transitionable.serialize()}set(it,d,$={}){if(this._validate(vu,it,$))return;const st=Object.assign({},it),lt=c.a6.rain;for(const ht of Object.keys(lt))st[ht]===void 0&&(st[ht]=lt[ht].default);this._options=st,this._transitionable.setTransitionOrValue(this._options,d)}updateConfig(it){this._transitionable.setTransitionOrValue(this._options,new Map(it))}updateTransitions(it){this._transitioning=this._transitionable.transitioned(it,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(it){this.properties=this._transitioning.possiblyEvaluate(it)}_validate(it,d,$){return(!$||$.validate!==!1)&&yr(this,it.call(jo,Object.assign({value:d,style:{glyphs:!0,sprite:!0},styleSpec:c.a6})))}};class Js extends c.E{constructor(d,$,st,lt){super(),this.scope=st,this._options=d,this.properties=new c.ai($),this._transitionable=new c.a8($,st,new Map(lt)),this._transitionable.setTransitionOrValue(d.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(d){this._transitionable.setTransitionOrValue(this._options.properties,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(d,$){this._options=d,this._transitionable.setTransitionOrValue(d.properties,$)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Xo{constructor(d,$,st){this.screenBounds=d,this.cameraPoint=st.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=$,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,st)}static createFromScreenPoints(d,$){let st,lt;if(d instanceof c.P||typeof d[0]=="number"){const ht=c.P.convert(d);st=[ht],lt=$.isPointAboveHorizon(ht)}else{const ht=c.P.convert(d[0]),dt=c.P.convert(d[1]),mt=ht.add(dt)._div(2);st=[ht,dt],lt=c.aq(ht,dt).every(Tt=>$.isPointAboveHorizon(Tt))&&$.isPointAboveHorizon(mt)}return new Xo(st,lt,$)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(d){return c.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],d)}bufferedCameraGeometry(d){const $=this.screenBounds[0],st=this.screenBounds.length===1?this.screenBounds[0].add(new c.P(1,1)):this.screenBounds[1],lt=c.aq($,st,0,!1);return this.cameraPoint.y>st.y&&(this.cameraPoint.x>$.x&&this.cameraPoint.x<st.x?lt.splice(3,0,this.cameraPoint):this.cameraPoint.x>=st.x?lt[2]=this.cameraPoint:this.cameraPoint.x<=$.x&&(lt[3]=this.cameraPoint)),c.ar(lt,d)}bufferedCameraGeometryGlobe(d){const $=this.screenBounds[0],st=this.screenBounds.length===1?this.screenBounds[0].add(new c.P(1,1)):this.screenBounds[1],lt=c.aq($,st,d),ht=this.cameraPoint.clone();switch(3*((ht.y>$.y)+(ht.y>st.y))+((ht.x>$.x)+(ht.x>st.x))){case 0:lt[0]=ht,lt[4]=ht.clone();break;case 1:lt.splice(1,0,ht);break;case 2:lt[1]=ht;break;case 3:lt.splice(4,0,ht);break;case 5:lt.splice(2,0,ht);break;case 6:lt[3]=ht;break;case 7:lt.splice(3,0,ht);break;case 8:lt[2]=ht}return lt}containsTile(d,$,st,lt=0){const ht=Math.max(d.queryPadding,d.evaluateQueryRenderedFeaturePadding())/$._pixelsPerMercatorPixel+1,dt=st?this._bufferedCameraMercator(ht,$):this._bufferedScreenMercator(ht,$);let mt=d.tileID.wrap+(dt.unwrapped?lt:0);const Tt=dt.polygon.map(sr=>c.as(d.tileTransform,sr,mt));if(!c.at(Tt,0,0,c.al,c.al))return;mt=d.tileID.wrap+(this.screenGeometryMercator.unwrapped?lt:0);const Pt=this.screenGeometryMercator.polygon.map(sr=>c.au(d.tileTransform,sr,mt)),Mt=Pt.map(sr=>new c.P(sr[0],sr[1])),Ht=$.getFreeCameraOptions().position||new c.ae(0,0,0),$t=c.au(d.tileTransform,Ht,mt),qt=Pt.map(sr=>{const ir=c.av(sr,sr,$t);return c.aw(ir,ir),new c.ax($t,ir)}),Qt=c.ay(d,1,$.zoom)*$._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:Mt,tilespaceRays:qt,bufferedTilespaceGeometry:Tt,bufferedTilespaceBounds:(Xt=c.az(Tt),Xt.min.x=c.aA(Xt.min.x,0,c.al),Xt.min.y=c.aA(Xt.min.y,0,c.al),Xt.max.x=c.aA(Xt.max.x,0,c.al),Xt.max.y=c.aA(Xt.max.y,0,c.al),Xt),tile:d,tileID:d.tileID,pixelToTileUnitsFactor:Qt};var Xt}_bufferedScreenMercator(d,$){const st=$a(d);if(this._screenRaycastCache[st])return this._screenRaycastCache[st];{let lt;return lt=$.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(d),$):{polygon:this.bufferedScreenGeometry(d).map(ht=>$.pointCoordinate3D(ht)),unwrapped:!0},this._screenRaycastCache[st]=lt,lt}}_bufferedCameraMercator(d,$){const st=$a(d);if(this._cameraRaycastCache[st])return this._cameraRaycastCache[st];{let lt;return lt=$.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(d),$):{polygon:this.bufferedCameraGeometry(d).map(ht=>$.pointCoordinate3D(ht)),unwrapped:!0},this._cameraRaycastCache[st]=lt,lt}}_projectAndResample(d,$){const st=function(ht,dt){const mt=c.aB([],dt.pixelMatrix,dt.globeMatrix),Tt=[0,-c.aD,0,1],Pt=[0,c.aD,0,1],Mt=[0,0,0,1];c.aC(Tt,Tt,mt),c.aC(Pt,Pt,mt),c.aC(Mt,Mt,mt);const Ht=new c.P(Tt[0]/Tt[3],Tt[1]/Tt[3]),$t=new c.P(Pt[0]/Pt[3],Pt[1]/Pt[3]),qt=c.aE(ht,Ht)&&Tt[3]<Mt[3],Qt=c.aE(ht,$t)&&Pt[3]<Mt[3];if(!qt&&!Qt)return null;const Xt=function(Ar,Er,vr){for(let Pr=1;Pr<Ar.length;Pr++){const Br=Us(Er.pointCoordinate3D(Ar[Pr-1]).x),Or=Us(Er.pointCoordinate3D(Ar[Pr]).x);if(vr<0){if(Br<Or)return{idx:Pr,t:-Br/(Or-1-Br)}}else if(Or<Br)return{idx:Pr,t:(1-Br)/(Or+1-Br)}}return null}(ht,dt,qt?-1:1);if(!Xt)return null;const{idx:sr,t:ir}=Xt;let hr=sr>1?Ro(ht.slice(0,sr),dt):[],mr=sr<ht.length?Ro(ht.slice(sr),dt):[];hr=hr.map(Ar=>new c.P(Us(Ar.x),Ar.y)),mr=mr.map(Ar=>new c.P(Us(Ar.x),Ar.y));const dr=[...hr];dr.length===0&&dr.push(mr[mr.length-1]);const Ir=c.ak(dr[dr.length-1].y,(mr.length===0?hr[0]:mr[0]).y,ir);let Tr;return Tr=qt?[new c.P(0,Ir),new c.P(0,0),new c.P(1,0),new c.P(1,Ir)]:[new c.P(1,Ir),new c.P(1,1),new c.P(0,1),new c.P(0,Ir)],dr.push(...Tr),mr.length===0?dr.push(hr[0]):dr.push(...mr),{polygon:dr.map(Ar=>new c.ae(Ar.x,Ar.y)),unwrapped:!1}}(d,$);if(st)return st;const lt=function(ht,dt){let mt=!1,Tt=-1/0,Pt=0;for(let Ht=0;Ht<ht.length-1;Ht++)ht[Ht].x>Tt&&(Tt=ht[Ht].x,Pt=Ht);for(let Ht=0;Ht<ht.length-1;Ht++){const $t=(Pt+Ht)%(ht.length-1),qt=ht[$t],Qt=ht[$t+1];Math.abs(qt.x-Qt.x)>.5&&(qt.x<Qt.x?(qt.x+=1,$t===0&&(ht[ht.length-1].x+=1)):(Qt.x+=1,$t+1===ht.length-1&&(ht[0].x+=1)),mt=!0)}const Mt=c.aF(dt.center.lng);return mt&&Mt<Math.abs(Mt-1)&&ht.forEach(Ht=>{Ht.x-=1}),{polygon:ht,unwrapped:mt}}(Ro(d,$).map(ht=>new c.P(Us(ht.x),ht.y)),$);return{polygon:lt.polygon.map(ht=>new c.ae(ht.x,ht.y)),unwrapped:lt.unwrapped}}}function Ro(it,d){return c.aG(it,$=>{const st=d.pointCoordinate3D($);$.x=st.x,$.y=st.y},1/256)}function Us(it){return it<0?1+it%1:it%1}function $a(it){return 100*it|0}function lu(it,d,$,st,lt){const ht=function(mt,Tt){if(mt)return lt(mt);if(Tt){if(it.url&&Tt.tiles&&it.tiles&&delete it.tiles,Tt.variants){if(!Array.isArray(Tt.variants))return lt(new Error("variants must be an array"));for(const Mt of Tt.variants){if(Mt==null||typeof Mt!="object"||Mt.constructor!==Object)return lt(new Error("variant must be an object"));if(!Array.isArray(Mt.capabilities))return lt(new Error("capabilities must be an array"));if(Mt.capabilities.length===1&&Mt.capabilities[0]==="meshopt"){Tt=Object.assign(Tt,Mt);break}}}const Pt=c.aH(Object.assign({},Tt,it),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);Pt.tiles=d.canonicalizeTileset(Pt,it.url),lt(null,Pt)}},dt=function(mt,Tt,Pt){if(!mt)return null;if(!Tt&&!Pt)return mt;Pt=Pt||mt.worldview_default;const Mt=Object.values(mt.language||{});if(Mt.length===0)return null;const Ht=Object.values(mt.worldview||{});if(Ht.length===0)return null;const $t=Mt.every(Qt=>Qt===Tt),qt=Ht.every(Qt=>Qt===Pt);return $t&&qt?mt:Tt in(mt.language_options||{})||Pt in(mt.worldview_options||{})?null:mt.language_options&&mt.worldview_options?mt:null}(it.data,$,st);return dt?c.o.frame(()=>ht(null,dt)):it.url?c.m(d.transformRequest(d.normalizeSourceURL(it.url,null,$,st),c.R.Source),ht):c.o.frame(()=>{const{data:mt,...Tt}=it;ht(null,Tt)})}function pu(it,d){const $=Math.pow(2,d.z),st=Math.floor(c.aF(it.getWest())*$),lt=Math.floor(c.aJ(it.getNorth())*$),ht=Math.ceil(c.aF(it.getEast())*$),dt=Math.ceil(c.aJ(it.getSouth())*$);return d.x>=st&&d.x<ht&&d.y>=lt&&d.y<dt}class Mu{constructor(d,$,st){this.bounds=d?c.aI.convert(this.validateBounds(d)):null,this.minzoom=$||0,this.maxzoom=st||24}validateBounds(d){return Array.isArray(d)&&d.length===4?[Math.max(-180,d[0]),Math.max(-90,d[1]),Math.min(180,d[2]),Math.min(90,d[3])]:[-180,-90,180,90]}addExtraBounds(d){if(d){this.extraBounds||(this.extraBounds=[]);for(const $ of d)this.extraBounds.push(c.aI.convert(this.validateBounds($)))}}contains(d){if(d.z>this.maxzoom||d.z<this.minzoom||this.bounds&&!pu(this.bounds,d))return!1;if(!this.extraBounds)return!0;for(const $ of this.extraBounds)if(pu($,d))return!0;return!1}static fromTileJSON(d){if(!d.bounds&&!d.extra_bounds)return null;const $=new Mu(d.bounds,d.minzoom,d.maxzoom);return $.addExtraBounds(d.extra_bounds),$}}class Km extends c.E{constructor(d,$,st,lt){if(super(),this.id=d,this.dispatcher=st,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,c.aH($,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},$),this._collectResourceTiming=!!$.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(lt),this._tileWorkers={},this._deduped=new c.aK}load(d){this._loaded=!1,this.fire(new c.z("dataloading",{dataType:"source"}));const $=Array.isArray(this.map._language)?this.map._language.join():this.map._language,st=this.map.getWorldview();this._tileJSONRequest=lu(this._options,this.map._requestManager,$,st,(lt,ht)=>{if(this._tileJSONRequest=null,this._loaded=!0,lt)$&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${$}`),st&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${st}`),this.fire(new c.y(lt));else if(ht){if(Object.assign(this,ht),this.hasWorldviews=!!ht.worldview_options,ht.worldview_default&&(this.worldviewDefault=ht.worldview_default),ht.vector_layers){this.vectorLayers=ht.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const dt of ht.vector_layers)this.vectorLayerIds.push(dt.id),ht.worldview&&ht.worldview[dt.source]&&this.localizableLayerIds.add(dt.id)}this.tileBounds=Mu.fromTileJSON(ht),fn(ht.tiles,this.map._requestManager._customAccessToken),this.fire(new c.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))}d&&d(lt)})}loaded(){return this._loaded}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}onAdd(d){this.map=d,this.load()}reload(){this.cancelTileJSONRequest();const d=c.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(d))}setTiles(d){return this._options.tiles=d,this.reload(),this}setUrl(d){return this.url=d,this._options.url=d,this.reload(),this}onRemove(d){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(d,$){const st=d.tileID.canonical.url(this.tiles,this.scheme),lt=this.map._requestManager.normalizeTileURL(st),ht=this.map._requestManager.transformRequest(lt,c.R.Tile),dt=this.map.style?this.map.style.getLut(this.scope):null,mt=dt?{image:dt.image.clone()}:null,Tt={request:ht,data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,lut:mt,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:c.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:d.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&c.h(st)&&(Tt.localizableLayerIds=this.localizableLayerIds),Tt.request.collectResourceTiming=this._collectResourceTiming,d.actor&&d.state!=="expired")d.state==="loading"?d.reloadCallback=$:d.request=d.actor.send("reloadTile",Tt,Pt.bind(this));else if(d.actor=this._tileWorkers[lt]=this._tileWorkers[lt]||this.dispatcher.getActor(),this.dispatcher.ready)d.request=d.actor.send("loadTile",Tt,Pt.bind(this),void 0,!0);else{const Mt=c.aL.call({deduped:this._deduped},Tt,(Ht,$t)=>{if(Ht||!$t)Pt.call(this,Ht);else{const qt=c.aM($t.responseHeaders);Tt.data={rawData:$t.rawData.slice(0),expires:qt.expires,cacheControl:qt.cacheControl},d.actor&&d.actor.send("loadTile",Tt,Pt.bind(this),void 0,!0)}},!0);d.request={cancel:Mt}}function Pt(Mt,Ht){return delete d.request,d.aborted?$(null):Mt&&Mt instanceof c.aN&&Mt.status!==404?$(Mt):(Ht&&Ht.resourceTiming&&(d.resourceTiming=Ht.resourceTiming),this.map._refreshExpiredTiles&&Ht&&d.setExpiryData(Ht),d.loadVectorData(Ht,this.map.painter),c.aO(this.dispatcher),$(null,Ht),void(d.reloadCallback&&(this.loadTile(d,d.reloadCallback),d.reloadCallback=null)))}}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(d,$){d.actor&&d.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Jl extends c.E{constructor(d,$,st,lt){super(),this.id=d,this.dispatcher=st,this.setEventedParent(lt),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},$),Object.assign(this,c.aH($,["url","scheme","tileSize"]))}load(d){this._loaded=!1,this.fire(new c.z("dataloading",{dataType:"source"}));const $=this.map.getWorldview();this._tileJSONRequest=lu(this._options,this.map._requestManager,null,$,(st,lt)=>{this._tileJSONRequest=null,this._loaded=!0,st?this.fire(new c.y(st)):lt&&(Object.assign(this,lt),lt.raster_layers&&(this.rasterLayers=lt.raster_layers,this.rasterLayerIds=this.rasterLayers.map(ht=>ht.id)),this.tileBounds=Mu.fromTileJSON(lt),fn(lt.tiles),this.fire(new c.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))),d&&d(st)})}loaded(){return this._loaded}onAdd(d){this.map=d,this.load()}reload(){this.cancelTileJSONRequest();const d=c.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(d))}setTiles(d){return this._options.tiles=d,this.reload(),this}setUrl(d){return this.url=d,this._options.url=d,this.reload(),this}onRemove(d){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,$){const st=c.o.devicePixelRatio>=2,lt=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),st,this.tileSize);d.request=c.n(this.map._requestManager.transformRequest(lt,c.R.Tile),(ht,dt,mt)=>{if(delete d.request,d.aborted)return d.state="unloaded",$(null);if(ht)return d.state="errored",$(ht);if(!dt)return $(null);const Tt=c.aM(mt);this.map._refreshExpiredTiles&&d.setExpiryData(Tt),d.setTexture(dt,this.map.painter),d.state="loaded",c.aO(this.dispatcher),$(null)})}abortTile(d,$){d.request&&(d.request.cancel(),delete d.request),$&&$()}unloadTile(d,$){d.texture&&d.texture instanceof c.T?(d.destroy(!1),d.texture&&d.texture instanceof c.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),$&&$()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Hu([it,d],$,st,{scaled:lt=!0}={}){const{tileSize:ht,buffer:dt}=st,{x:mt,y:Tt,z:Pt}=$;if(!isFinite(mt)||!isFinite(Tt)||!isFinite(Pt))throw new Error("Invalid MRT header");const Mt=2**Pt,Ht=Mt*c.aF(it),$t=Mt*c.aJ(d);return function([qt,Qt],Xt,{scaled:sr=!0}={}){if(!Xt)throw new Error("bandView is undefined");const{data:ir,tileSize:hr,buffer:mr,offset:dr,scale:Ir,dimension:Tr}=Xt;if(qt<-mr||qt>hr+mr||Qt<-mr||Qt>hr+mr)throw new Error(`Point (${qt}, ${Qt}) out of bounds for tileSize=${hr}, buffer=${mr}`);const Ar=(Qt+mr)*(hr+2*mr)+(qt+mr);if(new Uint32Array(ir.buffer)[Ar]===4294967295)return null;let Er=[];Er=sr?[]:new Xt.data.constructor(Tr);for(let vr=0;vr<Tr;vr++)Er[vr]=Math.round(1e12*(ir[Tr*Ar+vr]*Ir+dr))/1e12;return Er}([Math.min(Math.max(-dt,Math.floor((Ht-mt)*ht)),ht-1+dt),Math.min(Math.max(-dt,Math.floor(($t-Tt)*ht)),ht-1+dt)],st,{scaled:lt})}class bu extends Jl{constructor(d,$,st,lt){super(d,$,st,lt),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},$)}triggerRepaint(d){const $=this.map.painter._terrain,st=this.map.style.getSourceCache(this.id);$&&$.enabled&&st&&$._clearRenderCacheForTile(st.id,d.tileID),this.map.triggerRepaint()}loadTile(d,$){const st=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),lt=this.map._requestManager.transformRequest(st,c.R.Tile),ht={request:lt,uid:d.uid,tileID:d.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};d.source=this.id,d.scope=this.scope,d.requestParams=lt,d.actor||(d.actor=this.dispatcher.getActor());const dt=(mt,Tt,Pt)=>{if(delete d.request,d.aborted)return d.state="unloaded",$(null);if(mt)return mt.name==="AbortError"?void 0:(d.state="errored",$(mt));if(this.map._refreshExpiredTiles&&Tt){const Mt=c.aM(Pt);d.setExpiryData(Mt)}if(this.partial&&d.state!=="expired")d.state="empty";else if(!this.partial){if(!Tt)return $(null);d.state="loaded",d._isHeaderLoaded=!0,d._mrt=Tt}$(null)};d.request=this.partial?d.fetchHeader(void 0,dt.bind(this)):d.actor.send("loadTile",ht,dt.bind(this),void 0,!0)}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(d,$){const st=d.texturePerLayer;if(d.flushAllQueues(),st.size){d.destroy(!1);for(const lt of st.values())this.map.painter.saveTileTexture(lt)}else d.destroy()}prepareTile(d,$,st,lt){d._isHeaderLoaded&&(d.state!=="empty"&&(d.state="reloading"),d.fetchBandForRender($,st,lt,(ht,dt)=>{if(ht)return d.state="errored",this.fire(new c.y(ht)),void this.triggerRepaint(d);dt&&(d._isHeaderLoaded=!0,d.setTexturePerLayer(st,dt,this.map.painter),d.state="loaded",this.triggerRepaint(d))}))}getInitialBand(d){if(!this.rasterLayers)return 0;const $=this.rasterLayers.find(({id:ht})=>ht===d),st=$&&$.fields,lt=st&&st.bands&&st.bands;return lt?lt[0]:0}getTextureDescriptor(d,$,st){if(!d)return;const lt=$.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!lt)return;let ht=null;$ instanceof c.aR?ht=$.paint.get("raster-array-band"):$ instanceof c.aS&&(ht=$.paint.get("raster-particle-array-band"));const dt=ht||this.getInitialBand(lt);if(dt==null)return;if(!d.textureDescriptorPerLayer.get($.id))return void this.prepareTile(d,lt,$.id,dt);if(d.updateNeeded($.id,dt)&&!st)return;const mt=d.textureDescriptorPerLayer.get($.id);return Object.assign({},mt,{texture:d.texturePerLayer.get($.id)})}getImages(d,$){const st=new Map;for(const lt of d)for(const ht of $){const[dt,mt]=ht.split("/"),Tt=lt.getLayer(dt);if(!Tt||!Tt.hasBand(mt)||!Tt.hasDataForBand(mt))continue;const{bytes:Pt,tileSize:Mt,buffer:Ht}=Tt.getBandView(mt),$t=Mt+2*Ht,qt={data:new c.q({width:$t,height:$t},Pt),pixelRatio:2,sdf:!1,usvg:!1,version:0};st.set(ht,qt)}return st}queryRasterArrayValueByBandId(d,$,st){const lt=$._mrt;return new Promise(ht=>{const dt={},mt=new Set;for(const[Tt,Pt]of Object.entries(lt.layers)){if(st.layerName&&Tt!==st.layerName)continue;const Mt={};dt[Tt]=Mt;for(const{bands:Ht}of Pt.dataIndex)for(const $t of Ht)st.bands&&!st.bands.includes($t)||(mt.add(c.B(Tt,$t)),$.fetchBand(Tt,null,$t,qt=>{c.o.frame(()=>{Mt[$t]=qt?null:Hu([d.lng,d.lat],lt,Pt.getBandView($t)),mt.delete(c.B(Tt,$t)),mt.size===0&&ht(dt)})},!1))}mt.size===0&&ht(dt)})}_loadTileForQuery(d,$){if(this._loadTileLoaded[d.uid])return void $(null,d._mrt);if(this._loadTilePending[d.uid])return void this._loadTilePending[d.uid].push($);this._loadTilePending[d.uid]=[$];const st=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),lt=this.map._requestManager.transformRequest(st,c.R.Tile);d.actor.send("loadTile",{request:lt,uid:d.uid,tileID:d.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(ht,dt,mt)=>{if(ht)return this._loadTilePending[d.uid].forEach(Tt=>Tt(ht,null)),void delete this._loadTilePending[d.uid];if(!dt)return this._loadTilePending[d.uid].forEach(Tt=>Tt(null,null)),void delete this._loadTilePending[d.uid];if(this.map._refreshExpiredTiles&&dt){const Tt=c.aM(mt);d.setExpiryData(Tt)}d._mrt=dt,d._isHeaderLoaded=!0,d.state="loaded",this._loadTilePending[d.uid].forEach(Tt=>Tt(null,dt)),this._loadTileLoaded[d.uid]=!0,delete this._loadTilePending[d.uid]},void 0,!0)}queryRasterArrayValueByAllBands(d,$,st){return new Promise((lt,ht)=>{this._loadTileForQuery($,(dt,mt)=>{dt?ht(dt):lt(mt?this.queryRasterArrayValueByBandId(d,$,st):null)})})}queryRasterArrayValue(d,$){const st=c.aT.convert(d),lt=this.findLoadedParent(st);return lt&&lt._mrt?$.bands||!this.partial?this.queryRasterArrayValueByBandId(st,lt,$):this.queryRasterArrayValueByAllBands(st,lt,$):Promise.resolve(null)}findLoadedParent(d){const $=c.ae.fromLngLat(d,this.map.transform.tileSize),st=this.maxzoom+1,lt=1<<st,ht=Math.floor($.x),dt=Math.floor(($.x-ht)*lt),mt=Math.floor($.y*lt),Tt=this.map.style.getSourceCache(this.id),Pt=new c.aQ(st,ht,st,dt,mt);return Tt.findLoadedParent(Pt,this.minzoom)}}const kp={vector:Km,raster:Jl,"raster-dem":class extends Jl{constructor(it,d,$,st){super(it,d,$,st),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}loadTile(it,d){const $=this.map._requestManager.normalizeTileURL(it.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function st(lt,ht){lt&&(it.state="errored",d(lt)),ht&&(it.dem=ht,it.dem.onDeserialize(),it.needsHillshadePrepare=!0,it.needsDEMTextureUpload=!0,it.state="loaded",d(null))}it.request=c.n(this.map._requestManager.transformRequest($,c.R.Tile),(function(lt,ht,dt){if(delete it.request,it.aborted)it.state="unloaded",d(null);else if(lt)it.state="errored",d(lt);else if(ht){const mt=c.aM(dt);this.map._refreshExpiredTiles&&it.setExpiryData(mt);const Tt=ImageBitmap&&ht instanceof ImageBitmap&&c.r(),Pt=1-(ht.width-c.aP(ht.width))/2;Pt<1||it.neighboringTiles||(it.neighboringTiles=this._getNeighboringTiles(it.tileID));const Mt=Tt?ht:c.o.getImageData(ht,Pt),Ht={uid:it.uid,tileID:it.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:Mt,encoding:this.encoding,padding:Pt};it.actor&&it.state!=="expired"||(it.actor=this.dispatcher.getActor(),it.actor.send("loadTile",Ht,st.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(it){const d=it.canonical,$=Math.pow(2,d.z),st=(d.x-1+$)%$,lt=d.x===0?it.wrap-1:it.wrap,ht=(d.x+1+$)%$,dt=d.x+1===$?it.wrap+1:it.wrap,mt={};return mt[new c.aQ(it.overscaledZ,lt,d.z,st,d.y).key]={backfilled:!1},mt[new c.aQ(it.overscaledZ,dt,d.z,ht,d.y).key]={backfilled:!1},d.y>0&&(mt[new c.aQ(it.overscaledZ,lt,d.z,st,d.y-1).key]={backfilled:!1},mt[new c.aQ(it.overscaledZ,it.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},mt[new c.aQ(it.overscaledZ,dt,d.z,ht,d.y-1).key]={backfilled:!1}),d.y+1<$&&(mt[new c.aQ(it.overscaledZ,lt,d.z,st,d.y+1).key]={backfilled:!1},mt[new c.aQ(it.overscaledZ,it.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},mt[new c.aQ(it.overscaledZ,dt,d.z,ht,d.y+1).key]={backfilled:!1}),mt}},"raster-array":bu,geojson:class extends c.E{constructor(it,d,$,st){super(),this.id=it,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=$.getActor(),this.setEventedParent(st),this._data=d.data,this._options=Object.assign({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.minzoom!==void 0&&(this.minzoom=d.minzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const lt=c.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*lt,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*lt,extent:c.al,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:c.al,radius:(d.clusterRadius!==void 0?d.clusterRadius:50)*lt,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter,dynamic:d.dynamic},d.workerOptions)}onAdd(it){this.map=it,this.setData(this._data)}setData(it){return this._data=it,this._updateWorkerData(),this}updateData(it){if(!this._options.dynamic)return this.fire(new c.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof it!="string"&&(it.type==="Feature"&&(it={type:"FeatureCollection",features:[it]}),it.type!=="FeatureCollection"))return this.fire(new c.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof it!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const d=new Map;for(const $ of this._data.features)d.set($.id,$);for(const $ of it.features)d.set($.id,$);this._data.features=[...d.values()]}else this._data=it;return this._updateWorkerData(!0),this}getClusterExpansionZoom(it,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:it,source:this.id,scope:this.scope},d),this}getClusterChildren(it,d){return this.actor.send("geojson.getClusterChildren",{clusterId:it,source:this.id,scope:this.scope},d),this}getClusterLeaves(it,d,$,st){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:it,limit:d,offset:$},st),this}_updateWorkerData(it=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new c.z("dataloading",{dataType:"source"})),this._loaded=!1;const d=Object.assign({append:it},this.workerOptions);d.scope=this.scope;const $=this._data;typeof $=="string"?(d.request=this.map._requestManager.transformRequest(c.o.resolveURL($),c.R.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify($),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(st,lt)=>{if(this._loaded=!0,this._pendingLoad=null,st)this.fire(new c.y(st));else{const ht={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&lt&&lt.resourceTiming&&lt.resourceTiming[this.id]&&(ht.resourceTiming=lt.resourceTiming[this.id]),it&&(this._partialReload=!0),this.fire(new c.z("data",ht)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(it),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const it=c.B(this.id,this.scope);this.map.style.clearSource(it),this._updateWorkerData()}loadTile(it,d){const $=it.actor?"reloadTile":"loadTile";it.actor=this.actor;const st=this.map.style?this.map.style.getLut(this.scope):null,lt=st?{image:st.image.clone()}:null,ht=this._partialReload,dt={type:this.type,uid:it.uid,tileID:it.tileID,tileZoom:it.tileZoom,zoom:it.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:lt,scope:this.scope,pixelRatio:c.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:it.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:ht,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};it.request=this.actor.send($,dt,(mt,Tt)=>ht&&!Tt?(it.state="loaded",d(null)):(delete it.request,it.destroy(!1),it.aborted?d(null):mt?d(mt):(it.loadVectorData(Tt,this.map.painter,$==="reloadTile"),d(null))),void 0,$==="loadTile")}abortTile(it){it.request&&(it.request.cancel(),delete it.request),it.aborted=!0}unloadTile(it,d){this.actor.send("removeTile",{uid:it.uid,type:this.type,source:this.id,scope:this.scope}),it.destroy()}onRemove(it){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends c.aU{constructor(it,d,$,st){super(it,d,$,st),this.roundZoom=!0,this.type="video",this.options=d}load(){this._loaded=!1;const it=this.options;this.urls=[];for(const d of it.urls)this.urls.push(this.map._requestManager.transformRequest(d,c.R.Source).url);c.aV(this.urls,(d,$)=>{this._loaded=!0,d?this.fire(new c.y(d)):$&&(this.video=$,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(it){if(this.video){const d=this.video.seekable;it<d.start(0)||it>d.end(0)?this.fire(new c.y(new c.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=it}}getVideo(){return this.video}onAdd(it){this.map||(this.map=it,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const it=this.map.painter.context,d=it.gl;this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(it,this.video,d.RGBA8),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(it)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:c.aU,model:c.aX,"batched-model":class extends c.E{constructor(it,d,$,st){super(),this.type="batched-model",this.id=it,this.tileSize=512,this._options=d,this.tiles=this._options.tiles,this.maxzoom=d.maxzoom||19,this.minzoom=d.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=$,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(st)}onAdd(it){this.map=it,this.load()}reload(){this.cancelTileJSONRequest();const it=c.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(it))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(it){this._loaded=!1,this.fire(new c.z("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,$=this.map.getWorldview();this._tileJSONRequest=lu(this._options,this.map._requestManager,d,$,(st,lt)=>{this._tileJSONRequest=null,this._loaded=!0,st?(d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),$&&$.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${$}`),this.fire(new c.y(st))):lt&&(Object.assign(this,lt),lt.bounds&&(this.tileBounds=new Mu(lt.bounds,this.minzoom,this.maxzoom)),fn(lt.tiles,this.map._requestManager._customAccessToken),this.fire(new c.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))),it&&it(st)})}hasTransition(){return!1}hasTile(it){return!this.tileBounds||this.tileBounds.contains(it.canonical)}loaded(){return this._loaded}loadTile(it,d){const $=this.map._requestManager.normalizeTileURL(it.tileID.canonical.url(this.tiles,this.scheme)),st={request:this.map._requestManager.transformRequest($,c.R.Tile),data:void 0,uid:it.uid,tileID:it.tileID,tileZoom:it.tileZoom,zoom:it.tileID.overscaledZ,tileSize:this.tileSize*it.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:it.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:c.o.devicePixelRatio,promoteId:this.promoteId};if(it.actor&&it.state!=="expired")if(it.state==="loading")it.reloadCallback=d;else{if(it.buckets){const ht=Object.values(it.buckets);for(const dt of ht)dt.dirty=!0;return void(it.state="loaded")}it.request=it.actor.send("reloadTile",st,lt.bind(this))}else it.actor=this.dispatcher.getActor(),it.request=it.actor.send("loadTile",st,lt.bind(this),void 0,!0);function lt(ht,dt){return it.aborted?d(null):ht&&ht.status!==404?d(ht):(this.map._refreshExpiredTiles&&dt&&it.setExpiryData(dt),it.loadModelData(dt,this.map.painter),it.state="loaded",void d(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends c.aU{constructor(it,d,$,st){super(it,d,$,st),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(lt=>!Array.isArray(lt)||lt.length!==2||lt.some(ht=>typeof ht!="number"))||this.fire(new c.y(new c.V(`sources.${it}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.y(new c.V(`sources.${it}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new c.y(new c.V(`sources.${it}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new c.y(new c.V(`sources.${it}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.y(new c.V(`sources.${it}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(it){this.map=it,this.load(),this.canvas&&this.animate&&this.play()}onRemove(it){this.pause()}prepare(){let it=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,it=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,it=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context;this.texture?!it&&!this._playing||this.texture instanceof c.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.T(d,this.canvas,d.gl.RGBA8,{premultiply:!0}),this._prepareData(d)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const it of[this.canvas.width,this.canvas.height])if(isNaN(it)||it<=0)return!0;return!1}},custom:class extends c.E{constructor(it,d,$,st){super(),this.id=it,this.type="custom",this._dataType="raster",this._dispatcher=$,this._implementation=d,this.setEventedParent(st),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new c.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new c.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Mu(this._implementation.bounds,this.minzoom,this.maxzoom)),d.update=this._update.bind(this),d.clearTiles=this._clearTiles.bind(this),d.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,c.aH(d,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return c.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new c.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(it){this.map=it,this._loaded=!1,this.fire(new c.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(it),this.load()}onRemove(it){this._implementation.onRemove&&this._implementation.onRemove(it)}hasTile(it){if(this._implementation.hasTile){const{x:d,y:$,z:st}=it.canonical;return this._implementation.hasTile({x:d,y:$,z:st})}return!this.tileBounds||this.tileBounds.contains(it.canonical)}loadTile(it,d){const{x:$,y:st,z:lt}=it.tileID.canonical,ht=new AbortController;it.request=Promise.resolve(this._implementation.loadTile({x:$,y:st,z:lt},{signal:ht.signal})).then((function(dt){return delete it.request,it.aborted?(it.state="unloaded",d(null)):dt===void 0?(it.state="errored",d(null)):dt===null?(this.loadTileData(it,{width:this.tileSize,height:this.tileSize,data:null}),it.state="loaded",d(null)):function(mt){return mt instanceof ImageData||mt instanceof HTMLCanvasElement||mt instanceof ImageBitmap||mt instanceof HTMLImageElement}(dt)?(this.loadTileData(it,dt),it.state="loaded",void d(null)):(it.state="errored",d(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(dt=>{dt.name!=="AbortError"&&(it.state="errored",d(dt))}),it.request.cancel=()=>ht.abort()}loadTileData(it,d){it.setTexture(d,this.map.painter)}unloadTile(it,d){if(it.texture&&it.texture instanceof c.T?(it.destroy(!1),it.texture&&it.texture instanceof c.T&&this.map.painter.saveTileTexture(it.texture)):it.destroy(),this._implementation.unloadTile){const{x:$,y:st,z:lt}=it.tileID.canonical;this._implementation.unloadTile({x:$,y:st,z:lt})}d&&d()}abortTile(it,d){it.request&&it.request.cancel&&(it.request.cancel(),delete it.request),d&&d()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(it=>({x:it.canonical.x,y:it.canonical.y,z:it.canonical.z}))}_clearTiles(){const it=c.B(this.id,this.scope);this.map.style.clearSource(it)}_update(){this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))}}},Xl=function(it,d,$,st){const lt=new kp[d.type](it,d,$,st);if(lt.id!==it)throw new Error(`Expected Source id to be ${it} instead of ${lt.id}`);return c.aY(["load","abort","unload","serialize","prepare"],lt),lt};function Xm(it,d,$=""){return`${$}:${d.id||""}:${d.layer.id}:${function(st){if("layerId"in st)return`layer:${st.layerId}`;{const{featuresetId:lt,importId:ht}=st;return`featureset:${lt}${ht?`:import:${ht}`:""}`}}(it.target)}`}function v0(it,d,$,st=""){if(it.uniqueFeatureID){const lt=Xm(it,d,st);if($.has(lt))return!0;$.add(lt)}return!1}function ay(it,d,$,st,lt=!1){const ht=d.sourceCache.transform,dt=d.sourceCache.tilesIn(it,d.has3DLayers,lt);dt.sort(a_);const mt=[];for(const Tt of dt){const Pt=Tt.tile.queryRenderedFeatures(d,Tt,$,st,ht,lt);Object.keys(Pt).length&&mt.push({wrappedTileID:Tt.tile.tileID.wrapped().key,queryResults:Pt})}for(const Tt in d.layers){const Pt=d.layers[Tt];if(Pt.styleLayer){const Mt=Pt.styleLayer.queryRenderedFeatures(it,d.sourceCache,st);Object.keys(Mt).length&&mt.push({wrappedTileID:0,queryResults:Mt})}}return mt.length===0?{}:function(Tt){const Pt={},Mt={};for(const Ht of Tt){const $t=Ht.queryResults,qt=Ht.wrappedTileID,Qt=Mt[qt]=Mt[qt]||{};for(const Xt in $t){const sr=$t[Xt],ir=Qt[Xt]=Qt[Xt]||{},hr=Pt[Xt]=Pt[Xt]||[];for(const mr of sr)ir[mr.featureIndex]||(ir[mr.featureIndex]=!0,hr.push(mr))}}return Pt}(mt)}function ly(it,d,$,st,lt,ht){const dt={},mt=st.queryRenderedSymbols(it),Tt=[];for(const Pt of Object.keys(mt).map(Number))Tt.push(lt[Pt]);Tt.sort(a_);for(const Pt of Tt){const Mt=Pt.featureIndex.lookupSymbolFeatures(mt[Pt.bucketInstanceId],Pt.bucketIndex,Pt.sourceLayerIndex,d,$,ht);for(const Ht in Mt){const $t=dt[Ht]=dt[Ht]||[],qt=Mt[Ht];qt.sort((Qt,Xt)=>{const sr=Pt.featureSortOrder;if(sr){const ir=sr.indexOf(Qt.featureIndex);return sr.indexOf(Xt.featureIndex)-ir}return Xt.featureIndex-Qt.featureIndex});for(const Qt of qt)$t.push(Qt)}}return dt}function cy(it,d){const $=it.getRenderableIds().map(ht=>it.getTileByID(ht)),st=[],lt={};for(let ht=0;ht<$.length;ht++){const dt=$[ht],mt=dt.tileID.canonical.key;lt[mt]||(lt[mt]=!0,dt.querySourceFeatures(st,d))}return st}function a_(it,d){const $=it.tileID,st=d.tileID;return $.overscaledZ-st.overscaledZ||$.canonical.y-st.canonical.y||$.wrap-st.wrap||$.canonical.x-st.canonical.x}function Mp(it,d){const $={};if(!d)return $;for(const st of it){const lt=st.layerIds.map(ht=>d.getLayer(ht)).filter(Boolean);if(lt.length!==0){st.layers=lt,st.stateDependentLayerIds&&(st.stateDependentLayers=st.stateDependentLayerIds.map(ht=>lt.filter(dt=>dt.id===ht)[0]));for(const ht of lt)$[ht.fqid]=st}}return $}const Du=32,_p=33,yp=new Uint16Array(8184);for(let it=0;it<2046;it++){let d=it+2,$=0,st=0,lt=0,ht=0,dt=0,mt=0;for(1&d?lt=ht=dt=Du:$=st=mt=Du;(d>>=1)>1;){const Pt=$+lt>>1,Mt=st+ht>>1;1&d?(lt=$,ht=st,$=dt,st=mt):($=lt,st=ht,lt=dt,ht=mt),dt=Pt,mt=Mt}const Tt=4*it;yp[Tt+0]=$,yp[Tt+1]=st,yp[Tt+2]=lt,yp[Tt+3]=ht}const rp=new Uint16Array(2178),Dp=new Uint8Array(1089),bm=new Uint16Array(1089);function Zm(it){return it===0?-.03125:it===32?.03125:0}const uy={type:2,extent:c.al,loadGeometry:()=>[[new c.P(0,0),new c.P(c.al+1,0),new c.P(c.al+1,c.al+1),new c.P(0,c.al+1),new c.P(0,0)]]};class Ym{constructor(d,$,st,lt,ht,dt){this.tileID=d,this.uid=c.b2(),this.uses=0,this.tileSize=$,this.tileZoom=st,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=ht,lt&&lt.style&&(this._lastUpdatedBrightness=lt.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",lt&&lt.transform&&(this.projection=lt.transform.projection),this.worldview=dt,this._hasAppearances=null}registerFadeDuration(d){const $=d+this.timeAdded;$<c.o.now()||this.fadeEndTime&&$<this.fadeEndTime||(this.fadeEndTime=$)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=c.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(d,$,st){if(this.unloadVectorData(),this.state="loaded",d){d.featureIndex&&(this.latestFeatureIndex=d.featureIndex,d.rawTileData?(this.latestRawTileData=d.rawTileData,this.latestFeatureIndex.rawTileData=d.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=d.collisionBoxArray,this.buckets=Mp(d.buckets,$.style),this.hasSymbolBuckets=!1;for(const lt in this.buckets){const ht=this.buckets[lt];if(ht instanceof c.b4){if(this.hasSymbolBuckets=!0,!st)break;ht.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const lt in this.buckets){const ht=this.buckets[lt];if(ht instanceof c.b4&&ht.hasRTLText){this.hasRTLText=!0,c.b5();break}}this.queryPadding=0;for(const lt in this.buckets){const ht=this.buckets[lt],dt=$.style.getOwnLayer(lt);if(!dt)continue;const mt=dt.queryRadius(ht);this.queryPadding=Math.max(this.queryPadding,mt)}d.imageAtlas&&(this.imageAtlas=d.imageAtlas),d.glyphAtlasImage&&(this.glyphAtlasImage=d.glyphAtlasImage),d.lineAtlas&&(this.lineAtlas=d.lineAtlas),this._lastUpdatedBrightness=d.brightness}else this.collisionBoxArray=new c.b3}unloadVectorData(){if(this.hasData()){for(const d in this.buckets)this.buckets[d].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(d,$,st){d&&(d.resourceTiming&&(this.resourceTiming=d.resourceTiming),this.buckets=Object.assign({},this.buckets,Mp(d.buckets,$.style)),d.featureIndex&&(this.latestFeatureIndex=d.featureIndex))}getBucket(d){return this.buckets[d.fqid]}upload(d,$){for(const ht in this.buckets){const dt=this.buckets[ht];if(dt.uploadPending()){let mt={},Tt=[],Pt={zoom:0,pitch:0,brightness:0,worldview:""};if($){if($.style){Tt=$.style.listImages();const Mt=dt.layers[0],Ht=Mt.sourceLayer||"_geojsonTileLayer",$t=$.style.getLayerSourceCache(Mt);$t&&(mt=$t._state.getState(Ht,void 0))}Pt={zoom:$.transform.zoom||0,pitch:$.transform.pitch||0,brightness:$.style.getBrightness()||0,worldview:$.worldview||""}}dt.upload(d,this.tileID.canonical,mt,Tt,Pt)}}const st=d.gl,lt=this.imageAtlas;lt&&!lt.uploaded&&(this.imageAtlasTexture=new c.T(d,lt.image,st.RGBA8,{useMipmap:!!lt.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(d,this.glyphAtlasImage,st.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new c.T(d,this.lineAtlas.image,st.R8),this.lineAtlas.uploaded=!0)}prepare(d,$,st){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(d,this.imageAtlasTexture,st),!$||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const lt=$.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances($)),(this._lastUpdatedBrightness||lt||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&lt&&Math.abs(this._lastUpdatedBrightness-lt)<.001||(this.updateBuckets($,this._lastUpdatedBrightness!==lt),this._lastUpdatedBrightness=lt))}evaluateQueryRenderedFeaturePadding(){let d=0;for(const $ in this.buckets){const st=this.buckets[$];st.evaluateQueryRenderedFeaturePadding&&(d=Math.max(d,st.evaluateQueryRenderedFeaturePadding()))}return d}queryRenderedFeatures(d,$,st,lt,ht,dt){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const mt=this.evaluateQueryRenderedFeaturePadding(),Tt=function(Pt,Mt){const Ht=c.bq([],[.5*Pt.width,.5*-Pt.height,1]);return c.br(Ht,Ht,[1,-1,0]),c.aB(Ht,Ht,Pt.calculateProjMatrix(Mt.toUnwrapped())),Float32Array.from(Ht)}(ht,this.tileID);return this.latestFeatureIndex.query(d,{tilespaceGeometry:$,pixelPosMatrix:Tt,transform:lt,availableImages:st,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:mt})}querySourceFeatures(d,$){const st=this.latestFeatureIndex;if(!st||!st.rawTileData)return;const lt=st.loadVTLayers(),ht=$?$.sourceLayer:"",dt=lt._geojsonTileLayer||lt[ht];if(!dt)return;const mt=c.b6($&&$.filter),{z:Tt,x:Pt,y:Mt}=this.tileID.canonical,Ht={z:Tt,x:Pt,y:Mt};for(let $t=0;$t<dt.length;$t++){const qt=dt.feature($t);if(mt.needGeometry){const sr=c.b7(qt,!0);if(!mt.filter(new c.ac(this.tileID.overscaledZ,{worldview:this.worldview}),sr,this.tileID.canonical))continue}else if(!mt.filter(new c.ac(this.tileID.overscaledZ,{worldview:this.worldview}),qt))continue;const Qt=st.getId(qt,ht),Xt=new c.b8(qt,Tt,Pt,Mt,Qt);Xt.tile=Ht,d.push(Xt)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(d){const $=this.expirationTime;if(d.cacheControl){const st=c.b9(d.cacheControl);st["max-age"]&&(this.expirationTime=Date.now()+1e3*st["max-age"])}else d.expires&&(this.expirationTime=new Date(d.expires).getTime());if(this.expirationTime){const st=Date.now();let lt=!1;if(this.expirationTime>st)lt=!1;else if($)if(this.expirationTime<$)lt=!0;else{const ht=this.expirationTime-$;ht?this.expirationTime=st+Math.max(ht,3e4):lt=!0}else lt=!0;lt?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(d){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&d&&this.updateBuckets(d)}hasAppearances(d){for(const $ in this.buckets)if(d.style.hasLayer($)&&this.buckets[$].layers.some(st=>st.appearances&&st.appearances.length>0))return!0;return!1}updateBuckets(d,$){if(!this.latestFeatureIndex||!d.style)return;const st=d.style.listImages(),lt=d.style.getBrightness();for(const ht in this.buckets){if(!d.style.hasLayer(ht))continue;const dt=this.buckets[ht],mt=dt.layers[0],Tt=mt.sourceLayer||"_geojsonTileLayer",Pt=d.style.getLayerSourceCache(mt);let Mt={};Pt&&(Mt=Pt._state.getState(Tt,void 0));const Ht=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},$t=Object.keys(Mt).length>0&&!$;dt.hasAppearances=dt.layers.some(Xt=>Xt.appearances&&Xt.appearances.length>0);const qt=$t?dt.stateDependentLayers:dt.layers;if($t&&dt.stateDependentLayers.length!==0||$){const Xt=this.latestFeatureIndex.loadVTLayers();dt.update(Mt,Xt[Tt],st,Ht,qt,$,lt)}if($t&&dt.stateDependentLayers.length!==0||$||dt.hasAppearances){const Xt={zoom:d.transform.zoom,pitch:d.transform.pitch,brightness:d.style.getBrightness()||0,worldview:d.worldview};dt.updateAppearances(this.tileID.canonical,Mt,st,Xt)}(dt instanceof c.ba||dt instanceof c.bb)&&d._terrain&&d._terrain.enabled&&Pt&&dt.uploadPending()&&d._terrain._clearRenderCacheForTile(Pt.id,this.tileID);const Qt=d&&d.style&&d.style.getOwnLayer(ht);Qt&&(this.queryPadding=Math.max(this.queryPadding,Qt.queryRadius(dt)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<c.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(d){this.symbolFadeHoldUntil=c.o.now()+d}setTexture(d,$){const st=$.context,lt=st.gl;this.texture=this.texture||$.getTileTexture(d.width),this.texture&&this.texture instanceof c.T?this.texture.update(d):(this.texture=new c.T(st,d,lt.RGBA8,{useMipmap:!0}),this.texture.bind(lt.LINEAR,lt.CLAMP_TO_EDGE))}setDependencies(d,$){const st={};for(const lt of $)st[lt]=!0;this.dependencies[d]=st}hasDependency(d,$){for(const st of d){const lt=this.dependencies[st];if(lt){for(const ht of $)if(lt[ht])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(d,$){if(!$||$.name==="mercator"||this._tileDebugBuffer)return;const st=c.bc(uy,this.tileID.canonical,this.tileTransform)[0],lt=new c.bd,ht=new c.be;for(let dt=0;dt<st.length;dt++){const{x:mt,y:Tt}=st[dt];lt.emplaceBack(mt,Tt),ht.emplaceBack(dt)}ht.emplaceBack(0),this._tileDebugIndexBuffer=d.createIndexBuffer(ht),this._tileDebugBuffer=d.createVertexBuffer(lt,c.bf.members),this._tileDebugSegments=c.bg.simpleSegment(0,0,lt.length,ht.length)}_makeTileBoundsBuffers(d,$){if(this._tileBoundsBuffer||!$||$.name==="mercator")return;const st=c.bc(uy,this.tileID.canonical,this.tileTransform)[0];let lt,ht;if(this.isRaster){const dt=function(mt,Tt){const Pt=c.aZ(mt,Tt),Mt=Math.pow(2,mt.z);for(let sr=0;sr<_p;sr++)for(let ir=0;ir<_p;ir++){const hr=c.a_((mt.x+(ir+Zm(ir))/Du)/Mt),mr=c.a$((mt.y+(sr+Zm(sr))/Du)/Mt),dr=Tt.project(hr,mr),Ir=sr*_p+ir;rp[2*Ir+0]=Math.round((dr.x*Pt.scale-Pt.x)*c.al),rp[2*Ir+1]=Math.round((dr.y*Pt.scale-Pt.y)*c.al)}Dp.fill(0),bm.fill(0);for(let sr=2045;sr>=0;sr--){const ir=4*sr,hr=yp[ir+0],mr=yp[ir+1],dr=yp[ir+2],Ir=yp[ir+3],Tr=hr+dr>>1,Ar=mr+Ir>>1,Er=Tr+Ar-mr,vr=Ar+hr-Tr,Pr=mr*_p+hr,Br=Ir*_p+dr,Or=Ar*_p+Tr,Yr=Math.hypot((rp[2*Pr+0]+rp[2*Br+0])/2-rp[2*Or+0],(rp[2*Pr+1]+rp[2*Br+1])/2-rp[2*Or+1])>=16;Dp[Or]=Dp[Or]||(Yr?1:0),sr<1022&&(Dp[Or]=Dp[Or]||Dp[(mr+vr>>1)*_p+(hr+Er>>1)]||Dp[(Ir+vr>>1)*_p+(dr+Er>>1)])}const Ht=new c.b1,$t=new c.b0;let qt=0;function Qt(sr,ir){const hr=ir*_p+sr;return bm[hr]===0&&(Ht.emplaceBack(rp[2*hr+0],rp[2*hr+1],sr*c.al/Du,ir*c.al/Du),bm[hr]=++qt),bm[hr]-1}function Xt(sr,ir,hr,mr,dr,Ir){const Tr=sr+hr>>1,Ar=ir+mr>>1;if(Math.abs(sr-dr)+Math.abs(ir-Ir)>1&&Dp[Ar*_p+Tr])Xt(dr,Ir,sr,ir,Tr,Ar),Xt(hr,mr,dr,Ir,Tr,Ar);else{const Er=Qt(sr,ir),vr=Qt(hr,mr),Pr=Qt(dr,Ir);$t.emplaceBack(Er,vr,Pr)}}return Xt(0,0,Du,Du,Du,0),Xt(Du,Du,0,0,0,Du),{vertices:Ht,indices:$t}}(this.tileID.canonical,$);lt=dt.vertices,ht=dt.indices}else{lt=new c.b1,ht=new c.b0;for(const{x:mt,y:Tt}of st)lt.emplaceBack(mt,Tt,0,0);const dt=c.bh(lt.int16.subarray(0,4*lt.length),void 0,4);for(let mt=0;mt<dt.length;mt+=3)ht.emplaceBack(dt[mt],dt[mt+1],dt[mt+2])}this._tileBoundsBuffer=d.createVertexBuffer(lt,c.bi.members),this._tileBoundsIndexBuffer=d.createIndexBuffer(ht),this._tileBoundsSegments=c.bg.simpleSegment(0,0,lt.length,ht.length)}_makeGlobeTileDebugBuffers(d,$){const st=$.projection;if(!st||st.name!=="globe"||$.freezeTileCoverage)return;const lt=this.tileID.canonical,ht=c.bj(lt,$),dt=c.bk(ht),mt=c.aj($.zoom);let Tt;mt>0&&(Tt=c.bl(new Float64Array(16),$.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(d,lt,$,dt,Tt,mt),this._makeGlobeTileDebugTextBuffer(d,lt,$,dt,Tt,mt)}_globePoint(d,$,st,lt,ht,dt,mt){let Tt=c.bm(d,$,st);if(dt){const Pt=1<<st.z,Mt=c.aF(lt.center.lng),Ht=c.aJ(lt.center.lat),$t=(st.x+.5)/Pt-Mt;let qt=0;$t>.5?qt=-1:$t<-.5&&(qt=1);let Qt=(d/c.al+st.x)/Pt+qt,Xt=($/c.al+st.y)/Pt;Qt=(Qt-Mt)*lt._pixelsPerMercatorPixel+Mt,Xt=(Xt-Ht)*lt._pixelsPerMercatorPixel+Ht;const sr=[Qt*lt.worldSize,Xt*lt.worldSize,0];c.af(sr,sr,dt),Tt=c.bn(Tt,sr,mt)}return c.af(Tt,Tt,ht)}_makeGlobeTileDebugBorderBuffer(d,$,st,lt,ht,dt){const mt=new c.bd,Tt=new c.be,Pt=new c.bo,Mt=($t,qt,Qt,Xt,sr)=>{const ir=(Qt-$t)/(sr-1),hr=(Xt-qt)/(sr-1),mr=mt.length;for(let dr=0;dr<sr;dr++){const Ir=$t+dr*ir,Tr=qt+dr*hr;mt.emplaceBack(Ir,Tr);const Ar=this._globePoint(Ir,Tr,$,st,lt,ht,dt);Pt.emplaceBack(Ar[0],Ar[1],Ar[2]),Tt.emplaceBack(mr+dr)}},Ht=c.al;Mt(0,0,Ht,0,16),Mt(Ht,0,Ht,Ht,16),Mt(Ht,Ht,0,Ht,16),Mt(0,Ht,0,0,16),this._tileDebugIndexBuffer=d.createIndexBuffer(Tt),this._tileDebugBuffer=d.createVertexBuffer(mt,c.bf.members),this._globeTileDebugBorderBuffer=d.createVertexBuffer(Pt,c.bp.members),this._tileDebugSegments=c.bg.simpleSegment(0,0,mt.length,Tt.length)}_makeGlobeTileDebugTextBuffer(d,$,st,lt,ht,dt){const mt=c.al/4,Tt=new c.bd,Pt=new c.b0,Mt=new c.bo,Ht=25;Pt.reserve(32),Tt.reserve(Ht),Mt.reserve(Ht);const $t=(qt,Qt)=>Ht*qt+Qt;for(let qt=0;qt<Ht;qt++){const Qt=qt*mt;for(let Xt=0;Xt<Ht;Xt++){const sr=Xt*mt;Tt.emplaceBack(sr,Qt);const ir=this._globePoint(sr,Qt,$,st,lt,ht,dt);Mt.emplaceBack(ir[0],ir[1],ir[2])}}for(let qt=0;qt<4;qt++)for(let Qt=0;Qt<4;Qt++){const Xt=$t(qt,Qt),sr=$t(qt,Qt+1),ir=$t(qt+1,Qt),hr=$t(qt+1,Qt+1);Pt.emplaceBack(Xt,sr,ir),Pt.emplaceBack(ir,sr,hr)}this._tileDebugTextIndexBuffer=d.createIndexBuffer(Pt),this._tileDebugTextBuffer=d.createVertexBuffer(Tt,c.bf.members),this._globeTileDebugTextBuffer=d.createVertexBuffer(Mt,c.bp.members),this._tileDebugTextSegments=c.bg.simpleSegment(0,0,Ht,32)}destroy(d=!0){for(const $ in this.buckets)this.buckets[$].destroy(d);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),d&&this.texture&&this.texture instanceof c.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof c.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}c.bs.setPbf(c.bt);class hy extends Ym{constructor(d,$,st,lt,ht){super(d,$,st,lt,ht),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(d){return this._mrt&&this._mrt.getLayer(d)}setTexturePerLayer(d,$,st){const lt=st.context,ht=lt.gl;let dt=this.texturePerLayer.get(d)||st.getTileTexture($.width);dt&&dt instanceof c.T?dt.update($,{premultiply:!1}):dt=new c.T(lt,$,ht.RGBA8,{premultiply:!1}),this.texturePerLayer.has(d)||this.texturePerLayer.set(d,dt)}flushQueues(d){const $=this._workQueuePerLayer.get(d)||[],st=this._fetchQueuePerLayer.get(d)||[];for(;$.length;)$.pop()();for(;st.length;)st.pop()()}flushAllQueues(){for(const d of this._workQueuePerLayer.keys()){const $=this._workQueuePerLayer.get(d)||[];for(;$.length;)$.pop()()}for(const d of this._fetchQueuePerLayer.keys()){const $=this._fetchQueuePerLayer.get(d)||[];for(;$.length;)$.pop()()}}fetchHeader(d=16384,$){const st=this._mrt=new c.bs(30),lt=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(d-1)}});return this.entireBuffer=null,this.request=c.bu(lt,(ht,dt,mt)=>{if(ht)$(ht);else try{const Tt=st.getHeaderLength(dt);if(Tt>d)return void(this.request=this.fetchHeader(Tt,$));st.parseHeader(dt),this._isHeaderLoaded=!0;let Pt=0;for(const Mt of Object.values(st.layers))Pt=Math.max(Pt,Mt.dataIndex[Mt.dataIndex.length-1].lastByte);dt.byteLength>=Pt&&(this.entireBuffer=dt),$(null,this.entireBuffer||dt,mt)}catch(Tt){$(Tt)}}),this.request}fetchBandForRender(d,$,st,lt){this.fetchBand(d,$,st,ht=>{if(ht)return void lt(ht);this.updateTextureDescriptor(d,$,st);const dt=this.textureDescriptorPerLayer.get($);lt(null,dt?dt.img:null)})}fetchBand(d,$,st,lt,ht=!0){const dt=this._mrt;if(!this._isHeaderLoaded||!dt)return void lt(new Error("Tile header is not ready"));const mt=this.actor;if(!mt)return void lt(new Error("Can't fetch tile band without an actor"));let Tt;const Pt=c.B(String(st),c.B(this.tileID.key,d));let Mt=this._taskQueue.get(Pt);Mt?Mt.add(lt):(Mt=new Set,Mt.add(lt),this._taskQueue.set(Pt,Mt));const Ht=(Xt,sr)=>{Tt.complete(Xt,sr),Xt?lt(Xt):(Mt.forEach(ir=>ir(null,sr)),this._taskQueue.delete(Pt))},$t=(Xt,sr)=>{if(Xt)return lt(Xt);const ir=mt.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:sr,task:Tt},Ht,void 0,!0);if($!==null){const hr=this._workQueuePerLayer.get($)||[];hr.push(()=>{ir&&ir.cancel(),Tt.cancel()}),this._workQueuePerLayer.has($)||this._workQueuePerLayer.set($,hr)}};let qt;try{qt=dt.getLayer(d)}catch(Xt){if(this.state==="reloading")return;throw Xt}if(!qt)return void lt(new Error(`Unknown sourceLayer "${d}"`));if(qt.hasDataForBand(st))return Mt.forEach(Xt=>Xt(null,null)),void this._taskQueue.delete(Pt);const Qt=qt.getDataRange([st]);if(Tt=dt.createDecodingTask(Qt),!Tt||Tt.tasks.length)if($!==null&&this.flushQueues($),this.entireBuffer)$t(null,this.entireBuffer.slice(Qt.firstByte,Qt.lastByte+1));else{const Xt=Object.assign({},this.requestParams,{headers:{Range:`bytes=${Qt.firstByte}-${Qt.lastByte}`}}),sr=c.bu(Xt,$t);if($!==null){const ir=this._fetchQueuePerLayer.get($)||[];ir.push(()=>{sr.cancel(),Tt.cancel()}),this._fetchQueuePerLayer.has($)||this._fetchQueuePerLayer.set($,ir)}}}updateNeeded(d,$){return(!this.textureDescriptorPerLayer.get(d)||this.textureDescriptorPerLayer.get(d).band!==$||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(d,$,st){if(!this._mrt)return;const lt=this._mrt.getLayer(d);if(!lt||!lt.hasBand(st)||!lt.hasDataForBand(st))return;const{bytes:ht,tileSize:dt,buffer:mt,offset:Tt,scale:Pt}=lt.getBandView(st),Mt=dt+2*mt,Ht=new c.q({width:Mt,height:Mt},ht),$t=this.texturePerLayer.get($);$t&&$t instanceof c.T&&$t.update(Ht,{premultiply:!1}),this.textureDescriptorPerLayer.set($,{layer:d,band:st,img:Ht,buffer:mt,offset:Tt,tileSize:dt,format:lt.pixelFormat,mix:[Pt,256*Pt,65536*Pt,16777216*Pt]})}destroy(d=!1){if(super.destroy(d),delete this._mrt,!d)for(const $ of this.texturePerLayer.values())$&&$ instanceof c.T&&$.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class J1{constructor(d,$){this.max=d,this.onRemove=$,this.reset()}reset(){for(const d in this.data)for(const $ of this.data[d])$.timeout&&clearTimeout($.timeout),this.onRemove($.value);return this.data={},this.order=[],this}add(d,$,st){const lt=d.wrapped().key;this.data[lt]===void 0&&(this.data[lt]=[]);const ht={value:$,timeout:void 0};if(st!==void 0&&(ht.timeout=setTimeout(()=>{this.remove(d,ht)},st)),this.data[lt].push(ht),this.order.push(lt),this.order.length>this.max){const dt=this._getAndRemoveByKey(this.order[0]);dt&&this.onRemove(dt)}return this}has(d){return d.wrapped().key in this.data}getAndRemove(d){return this.has(d)?this._getAndRemoveByKey(d.wrapped().key):null}_getAndRemoveByKey(d){const $=this.data[d].shift();return $.timeout&&clearTimeout($.timeout),this.data[d].length===0&&delete this.data[d],this.order.splice(this.order.indexOf(d),1),$.value}getByKey(d){const $=this.data[d];return $?$[0].value:null}get(d){return this.has(d)?this.data[d.wrapped().key][0].value:null}remove(d,$){if(!this.has(d))return this;const st=d.wrapped().key,lt=$===void 0?0:this.data[st].indexOf($),ht=this.data[st][lt];return this.data[st].splice(lt,1),ht.timeout&&clearTimeout(ht.timeout),this.data[st].length===0&&delete this.data[st],this.onRemove(ht.value),this.order.splice(this.order.indexOf(st),1),this}setMaxSize(d){for(this.max=d;this.order.length>this.max;){const $=this._getAndRemoveByKey(this.order[0]);$&&this.onRemove($)}return this}filter(d){const $=[];for(const st in this.data)for(const lt of this.data[st])d(lt.value)||$.push(lt);for(const st of $)this.remove(st.value.tileID,st)}}class l_{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(d,$,st){const lt=String($);if(this.stateChanges[d]=this.stateChanges[d]||{},this.stateChanges[d][lt]=this.stateChanges[d][lt]||{},Object.assign(this.stateChanges[d][lt],st),this.deletedStates[d]===null){this.deletedStates[d]={};for(const ht in this.state[d])ht!==lt&&(this.deletedStates[d][ht]=null)}else if(this.deletedStates[d]&&this.deletedStates[d][lt]===null){this.deletedStates[d][lt]={};for(const ht in this.state[d][lt])st[ht]||(this.deletedStates[d][lt][ht]=null)}else for(const ht in st)this.deletedStates[d]&&this.deletedStates[d][lt]&&this.deletedStates[d][lt][ht]===null&&delete this.deletedStates[d][lt][ht]}removeFeatureState(d,$,st){if(this.deletedStates[d]===null)return;const lt=String($);if(this.deletedStates[d]=this.deletedStates[d]||{},st&&$!==void 0)this.deletedStates[d][lt]!==null&&(this.deletedStates[d][lt]=this.deletedStates[d][lt]||{},this.deletedStates[d][lt][st]=null);else if($!==void 0)if(this.stateChanges[d]&&this.stateChanges[d][lt])for(st in this.deletedStates[d][lt]={},this.stateChanges[d][lt])this.deletedStates[d][lt][st]=null;else this.deletedStates[d][lt]=null;else this.deletedStates[d]=null}getState(d,$){const st=this.state[d]||{},lt=this.stateChanges[d]||{},ht=this.deletedStates[d];if(ht===null)return{};if($!==void 0){const mt=String($),Tt=Object.assign({},st[mt],lt[mt]);if(ht){const Pt=ht[$];if(Pt===null)return{};for(const Mt in Pt)delete Tt[Mt]}return Tt}const dt=Object.assign({},st,lt);if(ht)for(const mt in ht)delete dt[mt];return dt}initializeTileState(d,$){d.refreshFeatureState($)}coalesceChanges(d,$){const st={};for(const lt in this.stateChanges){this.state[lt]=this.state[lt]||{};const ht={};for(const dt in this.stateChanges[lt])this.state[lt][dt]||(this.state[lt][dt]={}),Object.assign(this.state[lt][dt],this.stateChanges[lt][dt]),ht[dt]=this.state[lt][dt];st[lt]=ht}for(const lt in this.deletedStates){this.state[lt]=this.state[lt]||{};const ht={};if(this.deletedStates[lt]===null)for(const dt in this.state[lt])ht[dt]={},this.state[lt][dt]={};else for(const dt in this.deletedStates[lt]){if(this.deletedStates[lt][dt]===null)this.state[lt][dt]={};else if(this.state[lt][dt])for(const mt of Object.keys(this.deletedStates[lt][dt]))delete this.state[lt][dt][mt];ht[dt]=this.state[lt][dt]}st[lt]=st[lt]||{},Object.assign(st[lt],ht)}if(this.stateChanges={},this.deletedStates={},Object.keys(st).length!==0)for(const lt in d)d[lt].refreshFeatureState($)}}class zu extends c.E{constructor(d,$,st){super(),this.id=d,this._onlySymbols=st,$.on("data",lt=>{lt.dataType==="source"&&lt.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&lt.dataType==="source"&&lt.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),$.on("error",()=>{this._sourceErrored=!0}),this._source=$,this._tiles={},this._cache=new J1(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=$.minTileCacheSize,this._maxTileCacheSize=$.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new l_,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(d){this.map=d,this._minTileCacheSize=this._minTileCacheSize===void 0&&d?d._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&d?d._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const d in this._tiles)if(!this._tiles[d].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const d=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,d&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(d,$){return d.isSymbolTile=this._onlySymbols,d.isExtraShadowCaster=this._shadowCasterTiles[d.tileID.key],this._source.loadTile(d,$)}_unloadTile(d){if(this._source.unloadTile)return this._source.unloadTile(d)}_abortTile(d){if(this._source.abortTile)return this._source.abortTile(d)}serialize(){return this._source.serialize()}prepare(d){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const $ in this._tiles){const st=this._tiles[$];st.upload(d,this.map?this.map.painter:void 0),st.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(d=>d.tileID).sort(dy).map(d=>d.key)}getRenderableIds(d,$){const st=[];for(const lt in this._tiles)this._isIdRenderable(+lt,d,$)&&st.push(this._tiles[lt]);return d?st.sort((lt,ht)=>{const dt=lt.tileID,mt=ht.tileID,Tt=new c.P(dt.canonical.x,dt.canonical.y)._rotate(this.transform.angle),Pt=new c.P(mt.canonical.x,mt.canonical.y)._rotate(this.transform.angle);return dt.overscaledZ-mt.overscaledZ||Pt.y-Tt.y||Pt.x-Tt.x}).map(lt=>lt.tileID.key):st.map(lt=>lt.tileID).sort(dy).map(lt=>lt.key)}hasRenderableParent(d){const $=this.findLoadedParent(d,0);return!!$&&this._isIdRenderable($.tileID.key)}_isIdRenderable(d,$,st){return this._tiles[d]&&this._tiles[d].hasData()&&!this._coveredTiles[d]&&($||!this._tiles[d].holdingForFade())&&(st||!this._shadowCasterTiles[d])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const d in this._tiles)this._tiles[d].state!=="errored"&&this._reloadTile(+d,"reloading")}}_reloadTile(d,$){const st=this._tiles[d];st&&(st.state!=="loading"&&(st.state=$),this._loadTile(st,this._tileLoaded.bind(this,st,d,$)))}_tileLoaded(d,$,st,lt,ht){if(lt){if(d.state="errored",lt.status!==404)this._source.fire(new c.y(lt,{tile:d}));else{if(this._source.fire(new c.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:d})),!(d.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const mt=this.map.painter.terrain;this.update(this.transform,mt.getScaledDemTileSize(),!0),mt.resetTileLookupCache(this.id)}else this.update(this.transform)}return}d.timeAdded=c.o.now(),st==="expired"&&(d.refreshedUponExpiration=!0),this._setTileReloadTimer($,d),this._source.type==="raster-dem"&&d.dem&&this._backfillDEM(d),this._state.initializeTileState(d,this.map?this.map.painter:null);let dt=new Map;ht&&ht.responseHeaders&&(dt=ht.responseHeaders),this._source.fire(new c.z("data",{dataType:"source",tile:d,coord:d.tileID,sourceCacheId:this.id,responseHeaders:dt}))}_backfillDEM(d){const $=this.getRenderableIds();for(let lt=0;lt<$.length;lt++){const ht=$[lt];if(d.neighboringTiles&&d.neighboringTiles[ht]){const dt=this.getTileByID(ht);st(d,dt),st(dt,d)}}function st(lt,ht){if(!lt.dem||lt.dem.borderReady)return;lt.needsHillshadePrepare=!0,lt.needsDEMTextureUpload=!0;let dt=ht.tileID.canonical.x-lt.tileID.canonical.x;const mt=ht.tileID.canonical.y-lt.tileID.canonical.y,Tt=Math.pow(2,lt.tileID.canonical.z),Pt=ht.tileID.key;dt===0&&mt===0||Math.abs(mt)>1||(Math.abs(dt)>1&&(Math.abs(dt+Tt)===1?dt+=Tt:Math.abs(dt-Tt)===1&&(dt-=Tt)),ht.dem&&lt.dem&&(lt.dem.backfillBorder(ht.dem,dt,mt),lt.neighboringTiles&&lt.neighboringTiles[Pt]&&(lt.neighboringTiles[Pt].backfilled=!0)))}}getTile(d){return this.getTileByID(d.key)}getTileByID(d){return this._tiles[d]}_retainLoadedChildren(d,$,st,lt){for(const ht in this._tiles){let dt=this._tiles[ht];if(lt[ht]||!dt.hasData()||dt.tileID.overscaledZ<=$||dt.tileID.overscaledZ>st)continue;let mt=dt.tileID;for(;dt&&dt.tileID.overscaledZ>$+1;){const Pt=dt.tileID.scaledTo(dt.tileID.overscaledZ-1);dt=this._tiles[Pt.key],dt&&dt.hasData()&&(mt=Pt)}let Tt=mt;for(;Tt.overscaledZ>$;)if(Tt=Tt.scaledTo(Tt.overscaledZ-1),d[Tt.key]){lt[mt.key]=mt;break}}}findLoadedParent(d,$){if(d.key in this._loadedParentTiles){const st=this._loadedParentTiles[d.key];return st&&st.tileID.overscaledZ>=$?st:null}for(let st=d.overscaledZ-1;st>=$;st--){const lt=d.scaledTo(st),ht=this._getLoadedTile(lt);if(ht)return ht}}_getLoadedTile(d){const $=this._tiles[d.key];return $&&$.hasData()?$:this._cache.getByKey(this._source.reparseOverscaled?d.wrapped().key:d.canonical.key)}updateCacheSize(d,$){$=$||this._source.tileSize;const st=Math.ceil(d.width/$)+1,lt=Math.ceil(d.height/$)+1,ht=Math.floor(st*lt*5),dt=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,ht):ht,mt=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,dt):dt;this._cache.setMaxSize(mt)}handleWrapJump(d){const $=Math.round((d-(this._prevLng===void 0?d:this._prevLng))/360);if(this._prevLng=d,$){const st={};for(const lt in this._tiles){const ht=this._tiles[lt];ht.tileID=ht.tileID.unwrapTo(ht.tileID.wrap+$),st[ht.tileID.key]=ht}this._tiles=st;for(const lt in this._timers)clearTimeout(this._timers[lt]),delete this._timers[lt];for(const lt in this._tiles)this._setTileReloadTimer(+lt,this._tiles[lt])}}update(d,$,st,lt,ht){if(this.transform=d,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!st)return;this.updateCacheSize(d,$),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const dt=this._source.type==="batched-model";let mt,Tt=this._source.maxzoom;const Pt=this.map&&this.map.painter?this.map.painter._terrain:null;if(Pt&&Pt.sourceCache===this&&Pt.attenuationRange()){const $t=Pt.attenuationRange()[0],qt=Math.floor($t)-Math.log2(Pt.getDemUpscale());Tt>qt&&(Tt=qt)}if(this.used||this.usedForTerrain){if(this._source.tileID)mt=d.getVisibleUnwrappedCoordinates(this._source.tileID).map($t=>new c.aQ($t.canonical.z,$t.wrap,$t.canonical.z,$t.canonical.x,$t.canonical.y));else if(this.tileCoverLift!==0){const $t=d.clone();$t.tileCoverLift=this.tileCoverLift,mt=$t.coveringTiles({tileSize:$||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:Tt,roundZoom:this._source.roundZoom&&!st,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:dt}),this._source.minzoom<=1&&d.projection.name==="globe"&&(mt.push(new c.aQ(1,0,1,0,0)),mt.push(new c.aQ(1,0,1,1,0)),mt.push(new c.aQ(1,0,1,0,1)),mt.push(new c.aQ(1,0,1,1,1)))}else if(mt=d.coveringTiles({tileSize:$||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:Tt,roundZoom:this._source.roundZoom&&!st,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:dt}),this._source.hasTile){const $t=this._source.hasTile.bind(this._source);mt=mt.filter(qt=>$t(qt))}}else mt=[];if(mt.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Qm(this._source.type)){const $t=d.coveringZoomLevel({tileSize:$||this._source.tileSize,roundZoom:this._source.roundZoom&&!st}),qt=Math.min($t,this._source.maxzoom);if(dt){const Qt=d.extendTileCover(mt,qt);for(const Xt of Qt)mt.push(Xt)}else if(ht){const Qt=d.extendTileCoverToNearPlane(mt,this.transform.getFrustum(qt),qt);for(const Xt of Qt)mt.push(Xt)}else if(this.castsShadows&&lt){const Qt=d.extendTileCover(mt,qt,lt,16);for(const Xt of Qt)this._shadowCasterTiles[Xt.key]=!0,mt.push(Xt)}}const Mt=this._updateRetainedTiles(mt);if(Qm(this._source.type)&&mt.length!==0){const $t={},qt={},Qt=Object.keys(Mt);for(const sr of Qt){const ir=Mt[sr],hr=this._tiles[sr];if(!hr||hr.fadeEndTime&&hr.fadeEndTime<=c.o.now())continue;const mr=this.findLoadedParent(ir,Math.max(ir.overscaledZ-zu.maxOverzooming,this._source.minzoom));mr&&(this._addTile(mr.tileID),$t[mr.tileID.key]=mr.tileID),qt[sr]=ir}const Xt=mt[mt.length-1].overscaledZ;for(const sr in this._tiles){const ir=this._tiles[sr];if(Mt[sr]||!ir.hasData())continue;let hr=ir.tileID;for(;hr.overscaledZ>Xt;){hr=hr.scaledTo(hr.overscaledZ-1);const mr=this._tiles[hr.key];if(mr&&mr.hasData()&&qt[hr.key]){Mt[sr]=ir.tileID;break}}}for(const sr in $t)Mt[sr]||(this._coveredTiles[sr]=!0,Mt[sr]=$t[sr])}for(const $t in Mt)this._tiles[$t].clearFadeHold();const Ht=c.bv(this._tiles,Mt);for(const $t of Ht){const qt=this._tiles[$t];qt.hasSymbolBuckets&&!qt.holdingForFade()?qt.setHoldDuration(this.map._fadeDuration):qt.hasSymbolBuckets&&!qt.symbolFadeFinished()||this._removeTile(+$t)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const d in this._tiles)this._tiles[d].holdingForFade()&&this._removeTile(+d)}_updateRetainedTiles(d){const $={};if(d.length===0)return $;const st={},lt=d.reduce((Pt,Mt)=>Math.min(Pt,Mt.overscaledZ),1/0),ht=d[0].overscaledZ,dt=Math.max(ht-zu.maxOverzooming,this._source.minzoom),mt=Math.max(ht+zu.maxUnderzooming,this._source.minzoom),Tt={};for(const Pt of d){const Mt=this._addTile(Pt);$[Pt.key]=Pt,Mt.hasData()||lt<this._source.maxzoom&&(Tt[Pt.key]=Pt)}this._retainLoadedChildren(Tt,lt,mt,$);for(const Pt of d){let Mt=this._tiles[Pt.key];if(Mt.hasData())continue;if(Pt.canonical.z>=this._source.maxzoom){const $t=Pt.children(this._source.maxzoom)[0],qt=this.getTile($t);if(qt&&qt.hasData()){$[$t.key]=$t;continue}}else{const $t=Pt.children(this._source.maxzoom);if($[$t[0].key]&&$[$t[1].key]&&$[$t[2].key]&&$[$t[3].key])continue}let Ht=Mt.wasRequested();for(let $t=Pt.overscaledZ-1;$t>=dt;--$t){const qt=Pt.scaledTo($t);if(st[qt.key]||(st[qt.key]=!0,Mt=this.getTile(qt),!Mt&&Ht&&(Mt=this._addTile(qt)),Mt&&($[qt.key]=qt,Ht=Mt.wasRequested(),Mt.hasData())))break}}return $}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const d in this._tiles){const $=[];let st,lt=this._tiles[d].tileID;for(;lt.overscaledZ>0;){if(lt.key in this._loadedParentTiles){st=this._loadedParentTiles[lt.key];break}$.push(lt.key);const ht=lt.scaledTo(lt.overscaledZ-1);if(st=this._getLoadedTile(ht),st)break;lt=ht}for(const ht of $)this._loadedParentTiles[ht]=st}}_addTile(d){let $=this._tiles[d.key];if($)return $.isExtraShadowCaster!==!0||this._shadowCasterTiles[d.key]||this._reloadTile(d.key,"reloading"),$;$=this._cache.getAndRemove(d),$&&(this._setTileReloadTimer(d.key,$),$.tileID=d,this._state.initializeTileState($,this.map?this.map.painter:null),this._cacheTimers[d.key]&&(clearTimeout(this._cacheTimers[d.key]),delete this._cacheTimers[d.key],this._setTileReloadTimer(d.key,$)));const st=!!$;if(!st){const lt=this.map?this.map.painter:null,ht=this._source.tileSize*d.overscaleFactor();$=this._source.type==="raster-array"?new hy(d,ht,this.transform.tileZoom,lt,this._isRaster):new Ym(d,ht,this.transform.tileZoom,lt,this._isRaster,this._source.worldview),this._loadTile($,this._tileLoaded.bind(this,$,d.key,$.state))}return $.uses++,this._tiles[d.key]=$,st||this._source.fire(new c.z("dataloading",{tile:$,coord:$.tileID,dataType:"source"})),$}_setTileReloadTimer(d,$){d in this._timers&&(clearTimeout(this._timers[d]),delete this._timers[d]);const st=$.getExpiryTimeout();st&&(this._timers[d]=setTimeout(()=>{this._reloadTile(d,"expired"),delete this._timers[d]},st))}_removeTile(d){const $=this._tiles[d];$&&($.uses--,delete this._tiles[d],this._timers[d]&&(clearTimeout(this._timers[d]),delete this._timers[d]),$.uses>0||($.hasData()&&$.state!=="reloading"||$.state==="empty"?this._cache.add($.tileID,$,$.getExpiryTimeout()):($.aborted=!0,this._abortTile($),this._unloadTile($))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const d in this._tiles)this._removeTile(+d);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(d,$,st){const lt=[],ht=this.transform;if(!ht)return lt;const dt=ht.projection.name==="globe",mt=c.aF(ht.center.lng);for(const Tt in this._tiles){const Pt=this._tiles[Tt];if(st&&Pt.clearQueryDebugViz(),Pt.holdingForFade())continue;let Mt;if(dt){const Ht=Pt.tileID.canonical;if(Ht.z===0){const $t=[Math.abs(c.aA(mt,...Xp(Ht,-1))-mt),Math.abs(c.aA(mt,...Xp(Ht,1))-mt)];Mt=[0,2*$t.indexOf(Math.min(...$t))-1]}else{const $t=[Math.abs(c.aA(mt,...Xp(Ht,-1))-mt),Math.abs(c.aA(mt,...Xp(Ht,0))-mt),Math.abs(c.aA(mt,...Xp(Ht,1))-mt)];Mt=[$t.indexOf(Math.min(...$t))-1]}}else Mt=[0];for(const Ht of Mt){const $t=d.containsTile(Pt,ht,$,Ht);$t&&lt.push($t)}}return lt}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(d){return this._getRenderableCoordinates(d)}_getRenderableCoordinates(d,$){const st=this.getRenderableIds(d,$).map(ht=>this._tiles[ht].tileID),lt=this.transform.projection.name==="globe";for(const ht of st)ht.projMatrix=this.transform.calculateProjMatrix(ht.toUnwrapped()),ht.expandedProjMatrix=lt?this.transform.calculateProjMatrix(ht.toUnwrapped(),!1,!0):ht.projMatrix;return st}sortCoordinatesByDistance(d){const $=d.slice(),st=this.transform._camera.position,lt=this.transform._camera.forward(),ht={};for(const dt of $){const mt=1/(1<<dt.canonical.z);ht[dt.key]=((dt.canonical.x+.5)*mt+dt.wrap-st[0])*lt[0]+((dt.canonical.y+.5)*mt-st[1])*lt[1]-st[2]*lt[2]}return $.sort((dt,mt)=>ht[dt.key]-ht[mt.key]),$}hasTransition(){if(this._source.hasTransition())return!0;if(Qm(this._source.type))for(const d in this._tiles){const $=this._tiles[d];if($.fadeEndTime!==void 0&&$.fadeEndTime>=c.o.now())return!0}return!1}setFeatureState(d,$,st){this._state.updateState(d=d||"_geojsonTileLayer",$,st)}removeFeatureState(d,$,st){this._state.removeFeatureState(d=d||"_geojsonTileLayer",$,st)}getFeatureState(d,$){return this._state.getState(d=d||"_geojsonTileLayer",$)}setDependencies(d,$,st){const lt=this._tiles[d];lt&&lt.setDependencies($,st)}reloadTilesForDependencies(d,$){for(const st in this._tiles)this._tiles[st].hasDependency(d,$)&&this._reloadTile(+st,"reloading");this._cache.filter(st=>!st.hasDependency(d,$))}_preloadTiles(d,$){if(!this._sourceLoaded){const Tt=()=>{this._sourceLoaded&&(this._source.off("data",Tt),this._preloadTiles(d,$))};return void this._source.on("data",Tt)}const st=new Map,lt=Array.isArray(d)?d:[d],ht=this.map.painter.terrain,dt=this.usedForTerrain&&ht?ht.getScaledDemTileSize():this._source.tileSize;for(const Tt of lt){const Pt=Tt.coveringTiles({tileSize:dt,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const Mt of Pt)st.set(Mt.key,Mt);this.usedForTerrain&&Tt.updateElevation(!1)}const mt=Array.from(st.values());c.bw(mt,(Tt,Pt)=>{const Mt=new Ym(Tt,this._source.tileSize*Tt.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(Mt,Ht=>{this._source.type==="raster-dem"&&Mt.dem&&this._backfillDEM(Mt),Pt(Ht,Mt)})},$)}}function dy(it,d){const $=Math.abs(2*it.wrap)-+(it.wrap<0),st=Math.abs(2*d.wrap)-+(d.wrap<0);return it.overscaledZ-d.overscaledZ||st-$||d.canonical.y-it.canonical.y||d.canonical.x-it.canonical.x}function Qm(it){return it==="raster"||it==="image"||it==="video"||it==="custom"}function Xp(it,d){const $=1<<it.z;return[it.x/$+d,(it.x+1)/$+d]}zu.maxOverzooming=10,zu.maxUnderzooming=3;class YE{constructor(d){this.style=d,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const d=!1,$=!1;for(const st in this.style._mergedLayers){const lt=this.style._mergedLayers[st];if(lt.type==="fill-extrusion"||lt.type==="building")this.layers.push({layer:lt,visible:d,visibilityChanged:$});else if(lt.type==="model"){const ht=this.style.getLayerSource(lt);ht&&ht.type==="batched-model"&&this.layers.push({layer:lt,visible:d,visibilityChanged:$})}}}onNewFrame(d){this.layersGotHidden=!1;for(const $ of this.layers){const st=$.layer;let lt=!1;st.type==="fill-extrusion"?lt=!st.isHidden(d)&&st.paint.get("fill-extrusion-opacity")>0:st.type==="building"?lt=!st.isHidden(d)&&st.paint.get("building-opacity")>0:st.type==="model"&&(lt=!st.isHidden(d)&&st.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!lt&&$.visible,$.visible=lt}}updateZOffset(d,$){this.currentBuildingBuckets=[];for(const lt of this.layers){const ht=lt.layer,dt=this.style.getLayerSourceCache(ht);let mt=1;ht.type==="fill-extrusion"?mt=lt.visible?ht.paint.get("fill-extrusion-vertical-scale"):0:ht.type==="building"&&(mt=lt.visible?ht.paint.get("building-vertical-scale"):0);let Tt=dt?dt.getTile($):null;if(!Tt&&dt)for(const Pt in dt._tiles){const Mt=dt._tiles[Pt];if($.canonical.isChildOf(Mt.tileID.canonical)){Tt=Mt;break}}this.currentBuildingBuckets.push({bucket:Tt?Tt.getBucket(ht):null,tileID:Tt?Tt.tileID:$,verticalScale:mt})}d.hasAnyZOffset=!1;let st=!1;for(let lt=0;lt<d.symbolInstances.length;lt++){const ht=d.symbolInstances.get(lt),dt=ht.zOffset,mt=this._getHeightAtTileOffset($,ht.tileAnchorX,ht.tileAnchorY);ht.zOffset=mt!==Number.NEGATIVE_INFINITY?mt:dt,st||dt===ht.zOffset||(st=!0),d.hasAnyZOffset||ht.zOffset===0||(d.hasAnyZOffset=!0)}st&&(d.zOffsetBuffersNeedUpload=!0,d.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(d,$,st,lt){let ht=$,dt=st;if(d.canonical.z!==lt.canonical.z){const mt=lt.canonical,Tt=1/(1<<d.canonical.z-mt.z);ht=($+d.canonical.x*c.al)*Tt-mt.x*c.al|0,dt=(st+d.canonical.y*c.al)*Tt-mt.y*c.al|0}return{tileX:ht,tileY:dt}}_getHeightAtTileOffset(d,$,st){let lt,ht;for(let dt=0;dt<this.layers.length;++dt){const mt=this.layers[dt].layer;if(mt.type!=="fill-extrusion"&&mt.type!=="building")continue;const{bucket:Tt,tileID:Pt,verticalScale:Mt}=this.currentBuildingBuckets[dt];if(!Tt)continue;const{tileX:Ht,tileY:$t}=this._mapCoordToOverlappingTile(d,$,st,Pt),qt=Tt.getHeightAtTileCoord(Ht,$t);qt&&qt.height!==void 0&&(qt.hidden?lt=qt.height:ht=Math.max(qt.height*Mt,ht||0))}if(ht!==void 0)return ht;for(let dt=0;dt<this.layers.length;++dt){const mt=this.layers[dt];if(mt.layer.type!=="model"||!mt.visible)continue;const{bucket:Tt,tileID:Pt}=this.currentBuildingBuckets[dt];if(!Tt)continue;const{tileX:Mt,tileY:Ht}=this._mapCoordToOverlappingTile(d,$,st,Pt),$t=Tt.getHeightAtTileCoord(Mt,Ht);if($t&&!$t.hidden)return $t.height===void 0&&lt!==void 0?Math.min($t.maxHeight,lt)*$t.verticalScale:$t.height?$t.height*$t.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function _b(it,d){const $={};for(const st in it)st!=="ref"&&($[st]=it[st]);return c.bx.forEach(st=>{st in d&&($[st]=d[st])}),$}function c_(it){it=it.slice();const d=Object.create(null);for(let $=0;$<it.length;$++)d[it[$].id]=it[$];for(let $=0;$<it.length;$++)"ref"in it[$]&&(it[$]=_b(it[$],d[it[$].ref]));return it}const eo={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function py(it,d,$){$.push({command:eo.addSource,args:[it,d[it]]})}function iv(it,d,$){d.push({command:eo.removeSource,args:[it]}),$[it]=!0}function ew(it,d,$,st){iv(it,$,st),py(it,d,$)}function tw(it,d,$){let st;for(st in it[$])if(it[$].hasOwnProperty(st)&&st!=="data"&&!c.by(it[$][st],d[$][st]))return!1;for(st in d[$])if(d[$].hasOwnProperty(st)&&st!=="data"&&!c.by(it[$][st],d[$][st]))return!1;return!0}function wm(it,d,$,st,lt,ht){let dt;for(dt in d=d||{},it=it||{})it.hasOwnProperty(dt)&&(c.by(it[dt],d[dt])||$.push({command:ht,args:[st,dt,d[dt],lt]}));for(dt in d)d.hasOwnProperty(dt)&&!it.hasOwnProperty(dt)&&(c.by(it[dt],d[dt])||$.push({command:ht,args:[st,dt,d[dt],lt]}))}function u_(it){return it.id}function h_(it,d){return it[d.id]=d,it}function nv(it,d,$){const st=d.createTileMatrix(it,it.worldSize,$.toUnwrapped());return c.aB(new Float32Array(16),it.projMatrix,st)}function fy(it,d,$){if(d.projection.name===$.projection.name)return it.projMatrix;const st=$.clone();return st.setProjection(d.projection),nv(st,d.getProjection(),it)}function Np(it,d,$){return d.name===$.projection.name?it.projMatrix:nv($,d,it)}class d_{constructor(d,$){this.reset(d,$)}reset(d,$){this.points=d||[],this._distances=[0];for(let st=1;st<this.points.length;st++)this._distances[st]=this._distances[st-1]+this.points[st].dist(this.points[st-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min($||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(d){if(this.points.length===1)return this.points[0];d=c.aA(d,0,1);let $=1,st=this._distances[$];const lt=d*this.paddedLength+this.padding;for(;st<lt&&$<this._distances.length;)st=this._distances[++$];const ht=$-1,dt=this._distances[ht],mt=st-dt,Tt=mt>0?(lt-dt)/mt:0;return this.points[ht].mult(1-Tt).add(this.points[$].mult(Tt))}}class sv{constructor(d,$,st){const lt=this.boxCells=[],ht=this.circleCells=[];this.xCellCount=Math.ceil(d/st),this.yCellCount=Math.ceil($/st);for(let dt=0;dt<this.xCellCount*this.yCellCount;dt++)lt.push([]),ht.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=d,this.height=$,this.xScale=this.xCellCount/d,this.yScale=this.yCellCount/$,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(d,$,st,lt,ht){this._forEachCell($,st,lt,ht,this._insertBoxCell,this.boxUid++),this.boxKeys.push(d),this.bboxes.push($),this.bboxes.push(st),this.bboxes.push(lt),this.bboxes.push(ht)}insertCircle(d,$,st,lt){this._forEachCell($-lt,st-lt,$+lt,st+lt,this._insertCircleCell,this.circleUid++),this.circleKeys.push(d),this.circles.push($),this.circles.push(st),this.circles.push(lt)}_insertBoxCell(d,$,st,lt,ht,dt){this.boxCells[ht].push(dt)}_insertCircleCell(d,$,st,lt,ht,dt){this.circleCells[ht].push(dt)}_query(d,$,st,lt,ht,dt){if(st<0||d>this.width||lt<0||$>this.height)return!ht&&[];const mt=[];if(d<=0&&$<=0&&this.width<=st&&this.height<=lt){if(ht)return!0;for(let Tt=0;Tt<this.boxKeys.length;Tt++)mt.push({key:this.boxKeys[Tt],x1:this.bboxes[4*Tt],y1:this.bboxes[4*Tt+1],x2:this.bboxes[4*Tt+2],y2:this.bboxes[4*Tt+3]});for(let Tt=0;Tt<this.circleKeys.length;Tt++){const Pt=this.circles[3*Tt],Mt=this.circles[3*Tt+1],Ht=this.circles[3*Tt+2];mt.push({key:this.circleKeys[Tt],x1:Pt-Ht,y1:Mt-Ht,x2:Pt+Ht,y2:Mt+Ht})}return dt?mt.filter(dt):mt}return this._forEachCell(d,$,st,lt,this._queryCell,mt,{hitTest:ht,seenUids:{box:{},circle:{}}},dt),ht?mt.length>0:mt}_queryCircle(d,$,st,lt,ht){const dt=d-st,mt=d+st,Tt=$-st,Pt=$+st;if(mt<0||dt>this.width||Pt<0||Tt>this.height)return!lt&&[];const Mt=[];return this._forEachCell(dt,Tt,mt,Pt,this._queryCellCircle,Mt,{hitTest:lt,circle:{x:d,y:$,radius:st},seenUids:{box:{},circle:{}}},ht),lt?Mt.length>0:Mt}query(d,$,st,lt,ht){return this._query(d,$,st,lt,!1,ht)}hitTest(d,$,st,lt,ht){return this._query(d,$,st,lt,!0,ht)}hitTestCircle(d,$,st,lt){return this._queryCircle(d,$,st,!0,lt)}_queryCell(d,$,st,lt,ht,dt,mt,Tt){const Pt=mt.seenUids,Mt=this.boxCells[ht];if(Mt!==null){const $t=this.bboxes;for(const qt of Mt)if(!Pt.box[qt]){Pt.box[qt]=!0;const Qt=4*qt;if(d<=$t[Qt+2]&&$<=$t[Qt+3]&&st>=$t[Qt+0]&&lt>=$t[Qt+1]&&(!Tt||Tt(this.boxKeys[qt]))){if(mt.hitTest)return dt.push(!0),!0;dt.push({key:this.boxKeys[qt],x1:$t[Qt],y1:$t[Qt+1],x2:$t[Qt+2],y2:$t[Qt+3]})}}}const Ht=this.circleCells[ht];if(Ht!==null){const $t=this.circles;for(const qt of Ht)if(!Pt.circle[qt]){Pt.circle[qt]=!0;const Qt=3*qt;if(this._circleAndRectCollide($t[Qt],$t[Qt+1],$t[Qt+2],d,$,st,lt)&&(!Tt||Tt(this.circleKeys[qt]))){if(mt.hitTest)return dt.push(!0),!0;{const Xt=$t[Qt],sr=$t[Qt+1],ir=$t[Qt+2];dt.push({key:this.circleKeys[qt],x1:Xt-ir,y1:sr-ir,x2:Xt+ir,y2:sr+ir})}}}}}_queryCellCircle(d,$,st,lt,ht,dt,mt,Tt){const Pt=mt.circle,Mt=mt.seenUids,Ht=this.boxCells[ht];if(Ht!==null){const qt=this.bboxes;for(const Qt of Ht)if(!Mt.box[Qt]){Mt.box[Qt]=!0;const Xt=4*Qt;if(this._circleAndRectCollide(Pt.x,Pt.y,Pt.radius,qt[Xt+0],qt[Xt+1],qt[Xt+2],qt[Xt+3])&&(!Tt||Tt(this.boxKeys[Qt])))return dt.push(!0),!0}}const $t=this.circleCells[ht];if($t!==null){const qt=this.circles;for(const Qt of $t)if(!Mt.circle[Qt]){Mt.circle[Qt]=!0;const Xt=3*Qt;if(this._circlesCollide(qt[Xt],qt[Xt+1],qt[Xt+2],Pt.x,Pt.y,Pt.radius)&&(!Tt||Tt(this.circleKeys[Qt])))return dt.push(!0),!0}}}_forEachCell(d,$,st,lt,ht,dt,mt,Tt){const Pt=this._convertToXCellCoord(d),Mt=this._convertToYCellCoord($),Ht=this._convertToXCellCoord(st),$t=this._convertToYCellCoord(lt);for(let qt=Pt;qt<=Ht;qt++)for(let Qt=Mt;Qt<=$t;Qt++)if(ht.call(this,d,$,st,lt,this.xCellCount*Qt+qt,dt,mt,Tt))return}_convertToXCellCoord(d){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(d*this.xScale)))}_convertToYCellCoord(d){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(d*this.yScale)))}_circlesCollide(d,$,st,lt,ht,dt){const mt=lt-d,Tt=ht-$,Pt=st+dt;return Pt*Pt>mt*mt+Tt*Tt}_circleAndRectCollide(d,$,st,lt,ht,dt,mt){const Tt=(dt-lt)/2,Pt=Math.abs(d-(lt+Tt));if(Pt>Tt+st)return!1;const Mt=(mt-ht)/2,Ht=Math.abs($-(ht+Mt));if(Ht>Mt+st)return!1;if(Pt<=Tt||Ht<=Mt)return!0;const $t=Pt-Tt,qt=Ht-Mt;return $t*$t+qt*qt<=st*st}}const Em={unknown:0,flipRequired:1,flipNotRequired:2},Jm=Math.tan(85*Math.PI/180);function wu(it,d,$,st,lt,ht,dt){const mt=c.bC();if($)if(ht.name==="globe"){const Tt=c.bD(lt,d);c.aB(mt,mt,Tt)}else{const Tt=c.bE([],dt);mt[0]=Tt[0],mt[1]=Tt[1],mt[4]=Tt[2],mt[5]=Tt[3],st||c.bB(mt,mt,lt.angle)}else c.aB(mt,lt.labelPlaneMatrix,it);return mt}function my(it,d,$,st,lt,ht,dt){const mt=wu(it,d,$,st,lt,ht,dt);return ht.name==="globe"&&$||(mt[2]=mt[6]=mt[10]=mt[14]=0),mt}function p_(it,d,$,st,lt,ht,dt){if($){if(ht.name==="globe"){const mt=wu(it,d,$,st,lt,ht,dt);return c.bl(mt,mt),c.aB(mt,it,mt),mt}{const mt=c.bz(it),Tt=c.bA([]);return Tt[0]=dt[0],Tt[1]=dt[1],Tt[4]=dt[2],Tt[5]=dt[3],c.aB(mt,mt,Tt),st||c.bB(mt,mt,-lt.angle),mt}}return lt.glCoordMatrix}function np(it,d,$,st){const lt=[it,d,$,1];$?c.aC(lt,lt,st):is(lt,lt,st);const ht=lt[3];return lt[0]/=ht,lt[1]/=ht,lt[2]/=ht,lt}function fo(it,d){return Math.min(.5+it/d*.5,1.5)}function rw(it,d){const $=it[0]/it[3],st=it[1]/it[3];return $>=-d[0]&&$<=d[0]&&st>=-d[1]&&st<=d[1]}function iw(it,d,$,st,lt,ht,dt,mt,Tt,Pt,Mt=1){const Ht=$.transform,$t=st?it.textSizeData:it.iconSizeData,qt=c.bK($t,$.transform.zoom,Mt),Qt=Ht.projection.name==="globe",Xt=[256/$.width*2+1,256/$.height*2+1],sr=st?it.text.dynamicLayoutVertexArray:it.icon.dynamicLayoutVertexArray;sr.clear();let ir=null;Qt&&(ir=st?it.text.globeExtVertexArray:it.icon.globeExtVertexArray);const hr=it.lineVertexArray,mr=st?it.text.placedSymbolArray:it.icon.placedSymbolArray,dr=$.transform.width/$.transform.height;let Ir,Tr=!1;for(let Ar=0;Ar<mr.length;Ar++){const Er=mr.get(Ar),{numGlyphs:vr,writingMode:Pr}=Er;if(Pr!==c.bL.vertical||Tr||Ir===c.bL.horizontal||(Tr=!0),Ir=Pr,(Er.hidden||Pr===c.bL.vertical)&&!Tr){xp(vr,sr);continue}Tr=!1;const Br=new c.P(Er.tileAnchorX,Er.tileAnchorY),Or=it.elevationType==="road",Yr=!!Ht.elevation||Or;let{x:Qr,y:un,z:Cn}=Ht.projection.projectTilePoint(Br.x,Br.y,Pt.canonical),qr=null;if(Yr){const Gn=Or?it.getElevationFeatureForText(Ar):null;qr={getElevation:Tt,elevation:Ht.elevation,elevationFeature:Gn};const[as,Es,$s]=Tt(Br,Ht.elevation,Gn);Qr+=as,un+=Es,Cn+=$s}const Nr=[Qr,un,Cn,1];if(c.aC(Nr,Nr,d),!rw(Nr,Xt)){xp(vr,sr);continue}const tn=Nr[3],Kr=fo($.transform.getCameraToCenterDistance(Ht.projection),tn),yn=c.bM($t,qt,Er),Ln=dt?yn/Kr:yn*Kr,Un=np(Qr,un,Cn,lt);if(Un[3]<=0){xp(vr,sr);continue}let kn={};const An=c.an(it.layers[0].layout.get("text-max-angle")),Qn=Math.cos(An),Kn=dt?null:qr,zn=ov(Er,Ln,!1,mt,d,lt,ht,it.glyphOffsetArray,hr,sr,ir,Un,Br,kn,dr,Kn,Ht.projection,Pt,dt,Qn);Tr=zn.useVertical,Kn&&zn.needsFlipping&&(kn={}),(zn.notEnoughRoom||Tr||zn.needsFlipping&&ov(Er,Ln,!0,mt,d,lt,ht,it.glyphOffsetArray,hr,sr,ir,Un,Br,kn,dr,Kn,Ht.projection,Pt,dt,Qn).notEnoughRoom)&&xp(vr,sr)}st?(it.text.dynamicLayoutVertexBuffer.updateData(sr),ir&&it.text.globeExtVertexBuffer&&it.text.globeExtVertexBuffer.updateData(ir)):(it.icon.dynamicLayoutVertexBuffer.updateData(sr),ir&&it.icon.globeExtVertexBuffer&&it.icon.globeExtVertexBuffer.updateData(ir))}function nw(it,d,$,st,lt,ht,dt,mt,Tt,Pt,Mt,Ht,$t,qt,Qt,Xt,sr){const{lineStartIndex:ir,glyphStartIndex:hr,segment:mr}=mt,dr=hr+mt.numGlyphs,Ir=ir+mt.lineLength,Tr=d.getoffsetX(hr),Ar=d.getoffsetX(dr-1),Er=b0(it*Tr,$,st,lt,ht,dt,mr,ir,Ir,Tt,Pt,Mt,Ht,$t,!0,qt,Qt,Xt,sr);if(!Er)return null;const vr=b0(it*Ar,$,st,lt,ht,dt,mr,ir,Ir,Tt,Pt,Mt,Ht,$t,!0,qt,Qt,Xt,sr);return vr?{first:Er,last:vr}:null}function fs(it,d,$,st){return it===c.bL.horizontal&&Math.abs(st)>Math.abs($)?{useVertical:!0}:it===c.bL.vertical?st>0?{needsFlipping:!0}:null:d!==Em.unknown&&function(lt,ht){return lt===0||Math.abs(ht/lt)>Jm}($,st)?d===Em.flipRequired?{needsFlipping:!0}:null:$<0?{needsFlipping:!0}:null}function ov(it,d,$,st,lt,ht,dt,mt,Tt,Pt,Mt,Ht,$t,qt,Qt,Xt,sr,ir,hr,mr){const dr=d/24,Ir=it.lineOffsetX*dr,Tr=it.lineOffsetY*dr,{lineStartIndex:Ar,glyphStartIndex:Er,numGlyphs:vr,segment:Pr,writingMode:Br,flipState:Or}=it,Yr=Ar+it.lineLength,Qr=un=>{if(Mt){const[tn,Kr,yn]=un.up,Ln=Pt.length;c.bN(Mt,Ln+0,tn,Kr,yn),c.bN(Mt,Ln+1,tn,Kr,yn),c.bN(Mt,Ln+2,tn,Kr,yn),c.bN(Mt,Ln+3,tn,Kr,yn)}const[Cn,qr,Nr]=un.point;c.bO(Pt,Cn,qr,Nr,un.angle)};if(vr>1){const un=nw(dr,mt,Ir,Tr,$,Ht,$t,it,Tt,ht,qt,Xt,!1,sr,ir,hr,mr);if(!un)return{notEnoughRoom:!0};if(st&&!$){let[Cn,qr,Nr]=un.first.point,[tn,Kr,yn]=un.last.point;[Cn,qr]=np(Cn,qr,Nr,dt),[tn,Kr]=np(tn,Kr,yn,dt);const Ln=fs(Br,Or,(tn-Cn)*Qt,Kr-qr);if(it.flipState=Ln&&Ln.needsFlipping?Em.flipRequired:Em.flipNotRequired,Ln)return Ln}Qr(un.first);for(let Cn=Er+1;Cn<Er+vr-1;Cn++){const qr=b0(dr*mt.getoffsetX(Cn),Ir,Tr,$,Ht,$t,Pr,Ar,Yr,Tt,ht,qt,Xt,!1,!1,sr,ir,hr,mr);if(!qr)return Pt.length-=4*(Cn-Er),{notEnoughRoom:!0};Qr(qr)}Qr(un.last)}else{if(st&&!$){const Cn=np($t.x,$t.y,0,lt),qr=Ar+Pr+1,Nr=new c.P(Tt.getx(qr),Tt.gety(qr)),tn=np(Nr.x,Nr.y,0,lt),Kr=tn[3]>0?tn:sp($t,Nr,Cn,1,lt,void 0,sr,ir.canonical),yn=fs(Br,Or,(Kr[0]-Cn[0])*Qt,Kr[1]-Cn[1]);if(it.flipState=yn&&yn.needsFlipping?Em.flipRequired:Em.flipNotRequired,yn)return yn}const un=b0(dr*mt.getoffsetX(Er),Ir,Tr,$,Ht,$t,Pr,Ar,Yr,Tt,ht,qt,Xt,!1,!1,sr,ir,hr,mr);if(!un)return{notEnoughRoom:!0};Qr(un)}return{}}function f_(it,d,$,st,lt){const{x:ht,y:dt,z:mt}=st.projectTilePoint(it.x,it.y,d);if(!lt)return np(ht,dt,mt,$);const[Tt,Pt,Mt]=lt.getElevation(it,lt.elevation,lt.elevationFeature);return np(ht+Tt,dt+Pt,mt+Mt,$)}function sp(it,d,$,st,lt,ht,dt,mt){const Tt=f_(it.sub(d)._unit()._add(it),mt,lt,dt,ht);return c.av(Tt,$,Tt),c.aw(Tt,Tt),c.bH(Tt,$,Tt,st)}function b0(it,d,$,st,lt,ht,dt,mt,Tt,Pt,Mt,Ht,$t,qt,Qt,Xt,sr,ir,hr){const mr=st?it-d:it+d;let dr=mr>0?1:-1,Ir=0;st&&(dr*=-1,Ir=Math.PI),dr<0&&(Ir+=Math.PI);let Tr=mt+dt+(dr>0?0:1)|0,Ar=lt,Er=lt,vr=0,Pr=0;const Br=Math.abs(mr),Or=[],Yr=[];let Qr=ht,un=Qr,Cn=c.bF([]);const qr=()=>sp(un,Qr,Er,Br-vr+1,Mt,$t,Xt,sr.canonical);for(;vr+Pr<=Br;){if(Tr+=dr,Tr<mt||Tr>=Tt)return null;if(Er=Ar,un=Qr,Or.push(Er),qt&&Yr.push(un),Qr=new c.P(Pt.getx(Tr),Pt.gety(Tr)),Ar=Ht[Tr],!Ar){const Kn=f_(Qr,sr.canonical,Mt,Xt,$t);Ar=Kn[3]>0?Ht[Tr]=Kn:qr()}vr+=Pr;const An=c.av([],Ar,Er),Qn=c.bG(Er,Ar);if($&&Qn>0&&Pr>0&&c.bJ(Cn,An)/(Pr*Qn)<hr)return null;Pr=Qn,Cn=An}Qt&&$t&&(Ht[Tr]&&(Ar=qr(),Pr=c.bG(Er,Ar),Cn=c.av([],Ar,Er)),Ht[Tr]=Ar);const Nr=(Br-vr)/Pr,tn=Qr.sub(un)._mult(Nr)._add(un),Kr=c.bH([],Er,Cn,Nr);let yn=[0,0,1],Ln=Cn[0],Un=Cn[1];if(ir&&(yn=Xt.upVector(sr.canonical,tn.x,tn.y),yn[0]!==0||yn[1]!==0||yn[2]!==1)){const An=[yn[2],0,-yn[0]],Qn=c.bI([],yn,An);c.aw(An,An),c.aw(Qn,Qn),Ln=c.bJ(Cn,An),Un=c.bJ(Cn,Qn)}if($){const An=c.bI([],yn,Cn);c.aw(An,An),c.bH(Kr,Kr,An,$*dr)}const kn=Ir+Math.atan2(Un,Ln);return Or.push(Kr),qt&&Yr.push(tn),{point:Kr,angle:kn,path:Or,tilePath:Yr,up:yn}}function xp(it,d){const $=d.length,st=$+4*it;d.resize(st),d.float32.fill(-1/0,4*$,4*st)}function is(it,d,$){const st=d[0],lt=d[1];return it[0]=$[0]*st+$[4]*lt+$[12],it[1]=$[1]*st+$[5]*lt+$[13],it[3]=$[3]*st+$[7]*lt+$[15],it}const qs=100;class yo{constructor(d,$,st=new sv(d.width+200,d.height+200,25),lt=new sv(d.width+200,d.height+200,25)){this.transform=d,this.grid=st,this.ignoredGrid=lt,this.pitchfactor=Math.cos(d._pitch)*d.cameraToCenterDistance,this.screenRightBoundary=d.width+qs,this.screenBottomBoundary=d.height+qs,this.gridRightBoundary=d.width+200,this.gridBottomBoundary=d.height+200,this.fogState=$}placeCollisionBox(d,$,st,lt,ht,dt,mt,Tt,Pt,Mt,Ht){let $t=st.projectedAnchorX,qt=st.projectedAnchorY,Qt=st.projectedAnchorZ;const Xt=st.tileAnchorX,sr=st.tileAnchorY,ir=st.elevation,hr=st.tileID,mr=d.getProjection();if(ir&&hr){const[Yr,Qr,un]=mr.upVector(hr.canonical,st.tileAnchorX,st.tileAnchorY),Cn=mr.upVectorScale(hr.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;$t+=Yr*ir*Cn,qt+=Qr*ir*Cn,Qt+=un*ir*Cn}const dr=d.projection.name==="globe",Ir=d.projection.name==="globe"?c.aj(this.transform.zoom):0;if(hr&&dr&&Ir<1&&!dt){const Yr=1<<hr.canonical.z,Qr=c.bP(Xt,sr);c.bQ(Qr,Qr,1/c.al),c.bR(Qr,Qr,c.bP(hr.canonical.x,hr.canonical.y)),c.bQ(Qr,Qr,1/Yr),c.bS(Qr,Qr,c.bP(lt[0],lt[1])),Qr[0]=c.bT(Qr[0],-.5,.5),c.bQ(Qr,Qr,c.al);const un=c.bU(Qr[0],Qr[1],c.al/(2*Math.PI),1);c.aC(un,un,ht),$t=c.ak($t,un[0],Ir),qt=c.ak(qt,un[1],Ir),Qt=c.ak(Qt,un[2],Ir)}const Tr=this.projectAndGetPerspectiveRatio(Mt,$t,qt,Qt,st.tileID,mr.name==="globe"||!!ir||this.transform.pitch>0,mr),Ar=Pt*Tr.perspectiveRatio,Er=(st.x1*$+mt.x-st.padding)*Ar+Tr.point.x,vr=(st.y1*$+mt.y-st.padding)*Ar+Tr.point.y,Pr=(st.x2*$+mt.x+st.padding)*Ar+Tr.point.x,Br=(st.y2*$+mt.y+st.padding)*Ar+Tr.point.y,Or=Tr.perspectiveRatio<=.55||Tr.occluded;return!this.isInsideGrid(Er,vr,Pr,Br)||!Tt&&this.grid.hitTest(Er,vr,Pr,Br,Ht)||Or?{box:[],offscreen:!1,occluded:Tr.occluded}:{box:[Er,vr,Pr,Br],offscreen:this.isOffscreen(Er,vr,Pr,Br),occluded:!1}}placeCollisionCircles(d,$,st,lt,ht,dt,mt,Tt,Pt,Mt,Ht,$t,qt,Qt,Xt,sr){const ir=[],hr=this.transform.elevation,mr=d.getProjection(),dr=d.elevationType==="road",Ir=!!hr||dr,Tr=c.bV.getAtTileOffsetFunc(sr,this.transform.center.lat,this.transform.worldSize,mr),Ar=new c.P(st.tileAnchorX,st.tileAnchorY),Er=new c.P(st.tileAnchorX,st.tileAnchorY);let{x:vr,y:Pr,z:Br}=mr.projectTilePoint(Er.x,Er.y,sr.canonical),Or=null;if(Ir){const Qn=dr?d.getElevationFeatureForText(lt):null;Or={getElevation:Tr,elevation:hr,elevationFeature:Qn};const[Kn,zn,Gn]=Tr(Ar,hr,Qn);vr+=Kn,Pr+=zn,Br+=Gn}const Yr=mr.name==="globe",Qr=this.projectAndGetPerspectiveRatio(Tt,vr,Pr,Br,sr,Yr||!!hr||this.transform.pitch>0,mr),{perspectiveRatio:un}=Qr,Cn=($t?mt/un:mt*un)/c.bY,qr=np(vr,Pr,Br,Pt),Nr=st.lineOffsetX*Cn,tn=st.lineOffsetY*Cn,Kr=c.an(d.layers[0].layout.get("text-max-angle")),yn=Math.cos(Kr),Ln=Qr.signedDistanceFromCamera>0?nw(Cn,dt,Nr,tn,dr&&st.flipState===1,qr,Er,st,ht,Pt,{},Ir&&!$t?Or:null,$t&&Ir,mr,sr,$t,yn):null;let Un=!1,kn=!1,An=!0;if(Ln&&!Qr.occluded){const Qn=.5*Qt*un+Xt,Kn=new c.P(-100,-100),zn=new c.P(this.screenRightBoundary,this.screenBottomBoundary),Gn=new d_,{first:as,last:Es}=Ln,$s=as.path.length;let so=[];for(let bs=$s-1;bs>=1;bs--)so.push(as.path[bs]);for(let bs=1;bs<Es.path.length;bs++)so.push(Es.path[bs]);const Jn=2.5*Qn;Mt&&(so=so.map(([bs,co,xo],mo)=>(Ir&&!Yr&&(xo=Tr(mo<$s-1?as.tilePath[$s-1-mo]:Es.tilePath[mo-$s+2],hr,Or.elevationFeature)[2]),np(bs,co,xo,Mt))),so.some(bs=>bs[3]<=0)&&(so=[]));let ro=[];if(so.length>0){let bs=1/0,co=-1/0,xo=1/0,mo=-1/0;for(const to of so)bs=Math.min(bs,to[0]),xo=Math.min(xo,to[1]),co=Math.max(co,to[0]),mo=Math.max(mo,to[1]);co>=Kn.x&&bs<=zn.x&&mo>=Kn.y&&xo<=zn.y&&(ro=[so.map(to=>new c.P(to[0],to[1]))],(bs<Kn.x||co>zn.x||xo<Kn.y||mo>zn.y)&&(ro=c.bW(ro,Kn.x,Kn.y,zn.x,zn.y)))}for(const bs of ro){Gn.reset(bs,.25*Qn);let co=0;co=Gn.length<=.5*Qn?1:Math.ceil(Gn.paddedLength/Jn)+1;for(let xo=0;xo<co;xo++){const mo=xo/Math.max(co-1,1),to=Gn.lerp(mo),Ms=to.x+qs,ao=to.y+qs;ir.push(Ms,ao,Qn,0);const Zo=Ms-Qn,Bo=ao-Qn,uo=Ms+Qn,Ys=ao+Qn;if(An=An&&this.isOffscreen(Zo,Bo,uo,Ys),kn=kn||this.isInsideGrid(Zo,Bo,uo,Ys),!$&&this.grid.hitTestCircle(Ms,ao,Qn,qt)&&(Un=!0,!Ht))return{circles:[],offscreen:!1,collisionDetected:Un,occluded:!1}}}}return{circles:!Ht&&Un||!kn?[]:ir,offscreen:An,collisionDetected:Un,occluded:Qr.occluded}}queryRenderedSymbols(d){if(d.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const $=[];let st=1/0,lt=1/0,ht=-1/0,dt=-1/0;for(const Mt of d){const Ht=new c.P(Mt.x+qs,Mt.y+qs);st=Math.min(st,Ht.x),lt=Math.min(lt,Ht.y),ht=Math.max(ht,Ht.x),dt=Math.max(dt,Ht.y),$.push(Ht)}const mt=this.grid.query(st,lt,ht,dt).concat(this.ignoredGrid.query(st,lt,ht,dt)),Tt={},Pt={};for(const Mt of mt){const Ht=Mt.key;if(Tt[Ht.bucketInstanceId]===void 0&&(Tt[Ht.bucketInstanceId]={}),Tt[Ht.bucketInstanceId][Ht.featureIndex])continue;const $t=[new c.P(Mt.x1,Mt.y1),new c.P(Mt.x2,Mt.y1),new c.P(Mt.x2,Mt.y2),new c.P(Mt.x1,Mt.y2)];c.bX($,$t)&&(Tt[Ht.bucketInstanceId][Ht.featureIndex]=!0,Pt[Ht.bucketInstanceId]===void 0&&(Pt[Ht.bucketInstanceId]=[]),Pt[Ht.bucketInstanceId].push(Ht.featureIndex))}return Pt}insertCollisionBox(d,$,st,lt,ht){($?this.ignoredGrid:this.grid).insert({bucketInstanceId:st,featureIndex:lt,collisionGroupID:ht},d[0],d[1],d[2],d[3])}insertCollisionCircles(d,$,st,lt,ht){const dt=$?this.ignoredGrid:this.grid,mt={bucketInstanceId:st,featureIndex:lt,collisionGroupID:ht};for(let Tt=0;Tt<d.length;Tt+=4)dt.insertCircle(mt,d[Tt],d[Tt+1],d[Tt+2])}projectAndGetPerspectiveRatio(d,$,st,lt,ht,dt,mt){const Tt=[$,st,lt,1];let Pt=!1;lt||this.transform.pitch>0?(c.aC(Tt,Tt,d),this.fogState&&ht&&mt.name!=="globe"&&(Pt=function($t,qt,Qt,Xt,sr,ir){const hr=ir.calculateFogTileMatrix(sr),mr=[qt,Qt,Xt];return c.af(mr,mr,hr),Wn($t,c.ag(mr),ir.pitch,ir._fov)}(this.fogState,$,st,lt,ht.toUnwrapped(),this.transform)>.9)):is(Tt,Tt,d);const Mt=Tt[3];return{point:new c.P((Tt[0]/Mt+1)/2*this.transform.width+qs,(-Tt[1]/Mt+1)/2*this.transform.height+qs),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(mt)/Mt*.5,1.5),signedDistanceFromCamera:Mt,occluded:dt&&Tt[2]>Mt||Pt}}isOffscreen(d,$,st,lt){return st<qs||d>=this.screenRightBoundary||lt<qs||$>this.screenBottomBoundary}isInsideGrid(d,$,st,lt){return st>=0&&d<this.gridRightBoundary&&lt>=0&&$<this.gridBottomBoundary}getViewportMatrix(){const d=c.bA([]);return c.br(d,d,[-100,-100,0]),d}}class Nu{constructor(d,$,st,lt){this.opacity=d?Math.max(0,Math.min(1,d.opacity+(d.placed?$:-$))):lt&&st?1:0,this.placed=st}isHidden(){return this.opacity===0&&!this.placed}}class Lp{constructor(d,$,st,lt,ht,dt=!1){this.text=new Nu(d?d.text:null,$,st,ht),this.icon=new Nu(d?d.icon:null,$,lt,ht),this.clipped=dt}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class po{constructor(d,$,st,lt=!1){this.text=d,this.icon=$,this.skipFade=st,this.clipped=lt}}class gy{constructor(){this.invProjMatrix=c.bC(),this.viewportMatrix=c.bC(),this.circles=[]}}class m_{constructor(d,$,st,lt,ht){this.bucketInstanceId=d,this.featureIndex=$,this.sourceLayerIndex=st,this.bucketIndex=lt,this.tileID=ht}}class g_{constructor(d){this.crossSourceCollisions=d,this.maxGroupID=0,this.collisionGroups={}}get(d){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[d]){const $=++this.maxGroupID;this.collisionGroups[d]={ID:$,predicate:st=>st.collisionGroupID===$}}return this.collisionGroups[d]}}function fu(it,d,$,st,lt){const{horizontalAlign:ht,verticalAlign:dt}=c.c1(it),mt=-(ht-.5)*d,Tt=-(dt-.5)*$,Pt=c.c2(it,st);return new c.P(mt+Pt[0]*lt,Tt+Pt[1]*lt)}function Ml(it,d,$,st,lt){const ht=new c.P(it,d);return $&&ht._rotate(st?lt:-lt),ht}class QE{constructor(d,$,st,lt,ht,dt){this.transform=d.clone(),this.projection=d.projection.name,this.collisionIndex=new yo(this.transform,ht),this.buildingIndex=dt,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=$,this.retainedQueryData={},this.collisionGroups=new g_(st),this.collisionCircleArrays={},this.prevPlacement=lt,lt&&(lt.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(d,$,st,lt,ht=1){const dt=st.getBucket($),mt=st.latestFeatureIndex;if(!dt||!mt||$.fqid!==dt.layerIds[0])return;const Tt=dt.layers[0].layout,Pt=dt.layers[0].paint,Mt=st.collisionBoxArray,Ht=Math.pow(2,this.transform.zoom-st.tileID.overscaledZ),$t=st.tileSize/c.al,qt=st.tileID.toUnwrapped();this.transform.setProjection(dt.projection);const Qt=(Xt=st.tileID,sr=dt.getProjection(),ir=this.transform,sr.name===this.projection?ir.calculateProjMatrix(Xt.toUnwrapped()):nv(ir,sr,Xt));var Xt,sr,ir;const hr=Tt.get("text-pitch-alignment")==="map",mr=Tt.get("text-rotation-alignment")==="map";$.compileFilter($.options);const dr=$.dynamicFilter(),Ir=$.dynamicFilterNeedsFeature(),Tr=this.transform.calculatePixelsToTileUnitsMatrix(st),Ar=my(Qt,st.tileID.canonical,hr,mr,this.transform,dt.getProjection(),Tr);let Er=null;const vr=dt.getProjection().createInversionMatrix(this.transform,st.tileID.canonical);if(hr){const Nr=p_(Qt,st.tileID.canonical,hr,mr,this.transform,dt.getProjection(),Tr);Er=c.aB([],this.transform.labelPlaneMatrix,Nr)}let Pr=null;dr&&st.latestFeatureIndex&&(Pr={unwrappedTileID:qt,dynamicFilter:dr,dynamicFilterNeedsFeature:Ir}),this.retainedQueryData[dt.bucketInstanceId]=new m_(dt.bucketInstanceId,mt,dt.sourceLayerIndex,dt.index,st.tileID);const[Br,Or]=dt.layers[0].layout.get("text-size-scale-range"),Yr=c.aA(ht,Br,Or),[Qr,un]=Tt.get("icon-size-scale-range"),Cn=c.aA(ht,Qr,un),qr={bucket:dt,layout:Tt,paint:Pt,posMatrix:Qt,invMatrix:vr,mercatorCenter:[c.aF(this.transform.center.lng),c.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ar,labelToScreenMatrix:Er,clippingData:Pr,scale:Ht,textPixelRatio:$t,holdingForFade:st.holdingForFade(),collisionBoxArray:Mt,partiallyEvaluatedTextSize:c.bK(dt.textSizeData,this.transform.zoom,Yr),partiallyEvaluatedIconSize:c.bK(dt.iconSizeData,this.transform.zoom,Cn),collisionGroup:this.collisionGroups.get(dt.sourceID),latestFeatureIndex:st.latestFeatureIndex};if(lt)for(const Nr of dt.sortKeyRanges){const{sortKey:tn,symbolInstanceStart:Kr,symbolInstanceEnd:yn}=Nr;d.push({sortKey:tn,symbolInstanceStart:Kr,symbolInstanceEnd:yn,parameters:qr})}else d.push({symbolInstanceStart:0,symbolInstanceEnd:dt.symbolInstances.length,parameters:qr})}attemptAnchorPlacement(d,$,st,lt,ht,dt,mt,Tt,Pt,Mt,Ht,$t,qt,Qt,Xt,sr,ir,hr,mr,dr,Ir){const{textOffset0:Tr,textOffset1:Ar,crossTileID:Er}=Xt,vr=[Tr,Ar],Pr=fu(d,dt,mt,vr,Tt),Br=this.collisionIndex.placeCollisionBox(ir,Tt,$,st,lt,ht,Ml(Pr.x,Pr.y,Pt,Mt,this.transform.angle),Qt,Ht,$t,qt.predicate);if(mr){const Or=ir.getSymbolInstanceIconSize(Ir,this.transform.zoom,Xt.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ir,Or,mr,st,lt,ht,Ml(Pr.x,Pr.y,Pt,Mt,this.transform.angle),Qt,Ht,$t,qt.predicate).box.length===0)return}if(Br.box.length>0){let Or;return this.prevPlacement&&this.prevPlacement.variableOffsets[Er]&&this.prevPlacement.placements[Er]&&this.prevPlacement.placements[Er].text&&(Or=this.prevPlacement.variableOffsets[Er].anchor),this.variableOffsets[Er]={textOffset:vr,width:dt,height:mt,anchor:d,textScale:Tt,prevAnchor:Or},this.markUsedJustification(ir,d,Xt,hr),ir.allowVerticalPlacement&&(this.markUsedOrientation(ir,hr,Xt),this.placedOrientations[Er]=hr),{shift:Pr,placedGlyphBoxes:Br}}}placeLayerBucketPart(d,$,st,lt,ht=1){const{bucket:dt,layout:mt,paint:Tt,posMatrix:Pt,textLabelPlaneMatrix:Mt,labelToScreenMatrix:Ht,clippingData:$t,textPixelRatio:qt,mercatorCenter:Qt,invMatrix:Xt,holdingForFade:sr,collisionBoxArray:ir,partiallyEvaluatedTextSize:hr,partiallyEvaluatedIconSize:mr,collisionGroup:dr,latestFeatureIndex:Ir}=d.parameters,Tr=mt.get("text-optional"),Ar=mt.get("icon-optional"),Er=mt.get("text-allow-overlap"),vr=mt.get("icon-allow-overlap"),Pr=mt.get("text-rotation-alignment")==="map",Br=mt.get("icon-rotation-alignment")==="map",Or=mt.get("text-pitch-alignment")==="map",Yr=Tt.get("symbol-z-offset"),Qr=mt.get("symbol-elevation-reference")==="sea",un=mt.get("symbol-placement"),[Cn,qr]=mt.get("text-size-scale-range"),[Nr,tn]=mt.get("icon-size-scale-range"),Kr=c.aA(ht,Cn,qr),yn=c.aA(ht,Nr,tn),Ln=mt.get("text-variable-anchor"),Un=Pr&&un!=="point",kn=Br&&un!=="point",An=Ln&&dt.hasTextData(),Qn=dt.hasIconTextFit()&&An&&dt.hasIconData();this.transform.setProjection(dt.projection);const Kn=An||Un,zn=kn||Qn;let Gn=Er&&(vr||!dt.hasIconData()||Ar),as=vr&&(Er||!dt.hasTextData()||Tr);const Es=!Yr.isConstant();!dt.collisionArrays&&ir&&dt.deserializeCollisionBoxes(ir),st&&lt&&dt.updateCollisionDebugBuffers(this.transform.zoom,ir,Kr,yn);const $s=(Jn,ro,bs)=>{const{crossTileID:co,numVerticalGlyphVertices:xo}=Jn;let mo=null;if($t&&$t.dynamicFilterNeedsFeature||Es){const _a=this.retainedQueryData[dt.bucketInstanceId];mo=Ir.loadFeature({featureIndex:Jn.featureIndex,bucketIndex:_a.bucketIndex,sourceLayerIndex:_a.sourceLayerIndex,layoutVertexArrayOffset:0});const wl=mo.properties?mo.properties.worldview:null;if(dt.localizable&&dt.worldview&&typeof wl=="string")if(wl==="all")mo.properties.$localized=!0;else{if(!wl.split(",").includes(dt.worldview))return;mo.properties.$localized=!0,mo.properties.worldview=dt.worldview}}if($t&&!(0,$t.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:dt.worldview},mo,this.retainedQueryData[dt.bucketInstanceId].tileID.canonical,new c.P(Jn.tileAnchorX,Jn.tileAnchorY),this.transform.calculateDistanceTileData($t.unwrappedTileID)))return this.placements[co]=new po(!1,!1,!1,!0),void $.add(co);const to=Yr.evaluate(mo,{});if($.has(co))return;if(sr)return void(this.placements[co]=new po(!1,!1,!1));let Ms=!1,ao=!1,Zo=!0,Bo=!1,uo=!1,Ys=null,Ds={box:null,offscreen:null,occluded:null},Lo={box:null},_l=null,Ho=null,So=null,Pu=0,cu=0,zl=0;bs.textFeatureIndex?Pu=bs.textFeatureIndex:Jn.useRuntimeCollisionCircles&&(Pu=Jn.featureIndex),bs.verticalTextFeatureIndex&&(cu=bs.verticalTextFeatureIndex);const gu=dt.elevationFeatures?dt.elevationFeatures[Jn.elevationFeatureIndex]:void 0,_u=_a=>{_a.tileID=this.retainedQueryData[dt.bucketInstanceId].tileID;const wl=this.transform.elevation;_a.elevation=Qr?to:to+c.bV.getAtTileOffset(_a.tileID,new c.P(_a.tileAnchorX,_a.tileAnchorY),wl,gu),_a.elevation+=Jn.zOffset},nu=bs.textBox;if(nu){_u(nu);const _a=Co=>{let Al=c.bL.horizontal;if(dt.allowVerticalPlacement&&!Co&&this.prevPlacement){const Yo=this.prevPlacement.placedOrientations[co];Yo&&(this.placedOrientations[co]=Yo,Al=Yo,this.markUsedOrientation(dt,Al,Jn))}return Al},wl=(Co,Al)=>{if(dt.allowVerticalPlacement&&xo>0&&bs.verticalTextBox){for(const Yo of dt.writingModes)if(Yo===c.bL.vertical?(Ds=Al(),Lo=Ds):Ds=Co(),Ds&&Ds.box&&Ds.box.length)break}else Ds=Co()};if(Ln){let Co=Ln;if(this.prevPlacement&&this.prevPlacement.variableOffsets[co]){const Wo=this.prevPlacement.variableOffsets[co];Co.indexOf(Wo.anchor)>0&&(Co=Co.filter(fp=>fp!==Wo.anchor),Co.unshift(Wo.anchor))}const Al=(Wo,fp,G_)=>{const Sp=dt.getSymbolInstanceTextSize(hr,Jn,this.transform.zoom,ro),H_=(Wo.x2-Wo.x1)*Sp+2*Wo.padding,H0=(Wo.y2-Wo.y1)*Sp+2*Wo.padding,Gp=Jn.hasIconTextFit&&!vr?fp:null;Gp&&_u(Gp);let cm={box:[],offscreen:!1,occluded:!1};const W0=Er?2*Co.length:Co.length;for(let Bm=0;Bm<W0;++Bm){const um=this.attemptAnchorPlacement(Co[Bm%Co.length],Wo,Qt,Xt,Kn,H_,H0,Sp,Pr,Or,qt,Pt,dr,Bm>=Co.length,Jn,ro,dt,G_,Gp,hr,mr);if(um&&(cm=um.placedGlyphBoxes,cm&&cm.box&&cm.box.length)){Ms=!0,Ys=um.shift;break}}return cm};wl(()=>Al(nu,bs.iconBox,c.bL.horizontal),()=>{const Wo=bs.verticalTextBox;return Wo&&_u(Wo),dt.allowVerticalPlacement&&!(Ds&&Ds.box&&Ds.box.length)&&xo>0&&Wo?Al(Wo,bs.verticalIconBox,c.bL.vertical):{box:null,offscreen:null,occluded:null}}),Ds&&(Ms=Ds.box,Zo=Ds.offscreen,Bo=Ds.occluded);const Yo=_a(!(!Ds||!Ds.box));if(!Ms&&this.prevPlacement){const Wo=this.prevPlacement.variableOffsets[co];Wo&&(this.variableOffsets[co]=Wo,this.markUsedJustification(dt,Wo.anchor,Jn,Yo))}}else{const Co=(Al,Yo)=>{const Wo=dt.getSymbolInstanceTextSize(hr,Jn,this.transform.zoom,ro),fp=this.collisionIndex.placeCollisionBox(dt,Wo,Al,Qt,Xt,Kn,new c.P(0,0),Er,qt,Pt,dr.predicate);return fp&&fp.box&&fp.box.length&&(this.markUsedOrientation(dt,Yo,Jn),this.placedOrientations[co]=Yo),fp};wl(()=>Co(nu,c.bL.horizontal),()=>{const Al=bs.verticalTextBox;return dt.allowVerticalPlacement&&xo>0&&Al?(_u(Al),Co(Al,c.bL.vertical)):{box:null,offscreen:null,occluded:null}}),_a(!!(Ds&&Ds.box&&Ds.box.length))}}if(_l=Ds,Ms=_l&&_l.box&&_l.box.length>0,Zo=_l&&_l.offscreen,Bo=_l&&_l.occluded,Jn.useRuntimeCollisionCircles){const _a=Jn.centerJustifiedTextSymbolIndex>=0?Jn.centerJustifiedTextSymbolIndex:Jn.verticalPlacedTextSymbolIndex,wl=dt.text.placedSymbolArray.get(_a),Co=c.bM(dt.textSizeData,hr,wl),Al=mt.get("text-padding");Ho=this.collisionIndex.placeCollisionCircles(dt,Er,wl,_a,dt.lineVertexArray,dt.glyphOffsetArray,Co,Pt,Mt,Ht,st,Or,dr.predicate,Jn.collisionCircleDiameter*Co/c.bY,Al,this.retainedQueryData[dt.bucketInstanceId].tileID),Ms=Er||Ho.circles.length>0&&!Ho.collisionDetected,Zo=Zo&&Ho.offscreen,Bo=Ho.occluded}if(bs.iconFeatureIndex&&(zl=bs.iconFeatureIndex),bs.iconBox){const _a=wl=>{_u(wl);const Co=Jn.hasIconTextFit&&Ys?Ml(Ys.x,Ys.y,Pr,Or,this.transform.angle):new c.P(0,0),Al=dt.getSymbolInstanceIconSize(mr,this.transform.zoom,Jn.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(dt,Al,wl,Qt,Xt,zn,Co,vr,qt,Pt,dr.predicate)};Lo&&Lo.box&&Lo.box.length&&bs.verticalIconBox?(So=_a(bs.verticalIconBox),ao=So.box.length>0):(So=_a(bs.iconBox),ao=So.box.length>0),Zo=Zo&&So.offscreen,uo=So.occluded}const Zu=Tr||Jn.numHorizontalGlyphVertices===0&&xo===0,pp=Ar||Jn.numIconVertices===0;if(Zu||pp?pp?Zu||(ao=ao&&Ms):Ms=ao&&Ms:ao=Ms=ao&&Ms,Ms&&_l&&_l.box&&this.collisionIndex.insertCollisionBox(_l.box,mt.get("text-ignore-placement"),dt.bucketInstanceId,Lo&&Lo.box&&cu?cu:Pu,dr.ID),ao&&So&&this.collisionIndex.insertCollisionBox(So.box,mt.get("icon-ignore-placement"),dt.bucketInstanceId,zl,dr.ID),Ho&&(Ms&&this.collisionIndex.insertCollisionCircles(Ho.circles,mt.get("text-ignore-placement"),dt.bucketInstanceId,Pu,dr.ID),st)){const _a=dt.bucketInstanceId;let wl=this.collisionCircleArrays[_a];wl===void 0&&(wl=this.collisionCircleArrays[_a]=new gy);for(let Co=0;Co<Ho.circles.length;Co+=4)wl.circles.push(Ho.circles[Co+0]),wl.circles.push(Ho.circles[Co+1]),wl.circles.push(Ho.circles[Co+2]),wl.circles.push(Ho.collisionDetected?1:0)}const ju=dt.projection.name!=="globe";Gn=Gn&&(ju||!Bo),as=as&&(ju||!uo),this.placements[co]=new po(Ms||Gn,ao||as,Zo||dt.justReloaded),$.add(co)},so=this.retainedQueryData[dt.bucketInstanceId].tileID;if(dt.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(dt,so),dt.elevationType==="road"&&dt.updateRoadElevation(so.canonical),dt.updateZOffset(),dt.sortFeaturesByY){const Jn=dt.getSortedSymbolIndexes(this.transform.angle);for(let ro=Jn.length-1;ro>=0;--ro){const bs=Jn[ro];$s(dt.symbolInstances.get(bs),bs,dt.collisionArrays[bs])}dt.hasAnyZOffset&&c.w(`${dt.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(dt.hasAnyZOffset){const Jn=dt.getSortedIndexesByZOffset();for(let ro=0;ro<Jn.length;++ro){const bs=Jn[ro];$s(dt.symbolInstances.get(bs),bs,dt.collisionArrays[bs])}}else for(let Jn=d.symbolInstanceStart;Jn<d.symbolInstanceEnd;Jn++)$s(dt.symbolInstances.get(Jn),Jn,dt.collisionArrays[Jn]);if(st&&dt.bucketInstanceId in this.collisionCircleArrays){const Jn=this.collisionCircleArrays[dt.bucketInstanceId];c.bl(Jn.invProjMatrix,Pt),Jn.viewportMatrix=this.collisionIndex.getViewportMatrix()}dt.justReloaded=!1}markUsedJustification(d,$,st,lt){const{leftJustifiedTextSymbolIndex:ht,centerJustifiedTextSymbolIndex:dt,rightJustifiedTextSymbolIndex:mt,verticalPlacedTextSymbolIndex:Tt,crossTileID:Pt}=st,Mt=c.c3($),Ht=lt===c.bL.vertical?Tt:Mt==="left"?ht:Mt==="center"?dt:Mt==="right"?mt:-1;ht>=0&&(d.text.placedSymbolArray.get(ht).crossTileID=Ht>=0&&ht!==Ht?0:Pt),dt>=0&&(d.text.placedSymbolArray.get(dt).crossTileID=Ht>=0&&dt!==Ht?0:Pt),mt>=0&&(d.text.placedSymbolArray.get(mt).crossTileID=Ht>=0&&mt!==Ht?0:Pt),Tt>=0&&(d.text.placedSymbolArray.get(Tt).crossTileID=Ht>=0&&Tt!==Ht?0:Pt)}markUsedOrientation(d,$,st){const lt=$===c.bL.horizontal||$===c.bL.horizontalOnly?$:0,ht=$===c.bL.vertical?$:0,{leftJustifiedTextSymbolIndex:dt,centerJustifiedTextSymbolIndex:mt,rightJustifiedTextSymbolIndex:Tt,verticalPlacedTextSymbolIndex:Pt}=st,Mt=d.text.placedSymbolArray;dt>=0&&(Mt.get(dt).placedOrientation=lt),mt>=0&&(Mt.get(mt).placedOrientation=lt),Tt>=0&&(Mt.get(Tt).placedOrientation=lt),Pt>=0&&(Mt.get(Pt).placedOrientation=ht)}commit(d){this.commitTime=d,this.zoomAtLastRecencyCheck=this.transform.zoom;const $=this.prevPlacement;let st=!1;this.prevZoomAdjustment=$?$.zoomAdjustment(this.transform.zoom):0;const lt=$?$.symbolFadeChange(d):1,ht=$?$.opacities:{},dt=$?$.variableOffsets:{},mt=$?$.placedOrientations:{};for(const Tt in this.placements){const Pt=this.placements[Tt],Mt=ht[Tt];Mt?(this.opacities[Tt]=new Lp(Mt,lt,Pt.text,Pt.icon,null,Pt.clipped),st=st||Pt.text!==Mt.text.placed||Pt.icon!==Mt.icon.placed):(this.opacities[Tt]=new Lp(null,lt,Pt.text,Pt.icon,Pt.skipFade,Pt.clipped),st=st||Pt.text||Pt.icon)}for(const Tt in ht){const Pt=ht[Tt];if(!this.opacities[Tt]){const Mt=new Lp(Pt,lt,!1,!1);Mt.isHidden()||(this.opacities[Tt]=Mt,st=st||Pt.text.placed||Pt.icon.placed)}}for(const Tt in dt)this.variableOffsets[Tt]||!this.opacities[Tt]||this.opacities[Tt].isHidden()||(this.variableOffsets[Tt]=dt[Tt]);for(const Tt in mt)this.placedOrientations[Tt]||!this.opacities[Tt]||this.opacities[Tt].isHidden()||(this.placedOrientations[Tt]=mt[Tt]);st?this.lastPlacementChangeTime=d:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=$?$.lastPlacementChangeTime:d)}updateLayerOpacities(d,$,st,lt){lt&&(this.lastReplacementSourceUpdateTime=lt.updateTime);const ht=new Set;for(const dt of $){const mt=dt.getBucket(d);mt&&dt.latestFeatureIndex&&d.fqid===mt.layerIds[0]&&(this.updateBucketOpacities(mt,ht,dt,dt.collisionBoxArray,st,lt,dt.tileID,d.scope),mt.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(mt,dt.tileID),mt.elevationType==="road"&&mt.updateRoadElevation(dt.tileID.canonical),mt.updateZOffset())}}updateBucketOpacities(d,$,st,lt,ht,dt,mt,Tt){d.hasTextData()&&d.text.opacityVertexArray.clear(),d.hasIconData()&&d.icon.opacityVertexArray.clear(),d.hasIconCollisionBoxData()&&d.iconCollisionBox.collisionVertexArray.clear(),d.hasTextCollisionBoxData()&&d.textCollisionBox.collisionVertexArray.clear();const Pt=d.layers[0].layout,Mt=d.layers[0].paint,Ht=!!d.layers[0].dynamicFilter(),$t=new Lp(null,0,!1,!1,!0),qt=Pt.get("text-allow-overlap"),Qt=Pt.get("icon-allow-overlap"),Xt=Pt.get("text-variable-anchor"),sr=Pt.get("text-rotation-alignment")==="map",ir=Pt.get("text-pitch-alignment")==="map",hr=Mt.get("symbol-z-offset"),mr=Pt.get("symbol-elevation-reference")==="sea",dr=!hr.isConstant(),Ir=new Lp(null,0,qt&&(Qt||!d.hasIconData()||Pt.get("icon-optional")),Qt&&(qt||!d.hasTextData()||Pt.get("text-optional")),!0);!d.collisionArrays&&lt&&(d.hasIconCollisionBoxData()||d.hasTextCollisionBoxData())&&d.deserializeCollisionBoxes(lt);const Tr=(Er,vr,Pr)=>{for(let Br=0;Br<vr/4;Br++)Er.opacityVertexArray.emplaceBack(Pr)};let Ar=0;dt&&d.updateReplacement(mt,dt);for(let Er=0;Er<d.symbolInstances.length;Er++){const vr=d.symbolInstances.get(Er),{numHorizontalGlyphVertices:Pr,numVerticalGlyphVertices:Br,crossTileID:Or,numIconVertices:Yr,tileAnchorX:Qr,tileAnchorY:un}=vr;let Cn=null;const qr=this.retainedQueryData[d.bucketInstanceId];dr&&vr&&qr&&(Cn=st.latestFeatureIndex.loadFeature({featureIndex:vr.featureIndex,bucketIndex:qr.bucketIndex,sourceLayerIndex:qr.sourceLayerIndex,layoutVertexArrayOffset:0}));const Nr=hr.evaluate(Cn,{}),tn=$.has(Or);let Kr=this.opacities[Or];tn?Kr=$t:Kr||(Kr=Ir,this.opacities[Or]=Kr),$.add(Or);const yn=Pr>0||Br>0,Ln=Yr>0,Un=this.placedOrientations[Or],kn=Un===c.bL.vertical,An=Un===c.bL.horizontal||Un===c.bL.horizontalOnly;!yn&&!Ln||Kr.isHidden()||Ar++;let Qn=!1;if((yn||Ln)&&dt)for(const Kn of d.activeReplacements){if(c.bZ(Kn,ht,c.b_.Symbol,Tt)||Kn.min.x>Qr||Qr>Kn.max.x||Kn.min.y>un||un>Kn.max.y)continue;const zn=c.b$(Qr,un,mt.canonical,Kn.footprintTileId.canonical);if(Qn=c.c0(zn,Kn.footprint),Qn)break}if(yn){const Kn=Qn?_g:Cu(Kr.text);Tr(d.text,Pr,kn?_g:Kn),Tr(d.text,Br,An?_g:Kn);const zn=Kr.text.isHidden(),{leftJustifiedTextSymbolIndex:Gn,centerJustifiedTextSymbolIndex:as,rightJustifiedTextSymbolIndex:Es,verticalPlacedTextSymbolIndex:$s}=vr,so=d.text.placedSymbolArray,Jn=zn||kn?1:0;Gn>=0&&(so.get(Gn).hidden=Jn),as>=0&&(so.get(as).hidden=Jn),Es>=0&&(so.get(Es).hidden=Jn),$s>=0&&(so.get($s).hidden=zn||An?1:0);const ro=this.variableOffsets[Or];ro&&this.markUsedJustification(d,ro.anchor,vr,Un);const bs=this.placedOrientations[Or];bs&&(this.markUsedJustification(d,"left",vr,bs),this.markUsedOrientation(d,bs,vr))}if(Ln){const Kn=Qn?_g:Cu(Kr.icon),{placedIconSymbolIndex:zn,verticalPlacedIconSymbolIndex:Gn}=vr,as=d.icon.placedSymbolArray,Es=Kr.icon.isHidden()?1:0;zn>=0&&(Tr(d.icon,Yr,kn?_g:Kn),as.get(zn).hidden=Es),Gn>=0&&(Tr(d.icon,vr.numVerticalIconVertices,An?_g:Kn),as.get(Gn).hidden=Es)}if(d.hasIconCollisionBoxData()||d.hasTextCollisionBoxData()){const Kn=d.collisionArrays[Er];if(Kn){let zn=new c.P(0,0),Gn=!0;if(Kn.textBox||Kn.verticalTextBox){if(Xt){const Es=this.variableOffsets[Or];Es?(zn=fu(Es.anchor,Es.width,Es.height,Es.textOffset,Es.textScale),sr&&zn._rotate(ir?this.transform.angle:-this.transform.angle)):Gn=!1}Ht&&(Gn=!Kr.clipped),Kn.textBox&&Tm(d.textCollisionBox.collisionVertexArray,Kr.text.placed,!Gn||kn,Nr,mr,zn.x,zn.y),Kn.verticalTextBox&&Tm(d.textCollisionBox.collisionVertexArray,Kr.text.placed,!Gn||An,Nr,mr,zn.x,zn.y)}const as=Gn&&!!(!An&&Kn.verticalIconBox);Kn.iconBox&&Tm(d.iconCollisionBox.collisionVertexArray,Kr.icon.placed,as,Nr,mr,vr.hasIconTextFit?zn.x:0,vr.hasIconTextFit?zn.y:0),Kn.verticalIconBox&&Tm(d.iconCollisionBox.collisionVertexArray,Kr.icon.placed,!as,Nr,mr,vr.hasIconTextFit?zn.x:0,vr.hasIconTextFit?zn.y:0)}}}if(d.fullyClipped=Ar===0,d.sortFeatures(this.transform.angle),this.retainedQueryData[d.bucketInstanceId]&&(this.retainedQueryData[d.bucketInstanceId].featureSortOrder=d.featureSortOrder),d.hasTextData()&&d.text.opacityVertexBuffer&&d.text.opacityVertexBuffer.updateData(d.text.opacityVertexArray),d.hasIconData()&&d.icon.opacityVertexBuffer&&d.icon.opacityVertexBuffer.updateData(d.icon.opacityVertexArray),d.hasIconCollisionBoxData()&&d.iconCollisionBox.collisionVertexBuffer&&d.iconCollisionBox.collisionVertexBuffer.updateData(d.iconCollisionBox.collisionVertexArray),d.hasTextCollisionBoxData()&&d.textCollisionBox.collisionVertexBuffer&&d.textCollisionBox.collisionVertexBuffer.updateData(d.textCollisionBox.collisionVertexArray),d.bucketInstanceId in this.collisionCircleArrays){const Er=this.collisionCircleArrays[d.bucketInstanceId];d.placementInvProjMatrix=Er.invProjMatrix,d.placementViewportMatrix=Er.viewportMatrix,d.collisionCircleArray=Er.circles,delete this.collisionCircleArrays[d.bucketInstanceId]}}symbolFadeChange(d){return this.fadeDuration===0?1:(d-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(d){return Math.max(0,(this.transform.zoom-d)/1.5)}hasTransitions(d){return this.stale||d-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(d,$){const st=this.zoomAtLastRecencyCheck===$?1-this.zoomAdjustment($):1;return this.zoomAtLastRecencyCheck=$,this.commitTime+this.fadeDuration*st>d}isStale(){return this.stale}setStale(){this.stale=!0}}function Tm(it,d,$,st,lt,ht,dt){it.emplaceBack(d?1:0,$?1:0,ht||0,dt||0,st,lt?1:0),it.emplaceBack(d?1:0,$?1:0,ht||0,dt||0,st,lt?1:0),it.emplaceBack(d?1:0,$?1:0,ht||0,dt||0,st,lt?1:0),it.emplaceBack(d?1:0,$?1:0,ht||0,dt||0,st,lt?1:0)}const av=Math.pow(2,25),__=Math.pow(2,24),_y=Math.pow(2,17),lv=Math.pow(2,16),yy=Math.pow(2,9),Su=Math.pow(2,8),Zp=Math.pow(2,1);function Cu(it){if(it.opacity===0&&!it.placed)return 0;if(it.opacity===1&&it.placed)return 4294967295;const d=it.placed?1:0,$=Math.floor(127*it.opacity);return $*av+d*__+$*_y+d*lv+$*yy+d*Su+$*Zp+d}const _g=0;class w0{constructor(d){this._sortAcrossTiles=d.layout.get("symbol-z-order")!=="viewport-y"&&d.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(d,$,st,lt,ht,dt){const mt=this._bucketParts;for(;this._currentTileIndex<d.length;)if($.getBucketParts(mt,lt,d[this._currentTileIndex],this._sortAcrossTiles,dt),this._currentTileIndex++,ht())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,mt.sort((Tt,Pt)=>Tt.sortKey-Pt.sortKey));this._currentPartIndex<mt.length;){const Tt=mt[this._currentPartIndex];if($.placeLayerBucketPart(Tt,this._seenCrossTileIDs,st,Tt.symbolInstanceStart===0,dt),this._currentPartIndex++,ht())return!0}return!1}}class Zl{constructor(d,$,st,lt,ht,dt,mt,Tt,Pt){this.placement=new QE(d,ht,dt,mt,Tt,Pt),this._currentPlacementIndex=$.length-1,this._forceFullPlacement=st,this._showCollisionBoxes=lt,this._done=!1}isDone(){return this._done}continuePlacement(d,$,st,lt,ht){const dt=c.o.now(),mt=()=>{const Tt=c.o.now()-dt;return!this._forceFullPlacement&&Tt>2};for(;this._currentPlacementIndex>=0;){const Tt=$[d[this._currentPlacementIndex]],Pt=this.placement.collisionIndex.transform.zoom;if(Tt.type==="symbol"&&Tt.visibility!=="none"&&(!Tt.minzoom||Tt.minzoom<=Pt)&&(!Tt.maxzoom||Tt.maxzoom>Pt)){const Mt=Tt,Ht=Mt.layout.get("symbol-z-elevate"),$t=Mt.layout.get("symbol-sort-key").constantOr(1)!==void 0,qt=Mt.layout.get("symbol-z-order"),Qt=qt==="viewport-y"||qt==="auto"&&!(qt!=="viewport-y"&&$t),Xt=Mt.layout.get("text-allow-overlap")||Mt.layout.get("icon-allow-overlap")||Mt.layout.get("text-ignore-placement")||Mt.layout.get("icon-ignore-placement"),sr=Qt&&Xt,ir=this._inProgressLayer=this._inProgressLayer||new w0(Mt),hr=c.B(Tt.source,Tt.scope);if(ir.continuePlacement(Ht||sr?lt[hr]:st[hr],this.placement,this._showCollisionBoxes,Tt,mt,ht))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(d){return this.placement.commit(d),this.placement}}const ap=512/c.al/2;class Yp{constructor(d,$,st){this.tileID=d,this.bucketInstanceId=st,this.index=new c.c4($.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const lt=d.canonical.x*c.al,ht=d.canonical.y*c.al;for(let dt=0;dt<$.length;dt++){const{key:mt,crossTileID:Tt,tileAnchorX:Pt,tileAnchorY:Mt}=$.get(dt),Ht=Math.floor((lt+Pt)*ap),$t=Math.floor((ht+Mt)*ap);this.index.add(Ht,$t),this.keys.push(mt),this.crossTileIDs.push(Tt)}this.index.finish()}findMatches(d,$,st){const lt=this.tileID.canonical.z<$.canonical.z?1:Math.pow(2,this.tileID.canonical.z-$.canonical.z),ht=ap/Math.pow(2,$.canonical.z-this.tileID.canonical.z),dt=$.canonical.x*c.al,mt=$.canonical.y*c.al;for(let Tt=0;Tt<d.length;Tt++){const Pt=d.get(Tt);if(Pt.crossTileID)continue;const{key:Mt,tileAnchorX:Ht,tileAnchorY:$t}=Pt,qt=Math.floor((dt+Ht)*ht),Qt=Math.floor((mt+$t)*ht),Xt=this.index.range(qt-lt,Qt-lt,qt+lt,Qt+lt).sort((sr,ir)=>sr-ir);for(const sr of Xt){const ir=this.crossTileIDs[sr];if(this.keys[sr]===Mt&&!st.has(ir)){st.add(ir),Pt.crossTileID=ir;break}}}}}class Gl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class cv{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(d){const $=Math.round((d-this.lng)/360);if($!==0)for(const st in this.indexes){const lt=this.indexes[st],ht={};for(const dt in lt){const mt=lt[dt];mt.tileID=mt.tileID.unwrapTo(mt.tileID.wrap+$),ht[mt.tileID.key]=mt}this.indexes[st]=ht}this.lng=d}addBucket(d,$,st){if(this.indexes[d.overscaledZ]&&this.indexes[d.overscaledZ][d.key]){if(this.indexes[d.overscaledZ][d.key].bucketInstanceId===$.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(d.overscaledZ,this.indexes[d.overscaledZ][d.key])}for(let ht=0;ht<$.symbolInstances.length;ht++)$.symbolInstances.get(ht).crossTileID=0;this.usedCrossTileIDs[d.overscaledZ]||(this.usedCrossTileIDs[d.overscaledZ]=new Set);const lt=this.usedCrossTileIDs[d.overscaledZ];for(const ht in this.indexes){const dt=this.indexes[ht];if(Number(ht)>d.overscaledZ)for(const mt in dt){const Tt=dt[mt];Tt.tileID.isChildOf(d)&&Tt.findMatches($.symbolInstances,d,lt)}else{const mt=dt[d.scaledTo(Number(ht)).key];mt&&mt.findMatches($.symbolInstances,d,lt)}}for(let ht=0;ht<$.symbolInstances.length;ht++){const dt=$.symbolInstances.get(ht);dt.crossTileID||(dt.crossTileID=st.generate(),lt.add(dt.crossTileID))}return this.indexes[d.overscaledZ]===void 0&&(this.indexes[d.overscaledZ]={}),this.indexes[d.overscaledZ][d.key]=new Yp(d,$.symbolInstances,$.bucketInstanceId),!0}removeBucketCrossTileIDs(d,$){for(const st of $.crossTileIDs)this.usedCrossTileIDs[d].delete(st)}removeStaleBuckets(d){let $=!1;for(const st in this.indexes){const lt=this.indexes[st];for(const ht in lt)d[lt[ht].bucketInstanceId]||(this.removeBucketCrossTileIDs(st,lt[ht]),delete lt[ht],$=!0)}return $}}class vp{constructor(){this.layerIndexes={},this.crossTileIDs=new Gl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(d,$,st,lt){let ht=this.layerIndexes[d.fqid];ht===void 0&&(ht=this.layerIndexes[d.fqid]=new cv);let dt=!1;const mt={};lt.name!=="globe"&&ht.handleWrapJump(st);for(const Tt of $){const Pt=Tt.getBucket(d);Pt&&d.fqid===Pt.layerIds[0]&&(Pt.bucketInstanceId||(Pt.bucketInstanceId=++this.maxBucketInstanceId),ht.addBucket(Tt.tileID,Pt,this.crossTileIDs)&&(dt=!0),mt[Pt.bucketInstanceId]=!0)}return ht.removeStaleBuckets(mt)&&(dt=!0),dt}pruneUnusedLayers(d){const $={};d.forEach(st=>{$[st]=!0});for(const st in this.layerIndexes)$[st]||delete this.layerIndexes[st]}}const Op=771;class Ps{constructor(d,$,st,lt){this.blendFunction=d,this.blendColor=$.toNonPremultipliedRenderColor(null),this.mask=st,this.blendEquation=lt}}Ps.Replace=[1,0,1,0],Ps.disabled=new Ps(Ps.Replace,c.ao.transparent,[!1,!1,!1,!1]),Ps.unblended=new Ps(Ps.Replace,c.ao.transparent,[!0,!0,!0,!0]),Ps.alphaBlended=new Ps([1,Op,1,Op],c.ao.transparent,[!0,!0,!0,!0]),Ps.alphaBlendedNonPremultiplied=new Ps([770,Op,770,Op],c.ao.transparent,[!0,!0,!0,!0]),Ps.multiply=new Ps([774,0,774,0],c.ao.transparent,[!0,!0,!0,!0]),Ps.additive=new Ps([1,1,1,1],c.ao.transparent,[!0,!0,!0,!0]);class es{constructor(d,$,st){this.func=d,this.mask=$,this.range=st}}es.ReadOnly=!1,es.ReadWrite=!0,es.disabled=new es(519,es.ReadOnly,[0,1]);const xy=7680;class _s{constructor(d,$,st,lt,ht,dt){this.test=d,this.ref=$,this.mask=st,this.fail=lt,this.depthFail=ht,this.pass=dt}}_s.disabled=new _s({func:519,mask:0},0,0,xy,xy,xy);const E0=1029,vy=2305;class gs{constructor(d,$,st){this.enable=d,this.mode=$,this.frontFace=st}}function jp(it,d){const $=c.ca(it,3);c.cc(it,d),c.cg(it,3,$)}function uv(it,d){const $=c.c7([]);return c.c8($,$,-d),c.c9($,$,-it),$}function by(it,d){const $=[it[0],it[1],0],st=[d[0],d[1],0];if(c.ag($)>=1e-15){const dt=c.aw([],$);c.c5(st,dt,c.bJ(st,dt)),d[0]=st[0],d[1]=st[1]}const lt=c.bI([],d,it);if(c.c6(lt)<1e-15)return null;const ht=Math.atan2(-lt[1],lt[0]);return uv(Math.atan2(Math.sqrt(it[0]*it[0]+it[1]*it[1]),-it[2]),ht)}gs.disabled=new gs(!1,E0,vy),gs.backCCW=new gs(!0,E0,vy),gs.backCW=new gs(!0,E0,2304),gs.frontCW=new gs(!0,1028,2304),gs.frontCCW=new gs(!0,1028,vy);class Au{constructor(d,$){this.position=d,this.orientation=$}get position(){return this._position}set position(d){if(d){const $=d instanceof c.ae?d:new c.ae(d[0],d[1],d[2]);this._renderWorldCopies&&($.x=c.bT($.x,0,1)),this._position=$}else this._position=null}lookAtPoint(d,$,st){if(this.orientation=null,!this.position)return;const lt=this.position,ht=st||(this._elevation?this._elevation.getAtPointOrZero(c.ae.fromLngLat(d)):0),dt=c.ae.fromLngLat(d,ht),mt=[dt.x-lt.x,dt.y-lt.y,dt.z-lt.z];$||($=[0,0,1]),$[2]=Math.abs($[2]),this.orientation=by(mt,$)}setPitchBearing(d,$){this.orientation=uv(c.an(d),c.an(-$))}}class wy{constructor(d,$){this._transform=c.bA([]),this.orientation=$,this.position=d}get mercatorPosition(){const d=this.position;return new c.ae(d[0],d[1],d[2])}get position(){const d=c.ca(this._transform,3);return[d[0],d[1],d[2]]}set position(d){var $;d&&c.cg(this._transform,3,[($=d)[0],$[1],$[2],1])}get orientation(){return this._orientation}set orientation(d){this._orientation=d||c.c7([]),d&&jp(this._transform,this._orientation)}getPitchBearing(){const d=this.forward(),$=this.right();return{bearing:Math.atan2(-$[1],$[0]),pitch:Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2])}}setPitchBearing(d,$){this._orientation=uv(d,$),jp(this._transform,this._orientation)}forward(){const d=c.ca(this._transform,2);return[-d[0],-d[1],-d[2]]}up(){const d=c.ca(this._transform,1);return[-d[0],-d[1],-d[2]]}right(){const d=c.ca(this._transform,0);return[d[0],d[1],d[2]]}getCameraToWorld(d,$){const st=new Float64Array(16);return c.bl(st,this.getWorldToCamera(d,$)),st}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(d,$,st){const lt=this.position;c.c5(lt,lt,-d);const ht=new Float64Array(16);return c.bq(ht,[st,st,st]),c.br(ht,ht,lt),ht[10]*=$,ht}getWorldToCamera(d,$){const st=new Float64Array(16),lt=new Float64Array(4),ht=this.position;return c.cb(lt,this._orientation),c.c5(ht,ht,-d),c.cc(st,lt),c.br(st,st,ht),st[1]*=-1,st[5]*=-1,st[9]*=-1,st[13]*=-1,st[8]*=$,st[9]*=$,st[10]*=$,st[11]*=$,st}getCameraToClipPerspective(d,$,st,lt){const ht=new Float64Array(16);return c.cd(ht,d,$,st,lt),ht}getCameraToClipOrthographic(d,$,st,lt,ht,dt){const mt=new Float64Array(16);return c.ce(mt,d,$,st,lt,ht,dt),mt}getDistanceToElevation(d,$=!1){const st=d===0?0:c.cf(d,$?c.a$(this.position[1]):this.position[1]),lt=this.forward();return(st-this.position[2])/lt[2]}clone(){return new wy([...this.position],[...this.orientation])}}const _c={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Ey{constructor(d=0,$=0,st=0,lt=0){if(isNaN(d)||d<0||isNaN($)||$<0||isNaN(st)||st<0||isNaN(lt)||lt<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=d,this.bottom=$,this.left=st,this.right=lt}interpolate(d,$,st){return $.top!=null&&d.top!=null&&(this.top=c.ak(d.top,$.top,st)),$.bottom!=null&&d.bottom!=null&&(this.bottom=c.ak(d.bottom,$.bottom,st)),$.left!=null&&d.left!=null&&(this.left=c.ak(d.left,$.left,st)),$.right!=null&&d.right!=null&&(this.right=c.ak(d.right,$.right,st)),this}getCenter(d,$){const st=c.aA((this.left+d-this.right)/2,0,d),lt=c.aA((this.top+$-this.bottom)/2,0,$);return new c.P(st,lt)}equals(d){return this.top===d.top&&this.bottom===d.bottom&&this.left===d.left&&this.right===d.right}clone(){return new Ey(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const bp=15;class hv{constructor(d,$,st,lt,ht,dt,mt){this.tileSize=512,this._renderWorldCopies=ht===void 0||ht,this._minZoom=d||0,this._maxZoom=$||22,this._minPitch=st??0,this._maxPitch=lt??60,this.setProjection(dt),this.setMaxBounds(mt),this.width=0,this.height=0,this._center=new c.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ey,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new wy,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const d=new hv(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return d._elevation=this._elevation,d._centerAltitude=this._centerAltitude,d._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,d.tileSize=this.tileSize,d.mercatorFromTransition=this.mercatorFromTransition,d.width=this.width,d.height=this.height,d.cameraElevationReference=this.cameraElevationReference,d._center=this._center,d._setZoom(this.zoom),d._seaLevelZoom=this._seaLevelZoom,d.angle=this.angle,d._fov=this._fov,d._pitch=this._pitch,d._nearZ=this._nearZ,d._farZ=this._farZ,d._averageElevation=this._averageElevation,d._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,d._unmodified=this._unmodified,d._edgeInsets=this._edgeInsets.clone(),d._camera=this._camera.clone(),d._calcMatrices(),d.freezeTileCoverage=this.freezeTileCoverage,d.frustumCorners=this.frustumCorners,d._allowWorldUnderZoom=this._allowWorldUnderZoom,d}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<bp}get elevation(){return this._elevation}set elevation(d){this._elevation!==d&&(this._elevation=d,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(d,$=!1){const st=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||st)&&this._updateCameraOnTerrain(),(d||st)&&this._constrainCamera($),this._calcMatrices()}getProjection(){return c.aH(this.projection,["name","center","parallels"])}setProjection(d){this.projectionOptions=d||{name:"mercator"};const $=this.projection?this.getProjection():void 0;this.projection=c.cm(this.projectionOptions);const st=this.getProjection(),lt=!c.by($,st);return lt&&this._calcMatrices(),this.mercatorFromTransition=!1,lt}setOrthographicProjectionAtLowPitch(d){return this._orthographicProjectionAtLowPitch!==d&&(this._orthographicProjectionAtLowPitch=d,this._calcMatrices(),!0)}setMercatorFromTransition(){const d=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=c.cm({name:"mercator"});const $=d!==this.projection.name;return $&&this._calcMatrices(),$}get minZoom(){return this._minZoom}set minZoom(d){this._minZoom!==d&&(this._minZoom=d,this.zoom=Math.max(this.zoom,d))}get maxZoom(){return this._maxZoom}set maxZoom(d){this._maxZoom!==d&&(this._maxZoom=d,this.zoom=Math.min(this.zoom,d))}get minPitch(){return this._minPitch}set minPitch(d){this._minPitch!==d&&(this._minPitch=d,this.pitch=Math.max(this.pitch,d))}get maxPitch(){return this._maxPitch}set maxPitch(d){this._maxPitch!==d&&(this._maxPitch=d,this.pitch=Math.min(this.pitch,d))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(d){d===void 0?d=!0:d===null&&(d=!1),this._renderWorldCopies=d}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const d=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(d))}get cameraWorldSize(){const d=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(d))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return c.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return c.bT(this.rotation,-180,180)}set bearing(d){this.rotation=d}get rotation(){return-this.angle/Math.PI*180}set rotation(d){const $=-d*Math.PI/180;this.angle!==$&&(this._unmodified=!1,this.angle=$,this._calcMatrices(),this.rotationMatrix=c.cn(),c.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(d){const $=c.aA(d,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==$&&(this._unmodified=!1,this._pitch=$,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(d){d=Math.max(.01,Math.min(60,d)),this._fov!==d&&(this._unmodified=!1,this._fov=c.an(d),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const d=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/d)}get averageElevation(){return this._averageElevation}set averageElevation(d){this._averageElevation=d,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(d){const $=Math.min(Math.max(d,this.minZoom),this.maxZoom);this._zoom!==$&&(this._unmodified=!1,this._setZoom($),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(d){this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(d){this._tileCoverLift!==d&&(this._tileCoverLift=d)}_updateCameraOnTerrain(){const d=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,$=this.elevation&&d===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||d===Number.NEGATIVE_INFINITY&&(!$||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const st=this._elevation;$||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&st.exaggeration()&&this._centerAltitudeValidForExaggeration!==st.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*st.exaggeration(),this._centerAltitudeValidForExaggeration=st.exaggeration()):(this._centerAltitude=d||0,this._centerAltitudeValidForExaggeration=st.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const d=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(d)}sampleAverageElevation(){if(!this._elevation)return 0;const d=this._elevation,$=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],st=this.horizonLineFromTop();let lt=0,ht=0;for(let dt=0;dt<$.length;dt++){const mt=new c.P($[dt][0]*this.width,st+$[dt][1]*(this.height-st)),Tt=d.pointCoordinate(mt);if(!Tt)continue;const Pt=1/Math.hypot(Tt[0]-this._camera.position[0],Tt[1]-this._camera.position[1]);lt+=Tt[3]*Pt,ht+=Pt}return ht===0?NaN:lt/ht}get center(){return this._center}set center(d){d.lat===this._center.lat&&d.lng===this._center.lng||(this._unmodified=!1,this._center=d,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const d=this._seaLevelZoom,$=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),st=this.pixelsPerMeter/this.worldSize*$,lt=this._mercatorZfromZoom(d),ht=this._mercatorZfromZoom(this._maxZoom),dt=Math.max(lt-st,ht);this._setZoom(this._zoomFromMercatorZ(dt))}get padding(){return this._edgeInsets.toJSON()}set padding(d){this._edgeInsets.equals(d)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,d,1),this._calcMatrices())}equals(d){const $=this.elevation,st=d.elevation,lt=$!=null!=(st!=null)||$&&st&&$.exaggeration()!==st.exaggeration();return this.width===d.width&&this.height===d.height&&this.center.lng===d.center.lng&&this.center.lat===d.center.lat&&this.zoom===d.zoom&&this.bearing===d.bearing&&this.pitch===d.pitch&&this.fov===d.fov&&this.projection.name===d.projection.name&&this._edgeInsets.equals(d.padding)&&!lt}computeZoomRelativeTo(d){const $=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,d.toAltitude()));let st;st=d.z<this._camera.position[2]?[$.x,$.y,$.z]:[d.x,d.y,d.z];const lt=c.ag(c.av([],this._camera.position,st));return c.aA(this._zoomFromMercatorZ(lt),this._minZoom,this._maxZoom)}setFreeCameraOptions(d){if(!this.height||!d.position&&!d.orientation)return;this._updateCameraState();let $=!1;if(d.orientation&&!c.cp(d.orientation,this._camera.orientation)&&($=this._setCameraOrientation(d.orientation)),d.position){const st=[d.position.x,d.position.y,d.position.z];c.cq(st,this._camera.position)||(this._setCameraPosition(st),$=!0)}$&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const d=this._camera.position,$=new Au;return $.position=new c.ae(d[0],d[1],d[2]),$.orientation=this._camera.orientation,$._elevation=this.elevation,$._renderWorldCopies=this.renderWorldCopies,$}_setCameraOrientation(d){if(!c.cr(d))return!1;c.cs(d,d);const $=c.ct([],[0,0,-1],d),st=c.ct([],[0,-1,0],d);if(st[2]<0)return!1;const lt=by($,st);return!!lt&&(this._camera.orientation=lt,!0)}_setCameraPosition(d){const $=this.zoomScale(this.minZoom)*this.tileSize,st=this.zoomScale(this.maxZoom)*this.tileSize,lt=this.cameraToCenterDistance;d[2]=c.aA(d[2],lt/st,lt/$),this._camera.position=d}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(d){return this._edgeInsets.equals(d)}interpolatePadding(d,$,st){this._unmodified=!1,this._edgeInsets.interpolate(d,$,st),this._constrain(),this._calcMatrices()}coveringZoomLevel(d){const $=(d.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/d.tileSize));return Math.max(0,$)}getVisibleUnwrappedCoordinates(d){const $=[new c.cu(0,d)];if(this.renderWorldCopies){const st=this.pointCoordinate(new c.P(0,0)),lt=this.pointCoordinate(new c.P(this.width,0)),ht=this.pointCoordinate(new c.P(this.width,this.height)),dt=this.pointCoordinate(new c.P(0,this.height)),mt=Math.floor(Math.min(st.x,lt.x,ht.x,dt.x)),Tt=Math.floor(Math.max(st.x,lt.x,ht.x,dt.x)),Pt=1;for(let Mt=mt-Pt;Mt<=Tt+Pt;Mt++)Mt!==0&&$.push(new c.cu(Mt,d))}return $}isLODDisabled(d){return(!d||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(d,$,st,lt){let ht=[];const dt=st!=null,mt=!dt;if(mt&&this.zoom<$||dt&&st[0]===0&&st[1]===0)return ht;const Tt=new Set,Pt=(Ht,$t,qt,Qt,Xt)=>{const sr=c.cY($t,Ht,qt,Qt,Xt);Tt.has(sr)||(ht.push(new c.aQ(Ht,$t,qt,Qt,Xt)),Tt.add(sr))};for(let Ht=0;Ht<d.length;Ht++){const $t=d[Ht];if(mt&&$t.canonical.z!==$||dt&&lt!==void 0&&lt>$t.canonical.z)continue;const qt=$t.canonical,Qt=$t.overscaledZ,Xt=$t.wrap,sr=1<<qt.z,ir=qt.x+1<sr,hr=qt.x>0,mr=qt.y+1<sr,dr=qt.y>0,Ir=$t.wrap-(hr?0:1),Tr=$t.wrap+(ir?0:1),Ar=hr?qt.x-1:sr-1,Er=ir?qt.x+1:0;if(dt)st[0]<0?(Pt(Qt,Tr,qt.z,Er,qt.y),st[1]<0&&mr&&(Pt(Qt,Xt,qt.z,qt.x,qt.y+1),Pt(Qt,Tr,qt.z,Er,qt.y+1)),st[1]>0&&dr&&(Pt(Qt,Xt,qt.z,qt.x,qt.y-1),Pt(Qt,Tr,qt.z,Er,qt.y-1))):st[0]>0?(Pt(Qt,Ir,qt.z,Ar,qt.y),st[1]<0&&mr&&(Pt(Qt,Xt,qt.z,qt.x,qt.y+1),Pt(Qt,Ir,qt.z,Ar,qt.y+1)),st[1]>0&&dr&&(Pt(Qt,Xt,qt.z,qt.x,qt.y-1),Pt(Qt,Ir,qt.z,Ar,qt.y-1))):st[1]<0&&mr?Pt(Qt,Xt,qt.z,qt.x,qt.y+1):dr&&Pt(Qt,Xt,qt.z,qt.x,qt.y-1);else{const vr=$t.visibleQuadrants;1&vr&&(Pt(Qt,Ir,qt.z,Ar,qt.y),dr&&(Pt(Qt,Xt,qt.z,qt.x,qt.y-1),Pt(Qt,Ir,qt.z,Ar,qt.y-1))),2&vr&&(Pt(Qt,Tr,qt.z,Er,qt.y),dr&&(Pt(Qt,Xt,qt.z,qt.x,qt.y-1),Pt(Qt,Tr,qt.z,Er,qt.y-1))),4&vr&&(Pt(Qt,Ir,qt.z,Ar,qt.y),mr&&(Pt(Qt,Xt,qt.z,qt.x,qt.y+1),Pt(Qt,Ir,qt.z,Ar,qt.y+1))),8&vr&&(Pt(Qt,Tr,qt.z,Er,qt.y),mr&&(Pt(Qt,Xt,qt.z,qt.x,qt.y+1),Pt(Qt,Tr,qt.z,Er,qt.y+1)))}}const Mt=[];for(const Ht of ht)ht.some($t=>Ht.isChildOf($t))||Mt.push(Ht);if(ht=Mt.filter(Ht=>!d.some($t=>!!(Ht.overscaledZ<$&&$t.isChildOf(Ht))||Ht.equals($t)||Ht.isChildOf($t))),mt){const Ht=1<<$,$t=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),qt=[Ht*$t.x,Ht*$t.y],Qt=4,Xt=Qt*Qt;ht=ht.filter(sr=>{const ir=sr.canonical.x+.5-qt[0],hr=sr.canonical.y+.5-qt[1];return ir*ir+hr*hr<Xt})}return ht}extendTileCoverToNearPlane(d,$,st){const lt=[],ht=new Set;for(const hr of d)ht.add(hr.key);const dt=(hr,mr,dr,Ir,Tr)=>{const Ar=c.cY(mr,hr,dr,Ir,Tr);ht.has(Ar)||(lt.push(new c.aQ(hr,mr,dr,Ir,Tr)),ht.add(Ar))},mt=d.reduce((hr,mr)=>Math.max(hr,mr.overscaledZ),st),Tt=1<<st,Pt=[new c.P(0,0),new c.P(c.al,0),new c.P(c.al,c.al),new c.P(0,c.al)],Mt=new c.P(0,0),Ht=new c.P(0,0),$t=(hr,mr)=>{const dr=Math.floor(hr[0]),Ir=Math.floor(hr[1]),Tr=(hr[0]-dr)*c.al,Ar=(hr[1]-Ir)*c.al,Er=Math.floor(mr[0]),vr=Math.floor(mr[1]),Pr=(mr[0]-Er)*c.al,Br=(mr[1]-vr)*c.al;for(let Or=-1;Or<=1;Or++){const Yr=dr+Or;if(!(Yr<0||Yr>=Tt)){Mt.x=Tr-Or*c.al,Ht.x=Pr-(Yr-Er)*c.al;for(let Qr=-1;Qr<=1;Qr++){const un=Ir+Qr;Mt.y=Ar-Qr*c.al,Ht.y=Br-(un-vr)*c.al,c.cZ(Mt,Ht,Pt)&&dt(mt,0,st,Yr,un)}}}},qt=$.points,Qt=qt[c.cv],Xt=qt[c.cw],sr=this._projectToGround(Qt,qt[c.cx]),ir=this._projectToGround(Xt,qt[c.cy]);return $t(Qt,sr),$t(Xt,ir),lt}_projectToGround(d,$){return c.cz(c.cA(),d,$,d[2]/(d[2]-$[2]))}coveringTiles(d){let $=this.coveringZoomLevel(d);const st=$,lt=this.elevation&&this.elevation.exaggeration(),ht=lt&&!d.isTerrainDEM,dt=this.projection.name==="mercator";if(d.minzoom!==void 0&&$<d.minzoom)return[];d.maxzoom!==void 0&&$>d.maxzoom&&($=d.maxzoom);const mt=this.locationCoordinate(this.center),Tt=this.center.lat,Pt=1<<$,Mt=[Pt*mt.x,Pt*mt.y,0],Ht=this.projection.name==="globe",$t=!Ht,qt=c.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,$,$t),Qt=Ht?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Xt=Pt*c.cf(1,this.center.lat),sr=this._camera.position[2]/c.cf(1,this.center.lat),ir=[Pt*Qt.x,Pt*Qt.y,sr*($t?1:Xt)],hr=Ht||lt,mr=this.cameraToCenterDistance/d.tileSize*(d.roundZoom?1:.502),dr=this.isLODDisabled(!0)?$:0;let Ir;if(this._elevation&&d.isTerrainDEM)Ir=1e4*this._elevation.exaggeration();else if(this._elevation){const Nr=this._elevation.getMinMaxForVisibleTiles();Ir=Nr?Nr.max:this._centerAltitude}else Ir=this._centerAltitude;const Tr=d.isTerrainDEM?-Ir:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ar=this.projection.isReprojectedInTileSpace?c.cC(this):1,Er=Nr=>{const Kr=new c.ae(Nr.x+25e-6,Nr.y,Nr.z),yn=new c.ae(Nr.x,Nr.y+25e-6,Nr.z),Ln=Nr.toLngLat(),Un=Kr.toLngLat(),kn=yn.toLngLat(),An=this.locationCoordinate(Ln),Qn=this.locationCoordinate(Un),Kn=this.locationCoordinate(kn),zn=Math.hypot(Qn.x-An.x,Qn.y-An.y),Gn=Math.hypot(Kn.x-An.x,Kn.y-An.y);return Math.sqrt(zn*Gn)*Ar/25e-6},vr=Nr=>{const tn=Ir,Kr=Tr;return{aabb:c.cF(this,Pt,0,0,0,Nr,Kr,tn,this.projection),zoom:0,x:0,y:0,minZ:Kr,maxZ:tn,wrap:Nr,fullyVisible:!1}},Pr=[];let Br=[];const Or=$,Yr=d.reparseOverscaled?st:$,Qr=(sr-this._centerAltitude)*Xt,un=Nr=>{if(!this._elevation||!Nr.tileID||!dt)return;const tn=this._elevation.getMinMaxForTile(Nr.tileID),Kr=Nr.aabb;tn?(Kr.min[2]=tn.min,Kr.max[2]=tn.max,Kr.center[2]=(Kr.min[2]+Kr.max[2])/2):(Nr.shouldSplit=qr(Nr),Nr.shouldSplit||(Kr.min[2]=Kr.max[2]=Kr.center[2]=this._centerAltitude))},Cn=(Nr,tn)=>{if(.707*tn<Nr)return 1;const Kr=tn/Nr;return Kr/(1.4144271570014144+(Math.pow(1.1,Kr-1.4144271570014144+1)-1)/(1.1-1)-1)},qr=Nr=>{if(Nr.zoom<dr)return!0;if(Nr.zoom===Or)return!1;if(Nr.shouldSplit!=null)return Nr.shouldSplit;const tn=Nr.aabb.distanceX(ir),Kr=Nr.aabb.distanceY(ir);let yn=Qr,Ln=1;if(Ht){yn=Nr.aabb.distanceZ(ir);const Gn=Math.pow(2,Nr.zoom),as=c.a$((Nr.y+1)/Gn),Es=c.a$(Nr.y/Gn),$s=Math.min(Math.max(Tt,as),Es),so=c.d1($s)/c.d1(Tt);if(Ln=$s===Tt?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,so/this._mercatorScaleRatio),this.zoom<=c.c_&&Nr.zoom===Or-1&&so>=.9)return!0}else if(ht&&(yn=Nr.aabb.distanceZ(ir)*Xt),this.projection.isReprojectedInTileSpace&&st<=5){const Gn=Math.pow(2,Nr.zoom),as=Er(new c.ae((Nr.x+.5)/Gn,(Nr.y+.5)/Gn));Ln=as>.85?1:as}if(!dt&&!Ht){const Gn=Math.sqrt(tn*tn+Kr*Kr+yn*yn);let as=(1<<Or-Nr.zoom)*mr*Ln;return as*=Cn(Math.max(yn,Qr),Gn),Gn<as}let Un=Number.MAX_VALUE,kn=0;const An=Nr.aabb.getCorners(),Qn=[];for(const Gn of An){c.av(Qn,Gn,ir),Ht||(ht?Qn[2]*=Xt:Qn[2]=Qr);const as=c.bJ(Qn,this._camera.forward());as<Un&&(Un=as,kn=Math.abs(Qn[2]))}let Kn=(1<<Or-Nr.zoom)*mr*Ln;if(Kn*=Cn(Math.max(kn,Qr),Un),Un<Kn)return!0;const zn=Nr.aabb.closestPoint(Mt);return zn[0]===Mt[0]&&zn[1]===Mt[1]};if(this.renderWorldCopies)for(let Nr=1;Nr<=3;Nr++)Pr.push(vr(-Nr)),Pr.push(vr(Nr));for(Pr.push(vr(0));Pr.length>0;){const Nr=Pr.pop(),tn=Nr.x,Kr=Nr.y;let yn=Nr.fullyVisible;const Ln=()=>this.projection.name==="globe"&&(Nr.y===0||Nr.y===(1<<Nr.zoom)-1);if(!yn){let Un=hr?Nr.aabb.intersects(qt):Nr.aabb.intersectsFlat(qt);if(Un===0&&Ln()){const kn=new c.cD(Nr.zoom,tn,Kr);Un=c.cE(this,Pt,kn,!0).intersects(qt)}if(Un===0)continue;yn=Un===2}if(Nr.zoom!==Or&&qr(Nr))for(let Un=0;Un<4;Un++){const kn=(tn<<1)+Un%2,An=(Kr<<1)+(Un>>1),Qn={aabb:dt?Nr.aabb.quadrant(Un):c.cF(this,Pt,Nr.zoom+1,kn,An,Nr.wrap,Nr.minZ,Nr.maxZ,this.projection),zoom:Nr.zoom+1,x:kn,y:An,wrap:Nr.wrap,fullyVisible:yn,tileID:void 0,shouldSplit:void 0,minZ:Nr.minZ,maxZ:Nr.maxZ};ht&&!Ht&&(Qn.tileID=new c.aQ(Nr.zoom+1===Or?Yr:Nr.zoom+1,Nr.wrap,Nr.zoom+1,kn,An),un(Qn)),Pr.push(Qn)}else{const Un=Nr.zoom===Or?Yr:Nr.zoom;if(d.minzoom&&d.minzoom>Un)continue;let kn=0;if(!yn){let zn=hr?Nr.aabb.intersectsPrecise(qt):Nr.aabb.intersectsPreciseFlat(qt);if(zn===0&&Ln()){const Gn=new c.cD(Nr.zoom,tn,Kr);zn=c.cE(this,Pt,Gn,!0).intersectsPrecise(qt)}if(zn===0)continue;if(d.calculateQuadrantVisibility)if(qt.containsPoint(Nr.aabb.center))kn=15;else for(let Gn=0;Gn<4;Gn++)Nr.aabb.quadrant(Gn).intersects(qt)!==0&&(kn|=1<<Gn)}const An=Mt[0]-(.5+tn+(Nr.wrap<<Nr.zoom))*(1<<$-Nr.zoom),Qn=Mt[1]-.5-Kr,Kn=Nr.tileID?Nr.tileID:new c.aQ(Un,Nr.wrap,Nr.zoom,tn,Kr);d.calculateQuadrantVisibility&&(Kn.visibleQuadrants=kn),Br.push({tileID:Kn,distanceSq:An*An+Qn*Qn})}}if(this.fogCullDistSq){const Nr=this.fogCullDistSq,tn=this.horizonLineFromTop();Br=Br.filter(Kr=>{const yn=[0,0,0,1],Ln=[c.al,c.al,0,1],Un=this.calculateFogTileMatrix(Kr.tileID.toUnwrapped());c.aC(yn,yn,Un),c.aC(Ln,Ln,Un);const kn=c.cG([],yn,Ln),An=c.cH([],yn,Ln),Qn=c.c$(kn,An);if(Qn===0)return!0;let Kn=!1;const zn=this._elevation;if(zn&&Qn>Nr&&tn!==0){const Gn=this.calculateProjMatrix(Kr.tileID.toUnwrapped());let as;d.isTerrainDEM||(as=zn.getMinMaxForTile(Kr.tileID)),as||(as={min:Tr,max:Ir});const Es=c.cI(this.rotation),$s=[Es[0]*c.al,Es[1]*c.al,as.max];c.af($s,$s,Gn),Kn=(1-$s[1])*this.height*.5<tn}return Qn<Nr||Kn})}return Br.sort((Nr,tn)=>Nr.distanceSq-tn.distanceSq).map(Nr=>Nr.tileID)}resize(d,$){this.width=d,this.height=$,this.pixelsToGLUnits=[2/d,-2/$],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(d){return Math.pow(2,d)}scaleZoom(d){return Math.log2(d)}project(d){const $=c.aA(d.lat,-c.cJ,c.cJ),st=this.projection.project(d.lng,$);return new c.P(st.x*this.worldSize,st.y*this.worldSize)}unproject(d){return this.projection.unproject(d.x/this.worldSize,d.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/c.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(d,$){let st,lt;const ht=this.centerPoint;if(this.projection.name==="globe"){const mt=this.worldSize;st=($.x-ht.x)/mt,lt=($.y-ht.y)/mt}else{const mt=this.pointCoordinate($),Tt=this.pointCoordinate(ht);st=mt.x-Tt.x,lt=mt.y-Tt.y}const dt=this.locationCoordinate(d);this.setLocation(new c.ae(dt.x-st,dt.y-lt))}setLocation(d){this.center=this.coordinateLocation(d),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(d,$){return this.projection.locationPoint(this,d,$)}locationPoint3D(d,$){return this.projection.locationPoint(this,d,$,!0)}pointLocation(d){return this.coordinateLocation(this.pointCoordinate(d))}pointLocation3D(d,$){return this.coordinateLocation(this.pointCoordinate3D(d,$))}locationCoordinate(d,$){const st=$?c.cf($,d.lat):void 0,lt=this.projection.project(d.lng,d.lat);return new c.ae(lt.x,lt.y,st)}coordinateLocation(d){return this.projection.unproject(d.x,d.y)}pointRayIntersection(d,$){const st=$??this._centerAltitude,lt=[d.x,d.y,0,1],ht=[d.x,d.y,1,1];c.aC(lt,lt,this.pixelMatrixInverse),c.aC(ht,ht,this.pixelMatrixInverse);const dt=ht[3];c.cK(lt,lt,1/lt[3]),c.cK(ht,ht,1/dt);const mt=lt[2],Tt=ht[2];return{p0:lt,p1:ht,t:mt===Tt?0:(st-mt)/(Tt-mt)}}screenPointToMercatorRay(d){const $=[d.x,d.y,0,1],st=[d.x,d.y,1,1];return c.aC($,$,this.pixelMatrixInverse),c.aC(st,st,this.pixelMatrixInverse),c.cK($,$,1/$[3]),c.cK(st,st,1/st[3]),$[2]=c.cf($[2],this._center.lat)*this.worldSize,st[2]=c.cf(st[2],this._center.lat)*this.worldSize,c.cK($,$,1/this.worldSize),c.cK(st,st,1/this.worldSize),new c.ax([$[0],$[1],$[2]],c.aw([],c.av([],st,$)))}rayIntersectionCoordinate(d){const{p0:$,p1:st,t:lt}=d,ht=c.cf($[2],this._center.lat),dt=c.cf(st[2],this._center.lat);return new c.ae(c.ak($[0],st[0],lt)/this.worldSize,c.ak($[1],st[1],lt)/this.worldSize,c.ak(ht,dt,lt))}pointCoordinate(d,$=this._centerAltitude){return this.projection.pointCoordinate(this,d.x,d.y,$)}pointCoordinate3D(d,$){if(!this.elevation)return this.pointCoordinate(d,$);let st=this.projection.pointCoordinate3D(this,d.x,d.y);if(st)return new c.ae(st[0],st[1],st[2]);let lt=0,ht=this.horizonLineFromTop();if(d.y>ht)return this.pointCoordinate(d,$);const dt=.02*ht,mt=d.clone();for(let Tt=0;Tt<10&&ht-lt>dt;Tt++){mt.y=c.ak(lt,ht,.66);const Pt=this.projection.pointCoordinate3D(this,mt.x,mt.y);Pt?(ht=mt.y,st=Pt):lt=mt.y}return st?new c.ae(st[0],st[1],st[2]):this.pointCoordinate(d)}isPointAboveHorizon(d){return this.projection.isPointAboveHorizon(this,d)}isPointOnSurface(d){if(d.y<0||d.y>this.height||d.x<0||d.x>this.width)return!1;if(this.elevation||this.zoom>=c.cL)return!this.isPointAboveHorizon(d);const $=this.pointCoordinate(d);return $.y>=0&&$.y<=1}_coordinatePoint(d,$){const st=$&&this.elevation?this.elevation.getAtPointOrZero(d,this._centerAltitude):this._centerAltitude,lt=[d.x*this.worldSize,d.y*this.worldSize,st+d.toAltitude(),1];return c.aC(lt,lt,this.pixelMatrix),lt[3]>0?new c.P(lt[0]/lt[3],lt[1]/lt[3]):new c.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:d,left:$}=this._edgeInsets,st=this.height-this._edgeInsets.bottom,lt=this.width-this._edgeInsets.right,ht=this.pointLocation3D(new c.P($,d)),dt=this.pointLocation3D(new c.P(lt,d)),mt=this.pointLocation3D(new c.P(lt,st)),Tt=this.pointLocation3D(new c.P($,st));let Pt=Math.min(ht.lng,dt.lng,mt.lng,Tt.lng),Mt=Math.max(ht.lng,dt.lng,mt.lng,Tt.lng),Ht=Math.min(ht.lat,dt.lat,mt.lat,Tt.lat),$t=Math.max(ht.lat,dt.lat,mt.lat,Tt.lat);const qt=Math.pow(2,-this.zoom)/16*270,Qt=this.projection.name==="globe"?1:4,Xt=(sr,ir,hr,mr,dr)=>{const Ir=(sr+hr)/2,Tr=(ir+mr)/2,Ar=new c.P(Ir,Tr),{lng:Er,lat:vr}=this.pointLocation3D(Ar),Pr=Math.max(0,Pt-Er,Ht-vr,Er-Mt,vr-$t);Pt=Math.min(Pt,Er),Mt=Math.max(Mt,Er),Ht=Math.min(Ht,vr),$t=Math.max($t,vr),(dr<Qt||Pr>qt)&&(Xt(sr,ir,Ir,Tr,dr+1),Xt(Ir,Tr,hr,mr,dr+1))};if(Xt($,d,lt,d,1),Xt(lt,d,lt,st,1),Xt(lt,st,$,st,1),Xt($,st,$,d,1),this.projection.name==="globe"){const[sr,ir]=c.cM(this);sr?($t=90,Mt=180,Pt=-180):ir&&(Ht=-90,Mt=180,Pt=-180)}return new c.aI(new c.aT(Pt,Ht),new c.aT(Mt,$t))}_getBoundsRectangular(d,$){const{top:st,left:lt}=this._edgeInsets,ht=this.height-this._edgeInsets.bottom,dt=this.width-this._edgeInsets.right,mt=new c.P(lt,st),Tt=new c.P(dt,st),Pt=new c.P(dt,ht),Mt=new c.P(lt,ht);let Ht=this.pointCoordinate(mt,d),$t=this.pointCoordinate(Tt,d);const qt=this.pointCoordinate(Pt,$),Qt=this.pointCoordinate(Mt,$),Xt=(sr,ir)=>(ir.y-sr.y)/(ir.x-sr.x);return Ht.y>1&&$t.y>=0?Ht=new c.ae((1-Qt.y)/Xt(Qt,Ht)+Qt.x,1):Ht.y<0&&$t.y<=1&&(Ht=new c.ae(-Qt.y/Xt(Qt,Ht)+Qt.x,0)),$t.y>1&&Ht.y>=0?$t=new c.ae((1-qt.y)/Xt(qt,$t)+qt.x,1):$t.y<0&&Ht.y<=1&&($t=new c.ae(-qt.y/Xt(qt,$t)+qt.x,0)),new c.aI().extend(this.coordinateLocation(Ht)).extend(this.coordinateLocation($t)).extend(this.coordinateLocation(Qt)).extend(this.coordinateLocation(qt))}_getBoundsRectangularTerrain(){const d=this.elevation;if(!d.visibleDemTiles.length||d.isUsingMockSource())return this._getBoundsRectangular(0,0);const $=d.visibleDemTiles.reduce((st,lt)=>{if(lt.dem){const ht=lt.dem.tree;st.min=Math.min(st.min,ht.minimums[0]),st.max=Math.max(st.max,ht.maximums[0])}return st},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular($.min*d.exaggeration(),$.max*d.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(d=!0){const $=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,st=this.height/2-$*(1-this._horizonShift);return d?Math.max(0,st):st}getMaxBounds(){return this.maxBounds}setMaxBounds(d){this.maxBounds=d,this.minLat=-c.cJ,this.maxLat=c.cJ,this.minLng=-180,this.maxLng=180,d&&(this.minLat=d.getSouth(),this.maxLat=d.getNorth(),this.minLng=d.getWest(),this.maxLng=d.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=c.aF(this.minLng)*this.tileSize,this.worldMaxX=c.aF(this.maxLng)*this.tileSize,this.worldMinY=c.aJ(this.maxLat)*this.tileSize,this.worldMaxY=c.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(d,$){return this.projection.createTileMatrix(this,$,d)}calculateDistanceTileData(d){const $=d.key,st=this._distanceTileDataCache;if(st[$])return st[$];const lt=d.canonical,ht=1/this.height,dt=this.cameraWorldSize,mt=dt/this.zoomScale(lt.z),Tt=(lt.x+Math.pow(2,lt.z)*d.wrap)*mt,Pt=lt.y*mt,Mt=this.point;Mt.x*=dt/this.worldSize,Mt.y*=dt/this.worldSize;const Ht=this.angle,$t=Math.sin(-Ht),qt=-Math.cos(-Ht);return st[$]={bearing:[$t,qt],center:[(Mt.x-Tt)*ht,(Mt.y-Pt)*ht],scale:mt/c.al*ht},st[$]}calculateFogTileMatrix(d){const $=d.key,st=this._fogTileMatrixCache;if(st[$])return st[$];const lt=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,d);return c.aB(lt,this.worldToFogMatrix,lt),st[$]=new Float32Array(lt),st[$]}calculateProjMatrix(d,$=!1,st=!1){const lt=d.key;let ht;if(ht=st?this._expandedProjMatrixCache:$?this._alignedProjMatrixCache:this._projMatrixCache,ht[lt])return ht[lt];const dt=this.calculatePosMatrix(d,this.worldSize);let mt;return mt=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:st?this.expandedFarZProjMatrix:$?this.alignedProjMatrix:this.projMatrix,c.aB(dt,mt,dt),ht[lt]=new Float32Array(dt),ht[lt]}calculatePixelsToTileUnitsMatrix(d){const $=d.tileID.key,st=this._pixelsToTileUnitsCache;if(st[$])return st[$];const lt=c.cN(d,this);return st[$]=lt,st[$]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const d=1/this.worldSize,$=c.bq([],[d,d,d]);return c.aB($,$,this.globeMatrix),$}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const d=this._elevation;this._updateCameraState();const $=c.cf(1,this._center.lat)*this.worldSize,st=this._computeCameraPosition($),lt=this._camera.forward(),ht=c.cf(1,this._center.lat);st[2]/=ht,lt[2]/=ht,c.aw(lt,lt);const dt=d.raycast(st,lt,d.exaggeration());if(dt){const mt=c.bH([],st,lt,dt),Tt=new c.ae(mt[0],mt[1],c.cf(mt[2],c.a$(mt[1]))),Pt=(Tt.z+c.ag([Tt.x-st[0],Tt.y-st[1],Tt.z-st[2]*ht]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(Pt),this._centerAltitude=Tt.toAltitude(),this._center=this.coordinateLocation(Tt),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(d=!1){if(!this._elevation)return;const $=this._elevation,st=c.cf(1,this._center.lat)*this.worldSize,lt=this._computeCameraPosition(st),ht=$.getAtPointOrZero(new c.ae(...lt)),dt=this.pixelsPerMeter/this.worldSize*ht,mt=this._minimumHeightOverTerrain(),Tt=lt[2]-dt;if(Tt<=mt)if(Tt<0||d){const Pt=this.locationCoordinate(this._center,this._centerAltitude),Mt=[lt[0],lt[1],Pt.z-lt[2]],Ht=c.ag(Mt);Mt[2]-=(mt-Tt)/this._pixelsPerMercatorPixel;const $t=c.ag(Mt);if($t===0)return;c.c5(Mt,Mt,Ht/$t*this._pixelsPerMercatorPixel),this._camera.position=[lt[0],lt[1],Pt.z*this._pixelsPerMercatorPixel-Mt[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const d=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||d){const $t=this.center;return $t.lat=c.aA($t.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!d)&&($t.lng=c.aA($t.lng,this.minLng,this.maxLng)),this.center=$t,void(this._constraining=!1)}const $=this._unmodified,{x:st,y:lt}=this.point;let ht=0,dt=st,mt=lt;const Tt=this.width/2,Pt=this.height/2,Mt=this.worldMinY*this.scale,Ht=this.worldMaxY*this.scale;if(lt-Pt<Mt&&(mt=Mt+Pt),lt+Pt>Ht&&(mt=Ht-Pt),Ht-Mt<this.height&&(ht=Math.max(ht,this.height/(Ht-Mt)),mt=(Ht+Mt)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const $t=this.worldMinX*this.scale,qt=this.worldMaxX*this.scale,Qt=this.worldSize/2-($t+qt)/2;dt=(st+Qt+this.worldSize)%this.worldSize-Qt,dt-Tt<$t&&(dt=$t+Tt),dt+Tt>qt&&(dt=qt-Tt),qt-$t<this.width&&(ht=Math.max(ht,this.width/(qt-$t)),dt=(qt+$t)/2)}dt===st&&mt===lt||this._allowWorldUnderZoom||(this.center=this.unproject(new c.P(dt,mt))),ht&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(ht)),this._constrainCamera(),this._unmodified=$,this._constraining=!1}_minZoomForBounds(){let d=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(d=Math.max(d,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),d}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const d=this.centerOffset,$=this.projection.name==="globe",st=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=c.cf(1,this.center.lat)/c.cf(1,c.d2));const lt=c.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,lt),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const ht=this.projection.zAxisUnit==="meters"?st:1,dt=this._camera.getWorldToCamera(this.worldSize,ht);let mt;const Tt=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(Tt[8]=2*-d.x/this.width,Tt[9]=2*d.y/this.height,this.isOrthographic){let vr=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Pr=vr*this.aspect,Br=-Pr,Or=-vr;Pr-=d.x,Br-=d.x,vr+=d.y,Or+=d.y,mt=this._camera.getCameraToClipOrthographic(Br,Pr,Or,vr,this._nearZ,this._farZ),((Yr,Qr,un,Cn)=>{for(let qr=0;qr<16;qr++)Yr[qr]=c.ak(Qr[qr],un[qr],Cn)})(mt,mt,Tt,c.d0(this.pitch>=bp?1:this.pitch/bp))}else mt=Tt;const Pt=c.cP([],Tt,dt);let Mt=c.cP([],mt,dt);if(this.projection.isReprojectedInTileSpace){const vr=this.locationCoordinate(this.center),Pr=c.bA([]);c.br(Pr,Pr,[vr.x*this.worldSize,vr.y*this.worldSize,0]),c.aB(Pr,Pr,c.cQ(this)),c.br(Pr,Pr,[-vr.x*this.worldSize,-vr.y*this.worldSize,0]),c.aB(Mt,Mt,Pr),c.aB(Pt,Pt,Pr),this.inverseAdjustmentMatrix=c.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=c.cS([],Mt,[this.worldSize,this.worldSize,this.worldSize/ht,1]),this.projMatrix=Mt,this.invProjMatrix=c.bl(new Float64Array(16),this.projMatrix),$){const vr=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);vr[8]=2*-d.x/this.width,vr[9]=2*d.y/this.height,this.expandedFarZProjMatrix=c.cP([],vr,dt)}else this.expandedFarZProjMatrix=this.projMatrix;const Ht=c.bl([],mt);this.frustumCorners=c.cT.fromInvProjectionMatrix(Ht,this.horizonLineFromTop(),this.height),this.cameraFrustum=c.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!$);const $t=new Float32Array(16);c.bA($t),c.cS($t,$t,[1,-1,1]),c.cU($t,$t,this._pitch),c.bB($t,$t,this.angle);const qt=c.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=c.bz(qt);const Qt=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;qt[8]=2*-d.x/this.width,qt[9]=2*(d.y+Qt)/this.height,this.skyboxMatrix=c.aB($t,qt,$t);const Xt=this.point,sr=Xt.x,ir=Xt.y,hr=this.width%2/2,mr=this.height%2/2,dr=Math.cos(this.angle),Ir=Math.sin(this.angle),Tr=sr-Math.round(sr)+dr*hr+Ir*mr,Ar=ir-Math.round(ir)+dr*mr+Ir*hr,Er=new Float64Array(Mt);if(c.br(Er,Er,[Tr>.5?Tr-1:Tr,Ar>.5?Ar-1:Ar,0]),this.alignedProjMatrix=Er,Mt=c.bC(),c.cS(Mt,Mt,[this.width/2,-this.height/2,1]),c.br(Mt,Mt,[1,-1,0]),this.labelPlaneMatrix=Mt,Mt=c.bC(),c.cS(Mt,Mt,[1,-1,1]),c.br(Mt,Mt,[-1,-1,0]),c.cS(Mt,Mt,[2/this.width,2/this.height,1]),this.glCoordMatrix=Mt,this.pixelMatrix=c.aB(new Float64Array(16),this.labelPlaneMatrix,Pt),this._calcFogMatrices(),this._distanceTileDataCache={},Mt=c.bl(new Float64Array(16),this.pixelMatrix),!Mt)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=Mt,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=c.cV(this);const vr=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=c.af(vr,vr,dt),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=Mt;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const d=this.cameraWorldSizeForFog,$=this.cameraPixelsPerMeter,st=this._camera.position,lt=1/this.height/this._pixelsPerMercatorPixel,ht=[d,d,$];c.c5(ht,ht,lt),c.c5(st,st,-1),c.cW(st,st,ht);const dt=c.bC();c.br(dt,dt,st),c.cS(dt,dt,ht),this.mercatorFogMatrix=dt,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(d,$,lt)}_computeCameraPosition(d){const $=(d=d||this.pixelsPerMeter)/this.pixelsPerMeter,st=this._camera.forward(),lt=this.point,ht=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*$-d/this.worldSize*this._centerAltitude;return[lt.x/this.worldSize-st[0]*ht,lt.y/this.worldSize-st[1]*ht,d/this.worldSize*this._centerAltitude-st[2]*ht]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(d){const $=this._maxCameraBoundsDistance()*Math.cos(this._pitch),st=this._camera.position[2],lt=d[2];let ht=1;this.projection.wrap&&(this.center=this.center.wrap()),lt>0&&(ht=Math.min(($-st)/lt,1)),this._camera.position=c.bH([],this._camera.position,d,ht),this._updateStateFromCamera()}_updateStateFromCamera(){const d=this._camera.position,$=this._camera.forward(),{pitch:st,bearing:lt}=this._camera.getPitchBearing(),ht=c.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,dt=this._mercatorZfromZoom(this._maxZoom)*Math.cos(c.an(this._maxPitch)),mt=Math.max((d[2]-ht)/Math.cos(st),dt),Tt=this._zoomFromMercatorZ(mt);c.bH(d,d,$,mt),this._pitch=c.aA(st,c.an(this.minPitch),c.an(this.maxPitch)),this.angle=c.bT(lt,-Math.PI,Math.PI),this._setZoom(c.aA(Tt,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new c.ae(d[0],d[1],d[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(d){return Math.pow(2,d)*this.tileSize}_mercatorZfromZoom(d){return this.cameraToCenterDistance/this._worldSizeFromZoom(d)}_minimumHeightOverTerrain(){const d=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(d)}_zoomFromMercatorZ(d){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,d)*this.tileSize))}zoomFromMercatorZAdjusted(d){let $=0,st=c.cL,lt=0,ht=1/0;for(;st-$>1e-6&&st>$;){const dt=$+.5*(st-$),mt=this.tileSize*Math.pow(2,dt),Tt=this.getCameraToCenterDistance(this.projection,dt,mt),Pt=this.scaleZoom(Tt/(Math.max(0,d)*this.tileSize)),Mt=Math.abs(dt-Pt);Mt<ht&&(ht=Mt,lt=dt),dt<Pt?$=dt:st=dt}return lt}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(c.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(d,$){const st=Math.min(d.x,$.x),lt=Math.max(d.x,$.x),ht=Math.min(d.y,$.y),dt=Math.max(d.y,$.y);if(ht<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const mt=[new c.P(st,ht),new c.P(lt,dt),new c.P(st,dt),new c.P(lt,ht)],Tt=this.renderWorldCopies?-3:0,Pt=this.renderWorldCopies?4:1;for(const Mt of mt){const Ht=this.pointRayIntersection(Mt);if(Ht.t<0)return!0;const $t=this.rayIntersectionCoordinate(Ht);if($t.x<Tt||$t.y<0||$t.x>Pt||$t.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+c.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new c.P(0,0),new c.P(this.width,this.height))}zoomDeltaToMovement(d,$){const st=c.ag(c.av([],this._camera.position,d)),lt=this._zoomFromMercatorZ(st)+$;return st-this._mercatorZfromZoom(lt)}getCameraPoint(){if(this.projection.name==="globe"){const d=function([$,st,lt],ht){const dt=[$,st,lt,1];c.aC(dt,dt,ht);const mt=dt[3]=Math.max(dt[3],1e-6);return dt[0]/=mt,dt[1]/=mt,dt[2]/=mt,dt}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new c.P(d[0],d[1])}{const d=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,d))}}getCameraToCenterDistance(d,$=this.zoom,st=this.worldSize){const lt=c.cO(d,$,this.width,this.height,1024),ht=d.pixelSpaceConversion(this.center.lat,st,lt);let dt=.5/Math.tan(.5*this._fov)*this.height*ht;return this.isOrthographic&&(dt=c.ak(1,dt,c.d0(this.pitch>=bp?1:this.pitch/bp))),dt}getWorldToCameraMatrix(){const d=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&c.aB(d,d,this.globeMatrix),d}getFrustum(d){return c.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,this.projection.zAxisUnit==="meters")}}const Sm=(it,d)=>{if(d>0&&it.terrain&&c.w("Cutoff is currently disabled on terrain"),d<=0||it.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const $=it.transform,st=Math.max(Math.abs($._zoom-(it.minCutoffZoom-1)),1),lt=$.isLODDisabled(!1)?c.ah(60,45,$.pitch):c.ah(30,15,$.pitch),ht=$._farZ-$._nearZ,dt=d*$.height,mt=((1-(Tt=lt))*$.cameraToCenterDistance+Tt*($._farZ+dt))*st;var Tt;return{shouldRenderCutoff:lt<1,uniformValues:{u_cutoff_params:[$._nearZ,$._farZ,(mt-$._nearZ)/ht,(mt-dt-$._nearZ)/ht]}}},lp=2048;class y_{constructor(d,$){this.aabb=d,this.lastCascade=$}}class JE{add(d,$){const st=this.receivers[d.key];st!==void 0?(st.aabb.min[0]=Math.min(st.aabb.min[0],$.min[0]),st.aabb.min[1]=Math.min(st.aabb.min[1],$.min[1]),st.aabb.min[2]=Math.min(st.aabb.min[2],$.min[2]),st.aabb.max[0]=Math.max(st.aabb.max[0],$.max[0]),st.aabb.max[1]=Math.max(st.aabb.max[1],$.max[1]),st.aabb.max[2]=Math.max(st.aabb.max[2],$.max[2])):this.receivers[d.key]=new y_($,null)}clear(){this.receivers={}}get(d){return this.receivers[d.key]}computeRequiredCascades(d,$,st){const lt=c.d9.fromPoints(d.points);let ht=0;for(const dt in this.receivers){const mt=this.receivers[dt];if(!mt||!lt.intersectsAabb(mt.aabb))continue;mt.aabb.min=lt.closestPoint(mt.aabb.min),mt.aabb.max=lt.closestPoint(mt.aabb.max);const Tt=mt.aabb.getCorners();for(let Pt=0;Pt<st.length;Pt++){let Mt=!0;for(const Ht of Tt){const $t=[Ht[0]*$,Ht[1]*$,Ht[2]];if(c.af($t,$t,st[Pt].matrix),$t[0]<-1||$t[0]>1||$t[1]<-1||$t[1]>1){Mt=!1;break}}if(mt.lastCascade=Pt,ht=Math.max(ht,Pt),Mt)break}}return ht+1}}class T0{constructor(d){this.painter=d,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new JE,this._depthMode=new es(d.context.gl.LEQUAL,es.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const d of this._cascades)d.texture.destroy(),d.framebuffer.destroy();this._cascades=[]}updateShadowParameters(d,$){const st=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!$||!$.properties)return;const lt=$.properties.get("shadow-intensity");if(!$.shadowsEnabled()||lt<=0||(this._shadowLayerCount=st.style.order.reduce((Qt,Xt)=>{const sr=st.style._mergedLayers[Xt];return Qt+(sr.hasShadowPass()&&!sr.isHidden(d.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const ht=st.context,dt=lp,mt=lp;if(this._cascades.length===0||lp!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Qt=0;Qt<2;++Qt){const Xt=st._shadowMapDebug,sr=ht.gl,ir=ht.createFramebuffer(dt,mt,Xt?1:0,"texture"),hr=new c.T(ht,{width:dt,height:mt,data:null},sr.DEPTH_COMPONENT16);if(ir.depthAttachment.set(hr.texture),Xt){const mr=new c.T(ht,{width:dt,height:mt,data:null},sr.RGBA8);ir.colorAttachment0.set(mr.texture)}this._cascades.push({framebuffer:ir,texture:hr,matrix:[],far:0,boundingSphereRadius:0,frustum:new c.cB,scale:0})}}this.shadowDirection=v_($);let Tt=0;if(d.elevation){const Qt=d.elevation,Xt=[1e4,-1e4];Qt.visibleDemTiles.filter(sr=>sr.dem).forEach(sr=>{const ir=sr.dem.tree;Xt[0]=Math.min(Xt[0],ir.minimums[0]),Xt[1]=Math.max(Xt[1],ir.maximums[0])}),Xt[0]!==1e4&&(Tt=(Xt[1]-Xt[0])*Qt.exaggeration())}const Pt=1.5*d.cameraToCenterDistance,Mt=3*Pt,Ht=new Float64Array(16);for(let Qt=0;Qt<this._cascades.length;++Qt){const Xt=this._cascades[Qt];let sr=d.height/50,ir=1;Qt===0?ir=Pt:(sr=Pt,ir=Mt);const[hr,mr]=Cm(d,this.shadowDirection,sr,ir,lp,Tt);Xt.scale=d.scale,Xt.matrix=hr,Xt.boundingSphereRadius=mr,c.bl(Ht,Xt.matrix),Xt.frustum=c.cB.fromInvProjectionMatrix(Ht,1,0,!0),Xt.far=ir}const $t=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[$t].far,this._cascades[$t].far],this._uniformValues.u_shadow_intensity=lt,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=lp,this._uniformValues.u_shadowmap_0=_c.ShadowMap0,this._uniformValues.u_shadowmap_1=_c.ShadowMap0+1,this._groundShadowTiles=st.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const qt=st.transform.elevation;for(const Qt of this._groundShadowTiles){let Xt={min:0,max:0};if(qt){const sr=qt.getMinMaxForTile(Qt);sr&&(Xt=sr)}this.addShadowReceiver(Qt.toUnwrapped(),Xt.min,Xt.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(d){this._enabled=d}drawShadowPass(d,$){if(!this.enabled)return;const st=this.painter,lt=st.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(st.transform.getFrustum(0),st.transform.worldSize,this._cascades),lt.viewport.set([0,0,lp,lp]);for(let ht=0;ht<this._numCascadesToRender;++ht){st.currentShadowCascade=ht,lt.bindFramebuffer.set(this._cascades[ht].framebuffer.framebuffer),lt.clear({color:c.ao.white,depth:1});for(const dt of d.order){const mt=d._mergedLayers[dt];if(!mt.hasShadowPass()||mt.isHidden(st.transform.zoom))continue;const Tt=d.getLayerSourceCache(mt),Pt=Tt?$[Tt.id]:void 0;(mt.type==="model"||Pt&&Pt.length)&&st.renderLayer(st,Tt,mt,Pt)}}st.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const d=this.painter,$=d.style,st=d.context,lt=st.gl,ht=$.directionalLight,dt=$.ambientLight;if(!ht||!dt)return;const mt=[],Tt=Sm(d,d.longestCutoffRange);Tt.shouldRenderCutoff&&mt.push("RENDER_CUTOFF"),mt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&mt.push("NORMAL_OFFSET");const Pt=Qp($,ht,dt),Mt=new es(lt.LEQUAL,es.ReadOnly,d.depthRangeFor3D),Ht=new _s({func:lt.EQUAL,mask:255},0,255,lt.KEEP,lt.KEEP,lt.KEEP);for(const $t of this._groundShadowTiles){const qt=$t.toUnwrapped(),Qt=d.isTileAffectedByFog($t),Xt=d.getOrCreateProgram("groundShadow",{defines:mt,overrideFog:Qt});this.setupShadows(qt,Xt),d.uploadCommonUniforms(st,Xt,qt,null,Tt);const sr={u_matrix:d.transform.calculateProjMatrix(qt),u_ground_shadow_factor:Pt};Xt.draw(d,lt.TRIANGLES,Mt,Ht,Ps.multiply,gs.disabled,sr,"ground_shadow",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments,null,d.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ps.unblended:Ps.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(d){const $=this.painter.transform,st=$.calculatePosMatrix(d,$.worldSize);return c.aB(st,this._cascades[this.painter.currentShadowCascade].matrix,st),Float32Array.from(st)}calculateShadowPassMatrixFromMatrix(d){const $=c.bz(d);return c.aB($,this._cascades[this.painter.currentShadowCascade].matrix,d),$}setupShadows(d,$,st){if(!this.enabled)return;const lt=this.painter.transform,ht=this.painter.context,dt=ht.gl,mt=this._uniformValues,Tt=new Float64Array(16),Pt=lt.calculatePosMatrix(d,lt.worldSize);for(let Mt=0;Mt<this._cascades.length;Mt++)c.aB(Tt,this._cascades[Mt].matrix,Pt),mt[Mt===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(Tt),ht.activeTexture.set(dt.TEXTURE0+_c.ShadowMap0+Mt),this._cascades[Mt].texture.bindExtraParam(dt.LINEAR,dt.LINEAR,dt.CLAMP_TO_EDGE,dt.CLAMP_TO_EDGE,dt.GREATER);if(this.useNormalOffset=!!st,this.useNormalOffset){const Mt=c.d7(d.canonical),Ht=2/lt.tileSize*c.al/lp,$t=Ht*this._cascades[0].boundingSphereRadius,qt=Ht*this._cascades[this._cascades.length-1].boundingSphereRadius,Qt=(st==="vector-tile"?1:3)*function(Xt,sr,ir,hr,mr){const dr=c.aA((Xt-22)/-22,0,1);return .125*(1-dr)+4*dr}(lt.zoom);mt.u_shadow_normal_offset=[Mt,$t*Qt,qt*Qt],mt.u_shadow_bias=[1e-4,.0012,.012]}else mt.u_shadow_bias=[36e-5,.0012,.012];$.setShadowUniformValues(ht,mt)}setupShadowsFromMatrix(d,$,st=!1){if(!this.enabled)return;const lt=this.painter.context,ht=lt.gl,dt=this._uniformValues,mt=new Float64Array(16);for(let Tt=0;Tt<2;Tt++)c.aB(mt,this._cascades[Tt].matrix,d),dt[Tt===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(mt),lt.activeTexture.set(ht.TEXTURE0+_c.ShadowMap0+Tt),this._cascades[Tt].texture.bindExtraParam(ht.LINEAR,ht.LINEAR,ht.CLAMP_TO_EDGE,ht.CLAMP_TO_EDGE,ht.GREATER);this.useNormalOffset=st,st?(dt.u_shadow_normal_offset=[1,3,3],dt.u_shadow_bias=[6e-5,.0012,.012]):dt.u_shadow_bias=[36e-5,.0012,.012],$.setShadowUniformValues(lt,dt)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(d,$,st,lt){if(lt[2]>=0)return{};const ht=function(Tt,Pt,Mt){const Ht=Mt/(1<<Tt.canonical.z);return new c.d9([Tt.canonical.x*Ht+Tt.wrap*Mt,Tt.canonical.y*Ht+Tt.wrap*Mt,0],[(Tt.canonical.x+1)*Ht+Tt.wrap*Mt,(Tt.canonical.y+1)*Ht+Tt.wrap*Mt,Pt])}(d,$,st).getCorners(),dt=$/-lt[2];lt[0]<0?(c.d8(ht[0],ht[0],[lt[0]*dt,0,0]),c.d8(ht[3],ht[3],[lt[0]*dt,0,0])):lt[0]>0&&(c.d8(ht[1],ht[1],[lt[0]*dt,0,0]),c.d8(ht[2],ht[2],[lt[0]*dt,0,0])),lt[1]<0?(c.d8(ht[0],ht[0],[0,lt[1]*dt,0]),c.d8(ht[1],ht[1],[0,lt[1]*dt,0])):lt[1]>0&&(c.d8(ht[2],ht[2],[0,lt[1]*dt,0]),c.d8(ht[3],ht[3],[0,lt[1]*dt,0]));const mt={};return mt.vertices=ht,mt.planes=[x_(ht[1],ht[0],ht[4]),x_(ht[2],ht[1],ht[5]),x_(ht[3],ht[2],ht[6]),x_(ht[0],ht[3],ht[7])],mt}addShadowReceiver(d,$,st){this._receivers.add(d,c.d9.fromTileIdAndHeight(d,$,st))}getMaxCascadeForTile(d){const $=this._receivers.get(d);return $&&$.lastCascade?$.lastCascade:0}}function x_(it,d,$){const st=c.av([],$,d),lt=c.av([],it,d),ht=c.bI([],st,lt),dt=c.ag(ht);return dt===0?[0,0,1,0]:(c.c5(ht,ht,1/dt),[ht[0],ht[1],ht[2],-c.bJ(ht,d)])}function v_(it){const d=it.properties.get("direction"),$=c.d4(d.x,d.y,d.z);$[2]=c.aA($[2],0,75);const st=c.d6([$[0],$[1],$[2]]);return c.d5(st.x,st.y,st.z)}function Qp(it,d,$){const st=d.properties.get("color-use-theme")==="none",lt=d.properties.get("color"),ht=d.properties.get("intensity"),dt=d.properties.get("direction"),mt=[dt.x,dt.y,dt.z],Tt=$.properties.get("color-use-theme")==="none",Pt=$.properties.get("color"),Mt=$.properties.get("intensity"),Ht=Math.max(c.bJ([0,0,1],mt),0),$t=[0,0,0];c.c5($t,Pt.toPremultipliedRenderColor(Tt?null:it.getLut(d.scope)).toArray01Linear().slice(0,3),Mt);const qt=[0,0,0];return c.c5(qt,lt.toPremultipliedRenderColor(st?null:it.getLut($.scope)).toArray01Linear().slice(0,3),Ht*ht),c.db([$t[0]>0?$t[0]/($t[0]+qt[0]):0,$t[1]>0?$t[1]/($t[1]+qt[1]):0,$t[2]>0?$t[2]/($t[2]+qt[2]):0])}function Cm(it,d,$,st,lt,ht){const dt=it.zoom,mt=it.scale,Tt=it.worldSize,Pt=1/Tt,Mt=it.aspect,Ht=Math.sqrt(1+Mt*Mt)*Math.tan(.5*it.fovX),$t=Ht*Ht,qt=st-$,Qt=st+$;let Xt,sr;$t>qt/Qt?(Xt=st,sr=st*Ht):(Xt=.5*Qt*(1+$t),sr=.5*Math.sqrt(qt*qt+2*(st*st+$*$)*$t+Qt*Qt*$t*$t));const ir=it.projection.pixelsPerMeter(it.center.lat,Tt),hr=it._camera.getCameraToWorldMercator(),mr=[0,0,-Xt*Pt];c.af(mr,mr,hr);let dr=sr*Pt;const Ir=it._edgeInsets;if(!(Ir.left===0&&Ir.top===0&&Ir.right===0&&Ir.bottom===0||Ir.left===Ir.right&&Ir.top===Ir.bottom)){const yn=it._camera.getWorldToCamera(it.worldSize,it.projection.zAxisUnit==="meters"?ir:1),Ln=it._camera.getCameraToClipPerspective(it._fov,it.width/it.height,$,st);Ln[8]=2*-it.centerOffset.x/it.width,Ln[9]=2*it.centerOffset.y/it.height;const Un=new Float64Array(16);c.cP(Un,Ln,yn);const kn=new Float64Array(16);c.bl(kn,Un);const An=c.cB.fromInvProjectionMatrix(kn,Tt,dt,!0);for(const Qn of An.points){const Kn=((Tr=Qn)[0]/=mt,Tr[1]/=mt,Tr[2]=c.cf(Tr[2],it._center.lat),Tr);dr=Math.max(dr,c.c6(c.da([],mr,Kn)))}}var Tr;dr*=lt/(lt-1);const Ar=Math.acos(d[2]),Er=Math.atan2(-d[0],-d[1]),vr=new wy;vr.position=mr,vr.setPitchBearing(Ar,Er);const Pr=vr.getWorldToCamera(Tt,ir),Br=dr*Tt,Or=Math.min(it._mercatorZfromZoom(17)*Tt*-2,-2*Br),Yr=vr.getCameraToClipOrthographic(-Br,Br,-Br,Br,Or,(Br+ht*ir)/d[2]),Qr=new Float64Array(16);c.aB(Qr,Yr,Pr);const un=c.d5(Math.floor(1e6*mr[0])/1e6*Tt,Math.floor(1e6*mr[1])/1e6*Tt,0),Cn=.5*lt,qr=[0,0,0];c.af(qr,un,Qr),c.c5(qr,qr,Cn);const Nr=[Math.floor(qr[0]),Math.floor(qr[1]),Math.floor(qr[2])],tn=[0,0,0];c.av(tn,qr,Nr),c.c5(tn,tn,-1/Cn);const Kr=new Float64Array(16);return c.bA(Kr),c.br(Kr,Kr,tn),c.aB(Qr,Kr,Qr),[Qr,Br]}class eT extends c.E{constructor(d){super(),this.requestManager=d,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(d,$){return c.dc(this.requestManager.transformRequest($,c.R.Model).url).then(st=>{if(!st)return;const lt=c.dd(st),ht=new c.de(d,$,void 0,void 0,lt);return ht.computeBoundsAndApplyParent(),ht}).catch(st=>{if(st&&st.status===404)return null;this.fire(new c.y(new Error(`Could not load model ${d} from ${$}: ${st.message}`)))})}load(d,$,st={forceReload:!1}){this.models[$]||(this.models[$]={});const lt=Object.keys(d),ht=[],dt=[];for(const mt of lt){const Tt=d[mt];this.hasURLBeenRequested(Tt)&&!st.forceReload||(this.modelByURL[Tt]={modelId:mt,scope:$},ht.push(this.loadModel(mt,Tt)),dt.push(mt)),this.models[$][mt]||(this.models[$][mt]={model:null,numReferences:1})}this.numModelsLoading[$]=(this.numModelsLoading[$]||0)+dt.length,Promise.allSettled(ht).then(mt=>{for(let Tt=0;Tt<mt.length;Tt++){const{status:Pt}=mt[Tt];if(Pt==="rejected")continue;const{value:Mt}=mt[Tt];this.models[$][dt[Tt]]||(this.models[$][dt[Tt]]={model:null,numReferences:1}),this.models[$][dt[Tt]].model=Mt}this.numModelsLoading[$]-=dt.length,this.fire(new c.z("data",{dataType:"style"}))}).catch(mt=>{this.fire(new c.y(new Error(`Could not load models: ${mt.message}`)))})}isLoaded(){for(const d in this.numModelsLoading)if(this.numModelsLoading[d]>0)return!1;return!0}hasModel(d,$,st={exactIdMatch:!1}){return!!(st.exactIdMatch?this.getModel(d,$):this.getModelByURL(this.modelUris[$][d]))}getModel(d,$){return this.models[$]||(this.models[$]={}),this.models[$][d]?this.models[$][d].model:void 0}getModelByURL(d){if(!d)return null;const $=this.modelByURL[d];return $?this.models[$.scope][$.modelId].model:null}hasModelBeenAdded(d,$){return this.models[$]&&this.models[$][d]!==void 0}getModelURIs(d){return this.modelUris[d]||{}}addModel(d,$,st){this.models[st]||(this.models[st]={}),this.modelUris[st]||(this.modelUris[st]={});const lt=this.requestManager.normalizeModelURL($);if((this.hasModel(d,st,{exactIdMatch:!0})||this.hasModelBeenAdded(d,st))&&this.modelUris[st][d]===lt)this.models[st][d].numReferences++;else if(this.hasURLBeenRequested(lt)){const{scope:ht,modelId:dt}=this.modelByURL[lt];this.models[ht][dt].numReferences++}else this.modelUris[st][d]=lt,this.load({[d]:this.modelUris[st][d]},st)}addModelURLs(d,$){this.models[$]||(this.models[$]={}),this.modelUris[$]||(this.modelUris[$]={});const st=this.modelUris[$];for(const lt in d)st[lt]=this.requestManager.normalizeModelURL(d[lt])}reloadModels(d){this.load(this.modelUris[d],d,{forceReload:!0})}addModelsFromBucket(d,$){this.models[$]||(this.models[$]={}),this.modelUris[$]||(this.modelUris[$]={});const st={};for(const lt of d)this.hasModel(lt,$,{exactIdMatch:!0})||this.hasURLBeenRequested(lt)?this.models[$][lt].numReferences++:this.modelUris[$][lt]&&!this.hasURLBeenRequested(lt)?st[lt]=this.modelUris[$][lt]:!this.hasURLBeenRequested(lt)&&c.df(lt,!1)&&(this.modelUris[$][lt]=this.requestManager.normalizeModelURL(lt),st[lt]=this.modelUris[$][lt]);this.load(st,$)}hasURLBeenRequested(d){return this.modelByURL[d]!==void 0}removeModel(d,$,st=!1,lt=!1){if(this.models[$]&&this.models[$][d]&&(this.models[$][d].numReferences--,this.models[$][d].numReferences===0||lt)){const ht=this.modelUris[$][d];st||delete this.modelUris[$][d],delete this.modelByURL[ht];const dt=this.models[$][d].model;if(!dt)return;delete this.models[$][d],dt.destroy()}}destroy(){for(const d of Object.keys(this.models))for(const $ of Object.keys(this.models[d])){const st=this.models[d][$].model;delete this.models[d][$],st&&st.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(d){return this.models[d]||(this.models[d]={}),Object.keys(this.models[d])}upload(d,$){this.models[$]||(this.models[$]={});for(const st in this.models[$])this.models[$][st].model&&this.models[$][st].model.upload(d.context)}}const dv=c.a6.colorTheme,tT=new c.a9({data:new c.aa(dv.data)});function sw(it){if(!it.metadata||!it.metadata.content_area)return;const d=c.o.devicePixelRatio,{left:$,top:st,width:lt,height:ht}=it.metadata.content_area,dt=$*d,mt=st*d;return[dt,mt,dt+lt*d,mt+ht*d]}function ow(it){if(it)return it.map(([d,$])=>[d*c.o.devicePixelRatio,$*c.o.devicePixelRatio])}class pv{constructor(d,$,st){this.id=d,this.scope=$,this.sourceCache=st,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(d){this.missingRequests.has(d.name)||this.pendingRequests.has(d.name)||this.pendingRequests.add(d.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const d=new Map;if(!this.sourceCache.loaded())return d;const $=this.sourceCache.getVisibleCoordinates();if($.length===0)return d;const st=this.sourceCache.getSource();if(!(st instanceof bu))return d;const lt=$.map(dt=>this.sourceCache.getTile(dt)),ht=st.getImages(lt,Array.from(this.pendingRequests));for(const[dt,mt]of ht)d.set(c.I.from({name:dt,iconsetId:this.id}),mt),this.pendingRequests.delete(dt);for(const dt of this.pendingRequests)this.missingRequests.add(dt);return this.pendingRequests.clear(),d}}const Am=(it,d)=>yr(it,d&&d.filter($=>$.identifier!=="source.canvas")),aw=c.aH(eo,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),lw=c.aH(eo,["setCenter","setZoom","setBearing","setPitch"]),Ty=new Set(["background","sky","slot","custom"]),Rm={version:8,layers:[],sources:{}},b_={duration:300,delay:0};class cp extends c.E{constructor(d,$={}){super(),this.map=d,this.scope=$.scope||"",this.globalId=null,this.fragments=[],this.importDepth=$.importDepth||0,this.importsCache=$.importsCache||new Map,this.resolvedImports=$.resolvedImports||new Set,this.transition=Object.assign({},b_),this._buildingIndex=new YE(this),this.crossTileSymbolIndex=new vp,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=$.styleChanges||new wo,this._hasDataDrivenEmissive=!1,this.dispatcher=$.dispatcher?$.dispatcher:new c.D(c.dh(),this),$.imageManager?this.imageManager=$.imageManager:(this.imageManager=new ou(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=$.glyphManager?$.glyphManager:new c.di(d._requestManager,$.localFontFamily?c.dj.all:$.localIdeographFontFamily?c.dj.ideographs:c.dj.none,$.localFontFamily||$.localIdeographFontFamily),$.modelManager?this.modelManager=$.modelManager:(this.modelManager=new eT(d._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=$.configOptions?$.configOptions:new Map,this._configDependentLayers=$.configDependentLayers?$.configDependentLayers:new Set,this._indoorDependentLayers=$.indoorDependentLayers?$.indoorDependentLayers:new Set,this._config=$.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:$.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=$.initialConfig,this.dispatcher.broadcast("setReferrer",c.dk());const st=this;this._rtlTextPluginCallback=cp.registerForPluginStateChange(lt=>{st.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:lt.pluginStatus,pluginURL:lt.pluginURL},(ht,dt)=>{if(c.dl(ht),dt&&dt.every(mt=>mt))for(const mt in st._sourceCaches){const Tt=st._sourceCaches[mt],Pt=Tt.getSource().type;Pt!=="vector"&&Pt!=="geojson"||Tt.reload()}})}),this.on("data",lt=>{if(lt.dataType!=="source"||lt.sourceDataType!=="metadata")return;const ht=this.getOwnSource(lt.sourceId);if(ht&&ht.vectorLayerIds)for(const dt in this._layers){const mt=this._layers[dt];mt.source===ht.id&&this._validateLayer(mt)}})}load(d){return d?(typeof d=="string"?this.loadURL(d):this.loadJSON(d),this):this}_getGlobalId(d){if(!d)return null;if(typeof d=="string"){if(c.h(d))return d;const $=c.dm(d);if(!$.startsWith("http"))try{return new URL($,location.href).toString()}catch{return $}return $}return`json://${c.dn(JSON.stringify(d))}`}_diffStyle(d,$,st){this.globalId=this._getGlobalId(d);const lt=(ht,dt)=>{try{dt(null,this.setState(ht,st))}catch(mt){dt(mt,!1)}};if(typeof d=="string"){const ht=this.map._requestManager.normalizeStyleURL(d),dt=this.map._requestManager.transformRequest(ht,c.R.Style);c.m(dt,(mt,Tt)=>{mt?this.fire(new c.y(mt)):Tt&&lt(Tt,$)})}else typeof d=="object"&&lt(d,$)}loadURL(d,$={}){this.fire(new c.z("dataloading",{dataType:"style"}));const st=typeof $.validate=="boolean"?$.validate:!c.h(d);this.globalId=this._getGlobalId(d),d=this.map._requestManager.normalizeStyleURL(d,$.accessToken),this.resolvedImports.add(d);const lt=this.importsCache.get(d);if(lt)return this._load(lt,st);const ht=this.map._requestManager.transformRequest(d,c.R.Style);this._request=c.m(ht,(dt,mt)=>{if(this._request=null,dt)this.fire(new c.y(dt));else if(mt)return this.importsCache.set(d,mt),this._load(mt,st)})}loadJSON(d,$={}){this.fire(new c.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(d),this._request=c.o.frame(()=>{this._request=null,this._load(d,$.validate!==!1)})}loadEmpty(){this.fire(new c.z("dataloading",{dataType:"style"})),this._load(Rm,!1)}_loadImports(d,$,st){if(this.importDepth>=4)return c.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const lt=[];for(const ht of d){const dt=this._createFragmentStyle(ht),mt=new Promise(Mt=>{dt.once("style.import.load",Mt),dt.once("error",Mt)}).then(()=>this.mergeAll());if(lt.push(mt),this.resolvedImports.has(ht.url)){dt.loadEmpty();continue}const Tt=ht.data||this.importsCache.get(ht.url);Tt?(dt.loadJSON(Tt,{validate:$}),this._isInternalStyle(Tt)&&(dt.globalId=null)):ht.url?dt.loadURL(ht.url,{validate:$}):dt.loadEmpty();const Pt={style:dt,id:ht.id,config:ht.config};if(st){const Mt=this.fragments.findIndex(({id:Ht})=>Ht===st);this.fragments=this.fragments.slice(0,Mt).concat(Pt).concat(this.fragments.slice(Mt))}else this.fragments.push(Pt)}return Promise.allSettled(lt)}getImportGlobalIds(d=this,$=new Set){for(const st of d.fragments)st.style.globalId&&$.add(st.style.globalId),this.getImportGlobalIds(st.style,$);return[...$.values()]}_createFragmentStyle(d){const $=this.scope?c.B(d.id,this.scope):d.id;let st;const lt=this._initialConfig&&this._initialConfig[$];(d.config||lt)&&(st=Object.assign({},d.config,lt));const ht=new cp(this.map,{scope:$,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:st,configOptions:this.options,colorThemeOverride:d["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return ht.setEventedParent(this.map,{style:ht}),ht}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(d){return this.isRootStyle()&&(d.fragment||!!d.schema&&d.fragment!==!1)}_load(d,$){if(this._isInternalStyle(d)){const ht=Object.assign({},Rm,{imports:[{id:"basemap",data:d,url:""}]},d.center?{center:d.center}:{},d.bearing?{bearing:d.bearing}:{},d.pitch?{pitch:d.pitch}:{},d.zoom?{zoom:d.zoom}:{},d.light?{light:d.light}:{});return this._importedAsBasemap=!0,void this._load(ht,$)}if(this.updateConfig(this._config,d.schema),$&&Am(this,jo(d)))return;this._loaded=!0,this.stylesheet=c.dp(d);const st=()=>{for(const Tt in d.sources)this.addSource(Tt,d.sources[Tt],{validate:!1,isInitialLoad:!0});if(d.iconsets)for(const Tt in d.iconsets)this.addIconset(Tt,d.iconsets[Tt]);d.sprite?this._loadIconset(d.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&d.glyphs&&this.glyphManager.setURL(d.glyphs);const ht=c_(this.stylesheet.layers);if(this._order=ht.map(Tt=>Tt.id),this.stylesheet.light&&c.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const Tt=this.stylesheet.lights[0];this.light=new jr(Tt.properties,Tt.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new jr(this.stylesheet.light)),this._layers={};for(const Tt of ht){const Pt=c.du(Tt,this.scope,this._styleColorTheme.lut,this.options);Pt.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(Pt.fqid),Pt.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(Pt.fqid),this._hasAppearances=this._hasAppearances||Pt.getAppearances().length!==0,Pt.setEventedParent(this,{layer:{id:Pt.id}}),this._layers[Pt.id]=Pt;const Mt=this.getOwnLayerSourceCache(Pt),Ht=!!this.directionalLight&&this.directionalLight.shadowsEnabled();Mt&&Pt.canCastShadows()&&Ht&&(Mt.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const dt=this.stylesheet.terrain;dt&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(dt,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new c.z("data",{dataType:"style"}));const mt=this.isRootStyle();d.imports?this._loadImports(d.imports,$).then(()=>{this._reloadImports(),this.fire(new c.z(mt?"style.load":"style.import.load"))}).catch(Tt=>{this.fire(new c.y(new Error("Failed to load imports",Tt))),this.fire(new c.z(mt?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new c.z(mt?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const lt=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(lt){const ht=this._evaluateColorThemeData(lt);this._loadColorTheme(ht).then(()=>{st()}).catch(dt=>{c.w(`Couldn't load color theme from the stylesheet: ${dt}`),st()})}else this._styleColorTheme.lut=null,st()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(d=>d.style.hasAppearances())}mergeAll(){let d,$,st,lt,ht,dt,mt,Tt,Pt,Mt;const Ht={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle($t=>{if($t.stylesheet){if($t.light!=null&&(d=$t.light),$t.stylesheet.lights)for(const qt of $t.stylesheet.lights)qt.type==="ambient"&&$t.ambientLight!=null&&($=$t.ambientLight),qt.type==="directional"&&$t.directionalLight!=null&&(st=$t.directionalLight);lt=this._prioritizeTerrain(lt,$t.terrain,$t.stylesheet.terrain),$t.stylesheet.fog&&$t.fog!=null&&(ht=$t.fog),$t.stylesheet.snow&&$t.snow!=null&&(dt=$t.snow),$t.stylesheet.rain&&$t.rain!=null&&(mt=$t.rain),$t.stylesheet.camera!=null&&(Mt=$t.stylesheet.camera),$t.stylesheet.projection!=null&&(Tt=$t.stylesheet.projection),$t.stylesheet.transition!=null&&(Pt=$t.stylesheet.transition),Ht[$t.scope]=$t._styleColorTheme}}),this.light=d,this.ambientLight=$,this.directionalLight=st,this.fog=ht,this.snow=dt,this.rain=mt,this._styleColorThemeForScope=Ht,lt===null?delete this.terrain:this.terrain=lt,this.camera=Mt||{"camera-projection":"perspective"},this.projection=Tt||{name:"mercator"},this.transition=Object.assign({},b_,Pt),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(d){const $=st=>{for(const lt of st.fragments)$(lt.style);d(st)};$(this)}_prioritizeTerrain(d,$,st){const lt=d&&d.drapeRenderMode===0;return st===null?$&&$.drapeRenderMode===0?$:lt?d:null:$!=null&&(!d||lt||$&&$.drapeRenderMode===1)?$:d}mergeTerrain(){let d;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle($=>{d=this._prioritizeTerrain(d,$.terrain,$.stylesheet.terrain)}),d===null?delete this.terrain:this.terrain=d}mergeProjection(){let d;this.forEachFragmentStyle($=>{$.stylesheet.projection!=null&&(d=$.stylesheet.projection)}),this.projection=d||{name:"mercator"}}mergeSources(){const d={},$={},st={};this.forEachFragmentStyle(lt=>{for(const ht in lt._sourceCaches){const dt=c.B(ht,lt.scope);d[dt]=lt._sourceCaches[ht]}for(const ht in lt._otherSourceCaches){const dt=c.B(ht,lt.scope);$[dt]=lt._otherSourceCaches[ht]}for(const ht in lt._symbolSourceCaches){const dt=c.B(ht,lt.scope);st[dt]=lt._symbolSourceCaches[ht]}}),this._mergedSourceCaches=d,this._mergedOtherSourceCaches=$,this._mergedSymbolSourceCaches=st}mergeIndoor(){this.forEachFragmentStyle(d=>{if(d.stylesheet&&d.stylesheet.indoor)for(const $ of Object.values(d.stylesheet.indoor)){const st=$,lt=c.B(st.sourceId,d.scope);this._mergedIndoor[lt]=new Set(st.sourceLayers||[])}})}mergeLayers(){const d={},$=[],st={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(dt=>{for(const mt of dt._order){const Tt=dt._layers[mt];if(Tt.type==="slot"){const Pt=c.dq(mt);if(d[Pt])continue;d[Pt]=[]}Tt.slot&&d[Tt.slot]?d[Tt.slot].push(Tt):$.push(Tt)}}),this._mergedOrder=[];let lt=-1;const ht=(dt=[])=>{for(const mt of dt)if(mt.type==="slot"){const Tt=c.dq(mt.id);d[Tt]&&ht(d[Tt]),this._mergedSlots.push(Tt)}else{const Tt=c.B(mt.id,mt.scope);this._mergedOrder.push(Tt),st[Tt]=mt,mt.is3D(!!this.terrain)&&(this._has3DLayers=!0,lt=this._mergedOrder.length-1),mt.type==="circle"&&(this._hasCircleLayers=!0),mt.type==="symbol"&&(this._hasSymbolLayers=!0),mt.type==="clip"&&(this._clipLayerPresent=!0)}};if(ht($),this._has3DLayers){const dt={};for(let mt=0;mt<this._mergedOrder.length;++mt){const Tt=this._mergedOrder[mt];dt[Tt]=mt===lt?1:mt<lt?st[Tt].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((mt,Tt)=>dt[mt]-dt[Tt])}this._mergedLayers=st,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(d){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,d),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(d){return d.data?function($,st,lt,ht){const dt=Object.assign({},st);for(const Tt of Object.keys(dv))dt[Tt]===void 0&&(dt[Tt]=dv[Tt].default);const mt=new c.a8(tT,$,new Map(lt));return mt.setTransitionOrValue(dt,lt),mt.untransitioned().possiblyEvaluate(new c.ac(0,{worldview:void 0}))}(this.scope,d,this.options).get("data"):null}_loadColorTheme(d){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const $=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((st,lt)=>{const ht="data:image/png;base64,";if(!d||d.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void st();let dt=d;dt.startsWith(ht)||(dt=ht+dt);const mt=c.I.from("mapbox-reserved-lut"),Tt=new Image;Tt.src=dt,Tt.onerror=()=>{this._styleColorTheme.lutLoading=!1,lt(new Error("Failed to load image data"))},Tt.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==$)return void st();this._styleColorTheme.lutLoading=!1;const{width:Pt,height:Mt,data:Ht}=c.o.getImageData(Tt);if(Mt>32)return void lt(new Error("The height of the image must be less than or equal to 32 pixels."));if(Pt!==Mt*Mt)return void lt(new Error("The width of the image must be equal to the height squared."));this.getImage(mt)&&this.removeImage(mt),this.addImage(mt,{data:new c.q({width:Pt,height:Mt},Ht),pixelRatio:1,sdf:!1,usvg:!1,version:0});const $t=this.imageManager.getImage(mt,this.scope);$t?(this._styleColorTheme.lut={image:$t.data,data:d},st()):lt(new Error("Missing LUT image."))}})}getLut(d){const $=this._styleColorThemeForScope[d];return $?$.lut:null}setProjection(d){d?this.stylesheet.projection=d:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(d){this._spriteRequest=function($,st,lt){let ht,dt,mt;const Tt=c.o.devicePixelRatio>1?"@2x":"";let Pt=c.m(st.transformRequest(st.normalizeSpriteURL($,Tt,".json"),c.R.SpriteJSON),($t,qt)=>{Pt=null,mt||(mt=$t,ht=qt,Ht())}),Mt=c.n(st.transformRequest(st.normalizeSpriteURL($,Tt,".png"),c.R.SpriteImage),($t,qt)=>{Mt=null,mt||(mt=$t,dt=qt,Ht())});function Ht(){if(mt)lt(mt);else if(ht&&dt){const $t=c.o.getImageData(dt),qt={};for(const Qt in ht){const{width:Xt,height:sr,x:ir,y:hr,sdf:mr,pixelRatio:dr,stretchX:Ir,stretchY:Tr,content:Ar}=ht[Qt],Er=new c.q({width:Xt,height:sr});c.q.copy($t,Er,{x:ir,y:hr},{x:0,y:0},{width:Xt,height:sr},null),qt[Qt]={data:Er,pixelRatio:dr!==void 0?dr:1,sdf:mr!==void 0&&mr,stretchX:Ir,stretchY:Tr,content:Ar,usvg:!1,version:0}}lt(null,qt)}}return{cancel(){Pt&&(Pt.cancel(),Pt=null),Mt&&(Mt.cancel(),Mt=null)}}}(d,this.map._requestManager,($,st)=>{if(this._spriteRequest=null,$)this.fire(new c.y($));else if(st){const lt=new Map;for(const ht in st)lt.set(c.I.from(ht),st[ht]);this.addImages(lt)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new c.z("data",{dataType:"style"}))})}addIconset(d,$){if($.type==="sprite")return void this._loadSprite($.url);const st=this.getOwnSourceCache($.source);if(!st)return void this.fire(new c.y(new Error(`Source "${$.source}" as specified by iconset "${d}" does not exist and cannot be used as an iconset source`)));const lt=st.getSource();if(lt.type!=="raster-array")return void this.fire(new c.y(new Error(`Source "${$.source}" as specified by iconset "${d}" is not a "raster-array" source and cannot be used as an iconset source`)));lt.partial=!1;const ht=new pv(d,this.scope,st);this.imageManager.addImageProvider(ht,this.scope)}removeIconset(d){this.imageManager.removeImageProvider(d,this.scope)}_loadIconset(d){if(!c.h(d)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(d);const $=this.map._spriteFormat==="auto";var st,lt;this._spriteRequest=(lt=(ht,dt)=>{if(this._spriteRequest=null,ht)$?this._loadSprite(d):this.fire(new c.y(ht));else if(dt){const mt=new Map;for(const Tt in dt)mt.set(c.I.from(Tt),dt[Tt]);this.addImages(mt)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new c.z("data",{dataType:"style"}))},c.bu((st=this.map._requestManager).transformRequest(st.normalizeIconsetURL(d),c.R.Iconset),(ht,dt)=>{if(ht)return void lt(ht);const mt={},Tt=c.dg(new c.bt(dt));for(const Pt of Tt.icons){const Mt={version:1,pixelRatio:c.o.devicePixelRatio,content:sw(Pt),stretchX:Pt.metadata?ow(Pt.metadata.stretch_x_areas):void 0,stretchY:Pt.metadata?ow(Pt.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:Pt};mt[Pt.name]=Mt}lt(null,mt)}))}_validateLayer(d){const $=this.getOwnSource(d.source);if(!$)return;const st=d.sourceLayer;st&&($.type==="geojson"||$.vectorLayerIds&&$.vectorLayerIds.indexOf(st)===-1)&&this.fire(new c.y(new Error(`Source layer "${st}" does not exist on source "${$.id}" as specified by style layer "${d.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const d in this._sourceCaches)if(!this._sourceCaches[d].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:d}of this.fragments)if(!d.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((d,$)=>{const st=this.fragments[$];return st&&st.style&&(d.data=st.style.serialize()),d})}_serializeSources(){const d={};for(const $ in this._sourceCaches){const st=this._sourceCaches[$].getSource();d[st.id]||(d[st.id]=st.serialize())}return d}_serializeLayers(d){const $=[];for(const st of d){const lt=this._layers[st];lt&&lt.type!=="custom"&&$.push(lt.serialize())}return $}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const d in this._sourceCaches)if(this._sourceCaches[d].hasTransition())return!0;for(const d in this._layers)if(this._layers[d].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const d in this._mergedLayers){const $=this._mergedLayers[d];if($._transitionablePaint&&$._transitionablePaint._values){const st=$._transitionablePaint._values["line-emissive-strength"];if(st&&st.value&&st.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(d){return d?this.order:this._mergedOrder}isLayerDraped(d){return!!this.terrain&&d.isDraped(this.getLayerSourceCache(d))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(d){const $=this.getOwnLayer(d);if($)return $;this.fire(new c.y(new Error(`The layer '${d}' does not exist in the map's style.`)))}_checkSource(d){const $=this.getOwnSource(d);if($)return $;this.fire(new c.y(new Error(`The source '${d}' does not exist in the map's style.`)))}precompilePrograms(d,$){const st=this.map.painter;if(st)for(let lt=d.minzoom||0;lt<(d.maxzoom||25.5);lt++){const ht=d.getProgramIds();if(ht)for(const dt of ht){const mt=d.getDefaultProgramParams(dt,$.zoom,this._styleColorTheme.lut);mt&&(st.style=this,this.fog&&(st._fogVisible=!0,mt.overrideFog=!0,st.getOrCreateProgram(dt,mt)),st._fogVisible=!1,mt.overrideFog=!1,st.getOrCreateProgram(dt,mt),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(mt.overrideRtt=!0,st.getOrCreateProgram(dt,mt)))}}}update(d){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(d),this.directionalLight&&this.directionalLight.recalculate(d);const $=this.calculateLightsBrightness();d.brightness=$||0,$!==this._brightness&&(this._brightness=$,this.dispatcher.broadcast("setBrightness",$)),d.worldview!==this._worldview&&(this._worldview=d.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const st=this._changes.isDirty();let lt=!1;if(this._changes.isDirty()){const mt=this._changes.getLayerUpdatesByScope();for(const Tt in mt){const{updatedIds:Pt,removedIds:Mt}=mt[Tt];(Pt||Mt)&&(this._updateWorkerLayers(Tt,Pt,Mt),lt=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(d),this.light&&this.light.updateTransitions(d),this.ambientLight&&this.ambientLight.updateTransitions(d),this.directionalLight&&this.directionalLight.updateTransitions(d),this.fog&&this.fog.updateTransitions(d),this.snow&&this.snow.updateTransitions(d),this.rain&&this.rain.updateTransitions(d),this._changes.reset()}const ht={};for(const mt in this._mergedSourceCaches){const Tt=this._mergedSourceCaches[mt];ht[mt]=Tt.used,Tt.used=!1,Tt.tileCoverLift=0}for(const mt of this._mergedOrder){const Tt=this._mergedLayers[mt];if(Tt.visibility!=="none"&&Tt.recalculate(d,this._availableImages),!Tt.isHidden(d.zoom)){const Pt=this.getLayerSourceCache(Tt);Pt&&(Pt.used=!0,Pt.tileCoverLift=Math.max(Pt.tileCoverLift,Tt.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(Tt,d)}):this.precompilePrograms(Tt,d))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&lt&&this.mergeLayers();const dt=this.imageManager.getPendingImageProviders();for(const mt of dt)mt.sourceCache.used=!0;for(const mt in ht){const Tt=this._mergedSourceCaches[mt];ht[mt]!==Tt.used&&Tt.getSource().fire(new c.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:Tt.getSource().id}))}this.light&&this.light.recalculate(d),this.terrain&&this.terrain.recalculate(d),this.fog&&this.fog.recalculate(d),this.snow&&this.snow.recalculate(d),this.rain&&this.rain.recalculate(d),this.z=d.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),st&&this.fire(new c.z("data",{dataType:"style"}))}updateImageProviders(){const d=this.imageManager.getPendingImageProviders();for(const $ of d){const st=$.resolvePendingRequests(),lt=this.getFragmentStyle($.scope);lt&&lt.addImages(st)}}_updateTilesForChangedImages(){const d={};for(const $ in this._mergedSourceCaches){const st=this._mergedSourceCaches[$].getSource().scope;d[st]=d[st]||this._changes.getUpdatedImages(st),d[st].length!==0&&this._mergedSourceCaches[$].reloadTilesForDependencies(["icons","patterns"],d[st])}for(const $ in d)this._changes.resetUpdatedImages($)}_updateWorkerLayers(d,$,st){const lt=this.getFragmentStyle(d);lt&&this.dispatcher.broadcast("updateLayers",{layers:$?lt._serializeLayers($):[],scope:d,removedIds:st||[],options:lt.options})}setState(d,$){if(this._checkLoaded(),Am(this,jo(d)))return!1;(d=c.dp(d)).layers=c_(d.layers);const st=function(dt,mt){if(!dt)return[{command:eo.setStyle,args:[mt]}];let Tt=[];try{if(!c.by(dt.version,mt.version))return[{command:eo.setStyle,args:[mt]}];if(c.by(dt.center,mt.center)||Tt.push({command:eo.setCenter,args:[mt.center]}),c.by(dt.zoom,mt.zoom)||Tt.push({command:eo.setZoom,args:[mt.zoom]}),c.by(dt.bearing,mt.bearing)||Tt.push({command:eo.setBearing,args:[mt.bearing]}),c.by(dt.pitch,mt.pitch)||Tt.push({command:eo.setPitch,args:[mt.pitch]}),c.by(dt.sprite,mt.sprite)||Tt.push({command:eo.setSprite,args:[mt.sprite]}),c.by(dt.glyphs,mt.glyphs)||Tt.push({command:eo.setGlyphs,args:[mt.glyphs]}),c.by(dt.imports,mt.imports)||function(qt=[],Qt=[],Xt){Qt=Qt||[];const sr=(qt=qt||[]).map(u_),ir=Qt.map(u_),hr=qt.reduce(h_,{}),mr=Qt.reduce(h_,{}),dr=sr.slice();let Ir,Tr,Ar,Er;for(Ir=0,Tr=0;Ir<sr.length;Ir++)Ar=sr[Ir],mr.hasOwnProperty(Ar)?Tr++:(Xt.push({command:eo.removeImport,args:[Ar]}),dr.splice(dr.indexOf(Ar,Tr),1));for(Ir=0,Tr=0;Ir<ir.length;Ir++)Ar=ir[ir.length-1-Ir],dr[dr.length-1-Ir]!==Ar&&(hr.hasOwnProperty(Ar)?(Xt.push({command:eo.removeImport,args:[Ar]}),dr.splice(dr.lastIndexOf(Ar,dr.length-Tr),1)):Tr++,Er=dr[dr.length-Ir],Xt.push({command:eo.addImport,args:[mr[Ar],Er]}),dr.splice(dr.length-Ir,0,Ar));for(const vr of Qt){const Pr=hr[vr.id];Pr&&(delete Pr.data,c.by(Pr,vr)||Xt.push({command:eo.updateImport,args:[vr.id,vr]}))}}(dt.imports,mt.imports,Tt),c.by(dt.transition,mt.transition)||Tt.push({command:eo.setTransition,args:[mt.transition]}),c.by(dt.light,mt.light)||Tt.push({command:eo.setLight,args:[mt.light]}),c.by(dt.fog,mt.fog)||Tt.push({command:eo.setFog,args:[mt.fog]}),c.by(dt.snow,mt.snow)||Tt.push({command:eo.setSnow,args:[mt.snow]}),c.by(dt.rain,mt.rain)||Tt.push({command:eo.setRain,args:[mt.rain]}),c.by(dt.projection,mt.projection)||Tt.push({command:eo.setProjection,args:[mt.projection]}),c.by(dt.lights,mt.lights)||Tt.push({command:eo.setLights,args:[mt.lights]}),c.by(dt.camera,mt.camera)||Tt.push({command:eo.setCamera,args:[mt.camera]}),c.by(dt.iconsets,mt.iconsets)||function(qt,Qt,Xt){let sr;for(sr in Qt=Qt||{},qt=qt||{})qt.hasOwnProperty(sr)&&(Qt.hasOwnProperty(sr)||Xt.push({command:eo.removeIconset,args:[sr]}));for(sr in Qt){if(!Qt.hasOwnProperty(sr))continue;const ir=Qt[sr];qt.hasOwnProperty(sr)?c.by(qt[sr],ir)||(Xt.push({command:eo.removeIconset,args:[sr]}),Xt.push({command:eo.addIconset,args:[sr,ir]})):Xt.push({command:eo.addIconset,args:[sr,ir]})}}(dt.iconsets,mt.iconsets,Tt),!c.by(dt["color-theme"],mt["color-theme"]))return[{command:eo.setStyle,args:[mt]}];const Pt={},Mt=[];(function(qt,Qt,Xt,sr){let ir;for(ir in Qt=Qt||{},qt=qt||{})qt.hasOwnProperty(ir)&&(Qt.hasOwnProperty(ir)||iv(ir,Xt,sr));for(ir in Qt){if(!Qt.hasOwnProperty(ir))continue;const hr=Qt[ir];qt.hasOwnProperty(ir)?c.by(qt[ir],hr)||(qt[ir].type==="geojson"&&hr.type==="geojson"&&tw(qt,Qt,ir)?Xt.push({command:eo.setGeoJSONSourceData,args:[ir,hr.data]}):ew(ir,Qt,Xt,sr)):py(ir,Qt,Xt)}})(dt.sources,mt.sources,Mt,Pt);const Ht=[];dt.layers&&dt.layers.forEach(qt=>{qt.source&&Pt[qt.source]?Tt.push({command:eo.removeLayer,args:[qt.id]}):Ht.push(qt)});let $t=dt.terrain;$t&&Pt[$t.source]&&(Tt.push({command:eo.setTerrain,args:[void 0]}),$t=void 0),Tt=Tt.concat(Mt),c.by($t,mt.terrain)||Tt.push({command:eo.setTerrain,args:[mt.terrain]}),function(qt,Qt,Xt){Qt=Qt||[];const sr=(qt=qt||[]).map(u_),ir=Qt.map(u_),hr=qt.reduce(h_,{}),mr=Qt.reduce(h_,{}),dr=sr.slice(),Ir=Object.create(null);let Tr,Ar,Er,vr,Pr,Br,Or;for(Tr=0,Ar=0;Tr<sr.length;Tr++)Er=sr[Tr],mr.hasOwnProperty(Er)?Ar++:(Xt.push({command:eo.removeLayer,args:[Er]}),dr.splice(dr.indexOf(Er,Ar),1));for(Tr=0,Ar=0;Tr<ir.length;Tr++)Er=ir[ir.length-1-Tr],dr[dr.length-1-Tr]!==Er&&(hr.hasOwnProperty(Er)?(Xt.push({command:eo.removeLayer,args:[Er]}),dr.splice(dr.lastIndexOf(Er,dr.length-Ar),1)):Ar++,Br=dr[dr.length-Tr],Xt.push({command:eo.addLayer,args:[mr[Er],Br]}),dr.splice(dr.length-Tr,0,Er),Ir[Er]=!0);for(Tr=0;Tr<ir.length;Tr++)if(Er=ir[Tr],vr=hr[Er],Pr=mr[Er],!Ir[Er]&&!c.by(vr,Pr))if(c.by(vr.source,Pr.source)&&c.by(vr["source-layer"],Pr["source-layer"])&&c.by(vr.type,Pr.type)){for(Or in wm(vr.layout,Pr.layout,Xt,Er,null,eo.setLayoutProperty),wm(vr.paint,Pr.paint,Xt,Er,null,eo.setPaintProperty),c.by(vr.slot,Pr.slot)||Xt.push({command:eo.setSlot,args:[Er,Pr.slot]}),c.by(vr.filter,Pr.filter)||Xt.push({command:eo.setFilter,args:[Er,Pr.filter]}),c.by(vr.minzoom,Pr.minzoom)&&c.by(vr.maxzoom,Pr.maxzoom)||Xt.push({command:eo.setLayerZoomRange,args:[Er,Pr.minzoom,Pr.maxzoom]}),vr)vr.hasOwnProperty(Or)&&Or!=="layout"&&Or!=="paint"&&Or!=="filter"&&Or!=="metadata"&&Or!=="minzoom"&&Or!=="maxzoom"&&Or!=="slot"&&(Or.indexOf("paint.")===0?wm(vr[Or],Pr[Or],Xt,Er,Or.slice(6),eo.setPaintProperty):c.by(vr[Or],Pr[Or])||Xt.push({command:eo.setLayerProperty,args:[Er,Or,Pr[Or]]}));for(Or in Pr)Pr.hasOwnProperty(Or)&&!vr.hasOwnProperty(Or)&&Or!=="layout"&&Or!=="paint"&&Or!=="filter"&&Or!=="metadata"&&Or!=="minzoom"&&Or!=="maxzoom"&&Or!=="slot"&&(Or.indexOf("paint.")===0?wm(vr[Or],Pr[Or],Xt,Er,Or.slice(6),eo.setPaintProperty):c.by(vr[Or],Pr[Or])||Xt.push({command:eo.setLayerProperty,args:[Er,Or,Pr[Or]]}))}else Xt.push({command:eo.removeLayer,args:[Er]}),Br=dr[dr.lastIndexOf(Er)+1],Xt.push({command:eo.addLayer,args:[Pr,Br]})}(Ht,mt.layers,Tt)}catch(Pt){console.warn("Unable to compute style diff:",Pt),Tt=[{command:eo.setStyle,args:[mt]}]}return Tt}(this.serialize(),d).filter(dt=>!(dt.command in lw));if(st.length===0)return!1;const lt=st.filter(dt=>!(dt.command in aw));if(lt.length>0)throw new Error(`Unimplemented: ${lt.map(dt=>dt.command).join(", ")}.`);const ht=[];return st.forEach(dt=>{ht.push(this[dt.command](...dt.args))}),$&&Promise.all(ht).then($).catch($),this.stylesheet=d,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(d){if(d.size===0)return this;for(const[$,st]of d.entries()){if(this.getImage($))return this.fire(new c.y(new Error(`An image with the name "${$.name}" already exists.`)));this.imageManager.addImage($,this.scope,st),this._changes.updateImage($,this.scope)}return this._updateWorkerImages(),this.fire(new c.z("data",{dataType:"style"})),this}addImage(d,$){return this.getImage(d)?this.fire(new c.y(new Error(`An image with the name "${d.name}" already exists.`))):(this.imageManager.addImage(d,this.scope,$),this._changes.updateImage(d,this.scope),this._updateWorkerImages(),this.fire(new c.z("data",{dataType:"style"})),this)}updateImage(d,$,st=!1){this.imageManager.updateImage(d,this.scope,$),st&&(this._changes.updateImage(d,this.scope),this._updateWorkerImages(),this.fire(new c.z("data",{dataType:"style"})))}getImage(d){return this.imageManager.getImage(d,this.scope)}removeImage(d){return this.getImage(d)?(this.imageManager.removeImage(d,this.scope),this._changes.updateImage(d,this.scope),this._updateWorkerImages(),this.fire(new c.z("data",{dataType:"style"})),this):this.fire(new c.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(d){return this.modelManager.addModelURLs(d,this.getActualScope()),this._updateWorkerModels(),this.fire(new c.z("data",{dataType:"style"})),this}addModel(d,$,st={}){return this._checkLoaded(),this._validate(tr,`models.${d}`,$,null,st)||(this.modelManager.addModel(d,$,this.getActualScope()),this.fire(new c.z("data",{dataType:"style"}))),this}hasModel(d){return this.modelManager.hasModel(d,this.getActualScope())}removeModel(d){return this.hasModel(d)?(this.modelManager.removeModel(d,this.getActualScope(),!1,!0),this.fire(new c.z("data",{dataType:"style"})),this):this.fire(new c.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(d,$,st={}){if(this._checkLoaded(),this.getOwnSource(d)!==void 0)throw new Error(`There is already a source with ID "${d}".`);if(!$.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys($).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf($.type)>=0&&this._validate(Tu,`sources.${d}`,$,null,st))return;this.map&&this.map._collectResourceTiming&&($.collectResourceTiming=!0);const lt=Xl(d,$,this.dispatcher,this);lt.scope=this.scope,lt.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(lt.id),source:lt.serialize(),sourceId:lt.id}));const ht=dt=>{const mt=(dt?"symbol:":"other:")+lt.id,Tt=c.B(mt,this.scope),Pt=this._sourceCaches[mt]=new zu(Tt,lt,dt);(dt?this._symbolSourceCaches:this._otherSourceCaches)[lt.id]=Pt,Pt.onAdd(this.map)};ht(!1),$.type!=="vector"&&$.type!=="geojson"||ht(!0),lt.onAdd&&lt.onAdd(this.map),st.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(d){this._checkLoaded();const $=this.getOwnSource(d);if(!$)throw new Error("There is no source with this ID");for(const lt in this._layers)if(this._layers[lt].source===d)return this.fire(new c.y(new Error(`Source "${d}" cannot be removed while layer "${lt}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===d)return this.fire(new c.y(new Error(`Source "${d}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const lt=Object.entries(this.stylesheet.iconsets).find(([ht,dt])=>dt.type==="source"&&dt.source===d);if(lt)return this.fire(new c.y(new Error(`Source "${d}" cannot be removed while iconset "${lt[0]}" is using it.`)))}const st=this.getOwnSourceCaches(d);for(const lt of st){const ht=c.dq(lt.id);delete this._sourceCaches[ht],this._changes.discardSourceCacheUpdate(lt.id),lt.fire(new c.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:lt.getSource().id})),lt.setEventedParent(null),lt.clearTiles()}return delete this._otherSourceCaches[d],delete this._symbolSourceCaches[d],this.mergeSources(),$.setEventedParent(null),$.onRemove&&$.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(d,$){this._checkLoaded(),this.getOwnSource(d).setData($),this._changes.setDirty()}getOwnSource(d){const $=this.getOwnSourceCache(d);return $&&$.getSource()}getOwnSources(){const d=[];for(const $ in this._otherSourceCaches){const st=this.getOwnSourceCache($);st&&d.push(st.getSource())}return d}areTilesLoaded(){const d=this._mergedSourceCaches;for(const $ in d){const st=d[$]._tiles;for(const lt in st){const ht=st[lt];if(ht.state!=="loaded"&&ht.state!=="errored")return!1}}return!0}setLights(d){if(this._checkLoaded(),!d)return delete this.ambientLight,void delete this.directionalLight;const $=this._getTransitionParameters();for(const ht of d){if(this._validate(du,"lights",ht))return;switch(ht.type){case"ambient":if(this.ambientLight){const dt=this.ambientLight;dt.set(ht),dt.updateTransitions($)}else this.ambientLight=new Js(ht,Pl||(Pl=new c.a9({color:new c.aa(c.a6.properties_light_ambient.color),"color-use-theme":new c.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new c.aa(c.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const dt=this.directionalLight;dt.set(ht),dt.updateTransitions($)}else this.directionalLight=new Js(ht,ba||(ba=new c.a9({direction:new c.ap(c.a6.properties_light_directional.direction),color:new c.aa(c.a6.properties_light_directional.color),"color-use-theme":new c.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new c.aa(c.a6.properties_light_directional.intensity),"cast-shadows":new c.aa(c.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new c.aa(c.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new c.aa(c.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const st=Object.assign($,{worldview:this.map.getWorldview()}),lt=new c.ac(this.z||0,st);this.ambientLight&&this.ambientLight.recalculate(lt),this.directionalLight&&this.directionalLight.recalculate(lt),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const d=this.directionalLight,$=this.ambientLight;if(!d||!$)return;const st=$t=>.2126*($t[0]<=.03928?$t[0]/12.92:Math.pow(($t[0]+.055)/1.055,2.4))+.7152*($t[1]<=.03928?$t[1]/12.92:Math.pow(($t[1]+.055)/1.055,2.4))+.0722*($t[2]<=.03928?$t[2]/12.92:Math.pow(($t[2]+.055)/1.055,2.4)),lt=d.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),ht=d.properties.get("intensity"),dt=d.properties.get("direction"),mt=1-c.d4(dt.x,dt.y,dt.z)[2]/90,Tt=st(lt)*ht*mt,Pt=$.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),Mt=$.properties.get("intensity"),Ht=st(Pt)*Mt;return Number(((Tt+Ht)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const d=[];return this.directionalLight&&d.push(this.directionalLight.get()),this.ambientLight&&d.push(this.ambientLight.get()),d}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(d){if(d==null||d===""&&this.isRootStyle())return this;if(c.dr(d)){const $=c.ds(d),st=this.fragments.find(({id:ht})=>ht===$);if(!st)return;const lt=c.dq(d);return st.style.getFragmentStyle(lt)}{const $=this.fragments.find(({id:st})=>st===d);return $?$.style:void 0}}setFeaturesetSelectors(d){if(!d)return;const $={},st=(lt,ht="")=>`${lt}::${ht}`;this._featuresetSelectors={};for(const lt in d){const ht=this._featuresetSelectors[lt]=[];for(const dt of d[lt].selectors){if(dt.featureNamespace){const Tt=this.getOwnLayer(dt.layer);if(!Tt){c.w(`Layer is undefined for selector: ${dt.layer}`);continue}const Pt=st(Tt.source,Tt.sourceLayer);if(Pt in $&&$[Pt]!==dt.featureNamespace){c.w(`"featureNamespace ${dt.featureNamespace} of featureset ${lt}'s selector is not associated to the same source, skip this selector`);continue}$[Pt]=dt.featureNamespace}let mt;if(dt.properties)for(const Tt in dt.properties){const Pt=c.U(dt.properties[Tt]);Pt.result==="success"&&(mt=mt||{},mt[Tt]=Pt.value)}ht.push({layerId:dt.layer,namespace:dt.featureNamespace,properties:mt,uniqueFeatureID:dt._uniqueFeatureID})}}}getFeaturesetDescriptors(d){const $=this.getFragmentStyle(d);if(!$||!$.stylesheet.featuresets)return[];const st=[];for(const lt in $.stylesheet.featuresets)st.push({featuresetId:lt,importId:$.scope?$.scope:void 0});return st}getFeaturesetLayers(d,$){const st=this.getFragmentStyle($),lt=st.stylesheet.featuresets;if(!lt||!lt[d])return this.fire(new c.y(new Error(`The featureset '${d}' does not exist in the map's style and cannot be queried.`))),[];const ht=[];for(const dt of lt[d].selectors){const mt=st.getOwnLayer(dt.layer);mt&&ht.push(mt)}return ht}getConfigProperty(d,$){const st=this.getFragmentStyle(d);if(!st)return null;const lt=c.B($,st.scope),ht=st.options.get(lt),dt=ht?ht.value||ht.default:null;return dt?dt.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(d,$){const st=c.B(d,$);return this._mergedIndoor[st]}setIndoorData(d,$){this.map.indoor.setIndoorData($)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(d,$,st){const lt=this.getFragmentStyle(d);if(!lt)return;const ht=lt.stylesheet.schema;if(!ht||!ht[$])return;const dt=c.U(st);if(dt.result!=="success")return void Am(this,dt.value);const mt=dt.value.expression,Tt=c.B($,lt.scope),Pt=lt.options.get(Tt);if(!Pt)return;let Mt;const{minValue:Ht,maxValue:$t,stepValue:qt,type:Qt,values:Xt}=ht[$],sr=c.U(ht[$].default);sr.result==="success"&&(Mt=sr.value.expression),Mt?(this.options.set(Tt,Object.assign({},Pt,{value:mt,default:Mt,minValue:Ht,maxValue:$t,stepValue:qt,type:Qt,values:Xt})),this.updateConfigDependencies($)):this.fire(new c.y(new Error(`No schema defined for the config option "${$}" in the "${d}" fragment.`)))}getConfig(d){const $=this.getFragmentStyle(d);if(!$)return null;const st=$.stylesheet.schema;if(!st)return null;const lt={};for(const ht in st){const dt=c.B(ht,$.scope),mt=$.options.get(dt),Tt=mt?mt.value||mt.default:null;lt[ht]=Tt?Tt.serialize():null}return lt}setConfig(d,$){const st=this.getFragmentStyle(d);st&&(st.updateConfig($,st.stylesheet.schema),this.updateConfigDependencies())}getSchema(d){const $=this.getFragmentStyle(d);return $?$.stylesheet.schema:null}setSchema(d,$){const st=this.getFragmentStyle(d);st&&(st.stylesheet.schema=$,st.updateConfig(st._config,$),this.updateConfigDependencies())}updateConfig(d,$){if(this._config=d,d||$)if($)for(const st in $){let lt,ht;const dt=c.U($[st].default);if(dt.result==="success"&&(lt=dt.value.expression),d&&d[st]!==void 0){const $t=c.U(d[st]);$t.result==="success"&&(ht=$t.value.expression)}const{minValue:mt,maxValue:Tt,stepValue:Pt,type:Mt,values:Ht}=$[st];if(lt){const $t=c.B(st,this.scope);this.options.set($t,{default:lt,value:ht,minValue:mt,maxValue:Tt,stepValue:Pt,type:Mt,values:Ht})}else this.fire(new c.y(new Error(`No schema defined for config option "${st}".`)))}else this.fire(new c.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(d,$=()=>!0){for(const st of d){const lt=this.getLayer(st);lt&&$(lt)&&(lt.possiblyEvaluateVisibility(),this._updateLayer(lt),this._changes.setDirty())}}updateConfigDependencies(d){this._updateLayers(this._configDependentLayers,$=>!d||$.expressionDependencies.configDependencies.has(d)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle($=>{const st=$._styleColorTheme.colorThemeOverride?$._styleColorTheme.colorThemeOverride:$._styleColorTheme.colorTheme;if(st){const lt=$._evaluateColorThemeData(st);(!$._styleColorTheme.lut&&lt!==""||$._styleColorTheme.lut&&lt!==$._styleColorTheme.lut.data)&&$.setColorTheme(st)}}),this._changes.setDirty()}addLayer(d,$,st={}){this._checkLoaded();const lt=d.id;if(this._layers[lt])return void this.fire(new c.y(new Error(`Layer with id "${lt}" already exists on this map`)));let ht;if(d.type==="custom"){if(Am(this,c.dt(d)))return;ht=c.du(d,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof d.source=="object"&&(this.addSource(lt,d.source),d=c.dp(d),d=Object.assign(d,{source:lt})),this._validate(rv,`layers.${lt}`,d,{arrayIndex:-1},st))return;ht=c.du(d,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(ht),ht.setEventedParent(this,{layer:{id:lt}})}const dt=c.B(ht.source,ht.scope);ht.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(dt),ht.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(dt);let mt=this._order.length;if($){const Ht=this._order.indexOf($);if(Ht===-1)return void this.fire(new c.y(new Error(`Layer with id "${$}" does not exist on this map.`)));ht.slot===this._layers[$].slot?mt=Ht:c.w(`Layer with id "${$}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(mt,0,lt),this._layerOrderChanged=!0,this._layers[lt]=ht;const Tt=this.getOwnLayerSourceCache(ht),Pt=!!this.directionalLight&&this.directionalLight.shadowsEnabled();Tt&&ht.canCastShadows()&&Pt&&(Tt.castsShadows=!0);const Mt=this._changes.getRemovedLayer(ht);if(Mt&&ht.source&&Tt&&ht.type!=="custom"){this._changes.discardLayerRemoval(ht);const Ht=c.B(ht.source,ht.scope);Mt.type!==ht.type?this._changes.updateSourceCache(Ht,"clear"):(this._changes.updateSourceCache(Ht,"reload"),Tt.pause())}this._updateLayer(ht),ht.onAdd&&ht.onAdd(this.map),ht.scope=this.scope,this.mergeLayers()}moveLayer(d,$){this._checkLoaded();const st=this._checkLayer(d);if(!st||d===$)return;const lt=this._order.indexOf(d);this._order.splice(lt,1);let ht=this._order.length;if($){const dt=this._order.indexOf($);if(dt===-1)return void this.fire(new c.y(new Error(`Layer with id "${$}" does not exist on this map.`)));st.slot===this._layers[$].slot?ht=dt:c.w(`Layer with id "${$}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(ht,0,d),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(d){this._checkLoaded();const $=this._checkLayer(d);if(!$)return;$.setEventedParent(null);const st=this._order.indexOf(d);this._order.splice(st,1),delete this._layers[d],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete($.fqid),this._indoorDependentLayers.delete($.fqid),this._changes.removeLayer($);const lt=this.getOwnLayerSourceCache($);if(lt&&lt.castsShadows){let ht=!1;for(const dt in this._layers)if(this._layers[dt].source===$.source&&this._layers[dt].canCastShadows()){ht=!0;break}lt.castsShadows=ht}$.onRemove&&$.onRemove(this.map),this.mergeLayers()}getOwnLayer(d){return this._layers[d]}hasLayer(d){return d in this._mergedLayers}hasLayerType(d){for(const $ in this._layers)if(this._layers[$].type===d)return!0;return!1}setLayerZoomRange(d,$,st){this._checkLoaded();const lt=this._checkLayer(d);lt&&(lt.minzoom===$&&lt.maxzoom===st||($!=null&&(lt.minzoom=$),st!=null&&(lt.maxzoom=st),this._updateLayer(lt)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(d,$){this._checkLoaded();const st=this._checkLayer(d);st&&st.slot!==$&&(st.slot=$,this._updateLayer(st))}setFilter(d,$,st={}){this._checkLoaded();const lt=this._checkLayer(d);if(lt&&!c.by(lt.filter,$))return $==null?(lt.filter=void 0,void this._updateLayer(lt)):void(this._validate(qm,`layers.${lt.id}.filter`,$,{layerType:lt.type},st)||(lt.filter=c.dp($),this._updateLayer(lt)))}getFilter(d){const $=this._checkLayer(d);if($)return c.dp($.filter)}setLayoutProperty(d,$,st,lt={}){this._checkLoaded();const ht=this._checkLayer(d);if(ht&&!c.by(ht.getLayoutProperty($),st)){if(st!=null&&(!lt||lt.validate!==!1)&&Am(ht,Wr.call(jo,{key:`layers.${d}.layout.${$}`,layerType:ht.type,objectKey:$,value:st,styleSpec:c.a6,style:{glyphs:!0,sprite:!0}})))return;ht.setLayoutProperty($,st),ht.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(ht.fqid),ht.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(ht.fqid),this._updateLayer(ht)}}setLayerProperty(d,$,st,lt={}){this._checkLoaded();const ht=this._checkLayer(d);ht&&($==="appearances"?(ht.setAppearances(st),this._changes.setDirty()):ht.isPaintProperty($)?this.setPaintProperty(d,$,st,lt):this.setLayoutProperty(d,$,st,lt))}getLayoutProperty(d,$){const st=this._checkLayer(d);if(st)return st.getLayoutProperty($)}setPaintProperty(d,$,st,lt={}){this._checkLoaded();const ht=this._checkLayer(d);if(!ht||c.by(ht.getPaintProperty($),st)||st!=null&&(!lt||lt.validate!==!1)&&Am(ht,o_.call(jo,{key:`layers.${d}.paint.${$}`,layerType:ht.type,objectKey:$,value:st,styleSpec:c.a6})))return;const dt=ht.setPaintProperty($,st);ht.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(ht.fqid),ht.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(ht.fqid),dt&&this._updateLayer(ht),this._changes.updatePaintProperties(ht)}getPaintProperty(d,$){const st=this._checkLayer(d);if(st)return st.getPaintProperty($)}setFeatureState(d,$){if(this._checkLoaded(),"target"in d){if("featuresetId"in d.target){const{featuresetId:Tt,importId:Pt}=d.target,Mt=this.getFragmentStyle(Pt),Ht=Mt.getFeaturesetLayers(Tt);for(const{source:$t,sourceLayer:qt}of Ht)Mt.setFeatureState({id:d.id,source:$t,sourceLayer:qt},$)}else if("layerId"in d.target){const{layerId:Tt}=d.target,Pt=this.getLayer(Tt);this.setFeatureState({id:d.id,source:Pt.source,sourceLayer:Pt.sourceLayer},$)}return}const st=d.source,lt=d.sourceLayer,ht=this._checkSource(st);if(!ht)return;const dt=ht.type;if(dt==="geojson"&&lt)return void this.fire(new c.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(dt==="vector"&&!lt)return void this.fire(new c.y(new Error("The sourceLayer parameter must be provided for vector source types.")));d.id===void 0&&this.fire(new c.y(new Error("The feature id parameter must be provided.")));const mt=this.getOwnSourceCaches(st);for(const Tt of mt)Tt.setFeatureState(lt,d.id,$)}removeFeatureState(d,$){if(this._checkLoaded(),"target"in d){if("featuresetId"in d.target){const{featuresetId:Tt,importId:Pt}=d.target,Mt=this.getFragmentStyle(Pt),Ht=Mt.getFeaturesetLayers(Tt);for(const{source:$t,sourceLayer:qt}of Ht)Mt.removeFeatureState({id:d.id,source:$t,sourceLayer:qt},$)}else if("layerId"in d.target){const{layerId:Tt}=d.target,Pt=this.getLayer(Tt);this.removeFeatureState({id:d.id,source:Pt.source,sourceLayer:Pt.sourceLayer},$)}return}const st=d.source,lt=this._checkSource(st);if(!lt)return;const ht=lt.type,dt=ht==="vector"?d.sourceLayer:void 0;if(ht==="vector"&&!dt)return void this.fire(new c.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if($&&typeof d.id!="string"&&typeof d.id!="number")return void this.fire(new c.y(new Error("A feature id is required to remove its specific state property.")));const mt=this.getOwnSourceCaches(st);for(const Tt of mt)Tt.removeFeatureState(dt,d.id,$)}getFeatureState(d){if(this._checkLoaded(),"target"in d){let ht;if("featuresetId"in d.target){const{featuresetId:dt,importId:mt}=d.target,Tt=this.getFragmentStyle(mt),Pt=Tt.getFeaturesetLayers(dt);for(const{source:Mt,sourceLayer:Ht}of Pt){const $t=Tt.getFeatureState({id:d.id,source:Mt,sourceLayer:Ht});if($t&&!ht)ht=$t;else if(!c.by(ht,$t))return void this.fire(new c.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in d.target){const{layerId:dt}=d.target,mt=this.getLayer(dt);ht=this.getFeatureState({id:d.id,source:mt.source,sourceLayer:mt.sourceLayer})}return ht}const $=d.source,st=d.sourceLayer,lt=this._checkSource($);if(lt){if(lt.type!=="vector"||st)return d.id===void 0&&this.fire(new c.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches($)[0].getFeatureState(st,d.id);this.fire(new c.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(d){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,d),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const d=this.getTerrain(),$=d&&this.terrain&&this.terrain.scope===this.scope?d:this.stylesheet.terrain;return c.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:$,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},st=>st!==void 0)}_updateFilteredLayers(d){for(const $ of Object.values(this._mergedLayers))d($)&&this._updateLayer($)}_updateLayer(d){this._changes.updateLayer(d);const $=this.getLayerSourceCache(d),st=c.B(d.source,d.scope),lt=this._changes.getUpdatedSourceCaches();d.source&&!lt[st]&&$&&$.getSource().type!=="raster"&&(this._changes.updateSourceCache(st,"reload"),$.pause()),d.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(d){const $=mt=>this._mergedLayers[mt].is3D(!!this.terrain),st=this.order,lt={},ht=[];for(let mt=st.length-1;mt>=0;mt--){const Tt=st[mt];if($(Tt)){lt[Tt]=mt;for(const Pt of d){const Mt=Pt[Tt];if(Mt)for(const Ht of Mt)ht.push(Ht)}}}ht.sort((mt,Tt)=>Tt.intersectionZ-mt.intersectionZ);const dt=[];for(let mt=st.length-1;mt>=0;mt--){const Tt=st[mt];if($(Tt))for(let Pt=ht.length-1;Pt>=0;Pt--){const Mt=ht[Pt].feature;if(Mt.layer&&lt[Mt.layer.id]<mt)break;dt.push(Mt),ht.pop()}else for(const Pt of d){const Mt=Pt[Tt];if(Mt)for(const Ht of Mt)dt.push(Ht.feature)}}return dt}queryRasterValue(d,$,st){const lt=this.getOwnSource(d);return lt?lt.type!=="raster-array"?(this.fire(new c.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):lt.queryRasterArrayValue($,st):(this.fire(new c.y(new Error(`Source with id "${d}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(d,$,st){let lt;$&&!Array.isArray($)&&$.filter&&(this._validate(qm,"queryRenderedFeatures.filter",$.filter,null,$),lt=c.b6($.filter));const ht={},dt=Mt=>{if(Ty.has(Mt.type))return;const Ht=this.getOwnLayerSourceCache(Mt),$t=ht[Ht.id]=ht[Ht.id]||{sourceCache:Ht,layers:{},has3DLayers:!1};Mt.is3D(!!this.terrain)&&($t.has3DLayers=!0),$t.layers[Mt.fqid]=$t.layers[Mt.fqid]||{styleLayer:Mt,targets:[]},$t.layers[Mt.fqid].targets.push({filter:lt})};if($&&$.layers){if(!Array.isArray($.layers))return this.fire(new c.y(new Error("parameters.layers must be an Array."))),[];for(const Mt of $.layers){const Ht=this._layers[Mt];if(!Ht)return this.fire(new c.y(new Error(`The layer '${Mt}' does not exist in the map's style and cannot be queried for features.`))),[];dt(Ht)}}else for(const Mt in this._layers)dt(this._layers[Mt]);const mt=this._queryRenderedFeatures(d,ht,st),Tt=this._flattenAndSortRenderedFeatures(mt),Pt=[];for(const Mt of Tt)c.dw(Mt.layer.id)===this.scope&&Pt.push(Mt);return Pt}queryRenderedFeatureset(d,$,st){let lt;$&&!Array.isArray($)&&$.filter&&(this._validate(qm,"queryRenderedFeatures.filter",$.filter,null,$),lt=c.b6($.filter));const ht="mock",dt=[];if($&&$.target)dt.push(Object.assign({},$,{targetId:ht,filter:lt}));else{const Mt=this.getFeaturesetDescriptors();for(const Ht of Mt)dt.push({targetId:ht,filter:lt,target:Ht});for(const{style:Ht}of this.fragments){const $t=Ht.getFeaturesetDescriptors();for(const qt of $t)dt.push({targetId:ht,filter:lt,target:qt})}}const mt=this.queryRenderedTargets(d,dt,st),Tt=[],Pt=new Set;for(const Mt of mt)for(const Ht of Mt.variants[ht])v0(Ht,Mt,Pt)||Tt.push(new c.dx(Mt,Ht));return Tt}queryRenderedTargets(d,$,st){const lt={},ht=(mt,Tt,Pt,Mt)=>{const Ht=lt[Tt.id]=lt[Tt.id]||{sourceCache:Tt,layers:{},has3DLayers:!1};if(Ht.layers[mt.fqid]=Ht.layers[mt.fqid]||{styleLayer:mt,targets:[]},mt.is3D(!!this.terrain)&&(Ht.has3DLayers=!0),!Mt)return Pt.uniqueFeatureID=!1,void Ht.layers[mt.fqid].targets.push(Pt);Ht.layers[mt.fqid].targets.push(Object.assign({},Pt,{namespace:Mt.namespace,properties:Mt.properties,uniqueFeatureID:Mt.uniqueFeatureID}))};for(const mt of $)if("featuresetId"in mt.target){const{featuresetId:Tt,importId:Pt}=mt.target,Mt=this.getFragmentStyle(Pt);if(!Mt||!Mt._featuresetSelectors)continue;const Ht=Mt._featuresetSelectors[Tt];if(!Ht){this.fire(new c.y(new Error(`The featureset '${Tt}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const $t of Ht){const qt=Mt.getOwnLayer($t.layerId);qt&&!Ty.has(qt.type)&&ht(qt,Mt.getOwnLayerSourceCache(qt),mt,$t)}}else if("layerId"in mt.target){const{layerId:Tt}=mt.target,Pt=this.getLayer(Tt);if(!Pt||Ty.has(Pt.type))continue;ht(Pt,this.getLayerSourceCache(Pt),mt)}const dt=this._queryRenderedFeatures(d,lt,st);return this._flattenAndSortRenderedFeatures(dt)}_queryRenderedFeatures(d,$,st){const lt=[],ht=!!this.map._showQueryGeometry,dt=Xo.createFromScreenPoints(d,st);for(const mt in $){const Tt=ay(dt,$[mt],this._availableImages,st,ht);Object.keys(Tt).length&&lt.push(Tt)}if(this.placement)for(const mt in $){if(!$[mt].sourceCache._onlySymbols)continue;const Tt=ly(dt.screenGeometry,$[mt],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(Tt).length&&lt.push(Tt)}return lt}querySourceFeatures(d,$){const st=$&&$.filter;st&&this._validate(qm,"querySourceFeatures.filter",st,null,$);let lt=[];const ht=this.getOwnSourceCaches(d);for(const dt of ht)lt=lt.concat(cy(dt,$));return lt}addSourceType(d,$,st){return cp.getSourceType(d)?st(new Error(`A source type called "${d}" already exists.`)):(cp.setSourceType(d,$),$.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:d,url:$.workerSourceURL},st):st(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(d,$,st={}){this._checkLoaded();const lt=this.light.getLight();let ht=!1;for(const mt in d)if(!c.by(d[mt],lt[mt])){ht=!0;break}if(!ht)return;const dt=this._getTransitionParameters();this.light.setLight(d,$,st),this.light.updateTransitions(dt)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=c.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&c.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(d,$=1){if(this._checkLoaded(),!d)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),$===0&&delete this.terrain,d===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let st=d;const lt=!("source"in d)||d.source==null;if($===1){if(this.disableElevatedTerrain)return;if("source"in st&&typeof st.source=="object"){const mt="terrain-dem-src";this.addSource(mt,st.source),st=c.dp(st),st=Object.assign(st,{source:mt})}const ht=Object.assign({},st),dt={};if(this.terrain&&lt){ht.source=this.terrain.get().source;const mt=this.terrain?this.getFragmentStyle(this.terrain.scope):null;mt&&(dt.style=mt.serialize())}if(this._validate(gp,"terrain",ht,dt))return}if(!this.terrain||this.terrain.scope!==this.scope&&!lt||this.terrain&&$!==this.terrain.drapeRenderMode){if(!st)return;this._createTerrain(st,$),this.fire(new c.z("data",{dataType:"style"}))}else{const ht=this.terrain,dt=ht.get();for(const mt of Object.keys(c.a6.terrain))!st.hasOwnProperty(mt)&&c.a6.terrain[mt].default&&(st[mt]=c.a6.terrain[mt].default);for(const mt in d)if(!c.by(d[mt],dt[mt])){ht.set(d,this.options),this.stylesheet.terrain=d;const Tt=this._getTransitionParameters({duration:0});ht.updateTransitions(Tt),this.fire(new c.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(d){const $=this.fog=new As(d,this.map.transform,this.scope,this.options);this.stylesheet.fog=$.get();const st=this._getTransitionParameters({duration:0});$.updateTransitions(st)}_createSnow(d){const $=this.snow=new Ol(d,this.map.transform,this.scope,this.options);this.stylesheet.snow=$.get();const st=this._getTransitionParameters({duration:0});$.updateTransitions(st)}_createRain(d){const $=this.rain=new Ko(d,this.map.transform,this.scope,this.options);this.stylesheet.rain=$.get();const st=this._getTransitionParameters({duration:0});$.updateTransitions(st)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const d of this.map._markers)d._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(d){if(this._checkLoaded(),!d)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const $=this.fog;if(!c.by($.get(),d)){$.set(d,this.options),this.stylesheet.fog=$.get();const st=this._getTransitionParameters({duration:0});$.updateTransitions(st)}}else this._createFog(d);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(d){if(this._checkLoaded(),!d)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const $=this.snow;if(!c.by($.get(),d)){$.set(d,this.options),this.stylesheet.snow=$.get();const st=this._getTransitionParameters({duration:0});$.updateTransitions(st)}}else this._createSnow(d);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(d){if(this._checkLoaded(),!d)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const $=this.rain;if(!c.by($.get(),d)){$.set(d,this.options),this.stylesheet.rain=$.get();const st=this._getTransitionParameters({duration:0});$.updateTransitions(st)}}else this._createRain(d);this._markersNeedUpdate=!0}_reloadColorTheme(){const d=()=>{for(const lt in this._layers)this._layers[lt].lut=this._styleColorTheme.lut;for(const lt in this._sourceCaches)this._sourceCaches[lt].clearTiles()},$=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!$)return this._styleColorTheme.lut=null,void d();const st=this._evaluateColorThemeData($);this._loadColorTheme(st).then(()=>{this.fire(new c.z("colorthemeset")),d()}).catch(lt=>{c.w(`Couldn't set color theme: ${lt}`)})}setColorTheme(d){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&c.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=d,this._reloadColorTheme()}setImportColorTheme(d,$){const st=this.getFragmentStyle(d);st&&(st._styleColorTheme.colorThemeOverride=$,st._reloadColorTheme())}_getTransitionParameters(d){return{now:c.o.now(),transition:Object.assign(this.transition,d)}}updateDrapeFirstLayers(){if(!this.terrain)return;const d=[],$=[];for(const st of this._mergedOrder)this.isLayerDraped(this._mergedLayers[st])?d.push(st):$.push(st);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...d),this._drapedFirstOrder.push(...$)}_createTerrain(d,$){const st=this.terrain=new Vr(d,$,this.scope,this.options,this.map.getWorldview());$===1&&(this.stylesheet.terrain=d),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const lt=this._getTransitionParameters({duration:0});st.updateTransitions(lt)}_force3DLayerUpdate(){for(const d in this._layers){const $=this._layers[d];$.type==="fill-extrusion"&&this._updateLayer($)}}_forceSymbolLayerUpdate(){for(const d in this._layers){const $=this._layers[d];$.type==="symbol"&&this._updateLayer($)}}_validate(d,$,st,lt,ht={}){if(ht&&ht.validate===!1)return!1;const dt=Object.assign({},this.serialize());return Am(this,d.call(jo,Object.assign({key:$,style:dt,value:st,styleSpec:c.a6},lt)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const d in this._mergedLayers)this._mergedLayers[d].setEventedParent(null);for(const d in this._mergedSourceCaches)this._mergedSourceCaches[d].clearTiles(),this._mergedSourceCaches[d].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(d){const $=this.getSourceCaches(d);for(const st of $)st.clearTiles()}clearSources(){for(const d in this._mergedSourceCaches)this._mergedSourceCaches[d].clearTiles()}clearLayers(){for(const d in this._mergedLayers){const $=this._mergedLayers[d];$._clear&&$._clear()}}reloadSource(d){const $=this.getSourceCaches(d);for(const st of $)st.resume(),st.reload()}reloadSources(){for(const d of this.getSources())d.reload&&d.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(d=>{d.modelManager.reloadModels(d.scope)})}updateSources(d){let $;this.directionalLight&&($=v_(this.directionalLight));const st=new Set,lt=new Set;for(const ht in this._mergedLayers){const dt=this._mergedLayers[ht];dt.type==="building"&&st.add(dt.source),dt.hasElevation()&&!lt.has(dt.source)&&lt.add(dt.source)}for(const ht in this._mergedSourceCaches){const dt=this._mergedSourceCaches[ht],mt=lt.has(dt._source.id);st.has(dt._source.id)&&(dt._source.reparseOverscaled=!1),dt.update(d,void 0,void 0,$,mt)}}_generateCollisionBoxes(){for(const d in this._sourceCaches){const $=this._sourceCaches[d];$.resume(),$.reload()}}_updatePlacement(d,$,st,lt,ht,dt,mt=!1){let Tt=!1,Pt=!1;const Mt={},Ht={};for(const Xt of this._mergedOrder){const sr=this._mergedLayers[Xt];if(sr.type!=="symbol")continue;const ir=c.B(sr.source,sr.scope);let hr=Mt[ir];if(!hr){const dr=this.getLayerSourceCache(sr);if(!dr)continue;const Ir=dr.getRenderableIds(!0).map(Tr=>dr.getTileByID(Tr));Ht[ir]=Ir.slice(),hr=Mt[ir]=Ir.sort((Tr,Ar)=>Ar.tileID.overscaledZ-Tr.tileID.overscaledZ||(Tr.tileID.isLessThan(Ar.tileID)?-1:1))}const mr=this.crossTileSymbolIndex.addLayer(sr,hr,$.center.lng,$.projection);Tt=Tt||mr}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),mt=mt||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new c.z("neworder"));const $t=!!(this.placement&&!$.equals(this.placement.transform)),qt=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!dt||this.placement.lastReplacementSourceUpdateTime!==dt.updateTime)),Qt=($t||qt||Tt||this.placement&&this.placement.isStale())&&lt===0;if((mt||!this.pauseablePlacement||Qt||lt!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.o.now(),$.zoom))&&(this.pauseablePlacement=new Zl($,this._mergedOrder,mt||lt===0,st,lt,ht,this.placement,this.fog&&$.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,Mt,Ht,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.o.now()),Pt=!0),Tt&&this.pauseablePlacement.placement.setStale()),Pt||Tt){this._buildingIndex.onNewFrame($.zoom);for(let Xt=0;Xt<this._mergedOrder.length;Xt++){const sr=this._mergedLayers[this._mergedOrder[Xt]];if(sr.type!=="symbol"||sr.visibility==="none")continue;const ir=this.isLayerClipped(sr);this.placement.updateLayerOpacities(sr,Mt[c.B(sr.source,sr.scope)],Xt,ir?dt:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.o.now())}}_releaseSymbolFadeTiles(){for(const d in this._sourceCaches)this._sourceCaches[d].releaseSymbolFadeTiles()}addImport(d,$){this._checkLoaded();const st=this.stylesheet.imports=this.stylesheet.imports||[];if(st.findIndex(({id:ht})=>ht===d.id)!==-1)return void this.fire(new c.y(new Error(`Import with id '${d.id}' already exists in the map's style.`)));if(!$)return st.push(d),this._loadImports([d],!0);const lt=st.findIndex(({id:ht})=>ht===$);return lt===-1&&this.fire(new c.y(new Error(`Import with id "${$}" does not exist on this map.`))),this.stylesheet.imports=st.slice(0,lt).concat(d).concat(st.slice(lt)),this._loadImports([d],!0,$)}updateImport(d,$){this._checkLoaded();const st=this.stylesheet.imports||[],lt=this.getImportIndex(d);return lt===-1?this:typeof $=="string"?(this.setImportUrl(d,$),this):($.url&&$.url!==st[lt].url&&this.setImportUrl(d,$.url),c.by($.config,st[lt].config)||this.setImportConfig(d,$.config,$.data.schema),c.by($.data,st[lt].data)||this.setImportData(d,$.data),this)}moveImport(d,$){this._checkLoaded();let st=this.stylesheet.imports||[];const lt=this.getImportIndex(d);if(lt===-1)return this;const ht=this.getImportIndex($);if(ht===-1)return this;const dt=st[lt],mt=this.fragments[lt];return st=st.filter(({id:Tt})=>Tt!==d),this.fragments=this.fragments.filter(({id:Tt})=>Tt!==d),this.stylesheet.imports=st.slice(0,ht).concat(dt).concat(st.slice(ht)),this.fragments=this.fragments.slice(0,ht).concat(mt).concat(this.fragments.slice(ht)),this.mergeLayers(),this}setImportUrl(d,$){this._checkLoaded();const st=this.stylesheet.imports||[],lt=this.getImportIndex(d);if(lt===-1)return this;st[lt].url=$;const ht=this.fragments[lt];return ht.style=this._createFragmentStyle(st[lt]),ht.style.on("style.import.load",()=>this.mergeAll()),ht.style.loadURL($),this}setImportData(d,$){this._checkLoaded();const st=this.getImportIndex(d),lt=this.stylesheet.imports||[];return st===-1?this:$?(this.fragments[st].style.setState($),this._reloadImports(),this):(delete lt[st].data,this.setImportUrl(d,lt[st].url))}setImportConfig(d,$,st){this._checkLoaded();const lt=this.getImportIndex(d),ht=this.stylesheet.imports||[];if(lt===-1)return this;$?ht[lt].config=$:delete ht[lt].config;const dt=this.fragments[lt];st&&dt.style.stylesheet&&(dt.style.stylesheet.schema=st);const mt=dt.style.stylesheet&&dt.style.stylesheet.schema;return dt.config=$,dt.style.updateConfig($,mt),this.updateConfigDependencies(),this}removeImport(d){this._checkLoaded();const $=this.stylesheet.imports||[],st=this.getImportIndex(d);st!==-1&&($.splice(st,1),this.fragments[st].style._remove(),this.fragments.splice(st,1),this._reloadImports())}getImportIndex(d){const $=(this.stylesheet.imports||[]).findIndex(st=>st.id===d);return $===-1&&this.fire(new c.y(new Error(`Import '${d}' does not exist in the map's style and cannot be updated.`))),$}getLayer(d){return this._mergedLayers[d]}getSources(){const d=[];for(const $ in this._mergedOtherSourceCaches){const st=this._mergedOtherSourceCaches[$];st&&d.push(st.getSource())}return d}getSource(d,$){const st=this.getSourceCache(d,$);return st&&st.getSource()}getLayerSource(d){const $=this.getLayerSourceCache(d);return $&&$.getSource()}getSourceCache(d,$){const st=c.B(d,$);return this._mergedOtherSourceCaches[st]}getLayerSourceCache(d){const $=c.B(d.source,d.scope);return d.type==="symbol"?this._mergedSymbolSourceCaches[$]:this._mergedOtherSourceCaches[$]}getSourceCaches(d){if(d==null)return Object.values(this._mergedSourceCaches);const $=[];return this._mergedOtherSourceCaches[d]&&$.push(this._mergedOtherSourceCaches[d]),this._mergedSymbolSourceCaches[d]&&$.push(this._mergedSymbolSourceCaches[d]),$}updateSourceCaches(){const d=this._changes.getUpdatedSourceCaches();for(const $ in d){const st=d[$];st==="reload"?this.reloadSource($):st==="clear"&&this.clearSource($)}}updateLayers(d){const $=this._changes.getUpdatedPaintProperties();for(const st of $){const lt=this.getLayer(st);lt&&lt.updateTransitions(d)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(d){this.stylesheet.glyphs=d,this.glyphManager.setURL(d)}getImages(d,$,st){this.imageManager.getImages($.images,$.scope,st),this._updateTilesForChangedImages();const lt=dt=>{if(dt){const mt=$.images.map(Tt=>c.I.toString(Tt));dt.setDependencies($.tileID.key,$.type,mt)}},ht=c.B($.source,$.scope);lt(this._mergedOtherSourceCaches[ht]),lt(this._mergedSymbolSourceCaches[ht]),$.images.some(dt=>dt.iconsetId)&&this.fire(new c.z("data",{dataType:"style"}))}rasterizeImages(d,$,st){this.imageManager.rasterizeImages($,st)}getGlyphs(d,$,st){this.glyphManager.getGlyphs($.stacks,st)}getResource(d,$,st){return c.dz($,st)}getOwnSourceCache(d){return this._otherSourceCaches[d]}getOwnLayerSourceCache(d){return d.type==="symbol"?this._symbolSourceCaches[d.source]:this._otherSourceCaches[d.source]}getOwnSourceCaches(d){const $=[];return this._otherSourceCaches[d]&&$.push(this._otherSourceCaches[d]),this._symbolSourceCaches[d]&&$.push(this._symbolSourceCaches[d]),$}_isSourceCacheLoaded(d){const $=this.getOwnSourceCaches(d);return $.length===0?(this.fire(new c.y(new Error(`There is no source with ID '${d}'`))),!1):$.every(st=>st.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(d,$){if(!this._clipLayerPresent&&d.type!=="fill-extrusion"&&d.type!=="building")return!1;const st=d.type==="fill-extrusion"&&(d.sourceLayer==="building"||d.sourceLayer==="procedural_buildings"),lt=d.type==="building";if(d.is3D(!!this.terrain)){if(st||lt||$&&$.type==="batched-model"||d.type==="model")return!0}else if(d.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(d=>{d.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}cp.getSourceType=function(it){return kp[it]},cp.setSourceType=function(it,d){kp[it]=d},cp.registerForPluginStateChange=c.dA;class cw extends c.E{constructor(d){super(),this._style=d,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},c.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(d){d===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=d,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(d){this._activeFloorsVisible=d,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(d){for(const[$,st]of Object.entries(d.buildings))if(this._buildings[$])for(const lt of st.floorIds)this._buildings[$].floors[lt]||(this._buildings[$].floors[lt]=st.floors[lt]);else this._buildings[$]=st;for(const $ of d.activeFloors)this._activeFloors.add($);this._updateIndoorSelector()}getIndoorTileOptions(d,$){const st=this._style.getIndoorSourceLayers(d,$);return st&&this._indoorState?{sourceLayers:st,indoorState:this._indoorState}:null}_updateUI(d,$,st){const lt=function(ht,dt,mt,Tt){let Pt=null,Mt=Number.MAX_SAFE_INTEGER;if(Tt<16)return null;for(const[Ht,$t]of Object.entries(ht)){const qt=$t.center;if(qt){const Qt=dt.distanceTo(c.aT.convert(qt));Qt<Mt&&mt.contains(qt)&&(Mt=Qt,Pt=Ht)}}return Pt}(this._buildings,$,st,d);lt!==this._closestBuildingId&&(this._closestBuildingId=lt,this._updateIndoorSelector())}_updateIndoorSelector(){const d=this._buildings,$=this._closestBuildingId,st=$&&d?d[$]:void 0;if(!st)return void this.fire(new c.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let lt=null;for(const dt of st.floorIds)if(this._activeFloors&&this._activeFloors.has(dt)){lt=dt;break}const ht=Array.from(st.floorIds).map(dt=>({id:dt,name:st.floors[dt].name,zIndex:st.floors[dt].zIndex})).sort((dt,mt)=>mt.zIndex-dt.zIndex);this.fire(new c.z("selector-update",{selectedFloorId:lt,activeFloorsVisible:this._activeFloorsVisible,floors:ht}))}_updateActiveFloors(){const d=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:d,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var S0=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,C0=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,fv=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Sy="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Wu=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,Cy=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Mn=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,mv=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Ay=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Ry=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,gv=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const w_=/#include\s+"([^"]+)"/g,Fp=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,_v=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,e0=new Set(["ifdef","ifndef","elif","if","defined"]),t0=new Set;Pm(S0,t0),Pm(fv,t0),Pm(C0,t0);const Im={"_prelude_fog.vertex.glsl":Cy,"_prelude_terrain.vertex.glsl":Wu,"_prelude_shadow.vertex.glsl":Ry,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Mn,"_prelude_shadow.fragment.glsl":gv,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":mv,"_prelude_raster_particle.glsl":Ay},Iy={};Zs("",Wu),Zs(Mn,Cy),Zs(gv,Ry),Zs(mv,""),Zs(Ay,"");const uw=Zs(C0,fv),Py=S0,rT=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",Py,uw.fragmentSource].join(`
`),hw=["precision highp float;",Py,uw.vertexSource].join(`
`);var yv={background:Zs(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Zs(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Zs(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:Zs(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Zs(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Zs(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Zs("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Zs(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Zs(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Zs("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Zs("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Zs("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Zs(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Zs(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Zs(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Zs(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Zs(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Zs(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Zs(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Zs(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Zs(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Zs(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Zs(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Zs(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Zs(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Zs(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Zs(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Zs(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Zs(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Zs(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Zs("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Zs("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Zs(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Zs(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Zs(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Zs("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Zs(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Sy),skyboxGradient:Zs(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Sy),skyboxCapture:Zs(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Zs(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Zs(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Zs(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Zs(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Zs(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Zs("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Zs("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Zs("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Zs("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Pm(it,d){const $=it.split(`
`);for(let st of $){if(st=st.trimStart(),st[0]!=="#"||!st.includes("if")||st.startsWith("#endif"))continue;const lt=st.match(_v);if(lt)for(const ht of lt)e0.has(ht)||d.add(ht)}}function Zs(it,d){const $=new Set,st=[],lt=[];it=it.replace(w_,(dt,mt)=>(lt.push(mt),"")),d=d.replace(w_,(dt,mt)=>(st.push(mt),""));let ht=new Set(t0);Pm(it,ht),Pm(d,ht);for(const dt of[...st,...lt])Iy[dt]||(Iy[dt]=new Set,Pm(Im[dt],Iy[dt])),ht=new Set([...ht,...Iy[dt]]);return{fragmentSource:it=it.replace(Fp,(dt,mt,Tt,Pt,Mt)=>($.add(Mt),mt==="define"?`
#ifndef HAS_UNIFORM_u_${Mt}
in ${Tt} ${Pt} ${Mt};
#else
uniform ${Tt} ${Pt} u_${Mt};
#endif
`:mt==="initialize"?`
#ifdef HAS_UNIFORM_u_${Mt}
    ${Tt} ${Pt} ${Mt} = u_${Mt};
#endif
`:mt==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Mt}
    in ${Tt} ${Pt} ${Mt};
#endif
`:mt==="initialize-attribute"?"":void 0)),vertexSource:d=d.replace(Fp,(dt,mt,Tt,Pt,Mt)=>{const Ht=`MATERIAL_ATTRIBUTE_OFFSET_${Mt}`,$t=Pt==="float"?"vec2":Pt,qt=`GET_ATTRIBUTE_${$t}(a_${Mt}, materialInfo, ${Ht})`,Qt=Mt.match(/color/)?"color":$t;return mt==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Mt}
in ${Tt} ${Pt} a_${Mt};
#endif
`:$.has(Mt)?mt==="define"?`
#ifndef HAS_UNIFORM_u_${Mt}
uniform lowp float u_${Mt}_t;
    #if !defined(${Ht})
        in ${Tt} ${$t} a_${Mt};
    #endif
out ${Tt} ${Pt} ${Mt};
#else
uniform ${Tt} ${Pt} u_${Mt};
#endif
`:mt==="initialize"?Qt==="vec4"?`
#ifndef HAS_UNIFORM_u_${Mt}
    ${Mt} = a_${Mt};
#else
    ${Tt} ${Pt} ${Mt} = u_${Mt};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${Mt})
    #ifdef ${Ht}
        ${Mt} = unpack_mix_${Qt}(${qt}, u_${Mt}_t);
    #else
        ${Mt} = unpack_mix_${Qt}(a_${Mt}, u_${Mt}_t);
    #endif
#else
    ${Tt} ${Pt} ${Mt} = u_${Mt};
#endif
`:mt==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Mt}
    in ${Tt} ${Pt} a_${Mt};
    out ${Tt} ${Pt} ${Mt};
#endif
`:mt==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Mt}
    ${Mt} = a_${Mt};
#endif
`:void 0:mt==="define"?`
#ifndef HAS_UNIFORM_u_${Mt}
uniform lowp float u_${Mt}_t;
    #if !defined(${Ht})
        in ${Tt} ${$t} a_${Mt};
    #endif
#else
uniform ${Tt} ${Pt} u_${Mt};
#endif
`:mt==="define-instanced"?Qt==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Mt}0;
in vec4 a_${Mt}1;
in vec4 a_${Mt}2;
in vec4 a_${Mt}3;
#else
uniform ${Tt} ${Pt} u_${Mt};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${Tt} ${$t} a_${Mt};
#else
uniform ${Tt} ${Pt} u_${Mt};
#endif
`:mt==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Mt}
    ${Tt} ${Pt} ${Mt} = a_${Mt};
#endif
`:Qt==="vec4"?`
#ifndef HAS_UNIFORM_u_${Mt}
    #ifdef ${Ht}
        ${Tt} ${Pt} ${Mt} = ${qt};
    #else
        ${Tt} ${Pt} ${Mt} = a_${Mt};
    #endif
#else
    ${Tt} ${Pt} ${Mt} = u_${Mt};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Mt}
    #ifdef ${Ht}
        ${Tt} ${Pt} ${Mt} = unpack_mix_${Qt}(${qt}, u_${Mt}_t);
    #else
        ${Tt} ${Pt} ${Mt} = unpack_mix_${Qt}(a_${Mt}, u_${Mt}_t);
    #endif
#else
    ${Tt} ${Pt} ${Mt} = u_${Mt};
#endif
`}),usedDefines:ht,vertexIncludes:st,fragmentIncludes:lt}}class iT{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(d,$,st,lt,ht,dt,mt,Tt){this.context=d;let Pt=this.boundPaintVertexBuffers.length!==lt.length;for(let Ht=0;!Pt&&Ht<lt.length;Ht++)this.boundPaintVertexBuffers[Ht]!==lt[Ht]&&(Pt=!0);let Mt=this.boundDynamicVertexBuffers.length!==mt.length;for(let Ht=0;!Mt&&Ht<mt.length;Ht++)this.boundDynamicVertexBuffers[Ht]!==mt[Ht]&&(Mt=!0);if(!this.vao||this.boundProgram!==$||this.boundLayoutVertexBuffer!==st||Pt||Mt||this.boundIndexBuffer!==ht||this.boundVertexOffset!==dt)this.freshBind($,st,lt,ht,dt,mt,Tt);else{d.bindVertexArrayOES.set(this.vao);for(const Ht of mt)Ht&&(Ht.bind(),Tt&&Ht.instanceCount&&Ht.setVertexAttribDivisor(d.gl,$,Tt));ht&&ht.dynamicDraw&&ht.bind()}}freshBind(d,$,st,lt,ht,dt,mt){const Tt=this.context,Pt=Tt.gl;this.vao&&this.destroy(),this.vao=Tt.gl.createVertexArray(),Tt.bindVertexArrayOES.set(this.vao),this.boundProgram=d,this.boundLayoutVertexBuffer=$,this.boundPaintVertexBuffers=st,this.boundIndexBuffer=lt,this.boundVertexOffset=ht,this.boundDynamicVertexBuffers=dt,$.enableAttributes(Pt,d),$.bind(),$.setVertexAttribPointers(Pt,d,ht);for(const Mt of st)Mt.enableAttributes(Pt,d),Mt.bind(),Mt.setVertexAttribPointers(Pt,d,ht);for(const Mt of dt)Mt&&(Mt.enableAttributes(Pt,d),Mt.bind(),Mt.setVertexAttribPointers(Pt,d,ht),mt&&Mt.instanceCount&&Mt.setVertexAttribDivisor(Pt,d,mt));lt&&lt.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function nT(it,d){const $=Math.pow(2,d.canonical.z),st=d.canonical.y;return[new c.ae(0,st/$).toLngLat().lat,new c.ae(0,(st+1)/$).toLngLat().lat]}function sT(it,d,$,st,lt,ht,dt){const mt=it.context,Tt=mt.gl,Pt=$.hillshadeFBO;if(!Pt)return;it.prepareDrawTile();const Mt=it.isTileAffectedByFog(d),Ht=[];it.terrain&&it.terrain.renderingToTexture&&it.emissiveMode==="mrt-fallback"&&Ht.push("USE_MRT1");const $t=it.getOrCreateProgram("hillshade",{overrideFog:Mt,defines:Ht});mt.activeTexture.set(Tt.TEXTURE0),Tt.bindTexture(Tt.TEXTURE_2D,Pt.colorAttachment0.get());const qt=((ir,hr,mr,dr)=>{const Ir=mr.paint.get("hillshade-shadow-color"),Tr=mr.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ar=mr.paint.get("hillshade-highlight-color"),Er=mr.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",vr=mr.paint.get("hillshade-accent-color"),Pr=mr.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Br=mr.paint.get("hillshade-emissive-strength");let Or=c.an(mr.paint.get("hillshade-illumination-direction"));if(mr.paint.get("hillshade-illumination-anchor")==="viewport")Or-=ir.transform.angle;else if(ir.style&&ir.style.enable3dLights()&&ir.style.directionalLight){const Qr=ir.style.directionalLight.properties.get("direction"),un=c.d4(Qr.x,Qr.y,Qr.z);Or=c.an(un[1])}const Yr=!ir.options.moving;return{u_matrix:dr||ir.transform.calculateProjMatrix(hr.tileID.toUnwrapped(),Yr),u_image:0,u_latrange:nT(0,hr.tileID),u_light:[mr.paint.get("hillshade-exaggeration"),Or],u_shadow:Ir.toPremultipliedRenderColor(Tr?null:mr.lut),u_highlight:Ar.toPremultipliedRenderColor(Er?null:mr.lut),u_emissive_strength:Br,u_accent:vr.toPremultipliedRenderColor(Pr?null:mr.lut)}})(it,$,st,it.terrain?d.projMatrix:null);it.uploadCommonUniforms(mt,$t,d.toUnwrapped());const{tileBoundsBuffer:Qt,tileBoundsIndexBuffer:Xt,tileBoundsSegments:sr}=it.getTileBoundsBuffers($);$t.draw(it,Tt.TRIANGLES,lt,ht,dt,gs.disabled,qt,st.id,Qt,Xt,sr)}function xv(it,d,$){if(!d.needsDEMTextureUpload)return;const st=it.context,lt=st.gl;st.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||it.getTileTexture($.stride);const ht=$.getPixels();d.demTexture?d.demTexture.update(ht,{premultiply:!1}):d.demTexture=new c.T(st,ht,lt.R32F,{premultiply:!1}),d.needsDEMTextureUpload=!1}function oT(it,d,$){const st=it.context,lt=st.gl;if(!d.dem)return;const ht=d.dem;if(st.activeTexture.set(lt.TEXTURE1),xv(it,d,ht),!d.demTexture)return;d.demTexture.bind(lt.NEAREST,lt.CLAMP_TO_EDGE);const dt=ht.dim;st.activeTexture.set(lt.TEXTURE0);let mt=d.hillshadeFBO;if(!mt){const $t=new c.T(st,{width:dt,height:dt,data:null},lt.RGBA8);$t.bind(lt.LINEAR,lt.CLAMP_TO_EDGE),mt=d.hillshadeFBO=st.createFramebuffer(dt,dt,1,"renderbuffer"),mt.colorAttachment0.set($t.texture)}st.bindFramebuffer.set(mt.framebuffer),st.viewport.set([0,0,dt,dt]);const{tileBoundsBuffer:Tt,tileBoundsIndexBuffer:Pt,tileBoundsSegments:Mt}=it.getMercatorTileBoundsBuffers(),Ht=[];it.linearFloatFilteringSupported()&&Ht.push("TERRAIN_DEM_FLOAT_FORMAT"),it.terrain&&it.terrain.renderingToTexture&&it.emissiveMode==="mrt-fallback"&&Ht.push("USE_MRT1"),it.getOrCreateProgram("hillshadePrepare",{defines:Ht}).draw(it,lt.TRIANGLES,es.disabled,_s.disabled,Ps.unblended,gs.disabled,(($t,qt)=>{const Qt=qt.stride,Xt=c.bC();return c.ce(Xt,0,c.al,-c.al,0,0,1),c.br(Xt,Xt,[0,-c.al,0]),{u_matrix:Xt,u_image:1,u_dimension:[Qt,Qt],u_zoom:$t.overscaledZ}})(d.tileID,ht),$.id,Tt,Pt,Mt),d.needsHillshadePrepare=!1}class Uo{constructor(d){this.gl=d.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(d){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class aT extends Uo{getDefault(){return c.ao.transparent.toNonPremultipliedRenderColor(null)}set(d){const $=this.current;(d.r!==$.r||d.g!==$.g||d.b!==$.b||d.a!==$.a||this.dirty)&&(this.gl.clearColor(d.r,d.g,d.b,d.a),this.current=d,this.dirty=!1)}}class dw extends Uo{getDefault(){return 1}set(d){(d!==this.current||this.dirty)&&(this.gl.clearDepth(d),this.current=d,this.dirty=!1)}}class vv extends Uo{getDefault(){return 0}set(d){(d!==this.current||this.dirty)&&(this.gl.clearStencil(d),this.current=d,this.dirty=!1)}}class ky extends Uo{getDefault(){return[!0,!0,!0,!0]}set(d){const $=this.current;(d[0]!==$[0]||d[1]!==$[1]||d[2]!==$[2]||d[3]!==$[3]||this.dirty)&&(this.gl.colorMask(d[0],d[1],d[2],d[3]),this.current=d,this.dirty=!1)}}class bv extends Uo{getDefault(){return!0}set(d){(d!==this.current||this.dirty)&&(this.gl.depthMask(d),this.current=d,this.dirty=!1)}}class r0 extends Uo{getDefault(){return 255}set(d){(d!==this.current||this.dirty)&&(this.gl.stencilMask(d),this.current=d,this.dirty=!1)}}class A0 extends Uo{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(d){const $=this.current;(d.func!==$.func||d.ref!==$.ref||d.mask!==$.mask||this.dirty)&&(this.gl.stencilFunc(d.func,d.ref,d.mask),this.current=d,this.dirty=!1)}}class E_ extends Uo{getDefault(){const d=this.gl;return[d.KEEP,d.KEEP,d.KEEP]}set(d){const $=this.current;(d[0]!==$[0]||d[1]!==$[1]||d[2]!==$[2]||this.dirty)&&(this.gl.stencilOp(d[0],d[1],d[2]),this.current=d,this.dirty=!1)}}class R0 extends Uo{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;d?$.enable($.STENCIL_TEST):$.disable($.STENCIL_TEST),this.current=d,this.dirty=!1}}class pw extends Uo{getDefault(){return[0,1]}set(d){const $=this.current;(d[0]!==$[0]||d[1]!==$[1]||this.dirty)&&(this.gl.depthRange(d[0],d[1]),this.current=d,this.dirty=!1)}}class wv extends Uo{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;d?$.enable($.DEPTH_TEST):$.disable($.DEPTH_TEST),this.current=d,this.dirty=!1}}class fw extends Uo{getDefault(){return this.gl.LESS}set(d){(d!==this.current||this.dirty)&&(this.gl.depthFunc(d),this.current=d,this.dirty=!1)}}class I0 extends Uo{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;d?$.enable($.BLEND):$.disable($.BLEND),this.current=d,this.dirty=!1}}class My extends Uo{getDefault(){const d=this.gl;return[d.ONE,d.ZERO,d.ONE,d.ZERO]}set(d){const $=this.current;(d[0]!==$[0]||d[1]!==$[1]||d[2]!==$[2]||d[3]!==$[3]||this.dirty)&&(this.gl.blendFuncSeparate(d[0],d[1],d[2],d[3]),this.current=d,this.dirty=!1)}}class Dy extends Uo{getDefault(){return c.ao.transparent.toNonPremultipliedRenderColor(null)}set(d){const $=this.current;(d.r!==$.r||d.g!==$.g||d.b!==$.b||d.a!==$.a||this.dirty)&&(this.gl.blendColor(d.r,d.g,d.b,d.a),this.current=d,this.dirty=!1)}}class Ev extends Uo{getDefault(){return this.gl.FUNC_ADD}set(d){(d!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(d,d),this.current=d,this.dirty=!1)}}class Ny extends Uo{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;d?$.enable($.CULL_FACE):$.disable($.CULL_FACE),this.current=d,this.dirty=!1}}class T_ extends Uo{getDefault(){return this.gl.BACK}set(d){(d!==this.current||this.dirty)&&(this.gl.cullFace(d),this.current=d,this.dirty=!1)}}class mw extends Uo{getDefault(){return this.gl.CCW}set(d){(d!==this.current||this.dirty)&&(this.gl.frontFace(d),this.current=d,this.dirty=!1)}}let gw=class extends Uo{getDefault(){return null}set(it){(it!==this.current||this.dirty)&&(this.gl.useProgram(it),this.current=it,this.dirty=!1)}};class _w extends Uo{getDefault(){return this.gl.TEXTURE0}set(d){(d!==this.current||this.dirty)&&(this.gl.activeTexture(d),this.current=d,this.dirty=!1)}}class P0 extends Uo{getDefault(){const d=this.gl;return[0,0,d.drawingBufferWidth,d.drawingBufferHeight]}set(d){const $=this.current;(d[0]!==$[0]||d[1]!==$[1]||d[2]!==$[2]||d[3]!==$[3]||this.dirty)&&(this.gl.viewport(d[0],d[1],d[2],d[3]),this.current=d,this.dirty=!1)}}class yw extends Uo{getDefault(){return null}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;$.bindFramebuffer($.FRAMEBUFFER,d),this.current=d,this.dirty=!1}}class lT extends Uo{getDefault(){return null}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;$.bindRenderbuffer($.RENDERBUFFER,d),this.current=d,this.dirty=!1}}class cT extends Uo{getDefault(){return null}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;$.bindTexture($.TEXTURE_2D,d),this.current=d,this.dirty=!1}}class uT extends Uo{getDefault(){return null}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;$.bindBuffer($.ARRAY_BUFFER,d),this.current=d,this.dirty=!1}}class Tv extends Uo{getDefault(){return null}set(d){const $=this.gl;$.bindBuffer($.ELEMENT_ARRAY_BUFFER,d),this.current=d,this.dirty=!1}}class Sv extends Uo{getDefault(){return null}set(d){this.gl&&(d!==this.current||this.dirty)&&(this.gl.bindVertexArray(d),this.current=d,this.dirty=!1)}}class Cv extends Uo{getDefault(){return 4}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;$.pixelStorei($.UNPACK_ALIGNMENT,d),this.current=d,this.dirty=!1}}class Av extends Uo{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;$.pixelStorei($.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d),this.current=d,this.dirty=!1}}class xw extends Uo{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;$.pixelStorei($.UNPACK_FLIP_Y_WEBGL,d),this.current=d,this.dirty=!1}}class Ly extends Uo{constructor(d,$){super(d),this.context=d,this.parent=$}getDefault(){return null}}class Oy extends Ly{constructor(d,$,st=0){super(d,$),this.attachmentPoint=d.gl.COLOR_ATTACHMENT0+st}setDirty(){this.dirty=!0}set(d){if(d===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const $=this.gl;$.framebufferTexture2D($.FRAMEBUFFER,this.attachmentPoint,$.TEXTURE_2D,d,0),this.current=d,this.dirty=!1}}class k0 extends Ly{attachment(){return this.gl.DEPTH_ATTACHMENT}set(d){if(d===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const $=this.gl;$.framebufferRenderbuffer($.FRAMEBUFFER,this.attachment(),$.RENDERBUFFER,d),this.current=d,this.dirty=!1}}class S_ extends Ly{attachment(){return this.gl.DEPTH_ATTACHMENT}set(d){if(d===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const $=this.gl;$.framebufferTexture2D($.FRAMEBUFFER,this.attachment(),$.TEXTURE_2D,d,0),this.current=d,this.dirty=!1}}class bw extends k0{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const qu=(it,d,$,st)=>({u_matrix:it,u_image0:0,u_image1:1,u_skirt_height:d,u_ground_shadow_factor:$,u_emissive_texture_available:st}),jy=(it,d,$,st,lt,ht,dt,mt,Tt,Pt,Mt,Ht,$t,qt,Qt,Xt,sr)=>({u_proj_matrix:Float32Array.from(it),u_globe_matrix:d,u_normalize_matrix:Float32Array.from(st),u_merc_matrix:$,u_zoom_transition:lt,u_merc_center:ht,u_image0:0,u_image1:1,u_frustum_tl:dt,u_frustum_tr:mt,u_frustum_br:Tt,u_frustum_bl:Pt,u_globe_pos:Mt,u_globe_radius:Ht,u_viewport:$t,u_grid_matrix:sr?Float32Array.from(sr):new Float32Array(9),u_skirt_height:qt,u_far_z_cutoff:Qt,u_emissive_texture_available:Xt});function C_(it,d){return it!=null&&d!=null&&!(!it.hasData()||!d.hasData())&&it.demTexture!=null&&d.demTexture!=null&&it.tileID.key!==d.tileID.key}const Jp=new class{constructor(){this.operations={}}newMorphing(it,d,$,st,lt){if(it in this.operations){const ht=this.operations[it];ht.to.tileID.key!==$.tileID.key&&(ht.queued=$)}else this.operations[it]={startTime:st,phase:0,duration:lt,from:d,to:$,queued:null}}getMorphValuesForProxy(it){if(!(it in this.operations))return null;const d=this.operations[it];return{from:d.from,to:d.to,phase:d.phase}}update(it){for(const d in this.operations){const $=this.operations[d];for($.phase=(it-$.startTime)/$.duration;$.phase>=1||!this._validOp($);)if(!this._nextOp($,it)){delete this.operations[d];break}}}_nextOp(it,d){return!!it.queued&&(it.from=it.to,it.to=it.queued,it.queued=null,it.phase=0,it.startTime=d,!0)}_validOp(it){return it.from.hasData()&&it.to.hasData()}},Fy={0:null,1:"TERRAIN_VERTEX_MORPHING"};function By(it,d,$){if(d===0)return 0;const st=d<1&&$===514?.25/d:1;return 6*Math.pow(1.5,22-it)*Math.max(d,1)*st}function Rv(it,d){const $=1<<it.z;return!d&&(it.x===0||it.x===$-1)||it.y===0||it.y===$-1}function M0(it,d){if(!it.style||!it.style.enable3dLights())return;const $=it.context,st=$.gl;$.activeTexture.set(st.TEXTURE1),d?d.bind(st.LINEAR,st.CLAMP_TO_EDGE):it.emptyTexture.bind(st.LINEAR,st.CLAMP_TO_EDGE)}const A_=it=>({u_matrix:it});function R_(it,d,$,st,lt){if(lt>0){const ht=c.o.now(),dt=(ht-it.timeAdded)/lt,mt=d?(ht-d.timeAdded)/lt:-1,Tt=$.getSource(),Pt=st.coveringZoomLevel({tileSize:Tt.tileSize,roundZoom:Tt.roundZoom}),Mt=!d||Math.abs(d.tileID.overscaledZ-Pt)>Math.abs(it.tileID.overscaledZ-Pt),Ht=Mt&&it.refreshedUponExpiration?1:c.aA(Mt?dt:1-mt,0,1);return d?{opacity:1,mix:1-Ht,isFading:dt<1}:{opacity:Ht,mix:0,isFading:dt<1}}return{opacity:1,mix:0,isFading:!1}}class zy extends zu{constructor(d){const $=Xl("mock-dem",{type:"raster-dem",maxzoom:d.transform.maxZoom},d.style.dispatcher,d.style);super("mock-dem",$,!1),$.setEventedParent(this),this._sourceLoaded=!0}_loadTile(d,$){d.state="loaded",$(null)}}class Iv extends zu{constructor(d){const $=Xl("proxy",{type:"geojson",maxzoom:d.transform.maxZoom},d.style.dispatcher,d.style);super("proxy",$,!1),$.setEventedParent(this),this.map=this.getSource().map=d,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(d,$,st){if(d.freezeTileCoverage)return;this.transform=d;const lt=d.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((ht,dt)=>{if(ht[dt.key]="",!this._tiles[dt.key]){const mt=new Ym(dt,this._source.tileSize*dt.overscaleFactor(),d.tileZoom,void 0,void 0,this._source.worldview);mt.state="loaded",this._tiles[dt.key]=mt}return ht},{});for(const ht in this._tiles)ht in lt||(this.freeFBO(ht),this._tiles[ht].unloadVectorData(),delete this._tiles[ht])}freeFBO(d){const $=this.proxyCachedFBO[d];if($!==void 0){const st=Object.values($);this.renderCachePool.push(...st),delete this.proxyCachedFBO[d]}}deallocRenderCache(){this.renderCache.forEach(d=>d.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Pv extends c.aQ{constructor(d,$,st){super(d.overscaledZ,d.wrap,d.canonical.z,d.canonical.x,d.canonical.y),this.proxyTileKey=$,this.projMatrix=st}}class kv extends c.bV{constructor(d,$){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=d,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[st,lt,ht]=function(Tt){const Pt=new c.bd,Mt=new c.b0,Ht=131;Pt.reserve(17161),Mt.reserve(33800);const $t=c.al/128,qt=c.al+$t/2,Qt=qt+$t;for(let sr=-$t;sr<Qt;sr+=$t)for(let ir=-$t;ir<Qt;ir+=$t){const hr=ir<0||ir>qt||sr<0||sr>qt?24575:0,mr=c.aA(Math.round(ir),0,c.al),dr=c.aA(Math.round(sr),0,c.al);Pt.emplaceBack(mr+hr,dr)}const Xt=(sr,ir)=>{const hr=ir*Ht+sr;Mt.emplaceBack(hr+1,hr,hr+Ht),Mt.emplaceBack(hr+Ht,hr+Ht+1,hr+1)};for(let sr=1;sr<129;sr++)for(let ir=1;ir<129;ir++)Xt(ir,sr);return[0,129].forEach(sr=>{for(let ir=0;ir<130;ir++)Xt(ir,sr),Xt(sr,ir)}),[Pt,Mt,32768]}(),dt=d.context;this.gridBuffer=dt.createVertexBuffer(st,c.bf.members),this.gridIndexBuffer=dt.createIndexBuffer(lt),this.gridSegments=c.bg.simpleSegment(0,0,st.length,lt.length),this.gridNoSkirtSegments=c.bg.simpleSegment(0,0,st.length,ht),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Iv($.map),this.orthoMatrix=c.bC(),c.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,c.al,0,c.al,0,1);const mt=dt.gl;this._overlapStencilMode=new _s({func:mt.GEQUAL,mask:255},0,255,mt.KEEP,mt.KEEP,mt.REPLACE),this._previousZoom=d.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=$,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new zy($.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(d){d.on("data",this._onStyleDataEvent.bind(this)),this._style=d,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(d,$,st){if(d&&d.terrain){this._style!==d&&(this.style=d,this._evaluationZoom=void 0);const lt=d.terrain.properties,ht=d.terrain.drapeRenderMode===0,dt=d.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=c.o.now();const mt=d.terrain&&d.terrain.scope,Tt=lt.get("source"),Pt=ht?this._mockSourceCache:d.getSourceCache(Tt,mt);if(!Pt)return void c.w(`Couldn't find terrain source "${Tt}".`);if(this.sourceCache=Pt,this._attenuationRange=d.terrain.getAttenuationRange(),this._exaggeration=dt?this.calculateExaggeration($):lt.get("exaggeration"),!$.projection.requiresDraping&&dt&&this._exaggeration===0)return void this._disable();this.enabled=!0;const Mt=()=>{this.sourceCache.used&&c.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Ht=this.getScaledDemTileSize();this.sourceCache.update($,Ht,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,Mt(),this._initializing=!0),Mt(),$.updateElevation(!0,st),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update($),this._emptyDEMTextureDirty=!0,this._previousZoom=$.zoom}else this._disable()}calculateExaggeration(d){if(this._attenuationRange&&d.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(d.zoom);const $=this._previousCameraAltitude,st=d.getFreeCameraOptions().position.z/d.pixelsPerMeter*d.worldSize;this._previousCameraAltitude=st;const lt=$!=null?st-$:Number.MAX_VALUE;if(Math.abs(lt)<2)return this._exaggeration;const ht=d.zoom,dt=this._style.terrain;if(!this._previousUpdateTimestamp)return dt.getExaggeration(ht);let mt=ht-this._previousZoom;const Tt=this._previousUpdateTimestamp;let Pt=ht;this._evaluationZoom!=null&&(Pt=this._evaluationZoom,Math.abs(ht-Pt)>.5&&(mt=.5*(ht-Pt+mt)),mt*lt<0&&(Pt+=mt)),this._evaluationZoom=Pt;const Mt=dt.getExaggeration(Pt),Ht=Mt===dt.getExaggeration(Math.max(0,Pt-.1));if(Ht&&Math.abs(Mt-this._exaggeration)<.01)return Mt;let $t=Math.min(.1,.00375*(this._updateTimestamp-Tt));return(Ht||Mt<.1||Math.abs(mt)<1e-4)&&($t=Math.min(.2,4*$t)),c.ak(this._exaggeration,Mt,$t)}resetTileLookupCache(d){this._findCoveringTileCache[d]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(d){d.dataType==="source"&&d.coord?this._clearRenderCacheForTile(d.sourceCacheId,d.coord):d.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const d in this._style._mergedSourceCaches)this._style._mergedSourceCaches[d].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(d=>d.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const d=2*this.proxySourceCache.getSource().tileSize;return[d,d]}set useVertexMorphing(d){this._useVertexMorphing=d}updateTileBinding(d){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const $=this.proxySourceCache,st=this.painter.transform;this._initializing&&(this._initializing=st._centerAltitude===0&&this.getAtPointOrZero(c.ae.fromLngLat(st.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const lt=this.proxyCoords=$.getIds().map(Tt=>{const Pt=$.getTileByID(Tt).tileID;return Pt.projMatrix=st.calculateProjMatrix(Pt.toUnwrapped()),Pt});(function(Tt,Pt){const Mt=Pt.transform.pointCoordinate(Pt.transform.getCameraPoint()),Ht=new c.P(Mt.x,Mt.y);Tt.sort(($t,qt)=>{if(qt.overscaledZ-$t.overscaledZ)return qt.overscaledZ-$t.overscaledZ;const Qt=new c.P($t.canonical.x+(1<<$t.canonical.z)*$t.wrap,$t.canonical.y),Xt=new c.P(qt.canonical.x+(1<<qt.canonical.z)*qt.wrap,qt.canonical.y),sr=Ht.mult(1<<$t.canonical.z);return sr.x-=.5,sr.y-=.5,sr.distSqr(Qt)-sr.distSqr(Xt)})})(lt,this.painter);const ht=this.proxyToSource||{};this.proxyToSource={},lt.forEach(Tt=>{this.proxyToSource[Tt.key]={}}),this.terrainTileForTile={};const dt=this._style._mergedSourceCaches;for(const Tt in dt){const Pt=dt[Tt];if(!Pt.used||(Pt!==this.sourceCache&&this.resetTileLookupCache(Pt.id),this._setupProxiedCoordsForOrtho(Pt,d[Tt],ht),Pt.usedForTerrain))continue;const Mt=d[Tt];Pt.getSource().reparseOverscaled&&this._assignTerrainTiles(Mt)}this.proxiedCoords[$.id]=lt.map(Tt=>new Pv(Tt,Tt.key,this.orthoMatrix)),this._assignTerrainTiles(lt),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(ht),this.renderingToTexture=!1;const mt={};this._visibleDemTiles=[];for(const Tt of this.proxyCoords){const Pt=this.terrainTileForTile[Tt.key];if(!Pt)continue;const Mt=Pt.tileID.key;Mt in mt||(this._visibleDemTiles.push(Pt),mt[Mt]=Mt)}}_assignTerrainTiles(d){this._initializing||d.forEach($=>{if(this.terrainTileForTile[$.key])return;const st=this._findTileCoveringTileID($,this.sourceCache);st&&(this.terrainTileForTile[$.key]=st)})}_prepareDEMTextures(){const d=this.painter.context,$=d.gl;for(const st in this.terrainTileForTile){const lt=this.terrainTileForTile[st],ht=lt.dem;!ht||lt.demTexture&&!lt.needsDEMTextureUpload||(d.activeTexture.set($.TEXTURE1),xv(this.painter,lt,ht))}}_prepareDemTileUniforms(d,$,st,lt){if(!$||$.demTexture==null)return!1;const ht=d.tileID.canonical,dt=Math.pow(2,$.tileID.canonical.z-ht.z),mt=lt||"";return st[`u_dem_tl${mt}`]=[ht.x*dt%1,ht.y*dt%1],st[`u_dem_scale${mt}`]=dt,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let d=0;const $=this._visibleDemTiles.reduce((st,lt)=>{if(!lt.dem)return st;const ht=lt.dem.tree.minimums[0];return ht>0&&d++,st+ht},0);return d?$/d:0}_updateEmptyDEMTexture(){const d=this.painter.context,$=d.gl;d.activeTexture.set($.TEXTURE2);const st=this._getLoadedAreaMinimum(),lt=new c.dL({width:1,height:1},new Float32Array([st]));this._emptyDEMTextureDirty=!1;let ht=this._emptyDEMTexture;return ht?ht.update(lt,{premultiply:!1}):ht=this._emptyDEMTexture=new c.T(d,lt,$.R32F,{premultiply:!1}),ht}setupElevationDraw(d,$,st){const lt=this.painter.context,ht=lt.gl,dt={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};dt.u_exaggeration=this.exaggeration();let mt=null,Tt=null,Pt=1;if(st&&st.morphing&&this._useVertexMorphing){const qt=st.morphing.srcDemTile,Qt=st.morphing.dstDemTile;Pt=st.morphing.phase,qt&&Qt&&(this._prepareDemTileUniforms(d,qt,dt,"_prev")&&(Tt=qt),this._prepareDemTileUniforms(d,Qt,dt)&&(mt=Qt))}const Mt=qt=>qt&&qt.demTexture&&this.painter.linearFloatFilteringSupported()?ht.LINEAR:ht.NEAREST;let Ht=null;var $t;if(this.enabled?Tt&&mt?(Ht=mt.demTexture,lt.activeTexture.set(ht.TEXTURE4),Tt.demTexture.bind(Mt(Tt),ht.CLAMP_TO_EDGE),dt.u_dem_lerp=Pt):(mt=this.terrainTileForTile[d.tileID.key],Ht=this._prepareDemTileUniforms(d,mt,dt)?mt.demTexture:this.emptyDEMTexture):Ht=this.emptyDEMTexture,lt.activeTexture.set(ht.TEXTURE2),Ht&&(dt.u_dem_size=($t=Ht).size[0]===1?1:$t.size[0]-2,Ht.bind(Mt(mt),ht.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(st&&st.useDepthForOcclusion,$,dt),st&&st.useMeterToDem&&mt){const qt=(1<<mt.tileID.canonical.z)*c.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;dt.u_meter_to_dem=qt}if(st&&st.labelPlaneMatrixInv&&(dt.u_label_plane_matrix_inv=st.labelPlaneMatrixInv),$.setTerrainUniformValues(lt,dt),this.painter.transform.projection.name==="globe"){const qt=this.globeUniformValues(this.painter.transform,d.tileID.canonical,st&&st.useDenormalizedUpVectorScale);$.setGlobeUniformValues(lt,qt)}}globeUniformValues(d,$,st){const lt=d.projection;return{u_tile_tl_up:lt.upVector($,0,0),u_tile_tr_up:lt.upVector($,c.al,0),u_tile_br_up:lt.upVector($,c.al,c.al),u_tile_bl_up:lt.upVector($,0,c.al),u_tile_up_scale:st?c.dM(1):lt.upVectorScale($,d.center.lat,d.worldSize).metersToTile}}renderToBackBuffer(d){const $=this.painter,st=this.painter.context;d.length!==0&&(st.bindFramebuffer.set(null),st.viewport.set([0,0,$.width,$.height]),$.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(lt,ht,dt,mt,Tt){if(lt.transform.projection.name==="globe")(function(Pt,Mt,Ht,$t,qt){const Qt=Pt.context,Xt=Qt.gl;let sr,ir;const hr=Pt.transform,mr=c.dE(Pt,Qt,hr),dr=(Yr,Qr)=>{if(ir===Qr)return;const un=[Fy[Qr],"PROJECTION_GLOBE_VIEW"];mr&&un.push("CUSTOM_ANTIALIASING");const Cn=Pt.isTileAffectedByFog(Yr);sr=Pt.getOrCreateProgram("globeRaster",{defines:un,overrideFog:Cn}),ir=Qr},Ir=Pt.colorModeForRenderPass(),Tr=new es(Xt.LEQUAL,es.ReadWrite,Pt.depthRangeFor3D);Jp.update(qt);const Ar=c.dF(hr),Er=[c.aF(hr.center.lng),c.aJ(hr.center.lat)],vr=Pt.globeSharedBuffers,Pr=[hr.width*c.o.devicePixelRatio,hr.height*c.o.devicePixelRatio],Br=Float32Array.from(hr.globeMatrix),Or={useDenormalizedUpVectorScale:!0};{const Yr=Pt.transform,Qr=By(Yr.zoom,Mt.exaggeration(),Mt.sourceCache._source.tileSize);ir=-1;const un=Xt.TRIANGLES;for(const Cn of $t){const qr=Ht.getTile(Cn),Nr=_s.disabled,tn=Mt.prevTerrainTileForTile[Cn.key],Kr=Mt.terrainTileForTile[Cn.key];C_(tn,Kr)&&Jp.newMorphing(Cn.key,tn,Kr,qt,250),M0(Pt,qr.emissiveTexture),Qt.activeTexture.set(Xt.TEXTURE0),qr.texture&&qr.texture.bind(Xt.LINEAR,Xt.CLAMP_TO_EDGE);const yn=Jp.getMorphValuesForProxy(Cn.key),Ln=yn?1:0;yn&&Object.assign(Or,{morphing:{srcDemTile:yn.from,dstDemTile:yn.to,phase:c.dD(yn.phase)}});const Un=c.dG(Cn.canonical),kn=c.dH(Un.getCenter().lat),An=c.dI(Cn.canonical,Un,kn,Yr.worldSize/Yr._pixelsPerMercatorPixel),Qn=c.bk(c.dJ(Cn.canonical)),Kn=Pt.emissiveMode==="mrt-fallback"?1:0,zn=jy(Yr.expandedFarZProjMatrix,Br,Ar,Qn,c.aj(Yr.zoom),Er,Yr.frustumCorners.TL,Yr.frustumCorners.TR,Yr.frustumCorners.BR,Yr.frustumCorners.BL,Yr.globeCenterInViewSpace,Yr.globeRadius,Pr,Qr,Yr._farZ,Kn,An);if(dr(Cn,Ln),sr&&(Mt.setupElevationDraw(qr,sr,Or),Pt.uploadCommonUniforms(Qt,sr,Cn.toUnwrapped()),vr)){const[Gn,as,Es]=vr.getGridBuffers(kn,Qr!==0);sr.draw(Pt,un,Tr,Nr,Ir,gs.backCCW,zn,"globe_raster",Gn,as,Es)}}}if(vr&&(Pt.renderDefaultNorthPole||Pt.renderDefaultSouthPole)){const Yr=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];mr&&Yr.push("CUSTOM_ANTIALIASING"),sr=Pt.getOrCreateProgram("globeRaster",{defines:Yr});for(const Qr of $t){const{x:un,y:Cn,z:qr}=Qr.canonical,Nr=Cn===0,tn=Cn===(1<<qr)-1,[Kr,yn,Ln,Un]=vr.getPoleBuffers(qr,!1);if(Un&&(Nr||tn)){const kn=Ht.getTile(Qr);M0(Pt,kn.emissiveTexture),Qt.activeTexture.set(Xt.TEXTURE0),kn.texture&&kn.texture.bind(Xt.LINEAR,Xt.CLAMP_TO_EDGE);let An=c.dK(qr,un,hr);const Qn=c.bk(c.dJ(Qr.canonical)),Kn=Pt.emissiveMode==="mrt-fallback"?1:0,zn=(Gn,as)=>Gn.draw(Pt,Xt.TRIANGLES,Tr,_s.disabled,Ir,gs.disabled,jy(hr.expandedFarZProjMatrix,An,An,Qn,0,Er,hr.frustumCorners.TL,hr.frustumCorners.TR,hr.frustumCorners.BR,hr.frustumCorners.BL,hr.globeCenterInViewSpace,hr.globeRadius,Pr,0,hr._farZ,Kn),"globe_pole_raster",as,Ln,Un);Mt.setupElevationDraw(kn,sr,Or),Pt.uploadCommonUniforms(Qt,sr,Qr.toUnwrapped()),Nr&&Pt.renderDefaultNorthPole&&zn(sr,Kr),tn&&Pt.renderDefaultSouthPole&&(An=c.cS(c.bC(),An,[1,-1,1]),zn(sr,yn))}}}})(lt,ht,dt,mt,Tt);else{const Pt=lt.context,Mt=Pt.gl;let Ht,$t;const qt=lt.shadowRenderer,Qt=Sm(lt,lt.longestCutoffRange),Xt=Ir=>{if($t===Ir)return;const Tr=[];Tr.push(Fy[Ir]),Qt.shouldRenderCutoff&&Tr.push("RENDER_CUTOFF"),qt&&(Tr.push("RENDER_SHADOWS","DEPTH_TEXTURE"),qt.useNormalOffset&&Tr.push("NORMAL_OFFSET")),Ht=lt.getOrCreateProgram("terrainRaster",{defines:Tr}),$t=Ir},sr=lt.colorModeForRenderPass(),ir=new es(Mt.LEQUAL,es.ReadWrite,lt.depthRangeFor3D);Jp.update(Tt);const hr=lt.transform,mr=By(hr.zoom,ht.exaggeration(),ht.sourceCache._source.tileSize);let dr=[0,0,0];if(qt){const Ir=lt.style.directionalLight,Tr=lt.style.ambientLight;Ir&&Tr&&(dr=Qp(lt.style,Ir,Tr))}{$t=-1;const Ir=Mt.TRIANGLES,[Tr,Ar]=[ht.gridIndexBuffer,ht.gridSegments];for(const Er of mt){const vr=dt.getTile(Er),Pr=_s.disabled,Br=ht.prevTerrainTileForTile[Er.key],Or=ht.terrainTileForTile[Er.key];C_(Br,Or)&&Jp.newMorphing(Er.key,Br,Or,Tt,250),M0(lt,vr.emissiveTexture),Pt.activeTexture.set(Mt.TEXTURE0),vr.texture&&vr.texture.bind(Mt.LINEAR,Mt.CLAMP_TO_EDGE);const Yr=Jp.getMorphValuesForProxy(Er.key),Qr=Yr?1:0;let un;Yr&&(un={morphing:{srcDemTile:Yr.from,dstDemTile:Yr.to,phase:c.dD(Yr.phase)}});const Cn=lt.emissiveMode==="mrt-fallback"?1:0,qr=qu(Er.projMatrix,Rv(Er.canonical,hr.renderWorldCopies)?mr/10:mr,dr,Cn);if(Xt(Qr),!Ht)continue;ht.setupElevationDraw(vr,Ht,un);const Nr=Er.toUnwrapped();qt&&qt.setupShadows(Nr,Ht),lt.uploadCommonUniforms(Pt,Ht,Nr,null,Qt),Ht.draw(lt,Ir,ir,Pr,sr,gs.backCCW,qr,"terrain_raster",ht.gridBuffer,Tr,Ar)}}}}($,this,this.proxySourceCache,d,this._updateTimestamp),this.renderingToTexture=!0,$.gpuTimingDeferredRenderEnd(),d.splice(0,d.length))}renderBatch(d){if(this._drapedRenderBatches.length===0)return d+1;this.renderingToTexture=!0;const $=this.painter,st=this.painter.context,lt=this.proxySourceCache,ht=this.proxiedCoords[lt.id],dt=this._drapedRenderBatches.shift(),mt=$.style.order,Tt=[];this._updateFBOs($.emissiveMode==="mrt-fallback");let Pt=0;for(const Mt of ht){const Ht=lt.getTileByID(Mt.proxyTileKey),$t=lt.proxyCachedFBO[Mt.key]?lt.proxyCachedFBO[Mt.key][d]:void 0,qt=$t!==void 0?lt.renderCache[$t]:this.pool[Pt++],Qt=$t!==void 0;if(Ht.texture=qt.tex,Ht.emissiveTexture=qt.emissiveTex,Qt&&!qt.dirty){Tt.push(Ht.tileID);continue}st.bindFramebuffer.set(qt.fb.framebuffer);const Xt=st.gl;let sr;Xt.drawBuffers($.emissiveMode==="mrt-fallback"?[Xt.COLOR_ATTACHMENT0,Xt.COLOR_ATTACHMENT1]:[Xt.COLOR_ATTACHMENT0]),this.renderedToTile=!1,qt.dirty&&(st.clear({color:c.ao.transparent,stencil:0}),qt.dirty=!1);for(let ir=dt.start;ir<=dt.end;++ir){const hr=$.style._mergedLayers[mt[ir]];if(hr.isHidden($.transform.zoom))continue;const mr=$.style.getLayerSourceCache(hr),dr=mr?this.proxyToSource[Mt.key][mr.id]:[Mt];if(!dr)continue;const Ir=dr;st.viewport.set([0,0,qt.fb.width,qt.fb.height]),sr!==(mr?mr.id:null)&&(this._setupStencil(qt,dr,hr,mr),sr=mr?mr.id:null),$.renderLayer($,mr,hr,Ir)}if(Xt.drawBuffers([Xt.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const ir of this._pendingGroundEffectLayers){const hr=$.style._mergedLayers[mt[ir]];if(hr.isHidden($.transform.zoom))continue;const mr=$.style.getLayerSourceCache(hr),dr=mr?this.proxyToSource[Mt.key][mr.id]:[Mt];if(!dr)continue;const Ir=dr;st.viewport.set([0,0,qt.fb.width,qt.fb.height]),sr!==(mr?mr.id:null)&&(this._setupStencil(qt,dr,hr,mr),sr=mr?mr.id:null),$.renderLayer($,mr,hr,Ir)}this.renderedToTile?(qt.dirty=!0,Tt.push(Ht.tileID)):Qt||--Pt,Pt===5&&(Pt=0,this.renderToBackBuffer(Tt))}return this.renderToBackBuffer(Tt),this.renderingToTexture=!1,st.bindFramebuffer.set(null),st.viewport.set([0,0,$.width,$.height]),dt.end+1}postRender(){}isLayerOrderingCorrect(d){const $=d.order.length;let st=-1,lt=$;for(let ht=0;ht<$;++ht)this._style.isLayerDraped(d._mergedLayers[d.order[ht]])?st=Math.max(st,ht):lt=Math.min(lt,ht);return lt>st}getMinElevationBelowMSL(){let d=0;return this._visibleDemTiles.filter($=>$.dem).forEach($=>{d=Math.min(d,$.dem.tree.minimums[0])}),d===0?d:(d-30)*this._exaggeration}raycast(d,$,st){if(!this._visibleDemTiles)return null;const lt=this._visibleDemTiles.filter(ht=>ht.dem).map(ht=>{const dt=ht.tileID,mt=1<<dt.overscaledZ,{x:Tt,y:Pt}=dt.canonical,Mt=Tt/mt,Ht=(Tt+1)/mt,$t=Pt/mt,qt=(Pt+1)/mt;return{minx:Mt,miny:$t,maxx:Ht,maxy:qt,t:ht.dem.tree.raycastRoot(Mt,$t,Ht,qt,d,$,st),tile:ht}});lt.sort((ht,dt)=>(ht.t!==null?ht.t:Number.MAX_VALUE)-(dt.t!==null?dt.t:Number.MAX_VALUE));for(const ht of lt){if(ht.t==null)return null;const dt=ht.tile.dem.tree.raycast(ht.minx,ht.miny,ht.maxx,ht.maxy,d,$,st);if(dt!=null)return dt}return null}_createFBO(){const d=this.painter.context,$=d.gl,st=this.drapeBufferSize;d.activeTexture.set($.TEXTURE0);const lt=new c.T(d,{width:st[0],height:st[1],data:null},$.RGBA8);lt.bind($.LINEAR,$.CLAMP_TO_EDGE);const ht=d.createFramebuffer(st[0],st[1],1,null);let dt;return ht.colorAttachment0.set(lt.texture),this._emissiveTexture&&(dt=new c.T(d,{width:st[0],height:st[1],data:null},$.R8),dt.bind($.LINEAR,$.CLAMP_TO_EDGE),ht.createColorAttachment(d,1),ht.colorAttachment1.set(dt.texture)),ht.depthAttachment=new bw(d,ht.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=d.createRenderbuffer(d.gl.DEPTH_STENCIL,st[0],st[1]),this._stencilRef=0,ht.depthAttachment.set(this._sharedDepthStencil),d.clear({stencil:0})):ht.depthAttachment.set(this._sharedDepthStencil),d.extTextureFilterAnisotropic&&$.texParameterf($.TEXTURE_2D,d.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,d.extTextureFilterAnisotropicMax),{fb:ht,tex:lt,emissiveTex:dt,dirty:!1}}_updateFBOs(d){if(this._emissiveTexture!==d){for(const $ of this.pool)this._updateFBO($,d);for(const $ of this.proxySourceCache.renderCache)this._updateFBO($,d);this._emissiveTexture=d}}_updateFBO(d,$){const st=d.fb,lt=this.painter.context,ht=lt.gl,dt=this.drapeBufferSize;if($){const mt=new c.T(lt,{width:dt[0],height:dt[1],data:null},ht.R8);mt.bind(ht.LINEAR,ht.CLAMP_TO_EDGE),d.emissiveTex=mt,st.createColorAttachment(lt,1),st.colorAttachment1.set(mt.texture)}else d.emissiveTex=void 0,st.removeColorAttachment(lt,1);d.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d].hasTransition())return!0;return this._style.order.some(d=>{const $=this._style._mergedLayers[d],st=$.isHidden(this.painter.transform.zoom);return $.type==="hillshade"||$.type==="custom"?!st&&$.shouldRedrape():!st&&$.hasTransition()})}_clearLineLayersFromRenderCache(){let d=!1;for(const st of this._style.getSources())if(st instanceof Km){d=!0;break}if(!d)return;const $={};for(let st=0;st<this._style.order.length;++st){const lt=this._style._mergedLayers[this._style.order[st]],ht=this._style.getLayerSourceCache(lt);if(!ht||$[ht.id]||lt.isHidden(this.painter.transform.zoom)||lt.type!=="line")continue;const dt=lt.widthExpression(),mt=lt.emissiveStrengthExpression();if(dt instanceof c.ad||mt instanceof c.ad){$[ht.id]=!0;for(const Tt of this.proxyCoords){const Pt=this.proxyToSource[Tt.key][ht.id];if(Pt)for(const Mt of Pt)this._clearRenderCacheForTile(ht.id,Mt)}}}}_clearRasterLayersFromRenderCache(){let d=!1;for(const st in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[st]._source instanceof Jl){d=!0;break}if(!d)return;const $={};for(let st=0;st<this._style.order.length;++st){const lt=this._style._mergedLayers[this._style.order[st]],ht=this._style.getLayerSourceCache(lt);if(!ht||$[ht.id]||lt.isHidden(this.painter.transform.zoom)||lt.type!=="raster")continue;const dt=lt.paint.get("raster-fade-duration");for(const mt of this.proxyCoords){const Tt=this.proxyToSource[mt.key][ht.id];if(Tt)for(const Pt of Tt){const Mt=R_(ht.getTile(Pt),ht.findLoadedParent(Pt,0),ht,this.painter.transform,dt);(Mt.opacity!==1||Mt.mix!==0)&&this._clearRenderCacheForTile(ht.id,Pt)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const d=this._style.order,$=d.length;if($===0)return;const st=[];this._pendingGroundEffectLayers=[];let lt,ht=0,dt=this._style._mergedLayers[d[ht]];for(;!this._style.isLayerDraped(dt)&&dt.isHidden(this.painter.transform.zoom)&&++ht<$;)dt=this._style._mergedLayers[d[ht]];for(;ht<$;++ht){const mt=this._style._mergedLayers[d[ht]];mt.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(mt)?lt===void 0&&(lt=ht):(mt.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(ht),lt!==void 0&&(st.push({start:lt,end:ht-1}),lt=void 0)))}if(lt!==void 0&&st.push({start:lt,end:ht-1}),st.length!==0){const mt=st[st.length-1];this._pendingGroundEffectLayers.every(Tt=>Tt>mt.end)||c.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=st}_setupRenderCache(d){const $=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,$.renderCache.length>$.renderCachePool.length){const dt=Object.values($.proxyCachedFBO);$.proxyCachedFBO={};for(let mt=0;mt<dt.length;++mt){const Tt=Object.values(dt[mt]);$.renderCachePool.push(...Tt)}}return}this._clearRasterLayersFromRenderCache();const st=this.proxyCoords,lt=this._tilesDirty;for(let dt=st.length-1;dt>=0;dt--){const mt=st[dt];if($.getTileByID(mt.key),$.proxyCachedFBO[mt.key]!==void 0){const Tt=d[mt.key],Pt=this.proxyToSource[mt.key];let Mt=0;for(const Ht in Pt){const $t=Pt[Ht],qt=Tt[Ht];if(!qt||qt.length!==$t.length||$t.some((Qt,Xt)=>Qt!==qt[Xt]||lt[Ht]&&lt[Ht].hasOwnProperty(Qt.key))){Mt=-1;break}++Mt}for(const Ht in $.proxyCachedFBO[mt.key])$.renderCache[$.proxyCachedFBO[mt.key][Ht]].dirty=Mt<0||Mt!==Object.values(Tt).length}}const ht=[...this._drapedRenderBatches];ht.sort((dt,mt)=>mt.end-mt.start-(dt.end-dt.start));for(const dt of ht)for(const mt of st){if($.proxyCachedFBO[mt.key])continue;let Tt=$.renderCachePool.pop();Tt===void 0&&$.renderCache.length<50&&(Tt=$.renderCache.length,$.renderCache.push(this._createFBO())),Tt!==void 0&&($.proxyCachedFBO[mt.key]={},$.proxyCachedFBO[mt.key][dt.start]=Tt,$.renderCache[Tt].dirty=!0)}this._tilesDirty={}}_setupStencil(d,$,st,lt){if(!lt||!this._sourceTilesOverlap[lt.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const ht=this.painter.context,dt=ht.gl;if($.length<=1)return void(this._overlapStencilType=!1);let mt;if(st.isTileClipped())mt=$.length,this._overlapStencilMode.test={func:dt.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!($[0].overscaledZ>$[$.length-1].overscaledZ))return void(this._overlapStencilType=!1);mt=1,this._overlapStencilMode.test={func:dt.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+mt>255&&(ht.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=mt,this._overlapStencilMode.ref=this._stencilRef,st.isTileClipped()&&this._renderTileClippingMasks($,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(d){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[d.key]),this._overlapStencilMode):_s.disabled}_renderTileClippingMasks(d,$){const st=this.painter,lt=this.painter.context,ht=lt.gl;st._tileClippingMaskIDs={},lt.setColorMode(Ps.disabled),lt.setDepthMode(es.disabled);const dt=st.getOrCreateProgram("clippingMask");for(const mt of d){const Tt=st._tileClippingMaskIDs[mt.key]=--$;dt.draw(st,ht.TRIANGLES,es.disabled,new _s({func:ht.ALWAYS,mask:0},Tt,255,ht.KEEP,ht.KEEP,ht.REPLACE),Ps.disabled,gs.disabled,A_(mt.projMatrix),"$clipping",st.tileExtentBuffer,st.quadTriangleIndexBuffer,st.tileExtentSegments)}}pointCoordinate(d){const $=this.painter.transform;if(d.x<0||d.x>$.width||d.y<0||d.y>$.height)return null;const st=[d.x,d.y,1,1];c.aC(st,st,$.pixelMatrixInverse),c.cK(st,st,1/st[3]),st[0]/=$.worldSize,st[1]/=$.worldSize;const lt=$._camera.position,ht=c.cf(1,$.center.lat),dt=[lt[0],lt[1],lt[2]/ht,0],mt=c.da([],st.slice(0,3),dt);c.aw(mt,mt);const Tt=this.raycast(dt,mt,this._exaggeration);return Tt!==null&&Tt?(c.bH(dt,dt,mt,Tt),dt[3]=dt[2],dt[2]*=ht,dt):null}_setupProxiedCoordsForOrtho(d,$,st){if(d.getSource()instanceof c.aU)return this._setupProxiedCoordsForImageSource(d,$,st);this._findCoveringTileCache[d.id]=this._findCoveringTileCache[d.id]||{};const lt=this.proxiedCoords[d.id]=[],ht=this.proxyCoords;for(let Tt=0;Tt<ht.length;Tt++){const Pt=ht[Tt],Mt=this._findTileCoveringTileID(Pt,d);if(Mt){const Ht=this._createProxiedId(Pt,Mt,st[Pt.key]&&st[Pt.key][d.id]);lt.push(Ht),this.proxyToSource[Pt.key][d.id]=[Ht]}}let dt=!1;const mt=new Set;for(let Tt=0;Tt<$.length;Tt++){const Pt=d.getTile($[Tt]);if(!Pt||!Pt.hasData())continue;const Mt=this._findTileCoveringTileID(Pt.tileID,this.proxySourceCache);if(Mt&&Mt.tileID.canonical.z!==Pt.tileID.canonical.z){const Ht=this.proxyToSource[Mt.tileID.key][d.id],$t=this._createProxiedId(Mt.tileID,Pt,st[Mt.tileID.key]&&st[Mt.tileID.key][d.id]);Ht?Ht.splice(Ht.length-1,0,$t):this.proxyToSource[Mt.tileID.key][d.id]=[$t];const qt=this.proxyToSource[Mt.tileID.key][d.id];mt.has(qt)||mt.add(qt),lt.push($t),dt=!0}}if(this._sourceTilesOverlap[d.id]=dt,dt&&this._debugParams.sortTilesHiZFirst)for(const Tt of mt)Tt.sort((Pt,Mt)=>Mt.overscaledZ-Pt.overscaledZ)}_setupProxiedCoordsForImageSource(d,$,st){if(!d.getSource().loaded())return;const lt=this.proxiedCoords[d.id]=[],ht=this.proxyCoords,dt=d.getSource(),mt=dt.tileID;if(!mt)return;const Tt=new c.P(mt.x,mt.y)._div(1<<mt.z),Pt=dt.coordinates.map(c.ae.fromLngLat).reduce((Ht,$t)=>(Ht.min.x=Math.min(Ht.min.x,$t.x-Tt.x),Ht.min.y=Math.min(Ht.min.y,$t.y-Tt.y),Ht.max.x=Math.max(Ht.max.x,$t.x-Tt.x),Ht.max.y=Math.max(Ht.max.y,$t.y-Tt.y),Ht),{min:new c.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new c.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),Mt=(Ht,$t)=>{const qt=Ht.wrap+Ht.canonical.x/(1<<Ht.canonical.z),Qt=Ht.canonical.y/(1<<Ht.canonical.z),Xt=c.al/(1<<Ht.canonical.z),sr=$t.wrap+$t.canonical.x/(1<<$t.canonical.z),ir=$t.canonical.y/(1<<$t.canonical.z);return qt+Xt<sr+Pt.min.x||qt>sr+Pt.max.x||Qt+Xt<ir+Pt.min.y||Qt>ir+Pt.max.y};for(let Ht=0;Ht<ht.length;Ht++){const $t=ht[Ht];for(let qt=0;qt<$.length;qt++){const Qt=d.getTile($[qt]);if(!Qt||!Qt.hasData()||Mt($t,Qt.tileID))continue;const Xt=this._createProxiedId($t,Qt,st[$t.key]&&st[$t.key][d.id]),sr=this.proxyToSource[$t.key][d.id];sr?sr.push(Xt):this.proxyToSource[$t.key][d.id]=[Xt],lt.push(Xt)}}}_createProxiedId(d,$,st){let lt=this.orthoMatrix;if(st){const ht=st.find(dt=>dt.key===$.tileID.key);if(ht)return ht}if($.tileID.key!==d.key){const ht=d.canonical.z-$.tileID.canonical.z;let dt,mt,Tt;lt=c.bC();const Pt=$.tileID.wrap-d.wrap<<d.overscaledZ;ht>0?(dt=c.al>>ht,mt=dt*(($.tileID.canonical.x<<ht)-d.canonical.x+Pt),Tt=dt*(($.tileID.canonical.y<<ht)-d.canonical.y)):(dt=c.al<<-ht,mt=c.al*($.tileID.canonical.x-(d.canonical.x+Pt<<-ht)),Tt=c.al*($.tileID.canonical.y-(d.canonical.y<<-ht))),c.ce(lt,0,dt,0,dt,0,1),c.br(lt,lt,[mt,Tt,0])}return new Pv($.tileID,d.key,lt)}_findTileCoveringTileID(d,$){let st=$.getTile(d);if(st&&st.hasData())return st;const lt=this._findCoveringTileCache[$.id],ht=lt[d.key];if(st=ht?$.getTileByID(ht):null,st&&st.hasData()||ht===null)return st;let dt=st?st.tileID:d,mt=dt.overscaledZ;const Tt=$.getSource().minzoom,Pt=[];if(!ht){const Ht=$.getSource().maxzoom;if(d.canonical.z>=Ht){const $t=d.canonical.z-Ht;$.getSource().reparseOverscaled?(mt=Math.max(d.canonical.z+2,$.transform.tileZoom),dt=new c.aQ(mt,d.wrap,Ht,d.canonical.x>>$t,d.canonical.y>>$t)):$t!==0&&(mt=Ht,dt=new c.aQ(mt,d.wrap,Ht,d.canonical.x>>$t,d.canonical.y>>$t))}dt.key!==d.key&&(Pt.push(dt.key),st=$.getTile(dt))}const Mt=Ht=>{Pt.forEach($t=>{lt[$t]=Ht}),Pt.length=0};for(mt-=1;mt>=Tt&&(!st||!st.hasData());mt--){st&&Mt(st.tileID.key);const Ht=dt.calculateScaledKey(mt);if(st=$.getTileByID(Ht),st&&st.hasData())break;const $t=lt[Ht];if($t===null)break;$t===void 0?Pt.push(Ht):st=$.getTileByID($t)}return Mt(st?st.tileID.key:null),st&&st.hasData()?st:null}findDEMTileFor(d){return this.enabled?this._findTileCoveringTileID(d,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(d,$){let st=this._tilesDirty[d];st||(st=this._tilesDirty[d]={}),st[$.key]=!0}}function D0(it,d,$){const st=function(mt,Tt,Pt){const Mt=c.bJ(Tt,mt),Ht=c.bJ(Pt,[.2126,.7152,.0722]),$t=(Qt,Xt,sr)=>(1-sr)*Qt+sr*Xt,qt=$t(1-.3*Math.min(Ht,1),1,Math.min(Mt+1,1));return $t(.92,1,Math.asin(c.aA(Tt[2],-1,1))/Math.PI+.5)*qt}(it,[0,0,1],d),lt=[0,0,0];c.c5(lt,$.slice(0,3),st);const ht=[0,0,0];c.c5(ht,d.slice(0,3),it[2]);const dt=[0,0,0];return c.d8(dt,lt,ht),c.db(dt)}const hT=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],dT=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class ww{static cacheKey(d,$,st,lt){const ht=[$];lt&&ht.push(lt.cacheKey);for(const dt of st)d.usedDefines.has(dt)&&ht.push(dt);return ht.join("/")}constructor(d,$,st,lt,ht,dt){const mt=d.gl;this.program=mt.createProgram(),this.configuration=lt,this.name=$,this.fixedDefines=[...dt];const Tt=`#version 300 es
${(lt?lt.defines():[]).concat(dt.map(Xt=>`#define ${Xt}`)).join(`
`)}`,Pt=[Tt,rT];for(const Xt of st.fragmentIncludes)Pt.push(Im[Xt]);Pt.push(st.fragmentSource);const Mt=Pt.join(`
`),Ht=[Tt,hw];for(const Xt of st.vertexIncludes)Ht.push(Im[Xt]);this.forceManualRenderingForInstanceIDShaders=d.forceManualRenderingForInstanceIDShaders&&st.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&Ht.push("uniform int u_instanceID;"),Ht.push(st.vertexSource);let $t=Ht.join(`
`);this.forceManualRenderingForInstanceIDShaders&&($t=$t.replaceAll("gl_InstanceID","u_instanceID"));const qt=mt.createShader(mt.FRAGMENT_SHADER);if(mt.isContextLost())return void(this.failedToCreate=!0);mt.shaderSource(qt,Mt),mt.compileShader(qt),mt.attachShader(this.program,qt);const Qt=mt.createShader(mt.VERTEX_SHADER);mt.isContextLost()?this.failedToCreate=!0:(mt.shaderSource(Qt,$t),mt.compileShader(Qt),mt.attachShader(this.program,Qt),this.attributes={},mt.linkProgram(this.program),mt.deleteShader(Qt),mt.deleteShader(qt),this.fixedUniforms=ht(d),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=lt?lt.getUniforms(d):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Xt=>({u_instanceID:new c.ch(Xt)}))(d)),(dt.includes("TERRAIN")||$.includes("symbol")||$.includes("circle"))&&(this.terrainUniforms=(Xt=>({u_dem:new c.ch(Xt),u_dem_prev:new c.ch(Xt),u_dem_tl:new c.ck(Xt),u_dem_scale:new c.cj(Xt),u_dem_tl_prev:new c.ck(Xt),u_dem_scale_prev:new c.cj(Xt),u_dem_size:new c.cj(Xt),u_dem_lerp:new c.cj(Xt),u_exaggeration:new c.cj(Xt),u_depth:new c.ch(Xt),u_depth_size_inv:new c.ck(Xt),u_depth_range_unpack:new c.ck(Xt),u_occluder_half_size:new c.cj(Xt),u_occlusion_depth_offset:new c.cj(Xt),u_meter_to_dem:new c.cj(Xt),u_label_plane_matrix_inv:new c.cl(Xt)}))(d)),dt.includes("GLOBE")&&(this.globeUniforms=(Xt=>({u_tile_tl_up:new c.ci(Xt),u_tile_tr_up:new c.ci(Xt),u_tile_br_up:new c.ci(Xt),u_tile_bl_up:new c.ci(Xt),u_tile_up_scale:new c.cj(Xt)}))(d)),dt.includes("FOG")&&(this.fogUniforms=(Xt=>({u_fog_matrix:new c.cl(Xt),u_fog_range:new c.ck(Xt),u_fog_color:new c.d3(Xt),u_fog_horizon_blend:new c.cj(Xt),u_fog_vertical_limit:new c.ck(Xt),u_fog_temporal_offset:new c.cj(Xt),u_frustum_tl:new c.ci(Xt),u_frustum_tr:new c.ci(Xt),u_frustum_br:new c.ci(Xt),u_frustum_bl:new c.ci(Xt),u_globe_pos:new c.ci(Xt),u_globe_radius:new c.cj(Xt),u_globe_transition:new c.cj(Xt),u_is_globe:new c.ch(Xt),u_viewport:new c.ck(Xt)}))(d)),dt.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Xt=>({u_cutoff_params:new c.d3(Xt)}))(d)),dt.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Xt=>({u_lighting_ambient_color:new c.ci(Xt),u_lighting_directional_dir:new c.ci(Xt),u_lighting_directional_color:new c.ci(Xt),u_ground_radiance:new c.ci(Xt)}))(d)),dt.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Xt=>({u_light_matrix_0:new c.cl(Xt),u_light_matrix_1:new c.cl(Xt),u_fade_range:new c.ck(Xt),u_shadow_normal_offset:new c.ci(Xt),u_shadow_intensity:new c.cj(Xt),u_shadow_texel_size:new c.cj(Xt),u_shadow_map_resolution:new c.cj(Xt),u_shadow_direction:new c.ci(Xt),u_shadow_bias:new c.ci(Xt),u_shadowmap_0:new c.ch(Xt),u_shadowmap_1:new c.ch(Xt)}))(d)))}getAttributeLocation(d,$){let st=this.attributes[$];return st===void 0&&(st=this.attributes[$]=d.getAttribLocation(this.program,$)),st}setTerrainUniformValues(d,$){if(!this.terrainUniforms)return;const st=this.terrainUniforms;if(!this.failedToCreate){d.program.set(this.program);for(const lt in $)st[lt]&&st[lt].set(this.program,lt,$[lt])}}setGlobeUniformValues(d,$){if(!this.globeUniforms)return;const st=this.globeUniforms;if(!this.failedToCreate){d.program.set(this.program);for(const lt in $)st[lt]&&st[lt].set(this.program,lt,$[lt])}}setFogUniformValues(d,$){if(!this.fogUniforms)return;const st=this.fogUniforms;if(!this.failedToCreate){d.program.set(this.program);for(const lt in $)st[lt].set(this.program,lt,$[lt])}}setCutoffUniformValues(d,$){if(!this.cutoffUniforms)return;const st=this.cutoffUniforms;if(!this.failedToCreate){d.program.set(this.program);for(const lt in $)st[lt].set(this.program,lt,$[lt])}}setLightsUniformValues(d,$){if(!this.lightsUniforms)return;const st=this.lightsUniforms;if(!this.failedToCreate){d.program.set(this.program);for(const lt in $)st[lt].set(this.program,lt,$[lt])}}setShadowUniformValues(d,$){if(this.failedToCreate||!this.shadowUniforms)return;const st=this.shadowUniforms;d.program.set(this.program);for(const lt in $)st[lt].set(this.program,lt,$[lt])}_drawDebugWireframe(d,$,st,lt,ht,dt,mt,Tt,Pt,Mt){const Ht=d.options.wireframe;if(Ht.terrain===!1&&Ht.layers2D===!1&&Ht.layers3D===!1)return;const $t=d.context;if(!(!(!Ht.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Ht.layers2D||d._terrain&&d._terrain.renderingToTexture||!hT.includes(this.name))||!(!Ht.layers3D||!dT.includes(this.name))))return;const qt=$t.gl,Qt=d.wireframeDebugCache.getLinesFromTrianglesBuffer(d.frameCounter,ht,$t);if(!Qt)return;const Xt=[...this.fixedDefines,"DEBUG_WIREFRAME"],sr=d.getOrCreateProgram(this.name,{config:this.configuration,defines:Xt});$t.program.set(sr.program);const ir=(dr,Ir,Tr)=>{if(Ir[dr]&&Tr[dr])for(const Ar in Ir[dr])Tr[dr][Ar]&&Tr[dr][Ar].set(Tr.program,Ar,Ir[dr][Ar].current)};Pt&&Pt.setUniforms(sr.program,$t,sr.binderUniforms,mt,{zoom:Tt}),ir("fixedUniforms",this,sr),ir("terrainUniforms",this,sr),ir("globeUniforms",this,sr),ir("fogUniforms",this,sr),ir("lightsUniforms",this,sr),ir("shadowUniforms",this,sr),Qt.bind(),$t.setColorMode(new Ps([qt.ONE,qt.ONE_MINUS_SRC_ALPHA,qt.ZERO,qt.ONE],c.ao.transparent,[!0,!0,!0,!1])),$t.setDepthMode(new es($.func===qt.LESS?qt.LEQUAL:$.func,es.ReadOnly,$.range)),$t.setStencilMode(_s.disabled);const hr=3*dt.primitiveLength*2,mr=3*dt.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const dr=Mt||1;for(let Ir=0;Ir<dr;++Ir)sr.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ir),qt.drawElements(qt.LINES,hr,qt.UNSIGNED_SHORT,mr)}else Mt&&Mt>1?qt.drawElementsInstanced(qt.LINES,hr,qt.UNSIGNED_SHORT,mr,Mt):qt.drawElements(qt.LINES,hr,qt.UNSIGNED_SHORT,mr);ht.bind(),$t.program.set(this.program),$t.setDepthMode($),$t.setStencilMode(st),$t.setColorMode(lt)}checkUniforms(d,$,st){if(this.fixedDefines.includes($)){for(const lt of Object.keys(st))if(!st[lt].initialized)throw new Error(`Program '${this.name}', from draw '${d}': uniform ${lt} not set but required by ${$} being defined`)}}draw(d,$,st,lt,ht,dt,mt,Tt,Pt,Mt,Ht,$t,qt,Qt,Xt,sr){const ir=d.context,hr=ir.gl;if(this.failedToCreate)return;ir.program.set(this.program),ir.setDepthMode(st),ir.setStencilMode(lt),ir.setColorMode(ht),ir.setCullFace(dt);for(const[Er,vr]of this.fixedUniformsEntries)vr.set(this.program,Er,mt[Er]);Qt&&Qt.setUniforms(this.program,ir,this.binderUniforms,$t,{zoom:qt});const mr={[hr.POINTS]:1,[hr.LINES]:2,[hr.TRIANGLES]:3,[hr.LINE_STRIP]:1}[$];this.checkUniforms(Tt,"RENDER_SHADOWS",this.shadowUniforms);const dr=Xt||[],Ir=Qt?Qt.getPaintVertexBuffers():[],Tr=$===hr.TRIANGLES&&Mt,Ar=sr&&sr>0?1:void 0;for(const Er of Ht.get()){const vr=Er.vaos||(Er.vaos={});if((vr[Tt]||(vr[Tt]=new iT)).bind(ir,this,Pt,Ir,Mt,Er.vertexOffset,dr,Ar),this.forceManualRenderingForInstanceIDShaders){const Pr=sr||1;for(let Br=0;Br<Pr;++Br)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Br),Mt?hr.drawElements($,Er.primitiveLength*mr,hr.UNSIGNED_SHORT,Er.primitiveOffset*mr*2):hr.drawArrays($,Er.vertexOffset,Er.vertexLength)}else sr&&sr>1?hr.drawElementsInstanced($,Er.primitiveLength*mr,hr.UNSIGNED_SHORT,Er.primitiveOffset*mr*2,sr):Mt?hr.drawElements($,Er.primitiveLength*mr,hr.UNSIGNED_SHORT,Er.primitiveOffset*mr*2):hr.drawArrays($,Er.vertexOffset,Er.vertexLength);Tr&&this._drawDebugWireframe(d,st,lt,ht,Mt,Er,$t,qt,Qt,sr)}}}function Ew(it,d,$=0){const st=Math.pow(2,d.tileID.overscaledZ),lt=d.tileSize*Math.pow(2,it.transform.tileZoom)/st,ht=lt*(d.tileID.canonical.x+d.tileID.wrap*st),dt=lt*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture?d.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/c.ay(d,1,it.transform.tileZoom),u_pixel_coord_upper:[ht>>16,dt>>16],u_pixel_coord_lower:[65535&ht,65535&dt],u_pattern_transition:$}}const Vy={terrain:0,flat:1},pT=c.bC(),Uy=(it,d,$,st,lt,ht,dt,mt,Tt,Pt,Mt,Ht,$t,qt,Qt,Xt,sr,ir)=>{const hr=d.style.light,mr=hr.properties.get("position"),dr=[mr.x,mr.y,mr.z],Ir=c.dO();hr.properties.get("anchor")==="viewport"&&(c.dP(Ir,-d.transform.angle),c.dQ(dr,dr,Ir));const Tr=hr.properties.get("color").toPremultipliedRenderColor(null),Ar=d.transform,Er={u_matrix:it,u_lightpos:dr,u_lightintensity:hr.properties.get("intensity"),u_lightcolor:[Tr.r,Tr.g,Tr.b],u_vertical_gradient:+$,u_opacity:st,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:pT,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Vy[Pt],u_base_type:Vy[Mt],u_ao:lt,u_edge_radius:ht,u_width_scale:dt,u_flood_light_color:Qt,u_vertical_scale:Xt,u_flood_light_intensity:sr,u_ground_shadow_factor:ir};return Ar.projection.name==="globe"&&(Er.u_tile_id=[mt.canonical.x,mt.canonical.y,1<<mt.canonical.z],Er.u_zoom_transition=Ht,Er.u_inv_rot_matrix=qt,Er.u_merc_center=$t,Er.u_up_dir=Ar.projection.upVector(new c.cD(0,0,0),$t[0]*c.al,$t[1]*c.al),Er.u_height_lift=Tt),Er},Mv=(it,d,$,st,lt,ht)=>({u_matrix:it,u_edge_radius:d,u_width_scale:$,u_vertical_scale:st,u_height_type:Vy[lt],u_base_type:Vy[ht]}),Tw=(it,d,$,st,lt,ht,dt,mt,Tt,Pt,Mt,Ht,$t,qt,Qt,Xt,sr,ir)=>{const hr=Uy(it,d,$,st,lt,ht,dt,mt,Pt,Mt,Ht,$t,qt,Qt,Xt,sr,1,[0,0,0]),mr={u_height_factor:-Math.pow(2,mt.overscaledZ)/Tt.tileSize/8};return Object.assign(hr,Ew(d,Tt,ir),mr)},N0=(it,d,$,st,lt,ht,dt,mt,Tt,Pt,Mt)=>({u_matrix:d,u_opacity:$,u_ao_pass:st?1:0,u_meter_to_tile:lt,u_ao:ht,u_flood_light_intensity:dt,u_flood_light_color:mt,u_attenuation:Tt,u_edge_radius:Pt,u_fb:0,u_fb_size:Mt,u_dynamic_offset:1}),Dv=(it,d,$)=>({u_matrix:it,u_emissive_strength:d,u_ground_shadow_factor:$}),Nv=(it,d,$,st,lt,ht=0)=>Object.assign(Dv(it,d,lt),Ew($,st,ht)),Sw=(it,d,$,st)=>({u_matrix:it,u_world:$,u_emissive_strength:d,u_ground_shadow_factor:st}),Lv=(it,d,$,st,lt,ht,dt=0)=>Object.assign(Nv(it,d,$,st,ht,dt),{u_world:lt}),km=(it,d)=>({u_matrix:it,u_ground_shadow_factor:d}),i0=(it,d,$,st,lt)=>({u_matrix:it,u_camera_pos:[d[0],d[1],d[2]],u_depth_bias:$,u_height_scale:st,u_reset_depth:lt}),$y=(it,d,$,st,lt,ht,dt,mt,Tt)=>({u_matrix:it,u_normal_matrix:d,u_opacity:$,u_faux_facade_ao_intensity:st,u_camera_pos:lt,u_tile_to_meter:ht,u_facade_emissive_chance:dt,u_flood_light_color:mt,u_flood_light_intensity:Tt}),Cw=it=>({u_matrix:it}),Mm=it=>({u_matrix:it}),Ov=(it,d,$,st,lt,ht,dt,mt)=>{const Tt=c.al/ht.tileSize;return{u_matrix:it,u_inv_rot_matrix:d,u_camera_to_center_distance:$.getCameraToCenterDistance(mt),u_extrude_scale:[$.pixelsToGLUnits[0]/Tt,$.pixelsToGLUnits[1]/Tt],u_zoom_transition:st,u_tile_id:dt,u_merc_center:lt}},I_=(it,d,$=1)=>({u_matrix:it,u_color:d,u_overlay:0,u_overlay_scale:$}),Aw=c.bC(),Rw=(it,d,$,st,lt,ht,dt)=>{const mt=it.transform,Tt=mt.projection.name==="globe",Pt=Tt?c.dR(mt.zoom,d.canonical)*mt._pixelsPerMercatorPixel:c.ay($,1,ht),Mt={u_matrix:d.projMatrix,u_extrude_scale:Pt,u_intensity:dt,u_inv_rot_matrix:Aw,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(Tt){Mt.u_inv_rot_matrix=st,Mt.u_merc_center=lt,Mt.u_tile_id=[d.canonical.x,d.canonical.y,1<<d.canonical.z],Mt.u_zoom_transition=c.aj(mt.zoom);const Ht=lt[0]*c.al,$t=lt[1]*c.al;Mt.u_up_dir=mt.projection.upVector(new c.cD(0,0,0),Ht,$t)}return Mt};function Gy(it,[d,$,st,lt],[ht,dt]){if(ht===dt)return[0,0,0,0];const mt=255*(it-1)/(it*(dt-ht));return[d*mt,$*mt,st*mt,lt*mt]}function Hy(it,d,[$,st]){return $===st?0:.5/it+(d-$)*(it-1)/(it*(st-$))}const Iw=(it,d,$,st,lt,ht,dt,mt,Tt,Pt,Mt,Ht,$t,qt,Qt,Xt,sr,ir,hr,mr,dr)=>({u_matrix:it,u_normalize_matrix:d,u_globe_matrix:$,u_merc_matrix:st,u_grid_matrix:lt,u_tl_parent:ht,u_scale_parent:Pt,u_fade_t:Mt.mix,u_opacity:Mt.opacity*Ht.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Ht.paint.get("raster-brightness-min"),u_brightness_high:Ht.paint.get("raster-brightness-max"),u_saturation_factor:c.dT(Ht.paint.get("raster-saturation")),u_contrast_factor:c.dS(Ht.paint.get("raster-contrast")),u_spin_weights:Pw(Ht.paint.get("raster-hue-rotate")),u_perspective_transform:$t,u_raster_elevation:qt,u_zoom_transition:dt,u_merc_center:mt,u_cutoff_params:Tt,u_colorization_mix:Gy(c.dU,Xt,ir),u_colorization_offset:Hy(c.dU,sr,ir),u_color_ramp:Qt,u_texture_offset:[mr/(hr+2*mr),hr/(hr+2*mr)],u_texture_res:[hr+2*mr,hr+2*mr],u_emissive_strength:dr});function Pw(it){it*=Math.PI/180;const d=Math.sin(it),$=Math.cos(it);return[(2*$+1)/3,(-Math.sqrt(3)*d-$+1)/3,(Math.sqrt(3)*d-$+1)/3]}const Bp=.05,fT=(it,d,$,st,lt,ht,dt,mt,Tt,Pt,Mt,Ht)=>({u_matrix:it,u_normalize_matrix:d,u_globe_matrix:$,u_merc_matrix:st,u_grid_matrix:lt,u_tl_parent:ht,u_scale_parent:Pt,u_fade_t:Mt.mix,u_opacity:Mt.opacity,u_image0:0,u_image1:1,u_raster_elevation:Ht,u_zoom_transition:dt,u_merc_center:mt,u_cutoff_params:Tt}),mT=(it,d,$,st,lt,ht,dt,mt,Tt,Pt)=>({u_particle_texture:it,u_particle_texture_side_len:d,u_tile_offset:$,u_velocity:st,u_color_ramp:ht,u_velocity_res:lt,u_max_speed:dt,u_uv_offset:mt,u_data_scale:[255*Tt[0],255*Tt[1]],u_data_offset:Pt,u_particle_pos_scale:1.1,u_particle_pos_offset:[Bp,Bp]}),kw=(it,d,$,st,lt,ht,dt,mt,Tt,Pt)=>({u_particle_texture:it,u_particle_texture_side_len:d,u_velocity:$,u_velocity_res:st,u_max_speed:lt,u_speed_factor:ht,u_reset_rate:dt,u_rand_seed:Math.random(),u_uv_offset:mt,u_data_scale:[255*Tt[0],255*Tt[1]],u_data_offset:Pt,u_particle_pos_scale:1.1,u_particle_pos_offset:[Bp,Bp]}),Mw=c.bC(),Wy=(it,d,$,st,lt,ht,dt,mt,Tt,Pt,Mt,Ht,$t,qt,Qt,Xt,sr,ir,hr,mr,dr,Ir,Tr,Ar)=>{const Er=lt.transform,vr={u_is_size_zoom_constant:+(it==="constant"||it==="source"),u_is_size_feature_constant:+(it==="constant"||it==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:Er.getCameraToCenterDistance(hr),u_rotate_symbol:+$,u_aspect_ratio:Er.width/Er.height,u_fade_change:lt.options.fadeDuration?lt.symbolFadeChange:1,u_matrix:ht,u_label_plane_matrix:dt,u_coord_matrix:mt,u_is_text:+Pt,u_elevation_from_sea:Tt?1:0,u_pitch_with_map:+st,u_texsize:Mt,u_texsize_icon:Ht,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Mw,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Mw,u_up_vector:[0,-1,0],u_color_adj_mat:Ir,u_icon_transition:Tr||0,u_gamma_scale:st?lt.transform.getCameraToCenterDistance(hr)*Math.cos(lt.terrain?0:lt.transform._pitch):1,u_device_pixel_ratio:c.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ar||1,u_ground_shadow_factor:mr,u_inv_matrix:c.bl(c.bC(),dt),u_normal_scale:dr,u_lutTexture:_c.LUT};return hr.name==="globe"&&(vr.u_tile_id=[qt.canonical.x,qt.canonical.y,1<<qt.canonical.z],vr.u_zoom_transition=Qt,vr.u_inv_rot_matrix=sr,vr.u_merc_center=Xt,vr.u_camera_forward=Er._camera.forward(),vr.u_ecef_origin=c.dV(Er.globeMatrix,qt.toUnwrapped()),vr.u_tile_matrix=Float32Array.from(Er.globeMatrix),vr.u_up_vector=ir),vr},P_=(it,d,$,st)=>({u_matrix:it,u_emissive_strength:d,u_opacity:$,u_color:st}),Dm=(it,d,$,st,lt,ht,dt,mt,Tt)=>Object.assign(function(Pt,Mt,Ht,$t,qt,Qt){const{width:Xt,height:sr}=$t.imageManager.getPixelSize(Mt),ir=Math.pow(2,Qt.tileID.overscaledZ),hr=Qt.tileSize*Math.pow(2,$t.transform.tileZoom)/ir,mr=hr*(Qt.tileID.canonical.x+Qt.tileID.wrap*ir),dr=hr*Qt.tileID.canonical.y;return{u_image:0,u_pattern_tl:Ht.tl,u_pattern_br:Ht.br,u_texsize:[Xt,sr],u_pattern_size:Ht.displaySize,u_pattern_units_to_pixels:qt?[$t.transform.width,-1*$t.transform.height]:[1/c.ay(Qt,1,$t.transform.tileZoom),1/c.ay(Qt,1,$t.transform.tileZoom)],u_pixel_coord_upper:[mr>>16,dr>>16],u_pixel_coord_lower:[65535&mr,65535&dr]}}(0,ht,dt,st,mt,Tt),{u_matrix:it,u_emissive_strength:d,u_opacity:$}),L0=new Float32Array(c.bA([])),n0=(it,d,$,st,lt,ht,dt,mt,Tt,Pt,Mt,Ht,$t,qt=[0,0,0],Qt,Xt,sr)=>{const ir=lt.style.light,hr=ir.properties.get("position"),mr=[-hr.x,-hr.y,hr.z],dr=c.dO();ir.properties.get("anchor")==="viewport"&&(c.dP(dr,-lt.transform.angle),c.dQ(mr,mr,dr));const Ir=Mt.alphaMode==="MASK",Tr=ir.properties.get("color").toNonPremultipliedRenderColor(null),Ar=$t.paint.get("model-ambient-occlusion-intensity"),Er=$t.paint.get("model-color").constantOr(c.ao.white).toNonPremultipliedRenderColor(null);return Er.a=$t.paint.get("model-color-mix-intensity").constantOr(0),sr&&(Er.r=sr[0],Er.g=sr[1],Er.b=sr[2],Er.a=sr[3]),Xt&&(Er.r=Xt.color.r,Er.g=Xt.color.g,Er.b=Xt.color.b,Er.a=Xt.colorMix,Ht=Xt.emissionStrength,ht*=Xt.opacity),{u_matrix:it,u_lighting_matrix:d,u_normal_matrix:$,u_node_matrix:st||L0,u_lightpos:mr,u_lightintensity:ir.properties.get("intensity"),u_lightcolor:[Tr.r,Tr.g,Tr.b],u_camera_pos:qt,u_opacity:ht,u_baseTextureIsAlpha:0,u_alphaMask:+Ir,u_alphaCutoff:Mt.alphaCutoff,u_baseColorFactor:dt.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:mt.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:Tt,u_roughnessFactor:Pt,u_baseColorTexture:_c.BaseColor,u_metallicRoughnessTexture:_c.MetallicRoughness,u_normalTexture:_c.Normal,u_occlusionTexture:_c.Occlusion,u_emissionTexture:_c.Emission,u_lutTexture:_c.LUT,u_color_mix:Er.toArray01(),u_aoIntensity:Ar,u_emissive_strength:Ht,u_occlusionTextureTransform:Qt||[0,0,0,0]}},jv=(it,d=L0,$=L0)=>({u_matrix:it,u_instance:d,u_node_matrix:$}),qy={fillExtrusion:it=>({u_matrix:new c.cl(it),u_lightpos:new c.ci(it),u_lightintensity:new c.cj(it),u_lightcolor:new c.ci(it),u_vertical_gradient:new c.cj(it),u_opacity:new c.cj(it),u_edge_radius:new c.cj(it),u_width_scale:new c.cj(it),u_ao:new c.ck(it),u_height_type:new c.ch(it),u_base_type:new c.ch(it),u_tile_id:new c.ci(it),u_zoom_transition:new c.cj(it),u_inv_rot_matrix:new c.cl(it),u_merc_center:new c.ck(it),u_up_dir:new c.ci(it),u_height_lift:new c.cj(it),u_flood_light_color:new c.ci(it),u_vertical_scale:new c.cj(it),u_flood_light_intensity:new c.cj(it),u_ground_shadow_factor:new c.ci(it)}),fillExtrusionDepth:it=>({u_matrix:new c.cl(it),u_edge_radius:new c.cj(it),u_width_scale:new c.cj(it),u_vertical_scale:new c.cj(it),u_height_type:new c.ch(it),u_base_type:new c.ch(it)}),fillExtrusionPattern:it=>({u_matrix:new c.cl(it),u_lightpos:new c.ci(it),u_lightintensity:new c.cj(it),u_lightcolor:new c.ci(it),u_vertical_gradient:new c.cj(it),u_height_factor:new c.cj(it),u_edge_radius:new c.cj(it),u_width_scale:new c.cj(it),u_ao:new c.ck(it),u_height_type:new c.ch(it),u_base_type:new c.ch(it),u_tile_id:new c.ci(it),u_zoom_transition:new c.cj(it),u_inv_rot_matrix:new c.cl(it),u_merc_center:new c.ck(it),u_up_dir:new c.ci(it),u_height_lift:new c.cj(it),u_image:new c.ch(it),u_texsize:new c.ck(it),u_pixel_coord_upper:new c.ck(it),u_pixel_coord_lower:new c.ck(it),u_tile_units_to_pixels:new c.cj(it),u_opacity:new c.cj(it),u_pattern_transition:new c.cj(it)}),fillExtrusionGroundEffect:it=>({u_matrix:new c.cl(it),u_opacity:new c.cj(it),u_ao_pass:new c.cj(it),u_meter_to_tile:new c.cj(it),u_ao:new c.ck(it),u_flood_light_intensity:new c.cj(it),u_flood_light_color:new c.ci(it),u_attenuation:new c.cj(it),u_edge_radius:new c.cj(it),u_fb:new c.ch(it),u_fb_size:new c.cj(it),u_dynamic_offset:new c.cj(it)}),fill:it=>({u_matrix:new c.cl(it),u_emissive_strength:new c.cj(it),u_ground_shadow_factor:new c.ci(it)}),fillPattern:it=>({u_matrix:new c.cl(it),u_emissive_strength:new c.cj(it),u_image:new c.ch(it),u_texsize:new c.ck(it),u_pixel_coord_upper:new c.ck(it),u_pixel_coord_lower:new c.ck(it),u_tile_units_to_pixels:new c.cj(it),u_ground_shadow_factor:new c.ci(it),u_pattern_transition:new c.cj(it)}),fillOutline:it=>({u_matrix:new c.cl(it),u_emissive_strength:new c.cj(it),u_world:new c.ck(it),u_ground_shadow_factor:new c.ci(it)}),fillOutlinePattern:it=>({u_matrix:new c.cl(it),u_emissive_strength:new c.cj(it),u_world:new c.ck(it),u_image:new c.ch(it),u_texsize:new c.ck(it),u_pixel_coord_upper:new c.ck(it),u_pixel_coord_lower:new c.ck(it),u_tile_units_to_pixels:new c.cj(it),u_ground_shadow_factor:new c.ci(it),u_pattern_transition:new c.cj(it)}),building:it=>({u_matrix:new c.cl(it),u_normal_matrix:new c.cl(it),u_opacity:new c.cj(it),u_faux_facade_ao_intensity:new c.cj(it),u_camera_pos:new c.ci(it),u_tile_to_meter:new c.cj(it),u_facade_emissive_chance:new c.cj(it),u_flood_light_color:new c.ci(it),u_flood_light_intensity:new c.cj(it)}),buildingBloom:it=>({u_matrix:new c.cl(it)}),buildingDepth:it=>({u_matrix:new c.cl(it)}),elevatedStructuresDepth:it=>({u_matrix:new c.cl(it),u_depth_bias:new c.cj(it)}),elevatedStructures:it=>({u_matrix:new c.cl(it),u_ground_shadow_factor:new c.ci(it)}),elevatedStructuresDepthReconstruct:it=>({u_matrix:new c.cl(it),u_camera_pos:new c.ci(it),u_depth_bias:new c.cj(it),u_height_scale:new c.cj(it),u_reset_depth:new c.cj(it)}),circle:c.dY,collisionBox:it=>({u_matrix:new c.cl(it),u_inv_rot_matrix:new c.cl(it),u_camera_to_center_distance:new c.cj(it),u_extrude_scale:new c.ck(it),u_zoom_transition:new c.cj(it),u_merc_center:new c.ck(it),u_tile_id:new c.ci(it)}),collisionCircle:it=>({u_matrix:new c.cl(it),u_inv_matrix:new c.cl(it),u_camera_to_center_distance:new c.cj(it),u_viewport_size:new c.ck(it)}),debug:it=>({u_color:new c.dB(it),u_matrix:new c.cl(it),u_overlay:new c.ch(it),u_overlay_scale:new c.cj(it)}),clippingMask:it=>({u_matrix:new c.cl(it)}),heatmap:it=>({u_extrude_scale:new c.cj(it),u_intensity:new c.cj(it),u_matrix:new c.cl(it),u_inv_rot_matrix:new c.cl(it),u_merc_center:new c.ck(it),u_tile_id:new c.ci(it),u_zoom_transition:new c.cj(it),u_up_dir:new c.ci(it)}),heatmapTexture:it=>({u_image:new c.ch(it),u_color_ramp:new c.ch(it),u_opacity:new c.cj(it)}),hillshade:it=>({u_matrix:new c.cl(it),u_image:new c.ch(it),u_latrange:new c.ck(it),u_light:new c.ck(it),u_shadow:new c.dB(it),u_highlight:new c.dB(it),u_emissive_strength:new c.cj(it),u_accent:new c.dB(it)}),hillshadePrepare:it=>({u_matrix:new c.cl(it),u_image:new c.ch(it),u_dimension:new c.ck(it),u_zoom:new c.cj(it)}),line:c.dX,linePattern:c.dW,raster:it=>({u_matrix:new c.cl(it),u_normalize_matrix:new c.cl(it),u_globe_matrix:new c.cl(it),u_merc_matrix:new c.cl(it),u_grid_matrix:new c.dC(it),u_tl_parent:new c.ck(it),u_scale_parent:new c.cj(it),u_fade_t:new c.cj(it),u_opacity:new c.cj(it),u_image0:new c.ch(it),u_image1:new c.ch(it),u_brightness_low:new c.cj(it),u_brightness_high:new c.cj(it),u_saturation_factor:new c.cj(it),u_contrast_factor:new c.cj(it),u_spin_weights:new c.ci(it),u_perspective_transform:new c.ck(it),u_raster_elevation:new c.cj(it),u_zoom_transition:new c.cj(it),u_merc_center:new c.ck(it),u_cutoff_params:new c.d3(it),u_colorization_mix:new c.d3(it),u_colorization_offset:new c.cj(it),u_color_ramp:new c.ch(it),u_texture_offset:new c.ck(it),u_texture_res:new c.ck(it),u_emissive_strength:new c.cj(it)}),rasterParticle:it=>({u_matrix:new c.cl(it),u_normalize_matrix:new c.cl(it),u_globe_matrix:new c.cl(it),u_merc_matrix:new c.cl(it),u_grid_matrix:new c.dC(it),u_tl_parent:new c.ck(it),u_scale_parent:new c.cj(it),u_fade_t:new c.cj(it),u_opacity:new c.cj(it),u_image0:new c.ch(it),u_image1:new c.ch(it),u_raster_elevation:new c.cj(it),u_zoom_transition:new c.cj(it),u_merc_center:new c.ck(it),u_cutoff_params:new c.d3(it)}),rasterParticleTexture:it=>({u_texture:new c.ch(it),u_opacity:new c.cj(it)}),rasterParticleDraw:it=>({u_particle_texture:new c.ch(it),u_particle_texture_side_len:new c.cj(it),u_tile_offset:new c.ck(it),u_velocity:new c.ch(it),u_color_ramp:new c.ch(it),u_velocity_res:new c.ck(it),u_max_speed:new c.cj(it),u_uv_offset:new c.ck(it),u_data_scale:new c.ck(it),u_data_offset:new c.cj(it),u_particle_pos_scale:new c.cj(it),u_particle_pos_offset:new c.ck(it)}),rasterParticleUpdate:it=>({u_particle_texture:new c.ch(it),u_particle_texture_side_len:new c.cj(it),u_velocity:new c.ch(it),u_velocity_res:new c.ck(it),u_max_speed:new c.cj(it),u_speed_factor:new c.cj(it),u_reset_rate:new c.cj(it),u_rand_seed:new c.cj(it),u_uv_offset:new c.ck(it),u_data_scale:new c.ck(it),u_data_offset:new c.cj(it),u_particle_pos_scale:new c.cj(it),u_particle_pos_offset:new c.ck(it)}),symbol:it=>({u_is_size_zoom_constant:new c.ch(it),u_is_size_feature_constant:new c.ch(it),u_size_t:new c.cj(it),u_size:new c.cj(it),u_camera_to_center_distance:new c.cj(it),u_rotate_symbol:new c.ch(it),u_aspect_ratio:new c.cj(it),u_fade_change:new c.cj(it),u_matrix:new c.cl(it),u_label_plane_matrix:new c.cl(it),u_coord_matrix:new c.cl(it),u_is_text:new c.ch(it),u_elevation_from_sea:new c.ch(it),u_pitch_with_map:new c.ch(it),u_texsize:new c.ck(it),u_texsize_icon:new c.ck(it),u_texture:new c.ch(it),u_texture_icon:new c.ch(it),u_gamma_scale:new c.cj(it),u_device_pixel_ratio:new c.cj(it),u_tile_id:new c.ci(it),u_zoom_transition:new c.cj(it),u_inv_rot_matrix:new c.cl(it),u_merc_center:new c.ck(it),u_camera_forward:new c.ci(it),u_tile_matrix:new c.cl(it),u_up_vector:new c.ci(it),u_ecef_origin:new c.ci(it),u_is_halo:new c.ch(it),u_icon_transition:new c.cj(it),u_color_adj_mat:new c.cl(it),u_scale_factor:new c.cj(it),u_ground_shadow_factor:new c.ci(it),u_inv_matrix:new c.cl(it),u_normal_scale:new c.cj(it),u_lutTexture:new c.ch(it)}),background:it=>({u_matrix:new c.cl(it),u_emissive_strength:new c.cj(it),u_opacity:new c.cj(it),u_color:new c.dB(it)}),backgroundPattern:it=>({u_matrix:new c.cl(it),u_emissive_strength:new c.cj(it),u_opacity:new c.cj(it),u_image:new c.ch(it),u_pattern_tl:new c.ck(it),u_pattern_br:new c.ck(it),u_texsize:new c.ck(it),u_pattern_size:new c.ck(it),u_pixel_coord_upper:new c.ck(it),u_pixel_coord_lower:new c.ck(it),u_pattern_units_to_pixels:new c.ck(it)}),terrainRaster:it=>({u_matrix:new c.cl(it),u_image0:new c.ch(it),u_image1:new c.ch(it),u_skirt_height:new c.cj(it),u_ground_shadow_factor:new c.ci(it),u_emissive_texture_available:new c.cj(it)}),skybox:it=>({u_matrix:new c.cl(it),u_sun_direction:new c.ci(it),u_cubemap:new c.ch(it),u_opacity:new c.cj(it),u_temporal_offset:new c.cj(it)}),skyboxGradient:it=>({u_matrix:new c.cl(it),u_color_ramp:new c.ch(it),u_center_direction:new c.ci(it),u_radius:new c.cj(it),u_opacity:new c.cj(it),u_temporal_offset:new c.cj(it)}),skyboxCapture:it=>({u_matrix_3f:new c.dC(it),u_sun_direction:new c.ci(it),u_sun_intensity:new c.cj(it),u_color_tint_r:new c.d3(it),u_color_tint_m:new c.d3(it),u_luminance:new c.cj(it)}),globeRaster:it=>({u_proj_matrix:new c.cl(it),u_globe_matrix:new c.cl(it),u_normalize_matrix:new c.cl(it),u_merc_matrix:new c.cl(it),u_zoom_transition:new c.cj(it),u_merc_center:new c.ck(it),u_image0:new c.ch(it),u_image1:new c.ch(it),u_grid_matrix:new c.dC(it),u_skirt_height:new c.cj(it),u_far_z_cutoff:new c.cj(it),u_frustum_tl:new c.ci(it),u_frustum_tr:new c.ci(it),u_frustum_br:new c.ci(it),u_frustum_bl:new c.ci(it),u_globe_pos:new c.ci(it),u_globe_radius:new c.cj(it),u_viewport:new c.ck(it),u_emissive_texture_available:new c.cj(it)}),globeAtmosphere:it=>({u_frustum_tl:new c.ci(it),u_frustum_tr:new c.ci(it),u_frustum_br:new c.ci(it),u_frustum_bl:new c.ci(it),u_horizon:new c.cj(it),u_transition:new c.cj(it),u_fadeout_range:new c.cj(it),u_atmosphere_fog_color:new c.d3(it),u_high_color:new c.d3(it),u_space_color:new c.d3(it),u_temporal_offset:new c.cj(it),u_horizon_angle:new c.cj(it)}),model:it=>({u_matrix:new c.cl(it),u_lighting_matrix:new c.cl(it),u_normal_matrix:new c.cl(it),u_node_matrix:new c.cl(it),u_lightpos:new c.ci(it),u_lightintensity:new c.cj(it),u_lightcolor:new c.ci(it),u_camera_pos:new c.ci(it),u_opacity:new c.cj(it),u_baseColorFactor:new c.d3(it),u_emissiveFactor:new c.d3(it),u_metallicFactor:new c.cj(it),u_roughnessFactor:new c.cj(it),u_baseTextureIsAlpha:new c.ch(it),u_alphaMask:new c.ch(it),u_alphaCutoff:new c.cj(it),u_baseColorTexture:new c.ch(it),u_metallicRoughnessTexture:new c.ch(it),u_normalTexture:new c.ch(it),u_occlusionTexture:new c.ch(it),u_emissionTexture:new c.ch(it),u_lutTexture:new c.ch(it),u_color_mix:new c.d3(it),u_aoIntensity:new c.cj(it),u_emissive_strength:new c.cj(it),u_occlusionTextureTransform:new c.d3(it)}),modelDepth:it=>({u_matrix:new c.cl(it),u_instance:new c.cl(it),u_node_matrix:new c.cl(it)}),groundShadow:it=>({u_matrix:new c.cl(it),u_ground_shadow_factor:new c.ci(it)}),stars:it=>({u_matrix:new c.cl(it),u_up:new c.ci(it),u_right:new c.ci(it),u_intensity_multiplier:new c.cj(it)}),snowParticle:it=>({u_modelview:new c.cl(it),u_projection:new c.cl(it),u_time:new c.cj(it),u_cam_pos:new c.ci(it),u_velocityConeAperture:new c.cj(it),u_velocity:new c.cj(it),u_horizontalOscillationRadius:new c.cj(it),u_horizontalOscillationRate:new c.cj(it),u_boxSize:new c.cj(it),u_billboardSize:new c.cj(it),u_simpleShapeParameters:new c.ck(it),u_screenSize:new c.ck(it),u_thinningCenterPos:new c.ck(it),u_thinningShape:new c.ci(it),u_thinningAffectedRatio:new c.cj(it),u_thinningParticleOffset:new c.cj(it),u_particleColor:new c.d3(it),u_direction:new c.ci(it)}),rainParticle:it=>({u_modelview:new c.cl(it),u_projection:new c.cl(it),u_time:new c.cj(it),u_cam_pos:new c.ci(it),u_texScreen:new c.ch(it),u_velocityConeAperture:new c.cj(it),u_velocity:new c.cj(it),u_boxSize:new c.cj(it),u_rainDropletSize:new c.ck(it),u_distortionStrength:new c.cj(it),u_rainDirection:new c.ci(it),u_color:new c.d3(it),u_screenSize:new c.ck(it),u_thinningCenterPos:new c.ck(it),u_thinningShape:new c.ci(it),u_thinningAffectedRatio:new c.cj(it),u_thinningParticleOffset:new c.cj(it),u_shapeDirectionalPower:new c.cj(it),u_shapeNormalPower:new c.cj(it),u_mode:new c.cj(it)}),vignette:it=>({u_vignetteShape:new c.ci(it),u_vignetteColor:new c.d3(it)}),occlusion:it=>({u_matrix:new c.cl(it),u_anchorPos:new c.ci(it),u_screenSizePx:new c.ck(it),u_occluderSizePx:new c.ck(it),u_color:new c.d3(it)})};class wp{constructor(d,$,st,lt){this.id=wp.uniqueIdxCounter,wp.uniqueIdxCounter++,this.context=d;const ht=d.gl;this.buffer=ht.createBuffer(),this.dynamicDraw=!!st,this.context.unbindVAO(),d.bindElementBuffer.set(this.buffer),ht.bufferData(ht.ELEMENT_ARRAY_BUFFER,$.arrayBuffer,this.dynamicDraw?ht.DYNAMIC_DRAW:ht.STATIC_DRAW),this.dynamicDraw||lt||$.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(d){this.id=wp.uniqueIdxCounter,wp.uniqueIdxCounter++;const $=this.context.gl;this.context.unbindVAO(),this.bind(),$.bufferSubData($.ELEMENT_ARRAY_BUFFER,0,d.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}wp.uniqueIdxCounter=0;const Fv={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Dw{constructor(d,$,st,lt,ht,dt){this.length=$.length,this.attributes=st,this.itemSize=$.bytesPerElement,this.dynamicDraw=lt,this.instanceCount=dt,this.context=d;const mt=d.gl;this.buffer=mt.createBuffer(),d.bindVertexBuffer.set(this.buffer),mt.bufferData(mt.ARRAY_BUFFER,$.arrayBuffer,this.dynamicDraw?mt.DYNAMIC_DRAW:mt.STATIC_DRAW),this.dynamicDraw||ht||$.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(d){const $=this.context.gl;this.bind(),$.bufferSubData($.ARRAY_BUFFER,0,d.arrayBuffer)}enableAttributes(d,$){for(let st=0;st<this.attributes.length;st++){const lt=$.getAttributeLocation(d,this.attributes[st].name);lt!==-1&&d.enableVertexAttribArray(lt)}}setVertexAttribPointers(d,$,st){for(let lt=0;lt<this.attributes.length;lt++){const ht=this.attributes[lt],dt=$.getAttributeLocation(d,ht.name);dt!==-1&&d.vertexAttribPointer(dt,ht.components,d[Fv[ht.type]],!1,this.itemSize,ht.offset+this.itemSize*(st||0))}}setVertexAttribDivisor(d,$,st){for(let lt=0;lt<this.attributes.length;lt++){const ht=$.getAttributeLocation(d,this.attributes[lt].name);ht!==-1&&this.instanceCount&&this.instanceCount>0&&d.vertexAttribDivisor(ht,st)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Nw{constructor(d,$,st,lt,ht){this.context=d,this.width=$,this.height=st;const dt=this.framebuffer=d.gl.createFramebuffer();lt>0&&(this.colorAttachment0=new Oy(d,dt,0)),lt>1&&(this.colorAttachment1=new Oy(d,dt,1)),ht&&(this.depthAttachmentType=ht,this.depthAttachment=ht==="renderbuffer"?new k0(d,dt):new S_(d,dt))}createColorAttachment(d,$){$===0?this.colorAttachment0=new Oy(d,this.framebuffer,0):$===1&&(this.colorAttachment1=new Oy(d,this.framebuffer,1))}removeColorAttachment(d,$){const st=this.context.gl;let lt;$===0?(lt=this.colorAttachment0.get(),this.colorAttachment0=void 0):$===1&&(lt=this.colorAttachment1.get(),this.colorAttachment1=void 0),lt&&st.deleteTexture(lt)}destroy(){const d=this.context.gl;if(this.colorAttachment0){const $=this.colorAttachment0.get();$&&d.deleteTexture($)}if(this.colorAttachment1){const $=this.colorAttachment1.get();$&&d.deleteTexture($)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const $=this.depthAttachment.get();$&&d.deleteRenderbuffer($)}else{const $=this.depthAttachment.get();$&&d.deleteTexture($)}d.deleteFramebuffer(this.framebuffer)}}class O0{constructor(d,$){this.gl=d,this.clearColor=new aT(this),this.clearDepth=new dw(this),this.clearStencil=new vv(this),this.colorMask=new ky(this),this.depthMask=new bv(this),this.stencilMask=new r0(this),this.stencilFunc=new A0(this),this.stencilOp=new E_(this),this.stencilTest=new R0(this),this.depthRange=new pw(this),this.depthTest=new wv(this),this.depthFunc=new fw(this),this.blend=new I0(this),this.blendFunc=new My(this),this.blendColor=new Dy(this),this.blendEquation=new Ev(this),this.cullFace=new Ny(this),this.cullFaceSide=new T_(this),this.frontFace=new mw(this),this.program=new gw(this),this.activeTexture=new _w(this),this.viewport=new P0(this),this.bindFramebuffer=new yw(this),this.bindRenderbuffer=new lT(this),this.bindTexture=new cT(this),this.bindVertexBuffer=new uT(this),this.bindElementBuffer=new Tv(this),this.bindVertexArrayOES=new Sv(this),this.pixelStoreUnpack=new Cv(this),this.pixelStoreUnpackPremultiplyAlpha=new Av(this),this.pixelStoreUnpackFlipY=new xw(this),this.options=$?Object.assign({},$):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=d.getExtension("EXT_texture_filter_anisotropic")||d.getExtension("MOZ_EXT_texture_filter_anisotropic")||d.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=d.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=d.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=d.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=d.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=$&&!!$.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=d.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=d.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=d.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=d.getParameter(d.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=d.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(d,$,st){return new wp(this,d,$,st)}createVertexBuffer(d,$,st,lt,ht){return new Dw(this,d,$,st,lt,ht)}createRenderbuffer(d,$,st){const lt=this.gl,ht=lt.createRenderbuffer();return this.bindRenderbuffer.set(ht),lt.renderbufferStorage(lt.RENDERBUFFER,d,$,st),this.bindRenderbuffer.set(null),ht}createFramebuffer(d,$,st,lt){return new Nw(this,d,$,st,lt)}clear({color:d,depth:$,stencil:st,colorMask:lt}){const ht=this.gl;let dt=0;d&&(dt|=ht.COLOR_BUFFER_BIT,this.clearColor.set(d.toNonPremultipliedRenderColor(null)),this.colorMask.set(lt||[!0,!0,!0,!0])),$!==void 0&&(dt|=ht.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set($),this.depthMask.set(!0)),st!==void 0&&(dt|=ht.STENCIL_BUFFER_BIT,this.clearStencil.set(st),this.stencilMask.set(255)),ht.clear(dt)}setCullFace(d){d.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(d.mode),this.frontFace.set(d.frontFace))}setDepthMode(d){d.func!==this.gl.ALWAYS||d.mask?(this.depthTest.set(!0),this.depthFunc.set(d.func),this.depthMask.set(d.mask),this.depthRange.set(d.range)):this.depthTest.set(!1)}setStencilMode(d){d.test.func!==this.gl.ALWAYS||d.mask?(this.stencilTest.set(!0),this.stencilMask.set(d.mask),this.stencilOp.set([d.fail,d.depthFail,d.pass]),this.stencilFunc.set({func:d.test.func,ref:d.ref,mask:d.test.mask})):this.stencilTest.set(!1)}setColorMode(d){c.by(d.blendFunction,Ps.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(d.blendFunction),this.blendColor.set(d.blendColor),d.blendEquation?this.blendEquation.set(d.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(d.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let s0;function qn(it,d,$,st,lt,ht,dt){const mt=it.context,Tt=mt.gl,Pt=it.transform,Mt=[c.aF(Pt.center.lng),c.aJ(Pt.center.lat)],Ht=$.layout.get("symbol-placement"),$t=$.layout.get("text-variable-anchor"),qt=$.layout.get("icon-rotation-alignment")==="map",Qt=$.layout.get("text-rotation-alignment")==="map",Xt=Ht!=="point",sr=[];let ir=0,hr=0;for(let vr=0;vr<st.length;vr++){const Pr=st[vr],Br=d.getTile(Pr),Or=Br.getBucket($);if(!Or)continue;const Yr=Or.getProjection().createInversionMatrix(Pt,Pr.canonical),Qr=[],un=fy(Pr,Or,Pt),Cn=!dt&&qt&&Xt,qr=dt&&Qt&&Xt,Nr=$t&&Or.hasTextData(),tn=Or.hasIconTextFit()&&Nr&&Or.hasIconData(),Kr=Cn||qr||dt&&Nr||tn,yn=Or.projection.name==="globe",Ln=yn?c.aj(Pt.zoom):0;yn&&(Qr.push("PROJECTION_GLOBE_VIEW"),Kr&&Qr.push("PROJECTED_POS_ON_VIEWPORT"));const Un=it.getOrCreateProgram("collisionBox",{defines:Qr});let kn=un;lt[0]===0&&lt[1]===0||(kn=it.translatePosMatrix(un,Br,lt,ht));const An=dt?Or.textCollisionBox:Or.iconCollisionBox,Qn=Or.collisionCircleArray;if(Qn.length>0){const zn=c.bC(),Gn=kn;c.cP(zn,Or.placementInvProjMatrix,Pt.glCoordMatrix),c.cP(zn,zn,Or.placementViewportMatrix),sr.push({circleArray:Qn,circleOffset:hr,transform:Gn,invTransform:zn,projection:Or.getProjection()}),ir+=Qn.length/4,hr=ir}if(!An)continue;it.terrain&&it.terrain.setupElevationDraw(Br,Un);const Kn=yn?[Pr.canonical.x,Pr.canonical.y,1<<Pr.canonical.z]:[0,0,0];Un.draw(it,Tt.LINES,es.disabled,_s.disabled,it.colorModeForRenderPass(),gs.disabled,Ov(kn,Yr,Pt,Ln,Mt,Br,Kn,Or.getProjection()),$.id,An.layoutVertexBuffer,An.indexBuffer,An.segments,null,Pt.zoom,null,[An.collisionVertexBuffer,An.collisionVertexBufferExt])}if(!dt||!sr.length)return;const mr=it.getOrCreateProgram("collisionCircle"),dr=new c.dZ;dr.resize(4*ir),dr._trim();let Ir=0;for(const vr of sr)for(let Pr=0;Pr<vr.circleArray.length/4;Pr++){const Br=4*Pr,Or=vr.circleArray[Br+0],Yr=vr.circleArray[Br+1],Qr=vr.circleArray[Br+2],un=vr.circleArray[Br+3];dr.emplace(Ir++,Or,Yr,Qr,un,0),dr.emplace(Ir++,Or,Yr,Qr,un,1),dr.emplace(Ir++,Or,Yr,Qr,un,2),dr.emplace(Ir++,Or,Yr,Qr,un,3)}(!s0||s0.length<2*ir)&&(s0=function(vr){const Pr=2*vr,Br=new c.b0;Br.resize(Pr),Br._trim();for(let Or=0;Or<Pr;Or++){const Yr=6*Or;Br.uint16[Yr+0]=4*Or+0,Br.uint16[Yr+1]=4*Or+1,Br.uint16[Yr+2]=4*Or+2,Br.uint16[Yr+3]=4*Or+2,Br.uint16[Yr+4]=4*Or+3,Br.uint16[Yr+5]=4*Or+0}return Br}(ir));const Tr=mt.createIndexBuffer(s0,!0),Ar=mt.createVertexBuffer(dr,c.d_.members,!0);for(const vr of sr){const Pr={u_matrix:vr.transform,u_inv_matrix:vr.invTransform,u_camera_to_center_distance:(Er=Pt).getCameraToCenterDistance(vr.projection),u_viewport_size:[Er.width,Er.height]};mr.draw(it,Tt.TRIANGLES,es.disabled,_s.disabled,it.colorModeForRenderPass(),gs.disabled,Pr,$.id,Ar,Tr,c.bg.simpleSegment(0,2*vr.circleOffset,vr.circleArray.length,vr.circleArray.length/2),null,Pt.zoom)}var Er;Ar.destroy(),Tr.destroy()}const k_=c.bC();function _f(it){const d=it._camera.getWorldToCamera(it.worldSize,1),$=c.aB([],d,it.globeMatrix);c.bl($,$);const st=[0,0,0],lt=[0,1,0,0];return c.aC(lt,lt,$),st[0]=lt[0],st[1]=lt[1],st[2]=lt[2],c.aw(st,st),st}function Nm({width:it,height:d,anchor:$,textOffset:st,textScale:lt},ht){const{horizontalAlign:dt,verticalAlign:mt}=c.c1($),Tt=-(dt-.5)*it,Pt=-(mt-.5)*d,Mt=c.c2($,st);return new c.P((Tt/lt+Mt[0])*ht,(Pt/lt+Mt[1])*ht)}function cs(it,d,$,st,lt,ht,dt,mt,Tt,Pt){const Mt=it.text.placedSymbolArray,Ht=it.text.dynamicLayoutVertexArray,$t=it.icon.dynamicLayoutVertexArray,qt={},Qt=it.getProjection(),Xt=Np(dt,Qt,lt),sr=lt.elevation,ir=Qt.upVectorScale(dt.canonical,lt.center.lat,lt.worldSize).metersToTile;Ht.clear();for(let hr=0;hr<Mt.length;hr++){const mr=Mt.get(hr),{tileAnchorX:dr,tileAnchorY:Ir,numGlyphs:Tr}=mr,Ar=mr.hidden||!mr.crossTileID||it.allowVerticalPlacement&&!mr.placedOrientation?null:st[mr.crossTileID];if(Ar){let Er=0,vr=0,Pr=0;const Br=it.elevationType==="road";if(sr||Br){const Kr=Br?it.getElevationFeatureForText(hr):null,yn=c.bV.getAtTileOffset(dt,new c.P(dr,Ir),sr,Kr),[Ln,Un,kn]=Qt.upVector(dt.canonical,dr,Ir);Er=yn*Ln*ir,vr=yn*Un*ir,Pr=yn*kn*ir}let[Or,Yr,Qr,un]=np(mr.projectedAnchorX+Er,mr.projectedAnchorY+vr,mr.projectedAnchorZ+Pr,$?Xt:ht);const Cn=fo(lt.getCameraToCenterDistance(Qt),un);let qr=c.bM(it.textSizeData,Tt,mr)*Cn/c.bY;$&&(qr*=it.tilePixelRatio/mt);const Nr=Nm(Ar,qr);$?({x:Or,y:Yr,z:Qr}=Qt.projectTilePoint(dr+Nr.x,Ir+Nr.y,dt.canonical),[Or,Yr,Qr]=np(Or+Er,Yr+vr,Qr+Pr,ht)):(d&&Nr._rotate(-lt.angle),Or+=Nr.x,Yr+=Nr.y,Qr=0);const tn=it.allowVerticalPlacement&&mr.placedOrientation===c.bL.vertical?Math.PI/2:0;for(let Kr=0;Kr<Tr;Kr++)c.bO(Ht,Or,Yr,Qr,tn);Pt&&mr.associatedIconIndex>=0&&(qt[mr.associatedIconIndex]={x:Or,y:Yr,z:Qr,angle:tn})}else xp(Tr,Ht)}if(Pt){$t.clear();const hr=it.icon.placedSymbolArray;for(let mr=0;mr<hr.length;mr++){const dr=hr.get(mr),{numGlyphs:Ir}=dr,Tr=qt[mr];if(dr.hidden||!Tr)xp(Ir,$t);else{const{x:Ar,y:Er,z:vr,angle:Pr}=Tr;for(let Br=0;Br<Ir;Br++)c.bO($t,Ar,Er,vr,Pr)}}it.icon.dynamicLayoutVertexBuffer.updateData($t)}it.text.dynamicLayoutVertexBuffer.updateData(Ht)}function M_(it,d,$,st,lt,ht,dt={}){const mt=$.paint.get("icon-translate"),Tt=$.paint.get("text-translate"),Pt=$.paint.get("icon-translate-anchor"),Mt=$.paint.get("text-translate-anchor"),Ht=$.layout.get("icon-rotation-alignment"),$t=$.layout.get("text-rotation-alignment"),qt=$.layout.get("icon-pitch-alignment"),Qt=$.layout.get("text-pitch-alignment"),Xt=$.layout.get("icon-keep-upright"),sr=$.layout.get("text-keep-upright"),ir=$.paint.get("icon-color-saturation"),hr=$.paint.get("icon-color-contrast"),mr=$.paint.get("icon-color-brightness-min"),dr=$.paint.get("icon-color-brightness-max"),Ir=$.layout.get("symbol-elevation-reference")==="sea",Tr=$.layout.get("icon-image-use-theme")==="none",Ar=it.context,Er=Ar.gl,vr=it.transform,Pr=Ht==="map",Br=$t==="map",Or=qt==="map",Yr=Qt==="map",Qr=$.layout.get("symbol-sort-key").constantOr(1)!==void 0;let un=!1;const Cn=it.depthModeForSublayer(0,es.ReadOnly),qr=new es(it.context.gl.LEQUAL,es.ReadOnly,it.depthRangeFor3D),Nr=[c.aF(vr.center.lng),c.aJ(vr.center.lat)],tn=$.layout.get("text-variable-anchor"),Kr=vr.projection.name==="globe",yn=[],Ln=[0,-1,0];for(const Un of st){const kn=d.getTile(Un),An=kn.getBucket($);if(!An||An.projection.name==="mercator"&&Kr||An.fullyClipped)continue;const Qn=An.projection.name==="globe",Kn=Qn?c.aj(vr.zoom):0,zn=Np(Un,An.getProjection(),vr),Gn=vr.calculatePixelsToTileUnitsMatrix(kn),as=tn&&An.hasTextData(),Es=An.hasIconTextFit()&&as&&An.hasIconData(),$s=An.getProjection().createInversionMatrix(vr,Un.canonical),so=(1<<kn.tileID.canonical.z)*c.al/it.transform.worldSize,Jn=uo=>{let Ys=[0,0,0];if(uo){const Ds=it.style.directionalLight,Lo=it.style.ambientLight;Ds&&Lo&&(Ys=Qp(it.style,Ds,Lo))}return Ys},ro=uo=>{vr.depthOcclusionForSymbolsAndCircles&&($.hasOcclusionOpacityProperties||it.terrain)&&(uo.push("DEPTH_D24"),uo.push("DEPTH_OCCLUSION"))},bs=uo=>{$.lut&&!Tr&&($.lut.texture||($.lut.texture=new c.d$(it.context,$.lut.image,[$.lut.image.height,$.lut.image.height,$.lut.image.height],Ar.gl.RGBA8)),Ar.activeTexture.set(Ar.gl.TEXTURE0+_c.LUT),$.lut.texture&&$.lut.texture.bind(Ar.gl.LINEAR,Ar.gl.CLAMP_TO_EDGE),uo.push("APPLY_LUT_ON_GPU"))},co=()=>{const uo=Pr&&$.layout.get("symbol-placement")!=="point",Ys=[];ro(Ys),bs(Ys);const Ds=uo||Es,Lo=An.elevationType==="road",_l=it.shadowRenderer,Ho=Lo&&Or&&!!_l&&_l.enabled,So=Jn(Ho),Pu=Lo&&Or&&!it.terrain?qr:Cn,cu=$.paint.get("icon-image-cross-fade");it.terrainRenderModeElevated()&&Or&&Ys.push("PITCH_WITH_MAP_TERRAIN"),Qn&&(Ys.push("PROJECTION_GLOBE_VIEW"),Ds&&Ys.push("PROJECTED_POS_ON_VIEWPORT")),cu>0&&An.hasAnySecondaryIcon&&Ys.push("ICON_TRANSITION"),!An.icon.zOffsetVertexBuffer||Lo&&it.terrain||Ys.push("Z_OFFSET"),ir===0&&hr===0&&mr===0&&dr===1||Ys.push("COLOR_ADJUSTMENT"),An.sdfIcons&&Ys.push("RENDER_SDF"),Ho&&Ys.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Lo&&Or&&!it.terrain&&An.icon.orientationVertexBuffer&&Ys.push("ELEVATED_ROADS");const zl=An.icon.programConfigurations.get($.id),gu=it.getOrCreateProgram("symbol",{config:zl,defines:Ys}),_u=kn.imageAtlasTexture?kn.imageAtlasTexture.size:[0,0],nu=An.iconSizeData,Zu=c.bK(nu,vr.zoom),pp=Or||!vr.isOrthographic,ju=wu(zn,kn.tileID.canonical,Or,Pr,vr,An.getProjection(),Gn),_a=p_(zn,kn.tileID.canonical,Or,Pr,vr,An.getProjection(),Gn),wl=it.translatePosMatrix(_a,kn,mt,Pt,!0),Co=it.translatePosMatrix(zn,kn,mt,Pt),Al=Ds?k_:ju,Yo=Pr&&!Or&&!uo;let Wo=Ln;!Kr&&!vr.mercatorFromTransition||Pr||(Wo=_f(vr));const fp=Qn?Wo:Ln,G_=$.getColorAdjustmentMatrix(ir,hr,mr,dr),Sp=Wy(nu.kind,Zu,Yo,Or,it,Co,Al,wl,Ir,!1,_u,[0,0],0,Un,Kn,Nr,$s,fp,An.getProjection(),So,so,G_,cu,null),H_=kn.imageAtlasTexture?kn.imageAtlasTexture:null,H0=$.layout.get("icon-size").constantOr(0)!==1||An.iconsNeedLinear,Gp=An.sdfIcons||it.options.rotating||it.options.zooming||H0||pp?Er.LINEAR:Er.NEAREST,cm=An.sdfIcons&&$.paint.get("icon-halo-width").constantOr(1)!==0,W0=it.terrain&&Or&&uo?c.bl(c.bC(),ju):k_;if(uo&&An.icon){const Bm=c.bV.getAtTileOffsetFunc(Un,vr.center.lat,vr.worldSize,An.getProjection()),um=my(zn,kn.tileID.canonical,Or,Pr,vr,An.getProjection(),Gn),Cp=$.layout.get("icon-size-scale-range"),hm=c.aA(it.scaleFactor,Cp[0],Cp[1]);iw(An,zn,it,!1,um,_a,Or,Xt,Bm,Un,hm)}return{program:gu,buffers:An.icon,uniformValues:Sp,atlasTexture:H_,atlasTextureIcon:null,atlasInterpolation:Gp,atlasInterpolationIcon:null,isSDF:An.sdfIcons,hasHalo:cm,depthMode:Pu,tile:kn,renderWithShadows:Ho,labelPlaneMatrixInv:W0}},xo=()=>{const uo=Br&&$.layout.get("symbol-placement")!=="point",Ys=[],Ds=uo||tn||Es,Lo=An.elevationType==="road",_l=it.shadowRenderer,Ho=Lo&&Yr&&!!_l&&_l.enabled,So=Jn(Ho),Pu=Lo&&Yr&&!it.terrain?qr:Cn;it.terrainRenderModeElevated()&&Yr&&Ys.push("PITCH_WITH_MAP_TERRAIN"),Qn&&(Ys.push("PROJECTION_GLOBE_VIEW"),Ds&&Ys.push("PROJECTED_POS_ON_VIEWPORT")),!An.text.zOffsetVertexBuffer||Lo&&it.terrain||Ys.push("Z_OFFSET"),An.iconsInText&&Ys.push("RENDER_TEXT_AND_SYMBOL"),Ys.push("RENDER_SDF"),Ho&&Ys.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Lo&&Yr&&!it.terrain&&An.text.orientationVertexBuffer&&Ys.push("ELEVATED_ROADS"),ro(Ys);const cu=An.text.programConfigurations.get($.id),zl=it.getOrCreateProgram("symbol",{config:cu,defines:Ys});let gu,_u=[0,0],nu=null;const Zu=An.textSizeData;An.iconsInText&&(_u=kn.imageAtlasTexture?kn.imageAtlasTexture.size:[0,0],nu=kn.imageAtlasTexture?kn.imageAtlasTexture:null,gu=Yr||!vr.isOrthographic||it.options.rotating||it.options.zooming||Zu.kind==="composite"||Zu.kind==="camera"?Er.LINEAR:Er.NEAREST);const pp=kn.glyphAtlasTexture?kn.glyphAtlasTexture.size:[0,0],ju=$.layout.get("text-size-scale-range"),_a=c.aA(it.scaleFactor,ju[0],ju[1]),wl=c.bK(Zu,vr.zoom,_a),Co=wu(zn,kn.tileID.canonical,Yr,Br,vr,An.getProjection(),Gn),Al=p_(zn,kn.tileID.canonical,Yr,Br,vr,An.getProjection(),Gn),Yo=it.translatePosMatrix(Al,kn,Tt,Mt,!0),Wo=it.translatePosMatrix(zn,kn,Tt,Mt),fp=Ds?k_:Co,G_=Br&&!Yr&&!uo;let Sp=Ln;!Kr&&!vr.mercatorFromTransition||Br||(Sp=_f(vr));const H_=Wy(Zu.kind,wl,G_,Yr,it,Wo,fp,Yo,Ir,!0,pp,_u,0,Un,Kn,Nr,$s,Qn?Sp:Ln,An.getProjection(),So,so,null,null,_a),H0=kn.glyphAtlasTexture?kn.glyphAtlasTexture:null,Gp=Er.LINEAR,cm=$.paint.get("text-halo-width").constantOr(1)!==0,W0=it.terrain&&Yr&&uo?c.bl(c.bC(),Co):k_;if(uo&&An.text){const Bm=c.bV.getAtTileOffsetFunc(Un,vr.center.lat,vr.worldSize,An.getProjection()),um=my(zn,kn.tileID.canonical,Yr,Br,vr,An.getProjection(),Gn);iw(An,zn,it,!0,um,Al,Yr,sr,Bm,Un,_a)}return{program:zl,buffers:An.text,uniformValues:H_,atlasTexture:H0,atlasTextureIcon:nu,atlasInterpolation:Gp,atlasInterpolationIcon:gu,isSDF:!0,hasHalo:cm,depthMode:Pu,tile:kn,renderWithShadows:Ho,labelPlaneMatrixInv:W0}},mo=An.icon.segments.get().length,to=An.text.segments.get().length,Ms=mo&&!dt.onlyText?co():null,ao=to&&!dt.onlyIcons?xo():null,Zo=$.paint.get("icon-opacity").constantOr(1),Bo=$.paint.get("text-opacity").constantOr(1);if(Qr&&An.canOverlap){un=!0;const uo=Zo&&!dt.onlyText?An.icon.segments.get():[],Ys=Bo&&!dt.onlyIcons?An.text.segments.get():[];for(const Ds of uo)yn.push({segments:new c.bg([Ds]),sortKey:Ds.sortKey,state:Ms});for(const Ds of Ys)yn.push({segments:new c.bg([Ds]),sortKey:Ds.sortKey,state:ao})}else dt.onlyText||yn.push({segments:Zo?An.icon.segments:new c.bg([]),sortKey:0,state:Ms}),dt.onlyIcons||yn.push({segments:Bo?An.text.segments:new c.bg([]),sortKey:0,state:ao})}un&&yn.sort((Un,kn)=>Un.sortKey-kn.sortKey);for(const Un of yn){const kn=Un.state;if(kn)if(it.terrain?it.terrain.setupElevationDraw(kn.tile,kn.program,{useDepthForOcclusion:vr.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:kn.labelPlaneMatrixInv}):it.setupDepthForOcclusion(vr.depthOcclusionForSymbolsAndCircles,kn.program),Ar.activeTexture.set(Er.TEXTURE0),kn.atlasTexture&&kn.atlasTexture.bind(kn.atlasInterpolation,Er.CLAMP_TO_EDGE,!0),kn.atlasTextureIcon&&(Ar.activeTexture.set(Er.TEXTURE1),kn.atlasTextureIcon&&kn.atlasTextureIcon.bind(kn.atlasInterpolationIcon,Er.CLAMP_TO_EDGE,!0)),kn.renderWithShadows&&it.shadowRenderer.setupShadows(kn.tile.tileID.toUnwrapped(),kn.program,"vector-tile"),it.uploadCommonLightUniforms(it.context,kn.program),kn.hasHalo){const An=kn.uniformValues;An.u_is_halo=1,Bv(kn.buffers,Un.segments,$,it,kn.program,kn.depthMode,lt,ht,An,2),An.u_is_halo=0}else{if(kn.isSDF){const An=kn.uniformValues;kn.hasHalo&&(An.u_is_halo=1,Bv(kn.buffers,Un.segments,$,it,kn.program,kn.depthMode,lt,ht,An,1)),An.u_is_halo=0}Bv(kn.buffers,Un.segments,$,it,kn.program,kn.depthMode,lt,ht,kn.uniformValues,1)}}}function Bv(it,d,$,st,lt,ht,dt,mt,Tt,Pt){const Mt=[it.dynamicLayoutVertexBuffer,it.opacityVertexBuffer,it.iconTransitioningVertexBuffer,it.globeExtVertexBuffer,it.zOffsetVertexBuffer,it.orientationVertexBuffer];lt.draw(st,st.context.gl.TRIANGLES,ht,dt,mt,gs.disabled,Tt,$.id,it.layoutVertexBuffer,it.indexBuffer,d,$.paint,st.transform.zoom,it.programConfigurations.get($.id),Mt,Pt)}function Lw(it,d){const $=1<<it.canonical.z,st=(d.x*$-it.canonical.x-it.wrap*$)*c.al,lt=(d.y*$-it.canonical.y)*c.al,ht=c.e8(d.z,d.y);return c.d5(st,lt,ht)}function Ky(it,d,$,st,lt){if(!$.layout||$.layout.get("fill-elevation-reference")==="none"||$.paint.get("fill-opacity").constantOr(1)===0)return;const ht=it.context.gl,dt=new es(it.context.gl.LEQUAL,es.ReadWrite,it.depthRangeFor3D),mt=new es(it.context.gl.GREATER,es.ReadWrite,it.depthRangeFor3D),Tt=function(qt){let Qt=.01;return qt.isOrthographic&&(Qt=c.ak(1e-4,Qt,c.d0(qt.pitch>=bp?1:qt.pitch/bp))),2*Qt}(it.transform),Pt=it.transform.getFreeCameraOptions().position,Mt="elevatedStructuresDepthReconstruct",Ht=it.getOrCreateProgram(Mt,{defines:["DEPTH_RECONSTRUCTION"]}),$t=it.getOrCreateProgram(Mt);for(const qt of st){const Qt=d.getTile(qt),Xt=Qt.getBucket($);if(!Xt)continue;const sr=Xt.elevatedStructures;if(!sr)continue;const ir=Xt.elevationBufferData.heightRange,hr=Lw(qt.toUnwrapped(),Pt),mr=it.translatePosMatrix(qt.projMatrix,Qt,$.paint.get("fill-translate"),$.paint.get("fill-translate-anchor"));let dr,Ir,Tr,Ar;if(lt==="initialize"){if(!ir||ir.min>=1||sr.depthSegments.segments[0].primitiveLength===0)continue;dr=i0(mr,hr,Tt,1,0),Ir=dt,Tr=sr.depthSegments,Ar=Ht}else if(lt==="reset"){if(!ir||ir.min>=0||sr.maskSegments.segments[0].primitiveLength===0)continue;dr=i0(mr,hr,0,0,1),Ir=mt,Tr=sr.maskSegments,Ar=Ht}else if(lt==="geometry"){if(sr.depthSegments.segments[0].primitiveLength===0)continue;dr=i0(mr,hr,Tt,1,0),Ir=dt,Tr=sr.depthSegments,Ar=$t}Ar.draw(it,ht.TRIANGLES,Ir,_s.disabled,Ps.disabled,gs.disabled,dr,$.id,sr.vertexBuffer,sr.indexBuffer,Tr,$.paint,it.transform.zoom)}}function Xy(it,d,$,st){const{painter:lt,sourceCache:ht,layer:dt,coords:mt,colorMode:Tt,elevationType:Pt,terrainEnabled:Mt,pass:Ht}=it,$t=lt.context.gl,qt=dt.paint.get("fill-pattern"),Qt=dt.paint.get("fill-pattern-cross-fade"),Xt=qt.constantOr(null);let sr=Pt;Pt!=="road"||d&&!Mt||(sr="none");const ir=sr==="road",hr=it.painter.shadowRenderer,mr=ir&&!!hr&&hr.enabled,dr=new es(lt.context.gl.LEQUAL,es.ReadOnly,lt.depthRangeFor3D);let Ir=[0,0,0];if(mr){const vr=lt.style.directionalLight,Pr=lt.style.ambientLight;vr&&Pr&&(Ir=Qp(lt.style,vr,Pr))}const Tr=qt&&qt.constantOr(1),Ar=lt.terrain&&lt.terrain.renderingToTexture,Er=(vr,Pr)=>{let Br,Or,Yr,Qr,un;Pr?(Br=Tr&&!dt.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Yr=$t.LINES):(Br=Tr?"fillPattern":"fill",Yr=$t.TRIANGLES);for(const Cn of mt){const qr=ht.getTile(Cn);if(Tr&&!qr.patternsLoaded())continue;const Nr=qr.getBucket(dt);if(!Nr)continue;const tn=d?Nr.elevationBufferData:Nr.bufferData;if(tn.isEmpty())continue;lt.prepareDrawTile();const Kr=tn.programConfigurations.get(dt.id),yn=lt.isTileAffectedByFog(Cn),Ln=[],Un=[];ir&&(Ln.push("ELEVATED_ROADS"),Un.push(tn.elevatedLayoutVertexBuffer)),mr&&Ln.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ar&&$&&Ln.push("USE_MRT1"),Tr&&(lt.context.activeTexture.set($t.TEXTURE0),qr.imageAtlasTexture&&qr.imageAtlasTexture.bind($t.LINEAR,$t.CLAMP_TO_EDGE),Kr.updatePaintBuffers());let kn=!1;if(Xt&&qr.imageAtlas){const Gn=qr.imageAtlas,as=c.e3.from(Xt),Es=as.getPrimary().scaleSelf(c.o.devicePixelRatio).toString(),$s=as.getSecondary(),so=Gn.patternPositions.get(Es),Jn=$s?Gn.patternPositions.get($s.scaleSelf(c.o.devicePixelRatio).toString()):null;kn=!!so&&!!Jn,so&&Kr.setConstantPatternPositions(so,Jn)}Qt>0&&(kn||Kr.getPatternTransitionVertexBuffer("fill-pattern"))&&Ln.push("FILL_PATTERN_TRANSITION");const An=lt.getOrCreateProgram(Br,{config:Kr,overrideFog:yn,defines:Ln}),Qn=lt.translatePosMatrix(Cn.projMatrix,qr,dt.paint.get("fill-translate"),dt.paint.get("fill-translate-anchor"));mr&&hr.setupShadows(qr.tileID.toUnwrapped(),An,"vector-tile");const Kn=dt.paint.get("fill-emissive-strength");if(Pr){Qr=tn.lineIndexBuffer,un=tn.lineSegments;const Gn=lt.terrain&&lt.terrain.renderingToTexture?lt.terrain.drapeBufferSize:[$t.drawingBufferWidth,$t.drawingBufferHeight];Or=Br==="fillOutlinePattern"&&Tr?Lv(Qn,Kn,lt,qr,Gn,Ir,Qt):Sw(Qn,Kn,Gn,Ir)}else Qr=tn.indexBuffer,un=tn.triangleSegments,Or=Tr?Nv(Qn,Kn,lt,qr,Ir,Qt):Dv(Qn,Kn,Ir);lt.uploadCommonUniforms(lt.context,An,Cn.toUnwrapped());let zn=vr;(Pt==="road"&&!Mt||Pt==="offset")&&(zn=dr),An.draw(lt,Yr,zn,st||lt.stencilModeForClipping(Cn),Tt,gs.disabled,Or,dt.id,tn.layoutVertexBuffer,Qr,un,dt.paint,lt.transform.zoom,Kr,Un)}};lt.renderPass===Ht&&Er(lt.depthModeForSublayer(1,lt.renderPass==="opaque"?es.ReadWrite:es.ReadOnly),!1),sr==="none"&&lt.renderPass==="translucent"&&dt.paint.get("fill-antialias")&&Er(lt.depthModeForSublayer(dt.getPaintProperty("fill-outline-color")?2:0,es.ReadOnly),!0)}function Zy(it,d,$,st,lt,ht,dt,mt){$.resetLayerRenderingStats(it);const Tt=it.context,Pt=Tt.gl,Mt=it.transform,Ht=$.paint.get("fill-extrusion-pattern"),$t=$.paint.get("fill-extrusion-pattern-cross-fade"),qt=Ht.constantOr(null),Qt=Ht.constantOr(1),Xt=$.paint.get("fill-extrusion-opacity"),sr=it.style.enable3dLights(),ir=$.paint.get(sr&&!Qt?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),hr=[$.paint.get("fill-extrusion-ambient-occlusion-intensity"),ir],mr=$.layout.get("fill-extrusion-edge-radius"),dr=mr>0&&!$.paint.get("fill-extrusion-rounded-roof"),Ir=dr?0:mr,Tr=Mt.projection.name==="globe"?c.eb():0,Ar=Mt.projection.name==="globe",Er=Ar?c.aj(Mt.zoom):0,vr=[c.aF(Mt.center.lng),c.aJ(Mt.center.lat)],Pr=$.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Br=$.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Pr?null:$.lut).toArray01().slice(0,3),Or=$.paint.get("fill-extrusion-flood-light-intensity"),Yr=$.paint.get("fill-extrusion-vertical-scale"),Qr=$.paint.get("fill-extrusion-line-width").constantOr(1)!==0,un=$.paint.get("fill-extrusion-height-alignment"),Cn=$.paint.get("fill-extrusion-base-alignment"),qr=Sm(it,$.paint.get("fill-extrusion-cutoff-fade-range")),Nr=[];let tn;Ar&&Nr.push("PROJECTION_GLOBE_VIEW"),hr[0]>0&&Nr.push("FAUX_AO"),dr&&Nr.push("ZERO_ROOF_RADIUS"),mt&&Nr.push("HAS_CENTROID"),Or>0&&Nr.push("FLOOD_LIGHT"),qr.shouldRenderCutoff&&Nr.push("RENDER_CUTOFF"),Qr&&Nr.push("RENDER_WALL_MODE");const Kr=it.renderPass==="shadow",yn=it.shadowRenderer,Ln=Kr&&!!yn,Un=Kr?gs.disabled:gs.backCCW;it.shadowRenderer&&(it.shadowRenderer.useNormalOffset=!0);let kn=[0,0,0];if(yn){const Kn=it.style.directionalLight,zn=it.style.ambientLight;Kn&&zn&&(kn=Qp(it.style,Kn,zn)),Kr||(Nr.push("RENDER_SHADOWS","DEPTH_TEXTURE"),yn.useNormalOffset&&Nr.push("NORMAL_OFFSET")),tn=Nr.concat(["SHADOWS_SINGLE_CASCADE"])}const An=Ln?"fillExtrusionDepth":Qt?"fillExtrusionPattern":"fillExtrusion",Qn=$.getLayerRenderingStats();for(const Kn of st){const zn=d.getTile(Kn),Gn=zn.getBucket($);if(!Gn||Gn.projection.name!==Mt.projection.name)continue;let as=!1;yn&&(as=yn.getMaxCascadeForTile(Kn.toUnwrapped())===0);const Es=it.isTileAffectedByFog(Kn),$s=Gn.programConfigurations.get($.id);let so=!1;if(qt&&zn.imageAtlas){const to=zn.imageAtlas,Ms=c.e3.from(qt),ao=Ms.getPrimary().scaleSelf(c.o.devicePixelRatio).toString(),Zo=Ms.getSecondary(),Bo=to.patternPositions.get(ao),uo=Zo?to.patternPositions.get(Zo.scaleSelf(c.o.devicePixelRatio).toString()):null;so=!!Bo&&!!uo,Bo&&$s.setConstantPatternPositions(Bo,uo)}$t>0&&(so||$s.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Nr.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Jn=it.getOrCreateProgram(An,{config:$s,defines:as?tn:Nr,overrideFog:Es});if(it.terrain&&it.terrain.setupElevationDraw(zn,Jn,{useMeterToDem:!0}),!Gn.centroidVertexBuffer){const to=Jn.getAttributeLocation(Pt,"a_centroid_pos");to!==-1&&Pt.vertexAttrib2f(to,0,0)}!Kr&&yn&&yn.setupShadows(zn.tileID.toUnwrapped(),Jn,"vector-tile"),Qt&&(it.context.activeTexture.set(Pt.TEXTURE0),zn.imageAtlasTexture&&zn.imageAtlasTexture.bind(Pt.LINEAR,Pt.CLAMP_TO_EDGE),$s.updatePaintBuffers());const ro=$.paint.get("fill-extrusion-vertical-gradient"),bs=1/Gn.tileToMeter;let co;if(Kr&&yn){if(tm(zn.tileID,Gn.maxHeight,it))continue;const to=yn.calculateShadowPassMatrixFromTile(zn.tileID.toUnwrapped());co=Mv(to,Ir,bs,Yr,un,Cn)}else{const to=it.translatePosMatrix(Kn.expandedProjMatrix,zn,$.paint.get("fill-extrusion-translate"),$.paint.get("fill-extrusion-translate-anchor")),Ms=Mt.projection.createInversionMatrix(Mt,Kn.canonical);co=Qt?Tw(to,it,ro,Xt,hr,Ir,bs,Kn,zn,Tr,un,Cn,Er,vr,Ms,Br,Yr,$t):Uy(to,it,ro,Xt,hr,Ir,bs,Kn,Tr,un,Cn,Er,vr,Ms,Br,Yr,Or,kn)}it.uploadCommonUniforms(Tt,Jn,Kn.toUnwrapped(),null,qr);let xo=Gn.segments;if(Mt.projection.name==="mercator"&&!Kr&&(xo=Gn.getVisibleSegments(zn.tileID,it.terrain,it.transform.getFrustum(0)),!xo.get().length))continue;if(Qn)if(Kr)for(const to of xo.get())Qn.numRenderedVerticesInShadowPass+=to.primitiveLength;else for(const to of xo.get())Qn.numRenderedVerticesInTransparentPass+=to.primitiveLength;const mo=[];(it.terrain||mt)&&mo.push(Gn.centroidVertexBuffer),Ar&&mo.push(Gn.layoutVertexExtBuffer),Qr&&mo.push(Gn.wallVertexBuffer),Jn.draw(it,Tt.gl.TRIANGLES,lt,ht,dt,Un,co,$.id,Gn.layoutVertexBuffer,Gn.indexBuffer,xo,$.paint,it.transform.zoom,$s,mo)}it.shadowRenderer&&(it.shadowRenderer.useNormalOffset=!1)}class zv{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function em(it,d,$,st,lt,ht,dt,mt,Tt,Pt,Mt,Ht,$t,qt,Qt,Xt,sr,ir,hr,mr){const dr=d.context,Ir=dr.gl,Tr=d.transform,Ar=d.transform.zoom,Er=[],vr=it.translate,Pr=it.translateAnchor,Br=it.edgeRadius,Or=Sm(d,it.cutoffFadeRange);Mt==="clear"?(Er.push("CLEAR_SUBPASS"),mr&&(Er.push("CLEAR_FROM_TEXTURE"),dr.activeTexture.set(Ir.TEXTURE0),mr.bind(Ir.LINEAR,Ir.CLAMP_TO_EDGE))):Mt==="sdf"?Er.push("SDF_SUBPASS"):Mt==="emissive"&&(Er.push("USE_MRT1"),dr.activeTexture.set(Ir.TEXTURE0),mr.bind(Ir.LINEAR,Ir.CLAMP_TO_EDGE)),ir&&Er.push("HAS_CENTROID"),Or.shouldRenderCutoff&&Er.push("RENDER_CUTOFF");const Yr=(Qr,un,Cn,qr,Nr)=>{let tn=Er;un.groundRadiusBuffer!=null&&(tn=Er.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const Kr=un.programConfigurations.get(st.id),yn=d.isTileAffectedByFog(Qr),Ln=d.getOrCreateProgram("fillExtrusionGroundEffect",{config:Kr,defines:tn,overrideFog:yn}),Un=N0(d,qr,Ht,Pt,Nr,[$t,qt*Nr],Qt,Xt,sr,Ar>=17?0:Br*Nr,mr?mr.size[0]:0),kn=[];ir&&kn.push(un.hiddenByLandmarkVertexBuffer),un.groundRadiusBuffer!=null&&kn.push(un.groundRadiusBuffer),d.uploadCommonUniforms(dr,Ln,Qr.toUnwrapped(),null,Or),Ln.draw(d,dr.gl.TRIANGLES,ht,dt,mt,Tt,Un,st.id,un.vertexBuffer,un.indexBuffer,Cn,st.paint,Ar,Kr,kn)};for(const Qr of lt){const un=$.getTile(Qr),Cn=un.getBucket(st);if(!Cn||Cn.projection.name!==Tr.projection.name||!Cn.groundEffect||Cn.groundEffect&&!Cn.groundEffect.hasData())continue;const qr=Cn.groundEffect,Nr=1/Cn.tileToMeter;{const tn=d.translatePosMatrix(Qr.projMatrix,un,vr,Pr),Kr=qr.getDefaultSegment();Yr(Qr,qr,Kr,tn,Nr)}if(hr)for(let tn=0;tn<4;tn++){const Kr=c.e9[tn](Qr),yn=$.getTile(Kr);if(!yn)continue;const Ln=yn.getBucket(st);if(!Ln||Ln.projection.name!==Tr.projection.name||!Ln.groundEffect||Ln.groundEffect&&!Ln.groundEffect.hasData())continue;const Un=Ln.groundEffect;let kn,An;tn===0?(kn=[-c.al,0,0],An=1):tn===1?(kn=[c.al,0,0],An=0):tn===2?(kn=[0,-c.al,0],An=3):(kn=[0,c.al,0],An=2);const Qn=Un.regionSegments[An];if(!Qn)continue;const Kn=new Float32Array(16);c.br(Kn,Qr.projMatrix,kn),Yr(Qr,Un,Qn,d.translatePosMatrix(Kn,un,vr,Pr),Nr)}}}function gT(it,d,$,st,lt,ht,dt){st.centroidVertexArray.length===0&&st.createCentroidsBuffer();const mt=ht?ht.findDEMTileFor($):null;if(!(mt&&mt.dem||dt))return;ht&&mt&&mt.dem&&st.selfDEMTileTimestamp!==mt.dem._timestamp&&(st.borderDoneWithNeighborZ=[-1,-1,-1,-1],st.selfDEMTileTimestamp=mt.dem._timestamp);const Tt=ir=>new c.P(Math.ceil((ir+c.ed)*c.ee),0),Pt=ir=>{const hr=d.getSource().minzoom,mr=Ir=>{const Tr=d.getTileByID(Ir);if(Tr&&Tr.hasData())return Tr.getBucket(lt)},dr=[0,-1,1];for(const Ir of dr){if(ir.overscaledZ+Ir<hr)continue;const Tr=mr(ir.calculateScaledKey(ir.overscaledZ+Ir));if(Tr)return Tr}},Mt=[0,0,0],Ht=(ir,hr)=>(Mt[0]=Math.min(ir.min.y,hr.min.y),Mt[1]=Math.max(ir.max.y,hr.max.y),Mt[2]=c.al-hr.min.x>ir.max.x?hr.min.x-c.al:ir.max.x,Mt),$t=(ir,hr)=>(Mt[0]=Math.min(ir.min.x,hr.min.x),Mt[1]=Math.max(ir.max.x,hr.max.x),Mt[2]=c.al-hr.min.y>ir.max.y?hr.min.y-c.al:ir.max.y,Mt),qt=[(ir,hr)=>Ht(ir,hr),(ir,hr)=>Ht(hr,ir),(ir,hr)=>$t(ir,hr),(ir,hr)=>$t(hr,ir)],Qt=(ir,hr,mr,dr,Ir,Tr,Ar)=>{if(!ht)return 0;const Er=[[Tr?mr:ir,Tr?ir:mr,0],[Tr?mr:hr,Tr?hr:mr,0]],vr=Ar<0?c.al+Ar:Ar,Pr=[Tr?vr:(ir+hr)/2,Tr?(ir+hr)/2:vr,0];return mr===0&&Ar<0||mr!==0&&Ar>0?ht.getForTilePoints(Ir,[Pr],!0,dr):Er.push(Pr),ht.getForTilePoints($,Er,!0,mt),Math.max(Er[0][2],Er[1][2],Pr[2])/ht.exaggeration()};for(let ir=0;ir<4;ir++){const hr=st.borderFeatureIndices[ir];if(hr.length===0)continue;const mr=c.e9[ir]($),dr=Pt(mr);if(!(dr&&dr instanceof c.ea))continue;const Ir=ht?ht.findDEMTileFor(mr):null;if(!(Ir&&Ir.dem||dt)||(ht&&Ir&&Ir.dem&&st.borderDEMTileTimestamp[ir]!==Ir.dem._timestamp&&(st.borderDoneWithNeighborZ[ir]=-1,st.borderDEMTileTimestamp[ir]=Ir.dem._timestamp),st.borderDoneWithNeighborZ[ir]===dr.canonical.z))continue;dr.centroidVertexArray.length===0&&dr.createCentroidsBuffer();const Tr=(ir<2?1:5)-ir,Ar=dr.borderDoneWithNeighborZ[Tr]!==st.canonical.z,Er=dr.borderFeatureIndices[Tr];let vr=0;if(st.canonical.z!==dr.canonical.z){for(const Pr of hr)st.showCentroid(st.featuresOnBorder[Pr]);if(Ar)for(const Pr of Er)dr.showCentroid(dr.featuresOnBorder[Pr]);st.borderDoneWithNeighborZ[ir]=dr.canonical.z,dr.borderDoneWithNeighborZ[Tr]=st.canonical.z}for(const Pr of hr){const Br=st.featuresOnBorder[Pr],Or=st.centroidData[Br.centroidDataIndex],Yr=Br.borders[ir];let Qr;for(;vr<Er.length;){Qr=dr.featuresOnBorder[Er[vr]];const un=Qr.borders[Tr];if(un[1]>Yr[0]+3||un[0]>Yr[0]-3)break;dr.showCentroid(Qr),vr++}if(Qr&&vr<Er.length){const un=vr;let Cn=0;for(;!(Qr.borders[Tr][0]>Yr[1]-3)&&(Cn++,++vr!==Er.length);)Qr=dr.featuresOnBorder[Er[vr]];Qr=dr.featuresOnBorder[Er[un]];let qr=!1;if(Cn>=1){const Kr=Qr.borders[Tr];Math.abs(Yr[0]-Kr[0])<3&&Math.abs(Yr[1]-Kr[1])<3&&(Cn=1,qr=!0,vr=un+1)}else if(Cn===0){st.showCentroid(Br);continue}const Nr=dr.centroidData[Qr.centroidDataIndex];dt&&qr&&(((Xt=Or).flags|(sr=Nr).flags)&c.ec?(Xt.flags|=c.ec,sr.flags|=c.ec):(Xt.flags&=~c.ec,sr.flags&=~c.ec));const tn=Br.intersectsCount()>1||Qr.intersectsCount()>1;if(Cn>1)vr=un,Or.centroidXY=Nr.centroidXY=new c.P(0,0);else if(Ir&&Ir.dem&&!tn){const Kr=qt[ir](Or,Nr),yn=ir%2?c.al-1:0,Ln=Qt(Kr[0],Math.min(c.al-1,Kr[1]),yn,Ir,mr,ir<2,Kr[2]);Or.centroidXY=Nr.centroidXY=Tt(Ln)}else tn?Or.centroidXY=Nr.centroidXY=new c.P(0,0):(Or.centroidXY=st.encodeBorderCentroid(Br),Nr.centroidXY=dr.encodeBorderCentroid(Qr));st.writeCentroidToBuffer(Or),dr.writeCentroidToBuffer(Nr)}else st.showCentroid(Br)}st.borderDoneWithNeighborZ[ir]=dr.canonical.z,dr.borderDoneWithNeighborZ[Tr]=st.canonical.z}var Xt,sr;(st.needsCentroidUpdate||!st.centroidVertexBuffer&&st.centroidVertexArray.length!==0)&&st.uploadCentroid(it)}const Vu=[1,0,0],Vv=[0,1,0],Ru=[0,0,1];function tm(it,d,$){const st=$.transform,lt=$.shadowRenderer;if(!lt)return!0;const ht=it.toUnwrapped(),dt=st.tileSize*lt._cascades[$.currentShadowCascade].scale;let mt=d;if(st.elevation){const Xt=st.elevation.getMinMaxForTile(it);Xt&&(mt+=Xt.max)}const Tt=[...lt.shadowDirection];Tt[2]=-Tt[2];const Pt=lt.computeSimplifiedTileShadowVolume(ht,mt,dt,Tt);if(!Pt)return!1;const Mt=[Vu,Vv,Ru,Tt,[Tt[0],0,Tt[2]],[0,Tt[1],Tt[2]]],Ht=st.projection.name==="globe",$t=st.scaleZoom(dt),qt=c.cB.fromInvProjectionMatrix(st.invProjMatrix,st.worldSize,$t,!Ht),Qt=lt.getCurrentCascadeFrustum();return qt.intersectsPrecise(Pt.vertices,Pt.planes,Mt)===0||Qt.intersectsPrecise(Pt.vertices,Pt.planes,Mt)===0}function D_(it){const{painter:d,source:$,layer:st,coords:lt}=it;let ht=it.defines;const dt=d.context,mt=d.renderPass==="shadow",Tt=d.renderPass==="light-beam",Pt=d.shadowRenderer,Mt=c.ef(d.transform.center.lat,d.transform.zoom),Ht=Sm(d,st.paint.get("building-cutoff-fade-range"));Ht.shouldRenderCutoff&&(ht=ht.concat("RENDER_CUTOFF")),it.floodLightIntensity>0&&(ht=ht.concat("FLOOD_LIGHT"));for(const $t of lt){const qt=$.getTile($t),Qt=qt.getBucket(st);if(!Qt)continue;Pt&&Pt.getMaxCascadeForTile($t.toUnwrapped())===0&&(ht=ht.concat("SHADOWS_SINGLE_CASCADE"));const Xt=Qt.programConfigurations.get(st.id);let sr,ir,hr,mr=d.translatePosMatrix($t.expandedProjMatrix,qt,[0,0],"map");if(mr=c.cS(c.bC(),mr,[1,1,it.verticalScale]),mt&&Pt){if(tm(qt.tileID,Qt.maxHeight*Mt,d))continue;let Ir=Pt.calculateShadowPassMatrixFromTile(qt.tileID.toUnwrapped());Ir=c.cS(c.bC(),Ir,[1,1,it.verticalScale]),hr=Mm(Ir),sr=ir=d.getOrCreateProgram("buildingDepth",{config:Xt,defines:ht,overrideFog:!1})}else if(Tt)sr=ir=d.getOrCreateProgram("buildingBloom",{config:Xt,defines:ht,overrideFog:!1}),hr=Cw(mr);else{const Ir=d.transform.calculatePosMatrix($t.toUnwrapped(),d.transform.worldSize);c.cS(Ir,Ir,[1,1,it.verticalScale]);const Tr=c.bC();c.cS(Tr,Ir,[1,-1,1/Mt]),c.bl(Tr,Tr),c.eg(Tr,Tr);const Ar=d.transform.getFreeCameraOptions().position,Er=1<<$t.canonical.z;if(hr=$y(mr,Tr,it.opacity,it.facadeAOIntensity,[((Ar.x-$t.wrap)*Er-$t.canonical.x)*c.al,(Ar.y*Er-$t.canonical.y)*c.al,Ar.z*Er*c.al],Qt.tileToMeter,it.facadeEmissiveChance,it.floodLightColor,it.floodLightIntensity),ir=d.getOrCreateProgram("building",{config:Xt,defines:ht,overrideFog:!1}),it.depthOnly===!0)sr=ir;else{const vr=ht.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);sr=d.getOrCreateProgram("building",{config:Xt,defines:vr,overrideFog:!1})}Pt&&(Pt.setupShadowsFromMatrix(Ir,ir,!0),sr!==ir&&Pt.setupShadowsFromMatrix(Ir,sr,!0))}const dr=(Ir,Tr)=>{if(Tt){const Ar=Ir.entranceBloom;Tr.draw(d,dt.gl.TRIANGLES,it.depthMode,_s.disabled,it.blendMode,gs.disabled,hr,st.id,Ar.layoutVertexBuffer,Ar.indexBuffer,Ar.segmentsBucket,st.paint,d.transform.zoom,Xt,[Ar.layoutAttenuationBuffer,Ar.layoutColorBuffer])}else{const Ar=Ir.segmentsBucket;let Er=[Ir.layoutNormalBuffer,Ir.layoutCentroidBuffer,Ir.layoutColorBuffer,Ir.layoutFloodLightDataBuffer];Ir.layoutFacadePaintBuffer&&(Er=Er.concat([Ir.layoutFacadeDataBuffer,Ir.layoutFacadeVerticalRangeBuffer,Ir.layoutFacadePaintBuffer])),Tr.draw(d,dt.gl.TRIANGLES,it.depthMode,_s.disabled,it.blendMode,mt?gs.disabled:gs.backCW,hr,st.id,Ir.layoutVertexBuffer,Ir.indexBuffer,Ar,st.paint,d.transform.zoom,Xt,Er)}};d.uploadCommonUniforms(dt,ir,$t.toUnwrapped(),null,Ht),Qt.buildingWithoutFacade&&dr(Qt.buildingWithoutFacade,ir),Qt.buildingWithFacade&&(sr!==ir&&d.uploadCommonUniforms(dt,sr,$t.toUnwrapped(),null,Ht),dr(Qt.buildingWithFacade,sr))}}function Yy(it,d,$,st,lt,ht,dt,mt,Tt,Pt,Mt,Ht,$t){const qt=it.context.gl,Qt=it.depthModeForSublayer(1,es.ReadOnly,qt.LEQUAL,!0),Xt=.1*(1-(sr=Mt))+3*sr;var sr;const ir=it._showOverdrawInspector,hr=Ht,mr=new zv;ir||em(mr,it,d,$,st,Qt,new _s({func:qt.ALWAYS,mask:255},255,255,qt.KEEP,qt.KEEP,qt.REPLACE),new Ps([qt.ONE,qt.ONE,qt.ONE,qt.ONE],c.ao.transparent,[!1,!1,!1,!0],qt.MIN),gs.disabled,lt,"sdf",ht,dt,mt,Tt,Pt,Xt,hr,!1);{const dr=ir?_s.disabled:new _s({func:qt.EQUAL,mask:255},255,255,qt.KEEP,qt.DECR,qt.DECR),Ir=ir?it.colorModeForRenderPass():new Ps([qt.ONE_MINUS_DST_ALPHA,qt.DST_ALPHA,qt.ONE,qt.ONE],c.ao.transparent,[!0,!0,!0,!0]);em(mr,it,d,$,st,Qt,dr,Ir,gs.disabled,lt,"color",ht,dt,mt,Tt,Pt,Xt,hr,!1)}}function Qy(it){return[it[0]*c.eh,it[1]*c.eh,it[2]*c.eh,0]}function N_(it,d,$,st,lt,ht,dt,mt,Tt){const Pt=st.getSource(),Mt=$.globeSharedBuffers;if(!Mt)return;let Ht,$t,qt;if(d&&(Ht=st.getTile(d)),Pt instanceof c.aU?($t=Pt.texture,qt=c.dK(0,0,$.transform)):Ht&&d&&($t=Ht.texture,qt=c.dK(d.canonical.z,d.canonical.x,$.transform)),!$t||!qt)return;it||(qt=c.cS(c.bC(),qt,[1,-1,1]));const Qt=$.context,Xt=Qt.gl,sr=lt.paint.get("raster-resampling")==="nearest"?Xt.NEAREST:Xt.LINEAR,ir=$.colorModeForDrapableLayerRenderPass(ht),hr=dt.defines;hr.push("GLOBE_POLES");const mr=new es(Xt.LEQUAL,es.ReadWrite,$.depthRangeFor3D),dr=Float32Array.from($.transform.expandedFarZProjMatrix),Ir=Float32Array.from(c.bk(c.dJ(new c.cD(0,0,0))));$.terrain&&$.terrain.prepareDrawTile(),Qt.activeTexture.set(Xt.TEXTURE0),$t.bind(sr,Xt.CLAMP_TO_EDGE),Qt.activeTexture.set(Xt.TEXTURE1),$t.bind(sr,Xt.CLAMP_TO_EDGE),"useMipmap"in $t&&Qt.extTextureFilterAnisotropic&&$.transform.pitch>20&&Xt.texParameterf(Xt.TEXTURE_2D,Qt.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Qt.extTextureFilterAnisotropicMax);const[Tr,Ar,Er,vr]=d?Mt.getPoleBuffers(d.canonical.z,!1):Mt.getPoleBuffers(0,!0),Pr=lt.paint.get("raster-elevation");let Br;it?(Br=Tr,$.renderDefaultNorthPole=Pr!==0):(Br=Ar,$.renderDefaultSouthPole=Pr!==0);const Or=Qy(dt.mix),Yr=((un,Cn,qr,Nr,tn,Kr,yn,Ln,Un,kn,An,Qn,Kn)=>Iw(un,Cn,qr,new Float32Array(16),new Float32Array(9),[0,0],Nr,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Kr,[0,0],Ln,2,kn,An,Qn,1,0,Kn))(dr,Ir,qt,c.aj($.transform.zoom),0,lt,0,Pr,0,Or,dt.offset,dt.range,ht),Qr=$.getOrCreateProgram("raster",{defines:hr});$.uploadCommonUniforms(Qt,Qr,null),Qr.draw($,Xt.TRIANGLES,mr,Tt,ir,mt,Yr,lt.id,Br,Er,vr)}function Ow(it){const d=it._nearZ,$=it.projection.farthestPixelDistance(it),st=$-d,lt=.2*it.height,ht=d+lt;return[d,$,(ht-lt-d)/st,(ht-d)/st]}function rm(it,d,$,st){if(it)return d instanceof bu&&it instanceof hy?d.getTextureDescriptor(it,$,!0):{texture:it.texture,mix:Qy(st.mix),offset:st.offset,buffer:0,tileSize:1}}var Do=c.ei([{name:"a_index",type:"Int16",components:1}]);class Jy{constructor(d,$,st,lt){const ht={width:st[0],height:st[1],data:null},dt=d.gl;this.targetColorTexture=new c.T(d,ht,dt.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new c.T(d,ht,dt.RGBA8,{useMipmap:!1}),this.context=d,this.updateParticleTexture($,lt),this.lastInvalidatedAt=0}updateParticleTexture(d,$){if(this.particleTextureDimension===$.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const st=this.context.gl,lt=$.width*$.height;this.particleTexture0=new c.T(this.context,$,st.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new c.T(this.context,$,st.RGBA8,{premultiply:!1,useMipmap:!1});const ht=new c.ej;ht.reserve(lt);for(let dt=0;dt<lt;dt++)ht.emplaceBack(dt);this.particleIndexBuffer=this.context.createVertexBuffer(ht,Do.members,!0),this.particleSegment=c.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=$.width}update(d){return!(this.lastInvalidatedAt<d&&(this.lastInvalidatedAt=c.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Uv(it,d,$){if(!it)return null;const st=d.getTextureDescriptor(it,$,!0);if(!st)return null;let{texture:lt,mix:ht,offset:dt,tileSize:mt,buffer:Tt,format:Pt}=st;if(!lt||!Pt)return null;let Mt=!1;return Pt==="uint32"&&(Mt=!0,ht[3]=0,ht=Gy(c.ek,ht,[0,$.paint.get("raster-particle-max-speed")]),dt=Hy(c.ek,dt,[0,$.paint.get("raster-particle-max-speed")])),{texture:lt,textureOffset:[Tt/(mt+2*Tt),mt/(mt+2*Tt)],tileSize:mt,scalarData:Mt,scale:ht,offset:dt,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[Pt]]}}function jw(it){const d=it._nearZ,$=it.projection.farthestPixelDistance(it),st=$-d,lt=.2*it.height,ht=d+lt;return[d,$,(ht-lt-d)/st,(ht-d)/st]}const Fw=new c.ao(1,0,0,1),Bw=new c.ao(0,1,0,1),zw=new c.ao(0,0,1,1),o0=new c.ao(1,0,1,1),a0=new c.ao(0,1,1,1);function Pn(it,d,$,st,lt,ht){for(let dt=0;dt<$.length;dt++)if(lt){const Pt=new c.ao(st.r*.8,st.g*.8,st.b*.8,1);On(it,d,$[dt],st,-1,-1,ht),On(it,d,$[dt],st,-1,1,ht),On(it,d,$[dt],st,1,1,ht),On(it,d,$[dt],st,1,-1,ht),On(it,d,$[dt],Pt,0,0,ht)}else On(it,d,$[dt],st,0,0,ht)}function On(it,d,$,st,lt,ht,dt){const mt=it.context,Tt=it.transform,Pt=mt.gl,Mt=Tt.projection.name==="globe",Ht=Mt?["PROJECTION_GLOBE_VIEW"]:[];let $t=c.bz($.projMatrix);if(Mt&&c.aj(Tt.zoom)>0){const Or=c.bj($.canonical,Tt),Yr=c.el(Or);$t=c.aB(new Float32Array(16),Tt.globeMatrix,Yr),c.aB($t,Tt.projMatrix,$t)}const qt=c.bC();qt[12]+=2*lt/(c.o.devicePixelRatio*Tt.width),qt[13]+=2*ht/(c.o.devicePixelRatio*Tt.height),c.aB($t,qt,$t);const Qt=it.getOrCreateProgram("debug",{defines:Ht}),Xt=d.getTileByID($.key);it.terrain&&it.terrain.setupElevationDraw(Xt,Qt);const sr=es.disabled,ir=_s.disabled,hr=it.colorModeForRenderPass(),mr="$debug";mt.activeTexture.set(Pt.TEXTURE0),it.emptyTexture.bind(Pt.LINEAR,Pt.CLAMP_TO_EDGE),Mt?Xt._makeGlobeTileDebugBuffers(it.context,Tt):Xt._makeDebugTileBoundsBuffers(it.context,Tt.projection);const dr=Xt._tileDebugBuffer||it.debugBuffer,Ir=Xt._tileDebugIndexBuffer||it.debugIndexBuffer,Tr=Xt._tileDebugSegments||it.debugSegments;if(Qt.draw(it,Pt.LINE_STRIP,sr,ir,hr,gs.disabled,I_($t,st.toPremultipliedRenderColor(null)),mr,dr,Ir,Tr,null,null,null,[Xt._globeTileDebugBorderBuffer]),dt){const Or=Xt.latestRawTileData,Yr=Math.floor((Or&&Or.byteLength||0)/1024);let Qr=$.canonical.toString();$.overscaledZ!==$.canonical.z&&(Qr+=` => ${$.overscaledZ}`),Qr+=` ${Xt.state}`,Qr+=` ${Yr}kb`,function(un,Cn){un.initDebugOverlayCanvas();const qr=un.debugOverlayCanvas,Nr=un.context.gl,tn=un.debugOverlayCanvas.getContext("2d");tn.clearRect(0,0,qr.width,qr.height),tn.shadowColor="white",tn.shadowBlur=2,tn.lineWidth=1.5,tn.strokeStyle="white",tn.textBaseline="top",tn.font="bold 36px Open Sans, sans-serif",tn.fillText(Cn,5,5),tn.strokeText(Cn,5,5),un.debugOverlayTexture.update(qr),un.debugOverlayTexture.bind(Nr.LINEAR,Nr.CLAMP_TO_EDGE)}(it,Qr)}const Ar=d.getTile($).tileSize,Er=512/Math.min(Ar,512)*($.overscaledZ/Tt.zoom)*.5,vr=Xt._tileDebugTextBuffer||it.debugBuffer,Pr=Xt._tileDebugTextIndexBuffer||it.quadTriangleIndexBuffer,Br=Xt._tileDebugTextSegments||it.debugSegments;Qt.draw(it,Pt.TRIANGLES,sr,ir,Ps.alphaBlended,gs.disabled,I_($t,c.ao.transparent.toPremultipliedRenderColor(null),Er),mr,vr,Pr,Br,null,null,null,[Xt._globeTileDebugTextBuffer])}function l0(it,d,$,st){Gr(it,0,d+$/2,it.transform.width,$,st)}function ga(it,d,$,st){Gr(it,d-$/2,0,$,it.transform.height,st)}function Gr(it,d,$,st,lt,ht){const dt=it.context,mt=dt.gl;mt.enable(mt.SCISSOR_TEST),mt.scissor(d*c.o.devicePixelRatio,$*c.o.devicePixelRatio,st*c.o.devicePixelRatio,lt*c.o.devicePixelRatio),dt.clear({color:ht}),mt.disable(mt.SCISSOR_TEST)}const Vw=c.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ex}=Vw;function zp(it,d,$,st){it.emplaceBack(d,$,st)}class tx{constructor(d){this.vertexArray=new c.em,this.indices=new c.b0,zp(this.vertexArray,-1,-1,1),zp(this.vertexArray,1,-1,1),zp(this.vertexArray,-1,1,1),zp(this.vertexArray,1,1,1),zp(this.vertexArray,-1,-1,-1),zp(this.vertexArray,1,-1,-1),zp(this.vertexArray,-1,1,-1),zp(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=d.createVertexBuffer(this.vertexArray,ex),this.indexBuffer=d.createIndexBuffer(this.indices),this.segment=c.bg.simpleSegment(0,0,36,12)}}function c0(it,d,$,st,lt,ht){const dt=it.context.gl,mt=d.paint.get("sky-atmosphere-color"),Tt=d.paint.get("sky-atmosphere-halo-color"),Pt=d.paint.get("sky-atmosphere-sun-intensity"),Mt=((Ht,$t,qt,Qt,Xt)=>({u_matrix_3f:Ht,u_sun_direction:$t,u_sun_intensity:qt,u_color_tint_r:[Qt.r,Qt.g,Qt.b,Qt.a],u_color_tint_m:[Xt.r,Xt.g,Xt.b,Xt.a],u_luminance:5e-5}))(c.eo(c.dO(),st),lt,Pt,mt.toPremultipliedRenderColor(null),Tt.toPremultipliedRenderColor(null));dt.framebufferTexture2D(dt.FRAMEBUFFER,dt.COLOR_ATTACHMENT0,dt.TEXTURE_CUBE_MAP_POSITIVE_X+ht,d.skyboxTexture,0),$.draw(it,dt.TRIANGLES,es.disabled,_s.disabled,Ps.unblended,gs.frontCW,Mt,"skyboxCapture",d.skyboxGeometry.vertexBuffer,d.skyboxGeometry.indexBuffer,d.skyboxGeometry.segment)}const Uw=c.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class j0{constructor(d){const $=new c.ep;$.emplaceBack(-1,1,1,0,0),$.emplaceBack(1,1,1,1,0),$.emplaceBack(1,-1,1,1,1),$.emplaceBack(-1,-1,1,0,1);const st=new c.b0;st.emplaceBack(0,1,2),st.emplaceBack(2,3,0),this.vertexBuffer=d.createVertexBuffer($,Uw.members),this.indexBuffer=d.createIndexBuffer(st),this.segments=c.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const _T=c.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class yT{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class $w{constructor(d){this.colorModeAlphaBlendedWriteRGB=new Ps([1,Op,1,Op],c.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ps([1,0,1,0],c.ao.transparent,[!1,!1,!1,!0]),this.params=new yT,this.updateNeeded=!0}update(d){const $=d.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new j0($);const st=this.params.sizeRange,lt=this.params.intensityRange,ht=function(Mt){const Ht=c.eq(30),$t=[];for(let qt=0;qt<Mt;++qt){const Qt=2*Math.PI*Ht(),Xt=Math.acos(1-2*Ht())-.5*Math.PI;$t.push(c.d5(Math.cos(Xt)*Math.cos(Qt),Math.cos(Xt)*Math.sin(Qt),Math.sin(Xt)))}return $t}(this.params.starsCount),dt=c.eq(300),mt=new c.er,Tt=new c.b0;let Pt=0;for(let Mt=0;Mt<ht.length;++Mt){const Ht=c.c5([],ht[Mt],200),$t=Math.max(0,1+.01*st*(1*dt()-.5)),qt=Math.max(0,1+.01*lt*(1*dt()-.5));mt.emplaceBack(Ht[0],Ht[1],Ht[2],-1,-1,$t,qt),mt.emplaceBack(Ht[0],Ht[1],Ht[2],1,-1,$t,qt),mt.emplaceBack(Ht[0],Ht[1],Ht[2],1,1,$t,qt),mt.emplaceBack(Ht[0],Ht[1],Ht[2],-1,1,$t,qt),Tt.emplaceBack(Pt+0,Pt+1,Pt+2),Tt.emplaceBack(Pt+0,Pt+2,Pt+3),Pt+=4}this.starsVx=$.createVertexBuffer(mt,_T.members),this.starsIdx=$.createIndexBuffer(Tt),this.starsSegments=c.bg.simpleSegment(0,0,mt.length,Tt.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(d,$){const st=d.context,lt=st.gl,ht=d.transform,dt=new es(lt.LEQUAL,es.ReadOnly,[0,1]),mt=c.aj(ht.zoom),Tt=d.style.getLut($.scope),Pt=$.properties.get("color-use-theme")==="none",Mt=$.properties.get("color").toNonPremultipliedRenderColor(Pt?null:Tt),Ht=$.properties.get("high-color-use-theme")==="none",$t=$.properties.get("high-color").toNonPremultipliedRenderColor(Ht?null:Tt),qt=$.properties.get("space-color-use-theme")==="none",Qt=$.properties.get("space-color").toNonPremultipliedRenderColor(qt?null:Tt),Xt=5e-4,sr=c.es($.properties.get("horizon-blend"),0,1,Xt,.25),ir=c.dE(d,st,ht)&&sr===Xt?ht.worldSize/(2*Math.PI*1.025)-1:ht.globeRadius,hr=d.frameCounter/1e3%1,mr=c.ag(ht.globeCenterInViewSpace),dr=Math.sqrt(Math.pow(mr,2)-Math.pow(ir,2)),Ir=Math.acos(dr/mr),Tr=Ar=>{const Er=ht.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ar&&Er.push("ALPHA_PASS");const vr=d.getOrCreateProgram("globeAtmosphere",{defines:Er}),Pr=((Or,Yr,Qr,un,Cn,qr,Nr,tn,Kr,yn,Ln,Un)=>({u_frustum_tl:Or,u_frustum_tr:Yr,u_frustum_br:Qr,u_frustum_bl:un,u_horizon:Cn,u_transition:qr,u_fadeout_range:Nr,u_atmosphere_fog_color:tn.toArray01(),u_high_color:Kr.toArray01(),u_space_color:yn.toArray01(),u_temporal_offset:Ln,u_horizon_angle:Un}))(ht.frustumCorners.TL,ht.frustumCorners.TR,ht.frustumCorners.BR,ht.frustumCorners.BL,ht.frustumCorners.horizon,mt,sr,Mt,$t,Qt,hr,Ir);d.uploadCommonUniforms(st,vr);const Br=this.atmosphereBuffer;Br&&vr.draw(d,lt.TRIANGLES,dt,_s.disabled,Ar?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,gs.backCW,Pr,Ar?"atmosphere_glow_alpha":"atmosphere_glow",Br.vertexBuffer,Br.indexBuffer,Br.segments)};Tr(!1),Tr(!0)}drawStars(d,$){const st=c.aA($.properties.get("star-intensity"),0,1);if(st===0)return;const lt=d.context,ht=lt.gl,dt=d.transform,mt=d.getOrCreateProgram("stars"),Tt=c.c7([]);c.c9(Tt,Tt,-dt._pitch),c.c8(Tt,Tt,-dt.angle),c.c9(Tt,Tt,c.an(dt._center.lat)),c.et(Tt,Tt,-c.an(dt._center.lng));const Pt=c.cc(new Float32Array(16),Tt),Mt=c.aB([],dt.starsProjMatrix,Pt),Ht=c.eo([],Pt),$t=c.eu([],Ht),qt=[0,1,0];c.dQ(qt,qt,$t),c.c5(qt,qt,this.params.sizeMultiplier);const Qt=[1,0,0];c.dQ(Qt,Qt,$t),c.c5(Qt,Qt,this.params.sizeMultiplier);const Xt=(sr=qt,ir=Qt,hr=st,{u_matrix:Float32Array.from(Mt),u_up:sr,u_right:ir,u_intensity_multiplier:hr});var sr,ir,hr;d.uploadCommonUniforms(lt,mt),this.starsVx&&this.starsIdx&&mt.draw(d,ht.TRIANGLES,es.disabled,_s.disabled,this.colorModeAlphaBlendedWriteRGB,gs.disabled,Xt,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class rx{constructor(){this.visibleTiles=[]}updateBorders(d,$){const st=[],lt=[],ht=d._getRenderableCoordinates(!1,!0);for(const Tt of ht){const Pt=d.getTile(Tt);if(!Pt.hasData())continue;const Mt=Pt.getBucket($);Mt&&(Mt.isEmpty()||(st.push(Tt.key),lt.push({bucket:Mt,tileID:Tt.canonical})))}let dt=st.length!==this.visibleTiles.length;if(!dt){st.sort();for(let Tt=0;Tt<st.length;Tt++)if(st[Tt]!==this.visibleTiles[Tt]){dt=!0;break}}if(!dt)return;const mt=new Set;this.visibleTiles=st,lt.sort((Tt,Pt)=>Tt.tileID.z-Pt.tileID.z||Tt.tileID.x-Pt.tileID.x||Tt.tileID.y-Pt.tileID.y);for(const Tt of lt){const Pt=new Array,Mt=new Array,Ht=Tt.bucket;for(const $t of Ht.featuresOnBorder)mt.has($t.featureId)?Mt.push($t.footprintIndex):(mt.add($t.featureId),Pt.push($t.footprintIndex));Ht.updateFootprintHiddenFlags(Pt,c.ev,!1),Ht.updateFootprintHiddenFlags(Mt,c.ev,!0)}}}function ix(it,d){const $=[...it],st=d.cameraWorldSizeForFog/d.worldSize,lt=c.bA([]);return c.cS(lt,lt,[st,st,1]),c.aB($,lt,$),c.aB($,d.worldToFogMatrix,$),$}function nx(it,d,$,st,lt){const ht=$.material,dt=st.context,{baseColorTexture:mt,metallicRoughnessTexture:Tt}=ht.pbrMetallicRoughness,{normalTexture:Pt,occlusionTexture:Mt,emissionTexture:Ht}=ht;function $t(Qt,Xt,sr){if(Qt&&(it.push(Xt),dt.activeTexture.set(dt.gl.TEXTURE0+sr),Qt.gfxTexture)){const{minFilter:ir,magFilter:hr,wrapS:mr,wrapT:dr}=Qt.sampler;Qt.gfxTexture.bindExtraParam(ir,hr,mr,dr)}}$t(mt,"HAS_TEXTURE_u_baseColorTexture",_c.BaseColor),$t(Tt,"HAS_TEXTURE_u_metallicRoughnessTexture",_c.MetallicRoughness),$t(Pt,"HAS_TEXTURE_u_normalTexture",_c.Normal),$t(Mt,"HAS_TEXTURE_u_occlusionTexture",_c.Occlusion),$t(Ht,"HAS_TEXTURE_u_emissionTexture",_c.Emission),lt&&(lt.texture||(lt.texture=new c.d$(st.context,lt.image,[lt.image.height,lt.image.height,lt.image.height],dt.gl.RGBA8)),dt.activeTexture.set(dt.gl.TEXTURE0+_c.LUT),lt.texture&&lt.texture.bind(dt.gl.LINEAR,dt.gl.CLAMP_TO_EDGE),it.push("APPLY_LUT_ON_GPU")),$.texcoordBuffer&&(it.push("HAS_ATTRIBUTE_a_uv_2f"),d.push($.texcoordBuffer)),$.colorBuffer&&(it.push($.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),d.push($.colorBuffer)),$.normalBuffer&&(it.push("HAS_ATTRIBUTE_a_normal_3f"),d.push($.normalBuffer)),$.pbrBuffer&&(it.push("HAS_ATTRIBUTE_a_pbr"),it.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),d.push($.pbrBuffer)),ht.alphaMode!=="OPAQUE"&&ht.alphaMode!=="MASK"||it.push("UNPREMULT_TEXTURE_IN_SHADER"),ht.defined||it.push("DIFFUSE_SHADED");const qt=st.shadowRenderer;qt&&(it.push("RENDER_SHADOWS","DEPTH_TEXTURE"),qt.useNormalOffset&&it.push("NORMAL_OFFSET"))}function sx(it,d,$,st,lt,ht){const dt=it.modelOpacity,mt=d.context,Tt=new es(d.context.gl.LEQUAL,it.isLightMesh?es.ReadOnly:es.ReadWrite,d.depthRangeFor3D),Pt=d.transform,Mt=it.mesh,Ht=Mt.material,$t=Ht.pbrMetallicRoughness,qt=d.style.fog;let Qt;Qt=d.transform.projection.zAxisUnit==="pixels"?[...it.nodeModelMatrix]:c.aB([],st.zScaleMatrix,it.nodeModelMatrix),c.aB(Qt,st.negCameraPosMatrix,Qt);const Xt=c.bl([],Qt);c.eg(Xt,Xt);const sr=$.paint.get("model-color-use-theme").constantOr("default")==="none",ir=$.paint.get("model-emissive-strength").constantOr(0),hr=n0(new Float32Array(it.worldViewProjection),new Float32Array(Qt),new Float32Array(Xt),null,d,dt,$t.baseColorFactor,Ht.emissiveFactor,$t.metallicFactor,$t.roughnessFactor,Ht,ir,$,void 0,void 0,it.materialOverride,it.modelColor),mr={defines:[]},dr=[],Ir=d.shadowRenderer;Ir&&(Ir.useNormalOffset=!1),nx(mr.defines,dr,Mt,d,sr?null:$.lut);let Tr=null;if(qt){const vr=ix(it.nodeModelMatrix,d.transform);if(Tr=new Float32Array(vr),Pt.projection.name!=="globe"){const Pr=Mt.aabb.min,Br=Mt.aabb.max,[Or,Yr]=qt.getOpacityForBounds(vr,Pr[0],Pr[1],Br[0],Br[1]);mr.overrideFog=Or>=hn||Yr>=hn}}const Ar=Sm(d,$.paint.get("model-cutoff-fade-range"));Ar.shouldRenderCutoff&&mr.defines.push("RENDER_CUTOFF");const Er=d.getOrCreateProgram("model",mr);d.uploadCommonUniforms(mt,Er,null,Tr,Ar),d.renderPass!=="shadow"&&Ir&&Ir.setupShadowsFromMatrix(it.nodeModelMatrix,Er),Er.draw(d,mt.gl.TRIANGLES,Tt,lt,ht,Mt.material.doubleSided?gs.disabled:gs.backCCW,hr,$.id,Mt.vertexBuffer,Mt.indexBuffer,Mt.segments,$.paint,d.transform.zoom,void 0,dr)}function L_(it,d){return it.style._importedAsBasemap?"basemap":d.scope}function u0(it,d,$,st,lt,ht,dt,mt,Tt,Pt){const Mt=it.transform,Ht=!!d.isGeometryBloom&&d.isGeometryBloom;if(Ht&&it.renderPass==="shadow")return;const $t=Mt.projection.name==="globe"?c.eD($,Mt):[...$];c.aB($t,$t,d.globalMatrix);const qt=c.aB([],st,$t);if(d.meshes)for(const Qt of d.meshes){const Xt=mt.get(Qt.material.name);if(Xt&&Xt.opacity<=0)continue;if(Qt.material.alphaMode!=="BLEND"){dt.push({mesh:Qt,depth:0,modelIndex:lt,worldViewProjection:qt,nodeModelMatrix:$t,isLightMesh:Ht,materialOverride:Xt,modelOpacity:Tt,modelColor:Pt});continue}const sr=c.af([],Qt.centroid,qt);!Mt.isOrthographic&&sr[2]<=0||ht.push({mesh:Qt,depth:sr[2],modelIndex:lt,worldViewProjection:qt,nodeModelMatrix:$t,isLightMesh:Ht,materialOverride:Xt,modelOpacity:Tt,modelColor:Pt})}if(d.children)for(const Qt of d.children)u0(it,Qt,$,st,lt,ht,dt,mt,Tt,Pt)}function Ep(it,d,$,st){const lt=$.shadowRenderer;if(!lt)return;const ht=lt.getShadowPassDepthMode(),dt=lt.getShadowPassColorMode(),mt=lt.calculateShadowPassMatrixFromMatrix(d),Tt=jv(mt);$.getOrCreateProgram("modelDepth",{defines:$._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw($,$.context.gl.TRIANGLES,ht,_s.disabled,dt,gs.disabled,Tt,st.id,it.vertexBuffer,it.indexBuffer,it.segments,st.paint,$.transform.zoom,void 0,void 0)}function Gw(it,d,$,st,lt,ht){for(const dt of lt){const mt=Object.assign({},st);mt.part=dt;const Tt={type:"Unknown",id:d,properties:mt},Pt={orientation:it.paint.get("model-rotation").evaluate(Tt,$)};ht.set(dt,Pt)}}function Hw(it,d,$,st,lt,ht){for(const dt of lt){const mt=Object.assign({},st);mt.part=dt;const Tt={type:"Unknown",id:d,properties:mt},Pt={color:it.paint.get("model-color").evaluate(Tt,$),colorMix:it.paint.get("model-color-mix-intensity").evaluate(Tt,$),opacity:it.paint.get("model-opacity").evaluate(Tt,$),emissionStrength:it.paint.get("model-emissive-strength").evaluate(Tt,$)};ht.set(dt,Pt)}}function Ww(it,d,$,st,lt){let ht=!1;for(const mt of st)mt.modelOpacity!==1&&(sx(mt,it,d,lt[mt.modelIndex],_s.disabled,Ps.disabled),ht=!0);for(const mt of st)sx(mt,it,d,lt[mt.modelIndex],mt.modelOpacity!==1?it.stencilModeFor3D():_s.disabled,it.colorModeForRenderPass());ht&&it.resetStencilClippingMasks();const dt=Ps.additive;for(const mt of $)sx(mt,it,d,lt[mt.modelIndex],_s.disabled,mt.isLightMesh?dt:it.colorModeForRenderPass())}function qw(it,d,$){const st=d.updateZoomBasedPaintProperties(),lt=function(ht,dt,mt){let Tt,Pt,Mt,Ht=ht.terrain?ht.terrain.exaggeration():0;if(ht.terrain&&Ht>0){const $t=ht.terrain,qt=$t.findDEMTileFor(mt);qt&&qt.dem?Tt=c.eF.create($t,mt,qt):Ht=0}if(Ht===0&&(dt.terrainElevationMin=0,dt.terrainElevationMax=0),Ht===dt.validForExaggeration&&(Ht===0||Tt&&Tt._demTile&&Tt._demTile.tileID===dt.validForDEMTile.id&&Tt._dem._timestamp===dt.validForDEMTile.timestamp))return!1;for(const $t in dt.instancesPerModel){const qt=dt.instancesPerModel[$t];for(let Qt=0;Qt<qt.instancedDataArray.length;++Qt){const Xt=(Tt?Ht*Tt.getElevationAt(0|qt.instancedDataArray.float32[16*Qt],0|qt.instancedDataArray.float32[16*Qt+1],!0,!0):0)+qt.instancesEvaluatedElevation[Qt];qt.instancedDataArray.float32[16*Qt+6]=Xt,Pt=Pt?Math.min(dt.terrainElevationMin,Xt):Xt,Mt=Mt?Math.max(dt.terrainElevationMax,Xt):Xt}}return dt.terrainElevationMin=Pt||0,dt.terrainElevationMax=Mt||0,dt.validForExaggeration=Ht,dt.validForDEMTile=Tt&&Tt._demTile?{id:Tt._demTile.tileID,timestamp:Tt._dem._timestamp}:{id:void 0,timestamp:0},!0}(it,d,$);(st||lt)&&(d.uploaded=!1,d.upload(it.context))}const Vp={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new c.d9([0,0,0],[c.al,c.al,0])};function Iu(it,d){const $=1<<it.canonical.z,st=d.getFreeCameraOptions().position,lt=d.elevation,ht=it.canonical.x/$,dt=(it.canonical.x+1)/$,mt=it.canonical.y/$,Tt=(it.canonical.y+1)/$;let Pt=d._centerAltitude;if(lt){const qt=lt.getMinMaxForTile(it);qt&&qt.max>Pt&&(Pt=qt.max)}const Mt=c.aA(st.x,ht,dt)-st.x,Ht=c.aA(st.y,mt,Tt)-st.y,$t=c.cf(Pt,d.center.lat)-st.z;return d._zoomFromMercatorZ(Math.sqrt(Mt*Mt+Ht*Ht+$t*$t))}function Kw(it,d,$,st,lt,ht,dt){const mt=it.context,Tt=it.renderPass==="shadow",Pt=it.shadowRenderer,Mt=Tt&&Pt?Pt.getShadowPassDepthMode():new es(mt.gl.LEQUAL,es.ReadWrite,it.depthRangeFor3D),Ht=it.isTileAffectedByFog(ht),$t=it.transform.projection.name==="globe";if($.meshes)for(const qt of $.meshes){const Qt=$t?[]:["MODEL_POSITION_ON_GPU"],Xt=[];let sr,ir,hr;const mr=!$t&&st.instancedDataArray.length>20;mr&&Qt.push("INSTANCED_ARRAYS");const dr=Sm(it,d.paint.get("model-cutoff-fade-range"));if(dr.shouldRenderCutoff&&Qt.push("RENDER_CUTOFF"),Tt&&Pt)sr=it.getOrCreateProgram("modelDepth",{defines:Qt}),ir=jv(dt.shadowTileMatrix,dt.shadowTileMatrix,Float32Array.from($.globalMatrix)),hr=Pt.getShadowPassColorMode();else{nx(Qt,Xt,qt,it,d.paint.get("model-color-use-theme").constantOr("default")==="none"?null:d.lut),sr=it.getOrCreateProgram("model",{defines:Qt,overrideFog:Ht});const Tr=qt.material,Ar=Tr.pbrMetallicRoughness,Er=d.paint.get("model-opacity").constantOr(1),vr=d.paint.get("model-emissive-strength").constantOr(0);ir=n0(ht.expandedProjMatrix,Float32Array.from($.globalMatrix),new Float32Array(16),null,it,Er,Ar.baseColorFactor,Tr.emissiveFactor,Ar.metallicFactor,Ar.roughnessFactor,Tr,vr,d,lt),Pt&&(dt.shadowUniformsInitialized?sr.setShadowUniformValues(mt,Pt.getShadowUniformValues()):(Pt.setupShadows(ht.toUnwrapped(),sr,"model-tile"),dt.shadowUniformsInitialized=!0)),hr=dr.shouldRenderCutoff||Er<1||Tr.alphaMode!=="OPAQUE"?Ps.alphaBlended:Ps.unblended}it.uploadCommonUniforms(mt,sr,ht.toUnwrapped(),null,dr);const Ir=qt.material.doubleSided?gs.disabled:gs.backCCW;if(mr)Xt.push(st.instancedDataBuffer),sr.draw(it,mt.gl.TRIANGLES,Mt,_s.disabled,hr,Ir,ir,d.id,qt.vertexBuffer,qt.indexBuffer,qt.segments,d.paint,it.transform.zoom,void 0,Xt,st.instancedDataArray.length);else{const Tr=Tt?"u_instance":"u_normal_matrix";for(let Ar=0;Ar<st.instancedDataArray.length;++Ar)ir[Tr]=new Float32Array(st.instancedDataArray.arrayBuffer,64*Ar,16),sr.draw(it,mt.gl.TRIANGLES,Mt,_s.disabled,hr,Ir,ir,d.id,qt.vertexBuffer,qt.indexBuffer,qt.segments,d.paint,it.transform.zoom,void 0,Xt)}}if($.children)for(const qt of $.children)Kw(it,d,qt,st,lt,ht,dt)}const O_=[1,-1,1];function xT(it,d,$,st){if(!$.modelManager)return!0;const lt=$.modelManager;if(!$.shadowRenderer)return!0;const ht=$.shadowRenderer,dt=d.aabb;let mt=!0,Tt=it.maxHeight;if(Tt===0){let Mt=0;for(const Ht in it.instancesPerModel){const $t=lt.getModel(Ht,st);$t?Mt=Math.max(Mt,Math.max(Math.max($t.aabb.max[0],$t.aabb.max[1]),$t.aabb.max[2])):mt=!1}Tt=it.maxScale*Mt*1.41+it.maxVerticalOffset,mt&&(it.maxHeight=Tt)}dt.max[2]=Tt,dt.min[2]+=it.terrainElevationMin,dt.max[2]+=it.terrainElevationMax,c.af(dt.min,dt.min,d.tileMatrix),c.af(dt.max,dt.max,d.tileMatrix);const Pt=dt.intersects(ht.getCurrentCascadeFrustum());return $.currentShadowCascade===0&&(it.isInsideFirstShadowMapFrustum=Pt===2),Pt===0}function Fo(it,d){const $=it.uniformValues.u_cutoff_params[0],st=it.uniformValues.u_cutoff_params[1],lt=it.uniformValues.u_cutoff_params[2],ht=it.uniformValues.u_cutoff_params[3];return st===$||ht===lt?1:c.aA(((d-$)/(st-$)-lt)/(ht-lt),0,1)}function Bs(it,d,$,st){if(d.pitch<20)return 1;const lt=d.getWorldToCameraMatrix();c.aB(lt,lt,it);const ht=c.bU($.min[0],$.min[1],$.min[2],1);let dt=c.aC(c.eG(),ht,lt),mt=dt,Tt=dt;ht[1]=$.max[1],dt=c.aC(c.eG(),ht,lt),mt=dt[1]<mt[1]?dt:mt,Tt=dt[1]>Tt[1]?dt:Tt,ht[0]=$.max[0],dt=c.aC(c.eG(),ht,lt),mt=dt[1]<mt[1]?dt:mt,Tt=dt[1]>Tt[1]?dt:Tt,ht[1]=$.min[1],dt=c.aC(c.eG(),ht,lt),mt=dt[1]<mt[1]?dt:mt,Tt=dt[1]>Tt[1]?dt:Tt;const Pt=c.aA(st[0],0,1),Mt=100*d.pixelsPerMeter*c.aA(st[1],0,1),Ht=c.aA(st[2],0,1),$t=c.eH(c.eG(),mt,Tt,Pt),qt=Math.tan(.5*d.fovX),Qt=-$t[2]*qt;if(Mt===0)return $t[1]<-Math.abs(Qt)?Ht:1;const Xt=(-Math.abs(Qt)-$t[1])/Mt,sr=(hr,mr,dr)=>(1-dr)*hr+dr*mr,ir=c.aA(sr(1,Ht,Xt),Ht,1);return sr(1,ir,c.aA((d.pitch-20)/20,0,1))}class Xw{}class Lm{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(d,$,st){{const Ht=this._storage.get($.id);if(Ht)return Ht.lastUsedFrameIdx=d,Ht.buf}const lt=st.gl,ht=lt.getBufferParameter(lt.ELEMENT_ARRAY_BUFFER,lt.BUFFER_SIZE),dt=new ArrayBuffer(ht),mt=new Int16Array(dt);lt.getBufferSubData(lt.ELEMENT_ARRAY_BUFFER,0,new Int16Array(dt));const Tt=new c.eJ;for(let Ht=0;Ht<ht/2;Ht+=3){const $t=mt[Ht],qt=mt[Ht+1],Qt=mt[Ht+2];Tt.emplaceBack($t,qt),Tt.emplaceBack(qt,Qt),Tt.emplaceBack(Qt,$t)}const Pt=st.bindVertexArrayOES.current,Mt=new Xw;return Mt.buf=new wp(st,Tt),Mt.lastUsedFrameIdx=d,this._storage.set($.id,Mt),st.bindVertexArrayOES.set(Pt),Mt.buf}update(d){for(const[$,st]of this._storage)d-st.lastUsedFrameIdx>30&&(st.buf.destroy(),this._storage.delete($))}destroy(){for(const[d,$]of this._storage)$.buf.destroy(),this._storage.delete(d)}}class F0{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const B0=c.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class im{constructor(d){this.revealStart=11,this.revealRange=2}}const $v=c.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class Gv{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(d,$){const st=d.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const dt=new c.eK,mt=new c.b0;dt.emplaceBack(-1,-1),dt.emplaceBack(1,-1),dt.emplaceBack(1,1),dt.emplaceBack(-1,1),mt.emplaceBack(0,1,2),mt.emplaceBack(0,2,3),this.vignetteVx=d.context.createVertexBuffer(dt,$v.members),this.vignetteIdx=d.context.createIndexBuffer(mt)}const lt=c.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){d.uploadCommonUniforms(d.context,st);const dt={u_vignetteShape:(ht={vignetteShape:[$.start,$.range,Math.pow(10,$.fadePower)],vignetteColor:[$.color.r,$.color.g,$.color.b,$.color.a*$.strength]}).vignetteShape,u_vignetteColor:ht.vignetteColor};st.draw(d,d.context.gl.TRIANGLES,es.disabled,_s.disabled,Ps.alphaBlended,gs.disabled,dt,"vignette",this.vignetteVx,this.vignetteIdx,lt)}var ht}}class Hv{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(d,$){const st=d.getFreeCameraOptions().position,lt=st.toAltitude(),ht=st.toLngLat(),dt=c.an(ht.lng),mt=c.an(ht.lat),Tt=d.pixelsPerMeter/$,Pt=dt*c.eM,Mt=c.eM*Math.log(Math.tan(Math.PI/4+mt/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const Ht=-this._offsetYPrev+Mt,$t=-this._elevationPrev+lt;this._accumulatedOffsetX+=(-this._offsetXPrev+Pt)*Tt,this._accumulatedOffsetY+=Ht*Tt,this._accumulatedElevation+=$t*Tt,this._offsetXPrev=Pt,this._offsetYPrev=Mt,this._elevationPrev=lt}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function ox(it,d){return[-(it[0]-Math.floor(it[0]/d)*d),-(it[1]-Math.floor(it[1]/d)*d),-(it[2]-Math.floor(it[2]/d)*d)]}function Ku(it){const d=c.eq(1323123451230),$=[];for(let st=0;st<it;++st){const lt=2*d()-1,ht=2*d()-1,dt=2*d()-1;$.push(c.d5(lt,ht,dt))}return $}function Lu(it,d,$,st,lt){const ht=c.aA((lt-$)/(st-$),0,1);return(1-ht)*it+ht*d}class h0{constructor(d){this._movement=new Hv,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Gv,this._ppmScaleFactor=d}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(d,$){const st=d.transform;this._movement.update(st,this._ppmScaleFactor);const lt=st.starsProjMatrix,ht=c.c7([]);c.c9(ht,ht,c.an(90)-st._pitch),c.c8(ht,ht,-st.angle);const dt=c.cc(new Float32Array(16),ht),mt=c.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),Tt=c.eg([],mt),Pt=c.aB([],Tt,dt),Mt=Date.now()/1e3;return this._accumulatedTimeFromStart+=(Mt-this._prevTime)*$,this._prevTime=Mt,{projectionMatrix:lt,modelviewMatrix:Pt}}}class ax extends h0{constructor(d){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new im("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(d){const $=d.context;if(!this.particlesVx){const st=Ku(this.particlesCount),lt=new c.eN,ht=new c.b0;let dt=0;const mt=c.eq(1323123451230);for(let Tt=0;Tt<st.length;++Tt){const Pt=st[Tt],Mt=[2*mt()-1,mt(),mt(),mt()];lt.emplaceBack(Pt[0],Pt[1],Pt[2],-1,-1,...Mt),lt.emplaceBack(Pt[0],Pt[1],Pt[2],1,-1,...Mt),lt.emplaceBack(Pt[0],Pt[1],Pt[2],1,1,...Mt),lt.emplaceBack(Pt[0],Pt[1],Pt[2],-1,1,...Mt),ht.emplaceBack(dt+0,dt+1,dt+2),ht.emplaceBack(dt+0,dt+2,dt+3),dt+=4}this.particlesVx=$.createVertexBuffer(lt,B0.members),this.particlesIdx=$.createIndexBuffer(ht)}}draw(d){if(!this._params.overrideStyleParameters&&!d.style.rain)return;const $=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},st=d.transform.zoom;if($.revealStart>st)return;const lt=Lu(0,1,$.revealStart,$.revealStart+$.revealRange,st);if(!this.particlesVx||!this.particlesIdx)return;const ht=structuredClone(this._params);let dt=[-ht.direction.x,ht.direction.y,-100];c.aw(dt,dt);const mt=structuredClone(this._vignetteParams);mt.strength*=lt,ht.overrideStyleParameters||(ht.intensity=d.style.rain.state.density,ht.timeFactor=d.style.rain.state.intensity,ht.color=structuredClone(d.style.rain.state.color),dt=structuredClone(d.style.rain.state.direction),ht.screenThinning.intensity=d.style.rain.state.centerThinning,ht.dropletSizeX=d.style.rain.state.dropletSize[0],ht.dropletSizeYScale=d.style.rain.state.dropletSize[1]/d.style.rain.state.dropletSize[0],ht.distortionStrength=100*d.style.rain.state.distortionStrength,mt.strength=1,mt.color=structuredClone(d.style.rain.state.vignetteColor));const Tt=this.updateOnRender(d,ht.timeFactor),Pt=d.context,Mt=Pt.gl,Ht=d.transform;this.screenTexture&&this.screenTexture.size[0]===d.width&&this.screenTexture.size[1]===d.height||(this.screenTexture=new c.T(Pt,{width:d.width,height:d.height,data:null},Mt.RGBA8)),ht.distortionStrength>0&&(Pt.activeTexture.set(Mt.TEXTURE0),this.screenTexture.bind(Mt.LINEAR,Mt.CLAMP_TO_EDGE),Mt.copyTexSubImage2D(Mt.TEXTURE_2D,0,0,0,0,0,d.width,d.height));const $t=d.getOrCreateProgram("rainParticle");d.uploadCommonUniforms(Pt,$t),Pt.activeTexture.set(Mt.TEXTURE0),this.screenTexture.bind(Mt.LINEAR,Mt.CLAMP_TO_EDGE);const qt=[ht.color.r,ht.color.g,ht.color.b,ht.color.a],Qt=(Xt,sr)=>{const ir=ox(this._movement.getPosition(),Xt),hr=ht.dropletSizeX,mr=ht.dropletSizeX*ht.dropletSizeYScale,dr=d.width/2,Ir=d.height/2,Tr=Lu(0,ht.screenThinning.start,0,1,ht.screenThinning.intensity),Ar=Lu(.001,ht.screenThinning.range,0,1,ht.screenThinning.intensity),Er=Lu(0,ht.screenThinning.particleOffset,0,1,ht.screenThinning.intensity),vr=(Pr={modelview:Tt.modelviewMatrix,projection:Tt.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ir,velocityConeAperture:ht.velocityConeAperture,velocity:ht.velocity,boxSize:Xt,rainDropletSize:[hr,mr],distortionStrength:ht.distortionStrength,rainDirection:dt,color:qt,screenSize:[Ht.width,Ht.height],thinningCenterPos:[dr,Ir],thinningShape:[Tr,Ar,Math.pow(10,ht.screenThinning.fadePower)],thinningAffectedRatio:ht.screenThinning.affectedRatio,thinningParticleOffset:Er,shapeDirectionalPower:ht.shapeDirPower,shapeNormalPower:ht.shapeNormalPower,mode:sr?0:1},{u_modelview:Float32Array.from(Pr.modelview),u_projection:Float32Array.from(Pr.projection),u_time:Pr.time,u_cam_pos:Pr.camPos,u_texScreen:0,u_velocityConeAperture:Pr.velocityConeAperture,u_velocity:Pr.velocity,u_boxSize:Pr.boxSize,u_rainDropletSize:Pr.rainDropletSize,u_distortionStrength:Pr.distortionStrength,u_rainDirection:Pr.rainDirection,u_color:Pr.color,u_screenSize:Pr.screenSize,u_thinningCenterPos:Pr.thinningCenterPos,u_thinningShape:Pr.thinningShape,u_thinningAffectedRatio:Pr.thinningAffectedRatio,u_thinningParticleOffset:Pr.thinningParticleOffset,u_shapeDirectionalPower:Pr.shapeDirectionalPower,u_shapeNormalPower:Pr.shapeNormalPower,u_mode:Pr.mode});var Pr;const Br=Math.round(ht.intensity*this.particlesCount),Or=c.bg.simpleSegment(0,0,4*Br,2*Br);$t.draw(d,Mt.TRIANGLES,es.disabled,_s.disabled,Ps.alphaBlended,gs.disabled,vr,"rain_particles",this.particlesVx,this.particlesIdx,Or)};ht.distortionStrength>0&&Qt(ht.boxSize,!0),Qt(ht.boxSize,!1),this._vignette.draw(d,mt)}}const Wv=c.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class qv extends h0{constructor(d){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new im("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(d){const $=d.context;if(!this.particlesVx){const st=Ku(this.particlesCount),lt=new c.eO,ht=new c.b0;let dt=0;const mt=c.eq(1323123451230);for(let Tt=0;Tt<st.length;++Tt){const Pt=st[Tt],Mt=mt(),Ht=mt(),$t=mt(),qt=[Tt/st.length,Mt,Ht,$t],Qt=[mt(),mt()];lt.emplaceBack(Pt[0],Pt[1],Pt[2],-1,-1,...qt,...Qt),lt.emplaceBack(Pt[0],Pt[1],Pt[2],1,-1,...qt,...Qt),lt.emplaceBack(Pt[0],Pt[1],Pt[2],1,1,...qt,...Qt),lt.emplaceBack(Pt[0],Pt[1],Pt[2],-1,1,...qt,...Qt),ht.emplaceBack(dt+0,dt+1,dt+2),ht.emplaceBack(dt+0,dt+2,dt+3),dt+=4}this.particlesVx=$.createVertexBuffer(lt,Wv.members),this.particlesIdx=$.createIndexBuffer(ht)}}draw(d){if(!this._params.overrideStyleParameters&&!d.style.snow)return;const $=structuredClone(this._params);let st=[-$.direction.x,$.direction.y,-100];c.aw(st,st);const lt=structuredClone(this._vignetteParams),ht=$.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},dt=d.transform.zoom;if(ht.revealStart>dt)return;const mt=Lu(0,1,ht.revealStart,ht.revealStart+ht.revealRange,dt);lt.strength*=mt,$.overrideStyleParameters||($.intensity=d.style.snow.state.density,$.timeFactor=d.style.snow.state.intensity,$.color=structuredClone(d.style.snow.state.color),st=structuredClone(d.style.snow.state.direction),$.screenThinning.intensity=d.style.snow.state.centerThinning,$.billboardSize=2.79*d.style.snow.state.flakeSize,lt.strength=1,lt.color=structuredClone(d.style.snow.state.vignetteColor));const Tt=this.updateOnRender(d,$.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const Pt=d.context,Mt=Pt.gl,Ht=d.transform,$t=d.getOrCreateProgram("snowParticle");d.uploadCommonUniforms(Pt,$t),((qt,Qt,Xt)=>{const sr=ox(this._movement.getPosition(),qt),ir=Ht.width/2,hr=Ht.height/2,mr=Lu(0,Xt.screenThinning.start,0,1,Xt.screenThinning.intensity),dr=Lu(.001,Xt.screenThinning.range,0,1,Xt.screenThinning.intensity),Ir=Lu(0,Xt.screenThinning.particleOffset,0,1,Xt.screenThinning.intensity),Tr=(Ar={modelview:Tt.modelviewMatrix,projection:Tt.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:sr,velocityConeAperture:Xt.velocityConeAperture,velocity:Xt.velocity,horizontalOscillationRadius:Xt.horizontalOscillationRadius,horizontalOscillationRate:Xt.horizontalOscillationRate,boxSize:qt,billboardSize:1*Xt.billboardSize,simpleShapeParameters:[Xt.shapeFadeStart,Xt.shapeFadePower],screenSize:[Ht.width,Ht.height],thinningCenterPos:[ir,hr],thinningShape:[mr,dr,Math.pow(10,Xt.screenThinning.fadePower)],thinningAffectedRatio:Xt.screenThinning.affectedRatio,thinningParticleOffset:Ir,color:[Xt.color.r,Xt.color.g,Xt.color.b,Xt.color.a],direction:st},{u_modelview:Float32Array.from(Ar.modelview),u_projection:Float32Array.from(Ar.projection),u_time:Ar.time,u_cam_pos:Ar.camPos,u_velocityConeAperture:Ar.velocityConeAperture,u_velocity:Ar.velocity,u_horizontalOscillationRadius:Ar.horizontalOscillationRadius,u_horizontalOscillationRate:Ar.horizontalOscillationRate,u_boxSize:Ar.boxSize,u_billboardSize:Ar.billboardSize,u_simpleShapeParameters:Ar.simpleShapeParameters,u_screenSize:Ar.screenSize,u_thinningCenterPos:Ar.thinningCenterPos,u_thinningShape:Ar.thinningShape,u_thinningAffectedRatio:Ar.thinningAffectedRatio,u_thinningParticleOffset:Ar.thinningParticleOffset,u_particleColor:Ar.color,u_direction:Ar.direction});var Ar;const Er=Math.round(Xt.intensity*this.particlesCount),vr=c.bg.simpleSegment(0,0,4*Er,2*Er);this.particlesVx&&this.particlesIdx&&$t.draw(d,Mt.TRIANGLES,es.disabled,_s.disabled,Ps.alphaBlended,gs.disabled,Tr,"snow_particles",this.particlesVx,this.particlesIdx,vr)})($.boxSize,0,$),this._vignette.draw(d,lt)}}const Om={symbol:function(it,d,$,st,lt){if(it.renderPass!=="translucent")return;const ht=_s.disabled,dt=it.colorModeForRenderPass(),mt=$.layout.get("text-variable-anchor"),Tt=$.layout.get("text-size-scale-range"),Pt=c.aA(it.scaleFactor,Tt[0],Tt[1]);mt&&function($t,qt,Qt,Xt,sr,ir,hr,mr){const dr=qt.transform,Ir=sr==="map",Tr=ir==="map";for(const Ar of $t){const Er=Xt.getTile(Ar),vr=Er.getBucket(Qt);if(!vr||!vr.text||!vr.text.segments.get().length)continue;const Pr=c.bK(vr.textSizeData,dr.zoom,mr),Br=Np(Ar,vr.getProjection(),dr),Or=dr.calculatePixelsToTileUnitsMatrix(Er),Yr=wu(Br,Er.tileID.canonical,Tr,Ir,dr,vr.getProjection(),Or),Qr=vr.hasIconTextFit()&&vr.hasIconData();Pr&&cs(vr,Ir,Tr,hr,dr,Yr,Ar,Math.pow(2,dr.zoom-Er.tileID.overscaledZ),Pr,Qr)}}(st,it,$,d,$.layout.get("text-rotation-alignment"),$.layout.get("text-pitch-alignment"),lt,Pt);const Mt=$.paint.get("icon-opacity").constantOr(1)!==0,Ht=$.paint.get("text-opacity").constantOr(1)!==0;$.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(Mt||Ht)?M_(it,d,$,st,ht,dt):(Mt&&M_(it,d,$,st,ht,dt,{onlyIcons:!0}),Ht&&M_(it,d,$,st,ht,dt,{onlyText:!0})),d.map.showCollisionBoxes&&(qn(it,d,$,st,$.paint.get("text-translate"),$.paint.get("text-translate-anchor"),!0),qn(it,d,$,st,$.paint.get("icon-translate"),$.paint.get("icon-translate-anchor"),!1))},circle:function(it,d,$,st){if(it.renderPass!=="translucent")return;const lt=$.paint.get("circle-opacity"),ht=$.paint.get("circle-stroke-width"),dt=$.paint.get("circle-stroke-opacity"),mt=$.layout.get("circle-sort-key").constantOr(1)!==void 0,Tt=$.paint.get("circle-emissive-strength");if(lt.constantOr(1)===0&&(ht.constantOr(1)===0||dt.constantOr(1)===0))return;const Pt=it.context,Mt=Pt.gl,Ht=it.transform,$t=!(!it.terrain||!it.terrain.enabled),qt=$.layout.get("circle-elevation-reference"),Qt=it.depthModeForSublayer(0,es.ReadOnly),Xt=new es(it.context.gl.LEQUAL,es.ReadOnly,it.depthRangeFor3D),sr=qt==="none"||$t?Qt:Xt,ir=_s.disabled,hr=it.colorModeForDrapableLayerRenderPass(Tt),mr=Ht.projection.name==="globe",dr=[c.aF(Ht.center.lng),c.aJ(Ht.center.lat)],Ir=[];for(let Ar=0;Ar<st.length;Ar++){const Er=st[Ar],vr=d.getTile(Er),Pr=vr.getBucket($);if(!Pr||Pr.projection.name!==Ht.projection.name)continue;const Br=Pr.programConfigurations.get($.id),Or=Pr.layoutVertexBuffer,Yr=Pr.globeExtVertexBuffer,Qr=Pr.indexBuffer,un=c.e0($),Cn=[Yr],qr=it.isTileAffectedByFog(Er);mr&&un.push("PROJECTION_GLOBE_VIEW"),un.push("DEPTH_D24"),it.terrain&&Ht.depthOcclusionForSymbolsAndCircles&&un.push("DEPTH_OCCLUSION"),Pr.hasElevation&&!it.terrain&&(un.push("ELEVATED_ROADS"),Cn.push(Pr.elevatedLayoutVertexBuffer));const Nr=it.getOrCreateProgram("circle",{config:Br,defines:un,overrideFog:qr}),tn=Ht.projection.createInversionMatrix(Ht,Er.canonical),Kr={programConfiguration:Br,program:Nr,layoutVertexBuffer:Or,dynamicBuffers:Cn,indexBuffer:Qr,uniformValues:c.e1(it,Er,vr,tn,dr,$),tile:vr};if(mt){const yn=Pr.segments.get();for(const Ln of yn)Ir.push({segments:new c.bg([Ln]),sortKey:Ln.sortKey,state:Kr})}else Ir.push({segments:Pr.segments,sortKey:0,state:Kr})}mt&&Ir.sort((Ar,Er)=>Ar.sortKey-Er.sortKey);const Tr={useDepthForOcclusion:Ht.depthOcclusionForSymbolsAndCircles};for(const Ar of Ir){const{programConfiguration:Er,program:vr,layoutVertexBuffer:Pr,dynamicBuffers:Br,indexBuffer:Or,uniformValues:Yr,tile:Qr}=Ar.state,un=Ar.segments;it.terrain&&it.terrain.setupElevationDraw(Qr,vr,Tr),it.uploadCommonUniforms(Pt,vr,Qr.tileID.toUnwrapped()),vr.draw(it,Mt.TRIANGLES,sr,ir,hr,gs.disabled,Yr,$.id,Pr,Or,un,$.paint,Ht.zoom,Er,Br)}},heatmap:function(it,d,$,st){if($.paint.get("heatmap-opacity")!==0)if(it.renderPass==="offscreen"){const lt=it.context,ht=lt.gl,dt=_s.disabled,mt=new Ps([ht.ONE,ht.ONE,ht.ONE,ht.ONE],c.ao.transparent,[!0,!0,!0,!0]);(function(qt,Qt,Xt,sr){const ir=qt.gl,hr=Qt.width*sr,mr=Qt.height*sr;qt.activeTexture.set(ir.TEXTURE1),qt.viewport.set([0,0,hr,mr]);let dr=Xt.heatmapFbo;if(!dr||dr&&(dr.width!==hr||dr.height!==mr)){dr&&dr.destroy();const Ir=ir.createTexture();ir.bindTexture(ir.TEXTURE_2D,Ir),ir.texParameteri(ir.TEXTURE_2D,ir.TEXTURE_WRAP_S,ir.CLAMP_TO_EDGE),ir.texParameteri(ir.TEXTURE_2D,ir.TEXTURE_WRAP_T,ir.CLAMP_TO_EDGE),ir.texParameteri(ir.TEXTURE_2D,ir.TEXTURE_MIN_FILTER,ir.LINEAR),ir.texParameteri(ir.TEXTURE_2D,ir.TEXTURE_MAG_FILTER,ir.LINEAR),dr=Xt.heatmapFbo=qt.createFramebuffer(hr,mr,1,null),function(Tr,Ar,Er,vr,Pr,Br){const Or=Tr.gl;Or.texImage2D(Or.TEXTURE_2D,0,Tr.extRenderToTextureHalfFloat?Or.RGBA16F:Or.RGBA,Pr,Br,0,Or.RGBA,Tr.extRenderToTextureHalfFloat?Or.HALF_FLOAT:Or.UNSIGNED_BYTE,null),vr.colorAttachment0.set(Er)}(qt,0,Ir,dr,hr,mr)}else ir.bindTexture(ir.TEXTURE_2D,dr.colorAttachment0.get()),qt.bindFramebuffer.set(dr.framebuffer)})(lt,it,$,it.transform.projection.name==="globe"?.5:.25),lt.clear({color:c.ao.transparent});const Tt=it.transform,Pt=Tt.projection.name==="globe",Mt=Pt?["PROJECTION_GLOBE_VIEW"]:[],Ht=Pt?gs.frontCCW:gs.disabled,$t=[c.aF(Tt.center.lng),c.aJ(Tt.center.lat)];for(let qt=0;qt<st.length;qt++){const Qt=st[qt];if(d.hasRenderableParent(Qt))continue;const Xt=d.getTile(Qt),sr=Xt.getBucket($);if(!sr||sr.projection.name!==Tt.projection.name)continue;const ir=it.isTileAffectedByFog(Qt),hr=sr.programConfigurations.get($.id),mr=it.getOrCreateProgram("heatmap",{config:hr,defines:Mt,overrideFog:ir}),{zoom:dr}=it.transform;it.terrain&&it.terrain.setupElevationDraw(Xt,mr),it.uploadCommonUniforms(lt,mr,Qt.toUnwrapped());const Ir=Tt.projection.createInversionMatrix(Tt,Qt.canonical);mr.draw(it,ht.TRIANGLES,es.disabled,dt,mt,Ht,Rw(it,Qt,Xt,Ir,$t,dr,$.paint.get("heatmap-intensity")),$.id,sr.layoutVertexBuffer,sr.indexBuffer,sr.segments,$.paint,it.transform.zoom,hr,Pt?[sr.globeExtVertexBuffer]:null)}lt.viewport.set([0,0,it.width,it.height])}else it.renderPass==="translucent"&&(it.context.setColorMode(it.colorModeForRenderPass()),function(lt,ht){const dt=lt.context,mt=dt.gl,Tt=ht.heatmapFbo;if(!Tt)return;dt.activeTexture.set(mt.TEXTURE0),mt.bindTexture(mt.TEXTURE_2D,Tt.colorAttachment0.get()),dt.activeTexture.set(mt.TEXTURE1);let Pt=ht.colorRampTexture;Pt||(Pt=ht.colorRampTexture=new c.T(dt,ht.colorRamp,mt.RGBA8)),Pt.bind(mt.LINEAR,mt.CLAMP_TO_EDGE),lt.getOrCreateProgram("heatmapTexture").draw(lt,mt.TRIANGLES,es.disabled,_s.disabled,lt.colorModeForRenderPass(),gs.disabled,((Mt,Ht,$t,qt)=>({u_image:0,u_color_ramp:1,u_opacity:Ht.paint.get("heatmap-opacity")}))(0,ht),ht.id,lt.viewportBuffer,lt.quadTriangleIndexBuffer,lt.viewportSegments,ht.paint,lt.transform.zoom)}(it,$))},line:function(it,d,$,st){if(it.renderPass!=="translucent")return;const lt=$.paint.get("line-opacity"),ht=$.paint.get("line-width");if(lt.constantOr(1)===0||ht.constantOr(1)===0)return;const dt=$.paint.get("line-emissive-strength").isConstant(),mt=$.paint.get("line-emissive-strength").constantOr(0),Tt=$.paint.get("line-occlusion-opacity"),Pt=$.layout.get("line-elevation-reference"),Mt=$.layout.get("line-width-unit")==="meters",Ht=Pt==="sea",$t=!(!it.terrain||!it.terrain.enabled),qt=it.context,Qt=qt.gl;if($.hasElevatedBuckets&&it.transform.projection.name==="globe")return;const Xt=$.layout.get("line-cross-slope"),sr=Xt!==void 0,ir=Xt<1,hr=it.colorModeForDrapableLayerRenderPass(dt?mt:null),mr=it.terrain&&it.terrain.renderingToTexture,dr=mr?1:c.o.devicePixelRatio,Ir=$.paint.get("line-dasharray"),Tr=Ir.constantOr(1),Ar=$.layout.get("line-cap"),Er=Ir.constantOr(null),vr=Ar.constantOr(null),Pr=$.paint.get("line-pattern"),Br=Pr.constantOr(1),Or=$.paint.get("line-pattern-cross-fade"),Yr=Pr.constantOr(null),Qr=$.paint.get("line-opacity").constantOr(1);let un=!Br&&Qr!==1||it.depthOcclusion&&Tt>0&&Tt<1;const Cn=$.paint.get("line-gradient"),qr=Br?"linePattern":"line",Nr=c.e2($);let tn;if(mr&&it.terrain&&it.terrain.clipOrMaskOverlapStencilType()&&(un=!1),Tt!==0&&it.depthOcclusion){const Un=$.paint._values["line-opacity"];Un&&Un.value&&Un.value.kind==="constant"?tn=Un.value:c.w(`Occlusion opacity for layer ${$.id} is supported only when line-opacity isn't data-driven.`)}ht.value.kind!=="constant"&&ht.value.isLineProgressConstant===!1&&Nr.push("VARIABLE_LINE_WIDTH"),mr&&(it.emissiveMode!=="dual-source-blending"||dt?it.emissiveMode==="mrt-fallback"&&Nr.push("USE_MRT1"):Nr.push("DUAL_SOURCE_BLENDING"));const Kr=(Un,kn,An,Qn,Kn,zn)=>{for(const Gn of Un){const as=d.getTile(Gn);if(Br&&!as.patternsLoaded())continue;const Es=as.getBucket($);if(!Es||Es.elevationType!=="none"&&!Kn||Es.elevationType==="none"&&Kn)continue;it.prepareDrawTile();const $s=[...kn],so=it.shadowRenderer,Jn=Es.elevationType==="road"&&!!so&&so.enabled;let ro=[0,0,0];if(Jn){const Ds=it.style.directionalLight,Lo=it.style.ambientLight;Ds&&Lo&&(ro=Qp(it.style,Ds,Lo)),$s.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const bs=Es.programConfigurations.get($.id);let co=!1;if(Yr&&as.imageAtlas){const Ds=c.e3.from(Yr),Lo=Ds.getPrimary().scaleSelf(dr).toString(),_l=as.imageAtlas.patternPositions.get(Lo),Ho=Ds.getSecondary(),So=Ho?as.imageAtlas.patternPositions.get(Ho.scaleSelf(dr).toString()):null;co=!!_l&&!!So,_l&&bs.setConstantPatternPositions(_l,So)}Or>0&&(co||bs.getPatternTransitionVertexBuffer("line-pattern"))&&$s.push("LINE_PATTERN_TRANSITION");const xo=it.isTileAffectedByFog(Gn),mo=it.getOrCreateProgram(qr,{config:bs,defines:$s,overrideFog:xo});if(!Br&&Er&&vr&&as.lineAtlas){const Ds=as.lineAtlas.getDash(Er,vr);Ds&&bs.setConstantPatternPositions(Ds)}Jn&&so.setupShadows(as.tileID.toUnwrapped(),mo,"vector-tile");let[to,Ms]=$.paint.get("line-trim-offset");(vr==="round"||vr==="square")&&to!==Ms&&(to===0&&(to-=1),Ms===1&&(Ms+=1));const ao=mr?Gn.projMatrix:null,Zo=Mt?1/Es.tileToMeter/c.ay(as,1,it.transform.zoom):1,Bo=Mt?1/Es.tileToMeter/c.ay(as,1,Math.floor(it.transform.zoom)):1,uo=Br?c.e4(it,as,$,ao,dr,Zo,Bo,[to,Ms],ro,Or):c.e5(it,as,$,ao,Es.lineClipsArray.length,dr,Zo,Bo,[to,Ms],ro);if(Cn){const Ds=Es.gradients[$.id];let Lo=Ds.texture;if($.gradientVersion!==Ds.version){let _l=256;if($.stepInterpolant){const Ho=d.getSource().maxzoom,So=Gn.canonical.z===Ho?Math.ceil(1<<it.transform.maxZoom-Gn.canonical.z):1;_l=c.aA(c.e6(Es.maxLineLength/c.al*1024*So),256,qt.maxTextureSize)}Ds.gradient=c.e7({expression:$.gradientExpression(),evaluationKey:"lineProgress",resolution:_l,image:Ds.gradient||void 0,clips:Es.lineClipsArray}),Ds.texture?Ds.texture.update(Ds.gradient):Ds.texture=new c.T(qt,Ds.gradient,Qt.RGBA8),Ds.version=$.gradientVersion,Lo=Ds.texture}qt.activeTexture.set(Qt.TEXTURE1),Lo.bind($.stepInterpolant?Qt.NEAREST:Qt.LINEAR,Qt.CLAMP_TO_EDGE)}Tr&&(qt.activeTexture.set(Qt.TEXTURE0),as.lineAtlasTexture&&as.lineAtlasTexture.bind(Qt.LINEAR,Qt.REPEAT),bs.updatePaintBuffers()),Br&&(qt.activeTexture.set(Qt.TEXTURE0),as.imageAtlasTexture&&as.imageAtlasTexture.bind(Qt.LINEAR,Qt.CLAMP_TO_EDGE),bs.updatePaintBuffers()),Kn&&!Ht&&it.terrain.setupElevationDraw(as,mo),it.uploadCommonUniforms(qt,mo,Gn.toUnwrapped());const Ys=Ds=>{tn!=null&&(tn.value=Qr*Tt),mo.draw(it,Qt.TRIANGLES,An,Ds,hr,gs.disabled,uo,$.id,Es.layoutVertexBuffer,Es.indexBuffer,Es.segments,$.paint,it.transform.zoom,bs,[Es.layoutVertexBuffer2,Es.patternVertexBuffer,Es.zOffsetVertexBuffer]),tn!=null&&(tn.value=Qr)};if(un&&!Kn){const Ds=it.stencilModeForClipping(Gn).ref;Ds===0&&mr&&qt.clear({stencil:0});const Lo={func:Qt.EQUAL,mask:255};uo.u_alpha_discard_threshold=.8,Ys(new _s(Lo,Ds,255,Qt.KEEP,Qt.KEEP,Qt.INVERT)),uo.u_alpha_discard_threshold=0,Ys(new _s(Lo,Ds,255,Qt.KEEP,Qt.KEEP,Qt.KEEP))}else uo.u_alpha_discard_threshold=un&&Kn&&zn?.8:0,Ys(Kn?Qn:it.stencilModeForClipping(Gn))}};let yn=it.depthModeForSublayer(0,es.ReadOnly);const Ln=new es(it.depthOcclusion?Qt.GREATER:Qt.LEQUAL,es.ReadOnly,it.depthRangeFor3D);if($.hasNonElevatedBuckets){const Un=!mr&&it.terrain;Tt!==0&&Un?c.w(`Occlusion opacity for layer ${$.id} is supported on terrain only if the layer has line-z-offset enabled.`):Un?c.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${$.id}.`):Kr(st,Nr,yn,_s.disabled,!1,!0)}if($.hasElevatedBuckets){Pt==="hd-road-markup"?$t||(yn=Ln,Nr.push("ELEVATED_ROADS")):(Nr.push("ELEVATED"),yn=Ln,sr&&Nr.push(ir?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),Ht&&Nr.push("ELEVATION_REFERENCE_SEA"));const Un=un?it.stencilModeFor3D():_s.disabled;it.forceTerrainMode=!0,Kr(st,Nr,yn,Un,!0,!0),un&&Kr(st,Nr,yn,Un,!0,!1),it.forceTerrainMode=!1}un&&(it.resetStencilClippingMasks(),mr&&qt.clear({stencil:0})),Tt===0||it.depthOcclusion||mr||it.layersWithOcclusionOpacity.push(it.currentLayer)},fill:function(it,d,$,st){const lt=$.paint.get("fill-color"),ht=$.paint.get("fill-opacity");if(ht.constantOr(1)===0)return;const dt=$.paint.get("fill-emissive-strength"),mt=it.colorModeForDrapableLayerRenderPass(dt),Tt=$.paint.get("fill-pattern"),Pt=it.opaquePassEnabledForLayer()&&!Tt.constantOr(1)&&lt.constantOr(c.ao.transparent).a===1&&ht.constantOr(0)===1?"opaque":"translucent";let Mt="none";$.layout.get("fill-elevation-reference")!=="none"?Mt="road":$.paint.get("fill-z-offset").constantOr(1)!==0&&(Mt="offset");const Ht=!(!it.terrain||!it.terrain.enabled),$t={painter:it,sourceCache:d,layer:$,coords:st,colorMode:mt,elevationType:Mt,terrainEnabled:Ht,pass:Pt};if(it.renderPass==="shadow")return void(it.shadowRenderer&&Mt==="road"&&!Ht&&function(Qt){const{painter:Xt,sourceCache:sr,layer:ir,coords:hr}=Qt,mr=Xt.context.gl,dr=Qt.painter.shadowRenderer;for(const Ir of hr){const Tr=sr.getTile(Ir),Ar=Tr.getBucket(ir);if(!Ar)continue;const Er=Ar.elevatedStructures;if(!Er||!Er.shadowCasterSegments||Er.shadowCasterSegments.segments[0].primitiveLength===0)continue;Xt.prepareDrawTile();const vr=Ar.bufferData.programConfigurations.get(ir.id),Pr=Xt.isTileAffectedByFog(Ir),Br=Xt.getOrCreateProgram("elevatedStructuresDepth",{config:vr,overrideFog:Pr}),Or=dr.calculateShadowPassMatrixFromTile(Tr.tileID.toUnwrapped());Xt.uploadCommonUniforms(Xt.context,Br,Ir.toUnwrapped());const Yr={u_matrix:Or,u_depth_bias:0};Br.draw(Xt,mr.TRIANGLES,dr.getShadowPassDepthMode(),_s.disabled,dr.getShadowPassColorMode(),gs.disabled,Yr,ir.id,Er.vertexBuffer,Er.indexBuffer,Er.shadowCasterSegments,ir.paint,Xt.transform.zoom,vr)}}($t));const qt=it.emissiveMode==="mrt-fallback";if(Mt!=="offset"){if(Xy($t,!1,qt),Mt==="road"){const Qt=!Ht&&it.renderPass==="translucent";Qt&&Ky(it,d,$,st,"geometry"),Xy($t,!0,qt,_s.disabled),Qt&&function(Xt){const{painter:sr,sourceCache:ir,layer:hr,coords:mr,colorMode:dr}=Xt,Ir=sr.context.gl,Tr=Xt.painter.shadowRenderer,Ar=!!Tr&&Tr.enabled,Er=new es(sr.context.gl.LEQUAL,es.ReadOnly,sr.depthRangeFor3D);let vr=[0,0,0];if(Ar){const Br=sr.style.directionalLight,Or=sr.style.ambientLight;Br&&Or&&(vr=Qp(sr.style,Br,Or))}const Pr=Br=>{for(const Or of mr){const Yr=ir.getTile(Or),Qr=Yr.getBucket(hr);if(!Qr)continue;const un=Qr.elevatedStructures;if(!un)continue;let Cn,qr;if(Br?(Cn=un.renderableBridgeSegments,qr=un.bridgeProgramConfigurations.get(hr.id)):(Cn=un.renderableTunnelSegments,qr=un.tunnelProgramConfigurations.get(hr.id)),!Cn||Cn.segments[0].primitiveLength===0)continue;qr.updatePaintBuffers(),sr.prepareDrawTile();const Nr=sr.isTileAffectedByFog(Or),tn=[];Ar&&tn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Kr=sr.getOrCreateProgram("elevatedStructures",{config:qr,overrideFog:Nr,defines:tn}),yn=sr.translatePosMatrix(Or.projMatrix,Yr,hr.paint.get("fill-translate"),hr.paint.get("fill-translate-anchor"));Ar&&Tr.setupShadows(Yr.tileID.toUnwrapped(),Kr,"vector-tile");const Ln=km(yn,vr);sr.uploadCommonUniforms(sr.context,Kr,Or.toUnwrapped()),Kr.draw(sr,Ir.TRIANGLES,Er,_s.disabled,dr,gs.backCCW,Ln,hr.id,un.vertexBuffer,un.indexBuffer,Cn,hr.paint,sr.transform.zoom,qr,[un.vertexBufferNormal])}};Pr(!0),Pr(!1)}($t)}}else Xy($t,!1,qt,it.stencilModeFor3D())},"fill-extrusion":function(it,d,$,st){const lt=$.paint.get("fill-extrusion-opacity"),ht=it.context,dt=ht.gl,mt=it.terrain,Tt=mt&&mt.renderingToTexture;if(lt===0)return;const Pt=it.emissiveMode==="mrt-fallback",Mt=it.conflationActive&&it.style.isLayerClipped($,d.getSource()),Ht=it.style.order.indexOf($.fqid);if(Mt&&function($t,qt,Qt,Xt,sr){for(const ir of Xt){const hr=qt.getTile(ir).getBucket(Qt);hr&&(hr.updateReplacement(ir,$t.replacementSource,sr),hr.uploadCentroid($t.context))}}(it,d,$,st,Ht),mt||Mt)for(const $t of st){const qt=d.getTile($t).getBucket($);qt&&gT(it.context,d,$t,qt,$,mt,Mt)}if(it.renderPass==="shadow"&&it.shadowRenderer){const $t=it.shadowRenderer;if(mt&&lt<.65&&$._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof c.ad)return;const qt=$t.getShadowPassDepthMode(),Qt=$t.getShadowPassColorMode();Zy(it,d,$,st,qt,_s.disabled,Qt,Mt)}else if(it.renderPass==="translucent"){const $t=!$.paint.get("fill-extrusion-pattern").constantOr(1),qt=$.paint.get("fill-extrusion-color").constantOr(c.ao.white);if(!Tt&&qt.a!==0){const Qt=new es(it.context.gl.LEQUAL,es.ReadWrite,it.depthRangeFor3D);lt===1&&$t?Zy(it,d,$,st,Qt,_s.disabled,Ps.unblended,Mt):(Zy(it,d,$,st,Qt,_s.disabled,Ps.disabled,Mt),Zy(it,d,$,st,Qt,it.stencilModeFor3D(),it.colorModeForRenderPass(),Mt),it.resetStencilClippingMasks())}if(it.style.enable3dLights()&&$t&&(!mt&&it.transform.projection.name!=="globe"||Tt)){const Qt=$.paint.get("fill-extrusion-opacity"),Xt=$.paint.get("fill-extrusion-ambient-occlusion-intensity"),sr=$.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ir=$.paint.get("fill-extrusion-flood-light-intensity"),hr=$.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",mr=$.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(hr?null:$.lut).toArray01().slice(0,3),dr=Xt>0&&sr>0,Ir=ir>0,Tr=(vr,Pr,Br)=>(1-Br)*vr+Br*Pr,Ar=new zv;Ar.translate=$.paint.get("fill-extrusion-translate"),Ar.translateAnchor=$.paint.get("fill-extrusion-translate-anchor"),Ar.edgeRadius=$.layout.get("fill-extrusion-edge-radius"),Ar.cutoffFadeRange=$.paint.get("fill-extrusion-cutoff-fade-range");const Er=vr=>{const Pr=it.depthModeForSublayer(1,es.ReadOnly,dt.LEQUAL,!0),Br=$.paint.get(vr?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Or=Tr(.1,3,Br),Yr=it._showOverdrawInspector;if(!Yr){const Qr=new _s({func:dt.ALWAYS,mask:255},255,255,dt.KEEP,dt.KEEP,dt.REPLACE),un=new Ps([dt.ONE,dt.ONE,dt.ONE,dt.ONE],c.ao.transparent,[!1,!1,!1,!0],dt.MIN);em(Ar,it,d,$,st,Pr,Qr,un,gs.disabled,vr,"sdf",Qt,Xt,sr,ir,mr,Or,Mt,!1)}{const Qr=Yr?_s.disabled:new _s({func:dt.EQUAL,mask:255},255,255,dt.KEEP,dt.DECR,dt.DECR),un=Yr?it.colorModeForRenderPass():new Ps([dt.ONE_MINUS_DST_ALPHA,dt.DST_ALPHA,dt.ONE,dt.ONE],c.ao.transparent,[!0,!0,!0,!0]);em(Ar,it,d,$,st,Pr,Qr,un,gs.disabled,vr,"color",Qt,Xt,sr,ir,mr,Or,Mt,!1)}};if(Tt){const vr=()=>{const Br=mt.drapeBufferSize[0],Or=mt.drapeBufferSize[1];let Yr=mt.framebufferCopyTexture;return Yr&&(!Yr||Yr.size[0]===Br&&Yr.size[1]===Or)||(Yr&&Yr.destroy(),Yr=mt.framebufferCopyTexture=new c.T(ht,new c.q({width:Br,height:Or}),dt.RGBA8)),Yr.bind(dt.LINEAR,dt.CLAMP_TO_EDGE),dt.copyTexSubImage2D(dt.TEXTURE_2D,0,0,0,0,0,Br,Or),Yr},Pr=(Br,Or,Yr)=>{const Qr=it.depthModeForSublayer(1,es.ReadOnly,dt.LEQUAL,!1),un=$.paint.get(Br?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Cn=Tr(.1,3,un);{const qr=new Ps([dt.ONE,dt.ONE,dt.ONE,dt.ONE],c.ao.transparent,[!1,!1,!1,!0]);em(Ar,it,d,$,st,Qr,_s.disabled,qr,gs.disabled,Br,"clear",Qt,Xt,sr,ir,mr,Cn,Mt,Or)}{const qr=new _s({func:dt.ALWAYS,mask:255},255,255,dt.KEEP,dt.KEEP,dt.REPLACE),Nr=new Ps([dt.ONE,dt.ONE,dt.ONE,dt.ONE],c.ao.transparent,[!1,!1,!1,!0],dt.MIN);em(Ar,it,d,$,st,Qr,qr,Nr,gs.disabled,Br,"sdf",Qt,Xt,sr,ir,mr,Cn,Mt,Or)}Pt&&!Br&&(Yr=vr());{const qr=Br?dt.ZERO:dt.ONE_MINUS_DST_ALPHA,Nr=new _s({func:dt.EQUAL,mask:255},255,255,dt.KEEP,dt.DECR,dt.DECR),tn=new Ps([qr,dt.DST_ALPHA,dt.ONE_MINUS_DST_ALPHA,dt.ZERO],c.ao.transparent,[!0,!0,!0,!0]);em(Ar,it,d,$,st,Qr,Nr,tn,gs.disabled,Br,"color",Qt,Xt,sr,ir,mr,Cn,Mt,Or)}if(!Pt||Br){const qr=new Ps([dt.ONE,dt.ONE,dt.ONE,Br?dt.ZERO:dt.ONE],c.ao.transparent,[!1,!1,!1,!0],Br?dt.FUNC_ADD:dt.MAX);em(Ar,it,d,$,st,Qr,_s.disabled,qr,gs.disabled,Br,"clear",Qt,Xt,sr,ir,mr,Cn,Mt,Or,Yr)}else{dt.drawBuffers([dt.NONE,dt.COLOR_ATTACHMENT1]);const qr=new _s({func:dt.EQUAL,mask:255},254,255,dt.KEEP,dt.DECR,dt.DECR),Nr=new Ps([dt.ONE,dt.ONE,dt.ONE,dt.ONE],c.ao.transparent,[!0,!1,!1,!1],dt.MAX);em(Ar,it,d,$,st,Qr,qr,Nr,gs.disabled,Br,"emissive",Qt,Xt,sr,ir,mr,Cn,Mt,Or,Yr),dt.drawBuffers([dt.COLOR_ATTACHMENT0])}};if(dr||Ir){let Br;it.prepareDrawTile(),Pt&&!dr||(Br=vr()),dr&&Pr(!0,!1,Br),Ir&&Pr(!1,!0,Br)}}else dr&&Er(!0),Ir&&Er(!1),(dr||Ir)&&it.resetStencilClippingMasks()}}},building:function(it,d,$,st){it.currentLayer<it.firstLightBeamLayer&&(it.firstLightBeamLayer=it.currentLayer);const lt=$.paint.get("building-ambient-occlusion-ground-intensity"),ht=$.paint.get("building-ambient-occlusion-ground-radius"),dt=$.paint.get("building-ambient-occlusion-ground-attenuation"),mt=$.paint.get("building-opacity");if(mt<=0)return;let Tt=lt>0&&ht>0,Pt=!0;const Mt=$.paint.get("building-vertical-scale");if(Mt<=0)return;it.shadowRenderer||(Pt=!1);const Ht=it.conflationActive&&it.style.isLayerClipped($,d.getSource()),$t=it.style.order.indexOf($.fqid);if(function(qt,Qt,Xt,sr,ir,hr){for(const mr of hr){const dr=Qt.getTile(mr).getBucket(Xt);dr&&(ir&&dr.updateReplacement(mr,qt.replacementSource,sr),dr.uploadUpdatedIndexBuffer(qt.context))}}(it,d,$,$t,Ht,st),function(qt,Qt,Xt,sr){for(const ir of sr){const hr=Qt.getTile(ir).getBucket(Xt);hr&&hr.needsEvaluation()&&hr.uploadUpdatedColorBuffer(qt.context)}}(it,d,$,st),$.resetLayerRenderingStats(it),it.shadowRenderer&&(it.shadowRenderer.useNormalOffset=!0),it.renderPass==="shadow"&&it.shadowRenderer){const qt=it.shadowRenderer,Qt=[],Xt=qt.getShadowPassDepthMode();D_({painter:it,source:d,layer:$,coords:st,defines:Qt,blendMode:qt.getShadowPassColorMode(),depthMode:Xt,opacity:mt,verticalScale:Mt,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(it.renderPass==="translucent"){let qt=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];Pt&&(qt=qt.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),it.shadowRenderer&&it.shadowRenderer.useNormalOffset&&(qt=qt.concat("NORMAL_OFFSET"));const Qt=$.paint.get("building-facade-emissive-chance"),Xt=$.paint.get("building-ambient-occlusion-intensity"),sr=$.paint.get("building-flood-light-intensity"),ir=$.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",hr=$.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(ir?null:$.lut).toArray01().slice(0,3),mr=$.paint.get("building-flood-light-ground-attenuation"),dr=sr>0,Ir=new es(it.context.gl.LEQUAL,es.ReadWrite,it.depthRangeFor3D);mt<1&&D_({painter:it,source:d,layer:$,coords:st,defines:qt,blendMode:Ps.disabled,depthMode:Ir,opacity:mt,verticalScale:Mt,facadeEmissiveChance:Qt,facadeAOIntensity:Xt,floodLightIntensity:sr,floodLightColor:hr,depthOnly:!0});const Tr=it.colorModeForRenderPass();D_({painter:it,source:d,layer:$,coords:st,defines:qt,blendMode:Tr,depthMode:Ir,opacity:mt,verticalScale:Mt,facadeEmissiveChance:Qt,facadeAOIntensity:Xt,floodLightIntensity:sr,floodLightColor:hr}),Tt&&Yy(it,d,$,st,!0,mt,lt,ht,sr,hr,dt,Ht),dr&&Yy(it,d,$,st,!1,mt,lt,ht,sr,hr,mr,Ht)}else if(it.renderPass==="light-beam"){const qt=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],Qt=new es(it.context.gl.LEQUAL,es.ReadOnly,it.depthRangeFor3D);D_({painter:it,source:d,layer:$,coords:st,defines:qt,blendMode:Ps.alphaBlended,depthMode:Qt,opacity:mt,verticalScale:Mt,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}it.shadowRenderer&&(it.shadowRenderer.useNormalOffset=!1),it.resetStencilClippingMasks()},hillshade:function(it,d,$,st){if(it.renderPass!=="offscreen"&&it.renderPass!=="translucent"||it.style.disableElevatedTerrain)return;const lt=it.context,ht=it.terrain&&it.terrain.renderingToTexture,[dt,mt]=it.renderPass!=="translucent"||ht?[{},st]:it.stencilConfigForOverlap(st);for(const Tt of mt){const Pt=d.getTile(Tt);if(Pt.needsHillshadePrepare&&it.renderPass==="offscreen")oT(it,Pt,$);else if(it.renderPass==="translucent"){const Mt=it.depthModeForSublayer(0,es.ReadOnly),Ht=$.paint.get("hillshade-emissive-strength"),$t=it.colorModeForDrapableLayerRenderPass(Ht),qt=ht&&it.terrain?it.terrain.stencilModeForRTTOverlap(Tt):dt[Tt.overscaledZ];sT(it,Tt,Pt,$,Mt,qt,$t)}}lt.viewport.set([0,0,it.width,it.height]),it.resetStencilClippingMasks()},raster:function(it,d,$,st,lt,ht){if(it.renderPass!=="translucent"||$.paint.get("raster-opacity")===0)return;const dt=it.transform.projection.name==="globe",mt=$.paint.get("raster-elevation")!==0,Tt=mt&&dt;if(it.renderElevatedRasterBackface&&!Tt)return;const Pt=it.context,Mt=Pt.gl,Ht=d.getSource(),$t=function(Tr,Ar,Er,vr,Pr){const Br=Ar.paint.get("raster-color"),Or=Tr.type==="raster-array",Yr=[],Qr=Ar.paint.get("raster-resampling"),un=Ar.paint.get("raster-color-mix");let Cn=Ar.paint.get("raster-color-range");const qr=[un[0],un[1],un[2],0],Nr=un[3];let tn=Qr==="nearest"?vr.NEAREST:vr.LINEAR;if(Or&&(Yr.push("RASTER_ARRAY"),Br||Yr.push("RASTER_COLOR"),Qr==="linear"&&Yr.push("RASTER_ARRAY_LINEAR"),tn=vr.NEAREST,!Cn&&Tr.rasterLayers)){const Kr=Tr.rasterLayers.find(({id:yn})=>yn===Ar.sourceLayer);Kr&&Kr.fields&&Kr.fields.range&&(Cn=Kr.fields.range)}if(Cn=Cn||[0,1],Br){Yr.push("RASTER_COLOR"),Er.activeTexture.set(vr.TEXTURE2),Ar.updateColorRamp(Cn);let Kr=Ar.colorRampTexture;Kr||(Kr=Ar.colorRampTexture=new c.T(Er,Ar.colorRamp,vr.RGBA8)),Kr.bind(vr.LINEAR,vr.CLAMP_TO_EDGE)}return Pr&&Yr.push("USE_MRT1"),{mix:qr,range:Cn,offset:Nr,defines:Yr,resampling:tn}}(Ht,$,Pt,Mt,it.terrain&&it.terrain.renderingToTexture&&it.emissiveMode==="mrt-fallback");if(Ht instanceof c.aU&&!st.length&&!dt)return;const qt=$.paint.get("raster-emissive-strength"),Qt=it.colorModeForDrapableLayerRenderPass(qt),Xt=it.terrain&&it.terrain.renderingToTexture,sr=!it.options.moving,ir=$.paint.get("raster-resampling")==="nearest"?Mt.NEAREST:Mt.LINEAR;if(Ht instanceof c.aU&&!st.length&&(Ht.onNorthPole||Ht.onSouthPole)){const Tr=mt?it.stencilModeFor3D():_s.disabled;return void N_(!!Ht.onNorthPole,null,it,d,$,qt,$t,gs.disabled,Tr)}if(!st.length)return;const[hr,mr]=Ht instanceof c.aU||Xt?[{},st]:it.stencilConfigForOverlap(st),dr=mr[mr.length-1].overscaledZ;Tt&&$t.defines.push("PROJECTION_GLOBE_VIEW"),mt&&$t.defines.push("RENDER_CUTOFF");const Ir=(Tr,Ar,Er)=>{for(const vr of Tr){const Pr=vr.toUnwrapped(),Br=d.getTile(vr);if(Xt&&(!Br||!Br.hasData()))continue;Pt.activeTexture.set(Mt.TEXTURE0);const Or=rm(Br,Ht,$,$t);if(!Or||!Or.texture)continue;const{texture:Yr,mix:Qr,offset:un,tileSize:Cn,buffer:qr}=Or;let Nr,tn;Xt?(Nr=es.disabled,tn=vr.projMatrix):mt?(Nr=new es(Mt.LEQUAL,es.ReadWrite,it.depthRangeFor3D),tn=dt?Float32Array.from(it.transform.expandedFarZProjMatrix):it.transform.calculateProjMatrix(Pr,sr)):(Nr=it.depthModeForSublayer(vr.overscaledZ-dr,$.paint.get("raster-opacity")===1?es.ReadWrite:es.ReadOnly,Mt.LESS),tn=it.transform.calculateProjMatrix(Pr,sr));const Kr=it.terrain&&Xt?it.terrain.stencilModeForRTTOverlap(vr):hr[vr.overscaledZ],yn=ht?0:$.paint.get("raster-fade-duration");Br.registerFadeDuration(yn);const Ln=d.findLoadedParent(vr,0),Un=R_(Br,Ln,d,it.transform,yn);let kn,An;!Un.isFading&&Br.refreshedUponExpiration&&(Br.refreshedUponExpiration=!1),it.terrain&&it.terrain.prepareDrawTile(),Pt.activeTexture.set(Mt.TEXTURE0),Yr.bind(ir,Mt.CLAMP_TO_EDGE),Pt.activeTexture.set(Mt.TEXTURE1),Ln?(Ln.texture&&Ln.texture.bind(ir,Mt.CLAMP_TO_EDGE),kn=Math.pow(2,Ln.tileID.overscaledZ-Br.tileID.overscaledZ),An=[Br.tileID.canonical.x*kn%1,Br.tileID.canonical.y*kn%1]):Yr.bind(ir,Mt.CLAMP_TO_EDGE),"useMipmap"in Yr&&Pt.extTextureFilterAnisotropic&&it.transform.pitch>20&&Mt.texParameterf(Mt.TEXTURE_2D,Pt.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Pt.extTextureFilterAnisotropicMax);const Qn=it.transform;let Kn;const zn=mt?Ow(Qn):[0,0,0,0];let Gn,as,Es,$s,so,Jn=0;if(Tt&&Ht instanceof c.aU&&Ht.coordinates.length>3)Gn=Float32Array.from(c.bk(c.dJ(new c.cD(0,0,0)))),as=Float32Array.from(Qn.globeMatrix),Es=Float32Array.from(c.dF(Qn)),$s=[c.aF(Qn.center.lng),c.aJ(Qn.center.lat)],Kn=Ht.elevatedGlobePerspectiveTransform,so=Ht.elevatedGlobeGridMatrix||new Float32Array(9);else if(Tt){const xo=c.dG(vr.canonical);Jn=c.dH(xo.getCenter().lat),Gn=Float32Array.from(c.bk(c.dJ(vr.canonical))),as=Float32Array.from(Qn.globeMatrix),Es=Float32Array.from(c.dF(Qn)),$s=[c.aF(Qn.center.lng),c.aJ(Qn.center.lat)],Kn=[0,0],so=Float32Array.from(c.dI(vr.canonical,xo,Jn,Qn.worldSize/Qn._pixelsPerMercatorPixel))}else Kn=Ht instanceof c.aU?Ht.perspectiveTransform:[0,0],Gn=new Float32Array(16),as=new Float32Array(9),Es=new Float32Array(16),$s=[0,0],so=new Float32Array(9);const ro=Iw(tn,Gn,as,Es,so,An||[0,0],c.aj(it.transform.zoom),$s,zn,kn||1,Un,$,Kn,mt?$.paint.get("raster-elevation"):0,2,Qr,un,$t.range,Cn,qr,qt),bs=it.isTileAffectedByFog(vr),co=it.getOrCreateProgram("raster",{defines:$t.defines,overrideFog:bs});if(it.uploadCommonUniforms(Pt,co,Pr),Ht instanceof c.aU){const xo=Ht.elevatedGlobeVertexBuffer,mo=Ht.elevatedGlobeIndexBuffer;if(Xt||!dt)Ht.boundsBuffer&&Ht.boundsSegments&&co.draw(it,Mt.TRIANGLES,Nr,_s.disabled,Qt,gs.disabled,ro,$.id,Ht.boundsBuffer,it.quadTriangleIndexBuffer,Ht.boundsSegments);else if(xo&&mo){const to=Qn.zoom<=c.c_?Ht.elevatedGlobeSegments:Ht.getSegmentsForLongitude(Qn.center.lng);to&&co.draw(it,Mt.TRIANGLES,Nr,_s.disabled,Qt,Ar,ro,$.id,xo,mo,to)}}else if(Tt){Nr=new es(Mt.LEQUAL,es.ReadOnly,it.depthRangeFor3D);const xo=it.globeSharedBuffers;if(xo){const[mo,to,Ms]=xo.getGridBuffers(Jn,!1);co.draw(it,Mt.TRIANGLES,Nr,Er||Kr,it.colorModeForRenderPass(),Ar,ro,$.id,mo,to,Ms)}}else{const{tileBoundsBuffer:xo,tileBoundsIndexBuffer:mo,tileBoundsSegments:to}=it.getTileBoundsBuffers(Br);co.draw(it,Mt.TRIANGLES,Nr,Kr,Qt,gs.disabled,ro,$.id,xo,mo,to)}}if(!(Ht instanceof c.aU)&&Tt)for(const vr of Tr){const Pr=vr.canonical.y===(1<<vr.canonical.z)-1;vr.canonical.y===0&&N_(!0,vr,it,d,$,qt,$t,Ar,Er||_s.disabled),Pr&&N_(!1,vr,it,d,$,qt,$t,Ar===gs.frontCW?gs.backCW:gs.frontCW,Er||_s.disabled)}};Tt?Ir(mr,it.renderElevatedRasterBackface?gs.backCW:gs.frontCW,it.stencilModeFor3D()):Ir(mr,gs.disabled,void 0),it.resetStencilClippingMasks()},"raster-particle":function(it,d,$,st,lt,ht){it.renderPass==="offscreen"&&function(dt,mt,Tt,Pt){if(!Pt.length)return;const Mt=dt.context,Ht=Mt.gl,$t=mt.getSource();if(!($t instanceof bu))return;const qt=Math.ceil(Math.sqrt(Tt.paint.get("raster-particle-count")));let Qt=Tt.particlePositionRGBAImage;if(!Qt||Qt.width!==qt){const mr=function(dr){const Ir=dr*dr,Tr=new Uint8Array(4*Ir),Ar=function(vr){return vr|=0,vr=Math.imul(2747636419^vr,2654435769),vr=Math.imul(vr^vr>>>16,2654435769),((vr=Math.imul(vr^vr>>>16,2654435769))>>>0)/4294967296},Er=1/1.1;for(let vr=0;vr<Ir;vr++){const Pr=Er*(Ar(2*vr+0)+Bp),Br=Er*(Ar(2*vr+1)+Bp),Or=255*Pr%1,Yr=255*Br%1,Qr=Or,un=Br-Yr/255,Cn=Yr;Tr[4*vr+0]=255*(Pr-Or/255),Tr[4*vr+1]=255*Qr,Tr[4*vr+2]=255*un,Tr[4*vr+3]=255*Cn}return Tr}(qt);Qt=Tt.particlePositionRGBAImage=new c.q({width:qt,height:qt},mr)}let Xt=Tt.particleFramebuffer;Xt?Xt.width!==qt&&(Xt.destroy(),Xt=Tt.particleFramebuffer=Mt.createFramebuffer(qt,qt,1,null)):Xt=Tt.particleFramebuffer=Mt.createFramebuffer(qt,qt,1,null);const sr=[];for(const mr of Pt){const dr=mt.getTile(mr);if(!(dr instanceof hy))continue;const Ir=Uv(dr,$t,Tt);if(!Ir)continue;const Tr=[dr.tileSize,dr.tileSize];let Ar=Tt.tileFramebuffer;Ar||(Ar=Tt.tileFramebuffer=Mt.createFramebuffer(Tr[0],Tr[1],1,null));let Er=dr.rasterParticleState;Er||(Er=dr.rasterParticleState=new Jy(Mt,mr,Tr,Qt));const vr=Er.update(Tt.lastInvalidatedAt);Er.particleTextureDimension!==qt&&Er.updateParticleTexture(mr,Qt);const Pr=Er.targetColorTexture;Er.targetColorTexture=Er.backgroundColorTexture,Er.backgroundColorTexture=Pr;const Br=Er.particleTexture0;Er.particleTexture0=Er.particleTexture1,Er.particleTexture1=Br,sr.push([mr,Ir,Er,vr])}if(sr.length===0)return;const ir=c.o.now(),hr=Tt.previousDrawTimestamp?.001*(ir-Tt.previousDrawTimestamp):.0167;if(Tt.previousDrawTimestamp=ir,Tt.hasColorMap()){Mt.activeTexture.set(Ht.TEXTURE0+2);let mr=Tt.colorRampTexture;mr||(mr=Tt.colorRampTexture=new c.T(Mt,Tt.colorRamp,Ht.RGBA8)),mr.bind(Ht.LINEAR,Ht.CLAMP_TO_EDGE)}Mt.bindFramebuffer.set(Tt.tileFramebuffer.framebuffer),function(mr,dr,Ir){const Tr=mr.context,Ar=Tr.gl,Er=dr.tileFramebuffer;Tr.activeTexture.set(Ar.TEXTURE0);const vr={u_texture:0,u_opacity:1.05*(Br=dr.paint.get("raster-particle-fade-opacity-factor"))/(Br+.05)},Pr=mr.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Br;for(const Or of Ir){const[,,Yr,Qr]=Or;Er.colorAttachment0.set(Yr.targetColorTexture.texture),Tr.viewport.set([0,0,Er.width,Er.height]),Tr.clear({color:c.ao.transparent}),Qr&&(Yr.backgroundColorTexture.bind(Ar.NEAREST,Ar.CLAMP_TO_EDGE),Pr.draw(mr,Ar.TRIANGLES,es.disabled,_s.disabled,Ps.alphaBlended,gs.disabled,vr,dr.id,mr.viewportBuffer,mr.quadTriangleIndexBuffer,mr.viewportSegments))}}(dt,Tt,sr),function(mr,dr,Ir,Tr){const Ar=mr.context,Er=Ar.gl,vr=Ir.tileFramebuffer,Pr=mr.transform.projection.name==="globe",Br=Ir.paint.get("raster-particle-max-speed");for(const Or of Tr){const[Yr,Qr,un]=Or;Ar.activeTexture.set(Er.TEXTURE0+0),Qr.texture.bind(Er.LINEAR,Er.CLAMP_TO_EDGE),vr.colorAttachment0.set(un.targetColorTexture.texture);const Cn=mr.getOrCreateProgram("rasterParticleDraw",{defines:Qr.defines,overrideFog:!1});Ar.activeTexture.set(Er.TEXTURE0+1);const qr=Qr.scalarData?[]:[0,1,2,3].map(Kr=>c.e9[Kr](Yr));qr.push(Yr);const Nr=Yr.canonical.x,tn=Yr.canonical.y;for(const Kr of qr){const yn=dr.getTile(Pr?Kr.wrapped():Kr);if(!yn)continue;const Ln=yn.rasterParticleState;if(!Ln)continue;const Un=Kr.canonical.x+(1<<Kr.canonical.z)*(Kr.wrap-Yr.wrap),kn=Kr.canonical.y;Ln.particleTexture0.bind(Er.NEAREST,Er.CLAMP_TO_EDGE);const An=mT(1,Ln.particleTexture0.size[0],[Un-Nr,kn-tn],0,Qr.texture.size,2,Br,Qr.textureOffset,Qr.scale,Qr.offset);Cn.draw(mr,Er.POINTS,es.disabled,_s.disabled,Ps.alphaBlended,gs.disabled,An,Ir.id,Ln.particleIndexBuffer,void 0,Ln.particleSegment)}}}(dt,mt,Tt,sr),Mt.bindFramebuffer.set(Tt.particleFramebuffer.framebuffer),function(mr,dr,Ir,Tr){const Ar=mr.context,Er=Ar.gl,vr=dr.paint.get("raster-particle-max-speed"),Pr=Tr*dr.paint.get("raster-particle-speed-factor")*.15,Br=function(Yr){return Math.pow(Yr,6)}(.01+1*dr.paint.get("raster-particle-reset-rate-factor")),Or=dr.particleFramebuffer;Ar.viewport.set([0,0,Or.width,Or.height]);for(const Yr of Ir){const[,Qr,un]=Yr;Ar.activeTexture.set(Er.TEXTURE0+0),Qr.texture.bind(Er.LINEAR,Er.CLAMP_TO_EDGE),Ar.activeTexture.set(Er.TEXTURE0+1);const Cn=un.particleTexture0;Cn.bind(Er.NEAREST,Er.CLAMP_TO_EDGE);const qr=kw(1,Cn.size[0],0,Qr.texture.size,vr,Pr,Br,Qr.textureOffset,Qr.scale,Qr.offset);Or.colorAttachment0.set(un.particleTexture1.texture),Ar.clear({color:c.ao.transparent}),mr.getOrCreateProgram("rasterParticleUpdate",{defines:Qr.defines}).draw(mr,Er.TRIANGLES,es.disabled,_s.disabled,Ps.unblended,gs.disabled,qr,dr.id,mr.viewportBuffer,mr.quadTriangleIndexBuffer,mr.viewportSegments)}}(dt,Tt,sr,hr)}(it,d,$,st),it.renderPass==="translucent"&&(function(dt,mt,Tt,Pt,Mt){const Ht=dt.context,$t=Ht.gl,qt=mt.getSource().tileSize,Qt=5*(1-c.ah(c.cL,c.cL+1,dt.transform.zoom))*qt+Tt.paint.get("raster-particle-elevation"),Xt=!dt.options.moving,sr=dt.transform.projection.name==="globe";if(!Pt.length)return;const[ir,hr]=dt.stencilConfigForOverlap(Pt),mr=[];sr&&mr.push("PROJECTION_GLOBE_VIEW");const dr=dt.stencilModeFor3D();for(const Ir of hr){const Tr=Ir.toUnwrapped(),Ar=mt.getTile(Ir);if(!Ar.rasterParticleState)continue;const Er=Ar.rasterParticleState,vr=100;Ar.registerFadeDuration(vr);const Pr=mt.findLoadedParent(Ir,0),Br=R_(Ar,Pr,mt,dt.transform,vr);let Or,Yr;dt.terrain&&dt.terrain.prepareDrawTile(),Ht.activeTexture.set($t.TEXTURE0),Er.targetColorTexture.bind($t.LINEAR,$t.CLAMP_TO_EDGE),Ht.activeTexture.set($t.TEXTURE1),Pr&&Pr.rasterParticleState?(Pr.rasterParticleState.targetColorTexture.bind($t.LINEAR,$t.CLAMP_TO_EDGE),Or=Math.pow(2,Pr.tileID.overscaledZ-Ar.tileID.overscaledZ),Yr=[Ar.tileID.canonical.x*Or%1,Ar.tileID.canonical.y*Or%1]):Er.targetColorTexture.bind($t.LINEAR,$t.CLAMP_TO_EDGE);const Qr=sr?Float32Array.from(dt.transform.expandedFarZProjMatrix):dt.transform.calculateProjMatrix(Tr,Xt),un=dt.transform,Cn=jw(un),qr=c.dG(Ir.canonical),Nr=c.dH(qr.getCenter().lat);let tn,Kr,yn,Ln,Un;sr?(tn=Float32Array.from(c.bk(c.dJ(Ir.canonical))),Kr=Float32Array.from(un.globeMatrix),yn=Float32Array.from(c.dF(un)),Ln=[c.aF(un.center.lng),c.aJ(un.center.lat)],Un=Float32Array.from(c.dI(Ir.canonical,qr,Nr,un.worldSize/un._pixelsPerMercatorPixel))):(tn=new Float32Array(16),Kr=new Float32Array(9),yn=new Float32Array(16),Ln=[0,0],Un=new Float32Array(9));const kn=fT(Qr,tn,Kr,yn,Un,Yr||[0,0],c.aj(dt.transform.zoom),Ln,Cn,Or||1,Br,Qt),An=dt.isTileAffectedByFog(Ir),Qn=dt.getOrCreateProgram("rasterParticle",{defines:mr,overrideFog:An});if(dt.uploadCommonUniforms(Ht,Qn,Tr),sr){const Kn=new es($t.LEQUAL,es.ReadOnly,dt.depthRangeFor3D),zn=0,Gn=dt.globeSharedBuffers;if(Gn){const[as,Es,$s]=Gn.getGridBuffers(Nr,zn!==0);Qn.draw(dt,$t.TRIANGLES,Kn,dr,Ps.alphaBlended,dt.renderElevatedRasterBackface?gs.frontCCW:gs.backCCW,kn,Tt.id,as,Es,$s)}}else{const Kn=dt.depthModeForSublayer(0,es.ReadOnly),zn=ir[Ir.overscaledZ],{tileBoundsBuffer:Gn,tileBoundsIndexBuffer:as,tileBoundsSegments:Es}=dt.getTileBoundsBuffers(Ar);Qn.draw(dt,$t.TRIANGLES,Kn,zn,Ps.alphaBlended,gs.disabled,kn,Tt.id,Gn,as,Es)}}dt.resetStencilClippingMasks()}(it,d,$,st),it.style.map.triggerRepaint())},background:function(it,d,$,st){const lt=$.paint.get("background-color"),ht=$.paint.get("background-color-use-theme").constantOr("default")==="none",dt=$.paint.get("background-opacity"),mt=$.paint.get("background-emissive-strength"),Tt=$.paint.get("background-pitch-alignment")==="viewport";if(dt===0)return;const Pt=it.context,Mt=Pt.gl,Ht=it.transform,$t=Ht.tileSize,qt=$.paint.get("background-pattern");let Qt;if(qt!==void 0&&(qt===null||(Qt=it.imageManager.getPattern(c.I.from(qt.toString()),$.scope,it.style.getLut($.scope)),!Qt)))return;const Xt=!qt&&lt.a===1&&dt===1&&it.opaquePassEnabledForLayer()?"opaque":"translucent";if(it.renderPass!==Xt)return;const sr=_s.disabled,ir=it.depthModeForSublayer(0,Xt==="opaque"?es.ReadWrite:es.ReadOnly),hr=it.colorModeForDrapableLayerRenderPass(mt),mr=qt?"backgroundPattern":"background";let dr,Ir=st;Ir||(dr=it.getBackgroundTiles(),Ir=Object.values(dr).map(Ar=>Ar.tileID)),qt&&(Pt.activeTexture.set(Mt.TEXTURE0),it.imageManager.bind(it.context,$.scope));const Tr=[];if(it.terrain&&it.terrain.renderingToTexture&&it.emissiveMode==="mrt-fallback"&&Tr.push("USE_MRT1"),Tt){const Ar=it.getOrCreateProgram(mr,{overrideFog:!1,overrideRtt:!0,defines:Tr}),Er=new Float32Array(c.bA([])),vr=new c.aQ(0,0,0,0,0),Pr=qt?Dm(Er,mt,dt,it,0,$.scope,Qt,Tt,{tileID:vr,tileSize:$t}):P_(Er,mt,dt,lt.toPremultipliedRenderColor(ht?null:$.lut));Ar.draw(it,Mt.TRIANGLES,ir,sr,hr,gs.disabled,Pr,$.id,it.viewportBuffer,it.quadTriangleIndexBuffer,it.viewportSegments)}else for(const Ar of Ir){const Er=it.isTileAffectedByFog(Ar),vr=it.getOrCreateProgram(mr,{overrideFog:Er,defines:Tr}),Pr=Ar.toUnwrapped(),Br=st?Ar.projMatrix:it.transform.calculateProjMatrix(Pr);it.prepareDrawTile();const Or=d?d.getTile(Ar):dr?dr[Ar.key]:new Ym(Ar,$t,Ht.zoom,it),Yr=qt?Dm(Br,mt,dt,it,0,$.scope,Qt,Tt,{tileID:Ar,tileSize:$t}):P_(Br,mt,dt,lt.toPremultipliedRenderColor(ht?null:$.lut));it.uploadCommonUniforms(Pt,vr,Pr);const{tileBoundsBuffer:Qr,tileBoundsIndexBuffer:un,tileBoundsSegments:Cn}=it.getTileBoundsBuffers(Or);vr.draw(it,Mt.TRIANGLES,ir,sr,hr,gs.disabled,Yr,$.id,Qr,un,Cn)}},sky:function(it,d,$){const st=it._atmosphere?c.aj(it.transform.zoom):1,lt=$.paint.get("sky-opacity")*st;if(lt===0)return;const ht=it.context,dt=$.paint.get("sky-type"),mt=new es(ht.gl.LEQUAL,es.ReadOnly,[0,1]),Tt=it.frameCounter/1e3%1;dt==="atmosphere"?it.renderPass==="offscreen"?$.needsSkyboxCapture(it)&&(function(Pt,Mt,Ht,$t){const qt=Pt.context,Qt=qt.gl;let Xt=Mt.skyboxFbo;if(!Xt){Xt=Mt.skyboxFbo=qt.createFramebuffer(32,32,1,null),Mt.skyboxGeometry=new tx(qt),Mt.skyboxTexture=qt.gl.createTexture(),Qt.bindTexture(Qt.TEXTURE_CUBE_MAP,Mt.skyboxTexture),Qt.texParameteri(Qt.TEXTURE_CUBE_MAP,Qt.TEXTURE_WRAP_S,Qt.CLAMP_TO_EDGE),Qt.texParameteri(Qt.TEXTURE_CUBE_MAP,Qt.TEXTURE_WRAP_T,Qt.CLAMP_TO_EDGE),Qt.texParameteri(Qt.TEXTURE_CUBE_MAP,Qt.TEXTURE_MIN_FILTER,Qt.LINEAR),Qt.texParameteri(Qt.TEXTURE_CUBE_MAP,Qt.TEXTURE_MAG_FILTER,Qt.LINEAR);for(let mr=0;mr<6;++mr)Qt.texImage2D(Qt.TEXTURE_CUBE_MAP_POSITIVE_X+mr,0,Qt.RGBA,32,32,0,Qt.RGBA,Qt.UNSIGNED_BYTE,null)}qt.bindFramebuffer.set(Xt.framebuffer),qt.viewport.set([0,0,32,32]);const sr=Mt.getCenter(Pt,!0),ir=Pt.getOrCreateProgram("skyboxCapture"),hr=new Float64Array(16);c.bA(hr),c.en(hr,hr,.5*-Math.PI),c0(Pt,Mt,ir,hr,sr,0),c.bA(hr),c.en(hr,hr,.5*Math.PI),c0(Pt,Mt,ir,hr,sr,1),c.bA(hr),c.cU(hr,hr,.5*-Math.PI),c0(Pt,Mt,ir,hr,sr,2),c.bA(hr),c.cU(hr,hr,.5*Math.PI),c0(Pt,Mt,ir,hr,sr,3),c.bA(hr),c0(Pt,Mt,ir,hr,sr,4),c.bA(hr),c.en(hr,hr,Math.PI),c0(Pt,Mt,ir,hr,sr,5),qt.viewport.set([0,0,Pt.width,Pt.height])}(it,$),$.markSkyboxValid(it)):it.renderPass==="sky"&&function(Pt,Mt,Ht,$t,qt){const Qt=Pt.context,Xt=Qt.gl,sr=Pt.transform,ir=Pt.getOrCreateProgram("skybox");Qt.activeTexture.set(Xt.TEXTURE0),Xt.bindTexture(Xt.TEXTURE_CUBE_MAP,Mt.skyboxTexture);const hr=((mr,dr,Ir,Tr,Ar)=>({u_matrix:mr,u_sun_direction:dr,u_cubemap:0,u_opacity:Tr,u_temporal_offset:Ar}))(sr.skyboxMatrix,Mt.getCenter(Pt,!1),0,$t,qt);Pt.uploadCommonUniforms(Qt,ir),ir.draw(Pt,Xt.TRIANGLES,Ht,_s.disabled,Pt.colorModeForRenderPass(),gs.backCW,hr,"skybox",Mt.skyboxGeometry.vertexBuffer,Mt.skyboxGeometry.indexBuffer,Mt.skyboxGeometry.segment)}(it,$,mt,lt,Tt):dt==="gradient"&&it.renderPass==="sky"&&function(Pt,Mt,Ht,$t,qt){const Qt=Pt.context,Xt=Qt.gl,sr=Pt.transform,ir=Pt.getOrCreateProgram("skyboxGradient");Mt.skyboxGeometry||(Mt.skyboxGeometry=new tx(Qt)),Qt.activeTexture.set(Xt.TEXTURE0);let hr=Mt.colorRampTexture;hr||(hr=Mt.colorRampTexture=new c.T(Qt,Mt.colorRamp,Xt.RGBA8)),hr.bind(Xt.LINEAR,Xt.CLAMP_TO_EDGE);const mr=((dr,Ir,Tr,Ar,Er)=>({u_matrix:dr,u_color_ramp:0,u_center_direction:Ir,u_radius:c.an(Tr),u_opacity:Ar,u_temporal_offset:Er}))(sr.skyboxMatrix,Mt.getCenter(Pt,!1),Mt.paint.get("sky-gradient-radius"),$t,qt);Pt.uploadCommonUniforms(Qt,ir),ir.draw(Pt,Xt.TRIANGLES,Ht,_s.disabled,Pt.colorModeForRenderPass(),gs.backCW,mr,"skyboxGradient",Mt.skyboxGeometry.vertexBuffer,Mt.skyboxGeometry.indexBuffer,Mt.skyboxGeometry.segment)}(it,$,mt,lt,Tt)},custom:function(it,d,$,st){const lt=it.context,ht=$.implementation;if(!it.transform.projection.unsupportedLayers||!it.transform.projection.unsupportedLayers.includes("custom")||it.terrain&&(it.terrain.renderingToTexture||it.renderPass==="offscreen")&&$.isDraped(d)){if(it.renderPass==="offscreen"){const dt=ht.prerender;if(dt){if(it.setCustomLayerDefaults(),lt.setColorMode(it.colorModeForRenderPass()),it.transform.projection.name==="globe"){const mt=it.transform.pointMerc;dt.call(ht,lt.gl,it.transform.customLayerMatrix(),it.transform.getProjection(),it.transform.globeToMercatorMatrix(),c.aj(it.transform.zoom),[mt.x,mt.y],it.transform.pixelsPerMeterRatio)}else dt.call(ht,lt.gl,it.transform.customLayerMatrix());lt.setDirty(),it.setBaseState()}}else if(it.renderPass==="translucent"){if(it.terrain&&it.terrain.renderingToTexture){const mt=ht.renderToTile;if(mt){const Tt=st[0].canonical,Pt={x:Tt.x+st[0].wrap*(ht.wrapTileId?0:1<<Tt.z),y:Tt.y,z:Tt.z};lt.setDepthMode(es.disabled),lt.setStencilMode(_s.disabled),lt.setColorMode(it.colorModeForRenderPass()),it.setCustomLayerDefaults(),mt.call(ht,lt.gl,Pt),lt.setDirty(),it.setBaseState()}return}it.setCustomLayerDefaults(),lt.setColorMode(it.colorModeForRenderPass()),lt.setStencilMode(_s.disabled);const dt=ht.renderingMode==="3d"?new es(it.context.gl.LEQUAL,es.ReadWrite,it.depthRangeFor3D):it.depthModeForSublayer(0,es.ReadOnly);if(lt.setDepthMode(dt),it.transform.projection.name==="globe"){const mt=it.transform.pointMerc;ht.render(lt.gl,it.transform.customLayerMatrix(),it.transform.getProjection(),it.transform.globeToMercatorMatrix(),c.aj(it.transform.zoom),[mt.x,mt.y],it.transform.pixelsPerMeterRatio)}else ht.render(lt.gl,it.transform.customLayerMatrix());lt.setDirty(),it.setBaseState(),lt.bindFramebuffer.set(null)}}else c.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(it,d,$,st){if(it.renderPass==="opaque")return;const lt=$.paint.get("model-opacity").constantOr(1),ht=$.paint.get("model-elevation-reference"),dt=ht==="ground",mt=ht==="ground";if(lt===0)return;const Tt=$.paint.get("model-cast-shadows");if(it.renderPass==="shadow"&&(!Tt||it.terrain&&lt<.65&&$._transitionablePaint._values["model-opacity"].value.expression instanceof c.ad))return;const Pt=it.shadowRenderer,Mt=$.paint.get("model-receive-shadows");Pt&&(Pt.useNormalOffset=!0,Mt||(Pt.enabled=!1));const Ht=()=>{Pt&&(Pt.useNormalOffset=!0,Mt||(Pt.enabled=!0))},$t=d.getSource();if(it.renderPass==="light-beam"&&$t.type!=="batched-model")return;if($t.type==="vector"||$t.type==="geojson")return function(dr,Ir,Tr,Ar,Er){const vr=dr.transform,Pr=vr.projection.name==="globe",Br=vr.getFreeCameraOptions().position;if(!dr.modelManager)return;const Or=dr.modelManager;Tr.modelManager=Or;const Yr=dr.shadowRenderer;if(!Tr._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Qr=Tr._unevaluatedLayout._values["model-id"],un=Object.assign({},Tr.layout.get("model-id").parameters),Cn=dr.style.order.indexOf(Tr.fqid),qr=Tr.paint.get("model-opacity").constantOr(1);for(const Nr of Ar){const tn=Ir.getTile(Nr).getBucket(Tr);if(!tn||tn.projection.name!==vr.projection.name)continue;const Kr=tn.getModelUris();if(Kr&&!tn.modelsRequested&&(Or.addModelsFromBucket(Kr,Er),tn.modelsRequested=!0),Pr)un.zoom=Nr.overscaledZ;else{const zn=Iu(Nr,vr);un.zoom=zn}const yn=Qr.possiblyEvaluate(un);if(qw(dr,tn,Nr),Vp.shadowUniformsInitialized=!1,Vp.useSingleShadowCascade=!!Yr&&Yr.getMaxCascadeForTile(Nr.toUnwrapped())===0,dr.renderPass==="shadow"&&Yr){if(dr.currentShadowCascade===1&&tn.isInsideFirstShadowMapFrustum)continue;const zn=vr.calculatePosMatrix(Nr.toUnwrapped(),vr.worldSize);if(Vp.tileMatrix.set(zn),Vp.shadowTileMatrix=Float32Array.from(Yr.calculateShadowPassMatrixFromMatrix(zn)),Vp.aabb.min=[0,0,0],Vp.aabb.max[0]=Vp.aabb.max[1]=c.al,Vp.aabb.max[2]=0,xT(tn,Vp,dr,Tr.scope))continue}const Ln=1<<Nr.canonical.z,Un=[((Br.x-Nr.wrap)*Ln-Nr.canonical.x)*c.al,(Br.y*Ln-Nr.canonical.y)*c.al,Br.z*Ln*c.al];dr.conflationActive&&Object.keys(tn.instancesPerModel).length>0&&dr.style.isLayerClipped(Tr,Ir.getSource())&&tn.updateReplacement(Nr,dr.replacementSource,Cn,Tr.scope)&&(tn.uploaded=!1,tn.upload(dr.context));let kn=0;const An=new Array,Qn=new Array,Kn=new Array;for(let zn in tn.instancesPerModel){const Gn=tn.instancesPerModel[zn];Gn.features.length>0&&!Pr&&(zn=yn.evaluate(Gn.features[0].feature,{}));const as=Or.getModel(zn,Er);if(as||Or.hasURLBeenRequested(zn)||tn.modelUris.includes(zn)||(tn.modelUris.push(zn),tn.modelsRequested=!1),as&&as.uploaded)if(Pr){const Es=c.c5([],[Br.x,Br.y,Br.z],dr.transform.worldSize);c.ew(Es,Es);for(let $s=0;$s<Gn.instancedDataArray.length;++$s){const so=[0,0,0],Jn=[1,1,1],ro=c.ex(),bs=Gn.tileCoordinatesForInstance($s),co=Gn.transformForInstance($s);c.ey(Jn,co),c.ez(ro,co),c.eA(so,ro);const xo=Gn.translationForInstance($s),mo=new c.aT(0,0);c.eB(tn.canonical,mo,bs.x,bs.y);const to=c.bC();c.eC(to,as,dr.transform,mo,so,Jn,xo,!0,!1,!1);const Ms=Gn.colorForInstance($s),ao=c.bA([]),Zo=c.ef(mo.lat,dr.transform.zoom),Bo=c.bq([],[1,1,1/Zo]);c.br(ao,ao,Es),Kn.push({zScaleMatrix:Bo,negCameraPosMatrix:ao});for(const uo of as.nodes)u0(dr,uo,to,dr.transform.expandedFarZProjMatrix,kn,An,Qn,as.materialOverrides,qr,Ms);++kn}}else for(const Es of as.nodes)Kw(dr,Tr,Es,Gn,Un,Nr,Vp)}if(Pr)if(dr.renderPass==="shadow"){for(const zn of Qn)Ep(zn.mesh,zn.nodeModelMatrix,dr,Tr);for(const zn of An)Ep(zn.mesh,zn.nodeModelMatrix,dr,Tr)}else Ww(dr,Tr,An,Qn,Kn)}}(it,d,$,st,L_(it,$)),void Ht();if(!$t.loaded())return;if($t.type==="batched-model")return function(dr,Ir,Tr,Ar){Tr.resetLayerRenderingStats(dr);const Er=dr.context,vr=dr.transform,Pr=dr.style.fog,Br=dr.shadowRenderer;if(vr.projection.name!=="mercator")return void c.w(`Drawing 3D landmark models for ${vr.projection.name} projection is not yet implemented`);const Or=dr.transform.getFreeCameraOptions().position,Yr=c.c5([],[Or.x,Or.y,Or.z],dr.transform.worldSize),Qr=c.ew([],Yr),un=c.bA([]),Cn=c.ef(vr.center.lat,vr.zoom),qr=c.bq([],[1,1,1/Cn]);c.br(un,un,Qr);const Nr=Tr.paint.get("model-opacity").constantOr(1),tn=new es(Er.gl.LEQUAL,es.ReadWrite,dr.depthRangeFor3D),Kr=new es(Er.gl.LEQUAL,es.ReadOnly,dr.depthRangeFor3D),yn=new c.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ln=dr.renderPass==="shadow",Un=Ln&&Br?Br.getCurrentCascadeFrustum():vr.getFrustum(vr.scaleZoom(vr.worldSize)),kn=Tr.paint.get("model-front-cutoff"),An=kn[2]<1,Qn=Sm(dr,Tr.paint.get("model-cutoff-fade-range")),Kn=Tr.getLayerRenderingStats();(function(zn,Gn,as,Es){const $s=zn.terrain?zn.terrain.exaggeration():0,so=zn.transform.zoom;for(const Jn of Es){const ro=Gn.getTile(Jn).getBucket(as);ro&&(ro.setFilter(as.filter),zn.conflationActive&&ro.updateReplacement(Jn,zn.replacementSource),ro.evaluateTransform(zn,as),zn.terrain&&$s>0&&ro.elevationUpdate(zn.terrain,$s,Jn,as.source),ro.needsReEvaluation(zn,so,as)&&ro.evaluate(as))}})(dr,Ir,Tr,Ar),function(){let zn,Gn,as;An?(zn=Ar.length-1,Gn=-1,as=-1):(zn=0,Gn=Ar.length,as=1);const Es=new Float64Array(16),$s=c.cA(),so=new c.P(0,0);for(let Jn=zn;Jn!==Gn;Jn+=as){const ro=Ar[Jn],bs=Ir.getTile(ro).getBucket(Tr);if(!bs||!bs.uploaded)continue;let co=!1;Br&&(co=Br.getMaxCascadeForTile(ro.toUnwrapped())===0);const xo=vr.calculatePosMatrix(ro.toUnwrapped(),vr.worldSize),mo=bs.modelTraits;!Ln&&An&&(c.bl(Es,xo),c.af($s,Yr,Es),so.x=$s[0],so.y=$s[1]);const to=[];bs.setFilter(Tr.filter);for(const Ms of bs.getNodesInfo()){if(Ms.hiddenByReplacement||!Ms.node.meshes)continue;const ao=Ms.node;let Zo=0;dr.terrain&&ao.elevation&&(Zo=ao.elevation*dr.terrain.exaggeration());const Bo=(()=>{const gu=Ms.aabb;return yn.min=[...gu.min],yn.max=[...gu.max],yn.min[2]+=Zo,yn.max[2]+=Zo,c.af(yn.min,yn.min,xo),c.af(yn.max,yn.max,xo),yn})(),uo=Ms.evaluatedScale;if(uo[0]<=1&&uo[1]<=1&&uo[2]<=1&&Bo.intersects(Un)===0)continue;if(!Ln&&An){const gu=.16666666666666666;Ms.cameraCollisionOpacity=Yr[0]>Bo.min[0]&&Yr[0]<Bo.max[0]&&Yr[1]>Bo.min[1]&&Yr[1]<Bo.max[1]&&Yr[2]*Cn<Bo.max[2]&&ao.footprint&&c.c0(so,ao.footprint)?Math.max(Ms.cameraCollisionOpacity-gu,0):Math.min(1,Ms.cameraCollisionOpacity+gu)}const Ys=[...xo],Ds=1/c.d7(ro.canonical),Lo=ao.anchor?ao.anchor[0]:0,_l=ao.anchor?ao.anchor[1]:0;c.br(Ys,Ys,[Lo*(uo[0]-1)+Ms.evaluatedTranslation[0]*Ds,_l*(uo[1]-1)+Ms.evaluatedTranslation[1]*Ds,Zo+Ms.evaluatedTranslation[2]]),c.cq(uo,c.eE)||c.cS(Ys,Ys,uo);const Ho=c.aB([],Ys,ao.globalMatrix),So=c.aB([],vr.expandedFarZProjMatrix,Ho),Pu=c.aB([],vr.expandedFarZProjMatrix,Ys),cu=c.aC([],[Lo,_l,Zo,1],So)[2];ao.hidden=!1;let zl=Nr;Ln||(An&&(zl*=Ms.cameraCollisionOpacity,zl*=Bs(Ys,vr,Ms.aabb,kn)),zl*=Fo(Qn,cu)),zl!==0?to.push({nodeInfo:Ms,depth:cu,opacity:zl,wvpForNode:So,wvpForTile:Pu,nodeModelMatrix:Ho,tileModelMatrix:Ys}):ao.hidden=!0}Ln||to.sort((Ms,ao)=>!An||Ms.opacity===1&&ao.opacity===1?Ms.depth<ao.depth?-1:1:Ms.opacity===1?-1:ao.opacity===1?1:Ms.depth>ao.depth?-1:1);for(const Ms of to){const ao=Ms.nodeInfo,Zo=ao.node;let Bo=c.aB([],qr,Ms.tileModelMatrix);c.aB(Bo,un,Bo);const uo=c.bl([],Bo);c.eg(uo,uo),c.cS(uo,uo,O_),Bo=c.aB(Bo,Bo,Zo.globalMatrix);const Ys=dr.renderPass==="light-beam",Ds=Tr.paint.get("model-color-use-theme").constantOr("default")==="none",Lo=mo&c.eI.HasMapboxMeshFeatures,_l=Lo?0:ao.evaluatedRMEA[0][2];for(let Ho=0;Ho<Zo.meshes.length;++Ho){const So=Zo.meshes[Ho],Pu=Ho===Zo.lightMeshIndex;let cu=Ms.wvpForNode;if(Pu){if(!Ys&&!dr.terrain&&dr.shadowRenderer){dr.currentLayer<dr.firstLightBeamLayer&&(dr.firstLightBeamLayer=dr.currentLayer);continue}cu=Ms.wvpForTile}else if(Ys)continue;const zl={defines:[]},gu=[];if(!Ln&&Br&&(Br.useNormalOffset=!!So.normalBuffer),nx(zl.defines,gu,So,dr,Ds?null:Tr.lut),Lo||zl.defines.push("DIFFUSE_SHADED"),co&&zl.defines.push("SHADOWS_SINGLE_CASCADE"),Kn&&(Ln?Kn.numRenderedVerticesInShadowPass+=So.vertexArray.length:Kn.numRenderedVerticesInTransparentPass+=So.vertexArray.length),Ln){Ep(So,Ms.nodeModelMatrix,dr,Tr);continue}let _u=null;if(Pr){const wl=ix(Ms.nodeModelMatrix,dr.transform);if(_u=new Float32Array(wl),vr.projection.name!=="globe"){const Co=So.aabb.min,Al=So.aabb.max,[Yo,Wo]=Pr.getOpacityForBounds(wl,Co[0],Co[1],Al[0],Al[1]);zl.overrideFog=Yo>=hn||Wo>=hn}}const nu=So.material;let Zu;nu.occlusionTexture&&nu.occlusionTexture.offsetScale&&(Zu=nu.occlusionTexture.offsetScale,zl.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const pp=dr.getOrCreateProgram("model",zl);!Ln&&Br&&Br.setupShadowsFromMatrix(Ms.tileModelMatrix,pp,Br.useNormalOffset),dr.uploadCommonUniforms(Er,pp,null,_u);const ju=nu.pbrMetallicRoughness;ju.metallicFactor=.9,ju.roughnessFactor=.5;const _a=n0(new Float32Array(cu),new Float32Array(Bo),new Float32Array(uo),new Float32Array(Zo.globalMatrix),dr,Ms.opacity,ju.baseColorFactor,nu.emissiveFactor,ju.metallicFactor,ju.roughnessFactor,nu,_l,Tr,[0,0,0],Zu);!Pu&&(ao.hasTranslucentParts||Ms.opacity<1)&&pp.draw(dr,Er.gl.TRIANGLES,tn,_s.disabled,Ps.disabled,gs.backCCW,_a,Tr.id,So.vertexBuffer,So.indexBuffer,So.segments,Tr.paint,dr.transform.zoom,void 0,gu),pp.draw(dr,Er.gl.TRIANGLES,Pu?Kr:tn,_s.disabled,Pu||Ms.opacity<1||ao.hasTranslucentParts?Ps.alphaBlended:Ps.unblended,gs.backCCW,_a,Tr.id,So.vertexBuffer,So.indexBuffer,So.segments,Tr.paint,dr.transform.zoom,void 0,gu)}}}}()}(it,d,$,st),void Ht();if($t.type!=="model")return;const qt=$t.getModels(),Qt=[],Xt=it.transform.getFreeCameraOptions().position,sr=c.c5([],[Xt.x,Xt.y,Xt.z],it.transform.worldSize);c.ew(sr,sr);const ir=[],hr=[];let mr=0;for(const dr of qt){const Ir=d.getFeatureState("",dr.id),Tr={type:"Unknown",id:dr.id,properties:dr.featureProperties},Ar=$.paint.get("model-rotation").evaluate(Tr,Ir),Er=$.paint.get("model-scale").evaluate(Tr,Ir),vr=$.paint.get("model-translation").evaluate(Tr,Ir),Pr=$.paint.get("model-opacity").evaluate(Tr,Ir);Gw($,dr.id,Ir,dr.featureProperties,dr.nodeOverrideNames,dr.nodeOverrides),Hw($,dr.id,Ir,dr.featureProperties,dr.materialOverrideNames,dr.materialOverrides),dr.nodeOverrides.size>0&&dr.computeBoundsAndApplyParent(),dr.computeModelMatrix(it,Ar,Er,vr,mt,dt,!1);const Br=c.bA([]),Or=c.ef(dr.position.lat,it.transform.zoom),Yr=c.bq([],[1,1,1/Or]);c.br(Br,Br,sr),Qt.push({zScaleMatrix:Yr,negCameraPosMatrix:Br});for(const Qr of dr.nodes)u0(it,Qr,dr.matrix,it.transform.expandedFarZProjMatrix,mr,ir,hr,dr.materialOverrides,Pr);mr++}if(ir.sort((dr,Ir)=>Ir.depth-dr.depth),it.renderPass!=="shadow")Ww(it,$,ir,hr,Qt),Ht();else{for(const dr of hr)Ep(dr.mesh,dr.nodeModelMatrix,it,$);for(const dr of ir)Ep(dr.mesh,dr.nodeModelMatrix,it,$);Ht()}}},lx={line:function(it,d,$){if(it.hasElevatedBuckets=!1,it.hasNonElevatedBuckets=!1,it._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||it._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(d){const st=d.getVisibleCoordinates();for(const lt of st){const ht=d.getTile(lt).getBucket(it);if(ht&&(ht.elevationType!=="none"?it.hasElevatedBuckets=!0:it.hasNonElevatedBuckets=!0,it.hasElevatedBuckets&&it.hasNonElevatedBuckets))break}}}else it.hasNonElevatedBuckets=!0},model:function(it,d,$){const st=d.getSource();if(!st.loaded())return;if(st.type==="vector"||st.type==="geojson")return void($.modelManager&&$.modelManager.upload($,L_($,it)));if(st.type==="batched-model"||st.type!=="model")return;const lt=st.getModels();for(const ht of lt)ht.upload($.context)},raster:function(it,d,$){const st=d.getSource();if(!(st instanceof bu&&st.loaded()))return;const lt=it.sourceLayer||st.rasterLayerIds&&st.rasterLayerIds[0];if(!lt)return;const ht=it.paint.get("raster-array-band")||st.getInitialBand(lt);if(ht==null)return;const dt=d.getIds().map(mt=>d.getTileByID(mt));for(const mt of dt)mt.updateNeeded(it.id,ht)&&st.prepareTile(mt,lt,it.id,ht)},"raster-particle":function(it,d,$){const st=d.getSource();if(!(st instanceof bu&&st.loaded()))return;const lt=it.sourceLayer||st.rasterLayerIds&&st.rasterLayerIds[0];if(!lt)return;const ht=it.paint.get("raster-particle-array-band")||st.getInitialBand(lt);if(ht==null)return;const dt=d.getIds().map(mt=>d.getTileByID(mt));for(const mt of dt)mt.updateNeeded(it.id,ht)&&st.prepareTile(mt,lt,it.id,ht)}},Xu={fill:Ky},ux={fill:function(it,d,$,st){if(!$.layout||$.layout.get("fill-elevation-reference")==="none"||$.paint.get("fill-opacity").constantOr(1)===0)return;const lt=it.context.gl,ht=new es(lt.LEQUAL,es.ReadOnly,it.depthRangeFor3D),dt=new _s({func:lt.ALWAYS,mask:255},255,255,lt.KEEP,lt.KEEP,lt.REPLACE),mt=it.transform.getFreeCameraOptions().position,Tt=it.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const Pt of st){const Mt=d.getTile(Pt),Ht=Mt.getBucket($);if(!Ht)continue;const $t=Ht.elevatedStructures;if(!$t||$t.depthSegments.segments[0].primitiveLength===0)continue;const qt=Lw(Pt.toUnwrapped(),mt),Qt=it.translatePosMatrix(Pt.projMatrix,Mt,$.paint.get("fill-translate"),$.paint.get("fill-translate-anchor")),Xt=i0(Qt,qt,0,1,0);Tt.draw(it,lt.TRIANGLES,ht,dt,Ps.disabled,gs.disabled,Xt,$.id,$t.vertexBuffer,$t.indexBuffer,$t.depthSegments,$.paint,it.transform.zoom)}}};class hx{constructor(d,$,st,lt,ht){this.context=new O0(d,$),this.transform=st,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=c.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const dt=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const Tt of dt)this._debugParams.enabledLayers[Tt]=!0;for(const Tt of dt);this.occlusionParams=new F0,this.setup(),this.numSublayers=zu.maxUnderzooming+zu.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new c.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new T0(this),this._wireframeDebugCache=new Lm,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const mt=new c.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new c.T(this.context,mt,d.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=lt,this.worldview=ht,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(d,$){const st=!!d&&!!d.terrain&&this.transform.projection.supportsTerrain;if(!(st||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new kv(this,d));const lt=this._terrain;this.transform.elevation=st?lt:null,lt.update(d,this.transform,$),this.transform.elevation&&!lt.enabled&&(this.transform.elevation=null)}_updateFog(d){const $=d.fog;if(!$||this.transform.projection.name==="globe"||$.getOpacity(this.transform.pitch)<1||$.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[st,lt]=$.getFovAdjustedRange(this.transform._fov);if(st>lt)return void(this.transform.fogCullDistSq=null);const ht=st+.78*(lt-st);this.transform.fogCullDistSq=ht*ht}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(d){d&&!this._terrain&&(this._terrain=new kv(this,this.style)),this._forceTerrainMode=d}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(d,$){if(this.width=d*c.o.devicePixelRatio,this.height=$*c.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const st of this.style.order)this.style._mergedLayers[st].resize()}setup(){const d=this.context,$=new c.bd;$.emplaceBack(0,0),$.emplaceBack(c.al,0),$.emplaceBack(0,c.al),$.emplaceBack(c.al,c.al),this.tileExtentBuffer=d.createVertexBuffer($,c.bf.members),this.tileExtentSegments=c.bg.simpleSegment(0,0,4,2);const st=new c.bd;st.emplaceBack(0,0),st.emplaceBack(c.al,0),st.emplaceBack(0,c.al),st.emplaceBack(c.al,c.al),this.debugBuffer=d.createVertexBuffer(st,c.bf.members),this.debugSegments=c.bg.simpleSegment(0,0,4,5);const lt=new c.bd;lt.emplaceBack(-1,-1),lt.emplaceBack(1,-1),lt.emplaceBack(-1,1),lt.emplaceBack(1,1),this.viewportBuffer=d.createVertexBuffer(lt,c.bf.members),this.viewportSegments=c.bg.simpleSegment(0,0,4,2);const ht=new c.b1;ht.emplaceBack(0,0,0,0),ht.emplaceBack(c.al,0,c.al,0),ht.emplaceBack(0,c.al,0,c.al),ht.emplaceBack(c.al,c.al,c.al,c.al),this.mercatorBoundsBuffer=d.createVertexBuffer(ht,c.bi.members),this.mercatorBoundsSegments=c.bg.simpleSegment(0,0,4,2);const dt=new c.b0;dt.emplaceBack(0,1,2),dt.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=d.createIndexBuffer(dt);const mt=new c.be;for(const Pt of[0,1,3,2,0])mt.emplaceBack(Pt);this.debugIndexBuffer=d.createIndexBuffer(mt),this.emptyTexture=new c.T(d,new c.q({width:1,height:1},Uint8Array.of(0,0,0,0)),d.gl.RGBA8),this.identityMat=c.bC();const Tt=this.context.gl;this.stencilClearMode=new _s({func:Tt.ALWAYS,mask:0},0,255,Tt.ZERO,Tt.ZERO,Tt.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(d){return d._makeTileBoundsBuffers(this.context,this.transform.projection),d._tileBoundsBuffer?{tileBoundsBuffer:d._tileBoundsBuffer,tileBoundsIndexBuffer:d._tileBoundsIndexBuffer,tileBoundsSegments:d._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const d=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,d.TRIANGLES,es.disabled,this.stencilClearMode,Ps.disabled,gs.disabled,A_(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(d,$,st){if(!$||this.currentStencilSource===$.id||!d.isTileClipped()||!st||st.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let mt=!1;for(const Tt of st)if(this._tileClippingMaskIDs[Tt.key]===void 0){mt=!0;break}if(!mt)return}this.currentStencilSource=$.id;const lt=this.context,ht=lt.gl;this.nextStencilID+st.length>256&&this.clearStencil(),lt.setColorMode(Ps.disabled),lt.setDepthMode(es.disabled);const dt=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const mt of st){const Tt=$.getTile(mt),Pt=this._tileClippingMaskIDs[mt.key]=this.nextStencilID++,{tileBoundsBuffer:Mt,tileBoundsIndexBuffer:Ht,tileBoundsSegments:$t}=this.getTileBoundsBuffers(Tt);dt.draw(this,ht.TRIANGLES,es.disabled,new _s({func:ht.ALWAYS,mask:0},Pt,255,ht.KEEP,ht.KEEP,ht.REPLACE),Ps.disabled,gs.disabled,A_(mt.projMatrix),"$clipping",Mt,Ht,$t)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const d=this.nextStencilID++,$=this.context.gl;return new _s({func:$.NOTEQUAL,mask:255},d,255,$.KEEP,$.KEEP,$.REPLACE)}stencilModeForClipping(d){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(d);const $=this.context.gl;return new _s({func:$.EQUAL,mask:255},this._tileClippingMaskIDs[d.key],0,$.KEEP,$.KEEP,$.REPLACE)}stencilConfigForOverlap(d){const $=this.context.gl,st=d.sort((dt,mt)=>mt.overscaledZ-dt.overscaledZ),lt=st[st.length-1].overscaledZ,ht=st[0].overscaledZ-lt+1;if(ht>1){this.currentStencilSource=void 0,this.nextStencilID+ht>256&&this.clearStencil();const dt={};for(let mt=0;mt<ht;mt++)dt[mt+lt]=new _s({func:$.GEQUAL,mask:255},mt+this.nextStencilID,255,$.KEEP,$.KEEP,$.REPLACE);return this.nextStencilID+=ht,[dt,st]}return[{[lt]:_s.disabled},st]}colorModeForRenderPass(){const d=this.context.gl;return this._showOverdrawInspector?new Ps([d.CONSTANT_COLOR,d.ONE,d.CONSTANT_COLOR,d.ONE],new c.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ps.unblended:Ps.alphaBlended}colorModeForDrapableLayerRenderPass(d){const $=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?d!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new Ps([$.ONE,$.ONE_MINUS_SRC_ALPHA,$.CONSTANT_ALPHA,$.ONE_MINUS_SRC_ALPHA],new c.ao(0,0,0,d??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new Ps([$.ONE,$.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,$.ONE_MINUS_SRC_ALPHA],c.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(d,$,st,lt=!1){if(this.depthOcclusion)return new es(this.context.gl.GREATER,es.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!lt)return es.disabled;const ht=1-((1+this.currentLayer)*this.numSublayers+d)*this.depthEpsilon;return new es(st||this.context.gl.LEQUAL,$,[ht,ht])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const d=this.context.gl,$=Math.ceil(this.width),st=Math.ceil(this.height),lt=this.context.bindFramebuffer.get(),ht=d.getParameter(d.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===$&&this.depthFBO.height===st||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),$!==0&&st!==0&&(this.depthFBO=new Nw(this.context,$,st,0,"texture"),this.depthTexture=new c.T(this.context,{width:$,height:st,data:null},d.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(lt),d.bindTexture(d.TEXTURE_2D,ht),this.depthFBO&&(d.bindFramebuffer(d.READ_FRAMEBUFFER,null),d.bindFramebuffer(d.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),d.blitFramebuffer(0,0,$,st,0,0,$,st,d.DEPTH_BUFFER_BIT,d.NEAREST),d.bindFramebuffer(d.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((d,$)=>d+$/this._fpsHistory.length,0))}render(d,$){const st=c.o.now();this._dt=st-this._timeStamp,this._timeStamp=st,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=d.map.repaint,this.style=d,this.options=$;const lt=this.style._mergedLayers,ht=!(!this.terrain||!this.terrain.enabled),dt=()=>this.style._getOrder(ht).filter(qr=>{const Nr=lt[qr];return!(Nr.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Nr.type]});let mt=dt(),Tt=!1,Pt=!1,Mt=null,Ht=0,$t=!1;for(const qr of mt){const Nr=lt[qr];Nr.visibility!=="none"&&(Nr.type==="circle"?Tt=!0:Nr.type==="building"?(Mt=Nr,++Ht):Nr.type==="symbol"&&(Nr.hasOcclusionOpacityProperties?Pt=!0:Tt=!0))}this.updateEmissiveMode();let qt=mt.map(qr=>lt[qr]);const Qt=this.style._mergedSourceCaches;this.imageManager=d.imageManager,this.modelManager=d.modelManager,this.symbolFadeChange=d.placement.symbolFadeChange(c.o.now()),this.imageManager.beginFrame();for(const qr in Qt){const Nr=Qt[qr];Nr.used&&(Nr.prepare(this.context),Nr.getSource().usedInConflation&&++Ht)}let Xt=!1;for(const qr of qt)qr.isHidden(this.transform.zoom)||(qr.type==="clip"&&(Xt=!0),this.prepareLayer(qr));const sr={},ir={},hr={},mr={},dr={};for(const qr in Qt){const Nr=Qt[qr];sr[qr]=Nr.getVisibleCoordinates(),ir[qr]=sr[qr].slice().reverse(),hr[qr]=Nr.getVisibleCoordinates(!0).reverse(),mr[qr]=Nr.getShadowCasterCoordinates(),dr[qr]=Nr.sortCoordinatesByDistance(sr[qr])}const Ir=qr=>{const Nr=this.style.getLayerSourceCache(qr);return Nr&&Nr.used?Nr.getSource():null};if(Ht||Xt||this._clippingActiveLastFrame){const qr=[],Nr=[];let tn=0;for(const Kr of qt)this.isSourceForClippingOrConflation(Kr,Ir(Kr))&&(qr.push(Kr),Nr.push(tn)),tn++;if(qr&&(Xt||qr.length>1)||this._clippingActiveLastFrame){Xt=!1;const Kr=[];for(let yn=0;yn<qr.length;yn++){const Ln=qr[yn],Un=Nr[yn],kn=this.style.getLayerSourceCache(Ln);if(!kn||!kn.used||!kn.getSource().usedInConflation&&Ln.type!=="clip"&&Ln.type!=="building")continue;let An=c.eQ,Qn=c.b_.None;const Kn=[];let zn=!0;if(Ln.type==="building")An=c.eS;else if(Ln.type==="clip"){An=Un;for(const Gn of Ln.layout.get("clip-layer-types"))Qn|=Gn==="model"?c.b_.Model:Gn==="symbol"?c.b_.Symbol:c.b_.FillExtrusion;for(const Gn of Ln.layout.get("clip-layer-scope"))Kn.push(Gn);Ln.isHidden(this.transform.zoom)?zn=!1:Xt=!0}zn&&Kr.push({layer:Ln.fqid,cache:kn,order:An,clipMask:Qn,clipScope:Kn})}this.replacementSource.setSources(Kr),$t=!0}}this._clippingActiveLastFrame=Xt,$t||this.replacementSource.clear(),this.conflationActive=$t,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let qr=0;qr<qt.length;qr++){const Nr=qt[qr];if(Nr.visibility==="none")continue;const tn=Nr.cutoffRange();if(this.longestCutoffRange=Math.max(tn,this.longestCutoffRange),tn>0){const Kr=Ir(Nr);Kr&&(this.minCutoffZoom=Math.max(Kr.minzoom,this.minCutoffZoom)),Nr.minzoom&&(this.minCutoffZoom=Math.max(Nr.minzoom,this.minCutoffZoom))}Nr.is3D(ht)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=qr),this._lastOcclusionLayer=qr)}const Tr=this.style&&this.style.fog;Tr?(this._fogVisible=Tr.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Tr.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(hr),this.opaquePassCutoff=0,mt=dt(),qt=mt.map(qr=>lt[qr]));const Ar=this._shadowRenderer;if(Ar){Ar.updateShadowParameters(this.transform,this.style.directionalLight);for(const qr in Qt)for(const Nr of sr[qr]){let tn={min:0,max:0};this.terrain&&(tn=this.terrain.getMinMaxForTile(Nr)||tn),Ar.addShadowReceiver(Nr.toUnwrapped(),tn.min,tn.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new c.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new $w(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Er=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),vr=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Er&&!this._snow&&(this._snow=new qv(this)),!Er&&this._snow&&(this._snow.destroy(),delete this._snow),vr&&!this._rain&&(this._rain=new ax(this)),!vr&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),Mt){this.buildingTileBorderManager||(this.buildingTileBorderManager=new rx);const qr=this.style.getLayerSourceCache(Mt);this.buildingTileBorderManager.updateBorders(qr,Mt)}if(!Qo.has(this.context.gl))return;this.renderPass="offscreen";for(const qr of qt){const Nr=d.getLayerSourceCache(qr);if(!qr.hasOffscreenPass()||qr.isHidden(this.transform.zoom))continue;const tn=Nr?ir[Nr.id]:void 0;(qr.type==="custom"||qr.type==="raster"||qr.type==="raster-particle"||qr.isSky()||tn&&tn.length)&&this.renderLayer(this,Nr,qr,tn)}this.depthRangeFor3D=[0,1-(qt.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,mr)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Pr=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Br=(()=>{if($.showOverdrawInspector)return c.ao.black;const qr=this.style.fog;if(qr&&this.transform.projection.supportsFog){const Nr=this.style.getLut(qr.scope);if(!Pr){const tn=qr.properties.get("color-use-theme")==="none",Kr=qr.properties.get("color").toNonPremultipliedRenderColor(tn?null:Nr).toArray01();return new c.ao(...Kr)}if(Pr){const tn=qr.properties.get("space-color-use-theme")==="none",Kr=qr.properties.get("space-color").toNonPremultipliedRenderColor(tn?null:Nr).toArray01();return new c.ao(...Kr)}}return c.ao.transparent})();if(this.context.clear({color:Br,depth:1}),this.clearStencil(),this._showOverdrawInspector=$.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Pr&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=mt.length-1;this.currentLayer>=0;this.currentLayer--){const qr=qt[this.currentLayer],Nr=d.getLayerSourceCache(qr);if(qr.isSky())continue;const tn=Nr?(qr.is3D(ht)?dr:ir)[Nr.id]:void 0;this._renderTileClippingMasks(qr,Nr,tn),this.renderLayer(this,Nr,qr,tn)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Pr&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||c.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<mt.length;this.currentLayer++){const qr=qt[this.currentLayer],Nr=d.getLayerSourceCache(qr);qr.isSky()&&this.renderLayer(this,Nr,qr,Nr?ir[Nr.id]:void 0)}function Or(qr,Nr){let tn;return Nr&&(tn=(qr.type==="symbol"?hr:qr.is3D(ht)?dr:ir)[Nr.id]),tn}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<mt.length;){const qr=qt[this.currentLayer];if(qr.type==="raster"||qr.type==="raster-particle"){const Nr=d.getLayerSourceCache(qr);this.renderLayer(this,Nr,qr,Or(qr,Nr))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Yr=0;Ar&&(Yr=Ar.getShadowCastingLayerCount());let Qr=!1,un=-1;for(let qr=0;qr<mt.length;++qr){const Nr=qt[qr];Nr.isHidden(this.transform.zoom)||Nr.is3D(ht)&&(un=qr)}Pt&&un===-1&&(Tt=!0);let Cn=!1;for(;this.currentLayer<mt.length;){const qr=qt[this.currentLayer],Nr=d.getLayerSourceCache(qr);if(qr.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(qr)){if(qr.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Cn&&qr.is3D(ht)&&!ht){const tn=this.currentLayer,Kr=yn=>{for(this.currentLayer=0;this.currentLayer<qt.length;this.currentLayer++){const Ln=qt[this.currentLayer];if(Xu[Ln.type]){const Un=this.style.getLayerSourceCache(Ln);Xu[Ln.type](this,Un,Ln,Or(Ln,Un),yn)}}};Kr("initialize"),Kr("reset"),this.currentLayer=tn,Cn=!0}if(Tt&&!Qr&&this.terrain&&!this.transform.isOrthographic&&(Qr=!0,this.blitDepth()),Pt&&un!==-1&&this.currentLayer===un+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(qr,Nr,Nr?sr[Nr.id]:void 0),this.renderLayer(this,Nr,qr,Or(qr,Nr)),!this.terrain&&Ar&&Yr>0&&qr.hasShadowPass()&&--Yr==0){{this.clearStencil(),this.resetStencilClippingMasks();const tn=this.currentLayer;for(this.currentLayer=0;this.currentLayer<qt.length;this.currentLayer++){const Kr=qt[this.currentLayer];if(ux[Kr.type]){const yn=this.style.getLayerSourceCache(Kr);ux[Kr.type](this,yn,Kr,Or(Kr,yn))}}this.currentLayer=tn}if(Ar.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const tn=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=tn;this.currentLayer++){const Kr=qt[this.currentLayer];if(!Kr.hasLightBeamPass())continue;const yn=d.getLayerSourceCache(Kr);this.renderLayer(this,yn,Kr,yn?ir[yn.id]:void 0)}this.currentLayer=tn,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const tn=this.currentLayer;this.depthOcclusion=!0;for(const Kr of this.layersWithOcclusionOpacity){this.currentLayer=Kr;const yn=qt[this.currentLayer],Ln=d.getLayerSourceCache(yn),Un=Ln?ir[Ln.id]:void 0;this.terrain||this._renderTileClippingMasks(yn,Ln,Ln?sr[Ln.id]:void 0),this.renderLayer(this,Ln,yn,Un)}this.depthOcclusion=!1,this.currentLayer=tn,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let qr=null;qt.forEach(Nr=>{const tn=d.getLayerSourceCache(Nr);tn&&!Nr.isHidden(this.transform.zoom)&&tn.getVisibleCoordinates().length&&(!qr||qr.getSource().maxzoom<tn.getSource().maxzoom)&&(qr=tn)}),qr&&this.options.showTileBoundaries&&Pn(this,qr,qr.getVisibleCoordinates(),c.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Pn(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new c.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(qr){const Nr=qr.transform.padding;l0(qr,qr.transform.height-(Nr.top||0),3,Fw),l0(qr,Nr.bottom||0,3,Bw),ga(qr,Nr.left||0,3,zw),ga(qr,qr.transform.width-(Nr.right||0),3,o0);const tn=qr.transform.centerPoint;(function(Kr,yn,Ln,Un){Gr(Kr,yn-1,Ln-10,2,20,Un),Gr(Kr,yn-10,Ln-1,20,2,Un)})(qr,tn.x,qr.transform.height-tn.y,a0)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),$t||(this.conflationActive=!1)}prepareLayer(d){this.gpuTimingStart(d);const{unsupportedLayers:$}=this.transform.projection,st=!$||!$.includes(d.type);if(lx[d.type]&&(st||this.terrain&&d.type==="custom")){const lt=this.style.getLayerSourceCache(d);lx[d.type](d,lt,this)}this.gpuTimingEnd()}renderLayer(d,$,st,lt){st.isHidden(this.transform.zoom)||(st.type==="background"||st.type==="sky"||st.type==="custom"||st.type==="model"||st.type==="raster"||st.type==="raster-particle"||lt&&lt.length)&&(this.id=st.id,this.gpuTimingStart(st),d.transform.projection.unsupportedLayers&&d.transform.projection.unsupportedLayers.includes(st.type)&&(!d.terrain||st.type!=="custom")||st.type==="clip"||Om[st.type](d,$,st,lt,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(d){if(!this.options.gpuTiming)return;const $=this.context.extTimerQuery,st=this.context.gl;let lt=this.gpuTimers[d.id];lt||(lt=this.gpuTimers[d.id]={calls:0,cpuTime:0,query:st.createQuery()}),lt.calls++,st.beginQuery($.TIME_ELAPSED_EXT,lt.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const d=this.context.extTimerQuery,$=this.context.gl,st=$.createQuery();this.deferredRenderGpuTimeQueries.push(st),$.beginQuery(d.TIME_ELAPSED_EXT,st)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const d=this.gpuTimers;return this.gpuTimers={},d}collectDeferredRenderGpuQueries(){const d=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],d}queryGpuTimers(d){const $={};for(const st in d){const lt=d[st],ht=this.context.extTimerQuery,dt=ht.getQueryParameter(lt.query,this.context.gl.QUERY_RESULT)/1e6;ht.deleteQueryEXT(lt.query),$[st]=dt}return $}queryGpuTimeDeferredRender(d){if(!this.options.gpuTimingDeferredRender)return 0;const $=this.context.gl;let st=0;for(const lt of d)st+=$.getQueryParameter(lt,$.QUERY_RESULT)/1e6,$.deleteQuery(lt);return st}translatePosMatrix(d,$,st,lt,ht){if(!st[0]&&!st[1])return d;const dt=ht?lt==="map"?this.transform.angle:0:lt==="viewport"?-this.transform.angle:0;if(dt){const Pt=Math.sin(dt),Mt=Math.cos(dt);st=[st[0]*Mt-st[1]*Pt,st[0]*Pt+st[1]*Mt]}const mt=[ht?st[0]:c.ay($,st[0],this.transform.zoom),ht?st[1]:c.ay($,st[1],this.transform.zoom),0],Tt=new Float32Array(16);return c.br(Tt,d,mt),Tt}saveTileTexture(d){if(d.context!==this.context)return;const $=d.size[0],st=this._tileTextures[$];st?st.push(d):this._tileTextures[$]=[d]}getTileTexture(d){const $=this._tileTextures[d];return $&&$.length>0?$.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(d,$,st){const lt=st===void 0?this.terrain&&this.terrain.renderingToTexture:st,ht=[];return this.style&&this.style.enable3dLights()&&(d==="globeRaster"||d==="terrainRaster"?(ht.push("LIGHTING_3D_MODE"),ht.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):lt||ht.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||ht.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(ht.push("TERRAIN"),this.linearFloatFilteringSupported()&&ht.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&ht.push("GLOBE"),!this._fogVisible||lt||$!==void 0&&!$||ht.push("FOG","FOG_DITHERING"),lt&&ht.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&ht.push("OVERDRAW_INSPECTOR"),ht}getOrCreateProgram(d,$){this.cache=this.cache||{};const st=$&&$.defines||[],lt=$&&$.config,ht=this.currentGlobalDefines(d,$&&$.overrideFog,$&&$.overrideRtt).concat(st),dt=ww.cacheKey(yv[d],d,ht,lt);return this.cache[dt]||(this.cache[dt]=new ww(this.context,d,yv[d],lt,qy[d],ht)),this.cache[dt]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const d=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(d.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(d,$){if(this.style.enable3dLights()){const st=this.style.directionalLight,lt=this.style.ambientLight;if(st&&lt){const ht=((dt,mt,Tt)=>{const Pt=dt.properties.get("direction"),Mt=dt.properties.get("color-use-theme")==="none",Ht=dt.properties.get("color").toNonPremultipliedRenderColor(Mt?null:Tt.getLut(dt.scope)).toArray01(),$t=dt.properties.get("intensity"),qt=mt.properties.get("color-use-theme")==="none",Qt=mt.properties.get("color").toNonPremultipliedRenderColor(qt?null:Tt.getLut(mt.scope)).toArray01(),Xt=mt.properties.get("intensity"),sr=[Pt.x,Pt.y,Pt.z],ir=c.dN(Qt,Xt),hr=c.dN(Ht,$t);return{u_lighting_ambient_color:ir,u_lighting_directional_dir:sr,u_lighting_directional_color:hr,u_ground_radiance:D0(sr,hr,ir)}})(st,lt,this.style);$.setLightsUniformValues(d,ht)}}}uploadCommonUniforms(d,$,st,lt,ht){if(this.uploadCommonLightUniforms(d,$),this.terrain&&this.terrain.renderingToTexture)return;const dt=this.style.fog;if(dt){const mt=dt.getOpacity(this.transform.pitch),Tt=((Pt,Mt,Ht,$t,qt,Qt,Xt,sr,ir,hr,mr,dr)=>{const Ir=Pt.transform,Tr=Mt.properties.get("color-use-theme")==="none",Ar=Mt.properties.get("color").toNonPremultipliedRenderColor(Tr?null:Pt.style.getLut(Mt.scope)).toArray01();Ar[3]=$t;const Er=Pt.frameCounter/1e3%1,[vr,Pr]=Mt.properties.get("vertical-range");return{u_fog_matrix:Ht?Ir.calculateFogTileMatrix(Ht):dr||Pt.identityMat,u_fog_range:Mt.getFovAdjustedRange(Ir._fov),u_fog_color:Ar,u_fog_horizon_blend:Mt.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(vr,Pr),Pr],u_fog_temporal_offset:Er,u_frustum_tl:qt,u_frustum_tr:Qt,u_frustum_br:Xt,u_frustum_bl:sr,u_globe_pos:ir,u_globe_radius:hr,u_viewport:mr,u_globe_transition:c.aj(Ir.zoom),u_is_globe:+(Ir.projection.name==="globe")}})(this,dt,st,mt,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*c.o.devicePixelRatio,this.transform.height*c.o.devicePixelRatio],lt);$.setFogUniformValues(d,Tt)}ht&&$.setCutoffUniformValues(d,ht.uniformValues)}setTileLoadedFlag(d){this.tileLoaded=d}saveCanvasCopy(){const d=this.canvasCopy();d&&(this.frameCopies.push(d),this.tileLoaded=!1)}canvasCopy(){const d=this.context.gl,$=d.createTexture();return d.bindTexture(d.TEXTURE_2D,$),d.copyTexImage2D(d.TEXTURE_2D,0,d.RGBA,0,0,d.drawingBufferWidth,d.drawingBufferHeight,0),$}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const d=this.style&&this.style.fog;return!!d&&d.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const d=this._backgroundTiles,$=this._backgroundTiles={},st=this.transform.coveringTiles({tileSize:512});for(const lt of st)$[lt.key]=d[lt.key]||new Ym(lt,512,this.transform.tileZoom,this,void 0,this.worldview);return $}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(d,$){return!(!d.is3D(!(!this.terrain||!this.terrain.enabled))||d.type!=="clip"&&d.type!=="building"&&(d.minzoom&&d.minzoom>this.transform.zoom||(this.style._clipLayerPresent||d.sourceLayer!=="building"&&d.sourceLayer!=="procedural_buildings")&&(!$||$.type!=="batched-model")))}isTileAffectedByFog(d){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let $=this._cachedTileFogOpacities[d.key];return $||(this._cachedTileFogOpacities[d.key]=$=this.style.fog.getOpacityForTile(d)),$[0]>=hn||$[1]>=hn}setupDepthForOcclusion(d,$,st){const lt=this.context,ht=lt.gl,dt=!!st;var mt;st||(st={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),lt.activeTexture.set(ht.TEXTURE3),d&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(ht.NEAREST,ht.CLAMP_TO_EDGE),st.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],st.u_depth_range_unpack=[2/((mt=this.depthRangeFor3D)[1]-mt[0]),-1-2*mt[0]/(mt[1]-mt[0])],st.u_occluder_half_size=.5*this.occlusionParams.occluderSize,st.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(ht.NEAREST,ht.CLAMP_TO_EDGE),lt.activeTexture.set(ht.TEXTURE0),dt||$.setTerrainUniformValues(lt,st)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const d=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=d?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function dx(it,d){let $=!1,st=null;const lt=()=>{st=null,$&&(it(),st=setTimeout(lt,d),$=!1)};return()=>($=!0,st||lt(),st)}class Kv{constructor(d){this._hashName=d&&encodeURIComponent(d),c.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=dx(this._updateHashUnthrottled.bind(this),300)}addTo(d){return this._map=d,window.addEventListener("hashchange",this._onHashChange,!1),d.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const d=this._map;if(!d)return"";const $=Fl(d);if(this._hashName){const st=this._hashName;let lt=!1;const ht=location.hash.slice(1).split("&").map(dt=>{const mt=dt.split("=")[0];return mt===st?(lt=!0,`${mt}=${$}`):dt}).filter(dt=>dt);return lt||ht.push(`${st}=${$}`),`#${ht.join("&")}`}return`#${$}`}_getCurrentHash(){const d=location.hash.replace("#","");if(this._hashName){let $;return d.split("&").map(st=>st.split("=")).forEach(st=>{st[0]===this._hashName&&($=st)}),($&&$[1]||"").split("/")}return d.split("/")}_onHashChange(){const d=this._map;if(!d)return!1;const $=this._getCurrentHash();if($.length>=3&&!$.some(st=>isNaN(Number(st)))){const st=d.dragRotate.isEnabled()&&d.touchZoomRotate.isEnabled()?+($[3]||0):d.getBearing();return d.jumpTo({center:[+$[2],+$[1]],zoom:+$[0],bearing:st,pitch:+($[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Fl(it,d){const $=it.getCenter(),st=Math.round(100*it.getZoom())/100,lt=Math.ceil((st*Math.LN2+Math.log(512/360/.5))/Math.LN10),ht=Math.pow(10,lt),dt=Math.round($.lng*ht)/ht,mt=Math.round($.lat*ht)/ht,Tt=it.getBearing(),Pt=it.getPitch();let Mt=d?`/${dt}/${mt}/${st}`:`${st}/${mt}/${dt}`;return(Tt||Pt)&&(Mt+="/"+Math.round(10*Tt)/10),Pt&&(Mt+=`/${Math.round(Pt)}`),Mt}const z0={linearity:.3,easing:c.eT(0,0,.3,1)},Xv=Object.assign({deceleration:2500,maxSpeed:1400},z0),Zv=Object.assign({deceleration:20,maxSpeed:1400},z0),d0=Object.assign({deceleration:1e3,maxSpeed:360},z0),Yv=Object.assign({deceleration:1e3,maxSpeed:90},z0);class Qv{constructor(d){this._map=d,this.clear()}clear(){this._inertiaBuffer=[]}record(d){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.o.now(),settings:d})}_drainInertiaBuffer(){const d=this._inertiaBuffer,$=c.o.now();for(;d.length>0&&$-d[0].time>160;)d.shift()}_onMoveEnd(d){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const $={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:ht}of this._inertiaBuffer)$.zoom+=ht.zoomDelta||0,$.bearing+=ht.bearingDelta||0,$.pitch+=ht.pitchDelta||0,ht.panDelta&&$.pan._add(ht.panDelta),ht.around&&($.around=ht.around),ht.pinchAround&&($.pinchAround=ht.pinchAround);const st=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,lt={};if($.pan.mag()){const ht=Up($.pan.mag(),st,Object.assign({},Xv,d||{}));lt.offset=$.pan.mult(ht.amount/$.pan.mag()),lt.center=this._map.transform.center,V0(lt,ht)}if($.zoom){const ht=Up($.zoom,st,Zv);lt.zoom=this._map.transform.zoom+ht.amount,V0(lt,ht)}if($.bearing){const ht=Up($.bearing,st,d0);lt.bearing=this._map.transform.bearing+c.aA(ht.amount,-179,179),V0(lt,ht)}if($.pitch){const ht=Up($.pitch,st,Yv);lt.pitch=this._map.transform.pitch+ht.amount,V0(lt,ht)}if(lt.zoom||lt.bearing){const ht=$.pinchAround===void 0?$.around:$.pinchAround;lt.around=ht?this._map.unproject(ht):this._map.getCenter()}return this.clear(),lt.noMoveStart=!0,lt}}function V0(it,d){(!it.duration||it.duration<d.duration)&&(it.duration=d.duration,it.easing=d.easing)}function Up(it,d,$){const{maxSpeed:st,linearity:lt,deceleration:ht}=$,dt=c.aA(it*lt/(d/1e3),-st,st),mt=Math.abs(dt)/(ht*lt);return{easing:$.easing,duration:1e3*mt,amount:dt*(mt/2)}}class Ou extends c.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(d,$,st,lt={}){const ht=_r($.getCanvasContainer(),st),dt=$.unproject(ht);super(d,Object.assign({point:ht,lngLat:dt,originalEvent:st},lt)),this._defaultPrevented=!1,this.target=$}}class jm extends c.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(d,$,st){const lt=d==="touchend"?st.changedTouches:st.touches,ht=Ur($.getCanvasContainer(),lt),dt=ht.map(Tt=>$.unproject(Tt)),mt=ht.reduce((Tt,Pt,Mt,Ht)=>Tt.add(Pt.div(Ht.length)),new c.P(0,0));super(d,{points:ht,point:mt,lngLats:dt,lngLat:$.unproject(mt),originalEvent:st}),this._defaultPrevented=!1}}class Jv extends c.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(d,$){super("wheel",{originalEvent:$}),this._defaultPrevented=!1}}class fx{constructor(d,$){this._map=d,this._clickTolerance=$.clickTolerance}reset(){this._mousedownPos=void 0}wheel(d){return this._firePreventable(new Jv(this._map,d))}mousedown(d,$){return this._mousedownPos=$,this._firePreventable(new Ou(d.type,this._map,d))}mouseup(d){this._map.fire(new Ou(d.type,this._map,d))}preclick(d){const $=new MouseEvent("preclick",d);this._map.fire(new Ou($.type,this._map,$))}click(d,$){this._mousedownPos&&this._mousedownPos.dist($)>=this._clickTolerance||(this.preclick(d),this._map.fire(new Ou(d.type,this._map,d)))}dblclick(d){return this._firePreventable(new Ou(d.type,this._map,d))}mouseover(d){this._map.fire(new Ou(d.type,this._map,d))}mouseout(d){this._map.fire(new Ou(d.type,this._map,d))}touchstart(d){return this._firePreventable(new jm(d.type,this._map,d))}touchmove(d){this._map.fire(new jm(d.type,this._map,d))}touchend(d){this._map.fire(new jm(d.type,this._map,d))}touchcancel(d){this._map.fire(new jm(d.type,this._map,d))}_firePreventable(d){if(this._map.fire(d),d.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class e1{constructor(d){this._map=d}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(d){this._map.fire(new Ou(d.type,this._map,d))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ou("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(d){this._delayContextMenu?this._contextMenuEvent=d:this._map.fire(new Ou(d.type,this._map,d)),this._map.listens("contextmenu")&&d.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mx{constructor(d,$){this._map=d,this._el=d.getCanvasContainer(),this._container=d.getContainer(),this._clickTolerance=$.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(d,$){this.isEnabled()&&d.shiftKey&&d.button===0&&(Vt(),this._startPos=this._lastPos=$,this._active=!0)}mousemoveWindow(d,$){if(!this._active)return;const st=$,lt=this._startPos,ht=this._lastPos;if(!lt||!ht||ht.equals(st)||!this._box&&st.dist(lt)<this._clickTolerance)return;this._lastPos=st,this._box||(this._box=It("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",d));const dt=Math.min(lt.x,st.x),mt=Math.max(lt.x,st.x),Tt=Math.min(lt.y,st.y),Pt=Math.max(lt.y,st.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${dt}px,${Tt}px)`,this._box.style.width=mt-dt+"px",this._box.style.height=Pt-Tt+"px")})}mouseupWindow(d,$){if(!this._active)return;const st=this._startPos,lt=$;if(st&&d.button===0){if(this.reset(),ur(),st.x!==lt.x||st.y!==lt.y)return this._map.fire(new c.z("boxzoomend",{originalEvent:d})),{cameraAnimation:ht=>ht.fitScreenCoordinates(st,lt,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",d)}}keydown(d){this._active&&d.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",d))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Zt(),delete this._startPos,delete this._lastPos}_fireEvent(d,$){return this._map.fire(new c.z(d,{originalEvent:$}))}}function gx(it,d){const $={};for(let st=0;st<it.length;st++)$[it[st].identifier]=d[st];return $}class Zw{constructor(d){this.reset(),this.numTouches=d.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(d,$,st){(this.centroid||st.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=d.timeStamp),st.length===this.numTouches&&(this.centroid=function(lt){const ht=new c.P(0,0);for(const dt of lt)ht._add(dt);return ht.div(lt.length)}($),this.touches=gx(st,$)))}touchmove(d,$,st){if(this.aborted||!this.centroid)return;const lt=gx(st,$);for(const ht in this.touches){const dt=lt[ht];(!dt||dt.dist(this.touches[ht])>30)&&(this.aborted=!0)}}touchend(d,$,st){if((!this.centroid||d.timeStamp-this.startTime>500)&&(this.aborted=!0),st.length===0){const lt=!this.aborted&&this.centroid;if(this.reset(),lt)return lt}}}class _x{constructor(d){this.singleTap=new Zw(d),this.numTaps=d.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(d,$,st){this.singleTap.touchstart(d,$,st)}touchmove(d,$,st){this.singleTap.touchmove(d,$,st)}touchend(d,$,st){const lt=this.singleTap.touchend(d,$,st);if(lt){const ht=d.timeStamp-this.lastTime<500,dt=!this.lastTap||this.lastTap.dist(lt)<30;if(ht&&dt||this.reset(),this.count++,this.lastTime=d.timeStamp,this.lastTap=lt,this.count===this.numTaps)return this.reset(),lt}}}class Yw{constructor(){this._zoomIn=new _x({numTouches:1,numTaps:2}),this._zoomOut=new _x({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(d,$,st){this._zoomIn.touchstart(d,$,st),this._zoomOut.touchstart(d,$,st)}touchmove(d,$,st){this._zoomIn.touchmove(d,$,st),this._zoomOut.touchmove(d,$,st)}touchend(d,$,st){const lt=this._zoomIn.touchend(d,$,st),ht=this._zoomOut.touchend(d,$,st);return lt?(this._active=!0,d.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:dt=>dt.easeTo({duration:300,zoom:dt.getZoom()+1,around:dt.unproject(lt)},{originalEvent:d})}):ht?(this._active=!0,d.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:dt=>dt.easeTo({duration:300,zoom:dt.getZoom()-1,around:dt.unproject(ht)},{originalEvent:d})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Qw={0:1,2:2},t1={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class yx{constructor(d){this.reset(),this._clickTolerance=d.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(d,$){return!1}_move(d,$){return{}}mousedown(d,$){if(this._lastPoint)return;const st=ln(d);this._correctButton(d,st)&&(this._lastPoint=$,this._eventButton=st)}mousemoveWindow(d,$){const st=this._lastPoint;if(st){if(d.preventDefault(),this._eventButton!=null&&function(lt,ht){const dt=Qw[ht];return lt.buttons===void 0||(lt.buttons&dt)!==dt}(d,this._eventButton))this.reset();else if(this._moved||!($.dist(st)<this._clickTolerance))return this._moved=!0,this._lastPoint=$,this._move(st,$)}}mouseupWindow(d){this._lastPoint&&ln(d)===this._eventButton&&(this._moved&&ur(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jw extends yx{mousedown(d,$){super.mousedown(d,$),this._lastPoint&&(this._active=!0)}_correctButton(d,$){return $===0&&!d.ctrlKey}_move(d,$){return{around:$,panDelta:$.sub(d)}}}class r1 extends yx{constructor(d){super(d),this._pitchRotateKey=d.pitchRotateKey?t1[d.pitchRotateKey]:void 0}_correctButton(d,$){return this._pitchRotateKey?$===0&&d[this._pitchRotateKey]:$===0&&d.ctrlKey||$===2}_move(d,$){const st=.8*($.x-d.x);if(st)return this._active=!0,{bearingDelta:st}}contextmenu(d){this._pitchRotateKey||d.preventDefault()}}class i1 extends yx{constructor(d){super(d),this._pitchRotateKey=d.pitchRotateKey?t1[d.pitchRotateKey]:void 0}_correctButton(d,$){return this._pitchRotateKey?$===0&&d[this._pitchRotateKey]:$===0&&d.ctrlKey||$===2}_move(d,$){const st=-.5*($.y-d.y);if(st)return this._active=!0,{pitchDelta:st}}contextmenu(d){this._pitchRotateKey||d.preventDefault()}}class eE{constructor(d,$){this._map=d,this._el=d.getCanvasContainer(),this._minTouches=1,this._clickTolerance=$.clickTolerance||1,this.reset(),c.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}touchstart(d,$,st){return this._calculateTransform(d,$,st)}touchmove(d,$,st){if(this._active&&!(st.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(st.length===1&&!c.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return d.cancelable&&d.preventDefault(),this._calculateTransform(d,$,st)}}touchend(d,$,st){this._calculateTransform(d,$,st),this._active&&st.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(d,$,st){st.length>0&&(this._active=!0);const lt=gx(st,$),ht=new c.P(0,0),dt=new c.P(0,0);let mt=0;for(const Pt in lt){const Mt=lt[Pt],Ht=this._touches[Pt];Ht&&(ht._add(Mt),dt._add(Mt.sub(Ht)),mt++,lt[Pt]=Mt)}if(this._touches=lt,mt<this._minTouches||!dt.mag())return;const Tt=dt.div(mt);return this._sum._add(Tt),this._sum.mag()<this._clickTolerance?void 0:{around:ht.div(mt),panDelta:Tt}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=It("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class xx{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(d){}_move(d,$,st){return{}}touchstart(d,$,st){this._firstTwoTouches||st.length<2||(this._firstTwoTouches=[st[0].identifier,st[1].identifier],this._start([$[0],$[1]]))}touchmove(d,$,st){const lt=this._firstTwoTouches;if(!lt)return;d.preventDefault();const[ht,dt]=lt,mt=j_(st,$,ht),Tt=j_(st,$,dt);if(!mt||!Tt)return;const Pt=this._aroundCenter?null:mt.add(Tt).div(2);return this._move([mt,Tt],Pt,d)}touchend(d,$,st){if(!this._firstTwoTouches)return;const[lt,ht]=this._firstTwoTouches,dt=j_(st,$,lt),mt=j_(st,$,ht);dt&&mt||(this._active&&ur(),this.reset())}touchcancel(){this.reset()}enable(d){this._enabled=!0,this._aroundCenter=!!d&&d.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function j_(it,d,$){for(let st=0;st<it.length;st++)if(it[st].identifier===$)return d[st]}function tE(it,d){return Math.log2(it/d)}class vT extends xx{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(d){this._startDistance=this._distance=d[0].dist(d[1])}_move(d,$){const st=this._distance;if(this._distance=d[0].dist(d[1]),this._active||!(Math.abs(tE(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:tE(this._distance,st),pinchAround:$}}}function rE(it,d){return 180*it.angleWith(d)/Math.PI}class Go extends xx{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(d){this._startVector=this._vector=d[0].sub(d[1]),this._minDiameter=d[0].dist(d[1])}_move(d,$){const st=this._vector;if(this._vector=d[0].sub(d[1]),st&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:rE(this._vector,st),pinchAround:$}}_isBelowThreshold(d){this._minDiameter=Math.min(this._minDiameter,d.mag());const $=25/(Math.PI*this._minDiameter)*360,st=this._startVector;if(!st)return!1;const lt=rE(d,st);return Math.abs(lt)<$}}function vx(it){return Math.abs(it.y)>Math.abs(it.x)}class bT extends xx{constructor(d){super(),this._map=d}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(d){this._lastPoints=d,vx(d[0].sub(d[1]))&&(this._valid=!1)}_move(d,$,st){const lt=this._lastPoints;if(!lt)return;const ht=d[0].sub(lt[0]),dt=d[1].sub(lt[1]);return this._map._cooperativeGestures&&!c.eU()&&st.touches.length<3||(this._valid=this.gestureBeginsVertically(ht,dt,st.timeStamp),!this._valid)?void 0:(this._lastPoints=d,this._active=!0,{pitchDelta:(ht.y+dt.y)/2*-.5})}gestureBeginsVertically(d,$,st){if(this._valid!==void 0)return this._valid;const lt=d.mag()>=2,ht=$.mag()>=2;if(!lt&&!ht)return;if(!lt||!ht)return this._firstMove==null&&(this._firstMove=st),st-this._firstMove<100&&void 0;const dt=d.y>0==$.y>0;return vx(d)&&vx($)&&dt}}const wT={panStep:100,bearingStep:15,pitchStep:10};class ET{constructor(){const d=wT;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(d){if(d.altKey||d.ctrlKey||d.metaKey)return;let $=0,st=0,lt=0,ht=0,dt=0;switch(d.keyCode){case 61:case 107:case 171:case 187:$=1;break;case 189:case 109:case 173:$=-1;break;case 37:d.shiftKey?st=-1:(d.preventDefault(),ht=-1);break;case 39:d.shiftKey?st=1:(d.preventDefault(),ht=1);break;case 38:d.shiftKey?lt=1:(d.preventDefault(),dt=-1);break;case 40:d.shiftKey?lt=-1:(d.preventDefault(),dt=1);break;default:return}return this._rotationDisabled&&(st=0,lt=0),{cameraAnimation:mt=>{const Tt=mt.getZoom();mt.easeTo({duration:300,easeId:"keyboardHandler",easing:F_,zoom:$?Math.round(Tt)+$*(d.shiftKey?2:1):Tt,bearing:mt.getBearing()+st*this._bearingStep,pitch:mt.getPitch()+lt*this._pitchStep,offset:[-ht*this._panStep,-dt*this._panStep],center:mt.getCenter()},{originalEvent:d})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function F_(it){return it*(2-it)}const n1=4.000244140625,s1=1/450;class bx{constructor(d,$){this._map=d,this._el=d.getCanvasContainer(),this._handler=$,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=s1,c.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(d){this._defaultZoomRate=d}setWheelZoomRate(d){this._wheelZoomRate=d}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(d){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!d&&d.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(d){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(d.ctrlKey||d.metaKey||this.isZooming()||c.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let $=d.deltaMode===WheelEvent.DOM_DELTA_LINE?40*d.deltaY:d.deltaY;const st=c.o.now(),lt=st-(this._lastWheelEventTime||0);this._lastWheelEventTime=st,$!==0&&$%n1==0?this._type="wheel":$!==0&&Math.abs($)<4?this._type="trackpad":lt>400?(this._type=null,this._lastValue=$,this._timeout=window.setTimeout(this._onTimeout,40,d)):this._type||(this._type=Math.abs(lt*$)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,$+=this._lastValue)),d.shiftKey&&$&&($/=4),this._type&&(this._lastWheelEvent=d,this._delta-=$,this._active||this._start(d)),d.preventDefault()}_onTimeout(d){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)}_start(d){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const $=_r(this._el,d);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:$,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const d=this._map.transform;this._type==="wheel"&&d.projection.wrap&&(d._center.lng>=180||d._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const $=()=>d._terrainEnabled()&&this._aroundCoord?d.computeZoomRelativeTo(this._aroundCoord):d.zoom;if(this._delta!==0){const Pt=this._type==="wheel"&&Math.abs(this._delta)>n1?this._wheelZoomRate:this._defaultZoomRate;let Mt=2/(1+Math.exp(-Math.abs(this._delta*Pt)));this._delta<0&&Mt!==0&&(Mt=1/Mt);const Ht=$(),$t=Math.pow(2,Ht),qt=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):$t;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(qt*Mt))),this._type==="wheel"&&(this._startZoom=Ht,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const st=typeof this._targetZoom=="number"?this._targetZoom:$(),lt=this._startZoom,ht=this._easing;let dt,mt=!1;if(this._type==="wheel"&&lt&&ht){const Pt=Math.min((c.o.now()-this._lastWheelEventTime)/200,1),Mt=ht(Pt);dt=c.ak(lt,st,Mt),Pt<1?this._frameId||(this._frameId=!0):mt=!0}else dt=st,mt=!0;this._active=!0,mt&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let Tt=dt-$();return Tt*this._lastDelta<0&&(Tt=0),{noInertia:!0,needsRenderFrame:!mt,zoomDelta:Tt,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(d){let $=c.eV;if(this._prevEase){const st=this._prevEase,lt=(c.o.now()-st.start)/st.duration,ht=st.easing(lt+.01)-st.easing(lt),dt=.27/Math.sqrt(ht*ht+1e-4)*.01,mt=Math.sqrt(.0729-dt*dt);$=c.eT(dt,mt,.25,1)}return this._prevEase={start:c.o.now(),duration:d,easing:$},$}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=It("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class sm{constructor(d,$){this._clickZoom=d,this._tapZoom=$}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class wx{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(d,$){return d.preventDefault(),{cameraAnimation:st=>{st.easeTo({duration:300,zoom:st.getZoom()+(d.shiftKey?-1:1),around:st.unproject($)},{originalEvent:d})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bl{constructor(){this._tap=new _x({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(d,$,st){this._swipePoint||(this._tapTime&&d.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?st.length>0&&(this._swipePoint=$[0],this._swipeTouch=st[0].identifier):this._tap.touchstart(d,$,st))}touchmove(d,$,st){if(this._tapTime){if(this._swipePoint){if(st[0].identifier!==this._swipeTouch)return;const lt=$[0],ht=lt.y-this._swipePoint.y;return this._swipePoint=lt,d.preventDefault(),this._active=!0,{zoomDelta:ht/128}}}else this._tap.touchmove(d,$,st)}touchend(d,$,st){this._tapTime?this._swipePoint&&st.length===0&&this.reset():this._tap.touchend(d,$,st)&&(this._tapTime=d.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $p{constructor(d,$,st){this._el=d,this._mousePan=$,this._touchPan=st}enable(d){this._inertiaOptions=d||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class B_{constructor(d,$,st){this._pitchWithRotate=d.pitchWithRotate,this._mouseRotate=$,this._mousePitch=st}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ex{constructor(d,$,st,lt){this._el=d,this._touchZoom=$,this._touchRotate=st,this._tapDragZoom=lt,this._rotationDisabled=!1,this._enabled=!0}enable(d){this._touchZoom.enable(d),this._rotationDisabled||this._touchRotate.enable(d),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const z_=it=>it.zoom||it.drag||it.pitch||it.rotate;class TT extends c.z{}class V_{constructor(){this.constants=[1,1,.01],this.radius=0}setup(d,$){const st=c.av([],$,d);this.radius=c.ag(st[2]<0?c.eX([],st,this.constants):[st[0],st[1],0])}projectRay(d){c.eX(d,d,this.constants),c.aw(d,d),c.eY(d,d,this.constants);const $=c.c5([],d,this.radius);if($[2]>0){const st=c.c5([],[0,0,1],c.bJ($,[0,0,1])),lt=c.c5([],c.aw([],[$[0],$[1],0]),this.radius),ht=c.d8([],$,c.c5([],c.av([],c.d8([],lt,st),$),2));$[0]=ht[0],$[1]=ht[1]}return $}}function Tx(it){return it.panDelta&&it.panDelta.mag()||it.zoomDelta||it.bearingDelta||it.pitchDelta}class ST{constructor(d,$){this._map=d,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qv(d),this._bearingSnap=$.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new V_,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers($),c.aY(["handleEvent","handleWindowEvent"],this);const st=this._el;this._listeners=[[st,"touchstart",{passive:!0}],[st,"touchmove",{passive:!1}],[st,"touchend",void 0],[st,"touchcancel",void 0],[st,"mousedown",void 0],[st,"mousemove",void 0],[st,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[st,"mouseover",void 0],[st,"mouseout",void 0],[st,"dblclick",void 0],[st,"click",void 0],[st,"keydown",{capture:!1}],[st,"keyup",void 0],[st,"wheel",{passive:!1}],[st,"contextmenu",void 0],[window,"blur",void 0]];for(const[lt,ht,dt]of this._listeners){const mt=lt===document?this.handleWindowEvent:this.handleEvent;lt.addEventListener(ht,mt,dt)}}destroy(){for(const[d,$,st]of this._listeners){const lt=d===document?this.handleWindowEvent:this.handleEvent;d.removeEventListener($,lt,st)}}_addDefaultHandlers(d){const $=this._map,st=$.getCanvasContainer();this._add("mapEvent",new fx($,d));const lt=$.boxZoom=new mx($,d);this._add("boxZoom",lt);const ht=new Yw,dt=new wx;$.doubleClickZoom=new sm(dt,ht),this._add("tapZoom",ht),this._add("clickZoom",dt);const mt=new Bl;this._add("tapDragZoom",mt);const Tt=$.touchPitch=new bT($);this._add("touchPitch",Tt);const Pt=new r1(d),Mt=new i1(d);$.dragRotate=new B_(d,Pt,Mt),this._add("mouseRotate",Pt,["mousePitch"]),this._add("mousePitch",Mt,["mouseRotate"]);const Ht=new Jw(d),$t=new eE($,d);$.dragPan=new $p(st,Ht,$t),this._add("mousePan",Ht),this._add("touchPan",$t,["touchZoom","touchRotate"]);const qt=new Go,Qt=new vT;$.touchZoomRotate=new Ex(st,Qt,qt,mt),this._add("touchRotate",qt,["touchPan","touchZoom"]),this._add("touchZoom",Qt,["touchPan","touchRotate"]),this._add("blockableMapEvent",new e1($));const Xt=$.scrollZoom=new bx($,this);this._add("scrollZoom",Xt,["mousePan"]);const sr=$.keyboard=new ET;this._add("keyboard",sr);for(const ir of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])d.interactive&&d[ir]&&$[ir].enable(d[ir])}_add(d,$,st){this._handlers.push({handlerName:d,handler:$,allowed:st}),this._handlersById[d]=$}stop(d){if(!this._updatingCamera){for(const{handler:$}of this._handlers)$.reset();this._inertia.clear(),this._fireEvents({},{},d),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:d}of this._handlers)if(d.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!z_(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(d,$,st){for(const lt in d)if(lt!==st&&(!$||$.indexOf(lt)<0))return!0;return!1}handleWindowEvent(d){this.handleEvent(d,`${d.type}Window`)}_getMapTouches(d){const $=[];for(const st of d)this._el.contains(st.target)&&$.push(st);return $}handleEvent(d,$){this._updatingCamera=!0;const st=d.type==="renderFrame",lt=st?void 0:d,ht={needsRenderFrame:!1},dt={},mt={},Tt=d.touches?this._getMapTouches(d.touches):void 0,Pt=Tt?Ur(this._el,Tt):st?void 0:_r(this._el,d);for(const{handlerName:$t,handler:qt,allowed:Qt}of this._handlers){if(!qt.isEnabled())continue;let Xt;this._blockedByActive(mt,Qt,$t)?qt.reset():qt[$||d.type]&&(Xt=qt[$||d.type](d,Pt,Tt),this.mergeHandlerResult(ht,dt,Xt,$t,lt),Xt&&Xt.needsRenderFrame&&this._triggerRenderFrame()),(Xt||qt.isActive())&&(mt[$t]=qt)}const Mt={};for(const $t in this._previousActiveHandlers)mt[$t]||(Mt[$t]=lt);this._previousActiveHandlers=mt,(Object.keys(Mt).length||Tx(ht))&&(this._changes.push([ht,dt,Mt]),this._triggerRenderFrame()),(Object.keys(mt).length||Tx(ht))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Ht}=ht;Ht&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ht(this._map))}mergeHandlerResult(d,$,st,lt,ht){if(!st)return;Object.assign(d,st);const dt={handlerName:lt,originalEvent:st.originalEvent||ht};st.zoomDelta!==void 0&&($.zoom=dt),st.panDelta!==void 0&&($.drag=dt),st.pitchDelta!==void 0&&($.pitch=dt),st.bearingDelta!==void 0&&($.rotate=dt)}_applyChanges(){const d={},$={},st={};for(const[lt,ht,dt]of this._changes)lt.panDelta&&(d.panDelta=(d.panDelta||new c.P(0,0))._add(lt.panDelta)),lt.zoomDelta&&(d.zoomDelta=(d.zoomDelta||0)+lt.zoomDelta),lt.bearingDelta&&(d.bearingDelta=(d.bearingDelta||0)+lt.bearingDelta),lt.pitchDelta&&(d.pitchDelta=(d.pitchDelta||0)+lt.pitchDelta),lt.around!==void 0&&(d.around=lt.around),lt.aroundCoord!==void 0&&(d.aroundCoord=lt.aroundCoord),lt.pinchAround!==void 0&&(d.pinchAround=lt.pinchAround),lt.noInertia&&(d.noInertia=lt.noInertia),Object.assign($,ht),Object.assign(st,dt);this._updateMapTransform(d,$,st),this._changes=[]}_updateMapTransform(d,$,st){const lt=this._map,ht=lt.transform,dt=hr=>[hr.x,hr.y,hr.z];if((hr=>{const mr=this._eventsInProgress.drag;return mr&&!this._handlersById[mr.handlerName].isActive()})()&&!Tx(d)){const hr=ht.zoom;ht.cameraElevationReference="sea",this._originalZoom!=null&&ht._orthographicProjectionAtLowPitch&&ht.projection.name!=="globe"&&ht.pitch===0?(ht.cameraElevationReference="ground",ht.zoom=this._originalZoom):(ht.recenterOnTerrain(),ht.cameraElevationReference="ground"),hr!==ht.zoom&&this._map._update(!0)}if(ht._isCameraConstrained&&lt._stop(!0),!Tx(d))return void this._fireEvents($,st,!0);let{panDelta:mt,zoomDelta:Tt,bearingDelta:Pt,pitchDelta:Mt,around:Ht,aroundCoord:$t,pinchAround:qt}=d;ht._isCameraConstrained&&(Tt>0&&(Tt=0),ht._isCameraConstrained=!1),qt!==void 0&&(Ht=qt),(Tt||(hr=>$[hr]&&!this._eventsInProgress[hr])("drag"))&&Ht&&(this._dragOrigin=dt(ht.pointCoordinate3D(Ht)),this._originalZoom=ht.zoom,this._trackingEllipsoid.setup(ht._camera.position,this._dragOrigin)),ht.cameraElevationReference="sea",lt._stop(!0),Ht=Ht||lt.transform.centerPoint,Pt&&(ht.bearing+=Pt),Mt&&(ht.pitch+=Mt),ht._updateCameraState();const Qt=[0,0,0];if(mt)if(ht.projection.name==="mercator"){const hr=this._trackingEllipsoid.projectRay(ht.screenPointToMercatorRay(Ht).dir),mr=this._trackingEllipsoid.projectRay(ht.screenPointToMercatorRay(Ht.sub(mt)).dir);Qt[0]=mr[0]-hr[0],Qt[1]=mr[1]-hr[1]}else{const hr=ht.pointCoordinate(Ht);if(ht.projection.name==="globe"){mt=mt.rotate(-ht.angle);const mr=ht._pixelsPerMercatorPixel/ht.worldSize;Qt[0]=-mt.x*c.eW(c.a$(hr.y))*mr,Qt[1]=-mt.y*c.eW(ht.center.lat)*mr}else{const mr=ht.pointCoordinate(Ht.sub(mt));hr&&mr&&(Qt[0]=mr.x-hr.x,Qt[1]=mr.y-hr.y)}}const Xt=ht.zoom,sr=[0,0,0];if(Tt){const hr=dt($t||ht.pointCoordinate3D(Ht)),mr={dir:c.aw([],c.av([],hr,ht._camera.position))};if(mr.dir[2]<0){const dr=ht.zoomDeltaToMovement(hr,Tt);c.c5(sr,mr.dir,dr)}}const ir=c.d8(Qt,Qt,sr);ht._translateCameraConstrained(ir),Tt&&Math.abs(ht.zoom-Xt)>1e-4&&ht.recenterOnTerrain(),ht.cameraElevationReference="ground",this._map._update(),d.noInertia||this._inertia.record(d),this._fireEvents($,st,!0)}_fireEvents(d,$,st){const lt=z_(this._eventsInProgress),ht=z_(d),dt={};for(const Mt in d){const{originalEvent:Ht}=d[Mt];this._eventsInProgress[Mt]||(dt[`${Mt}start`]=Ht),this._eventsInProgress[Mt]=d[Mt]}!lt&&ht&&this._fireEvent("movestart",ht.originalEvent);for(const Mt in dt)this._fireEvent(Mt,dt[Mt]);ht&&this._fireEvent("move",ht.originalEvent);for(const Mt in d){const{originalEvent:Ht}=d[Mt];this._fireEvent(Mt,Ht)}const mt={};let Tt;for(const Mt in this._eventsInProgress){const{handlerName:Ht,originalEvent:$t}=this._eventsInProgress[Mt];this._handlersById[Ht].isActive()||(delete this._eventsInProgress[Mt],Tt=$[Ht]||$t,mt[`${Mt}end`]=Tt)}for(const Mt in mt)this._fireEvent(Mt,mt[Mt]);const Pt=z_(this._eventsInProgress);if(st&&(lt||ht)&&!Pt){this._updatingCamera=!0;const Mt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Ht=$t=>$t!==0&&-this._bearingSnap<$t&&$t<this._bearingSnap;Mt?(Ht(Mt.bearing||this._map.getBearing())&&(Mt.bearing=0),this._map.easeTo(Mt,{originalEvent:Tt})):(this._map.fire(new c.z("moveend",{originalEvent:Tt})),Ht(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(d,$){this._map.fire(new c.z(d,$?{originalEvent:$}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(d=>{this._frameId=void 0,this.handleEvent(new TT("renderFrame",{timeStamp:d})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Sx="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class o1 extends c.E{constructor(d,$){super(),this._moving=!1,this._zooming=!1,this.transform=d,this._bearingSnap=$.bearingSnap,this._respectPrefersReducedMotion=$.respectPrefersReducedMotion!==!1,c.aY(["_renderFrameCallback"],this)}getCenter(){return new c.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(d,$){return this.jumpTo({center:d},$)}panBy(d,$,st){return d=c.P.convert(d).mult(-1),this.panTo(this.transform.center,Object.assign({offset:d},$),st)}panTo(d,$,st){return this.easeTo(Object.assign({center:d},$),st)}getZoom(){return this.transform.zoom}setZoom(d,$){return this.jumpTo({zoom:d},$),this}zoomTo(d,$,st){return this.easeTo(Object.assign({zoom:d},$),st)}zoomIn(d,$){return this.zoomTo(this.getZoom()+1,d,$),this}zoomOut(d,$){return this.zoomTo(this.getZoom()-1,d,$),this}getBearing(){return this.transform.bearing}setBearing(d,$){return this.jumpTo({bearing:d},$),this}getPadding(){return this.transform.padding}setPadding(d,$){return this.jumpTo({padding:d},$),this}rotateTo(d,$,st){return this.easeTo(Object.assign({bearing:d},$),st)}resetNorth(d,$){return this.rotateTo(0,Object.assign({duration:1e3},d),$),this}resetNorthPitch(d,$){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},d),$),this}snapToNorth(d,$){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(d,$):this}getPitch(){return this.transform.pitch}setPitch(d,$){return this.jumpTo({pitch:d},$),this}cameraForBounds(d,$){d=c.aI.convert(d);const st=$&&$.bearing||0,lt=$&&$.pitch||0,ht=d.getNorthWest(),dt=d.getSouthEast();return this._cameraForBounds(this.transform,ht,dt,st,lt,$)}_extendPadding(d){const $={top:0,right:0,bottom:0,left:0};return d==null?Object.assign({},$,this.transform.padding):typeof d=="number"?{top:d,bottom:d,right:d,left:d}:Object.assign({},$,d)}_extendCameraOptions(d){return(d=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=this._extendPadding(d.padding),d}_minimumAABBFrustumDistance(d,$){const st=$.max[0]-$.min[0],lt=$.max[1]-$.min[1];return st/lt>d.aspect?st/(2*Math.tan(.5*d.fovX)*d.aspect):lt/(2*Math.tan(.5*d.fovY)*d.aspect)}_cameraForBoundsOnGlobe(d,$,st,lt,ht,dt){const mt=d.clone(),Tt=this._extendCameraOptions(dt);mt.bearing=lt,mt.pitch=ht;const Pt=c.aT.convert($),Mt=c.aT.convert(st),Ht=.5*(Pt.lat+Mt.lat),$t=.5*(Pt.lng+Mt.lng),qt=c.eZ(Ht,$t),Qt=c.aw([],qt),Xt=c.aw([],c.bI([],Qt,[0,1,0])),sr=c.bI([],Xt,Qt),ir=[Xt[0],Xt[1],Xt[2],0,sr[0],sr[1],sr[2],0,Qt[0],Qt[1],Qt[2],0,0,0,0,1],hr=[qt,c.eZ(Pt.lat,Pt.lng),c.eZ(Mt.lat,Pt.lng),c.eZ(Mt.lat,Mt.lng),c.eZ(Pt.lat,Mt.lng),c.eZ(Ht,Pt.lng),c.eZ(Ht,Mt.lng),c.eZ(Pt.lat,$t),c.eZ(Mt.lat,$t)];let mr=c.d9.fromPoints(hr.map(Kr=>[c.bJ(Xt,Kr),c.bJ(sr,Kr),c.bJ(Qt,Kr)]));const dr=c.af([],mr.center,ir);c.e_(dr)===0&&c.e$(dr,0,0,1),c.aw(dr,dr),c.c5(dr,dr,c.aD),mt.center=c.f0(dr);const Ir=mt.getWorldToCameraMatrix(),Tr=c.bl(new Float64Array(16),Ir);mr=c.d9.applyTransform(mr,c.aB([],Ir,ir));const Ar=this._extendAABB(mr,mt,Tt,lt);if(!Ar)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");mr=Ar,c.af(dr,dr,Ir);const Er=.5*(mr.max[2]-mr.min[2]),vr=this._minimumAABBFrustumDistance(mt,mr),Pr=c.c5([],[0,0,1],Er),Br=c.d8(Pr,dr,Pr),Or=vr+(mt.pitch===0?0:c.bG(dr,Br)),Yr=mt.globeCenterInViewSpace,Qr=c.av([],dr,[Yr[0],Yr[1],Yr[2]]);c.aw(Qr,Qr),c.c5(Qr,Qr,Or);const un=c.d8([],dr,Qr);c.af(un,un,Tr);const Cn=c.eM/c.aD,qr=c.ag(un),Nr=c.cf(Math.max(qr*Cn-c.eM,Number.EPSILON),0),tn=Math.min(mt.zoomFromMercatorZAdjusted(Nr),Tt.maxZoom);return tn>.5*(c.c_+c.cL)?(mt.setProjection({name:"mercator"}),mt.zoom=tn,this._cameraForBounds(mt,$,st,lt,ht,dt)):{center:mt.center,zoom:tn,bearing:lt,pitch:ht}}_extendAABB(d,$,st,lt){const ht=.5*((st.padding.left||0)+(st.padding.right||0)),dt=.5*((st.padding.top||0)+(st.padding.bottom||0)),mt=dt,Tt=ht,Pt=ht,Mt=dt,Ht=$.width-(Tt+Pt),$t=$.height-(mt+Mt),qt=c.av([],d.max,d.min),Qt=Math.min(Ht/qt[0],$t/qt[1]),Xt=Math.min($.scaleZoom($.scale*Qt),st.maxZoom);if(isNaN(Xt))return null;const sr=$.scale/$.zoomScale(Xt),ir=new c.d9([d.min[0]-Tt*sr,d.min[1]-Mt*sr,d.min[2]],[d.max[0]+Pt*sr,d.max[1]+mt*sr,d.max[2]]),hr=(typeof st.offset.x=="number"&&typeof st.offset.y=="number"?new c.P(st.offset.x,st.offset.y):c.P.convert(st.offset)).rotate(-c.an(lt));return ir.center[0]-=hr.x*sr,ir.center[1]+=hr.y*sr,ir}queryTerrainElevation(d,$){const st=this.transform.elevation;return st?($=Object.assign({},{exaggerated:!0},$),st.getAtPoint(c.ae.fromLngLat(d),null,$.exaggerated)):null}_cameraForBounds(d,$,st,lt,ht,dt){if(d.projection.name==="globe")return this._cameraForBoundsOnGlobe(d,$,st,lt,ht,dt);const mt=d.clone(),Tt=this._extendCameraOptions(dt);mt.bearing=lt,mt.pitch=ht;const Pt=c.aT.convert($),Mt=c.aT.convert(st),Ht=new c.aT(Pt.lng,Mt.lat),$t=new c.aT(Mt.lng,Pt.lat),qt=mt.project(Pt),Qt=mt.project(Mt),Xt=this.queryTerrainElevation(Pt),sr=this.queryTerrainElevation(Mt),ir=this.queryTerrainElevation(Ht),hr=this.queryTerrainElevation($t),mr=[[qt.x,qt.y,Math.min(Xt||0,sr||0,ir||0,hr||0)],[Qt.x,Qt.y,Math.max(Xt||0,sr||0,ir||0,hr||0)]];let dr=c.d9.fromPoints(mr);const Ir=mt.getWorldToCameraMatrix(),Tr=c.bl(new Float64Array(16),Ir);dr=c.d9.applyTransform(dr,Ir);const Ar=this._extendAABB(dr,mt,Tt,lt);if(!Ar)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");dr=Ar;const Er=.5*c.av([],dr.max,dr.min)[2],vr=this._minimumAABBFrustumDistance(mt,dr),Pr=[0,0,1,0];c.aC(Pr,Pr,Ir),c.f1(Pr,Pr);const Br=c.c5([],Pr,vr+Er),Or=c.d8([],dr.center,Br);c.af(dr.center,dr.center,Tr),c.af(Or,Or,Tr);const Yr=mt.unproject(new c.P(dr.center[0],dr.center[1])),Qr=c.f2(mt.projection,Yr),un=Math.pow(2,Qr),Cn=Math.min(mt._zoomFromMercatorZ(Or[2]*mt.pixelsPerMeter*un/mt.worldSize),Tt.maxZoom);return mt.mercatorFromTransition&&Cn<.5*(c.c_+c.cL)?(mt.setProjection({name:"globe"}),mt.zoom=Cn,this._cameraForBounds(mt,$,st,lt,ht,dt)):{center:Yr,zoom:Cn,bearing:lt,pitch:ht}}fitBounds(d,$,st){const lt=this.cameraForBounds(d,$);return this._fitInternal(lt,$,st)}fitScreenCoordinates(d,$,st,lt,ht){const dt=c.P.convert(d),mt=c.P.convert($),Tt=new c.P(Math.min(dt.x,mt.x),Math.min(dt.y,mt.y)),Pt=new c.P(Math.max(dt.x,mt.x),Math.max(dt.y,mt.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(dt,mt))return this;const Mt=this.transform.pointLocation3D(Tt),Ht=this.transform.pointLocation3D(Pt),$t=this.transform.pointLocation3D(new c.P(Tt.x,Pt.y)),qt=this.transform.pointLocation3D(new c.P(Pt.x,Tt.y)),Qt=[Math.min(Mt.lng,Ht.lng,$t.lng,qt.lng),Math.min(Mt.lat,Ht.lat,$t.lat,qt.lat)],Xt=[Math.max(Mt.lng,Ht.lng,$t.lng,qt.lng),Math.max(Mt.lat,Ht.lat,$t.lat,qt.lat)],sr=lt&&lt.pitch?lt.pitch:this.getPitch(),ir=this._cameraForBounds(this.transform,Qt,Xt,st,sr,lt);return this._fitInternal(ir,lt,ht)}_fitInternal(d,$,st){return d?($=Object.assign(d,$)).linear?this.easeTo($,st):this.flyTo($,st):this}jumpTo(d,$){this.stop();const st=d.preloadOnly?this.transform.clone():this.transform;let lt=!1,ht=!1,dt=!1;"zoom"in d&&st.zoom!==+d.zoom&&(lt=!0,st.zoom=+d.zoom),d.center!==void 0&&(st.center=c.aT.convert(d.center)),"bearing"in d&&st.bearing!==+d.bearing&&(ht=!0,st.bearing=+d.bearing),"pitch"in d&&st.pitch!==+d.pitch&&(dt=!0,st.pitch=+d.pitch);const mt=typeof d.padding=="number"?this._extendPadding(d.padding):d.padding;if(d.padding!=null&&!st.isPaddingEqual(mt))if(d.retainPadding===!1){const Tt=st.clone();Tt.padding=mt,st.setLocationAtPoint(st.center,Tt.centerPoint)}else st.padding=mt;return d.preloadOnly?(this._preloadTiles(st),this):(this.fire(new c.z("movestart",$)).fire(new c.z("move",$)),lt&&this.fire(new c.z("zoomstart",$)).fire(new c.z("zoom",$)).fire(new c.z("zoomend",$)),ht&&this.fire(new c.z("rotatestart",$)).fire(new c.z("rotate",$)).fire(new c.z("rotateend",$)),dt&&this.fire(new c.z("pitchstart",$)).fire(new c.z("pitch",$)).fire(new c.z("pitchend",$)),this.fire(new c.z("moveend",$)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||c.w(Sx),this.transform.getFreeCameraOptions()}setFreeCameraOptions(d,$){const st=this.transform;if(!st.projection.supportsFreeCamera)return c.w(Sx),this;this.stop();const lt=st.zoom,ht=st.pitch,dt=st.bearing;st.setFreeCameraOptions(d);const mt=lt!==st.zoom,Tt=ht!==st.pitch,Pt=dt!==st.bearing;return this.fire(new c.z("movestart",$)).fire(new c.z("move",$)),mt&&this.fire(new c.z("zoomstart",$)).fire(new c.z("zoom",$)).fire(new c.z("zoomend",$)),Pt&&this.fire(new c.z("rotatestart",$)).fire(new c.z("rotate",$)).fire(new c.z("rotateend",$)),Tt&&this.fire(new c.z("pitchstart",$)).fire(new c.z("pitch",$)).fire(new c.z("pitchend",$)),this.fire(new c.z("moveend",$)),this}easeTo(d,$){this._stop(!1,d.easeId),((d=Object.assign({offset:[0,0],duration:500,easing:c.eV},d)).animate===!1||this._prefersReducedMotion(d))&&(d.duration=0);const st=this.transform,lt=this.getZoom(),ht=this.getBearing(),dt=this.getPitch(),mt=this.getPadding(),Tt="zoom"in d?+d.zoom:lt,Pt="bearing"in d?this._normalizeBearing(d.bearing,ht):ht,Mt="pitch"in d?+d.pitch:dt,Ht=this._extendPadding(d.padding),$t=c.P.convert(d.offset);let qt,Qt,Xt;if(st.projection.name==="globe"){const Pr=c.ae.fromLngLat(st.center),Br=$t.rotate(-st.angle);Pr.x+=Br.x/st.worldSize,Pr.y+=Br.y/st.worldSize;const Or=Pr.toLngLat(),Yr=c.aT.convert(d.center||Or);this._normalizeCenter(Yr),qt=st.centerPoint.add(Br),Qt=new c.P(Pr.x,Pr.y).mult(st.worldSize),Xt=new c.P(c.aF(Yr.lng),c.aJ(Yr.lat)).mult(st.worldSize).sub(Qt)}else{qt=st.centerPoint.add($t);const Pr=st.pointLocation(qt),Br=c.aT.convert(d.center||Pr);this._normalizeCenter(Br),Qt=st.project(Pr),Xt=st.project(Br).sub(Qt)}const sr=st.zoomScale(Tt-lt);let ir,hr;d.around&&(ir=c.aT.convert(d.around),hr=st.locationPoint(ir));const mr=this._zooming||Tt!==lt,dr=this._rotating||ht!==Pt,Ir=this._pitching||Mt!==dt,Tr=!st.isPaddingEqual(Ht),Ar=d.retainPadding===!1?st.clone():st,Er=Pr=>Br=>{if(mr&&(Pr.zoom=c.ak(lt,Tt,Br)),dr&&(Pr.bearing=c.ak(ht,Pt,Br)),Ir&&(Pr.pitch=c.ak(dt,Mt,Br)),Tr&&(Ar.interpolatePadding(mt,Ht,Br),qt=Ar.centerPoint.add($t)),ir)Pr.setLocationAtPoint(ir,hr);else{const Or=Pr.zoomScale(Pr.zoom-lt),Yr=Tt>lt?Math.min(2,sr):Math.max(.5,sr),Qr=Math.pow(Yr,1-Br),un=Pr.unproject(Qt.add(Xt.mult(Br*Qr)).mult(Or));Pr.setLocationAtPoint(Pr.renderWorldCopies?un.wrap():un,qt)}return d.preloadOnly||this._fireMoveEvents($),Pr};if(d.preloadOnly){const Pr=this._emulate(Er,d.duration,st);return this._preloadTiles(Pr),this}const vr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=mr,this._rotating=dr,this._pitching=Ir,this._padding=Tr,this._easeId=d.easeId,this._prepareEase($,d.noMoveStart,vr),this._ease(Er(st),Pr=>{st.cameraElevationReference==="sea"&&st.recenterOnTerrain(),this._afterEase($,Pr)},d),this}_prepareEase(d,$,st={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),$||st.moving||this.fire(new c.z("movestart",d)),this._zooming&&!st.zooming&&this.fire(new c.z("zoomstart",d)),this._rotating&&!st.rotating&&this.fire(new c.z("rotatestart",d)),this._pitching&&!st.pitching&&this.fire(new c.z("pitchstart",d))}_fireMoveEvents(d){this.fire(new c.z("move",d)),this._zooming&&this.fire(new c.z("zoom",d)),this._rotating&&this.fire(new c.z("rotate",d)),this._pitching&&this.fire(new c.z("pitch",d))}_afterEase(d,$){if(this._easeId&&$&&this._easeId===$)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const st=this._zooming,lt=this._rotating,ht=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,st&&this.fire(new c.z("zoomend",d)),lt&&this.fire(new c.z("rotateend",d)),ht&&this.fire(new c.z("pitchend",d)),this.fire(new c.z("moveend",d))}flyTo(d,$){if(this._prefersReducedMotion(d)){const Kr=c.aH(d,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Kr,$)}this.stop(),d=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:c.eV},d);const st=this.transform,lt=this.getZoom(),ht=this.getBearing(),dt=this.getPitch(),mt=this.getPadding(),Tt="zoom"in d?c.aA(+d.zoom,st.minZoom,st.maxZoom):lt,Pt="bearing"in d?this._normalizeBearing(d.bearing,ht):ht,Mt="pitch"in d?+d.pitch:dt,Ht=this._extendPadding(d.padding),$t=st.zoomScale(Tt-lt),qt=c.P.convert(d.offset);let Qt=st.centerPoint.add(qt);const Xt=st.pointLocation(Qt),sr=c.aT.convert(d.center||Xt);this._normalizeCenter(sr);const ir=st.project(Xt),hr=st.project(sr).sub(ir);let mr=d.curve;const dr=Math.max(st.width,st.height),Ir=dr/$t,Tr=hr.mag();if("minZoom"in d){const Kr=c.aA(Math.min(d.minZoom,lt,Tt),st.minZoom,st.maxZoom),yn=dr/st.zoomScale(Kr-lt);mr=Math.sqrt(yn/Tr*2)}const Ar=mr*mr;function Er(Kr){const yn=(Ir*Ir-dr*dr+(Kr?-1:1)*Ar*Ar*Tr*Tr)/(2*(Kr?Ir:dr)*Ar*Tr);return Math.log(Math.sqrt(yn*yn+1)-yn)}function vr(Kr){return(Math.exp(Kr)-Math.exp(-Kr))/2}function Pr(Kr){return(Math.exp(Kr)+Math.exp(-Kr))/2}const Br=Er(0);let Or=function(Kr){return Pr(Br)/Pr(Br+mr*Kr)},Yr=function(Kr){return dr*((Pr(Br)*(vr(yn=Br+mr*Kr)/Pr(yn))-vr(Br))/Ar)/Tr;var yn},Qr=(Er(1)-Br)/mr;if(Math.abs(Tr)<1e-6||!isFinite(Qr)){if(Math.abs(dr-Ir)<1e-6)return this.easeTo(d,$);const Kr=Ir<dr?-1:1;Qr=Math.abs(Math.log(Ir/dr))/mr,Yr=function(){return 0},Or=function(yn){return Math.exp(Kr*mr*yn)}}d.duration="duration"in d?+d.duration:1e3*Qr/("screenSpeed"in d?+d.screenSpeed/mr:+d.speed),d.maxDuration&&d.duration>d.maxDuration&&(d.duration=0);const un=ht!==Pt,Cn=Mt!==dt,qr=!st.isPaddingEqual(Ht),Nr=d.retainPadding===!1?st.clone():st,tn=Kr=>yn=>{const Ln=yn*Qr,Un=1/Or(Ln);Kr.zoom=yn===1?Tt:lt+Kr.scaleZoom(Un),un&&(Kr.bearing=c.ak(ht,Pt,yn)),Cn&&(Kr.pitch=c.ak(dt,Mt,yn)),qr&&(Nr.interpolatePadding(mt,Ht,yn),Qt=Nr.centerPoint.add(qt));const kn=yn===1?sr:Kr.unproject(ir.add(hr.mult(Yr(Ln))).mult(Un));return Kr.setLocationAtPoint(Kr.renderWorldCopies?kn.wrap():kn,Qt),Kr._updateCameraOnTerrain(),d.preloadOnly||this._fireMoveEvents($),Kr};if(d.preloadOnly){const Kr=this._emulate(tn,d.duration,st);return this._preloadTiles(Kr),this}return this._zooming=!0,this._rotating=un,this._pitching=Cn,this._padding=qr,this._prepareEase($,!1),this._ease(tn(st),()=>this._afterEase($),d),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(d){}_cancelRenderFrame(d){}_stop(d,$){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const st=this._onEaseEnd;this._onEaseEnd=void 0,st.call(this,$)}if(!d){const st=this.handlers;st&&st.stop(!1)}return this}_ease(d,$,st){st.animate===!1||st.duration===0?(d(1),$()):(this._easeStart=c.o.now(),this._easeOptions=st,this._onEaseFrame=d,this._onEaseEnd=$,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const d=Math.min((c.o.now()-this._easeStart)/this._easeOptions.duration,1),$=this._onEaseFrame;$&&$(this._easeOptions.easing(d)),d<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(d,$){d=c.bT(d,-180,180);const st=Math.abs(d-$);return Math.abs(d-360-$)<st&&(d-=360),Math.abs(d+360-$)<st&&(d+=360),d}_normalizeCenter(d){const $=this.transform;if($.maxBounds||$.projection.name!=="globe"&&!$.renderWorldCopies)return;const st=d.lng-$.center.lng;d.lng+=st>180?-360:st<-180?360:0}_prefersReducedMotion(d){return this._respectPrefersReducedMotion&&c.o.prefersReducedMotion&&!(d&&d.essential)}_emulate(d,$,st){const lt=Math.ceil(15*$/1e3),ht=[],dt=d(st.clone());for(let mt=0;mt<=lt;mt++){const Tt=dt(mt/lt);ht.push(Tt.clone())}return ht}_preloadTiles(d,$){}}class U_{constructor(d={}){this.options=d,c.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(d){const $=this.options&&this.options.compact,st=d._getUIString("AttributionControl.ToggleAttribution");this._map=d,this._container=It("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=It("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",st);const lt=It("span","mapboxgl-ctrl-icon",this._compactButton);return lt.setAttribute("aria-hidden","true"),lt.setAttribute("title",st),this._innerContainer=It("div","mapboxgl-ctrl-attrib-inner",this._container),$&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),$===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let d=this._editLink;d||(d=this._editLink=this._container.querySelector(".mapbox-improve-map"));const $=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||c.e.ACCESS_TOKEN}];if(d){const st=$.reduce((lt,ht,dt)=>(ht.value&&(lt+=`${ht.key}=${ht.value}${dt<$.length-1?"&":""}`),lt),"?");d.href=`${c.e.FEEDBACK_URL}/${st}#${Fl(this._map,!0)}`,d.rel="noopener nofollow"}}_updateData(d){!d||(d.dataType!=="source"||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility")&&d.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let d=[];if(this._map.style.stylesheet){const lt=this._map.style.stylesheet;this.styleOwner=lt.owner,this.styleId=lt.id}const $=this._map.style._mergedSourceCaches;for(const lt in $){const ht=$[lt];if(ht.used){const dt=ht.getSource();dt.attribution&&d.indexOf(dt.attribution)<0&&d.push(dt.attribution)}}d.sort((lt,ht)=>lt.length-ht.length),d=d.filter((lt,ht)=>{for(let dt=ht+1;dt<d.length;dt++)if(d[dt].indexOf(lt)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?d=[...this.options.customAttribution,...d]:d.unshift(this.options.customAttribution));const st=d.map(lt=>function(ht){const dt=new DOMParser().parseFromString(ht,"text/html");return Array.from(dt.body.querySelectorAll("*")).forEach(mt=>{const Tt=mt.textContent||"";if(mt.tagName!=="A")return void mt.replaceWith(dt.createTextNode(Tt));const Pt=mt.getAttribute("href");if(!Pt||!/^(https?:|mailto:)/i.test(Pt))return void mt.replaceWith(dt.createTextNode(Tt));const Mt=dt.createElement("a");Mt.href=Pt,Mt.textContent=Tt,Mt.rel="noopener nofollow";const Ht=mt.getAttribute("class");Ht&&(Mt.className=Ht),mt.replaceWith(Mt)}),dt.body.innerHTML}(lt)).join(" | ");st!==this._attribHTML&&(this._attribHTML=st,d.length?(this._innerContainer.innerHTML=st,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class $_{constructor(){c.aY(["_updateLogo","_updateCompact"],this)}onAdd(d){this._map=d,this._container=It("div","mapboxgl-ctrl");const $=It("a","mapboxgl-ctrl-logo");return $.target="_blank",$.rel="noopener nofollow",$.href="https://www.mapbox.com/",$.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),$.setAttribute("rel","noopener nofollow"),this._container.appendChild($),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(d){d&&d.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const d=this._map.style._sourceCaches;if(Object.entries(d).length===0)return!0;for(const $ in d){const st=d[$].getSource();if(st.hasOwnProperty("mapbox_logo")&&!st.mapbox_logo)return!1}return!0}_updateCompact(){const d=this._container.children;if(d.length){const $=d[0];this._map.getCanvasContainer().offsetWidth<250?$.classList.add("mapboxgl-compact"):$.classList.remove("mapboxgl-compact")}}}class U0{constructor(){c.aY(["_onIndoorUpdate"],this)}onAdd(d){return this._map=d,this._container=It("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",$=>this._onIndoorUpdate($)),this._container}_createButton(d,$){const st=It("button",d,this._container);return st.type="button",st.addEventListener("click",$),st}_createSeparator(){return It("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(d,$){this._map&&(d.setAttribute("aria-label",$),d.textContent=$)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(d){if(!d||!d.floors)return this._model=d,void(this._container.style.display="none");const $=this._model;this._model=d,this._container.style.display="inline-block",this._container.style.borderRadius="8px",$&&Array.from(this._container.children).forEach(st=>st.remove()),d.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(d.floors,d.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const d=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const $=this._map;this._model&&$&&$._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});It("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&d.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(d),this._createSeparator()}_updateBuildingsButtonState(){const d=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");d&&this._model&&(this._model.activeFloorsVisible?d.classList.remove("mapboxgl-ctrl-level-button-selected"):d.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(d,$){for(let st=0;st<d.length;st++){const lt=d[st],ht=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(lt.id)});this._setButtonTitle(ht,lt.zIndex.toString()),this._model&&lt.id===this._model.selectedFloorId&&$&&ht.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(ht),st<d.length-1&&this._createSeparator()}}}class om{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(d){const $=++this._id;return this._queue.push({callback:d,id:$,cancelled:!1}),$}remove(d){const $=this._currentlyRunning,st=$?this._queue.concat($):this._queue;for(const lt of st)if(lt.id===d)return void(lt.cancelled=!0)}run(d=0){const $=this._currentlyRunning=this._queue;this._queue=[];for(const st of $)if(!st.cancelled&&(st.callback(d),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class am{constructor(d){this.jumpTo(d)}getValue(d){if(d<=this._startTime)return this._start;if(d>=this._endTime)return this._end;const $=c.dD((d-this._startTime)/(this._endTime-this._startTime));return this._start*(1-$)+this._end*$}isEasing(d){return d>=this._startTime&&d<=this._endTime}jumpTo(d){this._startTime=-1/0,this._endTime=-1/0,this._start=d,this._end=d}easeTo(d,$,st){this._start=this.getValue($),this._end=d,this._startTime=$,this._endTime=$+st}}const lm={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Fm extends c.z{constructor(d,$,st,lt){const{point:ht,lngLat:dt,originalEvent:mt,target:Tt}=d;super(d.type,{point:ht,lngLat:dt,originalEvent:mt,target:Tt}),this.preventDefault=()=>{d.preventDefault()},this.id=$,this.interaction=st,this.feature=lt}}class Tp{constructor(d){this.map=d,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(d,$){if(this.typeById.has(d))throw new Error(`Interaction id "${d}" already exists.`);const st=$.filter;let lt=$.type;st&&this.filters.set(d,c.b6(st)),lt==="mouseover"&&(lt="mouseenter"),lt==="mouseout"&&(lt="mouseleave");const ht=this.interactionsByType.get(lt)||new Map;lt==="mouseenter"||lt==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(d,$)):ht.size===0&&this.map.on(lt,this.handleType),ht.size===0&&this.interactionsByType.set(lt,ht),ht.set(d,$),this.typeById.set(d,lt)}get(d){const $=this.typeById.get(d);if(!$)return;const st=this.interactionsByType.get($);return st?st.get(d):void 0}remove(d){const $=this.typeById.get(d);if(!$)return;this.typeById.delete(d),this.filters.delete(d);const st=this.interactionsByType.get($);st&&(st.delete(d),$==="mouseenter"||$==="mouseleave"?(this.delegatedInteractions.delete(d),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):st.size===0&&this.map.off($,this.handleType))}queryTargets(d,$){const st=[];for(const[lt,ht]of $)ht.target&&st.push({targetId:lt,target:ht.target,filter:this.filters.get(lt)});return this.map.style.queryRenderedTargets(d,st,this.map.transform)}handleMove(d){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const $=this.queryTargets(d.point,Array.from(this.delegatedInteractions).reverse());$.length&&(d.type="mouseenter",this.handleType(d,$));const st=new Map;for(const[lt,{feature:ht}]of this.prevHoveredFeatures)this.hoveredFeatures.has(lt)||st.set(ht.id,ht);st.size&&(d.type="mouseleave",this.handleType(d,Array.from(st.values())))}handleOut(d){const $=Array.from(this.hoveredFeatures.values()).map(({feature:st})=>st);$.length&&(d.type="mouseleave",this.handleType(d,$)),this.hoveredFeatures.clear()}handleType(d,$){const st=d.type==="mouseenter";if(st&&!this.interactionsByType.has(d.type))return void c.w("mouseenter interaction required for mouseleave to work.");const lt=Array.from(this.interactionsByType.get(d.type)).reverse(),ht=!!$;$=$||this.queryTargets(d.point,lt);let dt=!1;const mt=new Set;for(const Tt of $){for(const[Pt,Mt]of lt){if(!Mt.target)continue;const Ht=Tt.variants?Tt.variants[Pt]:null;if(Ht){for(const $t of Ht){if(v0($t,Tt,mt,Pt))continue;const qt=new c.dx(Tt,$t),Qt=Xm($t,Tt,Pt);ht&&qt.id!==void 0&&(qt.state=this.map.getFeatureState(qt));const Xt=st?this.prevHoveredFeatures.get(Qt):null,sr=new Fm(d,Pt,Mt,qt),ir=Xt?Xt.stop:Mt.handler(sr);if(st&&this.hoveredFeatures.set(Qt,{feature:Tt,stop:ir}),ir!==!1){dt=!0;break}}if(dt)break}}if(dt)break}if(!dt)for(const[Tt,Pt]of lt){const{handler:Mt,target:Ht}=Pt;if(!Ht&&Mt(new Fm(d,Tt,Pt,null))!==!1)break}}}function CT(it,d){if(Array.isArray(it)&&Array.isArray(d)){const $=new Set(it),st=new Set(d);return $.size===st.size&&it.every(lt=>st.has(lt))}return c.by(it,d)}const AT={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},RT={showCompass:!0,showZoom:!0,visualizePitch:!1};class IT{constructor(d,$,st=!1){this._clickTolerance=10,this.element=$,this.mouseRotate=new r1({clickTolerance:d.dragRotate._mouseRotate._clickTolerance}),this.map=d,st&&(this.mousePitch=new i1({clickTolerance:d.dragRotate._mousePitch._clickTolerance})),c.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),$.addEventListener("mousedown",this.mousedown),$.addEventListener("touchstart",this.touchstart,{passive:!1}),$.addEventListener("touchmove",this.touchmove),$.addEventListener("touchend",this.touchend),$.addEventListener("touchcancel",this.reset)}down(d,$){this.mouseRotate.mousedown(d,$),this.mousePitch&&this.mousePitch.mousedown(d,$),Vt()}move(d,$){const st=this.map,lt=this.mouseRotate.mousemoveWindow(d,$),ht=lt&&lt.bearingDelta;if(ht&&st.setBearing(st.getBearing()+ht),this.mousePitch){const dt=this.mousePitch.mousemoveWindow(d,$),mt=dt&&dt.pitchDelta;mt&&st.setPitch(st.getPitch()+mt)}}off(){const d=this.element;d.removeEventListener("mousedown",this.mousedown),d.removeEventListener("touchstart",this.touchstart),d.removeEventListener("touchmove",this.touchmove),d.removeEventListener("touchend",this.touchend),d.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Zt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(d){this.down(Object.assign({},d,{ctrlKey:!0,preventDefault:()=>d.preventDefault()}),_r(this.element,d)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(d){this.move(d,_r(this.element,d))}mouseup(d){this.mouseRotate.mouseupWindow(d),this.mousePitch&&this.mousePitch.mouseupWindow(d),this.offTemp()}touchstart(d){d.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ur(this.element,d.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>d.preventDefault()},this._startPos))}touchmove(d){d.targetTouches.length!==1?this.reset():(this._lastPos=Ur(this.element,d.targetTouches)[0],this.move({preventDefault:()=>d.preventDefault()},this._lastPos))}touchend(d){d.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function a1(it,d,$){if(it=new c.aT(it.lng,it.lat),d){const st=new c.aT(it.lng-360,it.lat),lt=new c.aT(it.lng+360,it.lat),ht=360*Math.ceil(Math.abs(it.lng-$.center.lng)/360),dt=$.locationPoint3D(it).distSqr(d),mt=d.x<0||d.y<0||d.x>$.width||d.y>$.height;$.locationPoint3D(st).distSqr(d)<dt&&(mt||Math.abs(st.lng-$.center.lng)<ht)?it=st:$.locationPoint3D(lt).distSqr(d)<dt&&(mt||Math.abs(lt.lng-$.center.lng)<ht)&&(it=lt)}for(;Math.abs(it.lng-$.center.lng)>180;){const st=$.locationPoint3D(it);if(st.x>=0&&st.y>=0&&st.x<=$.width&&st.y<=$.height)break;it.lng>$.center.lng?it.lng-=360:it.lng+=360}return it}const mu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},up={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Cx extends c.E{constructor(d,$){super(),(d instanceof HTMLElement||$)&&(d=Object.assign({element:d},$)),c.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:st="center",color:lt="#3FB1CE",scale:ht=1,draggable:dt=!1,clickTolerance:mt=0,rotation:Tt=up.rotation,rotationAlignment:Pt=up.rotationAlignment,pitchAlignment:Mt=up.pitchAlignment,occludedOpacity:Ht=up.occludedOpacity,altitude:$t=up.altitude}=d||{};this._anchor=st,this._color=lt,this._scale=ht,this._draggable=dt,this._clickTolerance=mt,this._rotation=Tt,this._rotationAlignment=Pt,this._pitchAlignment=Mt,this._occludedOpacity=Ht,this._altitude=$t,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),d&&d.element?(this._element=d.element,this._offset=c.P.convert(d&&d.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=c.P.convert(d&&d.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Xt=>{Xt.preventDefault()}),this._element.addEventListener("mousedown",Xt=>{Xt.preventDefault()});const qt=this._element.classList;for(const Xt in mu)qt.remove(`mapboxgl-marker-anchor-${Xt}`);qt.add(`mapboxgl-marker-anchor-${this._anchor}`);const Qt=d&&d.className?d.className.trim().split(/\s+/):[];qt.add(...Qt),this._popup=null}_createDefaultMarker(){const d=It("div"),$=Gt("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},d);if(this._altitude===0){const st=Gt("radialGradient",{id:"shadowGradient"},Gt("defs",{},$));Gt("stop",{offset:"10%","stop-opacity":.4},st),Gt("stop",{offset:"100%","stop-opacity":.05},st),Gt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},$)}return Gt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},$),Gt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},$),Gt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},$),d}addTo(d){return d===this._map||(this.remove(),this._map=d,d.getCanvasContainer().appendChild(this._element),d.on("move",this._updateMoving),d.on("moveend",this._update),d.on("remove",this._clearFadeTimer),d._addMarker(this),this.setDraggable(this._draggable),this._update(),d.on("click",this._onMapClick)),this}remove(){const d=this._map;return d&&(d.off("click",this._onMapClick),d.off("move",this._updateMoving),d.off("moveend",this._update),d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler),d.off("mouseup",this._onUp),d.off("touchend",this._onUp),d.off("mousemove",this._onMove),d.off("touchmove",this._onMove),d.off("remove",this._clearFadeTimer),d._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=c.aT.convert(d),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(d){return d===this._altitude||(this._defaultMarker&&(this._altitude===0&&d!==0||this._altitude!==0&&d===0)&&(this._element=this._createDefaultMarker()),this._altitude=d||up.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(d){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),d){if(!("offset"in d.options)){const lt=Math.sqrt(Math.pow(13.5,2)/2);d.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[lt,-1*(38.1-13.5+lt)],"bottom-right":[-lt,-1*(38.1-13.5+lt)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=d,d._marker=this,d._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(d){const $=d.code,st=d.charCode||d.keyCode;$!=="Space"&&$!=="Enter"&&st!==32&&st!==13||this.togglePopup()}_onMapClick(d){const $=d.originalEvent.target,st=this._element;this._popup&&($===st||st.contains($))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const d=this._popup;return d?(d.isOpen()?(d.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(d.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const d=this._map,$=this._pos;if(!d||!$)return!1;const st=d.unproject($,this._altitude),lt=d.getFreeCameraOptions();if(!lt.position)return!1;const ht=lt.position.toLngLat();return ht.distanceTo(st)<.9*ht.distanceTo(this._lngLat)}_evaluateOpacity(){const d=this._map;if(!d)return;const $=this._pos;if(!$||$.x<0||$.x>d.transform.width||$.y<0||$.y>d.transform.height)return void this._clearFadeTimer();const st=d.unproject($,this._altitude);let lt;d._showingGlobe()&&c.f5(d.transform,this._lngLat)?lt=0:(lt=1-d._queryFogOpacity(st),d.transform._terrainEnabled()&&d.getTerrain()&&this._behindTerrain()&&(lt*=this._occludedOpacity)),this._element.style.opacity=`${lt}`,this._element.style.pointerEvents=lt>0?"auto":"none",this._popup&&this._popup._setOpacity(lt),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const d=this._pos;if(!d||!this._map)return;const $=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${d.x}px,${d.y}px)
            ${mu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${$.x}px,${$.y}px)
        `}_calculateXYTransform(){const d=this._pos,$=this._map,st=this.getPitchAlignment();if(!$||!d||st!=="map")return"";if(!$._showingGlobe()){const Tt=$.getPitch();return Tt?`rotateX(${Tt}deg)`:""}const lt=c.cX(c.f6($.transform,this._lngLat)),ht=d.sub(c.f7($.transform)),dt=Math.abs(ht.x)+Math.abs(ht.y);if(dt===0)return"";const mt=lt/dt;return`rotateX(${-ht.y*mt}deg) rotateY(${ht.x*mt}deg)`}_calculateZTransform(){const d=this._pos,$=this._map;if(!$||!d)return"";let st=0;const lt=this.getRotationAlignment();if(lt==="map")if($._showingGlobe()){const ht=$.project(new c.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),dt=$.project(new c.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(ht);st=c.cX(Math.atan2(dt.y,dt.x))-90}else st=-$.getBearing();else if(lt==="horizon"){const ht=c.ah(4,6,$.getZoom()),dt=c.f7($.transform);dt.y+=ht*$.transform.height;const mt=d.sub(dt),Tt=c.cX(Math.atan2(mt.y,mt.x));st=(Tt>90?Tt-270:Tt+90)*(1-ht)}return st+=this._rotation,st?`rotateZ(${st}deg)`:""}_update(d){cancelAnimationFrame(this._updateFrameId);const $=this._map;$&&($.transform.renderWorldCopies&&(this._lngLat=a1(this._lngLat,this._pos,$.transform)),this._pos=$.project(this._lngLat,this._altitude),d===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),$._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),($._showingGlobe()||$.getTerrain()||$.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(d){return this._offset=c.P.convert(d),this._update(),this}addClassName(d){return this._element.classList.add(d),this}removeClassName(d){return this._element.classList.remove(d),this}toggleClassName(d){return this._element.classList.toggle(d)}_onMove(d){const $=this._map;if(!$)return;const st=this._pointerdownPos,lt=this._positionDelta;if(st&&lt){if(!this._isDragging){const ht=this._clickTolerance||$._clickTolerance;if(d.point.dist(st)<ht)return;this._isDragging=!0}this._pos=d.point.sub(lt),this._lngLat=$.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.z("dragstart"))),this.fire(new c.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const d=this._map;d&&(d.off("mousemove",this._onMove),d.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new c.z("dragend")),this._state="inactive"}_addDragHandler(d){const $=this._map,st=this._pos;$&&st&&this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(st),this._pointerdownPos=d.point,this._state="pending",$.on("mousemove",this._onMove),$.on("touchmove",this._onMove),$.once("mouseup",this._onUp),$.once("touchend",this._onUp))}setDraggable(d){this._draggable=!!d;const $=this._map;return $&&(d?($.on("mousedown",this._addDragHandler),$.on("touchstart",this._addDragHandler)):($.off("mousedown",this._addDragHandler),$.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(d){return this._rotation=d||up.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(d){return this._rotationAlignment=d||up.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(d){return this._pitchAlignment=d||up.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(d){return this._occludedOpacity=d||up.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const PT={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},$0={maxWidth:100,unit:"metric"},l1={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},hp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},dp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function p0(it=new c.P(0,0),d="bottom"){if(typeof it=="number"){const $=Math.round(Math.sqrt(.5*Math.pow(it,2)));switch(d){case"top":return new c.P(0,it);case"top-left":return new c.P($,$);case"top-right":return new c.P(-$,$);case"bottom":return new c.P(0,-it);case"bottom-left":return new c.P($,-$);case"bottom-right":return new c.P(-$,-$);case"left":return new c.P(it,0);case"right":return new c.P(-it,0)}return new c.P(0,0)}return it instanceof c.P||Array.isArray(it)?c.P.convert(it):c.P.convert(it[d]||[0,0])}return{version:ct,supported:Nt.supported,setRTLTextPlugin:c.fb,getRTLTextPluginStatus:c.fa,Map:class extends o1{constructor(it){xt.mark(pt.create);const d=it;if((it=Object.assign({},AT,it)).minZoom!=null&&it.maxZoom!=null&&it.minZoom>it.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(it.minPitch!=null&&it.maxPitch!=null&&it.minPitch>it.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(it.minPitch!=null&&it.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(it.maxPitch!=null&&it.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(it.antialias&&c.f3(window)&&(it.antialias=!1,c.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new hv(it.minZoom,it.maxZoom,it.minPitch,it.maxPitch,it.renderWorldCopies,null,null),it),this._repaint=!!it.repaint,this._interactive=it.interactive,this._minTileCacheSize=it.minTileCacheSize,this._maxTileCacheSize=it.maxTileCacheSize,this._failIfMajorPerformanceCaveat=it.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=it.preserveDrawingBuffer,this._antialias=it.antialias,this._trackResize=it.trackResize,this._bearingSnap=it.bearingSnap,this._refreshExpiredTiles=it.refreshExpiredTiles,this._fadeDuration=it.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=it.crossSourceCollisions,this._collectResourceTiming=it.collectResourceTiming,this._language=this._parseLanguage(it.language),this._worldview=it.worldview,this._renderTaskQueue=new om,this._domRenderTaskQueue=new om,this._controls=[],this._markers=[],this._popups=[],this._mapId=c.b2(),this._locale=Object.assign({},lm,it.locale),this._clickTolerance=it.clickTolerance,this._cooperativeGestures=it.cooperativeGestures,this._performanceMetricsCollection=it.performanceMetricsCollection,this._tessellationStep=it.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=it.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new am(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=it.scaleFactor,this._requestManager=new gn(it.transformRequest,it.accessToken,it.testMode),this._silenceAuthErrors=!!it.testMode,this._contextCreateOptions=it.contextCreateOptions?Object.assign({},it.contextCreateOptions):{},typeof it.container=="string"){const $=document.getElementById(it.container);if(!$)throw new Error(`Container '${it.container.toString()}' not found.`);this._container=$}else{if(!(it.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=it.container}if(this._container.childNodes.length>0&&c.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),it.maxBounds&&this.setMaxBounds(it.maxBounds),this._spriteFormat=it.spriteFormat,c.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ST(this,it),this._localFontFamily=it.localFontFamily,this._localIdeographFontFamily=it.localIdeographFontFamily,(it.style||!it.testMode)&&this.setStyle(it.style||c.e.DEFAULT_STYLE,{config:it.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),it.projection&&this.setProjection(it.projection),it.hash&&(this._hash=new Kv(typeof it.hash=="string"&&it.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){d.center==null&&d.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:it.center,zoom:it.zoom,bearing:it.bearing,pitch:it.pitch});const $=it.bounds;$&&(this.resize(),this.fitBounds($,Object.assign({},it.fitBoundsOptions,{duration:0})))}this.resize(),it.attributionControl&&this.addControl(new U_({customAttribution:it.customAttribution})),this._logoControl=new $_,this.addControl(this._logoControl,it.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",$=>{this._update($.dataType==="style"),this.fire(new c.z(`${$.dataType}data`,$))}),this.on("dataloading",$=>{this.fire(new c.z(`${$.dataType}dataloading`,$))}),this._interactions=new Tp(this)}_getMapId(){return this._mapId}addControl(it,d){if(d===void 0&&(d=it.getDefaultPosition?it.getDefaultPosition():"top-right"),!it||!it.onAdd)return this.fire(new c.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const $=it.onAdd(this);this._controls.push(it);const st=this._controlPositions[d];return d.indexOf("bottom")!==-1?st.insertBefore($,st.firstChild):st.appendChild($),this}removeControl(it){if(!it||!it.onRemove)return this.fire(new c.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const d=this._controls.indexOf(it);return d>-1&&this._controls.splice(d,1),it.onRemove(this),this}hasControl(it){return this._controls.indexOf(it)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(it){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const d=!this._moving;return d&&this.fire(new c.z("movestart",it)).fire(new c.z("move",it)),this.fire(new c.z("resize",it)),d&&this.fire(new c.z("moveend",it)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(it){return this.transform.setMaxBounds(c.aI.convert(it)),this._update()}setMinZoom(it){if((it=it??-2)>=-2&&it<=this.transform.maxZoom)return this.transform.minZoom=it,this._update(),this.getZoom()<it?this.setZoom(it):this.fire(new c.z("zoomstart")).fire(new c.z("zoom")).fire(new c.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(it){if((it=it??22)>=this.transform.minZoom)return this.transform.maxZoom=it,this._update(),this.getZoom()>it?this.setZoom(it):this.fire(new c.z("zoomstart")).fire(new c.z("zoom")).fire(new c.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(it){if((it=it??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(it>=0&&it<=this.transform.maxPitch)return this.transform.minPitch=it,this._update(),this.getPitch()<it?this.setPitch(it):this.fire(new c.z("pitchstart")).fire(new c.z("pitch")).fire(new c.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(it){if((it=it??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(it>=this.transform.minPitch)return this.transform.maxPitch=it,this._update(),this.getPitch()>it?this.setPitch(it):this.fire(new c.z("pitchstart")).fire(new c.z("pitch")).fire(new c.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(it){return this._scaleFactor=it,this.painter.scaleFactor=it,this._scaleFactorChanged=!0,this.style._updateFilteredLayers(d=>d.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(it){return this.transform.renderWorldCopies=it,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(it){return it==="auto"?navigator.language:Array.isArray(it)?it.length===0?void 0:it.map(d=>d==="auto"?navigator.language:d):it}setLanguage(it){const d=this._parseLanguage(it);if(!this.style||d===this._language)return this;this._language=d,this.style.reloadSources();for(const $ of this._controls)$._setLanguage&&$._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(it){return this.style&&it!==this._worldview?(this._worldview=it,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(it){return this._lazyInitEmptyStyle(),it?typeof it=="string"&&(it={name:it}):it=null,this._useExplicitProjection=!!it,this._prioritizeAndUpdateProjection(it,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const it=this.transform,d=it.projection.name;let $;d==="globe"&&it.zoom>=c.cL?(it.setMercatorFromTransition(),$=!0):d==="mercator"&&it.zoom<c.cL&&(it.setProjection({name:"globe"}),$=!0),$&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(it,d){return this._updateProjection(it||d||{name:"mercator"})}_updateProjection(it){let d;const $=this.transform.mercatorFromTransition;d=it.name==="globe"&&this.transform.zoom>=c.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(it),this.style.applyProjectionUpdate();const st=this.transform.getProjection().name==="mercator"&&$!==this.transform.mercatorFromTransition;return(d||st)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(it,d){return this.transform.locationPoint3D(c.aT.convert(it),d)}unproject(it,d){return this.transform.pointLocation3D(c.P.convert(it),d)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(it,d,$){const st=lt=>{let ht=[];if(Array.isArray(d)){const dt=d.filter(mt=>this.getLayer(mt));ht=dt.length?this.queryRenderedFeatures(lt,{layers:dt}):[]}else ht=this.queryRenderedFeatures(lt,{target:d});return ht};if(it==="mouseenter"||it==="mouseover"){let lt=!1;return{listener:$,targets:d,delegates:{mousemove:dt=>{const mt=st(dt.point);mt.length?lt||(lt=!0,$.call(this,new Ou(it,this,dt.originalEvent,{features:mt}))):lt=!1},mouseout:()=>{lt=!1}}}}if(it==="mouseleave"||it==="mouseout"){let lt=!1;return{listener:$,targets:d,delegates:{mousemove:mt=>{st(mt.point).length?lt=!0:lt&&(lt=!1,$.call(this,new Ou(it,this,mt.originalEvent)))},mouseout:mt=>{lt&&(lt=!1,$.call(this,new Ou(it,this,mt.originalEvent)))}}}}{const lt=ht=>{const dt=st(ht.point);dt.length&&(ht.features=dt,$.call(this,ht),delete ht.features)};return{listener:$,targets:d,delegates:{[it]:lt}}}}on(it,d,$){if(typeof d=="function"||$===void 0)return super.on(it,d);if(typeof d=="string"&&(d=[d]),!this._areTargetsValid(d))return this;const st=this._createDelegatedListener(it,d,$);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[it]=this._delegatedListeners[it]||[],this._delegatedListeners[it].push(st);for(const lt in st.delegates)this.on(lt,st.delegates[lt]);return this}once(it,d,$){if(typeof d=="function"||$===void 0)return super.once(it,d);if(typeof d=="string"&&(d=[d]),!this._areTargetsValid(d))return this;const st=this._createDelegatedListener(it,d,$);for(const lt in st.delegates)this.once(lt,st.delegates[lt]);return this}off(it,d,$){if(typeof d=="function"||$===void 0)return super.off(it,d);if(typeof d=="string"&&(d=[d]),!this._areTargetsValid(d))return this;const st=this._delegatedListeners?this._delegatedListeners[it]:void 0;return st&&(lt=>{for(let ht=0;ht<lt.length;ht++){const dt=lt[ht];if(dt.listener===$&&CT(dt.targets,d)){for(const mt in dt.delegates)this.off(mt,dt.delegates[mt]);return lt.splice(ht,1),this}}})(st),this}queryRenderedFeatures(it,d){if(!this.style)return[];if(it===void 0||it instanceof c.P||Array.isArray(it)||d!==void 0||(d=it,it=void 0),it=it||[[0,0],[this.transform.width,this.transform.height]],!d){const ht=this.style.queryRenderedFeatures(it,void 0,this.transform),dt=this.style.queryRenderedFeatureset(it,void 0,this.transform);return ht.concat(dt)}let $=!0;if(d.target&&($=this._isTargetValid(d.target),$&&!d.layers))return this.style.queryRenderedFeatureset(it,d,this.transform);let st=!0;if(d.layers&&Array.isArray(d.layers)){for(const ht of d.layers)if(!this._isValidId(ht)){st=!1;break}if(st&&!d.target)return this.style.queryRenderedFeatures(it,d,this.transform)}let lt=[];return st&&(lt=lt.concat(this.style.queryRenderedFeatures(it,d,this.transform))),$&&(lt=lt.concat(this.style.queryRenderedFeatureset(it,d,this.transform))),lt}querySourceFeatures(it,d){return!it||typeof it=="string"&&!this._isValidId(it)?[]:this.style.querySourceFeatures(it,d)}queryRasterValue(it,d,$){return this._isValidId(it)?this.style.queryRasterValue(it,d,$):Promise.resolve(null)}isPointOnSurface(it){const{name:d}=this.transform.projection;return d!=="globe"&&d!=="mercator"&&c.w(`${d} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(c.P.convert(it))}addInteraction(it,d){return this._interactions.add(it,d),this}removeInteraction(it){return this._interactions.remove(it),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(it){return this._cooperativeGestures=it,this}setStyle(it,d){return d=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},d),this.style&&it&&d.diff!==!1&&d.localFontFamily===this._localFontFamily&&d.localIdeographFontFamily===this._localIdeographFontFamily&&!d.config?(this.style._diffStyle(it,($,st)=>{if($){const lt=typeof $=="string"?$:$ instanceof Error?$.message:$.error;c.w(`Unable to perform style diff: ${lt}. Rebuilding the style from scratch.`),this._updateStyle(it,d)}else st&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=d.localIdeographFontFamily,this._localFontFamily=d.localFontFamily,this._updateStyle(it,d))}_getUIString(it){const d=this._locale[it];if(d==null)throw new Error(`Missing UI string '${it}'`);return d}_updateStyle(it,d){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),it){const $=Object.assign({},d);d&&d.config&&($.initialConfig=d.config,delete $.config),this.style=new cp(this,$).load(it),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new cp(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(c.w("There is no style added to the map."),!1)}_isValidId(it){return it==null?(this.fire(new c.y(new Error("IDs can't be empty."))),!1):!c.dr(it)||(this.fire(new c.y(new Error(`IDs can't contain special symbols: "${it}".`))),!1)}_isTargetValid(it){return"featuresetId"in it?this._isValidId("importId"in it?it.importId:it.featuresetId):"layerId"in it&&this._isValidId(it.layerId)}_areTargetsValid(it){if(Array.isArray(it)){for(const d of it)if(!this._isValidId(d))return!1;return!0}return this._isTargetValid(it)}addSource(it,d){return this._isValidId(it)?(this._lazyInitEmptyStyle(),this.style.addSource(it,d),this._update(!0)):this}isSourceLoaded(it){return!!this._isValidId(it)&&!!this.style&&this.style._isSourceCacheLoaded(it)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(it,d,$){this._lazyInitEmptyStyle(),this.style.addSourceType(it,d,$)}removeSource(it){return this._isValidId(it)?(this.style.removeSource(it),this._updateTerrain(),this._update(!0)):this}getSource(it){return this._isValidId(it)?this.style.getOwnSource(it):null}addImage(it,d,{pixelRatio:$=1,sdf:st=!1,stretchX:lt,stretchY:ht,content:dt}={}){this._lazyInitEmptyStyle();const mt=c.I.from(it);if(d instanceof HTMLImageElement||ImageBitmap&&d instanceof ImageBitmap){const{width:Tt,height:Pt,data:Mt}=c.o.getImageData(d);this.style.addImage(mt,{data:new c.q({width:Tt,height:Pt},Mt),pixelRatio:$,stretchX:lt,stretchY:ht,content:dt,sdf:st,version:0,usvg:!1})}else if(d.width===void 0||d.height===void 0)this.fire(new c.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:Tt,height:Pt}=d,Mt=d;this.style.addImage(mt,{data:new c.q({width:Tt,height:Pt},new Uint8Array(Mt.data)),pixelRatio:$,stretchX:lt,stretchY:ht,content:dt,sdf:st,usvg:!1,version:0,userImage:Mt}),Mt.onAdd&&Mt.onAdd(this,it)}}updateImage(it,d){this._lazyInitEmptyStyle();const $=c.I.from(it),st=this.style.getImage($);if(!st)return void this.fire(new c.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const lt=d instanceof HTMLImageElement||ImageBitmap&&d instanceof ImageBitmap?c.o.getImageData(d):d,{width:ht,height:dt,data:mt}=lt;if(ht===void 0||dt===void 0)return void this.fire(new c.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(ht!==(st.usvg?st.icon.usvg_tree.width:st.data.width)||dt!==(st.usvg?st.icon.usvg_tree.height:st.data.height))return void this.fire(new c.y(new Error(`The width and height of the updated image (${ht}, ${dt})
                must be that same as the previous version of the image
                (${st.data.width}, ${st.data.height})`)));const Tt=!(d instanceof HTMLImageElement||ImageBitmap&&d instanceof ImageBitmap);let Pt=!1;st.usvg?(st.data=new c.q({width:ht,height:dt},new Uint8Array(mt)),st.usvg=!1,st.icon=void 0,Pt=!0):st.data.replace(mt,Tt),this.style.updateImage($,st,Pt)}hasImage(it){return it?!!this.style&&!!this.style.getImage(c.I.from(it)):(this.fire(new c.y(new Error("Missing required image id"))),!1)}removeImage(it){this.style.removeImage(c.I.from(it))}loadImage(it,d){c.n(this._requestManager.transformRequest(it,c.R.Image),($,st)=>{d($,st instanceof HTMLImageElement?c.o.getImageData(st):st)})}listImages(){return this.style.listImages().map(it=>it.name)}addModel(it,d){this._lazyInitEmptyStyle(),this.style.addModel(it,d)}hasModel(it){return it?this.style.hasModel(it):(this.fire(new c.y(new Error("Missing required model id"))),!1)}removeModel(it){this.style.removeModel(it)}listModels(){return this.style.listModels()}addLayer(it,d){return this._isValidId(it.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(it,d),this._update(!0)):this}getSlot(it){const d=this.getLayer(it);return d&&d.slot||null}setSlot(it,d){return this.style.setSlot(it,d),this.style.mergeLayers(),this._update(!0)}addImport(it,d){return this.style.addImport(it,d).catch($=>this.fire(new c.y(new Error("Failed to add import",$)))),this}updateImport(it,d){return typeof d!="string"&&d.id!==it?(this.removeImport(it),this.addImport(d)):(this.style.updateImport(it,d),this._update(!0))}removeImport(it){return this.style.removeImport(it),this}moveImport(it,d){return this.style.moveImport(it,d),this._update(!0)}moveLayer(it,d){return this._isValidId(it)?(this.style.moveLayer(it,d),this._update(!0)):this}removeLayer(it){return this._isValidId(it)?(this.style.removeLayer(it),this._update(!0)):this}getLayer(it){if(!this._isValidId(it))return null;const d=this.style.getOwnLayer(it);return d?d.type==="custom"?d.implementation:d.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(it,d,$){return this._isValidId(it)?(this.style.setLayerZoomRange(it,d,$),this._update(!0)):this}setFilter(it,d,$={}){return this._isValidId(it)?(this.style.setFilter(it,d,$),this._update(!0)):this}getFilter(it){return this._isValidId(it)?this.style.getFilter(it):null}setPaintProperty(it,d,$,st={}){return this._isValidId(it)?(this.style.setPaintProperty(it,d,$,st),this._update(!0)):this}getPaintProperty(it,d){return this._isValidId(it)?this.style.getPaintProperty(it,d):null}setLayoutProperty(it,d,$,st={}){return this._isValidId(it)?(this.style.setLayoutProperty(it,d,$,st),this._update(!0)):this}getLayoutProperty(it,d){return this._isValidId(it)?this.style.getLayoutProperty(it,d):null}setLayerProperty(it,d,$,st={}){return this._isValidId(it)?(d==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(it,d,$,st),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(it){return this.style.setGlyphsUrl(it),this._update(!0)}getSchema(it){return this.style.getSchema(it)}setSchema(it,d){return this.style.setSchema(it,d),this._update(!0)}getConfig(it){return this.style.getConfig(it)}setConfig(it,d){return this.style.setConfig(it,d),this._update(!0)}getConfigProperty(it,d){return this.style.getConfigProperty(it,d)}setConfigProperty(it,d,$){return this.style.setConfigProperty(it,d,$),this._update(!0)}getFeaturesetDescriptors(it){return this.style.getFeaturesetDescriptors(it)}setLights(it){if(this._lazyInitEmptyStyle(),it&&it.length===1&&it[0].type==="flat"){const d=it[0];d.properties?this.style.setFlatLight(d.properties,d.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(it),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const it=this.style.getLights()||[];return it.length===0&&it.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),it}setLight(it,d={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:it}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(it){return this._lazyInitEmptyStyle(),!it&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(it),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(it){return this._lazyInitEmptyStyle(),this.style.setFog(it),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(it){return this._lazyInitEmptyStyle(),this.style.setSnow(it),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(it){return this._lazyInitEmptyStyle(),this.style.setRain(it),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(it){return this._lazyInitEmptyStyle(),this.style.setColorTheme(it),this._update(!0)}setImportColorTheme(it,d){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(it,d),this._update(!0)}setCamera(it){return this.style.setCamera(it),this._triggerCameraUpdate(it)}_triggerCameraUpdate(it){return this._update(this.transform.setOrthographicProjectionAtLowPitch(it["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(it){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(c.aT.convert(it),this.transform):0}setFeatureState(it,d){return it.source&&!this._isValidId(it.source)?this:(this.style.setFeatureState(it,d),this._update())}removeFeatureState(it,d){return it.source&&!this._isValidId(it.source)?this:(this.style.removeFeatureState(it,d),this._update())}getFeatureState(it){return it.source&&!this._isValidId(it.source)?null:this.style.getFeatureState(it)}_selectIndoorFloor(it){this.indoor.selectFloor(it)}_setIndoorActiveFloorsVisibility(it){this.indoor.setActiveFloorsVisibility(it)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new U0),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const it=this._container.getBoundingClientRect().width||400,d=this._container.getBoundingClientRect().height||300;let $,st,lt,ht=this._container;for(;ht&&(!st||!lt);){const dt=window.getComputedStyle(ht).transform;dt&&dt!=="none"&&($=dt.match(/matrix.*\((.+)\)/)[1].split(", "),$[0]&&$[0]!=="0"&&$[0]!=="1"&&(st=$[0]),$[3]&&$[3]!=="0"&&$[3]!=="1"&&(lt=$[3])),ht=ht.parentElement}this._containerWidth=st?Math.abs(it/st):it,this._containerHeight=lt?Math.abs(d/lt):d}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&c.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new cw(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const it=this._container;it.classList.add("mapboxgl-map"),(this._missingCSSCanary=It("div","mapboxgl-canary",it)).style.visibility="hidden",this._detectMissingCSS();const d=this._canvasContainer=It("div","mapboxgl-canvas-container",it);this._canvas=It("canvas","mapboxgl-canvas",d),this._interactive&&(d.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const $=this._controlContainer=It("div","mapboxgl-control-container",it),st=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(lt=>{st[lt]=It("div",`mapboxgl-ctrl-${lt}`,$)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(it,d){const $=c.o.devicePixelRatio||1;this._canvas.width=$*Math.ceil(it),this._canvas.height=$*Math.ceil(d),this._canvas.style.width=`${it}px`,this._canvas.style.height=`${d}px`}_addMarker(it){this._markers.push(it)}_removeMarker(it){const d=this._markers.indexOf(it);d!==-1&&this._markers.splice(d,1)}_addPopup(it){this._popups.push(it)}_removePopup(it){const d=this._popups.indexOf(it);d!==-1&&this._popups.splice(d,1)}_setupPainter(){const it=Object.assign({},Nt.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),d=this._canvas.getContext("webgl2",it);d?(Vo(d,!0),this.painter=new hx(d,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",$=>{$.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),c.k.testSupport(d)):this.fire(new c.y(new Error("Failed to initialize WebGL")))}_contextLost(it){it.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.z("webglcontextlost",{originalEvent:it}))}_contextRestored(it){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new c.z("webglcontextrestored",{originalEvent:it}))}_onMapScroll(it){if(it.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(it){return this.style?(this._styleDirty=this._styleDirty||it,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(it){return this._update(),this._renderTaskQueue.add(it)}_cancelRenderFrame(it){this._renderTaskQueue.remove(it)}_requestDomTask(it){!this.loaded()||this.loaded()&&!this.isMoving()?it():this._domRenderTaskQueue.add(it)}_render(it){let d;this.fire(new c.z("renderstart")),++this._frameId;const $=this.painter.context.extTimerQuery,st=c.o.now(),lt=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(d=lt.createQuery(),lt.beginQuery($.TIME_ELAPSED_EXT,d)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(it),this._domRenderTaskQueue.run(it),this._removed)return;this._updateProjectionTransition();const ht=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const Pt=this.transform.zoom,Mt=this.transform.pitch,Ht=c.o.now(),$t=new c.ac(Pt,{now:Ht,fadeDuration:ht,pitch:Mt,transition:this.style.transition,worldview:this._worldview});this.style.update($t)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let dt=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),dt=this._updateAverageElevation(st),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):dt=this._updateAverageElevation(st);const mt=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,ht,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),mt&&(this._placementDirty=mt.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:ht,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new c.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,xt.mark(pt.load),this.fire(new c.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),d){const Pt=c.o.now()-st;lt.endQuery($.TIME_ELAPSED_EXT),setTimeout(()=>{const Mt=lt.getQueryParameter(d,lt.QUERY_RESULT)/1e6;lt.deleteQuery(d),this.fire(new c.z("gpu-timing-frame",{cpuTime:Pt,gpuTime:Mt}))},50)}if(this.listens("gpu-timing-layer")){const Pt=this.painter.collectGpuTimers();setTimeout(()=>{const Mt=this.painter.queryGpuTimers(Pt);this.fire(new c.z("gpu-timing-layer",{layerTimes:Mt}))},50)}if(this.listens("gpu-timing-deferred-render")){const Pt=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const Mt=this.painter.queryGpuTimeDeferredRender(Pt);this.fire(new c.z("gpu-timing-deferred-render",{gpuTime:Mt}))},50)}const Tt=this._sourcesDirty||this._styleDirty||this._placementDirty||dt;if(Tt||this._repaint)this.triggerRepaint();else{const Pt=this.idle();if(Pt&&(dt=this._updateAverageElevation(st,!0)),dt)this.triggerRepaint();else if(this._triggerFrame(!1),Pt&&(this.fire(new c.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const Mt=this._calculateSpeedIndex();this.fire(new c.z("speedindexcompleted",{speedIndex:Mt})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||Tt||(this._fullyLoaded=!0,xt.mark(pt.fullLoad),this._performanceMetricsCollection&&ws(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(it){for(const d of this._markers)it&&!this.getRenderWorldCopies()&&(d._lngLat=d._lngLat.wrap()),d._update();for(const d of this._popups)!it||this.getRenderWorldCopies()||d._trackPointer||(d._lngLat=d._lngLat.wrap()),d._update()}_updateAverageElevation(it,d=!1){const $=lt=>(this.transform.averageElevation=lt,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&$(0);const st=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(st||(d||it-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(it)){const lt=this.transform.averageElevation;let ht=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(ht)?ht=0:this._averageElevationLastSampledAt=it;const dt=Math.abs(lt-ht);if(dt>1){if(this._isInitialLoad||st)return this._averageElevation.jumpTo(ht),$(ht);this._averageElevation.easeTo(ht,it,300)}else if(dt>1e-4)return this._averageElevation.jumpTo(ht),$(ht)}return!!this._averageElevation.isEasing(it)&&$(this._averageElevation.getValue(it))}_authenticate(){Rl(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,it=>{if(it&&(it.message===rn||it.status===401)){const d=this.painter.context.gl;Vo(d,!1),this._logoControl instanceof $_&&this._logoControl._updateLogo(),d&&d.clear(d.DEPTH_BUFFER_BIT|d.COLOR_BUFFER_BIT|d.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new c.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),vs(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&ns(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&ls(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){Ss(this._requestManager._customAccessToken)}_updateTerrain(){const it=this._isDragging();this.painter.updateTerrain(this.style,it)}_calculateSpeedIndex(){const it=this.painter.canvasCopy(),d=this.painter.getCanvasCopiesAndTimestamps();d.timeStamps.push(performance.now());const $=this.painter.context.gl,st=$.createFramebuffer();function lt(ht){$.framebufferTexture2D($.FRAMEBUFFER,$.COLOR_ATTACHMENT0,$.TEXTURE_2D,ht,0);const dt=new Uint8Array($.drawingBufferWidth*$.drawingBufferHeight*4);return $.readPixels(0,0,$.drawingBufferWidth,$.drawingBufferHeight,$.RGBA,$.UNSIGNED_BYTE,dt),dt}return $.bindFramebuffer($.FRAMEBUFFER,st),this._canvasPixelComparison(lt(it),d.canvasCopies.map(lt),d.timeStamps)}_canvasPixelComparison(it,d,$){let st=$[1]-$[0];const lt=it.length/4;for(let ht=0;ht<d.length;ht++){const dt=d[ht];let mt=0;for(let Tt=0;Tt<dt.length;Tt+=4)dt[Tt]===it[Tt]&&dt[Tt+1]===it[Tt+1]&&dt[Tt+2]===it[Tt+2]&&dt[Tt+3]===it[Tt+3]&&(mt+=1);st+=($[ht+2]-$[ht+1])*(1-mt/lt)}return st}remove(){this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const it=this.painter.context.gl.getExtension("WEBGL_lose_context");it&&it.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Qo.delete(this.painter.context.gl),ps.remove(),jn.remove(),this._removed=!0,this.fire(new c.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(it){this._renderNextFrame=this._renderNextFrame||it,this.style&&!this._frame&&(this._frame=c.o.frame(d=>{const $=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,$&&this._render(d)}))}_preloadTiles(it){const d=this.style?this.style.getSourceCaches():[];return c.bw(d,($,st)=>$._preloadTiles(it,st),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(it){this._trackResize&&this.resize({originalEvent:it})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(it){this._showTileBoundaries!==it&&(this._showTileBoundaries=it,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(it){this._showParseStatus!==it&&(this._showParseStatus=it,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(it){this._showTerrainWireframe!==it&&(this._showTerrainWireframe=it,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(it){this._showLayers2DWireframe!==it&&(this._showLayers2DWireframe=it,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(it){this._showLayers3DWireframe!==it&&(this._showLayers3DWireframe=it,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(it){this._speedIndexTiming!==it&&(this._speedIndexTiming=it,this._update())}get showPadding(){return!!this._showPadding}set showPadding(it){this._showPadding!==it&&(this._showPadding=it,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(it){this._showCollisionBoxes!==it&&(this._showCollisionBoxes=it,this.style&&it?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(it){this._showOverdrawInspector!==it&&(this._showOverdrawInspector=it,this._update())}get repaint(){return!!this._repaint}set repaint(it){this._repaint!==it&&(this._repaint=it,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(it){this._vertices=it,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(it){this._showTileAABBs!==it&&(this._showTileAABBs=it,it&&this._update())}_setCacheLimits(it,d){c.f4(it,d)}get version(){return ct}},NavigationControl:class{constructor(it={}){this.options=Object.assign({},RT,it),this._container=It("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",d=>d.preventDefault()),this.options.showZoom&&(c.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",d=>{this._map&&this._map.zoomIn({},{originalEvent:d})}),It("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",d=>{this._map&&this._map.zoomOut({},{originalEvent:d})}),It("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(c.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",d=>{const $=this._map;$&&(this.options.visualizePitch?$.resetNorthPitch({},{originalEvent:d}):$.resetNorth({},{originalEvent:d}))}),this._compassIcon=It("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const it=this._map;if(!it)return;const d=it.getZoom(),$=d===it.getMaxZoom(),st=d===it.getMinZoom();this._zoomInButton.disabled=$,this._zoomOutButton.disabled=st,this._zoomInButton.setAttribute("aria-disabled",$.toString()),this._zoomOutButton.setAttribute("aria-disabled",st.toString())}_rotateCompassArrow(){const it=this._map;if(!it)return;const d=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(it.transform.pitch*(Math.PI/180)),.5)}) rotateX(${it.transform.pitch}deg) rotateZ(${it.transform.angle*(180/Math.PI)}deg)`:`rotate(${it.transform.angle*(180/Math.PI)}deg)`;it._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=d)})}onAdd(it){return this._map=it,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),it.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&it.on("pitch",this._rotateCompassArrow),it.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new IT(it,this._compass,this.options.visualizePitch)),this._container}onRemove(){const it=this._map;it&&(this._container.remove(),this.options.showZoom&&it.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&it.off("pitch",this._rotateCompassArrow),it.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(it,d){const $=It("button",it,this._container);return $.type="button",$.addEventListener("click",d),$}_setButtonTitle(it,d){if(!this._map)return;const $=this._map._getUIString(`NavigationControl.${d}`);it.setAttribute("aria-label",$),it.firstElementChild&&it.firstElementChild.setAttribute("title",$)}},GeolocateControl:class extends c.E{constructor(it={}){super();const d=navigator.geolocation;this.options=Object.assign({geolocation:d},PT,it),c.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=dx(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(it){return this._map=it,this._container=It("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(it){const d=($=!!this.options.geolocation)=>{this._supportsGeolocation=$,it($)};this._supportsGeolocation!==void 0?it(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then($=>d($.state!=="denied")).catch(()=>d()):d()}_isOutOfMapMaxBounds(it){const d=this._map.getMaxBounds(),$=it.coords;return!!d&&($.longitude<d.getWest()||$.longitude>d.getEast()||$.latitude<d.getSouth()||$.latitude>d.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(it){if(this._map){if(this._isOutOfMapMaxBounds(it))return this._setErrorState(),this.fire(new c.z("outofmaxbounds",it)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=it,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(it),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(it),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new c.z("geolocate",Object.assign({coords:it.coords,timestamp:it.timestamp},it.toJSON?{toJSON:it.toJSON.bind(it)}:{}))),this._finish()}}_updateCamera(it){const d=new c.aT(it.coords.longitude,it.coords.latitude),$=it.coords.accuracy,st=this._map.getBearing(),lt=Object.assign({bearing:st},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds($),lt,{geolocateSource:!0})}_updateMarker(it){if(it){const d=new c.aT(it.coords.longitude,it.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=it.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const it=this._map.transform,d=c.cf(1,it._center.lat)*it.worldSize,$=Math.ceil(2*this._accuracy*d);this._circleElement.style.width=`${$}px`,this._circleElement.style.height=`${$}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(it){if(this._map){if(this.options.trackUserLocation)if(it.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",d),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(it.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new c.z("error",it)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(it){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=It("button","mapboxgl-ctrl-geolocate",this._container),It("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",it===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",d),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",d),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=It("div","mapboxgl-user-location"),this._dotElement.appendChild(It("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(It("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Cx({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=It("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Cx({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new c.z("trackuserlocationend")))})}}_onDeviceOrientation(it){this._userLocationDotMarker&&(it.webkitCompassHeading?this._heading=it.webkitCompassHeading:it.absolute===!0&&(this._heading=-1*it.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new c.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let it;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(it={maximumAge:6e5,timeout:0},this._noTimeout=!0):(it=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,it),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const it=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(d=>{d==="granted"&&it()}).catch(console.error):it()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:U_,ScaleControl:class{constructor(it={}){this.options=Object.assign({},$0,it),c.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const it=this.options.maxWidth||100,d=this._map,$=d._containerHeight/2,st=d._containerWidth/2-it/2,lt=d.unproject([st,$]),ht=d.unproject([st+it,$]),dt=lt.distanceTo(ht);if(this.options.unit==="imperial"){const mt=3.2808*dt;mt>5280?this._setScale(it,mt/5280,"mile"):this._setScale(it,mt,"foot")}else this.options.unit==="nautical"?this._setScale(it,dt/1852,"nautical-mile"):dt>=1e3?this._setScale(it,dt/1e3,"kilometer"):this._setScale(it,dt,"meter")}_setScale(it,d,$){this._map._requestDomTask(()=>{const st=function(ht){const dt=Math.pow(10,`${Math.floor(ht)}`.length-1);let mt=ht/dt;return mt=mt>=10?10:mt>=5?5:mt>=3?3:mt>=2?2:mt>=1?1:function(Tt){const Pt=Math.pow(10,Math.ceil(-Math.log(Tt)/Math.LN10));return Math.round(Tt*Pt)/Pt}(mt),dt*mt}(d),lt=st/d;this._container.innerHTML=$!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:$}).format(st):`${st}&nbsp;${l1[$]}`,this._container.style.width=it*lt+"px"})}onAdd(it){return this._map=it,this._language=it.getLanguage(),this._container=It("div","mapboxgl-ctrl mapboxgl-ctrl-scale",it.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(it){this._language=it,this._update()}setUnit(it){this.options.unit=it,this._update()}},FullscreenControl:class{constructor(it={}){this._fullscreen=!1,it&&it.container&&(it.container instanceof HTMLElement?this._container=it.container:c.w("Full screen control 'container' must be a DOM element.")),c.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(it){return this._map=it,this._container||(this._container=this._map.getContainer()),this._controlContainer=It("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",c.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const it=this._fullscreenButton=It("button","mapboxgl-ctrl-fullscreen",this._controlContainer);It("span","mapboxgl-ctrl-icon",it).setAttribute("aria-hidden","true"),it.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const it=this._getTitle();this._fullscreenButton.setAttribute("aria-label",it),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",it)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:U0,Popup:class extends c.E{constructor(it){super(),this.options=Object.assign(Object.create(hp),it),this._altitude=this.options.altitude,c.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(it&&it.className?it.className.trim().split(/\s+/):[])}addTo(it){return this._map&&this.remove(),this._map=it,this.options.closeOnClick&&it.on("preclick",this._onClose),this.options.closeOnMove&&it.on("move",this._onClose),it.on("remove",this.remove),this._update(),it._addPopup(this),this._focusFirstElement(),this._trackPointer?(it.on("mousemove",this._onMouseEvent),it.on("mouseup",this._onMouseEvent),it._canvasContainer.classList.add("mapboxgl-track-pointer")):it.on("move",this._update),this.fire(new c.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const it=this._map;return it&&(it.off("move",this._update),it.off("move",this._onClose),it.off("preclick",this._onClose),it.off("click",this._onClose),it.off("remove",this.remove),it.off("mousemove",this._onMouseEvent),it.off("mouseup",this._onMouseEvent),it.off("drag",this._onMouseEvent),it._canvasContainer&&it._canvasContainer.classList.remove("mapboxgl-track-pointer"),it._removePopup(this),this._map=void 0),this.fire(new c.z("close")),this}getLngLat(){return this._lngLat}setLngLat(it){this._lngLat=c.aT.convert(it),this._pos=null,this._trackPointer=!1,this._update();const d=this._map;return d&&(d.on("move",this._update),d.off("mousemove",this._onMouseEvent),d._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(it){return this._altitude=it,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const it=this._map;return it&&(it.off("move",this._update),it.on("mousemove",this._onMouseEvent),it.on("drag",this._onMouseEvent),it._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(it){return this.setDOMContent(document.createTextNode(it))}setHTML(it){const d=document.createDocumentFragment(),$=document.createElement("body");let st;for($.innerHTML=it;st=$.firstChild,st;)d.appendChild(st);return this.setDOMContent(d)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(it){return this.options.maxWidth=it,this._update(),this}setDOMContent(it){let d=this._content;if(d)for(;d.hasChildNodes();)d.firstChild&&d.removeChild(d.firstChild);else d=this._content=It("div","mapboxgl-popup-content",this._container||void 0);if(d.appendChild(it),this.options.closeButton){const $=this._closeButton=It("button","mapboxgl-popup-close-button",d);$.type="button",$.setAttribute("aria-label","Close popup"),$.innerHTML='<span aria-hidden="true">&#215;</span>',$.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(it){return this._classList.add(it),this._updateClassList(),this}removeClassName(it){return this._classList.delete(it),this._updateClassList(),this}setOffset(it){return this.options.offset=it,this._update(),this}toggleClassName(it){let d;return this._classList.delete(it)?d=!1:(this._classList.add(it),d=!0),this._updateClassList(),d}_onMouseEvent(it){this._update(it.point)}_getAnchor(it){if(this.options.anchor)return this.options.anchor;const d=this._map,$=this._container,st=this._pos;if(!d||!$||!st)return"bottom";const lt=$.offsetWidth,ht=$.offsetHeight,dt=st.x<lt/2,mt=st.x>d.transform.width-lt/2;if(st.y+it<ht)return dt?"top-left":mt?"top-right":"top";if(st.y>d.transform.height-ht){if(dt)return"bottom-left";if(mt)return"bottom-right"}return dt?"left":mt?"right":"bottom"}_updateClassList(){const it=this._container;if(!it)return;const d=[...this._classList];d.push("mapboxgl-popup"),this._anchor&&d.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&d.push("mapboxgl-popup-track-pointer"),it.className=d.join(" ")}_update(it){const d=this._map,$=this._content;if(!d||!this._lngLat&&!this._trackPointer||!$)return;let st=this._container;if(st||(st=this._container=It("div","mapboxgl-popup",d.getContainer()),this._tip=It("div","mapboxgl-popup-tip",st),st.appendChild($)),this.options.maxWidth&&st.style.maxWidth!==this.options.maxWidth&&(st.style.maxWidth=this.options.maxWidth),d.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=a1(this._lngLat,this._pos,d.transform)),!this._trackPointer||it){const lt=this._pos=this._trackPointer&&it instanceof c.P?it:d.project(this._lngLat,this._altitude),ht=p0(this.options.offset),dt=this._anchor=this._getAnchor(ht.y),mt=p0(this.options.offset,dt),Tt=lt.add(mt).round();d._requestDomTask(()=>{this._container&&dt&&(this._container.style.transform=`${mu[dt]} translate(${Tt.x}px,${Tt.y}px)`)})}if(!this._marker&&d._showingGlobe()){const lt=c.f5(d.transform,this._lngLat)?0:1;this._setOpacity(lt)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const it=this._container.querySelector(dp);it&&it.focus()}_onClose(){this.remove()}_setOpacity(it){this._container&&(this._container.style.opacity=`${it}`),this._content&&(this._content.style.pointerEvents=it?"auto":"none")}},Marker:Cx,Style:cp,LngLat:c.aT,LngLatBounds:c.aI,Point:c.P,MercatorCoordinate:c.ae,FreeCameraOptions:Au,Evented:c.E,config:c.e,prewarm:c.f9,clearPrewarmedResources:c.f8,get accessToken(){return c.e.ACCESS_TOKEN},set accessToken(it){c.e.ACCESS_TOKEN=it},get baseApiUrl(){return c.e.API_URL},set baseApiUrl(it){c.e.API_URL=it},get workerCount(){return c.fi.workerCount},set workerCount(it){c.fi.workerCount=it},get maxParallelImageRequests(){return c.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(it){c.e.MAX_PARALLEL_IMAGE_REQUESTS=it},clearStorage(it){c.fh(it)},get workerUrl(){return c.fg.workerUrl},set workerUrl(it){c.fg.workerUrl=it},get workerClass(){return c.fg.workerClass},set workerClass(it){c.fg.workerClass=it},get workerParams(){return c.fg.workerParams},set workerParams(it){c.fg.workerParams=it},get dracoUrl(){return c.ff()},set dracoUrl(it){c.fe(it)},get meshoptUrl(){return c.fd()},set meshoptUrl(it){c.fc(it)},setNow:c.o.setNow,restoreNow:c.o.restoreNow}});var nt=b;return nt})})(mapboxGl);var mapboxGlExports=mapboxGl.exports;const mapboxgl=getDefaultExportFromCjs(mapboxGlExports);function useFranchises(){const[e,i]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[b,et]=reactExports.useState(null);return reactExports.useEffect(()=>{const nt=ref(database,"franchises"),c=onValue(nt,ct=>{try{const pt=ct.val();if(pt){const xt=Object.entries(pt).map(([St,Et])=>({...Et,id:St}));i(xt)}else i([]);a(!1)}catch{et("Failed to fetch franchises"),a(!1)}});return()=>c()},[]),{franchises:e,loading:s,error:b}}function useFranchise(e){const[i,s]=reactExports.useState(null),[a,b]=reactExports.useState(!0),[et,nt]=reactExports.useState(null);return reactExports.useEffect(()=>{if(!e){b(!1);return}const c=ref(database,`franchises/${e}`),ct=onValue(c,pt=>{try{const xt=pt.val();s(xt?{...xt,id:e}:null),b(!1)}catch{nt("Failed to fetch franchise"),b(!1)}});return()=>ct()},[e]),{franchise:i,loading:a,error:et}}function useAllUsersForAdmin(){const[e,i]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[b,et]=reactExports.useState(0),nt=reactExports.useCallback(()=>{et(c=>c+1)},[]);return reactExports.useEffect(()=>{const c=ref(database,"users"),ct=onValue(c,pt=>{const xt=pt.val();if(xt){const St=Object.entries(xt).map(([Et,Rt])=>({...Rt,id:Et}));i(St)}else i([]);a(!1)});return()=>ct()},[b]),{users:e,loading:s,refetch:nt}}async function createFranchise(e){try{const i=ref(database,"franchises"),s=push(i);return await set(s,e),e.adminId&&await update(ref(database,`users/${e.adminId}`),{role:"franchise_admin",franchiseId:s.key}),s.key}catch(i){return console.error("Error creating franchise:",i),null}}async function deleteFranchise(e,i){i&&await update(ref(database,`users/${i}`),{role:"user",franchiseId:null});const s=ref(database,`franchises/${e}`);await remove(s)}async function createFranchiseAdmin(e,i,s,a){try{const b=await createUserWithEmailAndPassword(auth,e,i),et={id:b.user.uid,email:e,name:s,phone:a,role:"franchise_admin",createdAt:Date.now()};return await set(ref(database,`users/${b.user.uid}`),et),b.user.uid}catch(b){throw b.code==="auth/email-already-in-use"?new Error("Email already in use"):b}}function FranchiseZoneLocationPicker({onLocationSelect:e,initialLocation:i,label:s="Kitchen Location",instructions:a="Select location within green zone",fullScreen:b=!1}){var ln;const et=reactExports.useRef(null),nt=reactExports.useRef(null),c=reactExports.useRef(null),[ct,pt]=reactExports.useState(!0),[xt,St]=reactExports.useState(!1),[Et,Rt]=reactExports.useState("Tap on map to select location"),[Nt,It]=reactExports.useState(!1),[Gt,Dt]=reactExports.useState(null),{franchises:Bt,loading:Lt}=useFranchises(),Vt=async(an,Fr)=>{try{const gn=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${Fr},${an}.json?access_token=${MAPBOX_ACCESS_TOKEN}&types=address,place,postcode`)).json();return gn.features&&gn.features.length>0?gn.features[0].place_name:"Unknown location"}catch(rn){return console.error("Geocoding error:",rn),"Unknown location"}},Zt=(an,Fr)=>{for(const rn of Bt)if(rn.zone&&isPointInPolygon({lat:an,lng:Fr},rn.zone))return{isInZone:!0,franchiseId:rn.id};return{isInZone:!1,franchiseId:null}},nr=async an=>{if(!nt.current)return;St(!0);const{isInZone:Fr,franchiseId:rn}=Zt(an.lat,an.lng);It(!Fr),Dt(rn),c.current?c.current.setLngLat([an.lng,an.lat]):(c.current=new mapboxgl.Marker({color:"#f97316",draggable:!0}).setLngLat([an.lng,an.lat]).addTo(nt.current),c.current.on("dragend",async()=>{var xr;const _i=(xr=c.current)==null?void 0:xr.getLngLat();if(_i){St(!0);const{isInZone:gr,franchiseId:rr}=Zt(_i.lat,_i.lng);It(!gr),Dt(rr);const cr=await Vt(_i.lat,_i.lng);Rt(cr),e({lat:_i.lat,lng:_i.lng,address:cr,franchiseId:gr?rr:null}),St(!1)}}));const gn=await Vt(an.lat,an.lng);Rt(gn),e({lat:an.lat,lng:an.lng,address:gn,franchiseId:Fr?rn:null}),St(!1)},ur=()=>{"geolocation"in navigator&&(St(!0),navigator.geolocation.getCurrentPosition(async an=>{const{latitude:Fr,longitude:rn}=an.coords;nt.current&&nt.current.flyTo({center:[rn,Fr],zoom:14,duration:1500}),await nr({lat:Fr,lng:rn})},an=>{console.error("Location error:",an),St(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4}))},_r=()=>{!nt.current||Bt.length===0||Bt.forEach((an,Fr)=>{if(!an.zone||!nt.current)return;const rn=`franchise-zone-${an.id}`,gn=`franchise-zone-fill-${an.id}`,_i=`franchise-zone-line-${an.id}`;nt.current.getLayer(gn)&&nt.current.removeLayer(gn),nt.current.getLayer(_i)&&nt.current.removeLayer(_i),nt.current.getSource(rn)&&nt.current.removeSource(rn),nt.current.addSource(rn,{type:"geojson",data:{type:"Feature",properties:{name:an.name},geometry:an.zone}}),nt.current.addLayer({id:gn,type:"fill",source:rn,paint:{"fill-color":"#22c55e","fill-opacity":.15}}),nt.current.addLayer({id:_i,type:"line",source:rn,paint:{"line-color":"#22c55e","line-width":2,"line-dasharray":[2,2]}})})};reactExports.useEffect(()=>{if(!et.current||Lt)return;mapboxgl.accessToken=MAPBOX_ACCESS_TOKEN;let an=[78.4867,17.385];if(i)an=[i.lng,i.lat];else if(Bt.length>0&&Bt[0].zone){const Fr=getPolygonCenter(Bt[0].zone);Fr&&(an=[Fr.lng,Fr.lat])}return nt.current=new mapboxgl.Map({container:et.current,style:"mapbox://styles/mapbox/streets-v12",center:an,zoom:12,attributionControl:!1}),nt.current.on("load",()=>{pt(!1),_r(),i&&nr({lat:i.lat,lng:i.lng})}),nt.current.on("click",async Fr=>{await nr({lat:Fr.lngLat.lat,lng:Fr.lngLat.lng})}),nt.current.addControl(new mapboxgl.NavigationControl({showCompass:!1}),"bottom-right"),()=>{var Fr;(Fr=nt.current)==null||Fr.remove()}},[Lt,Bt]),reactExports.useEffect(()=>{nt.current&&!ct&&Bt.length>0&&_r()},[Bt,ct]);const Ur=Gt?(ln=Bt.find(an=>an.id===Gt))==null?void 0:ln.name:null;return jsxRuntimeExports.jsxs("div",{className:`flex flex-col ${b?"absolute inset-0":"space-y-3 h-full"}`,children:[jsxRuntimeExports.jsxs("div",{className:`relative overflow-hidden ${b?"flex-1 w-full h-full":"rounded-xl flex-1 min-h-[435px]"}`,children:[jsxRuntimeExports.jsx("div",{ref:et,className:"absolute inset-0",style:{marginBottom:"-30px",height:"calc(100% + 30px)"}}),(ct||Lt)&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-secondary flex items-center justify-center z-10",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-6 h-6 animate-spin text-primary"})}),jsxRuntimeExports.jsx(Button,{size:"icon",variant:"secondary",className:`absolute right-3 rounded-full shadow-md z-10 ${b?"top-safe-offset":"top-3"}`,style:{top:b?"1rem":void 0},onClick:ur,children:jsxRuntimeExports.jsx(Navigation,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("div",{className:`absolute left-3 bg-card/90 backdrop-blur-sm rounded-lg px-3 py-1.5 z-10 ${b?"top-safe-offset":"top-3"}`,style:{top:b?"1rem":void 0},children:jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:a})}),!b&&jsxRuntimeExports.jsxs("div",{className:"absolute bottom-3 left-3 bg-card/90 backdrop-blur-sm rounded-lg px-3 py-1.5 flex items-center gap-2 z-10",children:[jsxRuntimeExports.jsx("div",{className:"w-3 h-3 rounded-sm bg-green-500/30 border border-green-500"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Service Area"})]})]}),jsxRuntimeExports.jsxs("div",{className:`${b?"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-background/80 to-transparent pt-12":"space-y-3"}`,children:[Nt&&jsxRuntimeExports.jsxs("div",{className:`bg-destructive/10 border border-destructive/20 p-3 flex items-start gap-3 ${b?"rounded-xl mb-3 bg-background/95 backdrop-blur-sm":"rounded-xl"}`,children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-5 h-5 text-destructive flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-destructive",children:"Outside Service Area"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Please select a location within the green zone."})]})]}),jsxRuntimeExports.jsxs("div",{className:`p-3 flex items-start gap-3 ${b?"rounded-xl bg-background/95 backdrop-blur-sm shadow-sm border border-border/50":`rounded-xl ${Nt?"bg-muted":"bg-secondary"}`}`,children:[jsxRuntimeExports.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${Nt?"bg-muted-foreground/10":"bg-primary/10"}`,children:xt?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 text-primary animate-spin"}):jsxRuntimeExports.jsx(MapPin,{className:`w-4 h-4 ${Nt?"text-muted-foreground":"text-primary"}`})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:s}),jsxRuntimeExports.jsx("p",{className:`text-sm font-medium line-clamp-2 ${Nt?"text-muted-foreground":"text-foreground"}`,children:xt?"Finding address...":Et}),Ur&&!Nt&&jsxRuntimeExports.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[" ",Ur," zone"]})]})]})]})]})}function RegisterKitchen(){const{user:e}=useAuth(),i=useNavigate(),[s,a]=reactExports.useState(!1),[b,et]=reactExports.useState(null),[nt,c]=reactExports.useState(null),[ct,pt]=reactExports.useState(null),[xt,St]=reactExports.useState({name:"",description:"",specialties:"",cookingTime:"20-30 mins",isVeg:!0,address:{line1:"",line2:"",city:"",pincode:"",lat:0,lng:0}}),Et=Nt=>{var Gt;const It=(Gt=Nt.target.files)==null?void 0:Gt[0];if(It){et(It);const Dt=new FileReader;Dt.onloadend=()=>{c(Dt.result)},Dt.readAsDataURL(It)}},Rt=async Nt=>{if(Nt.preventDefault(),!e){ue.error("Please login first");return}if(!xt.name||!xt.address.line1||!ct){ue.error("Please fill in all required fields and select location within service area");return}a(!0);try{let It="https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=400";if(b){const Gt=await uploadToImgBB(b);Gt&&(It=Gt.display_url)}await createKitchen({ownerId:e.id,franchiseId:ct,name:xt.name,description:xt.description,image:It,coverImage:It,address:xt.address,rating:0,totalRatings:0,isOpen:!1,specialties:xt.specialties.split(",").map(Gt=>Gt.trim()).filter(Boolean),cookingTime:xt.cookingTime,isVeg:xt.isVeg,isApproved:!1,createdAt:Date.now()}),ue.success("Kitchen registered! Waiting for admin approval."),i("/amma/dashboard")}catch(It){console.error("Registration failed:",It),ue.error("Failed to register kitchen")}finally{a(!1)}};return!e||e.role!=="amma"?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"You need to be registered as an Amma"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Login as Amma"})})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[jsxRuntimeExports.jsx(Link,{to:"/amma/dashboard",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})})}),jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Register Kitchen"})]})}),jsxRuntimeExports.jsxs("form",{onSubmit:Rt,className:"px-4 py-6 space-y-6",children:[jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsxs("label",{className:"cursor-pointer",children:[jsxRuntimeExports.jsx("div",{className:"w-32 h-32 rounded-2xl bg-secondary flex items-center justify-center overflow-hidden",children:nt?jsxRuntimeExports.jsx("img",{src:nt,alt:"Preview",className:"w-full h-full object-cover"}):jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(Camera,{className:"w-8 h-8 text-muted-foreground mx-auto mb-1"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Add Photo"})]})}),jsxRuntimeExports.jsx("input",{type:"file",accept:"image/*",onChange:Et,className:"hidden"})]})}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Kitchen Name *"}),jsxRuntimeExports.jsx(Input,{placeholder:"e.g., Lakshmi Amma's Kitchen",value:xt.name,onChange:Nt=>St({...xt,name:Nt.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Description"}),jsxRuntimeExports.jsx(Textarea,{placeholder:"Tell customers about your kitchen and cooking style...",value:xt.description,onChange:Nt=>St({...xt,description:Nt.target.value}),className:"bg-secondary border-0 mt-1 resize-none",rows:3})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Specialties (comma separated)"}),jsxRuntimeExports.jsx(Input,{placeholder:"e.g., Biryani, Andhra Meals, Pickles",value:xt.specialties,onChange:Nt=>St({...xt,specialties:Nt.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Cooking Time"}),jsxRuntimeExports.jsx(Input,{placeholder:"e.g., 20-30 mins",value:xt.cookingTime,onChange:Nt=>St({...xt,cookingTime:Nt.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between bg-secondary rounded-xl p-4",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"veg-switch",children:"Pure Vegetarian Kitchen"}),jsxRuntimeExports.jsx(Switch,{id:"veg-switch",checked:xt.isVeg,onCheckedChange:Nt=>St({...xt,isVeg:Nt})})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-foreground flex items-center gap-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4"})," Kitchen Location"]}),jsxRuntimeExports.jsx(FranchiseZoneLocationPicker,{onLocationSelect:Nt=>{var Dt;pt(Nt.franchiseId);const It=Nt.address.split(","),Gt=It.length>1?(Dt=It[It.length-2])==null?void 0:Dt.trim():"";St({...xt,address:{...xt.address,line1:Nt.address,city:Gt||xt.address.city,lat:Nt.lat,lng:Nt.lng}})}}),jsxRuntimeExports.jsx(Input,{placeholder:"Additional address details (optional)",value:xt.address.line2,onChange:Nt=>St({...xt,address:{...xt.address,line2:Nt.target.value}}),className:"bg-secondary border-0"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(Input,{placeholder:"City",value:xt.address.city,onChange:Nt=>St({...xt,address:{...xt.address,city:Nt.target.value}}),className:"bg-secondary border-0"}),jsxRuntimeExports.jsx(Input,{placeholder:"Pincode",value:xt.address.pincode,onChange:Nt=>St({...xt,address:{...xt.address,pincode:Nt.target.value}}),className:"bg-secondary border-0"})]})]}),jsxRuntimeExports.jsx(Button,{type:"submit",disabled:s,className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl",children:s?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin"}),jsxRuntimeExports.jsx("span",{children:"Registering..."})]}):"Register Kitchen"})]})]})}function clamp(e,[i,s]){return Math.min(s,Math.max(i,e))}var OPEN_KEYS=[" ","Enter","ArrowUp","ArrowDown"],SELECTION_KEYS=[" ","Enter"],SELECT_NAME="Select",[Collection,useCollection,createCollectionScope]=createCollection(SELECT_NAME),[createSelectContext,createSelectScope]=createContextScope(SELECT_NAME,[createCollectionScope,createPopperScope]),usePopperScope=createPopperScope(),[SelectProvider,useSelectContext]=createSelectContext(SELECT_NAME),[SelectNativeOptionsProvider,useSelectNativeOptionsContext]=createSelectContext(SELECT_NAME),Select$1=e=>{const{__scopeSelect:i,children:s,open:a,defaultOpen:b,onOpenChange:et,value:nt,defaultValue:c,onValueChange:ct,dir:pt,name:xt,autoComplete:St,disabled:Et,required:Rt,form:Nt}=e,It=usePopperScope(i),[Gt,Dt]=reactExports.useState(null),[Bt,Lt]=reactExports.useState(null),[Vt,Zt]=reactExports.useState(!1),nr=useDirection(pt),[ur,_r]=useControllableState({prop:a,defaultProp:b??!1,onChange:et,caller:SELECT_NAME}),[Ur,ln]=useControllableState({prop:nt,defaultProp:c,onChange:ct,caller:SELECT_NAME}),an=reactExports.useRef(null),Fr=Gt?Nt||!!Gt.closest("form"):!0,[rn,gn]=reactExports.useState(new Set),_i=Array.from(rn).map(xr=>xr.props.value).join(";");return jsxRuntimeExports.jsx(Root2$3,{...It,children:jsxRuntimeExports.jsxs(SelectProvider,{required:Rt,scope:i,trigger:Gt,onTriggerChange:Dt,valueNode:Bt,onValueNodeChange:Lt,valueNodeHasChildren:Vt,onValueNodeHasChildrenChange:Zt,contentId:useId(),value:Ur,onValueChange:ln,open:ur,onOpenChange:_r,dir:nr,triggerPointerDownPosRef:an,disabled:Et,children:[jsxRuntimeExports.jsx(Collection.Provider,{scope:i,children:jsxRuntimeExports.jsx(SelectNativeOptionsProvider,{scope:e.__scopeSelect,onNativeOptionAdd:reactExports.useCallback(xr=>{gn(gr=>new Set(gr).add(xr))},[]),onNativeOptionRemove:reactExports.useCallback(xr=>{gn(gr=>{const rr=new Set(gr);return rr.delete(xr),rr})},[]),children:s})}),Fr?jsxRuntimeExports.jsxs(SelectBubbleInput,{"aria-hidden":!0,required:Rt,tabIndex:-1,name:xt,autoComplete:St,value:Ur,onChange:xr=>ln(xr.target.value),disabled:Et,form:Nt,children:[Ur===void 0?jsxRuntimeExports.jsx("option",{value:""}):null,Array.from(rn)]},_i):null]})})};Select$1.displayName=SELECT_NAME;var TRIGGER_NAME="SelectTrigger",SelectTrigger$1=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,disabled:a=!1,...b}=e,et=usePopperScope(s),nt=useSelectContext(TRIGGER_NAME,s),c=nt.disabled||a,ct=useComposedRefs$1(i,nt.onTriggerChange),pt=useCollection(s),xt=reactExports.useRef("touch"),[St,Et,Rt]=useTypeaheadSearch(It=>{const Gt=pt().filter(Lt=>!Lt.disabled),Dt=Gt.find(Lt=>Lt.value===nt.value),Bt=findNextItem(Gt,It,Dt);Bt!==void 0&&nt.onValueChange(Bt.value)}),Nt=It=>{c||(nt.onOpenChange(!0),Rt()),It&&(nt.triggerPointerDownPosRef.current={x:Math.round(It.pageX),y:Math.round(It.pageY)})};return jsxRuntimeExports.jsx(Anchor,{asChild:!0,...et,children:jsxRuntimeExports.jsx(Primitive.button,{type:"button",role:"combobox","aria-controls":nt.contentId,"aria-expanded":nt.open,"aria-required":nt.required,"aria-autocomplete":"none",dir:nt.dir,"data-state":nt.open?"open":"closed",disabled:c,"data-disabled":c?"":void 0,"data-placeholder":shouldShowPlaceholder(nt.value)?"":void 0,...b,ref:ct,onClick:composeEventHandlers(b.onClick,It=>{It.currentTarget.focus(),xt.current!=="mouse"&&Nt(It)}),onPointerDown:composeEventHandlers(b.onPointerDown,It=>{xt.current=It.pointerType;const Gt=It.target;Gt.hasPointerCapture(It.pointerId)&&Gt.releasePointerCapture(It.pointerId),It.button===0&&It.ctrlKey===!1&&It.pointerType==="mouse"&&(Nt(It),It.preventDefault())}),onKeyDown:composeEventHandlers(b.onKeyDown,It=>{const Gt=St.current!=="";!(It.ctrlKey||It.altKey||It.metaKey)&&It.key.length===1&&Et(It.key),!(Gt&&It.key===" ")&&OPEN_KEYS.includes(It.key)&&(Nt(),It.preventDefault())})})})});SelectTrigger$1.displayName=TRIGGER_NAME;var VALUE_NAME="SelectValue",SelectValue$1=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,className:a,style:b,children:et,placeholder:nt="",...c}=e,ct=useSelectContext(VALUE_NAME,s),{onValueNodeHasChildrenChange:pt}=ct,xt=et!==void 0,St=useComposedRefs$1(i,ct.onValueNodeChange);return useLayoutEffect2(()=>{pt(xt)},[pt,xt]),jsxRuntimeExports.jsx(Primitive.span,{...c,ref:St,style:{pointerEvents:"none"},children:shouldShowPlaceholder(ct.value)?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:nt}):et})});SelectValue$1.displayName=VALUE_NAME;var ICON_NAME="SelectIcon",SelectIcon=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,children:a,...b}=e;return jsxRuntimeExports.jsx(Primitive.span,{"aria-hidden":!0,...b,ref:i,children:a||""})});SelectIcon.displayName=ICON_NAME;var PORTAL_NAME="SelectPortal",SelectPortal=e=>jsxRuntimeExports.jsx(Portal$2,{asChild:!0,...e});SelectPortal.displayName=PORTAL_NAME;var CONTENT_NAME="SelectContent",SelectContent$1=reactExports.forwardRef((e,i)=>{const s=useSelectContext(CONTENT_NAME,e.__scopeSelect),[a,b]=reactExports.useState();if(useLayoutEffect2(()=>{b(new DocumentFragment)},[]),!s.open){const et=a;return et?reactDomExports.createPortal(jsxRuntimeExports.jsx(SelectContentProvider,{scope:e.__scopeSelect,children:jsxRuntimeExports.jsx(Collection.Slot,{scope:e.__scopeSelect,children:jsxRuntimeExports.jsx("div",{children:e.children})})}),et):null}return jsxRuntimeExports.jsx(SelectContentImpl,{...e,ref:i})});SelectContent$1.displayName=CONTENT_NAME;var CONTENT_MARGIN=10,[SelectContentProvider,useSelectContentContext]=createSelectContext(CONTENT_NAME),CONTENT_IMPL_NAME="SelectContentImpl",Slot=createSlot("SelectContent.RemoveScroll"),SelectContentImpl=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,position:a="item-aligned",onCloseAutoFocus:b,onEscapeKeyDown:et,onPointerDownOutside:nt,side:c,sideOffset:ct,align:pt,alignOffset:xt,arrowPadding:St,collisionBoundary:Et,collisionPadding:Rt,sticky:Nt,hideWhenDetached:It,avoidCollisions:Gt,...Dt}=e,Bt=useSelectContext(CONTENT_NAME,s),[Lt,Vt]=reactExports.useState(null),[Zt,nr]=reactExports.useState(null),ur=useComposedRefs$1(i,ns=>Vt(ns)),[_r,Ur]=reactExports.useState(null),[ln,an]=reactExports.useState(null),Fr=useCollection(s),[rn,gn]=reactExports.useState(!1),_i=reactExports.useRef(!1);reactExports.useEffect(()=>{if(Lt)return hideOthers(Lt)},[Lt]),useFocusGuards();const xr=reactExports.useCallback(ns=>{const[Nn,...ls]=Fr().map(Ks=>Ks.ref.current),[ms]=ls.slice(-1),Ss=document.activeElement;for(const Ks of ns)if(Ks===Ss||(Ks==null||Ks.scrollIntoView({block:"nearest"}),Ks===Nn&&Zt&&(Zt.scrollTop=0),Ks===ms&&Zt&&(Zt.scrollTop=Zt.scrollHeight),Ks==null||Ks.focus(),document.activeElement!==Ss))return},[Fr,Zt]),gr=reactExports.useCallback(()=>xr([_r,Lt]),[xr,_r,Lt]);reactExports.useEffect(()=>{rn&&gr()},[rn,gr]);const{onOpenChange:rr,triggerPointerDownPosRef:cr}=Bt;reactExports.useEffect(()=>{if(Lt){let ns={x:0,y:0};const Nn=ms=>{var Ss,Ks;ns={x:Math.abs(Math.round(ms.pageX)-(((Ss=cr.current)==null?void 0:Ss.x)??0)),y:Math.abs(Math.round(ms.pageY)-(((Ks=cr.current)==null?void 0:Ks.y)??0))}},ls=ms=>{ns.x<=10&&ns.y<=10?ms.preventDefault():Lt.contains(ms.target)||rr(!1),document.removeEventListener("pointermove",Nn),cr.current=null};return cr.current!==null&&(document.addEventListener("pointermove",Nn),document.addEventListener("pointerup",ls,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Nn),document.removeEventListener("pointerup",ls,{capture:!0})}}},[Lt,rr,cr]),reactExports.useEffect(()=>{const ns=()=>rr(!1);return window.addEventListener("blur",ns),window.addEventListener("resize",ns),()=>{window.removeEventListener("blur",ns),window.removeEventListener("resize",ns)}},[rr]);const[Hr,$r]=useTypeaheadSearch(ns=>{const Nn=Fr().filter(Ss=>!Ss.disabled),ls=Nn.find(Ss=>Ss.ref.current===document.activeElement),ms=findNextItem(Nn,ns,ls);ms&&setTimeout(()=>ms.ref.current.focus())}),_n=reactExports.useCallback((ns,Nn,ls)=>{const ms=!_i.current&&!ls;(Bt.value!==void 0&&Bt.value===Nn||ms)&&(Ur(ns),ms&&(_i.current=!0))},[Bt.value]),fn=reactExports.useCallback(()=>Lt==null?void 0:Lt.focus(),[Lt]),jn=reactExports.useCallback((ns,Nn,ls)=>{const ms=!_i.current&&!ls;(Bt.value!==void 0&&Bt.value===Nn||ms)&&an(ns)},[Bt.value]),vs=a==="popper"?SelectPopperPosition:SelectItemAlignedPosition,Cs=vs===SelectPopperPosition?{side:c,sideOffset:ct,align:pt,alignOffset:xt,arrowPadding:St,collisionBoundary:Et,collisionPadding:Rt,sticky:Nt,hideWhenDetached:It,avoidCollisions:Gt}:{};return jsxRuntimeExports.jsx(SelectContentProvider,{scope:s,content:Lt,viewport:Zt,onViewportChange:nr,itemRefCallback:_n,selectedItem:_r,onItemLeave:fn,itemTextRefCallback:jn,focusSelectedItem:gr,selectedItemText:ln,position:a,isPositioned:rn,searchRef:Hr,children:jsxRuntimeExports.jsx(ReactRemoveScroll,{as:Slot,allowPinchZoom:!0,children:jsxRuntimeExports.jsx(FocusScope,{asChild:!0,trapped:Bt.open,onMountAutoFocus:ns=>{ns.preventDefault()},onUnmountAutoFocus:composeEventHandlers(b,ns=>{var Nn;(Nn=Bt.trigger)==null||Nn.focus({preventScroll:!0}),ns.preventDefault()}),children:jsxRuntimeExports.jsx(DismissableLayer,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:et,onPointerDownOutside:nt,onFocusOutside:ns=>ns.preventDefault(),onDismiss:()=>Bt.onOpenChange(!1),children:jsxRuntimeExports.jsx(vs,{role:"listbox",id:Bt.contentId,"data-state":Bt.open?"open":"closed",dir:Bt.dir,onContextMenu:ns=>ns.preventDefault(),...Dt,...Cs,onPlaced:()=>gn(!0),ref:ur,style:{display:"flex",flexDirection:"column",outline:"none",...Dt.style},onKeyDown:composeEventHandlers(Dt.onKeyDown,ns=>{const Nn=ns.ctrlKey||ns.altKey||ns.metaKey;if(ns.key==="Tab"&&ns.preventDefault(),!Nn&&ns.key.length===1&&$r(ns.key),["ArrowUp","ArrowDown","Home","End"].includes(ns.key)){let ms=Fr().filter(Ss=>!Ss.disabled).map(Ss=>Ss.ref.current);if(["ArrowUp","End"].includes(ns.key)&&(ms=ms.slice().reverse()),["ArrowUp","ArrowDown"].includes(ns.key)){const Ss=ns.target,Ks=ms.indexOf(Ss);ms=ms.slice(Ks+1)}setTimeout(()=>xr(ms)),ns.preventDefault()}})})})})})})});SelectContentImpl.displayName=CONTENT_IMPL_NAME;var ITEM_ALIGNED_POSITION_NAME="SelectItemAlignedPosition",SelectItemAlignedPosition=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,onPlaced:a,...b}=e,et=useSelectContext(CONTENT_NAME,s),nt=useSelectContentContext(CONTENT_NAME,s),[c,ct]=reactExports.useState(null),[pt,xt]=reactExports.useState(null),St=useComposedRefs$1(i,ur=>xt(ur)),Et=useCollection(s),Rt=reactExports.useRef(!1),Nt=reactExports.useRef(!0),{viewport:It,selectedItem:Gt,selectedItemText:Dt,focusSelectedItem:Bt}=nt,Lt=reactExports.useCallback(()=>{if(et.trigger&&et.valueNode&&c&&pt&&It&&Gt&&Dt){const ur=et.trigger.getBoundingClientRect(),_r=pt.getBoundingClientRect(),Ur=et.valueNode.getBoundingClientRect(),ln=Dt.getBoundingClientRect();if(et.dir!=="rtl"){const Ss=ln.left-_r.left,Ks=Ur.left-Ss,ws=ur.left-Ks,ps=ur.width+ws,Rl=Math.max(ps,_r.width),Qo=window.innerWidth-CONTENT_MARGIN,Vo=clamp(Ks,[CONTENT_MARGIN,Math.max(CONTENT_MARGIN,Qo-Rl)]);c.style.minWidth=ps+"px",c.style.left=Vo+"px"}else{const Ss=_r.right-ln.right,Ks=window.innerWidth-Ur.right-Ss,ws=window.innerWidth-ur.right-Ks,ps=ur.width+ws,Rl=Math.max(ps,_r.width),Qo=window.innerWidth-CONTENT_MARGIN,Vo=clamp(Ks,[CONTENT_MARGIN,Math.max(CONTENT_MARGIN,Qo-Rl)]);c.style.minWidth=ps+"px",c.style.right=Vo+"px"}const an=Et(),Fr=window.innerHeight-CONTENT_MARGIN*2,rn=It.scrollHeight,gn=window.getComputedStyle(pt),_i=parseInt(gn.borderTopWidth,10),xr=parseInt(gn.paddingTop,10),gr=parseInt(gn.borderBottomWidth,10),rr=parseInt(gn.paddingBottom,10),cr=_i+xr+rn+rr+gr,Hr=Math.min(Gt.offsetHeight*5,cr),$r=window.getComputedStyle(It),_n=parseInt($r.paddingTop,10),fn=parseInt($r.paddingBottom,10),jn=ur.top+ur.height/2-CONTENT_MARGIN,vs=Fr-jn,Cs=Gt.offsetHeight/2,ns=Gt.offsetTop+Cs,Nn=_i+xr+ns,ls=cr-Nn;if(Nn<=jn){const Ss=an.length>0&&Gt===an[an.length-1].ref.current;c.style.bottom="0px";const Ks=pt.clientHeight-It.offsetTop-It.offsetHeight,ws=Math.max(vs,Cs+(Ss?fn:0)+Ks+gr),ps=Nn+ws;c.style.height=ps+"px"}else{const Ss=an.length>0&&Gt===an[0].ref.current;c.style.top="0px";const ws=Math.max(jn,_i+It.offsetTop+(Ss?_n:0)+Cs)+ls;c.style.height=ws+"px",It.scrollTop=Nn-jn+It.offsetTop}c.style.margin=`${CONTENT_MARGIN}px 0`,c.style.minHeight=Hr+"px",c.style.maxHeight=Fr+"px",a==null||a(),requestAnimationFrame(()=>Rt.current=!0)}},[Et,et.trigger,et.valueNode,c,pt,It,Gt,Dt,et.dir,a]);useLayoutEffect2(()=>Lt(),[Lt]);const[Vt,Zt]=reactExports.useState();useLayoutEffect2(()=>{pt&&Zt(window.getComputedStyle(pt).zIndex)},[pt]);const nr=reactExports.useCallback(ur=>{ur&&Nt.current===!0&&(Lt(),Bt==null||Bt(),Nt.current=!1)},[Lt,Bt]);return jsxRuntimeExports.jsx(SelectViewportProvider,{scope:s,contentWrapper:c,shouldExpandOnScrollRef:Rt,onScrollButtonChange:nr,children:jsxRuntimeExports.jsx("div",{ref:ct,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:Vt},children:jsxRuntimeExports.jsx(Primitive.div,{...b,ref:St,style:{boxSizing:"border-box",maxHeight:"100%",...b.style}})})})});SelectItemAlignedPosition.displayName=ITEM_ALIGNED_POSITION_NAME;var POPPER_POSITION_NAME="SelectPopperPosition",SelectPopperPosition=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,align:a="start",collisionPadding:b=CONTENT_MARGIN,...et}=e,nt=usePopperScope(s);return jsxRuntimeExports.jsx(Content$2,{...nt,...et,ref:i,align:a,collisionPadding:b,style:{boxSizing:"border-box",...et.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});SelectPopperPosition.displayName=POPPER_POSITION_NAME;var[SelectViewportProvider,useSelectViewportContext]=createSelectContext(CONTENT_NAME,{}),VIEWPORT_NAME="SelectViewport",SelectViewport=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,nonce:a,...b}=e,et=useSelectContentContext(VIEWPORT_NAME,s),nt=useSelectViewportContext(VIEWPORT_NAME,s),c=useComposedRefs$1(i,et.onViewportChange),ct=reactExports.useRef(0);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),jsxRuntimeExports.jsx(Collection.Slot,{scope:s,children:jsxRuntimeExports.jsx(Primitive.div,{"data-radix-select-viewport":"",role:"presentation",...b,ref:c,style:{position:"relative",flex:1,overflow:"hidden auto",...b.style},onScroll:composeEventHandlers(b.onScroll,pt=>{const xt=pt.currentTarget,{contentWrapper:St,shouldExpandOnScrollRef:Et}=nt;if(Et!=null&&Et.current&&St){const Rt=Math.abs(ct.current-xt.scrollTop);if(Rt>0){const Nt=window.innerHeight-CONTENT_MARGIN*2,It=parseFloat(St.style.minHeight),Gt=parseFloat(St.style.height),Dt=Math.max(It,Gt);if(Dt<Nt){const Bt=Dt+Rt,Lt=Math.min(Nt,Bt),Vt=Bt-Lt;St.style.height=Lt+"px",St.style.bottom==="0px"&&(xt.scrollTop=Vt>0?Vt:0,St.style.justifyContent="flex-end")}}}ct.current=xt.scrollTop})})})]})});SelectViewport.displayName=VIEWPORT_NAME;var GROUP_NAME="SelectGroup",[SelectGroupContextProvider,useSelectGroupContext]=createSelectContext(GROUP_NAME),SelectGroup=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,...a}=e,b=useId();return jsxRuntimeExports.jsx(SelectGroupContextProvider,{scope:s,id:b,children:jsxRuntimeExports.jsx(Primitive.div,{role:"group","aria-labelledby":b,...a,ref:i})})});SelectGroup.displayName=GROUP_NAME;var LABEL_NAME="SelectLabel",SelectLabel$1=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,...a}=e,b=useSelectGroupContext(LABEL_NAME,s);return jsxRuntimeExports.jsx(Primitive.div,{id:b.id,...a,ref:i})});SelectLabel$1.displayName=LABEL_NAME;var ITEM_NAME="SelectItem",[SelectItemContextProvider,useSelectItemContext]=createSelectContext(ITEM_NAME),SelectItem$1=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,value:a,disabled:b=!1,textValue:et,...nt}=e,c=useSelectContext(ITEM_NAME,s),ct=useSelectContentContext(ITEM_NAME,s),pt=c.value===a,[xt,St]=reactExports.useState(et??""),[Et,Rt]=reactExports.useState(!1),Nt=useComposedRefs$1(i,Bt=>{var Lt;return(Lt=ct.itemRefCallback)==null?void 0:Lt.call(ct,Bt,a,b)}),It=useId(),Gt=reactExports.useRef("touch"),Dt=()=>{b||(c.onValueChange(a),c.onOpenChange(!1))};if(a==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return jsxRuntimeExports.jsx(SelectItemContextProvider,{scope:s,value:a,disabled:b,textId:It,isSelected:pt,onItemTextChange:reactExports.useCallback(Bt=>{St(Lt=>Lt||((Bt==null?void 0:Bt.textContent)??"").trim())},[]),children:jsxRuntimeExports.jsx(Collection.ItemSlot,{scope:s,value:a,disabled:b,textValue:xt,children:jsxRuntimeExports.jsx(Primitive.div,{role:"option","aria-labelledby":It,"data-highlighted":Et?"":void 0,"aria-selected":pt&&Et,"data-state":pt?"checked":"unchecked","aria-disabled":b||void 0,"data-disabled":b?"":void 0,tabIndex:b?void 0:-1,...nt,ref:Nt,onFocus:composeEventHandlers(nt.onFocus,()=>Rt(!0)),onBlur:composeEventHandlers(nt.onBlur,()=>Rt(!1)),onClick:composeEventHandlers(nt.onClick,()=>{Gt.current!=="mouse"&&Dt()}),onPointerUp:composeEventHandlers(nt.onPointerUp,()=>{Gt.current==="mouse"&&Dt()}),onPointerDown:composeEventHandlers(nt.onPointerDown,Bt=>{Gt.current=Bt.pointerType}),onPointerMove:composeEventHandlers(nt.onPointerMove,Bt=>{var Lt;Gt.current=Bt.pointerType,b?(Lt=ct.onItemLeave)==null||Lt.call(ct):Gt.current==="mouse"&&Bt.currentTarget.focus({preventScroll:!0})}),onPointerLeave:composeEventHandlers(nt.onPointerLeave,Bt=>{var Lt;Bt.currentTarget===document.activeElement&&((Lt=ct.onItemLeave)==null||Lt.call(ct))}),onKeyDown:composeEventHandlers(nt.onKeyDown,Bt=>{var Vt;((Vt=ct.searchRef)==null?void 0:Vt.current)!==""&&Bt.key===" "||(SELECTION_KEYS.includes(Bt.key)&&Dt(),Bt.key===" "&&Bt.preventDefault())})})})})});SelectItem$1.displayName=ITEM_NAME;var ITEM_TEXT_NAME="SelectItemText",SelectItemText=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,className:a,style:b,...et}=e,nt=useSelectContext(ITEM_TEXT_NAME,s),c=useSelectContentContext(ITEM_TEXT_NAME,s),ct=useSelectItemContext(ITEM_TEXT_NAME,s),pt=useSelectNativeOptionsContext(ITEM_TEXT_NAME,s),[xt,St]=reactExports.useState(null),Et=useComposedRefs$1(i,Dt=>St(Dt),ct.onItemTextChange,Dt=>{var Bt;return(Bt=c.itemTextRefCallback)==null?void 0:Bt.call(c,Dt,ct.value,ct.disabled)}),Rt=xt==null?void 0:xt.textContent,Nt=reactExports.useMemo(()=>jsxRuntimeExports.jsx("option",{value:ct.value,disabled:ct.disabled,children:Rt},ct.value),[ct.disabled,ct.value,Rt]),{onNativeOptionAdd:It,onNativeOptionRemove:Gt}=pt;return useLayoutEffect2(()=>(It(Nt),()=>Gt(Nt)),[It,Gt,Nt]),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Primitive.span,{id:ct.textId,...et,ref:Et}),ct.isSelected&&nt.valueNode&&!nt.valueNodeHasChildren?reactDomExports.createPortal(et.children,nt.valueNode):null]})});SelectItemText.displayName=ITEM_TEXT_NAME;var ITEM_INDICATOR_NAME="SelectItemIndicator",SelectItemIndicator=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,...a}=e;return useSelectItemContext(ITEM_INDICATOR_NAME,s).isSelected?jsxRuntimeExports.jsx(Primitive.span,{"aria-hidden":!0,...a,ref:i}):null});SelectItemIndicator.displayName=ITEM_INDICATOR_NAME;var SCROLL_UP_BUTTON_NAME="SelectScrollUpButton",SelectScrollUpButton$1=reactExports.forwardRef((e,i)=>{const s=useSelectContentContext(SCROLL_UP_BUTTON_NAME,e.__scopeSelect),a=useSelectViewportContext(SCROLL_UP_BUTTON_NAME,e.__scopeSelect),[b,et]=reactExports.useState(!1),nt=useComposedRefs$1(i,a.onScrollButtonChange);return useLayoutEffect2(()=>{if(s.viewport&&s.isPositioned){let c=function(){const pt=ct.scrollTop>0;et(pt)};const ct=s.viewport;return c(),ct.addEventListener("scroll",c),()=>ct.removeEventListener("scroll",c)}},[s.viewport,s.isPositioned]),b?jsxRuntimeExports.jsx(SelectScrollButtonImpl,{...e,ref:nt,onAutoScroll:()=>{const{viewport:c,selectedItem:ct}=s;c&&ct&&(c.scrollTop=c.scrollTop-ct.offsetHeight)}}):null});SelectScrollUpButton$1.displayName=SCROLL_UP_BUTTON_NAME;var SCROLL_DOWN_BUTTON_NAME="SelectScrollDownButton",SelectScrollDownButton$1=reactExports.forwardRef((e,i)=>{const s=useSelectContentContext(SCROLL_DOWN_BUTTON_NAME,e.__scopeSelect),a=useSelectViewportContext(SCROLL_DOWN_BUTTON_NAME,e.__scopeSelect),[b,et]=reactExports.useState(!1),nt=useComposedRefs$1(i,a.onScrollButtonChange);return useLayoutEffect2(()=>{if(s.viewport&&s.isPositioned){let c=function(){const pt=ct.scrollHeight-ct.clientHeight,xt=Math.ceil(ct.scrollTop)<pt;et(xt)};const ct=s.viewport;return c(),ct.addEventListener("scroll",c),()=>ct.removeEventListener("scroll",c)}},[s.viewport,s.isPositioned]),b?jsxRuntimeExports.jsx(SelectScrollButtonImpl,{...e,ref:nt,onAutoScroll:()=>{const{viewport:c,selectedItem:ct}=s;c&&ct&&(c.scrollTop=c.scrollTop+ct.offsetHeight)}}):null});SelectScrollDownButton$1.displayName=SCROLL_DOWN_BUTTON_NAME;var SelectScrollButtonImpl=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,onAutoScroll:a,...b}=e,et=useSelectContentContext("SelectScrollButton",s),nt=reactExports.useRef(null),c=useCollection(s),ct=reactExports.useCallback(()=>{nt.current!==null&&(window.clearInterval(nt.current),nt.current=null)},[]);return reactExports.useEffect(()=>()=>ct(),[ct]),useLayoutEffect2(()=>{var xt;const pt=c().find(St=>St.ref.current===document.activeElement);(xt=pt==null?void 0:pt.ref.current)==null||xt.scrollIntoView({block:"nearest"})},[c]),jsxRuntimeExports.jsx(Primitive.div,{"aria-hidden":!0,...b,ref:i,style:{flexShrink:0,...b.style},onPointerDown:composeEventHandlers(b.onPointerDown,()=>{nt.current===null&&(nt.current=window.setInterval(a,50))}),onPointerMove:composeEventHandlers(b.onPointerMove,()=>{var pt;(pt=et.onItemLeave)==null||pt.call(et),nt.current===null&&(nt.current=window.setInterval(a,50))}),onPointerLeave:composeEventHandlers(b.onPointerLeave,()=>{ct()})})}),SEPARATOR_NAME="SelectSeparator",SelectSeparator$1=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,...a}=e;return jsxRuntimeExports.jsx(Primitive.div,{"aria-hidden":!0,...a,ref:i})});SelectSeparator$1.displayName=SEPARATOR_NAME;var ARROW_NAME="SelectArrow",SelectArrow=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,...a}=e,b=usePopperScope(s),et=useSelectContext(ARROW_NAME,s),nt=useSelectContentContext(ARROW_NAME,s);return et.open&&nt.position==="popper"?jsxRuntimeExports.jsx(Arrow,{...b,...a,ref:i}):null});SelectArrow.displayName=ARROW_NAME;var BUBBLE_INPUT_NAME="SelectBubbleInput",SelectBubbleInput=reactExports.forwardRef(({__scopeSelect:e,value:i,...s},a)=>{const b=reactExports.useRef(null),et=useComposedRefs$1(a,b),nt=usePrevious(i);return reactExports.useEffect(()=>{const c=b.current;if(!c)return;const ct=window.HTMLSelectElement.prototype,xt=Object.getOwnPropertyDescriptor(ct,"value").set;if(nt!==i&&xt){const St=new Event("change",{bubbles:!0});xt.call(c,i),c.dispatchEvent(St)}},[nt,i]),jsxRuntimeExports.jsx(Primitive.select,{...s,style:{...VISUALLY_HIDDEN_STYLES,...s.style},ref:et,defaultValue:i})});SelectBubbleInput.displayName=BUBBLE_INPUT_NAME;function shouldShowPlaceholder(e){return e===""||e===void 0}function useTypeaheadSearch(e){const i=useCallbackRef$1(e),s=reactExports.useRef(""),a=reactExports.useRef(0),b=reactExports.useCallback(nt=>{const c=s.current+nt;i(c),function ct(pt){s.current=pt,window.clearTimeout(a.current),pt!==""&&(a.current=window.setTimeout(()=>ct(""),1e3))}(c)},[i]),et=reactExports.useCallback(()=>{s.current="",window.clearTimeout(a.current)},[]);return reactExports.useEffect(()=>()=>window.clearTimeout(a.current),[]),[s,b,et]}function findNextItem(e,i,s){const b=i.length>1&&Array.from(i).every(pt=>pt===i[0])?i[0]:i,et=s?e.indexOf(s):-1;let nt=wrapArray(e,Math.max(et,0));b.length===1&&(nt=nt.filter(pt=>pt!==s));const ct=nt.find(pt=>pt.textValue.toLowerCase().startsWith(b.toLowerCase()));return ct!==s?ct:void 0}function wrapArray(e,i){return e.map((s,a)=>e[(i+a)%e.length])}var Root2=Select$1,Trigger=SelectTrigger$1,Value=SelectValue$1,Icon=SelectIcon,Portal=SelectPortal,Content2=SelectContent$1,Viewport=SelectViewport,Label=SelectLabel$1,Item=SelectItem$1,ItemText=SelectItemText,ItemIndicator=SelectItemIndicator,ScrollUpButton=SelectScrollUpButton$1,ScrollDownButton=SelectScrollDownButton$1,Separator=SelectSeparator$1;const Select=Root2,SelectValue=Value,SelectTrigger=reactExports.forwardRef(({className:e,children:i,...s},a)=>jsxRuntimeExports.jsxs(Trigger,{ref:a,className:cn("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...s,children:[i,jsxRuntimeExports.jsx(Icon,{asChild:!0,children:jsxRuntimeExports.jsx(ChevronDown,{className:"h-4 w-4 opacity-50"})})]}));SelectTrigger.displayName=Trigger.displayName;const SelectScrollUpButton=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(ScrollUpButton,{ref:s,className:cn("flex cursor-default items-center justify-center py-1",e),...i,children:jsxRuntimeExports.jsx(ChevronUp,{className:"h-4 w-4"})}));SelectScrollUpButton.displayName=ScrollUpButton.displayName;const SelectScrollDownButton=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(ScrollDownButton,{ref:s,className:cn("flex cursor-default items-center justify-center py-1",e),...i,children:jsxRuntimeExports.jsx(ChevronDown,{className:"h-4 w-4"})}));SelectScrollDownButton.displayName=ScrollDownButton.displayName;const SelectContent=reactExports.forwardRef(({className:e,children:i,position:s="popper",...a},b)=>jsxRuntimeExports.jsx(Portal,{children:jsxRuntimeExports.jsxs(Content2,{ref:b,className:cn("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...a,children:[jsxRuntimeExports.jsx(SelectScrollUpButton,{}),jsxRuntimeExports.jsx(Viewport,{className:cn("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:i}),jsxRuntimeExports.jsx(SelectScrollDownButton,{})]})}));SelectContent.displayName=Content2.displayName;const SelectLabel=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Label,{ref:s,className:cn("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...i}));SelectLabel.displayName=Label.displayName;const SelectItem=reactExports.forwardRef(({className:e,children:i,...s},a)=>jsxRuntimeExports.jsxs(Item,{ref:a,className:cn("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...s,children:[jsxRuntimeExports.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:jsxRuntimeExports.jsx(ItemIndicator,{children:jsxRuntimeExports.jsx(Check,{className:"h-4 w-4"})})}),jsxRuntimeExports.jsx(ItemText,{children:i})]}));SelectItem.displayName=Item.displayName;const SelectSeparator=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Separator,{ref:s,className:cn("-mx-1 my-1 h-px bg-muted",e),...i}));SelectSeparator.displayName=Separator.displayName;const categories=["Biryani","Meals","Curries","Tiffin","Dosa","Sweets","Snacks","Beverages"];function AddDish(){const{user:e}=useAuth(),i=useNavigate(),{kitchens:s}=useAmmaKitchens(e==null?void 0:e.id),[a,b]=reactExports.useState(!1),[et,nt]=reactExports.useState(null),[c,ct]=reactExports.useState(null),[pt,xt]=reactExports.useState({kitchenId:"",name:"",description:"",price:"",originalPrice:"",category:"Meals",preparationTime:"15 mins",servingSize:"1 person",isVeg:!0,isAvailable:!0,tags:""}),St=Rt=>{var It;const Nt=(It=Rt.target.files)==null?void 0:It[0];if(Nt){nt(Nt);const Gt=new FileReader;Gt.onloadend=()=>{ct(Gt.result)},Gt.readAsDataURL(Nt)}},Et=async Rt=>{var It;Rt.preventDefault();const Nt=pt.kitchenId||((It=s[0])==null?void 0:It.id);if(!Nt){ue.error("No kitchen found. Please register your kitchen first.");return}if(!pt.name||!pt.price){ue.error("Please fill in all required fields");return}b(!0);try{let Gt="https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=400";if(et){const Dt=await uploadToImgBB(et);Dt&&(Gt=Dt.display_url)}await createDish({kitchenId:Nt,name:pt.name,description:pt.description,image:Gt,price:parseFloat(pt.price),originalPrice:pt.originalPrice?parseFloat(pt.originalPrice):void 0,isVeg:pt.isVeg,isAvailable:pt.isAvailable,category:pt.category,tags:pt.tags.split(",").map(Dt=>Dt.trim()).filter(Boolean),preparationTime:pt.preparationTime,servingSize:pt.servingSize}),ue.success("Dish added successfully!"),i("/amma/dashboard")}catch(Gt){console.error("Failed to add dish:",Gt),ue.error("Failed to add dish")}finally{b(!1)}};return!e||e.role!=="amma"?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"You need to be registered as an Amma"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Login as Amma"})})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[jsxRuntimeExports.jsx(Link,{to:"/amma/dashboard",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})})}),jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Add New Dish"})]})}),jsxRuntimeExports.jsxs("form",{onSubmit:Et,className:"px-4 py-6 space-y-6",children:[jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsxs("label",{className:"cursor-pointer",children:[jsxRuntimeExports.jsx("div",{className:"w-40 h-40 rounded-2xl bg-secondary flex items-center justify-center overflow-hidden",children:c?jsxRuntimeExports.jsx("img",{src:c,alt:"Preview",className:"w-full h-full object-cover"}):jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(Camera,{className:"w-8 h-8 text-muted-foreground mx-auto mb-1"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Add Dish Photo"})]})}),jsxRuntimeExports.jsx("input",{type:"file",accept:"image/*",onChange:St,className:"hidden"})]})}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Dish Name *"}),jsxRuntimeExports.jsx(Input,{placeholder:"e.g., Chicken Biryani",value:pt.name,onChange:Rt=>xt({...pt,name:Rt.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Description"}),jsxRuntimeExports.jsx(Textarea,{placeholder:"Describe your dish...",value:pt.description,onChange:Rt=>xt({...pt,description:Rt.target.value}),className:"bg-secondary border-0 mt-1 resize-none",rows:2})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Price () *"}),jsxRuntimeExports.jsx(Input,{type:"number",placeholder:"180",value:pt.price,onChange:Rt=>xt({...pt,price:Rt.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Original Price ()"}),jsxRuntimeExports.jsx(Input,{type:"number",placeholder:"220",value:pt.originalPrice,onChange:Rt=>xt({...pt,originalPrice:Rt.target.value}),className:"bg-secondary border-0 mt-1"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Category"}),jsxRuntimeExports.jsxs(Select,{value:pt.category,onValueChange:Rt=>xt({...pt,category:Rt}),children:[jsxRuntimeExports.jsx(SelectTrigger,{className:"bg-secondary border-0 mt-1",children:jsxRuntimeExports.jsx(SelectValue,{})}),jsxRuntimeExports.jsx(SelectContent,{children:categories.map(Rt=>jsxRuntimeExports.jsx(SelectItem,{value:Rt,children:Rt},Rt))})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Prep Time"}),jsxRuntimeExports.jsx(Input,{placeholder:"15 mins",value:pt.preparationTime,onChange:Rt=>xt({...pt,preparationTime:Rt.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Serving Size"}),jsxRuntimeExports.jsx(Input,{placeholder:"1 person",value:pt.servingSize,onChange:Rt=>xt({...pt,servingSize:Rt.target.value}),className:"bg-secondary border-0 mt-1"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Tags (comma separated)"}),jsxRuntimeExports.jsx(Input,{placeholder:"bestseller, spicy, healthy",value:pt.tags,onChange:Rt=>xt({...pt,tags:Rt.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between bg-secondary rounded-xl p-4",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"veg-dish",children:"Vegetarian"}),jsxRuntimeExports.jsx(Switch,{id:"veg-dish",checked:pt.isVeg,onCheckedChange:Rt=>xt({...pt,isVeg:Rt})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between bg-secondary rounded-xl p-4",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"available",children:"Available Now"}),jsxRuntimeExports.jsx(Switch,{id:"available",checked:pt.isAvailable,onCheckedChange:Rt=>xt({...pt,isAvailable:Rt})})]})]}),jsxRuntimeExports.jsx(Button,{type:"submit",disabled:a,className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl",children:a?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin"}),jsxRuntimeExports.jsx("span",{children:"Adding..."})]}):"Add Dish"})]})]})}function EditKitchen(){const{kitchenId:e}=useParams(),i=useNavigate(),{user:s}=useAuth();useLocationContext();const[a,b]=reactExports.useState(!0),[et,nt]=reactExports.useState(!1),[c,ct]=reactExports.useState(""),[pt,xt]=reactExports.useState(null),[St,Et]=reactExports.useState(null),[Rt,Nt]=reactExports.useState(null),[It,Gt]=reactExports.useState({name:"",description:"",specialties:"",cookingTime:"30-45 mins",isVeg:!0,address:{line1:"",city:"",pincode:""}});reactExports.useEffect(()=>{(async()=>{if(e){try{const Zt=ref(database,`kitchens/${e}`),nr=await get(Zt);if(nr.exists()){const ur=nr.val();if(ur.ownerId!==(s==null?void 0:s.id)){ue.error("You do not have permission to edit this kitchen"),i("/amma/dashboard");return}Gt({name:ur.name,description:ur.description,specialties:ur.specialties.join(", "),cookingTime:ur.cookingTime,isVeg:ur.isVeg,address:{line1:ur.address.line1,city:ur.address.city,pincode:ur.address.pincode}}),ct(ur.image),ur.address.lat&&ur.address.lng&&Et({lat:ur.address.lat,lng:ur.address.lng,address:ur.address.line1}),Nt(ur.franchiseId||null)}}catch(Zt){console.error("Error loading kitchen:",Zt),ue.error("Failed to load kitchen data")}b(!1)}})()},[e,s==null?void 0:s.id,i]);const Dt=Vt=>{var nr;const Zt=(nr=Vt.target.files)==null?void 0:nr[0];if(Zt){xt(Zt);const ur=new FileReader;ur.onload=()=>ct(ur.result),ur.readAsDataURL(Zt)}},Bt=Vt=>{Et(Vt),Nt(Vt.franchiseId),Gt(Zt=>({...Zt,address:{...Zt.address,line1:Vt.address}}))},Lt=async()=>{if(e){if(!It.name.trim()){ue.error("Please enter your kitchen name");return}if(!St){ue.error("Please select your kitchen location on the map");return}if(!Rt){ue.error("Your location must be within a service area");return}nt(!0);try{let Vt=c;pt&&(Vt=(await uploadImage(pt)).data.display_url),await updateKitchen(e,{name:It.name,description:It.description,specialties:It.specialties.split(",").map(Zt=>Zt.trim()).filter(Boolean),cookingTime:It.cookingTime,isVeg:It.isVeg,image:Vt,franchiseId:Rt,address:{line1:St.address,city:It.address.city,pincode:It.address.pincode,lat:St.lat,lng:St.lng}}),ue.success("Kitchen updated successfully!"),i("/amma/dashboard")}catch(Vt){console.error("Error updating kitchen:",Vt),ue.error("Failed to update kitchen")}nt(!1)}};return a?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-8",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:()=>i(-1),children:jsxRuntimeExports.jsx(ChevronLeft,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Edit Kitchen"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Update your kitchen details"})]})]})}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-6 space-y-6",children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-foreground mb-2",children:"Kitchen Image"}),jsxRuntimeExports.jsxs("div",{className:"relative w-full h-48 rounded-2xl bg-secondary overflow-hidden cursor-pointer group",children:[c?jsxRuntimeExports.jsx("img",{src:c,alt:"Kitchen",className:"w-full h-full object-cover"}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[jsxRuntimeExports.jsx(Camera,{className:"w-10 h-10 text-muted-foreground mb-2"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-muted-foreground",children:"Add kitchen photo"})]}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:jsxRuntimeExports.jsx(Camera,{className:"w-8 h-8 text-white"})}),jsxRuntimeExports.jsx("input",{type:"file",accept:"image/*",onChange:Dt,className:"absolute inset-0 opacity-0 cursor-pointer"})]})]})}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Kitchen Name *"}),jsxRuntimeExports.jsx(Input,{value:It.name,onChange:Vt=>Gt({...It,name:Vt.target.value}),placeholder:"e.g., Amma's Kitchen",className:"mt-1 bg-secondary border-0"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Description"}),jsxRuntimeExports.jsx("textarea",{value:It.description,onChange:Vt=>Gt({...It,description:Vt.target.value}),placeholder:"Tell customers about your kitchen...",rows:3,className:"mt-1 w-full px-4 py-3 rounded-xl bg-secondary text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 resize-none"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Specialties"}),jsxRuntimeExports.jsx(Input,{value:It.specialties,onChange:Vt=>Gt({...It,specialties:Vt.target.value}),placeholder:"e.g., Biryani, South Indian, Sweets",className:"mt-1 bg-secondary border-0"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Separate with commas"})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Cooking Time"}),jsxRuntimeExports.jsxs("select",{value:It.cookingTime,onChange:Vt=>Gt({...It,cookingTime:Vt.target.value}),className:"mt-1 w-full px-4 py-3 rounded-xl bg-secondary text-foreground",children:[jsxRuntimeExports.jsx("option",{value:"15-30 mins",children:"15-30 mins"}),jsxRuntimeExports.jsx("option",{value:"30-45 mins",children:"30-45 mins"}),jsxRuntimeExports.jsx("option",{value:"45-60 mins",children:"45-60 mins"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 pt-6",children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Pure Veg?"}),jsxRuntimeExports.jsx("button",{onClick:()=>Gt({...It,isVeg:!It.isVeg}),className:`w-12 h-6 rounded-full transition-colors ${It.isVeg?"bg-veg":"bg-muted"}`,children:jsxRuntimeExports.jsx("div",{className:`w-5 h-5 rounded-full bg-white shadow-md transition-transform ${It.isVeg?"translate-x-6":"translate-x-1"}`})})]})]})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4 text-primary"}),jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Kitchen Location *"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"Tap on the map to set your kitchen location. It must be within a service zone."}),jsxRuntimeExports.jsx(FranchiseZoneLocationPicker,{onLocationSelect:Bt,initialLocation:St||void 0})]}),St&&jsxRuntimeExports.jsxs("div",{className:"bg-secondary rounded-xl p-4",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-foreground",children:"Selected Address"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:St.address}),Rt&&jsxRuntimeExports.jsx("p",{className:"text-xs text-veg mt-2",children:" Within service area"})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"City"}),jsxRuntimeExports.jsx(Input,{value:It.address.city,onChange:Vt=>Gt({...It,address:{...It.address,city:Vt.target.value}}),placeholder:"City",className:"mt-1 bg-secondary border-0"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Pincode"}),jsxRuntimeExports.jsx(Input,{value:It.address.pincode,onChange:Vt=>Gt({...It,address:{...It.address,pincode:Vt.target.value}}),placeholder:"Pincode",className:"mt-1 bg-secondary border-0"})]})]})]}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:jsxRuntimeExports.jsx(Button,{onClick:Lt,disabled:et,className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl text-lg font-semibold",children:et?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin mr-2"}),"Saving..."]}):"Save Changes"})})]})]})}const roleDashboardMap={super_admin:"/super-admin",franchise_admin:"/franchise-admin",admin:"/admin",amma:"/amma/dashboard",user:"/"};function useRoleRedirect(e){const i=useAuth(),s=useNavigate(),{user:a,loading:b}=i;return reactExports.useEffect(()=>{if(!b){if(!a){s("/auth",{replace:!0});return}if(!e.includes(a.role)){const nt=roleDashboardMap[a.role]||"/";s(nt,{replace:!0})}}},[a,b,e,s]),{isAuthorized:!b&&a&&e.includes(a.role),isLoading:b}}const KitchenMap=({kitchens:e=[],userLocation:i,selectedKitchen:s,onKitchenSelect:a,height:b="300px",showUserLocation:et=!0})=>{const nt=reactExports.useRef(null),c=reactExports.useRef(null),ct=reactExports.useRef([]),[pt,xt]=reactExports.useState(!1),St=[80.648,16.5062];return reactExports.useEffect(()=>{if(!(!nt.current||c.current))return mapboxgl.accessToken=MAPBOX_ACCESS_TOKEN,c.current=new mapboxgl.Map({container:nt.current,style:"mapbox://styles/mapbox/streets-v12",center:i?[i.lng,i.lat]:St,zoom:13}),c.current.addControl(new mapboxgl.NavigationControl,"top-right"),c.current.on("load",()=>{xt(!0)}),()=>{var Et;(Et=c.current)==null||Et.remove(),c.current=null}},[]),reactExports.useEffect(()=>{if(!c.current||!pt||!i||!et)return;const Et=new mapboxgl.Marker({color:"#D97706"}).setLngLat([i.lng,i.lat]).setPopup(new mapboxgl.Popup().setHTML("<strong>Your Location</strong>")).addTo(c.current);return c.current.flyTo({center:[i.lng,i.lat],zoom:14}),()=>{Et.remove()}},[i,pt,et]),reactExports.useEffect(()=>{var Et;if(!(!c.current||!pt)&&(ct.current.forEach(Rt=>Rt.remove()),ct.current=[],e.forEach(Rt=>{if(!Rt.address.lat||!Rt.address.lng)return;const Nt=document.createElement("div");Nt.className="kitchen-marker",Nt.innerHTML=`
        <div class="w-10 h-10 rounded-full ${Rt.isOpen?"bg-primary":"bg-muted"} flex items-center justify-center shadow-lg cursor-pointer transform hover:scale-110 transition-transform">
          <span class="text-lg"></span>
        </div>
      `;const It=new mapboxgl.Popup({offset:25}).setHTML(`
        <div class="p-2">
          <h3 class="font-bold text-sm">${Rt.name}</h3>
          <p class="text-xs text-gray-500">${Rt.specialties.join(", ")}</p>
          <p class="text-xs ${Rt.isOpen?"text-green-600":"text-red-500"}">
            ${Rt.isOpen?" Open":" Closed"}
          </p>
        </div>
      `),Gt=new mapboxgl.Marker(Nt).setLngLat([Rt.address.lng,Rt.address.lat]).setPopup(It).addTo(c.current);Nt.addEventListener("click",()=>{a&&a(Rt.id)}),ct.current.push(Gt)}),e.length>0)){const Rt=new mapboxgl.LngLatBounds;e.forEach(Nt=>{Nt.address.lat&&Nt.address.lng&&Rt.extend([Nt.address.lng,Nt.address.lat])}),i&&Rt.extend([i.lng,i.lat]),Rt.isEmpty()||(Et=c.current)==null||Et.fitBounds(Rt,{padding:50})}},[e,pt,a]),reactExports.useEffect(()=>{if(!c.current||!s)return;const Et=e.find(Rt=>Rt.id===s);Et!=null&&Et.address.lat&&(Et!=null&&Et.address.lng)&&c.current.flyTo({center:[Et.address.lng,Et.address.lat],zoom:15})},[s,e]),jsxRuntimeExports.jsxs("div",{className:"relative w-full rounded-xl overflow-hidden shadow-lg",style:{height:b},children:[jsxRuntimeExports.jsx("div",{ref:nt,className:"absolute inset-0"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 pointer-events-none bg-gradient-to-b from-transparent to-background/5 rounded-xl"})]})};function AdminDashboard(){useAuth();const{isAuthorized:e,isLoading:i}=useRoleRedirect(["admin","franchise_admin"]),{kitchens:s,loading:a}=useAllKitchens(),{orders:b,loading:et}=useAllOrders(),{users:nt,loading:c}=useAllUsers(),[ct,pt]=reactExports.useState("overview"),[xt,St]=reactExports.useState(""),Et=s.filter(Vt=>!Vt.isApproved),Rt=s.filter(Vt=>Vt.isApproved),Nt=b.filter(Vt=>{const Zt=new Date;return new Date(Vt.createdAt).toDateString()===Zt.toDateString()}),It=b.reduce((Vt,Zt)=>Vt+Zt.totalAmount,0),Gt=async Vt=>{try{await approveKitchen(Vt),ue.success("Kitchen approved!")}catch{ue.error("Failed to approve kitchen")}},Dt=async Vt=>{try{await rejectKitchen(Vt),ue.success("Kitchen rejected")}catch{ue.error("Failed to reject kitchen")}},Bt=async Vt=>{if(confirm("Are you sure you want to delete this user?"))try{await deleteUser(Vt),ue.success("User deleted")}catch{ue.error("Failed to delete user")}};return i||a||et||c||!e?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx(Link,{to:"/profile",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Admin Dashboard"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Manage everything"})]})]}),Et.length>0&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-gold text-foreground text-xs",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-3 h-3"}),Et.length," pending"]})]}),jsxRuntimeExports.jsx("div",{className:"flex bg-secondary mx-4 rounded-xl p-1 mb-4 overflow-x-auto",children:["overview","kitchens","users","orders"].map(Vt=>jsxRuntimeExports.jsx("button",{onClick:()=>pt(Vt),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all capitalize whitespace-nowrap ${ct===Vt?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:Vt},Vt))})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[ct==="overview"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(Store$1,{className:"w-6 h-6 text-primary mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:Rt.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Active Kitchens"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(Users,{className:"w-6 h-6 text-accent mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:nt.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Users"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(Package,{className:"w-6 h-6 text-gold mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:Nt.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Today's Orders"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(TrendingUp,{className:"w-6 h-6 text-veg mb-2"}),jsxRuntimeExports.jsxs("p",{className:"text-2xl font-bold text-foreground",children:["",It]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Revenue"})]})]}),Et.length>0&&jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-foreground mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-4 h-4 text-gold"}),"Pending Kitchen Approvals"]}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:Et.map(Vt=>jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-3 bg-secondary rounded-xl",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:Vt.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:Vt.address.city})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Button,{size:"sm",className:"bg-veg text-primary-foreground",onClick:()=>Gt(Vt.id),children:jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(Button,{size:"sm",variant:"outline",className:"text-destructive border-destructive",onClick:()=>Dt(Vt.id),children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]})]},Vt.id))})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Kitchen Locations"}),jsxRuntimeExports.jsx(KitchenMap,{kitchens:Rt,height:"250px",showUserLocation:!1})]})]}),ct==="kitchens"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{placeholder:"Search kitchens...",value:xt,onChange:Vt=>St(Vt.target.value),className:"bg-secondary border-0"}),s.filter(Vt=>Vt.name.toLowerCase().includes(xt.toLowerCase())).map(Vt=>jsxRuntimeExports.jsxs(motion.div,{className:"bg-card rounded-xl p-4 shadow-card flex gap-4",children:[jsxRuntimeExports.jsx("img",{src:Vt.image,alt:Vt.name,className:"w-16 h-16 rounded-lg object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:Vt.name}),!Vt.isApproved&&jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 bg-gold/20 text-gold text-xs rounded-full",children:"Pending"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:Vt.specialties.join(", ")}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:Vt.address.city})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-1",children:[jsxRuntimeExports.jsx("span",{className:cn("text-xs px-2 py-1 rounded-full text-center",Vt.isOpen?"bg-veg/20 text-veg":"bg-muted text-muted-foreground"),children:Vt.isOpen?"Open":"Closed"}),!Vt.isApproved&&jsxRuntimeExports.jsx(Button,{size:"sm",className:"bg-veg text-primary-foreground text-xs",onClick:()=>Gt(Vt.id),children:"Approve"})]})]},Vt.id))]}),ct==="users"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{placeholder:"Search users...",value:xt,onChange:Vt=>St(Vt.target.value),className:"bg-secondary border-0"}),nt.filter(Vt=>Vt.name.toLowerCase().includes(xt.toLowerCase())||Vt.email.toLowerCase().includes(xt.toLowerCase())).map(Vt=>jsxRuntimeExports.jsxs(motion.div,{className:"bg-card rounded-xl p-4 shadow-card flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(Users,{className:"w-6 h-6 text-muted-foreground"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:Vt.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:Vt.email})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:cn("text-xs px-2 py-1 rounded-full capitalize",Vt.role==="admin"?"bg-primary/20 text-primary":Vt.role==="amma"?"bg-gold/20 text-gold":"bg-secondary text-muted-foreground"),children:Vt.role}),Vt.role!=="admin"&&jsxRuntimeExports.jsx(Button,{size:"icon",variant:"ghost",className:"text-destructive",onClick:()=>Bt(Vt.id),children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]})]},Vt.id))]}),ct==="orders"&&jsxRuntimeExports.jsx("div",{className:"space-y-4",children:b.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Package,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No orders yet"})]}):b.slice(0,20).map(Vt=>jsxRuntimeExports.jsxs(motion.div,{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-2",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:Vt.kitchenName}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",Vt.id.slice(-8),"  ",new Date(Vt.createdAt).toLocaleDateString()]})]}),jsxRuntimeExports.jsx("span",{className:cn("text-xs px-2 py-1 rounded-full capitalize",Vt.status==="delivered"?"bg-veg/20 text-veg":Vt.status==="cancelled"?"bg-destructive/20 text-destructive":"bg-primary/20 text-primary"),children:Vt.status})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsxs("span",{className:"text-muted-foreground",children:[Vt.items.length," items"]}),jsxRuntimeExports.jsxs("span",{className:"font-semibold text-foreground",children:["",Vt.totalAmount]})]})]},Vt.id))})]})]})}function FranchiseZoneMap({zone:e,kitchens:i=[],users:s=[],height:a="400px",onKitchenClick:b}){const et=reactExports.useRef(null),nt=reactExports.useRef(null),[c,ct]=reactExports.useState(!0),pt=reactExports.useRef([]);return reactExports.useEffect(()=>{if(et.current)return mapboxgl.accessToken=MAPBOX_ACCESS_TOKEN,nt.current=new mapboxgl.Map({container:et.current,style:"mapbox://styles/mapbox/streets-v12",center:[78.4867,17.385],zoom:10,attributionControl:!1}),nt.current.addControl(new mapboxgl.NavigationControl,"bottom-right"),nt.current.on("load",()=>{if(ct(!1),!nt.current)return;nt.current.addSource("franchise-zone",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:e.coordinates}}}),nt.current.addLayer({id:"franchise-zone-fill",type:"fill",source:"franchise-zone",paint:{"fill-color":"#f97316","fill-opacity":.15}}),nt.current.addLayer({id:"franchise-zone-border",type:"line",source:"franchise-zone",paint:{"line-color":"#f97316","line-width":3,"line-dasharray":[2,1]}});const xt=e.coordinates[0],St=new mapboxgl.LngLatBounds;xt.forEach(Et=>St.extend([Et[0],Et[1]])),nt.current.fitBounds(St,{padding:50})}),()=>{var xt;(xt=nt.current)==null||xt.remove()}},[]),reactExports.useEffect(()=>{!nt.current||c||(pt.current.forEach(xt=>xt.remove()),pt.current=[],i.forEach(xt=>{var Nt;if(!xt.address.lat||!xt.address.lng)return;const St=document.createElement("div");St.className="kitchen-marker",St.innerHTML=`
        <div class="w-10 h-10 rounded-full bg-orange-500 flex items-center justify-center shadow-lg border-2 border-white cursor-pointer transform hover:scale-110 transition-transform">
          <span class="text-lg"></span>
        </div>
      `,St.addEventListener("click",()=>{b&&b(xt.id)});const Et=new mapboxgl.Popup({offset:25}).setHTML(`
        <div class="p-2">
          <h3 class="font-bold text-sm text-orange-600"> ${xt.name}</h3>
          <p class="text-xs text-gray-500">${((Nt=xt.specialties)==null?void 0:Nt.join(", "))||"Home Kitchen"}</p>
          <p class="text-xs ${xt.isOpen?"text-green-600":"text-red-500"}">
            ${xt.isOpen?" Open":" Closed"}
          </p>
          ${xt.isApproved?"":'<p class="text-xs text-yellow-600"> Pending Approval</p>'}
          <p class="text-xs text-blue-500 mt-1 cursor-pointer">Click for details </p>
        </div>
      `),Rt=new mapboxgl.Marker(St).setLngLat([xt.address.lng,xt.address.lat]).setPopup(Et).addTo(nt.current);pt.current.push(Rt)}),s.forEach(xt=>{const St=document.createElement("div");St.className="user-marker",St.innerHTML=`
        <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center shadow-lg border-2 border-white cursor-pointer transform hover:scale-110 transition-transform">
          <span class="text-sm"></span>
        </div>
      `;const Et=new mapboxgl.Popup({offset:20}).setHTML(`
        <div class="p-2">
          <h3 class="font-bold text-sm text-blue-600"> ${xt.name}</h3>
          ${xt.email?`<p class="text-xs text-gray-500">${xt.email}</p>`:""}
          ${xt.city?`<p class="text-xs text-gray-400">${xt.city}</p>`:""}
        </div>
      `),Rt=new mapboxgl.Marker(St).setLngLat([xt.lng,xt.lat]).setPopup(Et).addTo(nt.current);pt.current.push(Rt)}))},[i,s,c,b]),jsxRuntimeExports.jsxs("div",{className:"relative rounded-xl overflow-hidden shadow-lg",style:{height:a},children:[jsxRuntimeExports.jsx("div",{ref:et,className:"absolute inset-0"}),c&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-6 h-6 animate-spin text-primary"})}),jsxRuntimeExports.jsxs("div",{className:"absolute bottom-4 left-4 bg-card/95 backdrop-blur-sm rounded-lg px-3 py-2 shadow-lg",children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-foreground mb-2",children:"Legend"}),jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-4 h-4 rounded-full bg-orange-500 flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-[8px]",children:""})}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Amma (Kitchen)"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-4 h-4 rounded-full bg-blue-500 flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-[8px]",children:""})}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Customer"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-4 h-1 bg-orange-500 rounded",style:{borderStyle:"dashed"}}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Service Zone"})]})]})]})]})}function FranchiseAdminDashboard(){var _i,xr;const{user:e,signOut:i}=useAuth(),s=useNavigate(),{isAuthorized:a,isLoading:b}=useRoleRedirect(["franchise_admin"]),{franchise:et,loading:nt}=useFranchise(e==null?void 0:e.franchiseId),{kitchens:c,loading:ct}=useAllKitchens(),{orders:pt,loading:xt}=useAllOrders(),{users:St,loading:Et}=useAllUsers(),[Rt,Nt]=reactExports.useState("overview"),[It,Gt]=reactExports.useState(""),[Dt,Bt]=reactExports.useState(null),Lt=async()=>{await i(),s("/auth")},Vt=gr=>{const rr=Zt.find(cr=>cr.id===gr);rr&&Bt(rr)},Zt=c.filter(gr=>!(et!=null&&et.zone)||!gr.address.lat||!gr.address.lng?!1:isPointInZone(gr.address.lat,gr.address.lng,et.zone)),nr=St.filter(gr=>{var rr,cr;return!(et!=null&&et.zone)||!((rr=gr.address)!=null&&rr.lat)||!((cr=gr.address)!=null&&cr.lng)||gr.role!=="user"?!1:isPointInZone(gr.address.lat,gr.address.lng,et.zone)});St.filter(gr=>{var rr,cr;return!(et!=null&&et.zone)||!((rr=gr.address)!=null&&rr.lat)||!((cr=gr.address)!=null&&cr.lng)?!1:gr.role==="amma"&&isPointInZone(gr.address.lat,gr.address.lng,et.zone)});const ur=Zt.filter(gr=>!gr.isApproved),_r=Zt.filter(gr=>gr.isApproved),Ur=pt.filter(gr=>{const rr=c.find(cr=>cr.id===gr.kitchenId);return!(et!=null&&et.zone)||!(rr!=null&&rr.address.lat)||!(rr!=null&&rr.address.lng)?!1:isPointInZone(rr.address.lat,rr.address.lng,et.zone)}),ln=Ur.filter(gr=>{const rr=new Date;return new Date(gr.createdAt).toDateString()===rr.toDateString()}),an=Ur.reduce((gr,rr)=>gr+rr.totalAmount,0),Fr=async gr=>{try{await approveKitchen(gr),ue.success("Kitchen approved!")}catch{ue.error("Failed to approve kitchen")}},rn=async gr=>{try{await rejectKitchen(gr),ue.success("Kitchen rejected")}catch{ue.error("Failed to reject kitchen")}};return b||nt||ct||xt||Et||!a?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):et?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:et.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Franchise Dashboard"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[ur.length>0&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-gold text-foreground text-xs",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-3 h-3"}),ur.length," pending"]}),jsxRuntimeExports.jsxs(Button,{variant:"ghost",size:"sm",onClick:Lt,className:"text-destructive",children:[jsxRuntimeExports.jsx(LogOut,{className:"w-4 h-4 mr-1"}),"Logout"]})]})]}),jsxRuntimeExports.jsx("div",{className:"flex bg-secondary mx-4 rounded-xl p-1 mb-4 overflow-x-auto",children:["overview","map","kitchens","users"].map(gr=>jsxRuntimeExports.jsx("button",{onClick:()=>Nt(gr),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all capitalize whitespace-nowrap ${Rt===gr?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:gr==="map"?jsxRuntimeExports.jsxs("span",{className:"flex items-center justify-center gap-1",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-3 h-3"})," Map"]}):gr},gr))})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[Rt==="overview"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(Store$1,{className:"w-6 h-6 text-primary mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:_r.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Active Kitchens"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(Users,{className:"w-6 h-6 text-blue-500 mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:nr.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Customers"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(Package,{className:"w-6 h-6 text-gold mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:ln.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Today's Orders"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(TrendingUp,{className:"w-6 h-6 text-veg mb-2"}),jsxRuntimeExports.jsxs("p",{className:"text-2xl font-bold text-foreground",children:["",an]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Revenue"})]})]}),ur.length>0&&jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-foreground mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-4 h-4 text-gold"}),"Pending Kitchen Approvals"]}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:ur.map(gr=>jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-3 bg-secondary rounded-xl",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:gr.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:gr.address.city})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Button,{size:"sm",className:"bg-veg text-primary-foreground",onClick:()=>Fr(gr.id),children:jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(Button,{size:"sm",variant:"outline",className:"text-destructive border-destructive",onClick:()=>rn(gr.id),children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]})]},gr.id))})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-foreground mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4 text-primary"}),"Service Zone"]}),jsxRuntimeExports.jsx(FranchiseZoneMap,{zone:et.zone,kitchens:Zt,users:nr.map(gr=>{var rr;return{id:gr.id,name:gr.name,lat:gr.address.lat,lng:gr.address.lng,email:gr.email,city:(rr=gr.address)==null?void 0:rr.city}}),height:"500px",onKitchenClick:Vt}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground text-center mt-2",children:[Zt.length," Ammas  ",nr.length," Customers in zone"]})]})]}),Rt==="map"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-foreground mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4 text-primary"}),et.name," - Service Zone Map"]}),jsxRuntimeExports.jsx(FranchiseZoneMap,{zone:et.zone,kitchens:Zt,users:nr.map(gr=>{var rr;return{id:gr.id,name:gr.name,lat:gr.address.lat,lng:gr.address.lng,email:gr.email,city:(rr=gr.address)==null?void 0:rr.city}}),height:"750px",onKitchenClick:Vt})]}),Dt&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-4",children:[jsxRuntimeExports.jsx("img",{src:Dt.image,alt:Dt.name,className:"w-20 h-20 rounded-xl object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:Dt.name}),!Dt.isApproved&&jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 bg-gold/20 text-gold text-xs rounded-full",children:"Pending"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:(_i=Dt.specialties)==null?void 0:_i.join(", ")}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:[Dt.address.line1,", ",Dt.address.city]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[jsxRuntimeExports.jsx("span",{className:cn("text-xs px-2 py-1 rounded-full",Dt.isOpen?"bg-veg/20 text-veg":"bg-muted text-muted-foreground"),children:Dt.isOpen?" Open":" Closed"}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-muted-foreground",children:[" ",((xr=Dt.rating)==null?void 0:xr.toFixed(1))||"N/A"]})]})]}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",onClick:()=>Bt(null),className:"text-muted-foreground",children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]}),!Dt.isApproved&&jsxRuntimeExports.jsxs("div",{className:"flex gap-2 mt-4",children:[jsxRuntimeExports.jsxs(Button,{size:"sm",className:"flex-1 bg-veg text-primary-foreground",onClick:()=>{Fr(Dt.id),Bt(null)},children:[jsxRuntimeExports.jsx(Check,{className:"w-4 h-4 mr-1"})," Approve"]}),jsxRuntimeExports.jsxs(Button,{size:"sm",variant:"outline",className:"flex-1 text-destructive border-destructive",onClick:()=>{rn(Dt.id),Bt(null)},children:[jsxRuntimeExports.jsx(X,{className:"w-4 h-4 mr-1"})," Reject"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-3 shadow-card text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-orange-500",children:Zt.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Ammas"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-3 shadow-card text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-blue-500",children:nr.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Customers"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-3 shadow-card text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-veg",children:Ur.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Orders"})]})]})]}),Rt==="kitchens"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{placeholder:"Search kitchens...",value:It,onChange:gr=>Gt(gr.target.value),className:"bg-secondary border-0"}),Zt.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Store$1,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No kitchens in your zone yet"})]}):Zt.filter(gr=>gr.name.toLowerCase().includes(It.toLowerCase())).map(gr=>{var rr;return jsxRuntimeExports.jsxs(motion.div,{className:"bg-card rounded-xl p-4 shadow-card flex gap-4",children:[jsxRuntimeExports.jsx("img",{src:gr.image,alt:gr.name,className:"w-16 h-16 rounded-lg object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:gr.name}),!gr.isApproved&&jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 bg-gold/20 text-gold text-xs rounded-full",children:"Pending"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:(rr=gr.specialties)==null?void 0:rr.join(", ")}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:gr.address.city})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-1",children:[jsxRuntimeExports.jsx("span",{className:cn("text-xs px-2 py-1 rounded-full text-center",gr.isOpen?"bg-veg/20 text-veg":"bg-muted text-muted-foreground"),children:gr.isOpen?"Open":"Closed"}),!gr.isApproved&&jsxRuntimeExports.jsx(Button,{size:"sm",className:"bg-veg text-primary-foreground text-xs",onClick:()=>Fr(gr.id),children:"Approve"})]})]},gr.id)})]}),Rt==="users"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{placeholder:"Search users...",value:It,onChange:gr=>Gt(gr.target.value),className:"bg-secondary border-0"}),nr.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Users,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No customers in your zone yet"})]}):nr.filter(gr=>gr.name.toLowerCase().includes(It.toLowerCase())||gr.email.toLowerCase().includes(It.toLowerCase())).map(gr=>{var rr;return jsxRuntimeExports.jsxs(motion.div,{className:"bg-card rounded-xl p-4 shadow-card flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-500/20 flex items-center justify-center",children:jsxRuntimeExports.jsx(Users,{className:"w-6 h-6 text-blue-500"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:gr.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:gr.email}),((rr=gr.address)==null?void 0:rr.city)&&jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:gr.address.city})]}),jsxRuntimeExports.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-blue-500/20 text-blue-500",children:"Customer"})]},gr.id)})]})]})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-16 h-16 text-gold mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"No franchise assigned to your account"}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Go Home"})})]})}const Dialog=Root$1,DialogTrigger=Trigger$2,DialogPortal=Portal$1,DialogOverlay=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Overlay,{ref:s,className:cn("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...i}));DialogOverlay.displayName=Overlay.displayName;const DialogContent=reactExports.forwardRef(({className:e,children:i,...s},a)=>jsxRuntimeExports.jsxs(DialogPortal,{children:[jsxRuntimeExports.jsx(DialogOverlay,{}),jsxRuntimeExports.jsxs(Content$1,{ref:a,className:cn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s,children:[i,jsxRuntimeExports.jsxs(Close,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[jsxRuntimeExports.jsx(X,{className:"h-4 w-4"}),jsxRuntimeExports.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));DialogContent.displayName=Content$1.displayName;const DialogHeader=({className:e,...i})=>jsxRuntimeExports.jsx("div",{className:cn("flex flex-col space-y-1.5 text-center sm:text-left",e),...i});DialogHeader.displayName="DialogHeader";const DialogTitle=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Title,{ref:s,className:cn("text-lg font-semibold leading-none tracking-tight",e),...i}));DialogTitle.displayName=Title.displayName;const DialogDescription=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Description,{ref:s,className:cn("text-sm text-muted-foreground",e),...i}));DialogDescription.displayName=Description.displayName;const classes={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},sources={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},cursors={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},types$1={POLYGON:"polygon",LINE:"line_string",POINT:"point"},geojsonTypes={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},modes$1={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},events$1={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},updateActions={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},meta={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},activeStates={ACTIVE:"true",INACTIVE:"false"},interactions=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],LAT_MIN$1=-90,LAT_RENDERED_MIN$1=-85,LAT_MAX$1=90,LAT_RENDERED_MAX$1=85,LNG_MIN$1=-270,LNG_MAX$1=270,Constants=Object.freeze(Object.defineProperty({__proto__:null,LAT_MAX:LAT_MAX$1,LAT_MIN:LAT_MIN$1,LAT_RENDERED_MAX:LAT_RENDERED_MAX$1,LAT_RENDERED_MIN:LAT_RENDERED_MIN$1,LNG_MAX:LNG_MAX$1,LNG_MIN:LNG_MIN$1,activeStates,classes,cursors,events:events$1,geojsonTypes,interactions,meta,modes:modes$1,sources,types:types$1,updateActions},Symbol.toStringTag,{value:"Module"}));function isOfMetaType(e){return function(i){const s=i.featureTarget;return!s||!s.properties?!1:s.properties.meta===e}}function isShiftMousedown(e){return!e.originalEvent||!e.originalEvent.shiftKey?!1:e.originalEvent.button===0}function isActiveFeature(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===activeStates.ACTIVE&&e.featureTarget.properties.meta===meta.FEATURE}function isInactiveFeature(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===activeStates.INACTIVE&&e.featureTarget.properties.meta===meta.FEATURE}function noTarget(e){return e.featureTarget===void 0}function isFeature(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.meta===meta.FEATURE}function isVertex$1(e){const i=e.featureTarget;return!i||!i.properties?!1:i.properties.meta===meta.VERTEX}function isShiftDown(e){return e.originalEvent?e.originalEvent.shiftKey===!0:!1}function isEscapeKey(e){return e.key==="Escape"||e.keyCode===27}function isEnterKey(e){return e.key==="Enter"||e.keyCode===13}function isBackspaceKey(e){return e.key==="Backspace"||e.keyCode===8}function isDeleteKey(e){return e.key==="Delete"||e.keyCode===46}function isDigit1Key(e){return e.key==="1"||e.keyCode===49}function isDigit2Key(e){return e.key==="2"||e.keyCode===50}function isDigit3Key(e){return e.key==="3"||e.keyCode===51}function isDigitKey(e){const i=e.key||String.fromCharCode(e.keyCode);return i>="0"&&i<="9"}function isTrue(){return!0}const common_selectors=Object.freeze(Object.defineProperty({__proto__:null,isActiveFeature,isBackspaceKey,isDeleteKey,isDigit1Key,isDigit2Key,isDigit3Key,isDigitKey,isEnterKey,isEscapeKey,isFeature,isInactiveFeature,isOfMetaType,isShiftDown,isShiftMousedown,isTrue,isVertex:isVertex$1,noTarget},Symbol.toStringTag,{value:"Module"}));var geojsonArea={},wgs84$1={};wgs84$1.RADIUS=6378137;wgs84$1.FLATTENING=1/298.257223563;wgs84$1.POLAR_RADIUS=63567523142e-4;var wgs84=wgs84$1;geojsonArea.geometry=geometry;geojsonArea.ring=ringArea;function geometry(e){var i=0,s;switch(e.type){case"Polygon":return polygonArea(e.coordinates);case"MultiPolygon":for(s=0;s<e.coordinates.length;s++)i+=polygonArea(e.coordinates[s]);return i;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(s=0;s<e.geometries.length;s++)i+=geometry(e.geometries[s]);return i}}function polygonArea(e){var i=0;if(e&&e.length>0){i+=Math.abs(ringArea(e[0]));for(var s=1;s<e.length;s++)i-=Math.abs(ringArea(e[s]))}return i}function ringArea(e){var i,s,a,b,et,nt,c,ct=0,pt=e.length;if(pt>2){for(c=0;c<pt;c++)c===pt-2?(b=pt-2,et=pt-1,nt=0):c===pt-1?(b=pt-1,et=0,nt=1):(b=c,et=c+1,nt=c+2),i=e[b],s=e[et],a=e[nt],ct+=(rad(a[0])-rad(i[0]))*Math.sin(rad(s[1]));ct=ct*wgs84.RADIUS*wgs84.RADIUS/2}return ct}function rad(e){return e*Math.PI/180}const FEATURE_SORT_RANKS={Point:0,LineString:1,MultiLineString:1,Polygon:2};function comparator(e,i){const s=FEATURE_SORT_RANKS[e.geometry.type]-FEATURE_SORT_RANKS[i.geometry.type];return s===0&&e.geometry.type===geojsonTypes.POLYGON?e.area-i.area:s}function sortFeatures(e){return e.map(i=>(i.geometry.type===geojsonTypes.POLYGON&&(i.area=geojsonArea.geometry({type:geojsonTypes.FEATURE,property:{},geometry:i.geometry})),i)).sort(comparator).map(i=>(delete i.area,i))}function mapEventToBoundingBox(e,i=0){return[[e.point.x-i,e.point.y-i],[e.point.x+i,e.point.y+i]]}function StringSet(e){if(this._items={},this._nums={},this._length=e?e.length:0,!!e)for(let i=0,s=e.length;i<s;i++)this.add(e[i]),e[i]!==void 0&&(typeof e[i]=="string"?this._items[e[i]]=i:this._nums[e[i]]=i)}StringSet.prototype.add=function(e){return this.has(e)?this:(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length,this)};StringSet.prototype.delete=function(e){return this.has(e)===!1?this:(this._length--,delete this._items[e],delete this._nums[e],this)};StringSet.prototype.has=function(e){return typeof e!="string"&&typeof e!="number"?!1:this._items[e]!==void 0||this._nums[e]!==void 0};StringSet.prototype.values=function(){const e=[];return Object.keys(this._items).forEach(i=>{e.push({k:i,v:this._items[i]})}),Object.keys(this._nums).forEach(i=>{e.push({k:JSON.parse(i),v:this._nums[i]})}),e.sort((i,s)=>i.v-s.v).map(i=>i.k)};StringSet.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const META_TYPES=[meta.FEATURE,meta.MIDPOINT,meta.VERTEX],featuresAt={click:featuresAtClick,touch:featuresAtTouch};function featuresAtClick(e,i,s){return featuresAt$1(e,i,s,s.options.clickBuffer)}function featuresAtTouch(e,i,s){return featuresAt$1(e,i,s,s.options.touchBuffer)}function featuresAt$1(e,i,s,a){if(s.map===null)return[];const b=e?mapEventToBoundingBox(e,a):i,et={};s.options.styles&&(et.layers=s.options.styles.map(pt=>pt.id).filter(pt=>s.map.getLayer(pt)!=null));const nt=s.map.queryRenderedFeatures(b,et).filter(pt=>META_TYPES.indexOf(pt.properties.meta)!==-1),c=new StringSet,ct=[];return nt.forEach(pt=>{const xt=pt.properties.id;c.has(xt)||(c.add(xt),ct.push(pt))}),sortFeatures(ct)}function getFeatureAtAndSetCursors(e,i){const s=featuresAt.click(e,null,i),a={mouse:cursors.NONE};return s[0]&&(a.mouse=s[0].properties.active===activeStates.ACTIVE?cursors.MOVE:cursors.POINTER,a.feature=s[0].properties.meta),i.events.currentModeName().indexOf("draw")!==-1&&(a.mouse=cursors.ADD),i.ui.queueMapClasses(a),i.ui.updateMapClasses(),s[0]}function euclideanDistance(e,i){const s=e.x-i.x,a=e.y-i.y;return Math.sqrt(s*s+a*a)}const FINE_TOLERANCE=4,GROSS_TOLERANCE=12,INTERVAL=500;function isClick(e,i,s={}){const a=s.fineTolerance!=null?s.fineTolerance:FINE_TOLERANCE,b=s.grossTolerance!=null?s.grossTolerance:GROSS_TOLERANCE,et=s.interval!=null?s.interval:INTERVAL;e.point=e.point||i.point,e.time=e.time||i.time;const nt=euclideanDistance(e.point,i.point);return nt<a||nt<b&&i.time-e.time<et}const TAP_TOLERANCE=25,TAP_INTERVAL=250;function isTap(e,i,s={}){const a=s.tolerance!=null?s.tolerance:TAP_TOLERANCE,b=s.interval!=null?s.interval:TAP_INTERVAL;return e.point=e.point||i.point,e.time=e.time||i.time,euclideanDistance(e.point,i.point)<a&&i.time-e.time<b}const ModeHandler=function(e,i){const s={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},a={on(et,nt,c){if(s[et]===void 0)throw new Error(`Invalid event type: ${et}`);s[et].push({selector:nt,fn:c})},render(et){i.store.featureChanged(et)}},b=function(et,nt){const c=s[et];let ct=c.length;for(;ct--;){const pt=c[ct];if(pt.selector(nt)){pt.fn.call(a,nt)||i.store.render(),i.ui.updateMapClasses();break}}};return e.start.call(a),{render:e.render,stop(){e.stop&&e.stop()},trash(){e.trash&&(e.trash(),i.store.render())},combineFeatures(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures(){e.uncombineFeatures&&e.uncombineFeatures()},drag(et){b("drag",et)},click(et){b("click",et)},mousemove(et){b("mousemove",et)},mousedown(et){b("mousedown",et)},mouseup(et){b("mouseup",et)},mouseout(et){b("mouseout",et)},keydown(et){b("keydown",et)},keyup(et){b("keyup",et)},touchstart(et){b("touchstart",et)},touchmove(et){b("touchmove",et)},touchend(et){b("touchend",et)},tap(et){b("tap",et)}}};let customAlphabet=(e,i=21)=>(s=i)=>{let a="",b=s|0;for(;b--;)a+=e[Math.random()*e.length|0];return a};const nanoid=customAlphabet("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function generateID(){return nanoid()}const Feature=function(e,i){this.ctx=e,this.properties=i.properties||{},this.coordinates=i.geometry.coordinates,this.id=i.id||generateID(),this.type=i.geometry.type};Feature.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};Feature.prototype.incomingCoords=function(e){this.setCoordinates(e)};Feature.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};Feature.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};Feature.prototype.setProperty=function(e,i){this.properties[e]=i};Feature.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:geojsonTypes.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};Feature.prototype.internal=function(e){const i={id:this.id,meta:meta.FEATURE,"meta:type":this.type,active:activeStates.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(const s in this.properties)i[`user_${s}`]=this.properties[s];return{type:geojsonTypes.FEATURE,properties:i,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const Point$1=function(e,i){Feature.call(this,e,i)};Point$1.prototype=Object.create(Feature.prototype);Point$1.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};Point$1.prototype.updateCoordinate=function(e,i,s){arguments.length===3?this.coordinates=[i,s]:this.coordinates=[e,i],this.changed()};Point$1.prototype.getCoordinate=function(){return this.getCoordinates()};const LineString=function(e,i){Feature.call(this,e,i)};LineString.prototype=Object.create(Feature.prototype);LineString.prototype.isValid=function(){return this.coordinates.length>1};LineString.prototype.addCoordinate=function(e,i,s){this.changed();const a=parseInt(e,10);this.coordinates.splice(a,0,[i,s])};LineString.prototype.getCoordinate=function(e){const i=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[i]))};LineString.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)};LineString.prototype.updateCoordinate=function(e,i,s){const a=parseInt(e,10);this.coordinates[a]=[i,s],this.changed()};const Polygon=function(e,i){Feature.call(this,e,i),this.coordinates=this.coordinates.map(s=>s.slice(0,-1))};Polygon.prototype=Object.create(Feature.prototype);Polygon.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(e=>e.length>2)};Polygon.prototype.incomingCoords=function(e){this.coordinates=e.map(i=>i.slice(0,-1)),this.changed()};Polygon.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};Polygon.prototype.addCoordinate=function(e,i,s){this.changed();const a=e.split(".").map(et=>parseInt(et,10));this.coordinates[a[0]].splice(a[1],0,[i,s])};Polygon.prototype.removeCoordinate=function(e){this.changed();const i=e.split(".").map(a=>parseInt(a,10)),s=this.coordinates[i[0]];s&&(s.splice(i[1],1),s.length<3&&this.coordinates.splice(i[0],1))};Polygon.prototype.getCoordinate=function(e){const i=e.split(".").map(a=>parseInt(a,10)),s=this.coordinates[i[0]];return JSON.parse(JSON.stringify(s[i[1]]))};Polygon.prototype.getCoordinates=function(){return this.coordinates.map(e=>e.concat([e[0]]))};Polygon.prototype.updateCoordinate=function(e,i,s){this.changed();const a=e.split("."),b=parseInt(a[0],10),et=parseInt(a[1],10);this.coordinates[b]===void 0&&(this.coordinates[b]=[]),this.coordinates[b][et]=[i,s]};const models={MultiPoint:Point$1,MultiLineString:LineString,MultiPolygon:Polygon},takeAction=(e,i,s,a,b)=>{const et=s.split("."),nt=parseInt(et[0],10),c=et[1]?et.slice(1).join("."):null;return e[nt][i](c,a,b)},MultiFeature=function(e,i){if(Feature.call(this,e,i),delete this.coordinates,this.model=models[i.geometry.type],this.model===void 0)throw new TypeError(`${i.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(i.geometry.coordinates)};MultiFeature.prototype=Object.create(Feature.prototype);MultiFeature.prototype._coordinatesToFeatures=function(e){const i=this.model.bind(this);return e.map(s=>new i(this.ctx,{id:generateID(),type:geojsonTypes.FEATURE,properties:{},geometry:{coordinates:s,type:this.type.replace("Multi","")}}))};MultiFeature.prototype.isValid=function(){return this.features.every(e=>e.isValid())};MultiFeature.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()};MultiFeature.prototype.getCoordinate=function(e){return takeAction(this.features,"getCoordinate",e)};MultiFeature.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(e=>e.type===geojsonTypes.POLYGON?e.getCoordinates():e.coordinates)))};MultiFeature.prototype.updateCoordinate=function(e,i,s){takeAction(this.features,"updateCoordinate",e,i,s),this.changed()};MultiFeature.prototype.addCoordinate=function(e,i,s){takeAction(this.features,"addCoordinate",e,i,s),this.changed()};MultiFeature.prototype.removeCoordinate=function(e){takeAction(this.features,"removeCoordinate",e),this.changed()};MultiFeature.prototype.getFeatures=function(){return this.features};function ModeInterface(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}ModeInterface.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)};ModeInterface.prototype.setSelectedCoordinates=function(e){this._ctx.store.setSelectedCoordinates(e),e.reduce((i,s)=>(i[s.feature_id]===void 0&&(i[s.feature_id]=!0,this._ctx.store.get(s.feature_id).changed()),i),{})};ModeInterface.prototype.getSelected=function(){return this._ctx.store.getSelected()};ModeInterface.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};ModeInterface.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)};ModeInterface.prototype.getFeature=function(e){return this._ctx.store.get(e)};ModeInterface.prototype.select=function(e){return this._ctx.store.select(e)};ModeInterface.prototype.deselect=function(e){return this._ctx.store.deselect(e)};ModeInterface.prototype.deleteFeature=function(e,i={}){return this._ctx.store.delete(e,i)};ModeInterface.prototype.addFeature=function(e,i={}){return this._ctx.store.add(e,i)};ModeInterface.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};ModeInterface.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};ModeInterface.prototype.setActionableState=function(e={}){const i={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(i)};ModeInterface.prototype.changeMode=function(e,i={},s={}){return this._ctx.events.changeMode(e,i,s)};ModeInterface.prototype.fire=function(e,i){return this._ctx.events.fire(e,i)};ModeInterface.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)};ModeInterface.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)};ModeInterface.prototype.featuresAt=function(e,i,s="click"){if(s!=="click"&&s!=="touch")throw new Error("invalid buffer type");return featuresAt[s](e,i,this._ctx)};ModeInterface.prototype.newFeature=function(e){const i=e.geometry.type;return i===geojsonTypes.POINT?new Point$1(this._ctx,e):i===geojsonTypes.LINE_STRING?new LineString(this._ctx,e):i===geojsonTypes.POLYGON?new Polygon(this._ctx,e):new MultiFeature(this._ctx,e)};ModeInterface.prototype.isInstanceOf=function(e,i){if(e===geojsonTypes.POINT)return i instanceof Point$1;if(e===geojsonTypes.LINE_STRING)return i instanceof LineString;if(e===geojsonTypes.POLYGON)return i instanceof Polygon;if(e==="MultiFeature")return i instanceof MultiFeature;throw new Error(`Unknown feature class: ${e}`)};ModeInterface.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)};ModeInterface.prototype.onSetup=function(){};ModeInterface.prototype.onDrag=function(){};ModeInterface.prototype.onClick=function(){};ModeInterface.prototype.onMouseMove=function(){};ModeInterface.prototype.onMouseDown=function(){};ModeInterface.prototype.onMouseUp=function(){};ModeInterface.prototype.onMouseOut=function(){};ModeInterface.prototype.onKeyUp=function(){};ModeInterface.prototype.onKeyDown=function(){};ModeInterface.prototype.onTouchStart=function(){};ModeInterface.prototype.onTouchMove=function(){};ModeInterface.prototype.onTouchEnd=function(){};ModeInterface.prototype.onTap=function(){};ModeInterface.prototype.onStop=function(){};ModeInterface.prototype.onTrash=function(){};ModeInterface.prototype.onCombineFeature=function(){};ModeInterface.prototype.onUncombineFeature=function(){};ModeInterface.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const eventMapper={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},eventKeys=Object.keys(eventMapper);function objectToMode(e){const i=Object.keys(e);return function(s,a={}){let b={};const et=i.reduce((c,ct)=>(c[ct]=e[ct],c),new ModeInterface(s));function nt(c){return ct=>et[c](b,ct)}return{start(){b=et.onSetup(a),eventKeys.forEach(c=>{const ct=eventMapper[c];let pt=()=>!1;e[ct]&&(pt=()=>!0),this.on(c,pt,nt(ct))})},stop(){et.onStop(b)},trash(){et.onTrash(b)},combineFeatures(){et.onCombineFeatures(b)},uncombineFeatures(){et.onUncombineFeatures(b)},render(c,ct){et.toDisplayFeatures(b,c,ct)}}}}function events(e){const i=Object.keys(e.options.modes).reduce((Et,Rt)=>(Et[Rt]=objectToMode(e.options.modes[Rt]),Et),{});let s={},a={};const b={};let et=null,nt=null;b.drag=function(Et,Rt){Rt({point:Et.point,time:new Date().getTime()})?(e.ui.queueMapClasses({mouse:cursors.DRAG}),nt.drag(Et)):Et.originalEvent.stopPropagation()},b.mousedrag=function(Et){b.drag(Et,Rt=>!isClick(s,Rt))},b.touchdrag=function(Et){b.drag(Et,Rt=>!isTap(a,Rt))},b.mousemove=function(Et){if((Et.originalEvent.buttons!==void 0?Et.originalEvent.buttons:Et.originalEvent.which)===1)return b.mousedrag(Et);const Nt=getFeatureAtAndSetCursors(Et,e);Et.featureTarget=Nt,nt.mousemove(Et)},b.mousedown=function(Et){s={time:new Date().getTime(),point:Et.point};const Rt=getFeatureAtAndSetCursors(Et,e);Et.featureTarget=Rt,nt.mousedown(Et)},b.mouseup=function(Et){const Rt=getFeatureAtAndSetCursors(Et,e);Et.featureTarget=Rt,isClick(s,{point:Et.point,time:new Date().getTime()})?nt.click(Et):nt.mouseup(Et)},b.mouseout=function(Et){nt.mouseout(Et)},b.touchstart=function(Et){if(!e.options.touchEnabled)return;a={time:new Date().getTime(),point:Et.point};const Rt=featuresAt.touch(Et,null,e)[0];Et.featureTarget=Rt,nt.touchstart(Et)},b.touchmove=function(Et){if(e.options.touchEnabled)return nt.touchmove(Et),b.touchdrag(Et)},b.touchend=function(Et){if(Et.originalEvent.preventDefault(),!e.options.touchEnabled)return;const Rt=featuresAt.touch(Et,null,e)[0];Et.featureTarget=Rt,isTap(a,{time:new Date().getTime(),point:Et.point})?nt.tap(Et):nt.touchend(Et)};const c=Et=>{const Rt=isBackspaceKey(Et),Nt=isDeleteKey(Et),It=isDigitKey(Et);return!(Rt||Nt||It)};b.keydown=function(Et){(Et.srcElement||Et.target).classList.contains(classes.CANVAS)&&((isBackspaceKey(Et)||isDeleteKey(Et))&&e.options.controls.trash?(Et.preventDefault(),nt.trash()):c(Et)?nt.keydown(Et):isDigit1Key(Et)&&e.options.controls.point?ct(modes$1.DRAW_POINT):isDigit2Key(Et)&&e.options.controls.line_string?ct(modes$1.DRAW_LINE_STRING):isDigit3Key(Et)&&e.options.controls.polygon&&ct(modes$1.DRAW_POLYGON))},b.keyup=function(Et){c(Et)&&nt.keyup(Et)},b.zoomend=function(){e.store.changeZoom()},b.data=function(Et){if(Et.dataType==="style"){const{setup:Rt,map:Nt,options:It,store:Gt}=e;It.styles.some(Bt=>Nt.getLayer(Bt.id))||(Rt.addLayers(),Gt.setDirty(),Gt.render())}};function ct(Et,Rt,Nt={}){nt.stop();const It=i[Et];if(It===void 0)throw new Error(`${Et} is not valid`);et=Et;const Gt=It(e,Rt);nt=ModeHandler(Gt,e),Nt.silent||e.map.fire(events$1.MODE_CHANGE,{mode:Et}),e.store.setDirty(),e.store.render()}const pt={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function xt(Et){let Rt=!1;Object.keys(Et).forEach(Nt=>{if(pt[Nt]===void 0)throw new Error("Invalid action type");pt[Nt]!==Et[Nt]&&(Rt=!0),pt[Nt]=Et[Nt]}),Rt&&e.map.fire(events$1.ACTIONABLE,{actions:pt})}return{start(){et=e.options.defaultMode,nt=ModeHandler(i[et](e),e)},changeMode:ct,actionable:xt,currentModeName(){return et},currentModeRender(Et,Rt){return nt.render(Et,Rt)},fire(Et,Rt){e.map&&e.map.fire(Et,Rt)},addEventListeners(){e.map.on("mousemove",b.mousemove),e.map.on("mousedown",b.mousedown),e.map.on("mouseup",b.mouseup),e.map.on("data",b.data),e.map.on("touchmove",b.touchmove),e.map.on("touchstart",b.touchstart),e.map.on("touchend",b.touchend),e.container.addEventListener("mouseout",b.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",b.keydown),e.container.addEventListener("keyup",b.keyup))},removeEventListeners(){e.map.off("mousemove",b.mousemove),e.map.off("mousedown",b.mousedown),e.map.off("mouseup",b.mouseup),e.map.off("data",b.data),e.map.off("touchmove",b.touchmove),e.map.off("touchstart",b.touchstart),e.map.off("touchend",b.touchend),e.container.removeEventListener("mouseout",b.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",b.keydown),e.container.removeEventListener("keyup",b.keyup))},trash(Et){nt.trash(Et)},combineFeatures(){nt.combineFeatures()},uncombineFeatures(){nt.uncombineFeatures()},getMode(){return et}}}function toDenseArray(e){return[].concat(e).filter(i=>i!==void 0)}function render(){const e=this;if(!(e.ctx.map&&e.ctx.map.getSource(sources.HOT)!==void 0))return ct();const s=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:s});let a=[],b=[];e.isDirty?b=e.getAllIds():(a=e.getChangedIds().filter(pt=>e.get(pt)!==void 0),b=e.sources.hot.filter(pt=>pt.properties.id&&a.indexOf(pt.properties.id)===-1&&e.get(pt.properties.id)!==void 0).map(pt=>pt.properties.id)),e.sources.hot=[];const et=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(pt=>{const xt=pt.properties.id||pt.properties.parent;return a.indexOf(xt)===-1});const nt=et!==e.sources.cold.length||b.length>0;a.forEach(pt=>c(pt,"hot")),b.forEach(pt=>c(pt,"cold"));function c(pt,xt){const Et=e.get(pt).internal(s);e.ctx.events.currentModeRender(Et,Rt=>{Rt.properties.mode=s,e.sources[xt].push(Rt)})}nt&&e.ctx.map.getSource(sources.COLD).setData({type:geojsonTypes.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(sources.HOT).setData({type:geojsonTypes.FEATURE_COLLECTION,features:e.sources.hot}),ct();function ct(){e.isDirty=!1,e.clearChangedIds()}}function Store(e){this._features={},this._featureIds=new StringSet,this._selectedFeatureIds=new StringSet,this._selectedCoordinates=[],this._changedFeatureIds=new StringSet,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]};let i;this.render=()=>{i||(i=requestAnimationFrame(()=>{i=null,render.call(this),this._emitSelectionChange&&(this.ctx.events.fire(events$1.SELECTION_CHANGE,{features:this.getSelected().map(s=>s.toGeoJSON()),points:this.getSelectedCoordinates().map(s=>({type:geojsonTypes.FEATURE,properties:{},geometry:{type:geojsonTypes.POINT,coordinates:s.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(events$1.RENDER,{})}))},this.isDirty=!1}Store.prototype.createRenderBatch=function(){const e=this.render;let i=0;return this.render=function(){i++},()=>{this.render=e,i>0&&this.render()}};Store.prototype.setDirty=function(){return this.isDirty=!0,this};Store.prototype.featureCreated=function(e,i={}){if(this._changedFeatureIds.add(e),(i.silent!=null?i.silent:this.ctx.options.suppressAPIEvents)!==!0){const a=this.get(e);this.ctx.events.fire(events$1.CREATE,{features:[a.toGeoJSON()]})}return this};Store.prototype.featureChanged=function(e,i={}){return this._changedFeatureIds.add(e),(i.silent!=null?i.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(events$1.UPDATE,{action:i.action?i.action:updateActions.CHANGE_COORDINATES,features:[this.get(e).toGeoJSON()]}),this};Store.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};Store.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};Store.prototype.getAllIds=function(){return this._featureIds.values()};Store.prototype.add=function(e,i={}){return this._features[e.id]=e,this._featureIds.add(e.id),this.featureCreated(e.id,{silent:i.silent}),this};Store.prototype.delete=function(e,i={}){const s=[];return toDenseArray(e).forEach(a=>{this._featureIds.has(a)&&(this._featureIds.delete(a),this._selectedFeatureIds.delete(a),i.silent||s.indexOf(this._features[a])===-1&&s.push(this._features[a].toGeoJSON()),delete this._features[a],this.isDirty=!0)}),s.length&&this.ctx.events.fire(events$1.DELETE,{features:s}),refreshSelectedCoordinates(this,i),this};Store.prototype.get=function(e){return this._features[e]};Store.prototype.getAll=function(){return Object.keys(this._features).map(e=>this._features[e])};Store.prototype.select=function(e,i={}){return toDenseArray(e).forEach(s=>{this._selectedFeatureIds.has(s)||(this._selectedFeatureIds.add(s),this._changedFeatureIds.add(s),i.silent||(this._emitSelectionChange=!0))}),this};Store.prototype.deselect=function(e,i={}){return toDenseArray(e).forEach(s=>{this._selectedFeatureIds.has(s)&&(this._selectedFeatureIds.delete(s),this._changedFeatureIds.add(s),i.silent||(this._emitSelectionChange=!0))}),refreshSelectedCoordinates(this,i),this};Store.prototype.clearSelected=function(e={}){return this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this};Store.prototype.setSelected=function(e,i={}){return e=toDenseArray(e),this.deselect(this._selectedFeatureIds.values().filter(s=>e.indexOf(s)===-1),{silent:i.silent}),this.select(e.filter(s=>!this._selectedFeatureIds.has(s)),{silent:i.silent}),this};Store.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this};Store.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};Store.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};Store.prototype.getSelected=function(){return this.getSelectedIds().map(e=>this.get(e))};Store.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(i=>({coordinates:this.get(i.feature_id).getCoordinate(i.coord_path)}))};Store.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)};Store.prototype.setFeatureProperty=function(e,i,s,a={}){this.get(e).setProperty(i,s),this.featureChanged(e,{silent:a.silent,action:updateActions.CHANGE_PROPERTIES})};function refreshSelectedCoordinates(e,i={}){const s=e._selectedCoordinates.filter(a=>e._selectedFeatureIds.has(a.feature_id));e._selectedCoordinates.length!==s.length&&!i.silent&&(e._emitSelectionChange=!0),e._selectedCoordinates=s}Store.prototype.storeMapConfig=function(){interactions.forEach(e=>{this.ctx.map[e]&&(this._mapInitialConfig[e]=this.ctx.map[e].isEnabled())})};Store.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(e=>{this._mapInitialConfig[e]?this.ctx.map[e].enable():this.ctx.map[e].disable()})};Store.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]!==void 0?this._mapInitialConfig[e]:!0};const classTypes=["mode","feature","mouse"];function ui(e){const i={};let s=null,a={mode:null,feature:null,mouse:null},b={mode:null,feature:null,mouse:null};function et(){nt({mode:null,feature:null,mouse:null}),c()}function nt(Rt){b=Object.assign(b,Rt)}function c(){if(!e.container)return;const Rt=[],Nt=[];classTypes.forEach(It=>{b[It]!==a[It]&&(Rt.push(`${It}-${a[It]}`),b[It]!==null&&Nt.push(`${It}-${b[It]}`))}),Rt.length>0&&e.container.classList.remove(...Rt),Nt.length>0&&e.container.classList.add(...Nt),a=Object.assign(a,b)}function ct(Rt,Nt={}){const It=document.createElement("button");return It.className=`${classes.CONTROL_BUTTON} ${Nt.className}`,It.setAttribute("title",Nt.title),Nt.container.appendChild(It),It.addEventListener("click",Gt=>{if(Gt.preventDefault(),Gt.stopPropagation(),Gt.target===s){pt(),Nt.onDeactivate();return}xt(Rt),Nt.onActivate()},!0),It}function pt(){s&&(s.classList.remove(classes.ACTIVE_BUTTON),s=null)}function xt(Rt){pt();const Nt=i[Rt];Nt&&Nt&&Rt!=="trash"&&(Nt.classList.add(classes.ACTIVE_BUTTON),s=Nt)}function St(){const Rt=e.options.controls,Nt=document.createElement("div");return Nt.className=`${classes.CONTROL_GROUP} ${classes.CONTROL_BASE}`,Rt&&(Rt[types$1.POINT]&&(i[types$1.POINT]=ct(types$1.POINT,{container:Nt,className:classes.CONTROL_BUTTON_POINT,title:`Marker tool ${e.options.keybindings?"(1)":""}`,onActivate:()=>e.events.changeMode(modes$1.DRAW_POINT),onDeactivate:()=>e.events.trash()})),Rt[types$1.LINE]&&(i[types$1.LINE]=ct(types$1.LINE,{container:Nt,className:classes.CONTROL_BUTTON_LINE,title:`LineString tool ${e.options.keybindings?"(2)":""}`,onActivate:()=>e.events.changeMode(modes$1.DRAW_LINE_STRING),onDeactivate:()=>e.events.trash()})),Rt[types$1.POLYGON]&&(i[types$1.POLYGON]=ct(types$1.POLYGON,{container:Nt,className:classes.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${e.options.keybindings?"(3)":""}`,onActivate:()=>e.events.changeMode(modes$1.DRAW_POLYGON),onDeactivate:()=>e.events.trash()})),Rt.trash&&(i.trash=ct("trash",{container:Nt,className:classes.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{e.events.trash()}})),Rt.combine_features&&(i.combine_features=ct("combineFeatures",{container:Nt,className:classes.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{e.events.combineFeatures()}})),Rt.uncombine_features&&(i.uncombine_features=ct("uncombineFeatures",{container:Nt,className:classes.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{e.events.uncombineFeatures()}}))),Nt}function Et(){Object.keys(i).forEach(Rt=>{const Nt=i[Rt];Nt.parentNode&&Nt.parentNode.removeChild(Nt),delete i[Rt]})}return{setActiveButton:xt,queueMapClasses:nt,updateMapClasses:c,clearMapClasses:et,addButtons:St,removeButtons:Et}}function runSetup(e){let i=null,s=null;const a={onRemove(){return e.map.off("load",a.connect),clearInterval(s),a.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,i&&i.parentNode&&i.parentNode.removeChild(i),i=null,this},connect(){e.map.off("load",a.connect),clearInterval(s),a.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd(b){if(e.map=b,e.events=events(e),e.ui=ui(e),e.container=b.getContainer(),e.store=new Store(e),i=e.ui.addButtons(),e.options.boxSelect){e.boxZoomInitial=b.boxZoom.isEnabled(),b.boxZoom.disable();const et=b.dragPan.isEnabled();b.dragPan.disable(),b.dragPan.enable(),et||b.dragPan.disable()}return b.loaded()?a.connect():(b.on("load",a.connect),s=setInterval(()=>{b.loaded()&&a.connect()},16)),e.events.start(),i},addLayers(){e.map.addSource(sources.COLD,{data:{type:geojsonTypes.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(sources.HOT,{data:{type:geojsonTypes.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(b=>{e.map.addLayer(b)}),e.store.setDirty(!0),e.store.render()},removeLayers(){e.options.styles.forEach(b=>{e.map.getLayer(b.id)&&e.map.removeLayer(b.id)}),e.map.getSource(sources.COLD)&&e.map.removeSource(sources.COLD),e.map.getSource(sources.HOT)&&e.map.removeSource(sources.HOT)}};return e.setup=a,a}const blue="#3bb2d0",orange="#fbb03b",white="#fff",styles=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],orange,blue],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],orange,blue],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":white}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],orange,blue]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":white}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":orange}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":orange}}];function Point(e,i){this.x=e,this.y=i}Point.prototype={clone(){return new Point(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,i){return this.clone()._rotateAround(e,i)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const i=e.x-this.x,s=e.y-this.y;return i*i+s*s},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult(e){const i=e[0]*this.x+e[1]*this.y,s=e[2]*this.x+e[3]*this.y;return this.x=i,this.y=s,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const i=Math.cos(e),s=Math.sin(e),a=i*this.x-s*this.y,b=s*this.x+i*this.y;return this.x=a,this.y=b,this},_rotateAround(e,i){const s=Math.cos(e),a=Math.sin(e),b=i.x+s*(this.x-i.x)-a*(this.y-i.y),et=i.y+a*(this.x-i.x)+s*(this.y-i.y);return this.x=b,this.y=et,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Point};Point.convert=function(e){if(e instanceof Point)return e;if(Array.isArray(e))return new Point(+e[0],+e[1]);if(e.x!==void 0&&e.y!==void 0)return new Point(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};function mouseEventPoint(e,i){const s=i.getBoundingClientRect();return new Point(e.clientX-s.left-(i.clientLeft||0),e.clientY-s.top-(i.clientTop||0))}function createVertex(e,i,s,a){return{type:geojsonTypes.FEATURE,properties:{meta:meta.VERTEX,parent:e,coord_path:s,active:a?activeStates.ACTIVE:activeStates.INACTIVE},geometry:{type:geojsonTypes.POINT,coordinates:i}}}function isNumber(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function coordEach(e,i,s){if(e!==null)for(var a,b,et,nt,c,ct,pt,xt=0,St=0,Et,Rt=e.type,Nt=Rt==="FeatureCollection",It=Rt==="Feature",Gt=Nt?e.features.length:1,Dt=0;Dt<Gt;Dt++){pt=Nt?e.features[Dt].geometry:It?e.geometry:e,Et=pt?pt.type==="GeometryCollection":!1,c=Et?pt.geometries.length:1;for(var Bt=0;Bt<c;Bt++){var Lt=0,Vt=0;if(nt=Et?pt.geometries[Bt]:pt,nt!==null){ct=nt.coordinates;var Zt=nt.type;switch(xt=0,Zt){case null:break;case"Point":if(i(ct,St,Dt,Lt,Vt)===!1)return!1;St++,Lt++;break;case"LineString":case"MultiPoint":for(a=0;a<ct.length;a++){if(i(ct[a],St,Dt,Lt,Vt)===!1)return!1;St++,Zt==="MultiPoint"&&Lt++}Zt==="LineString"&&Lt++;break;case"Polygon":case"MultiLineString":for(a=0;a<ct.length;a++){for(b=0;b<ct[a].length-xt;b++){if(i(ct[a][b],St,Dt,Lt,Vt)===!1)return!1;St++}Zt==="MultiLineString"&&Lt++,Zt==="Polygon"&&Vt++}Zt==="Polygon"&&Lt++;break;case"MultiPolygon":for(a=0;a<ct.length;a++){for(Vt=0,b=0;b<ct[a].length;b++){for(et=0;et<ct[a][b].length-xt;et++){if(i(ct[a][b][et],St,Dt,Lt,Vt)===!1)return!1;St++}Vt++}Lt++}break;case"GeometryCollection":for(a=0;a<nt.geometries.length;a++)if(coordEach(nt.geometries[a],i)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function clone(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return cloneFeature(e);case"FeatureCollection":return cloneFeatureCollection(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return cloneGeometry(e);default:throw new Error("unknown GeoJSON type")}}function cloneFeature(e){const i={type:"Feature"};return Object.keys(e).forEach(s=>{switch(s){case"type":case"properties":case"geometry":return;default:i[s]=e[s]}}),i.properties=cloneProperties(e.properties),e.geometry==null?i.geometry=null:i.geometry=cloneGeometry(e.geometry),i}function cloneProperties(e){const i={};return e&&Object.keys(e).forEach(s=>{const a=e[s];typeof a=="object"?a===null?i[s]=null:Array.isArray(a)?i[s]=a.map(b=>b):i[s]=cloneProperties(a):i[s]=a}),i}function cloneFeatureCollection(e){const i={type:"FeatureCollection"};return Object.keys(e).forEach(s=>{switch(s){case"type":case"features":return;default:i[s]=e[s]}}),i.features=e.features.map(s=>cloneFeature(s)),i}function cloneGeometry(e){const i={type:e.type};return e.bbox&&(i.bbox=e.bbox),e.type==="GeometryCollection"?(i.geometries=e.geometries.map(s=>cloneGeometry(s)),i):(i.coordinates=deepSlice(e.coordinates),i)}function deepSlice(e){const i=e;return typeof i[0]!="object"?i.slice():i.map(s=>deepSlice(s))}function toMercator(e,i={}){return convert(e,"mercator",i)}function toWgs84(e,i={}){return convert(e,"wgs84",i)}function convert(e,i,s={}){s=s||{};var a=s.mutate;if(!e)throw new Error("geojson is required");return Array.isArray(e)&&isNumber(e[0])?e=i==="mercator"?convertToMercator(e):convertToWgs84(e):(a!==!0&&(e=clone(e)),coordEach(e,function(b){var et=i==="mercator"?convertToMercator(b):convertToWgs84(b);b[0]=et[0],b[1]=et[1]})),e}function convertToMercator(e){var i=Math.PI/180,s=6378137,a=20037508342789244e-9,b=Math.abs(e[0])<=180?e[0]:e[0]-sign(e[0])*360,et=[s*b*i,s*Math.log(Math.tan(Math.PI*.25+.5*e[1]*i))];return et[0]>a&&(et[0]=a),et[0]<-a&&(et[0]=-a),et[1]>a&&(et[1]=a),et[1]<-a&&(et[1]=-a),et}function convertToWgs84(e){var i=180/Math.PI,s=6378137;return[e[0]*i/s,(Math.PI*.5-2*Math.atan(Math.exp(-e[1]/s)))*i]}function sign(e){return e<0?-1:e>0?1:0}function createMidpoint(e,i,s){const a=i.geometry.coordinates,b=s.geometry.coordinates;if(a[1]>LAT_RENDERED_MAX$1||a[1]<LAT_RENDERED_MIN$1||b[1]>LAT_RENDERED_MAX$1||b[1]<LAT_RENDERED_MIN$1)return null;const et=toMercator(a),nt=toMercator(b),c=St=>Number(St.toFixed(8)),ct=(St,Et)=>(St+Et)/2,pt=toWgs84([ct(et[0],nt[0]),ct(et[1],nt[1])]),xt=[c(pt[0]),c(pt[1])];return{type:geojsonTypes.FEATURE,properties:{meta:meta.MIDPOINT,parent:e,lng:xt[0],lat:xt[1],coord_path:s.properties.coord_path},geometry:{type:geojsonTypes.POINT,coordinates:xt}}}function createSupplementaryPoints(e,i={},s=null){const{type:a,coordinates:b}=e.geometry,et=e.properties&&e.properties.id;let nt=[];a===geojsonTypes.POINT?nt.push(createVertex(et,b,s,ct(s))):a===geojsonTypes.POLYGON?b.forEach((xt,St)=>{c(xt,s!==null?`${s}.${St}`:String(St))}):a===geojsonTypes.LINE_STRING?c(b,s):a.indexOf(geojsonTypes.MULTI_PREFIX)===0&&pt();function c(xt,St){let Et="",Rt=null;xt.forEach((Nt,It)=>{const Gt=St!=null?`${St}.${It}`:String(It),Dt=createVertex(et,Nt,Gt,ct(Gt));if(i.midpoints&&Rt){const Lt=createMidpoint(et,Rt,Dt);Lt&&nt.push(Lt)}Rt=Dt;const Bt=JSON.stringify(Nt);Et!==Bt&&nt.push(Dt),It===0&&(Et=Bt)})}function ct(xt){return i.selectedPaths?i.selectedPaths.indexOf(xt)!==-1:!1}function pt(){const xt=a.replace(geojsonTypes.MULTI_PREFIX,"");b.forEach((St,Et)=>{const Rt={type:geojsonTypes.FEATURE,properties:e.properties,geometry:{type:xt,coordinates:St}};nt=nt.concat(createSupplementaryPoints(Rt,i,Et))})}return nt}const doubleClickZoom={enable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.doubleClickZoom.disable()},0)}},{LAT_MIN,LAT_MAX,LAT_RENDERED_MIN,LAT_RENDERED_MAX,LNG_MIN,LNG_MAX}=Constants;function extent(e){const i={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[e.geometry.type],s=[e.geometry.coordinates].flat(i),a=s.map(c=>c[0]),b=s.map(c=>c[1]),et=c=>Math.min.apply(null,c),nt=c=>Math.max.apply(null,c);return[et(a),et(b),nt(a),nt(b)]}function constrainFeatureMovement(e,i){let s=LAT_MIN,a=LAT_MAX,b=LAT_MIN,et=LAT_MAX,nt=LNG_MAX,c=LNG_MIN;e.forEach(pt=>{const xt=extent(pt),St=xt[1],Et=xt[3],Rt=xt[0],Nt=xt[2];St>s&&(s=St),Et<a&&(a=Et),Et>b&&(b=Et),St<et&&(et=St),Rt<nt&&(nt=Rt),Nt>c&&(c=Nt)});const ct=i;return s+ct.lat>LAT_RENDERED_MAX&&(ct.lat=LAT_RENDERED_MAX-s),b+ct.lat>LAT_MAX&&(ct.lat=LAT_MAX-b),a+ct.lat<LAT_RENDERED_MIN&&(ct.lat=LAT_RENDERED_MIN-a),et+ct.lat<LAT_MIN&&(ct.lat=LAT_MIN-et),nt+ct.lng<=LNG_MIN&&(ct.lng+=Math.ceil(Math.abs(ct.lng)/360)*360),c+ct.lng>=LNG_MAX&&(ct.lng-=Math.ceil(Math.abs(ct.lng)/360)*360),ct}function moveFeatures(e,i){const s=constrainFeatureMovement(e.map(a=>a.toGeoJSON()),i);e.forEach(a=>{const b=a.getCoordinates(),et=pt=>{const xt={lng:pt[0]+s.lng,lat:pt[1]+s.lat};return[xt.lng,xt.lat]},nt=pt=>pt.map(xt=>et(xt)),c=pt=>pt.map(xt=>nt(xt));let ct;a.type===geojsonTypes.POINT?ct=et(b):a.type===geojsonTypes.LINE_STRING||a.type===geojsonTypes.MULTI_POINT?ct=b.map(et):a.type===geojsonTypes.POLYGON||a.type===geojsonTypes.MULTI_LINE_STRING?ct=b.map(nt):a.type===geojsonTypes.MULTI_POLYGON&&(ct=b.map(c)),a.incomingCoords(ct)})}const SimpleSelect={};SimpleSelect.onSetup=function(e){const i={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(i.initiallySelectedFeatureIds.filter(s=>this.getFeature(s)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),i};SimpleSelect.fireUpdate=function(){this.fire(events$1.UPDATE,{action:updateActions.MOVE,features:this.getSelected().map(e=>e.toGeoJSON())})};SimpleSelect.fireActionable=function(){const e=this.getSelected(),i=e.filter(et=>this.isInstanceOf("MultiFeature",et));let s=!1;if(e.length>1){s=!0;const et=e[0].type.replace("Multi","");e.forEach(nt=>{nt.type.replace("Multi","")!==et&&(s=!1)})}const a=i.length>0,b=e.length>0;this.setActionableState({combineFeatures:s,uncombineFeatures:a,trash:b})};SimpleSelect.getUniqueIds=function(e){return e.length?e.map(s=>s.properties.id).filter(s=>s!==void 0).reduce((s,a)=>(s.add(a),s),new StringSet).values():[]};SimpleSelect.stopExtendedInteractions=function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),(e.canDragMove||e.canBoxSelect)&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1};SimpleSelect.onStop=function(){doubleClickZoom.enable(this)};SimpleSelect.onMouseMove=function(e,i){return isFeature(i)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0};SimpleSelect.onMouseOut=function(e){return e.dragMoving?this.fireUpdate():!0};SimpleSelect.onTap=SimpleSelect.onClick=function(e,i){if(noTarget(i))return this.clickAnywhere(e,i);if(isOfMetaType(meta.VERTEX)(i))return this.clickOnVertex(e,i);if(isFeature(i))return this.clickOnFeature(e,i)};SimpleSelect.clickAnywhere=function(e){const i=this.getSelectedIds();i.length&&(this.clearSelectedFeatures(),i.forEach(s=>this.doRender(s))),doubleClickZoom.enable(this),this.stopExtendedInteractions(e)};SimpleSelect.clickOnVertex=function(e,i){this.changeMode(modes$1.DIRECT_SELECT,{featureId:i.featureTarget.properties.parent,coordPath:i.featureTarget.properties.coord_path,startPos:i.lngLat}),this.updateUIClasses({mouse:cursors.MOVE})};SimpleSelect.startOnActiveFeature=function(e,i){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(i.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=i.lngLat};SimpleSelect.clickOnFeature=function(e,i){doubleClickZoom.disable(this),this.stopExtendedInteractions(e);const s=isShiftDown(i),a=this.getSelectedIds(),b=i.featureTarget.properties.id,et=this.isSelected(b);if(!s&&et&&this.getFeature(b).type!==geojsonTypes.POINT)return this.changeMode(modes$1.DIRECT_SELECT,{featureId:b});et&&s?(this.deselect(b),this.updateUIClasses({mouse:cursors.POINTER}),a.length===1&&doubleClickZoom.enable(this)):!et&&s?(this.select(b),this.updateUIClasses({mouse:cursors.MOVE})):!et&&!s&&(a.forEach(nt=>this.doRender(nt)),this.setSelected(b),this.updateUIClasses({mouse:cursors.MOVE})),this.doRender(b)};SimpleSelect.onMouseDown=function(e,i){if(e.initialDragPanState=this.map.dragPan.isEnabled(),isActiveFeature(i))return this.startOnActiveFeature(e,i);if(this.drawConfig.boxSelect&&isShiftMousedown(i))return this.startBoxSelect(e,i)};SimpleSelect.startBoxSelect=function(e,i){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=mouseEventPoint(i.originalEvent,this.map.getContainer()),e.canBoxSelect=!0};SimpleSelect.onTouchStart=function(e,i){if(isActiveFeature(i))return this.startOnActiveFeature(e,i)};SimpleSelect.onDrag=function(e,i){if(e.canDragMove)return this.dragMove(e,i);if(this.drawConfig.boxSelect&&e.canBoxSelect)return this.whileBoxSelect(e,i)};SimpleSelect.whileBoxSelect=function(e,i){e.boxSelecting=!0,this.updateUIClasses({mouse:cursors.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(classes.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));const s=mouseEventPoint(i.originalEvent,this.map.getContainer()),a=Math.min(e.boxSelectStartLocation.x,s.x),b=Math.max(e.boxSelectStartLocation.x,s.x),et=Math.min(e.boxSelectStartLocation.y,s.y),nt=Math.max(e.boxSelectStartLocation.y,s.y),c=`translate(${a}px, ${et}px)`;e.boxSelectElement.style.transform=c,e.boxSelectElement.style.WebkitTransform=c,e.boxSelectElement.style.width=`${b-a}px`,e.boxSelectElement.style.height=`${nt-et}px`};SimpleSelect.dragMove=function(e,i){e.dragMoving=!0,i.originalEvent.stopPropagation();const s={lng:i.lngLat.lng-e.dragMoveLocation.lng,lat:i.lngLat.lat-e.dragMoveLocation.lat};moveFeatures(this.getSelected(),s),e.dragMoveLocation=i.lngLat};SimpleSelect.onTouchEnd=SimpleSelect.onMouseUp=function(e,i){if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){const s=[e.boxSelectStartLocation,mouseEventPoint(i.originalEvent,this.map.getContainer())],a=this.featuresAt(null,s,"click"),b=this.getUniqueIds(a).filter(et=>!this.isSelected(et));b.length&&(this.select(b),b.forEach(et=>this.doRender(et)),this.updateUIClasses({mouse:cursors.MOVE}))}this.stopExtendedInteractions(e)};SimpleSelect.toDisplayFeatures=function(e,i,s){i.properties.active=this.isSelected(i.properties.id)?activeStates.ACTIVE:activeStates.INACTIVE,s(i),this.fireActionable(),!(i.properties.active!==activeStates.ACTIVE||i.geometry.type===geojsonTypes.POINT)&&createSupplementaryPoints(i).forEach(s)};SimpleSelect.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()};SimpleSelect.onCombineFeatures=function(){const e=this.getSelected();if(e.length===0||e.length<2)return;const i=[],s=[],a=e[0].type.replace("Multi","");for(let b=0;b<e.length;b++){const et=e[b];if(et.type.replace("Multi","")!==a)return;et.type.includes("Multi")?et.getCoordinates().forEach(nt=>{i.push(nt)}):i.push(et.getCoordinates()),s.push(et.toGeoJSON())}if(s.length>1){const b=this.newFeature({type:geojsonTypes.FEATURE,properties:s[0].properties,geometry:{type:`Multi${a}`,coordinates:i}});this.addFeature(b),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([b.id]),this.fire(events$1.COMBINE_FEATURES,{createdFeatures:[b.toGeoJSON()],deletedFeatures:s})}this.fireActionable()};SimpleSelect.onUncombineFeatures=function(){const e=this.getSelected();if(e.length===0)return;const i=[],s=[];for(let a=0;a<e.length;a++){const b=e[a];this.isInstanceOf("MultiFeature",b)&&(b.getFeatures().forEach(et=>{this.addFeature(et),et.properties=b.properties,i.push(et.toGeoJSON()),this.select([et.id])}),this.deleteFeature(b.id,{silent:!0}),s.push(b.toGeoJSON()))}i.length>1&&this.fire(events$1.UNCOMBINE_FEATURES,{createdFeatures:i,deletedFeatures:s}),this.fireActionable()};const isVertex=isOfMetaType(meta.VERTEX),isMidpoint=isOfMetaType(meta.MIDPOINT),DirectSelect={};DirectSelect.fireUpdate=function(){this.fire(events$1.UPDATE,{action:updateActions.CHANGE_COORDINATES,features:this.getSelected().map(e=>e.toGeoJSON())})};DirectSelect.fireActionable=function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})};DirectSelect.startDragging=function(e,i){e.initialDragPanState==null&&(e.initialDragPanState=this.map.dragPan.isEnabled()),this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=i.lngLat};DirectSelect.stopDragging=function(e){e.canDragMove&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.initialDragPanState=null,e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null};DirectSelect.onVertex=function(e,i){this.startDragging(e,i);const s=i.featureTarget.properties,a=e.selectedCoordPaths.indexOf(s.coord_path);!isShiftDown(i)&&a===-1?e.selectedCoordPaths=[s.coord_path]:isShiftDown(i)&&a===-1&&e.selectedCoordPaths.push(s.coord_path);const b=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(b)};DirectSelect.onMidpoint=function(e,i){this.startDragging(e,i);const s=i.featureTarget.properties;e.feature.addCoordinate(s.coord_path,s.lng,s.lat),this.fireUpdate(),e.selectedCoordPaths=[s.coord_path]};DirectSelect.pathsToCoordinates=function(e,i){return i.map(s=>({feature_id:e,coord_path:s}))};DirectSelect.onFeature=function(e,i){e.selectedCoordPaths.length===0?this.startDragging(e,i):this.stopDragging(e)};DirectSelect.dragFeature=function(e,i,s){moveFeatures(this.getSelected(),s),e.dragMoveLocation=i.lngLat};DirectSelect.dragVertex=function(e,i,s){const a=e.selectedCoordPaths.map(nt=>e.feature.getCoordinate(nt)),b=a.map(nt=>({type:geojsonTypes.FEATURE,properties:{},geometry:{type:geojsonTypes.POINT,coordinates:nt}})),et=constrainFeatureMovement(b,s);for(let nt=0;nt<a.length;nt++){const c=a[nt];e.feature.updateCoordinate(e.selectedCoordPaths[nt],c[0]+et.lng,c[1]+et.lat)}};DirectSelect.clickNoTarget=function(){this.changeMode(modes$1.SIMPLE_SELECT)};DirectSelect.clickInactive=function(){this.changeMode(modes$1.SIMPLE_SELECT)};DirectSelect.clickActiveFeature=function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()};DirectSelect.onSetup=function(e){const i=e.featureId,s=this.getFeature(i);if(!s)throw new Error("You must provide a featureId to enter direct_select mode");if(s.type===geojsonTypes.POINT)throw new TypeError("direct_select mode doesn't handle point features");const a={featureId:i,feature:s,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(i,a.selectedCoordPaths)),this.setSelected(i),doubleClickZoom.disable(this),this.setActionableState({trash:!0}),a};DirectSelect.onStop=function(){doubleClickZoom.enable(this),this.clearSelectedCoordinates()};DirectSelect.toDisplayFeatures=function(e,i,s){e.featureId===i.properties.id?(i.properties.active=activeStates.ACTIVE,s(i),createSupplementaryPoints(i,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(s)):(i.properties.active=activeStates.INACTIVE,s(i)),this.fireActionable(e)};DirectSelect.onTrash=function(e){e.selectedCoordPaths.sort((i,s)=>s.localeCompare(i,"en",{numeric:!0})).forEach(i=>e.feature.removeCoordinate(i)),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(modes$1.SIMPLE_SELECT,{}))};DirectSelect.onMouseMove=function(e,i){const s=isActiveFeature(i),a=isVertex(i),b=isMidpoint(i),et=e.selectedCoordPaths.length===0;return s&&et?this.updateUIClasses({mouse:cursors.MOVE}):a&&!et?this.updateUIClasses({mouse:cursors.MOVE}):this.updateUIClasses({mouse:cursors.NONE}),(a||s||b)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0};DirectSelect.onMouseOut=function(e){return e.dragMoving&&this.fireUpdate(),!0};DirectSelect.onTouchStart=DirectSelect.onMouseDown=function(e,i){if(isVertex(i))return this.onVertex(e,i);if(isActiveFeature(i))return this.onFeature(e,i);if(isMidpoint(i))return this.onMidpoint(e,i)};DirectSelect.onDrag=function(e,i){if(e.canDragMove!==!0)return;e.dragMoving=!0,i.originalEvent.stopPropagation();const s={lng:i.lngLat.lng-e.dragMoveLocation.lng,lat:i.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,i,s):this.dragFeature(e,i,s),e.dragMoveLocation=i.lngLat};DirectSelect.onClick=function(e,i){if(noTarget(i))return this.clickNoTarget(e,i);if(isActiveFeature(i))return this.clickActiveFeature(e,i);if(isInactiveFeature(i))return this.clickInactive(e,i);this.stopDragging(e)};DirectSelect.onTap=function(e,i){if(noTarget(i))return this.clickNoTarget(e,i);if(isActiveFeature(i))return this.clickActiveFeature(e,i);if(isInactiveFeature(i))return this.clickInactive(e,i)};DirectSelect.onTouchEnd=DirectSelect.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};const DrawPoint={};DrawPoint.onSetup=function(){const e=this.newFeature({type:geojsonTypes.FEATURE,properties:{},geometry:{type:geojsonTypes.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:cursors.ADD}),this.activateUIButton(types$1.POINT),this.setActionableState({trash:!0}),{point:e}};DrawPoint.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT)};DrawPoint.onTap=DrawPoint.onClick=function(e,i){this.updateUIClasses({mouse:cursors.MOVE}),e.point.updateCoordinate("",i.lngLat.lng,i.lngLat.lat),this.fire(events$1.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.point.id]})};DrawPoint.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})};DrawPoint.toDisplayFeatures=function(e,i,s){const a=i.properties.id===e.point.id;if(i.properties.active=a?activeStates.ACTIVE:activeStates.INACTIVE,!a)return s(i)};DrawPoint.onTrash=DrawPoint.stopDrawingAndRemove;DrawPoint.onKeyUp=function(e,i){if(isEscapeKey(i)||isEnterKey(i))return this.stopDrawingAndRemove(e,i)};function isEventAtCoordinates(e,i){return e.lngLat?e.lngLat.lng===i[0]&&e.lngLat.lat===i[1]:!1}const DrawPolygon={};DrawPolygon.onSetup=function(){const e=this.newFeature({type:geojsonTypes.FEATURE,properties:{},geometry:{type:geojsonTypes.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),doubleClickZoom.disable(this),this.updateUIClasses({mouse:cursors.ADD}),this.activateUIButton(types$1.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}};DrawPolygon.clickAnywhere=function(e,i){if(e.currentVertexPosition>0&&isEventAtCoordinates(i,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:cursors.ADD}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,i.lngLat.lng,i.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,i.lngLat.lng,i.lngLat.lat)};DrawPolygon.clickOnVertex=function(e){return this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};DrawPolygon.onMouseMove=function(e,i){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,i.lngLat.lng,i.lngLat.lat),isVertex$1(i)&&this.updateUIClasses({mouse:cursors.POINTER})};DrawPolygon.onTap=DrawPolygon.onClick=function(e,i){return isVertex$1(i)?this.clickOnVertex(e,i):this.clickAnywhere(e,i)};DrawPolygon.onKeyUp=function(e,i){isEscapeKey(i)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT)):isEnterKey(i)&&this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};DrawPolygon.onStop=function(e){this.updateUIClasses({mouse:cursors.NONE}),doubleClickZoom.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.fire(events$1.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT,{},{silent:!0})))};DrawPolygon.toDisplayFeatures=function(e,i,s){const a=i.properties.id===e.polygon.id;if(i.properties.active=a?activeStates.ACTIVE:activeStates.INACTIVE,!a)return s(i);if(i.geometry.coordinates.length===0)return;const b=i.geometry.coordinates[0].length;if(!(b<3)){if(i.properties.meta=meta.FEATURE,s(createVertex(e.polygon.id,i.geometry.coordinates[0][0],"0.0",!1)),b>3){const et=i.geometry.coordinates[0].length-3;s(createVertex(e.polygon.id,i.geometry.coordinates[0][et],`0.${et}`,!1))}if(b<=4){const et=[[i.geometry.coordinates[0][0][0],i.geometry.coordinates[0][0][1]],[i.geometry.coordinates[0][1][0],i.geometry.coordinates[0][1][1]]];if(s({type:geojsonTypes.FEATURE,properties:i.properties,geometry:{coordinates:et,type:geojsonTypes.LINE_STRING}}),b===3)return}return s(i)}};DrawPolygon.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT)};const DrawLineString={};DrawLineString.onSetup=function(e){e=e||{};const i=e.featureId;let s,a,b="forward";if(i){if(s=this.getFeature(i),!s)throw new Error("Could not find a feature with the provided featureId");let et=e.from;if(et&&et.type==="Feature"&&et.geometry&&et.geometry.type==="Point"&&(et=et.geometry),et&&et.type==="Point"&&et.coordinates&&et.coordinates.length===2&&(et=et.coordinates),!et||!Array.isArray(et))throw new Error("Please use the `from` property to indicate which point to continue the line from");const nt=s.coordinates.length-1;if(s.coordinates[nt][0]===et[0]&&s.coordinates[nt][1]===et[1])a=nt+1,s.addCoordinate(a,...s.coordinates[nt]);else if(s.coordinates[0][0]===et[0]&&s.coordinates[0][1]===et[1])b="backwards",a=0,s.addCoordinate(a,...s.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else s=this.newFeature({type:geojsonTypes.FEATURE,properties:{},geometry:{type:geojsonTypes.LINE_STRING,coordinates:[]}}),a=0,this.addFeature(s);return this.clearSelectedFeatures(),doubleClickZoom.disable(this),this.updateUIClasses({mouse:cursors.ADD}),this.activateUIButton(types$1.LINE),this.setActionableState({trash:!0}),{line:s,currentVertexPosition:a,direction:b}};DrawLineString.clickAnywhere=function(e,i){if(e.currentVertexPosition>0&&isEventAtCoordinates(i,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&isEventAtCoordinates(i,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:cursors.ADD}),e.line.updateCoordinate(e.currentVertexPosition,i.lngLat.lng,i.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,i.lngLat.lng,i.lngLat.lat)):e.line.addCoordinate(0,i.lngLat.lng,i.lngLat.lat)};DrawLineString.clickOnVertex=function(e){return this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.line.id]})};DrawLineString.onMouseMove=function(e,i){e.line.updateCoordinate(e.currentVertexPosition,i.lngLat.lng,i.lngLat.lat),isVertex$1(i)&&this.updateUIClasses({mouse:cursors.POINTER})};DrawLineString.onTap=DrawLineString.onClick=function(e,i){if(isVertex$1(i))return this.clickOnVertex(e,i);this.clickAnywhere(e,i)};DrawLineString.onKeyUp=function(e,i){isEnterKey(i)?this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.line.id]}):isEscapeKey(i)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT))};DrawLineString.onStop=function(e){doubleClickZoom.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.fire(events$1.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT,{},{silent:!0})))};DrawLineString.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT)};DrawLineString.toDisplayFeatures=function(e,i,s){const a=i.properties.id===e.line.id;if(i.properties.active=a?activeStates.ACTIVE:activeStates.INACTIVE,!a)return s(i);i.geometry.coordinates.length<2||(i.properties.meta=meta.FEATURE,s(createVertex(e.line.id,i.geometry.coordinates[e.direction==="forward"?i.geometry.coordinates.length-2:1],`${e.direction==="forward"?i.geometry.coordinates.length-2:1}`,!1)),s(i))};const modes={simple_select:SimpleSelect,direct_select:DirectSelect,draw_point:DrawPoint,draw_polygon:DrawPolygon,draw_line_string:DrawLineString},defaultOptions={defaultMode:modes$1.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles,modes,controls:{},userProperties:!1,suppressAPIEvents:!0},showControls={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},hideControls={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function addSources(e,i){return e.map(s=>s.source?s:Object.assign({},s,{id:`${s.id}.${i}`,source:i==="hot"?sources.HOT:sources.COLD}))}function setupOptions(e={}){let i=Object.assign({},e);return e.controls||(i.controls={}),e.displayControlsDefault===!1?i.controls=Object.assign({},hideControls,e.controls):i.controls=Object.assign({},showControls,e.controls),i=Object.assign({},defaultOptions,i),i.styles=addSources(i.styles,"cold").concat(addSources(i.styles,"hot")),i}var fastDeepEqual=function e(i,s){if(i===s)return!0;if(i&&s&&typeof i=="object"&&typeof s=="object"){if(i.constructor!==s.constructor)return!1;var a,b,et;if(Array.isArray(i)){if(a=i.length,a!=s.length)return!1;for(b=a;b--!==0;)if(!e(i[b],s[b]))return!1;return!0}if(i.constructor===RegExp)return i.source===s.source&&i.flags===s.flags;if(i.valueOf!==Object.prototype.valueOf)return i.valueOf()===s.valueOf();if(i.toString!==Object.prototype.toString)return i.toString()===s.toString();if(et=Object.keys(i),a=et.length,a!==Object.keys(s).length)return!1;for(b=a;b--!==0;)if(!Object.prototype.hasOwnProperty.call(s,et[b]))return!1;for(b=a;b--!==0;){var nt=et[b];if(!e(i[nt],s[nt]))return!1}return!0}return i!==i&&s!==s};const isEqual=getDefaultExportFromCjs(fastDeepEqual);var geojsonNormalize=normalize,types={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function normalize(e){if(!e||!e.type)return null;var i=types[e.type];if(!i)return null;if(i==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]};if(i==="feature")return{type:"FeatureCollection",features:[e]};if(i==="featurecollection")return e}const normalize$1=getDefaultExportFromCjs(geojsonNormalize);function stringSetsAreEqual(e,i){return e.length!==i.length?!1:JSON.stringify(e.map(s=>s).sort())===JSON.stringify(i.map(s=>s).sort())}const featureTypes={Polygon,LineString,Point:Point$1,MultiPolygon:MultiFeature,MultiLineString:MultiFeature,MultiPoint:MultiFeature};function setupAPI(e,i){i.modes=modes$1;const s=e.options.suppressAPIEvents!==void 0?!!e.options.suppressAPIEvents:!0;return i.getFeatureIdsAt=function(a){return featuresAt.click({point:a},null,e).map(et=>et.properties.id)},i.getSelectedIds=function(){return e.store.getSelectedIds()},i.getSelected=function(){return{type:geojsonTypes.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(a=>e.store.get(a)).map(a=>a.toGeoJSON())}},i.getSelectedPoints=function(){return{type:geojsonTypes.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(a=>({type:geojsonTypes.FEATURE,properties:{},geometry:{type:geojsonTypes.POINT,coordinates:a.coordinates}}))}},i.set=function(a){if(a.type===void 0||a.type!==geojsonTypes.FEATURE_COLLECTION||!Array.isArray(a.features))throw new Error("Invalid FeatureCollection");const b=e.store.createRenderBatch();let et=e.store.getAllIds().slice();const nt=i.add(a),c=new StringSet(nt);return et=et.filter(ct=>!c.has(ct)),et.length&&i.delete(et),b(),nt},i.add=function(a){const et=JSON.parse(JSON.stringify(normalize$1(a))).features.map(nt=>{if(nt.id=nt.id||generateID(),nt.geometry===null)throw new Error("Invalid geometry: null");if(e.store.get(nt.id)===void 0||e.store.get(nt.id).type!==nt.geometry.type){const c=featureTypes[nt.geometry.type];if(c===void 0)throw new Error(`Invalid geometry type: ${nt.geometry.type}.`);const ct=new c(e,nt);e.store.add(ct,{silent:s})}else{const c=e.store.get(nt.id),ct=c.properties;c.properties=nt.properties,isEqual(ct,nt.properties)||e.store.featureChanged(c.id,{silent:s}),isEqual(c.getCoordinates(),nt.geometry.coordinates)||c.incomingCoords(nt.geometry.coordinates)}return nt.id});return e.store.render(),et},i.get=function(a){const b=e.store.get(a);if(b)return b.toGeoJSON()},i.getAll=function(){return{type:geojsonTypes.FEATURE_COLLECTION,features:e.store.getAll().map(a=>a.toGeoJSON())}},i.delete=function(a){return e.store.delete(a,{silent:s}),i.getMode()===modes$1.DIRECT_SELECT&&!e.store.getSelectedIds().length?e.events.changeMode(modes$1.SIMPLE_SELECT,void 0,{silent:s}):e.store.render(),i},i.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:s}),i.getMode()===modes$1.DIRECT_SELECT?e.events.changeMode(modes$1.SIMPLE_SELECT,void 0,{silent:s}):e.store.render(),i},i.changeMode=function(a,b={}){return a===modes$1.SIMPLE_SELECT&&i.getMode()===modes$1.SIMPLE_SELECT?(stringSetsAreEqual(b.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(b.featureIds,{silent:s}),e.store.render()),i):(a===modes$1.DIRECT_SELECT&&i.getMode()===modes$1.DIRECT_SELECT&&b.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(a,b,{silent:s}),i)},i.getMode=function(){return e.events.getMode()},i.trash=function(){return e.events.trash({silent:s}),i},i.combineFeatures=function(){return e.events.combineFeatures({silent:s}),i},i.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:s}),i},i.setFeatureProperty=function(a,b,et){return e.store.setFeatureProperty(a,b,et,{silent:s}),i},i}const lib=Object.freeze(Object.defineProperty({__proto__:null,CommonSelectors:common_selectors,ModeHandler,StringSet,constrainFeatureMovement,createMidPoint:createMidpoint,createSupplementaryPoints,createVertex,doubleClickZoom,euclideanDistance,featuresAt,getFeatureAtAndSetCursors,isClick,isEventAtCoordinates,isTap,mapEventToBoundingBox,moveFeatures,sortFeatures,stringSetsAreEqual,theme:styles,toDenseArray},Symbol.toStringTag,{value:"Module"})),setupDraw=function(e,i){e=setupOptions(e);const s={options:e};i=setupAPI(s,i),s.api=i;const a=runSetup(s);return i.onAdd=a.onAdd,i.onRemove=a.onRemove,i.types=types$1,i.options=e,i};function MapboxDraw(e){setupDraw(e,this)}MapboxDraw.modes=modes;MapboxDraw.constants=Constants;MapboxDraw.lib=lib;function ZoneDrawer({onZoneChange:e,initialZone:i,height:s="400px",showCurrentLocation:a=!0}){const b=reactExports.useRef(null),et=reactExports.useRef(null),nt=reactExports.useRef(null),c=reactExports.useRef(null),[ct,pt]=reactExports.useState(!0),[xt,St]=reactExports.useState(!!i),[Et,Rt]=reactExports.useState(null),[Nt,It]=reactExports.useState(!1),Gt=()=>{navigator.geolocation&&(It(!0),navigator.geolocation.getCurrentPosition(Bt=>{var Zt;const{latitude:Lt,longitude:Vt}=Bt.coords;if(Rt({lat:Lt,lng:Vt}),c.current)c.current.setLngLat([Vt,Lt]);else if(et.current){const nr=document.createElement("div");nr.className="current-location-marker",nr.innerHTML=`
            <div style="
              width: 20px;
              height: 20px;
              background: hsl(24, 95%, 53%);
              border: 3px solid white;
              border-radius: 50%;
              box-shadow: 0 2px 8px rgba(0,0,0,0.3);
              position: relative;
            ">
              <div style="
                position: absolute;
                width: 40px;
                height: 40px;
                background: hsla(24, 95%, 53%, 0.2);
                border-radius: 50%;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                animation: pulse 2s infinite;
              "></div>
            </div>
          `,c.current=new mapboxgl.Marker(nr).setLngLat([Vt,Lt]).setPopup(new mapboxgl.Popup({offset:25}).setText("Your current location")).addTo(et.current)}(Zt=et.current)==null||Zt.flyTo({center:[Vt,Lt],zoom:13,duration:1500}),It(!1)},Bt=>{console.error("Location error:",Bt),It(!1)},{enableHighAccuracy:!0,timeout:1e4}))};reactExports.useEffect(()=>{if(!b.current)return;mapboxgl.accessToken=MAPBOX_ACCESS_TOKEN,et.current=new mapboxgl.Map({container:b.current,style:"mapbox://styles/mapbox/streets-v12",center:[78.4867,17.385],zoom:10,attributionControl:!1}),nt.current=new MapboxDraw({displayControlsDefault:!1,controls:{polygon:!0,trash:!0},defaultMode:"simple_select",styles:[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#f97316","fill-outline-color":"#f97316","fill-opacity":.2}},{id:"gl-draw-polygon-stroke",type:"line",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#f97316","line-width":3}},{id:"gl-draw-polygon-and-line-vertex-halo-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#f97316"}}]}),et.current.addControl(nt.current,"top-left"),et.current.addControl(new mapboxgl.NavigationControl,"bottom-right"),et.current.on("load",()=>{var Lt;if(pt(!1),i&&nt.current){const Vt={type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:i.coordinates}};nt.current.add(Vt),St(!0);const Zt=i.coordinates[0],nr=new mapboxgl.LngLatBounds;Zt.forEach(ur=>nr.extend([ur[0],ur[1]])),(Lt=et.current)==null||Lt.fitBounds(nr,{padding:50})}}),et.current.on("draw.create",Bt),et.current.on("draw.update",Bt),et.current.on("draw.delete",()=>{St(!1),e(null)});function Bt(){if(!nt.current)return;const Lt=nt.current.getAll();if(Lt.features.length>0){const Vt=Lt.features.filter(ur=>ur.geometry.type==="Polygon");if(Vt.length>1)for(let ur=0;ur<Vt.length-1;ur++)nt.current.delete(Vt[ur].id);const Zt=Vt[Vt.length-1],nr=geoJSONToZonePolygon(Zt);St(!!nr),e(nr)}else St(!1),e(null)}return a&&Gt(),()=>{var Lt,Vt;(Lt=c.current)==null||Lt.remove(),(Vt=et.current)==null||Vt.remove()}},[]);const Dt=()=>{nt.current&&(nt.current.deleteAll(),St(!1),e(null))};return jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx("style",{children:`
        @keyframes pulse {
          0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
          100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
        }
      `}),jsxRuntimeExports.jsxs("div",{className:"relative rounded-xl overflow-hidden",style:{height:s},children:[jsxRuntimeExports.jsx("div",{ref:b,className:"absolute inset-0"}),ct&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-6 h-6 animate-spin text-primary"})}),a&&jsxRuntimeExports.jsx(Button,{size:"sm",variant:"secondary",className:"absolute bottom-3 left-3 shadow-lg",onClick:Gt,disabled:Nt,children:Nt?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Navigation,{className:"w-4 h-4 mr-1"}),"My Location"]})}),jsxRuntimeExports.jsx("div",{className:"absolute top-3 right-3 bg-card/90 backdrop-blur-sm rounded-lg px-3 py-2 max-w-[200px]",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:xt?"Zone drawn! Click on the zone to edit or delete.":"Click the polygon tool (top-left) to draw a service zone."})}),Et&&jsxRuntimeExports.jsx("div",{className:"absolute top-3 left-14 bg-card/90 backdrop-blur-sm rounded-lg px-3 py-2",children:jsxRuntimeExports.jsxs("p",{className:"text-xs text-primary font-medium flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"w-2 h-2 bg-primary rounded-full animate-pulse"}),"Live Location"]})})]}),xt&&jsxRuntimeExports.jsxs(Button,{variant:"outline",className:"w-full text-destructive border-destructive",onClick:Dt,children:[jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4 mr-2"})," Clear Zone"]})]})}const ALL_ROLES=[{value:"user",label:"User"},{value:"amma",label:"Amma"},{value:"admin",label:"Admin"},{value:"franchise_admin",label:"Franchise Admin"},{value:"super_admin",label:"Super Admin"}];function SuperAdminDashboard(){const{user:e,signOut:i}=useAuth(),s=useNavigate(),{isAuthorized:a,isLoading:b}=useRoleRedirect(["super_admin","admin"]),{franchises:et,loading:nt}=useFranchises(),{users:c,refetch:ct}=useAllUsersForAdmin(),{kitchens:pt}=useAllKitchens(),[xt,St]=reactExports.useState("franchises"),[Et,Rt]=reactExports.useState(!1),Nt=async()=>{if(confirm('CRITICAL WARNING: This will delete ALL users, franchises, kitchens, dishes, and orders. Only the Super Admin account will remain. This action cannot be undone. Type "DELETE" to confirm.')&&prompt('Type "DELETE" to confirm database reset:')==="DELETE"){Rt(!0);try{await clearAllDataExceptSuperAdmin(),ue.success("Database has been reset successfully"),ct(),window.location.reload()}catch{ue.error("Failed to reset database")}finally{Rt(!1)}}},[It,Gt]=reactExports.useState(!1),[Dt,Bt]=reactExports.useState(!1),[Lt,Vt]=reactExports.useState(!1),[Zt,nr]=reactExports.useState(null),[ur,_r]=reactExports.useState("user"),[Ur,ln]=reactExports.useState(!1),[an,Fr]=reactExports.useState(!1),[rn,gn]=reactExports.useState(!1),[_i,xr]=reactExports.useState({name:"",description:"",adminId:"",zone:null}),[gr,rr]=reactExports.useState({email:"",password:"",name:"",phone:""}),cr=c.filter(Nn=>Nn.role==="user"||Nn.role==="admin"||Nn.role==="franchise_admin"),Hr=pt.filter(Nn=>!Nn.isApproved),$r=async()=>{if(!gr.email||!gr.password||!gr.name||!gr.phone){ue.error("Please fill all fields");return}if(gr.password.length<6){ue.error("Password must be at least 6 characters");return}Fr(!0);try{await createFranchiseAdmin(gr.email,gr.password,gr.name,gr.phone),ue.success("Franchise Admin created successfully!"),Bt(!1),rr({email:"",password:"",name:"",phone:""}),ct()}catch(Nn){ue.error(Nn.message||"Failed to create admin")}finally{Fr(!1)}},_n=async Nn=>{try{await approveKitchen(Nn),ue.success("Kitchen approved!")}catch{ue.error("Failed to approve kitchen")}},fn=async Nn=>{if(confirm("Are you sure you want to reject this kitchen?"))try{await rejectKitchen(Nn),ue.success("Kitchen rejected")}catch{ue.error("Failed to reject kitchen")}},jn=async()=>{if(!Zt)return;if(Zt.currentRole==="amma"&&ur!=="amma"||Zt.currentRole==="franchise_admin"&&ur!=="franchise_admin"){const ls=Zt.currentRole==="amma"?"kitchens and dishes":"franchise assignment";if(!confirm(`Warning: Changing this role will delete all ${ls} for this user. Continue?`))return}gn(!0);try{await updateUserRole(Zt.id,ur,Zt.currentRole),ue.success(`Role updated to ${ur.replace("_"," ")}`),Vt(!1),nr(null),ct()}catch{ue.error("Failed to update role")}finally{gn(!1)}},vs=(Nn,ls,ms)=>{nr({id:Nn,name:ls,currentRole:ms}),_r(ms),Vt(!0)},Cs=async()=>{if(!e)return;if(!_i.name||!_i.adminId||!_i.zone){ue.error("Please fill all fields and draw a zone");return}const Nn=c.find(ls=>ls.id===_i.adminId);if(!Nn){ue.error("Invalid admin selected");return}ln(!0);try{await createFranchise({name:_i.name,description:_i.description,adminId:_i.adminId,adminName:Nn.name,adminEmail:Nn.email,zone:_i.zone,isActive:!0,createdAt:Date.now(),createdBy:e.id}),ue.success("Franchise created successfully!"),Gt(!1),xr({name:"",description:"",adminId:"",zone:null})}catch{ue.error("Failed to create franchise")}finally{ln(!1)}},ns=async(Nn,ls)=>{if(confirm("Are you sure you want to delete this franchise?"))try{await deleteFranchise(Nn,ls),ue.success("Franchise deleted")}catch{ue.error("Failed to delete franchise")}};return b||!a?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Super Admin"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Franchise Management"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[Hr.length>0&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-gold text-foreground text-xs",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-3 h-3"}),Hr.length," pending"]}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",onClick:async()=>{await i(),s("/auth")},className:"text-destructive",children:"Logout"})]})]}),jsxRuntimeExports.jsx("div",{className:"flex bg-secondary mx-4 rounded-xl p-1 mb-4",children:["franchises","users","kitchens","system"].map(Nn=>jsxRuntimeExports.jsx("button",{onClick:()=>St(Nn),className:`flex-1 py-2 rounded-lg text-sm font-medium transition-all capitalize ${xt===Nn?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:Nn},Nn))})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[xt==="franchises"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-foreground",children:["Franchises (",et.length,")"]}),jsxRuntimeExports.jsxs(Dialog,{open:It,onOpenChange:Gt,children:[jsxRuntimeExports.jsx(DialogTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{size:"sm",className:"gradient-primary text-primary-foreground",children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4 mr-1"})," Add Franchise"]})}),jsxRuntimeExports.jsxs(DialogContent,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(DialogTitle,{children:"Create New Franchise"})}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 mt-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Franchise Name"}),jsxRuntimeExports.jsx(Input,{placeholder:"e.g., Hyderabad Central",value:_i.name,onChange:Nn=>xr({..._i,name:Nn.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Description"}),jsxRuntimeExports.jsx(Textarea,{placeholder:"Brief description of this franchise area...",value:_i.description,onChange:Nn=>xr({..._i,description:Nn.target.value}),className:"bg-secondary border-0 mt-1 resize-none",rows:2})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Assign Franchise Admin"}),jsxRuntimeExports.jsxs(Select,{value:_i.adminId,onValueChange:Nn=>xr({..._i,adminId:Nn}),children:[jsxRuntimeExports.jsx(SelectTrigger,{className:"bg-secondary border-0 mt-1",children:jsxRuntimeExports.jsx(SelectValue,{placeholder:"Select a user to assign as admin"})}),jsxRuntimeExports.jsx(SelectContent,{children:cr.map(Nn=>jsxRuntimeExports.jsxs(SelectItem,{value:Nn.id,children:[Nn.name," (",Nn.email,")"]},Nn.id))})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Draw Service Zone"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Draw a polygon on the map to define the service area"}),jsxRuntimeExports.jsx(ZoneDrawer,{onZoneChange:Nn=>xr({..._i,zone:Nn}),height:"300px"})]}),jsxRuntimeExports.jsx(Button,{onClick:Cs,disabled:Ur,className:"w-full gradient-primary text-primary-foreground",children:Ur?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin"}):"Create Franchise"})]})]})]})]}),nt?jsxRuntimeExports.jsx("div",{className:"flex justify-center py-8",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):et.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Store$1,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No franchises yet"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Create your first franchise to get started"})]}):et.map(Nn=>jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:Nn.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:Nn.description})]}),jsxRuntimeExports.jsx("span",{className:cn("px-2 py-1 rounded-full text-xs font-medium",Nn.isActive?"bg-veg/20 text-veg":"bg-muted text-muted-foreground"),children:Nn.isActive?"Active":"Inactive"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx(Users,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:Nn.adminName})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx(Store$1,{className:"w-4 h-4"}),jsxRuntimeExports.jsxs("span",{children:[pt.filter(ls=>ls.franchiseId===Nn.id).length," kitchens"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",onClick:()=>s(`/super-admin/franchise/${Nn.id}`),children:[jsxRuntimeExports.jsx(Eye,{className:"w-4 h-4 mr-1"})," View"]}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",className:"text-destructive border-destructive",onClick:()=>ns(Nn.id,Nn.adminId),children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]})]},Nn.id))]}),xt==="users"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-foreground",children:["All Users (",c.length,")"]}),jsxRuntimeExports.jsxs(Dialog,{open:Dt,onOpenChange:Bt,children:[jsxRuntimeExports.jsx(DialogTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{size:"sm",className:"gradient-primary text-primary-foreground",children:[jsxRuntimeExports.jsx(UserPlus,{className:"w-4 h-4 mr-1"})," Create Admin"]})}),jsxRuntimeExports.jsxs(DialogContent,{className:"max-w-md",children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(DialogTitle,{children:"Create Franchise Admin"})}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 mt-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Name"}),jsxRuntimeExports.jsx(Input,{placeholder:"Admin Name",value:gr.name,onChange:Nn=>rr({...gr,name:Nn.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Email"}),jsxRuntimeExports.jsx(Input,{type:"email",placeholder:"admin@example.com",value:gr.email,onChange:Nn=>rr({...gr,email:Nn.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Phone"}),jsxRuntimeExports.jsx(Input,{placeholder:"9876543210",value:gr.phone,onChange:Nn=>rr({...gr,phone:Nn.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Password"}),jsxRuntimeExports.jsx(Input,{type:"password",placeholder:"Min 6 characters",value:gr.password,onChange:Nn=>rr({...gr,password:Nn.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsx(Button,{onClick:$r,disabled:an,className:"w-full gradient-primary text-primary-foreground",children:an?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin"}):"Create Franchise Admin"})]})]})]})]}),c.map(Nn=>jsxRuntimeExports.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:Nn.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:Nn.email})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:cn("px-2 py-1 rounded-full text-xs font-medium capitalize",Nn.role==="super_admin"&&"bg-primary/20 text-primary",Nn.role==="franchise_admin"&&"bg-accent/20 text-accent-foreground",Nn.role==="amma"&&"bg-veg/20 text-veg",Nn.role==="admin"&&"bg-gold/20 text-gold",Nn.role==="user"&&"bg-secondary text-secondary-foreground"),children:Nn.role.replace("_"," ")}),Nn.id!==(e==null?void 0:e.id)&&jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",onClick:()=>vs(Nn.id,Nn.name,Nn.role),children:jsxRuntimeExports.jsx(SquarePen,{className:"w-3 h-3"})})]})]})},Nn.id)),jsxRuntimeExports.jsx(Dialog,{open:Lt,onOpenChange:Vt,children:jsxRuntimeExports.jsxs(DialogContent,{className:"max-w-sm",children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(DialogTitle,{children:"Change User Role"})}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 mt-4",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground",children:["Change role for ",jsxRuntimeExports.jsx("span",{className:"font-medium text-foreground",children:Zt==null?void 0:Zt.name})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"New Role"}),jsxRuntimeExports.jsxs(Select,{value:ur,onValueChange:Nn=>_r(Nn),children:[jsxRuntimeExports.jsx(SelectTrigger,{className:"bg-secondary border-0 mt-1",children:jsxRuntimeExports.jsx(SelectValue,{})}),jsxRuntimeExports.jsx(SelectContent,{children:ALL_ROLES.map(Nn=>jsxRuntimeExports.jsx(SelectItem,{value:Nn.value,children:Nn.label},Nn.value))})]})]}),jsxRuntimeExports.jsx(Button,{onClick:jn,disabled:rn||ur===(Zt==null?void 0:Zt.currentRole),className:"w-full gradient-primary text-primary-foreground",children:rn?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin"}):"Update Role"})]})]})})]}),xt==="kitchens"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-foreground",children:["All Kitchens (",pt.length,")"]}),Hr.length>0&&jsxRuntimeExports.jsxs("div",{className:"bg-gold/10 rounded-2xl p-4 mb-4",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-foreground mb-3 flex items-center gap-2",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-4 h-4 text-gold"}),"Pending Approvals (",Hr.length,")"]}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:Hr.map(Nn=>{var ls;return jsxRuntimeExports.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("img",{src:Nn.image,alt:Nn.name,className:"w-16 h-16 rounded-lg object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:Nn.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:Nn.address.city}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:(ls=Nn.specialties)==null?void 0:ls.join(", ")})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-1",children:[jsxRuntimeExports.jsx(Button,{size:"sm",className:"bg-veg text-primary-foreground",onClick:()=>_n(Nn.id),children:jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(Button,{size:"sm",variant:"outline",className:"text-destructive border-destructive",onClick:()=>fn(Nn.id),children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]})]})},Nn.id)})})]}),pt.filter(Nn=>Nn.isApproved).map(Nn=>{const ls=et.find(ms=>ms.id===Nn.franchiseId);return jsxRuntimeExports.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("img",{src:Nn.image,alt:Nn.name,className:"w-16 h-16 rounded-lg object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:Nn.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:Nn.address.city}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs bg-veg/20 text-veg",children:"Approved"}),ls&&jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs bg-primary/20 text-primary",children:ls.name})]})]})]})},Nn.id)})]}),xt==="system"&&jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"System Management"}),jsxRuntimeExports.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-2xl p-6",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-destructive flex items-center gap-2 mb-4",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-5 h-5"}),"Danger Zone"]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-medium text-foreground",children:"Reset Database"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"This will permanently delete all data including users, franchises, kitchens, dishes, and orders. Only the Super Admin account will be preserved."})]}),jsxRuntimeExports.jsx(Button,{variant:"destructive",onClick:Nt,disabled:Et,className:"w-full sm:w-auto",children:Et?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 mr-2 animate-spin"}),"Resetting..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4 mr-2"}),"Reset Database (Keep Super Admin)"]})})]})]})]})]})]})}function PendingApproval({kitchenName:e}){const{signOut:i}=useAuth(),s=useNavigate();return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Kitchen Status"}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:async()=>{await i(),s("/auth")},className:"text-destructive",children:jsxRuntimeExports.jsx(LogOut,{className:"w-5 h-5"})})]})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-6 py-12",children:[jsxRuntimeExports.jsx(motion.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:20},className:"w-24 h-24 rounded-full bg-gold/20 flex items-center justify-center mb-6",children:jsxRuntimeExports.jsx(Clock,{className:"w-12 h-12 text-gold"})}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-center max-w-sm",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Pending Approval"}),jsxRuntimeExports.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card mb-6",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:jsxRuntimeExports.jsx(ChefHat,{className:"w-6 h-6 text-primary"})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"font-semibold text-foreground",children:e}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Your Kitchen"})]})]})}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-6",children:"Your kitchen registration is under review by the franchise admin. You'll be automatically redirected once approved."}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground bg-secondary rounded-lg p-3",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-gold animate-pulse"}),jsxRuntimeExports.jsx("span",{children:"Waiting for franchise admin approval..."})]})})]}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"mt-8",children:jsxRuntimeExports.jsxs(Button,{variant:"outline",onClick:()=>s("/"),className:"gap-2",children:[jsxRuntimeExports.jsx(House,{className:"w-4 h-4"}),"Browse as Customer"]})})]})]})}function AmmaRouteWrapper({children:e}){const{user:i,loading:s}=useAuth(),{kitchens:a,loading:b}=useAmmaKitchens(i==null?void 0:i.id);if(s)return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})});if(!i)return jsxRuntimeExports.jsx(Navigate,{to:"/auth",replace:!0});if(b)return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})});if(a.length>0){const et=a[0];if(!et.isApproved)return jsxRuntimeExports.jsx(PendingApproval,{kitchenName:et.name})}return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:e})}function LocationSelectionPage(){const e=useNavigate(),{userLocation:i,setUserLocation:s}=useLocationContext(),{user:a,updateUserLocation:b}=useAuth(),[et,nt]=reactExports.useState(null),[c,ct]=reactExports.useState(!1),[pt,xt]=reactExports.useState("home"),St=Rt=>{nt(Rt)},Et=async()=>{if(!(!et||!et.franchiseId)){if(ct(!0),s({lat:et.lat,lng:et.lng,address:et.address}),a)try{await b(et.lat,et.lng,et.address,pt)}catch(Rt){console.error("Failed to update user profile location:",Rt)}await new Promise(Rt=>setTimeout(Rt,500)),ct(!1),e(-1)}};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center gap-3 bg-card sticky top-0 z-10",children:[jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:()=>e(-1),children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-lg",children:"Select Location"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Deliver to"})]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 relative",children:jsxRuntimeExports.jsx(FranchiseZoneLocationPicker,{onLocationSelect:St,initialLocation:i?{lat:i.lat,lng:i.lng}:void 0,label:"Delivery Location",instructions:"Drag pin to your exact delivery location",fullScreen:!0})}),jsxRuntimeExports.jsx("div",{className:"p-4 bg-card border-t border-border sticky bottom-0 z-10",children:jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium mb-3",children:"Save as"}),jsxRuntimeExports.jsx("div",{className:"flex gap-3",children:["home","work","other"].map(Rt=>jsxRuntimeExports.jsxs("button",{onClick:()=>xt(Rt),className:`flex items-center gap-2 px-4 py-2 rounded-full border transition-all ${pt===Rt?"bg-primary text-primary-foreground border-primary":"bg-background border-border text-muted-foreground hover:border-primary/50"}`,children:[Rt==="home"&&jsxRuntimeExports.jsx(House,{className:"w-4 h-4"}),Rt==="work"&&jsxRuntimeExports.jsx(Briefcase,{className:"w-4 h-4"}),Rt==="other"&&jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{className:"capitalize",children:Rt})]},Rt))})]}),jsxRuntimeExports.jsx(Button,{className:"w-full font-semibold py-6 text-base",size:"lg",onClick:Et,disabled:!et||!et.franchiseId||c,children:c?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"mr-2 h-5 w-5 animate-spin"}),"Confirming..."]}):"Confirm Location"}),et&&!et.franchiseId&&jsxRuntimeExports.jsx("p",{className:"text-center text-destructive text-sm mt-2",children:"Location outside service area"})]})})]})}const NotFound=()=>{const e=useLocation();return reactExports.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),jsxRuntimeExports.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),jsxRuntimeExports.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),jsxRuntimeExports.jsx(Link,{to:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})},v="5.1.7",fr=30,ip=25,op=69,w=600,h=600,nm="success",ddd=0,assets=[{id:"comp_0",layers:[{ddd:0,ind:1,ty:4,nm:"Layer 4 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[115.68,468.673,0],ix:2},a:{a:0,k:[26.859,26.86,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[-20.859,20.86],[20.859,-20.86]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[26.859,26.86],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:0,k:0,ix:1},e:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[100],e:[0]},{t:22}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:2,ty:4,nm:"Layer 5 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[467.82,115.827,0],ix:2},a:{a:0,k:[26.86,26.859,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[-20.86,20.859],[20.86,-20.859]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[26.86,26.859],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[0],e:[100]},{t:22}],ix:1},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:3,ty:4,nm:"Layer 6 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[115.327,116.18,0],ix:2},a:{a:0,k:[26.859,26.859,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[-20.859,-20.86],[20.859,20.86]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[26.859,26.86],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:0,k:0,ix:1},e:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[100],e:[0]},{t:22}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:4,ty:4,nm:"Layer 7 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[468.174,468.32,0],ix:2},a:{a:0,k:[26.86,26.86,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[-20.86,-20.86],[20.86,20.86]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[26.86,26.86],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[0],e:[100]},{t:22}],ix:1},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:5,ty:4,nm:"Layer 8 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[42.5,292.5,0],ix:2},a:{a:0,k:[35.5,6,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[6,6],[65,6]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:0,k:0,ix:1},e:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[100],e:[0]},{t:22}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:6,ty:4,nm:"Layer 9 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[541,292,0],ix:2},a:{a:0,k:[35.5,6,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[6,6],[65,6]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[0],e:[100]},{t:22}],ix:1},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:7,ty:4,nm:"Layer 10 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[292,541.5,0],ix:2},a:{a:0,k:[6,35.5,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[6,65],[6,6]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:0,k:0,ix:1},e:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[100],e:[0]},{t:22}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:8,ty:4,nm:"Layer 11 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[291.5,43,0],ix:2},a:{a:0,k:[6,35.5,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[6,65],[6,6]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[0],e:[100]},{t:22}],ix:1},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0}]}],layers=[{ddd:0,ind:1,ty:4,nm:"Shape Layer 2",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[300,300,0],ix:2},a:{a:0,k:[0,0,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[367.859,367.859],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:25,s:[0],e:[0]},{i:{x:[.089],y:[1]},o:{x:[.655],y:[0]},n:["0p089_1_0p655_0"],t:36,s:[0],e:[100]},{t:50}],ix:1},e:{a:1,k:[{i:{x:[.333],y:[1]},o:{x:[.829],y:[0]},n:["0p333_1_0p829_0"],t:25,s:[0],e:[100]},{t:39}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1},{ty:"st",c:{a:0,k:[.893382352941,.893382352941,.893382352941,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:20,ix:5},lc:1,lj:1,ml:4,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[1.93,-10.07],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Ellipse 1",np:4,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:25,op:50,st:25,bm:0},{ddd:0,ind:2,ty:4,nm:"Shape Layer 1",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[300,300,0],ix:2},a:{a:0,k:[0,0,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[367.859,367.859],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:0,s:[0],e:[0]},{i:{x:[.089],y:[1]},o:{x:[.655],y:[0]},n:["0p089_1_0p655_0"],t:11,s:[0],e:[100]},{t:25}],ix:1},e:{a:1,k:[{i:{x:[.333],y:[1]},o:{x:[.829],y:[0]},n:["0p333_1_0p829_0"],t:0,s:[0],e:[100]},{t:14}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1},{ty:"st",c:{a:0,k:[.893382352941,.893382352941,.893382352941,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:20,ix:5},lc:1,lj:1,ml:4,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[1.93,-10.07],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Ellipse 1",np:4,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:25,st:0,bm:0},{ddd:0,ind:3,ty:0,nm:"Pre-comp 1",refId:"comp_0",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]},n:["0p833_0p833_0p167_0p167"],t:54,s:[0],e:[100]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]},n:["0p833_0p833_0p167_0p167"],t:56,s:[100],e:[100]},{t:62}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[300,300,0],ix:2},a:{a:0,k:[300,300,0],ix:1},s:{a:1,k:[{i:{x:[.833,.833,.833],y:[.833,.833,.833]},o:{x:[.167,.167,.167],y:[.167,.167,.167]},n:["0p833_0p833_0p167_0p167","0p833_0p833_0p167_0p167","0p833_0p833_0p167_0p167"],t:54,s:[86,86,100],e:[94,94,100]},{t:62}],ix:6}},ao:0,w:600,h:600,ip:54,op:354,st:54,bm:0},{ddd:0,ind:4,ty:4,nm:"Layer 2 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[300,300,0],ix:2},a:{a:0,k:[137.378,109.309,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0]],v:[[-84.878,.669],[-28.738,56.809],[84.878,-56.809]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:21,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[137.378,109.308],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[.185],y:[1]},o:{x:[.333],y:[0]},n:["0p185_1_0p333_0"],t:59,s:[0],e:[6]},{i:{x:[.306],y:[1]},o:{x:[.333],y:[0]},n:["0p306_1_0p333_0"],t:62,s:[6],e:[0]},{t:66}],ix:1},e:{a:1,k:[{i:{x:[.35],y:[1]},o:{x:[.333],y:[0]},n:["0p35_1_0p333_0"],t:54,s:[0],e:[100]},{i:{x:[.032],y:[1]},o:{x:[.333],y:[0]},n:["0p032_1_0p333_0"],t:62,s:[100],e:[94]},{t:66}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:54,op:354,st:54,bm:0},{ddd:0,ind:5,ty:4,nm:"Layer 1 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[299.988,299.91,0],ix:2},a:{a:0,k:[190.878,189.014,0],ix:1},s:{a:1,k:[{i:{x:[.046,.046,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},n:["0p046_1_0p333_0","0p046_1_0p333_0","0p667_1_0p333_0"],t:50,s:[0,0,100],e:[116,116,100]},{i:{x:[.019,.019,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[.032,.032,0]},n:["0p019_1_0p333_0p032","0p019_1_0p333_0p032","0p667_1_0p333_0"],t:61,s:[116,116,100],e:[100,100,100]},{t:67}],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-4.067,-3.573],[0,0],[-2.665,-.588],[0,0],[-1.937,-5.043],[0,0],[-2.087,-1.753],[0,0],[.635,-5.357],[0,0],[-1.033,-2.517],[0,0],[3.063,-4.444],[0,0],[.259,-2.704],[0,0],[4.789,-2.513],[0,0],[1.492,-2.273],[0,0],[5.418,-.007],[0,0],[2.383,-1.32],[0,0],[4.806,2.501],[0,0],[2.727,-.064],[0,0],[3.093,4.437],[0,0],[2.448,1.205],[0,0],[.67,5.356],[0,0],[1.607,2.198],[0,0],[-1.904,5.047],[0,0],[.399,2.689],[0,0],[-4.043,3.583],[0,0],[-.901,2.564],[0,0],[-5.257,1.298],[0,0],[-1.995,1.85],[0,0],[-5.265,-1.284],[0,0],[-2.632,.713],[0,0]],o:[[0,0],[2.049,1.8],[0,0],[5.292,1.166],[0,0],[.976,2.539],[0,0],[4.146,3.481],[0,0],[-.32,2.698],[0,0],[2.05,4.998],[0,0],[-1.542,2.239],[0,0],[-.514,5.372],[0,0],[-2.412,1.266],[0,0],[-2.961,4.512],[0,0],[-2.728,.003],[0,0],[-4.73,2.62],[0,0],[-2.42,-1.26],[0,0],[-5.416,.129],[0,0],[-1.557,-2.233],[0,0],[-4.861,-2.393],[0,0],[-.338,-2.697],[0,0],[-3.192,-4.367],[0,0],[.959,-2.542],[0,0],[-.792,-5.339],[0,0],[2.036,-1.805],[0,0],[1.789,-5.09],[0,0],[2.647,-.653],[0,0],[3.961,-3.674],[0,0],[2.651,.646],[0,0],[5.226,-1.416]],v:[[49.728,-183.893],[75.948,-160.861],[83.134,-157.221],[117.251,-149.704],[128.834,-139.758],[141.329,-107.249],[146,-100.704],[172.734,-78.264],[178.36,-64.104],[174.265,-29.568],[175.352,-21.617],[188.578,10.606],[186.957,25.734],[167.211,54.389],[164.465,61.924],[161.152,96.546],[152.657,109.178],[121.785,125.385],[115.833,130.78],[96.742,159.871],[83.317,167.112],[48.39,167.159],[40.598,169.176],[10.101,186.072],[-5.177,186.263],[-36.157,170.138],[-44.005,168.317],[-78.921,169.146],[-92.553,162.244],[-112.489,133.642],[-118.596,128.399],[-149.931,112.972],[-158.793,100.558],[-163.119,66.033],[-166.084,58.567],[-186.661,30.418],[-188.724,15.336],[-176.447,-17.206],[-175.593,-25.182],[-180.697,-59.604],[-175.488,-73.898],[-149.422,-97.001],[-144.943,-103.66],[-133.405,-136.47],[-122.117,-146.703],[-88.233,-155.074],[-81.156,-158.891],[-55.62,-182.572],[-40.839,-186.4],[-6.899,-178.12],[1.156,-178.22],[34.84,-187.349]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:4},o:{a:0,k:100,ix:5},r:1,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[190.878,189.015],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:50,op:350,st:50,bm:0}],markers=[],successAnimation={v,fr,ip,op,w,h,nm,ddd,assets,layers,markers};function OrderSuccessPage(){const e=useNavigate(),i=reactExports.useRef(null);return reactExports.useEffect(()=>{i.current&&i.current.setSpeed(.8)},[]),jsxRuntimeExports.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-green-50 to-white px-4",children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},className:"w-full max-w-md flex flex-col items-center text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-64 h-64",children:jsxRuntimeExports.jsx(Lottie,{lottieRef:i,animationData:successAnimation,loop:!1})}),jsxRuntimeExports.jsx(motion.h1,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"text-2xl font-bold text-foreground mt-4 mb-2",children:"Order Placed!"}),jsxRuntimeExports.jsx(motion.p,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},className:"text-muted-foreground mb-8",children:"Your order has been placed successfully and sent to the kitchen."}),jsxRuntimeExports.jsxs(motion.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},className:"w-full space-y-3",children:[jsxRuntimeExports.jsx(Button,{onClick:()=>e("/orders"),className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl font-semibold shadow-elevated",children:"View Order Status"}),jsxRuntimeExports.jsx(Button,{variant:"ghost",onClick:()=>e("/"),className:"w-full",children:"Back to Home"})]})]})})}const queryClient=new QueryClient;function SplashScreen({onFinish:e}){return reactExports.useEffect(()=>{const i=setTimeout(()=>{e()},3e3);return()=>clearTimeout(i)},[e]),jsxRuntimeExports.jsx("div",{className:"w-full h-full",onClick:()=>{document.fullscreenElement||document.documentElement.requestFullscreen().catch(i=>console.log("Fullscreen denied:",i))},children:jsxRuntimeExports.jsx(LoadingAnimation,{message:"Welcome to Amma Cheythi Vanta..."})})}const AppRoutes=()=>{const[e,i]=reactExports.useState(!0);return reactExports.useEffect(()=>{const s=()=>{document.fullscreenElement||document.documentElement.requestFullscreen().catch(a=>{console.log("Auto-fullscreen blocked:",a)})};return window.addEventListener("click",s,{once:!0}),window.addEventListener("touchstart",s,{once:!0}),()=>{window.removeEventListener("click",s),window.removeEventListener("touchstart",s)}},[]),e?jsxRuntimeExports.jsx(SplashScreen,{onFinish:()=>i(!1)}):jsxRuntimeExports.jsx(BrowserRouter,{basename:"/ammacheythivantalive",children:jsxRuntimeExports.jsxs(Routes,{children:[jsxRuntimeExports.jsx(Route,{path:"/",element:jsxRuntimeExports.jsx(HomePage,{})}),jsxRuntimeExports.jsx(Route,{path:"/kitchen/:id",element:jsxRuntimeExports.jsx(KitchenPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/cart",element:jsxRuntimeExports.jsx(CartPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/checkout",element:jsxRuntimeExports.jsx(CheckoutPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/auth",element:jsxRuntimeExports.jsx(AuthPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/profile",element:jsxRuntimeExports.jsx(ProfilePage,{})}),jsxRuntimeExports.jsx(Route,{path:"/settings",element:jsxRuntimeExports.jsx(SettingsPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/help",element:jsxRuntimeExports.jsx(HelpSupportPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/search",element:jsxRuntimeExports.jsx(SearchPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/orders",element:jsxRuntimeExports.jsx(OrdersPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/order-success",element:jsxRuntimeExports.jsx(OrderSuccessPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/favorites",element:jsxRuntimeExports.jsx(FavoritesPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/addresses",element:jsxRuntimeExports.jsx(SavedAddressesPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/amma/dashboard",element:jsxRuntimeExports.jsx(AmmaRouteWrapper,{children:jsxRuntimeExports.jsx(AmmaDashboard,{})})}),jsxRuntimeExports.jsx(Route,{path:"/amma/register",element:jsxRuntimeExports.jsx(AmmaRouteWrapper,{children:jsxRuntimeExports.jsx(RegisterKitchen,{})})}),jsxRuntimeExports.jsx(Route,{path:"/amma/add-dish",element:jsxRuntimeExports.jsx(AmmaRouteWrapper,{children:jsxRuntimeExports.jsx(AddDish,{})})}),jsxRuntimeExports.jsx(Route,{path:"/amma/edit-kitchen/:kitchenId",element:jsxRuntimeExports.jsx(AmmaRouteWrapper,{children:jsxRuntimeExports.jsx(EditKitchen,{})})}),jsxRuntimeExports.jsx(Route,{path:"/admin",element:jsxRuntimeExports.jsx(AdminDashboard,{})}),jsxRuntimeExports.jsx(Route,{path:"/franchise-admin",element:jsxRuntimeExports.jsx(FranchiseAdminDashboard,{})}),jsxRuntimeExports.jsx(Route,{path:"/super-admin",element:jsxRuntimeExports.jsx(SuperAdminDashboard,{})}),jsxRuntimeExports.jsx(Route,{path:"/location-select",element:jsxRuntimeExports.jsx(LocationSelectionPage,{})}),jsxRuntimeExports.jsx(Route,{path:"*",element:jsxRuntimeExports.jsx(NotFound,{})})]})})},App=()=>jsxRuntimeExports.jsx(QueryClientProvider,{client:queryClient,children:jsxRuntimeExports.jsx(AuthProvider,{children:jsxRuntimeExports.jsx(LocationProvider,{children:jsxRuntimeExports.jsx(CartProvider,{children:jsxRuntimeExports.jsxs(TooltipProvider,{children:[jsxRuntimeExports.jsx(Toaster$1,{}),jsxRuntimeExports.jsx(Toaster,{}),jsxRuntimeExports.jsx(AppRoutes,{})]})})})})});createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(App,{}));
