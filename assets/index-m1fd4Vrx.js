var S3=e=>{throw TypeError(e)};var h2=(e,t,i)=>t.has(e)||S3("Cannot "+i);var Vt=(e,t,i)=>(h2(e,t,"read from private field"),i?i.call(e):t.get(e)),Rr=(e,t,i)=>t.has(e)?S3("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),Ui=(e,t,i,l)=>(h2(e,t,"write to private field"),l?l.call(e,i):t.set(e,i),i),qo=(e,t,i)=>(h2(e,t,"access private method"),i);var vT=(e,t,i,l)=>({set _(d){Ui(e,t,d,i)},get _(){return Vt(e,t,l)}});function vQ(e,t){for(var i=0;i<t.length;i++){const l=t[i];if(typeof l!="string"&&!Array.isArray(l)){for(const d in l)if(d!=="default"&&!(d in e)){const m=Object.getOwnPropertyDescriptor(l,d);m&&Object.defineProperty(e,d,m.get?m:{enumerable:!0,get:()=>l[d]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))l(d);new MutationObserver(d=>{for(const m of d)if(m.type==="childList")for(const v of m.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&l(v)}).observe(document,{childList:!0,subtree:!0});function i(d){const m={};return d.integrity&&(m.integrity=d.integrity),d.referrerPolicy&&(m.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?m.credentials="include":d.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function l(d){if(d.ep)return;d.ep=!0;const m=i(d);fetch(d.href,m)}})();var xQ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function H1(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var kV={exports:{}},YS={},DV={exports:{}},ur={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W1=Symbol.for("react.element"),bQ=Symbol.for("react.portal"),wQ=Symbol.for("react.fragment"),TQ=Symbol.for("react.strict_mode"),EQ=Symbol.for("react.profiler"),SQ=Symbol.for("react.provider"),CQ=Symbol.for("react.context"),IQ=Symbol.for("react.forward_ref"),AQ=Symbol.for("react.suspense"),PQ=Symbol.for("react.memo"),RQ=Symbol.for("react.lazy"),C3=Symbol.iterator;function MQ(e){return e===null||typeof e!="object"?null:(e=C3&&e[C3]||e["@@iterator"],typeof e=="function"?e:null)}var NV={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},LV=Object.assign,OV={};function Ky(e,t,i){this.props=e,this.context=t,this.refs=OV,this.updater=i||NV}Ky.prototype.isReactComponent={};Ky.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Ky.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function FV(){}FV.prototype=Ky.prototype;function JM(e,t,i){this.props=e,this.context=t,this.refs=OV,this.updater=i||NV}var ek=JM.prototype=new FV;ek.constructor=JM;LV(ek,Ky.prototype);ek.isPureReactComponent=!0;var I3=Array.isArray,zV=Object.prototype.hasOwnProperty,tk={current:null},jV={key:!0,ref:!0,__self:!0,__source:!0};function BV(e,t,i){var l,d={},m=null,v=null;if(t!=null)for(l in t.ref!==void 0&&(v=t.ref),t.key!==void 0&&(m=""+t.key),t)zV.call(t,l)&&!jV.hasOwnProperty(l)&&(d[l]=t[l]);var o=arguments.length-2;if(o===1)d.children=i;else if(1<o){for(var I=Array(o),A=0;A<o;A++)I[A]=arguments[A+2];d.children=I}if(e&&e.defaultProps)for(l in o=e.defaultProps,o)d[l]===void 0&&(d[l]=o[l]);return{$$typeof:W1,type:e,key:m,ref:v,props:d,_owner:tk.current}}function kQ(e,t){return{$$typeof:W1,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function nk(e){return typeof e=="object"&&e!==null&&e.$$typeof===W1}function DQ(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(i){return t[i]})}var A3=/\/+/g;function f2(e,t){return typeof e=="object"&&e!==null&&e.key!=null?DQ(""+e.key):t.toString(36)}function rE(e,t,i,l,d){var m=typeof e;(m==="undefined"||m==="boolean")&&(e=null);var v=!1;if(e===null)v=!0;else switch(m){case"string":case"number":v=!0;break;case"object":switch(e.$$typeof){case W1:case bQ:v=!0}}if(v)return v=e,d=d(v),e=l===""?"."+f2(v,0):l,I3(d)?(i="",e!=null&&(i=e.replace(A3,"$&/")+"/"),rE(d,t,i,"",function(A){return A})):d!=null&&(nk(d)&&(d=kQ(d,i+(!d.key||v&&v.key===d.key?"":(""+d.key).replace(A3,"$&/")+"/")+e)),t.push(d)),1;if(v=0,l=l===""?".":l+":",I3(e))for(var o=0;o<e.length;o++){m=e[o];var I=l+f2(m,o);v+=rE(m,t,i,I,d)}else if(I=MQ(e),typeof I=="function")for(e=I.call(e),o=0;!(m=e.next()).done;)m=m.value,I=l+f2(m,o++),v+=rE(m,t,i,I,d);else if(m==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return v}function xT(e,t,i){if(e==null)return e;var l=[],d=0;return rE(e,l,"","",function(m){return t.call(i,m,d++)}),l}function NQ(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(i){(e._status===0||e._status===-1)&&(e._status=1,e._result=i)},function(i){(e._status===0||e._status===-1)&&(e._status=2,e._result=i)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Ta={current:null},sE={transition:null},LQ={ReactCurrentDispatcher:Ta,ReactCurrentBatchConfig:sE,ReactCurrentOwner:tk};function VV(){throw Error("act(...) is not supported in production builds of React.")}ur.Children={map:xT,forEach:function(e,t,i){xT(e,function(){t.apply(this,arguments)},i)},count:function(e){var t=0;return xT(e,function(){t++}),t},toArray:function(e){return xT(e,function(t){return t})||[]},only:function(e){if(!nk(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};ur.Component=Ky;ur.Fragment=wQ;ur.Profiler=EQ;ur.PureComponent=JM;ur.StrictMode=TQ;ur.Suspense=AQ;ur.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=LQ;ur.act=VV;ur.cloneElement=function(e,t,i){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var l=LV({},e.props),d=e.key,m=e.ref,v=e._owner;if(t!=null){if(t.ref!==void 0&&(m=t.ref,v=tk.current),t.key!==void 0&&(d=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(I in t)zV.call(t,I)&&!jV.hasOwnProperty(I)&&(l[I]=t[I]===void 0&&o!==void 0?o[I]:t[I])}var I=arguments.length-2;if(I===1)l.children=i;else if(1<I){o=Array(I);for(var A=0;A<I;A++)o[A]=arguments[A+2];l.children=o}return{$$typeof:W1,type:e.type,key:d,ref:m,props:l,_owner:v}};ur.createContext=function(e){return e={$$typeof:CQ,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:SQ,_context:e},e.Consumer=e};ur.createElement=BV;ur.createFactory=function(e){var t=BV.bind(null,e);return t.type=e,t};ur.createRef=function(){return{current:null}};ur.forwardRef=function(e){return{$$typeof:IQ,render:e}};ur.isValidElement=nk;ur.lazy=function(e){return{$$typeof:RQ,_payload:{_status:-1,_result:e},_init:NQ}};ur.memo=function(e,t){return{$$typeof:PQ,type:e,compare:t===void 0?null:t}};ur.startTransition=function(e){var t=sE.transition;sE.transition={};try{e()}finally{sE.transition=t}};ur.unstable_act=VV;ur.useCallback=function(e,t){return Ta.current.useCallback(e,t)};ur.useContext=function(e){return Ta.current.useContext(e)};ur.useDebugValue=function(){};ur.useDeferredValue=function(e){return Ta.current.useDeferredValue(e)};ur.useEffect=function(e,t){return Ta.current.useEffect(e,t)};ur.useId=function(){return Ta.current.useId()};ur.useImperativeHandle=function(e,t,i){return Ta.current.useImperativeHandle(e,t,i)};ur.useInsertionEffect=function(e,t){return Ta.current.useInsertionEffect(e,t)};ur.useLayoutEffect=function(e,t){return Ta.current.useLayoutEffect(e,t)};ur.useMemo=function(e,t){return Ta.current.useMemo(e,t)};ur.useReducer=function(e,t,i){return Ta.current.useReducer(e,t,i)};ur.useRef=function(e){return Ta.current.useRef(e)};ur.useState=function(e){return Ta.current.useState(e)};ur.useSyncExternalStore=function(e,t,i){return Ta.current.useSyncExternalStore(e,t,i)};ur.useTransition=function(){return Ta.current.useTransition()};ur.version="18.3.1";DV.exports=ur;var q=DV.exports;const rn=H1(q),ik=vQ({__proto__:null,default:rn},[q]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var OQ=q,FQ=Symbol.for("react.element"),zQ=Symbol.for("react.fragment"),jQ=Object.prototype.hasOwnProperty,BQ=OQ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,VQ={key:!0,ref:!0,__self:!0,__source:!0};function UV(e,t,i){var l,d={},m=null,v=null;i!==void 0&&(m=""+i),t.key!==void 0&&(m=""+t.key),t.ref!==void 0&&(v=t.ref);for(l in t)jQ.call(t,l)&&!VQ.hasOwnProperty(l)&&(d[l]=t[l]);if(e&&e.defaultProps)for(l in t=e.defaultProps,t)d[l]===void 0&&(d[l]=t[l]);return{$$typeof:FQ,type:e,key:m,ref:v,props:d,_owner:BQ.current}}YS.Fragment=zQ;YS.jsx=UV;YS.jsxs=UV;kV.exports=YS;var E=kV.exports,$V={exports:{}},wl={},GV={exports:{}},HV={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(et,Ct){var en=et.length;et.push(Ct);e:for(;0<en;){var Bn=en-1>>>1,En=et[Bn];if(0<d(En,Ct))et[Bn]=Ct,et[en]=En,en=Bn;else break e}}function i(et){return et.length===0?null:et[0]}function l(et){if(et.length===0)return null;var Ct=et[0],en=et.pop();if(en!==Ct){et[0]=en;e:for(var Bn=0,En=et.length,gn=En>>>1;Bn<gn;){var qt=2*(Bn+1)-1,Ji=et[qt],Sr=qt+1,_n=et[Sr];if(0>d(Ji,en))Sr<En&&0>d(_n,Ji)?(et[Bn]=_n,et[Sr]=en,Bn=Sr):(et[Bn]=Ji,et[qt]=en,Bn=qt);else if(Sr<En&&0>d(_n,en))et[Bn]=_n,et[Sr]=en,Bn=Sr;else break e}}return Ct}function d(et,Ct){var en=et.sortIndex-Ct.sortIndex;return en!==0?en:et.id-Ct.id}if(typeof performance=="object"&&typeof performance.now=="function"){var m=performance;e.unstable_now=function(){return m.now()}}else{var v=Date,o=v.now();e.unstable_now=function(){return v.now()-o}}var I=[],A=[],N=1,F=null,z=3,$=!1,J=!1,H=!1,re=typeof setTimeout=="function"?setTimeout:null,Q=typeof clearTimeout=="function"?clearTimeout:null,ee=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ie(et){for(var Ct=i(A);Ct!==null;){if(Ct.callback===null)l(A);else if(Ct.startTime<=et)l(A),Ct.sortIndex=Ct.expirationTime,t(I,Ct);else break;Ct=i(A)}}function ue(et){if(H=!1,ie(et),!J)if(i(I)!==null)J=!0,Wt(xe);else{var Ct=i(A);Ct!==null&&Ke(ue,Ct.startTime-et)}}function xe(et,Ct){J=!1,H&&(H=!1,Q(Be),Be=-1),$=!0;var en=z;try{for(ie(Ct),F=i(I);F!==null&&(!(F.expirationTime>Ct)||et&&!Zt());){var Bn=F.callback;if(typeof Bn=="function"){F.callback=null,z=F.priorityLevel;var En=Bn(F.expirationTime<=Ct);Ct=e.unstable_now(),typeof En=="function"?F.callback=En:F===i(I)&&l(I),ie(Ct)}else l(I);F=i(I)}if(F!==null)var gn=!0;else{var qt=i(A);qt!==null&&Ke(ue,qt.startTime-Ct),gn=!1}return gn}finally{F=null,z=en,$=!1}}var Oe=!1,ze=null,Be=-1,ot=5,Et=-1;function Zt(){return!(e.unstable_now()-Et<ot)}function at(){if(ze!==null){var et=e.unstable_now();Et=et;var Ct=!0;try{Ct=ze(!0,et)}finally{Ct?zt():(Oe=!1,ze=null)}}else Oe=!1}var zt;if(typeof ee=="function")zt=function(){ee(at)};else if(typeof MessageChannel<"u"){var Kt=new MessageChannel,nn=Kt.port2;Kt.port1.onmessage=at,zt=function(){nn.postMessage(null)}}else zt=function(){re(at,0)};function Wt(et){ze=et,Oe||(Oe=!0,zt())}function Ke(et,Ct){Be=re(function(){et(e.unstable_now())},Ct)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(et){et.callback=null},e.unstable_continueExecution=function(){J||$||(J=!0,Wt(xe))},e.unstable_forceFrameRate=function(et){0>et||125<et?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ot=0<et?Math.floor(1e3/et):5},e.unstable_getCurrentPriorityLevel=function(){return z},e.unstable_getFirstCallbackNode=function(){return i(I)},e.unstable_next=function(et){switch(z){case 1:case 2:case 3:var Ct=3;break;default:Ct=z}var en=z;z=Ct;try{return et()}finally{z=en}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(et,Ct){switch(et){case 1:case 2:case 3:case 4:case 5:break;default:et=3}var en=z;z=et;try{return Ct()}finally{z=en}},e.unstable_scheduleCallback=function(et,Ct,en){var Bn=e.unstable_now();switch(typeof en=="object"&&en!==null?(en=en.delay,en=typeof en=="number"&&0<en?Bn+en:Bn):en=Bn,et){case 1:var En=-1;break;case 2:En=250;break;case 5:En=1073741823;break;case 4:En=1e4;break;default:En=5e3}return En=en+En,et={id:N++,callback:Ct,priorityLevel:et,startTime:en,expirationTime:En,sortIndex:-1},en>Bn?(et.sortIndex=en,t(A,et),i(I)===null&&et===i(A)&&(H?(Q(Be),Be=-1):H=!0,Ke(ue,en-Bn))):(et.sortIndex=En,t(I,et),J||$||(J=!0,Wt(xe))),et},e.unstable_shouldYield=Zt,e.unstable_wrapCallback=function(et){var Ct=z;return function(){var en=z;z=Ct;try{return et.apply(this,arguments)}finally{z=en}}}})(HV);GV.exports=HV;var UQ=GV.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $Q=q,bl=UQ;function an(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var WV=new Set,J0={};function Nm(e,t){Ay(e,t),Ay(e+"Capture",t)}function Ay(e,t){for(J0[e]=t,e=0;e<t.length;e++)WV.add(t[e])}var Gd=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),FP=Object.prototype.hasOwnProperty,GQ=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,P3={},R3={};function HQ(e){return FP.call(R3,e)?!0:FP.call(P3,e)?!1:GQ.test(e)?R3[e]=!0:(P3[e]=!0,!1)}function WQ(e,t,i,l){if(i!==null&&i.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return l?!1:i!==null?!i.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function qQ(e,t,i,l){if(t===null||typeof t>"u"||WQ(e,t,i,l))return!0;if(l)return!1;if(i!==null)switch(i.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Ea(e,t,i,l,d,m,v){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=l,this.attributeNamespace=d,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=m,this.removeEmptyString=v}var Bo={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Bo[e]=new Ea(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Bo[t]=new Ea(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Bo[e]=new Ea(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Bo[e]=new Ea(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Bo[e]=new Ea(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Bo[e]=new Ea(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Bo[e]=new Ea(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Bo[e]=new Ea(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Bo[e]=new Ea(e,5,!1,e.toLowerCase(),null,!1,!1)});var rk=/[\-:]([a-z])/g;function sk(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(rk,sk);Bo[t]=new Ea(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(rk,sk);Bo[t]=new Ea(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(rk,sk);Bo[t]=new Ea(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Bo[e]=new Ea(e,1,!1,e.toLowerCase(),null,!1,!1)});Bo.xlinkHref=new Ea("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Bo[e]=new Ea(e,1,!1,e.toLowerCase(),null,!0,!0)});function ok(e,t,i,l){var d=Bo.hasOwnProperty(t)?Bo[t]:null;(d!==null?d.type!==0:l||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(qQ(t,i,d,l)&&(i=null),l||d===null?HQ(t)&&(i===null?e.removeAttribute(t):e.setAttribute(t,""+i)):d.mustUseProperty?e[d.propertyName]=i===null?d.type===3?!1:"":i:(t=d.attributeName,l=d.attributeNamespace,i===null?e.removeAttribute(t):(d=d.type,i=d===3||d===4&&i===!0?"":""+i,l?e.setAttributeNS(l,t,i):e.setAttribute(t,i))))}var th=$Q.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,bT=Symbol.for("react.element"),O_=Symbol.for("react.portal"),F_=Symbol.for("react.fragment"),ak=Symbol.for("react.strict_mode"),zP=Symbol.for("react.profiler"),qV=Symbol.for("react.provider"),ZV=Symbol.for("react.context"),lk=Symbol.for("react.forward_ref"),jP=Symbol.for("react.suspense"),BP=Symbol.for("react.suspense_list"),ck=Symbol.for("react.memo"),qh=Symbol.for("react.lazy"),KV=Symbol.for("react.offscreen"),M3=Symbol.iterator;function l0(e){return e===null||typeof e!="object"?null:(e=M3&&e[M3]||e["@@iterator"],typeof e=="function"?e:null)}var Ms=Object.assign,p2;function E0(e){if(p2===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);p2=t&&t[1]||""}return`
`+p2+e}var m2=!1;function g2(e,t){if(!e||m2)return"";m2=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(A){var l=A}Reflect.construct(e,[],t)}else{try{t.call()}catch(A){l=A}e.call(t.prototype)}else{try{throw Error()}catch(A){l=A}e()}}catch(A){if(A&&l&&typeof A.stack=="string"){for(var d=A.stack.split(`
`),m=l.stack.split(`
`),v=d.length-1,o=m.length-1;1<=v&&0<=o&&d[v]!==m[o];)o--;for(;1<=v&&0<=o;v--,o--)if(d[v]!==m[o]){if(v!==1||o!==1)do if(v--,o--,0>o||d[v]!==m[o]){var I=`
`+d[v].replace(" at new "," at ");return e.displayName&&I.includes("<anonymous>")&&(I=I.replace("<anonymous>",e.displayName)),I}while(1<=v&&0<=o);break}}}finally{m2=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?E0(e):""}function ZQ(e){switch(e.tag){case 5:return E0(e.type);case 16:return E0("Lazy");case 13:return E0("Suspense");case 19:return E0("SuspenseList");case 0:case 2:case 15:return e=g2(e.type,!1),e;case 11:return e=g2(e.type.render,!1),e;case 1:return e=g2(e.type,!0),e;default:return""}}function VP(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case F_:return"Fragment";case O_:return"Portal";case zP:return"Profiler";case ak:return"StrictMode";case jP:return"Suspense";case BP:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case ZV:return(e.displayName||"Context")+".Consumer";case qV:return(e._context.displayName||"Context")+".Provider";case lk:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case ck:return t=e.displayName||null,t!==null?t:VP(e.type)||"Memo";case qh:t=e._payload,e=e._init;try{return VP(e(t))}catch{}}return null}function KQ(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return VP(t);case 8:return t===ak?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Af(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function XV(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function XQ(e){var t=XV(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),l=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var d=i.get,m=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return d.call(this)},set:function(v){l=""+v,m.call(this,v)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return l},setValue:function(v){l=""+v},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function wT(e){e._valueTracker||(e._valueTracker=XQ(e))}function YV(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),l="";return e&&(l=XV(e)?e.checked?"true":"false":e.value),e=l,e!==i?(t.setValue(e),!0):!1}function NE(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function UP(e,t){var i=t.checked;return Ms({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??e._wrapperState.initialChecked})}function k3(e,t){var i=t.defaultValue==null?"":t.defaultValue,l=t.checked!=null?t.checked:t.defaultChecked;i=Af(t.value!=null?t.value:i),e._wrapperState={initialChecked:l,initialValue:i,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function QV(e,t){t=t.checked,t!=null&&ok(e,"checked",t,!1)}function $P(e,t){QV(e,t);var i=Af(t.value),l=t.type;if(i!=null)l==="number"?(i===0&&e.value===""||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if(l==="submit"||l==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?GP(e,t.type,i):t.hasOwnProperty("defaultValue")&&GP(e,t.type,Af(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function D3(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var l=t.type;if(!(l!=="submit"&&l!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}i=e.name,i!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,i!==""&&(e.name=i)}function GP(e,t,i){(t!=="number"||NE(e.ownerDocument)!==e)&&(i==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var S0=Array.isArray;function ty(e,t,i,l){if(e=e.options,t){t={};for(var d=0;d<i.length;d++)t["$"+i[d]]=!0;for(i=0;i<e.length;i++)d=t.hasOwnProperty("$"+e[i].value),e[i].selected!==d&&(e[i].selected=d),d&&l&&(e[i].defaultSelected=!0)}else{for(i=""+Af(i),t=null,d=0;d<e.length;d++){if(e[d].value===i){e[d].selected=!0,l&&(e[d].defaultSelected=!0);return}t!==null||e[d].disabled||(t=e[d])}t!==null&&(t.selected=!0)}}function HP(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(an(91));return Ms({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function N3(e,t){var i=t.value;if(i==null){if(i=t.children,t=t.defaultValue,i!=null){if(t!=null)throw Error(an(92));if(S0(i)){if(1<i.length)throw Error(an(93));i=i[0]}t=i}t==null&&(t=""),i=t}e._wrapperState={initialValue:Af(i)}}function JV(e,t){var i=Af(t.value),l=Af(t.defaultValue);i!=null&&(i=""+i,i!==e.value&&(e.value=i),t.defaultValue==null&&e.defaultValue!==i&&(e.defaultValue=i)),l!=null&&(e.defaultValue=""+l)}function L3(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function eU(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function WP(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?eU(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var TT,tU=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,i,l,d){MSApp.execUnsafeLocalFunction(function(){return e(t,i,l,d)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(TT=TT||document.createElement("div"),TT.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=TT.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function e1(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var k0={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},YQ=["Webkit","ms","Moz","O"];Object.keys(k0).forEach(function(e){YQ.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),k0[t]=k0[e]})});function nU(e,t,i){return t==null||typeof t=="boolean"||t===""?"":i||typeof t!="number"||t===0||k0.hasOwnProperty(e)&&k0[e]?(""+t).trim():t+"px"}function iU(e,t){e=e.style;for(var i in t)if(t.hasOwnProperty(i)){var l=i.indexOf("--")===0,d=nU(i,t[i],l);i==="float"&&(i="cssFloat"),l?e.setProperty(i,d):e[i]=d}}var QQ=Ms({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function qP(e,t){if(t){if(QQ[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(an(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(an(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(an(61))}if(t.style!=null&&typeof t.style!="object")throw Error(an(62))}}function ZP(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var KP=null;function uk(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var XP=null,ny=null,iy=null;function O3(e){if(e=K1(e)){if(typeof XP!="function")throw Error(an(280));var t=e.stateNode;t&&(t=nC(t),XP(e.stateNode,e.type,t))}}function rU(e){ny?iy?iy.push(e):iy=[e]:ny=e}function sU(){if(ny){var e=ny,t=iy;if(iy=ny=null,O3(e),t)for(e=0;e<t.length;e++)O3(t[e])}}function oU(e,t){return e(t)}function aU(){}var _2=!1;function lU(e,t,i){if(_2)return e(t,i);_2=!0;try{return oU(e,t,i)}finally{_2=!1,(ny!==null||iy!==null)&&(aU(),sU())}}function t1(e,t){var i=e.stateNode;if(i===null)return null;var l=nC(i);if(l===null)return null;i=l[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(e=e.type,l=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!l;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(an(231,t,typeof i));return i}var YP=!1;if(Gd)try{var c0={};Object.defineProperty(c0,"passive",{get:function(){YP=!0}}),window.addEventListener("test",c0,c0),window.removeEventListener("test",c0,c0)}catch{YP=!1}function JQ(e,t,i,l,d,m,v,o,I){var A=Array.prototype.slice.call(arguments,3);try{t.apply(i,A)}catch(N){this.onError(N)}}var D0=!1,LE=null,OE=!1,QP=null,eJ={onError:function(e){D0=!0,LE=e}};function tJ(e,t,i,l,d,m,v,o,I){D0=!1,LE=null,JQ.apply(eJ,arguments)}function nJ(e,t,i,l,d,m,v,o,I){if(tJ.apply(this,arguments),D0){if(D0){var A=LE;D0=!1,LE=null}else throw Error(an(198));OE||(OE=!0,QP=A)}}function Lm(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function cU(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function F3(e){if(Lm(e)!==e)throw Error(an(188))}function iJ(e){var t=e.alternate;if(!t){if(t=Lm(e),t===null)throw Error(an(188));return t!==e?null:e}for(var i=e,l=t;;){var d=i.return;if(d===null)break;var m=d.alternate;if(m===null){if(l=d.return,l!==null){i=l;continue}break}if(d.child===m.child){for(m=d.child;m;){if(m===i)return F3(d),e;if(m===l)return F3(d),t;m=m.sibling}throw Error(an(188))}if(i.return!==l.return)i=d,l=m;else{for(var v=!1,o=d.child;o;){if(o===i){v=!0,i=d,l=m;break}if(o===l){v=!0,l=d,i=m;break}o=o.sibling}if(!v){for(o=m.child;o;){if(o===i){v=!0,i=m,l=d;break}if(o===l){v=!0,l=m,i=d;break}o=o.sibling}if(!v)throw Error(an(189))}}if(i.alternate!==l)throw Error(an(190))}if(i.tag!==3)throw Error(an(188));return i.stateNode.current===i?e:t}function uU(e){return e=iJ(e),e!==null?dU(e):null}function dU(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=dU(e);if(t!==null)return t;e=e.sibling}return null}var hU=bl.unstable_scheduleCallback,z3=bl.unstable_cancelCallback,rJ=bl.unstable_shouldYield,sJ=bl.unstable_requestPaint,$s=bl.unstable_now,oJ=bl.unstable_getCurrentPriorityLevel,dk=bl.unstable_ImmediatePriority,fU=bl.unstable_UserBlockingPriority,FE=bl.unstable_NormalPriority,aJ=bl.unstable_LowPriority,pU=bl.unstable_IdlePriority,QS=null,Vu=null;function lJ(e){if(Vu&&typeof Vu.onCommitFiberRoot=="function")try{Vu.onCommitFiberRoot(QS,e,void 0,(e.current.flags&128)===128)}catch{}}var Wc=Math.clz32?Math.clz32:dJ,cJ=Math.log,uJ=Math.LN2;function dJ(e){return e>>>=0,e===0?32:31-(cJ(e)/uJ|0)|0}var ET=64,ST=4194304;function C0(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function zE(e,t){var i=e.pendingLanes;if(i===0)return 0;var l=0,d=e.suspendedLanes,m=e.pingedLanes,v=i&268435455;if(v!==0){var o=v&~d;o!==0?l=C0(o):(m&=v,m!==0&&(l=C0(m)))}else v=i&~d,v!==0?l=C0(v):m!==0&&(l=C0(m));if(l===0)return 0;if(t!==0&&t!==l&&!(t&d)&&(d=l&-l,m=t&-t,d>=m||d===16&&(m&4194240)!==0))return t;if(l&4&&(l|=i&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=l;0<t;)i=31-Wc(t),d=1<<i,l|=e[i],t&=~d;return l}function hJ(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function fJ(e,t){for(var i=e.suspendedLanes,l=e.pingedLanes,d=e.expirationTimes,m=e.pendingLanes;0<m;){var v=31-Wc(m),o=1<<v,I=d[v];I===-1?(!(o&i)||o&l)&&(d[v]=hJ(o,t)):I<=t&&(e.expiredLanes|=o),m&=~o}}function JP(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function mU(){var e=ET;return ET<<=1,!(ET&4194240)&&(ET=64),e}function y2(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function q1(e,t,i){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Wc(t),e[t]=i}function pJ(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var l=e.eventTimes;for(e=e.expirationTimes;0<i;){var d=31-Wc(i),m=1<<d;t[d]=0,l[d]=-1,e[d]=-1,i&=~m}}function hk(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var l=31-Wc(i),d=1<<l;d&t|e[l]&t&&(e[l]|=t),i&=~d}}var Ur=0;function gU(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var _U,fk,yU,vU,xU,eR=!1,CT=[],ff=null,pf=null,mf=null,n1=new Map,i1=new Map,Kh=[],mJ="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function j3(e,t){switch(e){case"focusin":case"focusout":ff=null;break;case"dragenter":case"dragleave":pf=null;break;case"mouseover":case"mouseout":mf=null;break;case"pointerover":case"pointerout":n1.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":i1.delete(t.pointerId)}}function u0(e,t,i,l,d,m){return e===null||e.nativeEvent!==m?(e={blockedOn:t,domEventName:i,eventSystemFlags:l,nativeEvent:m,targetContainers:[d]},t!==null&&(t=K1(t),t!==null&&fk(t)),e):(e.eventSystemFlags|=l,t=e.targetContainers,d!==null&&t.indexOf(d)===-1&&t.push(d),e)}function gJ(e,t,i,l,d){switch(t){case"focusin":return ff=u0(ff,e,t,i,l,d),!0;case"dragenter":return pf=u0(pf,e,t,i,l,d),!0;case"mouseover":return mf=u0(mf,e,t,i,l,d),!0;case"pointerover":var m=d.pointerId;return n1.set(m,u0(n1.get(m)||null,e,t,i,l,d)),!0;case"gotpointercapture":return m=d.pointerId,i1.set(m,u0(i1.get(m)||null,e,t,i,l,d)),!0}return!1}function bU(e){var t=tm(e.target);if(t!==null){var i=Lm(t);if(i!==null){if(t=i.tag,t===13){if(t=cU(i),t!==null){e.blockedOn=t,xU(e.priority,function(){yU(i)});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function oE(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=tR(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(i===null){i=e.nativeEvent;var l=new i.constructor(i.type,i);KP=l,i.target.dispatchEvent(l),KP=null}else return t=K1(i),t!==null&&fk(t),e.blockedOn=i,!1;t.shift()}return!0}function B3(e,t,i){oE(e)&&i.delete(t)}function _J(){eR=!1,ff!==null&&oE(ff)&&(ff=null),pf!==null&&oE(pf)&&(pf=null),mf!==null&&oE(mf)&&(mf=null),n1.forEach(B3),i1.forEach(B3)}function d0(e,t){e.blockedOn===t&&(e.blockedOn=null,eR||(eR=!0,bl.unstable_scheduleCallback(bl.unstable_NormalPriority,_J)))}function r1(e){function t(d){return d0(d,e)}if(0<CT.length){d0(CT[0],e);for(var i=1;i<CT.length;i++){var l=CT[i];l.blockedOn===e&&(l.blockedOn=null)}}for(ff!==null&&d0(ff,e),pf!==null&&d0(pf,e),mf!==null&&d0(mf,e),n1.forEach(t),i1.forEach(t),i=0;i<Kh.length;i++)l=Kh[i],l.blockedOn===e&&(l.blockedOn=null);for(;0<Kh.length&&(i=Kh[0],i.blockedOn===null);)bU(i),i.blockedOn===null&&Kh.shift()}var ry=th.ReactCurrentBatchConfig,jE=!0;function yJ(e,t,i,l){var d=Ur,m=ry.transition;ry.transition=null;try{Ur=1,pk(e,t,i,l)}finally{Ur=d,ry.transition=m}}function vJ(e,t,i,l){var d=Ur,m=ry.transition;ry.transition=null;try{Ur=4,pk(e,t,i,l)}finally{Ur=d,ry.transition=m}}function pk(e,t,i,l){if(jE){var d=tR(e,t,i,l);if(d===null)A2(e,t,l,BE,i),j3(e,l);else if(gJ(d,e,t,i,l))l.stopPropagation();else if(j3(e,l),t&4&&-1<mJ.indexOf(e)){for(;d!==null;){var m=K1(d);if(m!==null&&_U(m),m=tR(e,t,i,l),m===null&&A2(e,t,l,BE,i),m===d)break;d=m}d!==null&&l.stopPropagation()}else A2(e,t,l,null,i)}}var BE=null;function tR(e,t,i,l){if(BE=null,e=uk(l),e=tm(e),e!==null)if(t=Lm(e),t===null)e=null;else if(i=t.tag,i===13){if(e=cU(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return BE=e,null}function wU(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(oJ()){case dk:return 1;case fU:return 4;case FE:case aJ:return 16;case pU:return 536870912;default:return 16}default:return 16}}var af=null,mk=null,aE=null;function TU(){if(aE)return aE;var e,t=mk,i=t.length,l,d="value"in af?af.value:af.textContent,m=d.length;for(e=0;e<i&&t[e]===d[e];e++);var v=i-e;for(l=1;l<=v&&t[i-l]===d[m-l];l++);return aE=d.slice(e,1<l?1-l:void 0)}function lE(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function IT(){return!0}function V3(){return!1}function Tl(e){function t(i,l,d,m,v){this._reactName=i,this._targetInst=d,this.type=l,this.nativeEvent=m,this.target=v,this.currentTarget=null;for(var o in e)e.hasOwnProperty(o)&&(i=e[o],this[o]=i?i(m):m[o]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?IT:V3,this.isPropagationStopped=V3,this}return Ms(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=IT)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=IT)},persist:function(){},isPersistent:IT}),t}var Xy={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},gk=Tl(Xy),Z1=Ms({},Xy,{view:0,detail:0}),xJ=Tl(Z1),v2,x2,h0,JS=Ms({},Z1,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_k,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==h0&&(h0&&e.type==="mousemove"?(v2=e.screenX-h0.screenX,x2=e.screenY-h0.screenY):x2=v2=0,h0=e),v2)},movementY:function(e){return"movementY"in e?e.movementY:x2}}),U3=Tl(JS),bJ=Ms({},JS,{dataTransfer:0}),wJ=Tl(bJ),TJ=Ms({},Z1,{relatedTarget:0}),b2=Tl(TJ),EJ=Ms({},Xy,{animationName:0,elapsedTime:0,pseudoElement:0}),SJ=Tl(EJ),CJ=Ms({},Xy,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),IJ=Tl(CJ),AJ=Ms({},Xy,{data:0}),$3=Tl(AJ),PJ={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},RJ={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},MJ={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kJ(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=MJ[e])?!!t[e]:!1}function _k(){return kJ}var DJ=Ms({},Z1,{key:function(e){if(e.key){var t=PJ[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=lE(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?RJ[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_k,charCode:function(e){return e.type==="keypress"?lE(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?lE(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),NJ=Tl(DJ),LJ=Ms({},JS,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),G3=Tl(LJ),OJ=Ms({},Z1,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_k}),FJ=Tl(OJ),zJ=Ms({},Xy,{propertyName:0,elapsedTime:0,pseudoElement:0}),jJ=Tl(zJ),BJ=Ms({},JS,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),VJ=Tl(BJ),UJ=[9,13,27,32],yk=Gd&&"CompositionEvent"in window,N0=null;Gd&&"documentMode"in document&&(N0=document.documentMode);var $J=Gd&&"TextEvent"in window&&!N0,EU=Gd&&(!yk||N0&&8<N0&&11>=N0),H3=" ",W3=!1;function SU(e,t){switch(e){case"keyup":return UJ.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function CU(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var z_=!1;function GJ(e,t){switch(e){case"compositionend":return CU(t);case"keypress":return t.which!==32?null:(W3=!0,H3);case"textInput":return e=t.data,e===H3&&W3?null:e;default:return null}}function HJ(e,t){if(z_)return e==="compositionend"||!yk&&SU(e,t)?(e=TU(),aE=mk=af=null,z_=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return EU&&t.locale!=="ko"?null:t.data;default:return null}}var WJ={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function q3(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!WJ[e.type]:t==="textarea"}function IU(e,t,i,l){rU(l),t=VE(t,"onChange"),0<t.length&&(i=new gk("onChange","change",null,i,l),e.push({event:i,listeners:t}))}var L0=null,s1=null;function qJ(e){zU(e,0)}function eC(e){var t=V_(e);if(YV(t))return e}function ZJ(e,t){if(e==="change")return t}var AU=!1;if(Gd){var w2;if(Gd){var T2="oninput"in document;if(!T2){var Z3=document.createElement("div");Z3.setAttribute("oninput","return;"),T2=typeof Z3.oninput=="function"}w2=T2}else w2=!1;AU=w2&&(!document.documentMode||9<document.documentMode)}function K3(){L0&&(L0.detachEvent("onpropertychange",PU),s1=L0=null)}function PU(e){if(e.propertyName==="value"&&eC(s1)){var t=[];IU(t,s1,e,uk(e)),lU(qJ,t)}}function KJ(e,t,i){e==="focusin"?(K3(),L0=t,s1=i,L0.attachEvent("onpropertychange",PU)):e==="focusout"&&K3()}function XJ(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return eC(s1)}function YJ(e,t){if(e==="click")return eC(t)}function QJ(e,t){if(e==="input"||e==="change")return eC(t)}function JJ(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var eu=typeof Object.is=="function"?Object.is:JJ;function o1(e,t){if(eu(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),l=Object.keys(t);if(i.length!==l.length)return!1;for(l=0;l<i.length;l++){var d=i[l];if(!FP.call(t,d)||!eu(e[d],t[d]))return!1}return!0}function X3(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Y3(e,t){var i=X3(e);e=0;for(var l;i;){if(i.nodeType===3){if(l=e+i.textContent.length,e<=t&&l>=t)return{node:i,offset:t-e};e=l}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=X3(i)}}function RU(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?RU(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function MU(){for(var e=window,t=NE();t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=NE(e.document)}return t}function vk(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function eee(e){var t=MU(),i=e.focusedElem,l=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&RU(i.ownerDocument.documentElement,i)){if(l!==null&&vk(i)){if(t=l.start,e=l.end,e===void 0&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if(e=(t=i.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var d=i.textContent.length,m=Math.min(l.start,d);l=l.end===void 0?m:Math.min(l.end,d),!e.extend&&m>l&&(d=l,l=m,m=d),d=Y3(i,m);var v=Y3(i,l);d&&v&&(e.rangeCount!==1||e.anchorNode!==d.node||e.anchorOffset!==d.offset||e.focusNode!==v.node||e.focusOffset!==v.offset)&&(t=t.createRange(),t.setStart(d.node,d.offset),e.removeAllRanges(),m>l?(e.addRange(t),e.extend(v.node,v.offset)):(t.setEnd(v.node,v.offset),e.addRange(t)))}}for(t=[],e=i;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<t.length;i++)e=t[i],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var tee=Gd&&"documentMode"in document&&11>=document.documentMode,j_=null,nR=null,O0=null,iR=!1;function Q3(e,t,i){var l=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;iR||j_==null||j_!==NE(l)||(l=j_,"selectionStart"in l&&vk(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),O0&&o1(O0,l)||(O0=l,l=VE(nR,"onSelect"),0<l.length&&(t=new gk("onSelect","select",null,t,i),e.push({event:t,listeners:l}),t.target=j_)))}function AT(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var B_={animationend:AT("Animation","AnimationEnd"),animationiteration:AT("Animation","AnimationIteration"),animationstart:AT("Animation","AnimationStart"),transitionend:AT("Transition","TransitionEnd")},E2={},kU={};Gd&&(kU=document.createElement("div").style,"AnimationEvent"in window||(delete B_.animationend.animation,delete B_.animationiteration.animation,delete B_.animationstart.animation),"TransitionEvent"in window||delete B_.transitionend.transition);function tC(e){if(E2[e])return E2[e];if(!B_[e])return e;var t=B_[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in kU)return E2[e]=t[i];return e}var DU=tC("animationend"),NU=tC("animationiteration"),LU=tC("animationstart"),OU=tC("transitionend"),FU=new Map,J3="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function $f(e,t){FU.set(e,t),Nm(t,[e])}for(var S2=0;S2<J3.length;S2++){var C2=J3[S2],nee=C2.toLowerCase(),iee=C2[0].toUpperCase()+C2.slice(1);$f(nee,"on"+iee)}$f(DU,"onAnimationEnd");$f(NU,"onAnimationIteration");$f(LU,"onAnimationStart");$f("dblclick","onDoubleClick");$f("focusin","onFocus");$f("focusout","onBlur");$f(OU,"onTransitionEnd");Ay("onMouseEnter",["mouseout","mouseover"]);Ay("onMouseLeave",["mouseout","mouseover"]);Ay("onPointerEnter",["pointerout","pointerover"]);Ay("onPointerLeave",["pointerout","pointerover"]);Nm("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Nm("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Nm("onBeforeInput",["compositionend","keypress","textInput","paste"]);Nm("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Nm("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Nm("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var I0="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ree=new Set("cancel close invalid load scroll toggle".split(" ").concat(I0));function ej(e,t,i){var l=e.type||"unknown-event";e.currentTarget=i,nJ(l,t,void 0,e),e.currentTarget=null}function zU(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var l=e[i],d=l.event;l=l.listeners;e:{var m=void 0;if(t)for(var v=l.length-1;0<=v;v--){var o=l[v],I=o.instance,A=o.currentTarget;if(o=o.listener,I!==m&&d.isPropagationStopped())break e;ej(d,o,A),m=I}else for(v=0;v<l.length;v++){if(o=l[v],I=o.instance,A=o.currentTarget,o=o.listener,I!==m&&d.isPropagationStopped())break e;ej(d,o,A),m=I}}}if(OE)throw e=QP,OE=!1,QP=null,e}function fs(e,t){var i=t[lR];i===void 0&&(i=t[lR]=new Set);var l=e+"__bubble";i.has(l)||(jU(t,e,2,!1),i.add(l))}function I2(e,t,i){var l=0;t&&(l|=4),jU(i,e,l,t)}var PT="_reactListening"+Math.random().toString(36).slice(2);function a1(e){if(!e[PT]){e[PT]=!0,WV.forEach(function(i){i!=="selectionchange"&&(ree.has(i)||I2(i,!1,e),I2(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[PT]||(t[PT]=!0,I2("selectionchange",!1,t))}}function jU(e,t,i,l){switch(wU(t)){case 1:var d=yJ;break;case 4:d=vJ;break;default:d=pk}i=d.bind(null,t,i,e),d=void 0,!YP||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(d=!0),l?d!==void 0?e.addEventListener(t,i,{capture:!0,passive:d}):e.addEventListener(t,i,!0):d!==void 0?e.addEventListener(t,i,{passive:d}):e.addEventListener(t,i,!1)}function A2(e,t,i,l,d){var m=l;if(!(t&1)&&!(t&2)&&l!==null)e:for(;;){if(l===null)return;var v=l.tag;if(v===3||v===4){var o=l.stateNode.containerInfo;if(o===d||o.nodeType===8&&o.parentNode===d)break;if(v===4)for(v=l.return;v!==null;){var I=v.tag;if((I===3||I===4)&&(I=v.stateNode.containerInfo,I===d||I.nodeType===8&&I.parentNode===d))return;v=v.return}for(;o!==null;){if(v=tm(o),v===null)return;if(I=v.tag,I===5||I===6){l=m=v;continue e}o=o.parentNode}}l=l.return}lU(function(){var A=m,N=uk(i),F=[];e:{var z=FU.get(e);if(z!==void 0){var $=gk,J=e;switch(e){case"keypress":if(lE(i)===0)break e;case"keydown":case"keyup":$=NJ;break;case"focusin":J="focus",$=b2;break;case"focusout":J="blur",$=b2;break;case"beforeblur":case"afterblur":$=b2;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$=U3;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$=wJ;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$=FJ;break;case DU:case NU:case LU:$=SJ;break;case OU:$=jJ;break;case"scroll":$=xJ;break;case"wheel":$=VJ;break;case"copy":case"cut":case"paste":$=IJ;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$=G3}var H=(t&4)!==0,re=!H&&e==="scroll",Q=H?z!==null?z+"Capture":null:z;H=[];for(var ee=A,ie;ee!==null;){ie=ee;var ue=ie.stateNode;if(ie.tag===5&&ue!==null&&(ie=ue,Q!==null&&(ue=t1(ee,Q),ue!=null&&H.push(l1(ee,ue,ie)))),re)break;ee=ee.return}0<H.length&&(z=new $(z,J,null,i,N),F.push({event:z,listeners:H}))}}if(!(t&7)){e:{if(z=e==="mouseover"||e==="pointerover",$=e==="mouseout"||e==="pointerout",z&&i!==KP&&(J=i.relatedTarget||i.fromElement)&&(tm(J)||J[Hd]))break e;if(($||z)&&(z=N.window===N?N:(z=N.ownerDocument)?z.defaultView||z.parentWindow:window,$?(J=i.relatedTarget||i.toElement,$=A,J=J?tm(J):null,J!==null&&(re=Lm(J),J!==re||J.tag!==5&&J.tag!==6)&&(J=null)):($=null,J=A),$!==J)){if(H=U3,ue="onMouseLeave",Q="onMouseEnter",ee="mouse",(e==="pointerout"||e==="pointerover")&&(H=G3,ue="onPointerLeave",Q="onPointerEnter",ee="pointer"),re=$==null?z:V_($),ie=J==null?z:V_(J),z=new H(ue,ee+"leave",$,i,N),z.target=re,z.relatedTarget=ie,ue=null,tm(N)===A&&(H=new H(Q,ee+"enter",J,i,N),H.target=ie,H.relatedTarget=re,ue=H),re=ue,$&&J)t:{for(H=$,Q=J,ee=0,ie=H;ie;ie=M_(ie))ee++;for(ie=0,ue=Q;ue;ue=M_(ue))ie++;for(;0<ee-ie;)H=M_(H),ee--;for(;0<ie-ee;)Q=M_(Q),ie--;for(;ee--;){if(H===Q||Q!==null&&H===Q.alternate)break t;H=M_(H),Q=M_(Q)}H=null}else H=null;$!==null&&tj(F,z,$,H,!1),J!==null&&re!==null&&tj(F,re,J,H,!0)}}e:{if(z=A?V_(A):window,$=z.nodeName&&z.nodeName.toLowerCase(),$==="select"||$==="input"&&z.type==="file")var xe=ZJ;else if(q3(z))if(AU)xe=QJ;else{xe=XJ;var Oe=KJ}else($=z.nodeName)&&$.toLowerCase()==="input"&&(z.type==="checkbox"||z.type==="radio")&&(xe=YJ);if(xe&&(xe=xe(e,A))){IU(F,xe,i,N);break e}Oe&&Oe(e,z,A),e==="focusout"&&(Oe=z._wrapperState)&&Oe.controlled&&z.type==="number"&&GP(z,"number",z.value)}switch(Oe=A?V_(A):window,e){case"focusin":(q3(Oe)||Oe.contentEditable==="true")&&(j_=Oe,nR=A,O0=null);break;case"focusout":O0=nR=j_=null;break;case"mousedown":iR=!0;break;case"contextmenu":case"mouseup":case"dragend":iR=!1,Q3(F,i,N);break;case"selectionchange":if(tee)break;case"keydown":case"keyup":Q3(F,i,N)}var ze;if(yk)e:{switch(e){case"compositionstart":var Be="onCompositionStart";break e;case"compositionend":Be="onCompositionEnd";break e;case"compositionupdate":Be="onCompositionUpdate";break e}Be=void 0}else z_?SU(e,i)&&(Be="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(Be="onCompositionStart");Be&&(EU&&i.locale!=="ko"&&(z_||Be!=="onCompositionStart"?Be==="onCompositionEnd"&&z_&&(ze=TU()):(af=N,mk="value"in af?af.value:af.textContent,z_=!0)),Oe=VE(A,Be),0<Oe.length&&(Be=new $3(Be,e,null,i,N),F.push({event:Be,listeners:Oe}),ze?Be.data=ze:(ze=CU(i),ze!==null&&(Be.data=ze)))),(ze=$J?GJ(e,i):HJ(e,i))&&(A=VE(A,"onBeforeInput"),0<A.length&&(N=new $3("onBeforeInput","beforeinput",null,i,N),F.push({event:N,listeners:A}),N.data=ze))}zU(F,t)})}function l1(e,t,i){return{instance:e,listener:t,currentTarget:i}}function VE(e,t){for(var i=t+"Capture",l=[];e!==null;){var d=e,m=d.stateNode;d.tag===5&&m!==null&&(d=m,m=t1(e,i),m!=null&&l.unshift(l1(e,m,d)),m=t1(e,t),m!=null&&l.push(l1(e,m,d))),e=e.return}return l}function M_(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function tj(e,t,i,l,d){for(var m=t._reactName,v=[];i!==null&&i!==l;){var o=i,I=o.alternate,A=o.stateNode;if(I!==null&&I===l)break;o.tag===5&&A!==null&&(o=A,d?(I=t1(i,m),I!=null&&v.unshift(l1(i,I,o))):d||(I=t1(i,m),I!=null&&v.push(l1(i,I,o)))),i=i.return}v.length!==0&&e.push({event:t,listeners:v})}var see=/\r\n?/g,oee=/\u0000|\uFFFD/g;function nj(e){return(typeof e=="string"?e:""+e).replace(see,`
`).replace(oee,"")}function RT(e,t,i){if(t=nj(t),nj(e)!==t&&i)throw Error(an(425))}function UE(){}var rR=null,sR=null;function oR(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var aR=typeof setTimeout=="function"?setTimeout:void 0,aee=typeof clearTimeout=="function"?clearTimeout:void 0,ij=typeof Promise=="function"?Promise:void 0,lee=typeof queueMicrotask=="function"?queueMicrotask:typeof ij<"u"?function(e){return ij.resolve(null).then(e).catch(cee)}:aR;function cee(e){setTimeout(function(){throw e})}function P2(e,t){var i=t,l=0;do{var d=i.nextSibling;if(e.removeChild(i),d&&d.nodeType===8)if(i=d.data,i==="/$"){if(l===0){e.removeChild(d),r1(t);return}l--}else i!=="$"&&i!=="$?"&&i!=="$!"||l++;i=d}while(i);r1(t)}function gf(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function rj(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}var Yy=Math.random().toString(36).slice(2),Fu="__reactFiber$"+Yy,c1="__reactProps$"+Yy,Hd="__reactContainer$"+Yy,lR="__reactEvents$"+Yy,uee="__reactListeners$"+Yy,dee="__reactHandles$"+Yy;function tm(e){var t=e[Fu];if(t)return t;for(var i=e.parentNode;i;){if(t=i[Hd]||i[Fu]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=rj(e);e!==null;){if(i=e[Fu])return i;e=rj(e)}return t}e=i,i=e.parentNode}return null}function K1(e){return e=e[Fu]||e[Hd],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function V_(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(an(33))}function nC(e){return e[c1]||null}var cR=[],U_=-1;function Gf(e){return{current:e}}function ps(e){0>U_||(e.current=cR[U_],cR[U_]=null,U_--)}function os(e,t){U_++,cR[U_]=e.current,e.current=t}var Pf={},ea=Gf(Pf),Ka=Gf(!1),_m=Pf;function Py(e,t){var i=e.type.contextTypes;if(!i)return Pf;var l=e.stateNode;if(l&&l.__reactInternalMemoizedUnmaskedChildContext===t)return l.__reactInternalMemoizedMaskedChildContext;var d={},m;for(m in i)d[m]=t[m];return l&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=d),d}function Xa(e){return e=e.childContextTypes,e!=null}function $E(){ps(Ka),ps(ea)}function sj(e,t,i){if(ea.current!==Pf)throw Error(an(168));os(ea,t),os(Ka,i)}function BU(e,t,i){var l=e.stateNode;if(t=t.childContextTypes,typeof l.getChildContext!="function")return i;l=l.getChildContext();for(var d in l)if(!(d in t))throw Error(an(108,KQ(e)||"Unknown",d));return Ms({},i,l)}function GE(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Pf,_m=ea.current,os(ea,e),os(Ka,Ka.current),!0}function oj(e,t,i){var l=e.stateNode;if(!l)throw Error(an(169));i?(e=BU(e,t,_m),l.__reactInternalMemoizedMergedChildContext=e,ps(Ka),ps(ea),os(ea,e)):ps(Ka),os(Ka,i)}var Dd=null,iC=!1,R2=!1;function VU(e){Dd===null?Dd=[e]:Dd.push(e)}function hee(e){iC=!0,VU(e)}function Hf(){if(!R2&&Dd!==null){R2=!0;var e=0,t=Ur;try{var i=Dd;for(Ur=1;e<i.length;e++){var l=i[e];do l=l(!0);while(l!==null)}Dd=null,iC=!1}catch(d){throw Dd!==null&&(Dd=Dd.slice(e+1)),hU(dk,Hf),d}finally{Ur=t,R2=!1}}return null}var $_=[],G_=0,HE=null,WE=0,ql=[],Zl=0,ym=null,Od=1,Fd="";function Xp(e,t){$_[G_++]=WE,$_[G_++]=HE,HE=e,WE=t}function UU(e,t,i){ql[Zl++]=Od,ql[Zl++]=Fd,ql[Zl++]=ym,ym=e;var l=Od;e=Fd;var d=32-Wc(l)-1;l&=~(1<<d),i+=1;var m=32-Wc(t)+d;if(30<m){var v=d-d%5;m=(l&(1<<v)-1).toString(32),l>>=v,d-=v,Od=1<<32-Wc(t)+d|i<<d|l,Fd=m+e}else Od=1<<m|i<<d|l,Fd=e}function xk(e){e.return!==null&&(Xp(e,1),UU(e,1,0))}function bk(e){for(;e===HE;)HE=$_[--G_],$_[G_]=null,WE=$_[--G_],$_[G_]=null;for(;e===ym;)ym=ql[--Zl],ql[Zl]=null,Fd=ql[--Zl],ql[Zl]=null,Od=ql[--Zl],ql[Zl]=null}var vl=null,yl=null,xs=!1,Vc=null;function $U(e,t){var i=Xl(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)}function aj(e,t){switch(e.tag){case 5:var i=e.type;return t=t.nodeType!==1||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,vl=e,yl=gf(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,vl=e,yl=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(i=ym!==null?{id:Od,overflow:Fd}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},i=Xl(18,null,null,0),i.stateNode=t,i.return=e,e.child=i,vl=e,yl=null,!0):!1;default:return!1}}function uR(e){return(e.mode&1)!==0&&(e.flags&128)===0}function dR(e){if(xs){var t=yl;if(t){var i=t;if(!aj(e,t)){if(uR(e))throw Error(an(418));t=gf(i.nextSibling);var l=vl;t&&aj(e,t)?$U(l,i):(e.flags=e.flags&-4097|2,xs=!1,vl=e)}}else{if(uR(e))throw Error(an(418));e.flags=e.flags&-4097|2,xs=!1,vl=e}}}function lj(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;vl=e}function MT(e){if(e!==vl)return!1;if(!xs)return lj(e),xs=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!oR(e.type,e.memoizedProps)),t&&(t=yl)){if(uR(e))throw GU(),Error(an(418));for(;t;)$U(e,t),t=gf(t.nextSibling)}if(lj(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(an(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"){if(t===0){yl=gf(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++}e=e.nextSibling}yl=null}}else yl=vl?gf(e.stateNode.nextSibling):null;return!0}function GU(){for(var e=yl;e;)e=gf(e.nextSibling)}function Ry(){yl=vl=null,xs=!1}function wk(e){Vc===null?Vc=[e]:Vc.push(e)}var fee=th.ReactCurrentBatchConfig;function f0(e,t,i){if(e=i.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(an(309));var l=i.stateNode}if(!l)throw Error(an(147,e));var d=l,m=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===m?t.ref:(t=function(v){var o=d.refs;v===null?delete o[m]:o[m]=v},t._stringRef=m,t)}if(typeof e!="string")throw Error(an(284));if(!i._owner)throw Error(an(290,e))}return e}function kT(e,t){throw e=Object.prototype.toString.call(t),Error(an(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function cj(e){var t=e._init;return t(e._payload)}function HU(e){function t(Q,ee){if(e){var ie=Q.deletions;ie===null?(Q.deletions=[ee],Q.flags|=16):ie.push(ee)}}function i(Q,ee){if(!e)return null;for(;ee!==null;)t(Q,ee),ee=ee.sibling;return null}function l(Q,ee){for(Q=new Map;ee!==null;)ee.key!==null?Q.set(ee.key,ee):Q.set(ee.index,ee),ee=ee.sibling;return Q}function d(Q,ee){return Q=xf(Q,ee),Q.index=0,Q.sibling=null,Q}function m(Q,ee,ie){return Q.index=ie,e?(ie=Q.alternate,ie!==null?(ie=ie.index,ie<ee?(Q.flags|=2,ee):ie):(Q.flags|=2,ee)):(Q.flags|=1048576,ee)}function v(Q){return e&&Q.alternate===null&&(Q.flags|=2),Q}function o(Q,ee,ie,ue){return ee===null||ee.tag!==6?(ee=F2(ie,Q.mode,ue),ee.return=Q,ee):(ee=d(ee,ie),ee.return=Q,ee)}function I(Q,ee,ie,ue){var xe=ie.type;return xe===F_?N(Q,ee,ie.props.children,ue,ie.key):ee!==null&&(ee.elementType===xe||typeof xe=="object"&&xe!==null&&xe.$$typeof===qh&&cj(xe)===ee.type)?(ue=d(ee,ie.props),ue.ref=f0(Q,ee,ie),ue.return=Q,ue):(ue=mE(ie.type,ie.key,ie.props,null,Q.mode,ue),ue.ref=f0(Q,ee,ie),ue.return=Q,ue)}function A(Q,ee,ie,ue){return ee===null||ee.tag!==4||ee.stateNode.containerInfo!==ie.containerInfo||ee.stateNode.implementation!==ie.implementation?(ee=z2(ie,Q.mode,ue),ee.return=Q,ee):(ee=d(ee,ie.children||[]),ee.return=Q,ee)}function N(Q,ee,ie,ue,xe){return ee===null||ee.tag!==7?(ee=pm(ie,Q.mode,ue,xe),ee.return=Q,ee):(ee=d(ee,ie),ee.return=Q,ee)}function F(Q,ee,ie){if(typeof ee=="string"&&ee!==""||typeof ee=="number")return ee=F2(""+ee,Q.mode,ie),ee.return=Q,ee;if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case bT:return ie=mE(ee.type,ee.key,ee.props,null,Q.mode,ie),ie.ref=f0(Q,null,ee),ie.return=Q,ie;case O_:return ee=z2(ee,Q.mode,ie),ee.return=Q,ee;case qh:var ue=ee._init;return F(Q,ue(ee._payload),ie)}if(S0(ee)||l0(ee))return ee=pm(ee,Q.mode,ie,null),ee.return=Q,ee;kT(Q,ee)}return null}function z(Q,ee,ie,ue){var xe=ee!==null?ee.key:null;if(typeof ie=="string"&&ie!==""||typeof ie=="number")return xe!==null?null:o(Q,ee,""+ie,ue);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case bT:return ie.key===xe?I(Q,ee,ie,ue):null;case O_:return ie.key===xe?A(Q,ee,ie,ue):null;case qh:return xe=ie._init,z(Q,ee,xe(ie._payload),ue)}if(S0(ie)||l0(ie))return xe!==null?null:N(Q,ee,ie,ue,null);kT(Q,ie)}return null}function $(Q,ee,ie,ue,xe){if(typeof ue=="string"&&ue!==""||typeof ue=="number")return Q=Q.get(ie)||null,o(ee,Q,""+ue,xe);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case bT:return Q=Q.get(ue.key===null?ie:ue.key)||null,I(ee,Q,ue,xe);case O_:return Q=Q.get(ue.key===null?ie:ue.key)||null,A(ee,Q,ue,xe);case qh:var Oe=ue._init;return $(Q,ee,ie,Oe(ue._payload),xe)}if(S0(ue)||l0(ue))return Q=Q.get(ie)||null,N(ee,Q,ue,xe,null);kT(ee,ue)}return null}function J(Q,ee,ie,ue){for(var xe=null,Oe=null,ze=ee,Be=ee=0,ot=null;ze!==null&&Be<ie.length;Be++){ze.index>Be?(ot=ze,ze=null):ot=ze.sibling;var Et=z(Q,ze,ie[Be],ue);if(Et===null){ze===null&&(ze=ot);break}e&&ze&&Et.alternate===null&&t(Q,ze),ee=m(Et,ee,Be),Oe===null?xe=Et:Oe.sibling=Et,Oe=Et,ze=ot}if(Be===ie.length)return i(Q,ze),xs&&Xp(Q,Be),xe;if(ze===null){for(;Be<ie.length;Be++)ze=F(Q,ie[Be],ue),ze!==null&&(ee=m(ze,ee,Be),Oe===null?xe=ze:Oe.sibling=ze,Oe=ze);return xs&&Xp(Q,Be),xe}for(ze=l(Q,ze);Be<ie.length;Be++)ot=$(ze,Q,Be,ie[Be],ue),ot!==null&&(e&&ot.alternate!==null&&ze.delete(ot.key===null?Be:ot.key),ee=m(ot,ee,Be),Oe===null?xe=ot:Oe.sibling=ot,Oe=ot);return e&&ze.forEach(function(Zt){return t(Q,Zt)}),xs&&Xp(Q,Be),xe}function H(Q,ee,ie,ue){var xe=l0(ie);if(typeof xe!="function")throw Error(an(150));if(ie=xe.call(ie),ie==null)throw Error(an(151));for(var Oe=xe=null,ze=ee,Be=ee=0,ot=null,Et=ie.next();ze!==null&&!Et.done;Be++,Et=ie.next()){ze.index>Be?(ot=ze,ze=null):ot=ze.sibling;var Zt=z(Q,ze,Et.value,ue);if(Zt===null){ze===null&&(ze=ot);break}e&&ze&&Zt.alternate===null&&t(Q,ze),ee=m(Zt,ee,Be),Oe===null?xe=Zt:Oe.sibling=Zt,Oe=Zt,ze=ot}if(Et.done)return i(Q,ze),xs&&Xp(Q,Be),xe;if(ze===null){for(;!Et.done;Be++,Et=ie.next())Et=F(Q,Et.value,ue),Et!==null&&(ee=m(Et,ee,Be),Oe===null?xe=Et:Oe.sibling=Et,Oe=Et);return xs&&Xp(Q,Be),xe}for(ze=l(Q,ze);!Et.done;Be++,Et=ie.next())Et=$(ze,Q,Be,Et.value,ue),Et!==null&&(e&&Et.alternate!==null&&ze.delete(Et.key===null?Be:Et.key),ee=m(Et,ee,Be),Oe===null?xe=Et:Oe.sibling=Et,Oe=Et);return e&&ze.forEach(function(at){return t(Q,at)}),xs&&Xp(Q,Be),xe}function re(Q,ee,ie,ue){if(typeof ie=="object"&&ie!==null&&ie.type===F_&&ie.key===null&&(ie=ie.props.children),typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case bT:e:{for(var xe=ie.key,Oe=ee;Oe!==null;){if(Oe.key===xe){if(xe=ie.type,xe===F_){if(Oe.tag===7){i(Q,Oe.sibling),ee=d(Oe,ie.props.children),ee.return=Q,Q=ee;break e}}else if(Oe.elementType===xe||typeof xe=="object"&&xe!==null&&xe.$$typeof===qh&&cj(xe)===Oe.type){i(Q,Oe.sibling),ee=d(Oe,ie.props),ee.ref=f0(Q,Oe,ie),ee.return=Q,Q=ee;break e}i(Q,Oe);break}else t(Q,Oe);Oe=Oe.sibling}ie.type===F_?(ee=pm(ie.props.children,Q.mode,ue,ie.key),ee.return=Q,Q=ee):(ue=mE(ie.type,ie.key,ie.props,null,Q.mode,ue),ue.ref=f0(Q,ee,ie),ue.return=Q,Q=ue)}return v(Q);case O_:e:{for(Oe=ie.key;ee!==null;){if(ee.key===Oe)if(ee.tag===4&&ee.stateNode.containerInfo===ie.containerInfo&&ee.stateNode.implementation===ie.implementation){i(Q,ee.sibling),ee=d(ee,ie.children||[]),ee.return=Q,Q=ee;break e}else{i(Q,ee);break}else t(Q,ee);ee=ee.sibling}ee=z2(ie,Q.mode,ue),ee.return=Q,Q=ee}return v(Q);case qh:return Oe=ie._init,re(Q,ee,Oe(ie._payload),ue)}if(S0(ie))return J(Q,ee,ie,ue);if(l0(ie))return H(Q,ee,ie,ue);kT(Q,ie)}return typeof ie=="string"&&ie!==""||typeof ie=="number"?(ie=""+ie,ee!==null&&ee.tag===6?(i(Q,ee.sibling),ee=d(ee,ie),ee.return=Q,Q=ee):(i(Q,ee),ee=F2(ie,Q.mode,ue),ee.return=Q,Q=ee),v(Q)):i(Q,ee)}return re}var My=HU(!0),WU=HU(!1),qE=Gf(null),ZE=null,H_=null,Tk=null;function Ek(){Tk=H_=ZE=null}function Sk(e){var t=qE.current;ps(qE),e._currentValue=t}function hR(e,t,i){for(;e!==null;){var l=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,l!==null&&(l.childLanes|=t)):l!==null&&(l.childLanes&t)!==t&&(l.childLanes|=t),e===i)break;e=e.return}}function sy(e,t){ZE=e,Tk=H_=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Wa=!0),e.firstContext=null)}function nc(e){var t=e._currentValue;if(Tk!==e)if(e={context:e,memoizedValue:t,next:null},H_===null){if(ZE===null)throw Error(an(308));H_=e,ZE.dependencies={lanes:0,firstContext:e}}else H_=H_.next=e;return t}var nm=null;function Ck(e){nm===null?nm=[e]:nm.push(e)}function qU(e,t,i,l){var d=t.interleaved;return d===null?(i.next=i,Ck(t)):(i.next=d.next,d.next=i),t.interleaved=i,Wd(e,l)}function Wd(e,t){e.lanes|=t;var i=e.alternate;for(i!==null&&(i.lanes|=t),i=e,e=e.return;e!==null;)e.childLanes|=t,i=e.alternate,i!==null&&(i.childLanes|=t),i=e,e=e.return;return i.tag===3?i.stateNode:null}var Zh=!1;function Ik(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ZU(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Vd(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function _f(e,t,i){var l=e.updateQueue;if(l===null)return null;if(l=l.shared,Er&2){var d=l.pending;return d===null?t.next=t:(t.next=d.next,d.next=t),l.pending=t,Wd(e,i)}return d=l.interleaved,d===null?(t.next=t,Ck(l)):(t.next=d.next,d.next=t),l.interleaved=t,Wd(e,i)}function cE(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194240)!==0)){var l=t.lanes;l&=e.pendingLanes,i|=l,t.lanes=i,hk(e,i)}}function uj(e,t){var i=e.updateQueue,l=e.alternate;if(l!==null&&(l=l.updateQueue,i===l)){var d=null,m=null;if(i=i.firstBaseUpdate,i!==null){do{var v={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};m===null?d=m=v:m=m.next=v,i=i.next}while(i!==null);m===null?d=m=t:m=m.next=t}else d=m=t;i={baseState:l.baseState,firstBaseUpdate:d,lastBaseUpdate:m,shared:l.shared,effects:l.effects},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function KE(e,t,i,l){var d=e.updateQueue;Zh=!1;var m=d.firstBaseUpdate,v=d.lastBaseUpdate,o=d.shared.pending;if(o!==null){d.shared.pending=null;var I=o,A=I.next;I.next=null,v===null?m=A:v.next=A,v=I;var N=e.alternate;N!==null&&(N=N.updateQueue,o=N.lastBaseUpdate,o!==v&&(o===null?N.firstBaseUpdate=A:o.next=A,N.lastBaseUpdate=I))}if(m!==null){var F=d.baseState;v=0,N=A=I=null,o=m;do{var z=o.lane,$=o.eventTime;if((l&z)===z){N!==null&&(N=N.next={eventTime:$,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var J=e,H=o;switch(z=t,$=i,H.tag){case 1:if(J=H.payload,typeof J=="function"){F=J.call($,F,z);break e}F=J;break e;case 3:J.flags=J.flags&-65537|128;case 0:if(J=H.payload,z=typeof J=="function"?J.call($,F,z):J,z==null)break e;F=Ms({},F,z);break e;case 2:Zh=!0}}o.callback!==null&&o.lane!==0&&(e.flags|=64,z=d.effects,z===null?d.effects=[o]:z.push(o))}else $={eventTime:$,lane:z,tag:o.tag,payload:o.payload,callback:o.callback,next:null},N===null?(A=N=$,I=F):N=N.next=$,v|=z;if(o=o.next,o===null){if(o=d.shared.pending,o===null)break;z=o,o=z.next,z.next=null,d.lastBaseUpdate=z,d.shared.pending=null}}while(!0);if(N===null&&(I=F),d.baseState=I,d.firstBaseUpdate=A,d.lastBaseUpdate=N,t=d.shared.interleaved,t!==null){d=t;do v|=d.lane,d=d.next;while(d!==t)}else m===null&&(d.shared.lanes=0);xm|=v,e.lanes=v,e.memoizedState=F}}function dj(e,t,i){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var l=e[t],d=l.callback;if(d!==null){if(l.callback=null,l=i,typeof d!="function")throw Error(an(191,d));d.call(l)}}}var X1={},Uu=Gf(X1),u1=Gf(X1),d1=Gf(X1);function im(e){if(e===X1)throw Error(an(174));return e}function Ak(e,t){switch(os(d1,t),os(u1,e),os(Uu,X1),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:WP(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=WP(t,e)}ps(Uu),os(Uu,t)}function ky(){ps(Uu),ps(u1),ps(d1)}function KU(e){im(d1.current);var t=im(Uu.current),i=WP(t,e.type);t!==i&&(os(u1,e),os(Uu,i))}function Pk(e){u1.current===e&&(ps(Uu),ps(u1))}var As=Gf(0);function XE(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var M2=[];function Rk(){for(var e=0;e<M2.length;e++)M2[e]._workInProgressVersionPrimary=null;M2.length=0}var uE=th.ReactCurrentDispatcher,k2=th.ReactCurrentBatchConfig,vm=0,Rs=null,lo=null,Eo=null,YE=!1,F0=!1,h1=0,pee=0;function Zo(){throw Error(an(321))}function Mk(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!eu(e[i],t[i]))return!1;return!0}function kk(e,t,i,l,d,m){if(vm=m,Rs=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,uE.current=e===null||e.memoizedState===null?yee:vee,e=i(l,d),F0){m=0;do{if(F0=!1,h1=0,25<=m)throw Error(an(301));m+=1,Eo=lo=null,t.updateQueue=null,uE.current=xee,e=i(l,d)}while(F0)}if(uE.current=QE,t=lo!==null&&lo.next!==null,vm=0,Eo=lo=Rs=null,YE=!1,t)throw Error(an(300));return e}function Dk(){var e=h1!==0;return h1=0,e}function Du(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Eo===null?Rs.memoizedState=Eo=e:Eo=Eo.next=e,Eo}function ic(){if(lo===null){var e=Rs.alternate;e=e!==null?e.memoizedState:null}else e=lo.next;var t=Eo===null?Rs.memoizedState:Eo.next;if(t!==null)Eo=t,lo=e;else{if(e===null)throw Error(an(310));lo=e,e={memoizedState:lo.memoizedState,baseState:lo.baseState,baseQueue:lo.baseQueue,queue:lo.queue,next:null},Eo===null?Rs.memoizedState=Eo=e:Eo=Eo.next=e}return Eo}function f1(e,t){return typeof t=="function"?t(e):t}function D2(e){var t=ic(),i=t.queue;if(i===null)throw Error(an(311));i.lastRenderedReducer=e;var l=lo,d=l.baseQueue,m=i.pending;if(m!==null){if(d!==null){var v=d.next;d.next=m.next,m.next=v}l.baseQueue=d=m,i.pending=null}if(d!==null){m=d.next,l=l.baseState;var o=v=null,I=null,A=m;do{var N=A.lane;if((vm&N)===N)I!==null&&(I=I.next={lane:0,action:A.action,hasEagerState:A.hasEagerState,eagerState:A.eagerState,next:null}),l=A.hasEagerState?A.eagerState:e(l,A.action);else{var F={lane:N,action:A.action,hasEagerState:A.hasEagerState,eagerState:A.eagerState,next:null};I===null?(o=I=F,v=l):I=I.next=F,Rs.lanes|=N,xm|=N}A=A.next}while(A!==null&&A!==m);I===null?v=l:I.next=o,eu(l,t.memoizedState)||(Wa=!0),t.memoizedState=l,t.baseState=v,t.baseQueue=I,i.lastRenderedState=l}if(e=i.interleaved,e!==null){d=e;do m=d.lane,Rs.lanes|=m,xm|=m,d=d.next;while(d!==e)}else d===null&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function N2(e){var t=ic(),i=t.queue;if(i===null)throw Error(an(311));i.lastRenderedReducer=e;var l=i.dispatch,d=i.pending,m=t.memoizedState;if(d!==null){i.pending=null;var v=d=d.next;do m=e(m,v.action),v=v.next;while(v!==d);eu(m,t.memoizedState)||(Wa=!0),t.memoizedState=m,t.baseQueue===null&&(t.baseState=m),i.lastRenderedState=m}return[m,l]}function XU(){}function YU(e,t){var i=Rs,l=ic(),d=t(),m=!eu(l.memoizedState,d);if(m&&(l.memoizedState=d,Wa=!0),l=l.queue,Nk(e6.bind(null,i,l,e),[e]),l.getSnapshot!==t||m||Eo!==null&&Eo.memoizedState.tag&1){if(i.flags|=2048,p1(9,JU.bind(null,i,l,d,t),void 0,null),Co===null)throw Error(an(349));vm&30||QU(i,t,d)}return d}function QU(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=Rs.updateQueue,t===null?(t={lastEffect:null,stores:null},Rs.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function JU(e,t,i,l){t.value=i,t.getSnapshot=l,t6(t)&&n6(e)}function e6(e,t,i){return i(function(){t6(t)&&n6(e)})}function t6(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!eu(e,i)}catch{return!0}}function n6(e){var t=Wd(e,1);t!==null&&qc(t,e,1,-1)}function hj(e){var t=Du();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f1,lastRenderedState:e},t.queue=e,e=e.dispatch=_ee.bind(null,Rs,e),[t.memoizedState,e]}function p1(e,t,i,l){return e={tag:e,create:t,destroy:i,deps:l,next:null},t=Rs.updateQueue,t===null?(t={lastEffect:null,stores:null},Rs.updateQueue=t,t.lastEffect=e.next=e):(i=t.lastEffect,i===null?t.lastEffect=e.next=e:(l=i.next,i.next=e,e.next=l,t.lastEffect=e)),e}function i6(){return ic().memoizedState}function dE(e,t,i,l){var d=Du();Rs.flags|=e,d.memoizedState=p1(1|t,i,void 0,l===void 0?null:l)}function rC(e,t,i,l){var d=ic();l=l===void 0?null:l;var m=void 0;if(lo!==null){var v=lo.memoizedState;if(m=v.destroy,l!==null&&Mk(l,v.deps)){d.memoizedState=p1(t,i,m,l);return}}Rs.flags|=e,d.memoizedState=p1(1|t,i,m,l)}function fj(e,t){return dE(8390656,8,e,t)}function Nk(e,t){return rC(2048,8,e,t)}function r6(e,t){return rC(4,2,e,t)}function s6(e,t){return rC(4,4,e,t)}function o6(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function a6(e,t,i){return i=i!=null?i.concat([e]):null,rC(4,4,o6.bind(null,t,e),i)}function Lk(){}function l6(e,t){var i=ic();t=t===void 0?null:t;var l=i.memoizedState;return l!==null&&t!==null&&Mk(t,l[1])?l[0]:(i.memoizedState=[e,t],e)}function c6(e,t){var i=ic();t=t===void 0?null:t;var l=i.memoizedState;return l!==null&&t!==null&&Mk(t,l[1])?l[0]:(e=e(),i.memoizedState=[e,t],e)}function u6(e,t,i){return vm&21?(eu(i,t)||(i=mU(),Rs.lanes|=i,xm|=i,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Wa=!0),e.memoizedState=i)}function mee(e,t){var i=Ur;Ur=i!==0&&4>i?i:4,e(!0);var l=k2.transition;k2.transition={};try{e(!1),t()}finally{Ur=i,k2.transition=l}}function d6(){return ic().memoizedState}function gee(e,t,i){var l=vf(e);if(i={lane:l,action:i,hasEagerState:!1,eagerState:null,next:null},h6(e))f6(t,i);else if(i=qU(e,t,i,l),i!==null){var d=_a();qc(i,e,l,d),p6(i,t,l)}}function _ee(e,t,i){var l=vf(e),d={lane:l,action:i,hasEagerState:!1,eagerState:null,next:null};if(h6(e))f6(t,d);else{var m=e.alternate;if(e.lanes===0&&(m===null||m.lanes===0)&&(m=t.lastRenderedReducer,m!==null))try{var v=t.lastRenderedState,o=m(v,i);if(d.hasEagerState=!0,d.eagerState=o,eu(o,v)){var I=t.interleaved;I===null?(d.next=d,Ck(t)):(d.next=I.next,I.next=d),t.interleaved=d;return}}catch{}finally{}i=qU(e,t,d,l),i!==null&&(d=_a(),qc(i,e,l,d),p6(i,t,l))}}function h6(e){var t=e.alternate;return e===Rs||t!==null&&t===Rs}function f6(e,t){F0=YE=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function p6(e,t,i){if(i&4194240){var l=t.lanes;l&=e.pendingLanes,i|=l,t.lanes=i,hk(e,i)}}var QE={readContext:nc,useCallback:Zo,useContext:Zo,useEffect:Zo,useImperativeHandle:Zo,useInsertionEffect:Zo,useLayoutEffect:Zo,useMemo:Zo,useReducer:Zo,useRef:Zo,useState:Zo,useDebugValue:Zo,useDeferredValue:Zo,useTransition:Zo,useMutableSource:Zo,useSyncExternalStore:Zo,useId:Zo,unstable_isNewReconciler:!1},yee={readContext:nc,useCallback:function(e,t){return Du().memoizedState=[e,t===void 0?null:t],e},useContext:nc,useEffect:fj,useImperativeHandle:function(e,t,i){return i=i!=null?i.concat([e]):null,dE(4194308,4,o6.bind(null,t,e),i)},useLayoutEffect:function(e,t){return dE(4194308,4,e,t)},useInsertionEffect:function(e,t){return dE(4,2,e,t)},useMemo:function(e,t){var i=Du();return t=t===void 0?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var l=Du();return t=i!==void 0?i(t):t,l.memoizedState=l.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},l.queue=e,e=e.dispatch=gee.bind(null,Rs,e),[l.memoizedState,e]},useRef:function(e){var t=Du();return e={current:e},t.memoizedState=e},useState:hj,useDebugValue:Lk,useDeferredValue:function(e){return Du().memoizedState=e},useTransition:function(){var e=hj(!1),t=e[0];return e=mee.bind(null,e[1]),Du().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var l=Rs,d=Du();if(xs){if(i===void 0)throw Error(an(407));i=i()}else{if(i=t(),Co===null)throw Error(an(349));vm&30||QU(l,t,i)}d.memoizedState=i;var m={value:i,getSnapshot:t};return d.queue=m,fj(e6.bind(null,l,m,e),[e]),l.flags|=2048,p1(9,JU.bind(null,l,m,i,t),void 0,null),i},useId:function(){var e=Du(),t=Co.identifierPrefix;if(xs){var i=Fd,l=Od;i=(l&~(1<<32-Wc(l)-1)).toString(32)+i,t=":"+t+"R"+i,i=h1++,0<i&&(t+="H"+i.toString(32)),t+=":"}else i=pee++,t=":"+t+"r"+i.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},vee={readContext:nc,useCallback:l6,useContext:nc,useEffect:Nk,useImperativeHandle:a6,useInsertionEffect:r6,useLayoutEffect:s6,useMemo:c6,useReducer:D2,useRef:i6,useState:function(){return D2(f1)},useDebugValue:Lk,useDeferredValue:function(e){var t=ic();return u6(t,lo.memoizedState,e)},useTransition:function(){var e=D2(f1)[0],t=ic().memoizedState;return[e,t]},useMutableSource:XU,useSyncExternalStore:YU,useId:d6,unstable_isNewReconciler:!1},xee={readContext:nc,useCallback:l6,useContext:nc,useEffect:Nk,useImperativeHandle:a6,useInsertionEffect:r6,useLayoutEffect:s6,useMemo:c6,useReducer:N2,useRef:i6,useState:function(){return N2(f1)},useDebugValue:Lk,useDeferredValue:function(e){var t=ic();return lo===null?t.memoizedState=e:u6(t,lo.memoizedState,e)},useTransition:function(){var e=N2(f1)[0],t=ic().memoizedState;return[e,t]},useMutableSource:XU,useSyncExternalStore:YU,useId:d6,unstable_isNewReconciler:!1};function Oc(e,t){if(e&&e.defaultProps){t=Ms({},t),e=e.defaultProps;for(var i in e)t[i]===void 0&&(t[i]=e[i]);return t}return t}function fR(e,t,i,l){t=e.memoizedState,i=i(l,t),i=i==null?t:Ms({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var sC={isMounted:function(e){return(e=e._reactInternals)?Lm(e)===e:!1},enqueueSetState:function(e,t,i){e=e._reactInternals;var l=_a(),d=vf(e),m=Vd(l,d);m.payload=t,i!=null&&(m.callback=i),t=_f(e,m,d),t!==null&&(qc(t,e,d,l),cE(t,e,d))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var l=_a(),d=vf(e),m=Vd(l,d);m.tag=1,m.payload=t,i!=null&&(m.callback=i),t=_f(e,m,d),t!==null&&(qc(t,e,d,l),cE(t,e,d))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=_a(),l=vf(e),d=Vd(i,l);d.tag=2,t!=null&&(d.callback=t),t=_f(e,d,l),t!==null&&(qc(t,e,l,i),cE(t,e,l))}};function pj(e,t,i,l,d,m,v){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(l,m,v):t.prototype&&t.prototype.isPureReactComponent?!o1(i,l)||!o1(d,m):!0}function m6(e,t,i){var l=!1,d=Pf,m=t.contextType;return typeof m=="object"&&m!==null?m=nc(m):(d=Xa(t)?_m:ea.current,l=t.contextTypes,m=(l=l!=null)?Py(e,d):Pf),t=new t(i,m),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=sC,e.stateNode=t,t._reactInternals=e,l&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=d,e.__reactInternalMemoizedMaskedChildContext=m),t}function mj(e,t,i,l){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,l),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,l),t.state!==e&&sC.enqueueReplaceState(t,t.state,null)}function pR(e,t,i,l){var d=e.stateNode;d.props=i,d.state=e.memoizedState,d.refs={},Ik(e);var m=t.contextType;typeof m=="object"&&m!==null?d.context=nc(m):(m=Xa(t)?_m:ea.current,d.context=Py(e,m)),d.state=e.memoizedState,m=t.getDerivedStateFromProps,typeof m=="function"&&(fR(e,t,m,i),d.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(t=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),t!==d.state&&sC.enqueueReplaceState(d,d.state,null),KE(e,i,d,l),d.state=e.memoizedState),typeof d.componentDidMount=="function"&&(e.flags|=4194308)}function Dy(e,t){try{var i="",l=t;do i+=ZQ(l),l=l.return;while(l);var d=i}catch(m){d=`
Error generating stack: `+m.message+`
`+m.stack}return{value:e,source:t,stack:d,digest:null}}function L2(e,t,i){return{value:e,source:null,stack:i??null,digest:t??null}}function mR(e,t){try{console.error(t.value)}catch(i){setTimeout(function(){throw i})}}var bee=typeof WeakMap=="function"?WeakMap:Map;function g6(e,t,i){i=Vd(-1,i),i.tag=3,i.payload={element:null};var l=t.value;return i.callback=function(){eS||(eS=!0,SR=l),mR(e,t)},i}function _6(e,t,i){i=Vd(-1,i),i.tag=3;var l=e.type.getDerivedStateFromError;if(typeof l=="function"){var d=t.value;i.payload=function(){return l(d)},i.callback=function(){mR(e,t)}}var m=e.stateNode;return m!==null&&typeof m.componentDidCatch=="function"&&(i.callback=function(){mR(e,t),typeof l!="function"&&(yf===null?yf=new Set([this]):yf.add(this));var v=t.stack;this.componentDidCatch(t.value,{componentStack:v!==null?v:""})}),i}function gj(e,t,i){var l=e.pingCache;if(l===null){l=e.pingCache=new bee;var d=new Set;l.set(t,d)}else d=l.get(t),d===void 0&&(d=new Set,l.set(t,d));d.has(i)||(d.add(i),e=Lee.bind(null,e,t,i),t.then(e,e))}function _j(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function yj(e,t,i,l,d){return e.mode&1?(e.flags|=65536,e.lanes=d,e):(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(t=Vd(-1,1),t.tag=2,_f(i,t,1))),i.lanes|=1),e)}var wee=th.ReactCurrentOwner,Wa=!1;function fa(e,t,i,l){t.child=e===null?WU(t,null,i,l):My(t,e.child,i,l)}function vj(e,t,i,l,d){i=i.render;var m=t.ref;return sy(t,d),l=kk(e,t,i,l,m,d),i=Dk(),e!==null&&!Wa?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~d,qd(e,t,d)):(xs&&i&&xk(t),t.flags|=1,fa(e,t,l,d),t.child)}function xj(e,t,i,l,d){if(e===null){var m=i.type;return typeof m=="function"&&!$k(m)&&m.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(t.tag=15,t.type=m,y6(e,t,m,l,d)):(e=mE(i.type,null,l,t,t.mode,d),e.ref=t.ref,e.return=t,t.child=e)}if(m=e.child,!(e.lanes&d)){var v=m.memoizedProps;if(i=i.compare,i=i!==null?i:o1,i(v,l)&&e.ref===t.ref)return qd(e,t,d)}return t.flags|=1,e=xf(m,l),e.ref=t.ref,e.return=t,t.child=e}function y6(e,t,i,l,d){if(e!==null){var m=e.memoizedProps;if(o1(m,l)&&e.ref===t.ref)if(Wa=!1,t.pendingProps=l=m,(e.lanes&d)!==0)e.flags&131072&&(Wa=!0);else return t.lanes=e.lanes,qd(e,t,d)}return gR(e,t,i,l,d)}function v6(e,t,i){var l=t.pendingProps,d=l.children,m=e!==null?e.memoizedState:null;if(l.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},os(q_,ml),ml|=i;else{if(!(i&1073741824))return e=m!==null?m.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,os(q_,ml),ml|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},l=m!==null?m.baseLanes:i,os(q_,ml),ml|=l}else m!==null?(l=m.baseLanes|i,t.memoizedState=null):l=i,os(q_,ml),ml|=l;return fa(e,t,d,i),t.child}function x6(e,t){var i=t.ref;(e===null&&i!==null||e!==null&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function gR(e,t,i,l,d){var m=Xa(i)?_m:ea.current;return m=Py(t,m),sy(t,d),i=kk(e,t,i,l,m,d),l=Dk(),e!==null&&!Wa?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~d,qd(e,t,d)):(xs&&l&&xk(t),t.flags|=1,fa(e,t,i,d),t.child)}function bj(e,t,i,l,d){if(Xa(i)){var m=!0;GE(t)}else m=!1;if(sy(t,d),t.stateNode===null)hE(e,t),m6(t,i,l),pR(t,i,l,d),l=!0;else if(e===null){var v=t.stateNode,o=t.memoizedProps;v.props=o;var I=v.context,A=i.contextType;typeof A=="object"&&A!==null?A=nc(A):(A=Xa(i)?_m:ea.current,A=Py(t,A));var N=i.getDerivedStateFromProps,F=typeof N=="function"||typeof v.getSnapshotBeforeUpdate=="function";F||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(o!==l||I!==A)&&mj(t,v,l,A),Zh=!1;var z=t.memoizedState;v.state=z,KE(t,l,v,d),I=t.memoizedState,o!==l||z!==I||Ka.current||Zh?(typeof N=="function"&&(fR(t,i,N,l),I=t.memoizedState),(o=Zh||pj(t,i,o,l,z,I,A))?(F||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(t.flags|=4194308)):(typeof v.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=l,t.memoizedState=I),v.props=l,v.state=I,v.context=A,l=o):(typeof v.componentDidMount=="function"&&(t.flags|=4194308),l=!1)}else{v=t.stateNode,ZU(e,t),o=t.memoizedProps,A=t.type===t.elementType?o:Oc(t.type,o),v.props=A,F=t.pendingProps,z=v.context,I=i.contextType,typeof I=="object"&&I!==null?I=nc(I):(I=Xa(i)?_m:ea.current,I=Py(t,I));var $=i.getDerivedStateFromProps;(N=typeof $=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(o!==F||z!==I)&&mj(t,v,l,I),Zh=!1,z=t.memoizedState,v.state=z,KE(t,l,v,d);var J=t.memoizedState;o!==F||z!==J||Ka.current||Zh?(typeof $=="function"&&(fR(t,i,$,l),J=t.memoizedState),(A=Zh||pj(t,i,A,l,z,J,I)||!1)?(N||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(l,J,I),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(l,J,I)),typeof v.componentDidUpdate=="function"&&(t.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof v.componentDidUpdate!="function"||o===e.memoizedProps&&z===e.memoizedState||(t.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&z===e.memoizedState||(t.flags|=1024),t.memoizedProps=l,t.memoizedState=J),v.props=l,v.state=J,v.context=I,l=A):(typeof v.componentDidUpdate!="function"||o===e.memoizedProps&&z===e.memoizedState||(t.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&z===e.memoizedState||(t.flags|=1024),l=!1)}return _R(e,t,i,l,m,d)}function _R(e,t,i,l,d,m){x6(e,t);var v=(t.flags&128)!==0;if(!l&&!v)return d&&oj(t,i,!1),qd(e,t,m);l=t.stateNode,wee.current=t;var o=v&&typeof i.getDerivedStateFromError!="function"?null:l.render();return t.flags|=1,e!==null&&v?(t.child=My(t,e.child,null,m),t.child=My(t,null,o,m)):fa(e,t,o,m),t.memoizedState=l.state,d&&oj(t,i,!0),t.child}function b6(e){var t=e.stateNode;t.pendingContext?sj(e,t.pendingContext,t.pendingContext!==t.context):t.context&&sj(e,t.context,!1),Ak(e,t.containerInfo)}function wj(e,t,i,l,d){return Ry(),wk(d),t.flags|=256,fa(e,t,i,l),t.child}var yR={dehydrated:null,treeContext:null,retryLane:0};function vR(e){return{baseLanes:e,cachePool:null,transitions:null}}function w6(e,t,i){var l=t.pendingProps,d=As.current,m=!1,v=(t.flags&128)!==0,o;if((o=v)||(o=e!==null&&e.memoizedState===null?!1:(d&2)!==0),o?(m=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(d|=1),os(As,d&1),e===null)return dR(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(v=l.children,e=l.fallback,m?(l=t.mode,m=t.child,v={mode:"hidden",children:v},!(l&1)&&m!==null?(m.childLanes=0,m.pendingProps=v):m=lC(v,l,0,null),e=pm(e,l,i,null),m.return=t,e.return=t,m.sibling=e,t.child=m,t.child.memoizedState=vR(i),t.memoizedState=yR,e):Ok(t,v));if(d=e.memoizedState,d!==null&&(o=d.dehydrated,o!==null))return Tee(e,t,v,l,o,d,i);if(m){m=l.fallback,v=t.mode,d=e.child,o=d.sibling;var I={mode:"hidden",children:l.children};return!(v&1)&&t.child!==d?(l=t.child,l.childLanes=0,l.pendingProps=I,t.deletions=null):(l=xf(d,I),l.subtreeFlags=d.subtreeFlags&14680064),o!==null?m=xf(o,m):(m=pm(m,v,i,null),m.flags|=2),m.return=t,l.return=t,l.sibling=m,t.child=l,l=m,m=t.child,v=e.child.memoizedState,v=v===null?vR(i):{baseLanes:v.baseLanes|i,cachePool:null,transitions:v.transitions},m.memoizedState=v,m.childLanes=e.childLanes&~i,t.memoizedState=yR,l}return m=e.child,e=m.sibling,l=xf(m,{mode:"visible",children:l.children}),!(t.mode&1)&&(l.lanes=i),l.return=t,l.sibling=null,e!==null&&(i=t.deletions,i===null?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=l,t.memoizedState=null,l}function Ok(e,t){return t=lC({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function DT(e,t,i,l){return l!==null&&wk(l),My(t,e.child,null,i),e=Ok(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Tee(e,t,i,l,d,m,v){if(i)return t.flags&256?(t.flags&=-257,l=L2(Error(an(422))),DT(e,t,v,l)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(m=l.fallback,d=t.mode,l=lC({mode:"visible",children:l.children},d,0,null),m=pm(m,d,v,null),m.flags|=2,l.return=t,m.return=t,l.sibling=m,t.child=l,t.mode&1&&My(t,e.child,null,v),t.child.memoizedState=vR(v),t.memoizedState=yR,m);if(!(t.mode&1))return DT(e,t,v,null);if(d.data==="$!"){if(l=d.nextSibling&&d.nextSibling.dataset,l)var o=l.dgst;return l=o,m=Error(an(419)),l=L2(m,l,void 0),DT(e,t,v,l)}if(o=(v&e.childLanes)!==0,Wa||o){if(l=Co,l!==null){switch(v&-v){case 4:d=2;break;case 16:d=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:d=32;break;case 536870912:d=268435456;break;default:d=0}d=d&(l.suspendedLanes|v)?0:d,d!==0&&d!==m.retryLane&&(m.retryLane=d,Wd(e,d),qc(l,e,d,-1))}return Uk(),l=L2(Error(an(421))),DT(e,t,v,l)}return d.data==="$?"?(t.flags|=128,t.child=e.child,t=Oee.bind(null,e),d._reactRetry=t,null):(e=m.treeContext,yl=gf(d.nextSibling),vl=t,xs=!0,Vc=null,e!==null&&(ql[Zl++]=Od,ql[Zl++]=Fd,ql[Zl++]=ym,Od=e.id,Fd=e.overflow,ym=t),t=Ok(t,l.children),t.flags|=4096,t)}function Tj(e,t,i){e.lanes|=t;var l=e.alternate;l!==null&&(l.lanes|=t),hR(e.return,t,i)}function O2(e,t,i,l,d){var m=e.memoizedState;m===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:l,tail:i,tailMode:d}:(m.isBackwards=t,m.rendering=null,m.renderingStartTime=0,m.last=l,m.tail=i,m.tailMode=d)}function T6(e,t,i){var l=t.pendingProps,d=l.revealOrder,m=l.tail;if(fa(e,t,l.children,i),l=As.current,l&2)l=l&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Tj(e,i,t);else if(e.tag===19)Tj(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}l&=1}if(os(As,l),!(t.mode&1))t.memoizedState=null;else switch(d){case"forwards":for(i=t.child,d=null;i!==null;)e=i.alternate,e!==null&&XE(e)===null&&(d=i),i=i.sibling;i=d,i===null?(d=t.child,t.child=null):(d=i.sibling,i.sibling=null),O2(t,!1,d,i,m);break;case"backwards":for(i=null,d=t.child,t.child=null;d!==null;){if(e=d.alternate,e!==null&&XE(e)===null){t.child=d;break}e=d.sibling,d.sibling=i,i=d,d=e}O2(t,!0,i,null,m);break;case"together":O2(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function hE(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function qd(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),xm|=t.lanes,!(i&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(an(153));if(t.child!==null){for(e=t.child,i=xf(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=xf(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function Eee(e,t,i){switch(t.tag){case 3:b6(t),Ry();break;case 5:KU(t);break;case 1:Xa(t.type)&&GE(t);break;case 4:Ak(t,t.stateNode.containerInfo);break;case 10:var l=t.type._context,d=t.memoizedProps.value;os(qE,l._currentValue),l._currentValue=d;break;case 13:if(l=t.memoizedState,l!==null)return l.dehydrated!==null?(os(As,As.current&1),t.flags|=128,null):i&t.child.childLanes?w6(e,t,i):(os(As,As.current&1),e=qd(e,t,i),e!==null?e.sibling:null);os(As,As.current&1);break;case 19:if(l=(i&t.childLanes)!==0,e.flags&128){if(l)return T6(e,t,i);t.flags|=128}if(d=t.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),os(As,As.current),l)break;return null;case 22:case 23:return t.lanes=0,v6(e,t,i)}return qd(e,t,i)}var E6,xR,S6,C6;E6=function(e,t){for(var i=t.child;i!==null;){if(i.tag===5||i.tag===6)e.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};xR=function(){};S6=function(e,t,i,l){var d=e.memoizedProps;if(d!==l){e=t.stateNode,im(Uu.current);var m=null;switch(i){case"input":d=UP(e,d),l=UP(e,l),m=[];break;case"select":d=Ms({},d,{value:void 0}),l=Ms({},l,{value:void 0}),m=[];break;case"textarea":d=HP(e,d),l=HP(e,l),m=[];break;default:typeof d.onClick!="function"&&typeof l.onClick=="function"&&(e.onclick=UE)}qP(i,l);var v;i=null;for(A in d)if(!l.hasOwnProperty(A)&&d.hasOwnProperty(A)&&d[A]!=null)if(A==="style"){var o=d[A];for(v in o)o.hasOwnProperty(v)&&(i||(i={}),i[v]="")}else A!=="dangerouslySetInnerHTML"&&A!=="children"&&A!=="suppressContentEditableWarning"&&A!=="suppressHydrationWarning"&&A!=="autoFocus"&&(J0.hasOwnProperty(A)?m||(m=[]):(m=m||[]).push(A,null));for(A in l){var I=l[A];if(o=d!=null?d[A]:void 0,l.hasOwnProperty(A)&&I!==o&&(I!=null||o!=null))if(A==="style")if(o){for(v in o)!o.hasOwnProperty(v)||I&&I.hasOwnProperty(v)||(i||(i={}),i[v]="");for(v in I)I.hasOwnProperty(v)&&o[v]!==I[v]&&(i||(i={}),i[v]=I[v])}else i||(m||(m=[]),m.push(A,i)),i=I;else A==="dangerouslySetInnerHTML"?(I=I?I.__html:void 0,o=o?o.__html:void 0,I!=null&&o!==I&&(m=m||[]).push(A,I)):A==="children"?typeof I!="string"&&typeof I!="number"||(m=m||[]).push(A,""+I):A!=="suppressContentEditableWarning"&&A!=="suppressHydrationWarning"&&(J0.hasOwnProperty(A)?(I!=null&&A==="onScroll"&&fs("scroll",e),m||o===I||(m=[])):(m=m||[]).push(A,I))}i&&(m=m||[]).push("style",i);var A=m;(t.updateQueue=A)&&(t.flags|=4)}};C6=function(e,t,i,l){i!==l&&(t.flags|=4)};function p0(e,t){if(!xs)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:l.sibling=null}}function Ko(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,l=0;if(t)for(var d=e.child;d!==null;)i|=d.lanes|d.childLanes,l|=d.subtreeFlags&14680064,l|=d.flags&14680064,d.return=e,d=d.sibling;else for(d=e.child;d!==null;)i|=d.lanes|d.childLanes,l|=d.subtreeFlags,l|=d.flags,d.return=e,d=d.sibling;return e.subtreeFlags|=l,e.childLanes=i,t}function See(e,t,i){var l=t.pendingProps;switch(bk(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ko(t),null;case 1:return Xa(t.type)&&$E(),Ko(t),null;case 3:return l=t.stateNode,ky(),ps(Ka),ps(ea),Rk(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(e===null||e.child===null)&&(MT(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Vc!==null&&(AR(Vc),Vc=null))),xR(e,t),Ko(t),null;case 5:Pk(t);var d=im(d1.current);if(i=t.type,e!==null&&t.stateNode!=null)S6(e,t,i,l,d),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!l){if(t.stateNode===null)throw Error(an(166));return Ko(t),null}if(e=im(Uu.current),MT(t)){l=t.stateNode,i=t.type;var m=t.memoizedProps;switch(l[Fu]=t,l[c1]=m,e=(t.mode&1)!==0,i){case"dialog":fs("cancel",l),fs("close",l);break;case"iframe":case"object":case"embed":fs("load",l);break;case"video":case"audio":for(d=0;d<I0.length;d++)fs(I0[d],l);break;case"source":fs("error",l);break;case"img":case"image":case"link":fs("error",l),fs("load",l);break;case"details":fs("toggle",l);break;case"input":k3(l,m),fs("invalid",l);break;case"select":l._wrapperState={wasMultiple:!!m.multiple},fs("invalid",l);break;case"textarea":N3(l,m),fs("invalid",l)}qP(i,m),d=null;for(var v in m)if(m.hasOwnProperty(v)){var o=m[v];v==="children"?typeof o=="string"?l.textContent!==o&&(m.suppressHydrationWarning!==!0&&RT(l.textContent,o,e),d=["children",o]):typeof o=="number"&&l.textContent!==""+o&&(m.suppressHydrationWarning!==!0&&RT(l.textContent,o,e),d=["children",""+o]):J0.hasOwnProperty(v)&&o!=null&&v==="onScroll"&&fs("scroll",l)}switch(i){case"input":wT(l),D3(l,m,!0);break;case"textarea":wT(l),L3(l);break;case"select":case"option":break;default:typeof m.onClick=="function"&&(l.onclick=UE)}l=d,t.updateQueue=l,l!==null&&(t.flags|=4)}else{v=d.nodeType===9?d:d.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=eU(i)),e==="http://www.w3.org/1999/xhtml"?i==="script"?(e=v.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof l.is=="string"?e=v.createElement(i,{is:l.is}):(e=v.createElement(i),i==="select"&&(v=e,l.multiple?v.multiple=!0:l.size&&(v.size=l.size))):e=v.createElementNS(e,i),e[Fu]=t,e[c1]=l,E6(e,t,!1,!1),t.stateNode=e;e:{switch(v=ZP(i,l),i){case"dialog":fs("cancel",e),fs("close",e),d=l;break;case"iframe":case"object":case"embed":fs("load",e),d=l;break;case"video":case"audio":for(d=0;d<I0.length;d++)fs(I0[d],e);d=l;break;case"source":fs("error",e),d=l;break;case"img":case"image":case"link":fs("error",e),fs("load",e),d=l;break;case"details":fs("toggle",e),d=l;break;case"input":k3(e,l),d=UP(e,l),fs("invalid",e);break;case"option":d=l;break;case"select":e._wrapperState={wasMultiple:!!l.multiple},d=Ms({},l,{value:void 0}),fs("invalid",e);break;case"textarea":N3(e,l),d=HP(e,l),fs("invalid",e);break;default:d=l}qP(i,d),o=d;for(m in o)if(o.hasOwnProperty(m)){var I=o[m];m==="style"?iU(e,I):m==="dangerouslySetInnerHTML"?(I=I?I.__html:void 0,I!=null&&tU(e,I)):m==="children"?typeof I=="string"?(i!=="textarea"||I!=="")&&e1(e,I):typeof I=="number"&&e1(e,""+I):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&(J0.hasOwnProperty(m)?I!=null&&m==="onScroll"&&fs("scroll",e):I!=null&&ok(e,m,I,v))}switch(i){case"input":wT(e),D3(e,l,!1);break;case"textarea":wT(e),L3(e);break;case"option":l.value!=null&&e.setAttribute("value",""+Af(l.value));break;case"select":e.multiple=!!l.multiple,m=l.value,m!=null?ty(e,!!l.multiple,m,!1):l.defaultValue!=null&&ty(e,!!l.multiple,l.defaultValue,!0);break;default:typeof d.onClick=="function"&&(e.onclick=UE)}switch(i){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}}l&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Ko(t),null;case 6:if(e&&t.stateNode!=null)C6(e,t,e.memoizedProps,l);else{if(typeof l!="string"&&t.stateNode===null)throw Error(an(166));if(i=im(d1.current),im(Uu.current),MT(t)){if(l=t.stateNode,i=t.memoizedProps,l[Fu]=t,(m=l.nodeValue!==i)&&(e=vl,e!==null))switch(e.tag){case 3:RT(l.nodeValue,i,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&RT(l.nodeValue,i,(e.mode&1)!==0)}m&&(t.flags|=4)}else l=(i.nodeType===9?i:i.ownerDocument).createTextNode(l),l[Fu]=t,t.stateNode=l}return Ko(t),null;case 13:if(ps(As),l=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(xs&&yl!==null&&t.mode&1&&!(t.flags&128))GU(),Ry(),t.flags|=98560,m=!1;else if(m=MT(t),l!==null&&l.dehydrated!==null){if(e===null){if(!m)throw Error(an(318));if(m=t.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(an(317));m[Fu]=t}else Ry(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Ko(t),m=!1}else Vc!==null&&(AR(Vc),Vc=null),m=!0;if(!m)return t.flags&65536?t:null}return t.flags&128?(t.lanes=i,t):(l=l!==null,l!==(e!==null&&e.memoizedState!==null)&&l&&(t.child.flags|=8192,t.mode&1&&(e===null||As.current&1?ho===0&&(ho=3):Uk())),t.updateQueue!==null&&(t.flags|=4),Ko(t),null);case 4:return ky(),xR(e,t),e===null&&a1(t.stateNode.containerInfo),Ko(t),null;case 10:return Sk(t.type._context),Ko(t),null;case 17:return Xa(t.type)&&$E(),Ko(t),null;case 19:if(ps(As),m=t.memoizedState,m===null)return Ko(t),null;if(l=(t.flags&128)!==0,v=m.rendering,v===null)if(l)p0(m,!1);else{if(ho!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(v=XE(e),v!==null){for(t.flags|=128,p0(m,!1),l=v.updateQueue,l!==null&&(t.updateQueue=l,t.flags|=4),t.subtreeFlags=0,l=i,i=t.child;i!==null;)m=i,e=l,m.flags&=14680066,v=m.alternate,v===null?(m.childLanes=0,m.lanes=e,m.child=null,m.subtreeFlags=0,m.memoizedProps=null,m.memoizedState=null,m.updateQueue=null,m.dependencies=null,m.stateNode=null):(m.childLanes=v.childLanes,m.lanes=v.lanes,m.child=v.child,m.subtreeFlags=0,m.deletions=null,m.memoizedProps=v.memoizedProps,m.memoizedState=v.memoizedState,m.updateQueue=v.updateQueue,m.type=v.type,e=v.dependencies,m.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return os(As,As.current&1|2),t.child}e=e.sibling}m.tail!==null&&$s()>Ny&&(t.flags|=128,l=!0,p0(m,!1),t.lanes=4194304)}else{if(!l)if(e=XE(v),e!==null){if(t.flags|=128,l=!0,i=e.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),p0(m,!0),m.tail===null&&m.tailMode==="hidden"&&!v.alternate&&!xs)return Ko(t),null}else 2*$s()-m.renderingStartTime>Ny&&i!==1073741824&&(t.flags|=128,l=!0,p0(m,!1),t.lanes=4194304);m.isBackwards?(v.sibling=t.child,t.child=v):(i=m.last,i!==null?i.sibling=v:t.child=v,m.last=v)}return m.tail!==null?(t=m.tail,m.rendering=t,m.tail=t.sibling,m.renderingStartTime=$s(),t.sibling=null,i=As.current,os(As,l?i&1|2:i&1),t):(Ko(t),null);case 22:case 23:return Vk(),l=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==l&&(t.flags|=8192),l&&t.mode&1?ml&1073741824&&(Ko(t),t.subtreeFlags&6&&(t.flags|=8192)):Ko(t),null;case 24:return null;case 25:return null}throw Error(an(156,t.tag))}function Cee(e,t){switch(bk(t),t.tag){case 1:return Xa(t.type)&&$E(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return ky(),ps(Ka),ps(ea),Rk(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Pk(t),null;case 13:if(ps(As),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(an(340));Ry()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return ps(As),null;case 4:return ky(),null;case 10:return Sk(t.type._context),null;case 22:case 23:return Vk(),null;case 24:return null;default:return null}}var NT=!1,Yo=!1,Iee=typeof WeakSet=="function"?WeakSet:Set,Un=null;function W_(e,t){var i=e.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(l){Ls(e,t,l)}else i.current=null}function bR(e,t,i){try{i()}catch(l){Ls(e,t,l)}}var Ej=!1;function Aee(e,t){if(rR=jE,e=MU(),vk(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var l=i.getSelection&&i.getSelection();if(l&&l.rangeCount!==0){i=l.anchorNode;var d=l.anchorOffset,m=l.focusNode;l=l.focusOffset;try{i.nodeType,m.nodeType}catch{i=null;break e}var v=0,o=-1,I=-1,A=0,N=0,F=e,z=null;t:for(;;){for(var $;F!==i||d!==0&&F.nodeType!==3||(o=v+d),F!==m||l!==0&&F.nodeType!==3||(I=v+l),F.nodeType===3&&(v+=F.nodeValue.length),($=F.firstChild)!==null;)z=F,F=$;for(;;){if(F===e)break t;if(z===i&&++A===d&&(o=v),z===m&&++N===l&&(I=v),($=F.nextSibling)!==null)break;F=z,z=F.parentNode}F=$}i=o===-1||I===-1?null:{start:o,end:I}}else i=null}i=i||{start:0,end:0}}else i=null;for(sR={focusedElem:e,selectionRange:i},jE=!1,Un=t;Un!==null;)if(t=Un,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Un=e;else for(;Un!==null;){t=Un;try{var J=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(J!==null){var H=J.memoizedProps,re=J.memoizedState,Q=t.stateNode,ee=Q.getSnapshotBeforeUpdate(t.elementType===t.type?H:Oc(t.type,H),re);Q.__reactInternalSnapshotBeforeUpdate=ee}break;case 3:var ie=t.stateNode.containerInfo;ie.nodeType===1?ie.textContent="":ie.nodeType===9&&ie.documentElement&&ie.removeChild(ie.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(an(163))}}catch(ue){Ls(t,t.return,ue)}if(e=t.sibling,e!==null){e.return=t.return,Un=e;break}Un=t.return}return J=Ej,Ej=!1,J}function z0(e,t,i){var l=t.updateQueue;if(l=l!==null?l.lastEffect:null,l!==null){var d=l=l.next;do{if((d.tag&e)===e){var m=d.destroy;d.destroy=void 0,m!==void 0&&bR(t,i,m)}d=d.next}while(d!==l)}}function oC(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do{if((i.tag&e)===e){var l=i.create;i.destroy=l()}i=i.next}while(i!==t)}}function wR(e){var t=e.ref;if(t!==null){var i=e.stateNode;switch(e.tag){case 5:e=i;break;default:e=i}typeof t=="function"?t(e):t.current=e}}function I6(e){var t=e.alternate;t!==null&&(e.alternate=null,I6(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Fu],delete t[c1],delete t[lR],delete t[uee],delete t[dee])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function A6(e){return e.tag===5||e.tag===3||e.tag===4}function Sj(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||A6(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function TR(e,t,i){var l=e.tag;if(l===5||l===6)e=e.stateNode,t?i.nodeType===8?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(i.nodeType===8?(t=i.parentNode,t.insertBefore(e,i)):(t=i,t.appendChild(e)),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=UE));else if(l!==4&&(e=e.child,e!==null))for(TR(e,t,i),e=e.sibling;e!==null;)TR(e,t,i),e=e.sibling}function ER(e,t,i){var l=e.tag;if(l===5||l===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(l!==4&&(e=e.child,e!==null))for(ER(e,t,i),e=e.sibling;e!==null;)ER(e,t,i),e=e.sibling}var Oo=null,Bc=!1;function Bh(e,t,i){for(i=i.child;i!==null;)P6(e,t,i),i=i.sibling}function P6(e,t,i){if(Vu&&typeof Vu.onCommitFiberUnmount=="function")try{Vu.onCommitFiberUnmount(QS,i)}catch{}switch(i.tag){case 5:Yo||W_(i,t);case 6:var l=Oo,d=Bc;Oo=null,Bh(e,t,i),Oo=l,Bc=d,Oo!==null&&(Bc?(e=Oo,i=i.stateNode,e.nodeType===8?e.parentNode.removeChild(i):e.removeChild(i)):Oo.removeChild(i.stateNode));break;case 18:Oo!==null&&(Bc?(e=Oo,i=i.stateNode,e.nodeType===8?P2(e.parentNode,i):e.nodeType===1&&P2(e,i),r1(e)):P2(Oo,i.stateNode));break;case 4:l=Oo,d=Bc,Oo=i.stateNode.containerInfo,Bc=!0,Bh(e,t,i),Oo=l,Bc=d;break;case 0:case 11:case 14:case 15:if(!Yo&&(l=i.updateQueue,l!==null&&(l=l.lastEffect,l!==null))){d=l=l.next;do{var m=d,v=m.destroy;m=m.tag,v!==void 0&&(m&2||m&4)&&bR(i,t,v),d=d.next}while(d!==l)}Bh(e,t,i);break;case 1:if(!Yo&&(W_(i,t),l=i.stateNode,typeof l.componentWillUnmount=="function"))try{l.props=i.memoizedProps,l.state=i.memoizedState,l.componentWillUnmount()}catch(o){Ls(i,t,o)}Bh(e,t,i);break;case 21:Bh(e,t,i);break;case 22:i.mode&1?(Yo=(l=Yo)||i.memoizedState!==null,Bh(e,t,i),Yo=l):Bh(e,t,i);break;default:Bh(e,t,i)}}function Cj(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var i=e.stateNode;i===null&&(i=e.stateNode=new Iee),t.forEach(function(l){var d=Fee.bind(null,e,l);i.has(l)||(i.add(l),l.then(d,d))})}}function Mc(e,t){var i=t.deletions;if(i!==null)for(var l=0;l<i.length;l++){var d=i[l];try{var m=e,v=t,o=v;e:for(;o!==null;){switch(o.tag){case 5:Oo=o.stateNode,Bc=!1;break e;case 3:Oo=o.stateNode.containerInfo,Bc=!0;break e;case 4:Oo=o.stateNode.containerInfo,Bc=!0;break e}o=o.return}if(Oo===null)throw Error(an(160));P6(m,v,d),Oo=null,Bc=!1;var I=d.alternate;I!==null&&(I.return=null),d.return=null}catch(A){Ls(d,t,A)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)R6(t,e),t=t.sibling}function R6(e,t){var i=e.alternate,l=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Mc(t,e),ku(e),l&4){try{z0(3,e,e.return),oC(3,e)}catch(H){Ls(e,e.return,H)}try{z0(5,e,e.return)}catch(H){Ls(e,e.return,H)}}break;case 1:Mc(t,e),ku(e),l&512&&i!==null&&W_(i,i.return);break;case 5:if(Mc(t,e),ku(e),l&512&&i!==null&&W_(i,i.return),e.flags&32){var d=e.stateNode;try{e1(d,"")}catch(H){Ls(e,e.return,H)}}if(l&4&&(d=e.stateNode,d!=null)){var m=e.memoizedProps,v=i!==null?i.memoizedProps:m,o=e.type,I=e.updateQueue;if(e.updateQueue=null,I!==null)try{o==="input"&&m.type==="radio"&&m.name!=null&&QV(d,m),ZP(o,v);var A=ZP(o,m);for(v=0;v<I.length;v+=2){var N=I[v],F=I[v+1];N==="style"?iU(d,F):N==="dangerouslySetInnerHTML"?tU(d,F):N==="children"?e1(d,F):ok(d,N,F,A)}switch(o){case"input":$P(d,m);break;case"textarea":JV(d,m);break;case"select":var z=d._wrapperState.wasMultiple;d._wrapperState.wasMultiple=!!m.multiple;var $=m.value;$!=null?ty(d,!!m.multiple,$,!1):z!==!!m.multiple&&(m.defaultValue!=null?ty(d,!!m.multiple,m.defaultValue,!0):ty(d,!!m.multiple,m.multiple?[]:"",!1))}d[c1]=m}catch(H){Ls(e,e.return,H)}}break;case 6:if(Mc(t,e),ku(e),l&4){if(e.stateNode===null)throw Error(an(162));d=e.stateNode,m=e.memoizedProps;try{d.nodeValue=m}catch(H){Ls(e,e.return,H)}}break;case 3:if(Mc(t,e),ku(e),l&4&&i!==null&&i.memoizedState.isDehydrated)try{r1(t.containerInfo)}catch(H){Ls(e,e.return,H)}break;case 4:Mc(t,e),ku(e);break;case 13:Mc(t,e),ku(e),d=e.child,d.flags&8192&&(m=d.memoizedState!==null,d.stateNode.isHidden=m,!m||d.alternate!==null&&d.alternate.memoizedState!==null||(jk=$s())),l&4&&Cj(e);break;case 22:if(N=i!==null&&i.memoizedState!==null,e.mode&1?(Yo=(A=Yo)||N,Mc(t,e),Yo=A):Mc(t,e),ku(e),l&8192){if(A=e.memoizedState!==null,(e.stateNode.isHidden=A)&&!N&&e.mode&1)for(Un=e,N=e.child;N!==null;){for(F=Un=N;Un!==null;){switch(z=Un,$=z.child,z.tag){case 0:case 11:case 14:case 15:z0(4,z,z.return);break;case 1:W_(z,z.return);var J=z.stateNode;if(typeof J.componentWillUnmount=="function"){l=z,i=z.return;try{t=l,J.props=t.memoizedProps,J.state=t.memoizedState,J.componentWillUnmount()}catch(H){Ls(l,i,H)}}break;case 5:W_(z,z.return);break;case 22:if(z.memoizedState!==null){Aj(F);continue}}$!==null?($.return=z,Un=$):Aj(F)}N=N.sibling}e:for(N=null,F=e;;){if(F.tag===5){if(N===null){N=F;try{d=F.stateNode,A?(m=d.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none"):(o=F.stateNode,I=F.memoizedProps.style,v=I!=null&&I.hasOwnProperty("display")?I.display:null,o.style.display=nU("display",v))}catch(H){Ls(e,e.return,H)}}}else if(F.tag===6){if(N===null)try{F.stateNode.nodeValue=A?"":F.memoizedProps}catch(H){Ls(e,e.return,H)}}else if((F.tag!==22&&F.tag!==23||F.memoizedState===null||F===e)&&F.child!==null){F.child.return=F,F=F.child;continue}if(F===e)break e;for(;F.sibling===null;){if(F.return===null||F.return===e)break e;N===F&&(N=null),F=F.return}N===F&&(N=null),F.sibling.return=F.return,F=F.sibling}}break;case 19:Mc(t,e),ku(e),l&4&&Cj(e);break;case 21:break;default:Mc(t,e),ku(e)}}function ku(e){var t=e.flags;if(t&2){try{e:{for(var i=e.return;i!==null;){if(A6(i)){var l=i;break e}i=i.return}throw Error(an(160))}switch(l.tag){case 5:var d=l.stateNode;l.flags&32&&(e1(d,""),l.flags&=-33);var m=Sj(e);ER(e,m,d);break;case 3:case 4:var v=l.stateNode.containerInfo,o=Sj(e);TR(e,o,v);break;default:throw Error(an(161))}}catch(I){Ls(e,e.return,I)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Pee(e,t,i){Un=e,M6(e)}function M6(e,t,i){for(var l=(e.mode&1)!==0;Un!==null;){var d=Un,m=d.child;if(d.tag===22&&l){var v=d.memoizedState!==null||NT;if(!v){var o=d.alternate,I=o!==null&&o.memoizedState!==null||Yo;o=NT;var A=Yo;if(NT=v,(Yo=I)&&!A)for(Un=d;Un!==null;)v=Un,I=v.child,v.tag===22&&v.memoizedState!==null?Pj(d):I!==null?(I.return=v,Un=I):Pj(d);for(;m!==null;)Un=m,M6(m),m=m.sibling;Un=d,NT=o,Yo=A}Ij(e)}else d.subtreeFlags&8772&&m!==null?(m.return=d,Un=m):Ij(e)}}function Ij(e){for(;Un!==null;){var t=Un;if(t.flags&8772){var i=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Yo||oC(5,t);break;case 1:var l=t.stateNode;if(t.flags&4&&!Yo)if(i===null)l.componentDidMount();else{var d=t.elementType===t.type?i.memoizedProps:Oc(t.type,i.memoizedProps);l.componentDidUpdate(d,i.memoizedState,l.__reactInternalSnapshotBeforeUpdate)}var m=t.updateQueue;m!==null&&dj(t,m,l);break;case 3:var v=t.updateQueue;if(v!==null){if(i=null,t.child!==null)switch(t.child.tag){case 5:i=t.child.stateNode;break;case 1:i=t.child.stateNode}dj(t,v,i)}break;case 5:var o=t.stateNode;if(i===null&&t.flags&4){i=o;var I=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":I.autoFocus&&i.focus();break;case"img":I.src&&(i.src=I.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var A=t.alternate;if(A!==null){var N=A.memoizedState;if(N!==null){var F=N.dehydrated;F!==null&&r1(F)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(an(163))}Yo||t.flags&512&&wR(t)}catch(z){Ls(t,t.return,z)}}if(t===e){Un=null;break}if(i=t.sibling,i!==null){i.return=t.return,Un=i;break}Un=t.return}}function Aj(e){for(;Un!==null;){var t=Un;if(t===e){Un=null;break}var i=t.sibling;if(i!==null){i.return=t.return,Un=i;break}Un=t.return}}function Pj(e){for(;Un!==null;){var t=Un;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{oC(4,t)}catch(I){Ls(t,i,I)}break;case 1:var l=t.stateNode;if(typeof l.componentDidMount=="function"){var d=t.return;try{l.componentDidMount()}catch(I){Ls(t,d,I)}}var m=t.return;try{wR(t)}catch(I){Ls(t,m,I)}break;case 5:var v=t.return;try{wR(t)}catch(I){Ls(t,v,I)}}}catch(I){Ls(t,t.return,I)}if(t===e){Un=null;break}var o=t.sibling;if(o!==null){o.return=t.return,Un=o;break}Un=t.return}}var Ree=Math.ceil,JE=th.ReactCurrentDispatcher,Fk=th.ReactCurrentOwner,Jl=th.ReactCurrentBatchConfig,Er=0,Co=null,no=null,jo=0,ml=0,q_=Gf(0),ho=0,m1=null,xm=0,aC=0,zk=0,j0=null,Ha=null,jk=0,Ny=1/0,kd=null,eS=!1,SR=null,yf=null,LT=!1,lf=null,tS=0,B0=0,CR=null,fE=-1,pE=0;function _a(){return Er&6?$s():fE!==-1?fE:fE=$s()}function vf(e){return e.mode&1?Er&2&&jo!==0?jo&-jo:fee.transition!==null?(pE===0&&(pE=mU()),pE):(e=Ur,e!==0||(e=window.event,e=e===void 0?16:wU(e.type)),e):1}function qc(e,t,i,l){if(50<B0)throw B0=0,CR=null,Error(an(185));q1(e,i,l),(!(Er&2)||e!==Co)&&(e===Co&&(!(Er&2)&&(aC|=i),ho===4&&Xh(e,jo)),Ya(e,l),i===1&&Er===0&&!(t.mode&1)&&(Ny=$s()+500,iC&&Hf()))}function Ya(e,t){var i=e.callbackNode;fJ(e,t);var l=zE(e,e===Co?jo:0);if(l===0)i!==null&&z3(i),e.callbackNode=null,e.callbackPriority=0;else if(t=l&-l,e.callbackPriority!==t){if(i!=null&&z3(i),t===1)e.tag===0?hee(Rj.bind(null,e)):VU(Rj.bind(null,e)),lee(function(){!(Er&6)&&Hf()}),i=null;else{switch(gU(l)){case 1:i=dk;break;case 4:i=fU;break;case 16:i=FE;break;case 536870912:i=pU;break;default:i=FE}i=j6(i,k6.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function k6(e,t){if(fE=-1,pE=0,Er&6)throw Error(an(327));var i=e.callbackNode;if(oy()&&e.callbackNode!==i)return null;var l=zE(e,e===Co?jo:0);if(l===0)return null;if(l&30||l&e.expiredLanes||t)t=nS(e,l);else{t=l;var d=Er;Er|=2;var m=N6();(Co!==e||jo!==t)&&(kd=null,Ny=$s()+500,fm(e,t));do try{Dee();break}catch(o){D6(e,o)}while(!0);Ek(),JE.current=m,Er=d,no!==null?t=0:(Co=null,jo=0,t=ho)}if(t!==0){if(t===2&&(d=JP(e),d!==0&&(l=d,t=IR(e,d))),t===1)throw i=m1,fm(e,0),Xh(e,l),Ya(e,$s()),i;if(t===6)Xh(e,l);else{if(d=e.current.alternate,!(l&30)&&!Mee(d)&&(t=nS(e,l),t===2&&(m=JP(e),m!==0&&(l=m,t=IR(e,m))),t===1))throw i=m1,fm(e,0),Xh(e,l),Ya(e,$s()),i;switch(e.finishedWork=d,e.finishedLanes=l,t){case 0:case 1:throw Error(an(345));case 2:Yp(e,Ha,kd);break;case 3:if(Xh(e,l),(l&130023424)===l&&(t=jk+500-$s(),10<t)){if(zE(e,0)!==0)break;if(d=e.suspendedLanes,(d&l)!==l){_a(),e.pingedLanes|=e.suspendedLanes&d;break}e.timeoutHandle=aR(Yp.bind(null,e,Ha,kd),t);break}Yp(e,Ha,kd);break;case 4:if(Xh(e,l),(l&4194240)===l)break;for(t=e.eventTimes,d=-1;0<l;){var v=31-Wc(l);m=1<<v,v=t[v],v>d&&(d=v),l&=~m}if(l=d,l=$s()-l,l=(120>l?120:480>l?480:1080>l?1080:1920>l?1920:3e3>l?3e3:4320>l?4320:1960*Ree(l/1960))-l,10<l){e.timeoutHandle=aR(Yp.bind(null,e,Ha,kd),l);break}Yp(e,Ha,kd);break;case 5:Yp(e,Ha,kd);break;default:throw Error(an(329))}}}return Ya(e,$s()),e.callbackNode===i?k6.bind(null,e):null}function IR(e,t){var i=j0;return e.current.memoizedState.isDehydrated&&(fm(e,t).flags|=256),e=nS(e,t),e!==2&&(t=Ha,Ha=i,t!==null&&AR(t)),e}function AR(e){Ha===null?Ha=e:Ha.push.apply(Ha,e)}function Mee(e){for(var t=e;;){if(t.flags&16384){var i=t.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var l=0;l<i.length;l++){var d=i[l],m=d.getSnapshot;d=d.value;try{if(!eu(m(),d))return!1}catch{return!1}}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Xh(e,t){for(t&=~zk,t&=~aC,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-Wc(t),l=1<<i;e[i]=-1,t&=~l}}function Rj(e){if(Er&6)throw Error(an(327));oy();var t=zE(e,0);if(!(t&1))return Ya(e,$s()),null;var i=nS(e,t);if(e.tag!==0&&i===2){var l=JP(e);l!==0&&(t=l,i=IR(e,l))}if(i===1)throw i=m1,fm(e,0),Xh(e,t),Ya(e,$s()),i;if(i===6)throw Error(an(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Yp(e,Ha,kd),Ya(e,$s()),null}function Bk(e,t){var i=Er;Er|=1;try{return e(t)}finally{Er=i,Er===0&&(Ny=$s()+500,iC&&Hf())}}function bm(e){lf!==null&&lf.tag===0&&!(Er&6)&&oy();var t=Er;Er|=1;var i=Jl.transition,l=Ur;try{if(Jl.transition=null,Ur=1,e)return e()}finally{Ur=l,Jl.transition=i,Er=t,!(Er&6)&&Hf()}}function Vk(){ml=q_.current,ps(q_)}function fm(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(i!==-1&&(e.timeoutHandle=-1,aee(i)),no!==null)for(i=no.return;i!==null;){var l=i;switch(bk(l),l.tag){case 1:l=l.type.childContextTypes,l!=null&&$E();break;case 3:ky(),ps(Ka),ps(ea),Rk();break;case 5:Pk(l);break;case 4:ky();break;case 13:ps(As);break;case 19:ps(As);break;case 10:Sk(l.type._context);break;case 22:case 23:Vk()}i=i.return}if(Co=e,no=e=xf(e.current,null),jo=ml=t,ho=0,m1=null,zk=aC=xm=0,Ha=j0=null,nm!==null){for(t=0;t<nm.length;t++)if(i=nm[t],l=i.interleaved,l!==null){i.interleaved=null;var d=l.next,m=i.pending;if(m!==null){var v=m.next;m.next=d,l.next=v}i.pending=l}nm=null}return e}function D6(e,t){do{var i=no;try{if(Ek(),uE.current=QE,YE){for(var l=Rs.memoizedState;l!==null;){var d=l.queue;d!==null&&(d.pending=null),l=l.next}YE=!1}if(vm=0,Eo=lo=Rs=null,F0=!1,h1=0,Fk.current=null,i===null||i.return===null){ho=1,m1=t,no=null;break}e:{var m=e,v=i.return,o=i,I=t;if(t=jo,o.flags|=32768,I!==null&&typeof I=="object"&&typeof I.then=="function"){var A=I,N=o,F=N.tag;if(!(N.mode&1)&&(F===0||F===11||F===15)){var z=N.alternate;z?(N.updateQueue=z.updateQueue,N.memoizedState=z.memoizedState,N.lanes=z.lanes):(N.updateQueue=null,N.memoizedState=null)}var $=_j(v);if($!==null){$.flags&=-257,yj($,v,o,m,t),$.mode&1&&gj(m,A,t),t=$,I=A;var J=t.updateQueue;if(J===null){var H=new Set;H.add(I),t.updateQueue=H}else J.add(I);break e}else{if(!(t&1)){gj(m,A,t),Uk();break e}I=Error(an(426))}}else if(xs&&o.mode&1){var re=_j(v);if(re!==null){!(re.flags&65536)&&(re.flags|=256),yj(re,v,o,m,t),wk(Dy(I,o));break e}}m=I=Dy(I,o),ho!==4&&(ho=2),j0===null?j0=[m]:j0.push(m),m=v;do{switch(m.tag){case 3:m.flags|=65536,t&=-t,m.lanes|=t;var Q=g6(m,I,t);uj(m,Q);break e;case 1:o=I;var ee=m.type,ie=m.stateNode;if(!(m.flags&128)&&(typeof ee.getDerivedStateFromError=="function"||ie!==null&&typeof ie.componentDidCatch=="function"&&(yf===null||!yf.has(ie)))){m.flags|=65536,t&=-t,m.lanes|=t;var ue=_6(m,o,t);uj(m,ue);break e}}m=m.return}while(m!==null)}O6(i)}catch(xe){t=xe,no===i&&i!==null&&(no=i=i.return);continue}break}while(!0)}function N6(){var e=JE.current;return JE.current=QE,e===null?QE:e}function Uk(){(ho===0||ho===3||ho===2)&&(ho=4),Co===null||!(xm&268435455)&&!(aC&268435455)||Xh(Co,jo)}function nS(e,t){var i=Er;Er|=2;var l=N6();(Co!==e||jo!==t)&&(kd=null,fm(e,t));do try{kee();break}catch(d){D6(e,d)}while(!0);if(Ek(),Er=i,JE.current=l,no!==null)throw Error(an(261));return Co=null,jo=0,ho}function kee(){for(;no!==null;)L6(no)}function Dee(){for(;no!==null&&!rJ();)L6(no)}function L6(e){var t=z6(e.alternate,e,ml);e.memoizedProps=e.pendingProps,t===null?O6(e):no=t,Fk.current=null}function O6(e){var t=e;do{var i=t.alternate;if(e=t.return,t.flags&32768){if(i=Cee(i,t),i!==null){i.flags&=32767,no=i;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{ho=6,no=null;return}}else if(i=See(i,t,ml),i!==null){no=i;return}if(t=t.sibling,t!==null){no=t;return}no=t=e}while(t!==null);ho===0&&(ho=5)}function Yp(e,t,i){var l=Ur,d=Jl.transition;try{Jl.transition=null,Ur=1,Nee(e,t,i,l)}finally{Jl.transition=d,Ur=l}return null}function Nee(e,t,i,l){do oy();while(lf!==null);if(Er&6)throw Error(an(327));i=e.finishedWork;var d=e.finishedLanes;if(i===null)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(an(177));e.callbackNode=null,e.callbackPriority=0;var m=i.lanes|i.childLanes;if(pJ(e,m),e===Co&&(no=Co=null,jo=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||LT||(LT=!0,j6(FE,function(){return oy(),null})),m=(i.flags&15990)!==0,i.subtreeFlags&15990||m){m=Jl.transition,Jl.transition=null;var v=Ur;Ur=1;var o=Er;Er|=4,Fk.current=null,Aee(e,i),R6(i,e),eee(sR),jE=!!rR,sR=rR=null,e.current=i,Pee(i),sJ(),Er=o,Ur=v,Jl.transition=m}else e.current=i;if(LT&&(LT=!1,lf=e,tS=d),m=e.pendingLanes,m===0&&(yf=null),lJ(i.stateNode),Ya(e,$s()),t!==null)for(l=e.onRecoverableError,i=0;i<t.length;i++)d=t[i],l(d.value,{componentStack:d.stack,digest:d.digest});if(eS)throw eS=!1,e=SR,SR=null,e;return tS&1&&e.tag!==0&&oy(),m=e.pendingLanes,m&1?e===CR?B0++:(B0=0,CR=e):B0=0,Hf(),null}function oy(){if(lf!==null){var e=gU(tS),t=Jl.transition,i=Ur;try{if(Jl.transition=null,Ur=16>e?16:e,lf===null)var l=!1;else{if(e=lf,lf=null,tS=0,Er&6)throw Error(an(331));var d=Er;for(Er|=4,Un=e.current;Un!==null;){var m=Un,v=m.child;if(Un.flags&16){var o=m.deletions;if(o!==null){for(var I=0;I<o.length;I++){var A=o[I];for(Un=A;Un!==null;){var N=Un;switch(N.tag){case 0:case 11:case 15:z0(8,N,m)}var F=N.child;if(F!==null)F.return=N,Un=F;else for(;Un!==null;){N=Un;var z=N.sibling,$=N.return;if(I6(N),N===A){Un=null;break}if(z!==null){z.return=$,Un=z;break}Un=$}}}var J=m.alternate;if(J!==null){var H=J.child;if(H!==null){J.child=null;do{var re=H.sibling;H.sibling=null,H=re}while(H!==null)}}Un=m}}if(m.subtreeFlags&2064&&v!==null)v.return=m,Un=v;else e:for(;Un!==null;){if(m=Un,m.flags&2048)switch(m.tag){case 0:case 11:case 15:z0(9,m,m.return)}var Q=m.sibling;if(Q!==null){Q.return=m.return,Un=Q;break e}Un=m.return}}var ee=e.current;for(Un=ee;Un!==null;){v=Un;var ie=v.child;if(v.subtreeFlags&2064&&ie!==null)ie.return=v,Un=ie;else e:for(v=ee;Un!==null;){if(o=Un,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:oC(9,o)}}catch(xe){Ls(o,o.return,xe)}if(o===v){Un=null;break e}var ue=o.sibling;if(ue!==null){ue.return=o.return,Un=ue;break e}Un=o.return}}if(Er=d,Hf(),Vu&&typeof Vu.onPostCommitFiberRoot=="function")try{Vu.onPostCommitFiberRoot(QS,e)}catch{}l=!0}return l}finally{Ur=i,Jl.transition=t}}return!1}function Mj(e,t,i){t=Dy(i,t),t=g6(e,t,1),e=_f(e,t,1),t=_a(),e!==null&&(q1(e,1,t),Ya(e,t))}function Ls(e,t,i){if(e.tag===3)Mj(e,e,i);else for(;t!==null;){if(t.tag===3){Mj(t,e,i);break}else if(t.tag===1){var l=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(yf===null||!yf.has(l))){e=Dy(i,e),e=_6(t,e,1),t=_f(t,e,1),e=_a(),t!==null&&(q1(t,1,e),Ya(t,e));break}}t=t.return}}function Lee(e,t,i){var l=e.pingCache;l!==null&&l.delete(t),t=_a(),e.pingedLanes|=e.suspendedLanes&i,Co===e&&(jo&i)===i&&(ho===4||ho===3&&(jo&130023424)===jo&&500>$s()-jk?fm(e,0):zk|=i),Ya(e,t)}function F6(e,t){t===0&&(e.mode&1?(t=ST,ST<<=1,!(ST&130023424)&&(ST=4194304)):t=1);var i=_a();e=Wd(e,t),e!==null&&(q1(e,t,i),Ya(e,i))}function Oee(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),F6(e,i)}function Fee(e,t){var i=0;switch(e.tag){case 13:var l=e.stateNode,d=e.memoizedState;d!==null&&(i=d.retryLane);break;case 19:l=e.stateNode;break;default:throw Error(an(314))}l!==null&&l.delete(t),F6(e,i)}var z6;z6=function(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps||Ka.current)Wa=!0;else{if(!(e.lanes&i)&&!(t.flags&128))return Wa=!1,Eee(e,t,i);Wa=!!(e.flags&131072)}else Wa=!1,xs&&t.flags&1048576&&UU(t,WE,t.index);switch(t.lanes=0,t.tag){case 2:var l=t.type;hE(e,t),e=t.pendingProps;var d=Py(t,ea.current);sy(t,i),d=kk(null,t,l,e,d,i);var m=Dk();return t.flags|=1,typeof d=="object"&&d!==null&&typeof d.render=="function"&&d.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Xa(l)?(m=!0,GE(t)):m=!1,t.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,Ik(t),d.updater=sC,t.stateNode=d,d._reactInternals=t,pR(t,l,e,i),t=_R(null,t,l,!0,m,i)):(t.tag=0,xs&&m&&xk(t),fa(null,t,d,i),t=t.child),t;case 16:l=t.elementType;e:{switch(hE(e,t),e=t.pendingProps,d=l._init,l=d(l._payload),t.type=l,d=t.tag=jee(l),e=Oc(l,e),d){case 0:t=gR(null,t,l,e,i);break e;case 1:t=bj(null,t,l,e,i);break e;case 11:t=vj(null,t,l,e,i);break e;case 14:t=xj(null,t,l,Oc(l.type,e),i);break e}throw Error(an(306,l,""))}return t;case 0:return l=t.type,d=t.pendingProps,d=t.elementType===l?d:Oc(l,d),gR(e,t,l,d,i);case 1:return l=t.type,d=t.pendingProps,d=t.elementType===l?d:Oc(l,d),bj(e,t,l,d,i);case 3:e:{if(b6(t),e===null)throw Error(an(387));l=t.pendingProps,m=t.memoizedState,d=m.element,ZU(e,t),KE(t,l,null,i);var v=t.memoizedState;if(l=v.element,m.isDehydrated)if(m={element:l,isDehydrated:!1,cache:v.cache,pendingSuspenseBoundaries:v.pendingSuspenseBoundaries,transitions:v.transitions},t.updateQueue.baseState=m,t.memoizedState=m,t.flags&256){d=Dy(Error(an(423)),t),t=wj(e,t,l,i,d);break e}else if(l!==d){d=Dy(Error(an(424)),t),t=wj(e,t,l,i,d);break e}else for(yl=gf(t.stateNode.containerInfo.firstChild),vl=t,xs=!0,Vc=null,i=WU(t,null,l,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(Ry(),l===d){t=qd(e,t,i);break e}fa(e,t,l,i)}t=t.child}return t;case 5:return KU(t),e===null&&dR(t),l=t.type,d=t.pendingProps,m=e!==null?e.memoizedProps:null,v=d.children,oR(l,d)?v=null:m!==null&&oR(l,m)&&(t.flags|=32),x6(e,t),fa(e,t,v,i),t.child;case 6:return e===null&&dR(t),null;case 13:return w6(e,t,i);case 4:return Ak(t,t.stateNode.containerInfo),l=t.pendingProps,e===null?t.child=My(t,null,l,i):fa(e,t,l,i),t.child;case 11:return l=t.type,d=t.pendingProps,d=t.elementType===l?d:Oc(l,d),vj(e,t,l,d,i);case 7:return fa(e,t,t.pendingProps,i),t.child;case 8:return fa(e,t,t.pendingProps.children,i),t.child;case 12:return fa(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(l=t.type._context,d=t.pendingProps,m=t.memoizedProps,v=d.value,os(qE,l._currentValue),l._currentValue=v,m!==null)if(eu(m.value,v)){if(m.children===d.children&&!Ka.current){t=qd(e,t,i);break e}}else for(m=t.child,m!==null&&(m.return=t);m!==null;){var o=m.dependencies;if(o!==null){v=m.child;for(var I=o.firstContext;I!==null;){if(I.context===l){if(m.tag===1){I=Vd(-1,i&-i),I.tag=2;var A=m.updateQueue;if(A!==null){A=A.shared;var N=A.pending;N===null?I.next=I:(I.next=N.next,N.next=I),A.pending=I}}m.lanes|=i,I=m.alternate,I!==null&&(I.lanes|=i),hR(m.return,i,t),o.lanes|=i;break}I=I.next}}else if(m.tag===10)v=m.type===t.type?null:m.child;else if(m.tag===18){if(v=m.return,v===null)throw Error(an(341));v.lanes|=i,o=v.alternate,o!==null&&(o.lanes|=i),hR(v,i,t),v=m.sibling}else v=m.child;if(v!==null)v.return=m;else for(v=m;v!==null;){if(v===t){v=null;break}if(m=v.sibling,m!==null){m.return=v.return,v=m;break}v=v.return}m=v}fa(e,t,d.children,i),t=t.child}return t;case 9:return d=t.type,l=t.pendingProps.children,sy(t,i),d=nc(d),l=l(d),t.flags|=1,fa(e,t,l,i),t.child;case 14:return l=t.type,d=Oc(l,t.pendingProps),d=Oc(l.type,d),xj(e,t,l,d,i);case 15:return y6(e,t,t.type,t.pendingProps,i);case 17:return l=t.type,d=t.pendingProps,d=t.elementType===l?d:Oc(l,d),hE(e,t),t.tag=1,Xa(l)?(e=!0,GE(t)):e=!1,sy(t,i),m6(t,l,d),pR(t,l,d,i),_R(null,t,l,!0,e,i);case 19:return T6(e,t,i);case 22:return v6(e,t,i)}throw Error(an(156,t.tag))};function j6(e,t){return hU(e,t)}function zee(e,t,i,l){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Xl(e,t,i,l){return new zee(e,t,i,l)}function $k(e){return e=e.prototype,!(!e||!e.isReactComponent)}function jee(e){if(typeof e=="function")return $k(e)?1:0;if(e!=null){if(e=e.$$typeof,e===lk)return 11;if(e===ck)return 14}return 2}function xf(e,t){var i=e.alternate;return i===null?(i=Xl(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&14680064,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function mE(e,t,i,l,d,m){var v=2;if(l=e,typeof e=="function")$k(e)&&(v=1);else if(typeof e=="string")v=5;else e:switch(e){case F_:return pm(i.children,d,m,t);case ak:v=8,d|=8;break;case zP:return e=Xl(12,i,t,d|2),e.elementType=zP,e.lanes=m,e;case jP:return e=Xl(13,i,t,d),e.elementType=jP,e.lanes=m,e;case BP:return e=Xl(19,i,t,d),e.elementType=BP,e.lanes=m,e;case KV:return lC(i,d,m,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case qV:v=10;break e;case ZV:v=9;break e;case lk:v=11;break e;case ck:v=14;break e;case qh:v=16,l=null;break e}throw Error(an(130,e==null?e:typeof e,""))}return t=Xl(v,i,t,d),t.elementType=e,t.type=l,t.lanes=m,t}function pm(e,t,i,l){return e=Xl(7,e,l,t),e.lanes=i,e}function lC(e,t,i,l){return e=Xl(22,e,l,t),e.elementType=KV,e.lanes=i,e.stateNode={isHidden:!1},e}function F2(e,t,i){return e=Xl(6,e,null,t),e.lanes=i,e}function z2(e,t,i){return t=Xl(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bee(e,t,i,l,d){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=y2(0),this.expirationTimes=y2(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=y2(0),this.identifierPrefix=l,this.onRecoverableError=d,this.mutableSourceEagerHydrationData=null}function Gk(e,t,i,l,d,m,v,o,I){return e=new Bee(e,t,i,o,I),t===1?(t=1,m===!0&&(t|=8)):t=0,m=Xl(3,null,null,t),e.current=m,m.stateNode=e,m.memoizedState={element:l,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ik(m),e}function Vee(e,t,i){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:O_,key:l==null?null:""+l,children:e,containerInfo:t,implementation:i}}function B6(e){if(!e)return Pf;e=e._reactInternals;e:{if(Lm(e)!==e||e.tag!==1)throw Error(an(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Xa(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(an(171))}if(e.tag===1){var i=e.type;if(Xa(i))return BU(e,i,t)}return t}function V6(e,t,i,l,d,m,v,o,I){return e=Gk(i,l,!0,e,d,m,v,o,I),e.context=B6(null),i=e.current,l=_a(),d=vf(i),m=Vd(l,d),m.callback=t??null,_f(i,m,d),e.current.lanes=d,q1(e,d,l),Ya(e,l),e}function cC(e,t,i,l){var d=t.current,m=_a(),v=vf(d);return i=B6(i),t.context===null?t.context=i:t.pendingContext=i,t=Vd(m,v),t.payload={element:e},l=l===void 0?null:l,l!==null&&(t.callback=l),e=_f(d,t,v),e!==null&&(qc(e,d,v,m),cE(e,d,v)),v}function iS(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function kj(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function Hk(e,t){kj(e,t),(e=e.alternate)&&kj(e,t)}function Uee(){return null}var U6=typeof reportError=="function"?reportError:function(e){console.error(e)};function Wk(e){this._internalRoot=e}uC.prototype.render=Wk.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(an(409));cC(e,t,null,null)};uC.prototype.unmount=Wk.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;bm(function(){cC(null,e,null,null)}),t[Hd]=null}};function uC(e){this._internalRoot=e}uC.prototype.unstable_scheduleHydration=function(e){if(e){var t=vU();e={blockedOn:null,target:e,priority:t};for(var i=0;i<Kh.length&&t!==0&&t<Kh[i].priority;i++);Kh.splice(i,0,e),i===0&&bU(e)}};function qk(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function dC(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Dj(){}function $ee(e,t,i,l,d){if(d){if(typeof l=="function"){var m=l;l=function(){var A=iS(v);m.call(A)}}var v=V6(t,l,e,0,null,!1,!1,"",Dj);return e._reactRootContainer=v,e[Hd]=v.current,a1(e.nodeType===8?e.parentNode:e),bm(),v}for(;d=e.lastChild;)e.removeChild(d);if(typeof l=="function"){var o=l;l=function(){var A=iS(I);o.call(A)}}var I=Gk(e,0,!1,null,null,!1,!1,"",Dj);return e._reactRootContainer=I,e[Hd]=I.current,a1(e.nodeType===8?e.parentNode:e),bm(function(){cC(t,I,i,l)}),I}function hC(e,t,i,l,d){var m=i._reactRootContainer;if(m){var v=m;if(typeof d=="function"){var o=d;d=function(){var I=iS(v);o.call(I)}}cC(t,v,e,d)}else v=$ee(i,t,e,d,l);return iS(v)}_U=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=C0(t.pendingLanes);i!==0&&(hk(t,i|1),Ya(t,$s()),!(Er&6)&&(Ny=$s()+500,Hf()))}break;case 13:bm(function(){var l=Wd(e,1);if(l!==null){var d=_a();qc(l,e,1,d)}}),Hk(e,1)}};fk=function(e){if(e.tag===13){var t=Wd(e,134217728);if(t!==null){var i=_a();qc(t,e,134217728,i)}Hk(e,134217728)}};yU=function(e){if(e.tag===13){var t=vf(e),i=Wd(e,t);if(i!==null){var l=_a();qc(i,e,t,l)}Hk(e,t)}};vU=function(){return Ur};xU=function(e,t){var i=Ur;try{return Ur=e,t()}finally{Ur=i}};XP=function(e,t,i){switch(t){case"input":if($P(e,i),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var l=i[t];if(l!==e&&l.form===e.form){var d=nC(l);if(!d)throw Error(an(90));YV(l),$P(l,d)}}}break;case"textarea":JV(e,i);break;case"select":t=i.value,t!=null&&ty(e,!!i.multiple,t,!1)}};oU=Bk;aU=bm;var Gee={usingClientEntryPoint:!1,Events:[K1,V_,nC,rU,sU,Bk]},m0={findFiberByHostInstance:tm,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Hee={bundleType:m0.bundleType,version:m0.version,rendererPackageName:m0.rendererPackageName,rendererConfig:m0.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:th.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=uU(e),e===null?null:e.stateNode},findFiberByHostInstance:m0.findFiberByHostInstance||Uee,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var OT=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!OT.isDisabled&&OT.supportsFiber)try{QS=OT.inject(Hee),Vu=OT}catch{}}wl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Gee;wl.createPortal=function(e,t){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!qk(t))throw Error(an(200));return Vee(e,t,null,i)};wl.createRoot=function(e,t){if(!qk(e))throw Error(an(299));var i=!1,l="",d=U6;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(l=t.identifierPrefix),t.onRecoverableError!==void 0&&(d=t.onRecoverableError)),t=Gk(e,1,!1,null,null,i,!1,l,d),e[Hd]=t.current,a1(e.nodeType===8?e.parentNode:e),new Wk(t)};wl.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(an(188)):(e=Object.keys(e).join(","),Error(an(268,e)));return e=uU(t),e=e===null?null:e.stateNode,e};wl.flushSync=function(e){return bm(e)};wl.hydrate=function(e,t,i){if(!dC(t))throw Error(an(200));return hC(null,e,t,!0,i)};wl.hydrateRoot=function(e,t,i){if(!qk(e))throw Error(an(405));var l=i!=null&&i.hydratedSources||null,d=!1,m="",v=U6;if(i!=null&&(i.unstable_strictMode===!0&&(d=!0),i.identifierPrefix!==void 0&&(m=i.identifierPrefix),i.onRecoverableError!==void 0&&(v=i.onRecoverableError)),t=V6(t,null,e,1,i??null,d,!1,m,v),e[Hd]=t.current,a1(e),l)for(e=0;e<l.length;e++)i=l[e],d=i._getVersion,d=d(i._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[i,d]:t.mutableSourceEagerHydrationData.push(i,d);return new uC(t)};wl.render=function(e,t,i){if(!dC(t))throw Error(an(200));return hC(null,e,t,!1,i)};wl.unmountComponentAtNode=function(e){if(!dC(e))throw Error(an(40));return e._reactRootContainer?(bm(function(){hC(null,null,e,!1,function(){e._reactRootContainer=null,e[Hd]=null})}),!0):!1};wl.unstable_batchedUpdates=Bk;wl.unstable_renderSubtreeIntoContainer=function(e,t,i,l){if(!dC(i))throw Error(an(200));if(e==null||e._reactInternals===void 0)throw Error(an(38));return hC(e,t,i,!1,l)};wl.version="18.3.1-next-f1338f8080-20240426";function $6(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE($6)}catch(e){console.error(e)}}$6(),$V.exports=wl;var Om=$V.exports;const G6=H1(Om);var H6,Nj=Om;H6=Nj.createRoot,Nj.hydrateRoot;const Wee=1,qee=1e6;let j2=0;function Zee(){return j2=(j2+1)%Number.MAX_SAFE_INTEGER,j2.toString()}const B2=new Map,Lj=e=>{if(B2.has(e))return;const t=setTimeout(()=>{B2.delete(e),V0({type:"REMOVE_TOAST",toastId:e})},qee);B2.set(e,t)},Kee=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,Wee)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(i=>i.id===t.toast.id?{...i,...t.toast}:i)};case"DISMISS_TOAST":{const{toastId:i}=t;return i?Lj(i):e.toasts.forEach(l=>{Lj(l.id)}),{...e,toasts:e.toasts.map(l=>l.id===i||i===void 0?{...l,open:!1}:l)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(i=>i.id!==t.toastId)}}},gE=[];let _E={toasts:[]};function V0(e){_E=Kee(_E,e),gE.forEach(t=>{t(_E)})}function Xee({...e}){const t=Zee(),i=d=>V0({type:"UPDATE_TOAST",toast:{...d,id:t}}),l=()=>V0({type:"DISMISS_TOAST",toastId:t});return V0({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:d=>{d||l()}}}),{id:t,dismiss:l,update:i}}function Yee(){const[e,t]=q.useState(_E);return q.useEffect(()=>(gE.push(t),()=>{const i=gE.indexOf(t);i>-1&&gE.splice(i,1)}),[e]),{...e,toast:Xee,dismiss:i=>V0({type:"DISMISS_TOAST",toastId:i})}}function Li(e,t,{checkForDefaultPrevented:i=!0}={}){return function(d){if(e==null||e(d),i===!1||!d.defaultPrevented)return t==null?void 0:t(d)}}function Oj(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function W6(...e){return t=>{let i=!1;const l=e.map(d=>{const m=Oj(d,t);return!i&&typeof m=="function"&&(i=!0),m});if(i)return()=>{for(let d=0;d<l.length;d++){const m=l[d];typeof m=="function"?m():Oj(e[d],null)}}}}function zr(...e){return q.useCallback(W6(...e),e)}function Qee(e,t){const i=q.createContext(t),l=m=>{const{children:v,...o}=m,I=q.useMemo(()=>o,Object.values(o));return E.jsx(i.Provider,{value:I,children:v})};l.displayName=e+"Provider";function d(m){const v=q.useContext(i);if(v)return v;if(t!==void 0)return t;throw new Error(`\`${m}\` must be used within \`${e}\``)}return[l,d]}function Qu(e,t=[]){let i=[];function l(m,v){const o=q.createContext(v),I=i.length;i=[...i,v];const A=F=>{var Q;const{scope:z,children:$,...J}=F,H=((Q=z==null?void 0:z[e])==null?void 0:Q[I])||o,re=q.useMemo(()=>J,Object.values(J));return E.jsx(H.Provider,{value:re,children:$})};A.displayName=m+"Provider";function N(F,z){var H;const $=((H=z==null?void 0:z[e])==null?void 0:H[I])||o,J=q.useContext($);if(J)return J;if(v!==void 0)return v;throw new Error(`\`${F}\` must be used within \`${m}\``)}return[A,N]}const d=()=>{const m=i.map(v=>q.createContext(v));return function(o){const I=(o==null?void 0:o[e])||m;return q.useMemo(()=>({[`__scope${e}`]:{...o,[e]:I}}),[o,I])}};return d.scopeName=e,[l,Jee(d,...t)]}function Jee(...e){const t=e[0];if(e.length===1)return t;const i=()=>{const l=e.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(m){const v=l.reduce((o,{useScope:I,scopeName:A})=>{const F=I(m)[`__scope${A}`];return{...o,...F}},{});return q.useMemo(()=>({[`__scope${t.scopeName}`]:v}),[v])}};return i.scopeName=t.scopeName,i}function Ly(e){const t=tte(e),i=q.forwardRef((l,d)=>{const{children:m,...v}=l,o=q.Children.toArray(m),I=o.find(nte);if(I){const A=I.props.children,N=o.map(F=>F===I?q.Children.count(A)>1?q.Children.only(null):q.isValidElement(A)?A.props.children:null:F);return E.jsx(t,{...v,ref:d,children:q.isValidElement(A)?q.cloneElement(A,void 0,N):null})}return E.jsx(t,{...v,ref:d,children:m})});return i.displayName=`${e}.Slot`,i}var ete=Ly("Slot");function tte(e){const t=q.forwardRef((i,l)=>{const{children:d,...m}=i;if(q.isValidElement(d)){const v=rte(d),o=ite(m,d.props);return d.type!==q.Fragment&&(o.ref=l?W6(l,v):v),q.cloneElement(d,o)}return q.Children.count(d)>1?q.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var q6=Symbol("radix.slottable");function Z6(e){const t=({children:i})=>E.jsx(E.Fragment,{children:i});return t.displayName=`${e}.Slottable`,t.__radixId=q6,t}function nte(e){return q.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===q6}function ite(e,t){const i={...t};for(const l in t){const d=e[l],m=t[l];/^on[A-Z]/.test(l)?d&&m?i[l]=(...o)=>{const I=m(...o);return d(...o),I}:d&&(i[l]=d):l==="style"?i[l]={...d,...m}:l==="className"&&(i[l]=[d,m].filter(Boolean).join(" "))}return{...e,...i}}function rte(e){var l,d;let t=(l=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:l.get,i=t&&"isReactWarning"in t&&t.isReactWarning;return i?e.ref:(t=(d=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:d.get,i=t&&"isReactWarning"in t&&t.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}function Zk(e){const t=e+"CollectionProvider",[i,l]=Qu(t),[d,m]=i(t,{collectionRef:{current:null},itemMap:new Map}),v=H=>{const{scope:re,children:Q}=H,ee=rn.useRef(null),ie=rn.useRef(new Map).current;return E.jsx(d,{scope:re,itemMap:ie,collectionRef:ee,children:Q})};v.displayName=t;const o=e+"CollectionSlot",I=Ly(o),A=rn.forwardRef((H,re)=>{const{scope:Q,children:ee}=H,ie=m(o,Q),ue=zr(re,ie.collectionRef);return E.jsx(I,{ref:ue,children:ee})});A.displayName=o;const N=e+"CollectionItemSlot",F="data-radix-collection-item",z=Ly(N),$=rn.forwardRef((H,re)=>{const{scope:Q,children:ee,...ie}=H,ue=rn.useRef(null),xe=zr(re,ue),Oe=m(N,Q);return rn.useEffect(()=>(Oe.itemMap.set(ue,{ref:ue,...ie}),()=>void Oe.itemMap.delete(ue))),E.jsx(z,{[F]:"",ref:xe,children:ee})});$.displayName=N;function J(H){const re=m(e+"CollectionConsumer",H);return rn.useCallback(()=>{const ee=re.collectionRef.current;if(!ee)return[];const ie=Array.from(ee.querySelectorAll(`[${F}]`));return Array.from(re.itemMap.values()).sort((Oe,ze)=>ie.indexOf(Oe.ref.current)-ie.indexOf(ze.ref.current))},[re.collectionRef,re.itemMap])}return[{Provider:v,Slot:A,ItemSlot:$},J,l]}var ste=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ki=ste.reduce((e,t)=>{const i=Ly(`Primitive.${t}`),l=q.forwardRef((d,m)=>{const{asChild:v,...o}=d,I=v?i:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(I,{...o,ref:m})});return l.displayName=`Primitive.${t}`,{...e,[t]:l}},{});function K6(e,t){e&&Om.flushSync(()=>e.dispatchEvent(t))}function tu(e){const t=q.useRef(e);return q.useEffect(()=>{t.current=e}),q.useMemo(()=>(...i)=>{var l;return(l=t.current)==null?void 0:l.call(t,...i)},[])}function ote(e,t=globalThis==null?void 0:globalThis.document){const i=tu(e);q.useEffect(()=>{const l=d=>{d.key==="Escape"&&i(d)};return t.addEventListener("keydown",l,{capture:!0}),()=>t.removeEventListener("keydown",l,{capture:!0})},[i,t])}var ate="DismissableLayer",PR="dismissableLayer.update",lte="dismissableLayer.pointerDownOutside",cte="dismissableLayer.focusOutside",Fj,X6=q.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Y1=q.forwardRef((e,t)=>{const{disableOutsidePointerEvents:i=!1,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:m,onInteractOutside:v,onDismiss:o,...I}=e,A=q.useContext(X6),[N,F]=q.useState(null),z=(N==null?void 0:N.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,$]=q.useState({}),J=zr(t,ze=>F(ze)),H=Array.from(A.layers),[re]=[...A.layersWithOutsidePointerEventsDisabled].slice(-1),Q=H.indexOf(re),ee=N?H.indexOf(N):-1,ie=A.layersWithOutsidePointerEventsDisabled.size>0,ue=ee>=Q,xe=dte(ze=>{const Be=ze.target,ot=[...A.branches].some(Et=>Et.contains(Be));!ue||ot||(d==null||d(ze),v==null||v(ze),ze.defaultPrevented||o==null||o())},z),Oe=hte(ze=>{const Be=ze.target;[...A.branches].some(Et=>Et.contains(Be))||(m==null||m(ze),v==null||v(ze),ze.defaultPrevented||o==null||o())},z);return ote(ze=>{ee===A.layers.size-1&&(l==null||l(ze),!ze.defaultPrevented&&o&&(ze.preventDefault(),o()))},z),q.useEffect(()=>{if(N)return i&&(A.layersWithOutsidePointerEventsDisabled.size===0&&(Fj=z.body.style.pointerEvents,z.body.style.pointerEvents="none"),A.layersWithOutsidePointerEventsDisabled.add(N)),A.layers.add(N),zj(),()=>{i&&A.layersWithOutsidePointerEventsDisabled.size===1&&(z.body.style.pointerEvents=Fj)}},[N,z,i,A]),q.useEffect(()=>()=>{N&&(A.layers.delete(N),A.layersWithOutsidePointerEventsDisabled.delete(N),zj())},[N,A]),q.useEffect(()=>{const ze=()=>$({});return document.addEventListener(PR,ze),()=>document.removeEventListener(PR,ze)},[]),E.jsx(Ki.div,{...I,ref:J,style:{pointerEvents:ie?ue?"auto":"none":void 0,...e.style},onFocusCapture:Li(e.onFocusCapture,Oe.onFocusCapture),onBlurCapture:Li(e.onBlurCapture,Oe.onBlurCapture),onPointerDownCapture:Li(e.onPointerDownCapture,xe.onPointerDownCapture)})});Y1.displayName=ate;var ute="DismissableLayerBranch",Y6=q.forwardRef((e,t)=>{const i=q.useContext(X6),l=q.useRef(null),d=zr(t,l);return q.useEffect(()=>{const m=l.current;if(m)return i.branches.add(m),()=>{i.branches.delete(m)}},[i.branches]),E.jsx(Ki.div,{...e,ref:d})});Y6.displayName=ute;function dte(e,t=globalThis==null?void 0:globalThis.document){const i=tu(e),l=q.useRef(!1),d=q.useRef(()=>{});return q.useEffect(()=>{const m=o=>{if(o.target&&!l.current){let I=function(){Q6(lte,i,A,{discrete:!0})};const A={originalEvent:o};o.pointerType==="touch"?(t.removeEventListener("click",d.current),d.current=I,t.addEventListener("click",d.current,{once:!0})):I()}else t.removeEventListener("click",d.current);l.current=!1},v=window.setTimeout(()=>{t.addEventListener("pointerdown",m)},0);return()=>{window.clearTimeout(v),t.removeEventListener("pointerdown",m),t.removeEventListener("click",d.current)}},[t,i]),{onPointerDownCapture:()=>l.current=!0}}function hte(e,t=globalThis==null?void 0:globalThis.document){const i=tu(e),l=q.useRef(!1);return q.useEffect(()=>{const d=m=>{m.target&&!l.current&&Q6(cte,i,{originalEvent:m},{discrete:!1})};return t.addEventListener("focusin",d),()=>t.removeEventListener("focusin",d)},[t,i]),{onFocusCapture:()=>l.current=!0,onBlurCapture:()=>l.current=!1}}function zj(){const e=new CustomEvent(PR);document.dispatchEvent(e)}function Q6(e,t,i,{discrete:l}){const d=i.originalEvent.target,m=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:i});t&&d.addEventListener(e,t,{once:!0}),l?K6(d,m):d.dispatchEvent(m)}var fte=Y1,pte=Y6,Ao=globalThis!=null&&globalThis.document?q.useLayoutEffect:()=>{},mte="Portal",fC=q.forwardRef((e,t)=>{var o;const{container:i,...l}=e,[d,m]=q.useState(!1);Ao(()=>m(!0),[]);const v=i||d&&((o=globalThis==null?void 0:globalThis.document)==null?void 0:o.body);return v?G6.createPortal(E.jsx(Ki.div,{...l,ref:t}),v):null});fC.displayName=mte;function gte(e,t){return q.useReducer((i,l)=>t[i][l]??i,e)}var Fm=e=>{const{present:t,children:i}=e,l=_te(t),d=typeof i=="function"?i({present:l.isPresent}):q.Children.only(i),m=zr(l.ref,yte(d));return typeof i=="function"||l.isPresent?q.cloneElement(d,{ref:m}):null};Fm.displayName="Presence";function _te(e){const[t,i]=q.useState(),l=q.useRef(null),d=q.useRef(e),m=q.useRef("none"),v=e?"mounted":"unmounted",[o,I]=gte(v,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return q.useEffect(()=>{const A=FT(l.current);m.current=o==="mounted"?A:"none"},[o]),Ao(()=>{const A=l.current,N=d.current;if(N!==e){const z=m.current,$=FT(A);e?I("MOUNT"):$==="none"||(A==null?void 0:A.display)==="none"?I("UNMOUNT"):I(N&&z!==$?"ANIMATION_OUT":"UNMOUNT"),d.current=e}},[e,I]),Ao(()=>{if(t){let A;const N=t.ownerDocument.defaultView??window,F=$=>{const H=FT(l.current).includes($.animationName);if($.target===t&&H&&(I("ANIMATION_END"),!d.current)){const re=t.style.animationFillMode;t.style.animationFillMode="forwards",A=N.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=re)})}},z=$=>{$.target===t&&(m.current=FT(l.current))};return t.addEventListener("animationstart",z),t.addEventListener("animationcancel",F),t.addEventListener("animationend",F),()=>{N.clearTimeout(A),t.removeEventListener("animationstart",z),t.removeEventListener("animationcancel",F),t.removeEventListener("animationend",F)}}else I("ANIMATION_END")},[t,I]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:q.useCallback(A=>{l.current=A?getComputedStyle(A):null,i(A)},[])}}function FT(e){return(e==null?void 0:e.animationName)||"none"}function yte(e){var l,d;let t=(l=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:l.get,i=t&&"isReactWarning"in t&&t.isReactWarning;return i?e.ref:(t=(d=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:d.get,i=t&&"isReactWarning"in t&&t.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}var vte=ik[" useInsertionEffect ".trim().toString()]||Ao;function Rf({prop:e,defaultProp:t,onChange:i=()=>{},caller:l}){const[d,m,v]=xte({defaultProp:t,onChange:i}),o=e!==void 0,I=o?e:d;{const N=q.useRef(e!==void 0);q.useEffect(()=>{const F=N.current;F!==o&&console.warn(`${l} is changing from ${F?"controlled":"uncontrolled"} to ${o?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),N.current=o},[o,l])}const A=q.useCallback(N=>{var F;if(o){const z=bte(N)?N(e):N;z!==e&&((F=v.current)==null||F.call(v,z))}else m(N)},[o,e,m,v]);return[I,A]}function xte({defaultProp:e,onChange:t}){const[i,l]=q.useState(e),d=q.useRef(i),m=q.useRef(t);return vte(()=>{m.current=t},[t]),q.useEffect(()=>{var v;d.current!==i&&((v=m.current)==null||v.call(m,i),d.current=i)},[i,d]),[i,l,m]}function bte(e){return typeof e=="function"}var J6=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),wte="VisuallyHidden",pC=q.forwardRef((e,t)=>E.jsx(Ki.span,{...e,ref:t,style:{...J6,...e.style}}));pC.displayName=wte;var Tte=pC,Kk="ToastProvider",[Xk,Ete,Ste]=Zk("Toast"),[e8,Pbe]=Qu("Toast",[Ste]),[Cte,mC]=e8(Kk),t8=e=>{const{__scopeToast:t,label:i="Notification",duration:l=5e3,swipeDirection:d="right",swipeThreshold:m=50,children:v}=e,[o,I]=q.useState(null),[A,N]=q.useState(0),F=q.useRef(!1),z=q.useRef(!1);return i.trim()||console.error(`Invalid prop \`label\` supplied to \`${Kk}\`. Expected non-empty \`string\`.`),E.jsx(Xk.Provider,{scope:t,children:E.jsx(Cte,{scope:t,label:i,duration:l,swipeDirection:d,swipeThreshold:m,toastCount:A,viewport:o,onViewportChange:I,onToastAdd:q.useCallback(()=>N($=>$+1),[]),onToastRemove:q.useCallback(()=>N($=>$-1),[]),isFocusedToastEscapeKeyDownRef:F,isClosePausedRef:z,children:v})})};t8.displayName=Kk;var n8="ToastViewport",Ite=["F8"],RR="toast.viewportPause",MR="toast.viewportResume",i8=q.forwardRef((e,t)=>{const{__scopeToast:i,hotkey:l=Ite,label:d="Notifications ({hotkey})",...m}=e,v=mC(n8,i),o=Ete(i),I=q.useRef(null),A=q.useRef(null),N=q.useRef(null),F=q.useRef(null),z=zr(t,F,v.onViewportChange),$=l.join("+").replace(/Key/g,"").replace(/Digit/g,""),J=v.toastCount>0;q.useEffect(()=>{const re=Q=>{var ie;l.length!==0&&l.every(ue=>Q[ue]||Q.code===ue)&&((ie=F.current)==null||ie.focus())};return document.addEventListener("keydown",re),()=>document.removeEventListener("keydown",re)},[l]),q.useEffect(()=>{const re=I.current,Q=F.current;if(J&&re&&Q){const ee=()=>{if(!v.isClosePausedRef.current){const Oe=new CustomEvent(RR);Q.dispatchEvent(Oe),v.isClosePausedRef.current=!0}},ie=()=>{if(v.isClosePausedRef.current){const Oe=new CustomEvent(MR);Q.dispatchEvent(Oe),v.isClosePausedRef.current=!1}},ue=Oe=>{!re.contains(Oe.relatedTarget)&&ie()},xe=()=>{re.contains(document.activeElement)||ie()};return re.addEventListener("focusin",ee),re.addEventListener("focusout",ue),re.addEventListener("pointermove",ee),re.addEventListener("pointerleave",xe),window.addEventListener("blur",ee),window.addEventListener("focus",ie),()=>{re.removeEventListener("focusin",ee),re.removeEventListener("focusout",ue),re.removeEventListener("pointermove",ee),re.removeEventListener("pointerleave",xe),window.removeEventListener("blur",ee),window.removeEventListener("focus",ie)}}},[J,v.isClosePausedRef]);const H=q.useCallback(({tabbingDirection:re})=>{const ee=o().map(ie=>{const ue=ie.ref.current,xe=[ue,...Bte(ue)];return re==="forwards"?xe:xe.reverse()});return(re==="forwards"?ee.reverse():ee).flat()},[o]);return q.useEffect(()=>{const re=F.current;if(re){const Q=ee=>{var xe,Oe,ze;const ie=ee.altKey||ee.ctrlKey||ee.metaKey;if(ee.key==="Tab"&&!ie){const Be=document.activeElement,ot=ee.shiftKey;if(ee.target===re&&ot){(xe=A.current)==null||xe.focus();return}const at=H({tabbingDirection:ot?"backwards":"forwards"}),zt=at.findIndex(Kt=>Kt===Be);V2(at.slice(zt+1))?ee.preventDefault():ot?(Oe=A.current)==null||Oe.focus():(ze=N.current)==null||ze.focus()}};return re.addEventListener("keydown",Q),()=>re.removeEventListener("keydown",Q)}},[o,H]),E.jsxs(pte,{ref:I,role:"region","aria-label":d.replace("{hotkey}",$),tabIndex:-1,style:{pointerEvents:J?void 0:"none"},children:[J&&E.jsx(kR,{ref:A,onFocusFromOutsideViewport:()=>{const re=H({tabbingDirection:"forwards"});V2(re)}}),E.jsx(Xk.Slot,{scope:i,children:E.jsx(Ki.ol,{tabIndex:-1,...m,ref:z})}),J&&E.jsx(kR,{ref:N,onFocusFromOutsideViewport:()=>{const re=H({tabbingDirection:"backwards"});V2(re)}})]})});i8.displayName=n8;var r8="ToastFocusProxy",kR=q.forwardRef((e,t)=>{const{__scopeToast:i,onFocusFromOutsideViewport:l,...d}=e,m=mC(r8,i);return E.jsx(pC,{"aria-hidden":!0,tabIndex:0,...d,ref:t,style:{position:"fixed"},onFocus:v=>{var A;const o=v.relatedTarget;!((A=m.viewport)!=null&&A.contains(o))&&l()}})});kR.displayName=r8;var Q1="Toast",Ate="toast.swipeStart",Pte="toast.swipeMove",Rte="toast.swipeCancel",Mte="toast.swipeEnd",s8=q.forwardRef((e,t)=>{const{forceMount:i,open:l,defaultOpen:d,onOpenChange:m,...v}=e,[o,I]=Rf({prop:l,defaultProp:d??!0,onChange:m,caller:Q1});return E.jsx(Fm,{present:i||o,children:E.jsx(Nte,{open:o,...v,ref:t,onClose:()=>I(!1),onPause:tu(e.onPause),onResume:tu(e.onResume),onSwipeStart:Li(e.onSwipeStart,A=>{A.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Li(e.onSwipeMove,A=>{const{x:N,y:F}=A.detail.delta;A.currentTarget.setAttribute("data-swipe","move"),A.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${N}px`),A.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${F}px`)}),onSwipeCancel:Li(e.onSwipeCancel,A=>{A.currentTarget.setAttribute("data-swipe","cancel"),A.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),A.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),A.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),A.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Li(e.onSwipeEnd,A=>{const{x:N,y:F}=A.detail.delta;A.currentTarget.setAttribute("data-swipe","end"),A.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),A.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),A.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${N}px`),A.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${F}px`),I(!1)})})})});s8.displayName=Q1;var[kte,Dte]=e8(Q1,{onClose(){}}),Nte=q.forwardRef((e,t)=>{const{__scopeToast:i,type:l="foreground",duration:d,open:m,onClose:v,onEscapeKeyDown:o,onPause:I,onResume:A,onSwipeStart:N,onSwipeMove:F,onSwipeCancel:z,onSwipeEnd:$,...J}=e,H=mC(Q1,i),[re,Q]=q.useState(null),ee=zr(t,Kt=>Q(Kt)),ie=q.useRef(null),ue=q.useRef(null),xe=d||H.duration,Oe=q.useRef(0),ze=q.useRef(xe),Be=q.useRef(0),{onToastAdd:ot,onToastRemove:Et}=H,Zt=tu(()=>{var nn;(re==null?void 0:re.contains(document.activeElement))&&((nn=H.viewport)==null||nn.focus()),v()}),at=q.useCallback(Kt=>{!Kt||Kt===1/0||(window.clearTimeout(Be.current),Oe.current=new Date().getTime(),Be.current=window.setTimeout(Zt,Kt))},[Zt]);q.useEffect(()=>{const Kt=H.viewport;if(Kt){const nn=()=>{at(ze.current),A==null||A()},Wt=()=>{const Ke=new Date().getTime()-Oe.current;ze.current=ze.current-Ke,window.clearTimeout(Be.current),I==null||I()};return Kt.addEventListener(RR,Wt),Kt.addEventListener(MR,nn),()=>{Kt.removeEventListener(RR,Wt),Kt.removeEventListener(MR,nn)}}},[H.viewport,xe,I,A,at]),q.useEffect(()=>{m&&!H.isClosePausedRef.current&&at(xe)},[m,xe,H.isClosePausedRef,at]),q.useEffect(()=>(ot(),()=>Et()),[ot,Et]);const zt=q.useMemo(()=>re?h8(re):null,[re]);return H.viewport?E.jsxs(E.Fragment,{children:[zt&&E.jsx(Lte,{__scopeToast:i,role:"status","aria-live":l==="foreground"?"assertive":"polite","aria-atomic":!0,children:zt}),E.jsx(kte,{scope:i,onClose:Zt,children:Om.createPortal(E.jsx(Xk.ItemSlot,{scope:i,children:E.jsx(fte,{asChild:!0,onEscapeKeyDown:Li(o,()=>{H.isFocusedToastEscapeKeyDownRef.current||Zt(),H.isFocusedToastEscapeKeyDownRef.current=!1}),children:E.jsx(Ki.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":m?"open":"closed","data-swipe-direction":H.swipeDirection,...J,ref:ee,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Li(e.onKeyDown,Kt=>{Kt.key==="Escape"&&(o==null||o(Kt.nativeEvent),Kt.nativeEvent.defaultPrevented||(H.isFocusedToastEscapeKeyDownRef.current=!0,Zt()))}),onPointerDown:Li(e.onPointerDown,Kt=>{Kt.button===0&&(ie.current={x:Kt.clientX,y:Kt.clientY})}),onPointerMove:Li(e.onPointerMove,Kt=>{if(!ie.current)return;const nn=Kt.clientX-ie.current.x,Wt=Kt.clientY-ie.current.y,Ke=!!ue.current,et=["left","right"].includes(H.swipeDirection),Ct=["left","up"].includes(H.swipeDirection)?Math.min:Math.max,en=et?Ct(0,nn):0,Bn=et?0:Ct(0,Wt),En=Kt.pointerType==="touch"?10:2,gn={x:en,y:Bn},qt={originalEvent:Kt,delta:gn};Ke?(ue.current=gn,zT(Pte,F,qt,{discrete:!1})):jj(gn,H.swipeDirection,En)?(ue.current=gn,zT(Ate,N,qt,{discrete:!1}),Kt.target.setPointerCapture(Kt.pointerId)):(Math.abs(nn)>En||Math.abs(Wt)>En)&&(ie.current=null)}),onPointerUp:Li(e.onPointerUp,Kt=>{const nn=ue.current,Wt=Kt.target;if(Wt.hasPointerCapture(Kt.pointerId)&&Wt.releasePointerCapture(Kt.pointerId),ue.current=null,ie.current=null,nn){const Ke=Kt.currentTarget,et={originalEvent:Kt,delta:nn};jj(nn,H.swipeDirection,H.swipeThreshold)?zT(Mte,$,et,{discrete:!0}):zT(Rte,z,et,{discrete:!0}),Ke.addEventListener("click",Ct=>Ct.preventDefault(),{once:!0})}})})})}),H.viewport)})]}):null}),Lte=e=>{const{__scopeToast:t,children:i,...l}=e,d=mC(Q1,t),[m,v]=q.useState(!1),[o,I]=q.useState(!1);return zte(()=>v(!0)),q.useEffect(()=>{const A=window.setTimeout(()=>I(!0),1e3);return()=>window.clearTimeout(A)},[]),o?null:E.jsx(fC,{asChild:!0,children:E.jsx(pC,{...l,children:m&&E.jsxs(E.Fragment,{children:[d.label," ",i]})})})},Ote="ToastTitle",o8=q.forwardRef((e,t)=>{const{__scopeToast:i,...l}=e;return E.jsx(Ki.div,{...l,ref:t})});o8.displayName=Ote;var Fte="ToastDescription",a8=q.forwardRef((e,t)=>{const{__scopeToast:i,...l}=e;return E.jsx(Ki.div,{...l,ref:t})});a8.displayName=Fte;var l8="ToastAction",c8=q.forwardRef((e,t)=>{const{altText:i,...l}=e;return i.trim()?E.jsx(d8,{altText:i,asChild:!0,children:E.jsx(Yk,{...l,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${l8}\`. Expected non-empty \`string\`.`),null)});c8.displayName=l8;var u8="ToastClose",Yk=q.forwardRef((e,t)=>{const{__scopeToast:i,...l}=e,d=Dte(u8,i);return E.jsx(d8,{asChild:!0,children:E.jsx(Ki.button,{type:"button",...l,ref:t,onClick:Li(e.onClick,d.onClose)})})});Yk.displayName=u8;var d8=q.forwardRef((e,t)=>{const{__scopeToast:i,altText:l,...d}=e;return E.jsx(Ki.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":l||void 0,...d,ref:t})});function h8(e){const t=[];return Array.from(e.childNodes).forEach(l=>{if(l.nodeType===l.TEXT_NODE&&l.textContent&&t.push(l.textContent),jte(l)){const d=l.ariaHidden||l.hidden||l.style.display==="none",m=l.dataset.radixToastAnnounceExclude==="";if(!d)if(m){const v=l.dataset.radixToastAnnounceAlt;v&&t.push(v)}else t.push(...h8(l))}}),t}function zT(e,t,i,{discrete:l}){const d=i.originalEvent.currentTarget,m=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:i});t&&d.addEventListener(e,t,{once:!0}),l?K6(d,m):d.dispatchEvent(m)}var jj=(e,t,i=0)=>{const l=Math.abs(e.x),d=Math.abs(e.y),m=l>d;return t==="left"||t==="right"?m&&l>i:!m&&d>i};function zte(e=()=>{}){const t=tu(e);Ao(()=>{let i=0,l=0;return i=window.requestAnimationFrame(()=>l=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(i),window.cancelAnimationFrame(l)}},[t])}function jte(e){return e.nodeType===e.ELEMENT_NODE}function Bte(e){const t=[],i=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:l=>{const d=l.tagName==="INPUT"&&l.type==="hidden";return l.disabled||l.hidden||d?NodeFilter.FILTER_SKIP:l.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;i.nextNode();)t.push(i.currentNode);return t}function V2(e){const t=document.activeElement;return e.some(i=>i===t?!0:(i.focus(),document.activeElement!==t))}var Vte=t8,f8=i8,p8=s8,m8=o8,g8=a8,_8=c8,y8=Yk;function v8(e){var t,i,l="";if(typeof e=="string"||typeof e=="number")l+=e;else if(typeof e=="object")if(Array.isArray(e)){var d=e.length;for(t=0;t<d;t++)e[t]&&(i=v8(e[t]))&&(l&&(l+=" "),l+=i)}else for(i in e)e[i]&&(l&&(l+=" "),l+=i);return l}function x8(){for(var e,t,i=0,l="",d=arguments.length;i<d;i++)(e=arguments[i])&&(t=v8(e))&&(l&&(l+=" "),l+=t);return l}const Bj=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,Vj=x8,Qk=(e,t)=>i=>{var l;if((t==null?void 0:t.variants)==null)return Vj(e,i==null?void 0:i.class,i==null?void 0:i.className);const{variants:d,defaultVariants:m}=t,v=Object.keys(d).map(A=>{const N=i==null?void 0:i[A],F=m==null?void 0:m[A];if(N===null)return null;const z=Bj(N)||Bj(F);return d[A][z]}),o=i&&Object.entries(i).reduce((A,N)=>{let[F,z]=N;return z===void 0||(A[F]=z),A},{}),I=t==null||(l=t.compoundVariants)===null||l===void 0?void 0:l.reduce((A,N)=>{let{class:F,className:z,...$}=N;return Object.entries($).every(J=>{let[H,re]=J;return Array.isArray(re)?re.includes({...m,...o}[H]):{...m,...o}[H]===re})?[...A,F,z]:A},[]);return Vj(e,v,I,i==null?void 0:i.class,i==null?void 0:i.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ute=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),b8=(...e)=>e.filter((t,i,l)=>!!t&&t.trim()!==""&&l.indexOf(t)===i).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var $te={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gte=q.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:i=2,absoluteStrokeWidth:l,className:d="",children:m,iconNode:v,...o},I)=>q.createElement("svg",{ref:I,...$te,width:t,height:t,stroke:e,strokeWidth:l?Number(i)*24/Number(t):i,className:b8("lucide",d),...o},[...v.map(([A,N])=>q.createElement(A,N)),...Array.isArray(m)?m:[m]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ri=(e,t)=>{const i=q.forwardRef(({className:l,...d},m)=>q.createElement(Gte,{ref:m,iconNode:t,className:b8(`lucide-${Ute(e)}`,l),...d}));return i.displayName=`${e}`,i};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wf=ri("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hte=ri("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w8=ri("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rS=ri("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zu=ri("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mf=ri("ChefHat",[["path",{d:"M17 21a1 1 0 0 0 1-1v-5.35c0-.457.316-.844.727-1.041a4 4 0 0 0-2.134-7.589 5 5 0 0 0-9.186 0 4 4 0 0 0-2.134 7.588c.411.198.727.585.727 1.041V20a1 1 0 0 0 1 1Z",key:"1qvrer"}],["path",{d:"M6 17h12",key:"1jwigz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gC=ri("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wte=ri("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ay=ri("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qte=ri("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zte=ri("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g1=ri("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kte=ri("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xte=ri("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U2=ri("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yte=ri("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T8=ri("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $2=ri("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qte=ri("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E8=ri("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S8=ri("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jk=ri("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=ri("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jte=ri("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _1=ri("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ene=ri("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=ri("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tne=ri("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nne=ri("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ine=ri("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C8=ri("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rne=ri("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eD=ri("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wm=ri("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sne=ri("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const one=ri("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ly=ri("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ane=ri("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tD=ri("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I8=ri("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lne=ri("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cne=ri("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nD=ri("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const une=ri("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A8=ri("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P8=ri("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y1=ri("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R8=ri("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kf=ri("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M8=ri("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zc=ri("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dne=ri("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hne=ri("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DR=ri("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cy=ri("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kc=ri("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),iD="-",fne=e=>{const t=mne(e),{conflictingClassGroups:i,conflictingClassGroupModifiers:l}=e;return{getClassGroupId:v=>{const o=v.split(iD);return o[0]===""&&o.length!==1&&o.shift(),k8(o,t)||pne(v)},getConflictingClassGroupIds:(v,o)=>{const I=i[v]||[];return o&&l[v]?[...I,...l[v]]:I}}},k8=(e,t)=>{var v;if(e.length===0)return t.classGroupId;const i=e[0],l=t.nextPart.get(i),d=l?k8(e.slice(1),l):void 0;if(d)return d;if(t.validators.length===0)return;const m=e.join(iD);return(v=t.validators.find(({validator:o})=>o(m)))==null?void 0:v.classGroupId},Uj=/^\[(.+)\]$/,pne=e=>{if(Uj.test(e)){const t=Uj.exec(e)[1],i=t==null?void 0:t.substring(0,t.indexOf(":"));if(i)return"arbitrary.."+i}},mne=e=>{const{theme:t,prefix:i}=e,l={nextPart:new Map,validators:[]};return _ne(Object.entries(e.classGroups),i).forEach(([m,v])=>{NR(v,l,m,t)}),l},NR=(e,t,i,l)=>{e.forEach(d=>{if(typeof d=="string"){const m=d===""?t:$j(t,d);m.classGroupId=i;return}if(typeof d=="function"){if(gne(d)){NR(d(l),t,i,l);return}t.validators.push({validator:d,classGroupId:i});return}Object.entries(d).forEach(([m,v])=>{NR(v,$j(t,m),i,l)})})},$j=(e,t)=>{let i=e;return t.split(iD).forEach(l=>{i.nextPart.has(l)||i.nextPart.set(l,{nextPart:new Map,validators:[]}),i=i.nextPart.get(l)}),i},gne=e=>e.isThemeGetter,_ne=(e,t)=>t?e.map(([i,l])=>{const d=l.map(m=>typeof m=="string"?t+m:typeof m=="object"?Object.fromEntries(Object.entries(m).map(([v,o])=>[t+v,o])):m);return[i,d]}):e,yne=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,i=new Map,l=new Map;const d=(m,v)=>{i.set(m,v),t++,t>e&&(t=0,l=i,i=new Map)};return{get(m){let v=i.get(m);if(v!==void 0)return v;if((v=l.get(m))!==void 0)return d(m,v),v},set(m,v){i.has(m)?i.set(m,v):d(m,v)}}},D8="!",vne=e=>{const{separator:t,experimentalParseClassName:i}=e,l=t.length===1,d=t[0],m=t.length,v=o=>{const I=[];let A=0,N=0,F;for(let re=0;re<o.length;re++){let Q=o[re];if(A===0){if(Q===d&&(l||o.slice(re,re+m)===t)){I.push(o.slice(N,re)),N=re+m;continue}if(Q==="/"){F=re;continue}}Q==="["?A++:Q==="]"&&A--}const z=I.length===0?o:o.substring(N),$=z.startsWith(D8),J=$?z.substring(1):z,H=F&&F>N?F-N:void 0;return{modifiers:I,hasImportantModifier:$,baseClassName:J,maybePostfixModifierPosition:H}};return i?o=>i({className:o,parseClassName:v}):v},xne=e=>{if(e.length<=1)return e;const t=[];let i=[];return e.forEach(l=>{l[0]==="["?(t.push(...i.sort(),l),i=[]):i.push(l)}),t.push(...i.sort()),t},bne=e=>({cache:yne(e.cacheSize),parseClassName:vne(e),...fne(e)}),wne=/\s+/,Tne=(e,t)=>{const{parseClassName:i,getClassGroupId:l,getConflictingClassGroupIds:d}=t,m=[],v=e.trim().split(wne);let o="";for(let I=v.length-1;I>=0;I-=1){const A=v[I],{modifiers:N,hasImportantModifier:F,baseClassName:z,maybePostfixModifierPosition:$}=i(A);let J=!!$,H=l(J?z.substring(0,$):z);if(!H){if(!J){o=A+(o.length>0?" "+o:o);continue}if(H=l(z),!H){o=A+(o.length>0?" "+o:o);continue}J=!1}const re=xne(N).join(":"),Q=F?re+D8:re,ee=Q+H;if(m.includes(ee))continue;m.push(ee);const ie=d(H,J);for(let ue=0;ue<ie.length;++ue){const xe=ie[ue];m.push(Q+xe)}o=A+(o.length>0?" "+o:o)}return o};function Ene(){let e=0,t,i,l="";for(;e<arguments.length;)(t=arguments[e++])&&(i=N8(t))&&(l&&(l+=" "),l+=i);return l}const N8=e=>{if(typeof e=="string")return e;let t,i="";for(let l=0;l<e.length;l++)e[l]&&(t=N8(e[l]))&&(i&&(i+=" "),i+=t);return i};function Sne(e,...t){let i,l,d,m=v;function v(I){const A=t.reduce((N,F)=>F(N),e());return i=bne(A),l=i.cache.get,d=i.cache.set,m=o,o(I)}function o(I){const A=l(I);if(A)return A;const N=Tne(I,i);return d(I,N),N}return function(){return m(Ene.apply(null,arguments))}}const hs=e=>{const t=i=>i[e]||[];return t.isThemeGetter=!0,t},L8=/^\[(?:([a-z-]+):)?(.+)\]$/i,Cne=/^\d+\/\d+$/,Ine=new Set(["px","full","screen"]),Ane=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Pne=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Rne=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Mne=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,kne=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Rd=e=>uy(e)||Ine.has(e)||Cne.test(e),Vh=e=>Qy(e,"length",Bne),uy=e=>!!e&&!Number.isNaN(Number(e)),G2=e=>Qy(e,"number",uy),g0=e=>!!e&&Number.isInteger(Number(e)),Dne=e=>e.endsWith("%")&&uy(e.slice(0,-1)),Zi=e=>L8.test(e),Uh=e=>Ane.test(e),Nne=new Set(["length","size","percentage"]),Lne=e=>Qy(e,Nne,O8),One=e=>Qy(e,"position",O8),Fne=new Set(["image","url"]),zne=e=>Qy(e,Fne,Une),jne=e=>Qy(e,"",Vne),_0=()=>!0,Qy=(e,t,i)=>{const l=L8.exec(e);return l?l[1]?typeof t=="string"?l[1]===t:t.has(l[1]):i(l[2]):!1},Bne=e=>Pne.test(e)&&!Rne.test(e),O8=()=>!1,Vne=e=>Mne.test(e),Une=e=>kne.test(e),$ne=()=>{const e=hs("colors"),t=hs("spacing"),i=hs("blur"),l=hs("brightness"),d=hs("borderColor"),m=hs("borderRadius"),v=hs("borderSpacing"),o=hs("borderWidth"),I=hs("contrast"),A=hs("grayscale"),N=hs("hueRotate"),F=hs("invert"),z=hs("gap"),$=hs("gradientColorStops"),J=hs("gradientColorStopPositions"),H=hs("inset"),re=hs("margin"),Q=hs("opacity"),ee=hs("padding"),ie=hs("saturate"),ue=hs("scale"),xe=hs("sepia"),Oe=hs("skew"),ze=hs("space"),Be=hs("translate"),ot=()=>["auto","contain","none"],Et=()=>["auto","hidden","clip","visible","scroll"],Zt=()=>["auto",Zi,t],at=()=>[Zi,t],zt=()=>["",Rd,Vh],Kt=()=>["auto",uy,Zi],nn=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Wt=()=>["solid","dashed","dotted","double","none"],Ke=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],et=()=>["start","end","center","between","around","evenly","stretch"],Ct=()=>["","0",Zi],en=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Bn=()=>[uy,Zi];return{cacheSize:500,separator:":",theme:{colors:[_0],spacing:[Rd,Vh],blur:["none","",Uh,Zi],brightness:Bn(),borderColor:[e],borderRadius:["none","","full",Uh,Zi],borderSpacing:at(),borderWidth:zt(),contrast:Bn(),grayscale:Ct(),hueRotate:Bn(),invert:Ct(),gap:at(),gradientColorStops:[e],gradientColorStopPositions:[Dne,Vh],inset:Zt(),margin:Zt(),opacity:Bn(),padding:at(),saturate:Bn(),scale:Bn(),sepia:Ct(),skew:Bn(),space:at(),translate:at()},classGroups:{aspect:[{aspect:["auto","square","video",Zi]}],container:["container"],columns:[{columns:[Uh]}],"break-after":[{"break-after":en()}],"break-before":[{"break-before":en()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...nn(),Zi]}],overflow:[{overflow:Et()}],"overflow-x":[{"overflow-x":Et()}],"overflow-y":[{"overflow-y":Et()}],overscroll:[{overscroll:ot()}],"overscroll-x":[{"overscroll-x":ot()}],"overscroll-y":[{"overscroll-y":ot()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[H]}],"inset-x":[{"inset-x":[H]}],"inset-y":[{"inset-y":[H]}],start:[{start:[H]}],end:[{end:[H]}],top:[{top:[H]}],right:[{right:[H]}],bottom:[{bottom:[H]}],left:[{left:[H]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",g0,Zi]}],basis:[{basis:Zt()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Zi]}],grow:[{grow:Ct()}],shrink:[{shrink:Ct()}],order:[{order:["first","last","none",g0,Zi]}],"grid-cols":[{"grid-cols":[_0]}],"col-start-end":[{col:["auto",{span:["full",g0,Zi]},Zi]}],"col-start":[{"col-start":Kt()}],"col-end":[{"col-end":Kt()}],"grid-rows":[{"grid-rows":[_0]}],"row-start-end":[{row:["auto",{span:[g0,Zi]},Zi]}],"row-start":[{"row-start":Kt()}],"row-end":[{"row-end":Kt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Zi]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Zi]}],gap:[{gap:[z]}],"gap-x":[{"gap-x":[z]}],"gap-y":[{"gap-y":[z]}],"justify-content":[{justify:["normal",...et()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...et(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...et(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[ee]}],px:[{px:[ee]}],py:[{py:[ee]}],ps:[{ps:[ee]}],pe:[{pe:[ee]}],pt:[{pt:[ee]}],pr:[{pr:[ee]}],pb:[{pb:[ee]}],pl:[{pl:[ee]}],m:[{m:[re]}],mx:[{mx:[re]}],my:[{my:[re]}],ms:[{ms:[re]}],me:[{me:[re]}],mt:[{mt:[re]}],mr:[{mr:[re]}],mb:[{mb:[re]}],ml:[{ml:[re]}],"space-x":[{"space-x":[ze]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[ze]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Zi,t]}],"min-w":[{"min-w":[Zi,t,"min","max","fit"]}],"max-w":[{"max-w":[Zi,t,"none","full","min","max","fit","prose",{screen:[Uh]},Uh]}],h:[{h:[Zi,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Zi,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Zi,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Zi,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Uh,Vh]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",G2]}],"font-family":[{font:[_0]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Zi]}],"line-clamp":[{"line-clamp":["none",uy,G2]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Rd,Zi]}],"list-image":[{"list-image":["none",Zi]}],"list-style-type":[{list:["none","disc","decimal",Zi]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[Q]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[Q]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Wt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Rd,Vh]}],"underline-offset":[{"underline-offset":["auto",Rd,Zi]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:at()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Zi]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Zi]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[Q]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...nn(),One]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Lne]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},zne]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[J]}],"gradient-via-pos":[{via:[J]}],"gradient-to-pos":[{to:[J]}],"gradient-from":[{from:[$]}],"gradient-via":[{via:[$]}],"gradient-to":[{to:[$]}],rounded:[{rounded:[m]}],"rounded-s":[{"rounded-s":[m]}],"rounded-e":[{"rounded-e":[m]}],"rounded-t":[{"rounded-t":[m]}],"rounded-r":[{"rounded-r":[m]}],"rounded-b":[{"rounded-b":[m]}],"rounded-l":[{"rounded-l":[m]}],"rounded-ss":[{"rounded-ss":[m]}],"rounded-se":[{"rounded-se":[m]}],"rounded-ee":[{"rounded-ee":[m]}],"rounded-es":[{"rounded-es":[m]}],"rounded-tl":[{"rounded-tl":[m]}],"rounded-tr":[{"rounded-tr":[m]}],"rounded-br":[{"rounded-br":[m]}],"rounded-bl":[{"rounded-bl":[m]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[Q]}],"border-style":[{border:[...Wt(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[Q]}],"divide-style":[{divide:Wt()}],"border-color":[{border:[d]}],"border-color-x":[{"border-x":[d]}],"border-color-y":[{"border-y":[d]}],"border-color-s":[{"border-s":[d]}],"border-color-e":[{"border-e":[d]}],"border-color-t":[{"border-t":[d]}],"border-color-r":[{"border-r":[d]}],"border-color-b":[{"border-b":[d]}],"border-color-l":[{"border-l":[d]}],"divide-color":[{divide:[d]}],"outline-style":[{outline:["",...Wt()]}],"outline-offset":[{"outline-offset":[Rd,Zi]}],"outline-w":[{outline:[Rd,Vh]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:zt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[Q]}],"ring-offset-w":[{"ring-offset":[Rd,Vh]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Uh,jne]}],"shadow-color":[{shadow:[_0]}],opacity:[{opacity:[Q]}],"mix-blend":[{"mix-blend":[...Ke(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Ke()}],filter:[{filter:["","none"]}],blur:[{blur:[i]}],brightness:[{brightness:[l]}],contrast:[{contrast:[I]}],"drop-shadow":[{"drop-shadow":["","none",Uh,Zi]}],grayscale:[{grayscale:[A]}],"hue-rotate":[{"hue-rotate":[N]}],invert:[{invert:[F]}],saturate:[{saturate:[ie]}],sepia:[{sepia:[xe]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[i]}],"backdrop-brightness":[{"backdrop-brightness":[l]}],"backdrop-contrast":[{"backdrop-contrast":[I]}],"backdrop-grayscale":[{"backdrop-grayscale":[A]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[N]}],"backdrop-invert":[{"backdrop-invert":[F]}],"backdrop-opacity":[{"backdrop-opacity":[Q]}],"backdrop-saturate":[{"backdrop-saturate":[ie]}],"backdrop-sepia":[{"backdrop-sepia":[xe]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[v]}],"border-spacing-x":[{"border-spacing-x":[v]}],"border-spacing-y":[{"border-spacing-y":[v]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Zi]}],duration:[{duration:Bn()}],ease:[{ease:["linear","in","out","in-out",Zi]}],delay:[{delay:Bn()}],animate:[{animate:["none","spin","ping","pulse","bounce",Zi]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[ue]}],"scale-x":[{"scale-x":[ue]}],"scale-y":[{"scale-y":[ue]}],rotate:[{rotate:[g0,Zi]}],"translate-x":[{"translate-x":[Be]}],"translate-y":[{"translate-y":[Be]}],"skew-x":[{"skew-x":[Oe]}],"skew-y":[{"skew-y":[Oe]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Zi]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Zi]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":at()}],"scroll-mx":[{"scroll-mx":at()}],"scroll-my":[{"scroll-my":at()}],"scroll-ms":[{"scroll-ms":at()}],"scroll-me":[{"scroll-me":at()}],"scroll-mt":[{"scroll-mt":at()}],"scroll-mr":[{"scroll-mr":at()}],"scroll-mb":[{"scroll-mb":at()}],"scroll-ml":[{"scroll-ml":at()}],"scroll-p":[{"scroll-p":at()}],"scroll-px":[{"scroll-px":at()}],"scroll-py":[{"scroll-py":at()}],"scroll-ps":[{"scroll-ps":at()}],"scroll-pe":[{"scroll-pe":at()}],"scroll-pt":[{"scroll-pt":at()}],"scroll-pr":[{"scroll-pr":at()}],"scroll-pb":[{"scroll-pb":at()}],"scroll-pl":[{"scroll-pl":at()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Zi]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Rd,Vh,G2]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Gne=Sne($ne);function Xn(...e){return Gne(x8(e))}const Hne=Vte,F8=q.forwardRef(({className:e,...t},i)=>E.jsx(f8,{ref:i,className:Xn("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));F8.displayName=f8.displayName;const Wne=Qk("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),z8=q.forwardRef(({className:e,variant:t,...i},l)=>E.jsx(p8,{ref:l,className:Xn(Wne({variant:t}),e),...i}));z8.displayName=p8.displayName;const qne=q.forwardRef(({className:e,...t},i)=>E.jsx(_8,{ref:i,className:Xn("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...t}));qne.displayName=_8.displayName;const j8=q.forwardRef(({className:e,...t},i)=>E.jsx(y8,{ref:i,className:Xn("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:E.jsx(Kc,{className:"h-4 w-4"})}));j8.displayName=y8.displayName;const B8=q.forwardRef(({className:e,...t},i)=>E.jsx(m8,{ref:i,className:Xn("text-sm font-semibold",e),...t}));B8.displayName=m8.displayName;const V8=q.forwardRef(({className:e,...t},i)=>E.jsx(g8,{ref:i,className:Xn("text-sm opacity-90",e),...t}));V8.displayName=g8.displayName;function Zne(){const{toasts:e}=Yee();return E.jsxs(Hne,{children:[e.map(function({id:t,title:i,description:l,action:d,...m}){return E.jsxs(z8,{...m,children:[E.jsxs("div",{className:"grid gap-1",children:[i&&E.jsx(B8,{children:i}),l&&E.jsx(V8,{children:l})]}),d,E.jsx(j8,{})]},t)}),E.jsx(F8,{})]})}var Gj=["light","dark"],Kne="(prefers-color-scheme: dark)",Xne=q.createContext(void 0),Yne={setTheme:e=>{},themes:[]},Qne=()=>{var e;return(e=q.useContext(Xne))!=null?e:Yne};q.memo(({forcedTheme:e,storageKey:t,attribute:i,enableSystem:l,enableColorScheme:d,defaultTheme:m,value:v,attrs:o,nonce:I})=>{let A=m==="system",N=i==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${o.map(J=>`'${J}'`).join(",")})`};`:`var d=document.documentElement,n='${i}',s='setAttribute';`,F=d?Gj.includes(m)&&m?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${m}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",z=(J,H=!1,re=!0)=>{let Q=v?v[J]:J,ee=H?J+"|| ''":`'${Q}'`,ie="";return d&&re&&!H&&Gj.includes(J)&&(ie+=`d.style.colorScheme = '${J}';`),i==="class"?H||Q?ie+=`c.add(${ee})`:ie+="null":Q&&(ie+=`d[s](n,${ee})`),ie},$=e?`!function(){${N}${z(e)}}()`:l?`!function(){try{${N}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${A})){var t='${Kne}',m=window.matchMedia(t);if(m.media!==t||m.matches){${z("dark")}}else{${z("light")}}}else if(e){${v?`var x=${JSON.stringify(v)};`:""}${z(v?"x[e]":"e",!0)}}${A?"":"else{"+z(m,!1,!1)+"}"}${F}}catch(e){}}()`:`!function(){try{${N}var e=localStorage.getItem('${t}');if(e){${v?`var x=${JSON.stringify(v)};`:""}${z(v?"x[e]":"e",!0)}}else{${z(m,!1,!1)};}${F}}catch(t){}}();`;return q.createElement("script",{nonce:I,dangerouslySetInnerHTML:{__html:$}})});var Jne=e=>{switch(e){case"success":return nie;case"info":return rie;case"warning":return iie;case"error":return sie;default:return null}},eie=Array(12).fill(0),tie=({visible:e,className:t})=>rn.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},rn.createElement("div",{className:"sonner-spinner"},eie.map((i,l)=>rn.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${l}`})))),nie=rn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},rn.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),iie=rn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},rn.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),rie=rn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},rn.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),sie=rn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},rn.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),oie=rn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},rn.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),rn.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),aie=()=>{let[e,t]=rn.useState(document.hidden);return rn.useEffect(()=>{let i=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",i),()=>window.removeEventListener("visibilitychange",i)},[]),e},LR=1,lie=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:i,...l}=e,d=typeof(e==null?void 0:e.id)=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:LR++,m=this.toasts.find(o=>o.id===d),v=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(d)&&this.dismissedToasts.delete(d),m?this.toasts=this.toasts.map(o=>o.id===d?(this.publish({...o,...e,id:d,title:i}),{...o,...e,id:d,dismissible:v,title:i}):o):this.addToast({title:i,...l,dismissible:v,id:d}),d},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(i=>i({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let i;t.loading!==void 0&&(i=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let l=e instanceof Promise?e:e(),d=i!==void 0,m,v=l.then(async I=>{if(m=["resolve",I],rn.isValidElement(I))d=!1,this.create({id:i,type:"default",message:I});else if(uie(I)&&!I.ok){d=!1;let A=typeof t.error=="function"?await t.error(`HTTP error! status: ${I.status}`):t.error,N=typeof t.description=="function"?await t.description(`HTTP error! status: ${I.status}`):t.description;this.create({id:i,type:"error",message:A,description:N})}else if(t.success!==void 0){d=!1;let A=typeof t.success=="function"?await t.success(I):t.success,N=typeof t.description=="function"?await t.description(I):t.description;this.create({id:i,type:"success",message:A,description:N})}}).catch(async I=>{if(m=["reject",I],t.error!==void 0){d=!1;let A=typeof t.error=="function"?await t.error(I):t.error,N=typeof t.description=="function"?await t.description(I):t.description;this.create({id:i,type:"error",message:A,description:N})}}).finally(()=>{var I;d&&(this.dismiss(i),i=void 0),(I=t.finally)==null||I.call(t)}),o=()=>new Promise((I,A)=>v.then(()=>m[0]==="reject"?A(m[1]):I(m[1])).catch(A));return typeof i!="string"&&typeof i!="number"?{unwrap:o}:Object.assign(i,{unwrap:o})},this.custom=(e,t)=>{let i=(t==null?void 0:t.id)||LR++;return this.create({jsx:e(i),id:i,...t}),i},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},$a=new lie,cie=(e,t)=>{let i=(t==null?void 0:t.id)||LR++;return $a.addToast({title:e,...t,id:i}),i},uie=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",die=cie,hie=()=>$a.toasts,fie=()=>$a.getActiveToasts(),Mn=Object.assign(die,{success:$a.success,info:$a.info,warning:$a.warning,error:$a.error,custom:$a.custom,message:$a.message,promise:$a.promise,dismiss:$a.dismiss,loading:$a.loading},{getHistory:hie,getToasts:fie});function pie(e,{insertAt:t}={}){if(typeof document>"u")return;let i=document.head||document.getElementsByTagName("head")[0],l=document.createElement("style");l.type="text/css",t==="top"&&i.firstChild?i.insertBefore(l,i.firstChild):i.appendChild(l),l.styleSheet?l.styleSheet.cssText=e:l.appendChild(document.createTextNode(e))}pie(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function jT(e){return e.label!==void 0}var mie=3,gie="32px",_ie="16px",Hj=4e3,yie=356,vie=14,xie=20,bie=200;function kc(...e){return e.filter(Boolean).join(" ")}function wie(e){let[t,i]=e.split("-"),l=[];return t&&l.push(t),i&&l.push(i),l}var Tie=e=>{var t,i,l,d,m,v,o,I,A,N,F;let{invert:z,toast:$,unstyled:J,interacting:H,setHeights:re,visibleToasts:Q,heights:ee,index:ie,toasts:ue,expanded:xe,removeToast:Oe,defaultRichColors:ze,closeButton:Be,style:ot,cancelButtonStyle:Et,actionButtonStyle:Zt,className:at="",descriptionClassName:zt="",duration:Kt,position:nn,gap:Wt,loadingIcon:Ke,expandByDefault:et,classNames:Ct,icons:en,closeButtonAriaLabel:Bn="Close toast",pauseWhenPageIsHidden:En}=e,[gn,qt]=rn.useState(null),[Ji,Sr]=rn.useState(null),[_n,Rt]=rn.useState(!1),[pn,Fn]=rn.useState(!1),[si,$i]=rn.useState(!1),[Mi,Ts]=rn.useState(!1),[fo,ls]=rn.useState(!1),[Kr,xr]=rn.useState(0),[Sl,sc]=rn.useState(0),na=rn.useRef($.duration||Kt||Hj),Ja=rn.useRef(null),po=rn.useRef(null),ks=ie===0,el=ie+1<=Q,zs=$.type,Hs=$.dismissible!==!1,tl=$.className||"",Ws=$.descriptionClassName||"",Ia=rn.useMemo(()=>ee.findIndex(gi=>gi.toastId===$.id)||0,[ee,$.id]),oc=rn.useMemo(()=>{var gi;return(gi=$.closeButton)!=null?gi:Be},[$.closeButton,Be]),Cl=rn.useMemo(()=>$.duration||Kt||Hj,[$.duration,Kt]),Il=rn.useRef(0),jr=rn.useRef(0),qs=rn.useRef(0),Aa=rn.useRef(null),[Al,Pa]=nn.split("-"),Ra=rn.useMemo(()=>ee.reduce((gi,er,tr)=>tr>=Ia?gi:gi+er.height,0),[ee,Ia]),$o=aie(),id=$.invert||z,nl=zs==="loading";jr.current=rn.useMemo(()=>Ia*Wt+Ra,[Ia,Ra]),rn.useEffect(()=>{na.current=Cl},[Cl]),rn.useEffect(()=>{Rt(!0)},[]),rn.useEffect(()=>{let gi=po.current;if(gi){let er=gi.getBoundingClientRect().height;return sc(er),re(tr=>[{toastId:$.id,height:er,position:$.position},...tr]),()=>re(tr=>tr.filter(mo=>mo.toastId!==$.id))}},[re,$.id]),rn.useLayoutEffect(()=>{if(!_n)return;let gi=po.current,er=gi.style.height;gi.style.height="auto";let tr=gi.getBoundingClientRect().height;gi.style.height=er,sc(tr),re(mo=>mo.find(st=>st.toastId===$.id)?mo.map(st=>st.toastId===$.id?{...st,height:tr}:st):[{toastId:$.id,height:tr,position:$.position},...mo])},[_n,$.title,$.description,re,$.id]);let Oi=rn.useCallback(()=>{Fn(!0),xr(jr.current),re(gi=>gi.filter(er=>er.toastId!==$.id)),setTimeout(()=>{Oe($)},bie)},[$,Oe,re,jr]);rn.useEffect(()=>{if($.promise&&zs==="loading"||$.duration===1/0||$.type==="loading")return;let gi;return xe||H||En&&$o?(()=>{if(qs.current<Il.current){let er=new Date().getTime()-Il.current;na.current=na.current-er}qs.current=new Date().getTime()})():na.current!==1/0&&(Il.current=new Date().getTime(),gi=setTimeout(()=>{var er;(er=$.onAutoClose)==null||er.call($,$),Oi()},na.current)),()=>clearTimeout(gi)},[xe,H,$,zs,En,$o,Oi]),rn.useEffect(()=>{$.delete&&Oi()},[Oi,$.delete]);function ms(){var gi,er,tr;return en!=null&&en.loading?rn.createElement("div",{className:kc(Ct==null?void 0:Ct.loader,(gi=$==null?void 0:$.classNames)==null?void 0:gi.loader,"sonner-loader"),"data-visible":zs==="loading"},en.loading):Ke?rn.createElement("div",{className:kc(Ct==null?void 0:Ct.loader,(er=$==null?void 0:$.classNames)==null?void 0:er.loader,"sonner-loader"),"data-visible":zs==="loading"},Ke):rn.createElement(tie,{className:kc(Ct==null?void 0:Ct.loader,(tr=$==null?void 0:$.classNames)==null?void 0:tr.loader),visible:zs==="loading"})}return rn.createElement("li",{tabIndex:0,ref:po,className:kc(at,tl,Ct==null?void 0:Ct.toast,(t=$==null?void 0:$.classNames)==null?void 0:t.toast,Ct==null?void 0:Ct.default,Ct==null?void 0:Ct[zs],(i=$==null?void 0:$.classNames)==null?void 0:i[zs]),"data-sonner-toast":"","data-rich-colors":(l=$.richColors)!=null?l:ze,"data-styled":!($.jsx||$.unstyled||J),"data-mounted":_n,"data-promise":!!$.promise,"data-swiped":fo,"data-removed":pn,"data-visible":el,"data-y-position":Al,"data-x-position":Pa,"data-index":ie,"data-front":ks,"data-swiping":si,"data-dismissible":Hs,"data-type":zs,"data-invert":id,"data-swipe-out":Mi,"data-swipe-direction":Ji,"data-expanded":!!(xe||et&&_n),style:{"--index":ie,"--toasts-before":ie,"--z-index":ue.length-ie,"--offset":`${pn?Kr:jr.current}px`,"--initial-height":et?"auto":`${Sl}px`,...ot,...$.style},onDragEnd:()=>{$i(!1),qt(null),Aa.current=null},onPointerDown:gi=>{nl||!Hs||(Ja.current=new Date,xr(jr.current),gi.target.setPointerCapture(gi.pointerId),gi.target.tagName!=="BUTTON"&&($i(!0),Aa.current={x:gi.clientX,y:gi.clientY}))},onPointerUp:()=>{var gi,er,tr,mo;if(Mi||!Hs)return;Aa.current=null;let st=Number(((gi=po.current)==null?void 0:gi.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Zs=Number(((er=po.current)==null?void 0:er.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),il=new Date().getTime()-((tr=Ja.current)==null?void 0:tr.getTime()),js=gn==="x"?st:Zs,$n=Math.abs(js)/il;if(Math.abs(js)>=xie||$n>.11){xr(jr.current),(mo=$.onDismiss)==null||mo.call($,$),Sr(gn==="x"?st>0?"right":"left":Zs>0?"down":"up"),Oi(),Ts(!0),ls(!1);return}$i(!1),qt(null)},onPointerMove:gi=>{var er,tr,mo,st;if(!Aa.current||!Hs||((er=window.getSelection())==null?void 0:er.toString().length)>0)return;let Zs=gi.clientY-Aa.current.y,il=gi.clientX-Aa.current.x,js=(tr=e.swipeDirections)!=null?tr:wie(nn);!gn&&(Math.abs(il)>1||Math.abs(Zs)>1)&&qt(Math.abs(il)>Math.abs(Zs)?"x":"y");let $n={x:0,y:0};gn==="y"?(js.includes("top")||js.includes("bottom"))&&(js.includes("top")&&Zs<0||js.includes("bottom")&&Zs>0)&&($n.y=Zs):gn==="x"&&(js.includes("left")||js.includes("right"))&&(js.includes("left")&&il<0||js.includes("right")&&il>0)&&($n.x=il),(Math.abs($n.x)>0||Math.abs($n.y)>0)&&ls(!0),(mo=po.current)==null||mo.style.setProperty("--swipe-amount-x",`${$n.x}px`),(st=po.current)==null||st.style.setProperty("--swipe-amount-y",`${$n.y}px`)}},oc&&!$.jsx?rn.createElement("button",{"aria-label":Bn,"data-disabled":nl,"data-close-button":!0,onClick:nl||!Hs?()=>{}:()=>{var gi;Oi(),(gi=$.onDismiss)==null||gi.call($,$)},className:kc(Ct==null?void 0:Ct.closeButton,(d=$==null?void 0:$.classNames)==null?void 0:d.closeButton)},(m=en==null?void 0:en.close)!=null?m:oie):null,$.jsx||q.isValidElement($.title)?$.jsx?$.jsx:typeof $.title=="function"?$.title():$.title:rn.createElement(rn.Fragment,null,zs||$.icon||$.promise?rn.createElement("div",{"data-icon":"",className:kc(Ct==null?void 0:Ct.icon,(v=$==null?void 0:$.classNames)==null?void 0:v.icon)},$.promise||$.type==="loading"&&!$.icon?$.icon||ms():null,$.type!=="loading"?$.icon||(en==null?void 0:en[zs])||Jne(zs):null):null,rn.createElement("div",{"data-content":"",className:kc(Ct==null?void 0:Ct.content,(o=$==null?void 0:$.classNames)==null?void 0:o.content)},rn.createElement("div",{"data-title":"",className:kc(Ct==null?void 0:Ct.title,(I=$==null?void 0:$.classNames)==null?void 0:I.title)},typeof $.title=="function"?$.title():$.title),$.description?rn.createElement("div",{"data-description":"",className:kc(zt,Ws,Ct==null?void 0:Ct.description,(A=$==null?void 0:$.classNames)==null?void 0:A.description)},typeof $.description=="function"?$.description():$.description):null),q.isValidElement($.cancel)?$.cancel:$.cancel&&jT($.cancel)?rn.createElement("button",{"data-button":!0,"data-cancel":!0,style:$.cancelButtonStyle||Et,onClick:gi=>{var er,tr;jT($.cancel)&&Hs&&((tr=(er=$.cancel).onClick)==null||tr.call(er,gi),Oi())},className:kc(Ct==null?void 0:Ct.cancelButton,(N=$==null?void 0:$.classNames)==null?void 0:N.cancelButton)},$.cancel.label):null,q.isValidElement($.action)?$.action:$.action&&jT($.action)?rn.createElement("button",{"data-button":!0,"data-action":!0,style:$.actionButtonStyle||Zt,onClick:gi=>{var er,tr;jT($.action)&&((tr=(er=$.action).onClick)==null||tr.call(er,gi),!gi.defaultPrevented&&Oi())},className:kc(Ct==null?void 0:Ct.actionButton,(F=$==null?void 0:$.classNames)==null?void 0:F.actionButton)},$.action.label):null))};function Wj(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function Eie(e,t){let i={};return[e,t].forEach((l,d)=>{let m=d===1,v=m?"--mobile-offset":"--offset",o=m?_ie:gie;function I(A){["top","right","bottom","left"].forEach(N=>{i[`${v}-${N}`]=typeof A=="number"?`${A}px`:A})}typeof l=="number"||typeof l=="string"?I(l):typeof l=="object"?["top","right","bottom","left"].forEach(A=>{l[A]===void 0?i[`${v}-${A}`]=o:i[`${v}-${A}`]=typeof l[A]=="number"?`${l[A]}px`:l[A]}):I(o)}),i}var Sie=q.forwardRef(function(e,t){let{invert:i,position:l="bottom-right",hotkey:d=["altKey","KeyT"],expand:m,closeButton:v,className:o,offset:I,mobileOffset:A,theme:N="light",richColors:F,duration:z,style:$,visibleToasts:J=mie,toastOptions:H,dir:re=Wj(),gap:Q=vie,loadingIcon:ee,icons:ie,containerAriaLabel:ue="Notifications",pauseWhenPageIsHidden:xe}=e,[Oe,ze]=rn.useState([]),Be=rn.useMemo(()=>Array.from(new Set([l].concat(Oe.filter(En=>En.position).map(En=>En.position)))),[Oe,l]),[ot,Et]=rn.useState([]),[Zt,at]=rn.useState(!1),[zt,Kt]=rn.useState(!1),[nn,Wt]=rn.useState(N!=="system"?N:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Ke=rn.useRef(null),et=d.join("+").replace(/Key/g,"").replace(/Digit/g,""),Ct=rn.useRef(null),en=rn.useRef(!1),Bn=rn.useCallback(En=>{ze(gn=>{var qt;return(qt=gn.find(Ji=>Ji.id===En.id))!=null&&qt.delete||$a.dismiss(En.id),gn.filter(({id:Ji})=>Ji!==En.id)})},[]);return rn.useEffect(()=>$a.subscribe(En=>{if(En.dismiss){ze(gn=>gn.map(qt=>qt.id===En.id?{...qt,delete:!0}:qt));return}setTimeout(()=>{G6.flushSync(()=>{ze(gn=>{let qt=gn.findIndex(Ji=>Ji.id===En.id);return qt!==-1?[...gn.slice(0,qt),{...gn[qt],...En},...gn.slice(qt+1)]:[En,...gn]})})})}),[]),rn.useEffect(()=>{if(N!=="system"){Wt(N);return}if(N==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Wt("dark"):Wt("light")),typeof window>"u")return;let En=window.matchMedia("(prefers-color-scheme: dark)");try{En.addEventListener("change",({matches:gn})=>{Wt(gn?"dark":"light")})}catch{En.addListener(({matches:qt})=>{try{Wt(qt?"dark":"light")}catch(Ji){console.error(Ji)}})}},[N]),rn.useEffect(()=>{Oe.length<=1&&at(!1)},[Oe]),rn.useEffect(()=>{let En=gn=>{var qt,Ji;d.every(Sr=>gn[Sr]||gn.code===Sr)&&(at(!0),(qt=Ke.current)==null||qt.focus()),gn.code==="Escape"&&(document.activeElement===Ke.current||(Ji=Ke.current)!=null&&Ji.contains(document.activeElement))&&at(!1)};return document.addEventListener("keydown",En),()=>document.removeEventListener("keydown",En)},[d]),rn.useEffect(()=>{if(Ke.current)return()=>{Ct.current&&(Ct.current.focus({preventScroll:!0}),Ct.current=null,en.current=!1)}},[Ke.current]),rn.createElement("section",{ref:t,"aria-label":`${ue} ${et}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},Be.map((En,gn)=>{var qt;let[Ji,Sr]=En.split("-");return Oe.length?rn.createElement("ol",{key:En,dir:re==="auto"?Wj():re,tabIndex:-1,ref:Ke,className:o,"data-sonner-toaster":!0,"data-theme":nn,"data-y-position":Ji,"data-lifted":Zt&&Oe.length>1&&!m,"data-x-position":Sr,style:{"--front-toast-height":`${((qt=ot[0])==null?void 0:qt.height)||0}px`,"--width":`${yie}px`,"--gap":`${Q}px`,...$,...Eie(I,A)},onBlur:_n=>{en.current&&!_n.currentTarget.contains(_n.relatedTarget)&&(en.current=!1,Ct.current&&(Ct.current.focus({preventScroll:!0}),Ct.current=null))},onFocus:_n=>{_n.target instanceof HTMLElement&&_n.target.dataset.dismissible==="false"||en.current||(en.current=!0,Ct.current=_n.relatedTarget)},onMouseEnter:()=>at(!0),onMouseMove:()=>at(!0),onMouseLeave:()=>{zt||at(!1)},onDragEnd:()=>at(!1),onPointerDown:_n=>{_n.target instanceof HTMLElement&&_n.target.dataset.dismissible==="false"||Kt(!0)},onPointerUp:()=>Kt(!1)},Oe.filter(_n=>!_n.position&&gn===0||_n.position===En).map((_n,Rt)=>{var pn,Fn;return rn.createElement(Tie,{key:_n.id,icons:ie,index:Rt,toast:_n,defaultRichColors:F,duration:(pn=H==null?void 0:H.duration)!=null?pn:z,className:H==null?void 0:H.className,descriptionClassName:H==null?void 0:H.descriptionClassName,invert:i,visibleToasts:J,closeButton:(Fn=H==null?void 0:H.closeButton)!=null?Fn:v,interacting:zt,position:En,style:H==null?void 0:H.style,unstyled:H==null?void 0:H.unstyled,classNames:H==null?void 0:H.classNames,cancelButtonStyle:H==null?void 0:H.cancelButtonStyle,actionButtonStyle:H==null?void 0:H.actionButtonStyle,removeToast:Bn,toasts:Oe.filter(si=>si.position==_n.position),heights:ot.filter(si=>si.position==_n.position),setHeights:Et,expandByDefault:m,gap:Q,loadingIcon:ee,expanded:Zt,pauseWhenPageIsHidden:xe,swipeDirections:e.swipeDirections})})):null}))});const Cie=({...e})=>{const{theme:t="system"}=Qne();return E.jsx(Sie,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})};var Iie=ik[" useId ".trim().toString()]||(()=>{}),Aie=0;function bf(e){const[t,i]=q.useState(Iie());return Ao(()=>{i(l=>l??String(Aie++))},[e]),t?`radix-${t}`:""}const Pie=["top","right","bottom","left"],Df=Math.min,gl=Math.max,sS=Math.round,BT=Math.floor,$u=e=>({x:e,y:e}),Rie={left:"right",right:"left",bottom:"top",top:"bottom"},Mie={start:"end",end:"start"};function OR(e,t,i){return gl(e,Df(t,i))}function Zd(e,t){return typeof e=="function"?e(t):e}function Kd(e){return e.split("-")[0]}function Jy(e){return e.split("-")[1]}function rD(e){return e==="x"?"y":"x"}function sD(e){return e==="y"?"height":"width"}const kie=new Set(["top","bottom"]);function ju(e){return kie.has(Kd(e))?"y":"x"}function oD(e){return rD(ju(e))}function Die(e,t,i){i===void 0&&(i=!1);const l=Jy(e),d=oD(e),m=sD(d);let v=d==="x"?l===(i?"end":"start")?"right":"left":l==="start"?"bottom":"top";return t.reference[m]>t.floating[m]&&(v=oS(v)),[v,oS(v)]}function Nie(e){const t=oS(e);return[FR(e),t,FR(t)]}function FR(e){return e.replace(/start|end/g,t=>Mie[t])}const qj=["left","right"],Zj=["right","left"],Lie=["top","bottom"],Oie=["bottom","top"];function Fie(e,t,i){switch(e){case"top":case"bottom":return i?t?Zj:qj:t?qj:Zj;case"left":case"right":return t?Lie:Oie;default:return[]}}function zie(e,t,i,l){const d=Jy(e);let m=Fie(Kd(e),i==="start",l);return d&&(m=m.map(v=>v+"-"+d),t&&(m=m.concat(m.map(FR)))),m}function oS(e){return e.replace(/left|right|bottom|top/g,t=>Rie[t])}function jie(e){return{top:0,right:0,bottom:0,left:0,...e}}function U8(e){return typeof e!="number"?jie(e):{top:e,right:e,bottom:e,left:e}}function aS(e){const{x:t,y:i,width:l,height:d}=e;return{width:l,height:d,top:i,left:t,right:t+l,bottom:i+d,x:t,y:i}}function Kj(e,t,i){let{reference:l,floating:d}=e;const m=ju(t),v=oD(t),o=sD(v),I=Kd(t),A=m==="y",N=l.x+l.width/2-d.width/2,F=l.y+l.height/2-d.height/2,z=l[o]/2-d[o]/2;let $;switch(I){case"top":$={x:N,y:l.y-d.height};break;case"bottom":$={x:N,y:l.y+l.height};break;case"right":$={x:l.x+l.width,y:F};break;case"left":$={x:l.x-d.width,y:F};break;default:$={x:l.x,y:l.y}}switch(Jy(t)){case"start":$[v]-=z*(i&&A?-1:1);break;case"end":$[v]+=z*(i&&A?-1:1);break}return $}const Bie=async(e,t,i)=>{const{placement:l="bottom",strategy:d="absolute",middleware:m=[],platform:v}=i,o=m.filter(Boolean),I=await(v.isRTL==null?void 0:v.isRTL(t));let A=await v.getElementRects({reference:e,floating:t,strategy:d}),{x:N,y:F}=Kj(A,l,I),z=l,$={},J=0;for(let H=0;H<o.length;H++){const{name:re,fn:Q}=o[H],{x:ee,y:ie,data:ue,reset:xe}=await Q({x:N,y:F,initialPlacement:l,placement:z,strategy:d,middlewareData:$,rects:A,platform:v,elements:{reference:e,floating:t}});N=ee??N,F=ie??F,$={...$,[re]:{...$[re],...ue}},xe&&J<=50&&(J++,typeof xe=="object"&&(xe.placement&&(z=xe.placement),xe.rects&&(A=xe.rects===!0?await v.getElementRects({reference:e,floating:t,strategy:d}):xe.rects),{x:N,y:F}=Kj(A,z,I)),H=-1)}return{x:N,y:F,placement:z,strategy:d,middlewareData:$}};async function v1(e,t){var i;t===void 0&&(t={});const{x:l,y:d,platform:m,rects:v,elements:o,strategy:I}=e,{boundary:A="clippingAncestors",rootBoundary:N="viewport",elementContext:F="floating",altBoundary:z=!1,padding:$=0}=Zd(t,e),J=U8($),re=o[z?F==="floating"?"reference":"floating":F],Q=aS(await m.getClippingRect({element:(i=await(m.isElement==null?void 0:m.isElement(re)))==null||i?re:re.contextElement||await(m.getDocumentElement==null?void 0:m.getDocumentElement(o.floating)),boundary:A,rootBoundary:N,strategy:I})),ee=F==="floating"?{x:l,y:d,width:v.floating.width,height:v.floating.height}:v.reference,ie=await(m.getOffsetParent==null?void 0:m.getOffsetParent(o.floating)),ue=await(m.isElement==null?void 0:m.isElement(ie))?await(m.getScale==null?void 0:m.getScale(ie))||{x:1,y:1}:{x:1,y:1},xe=aS(m.convertOffsetParentRelativeRectToViewportRelativeRect?await m.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:ee,offsetParent:ie,strategy:I}):ee);return{top:(Q.top-xe.top+J.top)/ue.y,bottom:(xe.bottom-Q.bottom+J.bottom)/ue.y,left:(Q.left-xe.left+J.left)/ue.x,right:(xe.right-Q.right+J.right)/ue.x}}const Vie=e=>({name:"arrow",options:e,async fn(t){const{x:i,y:l,placement:d,rects:m,platform:v,elements:o,middlewareData:I}=t,{element:A,padding:N=0}=Zd(e,t)||{};if(A==null)return{};const F=U8(N),z={x:i,y:l},$=oD(d),J=sD($),H=await v.getDimensions(A),re=$==="y",Q=re?"top":"left",ee=re?"bottom":"right",ie=re?"clientHeight":"clientWidth",ue=m.reference[J]+m.reference[$]-z[$]-m.floating[J],xe=z[$]-m.reference[$],Oe=await(v.getOffsetParent==null?void 0:v.getOffsetParent(A));let ze=Oe?Oe[ie]:0;(!ze||!await(v.isElement==null?void 0:v.isElement(Oe)))&&(ze=o.floating[ie]||m.floating[J]);const Be=ue/2-xe/2,ot=ze/2-H[J]/2-1,Et=Df(F[Q],ot),Zt=Df(F[ee],ot),at=Et,zt=ze-H[J]-Zt,Kt=ze/2-H[J]/2+Be,nn=OR(at,Kt,zt),Wt=!I.arrow&&Jy(d)!=null&&Kt!==nn&&m.reference[J]/2-(Kt<at?Et:Zt)-H[J]/2<0,Ke=Wt?Kt<at?Kt-at:Kt-zt:0;return{[$]:z[$]+Ke,data:{[$]:nn,centerOffset:Kt-nn-Ke,...Wt&&{alignmentOffset:Ke}},reset:Wt}}}),Uie=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var i,l;const{placement:d,middlewareData:m,rects:v,initialPlacement:o,platform:I,elements:A}=t,{mainAxis:N=!0,crossAxis:F=!0,fallbackPlacements:z,fallbackStrategy:$="bestFit",fallbackAxisSideDirection:J="none",flipAlignment:H=!0,...re}=Zd(e,t);if((i=m.arrow)!=null&&i.alignmentOffset)return{};const Q=Kd(d),ee=ju(o),ie=Kd(o)===o,ue=await(I.isRTL==null?void 0:I.isRTL(A.floating)),xe=z||(ie||!H?[oS(o)]:Nie(o)),Oe=J!=="none";!z&&Oe&&xe.push(...zie(o,H,J,ue));const ze=[o,...xe],Be=await v1(t,re),ot=[];let Et=((l=m.flip)==null?void 0:l.overflows)||[];if(N&&ot.push(Be[Q]),F){const Kt=Die(d,v,ue);ot.push(Be[Kt[0]],Be[Kt[1]])}if(Et=[...Et,{placement:d,overflows:ot}],!ot.every(Kt=>Kt<=0)){var Zt,at;const Kt=(((Zt=m.flip)==null?void 0:Zt.index)||0)+1,nn=ze[Kt];if(nn&&(!(F==="alignment"?ee!==ju(nn):!1)||Et.every(et=>et.overflows[0]>0&&ju(et.placement)===ee)))return{data:{index:Kt,overflows:Et},reset:{placement:nn}};let Wt=(at=Et.filter(Ke=>Ke.overflows[0]<=0).sort((Ke,et)=>Ke.overflows[1]-et.overflows[1])[0])==null?void 0:at.placement;if(!Wt)switch($){case"bestFit":{var zt;const Ke=(zt=Et.filter(et=>{if(Oe){const Ct=ju(et.placement);return Ct===ee||Ct==="y"}return!0}).map(et=>[et.placement,et.overflows.filter(Ct=>Ct>0).reduce((Ct,en)=>Ct+en,0)]).sort((et,Ct)=>et[1]-Ct[1])[0])==null?void 0:zt[0];Ke&&(Wt=Ke);break}case"initialPlacement":Wt=o;break}if(d!==Wt)return{reset:{placement:Wt}}}return{}}}};function Xj(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function Yj(e){return Pie.some(t=>e[t]>=0)}const $ie=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:i}=t,{strategy:l="referenceHidden",...d}=Zd(e,t);switch(l){case"referenceHidden":{const m=await v1(t,{...d,elementContext:"reference"}),v=Xj(m,i.reference);return{data:{referenceHiddenOffsets:v,referenceHidden:Yj(v)}}}case"escaped":{const m=await v1(t,{...d,altBoundary:!0}),v=Xj(m,i.floating);return{data:{escapedOffsets:v,escaped:Yj(v)}}}default:return{}}}}},$8=new Set(["left","top"]);async function Gie(e,t){const{placement:i,platform:l,elements:d}=e,m=await(l.isRTL==null?void 0:l.isRTL(d.floating)),v=Kd(i),o=Jy(i),I=ju(i)==="y",A=$8.has(v)?-1:1,N=m&&I?-1:1,F=Zd(t,e);let{mainAxis:z,crossAxis:$,alignmentAxis:J}=typeof F=="number"?{mainAxis:F,crossAxis:0,alignmentAxis:null}:{mainAxis:F.mainAxis||0,crossAxis:F.crossAxis||0,alignmentAxis:F.alignmentAxis};return o&&typeof J=="number"&&($=o==="end"?J*-1:J),I?{x:$*N,y:z*A}:{x:z*A,y:$*N}}const Hie=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var i,l;const{x:d,y:m,placement:v,middlewareData:o}=t,I=await Gie(t,e);return v===((i=o.offset)==null?void 0:i.placement)&&(l=o.arrow)!=null&&l.alignmentOffset?{}:{x:d+I.x,y:m+I.y,data:{...I,placement:v}}}}},Wie=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:i,y:l,placement:d}=t,{mainAxis:m=!0,crossAxis:v=!1,limiter:o={fn:re=>{let{x:Q,y:ee}=re;return{x:Q,y:ee}}},...I}=Zd(e,t),A={x:i,y:l},N=await v1(t,I),F=ju(Kd(d)),z=rD(F);let $=A[z],J=A[F];if(m){const re=z==="y"?"top":"left",Q=z==="y"?"bottom":"right",ee=$+N[re],ie=$-N[Q];$=OR(ee,$,ie)}if(v){const re=F==="y"?"top":"left",Q=F==="y"?"bottom":"right",ee=J+N[re],ie=J-N[Q];J=OR(ee,J,ie)}const H=o.fn({...t,[z]:$,[F]:J});return{...H,data:{x:H.x-i,y:H.y-l,enabled:{[z]:m,[F]:v}}}}}},qie=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:i,y:l,placement:d,rects:m,middlewareData:v}=t,{offset:o=0,mainAxis:I=!0,crossAxis:A=!0}=Zd(e,t),N={x:i,y:l},F=ju(d),z=rD(F);let $=N[z],J=N[F];const H=Zd(o,t),re=typeof H=="number"?{mainAxis:H,crossAxis:0}:{mainAxis:0,crossAxis:0,...H};if(I){const ie=z==="y"?"height":"width",ue=m.reference[z]-m.floating[ie]+re.mainAxis,xe=m.reference[z]+m.reference[ie]-re.mainAxis;$<ue?$=ue:$>xe&&($=xe)}if(A){var Q,ee;const ie=z==="y"?"width":"height",ue=$8.has(Kd(d)),xe=m.reference[F]-m.floating[ie]+(ue&&((Q=v.offset)==null?void 0:Q[F])||0)+(ue?0:re.crossAxis),Oe=m.reference[F]+m.reference[ie]+(ue?0:((ee=v.offset)==null?void 0:ee[F])||0)-(ue?re.crossAxis:0);J<xe?J=xe:J>Oe&&(J=Oe)}return{[z]:$,[F]:J}}}},Zie=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var i,l;const{placement:d,rects:m,platform:v,elements:o}=t,{apply:I=()=>{},...A}=Zd(e,t),N=await v1(t,A),F=Kd(d),z=Jy(d),$=ju(d)==="y",{width:J,height:H}=m.floating;let re,Q;F==="top"||F==="bottom"?(re=F,Q=z===(await(v.isRTL==null?void 0:v.isRTL(o.floating))?"start":"end")?"left":"right"):(Q=F,re=z==="end"?"top":"bottom");const ee=H-N.top-N.bottom,ie=J-N.left-N.right,ue=Df(H-N[re],ee),xe=Df(J-N[Q],ie),Oe=!t.middlewareData.shift;let ze=ue,Be=xe;if((i=t.middlewareData.shift)!=null&&i.enabled.x&&(Be=ie),(l=t.middlewareData.shift)!=null&&l.enabled.y&&(ze=ee),Oe&&!z){const Et=gl(N.left,0),Zt=gl(N.right,0),at=gl(N.top,0),zt=gl(N.bottom,0);$?Be=J-2*(Et!==0||Zt!==0?Et+Zt:gl(N.left,N.right)):ze=H-2*(at!==0||zt!==0?at+zt:gl(N.top,N.bottom))}await I({...t,availableWidth:Be,availableHeight:ze});const ot=await v.getDimensions(o.floating);return J!==ot.width||H!==ot.height?{reset:{rects:!0}}:{}}}};function _C(){return typeof window<"u"}function ev(e){return G8(e)?(e.nodeName||"").toLowerCase():"#document"}function xl(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Ju(e){var t;return(t=(G8(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function G8(e){return _C()?e instanceof Node||e instanceof xl(e).Node:!1}function nu(e){return _C()?e instanceof Element||e instanceof xl(e).Element:!1}function Ku(e){return _C()?e instanceof HTMLElement||e instanceof xl(e).HTMLElement:!1}function Qj(e){return!_C()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof xl(e).ShadowRoot}const Kie=new Set(["inline","contents"]);function J1(e){const{overflow:t,overflowX:i,overflowY:l,display:d}=iu(e);return/auto|scroll|overlay|hidden|clip/.test(t+l+i)&&!Kie.has(d)}const Xie=new Set(["table","td","th"]);function Yie(e){return Xie.has(ev(e))}const Qie=[":popover-open",":modal"];function yC(e){return Qie.some(t=>{try{return e.matches(t)}catch{return!1}})}const Jie=["transform","translate","scale","rotate","perspective"],ere=["transform","translate","scale","rotate","perspective","filter"],tre=["paint","layout","strict","content"];function aD(e){const t=lD(),i=nu(e)?iu(e):e;return Jie.some(l=>i[l]?i[l]!=="none":!1)||(i.containerType?i.containerType!=="normal":!1)||!t&&(i.backdropFilter?i.backdropFilter!=="none":!1)||!t&&(i.filter?i.filter!=="none":!1)||ere.some(l=>(i.willChange||"").includes(l))||tre.some(l=>(i.contain||"").includes(l))}function nre(e){let t=Nf(e);for(;Ku(t)&&!Oy(t);){if(aD(t))return t;if(yC(t))return null;t=Nf(t)}return null}function lD(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const ire=new Set(["html","body","#document"]);function Oy(e){return ire.has(ev(e))}function iu(e){return xl(e).getComputedStyle(e)}function vC(e){return nu(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Nf(e){if(ev(e)==="html")return e;const t=e.assignedSlot||e.parentNode||Qj(e)&&e.host||Ju(e);return Qj(t)?t.host:t}function H8(e){const t=Nf(e);return Oy(t)?e.ownerDocument?e.ownerDocument.body:e.body:Ku(t)&&J1(t)?t:H8(t)}function x1(e,t,i){var l;t===void 0&&(t=[]),i===void 0&&(i=!0);const d=H8(e),m=d===((l=e.ownerDocument)==null?void 0:l.body),v=xl(d);if(m){const o=zR(v);return t.concat(v,v.visualViewport||[],J1(d)?d:[],o&&i?x1(o):[])}return t.concat(d,x1(d,[],i))}function zR(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function W8(e){const t=iu(e);let i=parseFloat(t.width)||0,l=parseFloat(t.height)||0;const d=Ku(e),m=d?e.offsetWidth:i,v=d?e.offsetHeight:l,o=sS(i)!==m||sS(l)!==v;return o&&(i=m,l=v),{width:i,height:l,$:o}}function cD(e){return nu(e)?e:e.contextElement}function dy(e){const t=cD(e);if(!Ku(t))return $u(1);const i=t.getBoundingClientRect(),{width:l,height:d,$:m}=W8(t);let v=(m?sS(i.width):i.width)/l,o=(m?sS(i.height):i.height)/d;return(!v||!Number.isFinite(v))&&(v=1),(!o||!Number.isFinite(o))&&(o=1),{x:v,y:o}}const rre=$u(0);function q8(e){const t=xl(e);return!lD()||!t.visualViewport?rre:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function sre(e,t,i){return t===void 0&&(t=!1),!i||t&&i!==xl(e)?!1:t}function Tm(e,t,i,l){t===void 0&&(t=!1),i===void 0&&(i=!1);const d=e.getBoundingClientRect(),m=cD(e);let v=$u(1);t&&(l?nu(l)&&(v=dy(l)):v=dy(e));const o=sre(m,i,l)?q8(m):$u(0);let I=(d.left+o.x)/v.x,A=(d.top+o.y)/v.y,N=d.width/v.x,F=d.height/v.y;if(m){const z=xl(m),$=l&&nu(l)?xl(l):l;let J=z,H=zR(J);for(;H&&l&&$!==J;){const re=dy(H),Q=H.getBoundingClientRect(),ee=iu(H),ie=Q.left+(H.clientLeft+parseFloat(ee.paddingLeft))*re.x,ue=Q.top+(H.clientTop+parseFloat(ee.paddingTop))*re.y;I*=re.x,A*=re.y,N*=re.x,F*=re.y,I+=ie,A+=ue,J=xl(H),H=zR(J)}}return aS({width:N,height:F,x:I,y:A})}function uD(e,t){const i=vC(e).scrollLeft;return t?t.left+i:Tm(Ju(e)).left+i}function Z8(e,t,i){i===void 0&&(i=!1);const l=e.getBoundingClientRect(),d=l.left+t.scrollLeft-(i?0:uD(e,l)),m=l.top+t.scrollTop;return{x:d,y:m}}function ore(e){let{elements:t,rect:i,offsetParent:l,strategy:d}=e;const m=d==="fixed",v=Ju(l),o=t?yC(t.floating):!1;if(l===v||o&&m)return i;let I={scrollLeft:0,scrollTop:0},A=$u(1);const N=$u(0),F=Ku(l);if((F||!F&&!m)&&((ev(l)!=="body"||J1(v))&&(I=vC(l)),Ku(l))){const $=Tm(l);A=dy(l),N.x=$.x+l.clientLeft,N.y=$.y+l.clientTop}const z=v&&!F&&!m?Z8(v,I,!0):$u(0);return{width:i.width*A.x,height:i.height*A.y,x:i.x*A.x-I.scrollLeft*A.x+N.x+z.x,y:i.y*A.y-I.scrollTop*A.y+N.y+z.y}}function are(e){return Array.from(e.getClientRects())}function lre(e){const t=Ju(e),i=vC(e),l=e.ownerDocument.body,d=gl(t.scrollWidth,t.clientWidth,l.scrollWidth,l.clientWidth),m=gl(t.scrollHeight,t.clientHeight,l.scrollHeight,l.clientHeight);let v=-i.scrollLeft+uD(e);const o=-i.scrollTop;return iu(l).direction==="rtl"&&(v+=gl(t.clientWidth,l.clientWidth)-d),{width:d,height:m,x:v,y:o}}function cre(e,t){const i=xl(e),l=Ju(e),d=i.visualViewport;let m=l.clientWidth,v=l.clientHeight,o=0,I=0;if(d){m=d.width,v=d.height;const A=lD();(!A||A&&t==="fixed")&&(o=d.offsetLeft,I=d.offsetTop)}return{width:m,height:v,x:o,y:I}}const ure=new Set(["absolute","fixed"]);function dre(e,t){const i=Tm(e,!0,t==="fixed"),l=i.top+e.clientTop,d=i.left+e.clientLeft,m=Ku(e)?dy(e):$u(1),v=e.clientWidth*m.x,o=e.clientHeight*m.y,I=d*m.x,A=l*m.y;return{width:v,height:o,x:I,y:A}}function Jj(e,t,i){let l;if(t==="viewport")l=cre(e,i);else if(t==="document")l=lre(Ju(e));else if(nu(t))l=dre(t,i);else{const d=q8(e);l={x:t.x-d.x,y:t.y-d.y,width:t.width,height:t.height}}return aS(l)}function K8(e,t){const i=Nf(e);return i===t||!nu(i)||Oy(i)?!1:iu(i).position==="fixed"||K8(i,t)}function hre(e,t){const i=t.get(e);if(i)return i;let l=x1(e,[],!1).filter(o=>nu(o)&&ev(o)!=="body"),d=null;const m=iu(e).position==="fixed";let v=m?Nf(e):e;for(;nu(v)&&!Oy(v);){const o=iu(v),I=aD(v);!I&&o.position==="fixed"&&(d=null),(m?!I&&!d:!I&&o.position==="static"&&!!d&&ure.has(d.position)||J1(v)&&!I&&K8(e,v))?l=l.filter(N=>N!==v):d=o,v=Nf(v)}return t.set(e,l),l}function fre(e){let{element:t,boundary:i,rootBoundary:l,strategy:d}=e;const v=[...i==="clippingAncestors"?yC(t)?[]:hre(t,this._c):[].concat(i),l],o=v[0],I=v.reduce((A,N)=>{const F=Jj(t,N,d);return A.top=gl(F.top,A.top),A.right=Df(F.right,A.right),A.bottom=Df(F.bottom,A.bottom),A.left=gl(F.left,A.left),A},Jj(t,o,d));return{width:I.right-I.left,height:I.bottom-I.top,x:I.left,y:I.top}}function pre(e){const{width:t,height:i}=W8(e);return{width:t,height:i}}function mre(e,t,i){const l=Ku(t),d=Ju(t),m=i==="fixed",v=Tm(e,!0,m,t);let o={scrollLeft:0,scrollTop:0};const I=$u(0);function A(){I.x=uD(d)}if(l||!l&&!m)if((ev(t)!=="body"||J1(d))&&(o=vC(t)),l){const $=Tm(t,!0,m,t);I.x=$.x+t.clientLeft,I.y=$.y+t.clientTop}else d&&A();m&&!l&&d&&A();const N=d&&!l&&!m?Z8(d,o):$u(0),F=v.left+o.scrollLeft-I.x-N.x,z=v.top+o.scrollTop-I.y-N.y;return{x:F,y:z,width:v.width,height:v.height}}function H2(e){return iu(e).position==="static"}function eB(e,t){if(!Ku(e)||iu(e).position==="fixed")return null;if(t)return t(e);let i=e.offsetParent;return Ju(e)===i&&(i=i.ownerDocument.body),i}function X8(e,t){const i=xl(e);if(yC(e))return i;if(!Ku(e)){let d=Nf(e);for(;d&&!Oy(d);){if(nu(d)&&!H2(d))return d;d=Nf(d)}return i}let l=eB(e,t);for(;l&&Yie(l)&&H2(l);)l=eB(l,t);return l&&Oy(l)&&H2(l)&&!aD(l)?i:l||nre(e)||i}const gre=async function(e){const t=this.getOffsetParent||X8,i=this.getDimensions,l=await i(e.floating);return{reference:mre(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:l.width,height:l.height}}};function _re(e){return iu(e).direction==="rtl"}const yre={convertOffsetParentRelativeRectToViewportRelativeRect:ore,getDocumentElement:Ju,getClippingRect:fre,getOffsetParent:X8,getElementRects:gre,getClientRects:are,getDimensions:pre,getScale:dy,isElement:nu,isRTL:_re};function Y8(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function vre(e,t){let i=null,l;const d=Ju(e);function m(){var o;clearTimeout(l),(o=i)==null||o.disconnect(),i=null}function v(o,I){o===void 0&&(o=!1),I===void 0&&(I=1),m();const A=e.getBoundingClientRect(),{left:N,top:F,width:z,height:$}=A;if(o||t(),!z||!$)return;const J=BT(F),H=BT(d.clientWidth-(N+z)),re=BT(d.clientHeight-(F+$)),Q=BT(N),ie={rootMargin:-J+"px "+-H+"px "+-re+"px "+-Q+"px",threshold:gl(0,Df(1,I))||1};let ue=!0;function xe(Oe){const ze=Oe[0].intersectionRatio;if(ze!==I){if(!ue)return v();ze?v(!1,ze):l=setTimeout(()=>{v(!1,1e-7)},1e3)}ze===1&&!Y8(A,e.getBoundingClientRect())&&v(),ue=!1}try{i=new IntersectionObserver(xe,{...ie,root:d.ownerDocument})}catch{i=new IntersectionObserver(xe,ie)}i.observe(e)}return v(!0),m}function xre(e,t,i,l){l===void 0&&(l={});const{ancestorScroll:d=!0,ancestorResize:m=!0,elementResize:v=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:I=!1}=l,A=cD(e),N=d||m?[...A?x1(A):[],...x1(t)]:[];N.forEach(Q=>{d&&Q.addEventListener("scroll",i,{passive:!0}),m&&Q.addEventListener("resize",i)});const F=A&&o?vre(A,i):null;let z=-1,$=null;v&&($=new ResizeObserver(Q=>{let[ee]=Q;ee&&ee.target===A&&$&&($.unobserve(t),cancelAnimationFrame(z),z=requestAnimationFrame(()=>{var ie;(ie=$)==null||ie.observe(t)})),i()}),A&&!I&&$.observe(A),$.observe(t));let J,H=I?Tm(e):null;I&&re();function re(){const Q=Tm(e);H&&!Y8(H,Q)&&i(),H=Q,J=requestAnimationFrame(re)}return i(),()=>{var Q;N.forEach(ee=>{d&&ee.removeEventListener("scroll",i),m&&ee.removeEventListener("resize",i)}),F==null||F(),(Q=$)==null||Q.disconnect(),$=null,I&&cancelAnimationFrame(J)}}const bre=Hie,wre=Wie,Tre=Uie,Ere=Zie,Sre=$ie,tB=Vie,Cre=qie,Ire=(e,t,i)=>{const l=new Map,d={platform:yre,...i},m={...d.platform,_c:l};return Bie(e,t,{...d,platform:m})};var Are=typeof document<"u",Pre=function(){},yE=Are?q.useLayoutEffect:Pre;function lS(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let i,l,d;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(i=e.length,i!==t.length)return!1;for(l=i;l--!==0;)if(!lS(e[l],t[l]))return!1;return!0}if(d=Object.keys(e),i=d.length,i!==Object.keys(t).length)return!1;for(l=i;l--!==0;)if(!{}.hasOwnProperty.call(t,d[l]))return!1;for(l=i;l--!==0;){const m=d[l];if(!(m==="_owner"&&e.$$typeof)&&!lS(e[m],t[m]))return!1}return!0}return e!==e&&t!==t}function Q8(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function nB(e,t){const i=Q8(e);return Math.round(t*i)/i}function W2(e){const t=q.useRef(e);return yE(()=>{t.current=e}),t}function Rre(e){e===void 0&&(e={});const{placement:t="bottom",strategy:i="absolute",middleware:l=[],platform:d,elements:{reference:m,floating:v}={},transform:o=!0,whileElementsMounted:I,open:A}=e,[N,F]=q.useState({x:0,y:0,strategy:i,placement:t,middlewareData:{},isPositioned:!1}),[z,$]=q.useState(l);lS(z,l)||$(l);const[J,H]=q.useState(null),[re,Q]=q.useState(null),ee=q.useCallback(et=>{et!==Oe.current&&(Oe.current=et,H(et))},[]),ie=q.useCallback(et=>{et!==ze.current&&(ze.current=et,Q(et))},[]),ue=m||J,xe=v||re,Oe=q.useRef(null),ze=q.useRef(null),Be=q.useRef(N),ot=I!=null,Et=W2(I),Zt=W2(d),at=W2(A),zt=q.useCallback(()=>{if(!Oe.current||!ze.current)return;const et={placement:t,strategy:i,middleware:z};Zt.current&&(et.platform=Zt.current),Ire(Oe.current,ze.current,et).then(Ct=>{const en={...Ct,isPositioned:at.current!==!1};Kt.current&&!lS(Be.current,en)&&(Be.current=en,Om.flushSync(()=>{F(en)}))})},[z,t,i,Zt,at]);yE(()=>{A===!1&&Be.current.isPositioned&&(Be.current.isPositioned=!1,F(et=>({...et,isPositioned:!1})))},[A]);const Kt=q.useRef(!1);yE(()=>(Kt.current=!0,()=>{Kt.current=!1}),[]),yE(()=>{if(ue&&(Oe.current=ue),xe&&(ze.current=xe),ue&&xe){if(Et.current)return Et.current(ue,xe,zt);zt()}},[ue,xe,zt,Et,ot]);const nn=q.useMemo(()=>({reference:Oe,floating:ze,setReference:ee,setFloating:ie}),[ee,ie]),Wt=q.useMemo(()=>({reference:ue,floating:xe}),[ue,xe]),Ke=q.useMemo(()=>{const et={position:i,left:0,top:0};if(!Wt.floating)return et;const Ct=nB(Wt.floating,N.x),en=nB(Wt.floating,N.y);return o?{...et,transform:"translate("+Ct+"px, "+en+"px)",...Q8(Wt.floating)>=1.5&&{willChange:"transform"}}:{position:i,left:Ct,top:en}},[i,o,Wt.floating,N.x,N.y]);return q.useMemo(()=>({...N,update:zt,refs:nn,elements:Wt,floatingStyles:Ke}),[N,zt,nn,Wt,Ke])}const Mre=e=>{function t(i){return{}.hasOwnProperty.call(i,"current")}return{name:"arrow",options:e,fn(i){const{element:l,padding:d}=typeof e=="function"?e(i):e;return l&&t(l)?l.current!=null?tB({element:l.current,padding:d}).fn(i):{}:l?tB({element:l,padding:d}).fn(i):{}}}},kre=(e,t)=>({...bre(e),options:[e,t]}),Dre=(e,t)=>({...wre(e),options:[e,t]}),Nre=(e,t)=>({...Cre(e),options:[e,t]}),Lre=(e,t)=>({...Tre(e),options:[e,t]}),Ore=(e,t)=>({...Ere(e),options:[e,t]}),Fre=(e,t)=>({...Sre(e),options:[e,t]}),zre=(e,t)=>({...Mre(e),options:[e,t]});var jre="Arrow",J8=q.forwardRef((e,t)=>{const{children:i,width:l=10,height:d=5,...m}=e;return E.jsx(Ki.svg,{...m,ref:t,width:l,height:d,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?i:E.jsx("polygon",{points:"0,0 30,0 15,10"})})});J8.displayName=jre;var Bre=J8;function e$(e){const[t,i]=q.useState(void 0);return Ao(()=>{if(e){i({width:e.offsetWidth,height:e.offsetHeight});const l=new ResizeObserver(d=>{if(!Array.isArray(d)||!d.length)return;const m=d[0];let v,o;if("borderBoxSize"in m){const I=m.borderBoxSize,A=Array.isArray(I)?I[0]:I;v=A.inlineSize,o=A.blockSize}else v=e.offsetWidth,o=e.offsetHeight;i({width:v,height:o})});return l.observe(e,{box:"border-box"}),()=>l.unobserve(e)}else i(void 0)},[e]),t}var dD="Popper",[t$,xC]=Qu(dD),[Vre,n$]=t$(dD),i$=e=>{const{__scopePopper:t,children:i}=e,[l,d]=q.useState(null);return E.jsx(Vre,{scope:t,anchor:l,onAnchorChange:d,children:i})};i$.displayName=dD;var r$="PopperAnchor",s$=q.forwardRef((e,t)=>{const{__scopePopper:i,virtualRef:l,...d}=e,m=n$(r$,i),v=q.useRef(null),o=zr(t,v);return q.useEffect(()=>{m.onAnchorChange((l==null?void 0:l.current)||v.current)}),l?null:E.jsx(Ki.div,{...d,ref:o})});s$.displayName=r$;var hD="PopperContent",[Ure,$re]=t$(hD),o$=q.forwardRef((e,t)=>{var _n,Rt,pn,Fn,si,$i;const{__scopePopper:i,side:l="bottom",sideOffset:d=0,align:m="center",alignOffset:v=0,arrowPadding:o=0,avoidCollisions:I=!0,collisionBoundary:A=[],collisionPadding:N=0,sticky:F="partial",hideWhenDetached:z=!1,updatePositionStrategy:$="optimized",onPlaced:J,...H}=e,re=n$(hD,i),[Q,ee]=q.useState(null),ie=zr(t,Mi=>ee(Mi)),[ue,xe]=q.useState(null),Oe=e$(ue),ze=(Oe==null?void 0:Oe.width)??0,Be=(Oe==null?void 0:Oe.height)??0,ot=l+(m!=="center"?"-"+m:""),Et=typeof N=="number"?N:{top:0,right:0,bottom:0,left:0,...N},Zt=Array.isArray(A)?A:[A],at=Zt.length>0,zt={padding:Et,boundary:Zt.filter(Hre),altBoundary:at},{refs:Kt,floatingStyles:nn,placement:Wt,isPositioned:Ke,middlewareData:et}=Rre({strategy:"fixed",placement:ot,whileElementsMounted:(...Mi)=>xre(...Mi,{animationFrame:$==="always"}),elements:{reference:re.anchor},middleware:[kre({mainAxis:d+Be,alignmentAxis:v}),I&&Dre({mainAxis:!0,crossAxis:!1,limiter:F==="partial"?Nre():void 0,...zt}),I&&Lre({...zt}),Ore({...zt,apply:({elements:Mi,rects:Ts,availableWidth:fo,availableHeight:ls})=>{const{width:Kr,height:xr}=Ts.reference,Sl=Mi.floating.style;Sl.setProperty("--radix-popper-available-width",`${fo}px`),Sl.setProperty("--radix-popper-available-height",`${ls}px`),Sl.setProperty("--radix-popper-anchor-width",`${Kr}px`),Sl.setProperty("--radix-popper-anchor-height",`${xr}px`)}}),ue&&zre({element:ue,padding:o}),Wre({arrowWidth:ze,arrowHeight:Be}),z&&Fre({strategy:"referenceHidden",...zt})]}),[Ct,en]=c$(Wt),Bn=tu(J);Ao(()=>{Ke&&(Bn==null||Bn())},[Ke,Bn]);const En=(_n=et.arrow)==null?void 0:_n.x,gn=(Rt=et.arrow)==null?void 0:Rt.y,qt=((pn=et.arrow)==null?void 0:pn.centerOffset)!==0,[Ji,Sr]=q.useState();return Ao(()=>{Q&&Sr(window.getComputedStyle(Q).zIndex)},[Q]),E.jsx("div",{ref:Kt.setFloating,"data-radix-popper-content-wrapper":"",style:{...nn,transform:Ke?nn.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Ji,"--radix-popper-transform-origin":[(Fn=et.transformOrigin)==null?void 0:Fn.x,(si=et.transformOrigin)==null?void 0:si.y].join(" "),...(($i=et.hide)==null?void 0:$i.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:E.jsx(Ure,{scope:i,placedSide:Ct,onArrowChange:xe,arrowX:En,arrowY:gn,shouldHideArrow:qt,children:E.jsx(Ki.div,{"data-side":Ct,"data-align":en,...H,ref:ie,style:{...H.style,animation:Ke?void 0:"none"}})})})});o$.displayName=hD;var a$="PopperArrow",Gre={top:"bottom",right:"left",bottom:"top",left:"right"},l$=q.forwardRef(function(t,i){const{__scopePopper:l,...d}=t,m=$re(a$,l),v=Gre[m.placedSide];return E.jsx("span",{ref:m.onArrowChange,style:{position:"absolute",left:m.arrowX,top:m.arrowY,[v]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[m.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[m.placedSide],visibility:m.shouldHideArrow?"hidden":void 0},children:E.jsx(Bre,{...d,ref:i,style:{...d.style,display:"block"}})})});l$.displayName=a$;function Hre(e){return e!==null}var Wre=e=>({name:"transformOrigin",options:e,fn(t){var re,Q,ee;const{placement:i,rects:l,middlewareData:d}=t,v=((re=d.arrow)==null?void 0:re.centerOffset)!==0,o=v?0:e.arrowWidth,I=v?0:e.arrowHeight,[A,N]=c$(i),F={start:"0%",center:"50%",end:"100%"}[N],z=(((Q=d.arrow)==null?void 0:Q.x)??0)+o/2,$=(((ee=d.arrow)==null?void 0:ee.y)??0)+I/2;let J="",H="";return A==="bottom"?(J=v?F:`${z}px`,H=`${-I}px`):A==="top"?(J=v?F:`${z}px`,H=`${l.floating.height+I}px`):A==="right"?(J=`${-I}px`,H=v?F:`${$}px`):A==="left"&&(J=`${l.floating.width+I}px`,H=v?F:`${$}px`),{data:{x:J,y:H}}}});function c$(e){const[t,i="center"]=e.split("-");return[t,i]}var qre=i$,u$=s$,d$=o$,h$=l$,[bC,Rbe]=Qu("Tooltip",[xC]),fD=xC(),f$="TooltipProvider",Zre=700,iB="tooltip.open",[Kre,p$]=bC(f$),m$=e=>{const{__scopeTooltip:t,delayDuration:i=Zre,skipDelayDuration:l=300,disableHoverableContent:d=!1,children:m}=e,v=q.useRef(!0),o=q.useRef(!1),I=q.useRef(0);return q.useEffect(()=>{const A=I.current;return()=>window.clearTimeout(A)},[]),E.jsx(Kre,{scope:t,isOpenDelayedRef:v,delayDuration:i,onOpen:q.useCallback(()=>{window.clearTimeout(I.current),v.current=!1},[]),onClose:q.useCallback(()=>{window.clearTimeout(I.current),I.current=window.setTimeout(()=>v.current=!0,l)},[l]),isPointerInTransitRef:o,onPointerInTransitChange:q.useCallback(A=>{o.current=A},[]),disableHoverableContent:d,children:m})};m$.displayName=f$;var g$="Tooltip",[Mbe,wC]=bC(g$),jR="TooltipTrigger",Xre=q.forwardRef((e,t)=>{const{__scopeTooltip:i,...l}=e,d=wC(jR,i),m=p$(jR,i),v=fD(i),o=q.useRef(null),I=zr(t,o,d.onTriggerChange),A=q.useRef(!1),N=q.useRef(!1),F=q.useCallback(()=>A.current=!1,[]);return q.useEffect(()=>()=>document.removeEventListener("pointerup",F),[F]),E.jsx(u$,{asChild:!0,...v,children:E.jsx(Ki.button,{"aria-describedby":d.open?d.contentId:void 0,"data-state":d.stateAttribute,...l,ref:I,onPointerMove:Li(e.onPointerMove,z=>{z.pointerType!=="touch"&&!N.current&&!m.isPointerInTransitRef.current&&(d.onTriggerEnter(),N.current=!0)}),onPointerLeave:Li(e.onPointerLeave,()=>{d.onTriggerLeave(),N.current=!1}),onPointerDown:Li(e.onPointerDown,()=>{d.open&&d.onClose(),A.current=!0,document.addEventListener("pointerup",F,{once:!0})}),onFocus:Li(e.onFocus,()=>{A.current||d.onOpen()}),onBlur:Li(e.onBlur,d.onClose),onClick:Li(e.onClick,d.onClose)})})});Xre.displayName=jR;var Yre="TooltipPortal",[kbe,Qre]=bC(Yre,{forceMount:void 0}),Fy="TooltipContent",_$=q.forwardRef((e,t)=>{const i=Qre(Fy,e.__scopeTooltip),{forceMount:l=i.forceMount,side:d="top",...m}=e,v=wC(Fy,e.__scopeTooltip);return E.jsx(Fm,{present:l||v.open,children:v.disableHoverableContent?E.jsx(y$,{side:d,...m,ref:t}):E.jsx(Jre,{side:d,...m,ref:t})})}),Jre=q.forwardRef((e,t)=>{const i=wC(Fy,e.__scopeTooltip),l=p$(Fy,e.__scopeTooltip),d=q.useRef(null),m=zr(t,d),[v,o]=q.useState(null),{trigger:I,onClose:A}=i,N=d.current,{onPointerInTransitChange:F}=l,z=q.useCallback(()=>{o(null),F(!1)},[F]),$=q.useCallback((J,H)=>{const re=J.currentTarget,Q={x:J.clientX,y:J.clientY},ee=rse(Q,re.getBoundingClientRect()),ie=sse(Q,ee),ue=ose(H.getBoundingClientRect()),xe=lse([...ie,...ue]);o(xe),F(!0)},[F]);return q.useEffect(()=>()=>z(),[z]),q.useEffect(()=>{if(I&&N){const J=re=>$(re,N),H=re=>$(re,I);return I.addEventListener("pointerleave",J),N.addEventListener("pointerleave",H),()=>{I.removeEventListener("pointerleave",J),N.removeEventListener("pointerleave",H)}}},[I,N,$,z]),q.useEffect(()=>{if(v){const J=H=>{const re=H.target,Q={x:H.clientX,y:H.clientY},ee=(I==null?void 0:I.contains(re))||(N==null?void 0:N.contains(re)),ie=!ase(Q,v);ee?z():ie&&(z(),A())};return document.addEventListener("pointermove",J),()=>document.removeEventListener("pointermove",J)}},[I,N,v,A,z]),E.jsx(y$,{...e,ref:m})}),[ese,tse]=bC(g$,{isInside:!1}),nse=Z6("TooltipContent"),y$=q.forwardRef((e,t)=>{const{__scopeTooltip:i,children:l,"aria-label":d,onEscapeKeyDown:m,onPointerDownOutside:v,...o}=e,I=wC(Fy,i),A=fD(i),{onClose:N}=I;return q.useEffect(()=>(document.addEventListener(iB,N),()=>document.removeEventListener(iB,N)),[N]),q.useEffect(()=>{if(I.trigger){const F=z=>{const $=z.target;$!=null&&$.contains(I.trigger)&&N()};return window.addEventListener("scroll",F,{capture:!0}),()=>window.removeEventListener("scroll",F,{capture:!0})}},[I.trigger,N]),E.jsx(Y1,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:m,onPointerDownOutside:v,onFocusOutside:F=>F.preventDefault(),onDismiss:N,children:E.jsxs(d$,{"data-state":I.stateAttribute,...A,...o,ref:t,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[E.jsx(nse,{children:l}),E.jsx(ese,{scope:i,isInside:!0,children:E.jsx(Tte,{id:I.contentId,role:"tooltip",children:d||l})})]})})});_$.displayName=Fy;var v$="TooltipArrow",ise=q.forwardRef((e,t)=>{const{__scopeTooltip:i,...l}=e,d=fD(i);return tse(v$,i).isInside?null:E.jsx(h$,{...d,...l,ref:t})});ise.displayName=v$;function rse(e,t){const i=Math.abs(t.top-e.y),l=Math.abs(t.bottom-e.y),d=Math.abs(t.right-e.x),m=Math.abs(t.left-e.x);switch(Math.min(i,l,d,m)){case m:return"left";case d:return"right";case i:return"top";case l:return"bottom";default:throw new Error("unreachable")}}function sse(e,t,i=5){const l=[];switch(t){case"top":l.push({x:e.x-i,y:e.y+i},{x:e.x+i,y:e.y+i});break;case"bottom":l.push({x:e.x-i,y:e.y-i},{x:e.x+i,y:e.y-i});break;case"left":l.push({x:e.x+i,y:e.y-i},{x:e.x+i,y:e.y+i});break;case"right":l.push({x:e.x-i,y:e.y-i},{x:e.x-i,y:e.y+i});break}return l}function ose(e){const{top:t,right:i,bottom:l,left:d}=e;return[{x:d,y:t},{x:i,y:t},{x:i,y:l},{x:d,y:l}]}function ase(e,t){const{x:i,y:l}=e;let d=!1;for(let m=0,v=t.length-1;m<t.length;v=m++){const o=t[m],I=t[v],A=o.x,N=o.y,F=I.x,z=I.y;N>l!=z>l&&i<(F-A)*(l-N)/(z-N)+A&&(d=!d)}return d}function lse(e){const t=e.slice();return t.sort((i,l)=>i.x<l.x?-1:i.x>l.x?1:i.y<l.y?-1:i.y>l.y?1:0),cse(t)}function cse(e){if(e.length<=1)return e.slice();const t=[];for(let l=0;l<e.length;l++){const d=e[l];for(;t.length>=2;){const m=t[t.length-1],v=t[t.length-2];if((m.x-v.x)*(d.y-v.y)>=(m.y-v.y)*(d.x-v.x))t.pop();else break}t.push(d)}t.pop();const i=[];for(let l=e.length-1;l>=0;l--){const d=e[l];for(;i.length>=2;){const m=i[i.length-1],v=i[i.length-2];if((m.x-v.x)*(d.y-v.y)>=(m.y-v.y)*(d.x-v.x))i.pop();else break}i.push(d)}return i.pop(),t.length===1&&i.length===1&&t[0].x===i[0].x&&t[0].y===i[0].y?t:t.concat(i)}var use=m$,x$=_$;const dse=use,hse=q.forwardRef(({className:e,sideOffset:t=4,...i},l)=>E.jsx(x$,{ref:l,sideOffset:t,className:Xn("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...i}));hse.displayName=x$.displayName;var TC=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},EC=typeof window>"u"||"Deno"in globalThis;function Fc(){}function fse(e,t){return typeof e=="function"?e(t):e}function pse(e){return typeof e=="number"&&e>=0&&e!==1/0}function mse(e,t){return Math.max(e+(t||0)-Date.now(),0)}function BR(e,t){return typeof e=="function"?e(t):e}function gse(e,t){return typeof e=="function"?e(t):e}function rB(e,t){const{type:i="all",exact:l,fetchStatus:d,predicate:m,queryKey:v,stale:o}=e;if(v){if(l){if(t.queryHash!==pD(v,t.options))return!1}else if(!w1(t.queryKey,v))return!1}if(i!=="all"){const I=t.isActive();if(i==="active"&&!I||i==="inactive"&&I)return!1}return!(typeof o=="boolean"&&t.isStale()!==o||d&&d!==t.state.fetchStatus||m&&!m(t))}function sB(e,t){const{exact:i,status:l,predicate:d,mutationKey:m}=e;if(m){if(!t.options.mutationKey)return!1;if(i){if(b1(t.options.mutationKey)!==b1(m))return!1}else if(!w1(t.options.mutationKey,m))return!1}return!(l&&t.state.status!==l||d&&!d(t))}function pD(e,t){return((t==null?void 0:t.queryKeyHashFn)||b1)(e)}function b1(e){return JSON.stringify(e,(t,i)=>VR(i)?Object.keys(i).sort().reduce((l,d)=>(l[d]=i[d],l),{}):i)}function w1(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(i=>w1(e[i],t[i])):!1}function b$(e,t){if(e===t)return e;const i=oB(e)&&oB(t);if(i||VR(e)&&VR(t)){const l=i?e:Object.keys(e),d=l.length,m=i?t:Object.keys(t),v=m.length,o=i?[]:{},I=new Set(l);let A=0;for(let N=0;N<v;N++){const F=i?N:m[N];(!i&&I.has(F)||i)&&e[F]===void 0&&t[F]===void 0?(o[F]=void 0,A++):(o[F]=b$(e[F],t[F]),o[F]===e[F]&&e[F]!==void 0&&A++)}return d===v&&A===d?e:o}return t}function oB(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function VR(e){if(!aB(e))return!1;const t=e.constructor;if(t===void 0)return!0;const i=t.prototype;return!(!aB(i)||!i.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function aB(e){return Object.prototype.toString.call(e)==="[object Object]"}function _se(e){return new Promise(t=>{setTimeout(t,e)})}function yse(e,t,i){return typeof i.structuralSharing=="function"?i.structuralSharing(e,t):i.structuralSharing!==!1?b$(e,t):t}function vse(e,t,i=0){const l=[...e,t];return i&&l.length>i?l.slice(1):l}function xse(e,t,i=0){const l=[t,...e];return i&&l.length>i?l.slice(0,-1):l}var mD=Symbol();function w$(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===mD?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}var am,tf,xy,EV,bse=(EV=class extends TC{constructor(){super();Rr(this,am);Rr(this,tf);Rr(this,xy);Ui(this,xy,t=>{if(!EC&&window.addEventListener){const i=()=>t();return window.addEventListener("visibilitychange",i,!1),()=>{window.removeEventListener("visibilitychange",i)}}})}onSubscribe(){Vt(this,tf)||this.setEventListener(Vt(this,xy))}onUnsubscribe(){var t;this.hasListeners()||((t=Vt(this,tf))==null||t.call(this),Ui(this,tf,void 0))}setEventListener(t){var i;Ui(this,xy,t),(i=Vt(this,tf))==null||i.call(this),Ui(this,tf,t(l=>{typeof l=="boolean"?this.setFocused(l):this.onFocus()}))}setFocused(t){Vt(this,am)!==t&&(Ui(this,am,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(i=>{i(t)})}isFocused(){var t;return typeof Vt(this,am)=="boolean"?Vt(this,am):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},am=new WeakMap,tf=new WeakMap,xy=new WeakMap,EV),T$=new bse,by,nf,wy,SV,wse=(SV=class extends TC{constructor(){super();Rr(this,by,!0);Rr(this,nf);Rr(this,wy);Ui(this,wy,t=>{if(!EC&&window.addEventListener){const i=()=>t(!0),l=()=>t(!1);return window.addEventListener("online",i,!1),window.addEventListener("offline",l,!1),()=>{window.removeEventListener("online",i),window.removeEventListener("offline",l)}}})}onSubscribe(){Vt(this,nf)||this.setEventListener(Vt(this,wy))}onUnsubscribe(){var t;this.hasListeners()||((t=Vt(this,nf))==null||t.call(this),Ui(this,nf,void 0))}setEventListener(t){var i;Ui(this,wy,t),(i=Vt(this,nf))==null||i.call(this),Ui(this,nf,t(this.setOnline.bind(this)))}setOnline(t){Vt(this,by)!==t&&(Ui(this,by,t),this.listeners.forEach(l=>{l(t)}))}isOnline(){return Vt(this,by)}},by=new WeakMap,nf=new WeakMap,wy=new WeakMap,SV),cS=new wse;function Tse(){let e,t;const i=new Promise((d,m)=>{e=d,t=m});i.status="pending",i.catch(()=>{});function l(d){Object.assign(i,d),delete i.resolve,delete i.reject}return i.resolve=d=>{l({status:"fulfilled",value:d}),e(d)},i.reject=d=>{l({status:"rejected",reason:d}),t(d)},i}function Ese(e){return Math.min(1e3*2**e,3e4)}function E$(e){return(e??"online")==="online"?cS.isOnline():!0}var S$=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function q2(e){return e instanceof S$}function C$(e){let t=!1,i=0,l=!1,d;const m=Tse(),v=H=>{var re;l||(z(new S$(H)),(re=e.abort)==null||re.call(e))},o=()=>{t=!0},I=()=>{t=!1},A=()=>T$.isFocused()&&(e.networkMode==="always"||cS.isOnline())&&e.canRun(),N=()=>E$(e.networkMode)&&e.canRun(),F=H=>{var re;l||(l=!0,(re=e.onSuccess)==null||re.call(e,H),d==null||d(),m.resolve(H))},z=H=>{var re;l||(l=!0,(re=e.onError)==null||re.call(e,H),d==null||d(),m.reject(H))},$=()=>new Promise(H=>{var re;d=Q=>{(l||A())&&H(Q)},(re=e.onPause)==null||re.call(e)}).then(()=>{var H;d=void 0,l||(H=e.onContinue)==null||H.call(e)}),J=()=>{if(l)return;let H;const re=i===0?e.initialPromise:void 0;try{H=re??e.fn()}catch(Q){H=Promise.reject(Q)}Promise.resolve(H).then(F).catch(Q=>{var Oe;if(l)return;const ee=e.retry??(EC?0:3),ie=e.retryDelay??Ese,ue=typeof ie=="function"?ie(i,Q):ie,xe=ee===!0||typeof ee=="number"&&i<ee||typeof ee=="function"&&ee(i,Q);if(t||!xe){z(Q);return}i++,(Oe=e.onFail)==null||Oe.call(e,i,Q),_se(ue).then(()=>A()?void 0:$()).then(()=>{t?z(Q):J()})})};return{promise:m,cancel:v,continue:()=>(d==null||d(),m),cancelRetry:o,continueRetry:I,canStart:N,start:()=>(N()?J():$().then(J),m)}}var Sse=e=>setTimeout(e,0);function Cse(){let e=[],t=0,i=o=>{o()},l=o=>{o()},d=Sse;const m=o=>{t?e.push(o):d(()=>{i(o)})},v=()=>{const o=e;e=[],o.length&&d(()=>{l(()=>{o.forEach(I=>{i(I)})})})};return{batch:o=>{let I;t++;try{I=o()}finally{t--,t||v()}return I},batchCalls:o=>(...I)=>{m(()=>{o(...I)})},schedule:m,setNotifyFunction:o=>{i=o},setBatchNotifyFunction:o=>{l=o},setScheduler:o=>{d=o}}}var pa=Cse(),lm,CV,I$=(CV=class{constructor(){Rr(this,lm)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),pse(this.gcTime)&&Ui(this,lm,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(EC?1/0:5*60*1e3))}clearGcTimeout(){Vt(this,lm)&&(clearTimeout(Vt(this,lm)),Ui(this,lm,void 0))}},lm=new WeakMap,CV),Ty,cm,Wl,um,Xo,$1,dm,zc,Md,IV,Ise=(IV=class extends I${constructor(t){super();Rr(this,zc);Rr(this,Ty);Rr(this,cm);Rr(this,Wl);Rr(this,um);Rr(this,Xo);Rr(this,$1);Rr(this,dm);Ui(this,dm,!1),Ui(this,$1,t.defaultOptions),this.setOptions(t.options),this.observers=[],Ui(this,um,t.client),Ui(this,Wl,Vt(this,um).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,Ui(this,Ty,Pse(this.options)),this.state=t.state??Vt(this,Ty),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=Vt(this,Xo))==null?void 0:t.promise}setOptions(t){this.options={...Vt(this,$1),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Vt(this,Wl).remove(this)}setData(t,i){const l=yse(this.state.data,t,this.options);return qo(this,zc,Md).call(this,{data:l,type:"success",dataUpdatedAt:i==null?void 0:i.updatedAt,manual:i==null?void 0:i.manual}),l}setState(t,i){qo(this,zc,Md).call(this,{type:"setState",state:t,setStateOptions:i})}cancel(t){var l,d;const i=(l=Vt(this,Xo))==null?void 0:l.promise;return(d=Vt(this,Xo))==null||d.cancel(t),i?i.then(Fc).catch(Fc):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Vt(this,Ty))}isActive(){return this.observers.some(t=>gse(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===mD||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>BR(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!mse(this.state.dataUpdatedAt,t)}onFocus(){var i;const t=this.observers.find(l=>l.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(i=Vt(this,Xo))==null||i.continue()}onOnline(){var i;const t=this.observers.find(l=>l.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(i=Vt(this,Xo))==null||i.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),Vt(this,Wl).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(i=>i!==t),this.observers.length||(Vt(this,Xo)&&(Vt(this,dm)?Vt(this,Xo).cancel({revert:!0}):Vt(this,Xo).cancelRetry()),this.scheduleGc()),Vt(this,Wl).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||qo(this,zc,Md).call(this,{type:"invalidate"})}fetch(t,i){var A,N,F;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(i!=null&&i.cancelRefetch))this.cancel({silent:!0});else if(Vt(this,Xo))return Vt(this,Xo).continueRetry(),Vt(this,Xo).promise}if(t&&this.setOptions(t),!this.options.queryFn){const z=this.observers.find($=>$.options.queryFn);z&&this.setOptions(z.options)}const l=new AbortController,d=z=>{Object.defineProperty(z,"signal",{enumerable:!0,get:()=>(Ui(this,dm,!0),l.signal)})},m=()=>{const z=w$(this.options,i),J=(()=>{const H={client:Vt(this,um),queryKey:this.queryKey,meta:this.meta};return d(H),H})();return Ui(this,dm,!1),this.options.persister?this.options.persister(z,J,this):z(J)},o=(()=>{const z={fetchOptions:i,options:this.options,queryKey:this.queryKey,client:Vt(this,um),state:this.state,fetchFn:m};return d(z),z})();(A=this.options.behavior)==null||A.onFetch(o,this),Ui(this,cm,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((N=o.fetchOptions)==null?void 0:N.meta))&&qo(this,zc,Md).call(this,{type:"fetch",meta:(F=o.fetchOptions)==null?void 0:F.meta});const I=z=>{var $,J,H,re;q2(z)&&z.silent||qo(this,zc,Md).call(this,{type:"error",error:z}),q2(z)||((J=($=Vt(this,Wl).config).onError)==null||J.call($,z,this),(re=(H=Vt(this,Wl).config).onSettled)==null||re.call(H,this.state.data,z,this)),this.scheduleGc()};return Ui(this,Xo,C$({initialPromise:i==null?void 0:i.initialPromise,fn:o.fetchFn,abort:l.abort.bind(l),onSuccess:z=>{var $,J,H,re;if(z===void 0){I(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(z)}catch(Q){I(Q);return}(J=($=Vt(this,Wl).config).onSuccess)==null||J.call($,z,this),(re=(H=Vt(this,Wl).config).onSettled)==null||re.call(H,z,this.state.error,this),this.scheduleGc()},onError:I,onFail:(z,$)=>{qo(this,zc,Md).call(this,{type:"failed",failureCount:z,error:$})},onPause:()=>{qo(this,zc,Md).call(this,{type:"pause"})},onContinue:()=>{qo(this,zc,Md).call(this,{type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0})),Vt(this,Xo).start()}},Ty=new WeakMap,cm=new WeakMap,Wl=new WeakMap,um=new WeakMap,Xo=new WeakMap,$1=new WeakMap,dm=new WeakMap,zc=new WeakSet,Md=function(t){const i=l=>{switch(t.type){case"failed":return{...l,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...l,fetchStatus:"paused"};case"continue":return{...l,fetchStatus:"fetching"};case"fetch":return{...l,...Ase(l.data,this.options),fetchMeta:t.meta??null};case"success":return Ui(this,cm,void 0),{...l,data:t.data,dataUpdateCount:l.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const d=t.error;return q2(d)&&d.revert&&Vt(this,cm)?{...Vt(this,cm),fetchStatus:"idle"}:{...l,error:d,errorUpdateCount:l.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:l.fetchFailureCount+1,fetchFailureReason:d,fetchStatus:"idle",status:"error"};case"invalidate":return{...l,isInvalidated:!0};case"setState":return{...l,...t.state}}};this.state=i(this.state),pa.batch(()=>{this.observers.forEach(l=>{l.onQueryUpdate()}),Vt(this,Wl).notify({query:this,type:"updated",action:t})})},IV);function Ase(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:E$(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function Pse(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,i=t!==void 0,l=i?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:i?l??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:i?"success":"pending",fetchStatus:"idle"}}var Nu,AV,Rse=(AV=class extends TC{constructor(t={}){super();Rr(this,Nu);this.config=t,Ui(this,Nu,new Map)}build(t,i,l){const d=i.queryKey,m=i.queryHash??pD(d,i);let v=this.get(m);return v||(v=new Ise({client:t,queryKey:d,queryHash:m,options:t.defaultQueryOptions(i),state:l,defaultOptions:t.getQueryDefaults(d)}),this.add(v)),v}add(t){Vt(this,Nu).has(t.queryHash)||(Vt(this,Nu).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const i=Vt(this,Nu).get(t.queryHash);i&&(t.destroy(),i===t&&Vt(this,Nu).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){pa.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return Vt(this,Nu).get(t)}getAll(){return[...Vt(this,Nu).values()]}find(t){const i={exact:!0,...t};return this.getAll().find(l=>rB(i,l))}findAll(t={}){const i=this.getAll();return Object.keys(t).length>0?i.filter(l=>rB(t,l)):i}notify(t){pa.batch(()=>{this.listeners.forEach(i=>{i(t)})})}onFocus(){pa.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){pa.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},Nu=new WeakMap,AV),Lu,ha,hm,Ou,Gh,PV,Mse=(PV=class extends I${constructor(t){super();Rr(this,Ou);Rr(this,Lu);Rr(this,ha);Rr(this,hm);this.mutationId=t.mutationId,Ui(this,ha,t.mutationCache),Ui(this,Lu,[]),this.state=t.state||kse(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){Vt(this,Lu).includes(t)||(Vt(this,Lu).push(t),this.clearGcTimeout(),Vt(this,ha).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){Ui(this,Lu,Vt(this,Lu).filter(i=>i!==t)),this.scheduleGc(),Vt(this,ha).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){Vt(this,Lu).length||(this.state.status==="pending"?this.scheduleGc():Vt(this,ha).remove(this))}continue(){var t;return((t=Vt(this,hm))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var m,v,o,I,A,N,F,z,$,J,H,re,Q,ee,ie,ue,xe,Oe,ze,Be;const i=()=>{qo(this,Ou,Gh).call(this,{type:"continue"})};Ui(this,hm,C$({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(ot,Et)=>{qo(this,Ou,Gh).call(this,{type:"failed",failureCount:ot,error:Et})},onPause:()=>{qo(this,Ou,Gh).call(this,{type:"pause"})},onContinue:i,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Vt(this,ha).canRun(this)}));const l=this.state.status==="pending",d=!Vt(this,hm).canStart();try{if(l)i();else{qo(this,Ou,Gh).call(this,{type:"pending",variables:t,isPaused:d}),await((v=(m=Vt(this,ha).config).onMutate)==null?void 0:v.call(m,t,this));const Et=await((I=(o=this.options).onMutate)==null?void 0:I.call(o,t));Et!==this.state.context&&qo(this,Ou,Gh).call(this,{type:"pending",context:Et,variables:t,isPaused:d})}const ot=await Vt(this,hm).start();return await((N=(A=Vt(this,ha).config).onSuccess)==null?void 0:N.call(A,ot,t,this.state.context,this)),await((z=(F=this.options).onSuccess)==null?void 0:z.call(F,ot,t,this.state.context)),await((J=($=Vt(this,ha).config).onSettled)==null?void 0:J.call($,ot,null,this.state.variables,this.state.context,this)),await((re=(H=this.options).onSettled)==null?void 0:re.call(H,ot,null,t,this.state.context)),qo(this,Ou,Gh).call(this,{type:"success",data:ot}),ot}catch(ot){try{throw await((ee=(Q=Vt(this,ha).config).onError)==null?void 0:ee.call(Q,ot,t,this.state.context,this)),await((ue=(ie=this.options).onError)==null?void 0:ue.call(ie,ot,t,this.state.context)),await((Oe=(xe=Vt(this,ha).config).onSettled)==null?void 0:Oe.call(xe,void 0,ot,this.state.variables,this.state.context,this)),await((Be=(ze=this.options).onSettled)==null?void 0:Be.call(ze,void 0,ot,t,this.state.context)),ot}finally{qo(this,Ou,Gh).call(this,{type:"error",error:ot})}}finally{Vt(this,ha).runNext(this)}}},Lu=new WeakMap,ha=new WeakMap,hm=new WeakMap,Ou=new WeakSet,Gh=function(t){const i=l=>{switch(t.type){case"failed":return{...l,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...l,isPaused:!0};case"continue":return{...l,isPaused:!1};case"pending":return{...l,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...l,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...l,data:void 0,error:t.error,failureCount:l.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=i(this.state),pa.batch(()=>{Vt(this,Lu).forEach(l=>{l.onMutationUpdate(t)}),Vt(this,ha).notify({mutation:this,type:"updated",action:t})})},PV);function kse(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Nd,jc,G1,RV,Dse=(RV=class extends TC{constructor(t={}){super();Rr(this,Nd);Rr(this,jc);Rr(this,G1);this.config=t,Ui(this,Nd,new Set),Ui(this,jc,new Map),Ui(this,G1,0)}build(t,i,l){const d=new Mse({mutationCache:this,mutationId:++vT(this,G1)._,options:t.defaultMutationOptions(i),state:l});return this.add(d),d}add(t){Vt(this,Nd).add(t);const i=VT(t);if(typeof i=="string"){const l=Vt(this,jc).get(i);l?l.push(t):Vt(this,jc).set(i,[t])}this.notify({type:"added",mutation:t})}remove(t){if(Vt(this,Nd).delete(t)){const i=VT(t);if(typeof i=="string"){const l=Vt(this,jc).get(i);if(l)if(l.length>1){const d=l.indexOf(t);d!==-1&&l.splice(d,1)}else l[0]===t&&Vt(this,jc).delete(i)}}this.notify({type:"removed",mutation:t})}canRun(t){const i=VT(t);if(typeof i=="string"){const l=Vt(this,jc).get(i),d=l==null?void 0:l.find(m=>m.state.status==="pending");return!d||d===t}else return!0}runNext(t){var l;const i=VT(t);if(typeof i=="string"){const d=(l=Vt(this,jc).get(i))==null?void 0:l.find(m=>m!==t&&m.state.isPaused);return(d==null?void 0:d.continue())??Promise.resolve()}else return Promise.resolve()}clear(){pa.batch(()=>{Vt(this,Nd).forEach(t=>{this.notify({type:"removed",mutation:t})}),Vt(this,Nd).clear(),Vt(this,jc).clear()})}getAll(){return Array.from(Vt(this,Nd))}find(t){const i={exact:!0,...t};return this.getAll().find(l=>sB(i,l))}findAll(t={}){return this.getAll().filter(i=>sB(t,i))}notify(t){pa.batch(()=>{this.listeners.forEach(i=>{i(t)})})}resumePausedMutations(){const t=this.getAll().filter(i=>i.state.isPaused);return pa.batch(()=>Promise.all(t.map(i=>i.continue().catch(Fc))))}},Nd=new WeakMap,jc=new WeakMap,G1=new WeakMap,RV);function VT(e){var t;return(t=e.options.scope)==null?void 0:t.id}function lB(e){return{onFetch:(t,i)=>{var N,F,z,$,J;const l=t.options,d=(z=(F=(N=t.fetchOptions)==null?void 0:N.meta)==null?void 0:F.fetchMore)==null?void 0:z.direction,m=(($=t.state.data)==null?void 0:$.pages)||[],v=((J=t.state.data)==null?void 0:J.pageParams)||[];let o={pages:[],pageParams:[]},I=0;const A=async()=>{let H=!1;const re=ie=>{Object.defineProperty(ie,"signal",{enumerable:!0,get:()=>(t.signal.aborted?H=!0:t.signal.addEventListener("abort",()=>{H=!0}),t.signal)})},Q=w$(t.options,t.fetchOptions),ee=async(ie,ue,xe)=>{if(H)return Promise.reject();if(ue==null&&ie.pages.length)return Promise.resolve(ie);const ze=(()=>{const Zt={client:t.client,queryKey:t.queryKey,pageParam:ue,direction:xe?"backward":"forward",meta:t.options.meta};return re(Zt),Zt})(),Be=await Q(ze),{maxPages:ot}=t.options,Et=xe?xse:vse;return{pages:Et(ie.pages,Be,ot),pageParams:Et(ie.pageParams,ue,ot)}};if(d&&m.length){const ie=d==="backward",ue=ie?Nse:cB,xe={pages:m,pageParams:v},Oe=ue(l,xe);o=await ee(xe,Oe,ie)}else{const ie=e??m.length;do{const ue=I===0?v[0]??l.initialPageParam:cB(l,o);if(I>0&&ue==null)break;o=await ee(o,ue),I++}while(I<ie)}return o};t.options.persister?t.fetchFn=()=>{var H,re;return(re=(H=t.options).persister)==null?void 0:re.call(H,A,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},i)}:t.fetchFn=A}}}function cB(e,{pages:t,pageParams:i}){const l=t.length-1;return t.length>0?e.getNextPageParam(t[l],t,i[l],i):void 0}function Nse(e,{pages:t,pageParams:i}){var l;return t.length>0?(l=e.getPreviousPageParam)==null?void 0:l.call(e,t[0],t,i[0],i):void 0}var Ns,rf,sf,Ey,Sy,of,Cy,Iy,MV,Lse=(MV=class{constructor(e={}){Rr(this,Ns);Rr(this,rf);Rr(this,sf);Rr(this,Ey);Rr(this,Sy);Rr(this,of);Rr(this,Cy);Rr(this,Iy);Ui(this,Ns,e.queryCache||new Rse),Ui(this,rf,e.mutationCache||new Dse),Ui(this,sf,e.defaultOptions||{}),Ui(this,Ey,new Map),Ui(this,Sy,new Map),Ui(this,of,0)}mount(){vT(this,of)._++,Vt(this,of)===1&&(Ui(this,Cy,T$.subscribe(async e=>{e&&(await this.resumePausedMutations(),Vt(this,Ns).onFocus())})),Ui(this,Iy,cS.subscribe(async e=>{e&&(await this.resumePausedMutations(),Vt(this,Ns).onOnline())})))}unmount(){var e,t;vT(this,of)._--,Vt(this,of)===0&&((e=Vt(this,Cy))==null||e.call(this),Ui(this,Cy,void 0),(t=Vt(this,Iy))==null||t.call(this),Ui(this,Iy,void 0))}isFetching(e){return Vt(this,Ns).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return Vt(this,rf).findAll({...e,status:"pending"}).length}getQueryData(e){var i;const t=this.defaultQueryOptions({queryKey:e});return(i=Vt(this,Ns).get(t.queryHash))==null?void 0:i.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),i=Vt(this,Ns).build(this,t),l=i.state.data;return l===void 0?this.fetchQuery(e):(e.revalidateIfStale&&i.isStaleByTime(BR(t.staleTime,i))&&this.prefetchQuery(t),Promise.resolve(l))}getQueriesData(e){return Vt(this,Ns).findAll(e).map(({queryKey:t,state:i})=>{const l=i.data;return[t,l]})}setQueryData(e,t,i){const l=this.defaultQueryOptions({queryKey:e}),d=Vt(this,Ns).get(l.queryHash),m=d==null?void 0:d.state.data,v=fse(t,m);if(v!==void 0)return Vt(this,Ns).build(this,l).setData(v,{...i,manual:!0})}setQueriesData(e,t,i){return pa.batch(()=>Vt(this,Ns).findAll(e).map(({queryKey:l})=>[l,this.setQueryData(l,t,i)]))}getQueryState(e){var i;const t=this.defaultQueryOptions({queryKey:e});return(i=Vt(this,Ns).get(t.queryHash))==null?void 0:i.state}removeQueries(e){const t=Vt(this,Ns);pa.batch(()=>{t.findAll(e).forEach(i=>{t.remove(i)})})}resetQueries(e,t){const i=Vt(this,Ns);return pa.batch(()=>(i.findAll(e).forEach(l=>{l.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const i={revert:!0,...t},l=pa.batch(()=>Vt(this,Ns).findAll(e).map(d=>d.cancel(i)));return Promise.all(l).then(Fc).catch(Fc)}invalidateQueries(e,t={}){return pa.batch(()=>(Vt(this,Ns).findAll(e).forEach(i=>{i.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const i={...t,cancelRefetch:t.cancelRefetch??!0},l=pa.batch(()=>Vt(this,Ns).findAll(e).filter(d=>!d.isDisabled()&&!d.isStatic()).map(d=>{let m=d.fetch(void 0,i);return i.throwOnError||(m=m.catch(Fc)),d.state.fetchStatus==="paused"?Promise.resolve():m}));return Promise.all(l).then(Fc)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const i=Vt(this,Ns).build(this,t);return i.isStaleByTime(BR(t.staleTime,i))?i.fetch(t):Promise.resolve(i.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Fc).catch(Fc)}fetchInfiniteQuery(e){return e.behavior=lB(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Fc).catch(Fc)}ensureInfiniteQueryData(e){return e.behavior=lB(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return cS.isOnline()?Vt(this,rf).resumePausedMutations():Promise.resolve()}getQueryCache(){return Vt(this,Ns)}getMutationCache(){return Vt(this,rf)}getDefaultOptions(){return Vt(this,sf)}setDefaultOptions(e){Ui(this,sf,e)}setQueryDefaults(e,t){Vt(this,Ey).set(b1(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...Vt(this,Ey).values()],i={};return t.forEach(l=>{w1(e,l.queryKey)&&Object.assign(i,l.defaultOptions)}),i}setMutationDefaults(e,t){Vt(this,Sy).set(b1(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...Vt(this,Sy).values()],i={};return t.forEach(l=>{w1(e,l.mutationKey)&&Object.assign(i,l.defaultOptions)}),i}defaultQueryOptions(e){if(e._defaulted)return e;const t={...Vt(this,sf).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=pD(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===mD&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...Vt(this,sf).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){Vt(this,Ns).clear(),Vt(this,rf).clear()}},Ns=new WeakMap,rf=new WeakMap,sf=new WeakMap,Ey=new WeakMap,Sy=new WeakMap,of=new WeakMap,Cy=new WeakMap,Iy=new WeakMap,MV),Ose=q.createContext(void 0),Fse=({client:e,children:t})=>(q.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),E.jsx(Ose.Provider,{value:e,children:t}));/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function T1(){return T1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(e[l]=i[l])}return e},T1.apply(this,arguments)}var cf;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(cf||(cf={}));const uB="popstate";function zse(e){e===void 0&&(e={});function t(l,d){let{pathname:m,search:v,hash:o}=l.location;return UR("",{pathname:m,search:v,hash:o},d.state&&d.state.usr||null,d.state&&d.state.key||"default")}function i(l,d){return typeof d=="string"?d:uS(d)}return Bse(t,i,null,e)}function Gs(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function A$(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function jse(){return Math.random().toString(36).substr(2,8)}function dB(e,t){return{usr:e.state,key:e.key,idx:t}}function UR(e,t,i,l){return i===void 0&&(i=null),T1({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?tv(t):t,{state:i,key:t&&t.key||l||jse()})}function uS(e){let{pathname:t="/",search:i="",hash:l=""}=e;return i&&i!=="?"&&(t+=i.charAt(0)==="?"?i:"?"+i),l&&l!=="#"&&(t+=l.charAt(0)==="#"?l:"#"+l),t}function tv(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substr(i),e=e.substr(0,i));let l=e.indexOf("?");l>=0&&(t.search=e.substr(l),e=e.substr(0,l)),e&&(t.pathname=e)}return t}function Bse(e,t,i,l){l===void 0&&(l={});let{window:d=document.defaultView,v5Compat:m=!1}=l,v=d.history,o=cf.Pop,I=null,A=N();A==null&&(A=0,v.replaceState(T1({},v.state,{idx:A}),""));function N(){return(v.state||{idx:null}).idx}function F(){o=cf.Pop;let re=N(),Q=re==null?null:re-A;A=re,I&&I({action:o,location:H.location,delta:Q})}function z(re,Q){o=cf.Push;let ee=UR(H.location,re,Q);A=N()+1;let ie=dB(ee,A),ue=H.createHref(ee);try{v.pushState(ie,"",ue)}catch(xe){if(xe instanceof DOMException&&xe.name==="DataCloneError")throw xe;d.location.assign(ue)}m&&I&&I({action:o,location:H.location,delta:1})}function $(re,Q){o=cf.Replace;let ee=UR(H.location,re,Q);A=N();let ie=dB(ee,A),ue=H.createHref(ee);v.replaceState(ie,"",ue),m&&I&&I({action:o,location:H.location,delta:0})}function J(re){let Q=d.location.origin!=="null"?d.location.origin:d.location.href,ee=typeof re=="string"?re:uS(re);return ee=ee.replace(/ $/,"%20"),Gs(Q,"No window.location.(origin|href) available to create URL for href: "+ee),new URL(ee,Q)}let H={get action(){return o},get location(){return e(d,v)},listen(re){if(I)throw new Error("A history only accepts one active listener");return d.addEventListener(uB,F),I=re,()=>{d.removeEventListener(uB,F),I=null}},createHref(re){return t(d,re)},createURL:J,encodeLocation(re){let Q=J(re);return{pathname:Q.pathname,search:Q.search,hash:Q.hash}},push:z,replace:$,go(re){return v.go(re)}};return H}var hB;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(hB||(hB={}));function Vse(e,t,i){return i===void 0&&(i="/"),Use(e,t,i,!1)}function Use(e,t,i,l){let d=typeof t=="string"?tv(t):t,m=gD(d.pathname||"/",i);if(m==null)return null;let v=P$(e);$se(v);let o=null;for(let I=0;o==null&&I<v.length;++I){let A=eoe(m);o=Qse(v[I],A,l)}return o}function P$(e,t,i,l){t===void 0&&(t=[]),i===void 0&&(i=[]),l===void 0&&(l="");let d=(m,v,o)=>{let I={relativePath:o===void 0?m.path||"":o,caseSensitive:m.caseSensitive===!0,childrenIndex:v,route:m};I.relativePath.startsWith("/")&&(Gs(I.relativePath.startsWith(l),'Absolute route path "'+I.relativePath+'" nested under path '+('"'+l+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),I.relativePath=I.relativePath.slice(l.length));let A=wf([l,I.relativePath]),N=i.concat(I);m.children&&m.children.length>0&&(Gs(m.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+A+'".')),P$(m.children,t,N,A)),!(m.path==null&&!m.index)&&t.push({path:A,score:Xse(A,m.index),routesMeta:N})};return e.forEach((m,v)=>{var o;if(m.path===""||!((o=m.path)!=null&&o.includes("?")))d(m,v);else for(let I of R$(m.path))d(m,v,I)}),t}function R$(e){let t=e.split("/");if(t.length===0)return[];let[i,...l]=t,d=i.endsWith("?"),m=i.replace(/\?$/,"");if(l.length===0)return d?[m,""]:[m];let v=R$(l.join("/")),o=[];return o.push(...v.map(I=>I===""?m:[m,I].join("/"))),d&&o.push(...v),o.map(I=>e.startsWith("/")&&I===""?"/":I)}function $se(e){e.sort((t,i)=>t.score!==i.score?i.score-t.score:Yse(t.routesMeta.map(l=>l.childrenIndex),i.routesMeta.map(l=>l.childrenIndex)))}const Gse=/^:[\w-]+$/,Hse=3,Wse=2,qse=1,Zse=10,Kse=-2,fB=e=>e==="*";function Xse(e,t){let i=e.split("/"),l=i.length;return i.some(fB)&&(l+=Kse),t&&(l+=Wse),i.filter(d=>!fB(d)).reduce((d,m)=>d+(Gse.test(m)?Hse:m===""?qse:Zse),l)}function Yse(e,t){return e.length===t.length&&e.slice(0,-1).every((l,d)=>l===t[d])?e[e.length-1]-t[t.length-1]:0}function Qse(e,t,i){let{routesMeta:l}=e,d={},m="/",v=[];for(let o=0;o<l.length;++o){let I=l[o],A=o===l.length-1,N=m==="/"?t:t.slice(m.length)||"/",F=pB({path:I.relativePath,caseSensitive:I.caseSensitive,end:A},N),z=I.route;if(!F&&A&&i&&!l[l.length-1].route.index&&(F=pB({path:I.relativePath,caseSensitive:I.caseSensitive,end:!1},N)),!F)return null;Object.assign(d,F.params),v.push({params:d,pathname:wf([m,F.pathname]),pathnameBase:roe(wf([m,F.pathnameBase])),route:z}),F.pathnameBase!=="/"&&(m=wf([m,F.pathnameBase]))}return v}function pB(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[i,l]=Jse(e.path,e.caseSensitive,e.end),d=t.match(i);if(!d)return null;let m=d[0],v=m.replace(/(.)\/+$/,"$1"),o=d.slice(1);return{params:l.reduce((A,N,F)=>{let{paramName:z,isOptional:$}=N;if(z==="*"){let H=o[F]||"";v=m.slice(0,m.length-H.length).replace(/(.)\/+$/,"$1")}const J=o[F];return $&&!J?A[z]=void 0:A[z]=(J||"").replace(/%2F/g,"/"),A},{}),pathname:m,pathnameBase:v,pattern:e}}function Jse(e,t,i){t===void 0&&(t=!1),i===void 0&&(i=!0),A$(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let l=[],d="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(v,o,I)=>(l.push({paramName:o,isOptional:I!=null}),I?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(l.push({paramName:"*"}),d+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?d+="\\/*$":e!==""&&e!=="/"&&(d+="(?:(?=\\/|$))"),[new RegExp(d,t?void 0:"i"),l]}function eoe(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return A$(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function gD(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,l=e.charAt(i);return l&&l!=="/"?null:e.slice(i)||"/"}function toe(e,t){t===void 0&&(t="/");let{pathname:i,search:l="",hash:d=""}=typeof e=="string"?tv(e):e;return{pathname:i?i.startsWith("/")?i:noe(i,t):t,search:soe(l),hash:ooe(d)}}function noe(e,t){let i=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(d=>{d===".."?i.length>1&&i.pop():d!=="."&&i.push(d)}),i.length>1?i.join("/"):"/"}function Z2(e,t,i,l){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(l)+"].  Please separate it out to the ")+("`to."+i+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function ioe(e){return e.filter((t,i)=>i===0||t.route.path&&t.route.path.length>0)}function _D(e,t){let i=ioe(e);return t?i.map((l,d)=>d===i.length-1?l.pathname:l.pathnameBase):i.map(l=>l.pathnameBase)}function yD(e,t,i,l){l===void 0&&(l=!1);let d;typeof e=="string"?d=tv(e):(d=T1({},e),Gs(!d.pathname||!d.pathname.includes("?"),Z2("?","pathname","search",d)),Gs(!d.pathname||!d.pathname.includes("#"),Z2("#","pathname","hash",d)),Gs(!d.search||!d.search.includes("#"),Z2("#","search","hash",d)));let m=e===""||d.pathname==="",v=m?"/":d.pathname,o;if(v==null)o=i;else{let F=t.length-1;if(!l&&v.startsWith("..")){let z=v.split("/");for(;z[0]==="..";)z.shift(),F-=1;d.pathname=z.join("/")}o=F>=0?t[F]:"/"}let I=toe(d,o),A=v&&v!=="/"&&v.endsWith("/"),N=(m||v===".")&&i.endsWith("/");return!I.pathname.endsWith("/")&&(A||N)&&(I.pathname+="/"),I}const wf=e=>e.join("/").replace(/\/\/+/g,"/"),roe=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),soe=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,ooe=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function aoe(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const M$=["post","put","patch","delete"];new Set(M$);const loe=["get",...M$];new Set(loe);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function E1(){return E1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(e[l]=i[l])}return e},E1.apply(this,arguments)}const vD=q.createContext(null),coe=q.createContext(null),qf=q.createContext(null),SC=q.createContext(null),nh=q.createContext({outlet:null,matches:[],isDataRoute:!1}),k$=q.createContext(null);function uoe(e,t){let{relative:i}=t===void 0?{}:t;nv()||Gs(!1);let{basename:l,navigator:d}=q.useContext(qf),{hash:m,pathname:v,search:o}=L$(e,{relative:i}),I=v;return l!=="/"&&(I=v==="/"?l:wf([l,v])),d.createHref({pathname:I,search:o,hash:m})}function nv(){return q.useContext(SC)!=null}function zm(){return nv()||Gs(!1),q.useContext(SC).location}function D$(e){q.useContext(qf).static||q.useLayoutEffect(e)}function Qa(){let{isDataRoute:e}=q.useContext(nh);return e?Toe():doe()}function doe(){nv()||Gs(!1);let e=q.useContext(vD),{basename:t,future:i,navigator:l}=q.useContext(qf),{matches:d}=q.useContext(nh),{pathname:m}=zm(),v=JSON.stringify(_D(d,i.v7_relativeSplatPath)),o=q.useRef(!1);return D$(()=>{o.current=!0}),q.useCallback(function(A,N){if(N===void 0&&(N={}),!o.current)return;if(typeof A=="number"){l.go(A);return}let F=yD(A,JSON.parse(v),m,N.relative==="path");e==null&&t!=="/"&&(F.pathname=F.pathname==="/"?t:wf([t,F.pathname])),(N.replace?l.replace:l.push)(F,N.state,N)},[t,l,v,m,e])}function N$(){let{matches:e}=q.useContext(nh),t=e[e.length-1];return t?t.params:{}}function L$(e,t){let{relative:i}=t===void 0?{}:t,{future:l}=q.useContext(qf),{matches:d}=q.useContext(nh),{pathname:m}=zm(),v=JSON.stringify(_D(d,l.v7_relativeSplatPath));return q.useMemo(()=>yD(e,JSON.parse(v),m,i==="path"),[e,v,m,i])}function hoe(e,t){return foe(e,t)}function foe(e,t,i,l){nv()||Gs(!1);let{navigator:d}=q.useContext(qf),{matches:m}=q.useContext(nh),v=m[m.length-1],o=v?v.params:{};v&&v.pathname;let I=v?v.pathnameBase:"/";v&&v.route;let A=zm(),N;if(t){var F;let re=typeof t=="string"?tv(t):t;I==="/"||(F=re.pathname)!=null&&F.startsWith(I)||Gs(!1),N=re}else N=A;let z=N.pathname||"/",$=z;if(I!=="/"){let re=I.replace(/^\//,"").split("/");$="/"+z.replace(/^\//,"").split("/").slice(re.length).join("/")}let J=Vse(e,{pathname:$}),H=yoe(J&&J.map(re=>Object.assign({},re,{params:Object.assign({},o,re.params),pathname:wf([I,d.encodeLocation?d.encodeLocation(re.pathname).pathname:re.pathname]),pathnameBase:re.pathnameBase==="/"?I:wf([I,d.encodeLocation?d.encodeLocation(re.pathnameBase).pathname:re.pathnameBase])})),m,i,l);return t&&H?q.createElement(SC.Provider,{value:{location:E1({pathname:"/",search:"",hash:"",state:null,key:"default"},N),navigationType:cf.Pop}},H):H}function poe(){let e=woe(),t=aoe(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,d={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return q.createElement(q.Fragment,null,q.createElement("h2",null,"Unexpected Application Error!"),q.createElement("h3",{style:{fontStyle:"italic"}},t),i?q.createElement("pre",{style:d},i):null,null)}const moe=q.createElement(poe,null);class goe extends q.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,i){return i.location!==t.location||i.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:i.error,location:i.location,revalidation:t.revalidation||i.revalidation}}componentDidCatch(t,i){console.error("React Router caught the following error during render",t,i)}render(){return this.state.error!==void 0?q.createElement(nh.Provider,{value:this.props.routeContext},q.createElement(k$.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function _oe(e){let{routeContext:t,match:i,children:l}=e,d=q.useContext(vD);return d&&d.static&&d.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(d.staticContext._deepestRenderedBoundaryId=i.route.id),q.createElement(nh.Provider,{value:t},l)}function yoe(e,t,i,l){var d;if(t===void 0&&(t=[]),i===void 0&&(i=null),l===void 0&&(l=null),e==null){var m;if(!i)return null;if(i.errors)e=i.matches;else if((m=l)!=null&&m.v7_partialHydration&&t.length===0&&!i.initialized&&i.matches.length>0)e=i.matches;else return null}let v=e,o=(d=i)==null?void 0:d.errors;if(o!=null){let N=v.findIndex(F=>F.route.id&&(o==null?void 0:o[F.route.id])!==void 0);N>=0||Gs(!1),v=v.slice(0,Math.min(v.length,N+1))}let I=!1,A=-1;if(i&&l&&l.v7_partialHydration)for(let N=0;N<v.length;N++){let F=v[N];if((F.route.HydrateFallback||F.route.hydrateFallbackElement)&&(A=N),F.route.id){let{loaderData:z,errors:$}=i,J=F.route.loader&&z[F.route.id]===void 0&&(!$||$[F.route.id]===void 0);if(F.route.lazy||J){I=!0,A>=0?v=v.slice(0,A+1):v=[v[0]];break}}}return v.reduceRight((N,F,z)=>{let $,J=!1,H=null,re=null;i&&($=o&&F.route.id?o[F.route.id]:void 0,H=F.route.errorElement||moe,I&&(A<0&&z===0?(J=!0,re=null):A===z&&(J=!0,re=F.route.hydrateFallbackElement||null)));let Q=t.concat(v.slice(0,z+1)),ee=()=>{let ie;return $?ie=H:J?ie=re:F.route.Component?ie=q.createElement(F.route.Component,null):F.route.element?ie=F.route.element:ie=N,q.createElement(_oe,{match:F,routeContext:{outlet:N,matches:Q,isDataRoute:i!=null},children:ie})};return i&&(F.route.ErrorBoundary||F.route.errorElement||z===0)?q.createElement(goe,{location:i.location,revalidation:i.revalidation,component:H,error:$,children:ee(),routeContext:{outlet:null,matches:Q,isDataRoute:!0}}):ee()},null)}var O$=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(O$||{}),dS=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(dS||{});function voe(e){let t=q.useContext(vD);return t||Gs(!1),t}function xoe(e){let t=q.useContext(coe);return t||Gs(!1),t}function boe(e){let t=q.useContext(nh);return t||Gs(!1),t}function F$(e){let t=boe(),i=t.matches[t.matches.length-1];return i.route.id||Gs(!1),i.route.id}function woe(){var e;let t=q.useContext(k$),i=xoe(dS.UseRouteError),l=F$(dS.UseRouteError);return t!==void 0?t:(e=i.errors)==null?void 0:e[l]}function Toe(){let{router:e}=voe(O$.UseNavigateStable),t=F$(dS.UseNavigateStable),i=q.useRef(!1);return D$(()=>{i.current=!0}),q.useCallback(function(d,m){m===void 0&&(m={}),i.current&&(typeof d=="number"?e.navigate(d):e.navigate(d,E1({fromRouteId:t},m)))},[e,t])}function Eoe(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function Soe(e){let{to:t,replace:i,state:l,relative:d}=e;nv()||Gs(!1);let{future:m,static:v}=q.useContext(qf),{matches:o}=q.useContext(nh),{pathname:I}=zm(),A=Qa(),N=yD(t,_D(o,m.v7_relativeSplatPath),I,d==="path"),F=JSON.stringify(N);return q.useEffect(()=>A(JSON.parse(F),{replace:i,state:l,relative:d}),[A,F,d,i,l]),null}function oo(e){Gs(!1)}function Coe(e){let{basename:t="/",children:i=null,location:l,navigationType:d=cf.Pop,navigator:m,static:v=!1,future:o}=e;nv()&&Gs(!1);let I=t.replace(/^\/*/,"/"),A=q.useMemo(()=>({basename:I,navigator:m,static:v,future:E1({v7_relativeSplatPath:!1},o)}),[I,o,m,v]);typeof l=="string"&&(l=tv(l));let{pathname:N="/",search:F="",hash:z="",state:$=null,key:J="default"}=l,H=q.useMemo(()=>{let re=gD(N,I);return re==null?null:{location:{pathname:re,search:F,hash:z,state:$,key:J},navigationType:d}},[I,N,F,z,$,J,d]);return H==null?null:q.createElement(qf.Provider,{value:A},q.createElement(SC.Provider,{children:i,value:H}))}function Ioe(e){let{children:t,location:i}=e;return hoe($R(t),i)}new Promise(()=>{});function $R(e,t){t===void 0&&(t=[]);let i=[];return q.Children.forEach(e,(l,d)=>{if(!q.isValidElement(l))return;let m=[...t,d];if(l.type===q.Fragment){i.push.apply(i,$R(l.props.children,m));return}l.type!==oo&&Gs(!1),!l.props.index||!l.props.children||Gs(!1);let v={id:l.props.id||m.join("-"),caseSensitive:l.props.caseSensitive,element:l.props.element,Component:l.props.Component,index:l.props.index,path:l.props.path,loader:l.props.loader,action:l.props.action,errorElement:l.props.errorElement,ErrorBoundary:l.props.ErrorBoundary,hasErrorBoundary:l.props.ErrorBoundary!=null||l.props.errorElement!=null,shouldRevalidate:l.props.shouldRevalidate,handle:l.props.handle,lazy:l.props.lazy};l.props.children&&(v.children=$R(l.props.children,m)),i.push(v)}),i}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function GR(){return GR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(e[l]=i[l])}return e},GR.apply(this,arguments)}function Aoe(e,t){if(e==null)return{};var i={},l=Object.keys(e),d,m;for(m=0;m<l.length;m++)d=l[m],!(t.indexOf(d)>=0)&&(i[d]=e[d]);return i}function Poe(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Roe(e,t){return e.button===0&&(!t||t==="_self")&&!Poe(e)}const Moe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],koe="6";try{window.__reactRouterVersion=koe}catch{}const Doe="startTransition",mB=ik[Doe];function Noe(e){let{basename:t,children:i,future:l,window:d}=e,m=q.useRef();m.current==null&&(m.current=zse({window:d,v5Compat:!0}));let v=m.current,[o,I]=q.useState({action:v.action,location:v.location}),{v7_startTransition:A}=l||{},N=q.useCallback(F=>{A&&mB?mB(()=>I(F)):I(F)},[I,A]);return q.useLayoutEffect(()=>v.listen(N),[v,N]),q.useEffect(()=>Eoe(l),[l]),q.createElement(Coe,{basename:t,children:i,location:o.location,navigationType:o.action,navigator:v,future:l})}const Loe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Ooe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Fr=q.forwardRef(function(t,i){let{onClick:l,relative:d,reloadDocument:m,replace:v,state:o,target:I,to:A,preventScrollReset:N,viewTransition:F}=t,z=Aoe(t,Moe),{basename:$}=q.useContext(qf),J,H=!1;if(typeof A=="string"&&Ooe.test(A)&&(J=A,Loe))try{let ie=new URL(window.location.href),ue=A.startsWith("//")?new URL(ie.protocol+A):new URL(A),xe=gD(ue.pathname,$);ue.origin===ie.origin&&xe!=null?A=xe+ue.search+ue.hash:H=!0}catch{}let re=uoe(A,{relative:d}),Q=Foe(A,{replace:v,state:o,target:I,preventScrollReset:N,relative:d,viewTransition:F});function ee(ie){l&&l(ie),ie.defaultPrevented||Q(ie)}return q.createElement("a",GR({},z,{href:J||re,onClick:H||m?l:ee,ref:i,target:I}))});var gB;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(gB||(gB={}));var _B;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(_B||(_B={}));function Foe(e,t){let{target:i,replace:l,state:d,preventScrollReset:m,relative:v,viewTransition:o}=t===void 0?{}:t,I=Qa(),A=zm(),N=L$(e,{relative:v});return q.useCallback(F=>{if(Roe(F,i)){F.preventDefault();let z=l!==void 0?l:uS(A)===uS(N);I(e,{replace:z,state:d,preventScrollReset:m,relative:v,viewTransition:o})}},[A,I,N,l,d,i,e,m,v,o])}const zoe=()=>{};var yB={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z$={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hn=function(e,t){if(!e)throw iv(t)},iv=function(e){return new Error("Firebase Database ("+z$.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j$=function(e){const t=[];let i=0;for(let l=0;l<e.length;l++){let d=e.charCodeAt(l);d<128?t[i++]=d:d<2048?(t[i++]=d>>6|192,t[i++]=d&63|128):(d&64512)===55296&&l+1<e.length&&(e.charCodeAt(l+1)&64512)===56320?(d=65536+((d&1023)<<10)+(e.charCodeAt(++l)&1023),t[i++]=d>>18|240,t[i++]=d>>12&63|128,t[i++]=d>>6&63|128,t[i++]=d&63|128):(t[i++]=d>>12|224,t[i++]=d>>6&63|128,t[i++]=d&63|128)}return t},joe=function(e){const t=[];let i=0,l=0;for(;i<e.length;){const d=e[i++];if(d<128)t[l++]=String.fromCharCode(d);else if(d>191&&d<224){const m=e[i++];t[l++]=String.fromCharCode((d&31)<<6|m&63)}else if(d>239&&d<365){const m=e[i++],v=e[i++],o=e[i++],I=((d&7)<<18|(m&63)<<12|(v&63)<<6|o&63)-65536;t[l++]=String.fromCharCode(55296+(I>>10)),t[l++]=String.fromCharCode(56320+(I&1023))}else{const m=e[i++],v=e[i++];t[l++]=String.fromCharCode((d&15)<<12|(m&63)<<6|v&63)}}return t.join("")},xD={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,l=[];for(let d=0;d<e.length;d+=3){const m=e[d],v=d+1<e.length,o=v?e[d+1]:0,I=d+2<e.length,A=I?e[d+2]:0,N=m>>2,F=(m&3)<<4|o>>4;let z=(o&15)<<2|A>>6,$=A&63;I||($=64,v||(z=64)),l.push(i[N],i[F],i[z],i[$])}return l.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(j$(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):joe(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const i=t?this.charToByteMapWebSafe_:this.charToByteMap_,l=[];for(let d=0;d<e.length;){const m=i[e.charAt(d++)],o=d<e.length?i[e.charAt(d)]:0;++d;const A=d<e.length?i[e.charAt(d)]:64;++d;const F=d<e.length?i[e.charAt(d)]:64;if(++d,m==null||o==null||A==null||F==null)throw new Boe;const z=m<<2|o>>4;if(l.push(z),A!==64){const $=o<<4&240|A>>2;if(l.push($),F!==64){const J=A<<6&192|F;l.push(J)}}}return l},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Boe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const B$=function(e){const t=j$(e);return xD.encodeByteArray(t,!0)},hS=function(e){return B$(e).replace(/\./g,"")},fS=function(e){try{return xD.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Voe(e){return V$(void 0,e)}function V$(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:const i=t;return new Date(i.getTime());case Object:e===void 0&&(e={});break;case Array:e=[];break;default:return t}for(const i in t)!t.hasOwnProperty(i)||!Uoe(i)||(e[i]=V$(e[i],t[i]));return e}function Uoe(e){return e!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $oe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Goe=()=>$oe().__FIREBASE_DEFAULTS__,Hoe=()=>{if(typeof process>"u"||typeof yB>"u")return;const e=yB.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},Woe=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=e&&fS(e[1]);return t&&JSON.parse(t)},bD=()=>{try{return zoe()||Goe()||Hoe()||Woe()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},U$=e=>{var t,i;return(i=(t=bD())==null?void 0:t.emulatorHosts)==null?void 0:i[e]},$$=e=>{const t=U$(e);if(!t)return;const i=t.lastIndexOf(":");if(i<=0||i+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const l=parseInt(t.substring(i+1),10);return t[0]==="["?[t.substring(1,i-1),l]:[t.substring(0,i),l]},G$=()=>{var e;return(e=bD())==null?void 0:e.config},H$=e=>{var t;return(t=bD())==null?void 0:t[`_${e}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eb{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,i)=>{this.resolve=t,this.reject=i})}wrapCallback(t){return(i,l)=>{i?this.reject(i):this.resolve(l),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(i):t(i,l))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jm(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function wD(e){return(await fetch(e,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W$(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},l=t||"demo-project",d=e.iat||0,m=e.sub||e.user_id;if(!m)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const v={iss:`https://securetoken.google.com/${l}`,aud:l,iat:d,exp:d+3600,auth_time:d,sub:m,user_id:m,firebase:{sign_in_provider:"custom",identities:{}},...e};return[hS(JSON.stringify(i)),hS(JSON.stringify(v)),""].join(".")}const U0={};function qoe(){const e={prod:[],emulator:[]};for(const t of Object.keys(U0))U0[t]?e.emulator.push(t):e.prod.push(t);return e}function Zoe(e){let t=document.getElementById(e),i=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),i=!0),{created:i,element:t}}let vB=!1;function TD(e,t){if(typeof window>"u"||typeof document>"u"||!jm(window.location.host)||U0[e]===t||U0[e]||vB)return;U0[e]=t;function i(z){return`__firebase__banner__${z}`}const l="__firebase__banner",m=qoe().prod.length>0;function v(){const z=document.getElementById(l);z&&z.remove()}function o(z){z.style.display="flex",z.style.background="#7faaf0",z.style.position="fixed",z.style.bottom="5px",z.style.left="5px",z.style.padding=".5em",z.style.borderRadius="5px",z.style.alignItems="center"}function I(z,$){z.setAttribute("width","24"),z.setAttribute("id",$),z.setAttribute("height","24"),z.setAttribute("viewBox","0 0 24 24"),z.setAttribute("fill","none"),z.style.marginLeft="-6px"}function A(){const z=document.createElement("span");return z.style.cursor="pointer",z.style.marginLeft="16px",z.style.fontSize="24px",z.innerHTML=" &times;",z.onclick=()=>{vB=!0,v()},z}function N(z,$){z.setAttribute("id",$),z.innerText="Learn more",z.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",z.setAttribute("target","__blank"),z.style.paddingLeft="5px",z.style.textDecoration="underline"}function F(){const z=Zoe(l),$=i("text"),J=document.getElementById($)||document.createElement("span"),H=i("learnmore"),re=document.getElementById(H)||document.createElement("a"),Q=i("preprendIcon"),ee=document.getElementById(Q)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(z.created){const ie=z.element;o(ie),N(re,H);const ue=A();I(ee,Q),ie.append(ee,J,re,ue),document.body.appendChild(ie)}m?(J.innerText="Preview backend disconnected.",ee.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(ee.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,J.innerText="Preview backend running in this workspace."),J.setAttribute("id",$)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",F):F()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ba(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function ED(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ba())}function Koe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Xoe(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function q$(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Yoe(){const e=ba();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function Z$(){return z$.NODE_ADMIN===!0}function Qoe(){try{return typeof indexedDB=="object"}catch{return!1}}function Joe(){return new Promise((e,t)=>{try{let i=!0;const l="validate-browser-context-for-indexeddb-analytics-module",d=self.indexedDB.open(l);d.onsuccess=()=>{d.result.close(),i||self.indexedDB.deleteDatabase(l),e(!0)},d.onupgradeneeded=()=>{i=!1},d.onerror=()=>{var m;t(((m=d.error)==null?void 0:m.message)||"")}}catch(i){t(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eae="FirebaseError";class ih extends Error{constructor(t,i,l){super(i),this.code=t,this.customData=l,this.name=eae,Object.setPrototypeOf(this,ih.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,tb.prototype.create)}}class tb{constructor(t,i,l){this.service=t,this.serviceName=i,this.errors=l}create(t,...i){const l=i[0]||{},d=`${this.service}/${t}`,m=this.errors[t],v=m?tae(m,l):"Error",o=`${this.serviceName}: ${v} (${d}).`;return new ih(d,o,l)}}function tae(e,t){return e.replace(nae,(i,l)=>{const d=t[l];return d!=null?String(d):`<${l}?>`})}const nae=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S1(e){return JSON.parse(e)}function uo(e){return JSON.stringify(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K$=function(e){let t={},i={},l={},d="";try{const m=e.split(".");t=S1(fS(m[0])||""),i=S1(fS(m[1])||""),d=m[2],l=i.d||{},delete i.d}catch{}return{header:t,claims:i,data:l,signature:d}},iae=function(e){const t=K$(e),i=t.claims;return!!i&&typeof i=="object"&&i.hasOwnProperty("iat")},rae=function(e){const t=K$(e).claims;return typeof t=="object"&&t.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ed(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function zy(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function HR(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function pS(e,t,i){const l={};for(const d in e)Object.prototype.hasOwnProperty.call(e,d)&&(l[d]=t.call(i,e[d],d,e));return l}function Em(e,t){if(e===t)return!0;const i=Object.keys(e),l=Object.keys(t);for(const d of i){if(!l.includes(d))return!1;const m=e[d],v=t[d];if(xB(m)&&xB(v)){if(!Em(m,v))return!1}else if(m!==v)return!1}for(const d of l)if(!i.includes(d))return!1;return!0}function xB(e){return e!==null&&typeof e=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rv(e){const t=[];for(const[i,l]of Object.entries(e))Array.isArray(l)?l.forEach(d=>{t.push(encodeURIComponent(i)+"="+encodeURIComponent(d))}):t.push(encodeURIComponent(i)+"="+encodeURIComponent(l));return t.length?"&"+t.join("&"):""}function A0(e){const t={};return e.replace(/^\?/,"").split("&").forEach(l=>{if(l){const[d,m]=l.split("=");t[decodeURIComponent(d)]=decodeURIComponent(m)}}),t}function P0(e){const t=e.indexOf("?");if(!t)return"";const i=e.indexOf("#",t);return e.substring(t,i>0?i:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sae{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,i){i||(i=0);const l=this.W_;if(typeof t=="string")for(let F=0;F<16;F++)l[F]=t.charCodeAt(i)<<24|t.charCodeAt(i+1)<<16|t.charCodeAt(i+2)<<8|t.charCodeAt(i+3),i+=4;else for(let F=0;F<16;F++)l[F]=t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3],i+=4;for(let F=16;F<80;F++){const z=l[F-3]^l[F-8]^l[F-14]^l[F-16];l[F]=(z<<1|z>>>31)&4294967295}let d=this.chain_[0],m=this.chain_[1],v=this.chain_[2],o=this.chain_[3],I=this.chain_[4],A,N;for(let F=0;F<80;F++){F<40?F<20?(A=o^m&(v^o),N=1518500249):(A=m^v^o,N=1859775393):F<60?(A=m&v|o&(m|v),N=2400959708):(A=m^v^o,N=3395469782);const z=(d<<5|d>>>27)+A+I+N+l[F]&4294967295;I=o,o=v,v=(m<<30|m>>>2)&4294967295,m=d,d=z}this.chain_[0]=this.chain_[0]+d&4294967295,this.chain_[1]=this.chain_[1]+m&4294967295,this.chain_[2]=this.chain_[2]+v&4294967295,this.chain_[3]=this.chain_[3]+o&4294967295,this.chain_[4]=this.chain_[4]+I&4294967295}update(t,i){if(t==null)return;i===void 0&&(i=t.length);const l=i-this.blockSize;let d=0;const m=this.buf_;let v=this.inbuf_;for(;d<i;){if(v===0)for(;d<=l;)this.compress_(t,d),d+=this.blockSize;if(typeof t=="string"){for(;d<i;)if(m[v]=t.charCodeAt(d),++v,++d,v===this.blockSize){this.compress_(m),v=0;break}}else for(;d<i;)if(m[v]=t[d],++v,++d,v===this.blockSize){this.compress_(m),v=0;break}}this.inbuf_=v,this.total_+=i}digest(){const t=[];let i=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let d=this.blockSize-1;d>=56;d--)this.buf_[d]=i&255,i/=256;this.compress_(this.buf_);let l=0;for(let d=0;d<5;d++)for(let m=24;m>=0;m-=8)t[l]=this.chain_[d]>>m&255,++l;return t}}function oae(e,t){const i=new aae(e,t);return i.subscribe.bind(i)}class aae{constructor(t,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{t(this)}).catch(l=>{this.error(l)})}next(t){this.forEachObserver(i=>{i.next(t)})}error(t){this.forEachObserver(i=>{i.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,i,l){let d;if(t===void 0&&i===void 0&&l===void 0)throw new Error("Missing Observer.");lae(t,["next","error","complete"])?d=t:d={next:t,error:i,complete:l},d.next===void 0&&(d.next=K2),d.error===void 0&&(d.error=K2),d.complete===void 0&&(d.complete=K2);const m=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?d.error(this.finalError):d.complete()}catch{}}),this.observers.push(d),m}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,t)}sendOne(t,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{i(this.observers[t])}catch(l){typeof console<"u"&&console.error&&console.error(l)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function lae(e,t){if(typeof e!="object"||e===null)return!1;for(const i of t)if(i in e&&typeof e[i]=="function")return!0;return!1}function K2(){}function CC(e,t){return`${e} failed: ${t} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cae=function(e){const t=[];let i=0;for(let l=0;l<e.length;l++){let d=e.charCodeAt(l);if(d>=55296&&d<=56319){const m=d-55296;l++,hn(l<e.length,"Surrogate pair missing trail surrogate.");const v=e.charCodeAt(l)-56320;d=65536+(m<<10)+v}d<128?t[i++]=d:d<2048?(t[i++]=d>>6|192,t[i++]=d&63|128):d<65536?(t[i++]=d>>12|224,t[i++]=d>>6&63|128,t[i++]=d&63|128):(t[i++]=d>>18|240,t[i++]=d>>12&63|128,t[i++]=d>>6&63|128,t[i++]=d&63|128)}return t},IC=function(e){let t=0;for(let i=0;i<e.length;i++){const l=e.charCodeAt(i);l<128?t++:l<2048?t+=2:l>=55296&&l<=56319?(t+=4,i++):t+=3}return t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ta(e){return e&&e._delegate?e._delegate:e}class Lf{constructor(t,i,l){this.name=t,this.instanceFactory=i,this.type=l,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qp="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uae{constructor(t,i){this.name=t,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const i=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(i)){const l=new eb;if(this.instancesDeferred.set(i,l),this.isInitialized(i)||this.shouldAutoInitialize())try{const d=this.getOrInitializeService({instanceIdentifier:i});d&&l.resolve(d)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(t){const i=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),l=(t==null?void 0:t.optional)??!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(hae(t))try{this.getOrInitializeService({instanceIdentifier:Qp})}catch{}for(const[i,l]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(i);try{const m=this.getOrInitializeService({instanceIdentifier:d});l.resolve(m)}catch{}}}}clearInstance(t=Qp){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...t.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Qp){return this.instances.has(t)}getOptions(t=Qp){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:i={}}=t,l=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(l))throw Error(`${this.name}(${l}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const d=this.getOrInitializeService({instanceIdentifier:l,options:i});for(const[m,v]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(m);l===o&&v.resolve(d)}return d}onInit(t,i){const l=this.normalizeInstanceIdentifier(i),d=this.onInitCallbacks.get(l)??new Set;d.add(t),this.onInitCallbacks.set(l,d);const m=this.instances.get(l);return m&&t(m,l),()=>{d.delete(t)}}invokeOnInitCallbacks(t,i){const l=this.onInitCallbacks.get(i);if(l)for(const d of l)try{d(t,i)}catch{}}getOrInitializeService({instanceIdentifier:t,options:i={}}){let l=this.instances.get(t);if(!l&&this.component&&(l=this.component.instanceFactory(this.container,{instanceIdentifier:dae(t),options:i}),this.instances.set(t,l),this.instancesOptions.set(t,i),this.invokeOnInitCallbacks(l,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,l)}catch{}return l||null}normalizeInstanceIdentifier(t=Qp){return this.component?this.component.multipleInstances?t:Qp:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function dae(e){return e===Qp?void 0:e}function hae(e){return e.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fae{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const i=this.getProvider(t.name);if(i.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);i.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const i=new uae(t,this);return this.providers.set(t,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qr;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(qr||(qr={}));const pae={debug:qr.DEBUG,verbose:qr.VERBOSE,info:qr.INFO,warn:qr.WARN,error:qr.ERROR,silent:qr.SILENT},mae=qr.INFO,gae={[qr.DEBUG]:"log",[qr.VERBOSE]:"log",[qr.INFO]:"info",[qr.WARN]:"warn",[qr.ERROR]:"error"},_ae=(e,t,...i)=>{if(t<e.logLevel)return;const l=new Date().toISOString(),d=gae[t];if(d)console[d](`[${l}]  ${e.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class SD{constructor(t){this.name=t,this._logLevel=mae,this._logHandler=_ae,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in qr))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?pae[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,qr.DEBUG,...t),this._logHandler(this,qr.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,qr.VERBOSE,...t),this._logHandler(this,qr.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,qr.INFO,...t),this._logHandler(this,qr.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,qr.WARN,...t),this._logHandler(this,qr.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,qr.ERROR,...t),this._logHandler(this,qr.ERROR,...t)}}const yae=(e,t)=>t.some(i=>e instanceof i);let bB,wB;function vae(){return bB||(bB=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function xae(){return wB||(wB=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const X$=new WeakMap,WR=new WeakMap,Y$=new WeakMap,X2=new WeakMap,CD=new WeakMap;function bae(e){const t=new Promise((i,l)=>{const d=()=>{e.removeEventListener("success",m),e.removeEventListener("error",v)},m=()=>{i(Tf(e.result)),d()},v=()=>{l(e.error),d()};e.addEventListener("success",m),e.addEventListener("error",v)});return t.then(i=>{i instanceof IDBCursor&&X$.set(i,e)}).catch(()=>{}),CD.set(t,e),t}function wae(e){if(WR.has(e))return;const t=new Promise((i,l)=>{const d=()=>{e.removeEventListener("complete",m),e.removeEventListener("error",v),e.removeEventListener("abort",v)},m=()=>{i(),d()},v=()=>{l(e.error||new DOMException("AbortError","AbortError")),d()};e.addEventListener("complete",m),e.addEventListener("error",v),e.addEventListener("abort",v)});WR.set(e,t)}let qR={get(e,t,i){if(e instanceof IDBTransaction){if(t==="done")return WR.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Y$.get(e);if(t==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return Tf(e[t])},set(e,t,i){return e[t]=i,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Tae(e){qR=e(qR)}function Eae(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...i){const l=e.call(Y2(this),t,...i);return Y$.set(l,t.sort?t.sort():[t]),Tf(l)}:xae().includes(e)?function(...t){return e.apply(Y2(this),t),Tf(X$.get(this))}:function(...t){return Tf(e.apply(Y2(this),t))}}function Sae(e){return typeof e=="function"?Eae(e):(e instanceof IDBTransaction&&wae(e),yae(e,vae())?new Proxy(e,qR):e)}function Tf(e){if(e instanceof IDBRequest)return bae(e);if(X2.has(e))return X2.get(e);const t=Sae(e);return t!==e&&(X2.set(e,t),CD.set(t,e)),t}const Y2=e=>CD.get(e);function Cae(e,t,{blocked:i,upgrade:l,blocking:d,terminated:m}={}){const v=indexedDB.open(e,t),o=Tf(v);return l&&v.addEventListener("upgradeneeded",I=>{l(Tf(v.result),I.oldVersion,I.newVersion,Tf(v.transaction),I)}),i&&v.addEventListener("blocked",I=>i(I.oldVersion,I.newVersion,I)),o.then(I=>{m&&I.addEventListener("close",()=>m()),d&&I.addEventListener("versionchange",A=>d(A.oldVersion,A.newVersion,A))}).catch(()=>{}),o}const Iae=["get","getKey","getAll","getAllKeys","count"],Aae=["put","add","delete","clear"],Q2=new Map;function TB(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(Q2.get(t))return Q2.get(t);const i=t.replace(/FromIndex$/,""),l=t!==i,d=Aae.includes(i);if(!(i in(l?IDBIndex:IDBObjectStore).prototype)||!(d||Iae.includes(i)))return;const m=async function(v,...o){const I=this.transaction(v,d?"readwrite":"readonly");let A=I.store;return l&&(A=A.index(o.shift())),(await Promise.all([A[i](...o),d&&I.done]))[0]};return Q2.set(t,m),m}Tae(e=>({...e,get:(t,i,l)=>TB(t,i)||e.get(t,i,l),has:(t,i)=>!!TB(t,i)||e.has(t,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pae{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(Rae(i)){const l=i.getImmediate();return`${l.library}/${l.version}`}else return null}).filter(i=>i).join(" ")}}function Rae(e){const t=e.getComponent();return(t==null?void 0:t.type)==="VERSION"}const ZR="@firebase/app",EB="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xd=new SD("@firebase/app"),Mae="@firebase/app-compat",kae="@firebase/analytics-compat",Dae="@firebase/analytics",Nae="@firebase/app-check-compat",Lae="@firebase/app-check",Oae="@firebase/auth",Fae="@firebase/auth-compat",zae="@firebase/database",jae="@firebase/data-connect",Bae="@firebase/database-compat",Vae="@firebase/functions",Uae="@firebase/functions-compat",$ae="@firebase/installations",Gae="@firebase/installations-compat",Hae="@firebase/messaging",Wae="@firebase/messaging-compat",qae="@firebase/performance",Zae="@firebase/performance-compat",Kae="@firebase/remote-config",Xae="@firebase/remote-config-compat",Yae="@firebase/storage",Qae="@firebase/storage-compat",Jae="@firebase/firestore",ele="@firebase/ai",tle="@firebase/firestore-compat",nle="firebase",ile="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KR="[DEFAULT]",rle={[ZR]:"fire-core",[Mae]:"fire-core-compat",[Dae]:"fire-analytics",[kae]:"fire-analytics-compat",[Lae]:"fire-app-check",[Nae]:"fire-app-check-compat",[Oae]:"fire-auth",[Fae]:"fire-auth-compat",[zae]:"fire-rtdb",[jae]:"fire-data-connect",[Bae]:"fire-rtdb-compat",[Vae]:"fire-fn",[Uae]:"fire-fn-compat",[$ae]:"fire-iid",[Gae]:"fire-iid-compat",[Hae]:"fire-fcm",[Wae]:"fire-fcm-compat",[qae]:"fire-perf",[Zae]:"fire-perf-compat",[Kae]:"fire-rc",[Xae]:"fire-rc-compat",[Yae]:"fire-gcs",[Qae]:"fire-gcs-compat",[Jae]:"fire-fst",[tle]:"fire-fst-compat",[ele]:"fire-vertex","fire-js":"fire-js",[nle]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mS=new Map,sle=new Map,XR=new Map;function SB(e,t){try{e.container.addComponent(t)}catch(i){Xd.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,i)}}function Sm(e){const t=e.name;if(XR.has(t))return Xd.debug(`There were multiple attempts to register component ${t}.`),!1;XR.set(t,e);for(const i of mS.values())SB(i,e);for(const i of sle.values())SB(i,e);return!0}function AC(e,t){const i=e.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),e.container.getProvider(t)}function _l(e){return e==null?!1:e.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ole={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ef=new tb("app","Firebase",ole);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ale{constructor(t,i,l){this._isDeleted=!1,this._options={...t},this._config={...i},this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=l,this.container.addComponent(new Lf("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Ef.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bm=ile;function Q$(e,t={}){let i=e;typeof t!="object"&&(t={name:t});const l={name:KR,automaticDataCollectionEnabled:!0,...t},d=l.name;if(typeof d!="string"||!d)throw Ef.create("bad-app-name",{appName:String(d)});if(i||(i=G$()),!i)throw Ef.create("no-options");const m=mS.get(d);if(m){if(Em(i,m.options)&&Em(l,m.config))return m;throw Ef.create("duplicate-app",{appName:d})}const v=new fae(d);for(const I of XR.values())v.addComponent(I);const o=new ale(i,l,v);return mS.set(d,o),o}function ID(e=KR){const t=mS.get(e);if(!t&&e===KR&&G$())return Q$();if(!t)throw Ef.create("no-app",{appName:e});return t}function Gu(e,t,i){let l=rle[e]??e;i&&(l+=`-${i}`);const d=l.match(/\s|\//),m=t.match(/\s|\//);if(d||m){const v=[`Unable to register library "${l}" with version "${t}":`];d&&v.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&m&&v.push("and"),m&&v.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Xd.warn(v.join(" "));return}Sm(new Lf(`${l}-version`,()=>({library:l,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lle="firebase-heartbeat-database",cle=1,C1="firebase-heartbeat-store";let J2=null;function J$(){return J2||(J2=Cae(lle,cle,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore(C1)}catch(i){console.warn(i)}}}}).catch(e=>{throw Ef.create("idb-open",{originalErrorMessage:e.message})})),J2}async function ule(e){try{const i=(await J$()).transaction(C1),l=await i.objectStore(C1).get(eG(e));return await i.done,l}catch(t){if(t instanceof ih)Xd.warn(t.message);else{const i=Ef.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Xd.warn(i.message)}}}async function CB(e,t){try{const l=(await J$()).transaction(C1,"readwrite");await l.objectStore(C1).put(t,eG(e)),await l.done}catch(i){if(i instanceof ih)Xd.warn(i.message);else{const l=Ef.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});Xd.warn(l.message)}}}function eG(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dle=1024,hle=30;class fle{constructor(t){this.container=t,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new mle(i),this._heartbeatsCachePromise=this._storage.read().then(l=>(this._heartbeatsCache=l,l))}async triggerHeartbeat(){var t,i;try{const d=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),m=IB();if(((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)==null?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===m||this._heartbeatsCache.heartbeats.some(v=>v.date===m))return;if(this._heartbeatsCache.heartbeats.push({date:m,agent:d}),this._heartbeatsCache.heartbeats.length>hle){const v=gle(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(v,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(l){Xd.warn(l)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=IB(),{heartbeatsToSend:l,unsentEntries:d}=ple(this._heartbeatsCache.heartbeats),m=hS(JSON.stringify({version:2,heartbeats:l}));return this._heartbeatsCache.lastSentHeartbeatDate=i,d.length>0?(this._heartbeatsCache.heartbeats=d,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),m}catch(i){return Xd.warn(i),""}}}function IB(){return new Date().toISOString().substring(0,10)}function ple(e,t=dle){const i=[];let l=e.slice();for(const d of e){const m=i.find(v=>v.agent===d.agent);if(m){if(m.dates.push(d.date),AB(i)>t){m.dates.pop();break}}else if(i.push({agent:d.agent,dates:[d.date]}),AB(i)>t){i.pop();break}l=l.slice(1)}return{heartbeatsToSend:i,unsentEntries:l}}class mle{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Qoe()?Joe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await ule(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const l=await this.read();return CB(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??l.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const l=await this.read();return CB(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...t.heartbeats]})}else return}}function AB(e){return hS(JSON.stringify({version:2,heartbeats:e})).length}function gle(e){if(e.length===0)return-1;let t=0,i=e[0].date;for(let l=1;l<e.length;l++)e[l].date<i&&(i=e[l].date,t=l);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _le(e){Sm(new Lf("platform-logger",t=>new Pae(t),"PRIVATE")),Sm(new Lf("heartbeat",t=>new fle(t),"PRIVATE")),Gu(ZR,EB,e),Gu(ZR,EB,"esm2020"),Gu("fire-js","")}_le("");function tG(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const yle=tG,nG=new tb("auth","Firebase",tG());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gS=new SD("@firebase/auth");function vle(e,...t){gS.logLevel<=qr.WARN&&gS.warn(`Auth (${Bm}): ${e}`,...t)}function vE(e,...t){gS.logLevel<=qr.ERROR&&gS.error(`Auth (${Bm}): ${e}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ru(e,...t){throw AD(e,...t)}function Hu(e,...t){return AD(e,...t)}function iG(e,t,i){const l={...yle(),[t]:i};return new tb("auth","Firebase",l).create(t,{appName:e.name})}function Ud(e){return iG(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function AD(e,...t){if(typeof e!="string"){const i=t[0],l=[...t.slice(1)];return l[0]&&(l[0].appName=e.name),e._errorFactory.create(i,...l)}return nG.create(e,...t)}function Ti(e,t,...i){if(!e)throw AD(t,...i)}function zd(e){const t="INTERNAL ASSERTION FAILED: "+e;throw vE(t),new Error(t)}function Yd(e,t){e||zd(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YR(){var e;return typeof self<"u"&&((e=self.location)==null?void 0:e.href)||""}function xle(){return PB()==="http:"||PB()==="https:"}function PB(){var e;return typeof self<"u"&&((e=self.location)==null?void 0:e.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ble(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(xle()||Xoe()||"connection"in navigator)?navigator.onLine:!0}function wle(){if(typeof navigator>"u")return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nb{constructor(t,i){this.shortDelay=t,this.longDelay=i,Yd(i>t,"Short delay should be less than long delay!"),this.isMobile=ED()||q$()}get(){return ble()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PD(e,t){Yd(e.emulator,"Emulator should always be set here");const{url:i}=e.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rG{static initialize(t,i,l){this.fetchImpl=t,i&&(this.headersImpl=i),l&&(this.responseImpl=l)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;zd("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;zd("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;zd("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tle={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ele=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Sle=new nb(3e4,6e4);function Zf(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function Kf(e,t,i,l,d={}){return sG(e,d,async()=>{let m={},v={};l&&(t==="GET"?v=l:m={body:JSON.stringify(l)});const o=rv({key:e.config.apiKey,...v}).slice(1),I=await e._getAdditionalHeaders();I["Content-Type"]="application/json",e.languageCode&&(I["X-Firebase-Locale"]=e.languageCode);const A={method:t,headers:I,...m};return Koe()||(A.referrerPolicy="no-referrer"),e.emulatorConfig&&jm(e.emulatorConfig.host)&&(A.credentials="include"),rG.fetch()(await oG(e,e.config.apiHost,i,o),A)})}async function sG(e,t,i){e._canInitEmulator=!1;const l={...Tle,...t};try{const d=new Ile(e),m=await Promise.race([i(),d.promise]);d.clearNetworkTimeout();const v=await m.json();if("needConfirmation"in v)throw UT(e,"account-exists-with-different-credential",v);if(m.ok&&!("errorMessage"in v))return v;{const o=m.ok?v.errorMessage:v.error.message,[I,A]=o.split(" : ");if(I==="FEDERATED_USER_ID_ALREADY_LINKED")throw UT(e,"credential-already-in-use",v);if(I==="EMAIL_EXISTS")throw UT(e,"email-already-in-use",v);if(I==="USER_DISABLED")throw UT(e,"user-disabled",v);const N=l[I]||I.toLowerCase().replace(/[_\s]+/g,"-");if(A)throw iG(e,N,A);ru(e,N)}}catch(d){if(d instanceof ih)throw d;ru(e,"network-request-failed",{message:String(d)})}}async function ib(e,t,i,l,d={}){const m=await Kf(e,t,i,l,d);return"mfaPendingCredential"in m&&ru(e,"multi-factor-auth-required",{_serverResponse:m}),m}async function oG(e,t,i,l){const d=`${t}${i}?${l}`,m=e,v=m.config.emulator?PD(e.config,d):`${e.config.apiScheme}://${d}`;return Ele.includes(i)&&(await m._persistenceManagerAvailable,m._getPersistenceType()==="COOKIE")?m._getPersistence()._getFinalTarget(v).toString():v}function Cle(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Ile{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((i,l)=>{this.timer=setTimeout(()=>l(Hu(this.auth,"network-request-failed")),Sle.get())})}}function UT(e,t,i){const l={appName:e.name};i.email&&(l.email=i.email),i.phoneNumber&&(l.phoneNumber=i.phoneNumber);const d=Hu(e,t,l);return d.customData._tokenResponse=i,d}function RB(e){return e!==void 0&&e.enterprise!==void 0}class Ale{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===t)return Cle(i.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Ple(e,t){return Kf(e,"GET","/v2/recaptchaConfig",Zf(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rle(e,t){return Kf(e,"POST","/v1/accounts:delete",t)}async function _S(e,t){return Kf(e,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $0(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function Mle(e,t=!1){const i=ta(e),l=await i.getIdToken(t),d=RD(l);Ti(d&&d.exp&&d.auth_time&&d.iat,i.auth,"internal-error");const m=typeof d.firebase=="object"?d.firebase:void 0,v=m==null?void 0:m.sign_in_provider;return{claims:d,token:l,authTime:$0(eP(d.auth_time)),issuedAtTime:$0(eP(d.iat)),expirationTime:$0(eP(d.exp)),signInProvider:v||null,signInSecondFactor:(m==null?void 0:m.sign_in_second_factor)||null}}function eP(e){return Number(e)*1e3}function RD(e){const[t,i,l]=e.split(".");if(t===void 0||i===void 0||l===void 0)return vE("JWT malformed, contained fewer than 3 sections"),null;try{const d=fS(i);return d?JSON.parse(d):(vE("Failed to decode base64 JWT payload"),null)}catch(d){return vE("Caught error parsing JWT payload as JSON",d==null?void 0:d.toString()),null}}function MB(e){const t=RD(e);return Ti(t,"internal-error"),Ti(typeof t.exp<"u","internal-error"),Ti(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I1(e,t,i=!1){if(i)return t;try{return await t}catch(l){throw l instanceof ih&&kle(l)&&e.auth.currentUser===e&&await e.auth.signOut(),l}}function kle({code:e}){return e==="auth/user-disabled"||e==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dle{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){if(t){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const l=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,l)}}schedule(t=!1){if(!this.isRunning)return;const i=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QR{constructor(t,i){this.createdAt=t,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=$0(this.lastLoginAt),this.creationTime=$0(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yS(e){var F;const t=e.auth,i=await e.getIdToken(),l=await I1(e,_S(t,{idToken:i}));Ti(l==null?void 0:l.users.length,t,"internal-error");const d=l.users[0];e._notifyReloadListener(d);const m=(F=d.providerUserInfo)!=null&&F.length?aG(d.providerUserInfo):[],v=Lle(e.providerData,m),o=e.isAnonymous,I=!(e.email&&d.passwordHash)&&!(v!=null&&v.length),A=o?I:!1,N={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:v,metadata:new QR(d.createdAt,d.lastLoginAt),isAnonymous:A};Object.assign(e,N)}async function Nle(e){const t=ta(e);await yS(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function Lle(e,t){return[...e.filter(l=>!t.some(d=>d.providerId===l.providerId)),...t]}function aG(e){return e.map(({providerId:t,...i})=>({providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ole(e,t){const i=await sG(e,{},async()=>{const l=rv({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:d,apiKey:m}=e.config,v=await oG(e,d,"/v1/token",`key=${m}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const I={method:"POST",headers:o,body:l};return e.emulatorConfig&&jm(e.emulatorConfig.host)&&(I.credentials="include"),rG.fetch()(v,I)});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function Fle(e,t){return Kf(e,"POST","/v2/accounts:revokeToken",Zf(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hy{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Ti(t.idToken,"internal-error"),Ti(typeof t.idToken<"u","internal-error"),Ti(typeof t.refreshToken<"u","internal-error");const i="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):MB(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,i)}updateFromIdToken(t){Ti(t.length!==0,"internal-error");const i=MB(t);this.updateTokensAndExpiration(t,null,i)}async getToken(t,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(Ti(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,i){const{accessToken:l,refreshToken:d,expiresIn:m}=await Ole(t,i);this.updateTokensAndExpiration(l,d,Number(m))}updateTokensAndExpiration(t,i,l){this.refreshToken=i||null,this.accessToken=t||null,this.expirationTime=Date.now()+l*1e3}static fromJSON(t,i){const{refreshToken:l,accessToken:d,expirationTime:m}=i,v=new hy;return l&&(Ti(typeof l=="string","internal-error",{appName:t}),v.refreshToken=l),d&&(Ti(typeof d=="string","internal-error",{appName:t}),v.accessToken=d),m&&(Ti(typeof m=="number","internal-error",{appName:t}),v.expirationTime=m),v}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new hy,this.toJSON())}_performRefresh(){return zd("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $h(e,t){Ti(typeof e=="string"||typeof e>"u","internal-error",{appName:t})}class $c{constructor({uid:t,auth:i,stsTokenManager:l,...d}){this.providerId="firebase",this.proactiveRefresh=new Dle(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new QR(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(t){const i=await I1(this,this.stsTokenManager.getToken(this.auth,t));return Ti(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(t){return Mle(this,t)}reload(){return Nle(this)}_assign(t){this!==t&&(Ti(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(i=>({...i})),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const i=new $c({...this,auth:t,stsTokenManager:this.stsTokenManager._clone()});return i.metadata._copy(this.metadata),i}_onReload(t){Ti(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,i=!1){let l=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),l=!0),i&&await yS(this),await this.auth._persistUserIfCurrent(this),l&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(_l(this.auth.app))return Promise.reject(Ud(this.auth));const t=await this.getIdToken();return await I1(this,Rle(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>({...t})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,i){const l=i.displayName??void 0,d=i.email??void 0,m=i.phoneNumber??void 0,v=i.photoURL??void 0,o=i.tenantId??void 0,I=i._redirectEventId??void 0,A=i.createdAt??void 0,N=i.lastLoginAt??void 0,{uid:F,emailVerified:z,isAnonymous:$,providerData:J,stsTokenManager:H}=i;Ti(F&&H,t,"internal-error");const re=hy.fromJSON(this.name,H);Ti(typeof F=="string",t,"internal-error"),$h(l,t.name),$h(d,t.name),Ti(typeof z=="boolean",t,"internal-error"),Ti(typeof $=="boolean",t,"internal-error"),$h(m,t.name),$h(v,t.name),$h(o,t.name),$h(I,t.name),$h(A,t.name),$h(N,t.name);const Q=new $c({uid:F,auth:t,email:d,emailVerified:z,displayName:l,isAnonymous:$,photoURL:v,phoneNumber:m,tenantId:o,stsTokenManager:re,createdAt:A,lastLoginAt:N});return J&&Array.isArray(J)&&(Q.providerData=J.map(ee=>({...ee}))),I&&(Q._redirectEventId=I),Q}static async _fromIdTokenResponse(t,i,l=!1){const d=new hy;d.updateFromServerResponse(i);const m=new $c({uid:i.localId,auth:t,stsTokenManager:d,isAnonymous:l});return await yS(m),m}static async _fromGetAccountInfoResponse(t,i,l){const d=i.users[0];Ti(d.localId!==void 0,"internal-error");const m=d.providerUserInfo!==void 0?aG(d.providerUserInfo):[],v=!(d.email&&d.passwordHash)&&!(m!=null&&m.length),o=new hy;o.updateFromIdToken(l);const I=new $c({uid:d.localId,auth:t,stsTokenManager:o,isAnonymous:v}),A={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:m,metadata:new QR(d.createdAt,d.lastLoginAt),isAnonymous:!(d.email&&d.passwordHash)&&!(m!=null&&m.length)};return Object.assign(I,A),I}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kB=new Map;function jd(e){Yd(e instanceof Function,"Expected a class definition");let t=kB.get(e);return t?(Yd(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,kB.set(e,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lG{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,i){this.storage[t]=i}async _get(t){const i=this.storage[t];return i===void 0?null:i}async _remove(t){delete this.storage[t]}_addListener(t,i){}_removeListener(t,i){}}lG.type="NONE";const DB=lG;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xE(e,t,i){return`firebase:${e}:${t}:${i}`}class fy{constructor(t,i,l){this.persistence=t,this.auth=i,this.userKey=l;const{config:d,name:m}=this.auth;this.fullUserKey=xE(this.userKey,d.apiKey,m),this.fullPersistenceKey=xE("persistence",d.apiKey,m),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);if(!t)return null;if(typeof t=="string"){const i=await _S(this.auth,{idToken:t}).catch(()=>{});return i?$c._fromGetAccountInfoResponse(this.auth,i,t):null}return $c._fromJSON(this.auth,t)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,i,l="authUser"){if(!i.length)return new fy(jd(DB),t,l);const d=(await Promise.all(i.map(async A=>{if(await A._isAvailable())return A}))).filter(A=>A);let m=d[0]||jd(DB);const v=xE(l,t.config.apiKey,t.name);let o=null;for(const A of i)try{const N=await A._get(v);if(N){let F;if(typeof N=="string"){const z=await _S(t,{idToken:N}).catch(()=>{});if(!z)break;F=await $c._fromGetAccountInfoResponse(t,z,N)}else F=$c._fromJSON(t,N);A!==m&&(o=F),m=A;break}}catch{}const I=d.filter(A=>A._shouldAllowMigration);return!m._shouldAllowMigration||!I.length?new fy(m,t,l):(m=I[0],o&&await m._set(v,o.toJSON()),await Promise.all(i.map(async A=>{if(A!==m)try{await A._remove(v)}catch{}})),new fy(m,t,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NB(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(hG(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(cG(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(pG(t))return"Blackberry";if(mG(t))return"Webos";if(uG(t))return"Safari";if((t.includes("chrome/")||dG(t))&&!t.includes("edge/"))return"Chrome";if(fG(t))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,l=e.match(i);if((l==null?void 0:l.length)===2)return l[1]}return"Other"}function cG(e=ba()){return/firefox\//i.test(e)}function uG(e=ba()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function dG(e=ba()){return/crios\//i.test(e)}function hG(e=ba()){return/iemobile/i.test(e)}function fG(e=ba()){return/android/i.test(e)}function pG(e=ba()){return/blackberry/i.test(e)}function mG(e=ba()){return/webos/i.test(e)}function MD(e=ba()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function zle(e=ba()){var t;return MD(e)&&!!((t=window.navigator)!=null&&t.standalone)}function jle(){return Yoe()&&document.documentMode===10}function gG(e=ba()){return MD(e)||fG(e)||mG(e)||pG(e)||/windows phone/i.test(e)||hG(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _G(e,t=[]){let i;switch(e){case"Browser":i=NB(ba());break;case"Worker":i=`${NB(ba())}-${e}`;break;default:i=e}const l=t.length?t.join(","):"FirebaseCore-web";return`${i}/JsCore/${Bm}/${l}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ble{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,i){const l=m=>new Promise((v,o)=>{try{const I=t(m);v(I)}catch(I){o(I)}});l.onAbort=i,this.queue.push(l);const d=this.queue.length-1;return()=>{this.queue[d]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const i=[];try{for(const l of this.queue)await l(t),l.onAbort&&i.push(l.onAbort)}catch(l){i.reverse();for(const d of i)try{d()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:l==null?void 0:l.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vle(e,t={}){return Kf(e,"GET","/v2/passwordPolicy",Zf(e,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ule=6;class $le{constructor(t){var l;const i=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=i.minPasswordLength??Ule,i.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=i.maxPasswordLength),i.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=i.containsLowercaseCharacter),i.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=i.containsUppercaseCharacter),i.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=i.containsNumericCharacter),i.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=i.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((l=t.allowedNonAlphanumericCharacters)==null?void 0:l.join(""))??"",this.forceUpgradeOnSignin=t.forceUpgradeOnSignin??!1,this.schemaVersion=t.schemaVersion}validatePassword(t){const i={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,i),this.validatePasswordCharacterOptions(t,i),i.isValid&&(i.isValid=i.meetsMinPasswordLength??!0),i.isValid&&(i.isValid=i.meetsMaxPasswordLength??!0),i.isValid&&(i.isValid=i.containsLowercaseLetter??!0),i.isValid&&(i.isValid=i.containsUppercaseLetter??!0),i.isValid&&(i.isValid=i.containsNumericCharacter??!0),i.isValid&&(i.isValid=i.containsNonAlphanumericCharacter??!0),i}validatePasswordLengthOptions(t,i){const l=this.customStrengthOptions.minPasswordLength,d=this.customStrengthOptions.maxPasswordLength;l&&(i.meetsMinPasswordLength=t.length>=l),d&&(i.meetsMaxPasswordLength=t.length<=d)}validatePasswordCharacterOptions(t,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let l;for(let d=0;d<t.length;d++)l=t.charAt(d),this.updatePasswordCharacterOptionsStatuses(i,l>="a"&&l<="z",l>="A"&&l<="Z",l>="0"&&l<="9",this.allowedNonAlphanumericCharacters.includes(l))}updatePasswordCharacterOptionsStatuses(t,i,l,d,m){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=l)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=d)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=m))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gle{constructor(t,i,l,d){this.app=t,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=l,this.config=d,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new LB(this),this.idTokenSubscription=new LB(this),this.beforeStateQueue=new Ble(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=nG,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=d.sdkClientVersion,this._persistenceManagerAvailable=new Promise(m=>this._resolvePersistenceManagerAvailable=m)}_initializeWithPersistence(t,i){return i&&(this._popupRedirectResolver=jd(i)),this._initializationPromise=this.queue(async()=>{var l,d,m;if(!this._deleted&&(this.persistenceManager=await fy.create(this,t),(l=this._resolvePersistenceManagerAvailable)==null||l.call(this),!this._deleted)){if((d=this._popupRedirectResolver)!=null&&d._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((m=this.currentUser)==null?void 0:m.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const i=await _S(this,{idToken:t}),l=await $c._fromGetAccountInfoResponse(this,i,t);await this.directlySetCurrentUser(l)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var m;if(_l(this.app)){const v=this.app.settings.authIdToken;return v?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(v).then(o,o))}):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let l=i,d=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const v=(m=this.redirectUser)==null?void 0:m._redirectEventId,o=l==null?void 0:l._redirectEventId,I=await this.tryRedirectSignIn(t);(!v||v===o)&&(I!=null&&I.user)&&(l=I.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(v){l=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(v))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Ti(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(t){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(t){try{await yS(t)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=wle()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(_l(this.app))return Promise.reject(Ud(this));const i=t?ta(t):null;return i&&Ti(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(t,i=!1){if(!this._deleted)return t&&Ti(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return _l(this.app)?Promise.reject(Ud(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return _l(this.app)?Promise.reject(Ud(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(jd(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await Vle(this),i=new $le(t);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(t){this._errorFactory=new tb("auth","Firebase",t())}onAuthStateChanged(t,i,l){return this.registerStateListener(this.authStateSubscription,t,i,l)}beforeAuthStateChanged(t,i){return this.beforeStateQueue.pushCallback(t,i)}onIdTokenChanged(t,i,l){return this.registerStateListener(this.idTokenSubscription,t,i,l)}authStateReady(){return new Promise((t,i)=>{if(this.currentUser)t();else{const l=this.onAuthStateChanged(()=>{l(),t()},i)}})}async revokeAccessToken(t){if(this.currentUser){const i=await this.currentUser.getIdToken(),l={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:i};this.tenantId!=null&&(l.tenantId=this.tenantId),await Fle(this,l)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)==null?void 0:t.toJSON()}}async _setRedirectUser(t,i){const l=await this.getOrInitRedirectPersistenceManager(i);return t===null?l.removeCurrentUser():l.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const i=t&&jd(t)||this._popupRedirectResolver;Ti(i,this,"argument-error"),this.redirectPersistenceManager=await fy.create(this,[jd(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var i,l;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)==null?void 0:i._redirectEventId)===t?this._currentUser:((l=this.redirectUser)==null?void 0:l._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const t=((i=this.currentUser)==null?void 0:i.uid)??null;this.lastNotifiedUid!==t&&(this.lastNotifiedUid=t,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,i,l,d){if(this._deleted)return()=>{};const m=typeof i=="function"?i:i.next.bind(i);let v=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ti(o,this,"internal-error"),o.then(()=>{v||m(this.currentUser)}),typeof i=="function"){const I=t.addObserver(i,l,d);return()=>{v=!0,I()}}else{const I=t.addObserver(i);return()=>{v=!0,I()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Ti(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=_G(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var d;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const i=await((d=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:d.getHeartbeatsHeader());i&&(t["X-Firebase-Client"]=i);const l=await this._getAppCheckToken();return l&&(t["X-Firebase-AppCheck"]=l),t}async _getAppCheckToken(){var i;if(_l(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await((i=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:i.getToken());return t!=null&&t.error&&vle(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Vm(e){return ta(e)}class LB{constructor(t){this.auth=t,this.observer=null,this.addObserver=oae(i=>this.observer=i)}get next(){return Ti(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let PC={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Hle(e){PC=e}function yG(e){return PC.loadJS(e)}function Wle(){return PC.recaptchaEnterpriseScript}function qle(){return PC.gapiScript}function Zle(e){return`__${e}${Math.floor(Math.random()*1e6)}`}class Kle{constructor(){this.enterprise=new Xle}ready(t){t()}execute(t,i){return Promise.resolve("token")}render(t,i){return""}}class Xle{ready(t){t()}execute(t,i){return Promise.resolve("token")}render(t,i){return""}}const Yle="recaptcha-enterprise",vG="NO_RECAPTCHA";class Qle{constructor(t){this.type=Yle,this.auth=Vm(t)}async verify(t="verify",i=!1){async function l(m){if(!i){if(m.tenantId==null&&m._agentRecaptchaConfig!=null)return m._agentRecaptchaConfig.siteKey;if(m.tenantId!=null&&m._tenantRecaptchaConfigs[m.tenantId]!==void 0)return m._tenantRecaptchaConfigs[m.tenantId].siteKey}return new Promise(async(v,o)=>{Ple(m,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(I=>{if(I.recaptchaKey===void 0)o(new Error("recaptcha Enterprise site key undefined"));else{const A=new Ale(I);return m.tenantId==null?m._agentRecaptchaConfig=A:m._tenantRecaptchaConfigs[m.tenantId]=A,v(A.siteKey)}}).catch(I=>{o(I)})})}function d(m,v,o){const I=window.grecaptcha;RB(I)?I.enterprise.ready(()=>{I.enterprise.execute(m,{action:t}).then(A=>{v(A)}).catch(()=>{v(vG)})}):o(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Kle().execute("siteKey",{action:"verify"}):new Promise((m,v)=>{l(this.auth).then(o=>{if(!i&&RB(window.grecaptcha))d(o,m,v);else{if(typeof window>"u"){v(new Error("RecaptchaVerifier is only supported in browser"));return}let I=Wle();I.length!==0&&(I+=o),yG(I).then(()=>{d(o,m,v)}).catch(A=>{v(A)})}}).catch(o=>{v(o)})})}}async function OB(e,t,i,l=!1,d=!1){const m=new Qle(e);let v;if(d)v=vG;else try{v=await m.verify(i)}catch{v=await m.verify(i,!0)}const o={...t};if(i==="mfaSmsEnrollment"||i==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in o){const I=o.phoneEnrollmentInfo.phoneNumber,A=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:I,recaptchaToken:A,captchaResponse:v,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const I=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:I,captchaResponse:v,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return l?Object.assign(o,{captchaResp:v}):Object.assign(o,{captchaResponse:v}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function JR(e,t,i,l,d){var m;if((m=e._getRecaptchaConfig())!=null&&m.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const v=await OB(e,t,i,i==="getOobCode");return l(e,v)}else return l(e,t).catch(async v=>{if(v.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await OB(e,t,i,i==="getOobCode");return l(e,o)}else return Promise.reject(v)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jle(e,t){const i=AC(e,"auth");if(i.isInitialized()){const d=i.getImmediate(),m=i.getOptions();if(Em(m,t??{}))return d;ru(d,"already-initialized")}return i.initialize({options:t})}function ece(e,t){const i=(t==null?void 0:t.persistence)||[],l=(Array.isArray(i)?i:[i]).map(jd);t!=null&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(l,t==null?void 0:t.popupRedirectResolver)}function tce(e,t,i){const l=Vm(e);Ti(/^https?:\/\//.test(t),l,"invalid-emulator-scheme");const d=!!(i!=null&&i.disableWarnings),m=xG(t),{host:v,port:o}=nce(t),I=o===null?"":`:${o}`,A={url:`${m}//${v}${I}/`},N=Object.freeze({host:v,port:o,protocol:m.replace(":",""),options:Object.freeze({disableWarnings:d})});if(!l._canInitEmulator){Ti(l.config.emulator&&l.emulatorConfig,l,"emulator-config-failed"),Ti(Em(A,l.config.emulator)&&Em(N,l.emulatorConfig),l,"emulator-config-failed");return}l.config.emulator=A,l.emulatorConfig=N,l.settings.appVerificationDisabledForTesting=!0,jm(v)?(wD(`${m}//${v}${I}`),TD("Auth",!0)):ice()}function xG(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function nce(e){const t=xG(e),i=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!i)return{host:"",port:null};const l=i[2].split("@").pop()||"",d=/^(\[[^\]]+\])(:|$)/.exec(l);if(d){const m=d[1];return{host:m,port:FB(l.substr(m.length+1))}}else{const[m,v]=l.split(":");return{host:m,port:FB(v)}}}function FB(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}function ice(){function e(){const t=document.createElement("p"),i=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",e):e())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kD{constructor(t,i){this.providerId=t,this.signInMethod=i}toJSON(){return zd("not implemented")}_getIdTokenResponse(t){return zd("not implemented")}_linkToIdToken(t,i){return zd("not implemented")}_getReauthenticationResolver(t){return zd("not implemented")}}async function rce(e,t){return Kf(e,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sce(e,t){return ib(e,"POST","/v1/accounts:signInWithPassword",Zf(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oce(e,t){return ib(e,"POST","/v1/accounts:signInWithEmailLink",Zf(e,t))}async function ace(e,t){return ib(e,"POST","/v1/accounts:signInWithEmailLink",Zf(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A1 extends kD{constructor(t,i,l,d=null){super("password",l),this._email=t,this._password=i,this._tenantId=d}static _fromEmailAndPassword(t,i){return new A1(t,i,"password")}static _fromEmailAndCode(t,i,l=null){return new A1(t,i,"emailLink",l)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const i=typeof t=="string"?JSON.parse(t):t;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return JR(t,i,"signInWithPassword",sce);case"emailLink":return oce(t,{email:this._email,oobCode:this._password});default:ru(t,"internal-error")}}async _linkToIdToken(t,i){switch(this.signInMethod){case"password":const l={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return JR(t,l,"signUpPassword",rce);case"emailLink":return ace(t,{idToken:i,email:this._email,oobCode:this._password});default:ru(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function py(e,t){return ib(e,"POST","/v1/accounts:signInWithIdp",Zf(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lce="http://localhost";class Cm extends kD{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const i=new Cm(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(i.idToken=t.idToken),t.accessToken&&(i.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(i.nonce=t.nonce),t.pendingToken&&(i.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(i.accessToken=t.oauthToken,i.secret=t.oauthTokenSecret):ru("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const i=typeof t=="string"?JSON.parse(t):t,{providerId:l,signInMethod:d,...m}=i;if(!l||!d)return null;const v=new Cm(l,d);return v.idToken=m.idToken||void 0,v.accessToken=m.accessToken||void 0,v.secret=m.secret,v.nonce=m.nonce,v.pendingToken=m.pendingToken||null,v}_getIdTokenResponse(t){const i=this.buildRequest();return py(t,i)}_linkToIdToken(t,i){const l=this.buildRequest();return l.idToken=i,py(t,l)}_getReauthenticationResolver(t){const i=this.buildRequest();return i.autoCreate=!1,py(t,i)}buildRequest(){const t={requestUri:lce,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),t.postBody=rv(i)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cce(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function uce(e){const t=A0(P0(e)).link,i=t?A0(P0(t)).deep_link_id:null,l=A0(P0(e)).deep_link_id;return(l?A0(P0(l)).link:null)||l||i||t||e}class DD{constructor(t){const i=A0(P0(t)),l=i.apiKey??null,d=i.oobCode??null,m=cce(i.mode??null);Ti(l&&d&&m,"argument-error"),this.apiKey=l,this.operation=m,this.code=d,this.continueUrl=i.continueUrl??null,this.languageCode=i.lang??null,this.tenantId=i.tenantId??null}static parseLink(t){const i=uce(t);try{return new DD(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sv{constructor(){this.providerId=sv.PROVIDER_ID}static credential(t,i){return A1._fromEmailAndPassword(t,i)}static credentialWithLink(t,i){const l=DD.parseLink(i);return Ti(l,"argument-error"),A1._fromEmailAndCode(t,l.code,l.tenantId)}}sv.PROVIDER_ID="password";sv.EMAIL_PASSWORD_SIGN_IN_METHOD="password";sv.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bG{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rb extends bG{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yh extends rb{constructor(){super("facebook.com")}static credential(t){return Cm._fromParams({providerId:Yh.PROVIDER_ID,signInMethod:Yh.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Yh.credentialFromTaggedObject(t)}static credentialFromError(t){return Yh.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Yh.credential(t.oauthAccessToken)}catch{return null}}}Yh.FACEBOOK_SIGN_IN_METHOD="facebook.com";Yh.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qh extends rb{constructor(){super("google.com"),this.addScope("profile")}static credential(t,i){return Cm._fromParams({providerId:Qh.PROVIDER_ID,signInMethod:Qh.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:i})}static credentialFromResult(t){return Qh.credentialFromTaggedObject(t)}static credentialFromError(t){return Qh.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:i,oauthAccessToken:l}=t;if(!i&&!l)return null;try{return Qh.credential(i,l)}catch{return null}}}Qh.GOOGLE_SIGN_IN_METHOD="google.com";Qh.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jh extends rb{constructor(){super("github.com")}static credential(t){return Cm._fromParams({providerId:Jh.PROVIDER_ID,signInMethod:Jh.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Jh.credentialFromTaggedObject(t)}static credentialFromError(t){return Jh.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Jh.credential(t.oauthAccessToken)}catch{return null}}}Jh.GITHUB_SIGN_IN_METHOD="github.com";Jh.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ef extends rb{constructor(){super("twitter.com")}static credential(t,i){return Cm._fromParams({providerId:ef.PROVIDER_ID,signInMethod:ef.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:i})}static credentialFromResult(t){return ef.credentialFromTaggedObject(t)}static credentialFromError(t){return ef.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:i,oauthTokenSecret:l}=t;if(!i||!l)return null;try{return ef.credential(i,l)}catch{return null}}}ef.TWITTER_SIGN_IN_METHOD="twitter.com";ef.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dce(e,t){return ib(e,"POST","/v1/accounts:signUp",Zf(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Im{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,i,l,d=!1){const m=await $c._fromIdTokenResponse(t,l,d),v=zB(l);return new Im({user:m,providerId:v,_tokenResponse:l,operationType:i})}static async _forOperation(t,i,l){await t._updateTokensIfNecessary(l,!0);const d=zB(l);return new Im({user:t,providerId:d,_tokenResponse:l,operationType:i})}}function zB(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vS extends ih{constructor(t,i,l,d){super(i.code,i.message),this.operationType=l,this.user=d,Object.setPrototypeOf(this,vS.prototype),this.customData={appName:t.name,tenantId:t.tenantId??void 0,_serverResponse:i.customData._serverResponse,operationType:l}}static _fromErrorAndOperation(t,i,l,d){return new vS(t,i,l,d)}}function wG(e,t,i,l){return(t==="reauthenticate"?i._getReauthenticationResolver(e):i._getIdTokenResponse(e)).catch(m=>{throw m.code==="auth/multi-factor-auth-required"?vS._fromErrorAndOperation(e,m,t,l):m})}async function hce(e,t,i=!1){const l=await I1(e,t._linkToIdToken(e.auth,await e.getIdToken()),i);return Im._forOperation(e,"link",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fce(e,t,i=!1){const{auth:l}=e;if(_l(l.app))return Promise.reject(Ud(l));const d="reauthenticate";try{const m=await I1(e,wG(l,d,t,e),i);Ti(m.idToken,l,"internal-error");const v=RD(m.idToken);Ti(v,l,"internal-error");const{sub:o}=v;return Ti(e.uid===o,l,"user-mismatch"),Im._forOperation(e,d,m)}catch(m){throw(m==null?void 0:m.code)==="auth/user-not-found"&&ru(l,"user-mismatch"),m}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TG(e,t,i=!1){if(_l(e.app))return Promise.reject(Ud(e));const l="signIn",d=await wG(e,l,t),m=await Im._fromIdTokenResponse(e,l,d);return i||await e._updateCurrentUser(m.user),m}async function pce(e,t){return TG(Vm(e),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EG(e){const t=Vm(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function ND(e,t,i){if(_l(e.app))return Promise.reject(Ud(e));const l=Vm(e),v=await JR(l,{returnSecureToken:!0,email:t,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",dce).catch(I=>{throw I.code==="auth/password-does-not-meet-requirements"&&EG(e),I}),o=await Im._fromIdTokenResponse(l,"signIn",v);return await l._updateCurrentUser(o.user),o}function SG(e,t,i){return _l(e.app)?Promise.reject(Ud(e)):pce(ta(e),sv.credential(t,i)).catch(async l=>{throw l.code==="auth/password-does-not-meet-requirements"&&EG(e),l})}function mce(e,t,i,l){return ta(e).onIdTokenChanged(t,i,l)}function gce(e,t,i){return ta(e).beforeAuthStateChanged(t,i)}function _ce(e){return ta(e).signOut()}const xS="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CG{constructor(t,i){this.storageRetriever=t,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(xS,"1"),this.storage.removeItem(xS),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,i){return this.storage.setItem(t,JSON.stringify(i)),Promise.resolve()}_get(t){const i=this.storage.getItem(t);return Promise.resolve(i?JSON.parse(i):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yce=1e3,vce=10;class IG extends CG{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,i)=>this.onStorageEvent(t,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=gG(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const i of Object.keys(this.listeners)){const l=this.storage.getItem(i),d=this.localCache[i];l!==d&&t(i,d,l)}}onStorageEvent(t,i=!1){if(!t.key){this.forAllChangedKeys((v,o,I)=>{this.notifyListeners(v,I)});return}const l=t.key;i?this.detachListener():this.stopPolling();const d=()=>{const v=this.storage.getItem(l);!i&&this.localCache[l]===v||this.notifyListeners(l,v)},m=this.storage.getItem(l);jle()&&m!==t.newValue&&t.newValue!==t.oldValue?setTimeout(d,vce):d()}notifyListeners(t,i){this.localCache[t]=i;const l=this.listeners[t];if(l)for(const d of Array.from(l))d(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,i,l)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:i,newValue:l}),!0)})},yce)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,i){await super._set(t,i),this.localCache[t]=JSON.stringify(i)}async _get(t){const i=await super._get(t);return this.localCache[t]=JSON.stringify(i),i}async _remove(t){await super._remove(t),delete this.localCache[t]}}IG.type="LOCAL";const xce=IG;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AG extends CG{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,i){}_removeListener(t,i){}}AG.type="SESSION";const PG=AG;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bce(e){return Promise.all(e.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RC{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const i=this.receivers.find(d=>d.isListeningto(t));if(i)return i;const l=new RC(t);return this.receivers.push(l),l}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const i=t,{eventId:l,eventType:d,data:m}=i.data,v=this.handlersMap[d];if(!(v!=null&&v.size))return;i.ports[0].postMessage({status:"ack",eventId:l,eventType:d});const o=Array.from(v).map(async A=>A(i.origin,m)),I=await bce(o);i.ports[0].postMessage({status:"done",eventId:l,eventType:d,response:I})}_subscribe(t,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(i)}_unsubscribe(t,i){this.handlersMap[t]&&i&&this.handlersMap[t].delete(i),(!i||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}RC.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LD(e="",t=10){let i="";for(let l=0;l<t;l++)i+=Math.floor(Math.random()*10);return e+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wce{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,i,l=50){const d=typeof MessageChannel<"u"?new MessageChannel:null;if(!d)throw new Error("connection_unavailable");let m,v;return new Promise((o,I)=>{const A=LD("",20);d.port1.start();const N=setTimeout(()=>{I(new Error("unsupported_event"))},l);v={messageChannel:d,onMessage(F){const z=F;if(z.data.eventId===A)switch(z.data.status){case"ack":clearTimeout(N),m=setTimeout(()=>{I(new Error("timeout"))},3e3);break;case"done":clearTimeout(m),o(z.data.response);break;default:clearTimeout(N),clearTimeout(m),I(new Error("invalid_response"));break}}},this.handlers.add(v),d.port1.addEventListener("message",v.onMessage),this.target.postMessage({eventType:t,eventId:A,data:i},[d.port2])}).finally(()=>{v&&this.removeMessageHandler(v)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wu(){return window}function Tce(e){Wu().location.href=e}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RG(){return typeof Wu().WorkerGlobalScope<"u"&&typeof Wu().importScripts=="function"}async function Ece(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Sce(){var e;return((e=navigator==null?void 0:navigator.serviceWorker)==null?void 0:e.controller)||null}function Cce(){return RG()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MG="firebaseLocalStorageDb",Ice=1,bS="firebaseLocalStorage",kG="fbase_key";class sb{constructor(t){this.request=t}toPromise(){return new Promise((t,i)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function MC(e,t){return e.transaction([bS],t?"readwrite":"readonly").objectStore(bS)}function Ace(){const e=indexedDB.deleteDatabase(MG);return new sb(e).toPromise()}function eM(){const e=indexedDB.open(MG,Ice);return new Promise((t,i)=>{e.addEventListener("error",()=>{i(e.error)}),e.addEventListener("upgradeneeded",()=>{const l=e.result;try{l.createObjectStore(bS,{keyPath:kG})}catch(d){i(d)}}),e.addEventListener("success",async()=>{const l=e.result;l.objectStoreNames.contains(bS)?t(l):(l.close(),await Ace(),t(await eM()))})})}async function jB(e,t,i){const l=MC(e,!0).put({[kG]:t,value:i});return new sb(l).toPromise()}async function Pce(e,t){const i=MC(e,!1).get(t),l=await new sb(i).toPromise();return l===void 0?null:l.value}function BB(e,t){const i=MC(e,!0).delete(t);return new sb(i).toPromise()}const Rce=800,Mce=3;class DG{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await eM(),this.db)}async _withRetries(t){let i=0;for(;;)try{const l=await this._openDb();return await t(l)}catch(l){if(i++>Mce)throw l;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return RG()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=RC._getInstance(Cce()),this.receiver._subscribe("keyChanged",async(t,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(t,i)=>["keyChanged"])}async initializeSender(){var i,l;if(this.activeServiceWorker=await Ece(),!this.activeServiceWorker)return;this.sender=new wce(this.activeServiceWorker);const t=await this.sender._send("ping",{},800);t&&(i=t[0])!=null&&i.fulfilled&&(l=t[0])!=null&&l.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||Sce()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await eM();return await jB(t,xS,"1"),await BB(t,xS),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,i){return this._withPendingWrite(async()=>(await this._withRetries(l=>jB(l,t,i)),this.localCache[t]=i,this.notifyServiceWorker(t)))}async _get(t){const i=await this._withRetries(l=>Pce(l,t));return this.localCache[t]=i,i}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(i=>BB(i,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(d=>{const m=MC(d,!1).getAll();return new sb(m).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const i=[],l=new Set;if(t.length!==0)for(const{fbase_key:d,value:m}of t)l.add(d),JSON.stringify(this.localCache[d])!==JSON.stringify(m)&&(this.notifyListeners(d,m),i.push(d));for(const d of Object.keys(this.localCache))this.localCache[d]&&!l.has(d)&&(this.notifyListeners(d,null),i.push(d));return i}notifyListeners(t,i){this.localCache[t]=i;const l=this.listeners[t];if(l)for(const d of Array.from(l))d(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Rce)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}DG.type="LOCAL";const kce=DG;new nb(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dce(e,t){return t?jd(t):(Ti(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD extends kD{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return py(t,this._buildIdpRequest())}_linkToIdToken(t,i){return py(t,this._buildIdpRequest(i))}_getReauthenticationResolver(t){return py(t,this._buildIdpRequest())}_buildIdpRequest(t){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(i.idToken=t),i}}function Nce(e){return TG(e.auth,new OD(e),e.bypassAuthState)}function Lce(e){const{auth:t,user:i}=e;return Ti(i,t,"internal-error"),fce(i,new OD(e),e.bypassAuthState)}async function Oce(e){const{auth:t,user:i}=e;return Ti(i,t,"internal-error"),hce(i,new OD(e),e.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NG{constructor(t,i,l,d,m=!1){this.auth=t,this.resolver=l,this.user=d,this.bypassAuthState=m,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(t,i)=>{this.pendingPromise={resolve:t,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(l){this.reject(l)}})}async onAuthEvent(t){const{urlResponse:i,sessionId:l,postBody:d,tenantId:m,error:v,type:o}=t;if(v){this.reject(v);return}const I={auth:this.auth,requestUri:i,sessionId:l,tenantId:m||void 0,postBody:d||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(I))}catch(A){this.reject(A)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return Nce;case"linkViaPopup":case"linkViaRedirect":return Oce;case"reauthViaPopup":case"reauthViaRedirect":return Lce;default:ru(this.auth,"internal-error")}}resolve(t){Yd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Yd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fce=new nb(2e3,1e4);class Z_ extends NG{constructor(t,i,l,d,m){super(t,i,d,m),this.provider=l,this.authWindow=null,this.pollId=null,Z_.currentPopupAction&&Z_.currentPopupAction.cancel(),Z_.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Ti(t,this.auth,"internal-error"),t}async onExecution(){Yd(this.filter.length===1,"Popup operations only handle one event");const t=LD();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(Hu(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)==null?void 0:t.associatedEvent)||null}cancel(){this.reject(Hu(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Z_.currentPopupAction=null}pollUserCancellation(){const t=()=>{var i,l;if((l=(i=this.authWindow)==null?void 0:i.window)!=null&&l.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Hu(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,Fce.get())};t()}}Z_.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zce="pendingRedirect",bE=new Map;class jce extends NG{constructor(t,i,l=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,l),this.eventId=null}async execute(){let t=bE.get(this.auth._key());if(!t){try{const l=await Bce(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(l)}catch(i){t=()=>Promise.reject(i)}bE.set(this.auth._key(),t)}return this.bypassAuthState||bE.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const i=await this.auth._redirectUserForId(t.eventId);if(i)return this.user=i,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Bce(e,t){const i=$ce(t),l=Uce(e);if(!await l._isAvailable())return!1;const d=await l._get(i)==="true";return await l._remove(i),d}function Vce(e,t){bE.set(e._key(),t)}function Uce(e){return jd(e._redirectPersistence)}function $ce(e){return xE(zce,e.config.apiKey,e.name)}async function Gce(e,t,i=!1){if(_l(e.app))return Promise.reject(Ud(e));const l=Vm(e),d=Dce(l,t),v=await new jce(l,d,i).execute();return v&&!i&&(delete v.user._redirectEventId,await l._persistUserIfCurrent(v.user),await l._setRedirectUser(null,t)),v}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hce=10*60*1e3;class Wce{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let i=!1;return this.consumers.forEach(l=>{this.isEventForConsumer(t,l)&&(i=!0,this.sendToConsumer(t,l),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!qce(t)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=t,i=!0)),i}sendToConsumer(t,i){var l;if(t.error&&!LG(t)){const d=((l=t.error.code)==null?void 0:l.split("auth/")[1])||"internal-error";i.onError(Hu(this.auth,d))}else i.onAuthEvent(t)}isEventForConsumer(t,i){const l=i.eventId===null||!!t.eventId&&t.eventId===i.eventId;return i.filter.includes(t.type)&&l}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=Hce&&this.cachedEventUids.clear(),this.cachedEventUids.has(VB(t))}saveEventToCache(t){this.cachedEventUids.add(VB(t)),this.lastProcessedEventTime=Date.now()}}function VB(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(t=>t).join("-")}function LG({type:e,error:t}){return e==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function qce(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return LG(e);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zce(e,t={}){return Kf(e,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kce=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Xce=/^https?/;async function Yce(e){if(e.config.emulator)return;const{authorizedDomains:t}=await Zce(e);for(const i of t)try{if(Qce(i))return}catch{}ru(e,"unauthorized-domain")}function Qce(e){const t=YR(),{protocol:i,hostname:l}=new URL(t);if(e.startsWith("chrome-extension://")){const v=new URL(e);return v.hostname===""&&l===""?i==="chrome-extension:"&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):i==="chrome-extension:"&&v.hostname===l}if(!Xce.test(i))return!1;if(Kce.test(e))return l===e;const d=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+d+"|"+d+")$","i").test(l)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jce=new nb(3e4,6e4);function UB(){const e=Wu().___jsl;if(e!=null&&e.H){for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let i=0;i<e.CP.length;i++)e.CP[i]=null}}function eue(e){return new Promise((t,i)=>{var d,m,v;function l(){UB(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{UB(),i(Hu(e,"network-request-failed"))},timeout:Jce.get()})}if((m=(d=Wu().gapi)==null?void 0:d.iframes)!=null&&m.Iframe)t(gapi.iframes.getContext());else if((v=Wu().gapi)!=null&&v.load)l();else{const o=Zle("iframefcb");return Wu()[o]=()=>{gapi.load?l():i(Hu(e,"network-request-failed"))},yG(`${qle()}?onload=${o}`).catch(I=>i(I))}}).catch(t=>{throw wE=null,t})}let wE=null;function tue(e){return wE=wE||eue(e),wE}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nue=new nb(5e3,15e3),iue="__/auth/iframe",rue="emulator/auth/iframe",sue={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},oue=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function aue(e){const t=e.config;Ti(t.authDomain,e,"auth-domain-config-required");const i=t.emulator?PD(t,rue):`https://${e.config.authDomain}/${iue}`,l={apiKey:t.apiKey,appName:e.name,v:Bm},d=oue.get(e.config.apiHost);d&&(l.eid=d);const m=e._getFrameworks();return m.length&&(l.fw=m.join(",")),`${i}?${rv(l).slice(1)}`}async function lue(e){const t=await tue(e),i=Wu().gapi;return Ti(i,e,"internal-error"),t.open({where:document.body,url:aue(e),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:sue,dontclear:!0},l=>new Promise(async(d,m)=>{await l.restyle({setHideOnLeave:!1});const v=Hu(e,"network-request-failed"),o=Wu().setTimeout(()=>{m(v)},nue.get());function I(){Wu().clearTimeout(o),d(l)}l.ping(I).then(I,()=>{m(v)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cue={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},uue=500,due=600,hue="_blank",fue="http://localhost";class $B{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function pue(e,t,i,l=uue,d=due){const m=Math.max((window.screen.availHeight-d)/2,0).toString(),v=Math.max((window.screen.availWidth-l)/2,0).toString();let o="";const I={...cue,width:l.toString(),height:d.toString(),top:m,left:v},A=ba().toLowerCase();i&&(o=dG(A)?hue:i),cG(A)&&(t=t||fue,I.scrollbars="yes");const N=Object.entries(I).reduce((z,[$,J])=>`${z}${$}=${J},`,"");if(zle(A)&&o!=="_self")return mue(t||"",o),new $B(null);const F=window.open(t||"",o,N);Ti(F,e,"popup-blocked");try{F.focus()}catch{}return new $B(F)}function mue(e,t){const i=document.createElement("a");i.href=e,i.target=t;const l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(l)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gue="__/auth/handler",_ue="emulator/auth/handler",yue=encodeURIComponent("fac");async function GB(e,t,i,l,d,m){Ti(e.config.authDomain,e,"auth-domain-config-required"),Ti(e.config.apiKey,e,"invalid-api-key");const v={apiKey:e.config.apiKey,appName:e.name,authType:i,redirectUrl:l,v:Bm,eventId:d};if(t instanceof bG){t.setDefaultLanguage(e.languageCode),v.providerId=t.providerId||"",HR(t.getCustomParameters())||(v.customParameters=JSON.stringify(t.getCustomParameters()));for(const[N,F]of Object.entries({}))v[N]=F}if(t instanceof rb){const N=t.getScopes().filter(F=>F!=="");N.length>0&&(v.scopes=N.join(","))}e.tenantId&&(v.tid=e.tenantId);const o=v;for(const N of Object.keys(o))o[N]===void 0&&delete o[N];const I=await e._getAppCheckToken(),A=I?`#${yue}=${encodeURIComponent(I)}`:"";return`${vue(e)}?${rv(o).slice(1)}${A}`}function vue({config:e}){return e.emulator?PD(e,_ue):`https://${e.authDomain}/${gue}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tP="webStorageSupport";class xue{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=PG,this._completeRedirectFn=Gce,this._overrideRedirectResult=Vce}async _openPopup(t,i,l,d){var v;Yd((v=this.eventManagers[t._key()])==null?void 0:v.manager,"_initialize() not called before _openPopup()");const m=await GB(t,i,l,YR(),d);return pue(t,m,LD())}async _openRedirect(t,i,l,d){await this._originValidation(t);const m=await GB(t,i,l,YR(),d);return Tce(m),new Promise(()=>{})}_initialize(t){const i=t._key();if(this.eventManagers[i]){const{manager:d,promise:m}=this.eventManagers[i];return d?Promise.resolve(d):(Yd(m,"If manager is not set, promise should be"),m)}const l=this.initAndGetManager(t);return this.eventManagers[i]={promise:l},l.catch(()=>{delete this.eventManagers[i]}),l}async initAndGetManager(t){const i=await lue(t),l=new Wce(t);return i.register("authEvent",d=>(Ti(d==null?void 0:d.authEvent,t,"invalid-auth-event"),{status:l.onEvent(d.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:l},this.iframes[t._key()]=i,l}_isIframeWebStorageSupported(t,i){this.iframes[t._key()].send(tP,{type:tP},d=>{var v;const m=(v=d==null?void 0:d[0])==null?void 0:v[tP];m!==void 0&&i(!!m),ru(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const i=t._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=Yce(t)),this.originValidationPromises[i]}get _shouldInitProactively(){return gG()||uG()||MD()}}const bue=xue;var HB="@firebase/auth",WB="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wue{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)==null?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const i=this.auth.onIdTokenChanged(l=>{t((l==null?void 0:l.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,i),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const i=this.internalListeners.get(t);i&&(this.internalListeners.delete(t),i(),this.updateProactiveRefresh())}assertAuthConfigured(){Ti(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tue(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Eue(e){Sm(new Lf("auth",(t,{options:i})=>{const l=t.getProvider("app").getImmediate(),d=t.getProvider("heartbeat"),m=t.getProvider("app-check-internal"),{apiKey:v,authDomain:o}=l.options;Ti(v&&!v.includes(":"),"invalid-api-key",{appName:l.name});const I={apiKey:v,authDomain:o,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_G(e)},A=new Gle(l,d,m,I);return ece(A,i),A},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,i,l)=>{t.getProvider("auth-internal").initialize()})),Sm(new Lf("auth-internal",t=>{const i=Vm(t.getProvider("auth").getImmediate());return(l=>new wue(l))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),Gu(HB,WB,Tue(e)),Gu(HB,WB,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sue=5*60,Cue=H$("authIdTokenMaxAge")||Sue;let qB=null;const Iue=e=>async t=>{const i=t&&await t.getIdTokenResult(),l=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(l&&l>Cue)return;const d=i==null?void 0:i.token;qB!==d&&(qB=d,await fetch(e,{method:d?"POST":"DELETE",headers:d?{Authorization:`Bearer ${d}`}:{}}))};function Aue(e=ID()){const t=AC(e,"auth");if(t.isInitialized())return t.getImmediate();const i=Jle(e,{popupRedirectResolver:bue,persistence:[kce,xce,PG]}),l=H$("authTokenSyncURL");if(l&&typeof isSecureContext=="boolean"&&isSecureContext){const m=new URL(l,location.origin);if(location.origin===m.origin){const v=Iue(m.toString());gce(i,v,()=>v(i.currentUser)),mce(i,o=>v(o))}}const d=U$("auth");return d&&tce(i,`http://${d}`),i}function Pue(){var e;return((e=document.getElementsByTagName("head"))==null?void 0:e[0])??document}Hle({loadJS(e){return new Promise((t,i)=>{const l=document.createElement("script");l.setAttribute("src",e),l.onload=t,l.onerror=d=>{const m=Hu("internal-error");m.customData=d,i(m)},l.type="text/javascript",l.charset="UTF-8",Pue().appendChild(l)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Eue("Browser");var ZB={};const KB="@firebase/database",XB="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let OG="";function Rue(e){OG=e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mue{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,i){i==null?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),uo(i))}get(t){const i=this.domStorage_.getItem(this.prefixedName_(t));return i==null?null:S1(i)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kue{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,i){i==null?delete this.cache_[t]:this.cache_[t]=i}get(t){return ed(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FG=function(e){try{if(typeof window<"u"&&typeof window[e]<"u"){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Mue(t)}}catch{}return new kue},rm=FG("localStorage"),Due=FG("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const my=new SD("@firebase/database"),Nue=function(){let e=1;return function(){return e++}}(),zG=function(e){const t=cae(e),i=new sae;i.update(t);const l=i.digest();return xD.encodeByteArray(l)},ob=function(...e){let t="";for(let i=0;i<e.length;i++){const l=e[i];Array.isArray(l)||l&&typeof l=="object"&&typeof l.length=="number"?t+=ob.apply(null,l):typeof l=="object"?t+=uo(l):t+=l,t+=" "}return t};let G0=null,YB=!0;const Lue=function(e,t){hn(!t,"Can't turn on custom loggers persistently."),my.logLevel=qr.VERBOSE,G0=my.log.bind(my)},zo=function(...e){if(YB===!0&&(YB=!1,G0===null&&Due.get("logging_enabled")===!0&&Lue()),G0){const t=ob.apply(null,e);G0(t)}},ab=function(e){return function(...t){zo(e,...t)}},tM=function(...e){const t="FIREBASE INTERNAL ERROR: "+ob(...e);my.error(t)},Qd=function(...e){const t=`FIREBASE FATAL ERROR: ${ob(...e)}`;throw my.error(t),new Error(t)},va=function(...e){const t="FIREBASE WARNING: "+ob(...e);my.warn(t)},Oue=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&va("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},FD=function(e){return typeof e=="number"&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},Fue=function(e){if(document.readyState==="complete")e();else{let t=!1;const i=function(){if(!document.body){setTimeout(i,Math.floor(10));return}t||(t=!0,e())};document.addEventListener?(document.addEventListener("DOMContentLoaded",i,!1),window.addEventListener("load",i,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&i()}),window.attachEvent("onload",i))}},jy="[MIN_NAME]",Am="[MAX_NAME]",Um=function(e,t){if(e===t)return 0;if(e===jy||t===Am)return-1;if(t===jy||e===Am)return 1;{const i=QB(e),l=QB(t);return i!==null?l!==null?i-l===0?e.length-t.length:i-l:-1:l!==null?1:e<t?-1:1}},zue=function(e,t){return e===t?0:e<t?-1:1},y0=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+uo(t))},zD=function(e){if(typeof e!="object"||e===null)return uo(e);const t=[];for(const l in e)t.push(l);t.sort();let i="{";for(let l=0;l<t.length;l++)l!==0&&(i+=","),i+=uo(t[l]),i+=":",i+=zD(e[t[l]]);return i+="}",i},jG=function(e,t){const i=e.length;if(i<=t)return[e];const l=[];for(let d=0;d<i;d+=t)d+t>i?l.push(e.substring(d,i)):l.push(e.substring(d,d+t));return l};function Vo(e,t){for(const i in e)e.hasOwnProperty(i)&&t(i,e[i])}const BG=function(e){hn(!FD(e),"Invalid JSON number");const t=11,i=52,l=(1<<t-1)-1;let d,m,v,o,I;e===0?(m=0,v=0,d=1/e===-1/0?1:0):(d=e<0,e=Math.abs(e),e>=Math.pow(2,1-l)?(o=Math.min(Math.floor(Math.log(e)/Math.LN2),l),m=o+l,v=Math.round(e*Math.pow(2,i-o)-Math.pow(2,i))):(m=0,v=Math.round(e/Math.pow(2,1-l-i))));const A=[];for(I=i;I;I-=1)A.push(v%2?1:0),v=Math.floor(v/2);for(I=t;I;I-=1)A.push(m%2?1:0),m=Math.floor(m/2);A.push(d?1:0),A.reverse();const N=A.join("");let F="";for(I=0;I<64;I+=8){let z=parseInt(N.substr(I,8),2).toString(16);z.length===1&&(z="0"+z),F=F+z}return F.toLowerCase()},jue=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Bue=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Vue(e,t){let i="Unknown Error";e==="too_big"?i="The data requested exceeds the maximum size that can be accessed with a single request.":e==="permission_denied"?i="Client doesn't have permission to access the desired data.":e==="unavailable"&&(i="The service is unavailable");const l=new Error(e+" at "+t._path.toString()+": "+i);return l.code=e.toUpperCase(),l}const Uue=new RegExp("^-?(0*)\\d{1,10}$"),$ue=-2147483648,Gue=2147483647,QB=function(e){if(Uue.test(e)){const t=Number(e);if(t>=$ue&&t<=Gue)return t}return null},ov=function(e){try{e()}catch(t){setTimeout(()=>{const i=t.stack||"";throw va("Exception was thrown by user callback.",i),t},Math.floor(0))}},Hue=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},H0=function(e,t){const i=setTimeout(e,t);return typeof i=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(i):typeof i=="object"&&i.unref&&i.unref(),i};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wue{constructor(t,i){this.appCheckProvider=i,this.appName=t.name,_l(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.appCheck=i==null?void 0:i.getImmediate({optional:!0}),this.appCheck||i==null||i.get().then(l=>this.appCheck=l)}getToken(t){if(this.serverAppAppCheckToken){if(t)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(t):new Promise((i,l)=>{setTimeout(()=>{this.appCheck?this.getToken(t).then(i,l):i(null)},0)})}addTokenChangeListener(t){var i;(i=this.appCheckProvider)==null||i.get().then(l=>l.addTokenListener(t))}notifyForInvalidToken(){va(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class que{constructor(t,i,l){this.appName_=t,this.firebaseOptions_=i,this.authProvider_=l,this.auth_=null,this.auth_=l.getImmediate({optional:!0}),this.auth_||l.onInit(d=>this.auth_=d)}getToken(t){return this.auth_?this.auth_.getToken(t).catch(i=>i&&i.code==="auth/token-not-initialized"?(zo("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(i)):new Promise((i,l)=>{setTimeout(()=>{this.auth_?this.getToken(t).then(i,l):i(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(i=>i.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(i=>i.removeAuthTokenListener(t))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',va(t)}}class TE{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}TE.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jD="5",VG="v",UG="s",$G="r",GG="f",HG=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,WG="ls",qG="p",nM="ac",ZG="websocket",KG="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XG{constructor(t,i,l,d,m=!1,v="",o=!1,I=!1,A=null){this.secure=i,this.namespace=l,this.webSocketOnly=d,this.nodeAdmin=m,this.persistenceKey=v,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=I,this.emulatorOptions=A,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=rm.get("host:"+t)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&rm.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){const t=this.secure?"https://":"http://",i=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${i}`}}function Zue(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams}function YG(e,t,i){hn(typeof t=="string","typeof type must == string"),hn(typeof i=="object","typeof params must == object");let l;if(t===ZG)l=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===KG)l=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+t);Zue(e)&&(i.ns=e.namespace);const d=[];return Vo(i,(m,v)=>{d.push(m+"="+v)}),l+d.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kue{constructor(){this.counters_={}}incrementCounter(t,i=1){ed(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=i}get(){return Voe(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nP={},iP={};function BD(e){const t=e.toString();return nP[t]||(nP[t]=new Kue),nP[t]}function Xue(e,t){const i=e.toString();return iP[i]||(iP[i]=t()),iP[i]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yue{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,i){this.closeAfterResponse=t,this.onClose=i,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,i){for(this.pendingResponses[t]=i;this.pendingResponses[this.currentResponseNum];){const l=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let d=0;d<l.length;++d)l[d]&&ov(()=>{this.onMessage_(l[d])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JB="start",Que="close",Jue="pLPCommand",ede="pRTLPCB",QG="id",JG="pw",eH="ser",tde="cb",nde="seg",ide="ts",rde="d",sde="dframe",tH=1870,nH=30,ode=tH-nH,ade=25e3,lde=3e4;class K_{constructor(t,i,l,d,m,v,o){this.connId=t,this.repoInfo=i,this.applicationId=l,this.appCheckToken=d,this.authToken=m,this.transportSessionId=v,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ab(t),this.stats_=BD(i),this.urlFn=I=>(this.appCheckToken&&(I[nM]=this.appCheckToken),YG(i,KG,I))}open(t,i){this.curSegmentNum=0,this.onDisconnect_=i,this.myPacketOrderer=new Yue(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(lde)),Fue(()=>{if(this.isClosed_)return;this.scriptTagHolder=new VD((...m)=>{const[v,o,I,A,N]=m;if(this.incrementIncomingBytes_(m),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,v===JB)this.id=o,this.password=I;else if(v===Que)o?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(o,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+v)},(...m)=>{const[v,o]=m;this.incrementIncomingBytes_(m),this.myPacketOrderer.handleResponse(v,o)},()=>{this.onClosed_()},this.urlFn);const l={};l[JB]="t",l[eH]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(l[tde]=this.scriptTagHolder.uniqueCallbackIdentifier),l[VG]=jD,this.transportSessionId&&(l[UG]=this.transportSessionId),this.lastSessionId&&(l[WG]=this.lastSessionId),this.applicationId&&(l[qG]=this.applicationId),this.appCheckToken&&(l[nM]=this.appCheckToken),typeof location<"u"&&location.hostname&&HG.test(location.hostname)&&(l[$G]=GG);const d=this.urlFn(l);this.log_("Connecting via long-poll to "+d),this.scriptTagHolder.addTag(d,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){K_.forceAllow_=!0}static forceDisallow(){K_.forceDisallow_=!0}static isAvailable(){return K_.forceAllow_?!0:!K_.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!jue()&&!Bue()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const i=uo(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);const l=B$(i),d=jG(l,ode);for(let m=0;m<d.length;m++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,d.length,d[m]),this.curSegmentNum++}addDisconnectPingFrame(t,i){this.myDisconnFrame=document.createElement("iframe");const l={};l[sde]="t",l[QG]=t,l[JG]=i,this.myDisconnFrame.src=this.urlFn(l),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const i=uo(t).length;this.bytesReceived+=i,this.stats_.incrementCounter("bytes_received",i)}}class VD{constructor(t,i,l,d){this.onDisconnect=l,this.urlFn=d,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Nue(),window[Jue+this.uniqueCallbackIdentifier]=t,window[ede+this.uniqueCallbackIdentifier]=i,this.myIFrame=VD.createIFrame_();let m="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(m='<script>document.domain="'+document.domain+'";<\/script>');const v="<html><body>"+m+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(v),this.myIFrame.doc.close()}catch(o){zo("frame writing exception"),o.stack&&zo(o.stack),zo(o)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",document.body){document.body.appendChild(t);try{t.contentWindow.document||zo("No IE domain setting required")}catch{const l=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+l+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,i){for(this.myID=t,this.myPW=i,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t[QG]=this.myID,t[JG]=this.myPW,t[eH]=this.currentSerial;let i=this.urlFn(t),l="",d=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+nH+l.length<=tH;){const v=this.pendingSegs.shift();l=l+"&"+nde+d+"="+v.seg+"&"+ide+d+"="+v.ts+"&"+rde+d+"="+v.d,d++}return i=i+l,this.addLongPollTag_(i,this.currentSerial),!0}else return!1}enqueueSegment(t,i,l){this.pendingSegs.push({seg:t,ts:i,d:l}),this.alive&&this.newRequest_()}addLongPollTag_(t,i){this.outstandingRequests.add(i);const l=()=>{this.outstandingRequests.delete(i),this.newRequest_()},d=setTimeout(l,Math.floor(ade)),m=()=>{clearTimeout(d),l()};this.addTag(t,m)}addTag(t,i){setTimeout(()=>{try{if(!this.sendNewPolls)return;const l=this.myIFrame.doc.createElement("script");l.type="text/javascript",l.async=!0,l.src=t,l.onload=l.onreadystatechange=function(){const d=l.readyState;(!d||d==="loaded"||d==="complete")&&(l.onload=l.onreadystatechange=null,l.parentNode&&l.parentNode.removeChild(l),i())},l.onerror=()=>{zo("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(l)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cde=16384,ude=45e3;let wS=null;typeof MozWebSocket<"u"?wS=MozWebSocket:typeof WebSocket<"u"&&(wS=WebSocket);class Uc{constructor(t,i,l,d,m,v,o){this.connId=t,this.applicationId=l,this.appCheckToken=d,this.authToken=m,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ab(this.connId),this.stats_=BD(i),this.connURL=Uc.connectionURL_(i,v,o,d,l),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,l,d,m){const v={};return v[VG]=jD,typeof location<"u"&&location.hostname&&HG.test(location.hostname)&&(v[$G]=GG),i&&(v[UG]=i),l&&(v[WG]=l),d&&(v[nM]=d),m&&(v[qG]=m),YG(t,ZG,v)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,rm.set("previous_websocket_failure",!0);try{let l;Z$(),this.mySock=new wS(this.connURL,[],l)}catch(l){this.log_("Error instantiating WebSocket.");const d=l.message||l.data;d&&this.log_(d),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=l=>{this.handleIncomingFrame(l)},this.mySock.onerror=l=>{this.log_("WebSocket error.  Closing connection.");const d=l.message||l.data;d&&this.log_(d),this.onClosed_()}}start(){}static forceDisallow(){Uc.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){const i=/Android ([0-9]{0,}\.[0-9]{0,})/,l=navigator.userAgent.match(i);l&&l.length>1&&parseFloat(l[1])<4.4&&(t=!0)}return!t&&wS!==null&&!Uc.forceDisallow_}static previouslyFailed(){return rm.isInMemoryStorage||rm.get("previous_websocket_failure")===!0}markConnectionHealthy(){rm.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const i=this.frames.join("");this.frames=null;const l=S1(i);this.onMessage(l)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(hn(this.frames===null,"We already have a frame buffer"),t.length<=6){const i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;const i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{const l=this.extractFrameCount_(i);l!==null&&this.appendFrame_(l)}}send(t){this.resetKeepAlive();const i=uo(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);const l=jG(i,cde);l.length>1&&this.sendString_(String(l.length));for(let d=0;d<l.length;d++)this.sendString_(l[d])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(ude))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Uc.responsesRequiredToBeHealthy=2;Uc.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P1{static get ALL_TRANSPORTS(){return[K_,Uc]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){const i=Uc&&Uc.isAvailable();let l=i&&!Uc.previouslyFailed();if(t.webSocketOnly&&(i||va("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),l=!0),l)this.transports_=[Uc];else{const d=this.transports_=[];for(const m of P1.ALL_TRANSPORTS)m&&m.isAvailable()&&d.push(m);P1.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}P1.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dde=6e4,hde=5e3,fde=10*1024,pde=100*1024,rP="t",e4="d",mde="s",t4="r",gde="e",n4="o",i4="a",r4="n",s4="p",_de="h";class yde{constructor(t,i,l,d,m,v,o,I,A,N){this.id=t,this.repoInfo_=i,this.applicationId_=l,this.appCheckToken_=d,this.authToken_=m,this.onMessage_=v,this.onReady_=o,this.onDisconnect_=I,this.onKill_=A,this.lastSessionId=N,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ab("c:"+this.id+":"),this.transportManager_=new P1(i),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const i=this.connReceiver_(this.conn_),l=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(i,l)},Math.floor(0));const d=t.healthyTimeout||0;d>0&&(this.healthyTimeout_=H0(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>pde?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>fde?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(d)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return i=>{t===this.conn_?this.onConnectionLost_(i):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return i=>{this.state_!==2&&(t===this.rx_?this.onPrimaryMessageReceived_(i):t===this.secondaryConn_?this.onSecondaryMessageReceived_(i):this.log_("message on old connection"))}}sendRequest(t){const i={t:"d",d:t};this.sendData_(i)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if(rP in t){const i=t[rP];i===i4?this.upgradeIfSecondaryHealthy_():i===t4?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):i===n4&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const i=y0("t",t),l=y0("d",t);if(i==="c")this.onSecondaryControl_(l);else if(i==="d")this.pendingDataMessages.push(l);else throw new Error("Unknown protocol layer: "+i)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:s4,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:i4,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:r4,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const i=y0("t",t),l=y0("d",t);i==="c"?this.onControl_(l):i==="d"&&this.onDataMessage_(l)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const i=y0(rP,t);if(e4 in t){const l=t[e4];if(i===_de){const d={...l};this.repoInfo_.isUsingEmulator&&(d.h=this.repoInfo_.host),this.onHandshake_(d)}else if(i===r4){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let d=0;d<this.pendingDataMessages.length;++d)this.onDataMessage_(this.pendingDataMessages[d]);this.pendingDataMessages=[],this.tryCleanupConnection()}else i===mde?this.onConnectionShutdown_(l):i===t4?this.onReset_(l):i===gde?tM("Server Error: "+l):i===n4?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):tM("Unknown control packet command: "+i)}}onHandshake_(t){const i=t.ts,l=t.v,d=t.h;this.sessionId=t.s,this.repoInfo_.host=d,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,i),jD!==l&&va("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const i=this.connReceiver_(this.secondaryConn_),l=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(i,l),H0(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(dde))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,i){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(i,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):H0(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(hde))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:s4,d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===t||this.rx_===t)&&this.close()}onConnectionLost_(t){this.conn_=null,!t&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(rm.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(t)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iH{put(t,i,l,d){}merge(t,i,l,d){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,i,l){}onDisconnectMerge(t,i,l){}onDisconnectCancel(t,i){}reportStats(t){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rH{constructor(t){this.allowedEvents_=t,this.listeners_={},hn(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...i){if(Array.isArray(this.listeners_[t])){const l=[...this.listeners_[t]];for(let d=0;d<l.length;d++)l[d].callback.apply(l[d].context,i)}}on(t,i,l){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:i,context:l});const d=this.getInitialEvent(t);d&&i.apply(l,d)}off(t,i,l){this.validateEventType_(t);const d=this.listeners_[t]||[];for(let m=0;m<d.length;m++)if(d[m].callback===i&&(!l||l===d[m].context)){d.splice(m,1);return}}validateEventType_(t){hn(this.allowedEvents_.find(i=>i===t),"Unknown event: "+t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TS extends rH{static getInstance(){return new TS}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!ED()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(t){return hn(t==="online","Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o4=32,a4=768;class Zr{constructor(t,i){if(i===void 0){this.pieces_=t.split("/");let l=0;for(let d=0;d<this.pieces_.length;d++)this.pieces_[d].length>0&&(this.pieces_[l]=this.pieces_[d],l++);this.pieces_.length=l,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=i}toString(){let t="";for(let i=this.pieceNum_;i<this.pieces_.length;i++)this.pieces_[i]!==""&&(t+="/"+this.pieces_[i]);return t||"/"}}function Dr(){return new Zr("")}function sr(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function Of(e){return e.pieces_.length-e.pieceNum_}function ss(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Zr(e.pieces_,t)}function UD(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function vde(e){let t="";for(let i=e.pieceNum_;i<e.pieces_.length;i++)e.pieces_[i]!==""&&(t+="/"+encodeURIComponent(String(e.pieces_[i])));return t||"/"}function R1(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function sH(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let i=e.pieceNum_;i<e.pieces_.length-1;i++)t.push(e.pieces_[i]);return new Zr(t,0)}function Os(e,t){const i=[];for(let l=e.pieceNum_;l<e.pieces_.length;l++)i.push(e.pieces_[l]);if(t instanceof Zr)for(let l=t.pieceNum_;l<t.pieces_.length;l++)i.push(t.pieces_[l]);else{const l=t.split("/");for(let d=0;d<l.length;d++)l[d].length>0&&i.push(l[d])}return new Zr(i,0)}function cr(e){return e.pieceNum_>=e.pieces_.length}function ma(e,t){const i=sr(e),l=sr(t);if(i===null)return t;if(i===l)return ma(ss(e),ss(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function xde(e,t){const i=R1(e,0),l=R1(t,0);for(let d=0;d<i.length&&d<l.length;d++){const m=Um(i[d],l[d]);if(m!==0)return m}return i.length===l.length?0:i.length<l.length?-1:1}function $D(e,t){if(Of(e)!==Of(t))return!1;for(let i=e.pieceNum_,l=t.pieceNum_;i<=e.pieces_.length;i++,l++)if(e.pieces_[i]!==t.pieces_[l])return!1;return!0}function Yl(e,t){let i=e.pieceNum_,l=t.pieceNum_;if(Of(e)>Of(t))return!1;for(;i<e.pieces_.length;){if(e.pieces_[i]!==t.pieces_[l])return!1;++i,++l}return!0}class bde{constructor(t,i){this.errorPrefix_=i,this.parts_=R1(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let l=0;l<this.parts_.length;l++)this.byteLength_+=IC(this.parts_[l]);oH(this)}}function wde(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=IC(t),oH(e)}function Tde(e){const t=e.parts_.pop();e.byteLength_-=IC(t),e.parts_.length>0&&(e.byteLength_-=1)}function oH(e){if(e.byteLength_>a4)throw new Error(e.errorPrefix_+"has a key path longer than "+a4+" bytes ("+e.byteLength_+").");if(e.parts_.length>o4)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+o4+") or object contains a cycle "+Jp(e))}function Jp(e){return e.parts_.length===0?"":"in property '"+e.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GD extends rH{static getInstance(){return new GD}constructor(){super(["visible"]);let t,i;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(i="visibilitychange",t="hidden"):typeof document.mozHidden<"u"?(i="mozvisibilitychange",t="mozHidden"):typeof document.msHidden<"u"?(i="msvisibilitychange",t="msHidden"):typeof document.webkitHidden<"u"&&(i="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,i&&document.addEventListener(i,()=>{const l=!document[t];l!==this.visible_&&(this.visible_=l,this.trigger("visible",l))},!1)}getInitialEvent(t){return hn(t==="visible","Unknown event type: "+t),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v0=1e3,Ede=60*5*1e3,l4=30*1e3,Sde=1.3,Cde=3e4,Ide="server_kill",c4=3;class $d extends iH{constructor(t,i,l,d,m,v,o,I){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=l,this.onConnectStatus_=d,this.onServerInfoUpdate_=m,this.authTokenProvider_=v,this.appCheckTokenProvider_=o,this.authOverride_=I,this.id=$d.nextPersistentConnectionId_++,this.log_=ab("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=v0,this.maxReconnectDelay_=Ede,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,I&&!Z$())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");GD.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&TS.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,l){const d=++this.requestNumber_,m={r:d,a:t,b:i};this.log_(uo(m)),hn(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(m),l&&(this.requestCBHash_[d]=l)}get(t){this.initConnection_();const i=new eb,d={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:v=>{const o=v.d;v.s==="ok"?i.resolve(o):i.reject(o)}};this.outstandingGets_.push(d),this.outstandingGetCount_++;const m=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(m),i.promise}listen(t,i,l,d){this.initConnection_();const m=t._queryIdentifier,v=t._path.toString();this.log_("Listen called for "+v+" "+m),this.listens.has(v)||this.listens.set(v,new Map),hn(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),hn(!this.listens.get(v).has(m),"listen() called twice for same path/queryId.");const o={onComplete:d,hashFn:i,query:t,tag:l};this.listens.get(v).set(m,o),this.connected_&&this.sendListen_(o)}sendGet_(t){const i=this.outstandingGets_[t];this.sendRequest("g",i.request,l=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(l)})}sendListen_(t){const i=t.query,l=i._path.toString(),d=i._queryIdentifier;this.log_("Listen on "+l+" for "+d);const m={p:l},v="q";t.tag&&(m.q=i._queryObject,m.t=t.tag),m.h=t.hashFn(),this.sendRequest(v,m,o=>{const I=o.d,A=o.s;$d.warnOnListenWarnings_(I,i),(this.listens.get(l)&&this.listens.get(l).get(d))===t&&(this.log_("listen response",o),A!=="ok"&&this.removeListen_(l,d),t.onComplete&&t.onComplete(A,I))})}static warnOnListenWarnings_(t,i){if(t&&typeof t=="object"&&ed(t,"w")){const l=zy(t,"w");if(Array.isArray(l)&&~l.indexOf("no_index")){const d='".indexOn": "'+i._queryParams.getIndex().toString()+'"',m=i._path.toString();va(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${d} at ${m} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||rae(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=l4)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,i=iae(t)?"auth":"gauth",l={cred:t};this.authOverride_===null?l.noauth=!0:typeof this.authOverride_=="object"&&(l.authvar=this.authOverride_),this.sendRequest(i,l,d=>{const m=d.s,v=d.d||"error";this.authToken_===t&&(m==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(m,v))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{const i=t.s,l=t.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,l)})}unlisten(t,i){const l=t._path.toString(),d=t._queryIdentifier;this.log_("Unlisten called for "+l+" "+d),hn(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(l,d)&&this.connected_&&this.sendUnlisten_(l,d,t._queryObject,i)}sendUnlisten_(t,i,l,d){this.log_("Unlisten on "+t+" for "+i);const m={p:t},v="n";d&&(m.q=l,m.t=d),this.sendRequest(v,m)}onDisconnectPut(t,i,l){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,l):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:l})}onDisconnectMerge(t,i,l){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,l):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:l})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,l,d){const m={p:i,d:l};this.log_("onDisconnect "+t,m),this.sendRequest(t,m,v=>{d&&setTimeout(()=>{d(v.s,v.d)},Math.floor(0))})}put(t,i,l,d){this.putInternal("p",t,i,l,d)}merge(t,i,l,d){this.putInternal("m",t,i,l,d)}putInternal(t,i,l,d,m){this.initConnection_();const v={p:i,d:l};m!==void 0&&(v.h=m),this.outstandingPuts_.push({action:t,request:v,onComplete:d}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+i)}sendPut_(t){const i=this.outstandingPuts_[t].action,l=this.outstandingPuts_[t].request,d=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,l,m=>{this.log_(i+" response",m),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),d&&d(m.s,m.d)})}reportStats(t){if(this.connected_){const i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,l=>{if(l.s!=="ok"){const m=l.d;this.log_("reportStats","Error sending stats: "+m)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+uo(t));const i=t.r,l=this.requestCBHash_[i];l&&(delete this.requestCBHash_[i],l(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),t==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):t==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):t==="c"?this.onListenRevoked_(i.p,i.q):t==="ac"?this.onAuthRevoked_(i.s,i.d):t==="apc"?this.onAppCheckRevoked_(i.s,i.d):t==="sd"?this.onSecurityDebugPacket_(i):tM("Unrecognized action received from server: "+uo(t)+`
Are you using the latest client?`)}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){hn(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=v0,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=v0,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Cde&&(this.reconnectDelay_=v0),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const t=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Sde)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),l=this.onRealtimeDisconnect_.bind(this),d=this.id+":"+$d.nextConnectionId_++,m=this.lastSessionId;let v=!1,o=null;const I=function(){o?o.close():(v=!0,l())},A=function(F){hn(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(F)};this.realtime_={close:I,sendRequest:A};const N=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[F,z]=await Promise.all([this.authTokenProvider_.getToken(N),this.appCheckTokenProvider_.getToken(N)]);v?zo("getToken() completed but was canceled"):(zo("getToken() completed. Creating connection."),this.authToken_=F&&F.accessToken,this.appCheckToken_=z&&z.token,o=new yde(d,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,i,l,$=>{va($+" ("+this.repoInfo_.toString()+")"),this.interrupt(Ide)},m))}catch(F){this.log_("Failed to get token: "+F),v||(this.repoInfo_.nodeAdmin&&va(F),I())}}}interrupt(t){zo("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){zo("Resuming connection for reason: "+t),delete this.interruptReasons_[t],HR(this.interruptReasons_)&&(this.reconnectDelay_=v0,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const i=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let l;i?l=i.map(m=>zD(m)).join("$"):l="default";const d=this.removeListen_(t,l);d&&d.onComplete&&d.onComplete("permission_denied")}removeListen_(t,i){const l=new Zr(t).toString();let d;if(this.listens.has(l)){const m=this.listens.get(l);d=m.get(i),m.delete(i),m.size===0&&this.listens.delete(l)}else d=void 0;return d}onAuthRevoked_(t,i){zo("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=c4&&(this.reconnectDelay_=l4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){zo("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=c4&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let i="js";t["sdk."+i+"."+OG.replace(/\./g,"-")]=1,ED()?t["framework.cordova"]=1:q$()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=TS.getInstance().currentlyOnline();return HR(this.interruptReasons_)&&t}}$d.nextPersistentConnectionId_=0;$d.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class or{constructor(t,i){this.name=t,this.node=i}static Wrap(t,i){return new or(t,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kC{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,i){const l=new or(jy,t),d=new or(jy,i);return this.compare(l,d)!==0}minPost(){return or.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $T;class aH extends kC{static get __EMPTY_NODE(){return $T}static set __EMPTY_NODE(t){$T=t}compare(t,i){return Um(t.name,i.name)}isDefinedOn(t){throw iv("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,i){return!1}minPost(){return or.MIN}maxPost(){return new or(Am,$T)}makePost(t,i){return hn(typeof t=="string","KeyIndex indexValue must always be a string."),new or(t,$T)}toString(){return".key"}}const gy=new aH;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GT{constructor(t,i,l,d,m=null){this.isReverse_=d,this.resultGenerator_=m,this.nodeStack_=[];let v=1;for(;!t.isEmpty();)if(t=t,v=i?l(t.key,i):1,d&&(v*=-1),v<0)this.isReverse_?t=t.left:t=t.right;else if(v===0){this.nodeStack_.push(t);break}else this.nodeStack_.push(t),this.isReverse_?t=t.right:t=t.left}getNext(){if(this.nodeStack_.length===0)return null;let t=this.nodeStack_.pop(),i;if(this.resultGenerator_?i=this.resultGenerator_(t.key,t.value):i={key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return i}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}class So{constructor(t,i,l,d,m){this.key=t,this.value=i,this.color=l??So.RED,this.left=d??qa.EMPTY_NODE,this.right=m??qa.EMPTY_NODE}copy(t,i,l,d,m){return new So(t??this.key,i??this.value,l??this.color,d??this.left,m??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,l){let d=this;const m=l(t,d.key);return m<0?d=d.copy(null,null,null,d.left.insert(t,i,l),null):m===0?d=d.copy(null,i,null,null,null):d=d.copy(null,null,null,null,d.right.insert(t,i,l)),d.fixUp_()}removeMin_(){if(this.left.isEmpty())return qa.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let l,d;if(l=this,i(t,l.key)<0)!l.left.isEmpty()&&!l.left.isRed_()&&!l.left.left.isRed_()&&(l=l.moveRedLeft_()),l=l.copy(null,null,null,l.left.remove(t,i),null);else{if(l.left.isRed_()&&(l=l.rotateRight_()),!l.right.isEmpty()&&!l.right.isRed_()&&!l.right.left.isRed_()&&(l=l.moveRedRight_()),i(t,l.key)===0){if(l.right.isEmpty())return qa.EMPTY_NODE;d=l.right.min_(),l=l.copy(d.key,d.value,null,null,l.right.removeMin_())}l=l.copy(null,null,null,null,l.right.remove(t,i))}return l.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,So.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,So.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}So.RED=!0;So.BLACK=!1;class Ade{copy(t,i,l,d,m){return this}insert(t,i,l){return new So(t,i,null)}remove(t,i){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class qa{constructor(t,i=qa.EMPTY_NODE){this.comparator_=t,this.root_=i}insert(t,i){return new qa(this.comparator_,this.root_.insert(t,i,this.comparator_).copy(null,null,So.BLACK,null,null))}remove(t){return new qa(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,So.BLACK,null,null))}get(t){let i,l=this.root_;for(;!l.isEmpty();){if(i=this.comparator_(t,l.key),i===0)return l.value;i<0?l=l.left:i>0&&(l=l.right)}return null}getPredecessorKey(t){let i,l=this.root_,d=null;for(;!l.isEmpty();)if(i=this.comparator_(t,l.key),i===0){if(l.left.isEmpty())return d?d.key:null;for(l=l.left;!l.right.isEmpty();)l=l.right;return l.key}else i<0?l=l.left:i>0&&(d=l,l=l.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new GT(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,i){return new GT(this.root_,t,this.comparator_,!1,i)}getReverseIteratorFrom(t,i){return new GT(this.root_,t,this.comparator_,!0,i)}getReverseIterator(t){return new GT(this.root_,null,this.comparator_,!0,t)}}qa.EMPTY_NODE=new Ade;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pde(e,t){return Um(e.name,t.name)}function HD(e,t){return Um(e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iM;function Rde(e){iM=e}const lH=function(e){return typeof e=="number"?"number:"+BG(e):"string:"+e},cH=function(e){if(e.isLeafNode()){const t=e.val();hn(typeof t=="string"||typeof t=="number"||typeof t=="object"&&ed(t,".sv"),"Priority must be a string or number.")}else hn(e===iM||e.isEmpty(),"priority of unexpected type.");hn(e===iM||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let u4;class To{static set __childrenNodeConstructor(t){u4=t}static get __childrenNodeConstructor(){return u4}constructor(t,i=To.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,hn(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),cH(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new To(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:To.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return cr(t)?this:sr(t)===".priority"?this.priorityNode_:To.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return t===".priority"?this.updatePriority(i):i.isEmpty()&&t!==".priority"?this:To.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){const l=sr(t);return l===null?i:i.isEmpty()&&l!==".priority"?this:(hn(l!==".priority"||Of(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(l,To.__childrenNodeConstructor.EMPTY_NODE.updateChild(ss(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+lH(this.priorityNode_.val())+":");const i=typeof this.value_;t+=i+":",i==="number"?t+=BG(this.value_):t+=this.value_,this.lazyHash_=zG(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===To.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof To.__childrenNodeConstructor?-1:(hn(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const i=typeof t.value_,l=typeof this.value_,d=To.VALUE_TYPE_ORDER.indexOf(i),m=To.VALUE_TYPE_ORDER.indexOf(l);return hn(d>=0,"Unknown leaf type: "+i),hn(m>=0,"Unknown leaf type: "+l),d===m?l==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:m-d}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const i=t;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}To.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uH,dH;function Mde(e){uH=e}function kde(e){dH=e}class Dde extends kC{compare(t,i){const l=t.node.getPriority(),d=i.node.getPriority(),m=l.compareTo(d);return m===0?Um(t.name,i.name):m}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,i){return!t.getPriority().equals(i.getPriority())}minPost(){return or.MIN}maxPost(){return new or(Am,new To("[PRIORITY-POST]",dH))}makePost(t,i){const l=uH(t);return new or(i,new To("[PRIORITY-POST]",l))}toString(){return".priority"}}const Fs=new Dde;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nde=Math.log(2);class Lde{constructor(t){const i=m=>parseInt(Math.log(m)/Nde,10),l=m=>parseInt(Array(m+1).join("1"),2);this.count=i(t+1),this.current_=this.count-1;const d=l(this.count);this.bits_=t+1&d}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const ES=function(e,t,i,l){e.sort(t);const d=function(I,A){const N=A-I;let F,z;if(N===0)return null;if(N===1)return F=e[I],z=i?i(F):F,new So(z,F.node,So.BLACK,null,null);{const $=parseInt(N/2,10)+I,J=d(I,$),H=d($+1,A);return F=e[$],z=i?i(F):F,new So(z,F.node,So.BLACK,J,H)}},m=function(I){let A=null,N=null,F=e.length;const z=function(J,H){const re=F-J,Q=F;F-=J;const ee=d(re+1,Q),ie=e[re],ue=i?i(ie):ie;$(new So(ue,ie.node,H,null,ee))},$=function(J){A?(A.left=J,A=J):(N=J,A=J)};for(let J=0;J<I.count;++J){const H=I.nextBitIsOne(),re=Math.pow(2,I.count-(J+1));H?z(re,So.BLACK):(z(re,So.BLACK),z(re,So.RED))}return N},v=new Lde(e.length),o=m(v);return new qa(l||t,o)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sP;const k_={};class Bd{static get Default(){return hn(k_&&Fs,"ChildrenNode.ts has not been loaded"),sP=sP||new Bd({".priority":k_},{".priority":Fs}),sP}constructor(t,i){this.indexes_=t,this.indexSet_=i}get(t){const i=zy(this.indexes_,t);if(!i)throw new Error("No index defined for "+t);return i instanceof qa?i:null}hasIndex(t){return ed(this.indexSet_,t.toString())}addIndex(t,i){hn(t!==gy,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const l=[];let d=!1;const m=i.getIterator(or.Wrap);let v=m.getNext();for(;v;)d=d||t.isDefinedOn(v.node),l.push(v),v=m.getNext();let o;d?o=ES(l,t.getCompare()):o=k_;const I=t.toString(),A={...this.indexSet_};A[I]=t;const N={...this.indexes_};return N[I]=o,new Bd(N,A)}addToIndexes(t,i){const l=pS(this.indexes_,(d,m)=>{const v=zy(this.indexSet_,m);if(hn(v,"Missing index implementation for "+m),d===k_)if(v.isDefinedOn(t.node)){const o=[],I=i.getIterator(or.Wrap);let A=I.getNext();for(;A;)A.name!==t.name&&o.push(A),A=I.getNext();return o.push(t),ES(o,v.getCompare())}else return k_;else{const o=i.get(t.name);let I=d;return o&&(I=I.remove(new or(t.name,o))),I.insert(t,t.node)}});return new Bd(l,this.indexSet_)}removeFromIndexes(t,i){const l=pS(this.indexes_,d=>{if(d===k_)return d;{const m=i.get(t.name);return m?d.remove(new or(t.name,m)):d}});return new Bd(l,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let x0;class Ei{static get EMPTY_NODE(){return x0||(x0=new Ei(new qa(HD),null,Bd.Default))}constructor(t,i,l){this.children_=t,this.priorityNode_=i,this.indexMap_=l,this.lazyHash_=null,this.priorityNode_&&cH(this.priorityNode_),this.children_.isEmpty()&&hn(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||x0}updatePriority(t){return this.children_.isEmpty()?this:new Ei(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{const i=this.children_.get(t);return i===null?x0:i}}getChild(t){const i=sr(t);return i===null?this:this.getImmediateChild(i).getChild(ss(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,i){if(hn(i,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(i);{const l=new or(t,i);let d,m;i.isEmpty()?(d=this.children_.remove(t),m=this.indexMap_.removeFromIndexes(l,this.children_)):(d=this.children_.insert(t,i),m=this.indexMap_.addToIndexes(l,this.children_));const v=d.isEmpty()?x0:this.priorityNode_;return new Ei(d,v,m)}}updateChild(t,i){const l=sr(t);if(l===null)return i;{hn(sr(t)!==".priority"||Of(t)===1,".priority must be the last token in a path");const d=this.getImmediateChild(l).updateChild(ss(t),i);return this.updateImmediateChild(l,d)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const i={};let l=0,d=0,m=!0;if(this.forEachChild(Fs,(v,o)=>{i[v]=o.val(t),l++,m&&Ei.INTEGER_REGEXP_.test(v)?d=Math.max(d,Number(v)):m=!1}),!t&&m&&d<2*l){const v=[];for(const o in i)v[o]=i[o];return v}else return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+lH(this.getPriority().val())+":"),this.forEachChild(Fs,(i,l)=>{const d=l.hash();d!==""&&(t+=":"+i+":"+d)}),this.lazyHash_=t===""?"":zG(t)}return this.lazyHash_}getPredecessorChildName(t,i,l){const d=this.resolveIndex_(l);if(d){const m=d.getPredecessorKey(new or(t,i));return m?m.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){const i=this.resolveIndex_(t);if(i){const l=i.minKey();return l&&l.name}else return this.children_.minKey()}getFirstChild(t){const i=this.getFirstChildName(t);return i?new or(i,this.children_.get(i)):null}getLastChildName(t){const i=this.resolveIndex_(t);if(i){const l=i.maxKey();return l&&l.name}else return this.children_.maxKey()}getLastChild(t){const i=this.getLastChildName(t);return i?new or(i,this.children_.get(i)):null}forEachChild(t,i){const l=this.resolveIndex_(t);return l?l.inorderTraversal(d=>i(d.name,d.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){const l=this.resolveIndex_(i);if(l)return l.getIteratorFrom(t,d=>d);{const d=this.children_.getIteratorFrom(t.name,or.Wrap);let m=d.peek();for(;m!=null&&i.compare(m,t)<0;)d.getNext(),m=d.peek();return d}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){const l=this.resolveIndex_(i);if(l)return l.getReverseIteratorFrom(t,d=>d);{const d=this.children_.getReverseIteratorFrom(t.name,or.Wrap);let m=d.peek();for(;m!=null&&i.compare(m,t)>0;)d.getNext(),m=d.peek();return d}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===lb?-1:0}withIndex(t){if(t===gy||this.indexMap_.hasIndex(t))return this;{const i=this.indexMap_.addIndex(t,this.children_);return new Ei(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===gy||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const i=t;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){const l=this.getIterator(Fs),d=i.getIterator(Fs);let m=l.getNext(),v=d.getNext();for(;m&&v;){if(m.name!==v.name||!m.node.equals(v.node))return!1;m=l.getNext(),v=d.getNext()}return m===null&&v===null}else return!1;else return!1}}resolveIndex_(t){return t===gy?null:this.indexMap_.get(t.toString())}}Ei.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Ode extends Ei{constructor(){super(new qa(HD),Ei.EMPTY_NODE,Bd.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return Ei.EMPTY_NODE}isEmpty(){return!1}}const lb=new Ode;Object.defineProperties(or,{MIN:{value:new or(jy,Ei.EMPTY_NODE)},MAX:{value:new or(Am,lb)}});aH.__EMPTY_NODE=Ei.EMPTY_NODE;To.__childrenNodeConstructor=Ei;Rde(lb);kde(lb);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fde=!0;function co(e,t=null){if(e===null)return Ei.EMPTY_NODE;if(typeof e=="object"&&".priority"in e&&(t=e[".priority"]),hn(t===null||typeof t=="string"||typeof t=="number"||typeof t=="object"&&".sv"in t,"Invalid priority type found: "+typeof t),typeof e=="object"&&".value"in e&&e[".value"]!==null&&(e=e[".value"]),typeof e!="object"||".sv"in e){const i=e;return new To(i,co(t))}if(!(e instanceof Array)&&Fde){const i=[];let l=!1;if(Vo(e,(v,o)=>{if(v.substring(0,1)!=="."){const I=co(o);I.isEmpty()||(l=l||!I.getPriority().isEmpty(),i.push(new or(v,I)))}}),i.length===0)return Ei.EMPTY_NODE;const m=ES(i,Pde,v=>v.name,HD);if(l){const v=ES(i,Fs.getCompare());return new Ei(m,co(t),new Bd({".priority":v},{".priority":Fs}))}else return new Ei(m,co(t),Bd.Default)}else{let i=Ei.EMPTY_NODE;return Vo(e,(l,d)=>{if(ed(e,l)&&l.substring(0,1)!=="."){const m=co(d);(m.isLeafNode()||!m.isEmpty())&&(i=i.updateImmediateChild(l,m))}}),i.updatePriority(co(t))}}Mde(co);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zde extends kC{constructor(t){super(),this.indexPath_=t,hn(!cr(t)&&sr(t)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,i){const l=this.extractChild(t.node),d=this.extractChild(i.node),m=l.compareTo(d);return m===0?Um(t.name,i.name):m}makePost(t,i){const l=co(t),d=Ei.EMPTY_NODE.updateChild(this.indexPath_,l);return new or(i,d)}maxPost(){const t=Ei.EMPTY_NODE.updateChild(this.indexPath_,lb);return new or(Am,t)}toString(){return R1(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jde extends kC{compare(t,i){const l=t.node.compareTo(i.node);return l===0?Um(t.name,i.name):l}isDefinedOn(t){return!0}indexedValueChanged(t,i){return!t.equals(i)}minPost(){return or.MIN}maxPost(){return or.MAX}makePost(t,i){const l=co(t);return new or(i,l)}toString(){return".value"}}const Bde=new jde;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hH(e){return{type:"value",snapshotNode:e}}function By(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function M1(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function k1(e,t,i){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:i}}function Vde(e,t){return{type:"child_moved",snapshotNode:t,childName:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WD{constructor(t){this.index_=t}updateChild(t,i,l,d,m,v){hn(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=t.getImmediateChild(i);return o.getChild(d).equals(l.getChild(d))&&o.isEmpty()===l.isEmpty()||(v!=null&&(l.isEmpty()?t.hasChild(i)?v.trackChildChange(M1(i,o)):hn(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?v.trackChildChange(By(i,l)):v.trackChildChange(k1(i,l,o))),t.isLeafNode()&&l.isEmpty())?t:t.updateImmediateChild(i,l).withIndex(this.index_)}updateFullNode(t,i,l){return l!=null&&(t.isLeafNode()||t.forEachChild(Fs,(d,m)=>{i.hasChild(d)||l.trackChildChange(M1(d,m))}),i.isLeafNode()||i.forEachChild(Fs,(d,m)=>{if(t.hasChild(d)){const v=t.getImmediateChild(d);v.equals(m)||l.trackChildChange(k1(d,m,v))}else l.trackChildChange(By(d,m))})),i.withIndex(this.index_)}updatePriority(t,i){return t.isEmpty()?Ei.EMPTY_NODE:t.updatePriority(i)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D1{constructor(t){this.indexedFilter_=new WD(t.getIndex()),this.index_=t.getIndex(),this.startPost_=D1.getStartPost_(t),this.endPost_=D1.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(t){const i=this.startIsInclusive_?this.index_.compare(this.getStartPost(),t)<=0:this.index_.compare(this.getStartPost(),t)<0,l=this.endIsInclusive_?this.index_.compare(t,this.getEndPost())<=0:this.index_.compare(t,this.getEndPost())<0;return i&&l}updateChild(t,i,l,d,m,v){return this.matches(new or(i,l))||(l=Ei.EMPTY_NODE),this.indexedFilter_.updateChild(t,i,l,d,m,v)}updateFullNode(t,i,l){i.isLeafNode()&&(i=Ei.EMPTY_NODE);let d=i.withIndex(this.index_);d=d.updatePriority(Ei.EMPTY_NODE);const m=this;return i.forEachChild(Fs,(v,o)=>{m.matches(new or(v,o))||(d=d.updateImmediateChild(v,Ei.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,d,l)}updatePriority(t,i){return t}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(t){if(t.hasStart()){const i=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),i)}else return t.getIndex().minPost()}static getEndPost_(t){if(t.hasEnd()){const i=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),i)}else return t.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ude{constructor(t){this.withinDirectionalStart=i=>this.reverse_?this.withinEndPost(i):this.withinStartPost(i),this.withinDirectionalEnd=i=>this.reverse_?this.withinStartPost(i):this.withinEndPost(i),this.withinStartPost=i=>{const l=this.index_.compare(this.rangedFilter_.getStartPost(),i);return this.startIsInclusive_?l<=0:l<0},this.withinEndPost=i=>{const l=this.index_.compare(i,this.rangedFilter_.getEndPost());return this.endIsInclusive_?l<=0:l<0},this.rangedFilter_=new D1(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft(),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}updateChild(t,i,l,d,m,v){return this.rangedFilter_.matches(new or(i,l))||(l=Ei.EMPTY_NODE),t.getImmediateChild(i).equals(l)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,i,l,d,m,v):this.fullLimitUpdateChild_(t,i,l,m,v)}updateFullNode(t,i,l){let d;if(i.isLeafNode()||i.isEmpty())d=Ei.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<i.numChildren()&&i.isIndexed(this.index_)){d=Ei.EMPTY_NODE.withIndex(this.index_);let m;this.reverse_?m=i.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):m=i.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let v=0;for(;m.hasNext()&&v<this.limit_;){const o=m.getNext();if(this.withinDirectionalStart(o))if(this.withinDirectionalEnd(o))d=d.updateImmediateChild(o.name,o.node),v++;else break;else continue}}else{d=i.withIndex(this.index_),d=d.updatePriority(Ei.EMPTY_NODE);let m;this.reverse_?m=d.getReverseIterator(this.index_):m=d.getIterator(this.index_);let v=0;for(;m.hasNext();){const o=m.getNext();v<this.limit_&&this.withinDirectionalStart(o)&&this.withinDirectionalEnd(o)?v++:d=d.updateImmediateChild(o.name,Ei.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,d,l)}updatePriority(t,i){return t}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,i,l,d,m){let v;if(this.reverse_){const F=this.index_.getCompare();v=(z,$)=>F($,z)}else v=this.index_.getCompare();const o=t;hn(o.numChildren()===this.limit_,"");const I=new or(i,l),A=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),N=this.rangedFilter_.matches(I);if(o.hasChild(i)){const F=o.getImmediateChild(i);let z=d.getChildAfterChild(this.index_,A,this.reverse_);for(;z!=null&&(z.name===i||o.hasChild(z.name));)z=d.getChildAfterChild(this.index_,z,this.reverse_);const $=z==null?1:v(z,I);if(N&&!l.isEmpty()&&$>=0)return m!=null&&m.trackChildChange(k1(i,l,F)),o.updateImmediateChild(i,l);{m!=null&&m.trackChildChange(M1(i,F));const H=o.updateImmediateChild(i,Ei.EMPTY_NODE);return z!=null&&this.rangedFilter_.matches(z)?(m!=null&&m.trackChildChange(By(z.name,z.node)),H.updateImmediateChild(z.name,z.node)):H}}else return l.isEmpty()?t:N&&v(A,I)>=0?(m!=null&&(m.trackChildChange(M1(A.name,A.node)),m.trackChildChange(By(i,l))),o.updateImmediateChild(i,l).updateImmediateChild(A.name,Ei.EMPTY_NODE)):t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qD{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Fs}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return hn(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return hn(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:jy}hasEnd(){return this.endSet_}getIndexEndValue(){return hn(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return hn(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Am}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return hn(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Fs}copy(){const t=new qD;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function $de(e){return e.loadsAllData()?new WD(e.getIndex()):e.hasLimit()?new Ude(e):new D1(e)}function d4(e){const t={};if(e.isDefault())return t;let i;if(e.index_===Fs?i="$priority":e.index_===Bde?i="$value":e.index_===gy?i="$key":(hn(e.index_ instanceof zde,"Unrecognized index type!"),i=e.index_.toString()),t.orderBy=uo(i),e.startSet_){const l=e.startAfterSet_?"startAfter":"startAt";t[l]=uo(e.indexStartValue_),e.startNameSet_&&(t[l]+=","+uo(e.indexStartName_))}if(e.endSet_){const l=e.endBeforeSet_?"endBefore":"endAt";t[l]=uo(e.indexEndValue_),e.endNameSet_&&(t[l]+=","+uo(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function h4(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let i=e.viewFrom_;i===""&&(e.isViewFromLeft()?i="l":i="r"),t.vf=i}return e.index_!==Fs&&(t.i=e.index_.toString()),t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SS extends iH{reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,i){return i!==void 0?"tag$"+i:(hn(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}constructor(t,i,l,d){super(),this.repoInfo_=t,this.onDataUpdate_=i,this.authTokenProvider_=l,this.appCheckTokenProvider_=d,this.log_=ab("p:rest:"),this.listens_={}}listen(t,i,l,d){const m=t._path.toString();this.log_("Listen called for "+m+" "+t._queryIdentifier);const v=SS.getListenId_(t,l),o={};this.listens_[v]=o;const I=d4(t._queryParams);this.restRequest_(m+".json",I,(A,N)=>{let F=N;if(A===404&&(F=null,A=null),A===null&&this.onDataUpdate_(m,F,!1,l),zy(this.listens_,v)===o){let z;A?A===401?z="permission_denied":z="rest_error:"+A:z="ok",d(z,null)}})}unlisten(t,i){const l=SS.getListenId_(t,i);delete this.listens_[l]}get(t){const i=d4(t._queryParams),l=t._path.toString(),d=new eb;return this.restRequest_(l+".json",i,(m,v)=>{let o=v;m===404&&(o=null,m=null),m===null?(this.onDataUpdate_(l,o,!1,null),d.resolve(o)):d.reject(new Error(o))}),d.promise}refreshAuthToken(t){}restRequest_(t,i={},l){return i.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([d,m])=>{d&&d.accessToken&&(i.auth=d.accessToken),m&&m.token&&(i.ac=m.token);const v=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+rv(i);this.log_("Sending REST request for "+v);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(l&&o.readyState===4){this.log_("REST Response for "+v+" received. status:",o.status,"response:",o.responseText);let I=null;if(o.status>=200&&o.status<300){try{I=S1(o.responseText)}catch{va("Failed to parse JSON response for "+v+": "+o.responseText)}l(null,I)}else o.status!==401&&o.status!==404&&va("Got unsuccessful REST response for "+v+" Status: "+o.status),l(o.status);l=null}},o.open("GET",v,!0),o.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gde{constructor(){this.rootNode_=Ei.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,i){this.rootNode_=this.rootNode_.updateChild(t,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CS(){return{value:null,children:new Map}}function fH(e,t,i){if(cr(t))e.value=i,e.children.clear();else if(e.value!==null)e.value=e.value.updateChild(t,i);else{const l=sr(t);e.children.has(l)||e.children.set(l,CS());const d=e.children.get(l);t=ss(t),fH(d,t,i)}}function rM(e,t,i){e.value!==null?i(t,e.value):Hde(e,(l,d)=>{const m=new Zr(t.toString()+"/"+l);rM(d,m,i)})}function Hde(e,t){e.children.forEach((i,l)=>{t(l,i)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wde{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),i={...t};return this.last_&&Vo(this.last_,(l,d)=>{i[l]=i[l]-d}),this.last_=t,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f4=10*1e3,qde=30*1e3,Zde=5*60*1e3;class Kde{constructor(t,i){this.server_=i,this.statsToReport_={},this.statsListener_=new Wde(t);const l=f4+(qde-f4)*Math.random();H0(this.reportStats_.bind(this),Math.floor(l))}reportStats_(){const t=this.statsListener_.get(),i={};let l=!1;Vo(t,(d,m)=>{m>0&&ed(this.statsToReport_,d)&&(i[d]=m,l=!0)}),l&&this.server_.reportStats(i),H0(this.reportStats_.bind(this),Math.floor(Math.random()*2*Zde))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Gc;(function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Gc||(Gc={}));function ZD(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function KD(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function XD(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IS{constructor(t,i,l){this.path=t,this.affectedTree=i,this.revert=l,this.type=Gc.ACK_USER_WRITE,this.source=ZD()}operationForChild(t){if(cr(this.path)){if(this.affectedTree.value!=null)return hn(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const i=this.affectedTree.subtree(new Zr(t));return new IS(Dr(),i,this.revert)}}else return hn(sr(this.path)===t,"operationForChild called for unrelated child."),new IS(ss(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N1{constructor(t,i){this.source=t,this.path=i,this.type=Gc.LISTEN_COMPLETE}operationForChild(t){return cr(this.path)?new N1(this.source,Dr()):new N1(this.source,ss(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pm{constructor(t,i,l){this.source=t,this.path=i,this.snap=l,this.type=Gc.OVERWRITE}operationForChild(t){return cr(this.path)?new Pm(this.source,Dr(),this.snap.getImmediateChild(t)):new Pm(this.source,ss(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vy{constructor(t,i,l){this.source=t,this.path=i,this.children=l,this.type=Gc.MERGE}operationForChild(t){if(cr(this.path)){const i=this.children.subtree(new Zr(t));return i.isEmpty()?null:i.value?new Pm(this.source,Dr(),i.value):new Vy(this.source,Dr(),i)}else return hn(sr(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new Vy(this.source,ss(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ff{constructor(t,i,l){this.node_=t,this.fullyInitialized_=i,this.filtered_=l}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(cr(t))return this.isFullyInitialized()&&!this.filtered_;const i=sr(t);return this.isCompleteForChild(i)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xde{constructor(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}}function Yde(e,t,i,l){const d=[],m=[];return t.forEach(v=>{v.type==="child_changed"&&e.index_.indexedValueChanged(v.oldSnap,v.snapshotNode)&&m.push(Vde(v.childName,v.snapshotNode))}),b0(e,d,"child_removed",t,l,i),b0(e,d,"child_added",t,l,i),b0(e,d,"child_moved",m,l,i),b0(e,d,"child_changed",t,l,i),b0(e,d,"value",t,l,i),d}function b0(e,t,i,l,d,m){const v=l.filter(o=>o.type===i);v.sort((o,I)=>Jde(e,o,I)),v.forEach(o=>{const I=Qde(e,o,m);d.forEach(A=>{A.respondsTo(o.type)&&t.push(A.createEvent(I,e.query_))})})}function Qde(e,t,i){return t.type==="value"||t.type==="child_removed"||(t.prevName=i.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}function Jde(e,t,i){if(t.childName==null||i.childName==null)throw iv("Should only compare child_ events.");const l=new or(t.childName,t.snapshotNode),d=new or(i.childName,i.snapshotNode);return e.index_.compare(l,d)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DC(e,t){return{eventCache:e,serverCache:t}}function W0(e,t,i,l){return DC(new Ff(t,i,l),e.serverCache)}function pH(e,t,i,l){return DC(e.eventCache,new Ff(t,i,l))}function AS(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Rm(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oP;const ehe=()=>(oP||(oP=new qa(zue)),oP);class rs{static fromObject(t){let i=new rs(null);return Vo(t,(l,d)=>{i=i.set(new Zr(l),d)}),i}constructor(t,i=ehe()){this.value=t,this.children=i}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,i){if(this.value!=null&&i(this.value))return{path:Dr(),value:this.value};if(cr(t))return null;{const l=sr(t),d=this.children.get(l);if(d!==null){const m=d.findRootMostMatchingPathAndValue(ss(t),i);return m!=null?{path:Os(new Zr(l),m.path),value:m.value}:null}else return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,()=>!0)}subtree(t){if(cr(t))return this;{const i=sr(t),l=this.children.get(i);return l!==null?l.subtree(ss(t)):new rs(null)}}set(t,i){if(cr(t))return new rs(i,this.children);{const l=sr(t),m=(this.children.get(l)||new rs(null)).set(ss(t),i),v=this.children.insert(l,m);return new rs(this.value,v)}}remove(t){if(cr(t))return this.children.isEmpty()?new rs(null):new rs(null,this.children);{const i=sr(t),l=this.children.get(i);if(l){const d=l.remove(ss(t));let m;return d.isEmpty()?m=this.children.remove(i):m=this.children.insert(i,d),this.value===null&&m.isEmpty()?new rs(null):new rs(this.value,m)}else return this}}get(t){if(cr(t))return this.value;{const i=sr(t),l=this.children.get(i);return l?l.get(ss(t)):null}}setTree(t,i){if(cr(t))return i;{const l=sr(t),m=(this.children.get(l)||new rs(null)).setTree(ss(t),i);let v;return m.isEmpty()?v=this.children.remove(l):v=this.children.insert(l,m),new rs(this.value,v)}}fold(t){return this.fold_(Dr(),t)}fold_(t,i){const l={};return this.children.inorderTraversal((d,m)=>{l[d]=m.fold_(Os(t,d),i)}),i(t,this.value,l)}findOnPath(t,i){return this.findOnPath_(t,Dr(),i)}findOnPath_(t,i,l){const d=this.value?l(i,this.value):!1;if(d)return d;if(cr(t))return null;{const m=sr(t),v=this.children.get(m);return v?v.findOnPath_(ss(t),Os(i,m),l):null}}foreachOnPath(t,i){return this.foreachOnPath_(t,Dr(),i)}foreachOnPath_(t,i,l){if(cr(t))return this;{this.value&&l(i,this.value);const d=sr(t),m=this.children.get(d);return m?m.foreachOnPath_(ss(t),Os(i,d),l):new rs(null)}}foreach(t){this.foreach_(Dr(),t)}foreach_(t,i){this.children.inorderTraversal((l,d)=>{d.foreach_(Os(t,l),i)}),this.value&&i(t,this.value)}foreachChild(t){this.children.inorderTraversal((i,l)=>{l.value&&t(i,l.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xc{constructor(t){this.writeTree_=t}static empty(){return new Xc(new rs(null))}}function q0(e,t,i){if(cr(t))return new Xc(new rs(i));{const l=e.writeTree_.findRootMostValueAndPath(t);if(l!=null){const d=l.path;let m=l.value;const v=ma(d,t);return m=m.updateChild(v,i),new Xc(e.writeTree_.set(d,m))}else{const d=new rs(i),m=e.writeTree_.setTree(t,d);return new Xc(m)}}}function sM(e,t,i){let l=e;return Vo(i,(d,m)=>{l=q0(l,Os(t,d),m)}),l}function p4(e,t){if(cr(t))return Xc.empty();{const i=e.writeTree_.setTree(t,new rs(null));return new Xc(i)}}function oM(e,t){return $m(e,t)!=null}function $m(e,t){const i=e.writeTree_.findRootMostValueAndPath(t);return i!=null?e.writeTree_.get(i.path).getChild(ma(i.path,t)):null}function m4(e){const t=[],i=e.writeTree_.value;return i!=null?i.isLeafNode()||i.forEachChild(Fs,(l,d)=>{t.push(new or(l,d))}):e.writeTree_.children.inorderTraversal((l,d)=>{d.value!=null&&t.push(new or(l,d.value))}),t}function Sf(e,t){if(cr(t))return e;{const i=$m(e,t);return i!=null?new Xc(new rs(i)):new Xc(e.writeTree_.subtree(t))}}function aM(e){return e.writeTree_.isEmpty()}function Uy(e,t){return mH(Dr(),e.writeTree_,t)}function mH(e,t,i){if(t.value!=null)return i.updateChild(e,t.value);{let l=null;return t.children.inorderTraversal((d,m)=>{d===".priority"?(hn(m.value!==null,"Priority writes must always be leaf nodes"),l=m.value):i=mH(Os(e,d),m,i)}),!i.getChild(e).isEmpty()&&l!==null&&(i=i.updateChild(Os(e,".priority"),l)),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NC(e,t){return vH(t,e)}function the(e,t,i,l,d){hn(l>e.lastWriteId,"Stacking an older write on top of newer ones"),d===void 0&&(d=!0),e.allWrites.push({path:t,snap:i,writeId:l,visible:d}),d&&(e.visibleWrites=q0(e.visibleWrites,t,i)),e.lastWriteId=l}function nhe(e,t,i,l){hn(l>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:t,children:i,writeId:l,visible:!0}),e.visibleWrites=sM(e.visibleWrites,t,i),e.lastWriteId=l}function ihe(e,t){for(let i=0;i<e.allWrites.length;i++){const l=e.allWrites[i];if(l.writeId===t)return l}return null}function rhe(e,t){const i=e.allWrites.findIndex(o=>o.writeId===t);hn(i>=0,"removeWrite called with nonexistent writeId.");const l=e.allWrites[i];e.allWrites.splice(i,1);let d=l.visible,m=!1,v=e.allWrites.length-1;for(;d&&v>=0;){const o=e.allWrites[v];o.visible&&(v>=i&&she(o,l.path)?d=!1:Yl(l.path,o.path)&&(m=!0)),v--}if(d){if(m)return ohe(e),!0;if(l.snap)e.visibleWrites=p4(e.visibleWrites,l.path);else{const o=l.children;Vo(o,I=>{e.visibleWrites=p4(e.visibleWrites,Os(l.path,I))})}return!0}else return!1}function she(e,t){if(e.snap)return Yl(e.path,t);for(const i in e.children)if(e.children.hasOwnProperty(i)&&Yl(Os(e.path,i),t))return!0;return!1}function ohe(e){e.visibleWrites=gH(e.allWrites,ahe,Dr()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}function ahe(e){return e.visible}function gH(e,t,i){let l=Xc.empty();for(let d=0;d<e.length;++d){const m=e[d];if(t(m)){const v=m.path;let o;if(m.snap)Yl(i,v)?(o=ma(i,v),l=q0(l,o,m.snap)):Yl(v,i)&&(o=ma(v,i),l=q0(l,Dr(),m.snap.getChild(o)));else if(m.children){if(Yl(i,v))o=ma(i,v),l=sM(l,o,m.children);else if(Yl(v,i))if(o=ma(v,i),cr(o))l=sM(l,Dr(),m.children);else{const I=zy(m.children,sr(o));if(I){const A=I.getChild(ss(o));l=q0(l,Dr(),A)}}}else throw iv("WriteRecord should have .snap or .children")}}return l}function _H(e,t,i,l,d){if(!l&&!d){const m=$m(e.visibleWrites,t);if(m!=null)return m;{const v=Sf(e.visibleWrites,t);if(aM(v))return i;if(i==null&&!oM(v,Dr()))return null;{const o=i||Ei.EMPTY_NODE;return Uy(v,o)}}}else{const m=Sf(e.visibleWrites,t);if(!d&&aM(m))return i;if(!d&&i==null&&!oM(m,Dr()))return null;{const v=function(A){return(A.visible||d)&&(!l||!~l.indexOf(A.writeId))&&(Yl(A.path,t)||Yl(t,A.path))},o=gH(e.allWrites,v,t),I=i||Ei.EMPTY_NODE;return Uy(o,I)}}}function lhe(e,t,i){let l=Ei.EMPTY_NODE;const d=$m(e.visibleWrites,t);if(d)return d.isLeafNode()||d.forEachChild(Fs,(m,v)=>{l=l.updateImmediateChild(m,v)}),l;if(i){const m=Sf(e.visibleWrites,t);return i.forEachChild(Fs,(v,o)=>{const I=Uy(Sf(m,new Zr(v)),o);l=l.updateImmediateChild(v,I)}),m4(m).forEach(v=>{l=l.updateImmediateChild(v.name,v.node)}),l}else{const m=Sf(e.visibleWrites,t);return m4(m).forEach(v=>{l=l.updateImmediateChild(v.name,v.node)}),l}}function che(e,t,i,l,d){hn(l||d,"Either existingEventSnap or existingServerSnap must exist");const m=Os(t,i);if(oM(e.visibleWrites,m))return null;{const v=Sf(e.visibleWrites,m);return aM(v)?d.getChild(i):Uy(v,d.getChild(i))}}function uhe(e,t,i,l){const d=Os(t,i),m=$m(e.visibleWrites,d);if(m!=null)return m;if(l.isCompleteForChild(i)){const v=Sf(e.visibleWrites,d);return Uy(v,l.getNode().getImmediateChild(i))}else return null}function dhe(e,t){return $m(e.visibleWrites,t)}function hhe(e,t,i,l,d,m,v){let o;const I=Sf(e.visibleWrites,t),A=$m(I,Dr());if(A!=null)o=A;else if(i!=null)o=Uy(I,i);else return[];if(o=o.withIndex(v),!o.isEmpty()&&!o.isLeafNode()){const N=[],F=v.getCompare(),z=m?o.getReverseIteratorFrom(l,v):o.getIteratorFrom(l,v);let $=z.getNext();for(;$&&N.length<d;)F($,l)!==0&&N.push($),$=z.getNext();return N}else return[]}function fhe(){return{visibleWrites:Xc.empty(),allWrites:[],lastWriteId:-1}}function PS(e,t,i,l){return _H(e.writeTree,e.treePath,t,i,l)}function YD(e,t){return lhe(e.writeTree,e.treePath,t)}function g4(e,t,i,l){return che(e.writeTree,e.treePath,t,i,l)}function RS(e,t){return dhe(e.writeTree,Os(e.treePath,t))}function phe(e,t,i,l,d,m){return hhe(e.writeTree,e.treePath,t,i,l,d,m)}function QD(e,t,i){return uhe(e.writeTree,e.treePath,t,i)}function yH(e,t){return vH(Os(e.treePath,t),e.writeTree)}function vH(e,t){return{treePath:e,writeTree:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mhe{constructor(){this.changeMap=new Map}trackChildChange(t){const i=t.type,l=t.childName;hn(i==="child_added"||i==="child_changed"||i==="child_removed","Only child changes supported for tracking"),hn(l!==".priority","Only non-priority child changes can be tracked.");const d=this.changeMap.get(l);if(d){const m=d.type;if(i==="child_added"&&m==="child_removed")this.changeMap.set(l,k1(l,t.snapshotNode,d.snapshotNode));else if(i==="child_removed"&&m==="child_added")this.changeMap.delete(l);else if(i==="child_removed"&&m==="child_changed")this.changeMap.set(l,M1(l,d.oldSnap));else if(i==="child_changed"&&m==="child_added")this.changeMap.set(l,By(l,t.snapshotNode));else if(i==="child_changed"&&m==="child_changed")this.changeMap.set(l,k1(l,t.snapshotNode,d.oldSnap));else throw iv("Illegal combination of changes: "+t+" occurred after "+d)}else this.changeMap.set(l,t)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ghe{getCompleteChild(t){return null}getChildAfterChild(t,i,l){return null}}const xH=new ghe;class JD{constructor(t,i,l=null){this.writes_=t,this.viewCache_=i,this.optCompleteServerCache_=l}getCompleteChild(t){const i=this.viewCache_.eventCache;if(i.isCompleteForChild(t))return i.getNode().getImmediateChild(t);{const l=this.optCompleteServerCache_!=null?new Ff(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return QD(this.writes_,t,l)}}getChildAfterChild(t,i,l){const d=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Rm(this.viewCache_),m=phe(this.writes_,d,i,1,l,t);return m.length===0?null:m[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _he(e){return{filter:e}}function yhe(e,t){hn(t.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),hn(t.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed")}function vhe(e,t,i,l,d){const m=new mhe;let v,o;if(i.type===Gc.OVERWRITE){const A=i;A.source.fromUser?v=lM(e,t,A.path,A.snap,l,d,m):(hn(A.source.fromServer,"Unknown source."),o=A.source.tagged||t.serverCache.isFiltered()&&!cr(A.path),v=MS(e,t,A.path,A.snap,l,d,o,m))}else if(i.type===Gc.MERGE){const A=i;A.source.fromUser?v=bhe(e,t,A.path,A.children,l,d,m):(hn(A.source.fromServer,"Unknown source."),o=A.source.tagged||t.serverCache.isFiltered(),v=cM(e,t,A.path,A.children,l,d,o,m))}else if(i.type===Gc.ACK_USER_WRITE){const A=i;A.revert?v=Ehe(e,t,A.path,l,d,m):v=whe(e,t,A.path,A.affectedTree,l,d,m)}else if(i.type===Gc.LISTEN_COMPLETE)v=The(e,t,i.path,l,m);else throw iv("Unknown operation type: "+i.type);const I=m.getChanges();return xhe(t,v,I),{viewCache:v,changes:I}}function xhe(e,t,i){const l=t.eventCache;if(l.isFullyInitialized()){const d=l.getNode().isLeafNode()||l.getNode().isEmpty(),m=AS(e);(i.length>0||!e.eventCache.isFullyInitialized()||d&&!l.getNode().equals(m)||!l.getNode().getPriority().equals(m.getPriority()))&&i.push(hH(AS(t)))}}function bH(e,t,i,l,d,m){const v=t.eventCache;if(RS(l,i)!=null)return t;{let o,I;if(cr(i))if(hn(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const A=Rm(t),N=A instanceof Ei?A:Ei.EMPTY_NODE,F=YD(l,N);o=e.filter.updateFullNode(t.eventCache.getNode(),F,m)}else{const A=PS(l,Rm(t));o=e.filter.updateFullNode(t.eventCache.getNode(),A,m)}else{const A=sr(i);if(A===".priority"){hn(Of(i)===1,"Can't have a priority with additional path components");const N=v.getNode();I=t.serverCache.getNode();const F=g4(l,i,N,I);F!=null?o=e.filter.updatePriority(N,F):o=v.getNode()}else{const N=ss(i);let F;if(v.isCompleteForChild(A)){I=t.serverCache.getNode();const z=g4(l,i,v.getNode(),I);z!=null?F=v.getNode().getImmediateChild(A).updateChild(N,z):F=v.getNode().getImmediateChild(A)}else F=QD(l,A,t.serverCache);F!=null?o=e.filter.updateChild(v.getNode(),A,F,N,d,m):o=v.getNode()}}return W0(t,o,v.isFullyInitialized()||cr(i),e.filter.filtersNodes())}}function MS(e,t,i,l,d,m,v,o){const I=t.serverCache;let A;const N=v?e.filter:e.filter.getIndexedFilter();if(cr(i))A=N.updateFullNode(I.getNode(),l,null);else if(N.filtersNodes()&&!I.isFiltered()){const $=I.getNode().updateChild(i,l);A=N.updateFullNode(I.getNode(),$,null)}else{const $=sr(i);if(!I.isCompleteForPath(i)&&Of(i)>1)return t;const J=ss(i),re=I.getNode().getImmediateChild($).updateChild(J,l);$===".priority"?A=N.updatePriority(I.getNode(),re):A=N.updateChild(I.getNode(),$,re,J,xH,null)}const F=pH(t,A,I.isFullyInitialized()||cr(i),N.filtersNodes()),z=new JD(d,F,m);return bH(e,F,i,d,z,o)}function lM(e,t,i,l,d,m,v){const o=t.eventCache;let I,A;const N=new JD(d,t,m);if(cr(i))A=e.filter.updateFullNode(t.eventCache.getNode(),l,v),I=W0(t,A,!0,e.filter.filtersNodes());else{const F=sr(i);if(F===".priority")A=e.filter.updatePriority(t.eventCache.getNode(),l),I=W0(t,A,o.isFullyInitialized(),o.isFiltered());else{const z=ss(i),$=o.getNode().getImmediateChild(F);let J;if(cr(z))J=l;else{const H=N.getCompleteChild(F);H!=null?UD(z)===".priority"&&H.getChild(sH(z)).isEmpty()?J=H:J=H.updateChild(z,l):J=Ei.EMPTY_NODE}if($.equals(J))I=t;else{const H=e.filter.updateChild(o.getNode(),F,J,z,N,v);I=W0(t,H,o.isFullyInitialized(),e.filter.filtersNodes())}}}return I}function _4(e,t){return e.eventCache.isCompleteForChild(t)}function bhe(e,t,i,l,d,m,v){let o=t;return l.foreach((I,A)=>{const N=Os(i,I);_4(t,sr(N))&&(o=lM(e,o,N,A,d,m,v))}),l.foreach((I,A)=>{const N=Os(i,I);_4(t,sr(N))||(o=lM(e,o,N,A,d,m,v))}),o}function y4(e,t,i){return i.foreach((l,d)=>{t=t.updateChild(l,d)}),t}function cM(e,t,i,l,d,m,v,o){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let I=t,A;cr(i)?A=l:A=new rs(null).setTree(i,l);const N=t.serverCache.getNode();return A.children.inorderTraversal((F,z)=>{if(N.hasChild(F)){const $=t.serverCache.getNode().getImmediateChild(F),J=y4(e,$,z);I=MS(e,I,new Zr(F),J,d,m,v,o)}}),A.children.inorderTraversal((F,z)=>{const $=!t.serverCache.isCompleteForChild(F)&&z.value===null;if(!N.hasChild(F)&&!$){const J=t.serverCache.getNode().getImmediateChild(F),H=y4(e,J,z);I=MS(e,I,new Zr(F),H,d,m,v,o)}}),I}function whe(e,t,i,l,d,m,v){if(RS(d,i)!=null)return t;const o=t.serverCache.isFiltered(),I=t.serverCache;if(l.value!=null){if(cr(i)&&I.isFullyInitialized()||I.isCompleteForPath(i))return MS(e,t,i,I.getNode().getChild(i),d,m,o,v);if(cr(i)){let A=new rs(null);return I.getNode().forEachChild(gy,(N,F)=>{A=A.set(new Zr(N),F)}),cM(e,t,i,A,d,m,o,v)}else return t}else{let A=new rs(null);return l.foreach((N,F)=>{const z=Os(i,N);I.isCompleteForPath(z)&&(A=A.set(N,I.getNode().getChild(z)))}),cM(e,t,i,A,d,m,o,v)}}function The(e,t,i,l,d){const m=t.serverCache,v=pH(t,m.getNode(),m.isFullyInitialized()||cr(i),m.isFiltered());return bH(e,v,i,l,xH,d)}function Ehe(e,t,i,l,d,m){let v;if(RS(l,i)!=null)return t;{const o=new JD(l,t,d),I=t.eventCache.getNode();let A;if(cr(i)||sr(i)===".priority"){let N;if(t.serverCache.isFullyInitialized())N=PS(l,Rm(t));else{const F=t.serverCache.getNode();hn(F instanceof Ei,"serverChildren would be complete if leaf node"),N=YD(l,F)}N=N,A=e.filter.updateFullNode(I,N,m)}else{const N=sr(i);let F=QD(l,N,t.serverCache);F==null&&t.serverCache.isCompleteForChild(N)&&(F=I.getImmediateChild(N)),F!=null?A=e.filter.updateChild(I,N,F,ss(i),o,m):t.eventCache.getNode().hasChild(N)?A=e.filter.updateChild(I,N,Ei.EMPTY_NODE,ss(i),o,m):A=I,A.isEmpty()&&t.serverCache.isFullyInitialized()&&(v=PS(l,Rm(t)),v.isLeafNode()&&(A=e.filter.updateFullNode(A,v,m)))}return v=t.serverCache.isFullyInitialized()||RS(l,Dr())!=null,W0(t,A,v,e.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class She{constructor(t,i){this.query_=t,this.eventRegistrations_=[];const l=this.query_._queryParams,d=new WD(l.getIndex()),m=$de(l);this.processor_=_he(m);const v=i.serverCache,o=i.eventCache,I=d.updateFullNode(Ei.EMPTY_NODE,v.getNode(),null),A=m.updateFullNode(Ei.EMPTY_NODE,o.getNode(),null),N=new Ff(I,v.isFullyInitialized(),d.filtersNodes()),F=new Ff(A,o.isFullyInitialized(),m.filtersNodes());this.viewCache_=DC(F,N),this.eventGenerator_=new Xde(this.query_)}get query(){return this.query_}}function Che(e){return e.viewCache_.serverCache.getNode()}function Ihe(e){return AS(e.viewCache_)}function Ahe(e,t){const i=Rm(e.viewCache_);return i&&(e.query._queryParams.loadsAllData()||!cr(t)&&!i.getImmediateChild(sr(t)).isEmpty())?i.getChild(t):null}function v4(e){return e.eventRegistrations_.length===0}function Phe(e,t){e.eventRegistrations_.push(t)}function x4(e,t,i){const l=[];if(i){hn(t==null,"A cancel should cancel all event registrations.");const d=e.query._path;e.eventRegistrations_.forEach(m=>{const v=m.createCancelEvent(i,d);v&&l.push(v)})}if(t){let d=[];for(let m=0;m<e.eventRegistrations_.length;++m){const v=e.eventRegistrations_[m];if(!v.matches(t))d.push(v);else if(t.hasAnyCallback()){d=d.concat(e.eventRegistrations_.slice(m+1));break}}e.eventRegistrations_=d}else e.eventRegistrations_=[];return l}function b4(e,t,i,l){t.type===Gc.MERGE&&t.source.queryId!==null&&(hn(Rm(e.viewCache_),"We should always have a full cache before handling merges"),hn(AS(e.viewCache_),"Missing event cache, even though we have a server cache"));const d=e.viewCache_,m=vhe(e.processor_,d,t,i,l);return yhe(e.processor_,m.viewCache),hn(m.viewCache.serverCache.isFullyInitialized()||!d.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=m.viewCache,wH(e,m.changes,m.viewCache.eventCache.getNode(),null)}function Rhe(e,t){const i=e.viewCache_.eventCache,l=[];return i.getNode().isLeafNode()||i.getNode().forEachChild(Fs,(m,v)=>{l.push(By(m,v))}),i.isFullyInitialized()&&l.push(hH(i.getNode())),wH(e,l,i.getNode(),t)}function wH(e,t,i,l){const d=l?[l]:e.eventRegistrations_;return Yde(e.eventGenerator_,t,i,d)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kS;class TH{constructor(){this.views=new Map}}function Mhe(e){hn(!kS,"__referenceConstructor has already been defined"),kS=e}function khe(){return hn(kS,"Reference.ts has not been loaded"),kS}function Dhe(e){return e.views.size===0}function eN(e,t,i,l){const d=t.source.queryId;if(d!==null){const m=e.views.get(d);return hn(m!=null,"SyncTree gave us an op for an invalid query."),b4(m,t,i,l)}else{let m=[];for(const v of e.views.values())m=m.concat(b4(v,t,i,l));return m}}function EH(e,t,i,l,d){const m=t._queryIdentifier,v=e.views.get(m);if(!v){let o=PS(i,d?l:null),I=!1;o?I=!0:l instanceof Ei?(o=YD(i,l),I=!1):(o=Ei.EMPTY_NODE,I=!1);const A=DC(new Ff(o,I,!1),new Ff(l,d,!1));return new She(t,A)}return v}function Nhe(e,t,i,l,d,m){const v=EH(e,t,l,d,m);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,v),Phe(v,i),Rhe(v,i)}function Lhe(e,t,i,l){const d=t._queryIdentifier,m=[];let v=[];const o=zf(e);if(d==="default")for(const[I,A]of e.views.entries())v=v.concat(x4(A,i,l)),v4(A)&&(e.views.delete(I),A.query._queryParams.loadsAllData()||m.push(A.query));else{const I=e.views.get(d);I&&(v=v.concat(x4(I,i,l)),v4(I)&&(e.views.delete(d),I.query._queryParams.loadsAllData()||m.push(I.query)))}return o&&!zf(e)&&m.push(new(khe())(t._repo,t._path)),{removed:m,events:v}}function SH(e){const t=[];for(const i of e.views.values())i.query._queryParams.loadsAllData()||t.push(i);return t}function Cf(e,t){let i=null;for(const l of e.views.values())i=i||Ahe(l,t);return i}function CH(e,t){if(t._queryParams.loadsAllData())return LC(e);{const l=t._queryIdentifier;return e.views.get(l)}}function IH(e,t){return CH(e,t)!=null}function zf(e){return LC(e)!=null}function LC(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let DS;function Ohe(e){hn(!DS,"__referenceConstructor has already been defined"),DS=e}function Fhe(){return hn(DS,"Reference.ts has not been loaded"),DS}let zhe=1;class w4{constructor(t){this.listenProvider_=t,this.syncPointTree_=new rs(null),this.pendingWriteTree_=fhe(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function AH(e,t,i,l,d){return the(e.pendingWriteTree_,t,i,l,d),d?av(e,new Pm(ZD(),t,i)):[]}function jhe(e,t,i,l){nhe(e.pendingWriteTree_,t,i,l);const d=rs.fromObject(i);return av(e,new Vy(ZD(),t,d))}function uf(e,t,i=!1){const l=ihe(e.pendingWriteTree_,t);if(rhe(e.pendingWriteTree_,t)){let m=new rs(null);return l.snap!=null?m=m.set(Dr(),!0):Vo(l.children,v=>{m=m.set(new Zr(v),!0)}),av(e,new IS(l.path,m,i))}else return[]}function cb(e,t,i){return av(e,new Pm(KD(),t,i))}function Bhe(e,t,i){const l=rs.fromObject(i);return av(e,new Vy(KD(),t,l))}function Vhe(e,t){return av(e,new N1(KD(),t))}function Uhe(e,t,i){const l=nN(e,i);if(l){const d=iN(l),m=d.path,v=d.queryId,o=ma(m,t),I=new N1(XD(v),o);return rN(e,m,I)}else return[]}function NS(e,t,i,l,d=!1){const m=t._path,v=e.syncPointTree_.get(m);let o=[];if(v&&(t._queryIdentifier==="default"||IH(v,t))){const I=Lhe(v,t,i,l);Dhe(v)&&(e.syncPointTree_=e.syncPointTree_.remove(m));const A=I.removed;if(o=I.events,!d){const N=A.findIndex(z=>z._queryParams.loadsAllData())!==-1,F=e.syncPointTree_.findOnPath(m,(z,$)=>zf($));if(N&&!F){const z=e.syncPointTree_.subtree(m);if(!z.isEmpty()){const $=Hhe(z);for(let J=0;J<$.length;++J){const H=$[J],re=H.query,Q=kH(e,H);e.listenProvider_.startListening(Z0(re),L1(e,re),Q.hashFn,Q.onComplete)}}}!F&&A.length>0&&!l&&(N?e.listenProvider_.stopListening(Z0(t),null):A.forEach(z=>{const $=e.queryToTagMap.get(OC(z));e.listenProvider_.stopListening(Z0(z),$)}))}Whe(e,A)}return o}function PH(e,t,i,l){const d=nN(e,l);if(d!=null){const m=iN(d),v=m.path,o=m.queryId,I=ma(v,t),A=new Pm(XD(o),I,i);return rN(e,v,A)}else return[]}function $he(e,t,i,l){const d=nN(e,l);if(d){const m=iN(d),v=m.path,o=m.queryId,I=ma(v,t),A=rs.fromObject(i),N=new Vy(XD(o),I,A);return rN(e,v,N)}else return[]}function uM(e,t,i,l=!1){const d=t._path;let m=null,v=!1;e.syncPointTree_.foreachOnPath(d,(z,$)=>{const J=ma(z,d);m=m||Cf($,J),v=v||zf($)});let o=e.syncPointTree_.get(d);o?(v=v||zf(o),m=m||Cf(o,Dr())):(o=new TH,e.syncPointTree_=e.syncPointTree_.set(d,o));let I;m!=null?I=!0:(I=!1,m=Ei.EMPTY_NODE,e.syncPointTree_.subtree(d).foreachChild(($,J)=>{const H=Cf(J,Dr());H&&(m=m.updateImmediateChild($,H))}));const A=IH(o,t);if(!A&&!t._queryParams.loadsAllData()){const z=OC(t);hn(!e.queryToTagMap.has(z),"View does not exist, but we have a tag");const $=qhe();e.queryToTagMap.set(z,$),e.tagToQueryMap.set($,z)}const N=NC(e.pendingWriteTree_,d);let F=Nhe(o,t,i,N,m,I);if(!A&&!v&&!l){const z=CH(o,t);F=F.concat(Zhe(e,t,z))}return F}function tN(e,t,i){const d=e.pendingWriteTree_,m=e.syncPointTree_.findOnPath(t,(v,o)=>{const I=ma(v,t),A=Cf(o,I);if(A)return A});return _H(d,t,m,i,!0)}function Ghe(e,t){const i=t._path;let l=null;e.syncPointTree_.foreachOnPath(i,(A,N)=>{const F=ma(A,i);l=l||Cf(N,F)});let d=e.syncPointTree_.get(i);d?l=l||Cf(d,Dr()):(d=new TH,e.syncPointTree_=e.syncPointTree_.set(i,d));const m=l!=null,v=m?new Ff(l,!0,!1):null,o=NC(e.pendingWriteTree_,t._path),I=EH(d,t,o,m?v.getNode():Ei.EMPTY_NODE,m);return Ihe(I)}function av(e,t){return RH(t,e.syncPointTree_,null,NC(e.pendingWriteTree_,Dr()))}function RH(e,t,i,l){if(cr(e.path))return MH(e,t,i,l);{const d=t.get(Dr());i==null&&d!=null&&(i=Cf(d,Dr()));let m=[];const v=sr(e.path),o=e.operationForChild(v),I=t.children.get(v);if(I&&o){const A=i?i.getImmediateChild(v):null,N=yH(l,v);m=m.concat(RH(o,I,A,N))}return d&&(m=m.concat(eN(d,e,l,i))),m}}function MH(e,t,i,l){const d=t.get(Dr());i==null&&d!=null&&(i=Cf(d,Dr()));let m=[];return t.children.inorderTraversal((v,o)=>{const I=i?i.getImmediateChild(v):null,A=yH(l,v),N=e.operationForChild(v);N&&(m=m.concat(MH(N,o,I,A)))}),d&&(m=m.concat(eN(d,e,l,i))),m}function kH(e,t){const i=t.query,l=L1(e,i);return{hashFn:()=>(Che(t)||Ei.EMPTY_NODE).hash(),onComplete:d=>{if(d==="ok")return l?Uhe(e,i._path,l):Vhe(e,i._path);{const m=Vue(d,i);return NS(e,i,null,m)}}}}function L1(e,t){const i=OC(t);return e.queryToTagMap.get(i)}function OC(e){return e._path.toString()+"$"+e._queryIdentifier}function nN(e,t){return e.tagToQueryMap.get(t)}function iN(e){const t=e.indexOf("$");return hn(t!==-1&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Zr(e.substr(0,t))}}function rN(e,t,i){const l=e.syncPointTree_.get(t);hn(l,"Missing sync point for query tag that we're tracking");const d=NC(e.pendingWriteTree_,t);return eN(l,i,d,null)}function Hhe(e){return e.fold((t,i,l)=>{if(i&&zf(i))return[LC(i)];{let d=[];return i&&(d=SH(i)),Vo(l,(m,v)=>{d=d.concat(v)}),d}})}function Z0(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(Fhe())(e._repo,e._path):e}function Whe(e,t){for(let i=0;i<t.length;++i){const l=t[i];if(!l._queryParams.loadsAllData()){const d=OC(l),m=e.queryToTagMap.get(d);e.queryToTagMap.delete(d),e.tagToQueryMap.delete(m)}}}function qhe(){return zhe++}function Zhe(e,t,i){const l=t._path,d=L1(e,t),m=kH(e,i),v=e.listenProvider_.startListening(Z0(t),d,m.hashFn,m.onComplete),o=e.syncPointTree_.subtree(l);if(d)hn(!zf(o.value),"If we're adding a query, it shouldn't be shadowed");else{const I=o.fold((A,N,F)=>{if(!cr(A)&&N&&zf(N))return[LC(N).query];{let z=[];return N&&(z=z.concat(SH(N).map($=>$.query))),Vo(F,($,J)=>{z=z.concat(J)}),z}});for(let A=0;A<I.length;++A){const N=I[A];e.listenProvider_.stopListening(Z0(N),L1(e,N))}}return v}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sN{constructor(t){this.node_=t}getImmediateChild(t){const i=this.node_.getImmediateChild(t);return new sN(i)}node(){return this.node_}}class oN{constructor(t,i){this.syncTree_=t,this.path_=i}getImmediateChild(t){const i=Os(this.path_,t);return new oN(this.syncTree_,i)}node(){return tN(this.syncTree_,this.path_)}}const Khe=function(e){return e=e||{},e.timestamp=e.timestamp||new Date().getTime(),e},T4=function(e,t,i){if(!e||typeof e!="object")return e;if(hn(".sv"in e,"Unexpected leaf node or priority contents"),typeof e[".sv"]=="string")return Xhe(e[".sv"],t,i);if(typeof e[".sv"]=="object")return Yhe(e[".sv"],t);hn(!1,"Unexpected server value: "+JSON.stringify(e,null,2))},Xhe=function(e,t,i){switch(e){case"timestamp":return i.timestamp;default:hn(!1,"Unexpected server value: "+e)}},Yhe=function(e,t,i){e.hasOwnProperty("increment")||hn(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const l=e.increment;typeof l!="number"&&hn(!1,"Unexpected increment value: "+l);const d=t.node();if(hn(d!==null&&typeof d<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!d.isLeafNode())return l;const v=d.getValue();return typeof v!="number"?l:v+l},DH=function(e,t,i,l){return aN(t,new oN(i,e),l)},NH=function(e,t,i){return aN(e,new sN(t),i)};function aN(e,t,i){const l=e.getPriority().val(),d=T4(l,t.getImmediateChild(".priority"),i);let m;if(e.isLeafNode()){const v=e,o=T4(v.getValue(),t,i);return o!==v.getValue()||d!==v.getPriority().val()?new To(o,co(d)):e}else{const v=e;return m=v,d!==v.getPriority().val()&&(m=m.updatePriority(new To(d))),v.forEachChild(Fs,(o,I)=>{const A=aN(I,t.getImmediateChild(o),i);A!==I&&(m=m.updateImmediateChild(o,A))}),m}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lN{constructor(t="",i=null,l={children:{},childCount:0}){this.name=t,this.parent=i,this.node=l}}function cN(e,t){let i=t instanceof Zr?t:new Zr(t),l=e,d=sr(i);for(;d!==null;){const m=zy(l.node.children,d)||{children:{},childCount:0};l=new lN(d,l,m),i=ss(i),d=sr(i)}return l}function lv(e){return e.node.value}function LH(e,t){e.node.value=t,dM(e)}function OH(e){return e.node.childCount>0}function Qhe(e){return lv(e)===void 0&&!OH(e)}function FC(e,t){Vo(e.node.children,(i,l)=>{t(new lN(i,e,l))})}function FH(e,t,i,l){i&&!l&&t(e),FC(e,d=>{FH(d,t,!0,l)}),i&&l&&t(e)}function Jhe(e,t,i){let l=e.parent;for(;l!==null;){if(t(l))return!0;l=l.parent}return!1}function ub(e){return new Zr(e.parent===null?e.name:ub(e.parent)+"/"+e.name)}function dM(e){e.parent!==null&&efe(e.parent,e.name,e)}function efe(e,t,i){const l=Qhe(i),d=ed(e.node.children,t);l&&d?(delete e.node.children[t],e.node.childCount--,dM(e)):!l&&!d&&(e.node.children[t]=i.node,e.node.childCount++,dM(e))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tfe=/[\[\].#$\/\u0000-\u001F\u007F]/,nfe=/[\[\].#$\u0000-\u001F\u007F]/,aP=10*1024*1024,uN=function(e){return typeof e=="string"&&e.length!==0&&!tfe.test(e)},zH=function(e){return typeof e=="string"&&e.length!==0&&!nfe.test(e)},ife=function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),zH(e)},rfe=function(e){return e===null||typeof e=="string"||typeof e=="number"&&!FD(e)||e&&typeof e=="object"&&ed(e,".sv")},jH=function(e,t,i,l){l&&t===void 0||zC(CC(e,"value"),t,i)},zC=function(e,t,i){const l=i instanceof Zr?new bde(i,e):i;if(t===void 0)throw new Error(e+"contains undefined "+Jp(l));if(typeof t=="function")throw new Error(e+"contains a function "+Jp(l)+" with contents = "+t.toString());if(FD(t))throw new Error(e+"contains "+t.toString()+" "+Jp(l));if(typeof t=="string"&&t.length>aP/3&&IC(t)>aP)throw new Error(e+"contains a string greater than "+aP+" utf8 bytes "+Jp(l)+" ('"+t.substring(0,50)+"...')");if(t&&typeof t=="object"){let d=!1,m=!1;if(Vo(t,(v,o)=>{if(v===".value")d=!0;else if(v!==".priority"&&v!==".sv"&&(m=!0,!uN(v)))throw new Error(e+" contains an invalid key ("+v+") "+Jp(l)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);wde(l,v),zC(e,o,l),Tde(l)}),d&&m)throw new Error(e+' contains ".value" child '+Jp(l)+" in addition to actual children.")}},sfe=function(e,t){let i,l;for(i=0;i<t.length;i++){l=t[i];const m=R1(l);for(let v=0;v<m.length;v++)if(!(m[v]===".priority"&&v===m.length-1)){if(!uN(m[v]))throw new Error(e+"contains an invalid key ("+m[v]+") in path "+l.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}t.sort(xde);let d=null;for(i=0;i<t.length;i++){if(l=t[i],d!==null&&Yl(d,l))throw new Error(e+"contains a path "+d.toString()+" that is ancestor of another path "+l.toString());d=l}},ofe=function(e,t,i,l){const d=CC(e,"values");if(!(t&&typeof t=="object")||Array.isArray(t))throw new Error(d+" must be an object containing the children to replace.");const m=[];Vo(t,(v,o)=>{const I=new Zr(v);if(zC(d,o,Os(i,I)),UD(I)===".priority"&&!rfe(o))throw new Error(d+"contains an invalid value for '"+I.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");m.push(I)}),sfe(d,m)},BH=function(e,t,i,l){if(!zH(i))throw new Error(CC(e,t)+'was an invalid path = "'+i+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},afe=function(e,t,i,l){i&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),BH(e,t,i)},dN=function(e,t){if(sr(t)===".info")throw new Error(e+" failed = Can't modify data under /.info/")},lfe=function(e,t){const i=t.path.toString();if(typeof t.repoInfo.host!="string"||t.repoInfo.host.length===0||!uN(t.repoInfo.namespace)&&t.repoInfo.host.split(":")[0]!=="localhost"||i.length!==0&&!ife(i))throw new Error(CC(e,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cfe{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function jC(e,t){let i=null;for(let l=0;l<t.length;l++){const d=t[l],m=d.getPath();i!==null&&!$D(m,i.path)&&(e.eventLists_.push(i),i=null),i===null&&(i={events:[],path:m}),i.events.push(d)}i&&e.eventLists_.push(i)}function VH(e,t,i){jC(e,i),UH(e,l=>$D(l,t))}function rc(e,t,i){jC(e,i),UH(e,l=>Yl(l,t)||Yl(t,l))}function UH(e,t){e.recursionDepth_++;let i=!0;for(let l=0;l<e.eventLists_.length;l++){const d=e.eventLists_[l];if(d){const m=d.path;t(m)?(ufe(e.eventLists_[l]),e.eventLists_[l]=null):i=!1}}i&&(e.eventLists_=[]),e.recursionDepth_--}function ufe(e){for(let t=0;t<e.events.length;t++){const i=e.events[t];if(i!==null){e.events[t]=null;const l=i.getEventRunner();G0&&zo("event: "+i.toString()),ov(l)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dfe="repo_interrupt",hfe=25;class ffe{constructor(t,i,l,d){this.repoInfo_=t,this.forceRestClient_=i,this.authTokenProvider_=l,this.appCheckProvider_=d,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new cfe,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=CS(),this.transactionQueueTree_=new lN,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function pfe(e,t,i){if(e.stats_=BD(e.repoInfo_),e.forceRestClient_||Hue())e.server_=new SS(e.repoInfo_,(l,d,m,v)=>{E4(e,l,d,m,v)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>S4(e,!0),0);else{if(typeof i<"u"&&i!==null){if(typeof i!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{uo(i)}catch(l){throw new Error("Invalid authOverride provided: "+l)}}e.persistentConnection_=new $d(e.repoInfo_,t,(l,d,m,v)=>{E4(e,l,d,m,v)},l=>{S4(e,l)},l=>{mfe(e,l)},e.authTokenProvider_,e.appCheckProvider_,i),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(l=>{e.server_.refreshAuthToken(l)}),e.appCheckProvider_.addTokenChangeListener(l=>{e.server_.refreshAppCheckToken(l.token)}),e.statsReporter_=Xue(e.repoInfo_,()=>new Kde(e.stats_,e.server_)),e.infoData_=new Gde,e.infoSyncTree_=new w4({startListening:(l,d,m,v)=>{let o=[];const I=e.infoData_.getNode(l._path);return I.isEmpty()||(o=cb(e.infoSyncTree_,l._path,I),setTimeout(()=>{v("ok")},0)),o},stopListening:()=>{}}),hN(e,"connected",!1),e.serverSyncTree_=new w4({startListening:(l,d,m,v)=>(e.server_.listen(l,m,d,(o,I)=>{const A=v(o,I);rc(e.eventQueue_,l._path,A)}),[]),stopListening:(l,d)=>{e.server_.unlisten(l,d)}})}function $H(e){const i=e.infoData_.getNode(new Zr(".info/serverTimeOffset")).val()||0;return new Date().getTime()+i}function BC(e){return Khe({timestamp:$H(e)})}function E4(e,t,i,l,d){e.dataUpdateCount++;const m=new Zr(t);i=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,i):i;let v=[];if(d)if(l){const I=pS(i,A=>co(A));v=$he(e.serverSyncTree_,m,I,d)}else{const I=co(i);v=PH(e.serverSyncTree_,m,I,d)}else if(l){const I=pS(i,A=>co(A));v=Bhe(e.serverSyncTree_,m,I)}else{const I=co(i);v=cb(e.serverSyncTree_,m,I)}let o=m;v.length>0&&(o=$y(e,m)),rc(e.eventQueue_,o,v)}function S4(e,t){hN(e,"connected",t),t===!1&&vfe(e)}function mfe(e,t){Vo(t,(i,l)=>{hN(e,i,l)})}function hN(e,t,i){const l=new Zr("/.info/"+t),d=co(i);e.infoData_.updateSnapshot(l,d);const m=cb(e.infoSyncTree_,l,d);rc(e.eventQueue_,l,m)}function fN(e){return e.nextWriteId_++}function gfe(e,t,i){const l=Ghe(e.serverSyncTree_,t);return l!=null?Promise.resolve(l):e.server_.get(t).then(d=>{const m=co(d).withIndex(t._queryParams.getIndex());uM(e.serverSyncTree_,t,i,!0);let v;if(t._queryParams.loadsAllData())v=cb(e.serverSyncTree_,t._path,m);else{const o=L1(e.serverSyncTree_,t);v=PH(e.serverSyncTree_,t._path,m,o)}return rc(e.eventQueue_,t._path,v),NS(e.serverSyncTree_,t,i,null,!0),m},d=>(db(e,"get for query "+uo(t)+" failed: "+d),Promise.reject(new Error(d))))}function _fe(e,t,i,l,d){db(e,"set",{path:t.toString(),value:i,priority:l});const m=BC(e),v=co(i,l),o=tN(e.serverSyncTree_,t),I=NH(v,o,m),A=fN(e),N=AH(e.serverSyncTree_,t,I,A,!0);jC(e.eventQueue_,N),e.server_.put(t.toString(),v.val(!0),(z,$)=>{const J=z==="ok";J||va("set at "+t+" failed: "+z);const H=uf(e.serverSyncTree_,A,!J);rc(e.eventQueue_,t,H),hM(e,d,z,$)});const F=mN(e,t);$y(e,F),rc(e.eventQueue_,F,[])}function yfe(e,t,i,l){db(e,"update",{path:t.toString(),value:i});let d=!0;const m=BC(e),v={};if(Vo(i,(o,I)=>{d=!1,v[o]=DH(Os(t,o),co(I),e.serverSyncTree_,m)}),d)zo("update() called with empty data.  Don't do anything."),hM(e,l,"ok",void 0);else{const o=fN(e),I=jhe(e.serverSyncTree_,t,v,o);jC(e.eventQueue_,I),e.server_.merge(t.toString(),i,(A,N)=>{const F=A==="ok";F||va("update at "+t+" failed: "+A);const z=uf(e.serverSyncTree_,o,!F),$=z.length>0?$y(e,t):t;rc(e.eventQueue_,$,z),hM(e,l,A,N)}),Vo(i,A=>{const N=mN(e,Os(t,A));$y(e,N)}),rc(e.eventQueue_,t,[])}}function vfe(e){db(e,"onDisconnectEvents");const t=BC(e),i=CS();rM(e.onDisconnect_,Dr(),(d,m)=>{const v=DH(d,m,e.serverSyncTree_,t);fH(i,d,v)});let l=[];rM(i,Dr(),(d,m)=>{l=l.concat(cb(e.serverSyncTree_,d,m));const v=mN(e,d);$y(e,v)}),e.onDisconnect_=CS(),rc(e.eventQueue_,Dr(),l)}function xfe(e,t,i){let l;sr(t._path)===".info"?l=uM(e.infoSyncTree_,t,i):l=uM(e.serverSyncTree_,t,i),VH(e.eventQueue_,t._path,l)}function C4(e,t,i){let l;sr(t._path)===".info"?l=NS(e.infoSyncTree_,t,i):l=NS(e.serverSyncTree_,t,i),VH(e.eventQueue_,t._path,l)}function bfe(e){e.persistentConnection_&&e.persistentConnection_.interrupt(dfe)}function db(e,...t){let i="";e.persistentConnection_&&(i=e.persistentConnection_.id+":"),zo(i,...t)}function hM(e,t,i,l){t&&ov(()=>{if(i==="ok")t(null);else{const d=(i||"error").toUpperCase();let m=d;l&&(m+=": "+l);const v=new Error(m);v.code=d,t(v)}})}function GH(e,t,i){return tN(e.serverSyncTree_,t,i)||Ei.EMPTY_NODE}function pN(e,t=e.transactionQueueTree_){if(t||VC(e,t),lv(t)){const i=WH(e,t);hn(i.length>0,"Sending zero length transaction queue"),i.every(d=>d.status===0)&&wfe(e,ub(t),i)}else OH(t)&&FC(t,i=>{pN(e,i)})}function wfe(e,t,i){const l=i.map(A=>A.currentWriteId),d=GH(e,t,l);let m=d;const v=d.hash();for(let A=0;A<i.length;A++){const N=i[A];hn(N.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),N.status=1,N.retryCount++;const F=ma(t,N.path);m=m.updateChild(F,N.currentOutputSnapshotRaw)}const o=m.val(!0),I=t;e.server_.put(I.toString(),o,A=>{db(e,"transaction put response",{path:I.toString(),status:A});let N=[];if(A==="ok"){const F=[];for(let z=0;z<i.length;z++)i[z].status=2,N=N.concat(uf(e.serverSyncTree_,i[z].currentWriteId)),i[z].onComplete&&F.push(()=>i[z].onComplete(null,!0,i[z].currentOutputSnapshotResolved)),i[z].unwatcher();VC(e,cN(e.transactionQueueTree_,t)),pN(e,e.transactionQueueTree_),rc(e.eventQueue_,t,N);for(let z=0;z<F.length;z++)ov(F[z])}else{if(A==="datastale")for(let F=0;F<i.length;F++)i[F].status===3?i[F].status=4:i[F].status=0;else{va("transaction at "+I.toString()+" failed: "+A);for(let F=0;F<i.length;F++)i[F].status=4,i[F].abortReason=A}$y(e,t)}},v)}function $y(e,t){const i=HH(e,t),l=ub(i),d=WH(e,i);return Tfe(e,d,l),l}function Tfe(e,t,i){if(t.length===0)return;const l=[];let d=[];const v=t.filter(o=>o.status===0).map(o=>o.currentWriteId);for(let o=0;o<t.length;o++){const I=t[o],A=ma(i,I.path);let N=!1,F;if(hn(A!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),I.status===4)N=!0,F=I.abortReason,d=d.concat(uf(e.serverSyncTree_,I.currentWriteId,!0));else if(I.status===0)if(I.retryCount>=hfe)N=!0,F="maxretry",d=d.concat(uf(e.serverSyncTree_,I.currentWriteId,!0));else{const z=GH(e,I.path,v);I.currentInputSnapshot=z;const $=t[o].update(z.val());if($!==void 0){zC("transaction failed: Data returned ",$,I.path);let J=co($);typeof $=="object"&&$!=null&&ed($,".priority")||(J=J.updatePriority(z.getPriority()));const re=I.currentWriteId,Q=BC(e),ee=NH(J,z,Q);I.currentOutputSnapshotRaw=J,I.currentOutputSnapshotResolved=ee,I.currentWriteId=fN(e),v.splice(v.indexOf(re),1),d=d.concat(AH(e.serverSyncTree_,I.path,ee,I.currentWriteId,I.applyLocally)),d=d.concat(uf(e.serverSyncTree_,re,!0))}else N=!0,F="nodata",d=d.concat(uf(e.serverSyncTree_,I.currentWriteId,!0))}rc(e.eventQueue_,i,d),d=[],N&&(t[o].status=2,function(z){setTimeout(z,Math.floor(0))}(t[o].unwatcher),t[o].onComplete&&(F==="nodata"?l.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):l.push(()=>t[o].onComplete(new Error(F),!1,null))))}VC(e,e.transactionQueueTree_);for(let o=0;o<l.length;o++)ov(l[o]);pN(e,e.transactionQueueTree_)}function HH(e,t){let i,l=e.transactionQueueTree_;for(i=sr(t);i!==null&&lv(l)===void 0;)l=cN(l,i),t=ss(t),i=sr(t);return l}function WH(e,t){const i=[];return qH(e,t,i),i.sort((l,d)=>l.order-d.order),i}function qH(e,t,i){const l=lv(t);if(l)for(let d=0;d<l.length;d++)i.push(l[d]);FC(t,d=>{qH(e,d,i)})}function VC(e,t){const i=lv(t);if(i){let l=0;for(let d=0;d<i.length;d++)i[d].status!==2&&(i[l]=i[d],l++);i.length=l,LH(t,i.length>0?i:void 0)}FC(t,l=>{VC(e,l)})}function mN(e,t){const i=ub(HH(e,t)),l=cN(e.transactionQueueTree_,t);return Jhe(l,d=>{lP(e,d)}),lP(e,l),FH(l,d=>{lP(e,d)}),i}function lP(e,t){const i=lv(t);if(i){const l=[];let d=[],m=-1;for(let v=0;v<i.length;v++)i[v].status===3||(i[v].status===1?(hn(m===v-1,"All SENT items should be at beginning of queue."),m=v,i[v].status=3,i[v].abortReason="set"):(hn(i[v].status===0,"Unexpected transaction status in abort"),i[v].unwatcher(),d=d.concat(uf(e.serverSyncTree_,i[v].currentWriteId,!0)),i[v].onComplete&&l.push(i[v].onComplete.bind(null,new Error("set"),!1,null))));m===-1?LH(t,void 0):i.length=m+1,rc(e.eventQueue_,ub(t),d);for(let v=0;v<l.length;v++)ov(l[v])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Efe(e){let t="";const i=e.split("/");for(let l=0;l<i.length;l++)if(i[l].length>0){let d=i[l];try{d=decodeURIComponent(d.replace(/\+/g," "))}catch{}t+="/"+d}return t}function Sfe(e){const t={};e.charAt(0)==="?"&&(e=e.substring(1));for(const i of e.split("&")){if(i.length===0)continue;const l=i.split("=");l.length===2?t[decodeURIComponent(l[0])]=decodeURIComponent(l[1]):va(`Invalid query segment '${i}' in query '${e}'`)}return t}const I4=function(e,t){const i=Cfe(e),l=i.namespace;i.domain==="firebase.com"&&Qd(i.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!l||l==="undefined")&&i.domain!=="localhost"&&Qd("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),i.secure||Oue();const d=i.scheme==="ws"||i.scheme==="wss";return{repoInfo:new XG(i.host,i.secure,l,d,t,"",l!==i.subdomain),path:new Zr(i.pathString)}},Cfe=function(e){let t="",i="",l="",d="",m="",v=!0,o="https",I=443;if(typeof e=="string"){let A=e.indexOf("//");A>=0&&(o=e.substring(0,A-1),e=e.substring(A+2));let N=e.indexOf("/");N===-1&&(N=e.length);let F=e.indexOf("?");F===-1&&(F=e.length),t=e.substring(0,Math.min(N,F)),N<F&&(d=Efe(e.substring(N,F)));const z=Sfe(e.substring(Math.min(e.length,F)));A=t.indexOf(":"),A>=0?(v=o==="https"||o==="wss",I=parseInt(t.substring(A+1),10)):A=t.length;const $=t.slice(0,A);if($.toLowerCase()==="localhost")i="localhost";else if($.split(".").length<=2)i=$;else{const J=t.indexOf(".");l=t.substring(0,J).toLowerCase(),i=t.substring(J+1),m=l}"ns"in z&&(m=z.ns)}return{host:t,port:I,domain:i,subdomain:l,secure:v,scheme:o,pathString:d,namespace:m}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A4="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Ife=function(){let e=0;const t=[];return function(i){const l=i===e;e=i;let d;const m=new Array(8);for(d=7;d>=0;d--)m[d]=A4.charAt(i%64),i=Math.floor(i/64);hn(i===0,"Cannot push at time == 0");let v=m.join("");if(l){for(d=11;d>=0&&t[d]===63;d--)t[d]=0;t[d]++}else for(d=0;d<12;d++)t[d]=Math.floor(Math.random()*64);for(d=0;d<12;d++)v+=A4.charAt(t[d]);return hn(v.length===20,"nextPushId: Length should be 20."),v}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Afe{constructor(t,i,l,d){this.eventType=t,this.eventRegistration=i,this.snapshot=l,this.prevName=d}getPath(){const t=this.snapshot.ref;return this.eventType==="value"?t._path:t.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+uo(this.snapshot.exportVal())}}class Pfe{constructor(t,i,l){this.eventRegistration=t,this.error=i,this.path=l}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZH{constructor(t,i){this.snapshotCallback=t,this.cancelCallback=i}onValue(t,i){this.snapshotCallback.call(null,t,i)}onCancel(t){return hn(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)}get hasCancelCallback(){return!!this.cancelCallback}matches(t){return this.snapshotCallback===t.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gN{constructor(t,i,l,d){this._repo=t,this._path=i,this._queryParams=l,this._orderByCalled=d}get key(){return cr(this._path)?null:UD(this._path)}get ref(){return new rh(this._repo,this._path)}get _queryIdentifier(){const t=h4(this._queryParams),i=zD(t);return i==="{}"?"default":i}get _queryObject(){return h4(this._queryParams)}isEqual(t){if(t=ta(t),!(t instanceof gN))return!1;const i=this._repo===t._repo,l=$D(this._path,t._path),d=this._queryIdentifier===t._queryIdentifier;return i&&l&&d}toJSON(){return this.toString()}toString(){return this._repo.toString()+vde(this._path)}}class rh extends gN{constructor(t,i){super(t,i,new qD,!1)}get parent(){const t=sH(this._path);return t===null?null:new rh(this._repo,t)}get root(){let t=this;for(;t.parent!==null;)t=t.parent;return t}}class O1{constructor(t,i,l){this._node=t,this.ref=i,this._index=l}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){const i=new Zr(t),l=F1(this.ref,t);return new O1(this._node.getChild(i),l,Fs)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(l,d)=>t(new O1(d,F1(this.ref,l),Fs)))}hasChild(t){const i=new Zr(t);return!this._node.getChild(i).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function xi(e,t){return e=ta(e),e._checkNotDeleted("ref"),t!==void 0?F1(e._root,t):e._root}function F1(e,t){return e=ta(e),sr(e._path)===null?afe("child","path",t):BH("child","path",t),new rh(e._repo,Os(e._path,t))}function hb(e,t){e=ta(e),dN("push",e._path),jH("push",t,e._path,!0);const i=$H(e._repo),l=Ife(i),d=F1(e,l),m=F1(e,l);let v;return v=Promise.resolve(m),d.then=v.then.bind(v),d.catch=v.then.bind(v,void 0),d}function Gm(e){return dN("remove",e._path),Yc(e,null)}function Yc(e,t){e=ta(e),dN("set",e._path),jH("set",t,e._path,!1);const i=new eb;return _fe(e._repo,e._path,t,null,i.wrapCallback(()=>{})),i.promise}function Qc(e,t){ofe("update",t,e._path);const i=new eb;return yfe(e._repo,e._path,t,i.wrapCallback(()=>{})),i.promise}function If(e){e=ta(e);const t=new ZH(()=>{}),i=new UC(t);return gfe(e._repo,e,i).then(l=>new O1(l,new rh(e._repo,e._path),e._queryParams.getIndex()))}class UC{constructor(t){this.callbackContext=t}respondsTo(t){return t==="value"}createEvent(t,i){const l=i._queryParams.getIndex();return new Afe("value",this,new O1(t.snapshotNode,new rh(i._repo,i._path),l))}getEventRunner(t){return t.getEventType()==="cancel"?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,null)}createCancelEvent(t,i){return this.callbackContext.hasCancelCallback?new Pfe(this,t,i):null}matches(t){return t instanceof UC?!t.callbackContext||!this.callbackContext?!0:t.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function Rfe(e,t,i,l,d){let m;if(typeof l=="object"&&(m=void 0,d=l),typeof l=="function"&&(m=l),d&&d.onlyOnce){const I=i,A=(N,F)=>{C4(e._repo,e,o),I(N,F)};A.userCallback=i.userCallback,A.context=i.context,i=A}const v=new ZH(i,m||void 0),o=new UC(v);return xfe(e._repo,e,o),()=>C4(e._repo,e,o)}function Uo(e,t,i,l){return Rfe(e,"value",t,i,l)}Mhe(rh);Ohe(rh);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mfe="FIREBASE_DATABASE_EMULATOR_HOST",fM={};let kfe=!1;function Dfe(e,t,i,l){const d=t.lastIndexOf(":"),m=t.substring(0,d),v=jm(m);e.repoInfo_=new XG(t,v,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,i),l&&(e.authTokenProvider_=l)}function Nfe(e,t,i,l,d){let m=l||e.options.databaseURL;m===void 0&&(e.options.projectId||Qd("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),zo("Using default host for project ",e.options.projectId),m=`${e.options.projectId}-default-rtdb.firebaseio.com`);let v=I4(m,d),o=v.repoInfo,I;typeof process<"u"&&ZB&&(I=ZB[Mfe]),I?(m=`http://${I}?ns=${o.namespace}`,v=I4(m,d),o=v.repoInfo):v.repoInfo.secure;const A=new que(e.name,e.options,t);lfe("Invalid Firebase Database URL",v),cr(v.path)||Qd("Database URL must point to the root of a Firebase Database (not including a child path).");const N=Ofe(o,e,A,new Wue(e,i));return new Ffe(N,e)}function Lfe(e,t){const i=fM[t];(!i||i[e.key]!==e)&&Qd(`Database ${t}(${e.repoInfo_}) has already been deleted.`),bfe(e),delete i[e.key]}function Ofe(e,t,i,l){let d=fM[t.name];d||(d={},fM[t.name]=d);let m=d[e.toURLString()];return m&&Qd("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),m=new ffe(e,kfe,i,l),d[e.toURLString()]=m,m}class Ffe{constructor(t,i){this._repoInternal=t,this.app=i,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(pfe(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new rh(this._repo,Dr())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Lfe(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){this._rootInternal===null&&Qd("Cannot call "+t+" on a deleted database.")}}function zfe(e=ID(),t){const i=AC(e,"database").getImmediate({identifier:t});if(!i._instanceStarted){const l=$$("database");l&&jfe(i,...l)}return i}function jfe(e,t,i,l={}){e=ta(e),e._checkNotDeleted("useEmulator");const d=`${t}:${i}`,m=e._repoInternal;if(e._instanceStarted){if(d===e._repoInternal.repoInfo_.host&&Em(l,m.repoInfo_.emulatorOptions))return;Qd("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let v;if(m.repoInfo_.nodeAdmin)l.mockUserToken&&Qd('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),v=new TE(TE.OWNER);else if(l.mockUserToken){const o=typeof l.mockUserToken=="string"?l.mockUserToken:W$(l.mockUserToken,e.app.options.projectId);v=new TE(o)}jm(t)&&(wD(t),TD("Database",!0)),Dfe(m,d,l,v)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bfe(e){Rue(Bm),Sm(new Lf("database",(t,{instanceIdentifier:i})=>{const l=t.getProvider("app").getImmediate(),d=t.getProvider("auth-internal"),m=t.getProvider("app-check-internal");return Nfe(l,d,m,i)},"PUBLIC").setMultipleInstances(!0)),Gu(KB,XB,e),Gu(KB,XB,"esm2020")}$d.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)};$d.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};Bfe();var Vfe="firebase",Ufe="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Gu(Vfe,Ufe,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KH="firebasestorage.googleapis.com",$fe="storageBucket",Gfe=2*60*1e3,Hfe=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class td extends ih{constructor(t,i,l=0){super(cP(t),`Firebase Storage: ${i} (${cP(t)})`),this.status_=l,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,td.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return cP(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Xu;(function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Xu||(Xu={}));function cP(e){return"storage/"+e}function Wfe(){const e="An unknown error occurred, please check the error payload for server response.";return new td(Xu.UNKNOWN,e)}function qfe(){return new td(Xu.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Zfe(){return new td(Xu.CANCELED,"User canceled the upload/download.")}function Kfe(e){return new td(Xu.INVALID_URL,"Invalid URL '"+e+"'.")}function Xfe(e){return new td(Xu.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}function P4(e){return new td(Xu.INVALID_ARGUMENT,e)}function XH(){return new td(Xu.APP_DELETED,"The Firebase app was deleted.")}function Yfe(e){return new td(Xu.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hc{constructor(t,i){this.bucket=t,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,i){let l;try{l=Hc.makeFromUrl(t,i)}catch{return new Hc(t,"")}if(l.path==="")return l;throw Xfe(t)}static makeFromUrl(t,i){let l=null;const d="([A-Za-z0-9.\\-_]+)";function m(ue){ue.path.charAt(ue.path.length-1)==="/"&&(ue.path_=ue.path_.slice(0,-1))}const v="(/(.*))?$",o=new RegExp("^gs://"+d+v,"i"),I={bucket:1,path:3};function A(ue){ue.path_=decodeURIComponent(ue.path)}const N="v[A-Za-z0-9_]+",F=i.replace(/[.]/g,"\\."),z="(/([^?#]*).*)?$",$=new RegExp(`^https?://${F}/${N}/b/${d}/o${z}`,"i"),J={bucket:1,path:3},H=i===KH?"(?:storage.googleapis.com|storage.cloud.google.com)":i,re="([^?#]*)",Q=new RegExp(`^https?://${H}/${d}/${re}`,"i"),ie=[{regex:o,indices:I,postModify:m},{regex:$,indices:J,postModify:A},{regex:Q,indices:{bucket:1,path:2},postModify:A}];for(let ue=0;ue<ie.length;ue++){const xe=ie[ue],Oe=xe.regex.exec(t);if(Oe){const ze=Oe[xe.indices.bucket];let Be=Oe[xe.indices.path];Be||(Be=""),l=new Hc(ze,Be),xe.postModify(l);break}}if(l==null)throw Kfe(t);return l}}class Qfe{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jfe(e,t,i){let l=1,d=null,m=null,v=!1,o=0;function I(){return o===2}let A=!1;function N(...re){A||(A=!0,t.apply(null,re))}function F(re){d=setTimeout(()=>{d=null,e($,I())},re)}function z(){m&&clearTimeout(m)}function $(re,...Q){if(A){z();return}if(re){z(),N.call(null,re,...Q);return}if(I()||v){z(),N.call(null,re,...Q);return}l<64&&(l*=2);let ie;o===1?(o=2,ie=0):ie=(l+Math.random())*1e3,F(ie)}let J=!1;function H(re){J||(J=!0,z(),!A&&(d!==null?(re||(o=2),clearTimeout(d),F(0)):re||(o=1)))}return F(0),m=setTimeout(()=>{v=!0,H(!0)},i),H}function epe(e){e(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tpe(e){return e!==void 0}function R4(e,t,i,l){if(l<t)throw P4(`Invalid value for '${e}'. Expected ${t} or greater.`);if(l>i)throw P4(`Invalid value for '${e}'. Expected ${i} or less.`)}function npe(e){const t=encodeURIComponent;let i="?";for(const l in e)if(e.hasOwnProperty(l)){const d=t(l)+"="+t(e[l]);i=i+d+"&"}return i=i.slice(0,-1),i}var LS;(function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"})(LS||(LS={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ipe(e,t){const i=e>=500&&e<600,d=[408,429].indexOf(e)!==-1,m=t.indexOf(e)!==-1;return i||d||m}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rpe{constructor(t,i,l,d,m,v,o,I,A,N,F,z=!0,$=!1){this.url_=t,this.method_=i,this.headers_=l,this.body_=d,this.successCodes_=m,this.additionalRetryCodes_=v,this.callback_=o,this.errorCallback_=I,this.timeout_=A,this.progressCallback_=N,this.connectionFactory_=F,this.retry=z,this.isUsingEmulator=$,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((J,H)=>{this.resolve_=J,this.reject_=H,this.start_()})}start_(){const t=(l,d)=>{if(d){l(!1,new HT(!1,null,!0));return}const m=this.connectionFactory_();this.pendingConnection_=m;const v=o=>{const I=o.loaded,A=o.lengthComputable?o.total:-1;this.progressCallback_!==null&&this.progressCallback_(I,A)};this.progressCallback_!==null&&m.addUploadProgressListener(v),m.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&m.removeUploadProgressListener(v),this.pendingConnection_=null;const o=m.getErrorCode()===LS.NO_ERROR,I=m.getStatus();if(!o||ipe(I,this.additionalRetryCodes_)&&this.retry){const N=m.getErrorCode()===LS.ABORT;l(!1,new HT(!1,null,N));return}const A=this.successCodes_.indexOf(I)!==-1;l(!0,new HT(A,m))})},i=(l,d)=>{const m=this.resolve_,v=this.reject_,o=d.connection;if(d.wasSuccessCode)try{const I=this.callback_(o,o.getResponse());tpe(I)?m(I):m()}catch(I){v(I)}else if(o!==null){const I=Wfe();I.serverResponse=o.getErrorText(),this.errorCallback_?v(this.errorCallback_(o,I)):v(I)}else if(d.canceled){const I=this.appDelete_?XH():Zfe();v(I)}else{const I=qfe();v(I)}};this.canceled_?i(!1,new HT(!1,null,!0)):this.backoffId_=Jfe(t,i,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&epe(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class HT{constructor(t,i,l){this.wasSuccessCode=t,this.connection=i,this.canceled=!!l}}function spe(e,t){t!==null&&t.length>0&&(e.Authorization="Firebase "+t)}function ope(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function ape(e,t){t&&(e["X-Firebase-GMPID"]=t)}function lpe(e,t){t!==null&&(e["X-Firebase-AppCheck"]=t)}function cpe(e,t,i,l,d,m,v=!0,o=!1){const I=npe(e.urlParams),A=e.url+I,N=Object.assign({},e.headers);return ape(N,t),spe(N,i),ope(N,m),lpe(N,l),new rpe(A,e.method,N,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,d,v,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function upe(e){if(e.length===0)return null;const t=e.lastIndexOf("/");return t===-1?"":e.slice(0,t)}function dpe(e){const t=e.lastIndexOf("/",e.length-2);return t===-1?e:e.slice(t+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OS{constructor(t,i){this._service=t,i instanceof Hc?this._location=i:this._location=Hc.makeFromUrl(i,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,i){return new OS(t,i)}get root(){const t=new Hc(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return dpe(this._location.path)}get storage(){return this._service}get parent(){const t=upe(this._location.path);if(t===null)return null;const i=new Hc(this._location.bucket,t);return new OS(this._service,i)}_throwIfRoot(t){if(this._location.path==="")throw Yfe(t)}}function M4(e,t){const i=t==null?void 0:t[$fe];return i==null?null:Hc.makeFromBucketSpec(i,e)}function hpe(e,t,i,l={}){e.host=`${t}:${i}`;const d=jm(t);d&&(wD(`https://${e.host}/b`),TD("Storage",!0)),e._isUsingEmulator=!0,e._protocol=d?"https":"http";const{mockUserToken:m}=l;m&&(e._overrideAuthToken=typeof m=="string"?m:W$(m,e.app.options.projectId))}class fpe{constructor(t,i,l,d,m,v=!1){this.app=t,this._authProvider=i,this._appCheckProvider=l,this._url=d,this._firebaseVersion=m,this._isUsingEmulator=v,this._bucket=null,this._host=KH,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Gfe,this._maxUploadRetryTime=Hfe,this._requests=new Set,d!=null?this._bucket=Hc.makeFromBucketSpec(d,this._host):this._bucket=M4(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=Hc.makeFromBucketSpec(this._url,t):this._bucket=M4(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){R4("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){R4("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const i=await t.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){if(_l(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new OS(this,t)}_makeRequest(t,i,l,d,m=!0){if(this._deleted)return new Qfe(XH());{const v=cpe(t,this._appId,l,d,i,this._firebaseVersion,m,this._isUsingEmulator);return this._requests.add(v),v.getPromise().then(()=>this._requests.delete(v),()=>this._requests.delete(v)),v}}async makeRequestWithTokens(t,i){const[l,d]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,i,l,d).getPromise()}}const k4="@firebase/storage",D4="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YH="storage";function ppe(e=ID(),t){e=ta(e);const l=AC(e,YH).getImmediate({identifier:t}),d=$$("storage");return d&&mpe(l,...d),l}function mpe(e,t,i,l={}){hpe(e,t,i,l)}function gpe(e,{instanceIdentifier:t}){const i=e.getProvider("app").getImmediate(),l=e.getProvider("auth-internal"),d=e.getProvider("app-check-internal");return new fpe(i,l,d,t,Bm)}function _pe(){Sm(new Lf(YH,gpe,"PUBLIC").setMultipleInstances(!0)),Gu(k4,D4,""),Gu(k4,D4,"esm2020")}_pe();const ype={apiKey:"AIzaSyC_2a50875vxMTHa8jZhcfMP--nO_Jvmko",authDomain:"nulltobuild.firebaseapp.com",databaseURL:"https://nulltobuild-default-rtdb.firebaseio.com",projectId:"nulltobuild",storageBucket:"nulltobuild.firebasestorage.app",messagingSenderId:"937347030160",appId:"1:937347030160:web:d60bb96785fbc5a7e9cc15"},_N=Q$(ype),Bu=Aue(_N),bi=zfe(_N);ppe(_N);const QH=q.createContext(void 0);async function vpe(e,t){try{const l=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${t},${e}.json?access_token=pk.eyJ1IjoibG92YWJsZSIsImEiOiJjbHNxOWt2ZnowMmt5MmtwOGR0ZGYwdnB0In0.5gBHmRqz0YCdBbKXm7Q0gQ&types=place`)).json();return l.features&&l.features.length>0&&l.features[0].text||"Unknown"}catch(i){return console.error("Error getting city name:",i),"Unknown"}}function xpe({children:e}){const[t,i]=q.useState(null),[l,d]=q.useState(null),[m,v]=q.useState(!0),o=async()=>{if(t)try{const z=xi(bi,`users/${t.uid}`),$=await If(z);$.exists()&&d($.val())}catch(z){console.error("Error refreshing user data:",z)}};q.useEffect(()=>{const z=Bu.onAuthStateChanged($=>{i($),$?setTimeout(async()=>{try{const J=xi(bi,`users/${$.uid}`),H=await If(J);H.exists()&&d(H.val())}catch(J){console.error("Error fetching user data:",J)}v(!1)},0):(d(null),v(!1))});return()=>z()},[]);const I=async(z,$)=>{const J=await SG(Bu,z,$),H=xi(bi,`users/${J.user.uid}`),re=await If(H);re.exists()&&d(re.val())},A=async(z,$,J,H,re)=>{const Q=await ND(Bu,z,$),ee={id:Q.user.uid,email:z,name:J,phone:H,role:re,createdAt:Date.now()};await Yc(xi(bi,`users/${Q.user.uid}`),ee),d(ee)},N=async(z,$,J)=>{var Q,ee;if(!l)return;const H=J||await vpe(z,$),re={...l.address,line1:((Q=l.address)==null?void 0:Q.line1)||"",city:H,pincode:((ee=l.address)==null?void 0:ee.pincode)||"",lat:z,lng:$};await Qc(xi(bi,`users/${l.id}`),{address:re}),d(ie=>ie?{...ie,address:re}:null)},F=async()=>{await _ce(Bu),d(null)};return E.jsx(QH.Provider,{value:{firebaseUser:t,user:l,loading:m,signIn:I,signUp:A,signOut:F,updateUserLocation:N,refreshUser:o},children:e})}function Sa(){const e=q.useContext(QH);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e}const JH=q.createContext(void 0),N4="amma-cheythi-cart";function bpe({children:e}){const[t,i]=q.useState(()=>{const A=localStorage.getItem(N4);return A?JSON.parse(A):{items:[],kitchenId:null,kitchenName:null}});q.useEffect(()=>{localStorage.setItem(N4,JSON.stringify(t))},[t]);const l=(A,N,F)=>{i(z=>z.kitchenId&&z.kitchenId!==N?(Mn.error("You can only order from one kitchen at a time. Clear cart first."),z):z.items.find(J=>J.dish.id===A.id)?{...z,items:z.items.map(J=>J.dish.id===A.id?{...J,quantity:J.quantity+1}:J)}:(Mn.success(`Added ${A.name} to cart!`),{items:[...z.items,{dish:A,quantity:1,kitchenId:N,kitchenName:F}],kitchenId:N,kitchenName:F}))},d=A=>{i(N=>{const F=N.items.filter(z=>z.dish.id!==A);return{items:F,kitchenId:F.length>0?N.kitchenId:null,kitchenName:F.length>0?N.kitchenName:null}})},m=(A,N)=>{if(N<=0){d(A);return}i(F=>({...F,items:F.items.map(z=>z.dish.id===A?{...z,quantity:N}:z)}))},v=()=>{i({items:[],kitchenId:null,kitchenName:null})},o=()=>t.items.reduce((A,N)=>A+N.quantity,0),I=()=>t.items.reduce((A,N)=>A+N.dish.price*N.quantity,0);return E.jsx(JH.Provider,{value:{cart:t,addToCart:l,removeFromCart:d,updateQuantity:m,clearCart:v,getItemCount:o,getTotal:I},children:e})}function fb(){const e=q.useContext(JH);if(e===void 0)throw new Error("useCart must be used within a CartProvider");return e}function $C(e,t){if(!t||!t.coordinates||t.coordinates.length===0)return!1;const i=t.coordinates[0],l=e.lng,d=e.lat;let m=!1;for(let v=0,o=i.length-1;v<i.length;o=v++){const I=i[v][0],A=i[v][1],N=i[o][0],F=i[o][1];A>d!=F>d&&l<(N-I)*(d-A)/(F-A)+I&&(m=!m)}return m}function WT(e,t,i){return $C({lat:e,lng:t},i)}function wpe(e,t){for(const i of t){if(!i.zone||!i.zone.coordinates||!i.zone.coordinates[0]){console.log(`Skipping franchise ${i.id} - invalid zone data`);continue}const l=$C(e,i.zone);if(console.log(`Zone check for ${i.id}:`,{point:e,zoneCoords:i.zone.coordinates[0].slice(0,3),result:l}),l)return{isInZone:!0,franchiseId:i.id}}return{isInZone:!1,franchiseId:null}}function Tpe(e){if(!e||!e.coordinates||e.coordinates.length===0)return null;const t=e.coordinates[0];let i=0,l=0;for(const d of t)l+=d[0],i+=d[1];return{lat:i/t.length,lng:l/t.length}}function Epe(e){return!e||!e.geometry||e.geometry.type!=="Polygon"?null:{type:"Polygon",coordinates:e.geometry.coordinates}}const jf="pk.eyJ1IjoicGF2YW5rdW1hcnN3YW15IiwiYSI6ImNtNnc1c3ZpdTBkdGgyanM5b25rN2ZqcncifQ.Ls1e2W6rx3apoBsStWa5Ow";function Spe(){const[e,t]=q.useState(null),[i,l]=q.useState(!0),[d,m]=q.useState(null),v=async(I,A)=>{try{const F=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${A},${I}.json?access_token=${jf}`)).json();if(F.features&&F.features.length>0){const z=F.features[0].context||[],$=z.find(H=>H.id.startsWith("locality")||H.id.startsWith("neighborhood")),J=z.find(H=>H.id.startsWith("place"));return $?$.text:J?J.text:F.features[0].text||"Unknown"}return"Unknown location"}catch(N){return console.error("Geocoding error:",N),"Unknown location"}},o=()=>{if(l(!0),m(null),!("geolocation"in navigator)){m("Geolocation not supported"),l(!1);return}navigator.geolocation.getCurrentPosition(async I=>{const{latitude:A,longitude:N}=I.coords,F=await v(A,N);t({lat:A,lng:N,address:F}),l(!1)},I=>{console.error("Location error:",I),m("Location access denied"),l(!1)},{enableHighAccuracy:!0,timeout:1e4})};return q.useEffect(()=>{o()},[]),{location:e,loading:i,error:d,refetch:o}}const eW=q.createContext(void 0);function Cpe({children:e}){const{location:t,loading:i,error:l,refetch:d}=Spe(),[m,v]=q.useState([]),[o,I]=q.useState(!0),[A,N]=q.useState(!0),[F,z]=q.useState(null),[$,J]=q.useState(!1);q.useEffect(()=>{const Q=xi(bi,"franchises"),ee=Uo(Q,ie=>{const ue=ie.val();if(ue){const xe=Object.entries(ue).map(([Oe,ze])=>({...ze,id:Oe})).filter(Oe=>Oe.isActive);v(xe)}else v([]);I(!1)});return()=>ee()},[]),q.useEffect(()=>{if(i||o)return;if(!t){console.log("No location available, allowing access by default"),N(!0),z(null),J(!0);return}if(m.length===0){console.log("No franchises exist, allowing access"),N(!0),z(null),J(!0);return}const Q=m.filter(ue=>ue.zone&&ue.zone.coordinates&&ue.zone.coordinates[0]&&ue.zone.coordinates[0].length>0);if(console.log("Location check:",{userLat:t.lat,userLng:t.lng,totalFranchises:m.length,validFranchises:Q.length,franchiseZones:m.map(ue=>{var xe,Oe,ze,Be;return{id:ue.id,name:ue.name,hasZone:!!ue.zone,zoneType:(xe=ue.zone)==null?void 0:xe.type,coordsLength:(Be=(ze=(Oe=ue.zone)==null?void 0:Oe.coordinates)==null?void 0:ze[0])==null?void 0:Be.length}})}),Q.length===0){console.log("No valid franchise zones, allowing access"),N(!0),z(null),J(!0);return}const ee=Q.map(ue=>({id:ue.id,zone:ue.zone})),ie=wpe({lat:t.lat,lng:t.lng},ee);console.log("Zone check result:",ie),N(ie.isInZone),z(ie.franchiseId),J(!0)},[t,m,i,o]);const H=m.find(Q=>Q.id===F)||null,re=i||o||!$;return E.jsx(eW.Provider,{value:{userLocation:t,locationLoading:i,locationError:l,isInServiceArea:A,currentFranchiseId:F,currentFranchise:H,franchises:m,checkingZone:re,refetchLocation:d},children:e})}function GC(){const e=q.useContext(eW);if(e===void 0)throw new Error("useLocationContext must be used within a LocationProvider");return e}async function Ipe(){const e="admin@admin.com",t="admin@1234";try{try{const i=await SG(Bu,e,t),l=xi(bi,`users/${i.user.uid}`),d=await If(l);if(d.exists()){const m=d.val();m.role!=="super_admin"&&await Yc(l,{...m,role:"super_admin"})}else{const m={id:i.user.uid,email:e,name:"Super Admin",phone:"0000000000",role:"super_admin",createdAt:Date.now()};await Yc(l,m)}return await Bu.signOut(),console.log("Super Admin verified"),!0}catch(i){if(i.code==="auth/user-not-found"||i.code==="auth/invalid-credential"){const l=await ND(Bu,e,t),d={id:l.user.uid,email:e,name:"Super Admin",phone:"0000000000",role:"super_admin",createdAt:Date.now()};return await Yc(xi(bi,`users/${l.user.uid}`),d),await Bu.signOut(),console.log("Super Admin created successfully"),!0}throw i}}catch(i){return console.error("Error ensuring super admin:",i),!1}}async function Ape(){try{const e={},t=xi(bi,"users"),i=await If(t);if(i.exists()){const l=i.val();Object.keys(l).forEach(d=>{l[d].role!=="super_admin"&&(e[`users/${d}`]=null)})}return e.franchises=null,e.kitchens=null,e.dishes=null,e.orders=null,e.coupons=null,e.reviews=null,await Qc(xi(bi),e),console.log("Database cleared successfully! (Super Admin preserved)"),!0}catch(e){return console.error("Error clearing database:",e),!1}}const yN=q.createContext({});function vN(e){const t=q.useRef(null);return t.current===null&&(t.current=e()),t.current}const xN=typeof window<"u",tW=xN?q.useLayoutEffect:q.useEffect,HC=q.createContext(null);function bN(e,t){e.indexOf(t)===-1&&e.push(t)}function wN(e,t){const i=e.indexOf(t);i>-1&&e.splice(i,1)}const Jd=(e,t,i)=>i>t?t:i<e?e:i;let WC=()=>{},Gy=()=>{};const eh={},nW=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function iW(e){return typeof e=="object"&&e!==null}const rW=e=>/^0[^.\s]+$/u.test(e);function TN(e){let t;return()=>(t===void 0&&(t=e()),t)}const ec=e=>e,Ppe=(e,t)=>i=>t(e(i)),pb=(...e)=>e.reduce(Ppe),z1=(e,t,i)=>{const l=t-e;return l===0?1:(i-e)/l};class EN{constructor(){this.subscriptions=[]}add(t){return bN(this.subscriptions,t),()=>wN(this.subscriptions,t)}notify(t,i,l){const d=this.subscriptions.length;if(d)if(d===1)this.subscriptions[0](t,i,l);else for(let m=0;m<d;m++){const v=this.subscriptions[m];v&&v(t,i,l)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Jc=e=>e*1e3,Ql=e=>e/1e3;function sW(e,t){return t?e*(1e3/t):0}const oW=(e,t,i)=>(((1-3*i+3*t)*e+(3*i-6*t))*e+3*t)*e,Rpe=1e-7,Mpe=12;function kpe(e,t,i,l,d){let m,v,o=0;do v=t+(i-t)/2,m=oW(v,l,d)-e,m>0?i=v:t=v;while(Math.abs(m)>Rpe&&++o<Mpe);return v}function mb(e,t,i,l){if(e===t&&i===l)return ec;const d=m=>kpe(m,0,1,e,i);return m=>m===0||m===1?m:oW(d(m),t,l)}const aW=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,lW=e=>t=>1-e(1-t),cW=mb(.33,1.53,.69,.99),SN=lW(cW),uW=aW(SN),dW=e=>(e*=2)<1?.5*SN(e):.5*(2-Math.pow(2,-10*(e-1))),CN=e=>1-Math.sin(Math.acos(e)),hW=lW(CN),fW=aW(CN),Dpe=mb(.42,0,1,1),Npe=mb(0,0,.58,1),pW=mb(.42,0,.58,1),Lpe=e=>Array.isArray(e)&&typeof e[0]!="number",mW=e=>Array.isArray(e)&&typeof e[0]=="number",L4={linear:ec,easeIn:Dpe,easeInOut:pW,easeOut:Npe,circIn:CN,circInOut:fW,circOut:hW,backIn:SN,backInOut:uW,backOut:cW,anticipate:dW},Ope=e=>typeof e=="string",O4=e=>{if(mW(e)){Gy(e.length===4,"Cubic bezier arrays must contain four numerical values.","cubic-bezier-length");const[t,i,l,d]=e;return mb(t,i,l,d)}else if(Ope(e))return Gy(L4[e]!==void 0,`Invalid easing type '${e}'`,"invalid-easing-type"),L4[e];return e},qT=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],F4={value:null,addProjectionMetrics:null};function Fpe(e,t){let i=new Set,l=new Set,d=!1,m=!1;const v=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1},I=0;function A(F){v.has(F)&&(N.schedule(F),e()),I++,F(o)}const N={schedule:(F,z=!1,$=!1)=>{const H=$&&d?i:l;return z&&v.add(F),H.has(F)||H.add(F),F},cancel:F=>{l.delete(F),v.delete(F)},process:F=>{if(o=F,d){m=!0;return}d=!0,[i,l]=[l,i],i.forEach(A),t&&F4.value&&F4.value.frameloop[t].push(I),I=0,i.clear(),d=!1,m&&(m=!1,N.process(F))}};return N}const zpe=40;function gW(e,t){let i=!1,l=!0;const d={delta:0,timestamp:0,isProcessing:!1},m=()=>i=!0,v=qT.reduce((ie,ue)=>(ie[ue]=Fpe(m,t?ue:void 0),ie),{}),{setup:o,read:I,resolveKeyframes:A,preUpdate:N,update:F,preRender:z,render:$,postRender:J}=v,H=()=>{const ie=eh.useManualTiming?d.timestamp:performance.now();i=!1,eh.useManualTiming||(d.delta=l?1e3/60:Math.max(Math.min(ie-d.timestamp,zpe),1)),d.timestamp=ie,d.isProcessing=!0,o.process(d),I.process(d),A.process(d),N.process(d),F.process(d),z.process(d),$.process(d),J.process(d),d.isProcessing=!1,i&&t&&(l=!1,e(H))},re=()=>{i=!0,l=!0,d.isProcessing||e(H)};return{schedule:qT.reduce((ie,ue)=>{const xe=v[ue];return ie[ue]=(Oe,ze=!1,Be=!1)=>(i||re(),xe.schedule(Oe,ze,Be)),ie},{}),cancel:ie=>{for(let ue=0;ue<qT.length;ue++)v[qT[ue]].cancel(ie)},state:d,steps:v}}const{schedule:bs,cancel:Bf,state:Fo,steps:uP}=gW(typeof requestAnimationFrame<"u"?requestAnimationFrame:ec,!0);let EE;function jpe(){EE=void 0}const Za={now:()=>(EE===void 0&&Za.set(Fo.isProcessing||eh.useManualTiming?Fo.timestamp:performance.now()),EE),set:e=>{EE=e,queueMicrotask(jpe)}},_W=e=>t=>typeof t=="string"&&t.startsWith(e),yW=_W("--"),Bpe=_W("var(--"),IN=e=>Bpe(e)?Vpe.test(e.split("/*")[0].trim()):!1,Vpe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,cv={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},j1={...cv,transform:e=>Jd(0,1,e)},ZT={...cv,default:1},K0=e=>Math.round(e*1e5)/1e5,AN=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Upe(e){return e==null}const $pe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,PN=(e,t)=>i=>!!(typeof i=="string"&&$pe.test(i)&&i.startsWith(e)||t&&!Upe(i)&&Object.prototype.hasOwnProperty.call(i,t)),vW=(e,t,i)=>l=>{if(typeof l!="string")return l;const[d,m,v,o]=l.match(AN);return{[e]:parseFloat(d),[t]:parseFloat(m),[i]:parseFloat(v),alpha:o!==void 0?parseFloat(o):1}},Gpe=e=>Jd(0,255,e),dP={...cv,transform:e=>Math.round(Gpe(e))},sm={test:PN("rgb","red"),parse:vW("red","green","blue"),transform:({red:e,green:t,blue:i,alpha:l=1})=>"rgba("+dP.transform(e)+", "+dP.transform(t)+", "+dP.transform(i)+", "+K0(j1.transform(l))+")"};function Hpe(e){let t="",i="",l="",d="";return e.length>5?(t=e.substring(1,3),i=e.substring(3,5),l=e.substring(5,7),d=e.substring(7,9)):(t=e.substring(1,2),i=e.substring(2,3),l=e.substring(3,4),d=e.substring(4,5),t+=t,i+=i,l+=l,d+=d),{red:parseInt(t,16),green:parseInt(i,16),blue:parseInt(l,16),alpha:d?parseInt(d,16)/255:1}}const pM={test:PN("#"),parse:Hpe,transform:sm.transform},gb=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Hh=gb("deg"),qu=gb("%"),Vn=gb("px"),Wpe=gb("vh"),qpe=gb("vw"),z4={...qu,parse:e=>qu.parse(e)/100,transform:e=>qu.transform(e*100)},X_={test:PN("hsl","hue"),parse:vW("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:i,alpha:l=1})=>"hsla("+Math.round(e)+", "+qu.transform(K0(t))+", "+qu.transform(K0(i))+", "+K0(j1.transform(l))+")"},to={test:e=>sm.test(e)||pM.test(e)||X_.test(e),parse:e=>sm.test(e)?sm.parse(e):X_.test(e)?X_.parse(e):pM.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?sm.transform(e):X_.transform(e),getAnimatableNone:e=>{const t=to.parse(e);return t.alpha=0,to.transform(t)}},Zpe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Kpe(e){var t,i;return isNaN(e)&&typeof e=="string"&&(((t=e.match(AN))==null?void 0:t.length)||0)+(((i=e.match(Zpe))==null?void 0:i.length)||0)>0}const xW="number",bW="color",Xpe="var",Ype="var(",j4="${}",Qpe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function B1(e){const t=e.toString(),i=[],l={color:[],number:[],var:[]},d=[];let m=0;const o=t.replace(Qpe,I=>(to.test(I)?(l.color.push(m),d.push(bW),i.push(to.parse(I))):I.startsWith(Ype)?(l.var.push(m),d.push(Xpe),i.push(I)):(l.number.push(m),d.push(xW),i.push(parseFloat(I))),++m,j4)).split(j4);return{values:i,split:o,indexes:l,types:d}}function wW(e){return B1(e).values}function TW(e){const{split:t,types:i}=B1(e),l=t.length;return d=>{let m="";for(let v=0;v<l;v++)if(m+=t[v],d[v]!==void 0){const o=i[v];o===xW?m+=K0(d[v]):o===bW?m+=to.transform(d[v]):m+=d[v]}return m}}const Jpe=e=>typeof e=="number"?0:to.test(e)?to.getAnimatableNone(e):e;function eme(e){const t=wW(e);return TW(e)(t.map(Jpe))}const Vf={test:Kpe,parse:wW,createTransformer:TW,getAnimatableNone:eme};function hP(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function tme({hue:e,saturation:t,lightness:i,alpha:l}){e/=360,t/=100,i/=100;let d=0,m=0,v=0;if(!t)d=m=v=i;else{const o=i<.5?i*(1+t):i+t-i*t,I=2*i-o;d=hP(I,o,e+1/3),m=hP(I,o,e),v=hP(I,o,e-1/3)}return{red:Math.round(d*255),green:Math.round(m*255),blue:Math.round(v*255),alpha:l}}function FS(e,t){return i=>i>0?t:e}const Ps=(e,t,i)=>e+(t-e)*i,fP=(e,t,i)=>{const l=e*e,d=i*(t*t-l)+l;return d<0?0:Math.sqrt(d)},nme=[pM,sm,X_],ime=e=>nme.find(t=>t.test(e));function B4(e){const t=ime(e);if(WC(!!t,`'${e}' is not an animatable color. Use the equivalent color code instead.`,"color-not-animatable"),!t)return!1;let i=t.parse(e);return t===X_&&(i=tme(i)),i}const V4=(e,t)=>{const i=B4(e),l=B4(t);if(!i||!l)return FS(e,t);const d={...i};return m=>(d.red=fP(i.red,l.red,m),d.green=fP(i.green,l.green,m),d.blue=fP(i.blue,l.blue,m),d.alpha=Ps(i.alpha,l.alpha,m),sm.transform(d))},mM=new Set(["none","hidden"]);function rme(e,t){return mM.has(e)?i=>i<=0?e:t:i=>i>=1?t:e}function sme(e,t){return i=>Ps(e,t,i)}function RN(e){return typeof e=="number"?sme:typeof e=="string"?IN(e)?FS:to.test(e)?V4:lme:Array.isArray(e)?EW:typeof e=="object"?to.test(e)?V4:ome:FS}function EW(e,t){const i=[...e],l=i.length,d=e.map((m,v)=>RN(m)(m,t[v]));return m=>{for(let v=0;v<l;v++)i[v]=d[v](m);return i}}function ome(e,t){const i={...e,...t},l={};for(const d in i)e[d]!==void 0&&t[d]!==void 0&&(l[d]=RN(e[d])(e[d],t[d]));return d=>{for(const m in l)i[m]=l[m](d);return i}}function ame(e,t){const i=[],l={color:0,var:0,number:0};for(let d=0;d<t.values.length;d++){const m=t.types[d],v=e.indexes[m][l[m]],o=e.values[v]??0;i[d]=o,l[m]++}return i}const lme=(e,t)=>{const i=Vf.createTransformer(t),l=B1(e),d=B1(t);return l.indexes.var.length===d.indexes.var.length&&l.indexes.color.length===d.indexes.color.length&&l.indexes.number.length>=d.indexes.number.length?mM.has(e)&&!d.values.length||mM.has(t)&&!l.values.length?rme(e,t):pb(EW(ame(l,d),d.values),i):(WC(!0,`Complex values '${e}' and '${t}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`,"complex-values-different"),FS(e,t))};function SW(e,t,i){return typeof e=="number"&&typeof t=="number"&&typeof i=="number"?Ps(e,t,i):RN(e)(e,t)}const cme=e=>{const t=({timestamp:i})=>e(i);return{start:(i=!0)=>bs.update(t,i),stop:()=>Bf(t),now:()=>Fo.isProcessing?Fo.timestamp:Za.now()}},CW=(e,t,i=10)=>{let l="";const d=Math.max(Math.round(t/i),2);for(let m=0;m<d;m++)l+=Math.round(e(m/(d-1))*1e4)/1e4+", ";return`linear(${l.substring(0,l.length-2)})`},zS=2e4;function MN(e){let t=0;const i=50;let l=e.next(t);for(;!l.done&&t<zS;)t+=i,l=e.next(t);return t>=zS?1/0:t}function ume(e,t=100,i){const l=i({...e,keyframes:[0,t]}),d=Math.min(MN(l),zS);return{type:"keyframes",ease:m=>l.next(d*m).value/t,duration:Ql(d)}}const dme=5;function IW(e,t,i){const l=Math.max(t-dme,0);return sW(i-e(l),t-l)}const Is={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},pP=.001;function hme({duration:e=Is.duration,bounce:t=Is.bounce,velocity:i=Is.velocity,mass:l=Is.mass}){let d,m;WC(e<=Jc(Is.maxDuration),"Spring duration must be 10 seconds or less","spring-duration-limit");let v=1-t;v=Jd(Is.minDamping,Is.maxDamping,v),e=Jd(Is.minDuration,Is.maxDuration,Ql(e)),v<1?(d=A=>{const N=A*v,F=N*e,z=N-i,$=gM(A,v),J=Math.exp(-F);return pP-z/$*J},m=A=>{const F=A*v*e,z=F*i+i,$=Math.pow(v,2)*Math.pow(A,2)*e,J=Math.exp(-F),H=gM(Math.pow(A,2),v);return(-d(A)+pP>0?-1:1)*((z-$)*J)/H}):(d=A=>{const N=Math.exp(-A*e),F=(A-i)*e+1;return-pP+N*F},m=A=>{const N=Math.exp(-A*e),F=(i-A)*(e*e);return N*F});const o=5/e,I=pme(d,m,o);if(e=Jc(e),isNaN(I))return{stiffness:Is.stiffness,damping:Is.damping,duration:e};{const A=Math.pow(I,2)*l;return{stiffness:A,damping:v*2*Math.sqrt(l*A),duration:e}}}const fme=12;function pme(e,t,i){let l=i;for(let d=1;d<fme;d++)l=l-e(l)/t(l);return l}function gM(e,t){return e*Math.sqrt(1-t*t)}const mme=["duration","bounce"],gme=["stiffness","damping","mass"];function U4(e,t){return t.some(i=>e[i]!==void 0)}function _me(e){let t={velocity:Is.velocity,stiffness:Is.stiffness,damping:Is.damping,mass:Is.mass,isResolvedFromDuration:!1,...e};if(!U4(e,gme)&&U4(e,mme))if(e.visualDuration){const i=e.visualDuration,l=2*Math.PI/(i*1.2),d=l*l,m=2*Jd(.05,1,1-(e.bounce||0))*Math.sqrt(d);t={...t,mass:Is.mass,stiffness:d,damping:m}}else{const i=hme(e);t={...t,...i,mass:Is.mass},t.isResolvedFromDuration=!0}return t}function jS(e=Is.visualDuration,t=Is.bounce){const i=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:l,restDelta:d}=i;const m=i.keyframes[0],v=i.keyframes[i.keyframes.length-1],o={done:!1,value:m},{stiffness:I,damping:A,mass:N,duration:F,velocity:z,isResolvedFromDuration:$}=_me({...i,velocity:-Ql(i.velocity||0)}),J=z||0,H=A/(2*Math.sqrt(I*N)),re=v-m,Q=Ql(Math.sqrt(I/N)),ee=Math.abs(re)<5;l||(l=ee?Is.restSpeed.granular:Is.restSpeed.default),d||(d=ee?Is.restDelta.granular:Is.restDelta.default);let ie;if(H<1){const xe=gM(Q,H);ie=Oe=>{const ze=Math.exp(-H*Q*Oe);return v-ze*((J+H*Q*re)/xe*Math.sin(xe*Oe)+re*Math.cos(xe*Oe))}}else if(H===1)ie=xe=>v-Math.exp(-Q*xe)*(re+(J+Q*re)*xe);else{const xe=Q*Math.sqrt(H*H-1);ie=Oe=>{const ze=Math.exp(-H*Q*Oe),Be=Math.min(xe*Oe,300);return v-ze*((J+H*Q*re)*Math.sinh(Be)+xe*re*Math.cosh(Be))/xe}}const ue={calculatedDuration:$&&F||null,next:xe=>{const Oe=ie(xe);if($)o.done=xe>=F;else{let ze=xe===0?J:0;H<1&&(ze=xe===0?Jc(J):IW(ie,xe,Oe));const Be=Math.abs(ze)<=l,ot=Math.abs(v-Oe)<=d;o.done=Be&&ot}return o.value=o.done?v:Oe,o},toString:()=>{const xe=Math.min(MN(ue),zS),Oe=CW(ze=>ue.next(xe*ze).value,xe,30);return xe+"ms "+Oe},toTransition:()=>{}};return ue}jS.applyToOptions=e=>{const t=ume(e,100,jS);return e.ease=t.ease,e.duration=Jc(t.duration),e.type="keyframes",e};function _M({keyframes:e,velocity:t=0,power:i=.8,timeConstant:l=325,bounceDamping:d=10,bounceStiffness:m=500,modifyTarget:v,min:o,max:I,restDelta:A=.5,restSpeed:N}){const F=e[0],z={done:!1,value:F},$=Be=>o!==void 0&&Be<o||I!==void 0&&Be>I,J=Be=>o===void 0?I:I===void 0||Math.abs(o-Be)<Math.abs(I-Be)?o:I;let H=i*t;const re=F+H,Q=v===void 0?re:v(re);Q!==re&&(H=Q-F);const ee=Be=>-H*Math.exp(-Be/l),ie=Be=>Q+ee(Be),ue=Be=>{const ot=ee(Be),Et=ie(Be);z.done=Math.abs(ot)<=A,z.value=z.done?Q:Et};let xe,Oe;const ze=Be=>{$(z.value)&&(xe=Be,Oe=jS({keyframes:[z.value,J(z.value)],velocity:IW(ie,Be,z.value),damping:d,stiffness:m,restDelta:A,restSpeed:N}))};return ze(0),{calculatedDuration:null,next:Be=>{let ot=!1;return!Oe&&xe===void 0&&(ot=!0,ue(Be),ze(Be)),xe!==void 0&&Be>=xe?Oe.next(Be-xe):(!ot&&ue(Be),z)}}}function yme(e,t,i){const l=[],d=i||eh.mix||SW,m=e.length-1;for(let v=0;v<m;v++){let o=d(e[v],e[v+1]);if(t){const I=Array.isArray(t)?t[v]||ec:t;o=pb(I,o)}l.push(o)}return l}function vme(e,t,{clamp:i=!0,ease:l,mixer:d}={}){const m=e.length;if(Gy(m===t.length,"Both input and output ranges must be the same length","range-length"),m===1)return()=>t[0];if(m===2&&t[0]===t[1])return()=>t[1];const v=e[0]===e[1];e[0]>e[m-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=yme(t,l,d),I=o.length,A=N=>{if(v&&N<e[0])return t[0];let F=0;if(I>1)for(;F<e.length-2&&!(N<e[F+1]);F++);const z=z1(e[F],e[F+1],N);return o[F](z)};return i?N=>A(Jd(e[0],e[m-1],N)):A}function xme(e,t){const i=e[e.length-1];for(let l=1;l<=t;l++){const d=z1(0,t,l);e.push(Ps(i,1,d))}}function bme(e){const t=[0];return xme(t,e.length-1),t}function wme(e,t){return e.map(i=>i*t)}function Tme(e,t){return e.map(()=>t||pW).splice(0,e.length-1)}function X0({duration:e=300,keyframes:t,times:i,ease:l="easeInOut"}){const d=Lpe(l)?l.map(O4):O4(l),m={done:!1,value:t[0]},v=wme(i&&i.length===t.length?i:bme(t),e),o=vme(v,t,{ease:Array.isArray(d)?d:Tme(t,d)});return{calculatedDuration:e,next:I=>(m.value=o(I),m.done=I>=e,m)}}const Eme=e=>e!==null;function kN(e,{repeat:t,repeatType:i="loop"},l,d=1){const m=e.filter(Eme),o=d<0||t&&i!=="loop"&&t%2===1?0:m.length-1;return!o||l===void 0?m[o]:l}const Sme={decay:_M,inertia:_M,tween:X0,keyframes:X0,spring:jS};function AW(e){typeof e.type=="string"&&(e.type=Sme[e.type])}class DN{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,i){return this.finished.then(t,i)}}const Cme=e=>e/100;class NN extends DN{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var l,d;const{motionValue:i}=this.options;i&&i.updatedAt!==Za.now()&&this.tick(Za.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(d=(l=this.options).onStop)==null||d.call(l))},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;AW(t);const{type:i=X0,repeat:l=0,repeatDelay:d=0,repeatType:m,velocity:v=0}=t;let{keyframes:o}=t;const I=i||X0;I!==X0&&typeof o[0]!="number"&&(this.mixKeyframes=pb(Cme,SW(o[0],o[1])),o=[0,100]);const A=I({...t,keyframes:o});m==="mirror"&&(this.mirroredGenerator=I({...t,keyframes:[...o].reverse(),velocity:-v})),A.calculatedDuration===null&&(A.calculatedDuration=MN(A));const{calculatedDuration:N}=A;this.calculatedDuration=N,this.resolvedDuration=N+d,this.totalDuration=this.resolvedDuration*(l+1)-d,this.generator=A}updateTime(t){const i=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=i}tick(t,i=!1){const{generator:l,totalDuration:d,mixKeyframes:m,mirroredGenerator:v,resolvedDuration:o,calculatedDuration:I}=this;if(this.startTime===null)return l.next(0);const{delay:A=0,keyframes:N,repeat:F,repeatType:z,repeatDelay:$,type:J,onUpdate:H,finalKeyframe:re}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-d/this.speed,this.startTime)),i?this.currentTime=t:this.updateTime(t);const Q=this.currentTime-A*(this.playbackSpeed>=0?1:-1),ee=this.playbackSpeed>=0?Q<0:Q>d;this.currentTime=Math.max(Q,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=d);let ie=this.currentTime,ue=l;if(F){const Be=Math.min(this.currentTime,d)/o;let ot=Math.floor(Be),Et=Be%1;!Et&&Be>=1&&(Et=1),Et===1&&ot--,ot=Math.min(ot,F+1),!!(ot%2)&&(z==="reverse"?(Et=1-Et,$&&(Et-=$/o)):z==="mirror"&&(ue=v)),ie=Jd(0,1,Et)*o}const xe=ee?{done:!1,value:N[0]}:ue.next(ie);m&&(xe.value=m(xe.value));let{done:Oe}=xe;!ee&&I!==null&&(Oe=this.playbackSpeed>=0?this.currentTime>=d:this.currentTime<=0);const ze=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Oe);return ze&&J!==_M&&(xe.value=kN(N,this.options,re,this.speed)),H&&H(xe.value),ze&&this.finish(),xe}then(t,i){return this.finished.then(t,i)}get duration(){return Ql(this.calculatedDuration)}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+Ql(t)}get time(){return Ql(this.currentTime)}set time(t){var i;t=Jc(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),(i=this.driver)==null||i.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(Za.now());const i=this.playbackSpeed!==t;this.playbackSpeed=t,i&&(this.time=Ql(this.currentTime))}play(){var d,m;if(this.isStopped)return;const{driver:t=cme,startTime:i}=this.options;this.driver||(this.driver=t(v=>this.tick(v))),(m=(d=this.options).onPlay)==null||m.call(d);const l=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=l):this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime||(this.startTime=i??l),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Za.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var t,i;this.notifyFinished(),this.teardown(),this.state="finished",(i=(t=this.options).onComplete)==null||i.call(t)}cancel(){var t,i;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(i=(t=this.options).onCancel)==null||i.call(t)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){var i;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(i=this.driver)==null||i.stop(),t.observe(this)}}function Ime(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}const om=e=>e*180/Math.PI,yM=e=>{const t=om(Math.atan2(e[1],e[0]));return vM(t)},Ame={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:yM,rotateZ:yM,skewX:e=>om(Math.atan(e[1])),skewY:e=>om(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},vM=e=>(e=e%360,e<0&&(e+=360),e),$4=yM,G4=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),H4=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),Pme={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:G4,scaleY:H4,scale:e=>(G4(e)+H4(e))/2,rotateX:e=>vM(om(Math.atan2(e[6],e[5]))),rotateY:e=>vM(om(Math.atan2(-e[2],e[0]))),rotateZ:$4,rotate:$4,skewX:e=>om(Math.atan(e[4])),skewY:e=>om(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function xM(e){return e.includes("scale")?1:0}function bM(e,t){if(!e||e==="none")return xM(t);const i=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let l,d;if(i)l=Pme,d=i;else{const o=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);l=Ame,d=o}if(!d)return xM(t);const m=l[t],v=d[1].split(",").map(Mme);return typeof m=="function"?m(v):v[m]}const Rme=(e,t)=>{const{transform:i="none"}=getComputedStyle(e);return bM(i,t)};function Mme(e){return parseFloat(e.trim())}const uv=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],dv=new Set(uv),W4=e=>e===cv||e===Vn,kme=new Set(["x","y","z"]),Dme=uv.filter(e=>!kme.has(e));function Nme(e){const t=[];return Dme.forEach(i=>{const l=e.getValue(i);l!==void 0&&(t.push([i,l.get()]),l.set(i.startsWith("scale")?1:0))}),t}const mm={width:({x:e},{paddingLeft:t="0",paddingRight:i="0"})=>e.max-e.min-parseFloat(t)-parseFloat(i),height:({y:e},{paddingTop:t="0",paddingBottom:i="0"})=>e.max-e.min-parseFloat(t)-parseFloat(i),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>bM(t,"x"),y:(e,{transform:t})=>bM(t,"y")};mm.translateX=mm.x;mm.translateY=mm.y;const gm=new Set;let wM=!1,TM=!1,EM=!1;function PW(){if(TM){const e=Array.from(gm).filter(l=>l.needsMeasurement),t=new Set(e.map(l=>l.element)),i=new Map;t.forEach(l=>{const d=Nme(l);d.length&&(i.set(l,d),l.render())}),e.forEach(l=>l.measureInitialState()),t.forEach(l=>{l.render();const d=i.get(l);d&&d.forEach(([m,v])=>{var o;(o=l.getValue(m))==null||o.set(v)})}),e.forEach(l=>l.measureEndState()),e.forEach(l=>{l.suspendedScrollY!==void 0&&window.scrollTo(0,l.suspendedScrollY)})}TM=!1,wM=!1,gm.forEach(e=>e.complete(EM)),gm.clear()}function RW(){gm.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(TM=!0)})}function Lme(){EM=!0,RW(),PW(),EM=!1}class LN{constructor(t,i,l,d,m,v=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=i,this.name=l,this.motionValue=d,this.element=m,this.isAsync=v}scheduleResolve(){this.state="scheduled",this.isAsync?(gm.add(this),wM||(wM=!0,bs.read(RW),bs.resolveKeyframes(PW))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:i,element:l,motionValue:d}=this;if(t[0]===null){const m=d==null?void 0:d.get(),v=t[t.length-1];if(m!==void 0)t[0]=m;else if(l&&i){const o=l.readValue(i,v);o!=null&&(t[0]=o)}t[0]===void 0&&(t[0]=v),d&&m===void 0&&d.set(t[0])}Ime(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),gm.delete(this)}cancel(){this.state==="scheduled"&&(gm.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Ome=e=>e.startsWith("--");function Fme(e,t,i){Ome(t)?e.style.setProperty(t,i):e.style[t]=i}const zme=TN(()=>window.ScrollTimeline!==void 0),jme={};function Bme(e,t){const i=TN(e);return()=>jme[t]??i()}const MW=Bme(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),R0=([e,t,i,l])=>`cubic-bezier(${e}, ${t}, ${i}, ${l})`,q4={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:R0([0,.65,.55,1]),circOut:R0([.55,0,1,.45]),backIn:R0([.31,.01,.66,-.59]),backOut:R0([.33,1.53,.69,.99])};function kW(e,t){if(e)return typeof e=="function"?MW()?CW(e,t):"ease-out":mW(e)?R0(e):Array.isArray(e)?e.map(i=>kW(i,t)||q4.easeOut):q4[e]}function Vme(e,t,i,{delay:l=0,duration:d=300,repeat:m=0,repeatType:v="loop",ease:o="easeOut",times:I}={},A=void 0){const N={[t]:i};I&&(N.offset=I);const F=kW(o,d);Array.isArray(F)&&(N.easing=F);const z={delay:l,duration:d,easing:Array.isArray(F)?"linear":F,fill:"both",iterations:m+1,direction:v==="reverse"?"alternate":"normal"};return A&&(z.pseudoElement=A),e.animate(N,z)}function DW(e){return typeof e=="function"&&"applyToOptions"in e}function Ume({type:e,...t}){return DW(e)&&MW()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class $me extends DN{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,!t)return;const{element:i,name:l,keyframes:d,pseudoElement:m,allowFlatten:v=!1,finalKeyframe:o,onComplete:I}=t;this.isPseudoElement=!!m,this.allowFlatten=v,this.options=t,Gy(typeof t.type!="string",`Mini animate() doesn't support "type" as a string.`,"mini-spring");const A=Ume(t);this.animation=Vme(i,l,d,A,m),A.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!m){const N=kN(d,this.options,o,this.speed);this.updateMotionValue?this.updateMotionValue(N):Fme(i,l,N),this.animation.cancel()}I==null||I(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var t,i;(i=(t=this.animation).finish)==null||i.call(t)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var t,i;this.isPseudoElement||(i=(t=this.animation).commitStyles)==null||i.call(t)}get duration(){var i,l;const t=((l=(i=this.animation.effect)==null?void 0:i.getComputedTiming)==null?void 0:l.call(i).duration)||0;return Ql(Number(t))}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+Ql(t)}get time(){return Ql(Number(this.animation.currentTime)||0)}set time(t){this.finishedTime=null,this.animation.currentTime=Jc(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(t){this.animation.startTime=t}attachTimeline({timeline:t,observe:i}){var l;return this.allowFlatten&&((l=this.animation.effect)==null||l.updateTiming({easing:"linear"})),this.animation.onfinish=null,t&&zme()?(this.animation.timeline=t,ec):i(this)}}const NW={anticipate:dW,backInOut:uW,circInOut:fW};function Gme(e){return e in NW}function Hme(e){typeof e.ease=="string"&&Gme(e.ease)&&(e.ease=NW[e.ease])}const Z4=10;class Wme extends $me{constructor(t){Hme(t),AW(t),super(t),t.startTime&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:i,onUpdate:l,onComplete:d,element:m,...v}=this.options;if(!i)return;if(t!==void 0){i.set(t);return}const o=new NN({...v,autoplay:!1}),I=Jc(this.finishedTime??this.time);i.setWithVelocity(o.sample(I-Z4).value,o.sample(I).value,Z4),o.stop()}}const K4=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Vf.test(e)||e==="0")&&!e.startsWith("url("));function qme(e){const t=e[0];if(e.length===1)return!0;for(let i=0;i<e.length;i++)if(e[i]!==t)return!0}function Zme(e,t,i,l){const d=e[0];if(d===null)return!1;if(t==="display"||t==="visibility")return!0;const m=e[e.length-1],v=K4(d,t),o=K4(m,t);return WC(v===o,`You are trying to animate ${t} from "${d}" to "${m}". "${v?m:d}" is not an animatable value.`,"value-not-animatable"),!v||!o?!1:qme(e)||(i==="spring"||DW(i))&&l}function SM(e){e.duration=0,e.type="keyframes"}const Kme=new Set(["opacity","clipPath","filter","transform"]),Xme=TN(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function Yme(e){var N;const{motionValue:t,name:i,repeatDelay:l,repeatType:d,damping:m,type:v}=e;if(!(((N=t==null?void 0:t.owner)==null?void 0:N.current)instanceof HTMLElement))return!1;const{onUpdate:I,transformTemplate:A}=t.owner.getProps();return Xme()&&i&&Kme.has(i)&&(i!=="transform"||!A)&&!I&&!l&&d!=="mirror"&&m!==0&&v!=="inertia"}const Qme=40;class Jme extends DN{constructor({autoplay:t=!0,delay:i=0,type:l="keyframes",repeat:d=0,repeatDelay:m=0,repeatType:v="loop",keyframes:o,name:I,motionValue:A,element:N,...F}){var J;super(),this.stop=()=>{var H,re;this._animation&&(this._animation.stop(),(H=this.stopTimeline)==null||H.call(this)),(re=this.keyframeResolver)==null||re.cancel()},this.createdAt=Za.now();const z={autoplay:t,delay:i,type:l,repeat:d,repeatDelay:m,repeatType:v,name:I,motionValue:A,element:N,...F},$=(N==null?void 0:N.KeyframeResolver)||LN;this.keyframeResolver=new $(o,(H,re,Q)=>this.onKeyframesResolved(H,re,z,!Q),I,A,N),(J=this.keyframeResolver)==null||J.scheduleResolve()}onKeyframesResolved(t,i,l,d){this.keyframeResolver=void 0;const{name:m,type:v,velocity:o,delay:I,isHandoff:A,onUpdate:N}=l;this.resolvedAt=Za.now(),Zme(t,m,v,o)||((eh.instantAnimations||!I)&&(N==null||N(kN(t,l,i))),t[0]=t[t.length-1],SM(l),l.repeat=0);const z={startTime:d?this.resolvedAt?this.resolvedAt-this.createdAt>Qme?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:i,...l,keyframes:t},$=!A&&Yme(z)?new Wme({...z,element:z.motionValue.owner.current}):new NN(z);$.finished.then(()=>this.notifyFinished()).catch(ec),this.pendingTimeline&&(this.stopTimeline=$.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=$}get finished(){return this._animation?this.animation.finished:this._finished}then(t,i){return this.finished.finally(t).then(()=>{})}get animation(){var t;return this._animation||((t=this.keyframeResolver)==null||t.resume(),Lme()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var t;this._animation&&this.animation.cancel(),(t=this.keyframeResolver)==null||t.cancel()}}const ege=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function tge(e){const t=ege.exec(e);if(!t)return[,];const[,i,l,d]=t;return[`--${i??l}`,d]}const nge=4;function LW(e,t,i=1){Gy(i<=nge,`Max CSS variable fallback depth detected in property "${e}". This may indicate a circular fallback dependency.`,"max-css-var-depth");const[l,d]=tge(e);if(!l)return;const m=window.getComputedStyle(t).getPropertyValue(l);if(m){const v=m.trim();return nW(v)?parseFloat(v):v}return IN(d)?LW(d,t,i+1):d}function ON(e,t){return(e==null?void 0:e[t])??(e==null?void 0:e.default)??e}const OW=new Set(["width","height","top","left","right","bottom",...uv]),ige={test:e=>e==="auto",parse:e=>e},FW=e=>t=>t.test(e),zW=[cv,Vn,qu,Hh,qpe,Wpe,ige],X4=e=>zW.find(FW(e));function rge(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||rW(e):!0}const sge=new Set(["brightness","contrast","saturate","opacity"]);function oge(e){const[t,i]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[l]=i.match(AN)||[];if(!l)return e;const d=i.replace(l,"");let m=sge.has(t)?1:0;return l!==i&&(m*=100),t+"("+m+d+")"}const age=/\b([a-z-]*)\(.*?\)/gu,CM={...Vf,getAnimatableNone:e=>{const t=e.match(age);return t?t.map(oge).join(" "):e}},Y4={...cv,transform:Math.round},lge={rotate:Hh,rotateX:Hh,rotateY:Hh,rotateZ:Hh,scale:ZT,scaleX:ZT,scaleY:ZT,scaleZ:ZT,skew:Hh,skewX:Hh,skewY:Hh,distance:Vn,translateX:Vn,translateY:Vn,translateZ:Vn,x:Vn,y:Vn,z:Vn,perspective:Vn,transformPerspective:Vn,opacity:j1,originX:z4,originY:z4,originZ:Vn},FN={borderWidth:Vn,borderTopWidth:Vn,borderRightWidth:Vn,borderBottomWidth:Vn,borderLeftWidth:Vn,borderRadius:Vn,radius:Vn,borderTopLeftRadius:Vn,borderTopRightRadius:Vn,borderBottomRightRadius:Vn,borderBottomLeftRadius:Vn,width:Vn,maxWidth:Vn,height:Vn,maxHeight:Vn,top:Vn,right:Vn,bottom:Vn,left:Vn,inset:Vn,insetBlock:Vn,insetBlockStart:Vn,insetBlockEnd:Vn,insetInline:Vn,insetInlineStart:Vn,insetInlineEnd:Vn,padding:Vn,paddingTop:Vn,paddingRight:Vn,paddingBottom:Vn,paddingLeft:Vn,paddingBlock:Vn,paddingBlockStart:Vn,paddingBlockEnd:Vn,paddingInline:Vn,paddingInlineStart:Vn,paddingInlineEnd:Vn,margin:Vn,marginTop:Vn,marginRight:Vn,marginBottom:Vn,marginLeft:Vn,marginBlock:Vn,marginBlockStart:Vn,marginBlockEnd:Vn,marginInline:Vn,marginInlineStart:Vn,marginInlineEnd:Vn,backgroundPositionX:Vn,backgroundPositionY:Vn,...lge,zIndex:Y4,fillOpacity:j1,strokeOpacity:j1,numOctaves:Y4},cge={...FN,color:to,backgroundColor:to,outlineColor:to,fill:to,stroke:to,borderColor:to,borderTopColor:to,borderRightColor:to,borderBottomColor:to,borderLeftColor:to,filter:CM,WebkitFilter:CM},jW=e=>cge[e];function BW(e,t){let i=jW(e);return i!==CM&&(i=Vf),i.getAnimatableNone?i.getAnimatableNone(t):void 0}const uge=new Set(["auto","none","0"]);function dge(e,t,i){let l=0,d;for(;l<e.length&&!d;){const m=e[l];typeof m=="string"&&!uge.has(m)&&B1(m).values.length&&(d=e[l]),l++}if(d&&i)for(const m of t)e[m]=BW(i,d)}class hge extends LN{constructor(t,i,l,d,m){super(t,i,l,d,m,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:i,name:l}=this;if(!i||!i.current)return;super.readKeyframes();for(let I=0;I<t.length;I++){let A=t[I];if(typeof A=="string"&&(A=A.trim(),IN(A))){const N=LW(A,i.current);N!==void 0&&(t[I]=N),I===t.length-1&&(this.finalKeyframe=A)}}if(this.resolveNoneKeyframes(),!OW.has(l)||t.length!==2)return;const[d,m]=t,v=X4(d),o=X4(m);if(v!==o)if(W4(v)&&W4(o))for(let I=0;I<t.length;I++){const A=t[I];typeof A=="string"&&(t[I]=parseFloat(A))}else mm[l]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:i}=this,l=[];for(let d=0;d<t.length;d++)(t[d]===null||rge(t[d]))&&l.push(d);l.length&&dge(t,l,i)}measureInitialState(){const{element:t,unresolvedKeyframes:i,name:l}=this;if(!t||!t.current)return;l==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=mm[l](t.measureViewportBox(),window.getComputedStyle(t.current)),i[0]=this.measuredOrigin;const d=i[i.length-1];d!==void 0&&t.getValue(l,d).jump(d,!1)}measureEndState(){var o;const{element:t,name:i,unresolvedKeyframes:l}=this;if(!t||!t.current)return;const d=t.getValue(i);d&&d.jump(this.measuredOrigin,!1);const m=l.length-1,v=l[m];l[m]=mm[i](t.measureViewportBox(),window.getComputedStyle(t.current)),v!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=v),(o=this.removedTransforms)!=null&&o.length&&this.removedTransforms.forEach(([I,A])=>{t.getValue(I).set(A)}),this.resolveNoneKeyframes()}}function fge(e,t,i){if(e instanceof EventTarget)return[e];if(typeof e=="string"){const d=document.querySelectorAll(e);return d?Array.from(d):[]}return Array.from(e)}const VW=(e,t)=>t&&typeof e=="number"?t.transform(e):e;function UW(e){return iW(e)&&"offsetHeight"in e}const Q4=30,pge=e=>!isNaN(parseFloat(e));class mge{constructor(t,i={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=l=>{var m;const d=Za.now();if(this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(l),this.current!==this.prev&&((m=this.events.change)==null||m.notify(this.current),this.dependents))for(const v of this.dependents)v.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=i.owner}setCurrent(t){this.current=t,this.updatedAt=Za.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=pge(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,i){this.events[t]||(this.events[t]=new EN);const l=this.events[t].add(i);return t==="change"?()=>{l(),bs.read(()=>{this.events.change.getSize()||this.stop()})}:l}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,i){this.passiveEffect=t,this.stopPassiveEffect=i}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,i,l){this.set(i),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-l}jump(t,i=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var t;(t=this.events.change)==null||t.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Za.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>Q4)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,Q4);return sW(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(t){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=t(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var t,i;(t=this.dependents)==null||t.clear(),(i=this.events.destroy)==null||i.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Hy(e,t){return new mge(e,t)}const{schedule:zN,cancel:Dbe}=gW(queueMicrotask,!1),Nc={x:!1,y:!1};function $W(){return Nc.x||Nc.y}function gge(e){return e==="x"||e==="y"?Nc[e]?null:(Nc[e]=!0,()=>{Nc[e]=!1}):Nc.x||Nc.y?null:(Nc.x=Nc.y=!0,()=>{Nc.x=Nc.y=!1})}function GW(e,t){const i=fge(e),l=new AbortController,d={passive:!0,...t,signal:l.signal};return[i,d,()=>l.abort()]}function J4(e){return!(e.pointerType==="touch"||$W())}function _ge(e,t,i={}){const[l,d,m]=GW(e,i),v=o=>{if(!J4(o))return;const{target:I}=o,A=t(I,o);if(typeof A!="function"||!I)return;const N=F=>{J4(F)&&(A(F),I.removeEventListener("pointerleave",N))};I.addEventListener("pointerleave",N,d)};return l.forEach(o=>{o.addEventListener("pointerenter",v,d)}),m}const HW=(e,t)=>t?e===t?!0:HW(e,t.parentElement):!1,jN=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,yge=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function vge(e){return yge.has(e.tagName)||e.tabIndex!==-1}const SE=new WeakSet;function e5(e){return t=>{t.key==="Enter"&&e(t)}}function mP(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const xge=(e,t)=>{const i=e.currentTarget;if(!i)return;const l=e5(()=>{if(SE.has(i))return;mP(i,"down");const d=e5(()=>{mP(i,"up")}),m=()=>mP(i,"cancel");i.addEventListener("keyup",d,t),i.addEventListener("blur",m,t)});i.addEventListener("keydown",l,t),i.addEventListener("blur",()=>i.removeEventListener("keydown",l),t)};function t5(e){return jN(e)&&!$W()}function bge(e,t,i={}){const[l,d,m]=GW(e,i),v=o=>{const I=o.currentTarget;if(!t5(o))return;SE.add(I);const A=t(I,o),N=($,J)=>{window.removeEventListener("pointerup",F),window.removeEventListener("pointercancel",z),SE.has(I)&&SE.delete(I),t5($)&&typeof A=="function"&&A($,{success:J})},F=$=>{N($,I===window||I===document||i.useGlobalTarget||HW(I,$.target))},z=$=>{N($,!1)};window.addEventListener("pointerup",F,d),window.addEventListener("pointercancel",z,d)};return l.forEach(o=>{(i.useGlobalTarget?window:o).addEventListener("pointerdown",v,d),UW(o)&&(o.addEventListener("focus",A=>xge(A,d)),!vge(o)&&!o.hasAttribute("tabindex")&&(o.tabIndex=0))}),m}function WW(e){return iW(e)&&"ownerSVGElement"in e}function wge(e){return WW(e)&&e.tagName==="svg"}const Qo=e=>!!(e&&e.getVelocity),Tge=[...zW,to,Vf],Ege=e=>Tge.find(FW(e)),BN=q.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function n5(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function Sge(...e){return t=>{let i=!1;const l=e.map(d=>{const m=n5(d,t);return!i&&typeof m=="function"&&(i=!0),m});if(i)return()=>{for(let d=0;d<l.length;d++){const m=l[d];typeof m=="function"?m():n5(e[d],null)}}}}function Cge(...e){return q.useCallback(Sge(...e),e)}class Ige extends q.Component{getSnapshotBeforeUpdate(t){const i=this.props.childRef.current;if(i&&t.isPresent&&!this.props.isPresent){const l=i.offsetParent,d=UW(l)&&l.offsetWidth||0,m=this.props.sizeRef.current;m.height=i.offsetHeight||0,m.width=i.offsetWidth||0,m.top=i.offsetTop,m.left=i.offsetLeft,m.right=d-m.width-m.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Age({children:e,isPresent:t,anchorX:i,root:l}){var N;const d=q.useId(),m=q.useRef(null),v=q.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:o}=q.useContext(BN),I=((N=e.props)==null?void 0:N.ref)??(e==null?void 0:e.ref),A=Cge(m,I);return q.useInsertionEffect(()=>{const{width:F,height:z,top:$,left:J,right:H}=v.current;if(t||!m.current||!F||!z)return;const re=i==="left"?`left: ${J}`:`right: ${H}`;m.current.dataset.motionPopId=d;const Q=document.createElement("style");o&&(Q.nonce=o);const ee=l??document.head;return ee.appendChild(Q),Q.sheet&&Q.sheet.insertRule(`
          [data-motion-pop-id="${d}"] {
            position: absolute !important;
            width: ${F}px !important;
            height: ${z}px !important;
            ${re}px !important;
            top: ${$}px !important;
          }
        `),()=>{ee.contains(Q)&&ee.removeChild(Q)}},[t]),E.jsx(Ige,{isPresent:t,childRef:m,sizeRef:v,children:q.cloneElement(e,{ref:A})})}const Pge=({children:e,initial:t,isPresent:i,onExitComplete:l,custom:d,presenceAffectsLayout:m,mode:v,anchorX:o,root:I})=>{const A=vN(Rge),N=q.useId();let F=!0,z=q.useMemo(()=>(F=!1,{id:N,initial:t,isPresent:i,custom:d,onExitComplete:$=>{A.set($,!0);for(const J of A.values())if(!J)return;l&&l()},register:$=>(A.set($,!1),()=>A.delete($))}),[i,A,l]);return m&&F&&(z={...z}),q.useMemo(()=>{A.forEach(($,J)=>A.set(J,!1))},[i]),q.useEffect(()=>{!i&&!A.size&&l&&l()},[i]),v==="popLayout"&&(e=E.jsx(Age,{isPresent:i,anchorX:o,root:I,children:e})),E.jsx(HC.Provider,{value:z,children:e})};function Rge(){return new Map}function qW(e=!0){const t=q.useContext(HC);if(t===null)return[!0,null];const{isPresent:i,onExitComplete:l,register:d}=t,m=q.useId();q.useEffect(()=>{if(e)return d(m)},[e]);const v=q.useCallback(()=>e&&l&&l(m),[m,l,e]);return!i&&l?[!1,v]:[!0]}const KT=e=>e.key||"";function i5(e){const t=[];return q.Children.forEach(e,i=>{q.isValidElement(i)&&t.push(i)}),t}const VN=({children:e,custom:t,initial:i=!0,onExitComplete:l,presenceAffectsLayout:d=!0,mode:m="sync",propagate:v=!1,anchorX:o="left",root:I})=>{const[A,N]=qW(v),F=q.useMemo(()=>i5(e),[e]),z=v&&!A?[]:F.map(KT),$=q.useRef(!0),J=q.useRef(F),H=vN(()=>new Map),re=q.useRef(new Set),[Q,ee]=q.useState(F),[ie,ue]=q.useState(F);tW(()=>{$.current=!1,J.current=F;for(let ze=0;ze<ie.length;ze++){const Be=KT(ie[ze]);z.includes(Be)?(H.delete(Be),re.current.delete(Be)):H.get(Be)!==!0&&H.set(Be,!1)}},[ie,z.length,z.join("-")]);const xe=[];if(F!==Q){let ze=[...F];for(let Be=0;Be<ie.length;Be++){const ot=ie[Be],Et=KT(ot);z.includes(Et)||(ze.splice(Be,0,ot),xe.push(ot))}return m==="wait"&&xe.length&&(ze=xe),ue(i5(ze)),ee(F),null}const{forceRender:Oe}=q.useContext(yN);return E.jsx(E.Fragment,{children:ie.map(ze=>{const Be=KT(ze),ot=v&&!A?!1:F===ie||z.includes(Be),Et=()=>{if(re.current.has(Be))return;if(re.current.add(Be),H.has(Be))H.set(Be,!0);else return;let Zt=!0;H.forEach(at=>{at||(Zt=!1)}),Zt&&(Oe==null||Oe(),ue(J.current),v&&(N==null||N()),l&&l())};return E.jsx(Pge,{isPresent:ot,initial:!$.current||i?void 0:!1,custom:t,presenceAffectsLayout:d,mode:m,root:I,onExitComplete:ot?void 0:Et,anchorX:o,children:ze},Be)})})},ZW=q.createContext({strict:!1}),r5={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Wy={};for(const e in r5)Wy[e]={isEnabled:t=>r5[e].some(i=>!!t[i])};function Mge(e){for(const t in e)Wy[t]={...Wy[t],...e[t]}}const kge=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function BS(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||kge.has(e)}let KW=e=>!BS(e);function Dge(e){typeof e=="function"&&(KW=t=>t.startsWith("on")?!BS(t):e(t))}try{Dge(require("@emotion/is-prop-valid").default)}catch{}function Nge(e,t,i){const l={};for(const d in e)d==="values"&&typeof e.values=="object"||(KW(d)||i===!0&&BS(d)||!t&&!BS(d)||e.draggable&&d.startsWith("onDrag"))&&(l[d]=e[d]);return l}const qC=q.createContext({});function ZC(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function V1(e){return typeof e=="string"||Array.isArray(e)}const UN=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],$N=["initial",...UN];function KC(e){return ZC(e.animate)||$N.some(t=>V1(e[t]))}function XW(e){return!!(KC(e)||e.variants)}function Lge(e,t){if(KC(e)){const{initial:i,animate:l}=e;return{initial:i===!1||V1(i)?i:void 0,animate:V1(l)?l:void 0}}return e.inherit!==!1?t:{}}function Oge(e){const{initial:t,animate:i}=Lge(e,q.useContext(qC));return q.useMemo(()=>({initial:t,animate:i}),[s5(t),s5(i)])}function s5(e){return Array.isArray(e)?e.join(" "):e}function o5(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const w0={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(Vn.test(e))e=parseFloat(e);else return e;const i=o5(e,t.target.x),l=o5(e,t.target.y);return`${i}% ${l}%`}},Fge={correct:(e,{treeScale:t,projectionDelta:i})=>{const l=e,d=Vf.parse(e);if(d.length>5)return l;const m=Vf.createTransformer(e),v=typeof d[0]!="number"?1:0,o=i.x.scale*t.x,I=i.y.scale*t.y;d[0+v]/=o,d[1+v]/=I;const A=Ps(o,I,.5);return typeof d[2+v]=="number"&&(d[2+v]/=A),typeof d[3+v]=="number"&&(d[3+v]/=A),m(d)}},IM={borderRadius:{...w0,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:w0,borderTopRightRadius:w0,borderBottomLeftRadius:w0,borderBottomRightRadius:w0,boxShadow:Fge};function YW(e,{layout:t,layoutId:i}){return dv.has(e)||e.startsWith("origin")||(t||i!==void 0)&&(!!IM[e]||e==="opacity")}const zge={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},jge=uv.length;function Bge(e,t,i){let l="",d=!0;for(let m=0;m<jge;m++){const v=uv[m],o=e[v];if(o===void 0)continue;let I=!0;if(typeof o=="number"?I=o===(v.startsWith("scale")?1:0):I=parseFloat(o)===0,!I||i){const A=VW(o,FN[v]);if(!I){d=!1;const N=zge[v]||v;l+=`${N}(${A}) `}i&&(t[v]=A)}}return l=l.trim(),i?l=i(t,d?"":l):d&&(l="none"),l}function GN(e,t,i){const{style:l,vars:d,transformOrigin:m}=e;let v=!1,o=!1;for(const I in t){const A=t[I];if(dv.has(I)){v=!0;continue}else if(yW(I)){d[I]=A;continue}else{const N=VW(A,FN[I]);I.startsWith("origin")?(o=!0,m[I]=N):l[I]=N}}if(t.transform||(v||i?l.transform=Bge(t,e.transform,i):l.transform&&(l.transform="none")),o){const{originX:I="50%",originY:A="50%",originZ:N=0}=m;l.transformOrigin=`${I} ${A} ${N}`}}const HN=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function QW(e,t,i){for(const l in t)!Qo(t[l])&&!YW(l,i)&&(e[l]=t[l])}function Vge({transformTemplate:e},t){return q.useMemo(()=>{const i=HN();return GN(i,t,e),Object.assign({},i.vars,i.style)},[t])}function Uge(e,t){const i=e.style||{},l={};return QW(l,i,e),Object.assign(l,Vge(e,t)),l}function $ge(e,t){const i={},l=Uge(e,t);return e.drag&&e.dragListener!==!1&&(i.draggable=!1,l.userSelect=l.WebkitUserSelect=l.WebkitTouchCallout="none",l.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(i.tabIndex=0),i.style=l,i}const Gge={offset:"stroke-dashoffset",array:"stroke-dasharray"},Hge={offset:"strokeDashoffset",array:"strokeDasharray"};function Wge(e,t,i=1,l=0,d=!0){e.pathLength=1;const m=d?Gge:Hge;e[m.offset]=Vn.transform(-l);const v=Vn.transform(t),o=Vn.transform(i);e[m.array]=`${v} ${o}`}const qge=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function JW(e,{attrX:t,attrY:i,attrScale:l,pathLength:d,pathSpacing:m=1,pathOffset:v=0,...o},I,A,N){if(GN(e,o,A),I){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:F,style:z}=e;F.transform&&(z.transform=F.transform,delete F.transform),(z.transform||F.transformOrigin)&&(z.transformOrigin=F.transformOrigin??"50% 50%",delete F.transformOrigin),z.transform&&(z.transformBox=(N==null?void 0:N.transformBox)??"fill-box",delete F.transformBox);for(const $ of qge)F[$]!==void 0&&(z[$]=F[$],delete F[$]);t!==void 0&&(F.x=t),i!==void 0&&(F.y=i),l!==void 0&&(F.scale=l),d!==void 0&&Wge(F,d,m,v,!1)}const e7=()=>({...HN(),attrs:{}}),t7=e=>typeof e=="string"&&e.toLowerCase()==="svg";function Zge(e,t,i,l){const d=q.useMemo(()=>{const m=e7();return JW(m,t,t7(l),e.transformTemplate,e.style),{...m.attrs,style:{...m.style}}},[t]);if(e.style){const m={};QW(m,e.style,e),d.style={...m,...d.style}}return d}const Kge=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function WN(e){return typeof e!="string"||e.includes("-")?!1:!!(Kge.indexOf(e)>-1||/[A-Z]/u.test(e))}function Xge(e,t,i,{latestValues:l},d,m=!1,v){const I=(v??WN(e)?Zge:$ge)(t,l,d,e),A=Nge(t,typeof e=="string",m),N=e!==q.Fragment?{...A,...I,ref:i}:{},{children:F}=t,z=q.useMemo(()=>Qo(F)?F.get():F,[F]);return q.createElement(e,{...N,children:z})}function a5(e){const t=[{},{}];return e==null||e.values.forEach((i,l)=>{t[0][l]=i.get(),t[1][l]=i.getVelocity()}),t}function qN(e,t,i,l){if(typeof t=="function"){const[d,m]=a5(l);t=t(i!==void 0?i:e.custom,d,m)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[d,m]=a5(l);t=t(i!==void 0?i:e.custom,d,m)}return t}function CE(e){return Qo(e)?e.get():e}function Yge({scrapeMotionValuesFromProps:e,createRenderState:t},i,l,d){return{latestValues:Qge(i,l,d,e),renderState:t()}}function Qge(e,t,i,l){const d={},m=l(e,{});for(const z in m)d[z]=CE(m[z]);let{initial:v,animate:o}=e;const I=KC(e),A=XW(e);t&&A&&!I&&e.inherit!==!1&&(v===void 0&&(v=t.initial),o===void 0&&(o=t.animate));let N=i?i.initial===!1:!1;N=N||v===!1;const F=N?o:v;if(F&&typeof F!="boolean"&&!ZC(F)){const z=Array.isArray(F)?F:[F];for(let $=0;$<z.length;$++){const J=qN(e,z[$]);if(J){const{transitionEnd:H,transition:re,...Q}=J;for(const ee in Q){let ie=Q[ee];if(Array.isArray(ie)){const ue=N?ie.length-1:0;ie=ie[ue]}ie!==null&&(d[ee]=ie)}for(const ee in H)d[ee]=H[ee]}}}return d}const n7=e=>(t,i)=>{const l=q.useContext(qC),d=q.useContext(HC),m=()=>Yge(e,t,l,d);return i?m():vN(m)};function ZN(e,t,i){var m;const{style:l}=e,d={};for(const v in l)(Qo(l[v])||t.style&&Qo(t.style[v])||YW(v,e)||((m=i==null?void 0:i.getValue(v))==null?void 0:m.liveStyle)!==void 0)&&(d[v]=l[v]);return d}const Jge=n7({scrapeMotionValuesFromProps:ZN,createRenderState:HN});function i7(e,t,i){const l=ZN(e,t,i);for(const d in e)if(Qo(e[d])||Qo(t[d])){const m=uv.indexOf(d)!==-1?"attr"+d.charAt(0).toUpperCase()+d.substring(1):d;l[m]=e[d]}return l}const e_e=n7({scrapeMotionValuesFromProps:i7,createRenderState:e7}),t_e=Symbol.for("motionComponentSymbol");function Y_(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function l5(e,t){if(typeof e=="function")return e(t);Y_(e)&&(e.current=t)}function n_e(e,t,i){const l=q.useRef(null);return q.useCallback(d=>{if(d&&e.onMount&&e.onMount(d),t&&(d?t.mount(d):t.unmount()),i)if(d){const m=l5(i,d);typeof m=="function"&&(l.current=m)}else l.current?(l.current(),l.current=null):l5(i,d)},[t,e,i])}const KN=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),i_e="framerAppearId",r7="data-"+KN(i_e),s7=q.createContext({});function r_e(e,t,i,l,d,m){var re,Q;const{visualElement:v}=q.useContext(qC),o=q.useContext(ZW),I=q.useContext(HC),A=q.useContext(BN).reducedMotion,N=q.useRef(null);l=l||o.renderer,!N.current&&l&&(N.current=l(e,{visualState:t,parent:v,props:i,presenceContext:I,blockInitialAnimation:I?I.initial===!1:!1,reducedMotionConfig:A,isSVG:m}));const F=N.current,z=q.useContext(s7);F&&!F.projection&&d&&(F.type==="html"||F.type==="svg")&&s_e(N.current,i,d,z);const $=q.useRef(!1);q.useInsertionEffect(()=>{F&&$.current&&F.update(i,I)});const J=i[r7],H=q.useRef(!!J&&!((re=window.MotionHandoffIsComplete)!=null&&re.call(window,J))&&((Q=window.MotionHasOptimisedAnimation)==null?void 0:Q.call(window,J)));return tW(()=>{F&&($.current=!0,window.MotionIsMounted=!0,F.updateFeatures(),F.scheduleRenderMicrotask(),H.current&&F.animationState&&F.animationState.animateChanges())}),q.useEffect(()=>{F&&(!H.current&&F.animationState&&F.animationState.animateChanges(),H.current&&(queueMicrotask(()=>{var ee;(ee=window.MotionHandoffMarkAsComplete)==null||ee.call(window,J)}),H.current=!1),F.enteringChildren=void 0)}),F}function s_e(e,t,i,l){const{layoutId:d,layout:m,drag:v,dragConstraints:o,layoutScroll:I,layoutRoot:A,layoutCrossfade:N}=t;e.projection=new i(e.latestValues,t["data-framer-portal-id"]?void 0:o7(e.parent)),e.projection.setOptions({layoutId:d,layout:m,alwaysMeasureLayout:!!v||o&&Y_(o),visualElement:e,animationType:typeof m=="string"?m:"both",initialPromotionConfig:l,crossfade:N,layoutScroll:I,layoutRoot:A})}function o7(e){if(e)return e.options.allowProjection!==!1?e.projection:o7(e.parent)}function gP(e,{forwardMotionProps:t=!1,type:i}={},l,d){l&&Mge(l);const m=i?i==="svg":WN(e),v=m?e_e:Jge;function o(A,N){let F;const z={...q.useContext(BN),...A,layoutId:o_e(A)},{isStatic:$}=z,J=Oge(A),H=v(A,$);if(!$&&xN){a_e();const re=l_e(z);F=re.MeasureLayout,J.visualElement=r_e(e,H,z,d,re.ProjectionNode,m)}return E.jsxs(qC.Provider,{value:J,children:[F&&J.visualElement?E.jsx(F,{visualElement:J.visualElement,...z}):null,Xge(e,A,n_e(H,J.visualElement,N),H,$,t,m)]})}o.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const I=q.forwardRef(o);return I[t_e]=e,I}function o_e({layoutId:e}){const t=q.useContext(yN).id;return t&&e!==void 0?t+"-"+e:e}function a_e(e,t){q.useContext(ZW).strict}function l_e(e){const{drag:t,layout:i}=Wy;if(!t&&!i)return{};const l={...t,...i};return{MeasureLayout:t!=null&&t.isEnabled(e)||i!=null&&i.isEnabled(e)?l.MeasureLayout:void 0,ProjectionNode:l.ProjectionNode}}function c_e(e,t){if(typeof Proxy>"u")return gP;const i=new Map,l=(m,v)=>gP(m,v,e,t),d=(m,v)=>l(m,v);return new Proxy(d,{get:(m,v)=>v==="create"?l:(i.has(v)||i.set(v,gP(v,void 0,e,t)),i.get(v))})}function a7({top:e,left:t,right:i,bottom:l}){return{x:{min:t,max:i},y:{min:e,max:l}}}function u_e({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function d_e(e,t){if(!t)return e;const i=t({x:e.left,y:e.top}),l=t({x:e.right,y:e.bottom});return{top:i.y,left:i.x,bottom:l.y,right:l.x}}function _P(e){return e===void 0||e===1}function AM({scale:e,scaleX:t,scaleY:i}){return!_P(e)||!_P(t)||!_P(i)}function em(e){return AM(e)||l7(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function l7(e){return c5(e.x)||c5(e.y)}function c5(e){return e&&e!=="0%"}function VS(e,t,i){const l=e-i,d=t*l;return i+d}function u5(e,t,i,l,d){return d!==void 0&&(e=VS(e,d,l)),VS(e,i,l)+t}function PM(e,t=0,i=1,l,d){e.min=u5(e.min,t,i,l,d),e.max=u5(e.max,t,i,l,d)}function c7(e,{x:t,y:i}){PM(e.x,t.translate,t.scale,t.originPoint),PM(e.y,i.translate,i.scale,i.originPoint)}const d5=.999999999999,h5=1.0000000000001;function h_e(e,t,i,l=!1){const d=i.length;if(!d)return;t.x=t.y=1;let m,v;for(let o=0;o<d;o++){m=i[o],v=m.projectionDelta;const{visualElement:I}=m.options;I&&I.props.style&&I.props.style.display==="contents"||(l&&m.options.layoutScroll&&m.scroll&&m!==m.root&&J_(e,{x:-m.scroll.offset.x,y:-m.scroll.offset.y}),v&&(t.x*=v.x.scale,t.y*=v.y.scale,c7(e,v)),l&&em(m.latestValues)&&J_(e,m.latestValues))}t.x<h5&&t.x>d5&&(t.x=1),t.y<h5&&t.y>d5&&(t.y=1)}function Q_(e,t){e.min=e.min+t,e.max=e.max+t}function f5(e,t,i,l,d=.5){const m=Ps(e.min,e.max,d);PM(e,t,i,m,l)}function J_(e,t){f5(e.x,t.x,t.scaleX,t.scale,t.originX),f5(e.y,t.y,t.scaleY,t.scale,t.originY)}function u7(e,t){return a7(d_e(e.getBoundingClientRect(),t))}function f_e(e,t,i){const l=u7(e,i),{scroll:d}=t;return d&&(Q_(l.x,d.offset.x),Q_(l.y,d.offset.y)),l}const p5=()=>({translate:0,scale:1,origin:0,originPoint:0}),ey=()=>({x:p5(),y:p5()}),m5=()=>({min:0,max:0}),ao=()=>({x:m5(),y:m5()}),RM={current:null},d7={current:!1};function p_e(){if(d7.current=!0,!!xN)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>RM.current=e.matches;e.addEventListener("change",t),t()}else RM.current=!1}const m_e=new WeakMap;function g_e(e,t,i){for(const l in t){const d=t[l],m=i[l];if(Qo(d))e.addValue(l,d);else if(Qo(m))e.addValue(l,Hy(d,{owner:e}));else if(m!==d)if(e.hasValue(l)){const v=e.getValue(l);v.liveStyle===!0?v.jump(d):v.hasAnimated||v.set(d)}else{const v=e.getStaticValue(l);e.addValue(l,Hy(v!==void 0?v:d,{owner:e}))}}for(const l in i)t[l]===void 0&&e.removeValue(l);return t}const g5=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class __e{scrapeMotionValuesFromProps(t,i,l){return{}}constructor({parent:t,props:i,presenceContext:l,reducedMotionConfig:d,blockInitialAnimation:m,visualState:v},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=LN,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const z=Za.now();this.renderScheduledAt<z&&(this.renderScheduledAt=z,bs.render(this.render,!1,!0))};const{latestValues:I,renderState:A}=v;this.latestValues=I,this.baseTarget={...I},this.initialValues=i.initial?{...I}:{},this.renderState=A,this.parent=t,this.props=i,this.presenceContext=l,this.depth=t?t.depth+1:0,this.reducedMotionConfig=d,this.options=o,this.blockInitialAnimation=!!m,this.isControllingVariants=KC(i),this.isVariantNode=XW(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:N,...F}=this.scrapeMotionValuesFromProps(i,{},this);for(const z in F){const $=F[z];I[z]!==void 0&&Qo($)&&$.set(I[z])}}mount(t){var i;this.current=t,m_e.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((l,d)=>this.bindToMotionValue(d,l)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(d7.current||p_e(),this.shouldReduceMotion=RM.current),(i=this.parent)==null||i.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var t;this.projection&&this.projection.unmount(),Bf(this.notifyUpdate),Bf(this.render),this.valueSubscriptions.forEach(i=>i()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(t=this.parent)==null||t.removeChild(this);for(const i in this.events)this.events[i].clear();for(const i in this.features){const l=this.features[i];l&&(l.unmount(),l.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,i){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const l=dv.has(t);l&&this.onBindTransform&&this.onBindTransform();const d=i.on("change",v=>{this.latestValues[t]=v,this.props.onUpdate&&bs.preRender(this.notifyUpdate),l&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let m;window.MotionCheckAppearSync&&(m=window.MotionCheckAppearSync(this,t,i)),this.valueSubscriptions.set(t,()=>{d(),m&&m(),i.owner&&i.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in Wy){const i=Wy[t];if(!i)continue;const{isEnabled:l,Feature:d}=i;if(!this.features[t]&&d&&l(this.props)&&(this.features[t]=new d(this)),this.features[t]){const m=this.features[t];m.isMounted?m.update():(m.mount(),m.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ao()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,i){this.latestValues[t]=i}update(t,i){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let l=0;l<g5.length;l++){const d=g5[l];this.propEventSubscriptions[d]&&(this.propEventSubscriptions[d](),delete this.propEventSubscriptions[d]);const m="on"+d,v=t[m];v&&(this.propEventSubscriptions[d]=this.on(d,v))}this.prevMotionValues=g_e(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(t),()=>i.variantChildren.delete(t)}addValue(t,i){const l=this.values.get(t);i!==l&&(l&&this.removeValue(t),this.bindToMotionValue(t,i),this.values.set(t,i),this.latestValues[t]=i.get())}removeValue(t){this.values.delete(t);const i=this.valueSubscriptions.get(t);i&&(i(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,i){if(this.props.values&&this.props.values[t])return this.props.values[t];let l=this.values.get(t);return l===void 0&&i!==void 0&&(l=Hy(i===null?void 0:i,{owner:this}),this.addValue(t,l)),l}readValue(t,i){let l=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return l!=null&&(typeof l=="string"&&(nW(l)||rW(l))?l=parseFloat(l):!Ege(l)&&Vf.test(i)&&(l=BW(t,i)),this.setBaseTarget(t,Qo(l)?l.get():l)),Qo(l)?l.get():l}setBaseTarget(t,i){this.baseTarget[t]=i}getBaseTarget(t){var m;const{initial:i}=this.props;let l;if(typeof i=="string"||typeof i=="object"){const v=qN(this.props,i,(m=this.presenceContext)==null?void 0:m.custom);v&&(l=v[t])}if(i&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,t);return d!==void 0&&!Qo(d)?d:this.initialValues[t]!==void 0&&l===void 0?void 0:this.baseTarget[t]}on(t,i){return this.events[t]||(this.events[t]=new EN),this.events[t].add(i)}notify(t,...i){this.events[t]&&this.events[t].notify(...i)}scheduleRenderMicrotask(){zN.render(this.render)}}class h7 extends __e{constructor(){super(...arguments),this.KeyframeResolver=hge}sortInstanceNodePosition(t,i){return t.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(t,i){return t.style?t.style[i]:void 0}removeValueFromRenderState(t,{vars:i,style:l}){delete i[t],delete l[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Qo(t)&&(this.childSubscription=t.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function f7(e,{style:t,vars:i},l,d){const m=e.style;let v;for(v in t)m[v]=t[v];d==null||d.applyProjectionStyles(m,l);for(v in i)m.setProperty(v,i[v])}function y_e(e){return window.getComputedStyle(e)}class v_e extends h7{constructor(){super(...arguments),this.type="html",this.renderInstance=f7}readValueFromInstance(t,i){var l;if(dv.has(i))return(l=this.projection)!=null&&l.isProjecting?xM(i):Rme(t,i);{const d=y_e(t),m=(yW(i)?d.getPropertyValue(i):d[i])||0;return typeof m=="string"?m.trim():m}}measureInstanceViewportBox(t,{transformPagePoint:i}){return u7(t,i)}build(t,i,l){GN(t,i,l.transformTemplate)}scrapeMotionValuesFromProps(t,i,l){return ZN(t,i,l)}}const p7=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function x_e(e,t,i,l){f7(e,t,void 0,l);for(const d in t.attrs)e.setAttribute(p7.has(d)?d:KN(d),t.attrs[d])}class b_e extends h7{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ao}getBaseTargetFromProps(t,i){return t[i]}readValueFromInstance(t,i){if(dv.has(i)){const l=jW(i);return l&&l.default||0}return i=p7.has(i)?i:KN(i),t.getAttribute(i)}scrapeMotionValuesFromProps(t,i,l){return i7(t,i,l)}build(t,i,l){JW(t,i,this.isSVGTag,l.transformTemplate,l.style)}renderInstance(t,i,l,d){x_e(t,i,l,d)}mount(t){this.isSVGTag=t7(t.tagName),super.mount(t)}}const w_e=(e,t)=>t.isSVG??WN(e)?new b_e(t):new v_e(t,{allowProjection:e!==q.Fragment});function _y(e,t,i){const l=e.getProps();return qN(l,t,i!==void 0?i:l.custom,e)}const MM=e=>Array.isArray(e);function T_e(e,t,i){e.hasValue(t)?e.getValue(t).set(i):e.addValue(t,Hy(i))}function E_e(e){return MM(e)?e[e.length-1]||0:e}function S_e(e,t){const i=_y(e,t);let{transitionEnd:l={},transition:d={},...m}=i||{};m={...m,...l};for(const v in m){const o=E_e(m[v]);T_e(e,v,o)}}function C_e(e){return!!(Qo(e)&&e.add)}function kM(e,t){const i=e.getValue("willChange");if(C_e(i))return i.add(t);if(!i&&eh.WillChange){const l=new eh.WillChange("auto");e.addValue("willChange",l),l.add(t)}}function m7(e){return e.props[r7]}const I_e=e=>e!==null;function A_e(e,{repeat:t,repeatType:i="loop"},l){const d=e.filter(I_e),m=t&&i!=="loop"&&t%2===1?0:d.length-1;return!m||l===void 0?d[m]:l}const P_e={type:"spring",stiffness:500,damping:25,restSpeed:10},R_e=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),M_e={type:"keyframes",duration:.8},k_e={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},D_e=(e,{keyframes:t})=>t.length>2?M_e:dv.has(e)?e.startsWith("scale")?R_e(t[1]):P_e:k_e;function N_e({when:e,delay:t,delayChildren:i,staggerChildren:l,staggerDirection:d,repeat:m,repeatType:v,repeatDelay:o,from:I,elapsed:A,...N}){return!!Object.keys(N).length}const XN=(e,t,i,l={},d,m)=>v=>{const o=ON(l,e)||{},I=o.delay||l.delay||0;let{elapsed:A=0}=l;A=A-Jc(I);const N={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-A,onUpdate:z=>{t.set(z),o.onUpdate&&o.onUpdate(z)},onComplete:()=>{v(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:m?void 0:d};N_e(o)||Object.assign(N,D_e(e,N)),N.duration&&(N.duration=Jc(N.duration)),N.repeatDelay&&(N.repeatDelay=Jc(N.repeatDelay)),N.from!==void 0&&(N.keyframes[0]=N.from);let F=!1;if((N.type===!1||N.duration===0&&!N.repeatDelay)&&(SM(N),N.delay===0&&(F=!0)),(eh.instantAnimations||eh.skipAnimations)&&(F=!0,SM(N),N.delay=0),N.allowFlatten=!o.type&&!o.ease,F&&!m&&t.get()!==void 0){const z=A_e(N.keyframes,o);if(z!==void 0){bs.update(()=>{N.onUpdate(z),N.onComplete()});return}}return o.isSync?new NN(N):new Jme(N)};function L_e({protectedKeys:e,needsAnimating:t},i){const l=e.hasOwnProperty(i)&&t[i]!==!0;return t[i]=!1,l}function g7(e,t,{delay:i=0,transitionOverride:l,type:d}={}){let{transition:m=e.getDefaultTransition(),transitionEnd:v,...o}=t;l&&(m=l);const I=[],A=d&&e.animationState&&e.animationState.getState()[d];for(const N in o){const F=e.getValue(N,e.latestValues[N]??null),z=o[N];if(z===void 0||A&&L_e(A,N))continue;const $={delay:i,...ON(m||{},N)},J=F.get();if(J!==void 0&&!F.isAnimating&&!Array.isArray(z)&&z===J&&!$.velocity)continue;let H=!1;if(window.MotionHandoffAnimation){const Q=m7(e);if(Q){const ee=window.MotionHandoffAnimation(Q,N,bs);ee!==null&&($.startTime=ee,H=!0)}}kM(e,N),F.start(XN(N,F,z,e.shouldReduceMotion&&OW.has(N)?{type:!1}:$,e,H));const re=F.animation;re&&I.push(re)}return v&&Promise.all(I).then(()=>{bs.update(()=>{v&&S_e(e,v)})}),I}function _7(e,t,i,l=0,d=1){const m=Array.from(e).sort((A,N)=>A.sortNodePosition(N)).indexOf(t),v=e.size,o=(v-1)*l;return typeof i=="function"?i(m,v):d===1?m*l:o-m*l}function DM(e,t,i={}){var I;const l=_y(e,t,i.type==="exit"?(I=e.presenceContext)==null?void 0:I.custom:void 0);let{transition:d=e.getDefaultTransition()||{}}=l||{};i.transitionOverride&&(d=i.transitionOverride);const m=l?()=>Promise.all(g7(e,l,i)):()=>Promise.resolve(),v=e.variantChildren&&e.variantChildren.size?(A=0)=>{const{delayChildren:N=0,staggerChildren:F,staggerDirection:z}=d;return O_e(e,t,A,N,F,z,i)}:()=>Promise.resolve(),{when:o}=d;if(o){const[A,N]=o==="beforeChildren"?[m,v]:[v,m];return A().then(()=>N())}else return Promise.all([m(),v(i.delay)])}function O_e(e,t,i=0,l=0,d=0,m=1,v){const o=[];for(const I of e.variantChildren)I.notify("AnimationStart",t),o.push(DM(I,t,{...v,delay:i+(typeof l=="function"?0:l)+_7(e.variantChildren,I,l,d,m)}).then(()=>I.notify("AnimationComplete",t)));return Promise.all(o)}function F_e(e,t,i={}){e.notify("AnimationStart",t);let l;if(Array.isArray(t)){const d=t.map(m=>DM(e,m,i));l=Promise.all(d)}else if(typeof t=="string")l=DM(e,t,i);else{const d=typeof t=="function"?_y(e,t,i.custom):t;l=Promise.all(g7(e,d,i))}return l.then(()=>{e.notify("AnimationComplete",t)})}function y7(e,t){if(!Array.isArray(t))return!1;const i=t.length;if(i!==e.length)return!1;for(let l=0;l<i;l++)if(t[l]!==e[l])return!1;return!0}const z_e=$N.length;function v7(e){if(!e)return;if(!e.isControllingVariants){const i=e.parent?v7(e.parent)||{}:{};return e.props.initial!==void 0&&(i.initial=e.props.initial),i}const t={};for(let i=0;i<z_e;i++){const l=$N[i],d=e.props[l];(V1(d)||d===!1)&&(t[l]=d)}return t}const j_e=[...UN].reverse(),B_e=UN.length;function V_e(e){return t=>Promise.all(t.map(({animation:i,options:l})=>F_e(e,i,l)))}function U_e(e){let t=V_e(e),i=_5(),l=!0;const d=I=>(A,N)=>{var z;const F=_y(e,N,I==="exit"?(z=e.presenceContext)==null?void 0:z.custom:void 0);if(F){const{transition:$,transitionEnd:J,...H}=F;A={...A,...H,...J}}return A};function m(I){t=I(e)}function v(I){const{props:A}=e,N=v7(e.parent)||{},F=[],z=new Set;let $={},J=1/0;for(let re=0;re<B_e;re++){const Q=j_e[re],ee=i[Q],ie=A[Q]!==void 0?A[Q]:N[Q],ue=V1(ie),xe=Q===I?ee.isActive:null;xe===!1&&(J=re);let Oe=ie===N[Q]&&ie!==A[Q]&&ue;if(Oe&&l&&e.manuallyAnimateOnMount&&(Oe=!1),ee.protectedKeys={...$},!ee.isActive&&xe===null||!ie&&!ee.prevProp||ZC(ie)||typeof ie=="boolean")continue;const ze=$_e(ee.prevProp,ie);let Be=ze||Q===I&&ee.isActive&&!Oe&&ue||re>J&&ue,ot=!1;const Et=Array.isArray(ie)?ie:[ie];let Zt=Et.reduce(d(Q),{});xe===!1&&(Zt={});const{prevResolvedValues:at={}}=ee,zt={...at,...Zt},Kt=Ke=>{Be=!0,z.has(Ke)&&(ot=!0,z.delete(Ke)),ee.needsAnimating[Ke]=!0;const et=e.getValue(Ke);et&&(et.liveStyle=!1)};for(const Ke in zt){const et=Zt[Ke],Ct=at[Ke];if($.hasOwnProperty(Ke))continue;let en=!1;MM(et)&&MM(Ct)?en=!y7(et,Ct):en=et!==Ct,en?et!=null?Kt(Ke):z.add(Ke):et!==void 0&&z.has(Ke)?Kt(Ke):ee.protectedKeys[Ke]=!0}ee.prevProp=ie,ee.prevResolvedValues=Zt,ee.isActive&&($={...$,...Zt}),l&&e.blockInitialAnimation&&(Be=!1);const nn=Oe&&ze;Be&&(!nn||ot)&&F.push(...Et.map(Ke=>{const et={type:Q};if(typeof Ke=="string"&&l&&!nn&&e.manuallyAnimateOnMount&&e.parent){const{parent:Ct}=e,en=_y(Ct,Ke);if(Ct.enteringChildren&&en){const{delayChildren:Bn}=en.transition||{};et.delay=_7(Ct.enteringChildren,e,Bn)}}return{animation:Ke,options:et}}))}if(z.size){const re={};if(typeof A.initial!="boolean"){const Q=_y(e,Array.isArray(A.initial)?A.initial[0]:A.initial);Q&&Q.transition&&(re.transition=Q.transition)}z.forEach(Q=>{const ee=e.getBaseTarget(Q),ie=e.getValue(Q);ie&&(ie.liveStyle=!0),re[Q]=ee??null}),F.push({animation:re})}let H=!!F.length;return l&&(A.initial===!1||A.initial===A.animate)&&!e.manuallyAnimateOnMount&&(H=!1),l=!1,H?t(F):Promise.resolve()}function o(I,A){var F;if(i[I].isActive===A)return Promise.resolve();(F=e.variantChildren)==null||F.forEach(z=>{var $;return($=z.animationState)==null?void 0:$.setActive(I,A)}),i[I].isActive=A;const N=v(I);for(const z in i)i[z].protectedKeys={};return N}return{animateChanges:v,setActive:o,setAnimateFunction:m,getState:()=>i,reset:()=>{i=_5()}}}function $_e(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!y7(t,e):!1}function Kp(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function _5(){return{animate:Kp(!0),whileInView:Kp(),whileHover:Kp(),whileTap:Kp(),whileDrag:Kp(),whileFocus:Kp(),exit:Kp()}}let Xf=class{constructor(t){this.isMounted=!1,this.node=t}update(){}};class G_e extends Xf{constructor(t){super(t),t.animationState||(t.animationState=U_e(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();ZC(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:i}=this.node.prevProps||{};t!==i&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)==null||t.call(this)}}let H_e=0;class W_e extends Xf{constructor(){super(...arguments),this.id=H_e++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:i}=this.node.presenceContext,{isPresent:l}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===l)return;const d=this.node.animationState.setActive("exit",!t);i&&!t&&d.then(()=>{i(this.id)})}mount(){const{register:t,onExitComplete:i}=this.node.presenceContext||{};i&&i(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const q_e={animation:{Feature:G_e},exit:{Feature:W_e}};function U1(e,t,i,l={passive:!0}){return e.addEventListener(t,i,l),()=>e.removeEventListener(t,i)}function _b(e){return{point:{x:e.pageX,y:e.pageY}}}const Z_e=e=>t=>jN(t)&&e(t,_b(t));function Y0(e,t,i,l){return U1(e,t,Z_e(i),l)}const x7=1e-4,K_e=1-x7,X_e=1+x7,b7=.01,Y_e=0-b7,Q_e=0+b7;function ga(e){return e.max-e.min}function J_e(e,t,i){return Math.abs(e-t)<=i}function y5(e,t,i,l=.5){e.origin=l,e.originPoint=Ps(t.min,t.max,e.origin),e.scale=ga(i)/ga(t),e.translate=Ps(i.min,i.max,e.origin)-e.originPoint,(e.scale>=K_e&&e.scale<=X_e||isNaN(e.scale))&&(e.scale=1),(e.translate>=Y_e&&e.translate<=Q_e||isNaN(e.translate))&&(e.translate=0)}function Q0(e,t,i,l){y5(e.x,t.x,i.x,l?l.originX:void 0),y5(e.y,t.y,i.y,l?l.originY:void 0)}function v5(e,t,i){e.min=i.min+t.min,e.max=e.min+ga(t)}function eye(e,t,i){v5(e.x,t.x,i.x),v5(e.y,t.y,i.y)}function x5(e,t,i){e.min=t.min-i.min,e.max=e.min+ga(t)}function US(e,t,i){x5(e.x,t.x,i.x),x5(e.y,t.y,i.y)}function Hl(e){return[e("x"),e("y")]}const w7=({current:e})=>e?e.ownerDocument.defaultView:null,b5=(e,t)=>Math.abs(e-t);function tye(e,t){const i=b5(e.x,t.x),l=b5(e.y,t.y);return Math.sqrt(i**2+l**2)}class T7{constructor(t,i,{transformPagePoint:l,contextWindow:d=window,dragSnapToOrigin:m=!1,distanceThreshold:v=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const z=vP(this.lastMoveEventInfo,this.history),$=this.startEvent!==null,J=tye(z.offset,{x:0,y:0})>=this.distanceThreshold;if(!$&&!J)return;const{point:H}=z,{timestamp:re}=Fo;this.history.push({...H,timestamp:re});const{onStart:Q,onMove:ee}=this.handlers;$||(Q&&Q(this.lastMoveEvent,z),this.startEvent=this.lastMoveEvent),ee&&ee(this.lastMoveEvent,z)},this.handlePointerMove=(z,$)=>{this.lastMoveEvent=z,this.lastMoveEventInfo=yP($,this.transformPagePoint),bs.update(this.updatePoint,!0)},this.handlePointerUp=(z,$)=>{this.end();const{onEnd:J,onSessionEnd:H,resumeAnimation:re}=this.handlers;if(this.dragSnapToOrigin&&re&&re(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Q=vP(z.type==="pointercancel"?this.lastMoveEventInfo:yP($,this.transformPagePoint),this.history);this.startEvent&&J&&J(z,Q),H&&H(z,Q)},!jN(t))return;this.dragSnapToOrigin=m,this.handlers=i,this.transformPagePoint=l,this.distanceThreshold=v,this.contextWindow=d||window;const o=_b(t),I=yP(o,this.transformPagePoint),{point:A}=I,{timestamp:N}=Fo;this.history=[{...A,timestamp:N}];const{onSessionStart:F}=i;F&&F(t,vP(I,this.history)),this.removeListeners=pb(Y0(this.contextWindow,"pointermove",this.handlePointerMove),Y0(this.contextWindow,"pointerup",this.handlePointerUp),Y0(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Bf(this.updatePoint)}}function yP(e,t){return t?{point:t(e.point)}:e}function w5(e,t){return{x:e.x-t.x,y:e.y-t.y}}function vP({point:e},t){return{point:e,delta:w5(e,E7(t)),offset:w5(e,nye(t)),velocity:iye(t,.1)}}function nye(e){return e[0]}function E7(e){return e[e.length-1]}function iye(e,t){if(e.length<2)return{x:0,y:0};let i=e.length-1,l=null;const d=E7(e);for(;i>=0&&(l=e[i],!(d.timestamp-l.timestamp>Jc(t)));)i--;if(!l)return{x:0,y:0};const m=Ql(d.timestamp-l.timestamp);if(m===0)return{x:0,y:0};const v={x:(d.x-l.x)/m,y:(d.y-l.y)/m};return v.x===1/0&&(v.x=0),v.y===1/0&&(v.y=0),v}function rye(e,{min:t,max:i},l){return t!==void 0&&e<t?e=l?Ps(t,e,l.min):Math.max(e,t):i!==void 0&&e>i&&(e=l?Ps(i,e,l.max):Math.min(e,i)),e}function T5(e,t,i){return{min:t!==void 0?e.min+t:void 0,max:i!==void 0?e.max+i-(e.max-e.min):void 0}}function sye(e,{top:t,left:i,bottom:l,right:d}){return{x:T5(e.x,i,d),y:T5(e.y,t,l)}}function E5(e,t){let i=t.min-e.min,l=t.max-e.max;return t.max-t.min<e.max-e.min&&([i,l]=[l,i]),{min:i,max:l}}function oye(e,t){return{x:E5(e.x,t.x),y:E5(e.y,t.y)}}function aye(e,t){let i=.5;const l=ga(e),d=ga(t);return d>l?i=z1(t.min,t.max-l,e.min):l>d&&(i=z1(e.min,e.max-d,t.min)),Jd(0,1,i)}function lye(e,t){const i={};return t.min!==void 0&&(i.min=t.min-e.min),t.max!==void 0&&(i.max=t.max-e.min),i}const NM=.35;function cye(e=NM){return e===!1?e=0:e===!0&&(e=NM),{x:S5(e,"left","right"),y:S5(e,"top","bottom")}}function S5(e,t,i){return{min:C5(e,t),max:C5(e,i)}}function C5(e,t){return typeof e=="number"?e:e[t]||0}const uye=new WeakMap;class dye{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ao(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:i=!1,distanceThreshold:l}={}){const{presenceContext:d}=this.visualElement;if(d&&d.isPresent===!1)return;const m=F=>{const{dragSnapToOrigin:z}=this.getProps();z?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(_b(F).point)},v=(F,z)=>{const{drag:$,dragPropagation:J,onDragStart:H}=this.getProps();if($&&!J&&(this.openDragLock&&this.openDragLock(),this.openDragLock=gge($),!this.openDragLock))return;this.latestPointerEvent=F,this.latestPanInfo=z,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Hl(Q=>{let ee=this.getAxisMotionValue(Q).get()||0;if(qu.test(ee)){const{projection:ie}=this.visualElement;if(ie&&ie.layout){const ue=ie.layout.layoutBox[Q];ue&&(ee=ga(ue)*(parseFloat(ee)/100))}}this.originPoint[Q]=ee}),H&&bs.postRender(()=>H(F,z)),kM(this.visualElement,"transform");const{animationState:re}=this.visualElement;re&&re.setActive("whileDrag",!0)},o=(F,z)=>{this.latestPointerEvent=F,this.latestPanInfo=z;const{dragPropagation:$,dragDirectionLock:J,onDirectionLock:H,onDrag:re}=this.getProps();if(!$&&!this.openDragLock)return;const{offset:Q}=z;if(J&&this.currentDirection===null){this.currentDirection=hye(Q),this.currentDirection!==null&&H&&H(this.currentDirection);return}this.updateAxis("x",z.point,Q),this.updateAxis("y",z.point,Q),this.visualElement.render(),re&&re(F,z)},I=(F,z)=>{this.latestPointerEvent=F,this.latestPanInfo=z,this.stop(F,z),this.latestPointerEvent=null,this.latestPanInfo=null},A=()=>Hl(F=>{var z;return this.getAnimationState(F)==="paused"&&((z=this.getAxisMotionValue(F).animation)==null?void 0:z.play())}),{dragSnapToOrigin:N}=this.getProps();this.panSession=new T7(t,{onSessionStart:m,onStart:v,onMove:o,onSessionEnd:I,resumeAnimation:A},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:N,distanceThreshold:l,contextWindow:w7(this.visualElement)})}stop(t,i){const l=t||this.latestPointerEvent,d=i||this.latestPanInfo,m=this.isDragging;if(this.cancel(),!m||!d||!l)return;const{velocity:v}=d;this.startAnimation(v);const{onDragEnd:o}=this.getProps();o&&bs.postRender(()=>o(l,d))}cancel(){this.isDragging=!1;const{projection:t,animationState:i}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:l}=this.getProps();!l&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(t,i,l){const{drag:d}=this.getProps();if(!l||!XT(t,d,this.currentDirection))return;const m=this.getAxisMotionValue(t);let v=this.originPoint[t]+l[t];this.constraints&&this.constraints[t]&&(v=rye(v,this.constraints[t],this.elastic[t])),m.set(v)}resolveConstraints(){var m;const{dragConstraints:t,dragElastic:i}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(m=this.visualElement.projection)==null?void 0:m.layout,d=this.constraints;t&&Y_(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&l?this.constraints=sye(l.layoutBox,t):this.constraints=!1,this.elastic=cye(i),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Hl(v=>{this.constraints!==!1&&this.getAxisMotionValue(v)&&(this.constraints[v]=lye(l.layoutBox[v],this.constraints[v]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:i}=this.getProps();if(!t||!Y_(t))return!1;const l=t.current;Gy(l!==null,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.","drag-constraints-ref");const{projection:d}=this.visualElement;if(!d||!d.layout)return!1;const m=f_e(l,d.root,this.visualElement.getTransformPagePoint());let v=oye(d.layout.layoutBox,m);if(i){const o=i(u_e(v));this.hasMutatedConstraints=!!o,o&&(v=a7(o))}return v}startAnimation(t){const{drag:i,dragMomentum:l,dragElastic:d,dragTransition:m,dragSnapToOrigin:v,onDragTransitionEnd:o}=this.getProps(),I=this.constraints||{},A=Hl(N=>{if(!XT(N,i,this.currentDirection))return;let F=I&&I[N]||{};v&&(F={min:0,max:0});const z=d?200:1e6,$=d?40:1e7,J={type:"inertia",velocity:l?t[N]:0,bounceStiffness:z,bounceDamping:$,timeConstant:750,restDelta:1,restSpeed:10,...m,...F};return this.startAxisValueAnimation(N,J)});return Promise.all(A).then(o)}startAxisValueAnimation(t,i){const l=this.getAxisMotionValue(t);return kM(this.visualElement,t),l.start(XN(t,l,0,i,this.visualElement,!1))}stopAnimation(){Hl(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Hl(t=>{var i;return(i=this.getAxisMotionValue(t).animation)==null?void 0:i.pause()})}getAnimationState(t){var i;return(i=this.getAxisMotionValue(t).animation)==null?void 0:i.state}getAxisMotionValue(t){const i=`_drag${t.toUpperCase()}`,l=this.visualElement.getProps(),d=l[i];return d||this.visualElement.getValue(t,(l.initial?l.initial[t]:void 0)||0)}snapToCursor(t){Hl(i=>{const{drag:l}=this.getProps();if(!XT(i,l,this.currentDirection))return;const{projection:d}=this.visualElement,m=this.getAxisMotionValue(i);if(d&&d.layout){const{min:v,max:o}=d.layout.layoutBox[i],I=m.get()||0;m.set(t[i]-Ps(v,o,.5)+I)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:i}=this.getProps(),{projection:l}=this.visualElement;if(!Y_(i)||!l||!this.constraints)return;this.stopAnimation();const d={x:0,y:0};Hl(v=>{const o=this.getAxisMotionValue(v);if(o&&this.constraints!==!1){const I=o.get();d[v]=aye({min:I,max:I},this.constraints[v])}});const{transformTemplate:m}=this.visualElement.getProps();this.visualElement.current.style.transform=m?m({},""):"none",l.root&&l.root.updateScroll(),l.updateLayout(),this.resolveConstraints(),Hl(v=>{if(!XT(v,t,null))return;const o=this.getAxisMotionValue(v),{min:I,max:A}=this.constraints[v];o.set(Ps(I,A,d[v]))})}addListeners(){if(!this.visualElement.current)return;uye.set(this.visualElement,this);const t=this.visualElement.current,i=Y0(t,"pointerdown",I=>{const{drag:A,dragListener:N=!0}=this.getProps();A&&N&&this.start(I)}),l=()=>{const{dragConstraints:I}=this.getProps();Y_(I)&&I.current&&(this.constraints=this.resolveRefConstraints())},{projection:d}=this.visualElement,m=d.addEventListener("measure",l);d&&!d.layout&&(d.root&&d.root.updateScroll(),d.updateLayout()),bs.read(l);const v=U1(window,"resize",()=>this.scalePositionWithinConstraints()),o=d.addEventListener("didUpdate",({delta:I,hasLayoutChanged:A})=>{this.isDragging&&A&&(Hl(N=>{const F=this.getAxisMotionValue(N);F&&(this.originPoint[N]+=I[N].translate,F.set(F.get()+I[N].translate))}),this.visualElement.render())});return()=>{v(),i(),m(),o&&o()}}getProps(){const t=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:l=!1,dragPropagation:d=!1,dragConstraints:m=!1,dragElastic:v=NM,dragMomentum:o=!0}=t;return{...t,drag:i,dragDirectionLock:l,dragPropagation:d,dragConstraints:m,dragElastic:v,dragMomentum:o}}}function XT(e,t,i){return(t===!0||t===e)&&(i===null||i===e)}function hye(e,t=10){let i=null;return Math.abs(e.y)>t?i="y":Math.abs(e.x)>t&&(i="x"),i}class fye extends Xf{constructor(t){super(t),this.removeGroupControls=ec,this.removeListeners=ec,this.controls=new dye(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ec}update(){const{dragControls:t}=this.node.getProps(),{dragControls:i}=this.node.prevProps||{};t!==i&&(this.removeGroupControls(),t&&(this.removeGroupControls=t.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners()}}const I5=e=>(t,i)=>{e&&bs.postRender(()=>e(t,i))};class pye extends Xf{constructor(){super(...arguments),this.removePointerDownListener=ec}onPointerDown(t){this.session=new T7(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:w7(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:i,onPan:l,onPanEnd:d}=this.node.getProps();return{onSessionStart:I5(t),onStart:I5(i),onMove:l,onEnd:(m,v)=>{delete this.session,d&&bs.postRender(()=>d(m,v))}}}mount(){this.removePointerDownListener=Y0(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const IE={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let xP=!1;class mye extends q.Component{componentDidMount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:l,layoutId:d}=this.props,{projection:m}=t;m&&(i.group&&i.group.add(m),l&&l.register&&d&&l.register(m),xP&&m.root.didUpdate(),m.addEventListener("animationComplete",()=>{this.safeToRemove()}),m.setOptions({...m.options,onExitComplete:()=>this.safeToRemove()})),IE.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:i,visualElement:l,drag:d,isPresent:m}=this.props,{projection:v}=l;return v&&(v.isPresent=m,xP=!0,d||t.layoutDependency!==i||i===void 0||t.isPresent!==m?v.willUpdate():this.safeToRemove(),t.isPresent!==m&&(m?v.promote():v.relegate()||bs.postRender(()=>{const o=v.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),zN.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:l}=this.props,{projection:d}=t;xP=!0,d&&(d.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(d),l&&l.deregister&&l.deregister(d))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function S7(e){const[t,i]=qW(),l=q.useContext(yN);return E.jsx(mye,{...e,layoutGroup:l,switchLayoutGroup:q.useContext(s7),isPresent:t,safeToRemove:i})}function gye(e,t,i){const l=Qo(e)?e:Hy(e);return l.start(XN("",l,t,i)),l.animation}const _ye=(e,t)=>e.depth-t.depth;class yye{constructor(){this.children=[],this.isDirty=!1}add(t){bN(this.children,t),this.isDirty=!0}remove(t){wN(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(_ye),this.isDirty=!1,this.children.forEach(t)}}function vye(e,t){const i=Za.now(),l=({timestamp:d})=>{const m=d-i;m>=t&&(Bf(l),e(m-t))};return bs.setup(l,!0),()=>Bf(l)}const C7=["TopLeft","TopRight","BottomLeft","BottomRight"],xye=C7.length,A5=e=>typeof e=="string"?parseFloat(e):e,P5=e=>typeof e=="number"||Vn.test(e);function bye(e,t,i,l,d,m){d?(e.opacity=Ps(0,i.opacity??1,wye(l)),e.opacityExit=Ps(t.opacity??1,0,Tye(l))):m&&(e.opacity=Ps(t.opacity??1,i.opacity??1,l));for(let v=0;v<xye;v++){const o=`border${C7[v]}Radius`;let I=R5(t,o),A=R5(i,o);if(I===void 0&&A===void 0)continue;I||(I=0),A||(A=0),I===0||A===0||P5(I)===P5(A)?(e[o]=Math.max(Ps(A5(I),A5(A),l),0),(qu.test(A)||qu.test(I))&&(e[o]+="%")):e[o]=A}(t.rotate||i.rotate)&&(e.rotate=Ps(t.rotate||0,i.rotate||0,l))}function R5(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const wye=I7(0,.5,hW),Tye=I7(.5,.95,ec);function I7(e,t,i){return l=>l<e?0:l>t?1:i(z1(e,t,l))}function M5(e,t){e.min=t.min,e.max=t.max}function Dc(e,t){M5(e.x,t.x),M5(e.y,t.y)}function k5(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function D5(e,t,i,l,d){return e-=t,e=VS(e,1/i,l),d!==void 0&&(e=VS(e,1/d,l)),e}function Eye(e,t=0,i=1,l=.5,d,m=e,v=e){if(qu.test(t)&&(t=parseFloat(t),t=Ps(v.min,v.max,t/100)-v.min),typeof t!="number")return;let o=Ps(m.min,m.max,l);e===m&&(o-=t),e.min=D5(e.min,t,i,o,d),e.max=D5(e.max,t,i,o,d)}function N5(e,t,[i,l,d],m,v){Eye(e,t[i],t[l],t[d],t.scale,m,v)}const Sye=["x","scaleX","originX"],Cye=["y","scaleY","originY"];function L5(e,t,i,l){N5(e.x,t,Sye,i?i.x:void 0,l?l.x:void 0),N5(e.y,t,Cye,i?i.y:void 0,l?l.y:void 0)}function O5(e){return e.translate===0&&e.scale===1}function A7(e){return O5(e.x)&&O5(e.y)}function F5(e,t){return e.min===t.min&&e.max===t.max}function Iye(e,t){return F5(e.x,t.x)&&F5(e.y,t.y)}function z5(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function P7(e,t){return z5(e.x,t.x)&&z5(e.y,t.y)}function j5(e){return ga(e.x)/ga(e.y)}function B5(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class Aye{constructor(){this.members=[]}add(t){bN(this.members,t),t.scheduleRender()}remove(t){if(wN(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(t){const i=this.members.findIndex(d=>t===d);if(i===0)return!1;let l;for(let d=i;d>=0;d--){const m=this.members[d];if(m.isPresent!==!1){l=m;break}}return l?(this.promote(l),!0):!1}promote(t,i){const l=this.lead;if(t!==l&&(this.prevLead=l,this.lead=t,t.show(),l)){l.instance&&l.scheduleRender(),t.scheduleRender(),t.resumeFrom=l,i&&(t.resumeFrom.preserveOpacity=!0),l.snapshot&&(t.snapshot=l.snapshot,t.snapshot.latestValues=l.animationValues||l.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:d}=t.options;d===!1&&l.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:i,resumingFrom:l}=t;i.onExitComplete&&i.onExitComplete(),l&&l.options.onExitComplete&&l.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Pye(e,t,i){let l="";const d=e.x.translate/t.x,m=e.y.translate/t.y,v=(i==null?void 0:i.z)||0;if((d||m||v)&&(l=`translate3d(${d}px, ${m}px, ${v}px) `),(t.x!==1||t.y!==1)&&(l+=`scale(${1/t.x}, ${1/t.y}) `),i){const{transformPerspective:A,rotate:N,rotateX:F,rotateY:z,skewX:$,skewY:J}=i;A&&(l=`perspective(${A}px) ${l}`),N&&(l+=`rotate(${N}deg) `),F&&(l+=`rotateX(${F}deg) `),z&&(l+=`rotateY(${z}deg) `),$&&(l+=`skewX(${$}deg) `),J&&(l+=`skewY(${J}deg) `)}const o=e.x.scale*t.x,I=e.y.scale*t.y;return(o!==1||I!==1)&&(l+=`scale(${o}, ${I})`),l||"none"}const bP=["","X","Y","Z"],Rye=1e3;let Mye=0;function wP(e,t,i,l){const{latestValues:d}=t;d[e]&&(i[e]=d[e],t.setStaticValue(e,0),l&&(l[e]=0))}function R7(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const i=m7(t);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:d,layoutId:m}=e.options;window.MotionCancelOptimisedAnimation(i,"transform",bs,!(d||m))}const{parent:l}=e;l&&!l.hasCheckedOptimisedAppear&&R7(l)}function M7({attachResizeListener:e,defaultParent:t,measureScroll:i,checkIsScrollRoot:l,resetTransform:d}){return class{constructor(v={},o=t==null?void 0:t()){this.id=Mye++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Nye),this.nodes.forEach(zye),this.nodes.forEach(jye),this.nodes.forEach(Lye)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=v,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let I=0;I<this.path.length;I++)this.path[I].shouldResetTransform=!0;this.root===this&&(this.nodes=new yye)}addEventListener(v,o){return this.eventHandlers.has(v)||this.eventHandlers.set(v,new EN),this.eventHandlers.get(v).add(o)}notifyListeners(v,...o){const I=this.eventHandlers.get(v);I&&I.notify(...o)}hasListeners(v){return this.eventHandlers.has(v)}mount(v){if(this.instance)return;this.isSVG=WW(v)&&!wge(v),this.instance=v;const{layoutId:o,layout:I,visualElement:A}=this.options;if(A&&!A.current&&A.mount(v),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(I||o)&&(this.isLayoutDirty=!0),e){let N,F=0;const z=()=>this.root.updateBlockedByResize=!1;bs.read(()=>{F=window.innerWidth}),e(v,()=>{const $=window.innerWidth;$!==F&&(F=$,this.root.updateBlockedByResize=!0,N&&N(),N=vye(z,250),IE.hasAnimatedSinceResize&&(IE.hasAnimatedSinceResize=!1,this.nodes.forEach($5)))})}o&&this.root.registerSharedNode(o,this),this.options.animate!==!1&&A&&(o||I)&&this.addEventListener("didUpdate",({delta:N,hasLayoutChanged:F,hasRelativeLayoutChanged:z,layout:$})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const J=this.options.transition||A.getDefaultTransition()||Gye,{onLayoutAnimationStart:H,onLayoutAnimationComplete:re}=A.getProps(),Q=!this.targetLayout||!P7(this.targetLayout,$),ee=!F&&z;if(this.options.layoutRoot||this.resumeFrom||ee||F&&(Q||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const ie={...ON(J,"layout"),onPlay:H,onComplete:re};(A.shouldReduceMotion||this.options.layoutRoot)&&(ie.delay=0,ie.type=!1),this.startAnimation(ie),this.setAnimationOrigin(N,ee)}else F||$5(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=$})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const v=this.getStack();v&&v.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Bf(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Bye),this.animationId++)}getTransformTemplate(){const{visualElement:v}=this.options;return v&&v.getProps().transformTemplate}willUpdate(v=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&R7(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let N=0;N<this.path.length;N++){const F=this.path[N];F.shouldResetTransform=!0,F.updateScroll("snapshot"),F.options.layoutRoot&&F.willUpdate(!1)}const{layoutId:o,layout:I}=this.options;if(o===void 0&&!I)return;const A=this.getTransformTemplate();this.prevTransformTemplateValue=A?A(this.latestValues,""):void 0,this.updateSnapshot(),v&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(V5);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(U5);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(Fye),this.nodes.forEach(kye),this.nodes.forEach(Dye)):this.nodes.forEach(U5),this.clearAllSnapshots();const o=Za.now();Fo.delta=Jd(0,1e3/60,o-Fo.timestamp),Fo.timestamp=o,Fo.isProcessing=!0,uP.update.process(Fo),uP.preRender.process(Fo),uP.render.process(Fo),Fo.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,zN.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Oye),this.sharedNodes.forEach(Vye)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,bs.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){bs.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ga(this.snapshot.measuredBox.x)&&!ga(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let I=0;I<this.path.length;I++)this.path[I].updateScroll();const v=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=ao(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,v?v.layoutBox:void 0)}updateScroll(v="measure"){let o=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===v&&(o=!1),o&&this.instance){const I=l(this.instance);this.scroll={animationId:this.root.animationId,phase:v,isRoot:I,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:I}}}resetTransform(){if(!d)return;const v=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,o=this.projectionDelta&&!A7(this.projectionDelta),I=this.getTransformTemplate(),A=I?I(this.latestValues,""):void 0,N=A!==this.prevTransformTemplateValue;v&&this.instance&&(o||em(this.latestValues)||N)&&(d(this.instance,A),this.shouldResetTransform=!1,this.scheduleRender())}measure(v=!0){const o=this.measurePageBox();let I=this.removeElementScroll(o);return v&&(I=this.removeTransform(I)),Hye(I),{animationId:this.root.animationId,measuredBox:o,layoutBox:I,latestValues:{},source:this.id}}measurePageBox(){var A;const{visualElement:v}=this.options;if(!v)return ao();const o=v.measureViewportBox();if(!(((A=this.scroll)==null?void 0:A.wasRoot)||this.path.some(Wye))){const{scroll:N}=this.root;N&&(Q_(o.x,N.offset.x),Q_(o.y,N.offset.y))}return o}removeElementScroll(v){var I;const o=ao();if(Dc(o,v),(I=this.scroll)!=null&&I.wasRoot)return o;for(let A=0;A<this.path.length;A++){const N=this.path[A],{scroll:F,options:z}=N;N!==this.root&&F&&z.layoutScroll&&(F.wasRoot&&Dc(o,v),Q_(o.x,F.offset.x),Q_(o.y,F.offset.y))}return o}applyTransform(v,o=!1){const I=ao();Dc(I,v);for(let A=0;A<this.path.length;A++){const N=this.path[A];!o&&N.options.layoutScroll&&N.scroll&&N!==N.root&&J_(I,{x:-N.scroll.offset.x,y:-N.scroll.offset.y}),em(N.latestValues)&&J_(I,N.latestValues)}return em(this.latestValues)&&J_(I,this.latestValues),I}removeTransform(v){const o=ao();Dc(o,v);for(let I=0;I<this.path.length;I++){const A=this.path[I];if(!A.instance||!em(A.latestValues))continue;AM(A.latestValues)&&A.updateSnapshot();const N=ao(),F=A.measurePageBox();Dc(N,F),L5(o,A.latestValues,A.snapshot?A.snapshot.layoutBox:void 0,N)}return em(this.latestValues)&&L5(o,this.latestValues),o}setTargetDelta(v){this.targetDelta=v,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(v){this.options={...this.options,...v,crossfade:v.crossfade!==void 0?v.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Fo.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(v=!1){var $;const o=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=o.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=o.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=o.isSharedProjectionDirty);const I=!!this.resumingFrom||this!==o;if(!(v||I&&this.isSharedProjectionDirty||this.isProjectionDirty||($=this.parent)!=null&&$.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:N,layoutId:F}=this.options;if(!this.layout||!(N||F))return;this.resolvedRelativeTargetAt=Fo.timestamp;const z=this.getClosestProjectingParent();z&&this.linkedParentVersion!==z.layoutVersion&&!z.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(z&&z.layout?this.createRelativeTarget(z,this.layout.layoutBox,z.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ao(),this.targetWithTransforms=ao()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),eye(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Dc(this.target,this.layout.layoutBox),c7(this.target,this.targetDelta)):Dc(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,z&&!!z.resumingFrom==!!this.resumingFrom&&!z.options.layoutScroll&&z.target&&this.animationProgress!==1?this.createRelativeTarget(z,this.target,z.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||AM(this.parent.latestValues)||l7(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(v,o,I){this.relativeParent=v,this.linkedParentVersion=v.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ao(),this.relativeTargetOrigin=ao(),US(this.relativeTargetOrigin,o,I),Dc(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var J;const v=this.getLead(),o=!!this.resumingFrom||this!==v;let I=!0;if((this.isProjectionDirty||(J=this.parent)!=null&&J.isProjectionDirty)&&(I=!1),o&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(I=!1),this.resolvedRelativeTargetAt===Fo.timestamp&&(I=!1),I)return;const{layout:A,layoutId:N}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(A||N))return;Dc(this.layoutCorrected,this.layout.layoutBox);const F=this.treeScale.x,z=this.treeScale.y;h_e(this.layoutCorrected,this.treeScale,this.path,o),v.layout&&!v.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(v.target=v.layout.layoutBox,v.targetWithTransforms=ao());const{target:$}=v;if(!$){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(k5(this.prevProjectionDelta.x,this.projectionDelta.x),k5(this.prevProjectionDelta.y,this.projectionDelta.y)),Q0(this.projectionDelta,this.layoutCorrected,$,this.latestValues),(this.treeScale.x!==F||this.treeScale.y!==z||!B5(this.projectionDelta.x,this.prevProjectionDelta.x)||!B5(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",$))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(v=!0){var o;if((o=this.options.visualElement)==null||o.scheduleRender(),v){const I=this.getStack();I&&I.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=ey(),this.projectionDelta=ey(),this.projectionDeltaWithTransform=ey()}setAnimationOrigin(v,o=!1){const I=this.snapshot,A=I?I.latestValues:{},N={...this.latestValues},F=ey();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const z=ao(),$=I?I.source:void 0,J=this.layout?this.layout.source:void 0,H=$!==J,re=this.getStack(),Q=!re||re.members.length<=1,ee=!!(H&&!Q&&this.options.crossfade===!0&&!this.path.some($ye));this.animationProgress=0;let ie;this.mixTargetDelta=ue=>{const xe=ue/1e3;G5(F.x,v.x,xe),G5(F.y,v.y,xe),this.setTargetDelta(F),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(US(z,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Uye(this.relativeTarget,this.relativeTargetOrigin,z,xe),ie&&Iye(this.relativeTarget,ie)&&(this.isProjectionDirty=!1),ie||(ie=ao()),Dc(ie,this.relativeTarget)),H&&(this.animationValues=N,bye(N,A,this.latestValues,xe,ee,Q)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=xe},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(v){var o,I,A;this.notifyListeners("animationStart"),(o=this.currentAnimation)==null||o.stop(),(A=(I=this.resumingFrom)==null?void 0:I.currentAnimation)==null||A.stop(),this.pendingAnimation&&(Bf(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=bs.update(()=>{IE.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Hy(0)),this.currentAnimation=gye(this.motionValue,[0,1e3],{...v,velocity:0,isSync:!0,onUpdate:N=>{this.mixTargetDelta(N),v.onUpdate&&v.onUpdate(N)},onStop:()=>{},onComplete:()=>{v.onComplete&&v.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const v=this.getStack();v&&v.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Rye),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const v=this.getLead();let{targetWithTransforms:o,target:I,layout:A,latestValues:N}=v;if(!(!o||!I||!A)){if(this!==v&&this.layout&&A&&k7(this.options.animationType,this.layout.layoutBox,A.layoutBox)){I=this.target||ao();const F=ga(this.layout.layoutBox.x);I.x.min=v.target.x.min,I.x.max=I.x.min+F;const z=ga(this.layout.layoutBox.y);I.y.min=v.target.y.min,I.y.max=I.y.min+z}Dc(o,I),J_(o,N),Q0(this.projectionDeltaWithTransform,this.layoutCorrected,o,N)}}registerSharedNode(v,o){this.sharedNodes.has(v)||this.sharedNodes.set(v,new Aye),this.sharedNodes.get(v).add(o);const A=o.options.initialPromotionConfig;o.promote({transition:A?A.transition:void 0,preserveFollowOpacity:A&&A.shouldPreserveFollowOpacity?A.shouldPreserveFollowOpacity(o):void 0})}isLead(){const v=this.getStack();return v?v.lead===this:!0}getLead(){var o;const{layoutId:v}=this.options;return v?((o=this.getStack())==null?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:v}=this.options;return v?(o=this.getStack())==null?void 0:o.prevLead:void 0}getStack(){const{layoutId:v}=this.options;if(v)return this.root.sharedNodes.get(v)}promote({needsReset:v,transition:o,preserveFollowOpacity:I}={}){const A=this.getStack();A&&A.promote(this,I),v&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const v=this.getStack();return v?v.relegate(this):!1}resetSkewAndRotation(){const{visualElement:v}=this.options;if(!v)return;let o=!1;const{latestValues:I}=v;if((I.z||I.rotate||I.rotateX||I.rotateY||I.rotateZ||I.skewX||I.skewY)&&(o=!0),!o)return;const A={};I.z&&wP("z",v,A,this.animationValues);for(let N=0;N<bP.length;N++)wP(`rotate${bP[N]}`,v,A,this.animationValues),wP(`skew${bP[N]}`,v,A,this.animationValues);v.render();for(const N in A)v.setStaticValue(N,A[N]),this.animationValues&&(this.animationValues[N]=A[N]);v.scheduleRender()}applyProjectionStyles(v,o){if(!this.instance||this.isSVG)return;if(!this.isVisible){v.visibility="hidden";return}const I=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,v.visibility="",v.opacity="",v.pointerEvents=CE(o==null?void 0:o.pointerEvents)||"",v.transform=I?I(this.latestValues,""):"none";return}const A=this.getLead();if(!this.projectionDelta||!this.layout||!A.target){this.options.layoutId&&(v.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,v.pointerEvents=CE(o==null?void 0:o.pointerEvents)||""),this.hasProjected&&!em(this.latestValues)&&(v.transform=I?I({},""):"none",this.hasProjected=!1);return}v.visibility="";const N=A.animationValues||A.latestValues;this.applyTransformsToTarget();let F=Pye(this.projectionDeltaWithTransform,this.treeScale,N);I&&(F=I(N,F)),v.transform=F;const{x:z,y:$}=this.projectionDelta;v.transformOrigin=`${z.origin*100}% ${$.origin*100}% 0`,A.animationValues?v.opacity=A===this?N.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:N.opacityExit:v.opacity=A===this?N.opacity!==void 0?N.opacity:"":N.opacityExit!==void 0?N.opacityExit:0;for(const J in IM){if(N[J]===void 0)continue;const{correct:H,applyTo:re,isCSSVariable:Q}=IM[J],ee=F==="none"?N[J]:H(N[J],A);if(re){const ie=re.length;for(let ue=0;ue<ie;ue++)v[re[ue]]=ee}else Q?this.options.visualElement.renderState.vars[J]=ee:v[J]=ee}this.options.layoutId&&(v.pointerEvents=A===this?CE(o==null?void 0:o.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(v=>{var o;return(o=v.currentAnimation)==null?void 0:o.stop()}),this.root.nodes.forEach(V5),this.root.sharedNodes.clear()}}}function kye(e){e.updateLayout()}function Dye(e){var i;const t=((i=e.resumeFrom)==null?void 0:i.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:l,measuredBox:d}=e.layout,{animationType:m}=e.options,v=t.source!==e.layout.source;m==="size"?Hl(F=>{const z=v?t.measuredBox[F]:t.layoutBox[F],$=ga(z);z.min=l[F].min,z.max=z.min+$}):k7(m,t.layoutBox,l)&&Hl(F=>{const z=v?t.measuredBox[F]:t.layoutBox[F],$=ga(l[F]);z.max=z.min+$,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[F].max=e.relativeTarget[F].min+$)});const o=ey();Q0(o,l,t.layoutBox);const I=ey();v?Q0(I,e.applyTransform(d,!0),t.measuredBox):Q0(I,l,t.layoutBox);const A=!A7(o);let N=!1;if(!e.resumeFrom){const F=e.getClosestProjectingParent();if(F&&!F.resumeFrom){const{snapshot:z,layout:$}=F;if(z&&$){const J=ao();US(J,t.layoutBox,z.layoutBox);const H=ao();US(H,l,$.layoutBox),P7(J,H)||(N=!0),F.options.layoutRoot&&(e.relativeTarget=H,e.relativeTargetOrigin=J,e.relativeParent=F)}}}e.notifyListeners("didUpdate",{layout:l,snapshot:t,delta:I,layoutDelta:o,hasLayoutChanged:A,hasRelativeLayoutChanged:N})}else if(e.isLead()){const{onExitComplete:l}=e.options;l&&l()}e.options.transition=void 0}function Nye(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Lye(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Oye(e){e.clearSnapshot()}function V5(e){e.clearMeasurements()}function U5(e){e.isLayoutDirty=!1}function Fye(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function $5(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function zye(e){e.resolveTargetDelta()}function jye(e){e.calcProjection()}function Bye(e){e.resetSkewAndRotation()}function Vye(e){e.removeLeadSnapshot()}function G5(e,t,i){e.translate=Ps(t.translate,0,i),e.scale=Ps(t.scale,1,i),e.origin=t.origin,e.originPoint=t.originPoint}function H5(e,t,i,l){e.min=Ps(t.min,i.min,l),e.max=Ps(t.max,i.max,l)}function Uye(e,t,i,l){H5(e.x,t.x,i.x,l),H5(e.y,t.y,i.y,l)}function $ye(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Gye={duration:.45,ease:[.4,0,.1,1]},W5=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),q5=W5("applewebkit/")&&!W5("chrome/")?Math.round:ec;function Z5(e){e.min=q5(e.min),e.max=q5(e.max)}function Hye(e){Z5(e.x),Z5(e.y)}function k7(e,t,i){return e==="position"||e==="preserve-aspect"&&!J_e(j5(t),j5(i),.2)}function Wye(e){var t;return e!==e.root&&((t=e.scroll)==null?void 0:t.wasRoot)}const qye=M7({attachResizeListener:(e,t)=>U1(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),TP={current:void 0},D7=M7({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!TP.current){const e=new qye({});e.mount(window),e.setOptions({layoutScroll:!0}),TP.current=e}return TP.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Zye={pan:{Feature:pye},drag:{Feature:fye,ProjectionNode:D7,MeasureLayout:S7}};function K5(e,t,i){const{props:l}=e;e.animationState&&l.whileHover&&e.animationState.setActive("whileHover",i==="Start");const d="onHover"+i,m=l[d];m&&bs.postRender(()=>m(t,_b(t)))}class Kye extends Xf{mount(){const{current:t}=this.node;t&&(this.unmount=_ge(t,(i,l)=>(K5(this.node,l,"Start"),d=>K5(this.node,d,"End"))))}unmount(){}}class Xye extends Xf{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=pb(U1(this.node.current,"focus",()=>this.onFocus()),U1(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function X5(e,t,i){const{props:l}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&l.whileTap&&e.animationState.setActive("whileTap",i==="Start");const d="onTap"+(i==="End"?"":i),m=l[d];m&&bs.postRender(()=>m(t,_b(t)))}class Yye extends Xf{mount(){const{current:t}=this.node;t&&(this.unmount=bge(t,(i,l)=>(X5(this.node,l,"Start"),(d,{success:m})=>X5(this.node,d,m?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const LM=new WeakMap,EP=new WeakMap,Qye=e=>{const t=LM.get(e.target);t&&t(e)},Jye=e=>{e.forEach(Qye)};function eve({root:e,...t}){const i=e||document;EP.has(i)||EP.set(i,{});const l=EP.get(i),d=JSON.stringify(t);return l[d]||(l[d]=new IntersectionObserver(Jye,{root:e,...t})),l[d]}function tve(e,t,i){const l=eve(t);return LM.set(e,i),l.observe(e),()=>{LM.delete(e),l.unobserve(e)}}const nve={some:0,all:1};class ive extends Xf{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:i,margin:l,amount:d="some",once:m}=t,v={root:i?i.current:void 0,rootMargin:l,threshold:typeof d=="number"?d:nve[d]},o=I=>{const{isIntersecting:A}=I;if(this.isInView===A||(this.isInView=A,m&&!A&&this.hasEnteredView))return;A&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",A);const{onViewportEnter:N,onViewportLeave:F}=this.node.getProps(),z=A?N:F;z&&z(I)};return tve(this.node.current,v,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:i}=this.node;["amount","margin","root"].some(rve(t,i))&&this.startObserver()}unmount(){}}function rve({viewport:e={}},{viewport:t={}}={}){return i=>e[i]!==t[i]}const sve={inView:{Feature:ive},tap:{Feature:Yye},focus:{Feature:Xye},hover:{Feature:Kye}},ove={layout:{ProjectionNode:D7,MeasureLayout:S7}},ave={...q_e,...sve,...Zye,...ove},bn=c_e(ave,w_e);function N7({kitchen:e,index:t=0}){return E.jsx(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.1,duration:.3},children:E.jsx(Fr,{to:`/kitchen/${e.id}`,children:E.jsxs("div",{className:"bg-card rounded-2xl overflow-hidden shadow-card hover:shadow-elevated transition-shadow duration-300",children:[E.jsxs("div",{className:"relative h-36 overflow-hidden",children:[E.jsx("img",{src:e.image,alt:e.name,className:"w-full h-full object-cover",loading:"lazy"}),E.jsx("div",{className:Xn("absolute top-3 right-3 px-2.5 py-1 rounded-full text-xs font-semibold",e.isOpen?"bg-accent text-accent-foreground":"bg-muted text-muted-foreground"),children:e.isOpen?"Cooking Today":"Closed"}),e.isVeg&&E.jsx("div",{className:"absolute top-3 left-3 p-1.5 rounded-full bg-veg",children:E.jsx(Jk,{className:"w-3 h-3 text-white"})})]}),E.jsxs("div",{className:"p-4",children:[E.jsx("h3",{className:"font-semibold text-foreground text-base mb-1 truncate",children:e.name}),E.jsx("p",{className:"text-muted-foreground text-sm mb-3 line-clamp-1",children:e.specialties.slice(0,3).join("  ")}),E.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[E.jsx("div",{className:"flex items-center gap-1",children:E.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 rounded-md bg-gold-soft",children:[E.jsx(P8,{className:"w-3.5 h-3.5 text-gold fill-gold"}),E.jsx("span",{className:"font-semibold text-foreground",children:e.rating.toFixed(1)})]})}),E.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[E.jsx(g1,{className:"w-3.5 h-3.5"}),E.jsx("span",{children:e.cookingTime})]}),E.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[E.jsx(ya,{className:"w-3.5 h-3.5"}),E.jsx("span",{className:"truncate max-w-[80px]",children:e.address.city})]})]})]})]})})})}function Ld({className:e}){return E.jsx("div",{className:Xn("animate-pulse-soft rounded-lg bg-muted",e)})}function SP(){return E.jsxs("div",{className:"bg-card rounded-2xl overflow-hidden shadow-card",children:[E.jsx(Ld,{className:"h-36 w-full rounded-none"}),E.jsxs("div",{className:"p-4 space-y-3",children:[E.jsx(Ld,{className:"h-5 w-3/4"}),E.jsx(Ld,{className:"h-4 w-1/2"}),E.jsxs("div",{className:"flex gap-2",children:[E.jsx(Ld,{className:"h-6 w-16 rounded-full"}),E.jsx(Ld,{className:"h-6 w-20 rounded-full"})]})]})]})}function CP(){return E.jsxs("div",{className:"flex gap-4 p-4 bg-card rounded-xl shadow-card",children:[E.jsxs("div",{className:"flex-1 space-y-2",children:[E.jsx(Ld,{className:"h-5 w-3/4"}),E.jsx(Ld,{className:"h-4 w-full"}),E.jsx(Ld,{className:"h-4 w-1/3"})]}),E.jsx(Ld,{className:"w-24 h-24 rounded-xl flex-shrink-0"})]})}function L7(){const[e,t]=q.useState([]),[i,l]=q.useState(!0),[d,m]=q.useState(null);return q.useEffect(()=>{const v=xi(bi,"kitchens"),o=Uo(v,I=>{try{const A=I.val();if(A){const N=Object.entries(A).map(([z,$])=>({...$,id:z})),F=N.filter(z=>z.isApproved===!0);t(F.length>0?F:N)}else t([]);l(!1)}catch{m("Failed to fetch kitchens"),l(!1)}},I=>{m(I.message),l(!1)});return()=>o()},[]),{kitchens:e,loading:i,error:d}}function lve(e){const[t,i]=q.useState(null),[l,d]=q.useState(!0),[m,v]=q.useState(null);return q.useEffect(()=>{if(!e){d(!1);return}const o=xi(bi,`kitchens/${e}`),I=Uo(o,A=>{try{const N=A.val();i(N?{...N,id:e}:null),d(!1)}catch{v("Failed to fetch kitchen"),d(!1)}});return()=>I()},[e]),{kitchen:t,loading:l,error:m}}function O7(e){const[t,i]=q.useState([]),[l,d]=q.useState(!0),[m,v]=q.useState(null);return q.useEffect(()=>{if(!e){d(!1);return}const o=xi(bi,"dishes"),I=Uo(o,A=>{try{const N=A.val();if(N){const F=Object.entries(N).map(([z,$])=>({...$,id:z})).filter(z=>z.kitchenId===e);i(F)}else i([]);d(!1)}catch{v("Failed to fetch dishes"),d(!1)}});return()=>I()},[e]),{dishes:t,loading:l,error:m}}function cve(e){const[t,i]=q.useState([]),[l,d]=q.useState(!0),[m,v]=q.useState(null);return q.useEffect(()=>{if(!e){d(!1);return}const o=xi(bi,"orders"),I=Uo(o,A=>{try{const N=A.val();if(N){const F=Object.entries(N).map(([z,$])=>({...$,id:z})).filter(z=>z.userId===e).sort((z,$)=>$.createdAt-z.createdAt);i(F)}else i([]);d(!1)}catch{v("Failed to fetch orders"),d(!1)}});return()=>I()},[e]),{orders:t,loading:l,error:m}}async function uve(e){const t=xi(bi,"kitchens"),i=hb(t);return await Yc(i,e),i.key}async function F7(e,t){const i=xi(bi,`kitchens/${e}`);await Qc(i,t)}async function dve(e){const t=xi(bi,"dishes"),i=hb(t);return await Yc(i,e),i.key}async function hve(e){const t=xi(bi,`dishes/${e}`);await Gm(t)}async function fve(e){const t=xi(bi,"orders"),i=hb(t);return await Yc(i,e),i.key}async function pve(e,t){const i=xi(bi,`orders/${e}`);await Qc(i,{status:t,updatedAt:Date.now()})}async function mve(e){const t=xi(bi,"coupons"),i=hb(t);return await Yc(i,e),i.key}async function gve(e,t){const i=xi(bi,`coupons/${e}`);await Qc(i,t)}async function _ve(e){const t=xi(bi,`coupons/${e}`);await Gm(t)}async function yve(e){const t=xi(bi,"coupons"),i=await If(t);if(i.exists()){const l=i.val();for(const[d,m]of Object.entries(l)){const v=m;if(v.code.toUpperCase()===e.toUpperCase())return{...v,id:d}}}return null}function vve(e){const[t,i]=q.useState([]),[l,d]=q.useState(!0);return q.useEffect(()=>{if(!e){d(!1);return}const m=xi(bi,"coupons"),v=Uo(m,o=>{const I=o.val();if(I){const A=Object.entries(I).map(([N,F])=>({...F,id:N})).filter(N=>N.kitchenId===e);i(A)}else i([]);d(!1)});return()=>v()},[e]),{coupons:t,loading:l}}const YN=Qk("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),wn=q.forwardRef(({className:e,variant:t,size:i,asChild:l=!1,...d},m)=>{const v=l?ete:"button";return E.jsx(v,{className:Xn(YN({variant:t,size:i,className:e})),ref:m,...d})});wn.displayName="Button";const xve=[{icon:S8,label:"Home",path:"/"},{icon:tD,label:"Search",path:"/search"},{icon:nD,label:"Orders",path:"/orders"},{icon:DR,label:"Profile",path:"/profile"}];function Uf(){const e=zm(),{getItemCount:t}=fb(),i=t();return E.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-50 bg-card/95 backdrop-blur-lg border-t border-border safe-bottom",children:E.jsxs("div",{className:"flex items-center justify-around px-2 py-2 max-w-lg mx-auto",children:[xve.map(l=>{const d=e.pathname===l.path,m=l.icon;return E.jsxs(Fr,{to:l.path,className:"relative flex flex-col items-center justify-center py-2 px-4 min-w-[64px]",children:[E.jsxs(bn.div,{whileTap:{scale:.9},className:Xn("flex flex-col items-center transition-colors duration-200",d?"text-primary":"text-muted-foreground"),children:[E.jsx(m,{className:"w-6 h-6",strokeWidth:d?2.5:2}),E.jsx("span",{className:"text-[10px] font-medium mt-1",children:l.label})]}),d&&E.jsx(bn.div,{layoutId:"activeTab",className:"absolute -top-2 left-1/2 -translate-x-1/2 w-1 h-1 rounded-full bg-primary"})]},l.path)}),E.jsx(Fr,{to:"/cart",className:"relative flex flex-col items-center justify-center py-2 px-4 min-w-[64px]",children:E.jsxs(bn.div,{whileTap:{scale:.9},className:Xn("flex flex-col items-center transition-colors duration-200",e.pathname==="/cart"?"text-primary":"text-muted-foreground"),children:[E.jsxs("div",{className:"relative",children:[E.jsx(Mf,{className:"w-6 h-6",strokeWidth:e.pathname==="/cart"?2.5:2}),i>0&&E.jsx(bn.span,{initial:{scale:0},animate:{scale:1},className:"absolute -top-2 -right-2 w-5 h-5 rounded-full bg-primary text-primary-foreground text-[10px] font-bold flex items-center justify-center",children:i>9?"9+":i})]}),E.jsx("span",{className:"text-[10px] font-medium mt-1",children:"Cart"})]})})]})})}function bve(){const{userLocation:e,refetchLocation:t,locationLoading:i}=GC();return E.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-6 text-center",children:[E.jsx(bn.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"w-24 h-24 rounded-full bg-destructive/10 flex items-center justify-center mb-6",children:E.jsx(Zc,{className:"w-12 h-12 text-destructive"})}),E.jsx(bn.h1,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1},className:"text-2xl font-bold text-foreground mb-3",children:"Service Not Available"}),E.jsx(bn.p,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},className:"text-muted-foreground mb-6 max-w-sm",children:"Sorry, Amma Cheythi Vanta is not yet available in your area. We're expanding soon!"}),e&&E.jsx(bn.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"bg-secondary rounded-xl p-4 mb-6 w-full max-w-sm",children:E.jsxs("div",{className:"flex items-start gap-3",children:[E.jsx(ya,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),E.jsxs("div",{className:"text-left",children:[E.jsx("p",{className:"text-xs text-muted-foreground",children:"Your location"}),E.jsx("p",{className:"text-sm text-foreground",children:e.address})]})]})}),E.jsx(bn.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},children:E.jsxs(wn,{variant:"outline",onClick:t,disabled:i,className:"gap-2",children:[E.jsx(ane,{className:`w-4 h-4 ${i?"animate-spin":""}`}),"Refresh Location"]})}),E.jsx(bn.p,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},className:"text-xs text-muted-foreground mt-8",children:"If you think this is an error, please allow location access and try again."})]})}function wve(){const{kitchens:e,loading:t,error:i}=L7(),{user:l,loading:d}=Sa(),{userLocation:m,locationLoading:v,isInServiceArea:o,checkingZone:I,currentFranchiseId:A,refetchLocation:N}=GC(),F=Qa(),[z,$]=q.useState("all"),[J,H]=q.useState("");q.useEffect(()=>{!d&&l&&(l.role==="amma"?F("/amma/dashboard"):l.role==="admin"?F("/admin"):l.role==="super_admin"?F("/super-admin"):l.role==="franchise_admin"&&l.franchiseId&&F("/admin"))},[l,d,F]);const re=e.filter(Q=>{if(!Q.isApproved||A&&Q.franchiseId!==A||z==="veg"&&!Q.isVeg||z==="open"&&!Q.isOpen)return!1;if(J){const ee=J.toLowerCase();return Q.name.toLowerCase().includes(ee)||Q.specialties.some(ie=>ie.toLowerCase().includes(ee))}return!0});return I?E.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center",children:[E.jsx(kr,{className:"w-8 h-8 animate-spin text-primary mb-4"}),E.jsx("p",{className:"text-muted-foreground",children:"Finding your location..."})]}):o?E.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[E.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:E.jsxs("div",{className:"px-4 py-3",children:[E.jsxs("div",{className:"flex items-center justify-between mb-3",children:[E.jsxs(bn.button,{whileTap:{scale:.98},onClick:N,className:"flex items-center gap-2",children:[E.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:v?E.jsx(kr,{className:"w-5 h-5 text-primary animate-spin"}):E.jsx(ya,{className:"w-5 h-5 text-primary"})}),E.jsxs("div",{className:"text-left",children:[E.jsx("p",{className:"text-xs text-muted-foreground",children:"Deliver to"}),E.jsxs("div",{className:"flex items-center gap-1",children:[E.jsx("span",{className:"font-semibold text-foreground max-w-[180px] truncate",children:v?"Finding location...":(m==null?void 0:m.address)||"Set location"}),E.jsx(gC,{className:"w-4 h-4 text-muted-foreground"})]})]})]}),E.jsxs(wn,{variant:"ghost",size:"icon",className:"relative",children:[E.jsx(w8,{className:"w-5 h-5"}),E.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 rounded-full bg-primary"})]})]}),E.jsx(Fr,{to:"/search",children:E.jsxs(bn.div,{whileTap:{scale:.99},className:"relative",children:[E.jsx(tD,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),E.jsx("input",{type:"text",placeholder:"Search Biryani or Amma's Kitchen",value:J,onChange:Q=>H(Q.target.value),className:"w-full pl-12 pr-4 py-3 rounded-xl bg-secondary border-0 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20"})]})})]})}),E.jsx("div",{className:"px-4 pt-4",children:E.jsxs(bn.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"gradient-hero rounded-2xl p-5 text-primary-foreground",children:[E.jsx("h1",{className:"text-2xl font-bold mb-1",children:"Amma Cheythi Vanta"}),E.jsx("p",{className:"text-primary-foreground/90 text-sm mb-3",children:"Homemade food from loving mothers nearby "}),E.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[E.jsxs("span",{className:"px-2 py-1 rounded-full bg-primary-foreground/20",children:[re.length," Kitchens nearby"]}),E.jsx("span",{className:"px-2 py-1 rounded-full bg-primary-foreground/20",children:" Fresh & Hot"})]})]})}),E.jsx("div",{className:"px-4 py-4 flex gap-2 overflow-x-auto hide-scrollbar",children:[{id:"all",label:"All"},{id:"open",label:" Open Now"},{id:"veg",label:" Pure Veg"}].map(Q=>E.jsx(bn.button,{whileTap:{scale:.95},onClick:()=>$(Q.id),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${z===Q.id?"gradient-primary text-primary-foreground":"bg-secondary text-secondary-foreground"}`,children:Q.label},Q.id))}),E.jsxs("div",{className:"px-4 mb-3",children:[E.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Kitchens Near You"}),E.jsx("p",{className:"text-sm text-muted-foreground",children:"Order homemade food from loving Ammas"})]}),E.jsxs("div",{className:"px-4 space-y-4",children:[t?E.jsxs(E.Fragment,{children:[E.jsx(SP,{}),E.jsx(SP,{}),E.jsx(SP,{})]}):i?E.jsx("div",{className:"text-center py-12",children:E.jsx("p",{className:"text-destructive",children:i})}):re.map((Q,ee)=>E.jsx(N7,{kitchen:Q,index:ee},Q.id)),re.length===0&&!t&&!i&&E.jsxs("div",{className:"text-center py-12",children:[E.jsx("p",{className:"text-muted-foreground",children:"No kitchens found"}),E.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Be the first Amma to register your kitchen!"})]})]}),E.jsx(Uf,{})]}):E.jsx(bve,{})}function Tve({dish:e,kitchenId:t,kitchenName:i}){const{cart:l,addToCart:d,updateQuantity:m,removeFromCart:v}=fb(),o=l.items.find(z=>z.dish.id===e.id),I=(o==null?void 0:o.quantity)||0,A=()=>{d(e,t,i)},N=()=>{m(e.id,I+1)},F=()=>{I<=1?v(e.id):m(e.id,I-1)};return E.jsxs(bn.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"flex gap-4 p-4 bg-card rounded-xl shadow-card",children:[E.jsxs("div",{className:"flex-1 min-w-0",children:[E.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[E.jsx("div",{className:Xn("w-4 h-4 border-2 rounded-sm flex items-center justify-center",e.isVeg?"border-veg":"border-non-veg"),children:E.jsx("div",{className:Xn("w-2 h-2 rounded-full",e.isVeg?"bg-veg":"bg-non-veg")})}),e.isVeg&&E.jsx("span",{className:"text-xs text-veg font-medium",children:"Pure Veg"})]}),E.jsx("h3",{className:"font-semibold text-foreground text-base mb-1 truncate",children:e.name}),E.jsx("p",{className:"text-muted-foreground text-sm mb-2 line-clamp-2",children:e.description}),E.jsxs("div",{className:"flex items-center gap-2",children:[E.jsxs("span",{className:"font-bold text-foreground",children:["",e.price]}),e.originalPrice&&e.originalPrice>e.price&&E.jsxs("span",{className:"text-sm text-muted-foreground line-through",children:["",e.originalPrice]})]}),e.tags&&e.tags.length>0&&E.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:e.tags.slice(0,2).map(z=>E.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-secondary text-secondary-foreground",children:z},z))})]}),E.jsxs("div",{className:"relative flex-shrink-0",children:[E.jsx("img",{src:e.image,alt:e.name,className:"w-24 h-24 rounded-xl object-cover",loading:"lazy"}),e.isAvailable?E.jsx("div",{className:"absolute -bottom-3 left-1/2 -translate-x-1/2",children:E.jsx(VN,{mode:"wait",children:I===0?E.jsx(bn.div,{initial:{scale:.8},animate:{scale:1},exit:{scale:.8},children:E.jsx(wn,{onClick:A,size:"sm",className:"gradient-primary text-primary-foreground font-semibold px-6 rounded-lg shadow-soft",children:"ADD"})},"add"):E.jsxs(bn.div,{initial:{scale:.8},animate:{scale:1},exit:{scale:.8},className:"flex items-center gap-1 bg-primary rounded-lg shadow-soft",children:[E.jsx(wn,{onClick:F,size:"icon",variant:"ghost",className:"h-8 w-8 text-primary-foreground hover:bg-primary/80",children:E.jsx(C8,{className:"w-4 h-4"})}),E.jsx("span",{className:"font-bold text-primary-foreground px-2 min-w-[24px] text-center",children:I}),E.jsx(wn,{onClick:N,size:"icon",variant:"ghost",className:"h-8 w-8 text-primary-foreground hover:bg-primary/80",children:E.jsx(ly,{className:"w-4 h-4"})})]},"quantity")})}):E.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-muted/90 text-muted-foreground text-xs text-center py-1 rounded-b-xl",children:"Sold Out"})]})]})}function Eve(){const{id:e}=N$(),{kitchen:t,loading:i,error:l}=lve(e),{dishes:d,loading:m}=O7(e),{cart:v,getTotal:o,getItemCount:I}=fb();if(i)return E.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:E.jsx(kr,{className:"w-8 h-8 animate-spin text-primary"})});if(l||!t)return E.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background px-4",children:[E.jsx("p",{className:"text-muted-foreground mb-4",children:"Kitchen not found"}),E.jsx(Fr,{to:"/",children:E.jsx(wn,{className:"gradient-primary text-primary-foreground",children:"Go Back Home"})})]});const A=[...new Set(d.map(N=>N.category))];return E.jsxs("div",{className:"min-h-screen bg-background pb-32",children:[E.jsxs("div",{className:"relative h-56",children:[E.jsx("img",{src:t.coverImage||t.image,alt:t.name,className:"w-full h-full object-cover"}),E.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background via-transparent to-transparent"}),E.jsxs("div",{className:"absolute top-4 left-4 right-4 flex justify-between",children:[E.jsx(Fr,{to:"/",children:E.jsx(bn.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-card/90 backdrop-blur-sm flex items-center justify-center shadow-soft",children:E.jsx(Wf,{className:"w-5 h-5"})})}),E.jsxs("div",{className:"flex gap-2",children:[E.jsx(bn.button,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-card/90 backdrop-blur-sm flex items-center justify-center shadow-soft",children:E.jsx(lne,{className:"w-5 h-5"})}),E.jsx(bn.button,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-card/90 backdrop-blur-sm flex items-center justify-center shadow-soft",children:E.jsx(E8,{className:"w-5 h-5"})})]})]})]}),E.jsx("div",{className:"px-4 -mt-8 relative z-10",children:E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl p-4 shadow-elevated",children:[E.jsxs("div",{className:"flex items-start justify-between mb-3",children:[E.jsxs("div",{children:[E.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.isVeg&&E.jsx("div",{className:"p-1 rounded-full bg-veg/10",children:E.jsx(Jk,{className:"w-3 h-3 text-veg"})}),E.jsx("h1",{className:"text-xl font-bold text-foreground",children:t.name})]}),E.jsx("p",{className:"text-sm text-muted-foreground",children:t.specialties.join("  ")})]}),E.jsxs("div",{className:"flex items-center gap-1 px-2.5 py-1 rounded-lg bg-gold-soft",children:[E.jsx(P8,{className:"w-4 h-4 text-gold fill-gold"}),E.jsx("span",{className:"font-bold text-foreground",children:t.rating}),E.jsxs("span",{className:"text-muted-foreground text-sm",children:["(",t.totalRatings,")"]})]})]}),E.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:t.description}),E.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[E.jsxs("div",{className:"flex items-center gap-1.5 text-muted-foreground",children:[E.jsx(g1,{className:"w-4 h-4"}),E.jsx("span",{children:t.cookingTime})]}),E.jsxs("div",{className:"flex items-center gap-1.5 text-muted-foreground",children:[E.jsx(ya,{className:"w-4 h-4"}),E.jsxs("span",{children:[t.address.line1,", ",t.address.city]})]})]}),E.jsx("div",{className:Xn("mt-4 px-3 py-2 rounded-lg text-sm font-medium text-center",t.isOpen?"bg-accent/10 text-accent":"bg-muted text-muted-foreground"),children:t.isOpen?" Kitchen is open and cooking!":" Kitchen is closed"})]})}),E.jsxs("div",{className:"px-4 mt-6",children:[E.jsx("h2",{className:"text-lg font-semibold text-foreground mb-4",children:"Menu"}),m?E.jsxs("div",{className:"space-y-4",children:[E.jsx(CP,{}),E.jsx(CP,{}),E.jsx(CP,{})]}):d.length===0?E.jsx("div",{className:"text-center py-12",children:E.jsx("p",{className:"text-muted-foreground",children:"No dishes available yet"})}):A.map(N=>E.jsxs("div",{className:"mb-6",children:[E.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide mb-3",children:N}),E.jsx("div",{className:"space-y-4",children:d.filter(F=>F.category===N).map(F=>E.jsx(Tve,{dish:F,kitchenId:t.id,kitchenName:t.name},F.id))})]},N))]}),v.items.length>0&&v.kitchenId===t.id&&E.jsx(bn.div,{initial:{y:100},animate:{y:0},className:"fixed bottom-0 left-0 right-0 p-4 bg-card/95 backdrop-blur-lg border-t border-border safe-bottom",children:E.jsx(Fr,{to:"/cart",children:E.jsx(wn,{className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl shadow-elevated",children:E.jsxs("div",{className:"flex items-center justify-between w-full",children:[E.jsxs("div",{className:"flex items-center gap-2",children:[E.jsxs("span",{className:"bg-primary-foreground/20 px-2 py-0.5 rounded-md text-sm",children:[I()," items"]}),E.jsx("span",{className:"font-semibold",children:"View Cart"})]}),E.jsxs("span",{className:"font-bold",children:["",o()]})]})})})})]})}function Sve(){const{cart:e,updateQuantity:t,removeFromCart:i,clearCart:l,getTotal:d,getItemCount:m}=fb(),v=30,o=5,I=d()+v+o;return e.items.length===0?E.jsx("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:E.jsxs(bn.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"text-center",children:[E.jsx("div",{className:"w-24 h-24 rounded-full bg-secondary flex items-center justify-center mx-auto mb-4",children:E.jsx(Mf,{className:"w-12 h-12 text-muted-foreground"})}),E.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Your cart is empty"}),E.jsx("p",{className:"text-muted-foreground mb-6",children:"Add delicious homemade food from nearby Ammas"}),E.jsx(Fr,{to:"/",children:E.jsx(wn,{className:"gradient-primary text-primary-foreground px-8",children:"Explore Kitchens"})})]})}):E.jsxs("div",{className:"min-h-screen bg-background pb-40",children:[E.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:E.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[E.jsx(Fr,{to:"/",children:E.jsx(bn.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:E.jsx(Wf,{className:"w-5 h-5"})})}),E.jsxs("div",{className:"flex-1",children:[E.jsx("h1",{className:"font-semibold text-foreground",children:"Your Cart"}),E.jsxs("p",{className:"text-sm text-muted-foreground",children:["from ",e.kitchenName]})]}),E.jsxs(wn,{onClick:l,variant:"outline",size:"sm",className:"text-destructive border-destructive hover:bg-destructive hover:text-destructive-foreground",children:[E.jsx(kf,{className:"w-4 h-4 mr-1"}),"Clear"]})]})}),E.jsxs("div",{className:"px-4 py-4",children:[E.jsx(VN,{children:e.items.map((A,N)=>E.jsxs(bn.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:N*.05},className:"flex gap-4 py-4 border-b border-border",children:[E.jsx("div",{className:Xn("w-4 h-4 border-2 rounded-sm flex items-center justify-center mt-1 flex-shrink-0",A.dish.isVeg?"border-veg":"border-non-veg"),children:E.jsx("div",{className:Xn("w-2 h-2 rounded-full",A.dish.isVeg?"bg-veg":"bg-non-veg")})}),E.jsxs("div",{className:"flex-1 min-w-0",children:[E.jsx("h3",{className:"font-medium text-foreground truncate",children:A.dish.name}),E.jsxs("p",{className:"text-sm text-muted-foreground",children:["",A.dish.price]})]}),E.jsxs("div",{className:"flex items-center gap-2",children:[E.jsxs("div",{className:"flex items-center gap-1 bg-secondary rounded-lg",children:[E.jsx(wn,{onClick:()=>t(A.dish.id,A.quantity-1),size:"icon",variant:"ghost",className:"h-8 w-8",children:A.quantity===1?E.jsx(kf,{className:"w-4 h-4 text-destructive"}):E.jsx(C8,{className:"w-4 h-4"})}),E.jsx("span",{className:"font-semibold text-foreground px-2 min-w-[24px] text-center",children:A.quantity}),E.jsx(wn,{onClick:()=>t(A.dish.id,A.quantity+1),size:"icon",variant:"ghost",className:"h-8 w-8",children:E.jsx(ly,{className:"w-4 h-4"})})]}),E.jsxs("span",{className:"font-semibold text-foreground min-w-[60px] text-right",children:["",A.dish.price*A.quantity]})]})]},A.dish.id))}),E.jsx(Fr,{to:`/kitchen/${e.kitchenId}`,children:E.jsx(wn,{variant:"ghost",className:"w-full mt-4 text-primary",children:"+ Add more items"})})]}),E.jsx("div",{className:"px-4 mt-4",children:E.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[E.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Bill Details"}),E.jsxs("div",{className:"space-y-2 text-sm",children:[E.jsxs("div",{className:"flex justify-between",children:[E.jsx("span",{className:"text-muted-foreground",children:"Item Total"}),E.jsxs("span",{className:"text-foreground",children:["",d()]})]}),E.jsxs("div",{className:"flex justify-between",children:[E.jsx("span",{className:"text-muted-foreground",children:"Delivery Fee"}),E.jsxs("span",{className:"text-foreground",children:["",v]})]}),E.jsxs("div",{className:"flex justify-between",children:[E.jsx("span",{className:"text-muted-foreground",children:"Platform Fee"}),E.jsxs("span",{className:"text-foreground",children:["",o]})]}),E.jsx("div",{className:"border-t border-border pt-2 mt-2",children:E.jsxs("div",{className:"flex justify-between font-semibold",children:[E.jsx("span",{className:"text-foreground",children:"To Pay"}),E.jsxs("span",{className:"text-foreground",children:["",I]})]})})]})]})}),E.jsx(bn.div,{initial:{y:100},animate:{y:0},className:"fixed bottom-0 left-0 right-0 p-4 bg-card/95 backdrop-blur-lg border-t border-border safe-bottom",children:E.jsx(Fr,{to:"/checkout",children:E.jsx(wn,{className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl shadow-elevated",children:E.jsxs("div",{className:"flex items-center justify-between w-full",children:[E.jsx("span",{className:"font-semibold",children:"Proceed to Checkout"}),E.jsxs("span",{className:"font-bold",children:["",I]})]})})})})]})}const Yi=q.forwardRef(({className:e,type:t,...i},l)=>E.jsx("input",{type:t,className:Xn("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:l,...i}));Yi.displayName="Input";const yb=q.forwardRef(({className:e,...t},i)=>E.jsx("textarea",{className:Xn("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...t}));yb.displayName="Textarea";const Cve="rzp_live_HJl9NwyBSY9rwV";function Ive(){return new Promise(e=>{if(window.Razorpay){e(!0);return}const t=document.createElement("script");t.src="https://checkout.razorpay.com/v1/checkout.js",t.onload=()=>e(!0),t.onerror=()=>e(!1),document.body.appendChild(t)})}async function Ave(e,t,i,l,d,m){if(!await Ive())throw new Error("Failed to load Razorpay SDK");const o={key:Cve,amount:e*100,currency:"INR",name:"Amma Cheythi Vanta",description:"Homemade food order payment",prefill:{name:t,email:i,contact:l},theme:{color:"#D97706"},handler:d,modal:{ondismiss:m}};new window.Razorpay(o).open()}var z7={exports:{}};(function(e,t){(function(i,l){e.exports=l()})(xQ,function(){var i,l,d;function m(o,I){if(!i)i=I;else if(!l)l=I;else{var A="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+l+")(sharedChunk); self.onerror = null;",N={};i(N),d=I(N),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([A],{type:"text/javascript"})))}}m(["exports"],function(o){var I=1e-6,A=typeof Float32Array<"u"?Float32Array:Array;function N(a,n){var s=n[0],u=n[1],h=n[2],g=n[3],_=s*g-h*u;return _?(a[0]=g*(_=1/_),a[1]=-u*_,a[2]=-h*_,a[3]=s*_,a):null}function F(){var a=new A(9);return A!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function z(a,n){var s=n[0],u=n[1],h=n[2],g=n[3],_=n[4],x=n[5],T=n[6],C=n[7],R=n[8];return a[0]=_*R-x*C,a[1]=h*C-u*R,a[2]=u*x-h*_,a[3]=x*T-g*R,a[4]=s*R-h*T,a[5]=h*g-s*x,a[6]=g*C-_*T,a[7]=u*T-s*C,a[8]=s*_-u*g,a}function $(a,n,s){var u=n[0],h=n[1],g=n[2],_=n[3],x=n[4],T=n[5],C=n[6],R=n[7],M=n[8],D=s[0],O=s[1],j=s[2],G=s[3],X=s[4],K=s[5],se=s[6],ae=s[7],de=s[8];return a[0]=D*u+O*_+j*C,a[1]=D*h+O*x+j*R,a[2]=D*g+O*T+j*M,a[3]=G*u+X*_+K*C,a[4]=G*h+X*x+K*R,a[5]=G*g+X*T+K*M,a[6]=se*u+ae*_+de*C,a[7]=se*h+ae*x+de*R,a[8]=se*g+ae*T+de*M,a}function J(){var a=new A(16);return A!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a}function H(a){var n=new A(16);return n[0]=a[0],n[1]=a[1],n[2]=a[2],n[3]=a[3],n[4]=a[4],n[5]=a[5],n[6]=a[6],n[7]=a[7],n[8]=a[8],n[9]=a[9],n[10]=a[10],n[11]=a[11],n[12]=a[12],n[13]=a[13],n[14]=a[14],n[15]=a[15],n}function re(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Q(a,n){var s=n[0],u=n[1],h=n[2],g=n[3],_=n[4],x=n[5],T=n[6],C=n[7],R=n[8],M=n[9],D=n[10],O=n[11],j=n[12],G=n[13],X=n[14],K=n[15],se=s*x-u*_,ae=s*T-h*_,de=s*C-g*_,ve=u*T-h*x,me=u*C-g*x,Te=h*C-g*T,Ie=R*G-M*j,Re=R*X-D*j,qe=R*K-O*j,Ne=M*X-D*G,Qe=M*K-O*G,it=D*K-O*X,rt=se*it-ae*Qe+de*Ne+ve*qe-me*Re+Te*Ie;return rt?(a[0]=(x*it-T*Qe+C*Ne)*(rt=1/rt),a[1]=(h*Qe-u*it-g*Ne)*rt,a[2]=(G*Te-X*me+K*ve)*rt,a[3]=(D*me-M*Te-O*ve)*rt,a[4]=(T*qe-_*it-C*Re)*rt,a[5]=(s*it-h*qe+g*Re)*rt,a[6]=(X*de-j*Te-K*ae)*rt,a[7]=(R*Te-D*de+O*ae)*rt,a[8]=(_*Qe-x*qe+C*Ie)*rt,a[9]=(u*qe-s*Qe-g*Ie)*rt,a[10]=(j*me-G*de+K*se)*rt,a[11]=(M*de-R*me-O*se)*rt,a[12]=(x*Re-_*Ne-T*Ie)*rt,a[13]=(s*Ne-u*Re+h*Ie)*rt,a[14]=(G*ae-j*ve-X*se)*rt,a[15]=(R*ve-M*ae+D*se)*rt,a):null}function ee(a,n,s){var u=n[0],h=n[1],g=n[2],_=n[3],x=n[4],T=n[5],C=n[6],R=n[7],M=n[8],D=n[9],O=n[10],j=n[11],G=n[12],X=n[13],K=n[14],se=n[15],ae=s[0],de=s[1],ve=s[2],me=s[3];return a[0]=ae*u+de*x+ve*M+me*G,a[1]=ae*h+de*T+ve*D+me*X,a[2]=ae*g+de*C+ve*O+me*K,a[3]=ae*_+de*R+ve*j+me*se,a[4]=(ae=s[4])*u+(de=s[5])*x+(ve=s[6])*M+(me=s[7])*G,a[5]=ae*h+de*T+ve*D+me*X,a[6]=ae*g+de*C+ve*O+me*K,a[7]=ae*_+de*R+ve*j+me*se,a[8]=(ae=s[8])*u+(de=s[9])*x+(ve=s[10])*M+(me=s[11])*G,a[9]=ae*h+de*T+ve*D+me*X,a[10]=ae*g+de*C+ve*O+me*K,a[11]=ae*_+de*R+ve*j+me*se,a[12]=(ae=s[12])*u+(de=s[13])*x+(ve=s[14])*M+(me=s[15])*G,a[13]=ae*h+de*T+ve*D+me*X,a[14]=ae*g+de*C+ve*O+me*K,a[15]=ae*_+de*R+ve*j+me*se,a}function ie(a,n,s){var u,h,g,_,x,T,C,R,M,D,O,j,G=s[0],X=s[1],K=s[2];return n===a?(a[12]=n[0]*G+n[4]*X+n[8]*K+n[12],a[13]=n[1]*G+n[5]*X+n[9]*K+n[13],a[14]=n[2]*G+n[6]*X+n[10]*K+n[14],a[15]=n[3]*G+n[7]*X+n[11]*K+n[15]):(h=n[1],g=n[2],_=n[3],x=n[4],T=n[5],C=n[6],R=n[7],M=n[8],D=n[9],O=n[10],j=n[11],a[0]=u=n[0],a[1]=h,a[2]=g,a[3]=_,a[4]=x,a[5]=T,a[6]=C,a[7]=R,a[8]=M,a[9]=D,a[10]=O,a[11]=j,a[12]=u*G+x*X+M*K+n[12],a[13]=h*G+T*X+D*K+n[13],a[14]=g*G+C*X+O*K+n[14],a[15]=_*G+R*X+j*K+n[15]),a}function ue(a,n,s){var u=s[0],h=s[1],g=s[2];return a[0]=n[0]*u,a[1]=n[1]*u,a[2]=n[2]*u,a[3]=n[3]*u,a[4]=n[4]*h,a[5]=n[5]*h,a[6]=n[6]*h,a[7]=n[7]*h,a[8]=n[8]*g,a[9]=n[9]*g,a[10]=n[10]*g,a[11]=n[11]*g,a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15],a}function xe(a,n,s){var u=Math.sin(s),h=Math.cos(s),g=n[4],_=n[5],x=n[6],T=n[7],C=n[8],R=n[9],M=n[10],D=n[11];return n!==a&&(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[4]=g*h+C*u,a[5]=_*h+R*u,a[6]=x*h+M*u,a[7]=T*h+D*u,a[8]=C*h-g*u,a[9]=R*h-_*u,a[10]=M*h-x*u,a[11]=D*h-T*u,a}function Oe(a,n,s){var u=Math.sin(s),h=Math.cos(s),g=n[0],_=n[1],x=n[2],T=n[3],C=n[8],R=n[9],M=n[10],D=n[11];return n!==a&&(a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[0]=g*h-C*u,a[1]=_*h-R*u,a[2]=x*h-M*u,a[3]=T*h-D*u,a[8]=g*u+C*h,a[9]=_*u+R*h,a[10]=x*u+M*h,a[11]=T*u+D*h,a}function ze(a,n,s){var u=Math.sin(s),h=Math.cos(s),g=n[0],_=n[1],x=n[2],T=n[3],C=n[4],R=n[5],M=n[6],D=n[7];return n!==a&&(a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[0]=g*h+C*u,a[1]=_*h+R*u,a[2]=x*h+M*u,a[3]=T*h+D*u,a[4]=C*h-g*u,a[5]=R*h-_*u,a[6]=M*h-x*u,a[7]=D*h-T*u,a}function Be(a,n){return a[0]=n[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=n[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=n[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function ot(a,n,s){var u,h,g,_=s[0],x=s[1],T=s[2],C=Math.sqrt(_*_+x*x+T*T);return C<I?null:(_*=C=1/C,x*=C,T*=C,u=Math.sin(n),h=Math.cos(n),a[0]=_*_*(g=1-h)+h,a[1]=x*_*g+T*u,a[2]=T*_*g-x*u,a[3]=0,a[4]=_*x*g-T*u,a[5]=x*x*g+h,a[6]=T*x*g+_*u,a[7]=0,a[8]=_*T*g+x*u,a[9]=x*T*g-_*u,a[10]=T*T*g+h,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}function Et(a,n){var s=n[0],u=n[1],h=n[2],g=n[4],_=n[5],x=n[6],T=n[8],C=n[9],R=n[10];return a[0]=Math.sqrt(s*s+u*u+h*h),a[1]=Math.sqrt(g*g+_*_+x*x),a[2]=Math.sqrt(T*T+C*C+R*R),a}function Zt(a,n){var s=n[0],u=n[1],h=n[2],g=n[3],_=s+s,x=u+u,T=h+h,C=s*_,R=u*_,M=u*x,D=h*_,O=h*x,j=h*T,G=g*_,X=g*x,K=g*T;return a[0]=1-M-j,a[1]=R+K,a[2]=D-X,a[3]=0,a[4]=R-K,a[5]=1-C-j,a[6]=O+G,a[7]=0,a[8]=D+X,a[9]=O-G,a[10]=1-C-M,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}var at=ee;function zt(){var a=new A(3);return A!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Kt(a){var n=new A(3);return n[0]=a[0],n[1]=a[1],n[2]=a[2],n}function nn(a){var n=a[0],s=a[1],u=a[2];return Math.sqrt(n*n+s*s+u*u)}function Wt(a,n,s){var u=new A(3);return u[0]=a,u[1]=n,u[2]=s,u}function Ke(a,n,s,u){return a[0]=n,a[1]=s,a[2]=u,a}function et(a,n,s){return a[0]=n[0]+s[0],a[1]=n[1]+s[1],a[2]=n[2]+s[2],a}function Ct(a,n,s){return a[0]=n[0]-s[0],a[1]=n[1]-s[1],a[2]=n[2]-s[2],a}function en(a,n,s){return a[0]=n[0]*s[0],a[1]=n[1]*s[1],a[2]=n[2]*s[2],a}function Bn(a,n,s){return a[0]=Math.min(n[0],s[0]),a[1]=Math.min(n[1],s[1]),a[2]=Math.min(n[2],s[2]),a}function En(a,n,s){return a[0]=Math.max(n[0],s[0]),a[1]=Math.max(n[1],s[1]),a[2]=Math.max(n[2],s[2]),a}function gn(a,n,s){return a[0]=n[0]*s,a[1]=n[1]*s,a[2]=n[2]*s,a}function qt(a,n,s,u){return a[0]=n[0]+s[0]*u,a[1]=n[1]+s[1]*u,a[2]=n[2]+s[2]*u,a}function Ji(a,n){var s=n[0]-a[0],u=n[1]-a[1],h=n[2]-a[2];return Math.sqrt(s*s+u*u+h*h)}function Sr(a,n){var s=n[0]-a[0],u=n[1]-a[1],h=n[2]-a[2];return s*s+u*u+h*h}function _n(a){var n=a[0],s=a[1],u=a[2];return n*n+s*s+u*u}function Rt(a,n){return a[0]=-n[0],a[1]=-n[1],a[2]=-n[2],a}function pn(a,n){var s=n[0],u=n[1],h=n[2],g=s*s+u*u+h*h;return g>0&&(g=1/Math.sqrt(g)),a[0]=n[0]*g,a[1]=n[1]*g,a[2]=n[2]*g,a}function Fn(a,n){return a[0]*n[0]+a[1]*n[1]+a[2]*n[2]}function si(a,n,s){var u=n[0],h=n[1],g=n[2],_=s[0],x=s[1],T=s[2];return a[0]=h*T-g*x,a[1]=g*_-u*T,a[2]=u*x-h*_,a}function $i(a,n,s,u){var h=n[0],g=n[1],_=n[2];return a[0]=h+u*(s[0]-h),a[1]=g+u*(s[1]-g),a[2]=_+u*(s[2]-_),a}function Mi(a,n,s){var u=n[0],h=n[1],g=n[2],_=s[3]*u+s[7]*h+s[11]*g+s[15];return a[0]=(s[0]*u+s[4]*h+s[8]*g+s[12])/(_=_||1),a[1]=(s[1]*u+s[5]*h+s[9]*g+s[13])/_,a[2]=(s[2]*u+s[6]*h+s[10]*g+s[14])/_,a}function Ts(a,n,s){var u=n[0],h=n[1],g=n[2];return a[0]=u*s[0]+h*s[3]+g*s[6],a[1]=u*s[1]+h*s[4]+g*s[7],a[2]=u*s[2]+h*s[5]+g*s[8],a}function fo(a,n,s){var u=s[0],h=s[1],g=s[2],_=s[3],x=n[0],T=n[1],C=n[2],R=h*C-g*T,M=g*x-u*C,D=u*T-h*x;return a[0]=x+_*(R+=R)+h*(D+=D)-g*(M+=M),a[1]=T+_*M+g*R-u*D,a[2]=C+_*D+u*M-h*R,a}function ls(a){return a[0]=0,a[1]=0,a[2]=0,a}function Kr(a,n){return a[0]===n[0]&&a[1]===n[1]&&a[2]===n[2]}var xr=Ct,Sl=en,sc=nn;function na(){var a=new A(4);return A!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0),a}function Ja(a,n,s){return a[0]=n[0]*s,a[1]=n[1]*s,a[2]=n[2]*s,a[3]=n[3]*s,a}function po(a,n){var s=n[0],u=n[1],h=n[2],g=n[3],_=s*s+u*u+h*h+g*g;return _>0&&(_=1/Math.sqrt(_)),a[0]=s*_,a[1]=u*_,a[2]=h*_,a[3]=g*_,a}function ks(a,n,s){var u=n[0],h=n[1],g=n[2],_=n[3];return a[0]=s[0]*u+s[4]*h+s[8]*g+s[12]*_,a[1]=s[1]*u+s[5]*h+s[9]*g+s[13]*_,a[2]=s[2]*u+s[6]*h+s[10]*g+s[14]*_,a[3]=s[3]*u+s[7]*h+s[11]*g+s[15]*_,a}function el(){var a=new A(4);return A!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function zs(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Hs(a,n,s){s*=.5;var u=n[0],h=n[1],g=n[2],_=n[3],x=Math.sin(s),T=Math.cos(s);return a[0]=u*T+_*x,a[1]=h*T+g*x,a[2]=g*T-h*x,a[3]=_*T-u*x,a}function tl(a,n,s){s*=.5;var u=n[0],h=n[1],g=n[2],_=n[3],x=Math.sin(s),T=Math.cos(s);return a[0]=u*T-g*x,a[1]=h*T+_*x,a[2]=g*T+u*x,a[3]=_*T-h*x,a}zt(),na();var Ws,Ia,oc,Cl=po,Il=(Ws=zt(),Ia=Wt(1,0,0),oc=Wt(0,1,0),function(a,n,s){var u=Fn(n,s);return u<-.999999?(si(Ws,Ia,n),sc(Ws)<1e-6&&si(Ws,oc,n),pn(Ws,Ws),function(h,g,_){_*=.5;var x=Math.sin(_);h[0]=x*g[0],h[1]=x*g[1],h[2]=x*g[2],h[3]=Math.cos(_)}(a,Ws,Math.PI),a):u>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(si(Ws,n,s),a[0]=Ws[0],a[1]=Ws[1],a[2]=Ws[2],a[3]=1+u,Cl(a,a))});function jr(){var a=new A(2);return A!=Float32Array&&(a[0]=0,a[1]=0),a}function qs(a,n){var s=new A(2);return s[0]=a,s[1]=n,s}function Aa(a,n,s){return a[0]=n,a[1]=s,a}function Al(a,n,s){return a[0]=n[0]+s[0],a[1]=n[1]+s[1],a}function Pa(a,n,s){return a[0]=n[0]-s[0],a[1]=n[1]-s[1],a}function Ra(a,n,s){return a[0]=n[0]*s,a[1]=n[1]*s,a}function $o(a){var n=a[0],s=a[1];return Math.sqrt(n*n+s*s)}function id(a,n){var s=n[0],u=n[1],h=s*s+u*u;return h>0&&(h=1/Math.sqrt(h)),a[0]=n[0]*h,a[1]=n[1]*h,a}function nl(a,n){return a[0]*n[0]+a[1]*n[1]}el(),el(),F();var Oi,ms,gi=Pa;function er(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}jr();var tr=function(){if(ms)return Oi;function a(n,s,u,h){this.cx=3*n,this.bx=3*(u-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(h-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=s,this.p2x=u,this.p2y=h}return ms=1,Oi=a,a.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,s){if(s===void 0&&(s=1e-6),n<0)return 0;if(n>1)return 1;for(var u=n,h=0;h<8;h++){var g=this.sampleCurveX(u)-n;if(Math.abs(g)<s)return u;var _=this.sampleCurveDerivativeX(u);if(Math.abs(_)<1e-6)break;u-=g/_}var x=0,T=1;for(u=n,h=0;h<20&&(g=this.sampleCurveX(u),!(Math.abs(g-n)<s));h++)n>g?x=u:T=u,u=.5*(T-x)+x;return u},solve:function(n,s){return this.sampleCurveY(this.solveCurveX(n,s))}},Oi}(),mo=er(tr);function st(a,n){this.x=a,this.y=n}function Zs(a,n){if(Array.isArray(a)){if(!Array.isArray(n)||a.length!==n.length)return!1;for(let s=0;s<a.length;s++)if(!Zs(a[s],n[s]))return!1;return!0}if(typeof a=="object"&&a!==null&&n!==null){if(typeof n!="object"||Object.keys(a).length!==Object.keys(n).length)return!1;for(const s in a)if(!Zs(a[s],n[s]))return!1;return!0}return a===n}st.prototype={clone(){return new st(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,n){return this.clone()._rotateAround(a,n)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){const n=a.x-this.x,s=a.y-this.y;return n*n+s*s},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,n){return Math.atan2(this.x*n-this.y*a,this.x*a+this.y*n)},_matMult(a){const n=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=n,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){const a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){const n=Math.cos(a),s=Math.sin(a),u=s*this.x+n*this.y;return this.x=n*this.x-s*this.y,this.y=u,this},_rotateAround(a,n){const s=Math.cos(a),u=Math.sin(a),h=n.y+u*(this.x-n.x)+s*(this.y-n.y);return this.x=n.x+s*(this.x-n.x)-u*(this.y-n.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:st},st.convert=function(a){if(a instanceof st)return a;if(Array.isArray(a))return new st(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new st(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};const il=Math.PI/180,js=180/Math.PI;function $n(a){return a*il}function io(a){return a*js}const fv=[[0,0],[1,0],[1,1],[0,1]];function rd(a){if(a<=0)return 0;if(a>=1)return 1;const n=a*a,s=n*a;return 4*(a<.5?s:3*(a-n)+s-.75)}function ep(a,n,s,u){const h=new mo(a,n,s,u);return function(g){return h.solve(g)}}const je=ep(.25,.1,.25,1);function Y(a,n,s){return Math.min(s,Math.max(n,a))}function oe(a,n,s){return(s=Y((s-a)/(n-a),0,1))*s*(3-2*s)}function fe(a,n,s){const u=s-n,h=((a-n)%u+u)%u+n;return h===n?s:h}function Ae(a,n,s){if(!a.length)return s(null,[]);let u=a.length;const h=new Array(a.length);let g=null;a.forEach((_,x)=>{n(_,(T,C)=>{T&&(g=T),h[x]=C,--u==0&&s(g,h)})})}let Ce=1;function ke(){return Ce++}function Ge(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log2(a)))}function Le(a,n){a.forEach(s=>{n[s]&&(n[s]=n[s].bind(n))})}function $e(a,n,s){const u={};for(const h in a)u[h]=n.call(this,a[h],h,a);return u}function mt(a,n,s){const u={};for(const h in a)n.call(this,a[h],h,a)&&(u[h]=a[h]);return u}function nt(a){return Array.isArray(a)?a.map(nt):typeof a=="object"&&a?$e(a,nt):a}function Ft(a,n){for(let s=0;s<a.length;s++)if(n.indexOf(a[s])>=0)return!0;return!1}const sn={};function Nt(a){sn[a]||(typeof console<"u"&&console.warn(a),sn[a]=!0)}function kn(a,n,s){return(s.y-a.y)*(n.x-a.x)>(n.y-a.y)*(s.x-a.x)}function Pn(a){let n=0;for(let s,u,h=0,g=a.length,_=g-1;h<g;_=h++)s=a[h],u=a[_],n+=(u.x-s.x)*(s.y+u.y);return n}function In([a,n,s]){const u=$n(n+90),h=$n(s);return{x:a*Math.cos(u)*Math.sin(h),y:a*Math.sin(u)*Math.sin(h),z:a*Math.cos(h),azimuthal:n,polar:s}}function ei(a){return(typeof self<"u"||a!==void 0)&&typeof WorkerGlobalScope<"u"&&(a!==void 0?a:self)instanceof WorkerGlobalScope}function br(a){const n={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,u,h,g)=>{const _=h||g;return n[u]=!_||_.toLowerCase(),""}),n["max-age"]){const s=parseInt(n["max-age"],10);isNaN(s)?delete n["max-age"]:n["max-age"]=s}return n}let $r=null;function Cr(a,n){return[a[4*n],a[4*n+1],a[4*n+2],a[4*n+3]]}function Xr(a,n,s,u){for(;n<s;){const h=n+s>>1;a[h]<u?n=h+1:s=h}return n}function gr(a,n,s,u){for(;n<s;){const h=n+s>>1;a[h]<=u?n=h+1:s=h}return n}function ai(a){return a>0?1/(1.001-a):1+a}function _r(a){return a>0?1-1/(1.001-a):-a}function Bi(a,n,s){return(a-n.min)*(s.max-s.min)/(n.max-n.min)+s.min}const qn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!qn.API_URL)return null;try{const a=new URL(qn.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ir(a){return qn.API_URL_REGEX.test(a)}function Bs(a){return qn.API_SPRITE_REGEX.test(a)}let Ks,Po,sd,Es,ia,ro;function Pl(){return Ks==null&&(Ks=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ks}const gs={now:()=>Es!==void 0?Es:performance.now(),setNow(a){Es=a},restoreNow(){Es=void 0},frame(a){const n=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(a,n=0){const{width:s,height:u}=a;ia||(ia=document.createElement("canvas"));const h=ia.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(s>ia.width||u>ia.height)&&(ia.width=s,ia.height=u),h.clearRect(-n,-n,s+2*n,u+2*n),h.drawImage(a,0,0,s,u),h.getImageData(-n,-n,s+2*n,u+2*n)},resolveURL:a=>(Po||(Po=document.createElement("a")),Po.href=a,Po.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(sd==null&&(sd=window.matchMedia("(prefers-reduced-motion: reduce)")),sd.matches)},hasCanvasFingerprintNoise(){if(ro!==void 0)return ro;if(!Pl())return ro=!1,!1;const a=new OffscreenCanvas(85,1),n=a.getContext("2d",{willReadFrequently:!0});let s=0;for(let h=0;h<a.width;++h)n.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,n.fillRect(h,0,1,1);const u=n.getImageData(0,0,a.width,a.height);s=0;for(let h=0;h<u.data.length;++h)if(h%4!=3&&s++!==u.data[h])return ro=!0,!0;return ro=!1,!1}};function od(a,n){const s=a.indexOf("?");if(s<0)return`${a}?${new URLSearchParams(n).toString()}`;const u=new URLSearchParams(a.slice(s));for(const h in n)u.set(h,n[h]);return`${a.slice(0,s)}?${u.toString()}`}function oh(a,n={persistentParams:[]}){const s=a.indexOf("?");if(s<0)return a;const u=new URLSearchParams,h=new URLSearchParams(a.slice(s));for(const _ of n.persistentParams){const x=h.get(_);x&&u.set(_,x)}const g=u.toString();return`${a.slice(0,s)}${g.length>0?`?${g}`:""}`}const Wm="mapbox-tiles";let qm=500,Zm=50;const tp=["language","worldview","jobid"];let Rl,Ro;function rl(){try{return caches}catch{}}function sl(){const a=rl();a&&Rl==null&&(Rl=a.open(Wm))}let Ma=1/0;const Ml={supported:!1,testSupport:function(a){!Km&&ad&&(ld?wb(a):uu=a)}};let uu,ad,Km=!1,ld=!1;const Xm=typeof self<"u"?self:{};function wb(a){const n=a.createTexture();a.bindTexture(a.TEXTURE_2D,n);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,ad),a.isContextLost())return;Ml.supported=!0}catch{}a.deleteTexture(n),Km=!0}Xm.document&&(ad=Xm.document.createElement("img"),ad.onload=function(){uu&&wb(uu),uu=null,ld=!0},ad.onerror=function(){Km=!0,uu=null},ad.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const np={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(np);class Go extends Error{constructor(n,s,u){s===401&&Ir(u)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=s,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ym=ei()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,cd=function(a,n){if(!(/^file:/.test(s=a.url)||/^file:/.test(Ym())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,h){const g=new AbortController,_=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Ym(),referrerPolicy:u.referrerPolicy,signal:g.signal});let x=!1,T=!1;const C=(R=_.url).indexOf("sku=")>0&&Ir(R);var R;u.type==="json"&&_.headers.set("Accept","application/json");const M=(O,j,G)=>{if(T)return;if(O&&O.message!=="SecurityError"&&Nt(O.toString()),j&&G)return D(j);const X=Date.now();fetch(_).then(K=>{if(K.ok){const se=C?K.clone():null;return D(K,se,X)}return h(new Go(K.statusText,K.status,u.url))}).catch(K=>{K.name!=="AbortError"&&h(new Error(`${K.message} ${u.url}`))})},D=(O,j,G)=>{(u.type==="arrayBuffer"?O.arrayBuffer():u.type==="json"?O.json():O.text()).then(X=>{T||(j&&G&&function(K,se,ae){if(sl(),Rl==null)return;const de=br(se.headers.get("Cache-Control")||"");if(de["no-store"])return;const ve={status:se.status,statusText:se.statusText,headers:new Headers};se.headers.forEach((Ie,Re)=>ve.headers.set(Re,Ie)),de["max-age"]&&ve.headers.set("Expires",new Date(ae+1e3*de["max-age"]).toUTCString());const me=ve.headers.get("Expires");if(!me||new Date(me).getTime()-ae<42e4)return;let Te=oh(K.url,{persistentParams:tp});if(se.status===206){const Ie=K.headers.get("Range");if(!Ie)return;ve.status=200,Te=od(Te,{range:Ie})}(function(Ie,Re){if(Ro===void 0)try{new Response(new ReadableStream),Ro=!0}catch{Ro=!1}Ro?Re(Ie.body):Ie.blob().then(Re).catch(qe=>Nt(qe.message))})(se,Ie=>{const Re=new Response((qe=se.status)!==200&&qe!==404&&[101,103,204,205,304].includes(qe)?null:Ie,ve);var qe;sl(),Rl!=null&&Rl.then(Ne=>Ne.put(Te,Re)).catch(Ne=>Nt(Ne.message))})}(_,j,G),x=!0,h(null,X,O.headers))}).catch(X=>{T||h(new Error(X.message))})};return C?function(O,j){if(sl(),Rl==null)return j(null);Rl.then(G=>{let X=oh(O.url,{persistentParams:tp});const K=O.headers.get("Range");K&&(X=od(X,{range:K})),G.match(X).then(se=>{const ae=function(de){if(!de)return!1;const ve=new Date(de.headers.get("Expires")||0),me=br(de.headers.get("Cache-Control")||"");return Number(ve)>Date.now()&&!me["no-cache"]}(se);G.delete(X).catch(j),ae&&G.put(X,se.clone()).catch(j),j(null,se,ae)}).catch(j)}).catch(j)}(_,M):M(null,null),{cancel:()=>{T=!0,x||g.abort()}}}(a,n);if(ei(self)&&self.worker.actor)return self.worker.actor.send("getResource",a,n,void 0,!0)}var s;return function(u,h){const g=new XMLHttpRequest;g.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const _ in u.headers)g.setRequestHeader(_,u.headers[_]);return u.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=u.credentials==="include",g.onerror=()=>{h(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let _=g.response;if(u.type==="json")try{_=JSON.parse(g.response)}catch(T){return h(T)}const x=new Headers;g.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(T=>{const C=T.split(": "),R=C.shift(),M=C.join(": ");x.append(R,M)}),h(null,_,x)}else h(new Go(g.statusText,g.status,u.url))},g.send(u.body),{cancel:()=>g.abort()}}(a,n)},ac=function(a,n){return cd(Object.assign(a,{type:"arrayBuffer"}),n)};function fI(a){const n=document.createElement("a");return n.href=a,n.protocol===location.protocol&&n.host===location.host}const Tb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ip,li;ip=[],li=0;const Qm=function(a,n){if(Ml.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),li>=qn.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:a,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return ip.push(g),g}li++;let s=!1;const u=()=>{if(!s)for(s=!0,li--;ip.length&&li<qn.MAX_PARALLEL_IMAGE_REQUESTS;){const g=ip.shift(),{requestParameters:_,callback:x,cancelled:T}=g;T||(g.cancel=Qm(_,x).cancel)}},h=ac(a,(g,_,x)=>{u(),g?n(g):_&&(self.createImageBitmap?function(T,C){const R=new Blob([new Uint8Array(T)],{type:"image/png"});createImageBitmap(R).then(M=>{C(null,M)}).catch(M=>{C(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(T,C)=>n(T,C,x)):function(T,C){const R=new Image;R.onload=()=>{C(null,R),URL.revokeObjectURL(R.src),R.onload=null,requestAnimationFrame(()=>{R.src=Tb})},R.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(T)],{type:"image/png"});R.src=T.byteLength?URL.createObjectURL(M):Tb}(_,(T,C)=>n(T,C,x)))});return{cancel:()=>{h.cancel(),u()}}};var pv,Eb,Sb,du={exports:{}},rp={exports:{}},sp={exports:{}},mv=function(){if(Sb)return du.exports;Sb=1;var a=(pv||(pv=1,rp.exports=function(s,u){var h,g,_,x,T,C,R,M;for(g=s.length-(h=3&s.length),_=u,T=3432918353,C=461845907,M=0;M<g;)R=255&s.charCodeAt(M)|(255&s.charCodeAt(++M))<<8|(255&s.charCodeAt(++M))<<16|(255&s.charCodeAt(++M))<<24,++M,_=27492+(65535&(x=5*(65535&(_=(_^=R=(65535&(R=(R=(65535&R)*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*C+(((R>>>16)*C&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(R=0,h){case 3:R^=(255&s.charCodeAt(M+2))<<16;case 2:R^=(255&s.charCodeAt(M+1))<<8;case 1:_^=R=(65535&(R=(R=(65535&(R^=255&s.charCodeAt(M)))*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*C+(((R>>>16)*C&65535)<<16)&4294967295}return _^=s.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),rp.exports),n=(Eb||(Eb=1,sp.exports=function(s,u){for(var h,g=s.length,_=u^g,x=0;g>=4;)h=1540483477*(65535&(h=255&s.charCodeAt(x)|(255&s.charCodeAt(++x))<<8|(255&s.charCodeAt(++x))<<16|(255&s.charCodeAt(++x))<<24))+((1540483477*(h>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),g-=4,++x;switch(g){case 3:_^=(255&s.charCodeAt(x+2))<<16;case 2:_^=(255&s.charCodeAt(x+1))<<8;case 1:_=1540483477*(65535&(_^=255&s.charCodeAt(x)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),sp.exports);return du.exports=a,du.exports.murmur3=a,du.exports.murmur2=n,du.exports}(),Jm=er(mv);class kl{constructor(n,...s){Object.assign(this,s[0]||{}),this.type=n}}class op extends kl{constructor(n,s={}){super("error",Object.assign({error:n},s))}}function gv(a,n,s){s[a]&&s[a].indexOf(n)!==-1||(s[a]=s[a]||[],s[a].push(n))}function hu(a,n,s){if(s&&s[a]){const u=s[a].indexOf(n);u!==-1&&s[a].splice(u,1)}}class ud{on(n,s){return this._listeners=this._listeners||{},gv(n,s,this._listeners),this}off(n,s){return hu(n,s,this._listeners),hu(n,s,this._oneTimeListeners),this}once(n,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},gv(n,s,this._oneTimeListeners),this):new Promise(u=>{this.once(n,u)})}fire(n,s){const u=typeof n=="string"?new kl(n,s):n,h=u.type;if(this.listens(h)){u.target=this;const g=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const T of g)T.call(this,u);const _=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const T of _)hu(h,T,this._oneTimeListeners),T.call(this,u);const x=this._eventedParent;if(x){const T=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(u,T),x.fire(u)}}else u instanceof op&&console.error(u.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,s){return this._eventedParent=n,this._eventedParentData=s,this}}class so{constructor(n){typeof n=="string"?this.name=n:(this.name=n.name,this.iconsetId=n.iconsetId)}static from(n){return new so(n)}static toString(n){return n.iconsetId?`${n.name}${n.iconsetId}`:n.name}static parse(n){const[s,u]=n.split("");return new so({name:s,iconsetId:u})}static isEqual(n,s){return n.name===s.name&&n.iconsetId===s.iconsetId}toString(){return so.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var eg,ap={},ka=function(){if(eg)return ap;eg=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(g){return(g=Math.round(g))<0?0:g>255?255:g}function s(g){return n(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function u(g){return(_=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:_>1?1:_;var _}function h(g,_,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?g+(_-g)*x*6:2*x<1?_:3*x<2?g+(_-g)*(2/3-x)*6:g}try{ap.parseCSSColor=function(g){var _,x=g.replace(/ /g,"").toLowerCase();if(x in a)return a[x].slice();if(x[0]==="#")return x.length===4?(_=parseInt(x.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:x.length===7&&(_=parseInt(x.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var T=x.indexOf("("),C=x.indexOf(")");if(T!==-1&&C+1===x.length){var R=x.substr(0,T),M=x.substr(T+1,C-(T+1)).split(","),D=1;switch(R){case"rgba":if(M.length!==4)return null;D=u(M.pop());case"rgb":return M.length!==3?null:[s(M[0]),s(M[1]),s(M[2]),D];case"hsla":if(M.length!==4)return null;D=u(M.pop());case"hsl":if(M.length!==3)return null;var O=(parseFloat(M[0])%360+360)%360/360,j=u(M[1]),G=u(M[2]),X=G<=.5?G*(j+1):G+j-G*j,K=2*G-X;return[n(255*h(K,X,O+1/3)),n(255*h(K,X,O)),n(255*h(K,X,O-1/3)),D];default:return null}}return null}}catch{}return ap}();class Si{constructor(n,s,u,h=1){this.r=n,this.g=s,this.b=u,this.a=h}static parse(n){if(!n)return;if(n instanceof Si)return n;if(typeof n!="string")return;const s=ka.parseCSSColor(n);return s?new Si(s[0]/255,s[1]/255,s[2]/255,s[3]):void 0}toString(){const[n,s,u,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*n)},${Math.round(255*s)},${Math.round(255*u)},${h})`}toNonPremultipliedRenderColor(n){const{r:s,g:u,b:h,a:g}=this;return new Ib(n,s,u,h,g)}toPremultipliedRenderColor(n){const{r:s,g:u,b:h,a:g}=this;return new Ab(n,s*g,u*g,h*g,g)}clone(){return new Si(this.r,this.g,this.b,this.a)}}class Cb{constructor(n,s,u,h,g,_=!1){if(this.premultiplied=!1,this.premultiplied=_,n){const x=n.image.height,T=x*x;this.premultiplied?(s=g===0?0:s/g*(x-1),u=g===0?0:u/g*(x-1),h=g===0?0:h/g*(x-1)):(s*=x-1,u*=x-1,h*=x-1);const C=Math.floor(s),R=Math.floor(u),M=Math.floor(h),D=Math.ceil(s),O=Math.ceil(u),j=Math.ceil(h),G=s-C,X=u-R,K=h-M,se=n.image.data,ae=4*(C+R*T+M*x),de=4*(C+R*T+j*x),ve=4*(C+O*T+M*x),me=4*(C+O*T+j*x),Te=4*(D+R*T+M*x),Ie=4*(D+R*T+j*x),Re=4*(D+O*T+M*x),qe=4*(D+O*T+j*x);if(ae<0||qe>=se.length)throw new Error("out of range");this.r=fn(fn(fn(se[ae],se[de],K),fn(se[ve],se[me],K),X),fn(fn(se[Te],se[Ie],K),fn(se[Re],se[qe],K),X),G)/255*(this.premultiplied?g:1),this.g=fn(fn(fn(se[ae+1],se[de+1],K),fn(se[ve+1],se[me+1],K),X),fn(fn(se[Te+1],se[Ie+1],K),fn(se[Re+1],se[qe+1],K),X),G)/255*(this.premultiplied?g:1),this.b=fn(fn(fn(se[ae+2],se[de+2],K),fn(se[ve+2],se[me+2],K),X),fn(fn(se[Te+2],se[Ie+2],K),fn(se[Re+2],se[qe+2],K),X),G)/255*(this.premultiplied?g:1),this.a=g}else this.r=s,this.g=u,this.b=h,this.a=g}toArray(){const{r:n,g:s,b:u,a:h}=this;return[255*n,255*s,255*u,h]}toHslaArray(){let{r:n,g:s,b:u,a:h}=this;if(this.premultiplied){if(h===0)return[0,0,0,0];const j=1/h;n*=j,s*=j,u*=j}const g=Math.min(Math.max(n,0),1),_=Math.min(Math.max(s,0),1),x=Math.min(Math.max(u,0),1),T=Math.min(g,_,x),C=Math.max(g,_,x),R=C-T,M=.5*(T+C);if(R===0)return[0,0,100*M,h];const D=M>.5?R/(2-C-T):R/(C+T);let O;switch(C){case g:O=60*((_-x)/R+(_<x?6:0));break;case _:O=60*((x-g)/R+2);break;default:O=60*((g-_)/R+4)}return[O,100*D,100*M,h]}toArray01(){const{r:n,g:s,b:u,a:h}=this;return[n,s,u,h]}toArray01Scaled(n){const{r:s,g:u,b:h}=this;return[s*n,u*n,h*n]}toArray01Linear(){const{r:n,g:s,b:u,a:h}=this;return[Math.pow(n,2.2),Math.pow(s,2.2),Math.pow(u,2.2),h]}}class Ib extends Cb{constructor(n,s,u,h,g){super(n,s,u,h,g,!1)}}class Ab extends Cb{constructor(n,s,u,h,g){super(n,s,u,h,g,!0)}}function fn(a,n,s){return a*(1-s)+n*s}function _v(a,n,s){return a.map((u,h)=>fn(u,n[h],s))}Si.black=new Si(0,0,0,1),Si.white=new Si(1,1,1,1),Si.transparent=new Si(0,0,0,0),Si.red=new Si(1,0,0,1),Si.blue=new Si(0,0,1,1);var lp=Object.freeze({__proto__:null,array:_v,color:function(a,n,s){return new Si(fn(a.r,n.r,s),fn(a.g,n.g,s),fn(a.b,n.b,s),fn(a.a,n.a,s))},number:fn});class Da extends Error{constructor(n,s){super(s),this.message=s,this.key=n}}class ah{constructor(n,s=[]){this.parent=n,this.bindings={};for(const[u,h]of s)this.bindings[u]=h}concat(n){return new ah(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const ol={kind:"null"},Jt={kind:"number"},Jn={kind:"string"},Pi={kind:"boolean"},Mo={kind:"color"},Dl={kind:"object"},wi={kind:"value"},tg={kind:"collator"},cp={kind:"formatted"},up={kind:"resolvedImage"};function Xs(a,n){return{kind:"array",itemType:a,N:n}}function Gr(a){if(a.kind==="array"){const n=Gr(a.itemType);return typeof a.N=="number"?`array<${n}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${n}>`}return a.kind}const pI=[ol,Jt,Jn,Pi,Mo,cp,Dl,Xs(wi),up];function fu(a,n){if(n.kind==="error")return null;if(a.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!fu(a.itemType,n.itemType))&&(typeof a.N!="number"||a.N===n.N))return null}else{if(a.kind===n.kind)return null;if(a.kind==="value"){for(const s of pI)if(!fu(s,n))return null}}return`Expected ${Gr(a)} but found ${Gr(n)} instead.`}function yv(a,n){return n.some(s=>s.kind===a.kind)}function dp(a,n){return n.some(s=>s==="null"?a===null:s==="array"?Array.isArray(a):s==="object"?a&&!Array.isArray(a)&&typeof a=="object":s===typeof a)}function ng(a,n){return a.kind==="array"&&n.kind==="array"?a.N===n.N&&ng(a.itemType,n.itemType):a.kind===n.kind}class vv{constructor(n,s,u){this.sensitivity=n?s?"variant":"case":s?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,s){return this.collator.compare(n,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ig{constructor(n,s,u,h,g){this.text=n.normalize?n.normalize():n,this.image=s,this.scale=u,this.fontStack=h,this.textColor=g}}class go{constructor(n){this.sections=n}static fromString(n){return new go([new ig(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||!!n.image&&n.image.hasPrimary())}static factory(n){return n instanceof go?n:go.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const s of this.sections){if(s.image){const h=s.image.getPrimary().id.toString();n.push(["image",h]);continue}n.push(s.text);const u={};s.fontStack&&(u["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(u["font-scale"]=s.scale),s.textColor&&(u["text-color"]=["rgba"].concat(s.textColor.toNonPremultipliedRenderColor(null).toArray())),n.push(u)}return n}}class lc{constructor(n,s={}){this.id=so.from(n),this.params=s.params,this.sx=s.sx||1,this.sy=s.sy||1}toString(){return JSON.stringify(this)}static parse(n){let s,u,h,g;try{({id:s,params:u,sx:h,sy:g}=JSON.parse(n)||{})}catch{return null}return s?new lc(s,{params:u,sx:h,sy:g}):null}scaleSelf(n,s=n){return this.sx*=n,this.sy*=s,this}}class _o{constructor(n,s,u,h,g=!1){this.primaryId=so.from(n),this.primaryOptions=s,u&&(this.secondaryId=so.from(u)),this.secondaryOptions=h,this.available=g}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new lc(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new lc(this.secondaryId,this.secondaryOptions):null}static from(n){return typeof n=="string"?_o.build({name:n}):n}static build(n,s,u,h){return!n||typeof n=="object"&&!("name"in n)?null:new _o(n,u,s,h)}}function dd(a,n,s,u){return typeof a=="number"&&a>=0&&a<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof s=="number"&&s>=0&&s<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[a,n,s,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[a,n,s,u]:[a,n,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function lh(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Si||a instanceof vv||a instanceof go||a instanceof _o)return!0;if(Array.isArray(a)){for(const n of a)if(!lh(n))return!1;return!0}if(typeof a=="object"){for(const n in a)if(!lh(a[n]))return!1;return!0}return!1}function _s(a){if(a===null)return ol;if(typeof a=="string")return Jn;if(typeof a=="boolean")return Pi;if(typeof a=="number")return Jt;if(a instanceof Si)return Mo;if(a instanceof vv)return tg;if(a instanceof go)return cp;if(a instanceof _o)return up;if(Array.isArray(a)){const n=a.length;let s;for(const u of a){const h=_s(u);if(s){if(s===h)continue;s=wi;break}s=h}return Xs(s||wi,n)}return Dl}function Na(a){const n=typeof a;return a===null?"":n==="string"||n==="number"||n==="boolean"?String(a):a instanceof go||a instanceof _o||a instanceof Si?a.toString():JSON.stringify(a)}class cc{constructor(n,s){this.type=n,this.value=s}static parse(n,s){if(n.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!lh(n[1]))return s.error("invalid value");const u=n[1];let h=_s(u);const g=s.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new cc(h,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Si?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof go?this.value.serialize():this.value}}class cs{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const xv={string:Jn,number:Jt,boolean:Pi,object:Dl};class al{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");let u,h=1;const g=n[0];if(g==="array"){let x,T;if(n.length>2){const C=n[1];if(typeof C!="string"||!(C in xv)||C==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);x=xv[C],h++}else x=wi;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return s.error('The length argument to "array" must be a positive integer literal',2);T=n[2],h++}u=Xs(x,T)}else u=xv[g];const _=[];for(;h<n.length;h++){const x=s.parse(n[h],h,wi);if(!x)return null;_.push(x)}return new al(u,_)}evaluate(n){for(let s=0;s<this.args.length;s++){const u=this.args[s].evaluate(n);if(!fu(this.type,_s(u)))return u;if(s===this.args.length-1)throw new cs(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${Gr(_s(u))} but was expected to be of type ${Gr(this.type)}.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,s=[n.kind];if(n.kind==="array"){const u=n.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){s.push(u.kind);const h=n.N;(typeof h=="number"||this.args.length>1)&&s.push(h)}}return s.concat(this.args.map(u=>u.serialize()))}}class Nl{constructor(n){this.type=cp,this.sections=n}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const u=n[1];if(!Array.isArray(u)&&typeof u=="object")return s.error("First argument must be an image or text section.");const h=[];let g=!1;for(let _=1;_<=n.length-1;++_){const x=n[_];if(g&&typeof x=="object"&&!Array.isArray(x)){g=!1;let T=null;if(x["font-scale"]&&(T=s.parseObjectValue(x["font-scale"],_,"font-scale",Jt),!T))return null;let C=null;if(x["text-font"]&&(C=s.parseObjectValue(x["text-font"],_,"text-font",Xs(Jn)),!C))return null;let R=null;if(x["text-color"]&&(R=s.parseObjectValue(x["text-color"],_,"text-color",Mo),!R))return null;const M=h[h.length-1];M.scale=T,M.font=C,M.textColor=R}else{const T=s.parse(n[_],_,wi);if(!T)return null;const C=T.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:T,scale:null,font:null,textColor:null})}}return new Nl(h)}evaluate(n){return new go(this.sections.map(s=>{const u=s.content.evaluate(n);return ng(_s(u),up)?new ig("",u,null,null,null):new ig(Na(u),null,s.scale?s.scale.evaluate(n):null,s.font?s.font.evaluate(n).join(","):null,s.textColor?s.textColor.evaluate(n):null)}))}eachChild(n){for(const s of this.sections)n(s.content),s.scale&&n(s.scale),s.font&&n(s.font),s.textColor&&n(s.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const s of this.sections){n.push(s.content.serialize());const u={};s.scale&&(u["font-scale"]=s.scale.serialize()),s.font&&(u["text-font"]=s.font.serialize()),s.textColor&&(u["text-color"]=s.textColor.serialize()),n.push(u)}return n}}class Rn{constructor(n,s,u,h){this._imageWarnHistory={},this.type=up,this.namePrimary=n,this.nameSecondary=s,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),h&&(this.paramsSecondary=h.params,this.iconsetIdSecondary=h.iconset?h.iconset.id:void 0)}static parse(n,s){if(n.length<2)return s.error("Expected two or more arguments.");let u=1;const h=[];function g(){if(u<n.length){const x=s.parse(n[u],u++,Jn);return x?(h.push({image:x,options:{}}),!0):(s.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(u<n.length){const T=n[u];if((x=T)===null||typeof x!="object"||Array.isArray(x))return!0;const C=T.params,R=T.iconset,M=s.concat(u);if(!C&&!R)return u++,!0;if(C){if(typeof C!="object"||C.constructor!==Object)return M.error('Image options "params" should be an object'),!1;const D={},O=M.concat(void 0,"params");for(const j in C){if(!j)return O.error("Image parameter name should be non-empty"),!1;const G=O.concat(void 0,j).parse(C[j],void 0,Mo,void 0,{typeAnnotation:"coerce"});if(!G)return!1;D[j]=G}h[h.length-1].options.params=D}if(R){if(typeof R!="object"||R.constructor!==Object)return M.error('Image options "iconset" should be an object'),!1;if(!R.id)return M.error('Image options "iconset" should have an "id" property'),!1;h[h.length-1].options.iconset=R}return u++,!0}var x;return!0}for(let x=0;x<2;x++)if(!g()||!_())return;return new Rn(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(n,s){const u={};if(s){for(const h in s)if(s[h])try{u[h]=s[h].evaluate(n)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(n){const s={name:this.namePrimary.evaluate(n),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(n),iconsetId:this.iconsetIdSecondary}:void 0,h=_o.build(s,u,this.paramsPrimary?this.evaluateParams(n,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(n,this.paramsSecondary):void 0);if(h&&n.availableImages){const g=h.getPrimary().id;if(h.available=n.availableImages.some(_=>so.isEqual(_,g)),h.available){const _=h.getSecondary()?h.getSecondary().id:null;_&&(h.available=n.availableImages.some(x=>so.isEqual(x,_)))}}return h}eachChild(n){if(n(this.namePrimary),this.paramsPrimary)for(const s in this.paramsPrimary)this.paramsPrimary[s]&&n(this.paramsPrimary[s]);if(this.nameSecondary&&(n(this.nameSecondary),this.paramsSecondary))for(const s in this.paramsSecondary)this.paramsSecondary[s]&&n(this.paramsSecondary[s])}outputDefined(){return!1}serializeOptions(n,s){const u={};if(s&&(u.iconset={id:s}),n){u.params={};for(const h in n)n[h]&&(u.params[h]=n[h].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const n=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const s=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);s&&n.push(s)}if(this.nameSecondary&&(n.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const s=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);s&&n.push(s)}return n}}function Xt(a){return yn(a)?"string":ch(a)?"number":sg(a)?"boolean":Array.isArray(a)?"array":a===null?"null":rg(a)?"object":typeof a}function rg(a){return a!=null&&!Array.isArray(a)&&typeof a!="function"&&!(a instanceof String||a instanceof Number||a instanceof Boolean)&&typeof a=="object"}function yn(a){return typeof a=="string"||a instanceof String}function ch(a){return typeof a=="number"||a instanceof Number}function sg(a){return typeof a=="boolean"||a instanceof Boolean}const mn={"to-boolean":Pi,"to-color":Mo,"to-number":Jt,"to-string":Jn};class Ll{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const u=n[0],h=[];let g=ol;if(u==="to-array"){if(!Array.isArray(n[1]))return null;const _=n[1].length;if(s.expectedType){if(s.expectedType.kind!=="array")return s.error(`Expected ${s.expectedType.kind} but found array.`);g=Xs(s.expectedType.itemType,_)}else{if(!(_>0&&lh(n[1][0])))return null;g=Xs(_s(n[1][0]),_)}for(let x=0;x<_;x++){const T=n[1][x];let C;if(Array.isArray(T))C=s.parse(T,void 0,g.itemType);else{const R=Xt(T);if(R!==g.itemType.kind)return s.error(`Expected ${g.itemType.kind} but found ${R}.`);C=s.registry.literal.parse(["literal",T===void 0?null:T],s)}if(!C)return null;h.push(C)}}else{if((u==="to-boolean"||u==="to-string")&&n.length!==2)return s.error("Expected one argument.");g=mn[u];for(let _=1;_<n.length;_++){const x=s.parse(n[_],_,wi);if(!x)return null;h.push(x)}}return new Ll(g,h)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let s,u;for(const h of this.args){if(s=h.evaluate(n),u=null,s instanceof Si)return s;if(typeof s=="string"){const g=n.parseColor(s);if(g)return g}else if(Array.isArray(s)&&(u=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:dd(s[0],s[1],s[2],s[3]),!u))return new Si(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new cs(u||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const u of this.args){if(s=u.evaluate(n),s===null)return 0;const h=Number(s);if(!isNaN(h))return h}throw new cs(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?go.fromString(Na(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?_o.build(Na(this.args[0].evaluate(n))):this.type.kind==="array"?this.args.map(s=>s.evaluate(n)):Na(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Nl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Rn(this.args[0]).serialize();const n=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{n.push(s.serialize())}),n}}const bv=["Unknown","Point","LineString","Polygon"];class og{constructor(n,s,u){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=n,this.options=s,this.iconImageUseTheme=u}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?bv[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(n){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:u,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*s-n[0])+this.featureDistanceData.bearing[1]*(h*s-n[1])}return 0}parseColor(n){let s=this._parseColorCache[n];return s||(s=this._parseColorCache[n]=Si.parse(n)),s}getConfig(n){return this.options?this.options.get(n):null}}class yo{constructor(n,s,u,h,g){this.name=n,this.type=s,this._evaluate=u,this.args=h,this._overloadIndex=g}evaluate(n){if(!this._evaluate){const s=yo.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,s){const u=n[0],h=yo.definitions[u];if(!h)return s.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=[];let T=null,C=-1;for(const[R,M]of _){if(Array.isArray(R)&&R.length!==n.length-1)continue;x.push(R),C++,T=new yg(s.registry,s.path,null,s.scope,void 0,s._scope,s.options,s.iconImageUseTheme);const D=[];let O=!1;for(let j=1;j<n.length;j++){const G=n[j],X=Array.isArray(R)?R[j-1]:R.type,K=T.parse(G,1+D.length,X);if(!K){O=!0;break}D.push(K)}if(!O)if(Array.isArray(R)&&R.length!==D.length)T.error(`Expected ${R.length} arguments, but found ${D.length} instead.`);else{for(let j=0;j<D.length;j++){const G=Array.isArray(R)?R[j]:R.type,X=D[j];T.concat(j+1).checkSubtype(G,X.type)}if(T.errors.length===0)return new yo(u,g,M,D,C)}}if(x.length===1)s.errors.push(...T.errors);else{const R=(x.length?x:_.map(([D])=>D)).map(ag).join(" | "),M=[];for(let D=1;D<n.length;D++){const O=s.parse(n[D],1+M.length);if(!O)return null;M.push(Gr(O.type))}s.error(`Expected arguments of type ${R}, but found (${M.join(", ")}) instead.`)}return null}static register(n,s){yo.definitions=s;for(const u in s)n[u]=yo}}function ag(a){return Array.isArray(a)?`(${a.map(Gr).join(", ")})`:`(${Gr(a.type)}...)`}class Ss{constructor(n,s,u){this.type=tg,this.locale=u,this.caseSensitive=n,this.diacriticSensitive=s}static parse(n,s){if(n.length!==2)return s.error("Expected one argument.");const u=n[1];if(typeof u!="object"||Array.isArray(u))return s.error("Collator options argument must be an object.");const h=u["case-sensitive"]===void 0?s.parse(!1,1,Pi):s.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Pi);if(!h)return null;const g=u["diacritic-sensitive"]===void 0?s.parse(!1,1,Pi):s.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Pi);if(!g)return null;let _=null;return u.locale&&(_=s.parseObjectValue(u.locale,1,"locale",Jn),!_)?null:new Ss(h,g,_)}evaluate(n){return new vv(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}function lg(a,n,s=0,u=a.length-1,h=wv){for(;u>s;){if(u-s>600){const T=u-s+1,C=n-s+1,R=Math.log(T),M=.5*Math.exp(2*R/3),D=.5*Math.sqrt(R*M*(T-M)/T)*(C-T/2<0?-1:1);lg(a,n,Math.max(s,Math.floor(n-C*M/T+D)),Math.min(u,Math.floor(n+(T-C)*M/T+D)),h)}const g=a[n];let _=s,x=u;for(ll(a,s,n),h(a[u],g)>0&&ll(a,s,u);_<x;){for(ll(a,_,x),_++,x--;h(a[_],g)<0;)_++;for(;h(a[x],g)>0;)x--}h(a[s],g)===0?ll(a,s,x):(x++,ll(a,x,u)),x<=n&&(s=x+1),n<=x&&(u=x-1)}}function ll(a,n,s){const u=a[n];a[n]=a[s],a[s]=u}function wv(a,n){return a<n?-1:a>n?1:0}function pu(a){let n=0;for(let s,u,h=0,g=a.length,_=g-1;h<g;_=h++)s=a[h],u=a[_],n+=(u.x-s.x)*(s.y+u.y);return n}function La(a,n){a[0]=Math.min(a[0],n[0]),a[1]=Math.min(a[1],n[1]),a[2]=Math.max(a[2],n[0]),a[3]=Math.max(a[3],n[1])}function hp(a,n){return!(a[0]<=n[0]||a[2]>=n[2]||a[1]<=n[1]||a[3]>=n[3])}function mI(a,n,s){const u=a[0]-n[0],h=a[1]-n[1],g=a[0]-s[0],_=a[1]-s[1];return u*_-g*h==0&&u*g<=0&&h*_<=0}function uh(a,n,s=!1){let u=!1;for(let x=0,T=n.length;x<T;x++){const C=n[x];for(let R=0,M=C.length,D=M-1;R<M;D=R++){const O=C[D],j=C[R];if(mI(a,O,j))return s;(g=O)[1]>(h=a)[1]!=(_=j)[1]>h[1]&&h[0]<(_[0]-g[0])*(h[1]-g[1])/(_[1]-g[1])+g[0]&&(u=!u)}}var h,g,_;return u}function fp(a,n,s,u){const h=u[0]-s[0],g=u[1]-s[1],_=(a[0]-s[0])*g-h*(a[1]-s[1]),x=(n[0]-s[0])*g-h*(n[1]-s[1]);return _>0&&x<0||_<0&&x>0}function pp(a,n,s,u){return(h=[u[0]-s[0],u[1]-s[1]])[0]*(g=[n[0]-a[0],n[1]-a[1]])[1]-h[1]*g[0]!=0&&!(!fp(a,n,s,u)||!fp(s,u,a,n));var h,g}function uc(a){const n=new st(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=new st(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of a[0])n.x>u.x&&(n.x=u.x),n.y>u.y&&(n.y=u.y),s.x<u.x&&(s.x=u.x),s.y<u.y&&(s.y=u.y);return{min:n,max:s}}const mu=8192;function gI(a,n){const s=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,h=Math.pow(2,n.z);return[Math.round(s*h*mu),Math.round(u*h*mu)]}function Tv(a,n){for(let s=0;s<n.length;s++)if(uh(a,n[s]))return!0;return!1}function _I(a,n,s){for(const u of s)for(let h=0,g=u.length,_=g-1;h<g;_=h++)if(pp(a,n,u[_],u[h]))return!0;return!1}function Pb(a,n){for(let s=0;s<a.length;++s)if(!uh(a[s],n))return!1;for(let s=0;s<a.length-1;++s)if(_I(a[s],a[s+1],n))return!1;return!0}function Rb(a,n){for(let s=0;s<n.length;s++)if(Pb(a,n[s]))return!0;return!1}function Ev(a,n,s){const u=[];for(let h=0;h<a.length;h++){const g=[];for(let _=0;_<a[h].length;_++){const x=gI(a[h][_],s);La(n,x),g.push(x)}u.push(g)}return u}function gu(a,n,s){const u=[];for(let h=0;h<a.length;h++){const g=Ev(a[h],n,s);u.push(g)}return u}function Mb(a,n,s,u){if(a[0]<s[0]||a[0]>s[2]){const h=.5*u;let g=a[0]-s[0]>h?-u:s[0]-a[0]>h?u:0;g===0&&(g=a[0]-s[2]>h?-u:s[2]-a[0]>h?u:0),a[0]+=g}La(n,a)}function kb(a,n,s,u){const h=Math.pow(2,u.z)*mu,g=[u.x*mu,u.y*mu],_=[];if(!a)return _;for(const x of a)for(const T of x){const C=[T.x+g[0],T.y+g[1]];Mb(C,n,s,h),_.push(C)}return _}function cg(a,n,s,u){const h=Math.pow(2,u.z)*mu,g=[u.x*mu,u.y*mu],_=[];if(!a)return _;for(const T of a){const C=[];for(const R of T){const M=[R.x+g[0],R.y+g[1]];La(n,M),C.push(M)}_.push(C)}if(n[2]-n[0]<=h/2){(x=n)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const T of _)for(const C of T)Mb(C,n,s,h)}var x;return _}class _u{constructor(n,s){this.type=Pi,this.geojson=n,this.geometries=s}static parse(n,s){if(n.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(lh(n[1])){const u=n[1];if(u.type==="FeatureCollection")for(let h=0;h<u.features.length;++h){const g=u.features[h].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new _u(u,u.features[h].geometry)}else if(u.type==="Feature"){const h=u.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new _u(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new _u(u,u)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(s,u){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if(!_)return!1;if(u.type==="Polygon"){const x=Ev(u.coordinates,g,_),T=kb(s.geometry(),h,g,_);if(!hp(h,g))return!1;for(const C of T)if(!uh(C,x))return!1}if(u.type==="MultiPolygon"){const x=gu(u.coordinates,g,_),T=kb(s.geometry(),h,g,_);if(!hp(h,g))return!1;for(const C of T)if(!Tv(C,x))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(s,u){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if(!_)return!1;if(u.type==="Polygon"){const x=Ev(u.coordinates,g,_),T=cg(s.geometry(),h,g,_);if(!hp(h,g))return!1;for(const C of T)if(!Pb(C,x))return!1}if(u.type==="MultiPolygon"){const x=gu(u.coordinates,g,_),T=cg(s.geometry(),h,g,_);if(!hp(h,g))return!1;for(const C of T)if(!Rb(C,x))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const mp={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Oa=1/298.257223563,Db=Oa*(2-Oa),dh=Math.PI/180;class hh{static fromTile(n,s,u){const h=Math.PI*(1-2*(n+.5)/Math.pow(2,s)),g=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/dh;return new hh(g,u)}static get units(){return mp}constructor(n,s){if(n===void 0)throw new Error("No latitude given.");if(s&&!mp[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(mp).join(", ")}`);const u=6378.137*dh*(s?mp[s]:1),h=Math.cos(n*dh),g=1/(1-Db*(1-h*h)),_=Math.sqrt(g);this.kx=u*_*h,this.ky=u*_*g*(1-Db)}distance(n,s){const u=ra(n[0]-s[0])*this.kx,h=(n[1]-s[1])*this.ky;return Math.sqrt(u*u+h*h)}bearing(n,s){const u=ra(s[0]-n[0])*this.kx;return Math.atan2(u,(s[1]-n[1])*this.ky)/dh}destination(n,s,u){const h=u*dh;return this.offset(n,Math.sin(h)*s,Math.cos(h)*s)}offset(n,s,u){return[n[0]+s/this.kx,n[1]+u/this.ky]}lineDistance(n){let s=0;for(let u=0;u<n.length-1;u++)s+=this.distance(n[u],n[u+1]);return s}area(n){let s=0;for(let u=0;u<n.length;u++){const h=n[u];for(let g=0,_=h.length,x=_-1;g<_;x=g++)s+=ra(h[g][0]-h[x][0])*(h[g][1]+h[x][1])*(u?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(n,s){let u=0;if(s<=0)return n[0];for(let h=0;h<n.length-1;h++){const g=n[h],_=n[h+1],x=this.distance(g,_);if(u+=x,u>s)return ug(g,_,(s-(u-x))/x)}return n[n.length-1]}pointToSegmentDistance(n,s,u){let[h,g]=s,_=ra(u[0]-h)*this.kx,x=(u[1]-g)*this.ky;if(_!==0||x!==0){const T=(ra(n[0]-h)*this.kx*_+(n[1]-g)*this.ky*x)/(_*_+x*x);T>1?(h=u[0],g=u[1]):T>0&&(h+=_/this.kx*T,g+=x/this.ky*T)}return _=ra(n[0]-h)*this.kx,x=(n[1]-g)*this.ky,Math.sqrt(_*_+x*x)}pointOnLine(n,s){let u=1/0,h=n[0][0],g=n[0][1],_=0,x=0;for(let T=0;T<n.length-1;T++){let C=n[T][0],R=n[T][1],M=ra(n[T+1][0]-C)*this.kx,D=(n[T+1][1]-R)*this.ky,O=0;M===0&&D===0||(O=(ra(s[0]-C)*this.kx*M+(s[1]-R)*this.ky*D)/(M*M+D*D),O>1?(C=n[T+1][0],R=n[T+1][1]):O>0&&(C+=M/this.kx*O,R+=D/this.ky*O)),M=ra(s[0]-C)*this.kx,D=(s[1]-R)*this.ky;const j=M*M+D*D;j<u&&(u=j,h=C,g=R,_=T,x=O)}return{point:[h,g],index:_,t:Math.max(0,Math.min(1,x))}}lineSlice(n,s,u){let h=this.pointOnLine(u,n),g=this.pointOnLine(u,s);if(h.index>g.index||h.index===g.index&&h.t>g.t){const C=h;h=g,g=C}const _=[h.point],x=h.index+1,T=g.index;!Sv(u[x],_[0])&&x<=T&&_.push(u[x]);for(let C=x+1;C<=T;C++)_.push(u[C]);return Sv(u[T],g.point)||_.push(g.point),_}lineSliceAlong(n,s,u){let h=0;const g=[];for(let _=0;_<u.length-1;_++){const x=u[_],T=u[_+1],C=this.distance(x,T);if(h+=C,h>n&&g.length===0&&g.push(ug(x,T,(n-(h-C))/C)),h>=s)return g.push(ug(x,T,(s-(h-C))/C)),g;h>n&&g.push(T)}return g}bufferPoint(n,s){const u=s/this.ky,h=s/this.kx;return[n[0]-h,n[1]-u,n[0]+h,n[1]+u]}bufferBBox(n,s){const u=s/this.ky,h=s/this.kx;return[n[0]-h,n[1]-u,n[2]+h,n[3]+u]}insideBBox(n,s){return ra(n[0]-s[0])>=0&&ra(n[0]-s[2])<=0&&n[1]>=s[1]&&n[1]<=s[3]}}function Sv(a,n){return a[0]===n[0]&&a[1]===n[1]}function ug(a,n,s){const u=ra(n[0]-a[0]);return[a[0]+u*s,a[1]+(n[1]-a[1])*s]}function ra(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class dg{constructor(n=[],s=(u,h)=>u<h?-1:u>h?1:0){if(this.data=n,this.length=this.data.length,this.compare=s,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:s,compare:u}=this,h=s[n];for(;n>0;){const g=n-1>>1,_=s[g];if(u(h,_)>=0)break;s[n]=_,n=g}s[n]=h}_down(n){const{data:s,compare:u}=this,h=this.length>>1,g=s[n];for(;n<h;){let _=1+(n<<1);const x=_+1;if(x<this.length&&u(s[x],s[_])<0&&(_=x),u(s[_],g)>=0)break;s[n]=s[_],n=_}s[n]=g}}var wt=8192;function Cv(a,n){return n.dist-a.dist}const hg=100,fg=50;function Iv(a){const n=[1/0,1/0,-1/0,-1/0];if(n.length!==a.length)return!1;for(let s=0;s<n.length;s++)if(n[s]!==a[s])return!1;return!0}function gp(a){return a[1]-a[0]+1}function Ol(a,n){const s=a[1]>=a[0]&&a[1]<n;return s||console.warn("Distance Expression: Index is out of range"),s}function Av(a,n){if(a[0]>a[1])return[null,null];const s=gp(a);if(n){if(s===2)return[a,null];const u=Math.floor(s/2);return[[a[0],a[0]+u],[a[0]+u,a[1]]]}{if(s===1)return[a,null];const u=Math.floor(s/2)-1;return[[a[0],a[0]+u],[a[0]+u+1,a[1]]]}}function hd(a,n){const s=[1/0,1/0,-1/0,-1/0];if(!Ol(n,a.length))return s;for(let u=n[0];u<=n[1];++u)La(s,a[u]);return s}function fd(a){const n=[1/0,1/0,-1/0,-1/0];for(let s=0;s<a.length;++s)for(let u=0;u<a[s].length;++u)La(n,a[s][u]);return n}function yu(a,n,s){if(Iv(a)||Iv(n))return NaN;let u=0,h=0;return a[2]<n[0]&&(u=n[0]-a[2]),a[0]>n[2]&&(u=a[0]-n[2]),a[1]>n[3]&&(h=a[1]-n[3]),a[3]<n[1]&&(h=n[1]-a[3]),s.distance([0,0],[u,h])}function pg(a){return 360*a-180}function Nb(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function mg(a,n){const s=Math.pow(2,n.z),u=(a.y/wt+n.y)/s;return[pg((a.x/wt+n.x)/s),Nb(u)]}function yI(a,n){const s=[];for(let u=0;u<a.length;++u)s.push(mg(a[u],n));return s}function Lb(a,n,s){const u=s.pointOnLine(n,a).point;return s.distance(a,u)}function Pv(a,n,s,u,h){const g=s.slice(u[0],u[1]+1);let _=1/0;for(let x=n[0];x<=n[1];++x)if((_=Math.min(_,Lb(a[x],g,h)))===0)return 0;return _}function vu(a,n,s,u,h){const g=Math.min(h.pointToSegmentDistance(a,s,u),h.pointToSegmentDistance(n,s,u)),_=Math.min(h.pointToSegmentDistance(s,a,n),h.pointToSegmentDistance(u,a,n));return Math.min(g,_)}function ti(a,n,s,u,h){if(!Ol(n,a.length)||!Ol(u,s.length))return NaN;let g=1/0;for(let _=n[0];_<n[1];++_)for(let x=u[0];x<u[1];++x){if(pp(a[_],a[_+1],s[x],s[x+1]))return 0;g=Math.min(g,vu(a[_],a[_+1],s[x],s[x+1],h))}return g}function vI(a,n,s,u,h){if(!Ol(n,a.length)||!Ol(u,s.length))return NaN;let g=1/0;for(let _=n[0];_<=n[1];++_)for(let x=u[0];x<=u[1];++x)if((g=Math.min(g,h.distance(a[_],s[x])))===0)return g;return g}function xI(a,n,s){if(uh(a,n,!0))return 0;let u=1/0;for(const h of n){const g=h.length;if(g<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[g-1]&&(u=Math.min(u,s.pointToSegmentDistance(a,h[g-1],h[0])))===0||(u=Math.min(u,Lb(a,h,s)))===0)return u}return u}function bI(a,n,s,u){if(!Ol(n,a.length))return NaN;for(let g=n[0];g<=n[1];++g)if(uh(a[g],s,!0))return 0;let h=1/0;for(let g=n[0];g<n[1];++g)for(const _ of s)for(let x=0,T=_.length,C=T-1;x<T;C=x++){if(pp(a[g],a[g+1],_[C],_[x]))return 0;h=Math.min(h,vu(a[g],a[g+1],_[C],_[x],u))}return h}function Rv(a,n){for(const s of a)for(let u=0;u<=s.length-1;++u)if(uh(s[u],n,!0))return!0;return!1}function wI(a,n,s,u=1/0){const h=fd(a),g=fd(n);if(u!==1/0&&yu(h,g,s)>=u)return u;if(hp(h,g)){if(Rv(a,n))return 0}else if(Rv(n,a))return 0;let _=u;for(const x of a)for(let T=0,C=x.length,R=C-1;T<C;R=T++)for(const M of n)for(let D=0,O=M.length,j=O-1;D<O;j=D++){if(pp(x[R],x[T],M[j],M[D]))return 0;_=Math.min(_,vu(x[R],x[T],M[j],M[D],s))}return _}function ar(a,n,s,u,h,g,_){if(g===null||_===null)return;const x=yu(hd(u,g),hd(h,_),s);x<n&&a.push({dist:x,range1:g,range2:_})}function TI(a,n,s,u,h=1/0){let g=Math.min(u.distance(a[0],s[0][0]),h);if(g===0)return g;const _=new dg([{dist:0,range1:[0,a.length-1],range2:[0,0]}],Cv),x=n?fg:hg,T=fd(s);for(;_.length;){const C=_.pop();if(C.dist>=g)continue;const R=C.range1;if(gp(R)<=x){if(!Ol(R,a.length))return NaN;if(n){const M=bI(a,R,s,u);if((g=Math.min(g,M))===0)return g}else for(let M=R[0];M<=R[1];++M){const D=xI(a[M],s,u);if((g=Math.min(g,D))===0)return g}}else{const M=Av(R,n);if(M[0]!==null){const D=yu(hd(a,M[0]),T,u);D<g&&_.push({dist:D,range1:M[0],range2:[0,0]})}if(M[1]!==null){const D=yu(hd(a,M[1]),T,u);D<g&&_.push({dist:D,range1:M[1],range2:[0,0]})}}}return g}function Ob(a,n,s,u,h,g=1/0){let _=Math.min(g,h.distance(a[0],s[0]));if(_===0)return _;const x=new dg([{dist:0,range1:[0,a.length-1],range2:[0,s.length-1]}],Cv),T=n?fg:hg,C=u?fg:hg;for(;x.length;){const R=x.pop();if(R.dist>=_)continue;const M=R.range1,D=R.range2;if(gp(M)<=T&&gp(D)<=C){if(!Ol(M,a.length)||!Ol(D,s.length))return NaN;if(n&&u?_=Math.min(_,ti(a,M,s,D,h)):n||u?n&&!u?_=Math.min(_,Pv(s,D,a,M,h)):!n&&u&&(_=Math.min(_,Pv(a,M,s,D,h))):_=Math.min(_,vI(a,M,s,D,h)),_===0)return _}else{const O=Av(M,n),j=Av(D,u);ar(x,_,h,a,s,O[0],j[0]),ar(x,_,h,a,s,O[0],j[1]),ar(x,_,h,a,s,O[1],j[0]),ar(x,_,h,a,s,O[1],j[1])}}return _}function Mv(a,n,s,u,h=1/0){let g=h;const _=hd(a,[0,a.length-1]);for(const x of s)if(!(g!==1/0&&yu(_,hd(x,[0,x.length-1]),u)>=g)&&(g=Math.min(g,Ob(a,n,x,!0,u,g)),g===0))return g;return g}function gg(a,n,s,u,h=1/0){let g=h;const _=hd(a,[0,a.length-1]);for(const x of s){if(g!==1/0&&yu(_,fd(x),u)>=g)continue;const T=TI(a,n,x,u,g);if(isNaN(T))return T;if((g=Math.min(g,T))===0)return g}return g}function kv(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class pd{constructor(n,s){this.type=Jt,this.geojson=n,this.geometries=s}static parse(n,s){if(n.length!==2)return s.error(`'distance' expression requires either one argument, but found ' ${n.length-1} instead.`);if(lh(n[1])){const u=n[1];if(u.type==="FeatureCollection"){for(let h=0;h<u.features.length;++h)if(kv(u.features[h].geometry.type))return new pd(u,u.features[h].geometry)}else if(u.type==="Feature"){if(kv(u.geometry.type))return new pd(u,u.geometry)}else if(kv(u.type))return new pd(u,u)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(n){const s=n.geometry(),u=n.canonicalID();if(s!=null&&u!=null){if(n.geometryType()==="Point")return function(h,g,_){const x=[];for(const C of h)for(const R of C)x.push(mg(R,g));const T=new hh(x[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?Ob(x,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",T):_.type==="MultiLineString"?Mv(x,!1,_.coordinates,T):_.type==="Polygon"||_.type==="MultiPolygon"?gg(x,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,T):null}(s,u,this.geometries);if(n.geometryType()==="LineString")return function(h,g,_){const x=[];for(const C of h){const R=[];for(const M of C)R.push(mg(M,g));x.push(R)}const T=new hh(x[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Mv(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",x,T);if(_.type==="MultiLineString"){let C=1/0;for(let R=0;R<_.coordinates.length;R++){const M=Mv(_.coordinates[R],!0,x,T,C);if(isNaN(M))return M;if((C=Math.min(C,M))===0)return C}return C}if(_.type==="Polygon"||_.type==="MultiPolygon"){let C=1/0;for(let R=0;R<x.length;R++){const M=gg(x[R],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,T,C);if(isNaN(M))return M;if((C=Math.min(C,M))===0)return C}return C}return null}(s,u,this.geometries);if(n.geometryType()==="Polygon")return function(h,g,_){const x=[];for(const C of function(R,M){const D=R.length;if(D<=1)return[R];const O=[];let j,G;for(let X=0;X<D;X++){const K=pu(R[X]);K!==0&&(R[X].area=Math.abs(K),G===void 0&&(G=K<0),G===K<0?(j&&O.push(j),j=[R[X]]):j.push(R[X]))}return j&&O.push(j),O}(h)){const R=[];for(let M=0;M<C.length;++M)R.push(yI(C[M],g));x.push(R)}const T=new hh(x[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return gg(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",x,T);if(_.type==="MultiLineString"){let C=1/0;for(let R=0;R<_.coordinates.length;R++){const M=gg(_.coordinates[R],!0,x,T,C);if(isNaN(M))return M;if((C=Math.min(C,M))===0)return C}return C}return _.type==="Polygon"||_.type==="MultiPolygon"?function(C,R,M){let D=1/0;for(const O of C)for(const j of R){const G=wI(O,j,M,D);if(isNaN(G))return G;if((D=Math.min(D,G))===0)return D}return D}(_.type==="Polygon"?[_.coordinates]:_.coordinates,x,T):null}(s,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function fh(a){if(a instanceof yo&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof _u||a instanceof pd)return!1;if(a instanceof mh)return a.featureConstant;let n=!0;return a.eachChild(s=>{n&&!fh(s)&&(n=!1)}),n}function _p(a){if(a instanceof yo&&a.name==="feature-state")return!1;let n=!0;return a.eachChild(s=>{n&&!_p(s)&&(n=!1)}),n}function ph(a,n){if(a instanceof yo&&n.indexOf(a.name)>=0)return!1;let s=!0;return a.eachChild(u=>{s&&!ph(u,n)&&(s=!1)}),s}function Fb(a,n,s){return[a,n,s].filter(Boolean).join("")}function Dv(a,n){switch(a){case"string":return Na(n);case"number":return+n;case"boolean":return!!n;case"color":return Si.parse(n);case"formatted":return go.fromString(Na(n));case"resolvedImage":return _o.build(Na(n))}return n}function zb(a,n,s,u){return u!==void 0&&(a=u*Math.round(a/u)),n!==void 0&&a<n&&(a=n),s!==void 0&&a>s&&(a=s),a}class mh{constructor(n,s,u,h=!1){this.type=n,this.key=s,this.scope=u,this.featureConstant=h}static parse(n,s){let u=s.expectedType;if(u==null&&(u=wi),n.length<2||n.length>3)return s.error("Invalid number of arguments for 'config' expression.");const h=s.parse(n[1],1);if(!(h instanceof cc))return s.error("Key name of 'config' expression must be a string literal.");let g,_=!0;const x=Na(h.value);if(n.length>=3){const T=s.parse(n[2],2);if(!(T instanceof cc))return s.error("Scope of 'config' expression must be a string literal.");g=Na(T.value)}if(s.options){const T=Fb(x,g,s._scope),C=s.options.get(T);C&&(_=fh(C.value||C.default))}return new mh(u,x,g,_)}evaluate(n){const s=Fb(this.key,this.scope,n.scope),u=n.getConfig(s);if(!u)return null;const{type:h,value:g,values:_,minValue:x,maxValue:T,stepValue:C}=u,R=u.default.evaluate(n);let M=R;if(g){const D=n.scope;n.scope=(D||"").split("").slice(1).join(""),M=g.evaluate(n),n.scope=D}return h&&(M=Dv(h,M)),M===void 0||x===void 0&&T===void 0&&C===void 0||(typeof M=="number"?M=zb(M,x,T,C):Array.isArray(M)&&(M=M.map(D=>typeof D=="number"?zb(D,x,T,C):D))),g!==void 0&&M!==void 0&&_&&!_.includes(M)&&(M=R,h&&(M=Dv(h,M))),(h&&h!==this.type||M!==void 0&&!ng(_s(M),this.type))&&(M=Dv(this.type.kind,M)),M}eachChild(){}outputDefined(){return!1}serialize(){const n=["config",this.key];return this.scope&&n.concat(this.scope),n}}class _g{constructor(n,s){this.type=s.type,this.name=n,this.boundExpression=s}static parse(n,s){if(n.length!==2||typeof n[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const u=n[1];return s.scope.has(u)?new _g(u,s.scope.get(u)):s.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class yg{constructor(n,s=[],u,h=new ah,g=[],_,x,T){this.registry=n,this.path=s,this.key=s.map(C=>typeof C=="string"?`['${C}']`:`[${C}]`).join(""),this.scope=h,this.errors=g,this.expectedType=u,this._scope=_,this.options=x,this.iconImageUseTheme=T}parse(n,s,u,h,g={}){return s||u?this.concat(s,null,u,h)._parse(n,g):this._parse(n,g)}parseObjectValue(n,s,u,h,g,_={}){return this.concat(s,u,h,g)._parse(n,_)}_parse(n,s){function u(h,g,_){return _==="assert"?new al(g,[h]):_==="coerce"?new Ll(g,[h]):h}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof n[0]=="string"?this.registry[n[0]]:void 0;if(h){let g=h.parse(n,this);if(!g)return null;if(this.expectedType){const _=this.expectedType,x=g.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||x.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(_,x))return null}else g=u(g,_,s.typeAnnotation||"coerce");else g=u(g,_,s.typeAnnotation||"assert")}if(!(g instanceof cc)&&g.type.kind!=="resolvedImage"&&Nv(g)){const _=new og(this._scope,this.options,this.iconImageUseTheme);try{g=new cc(g.type,g.evaluate(_))}catch(x){return this.error(x.message),null}}return g}return Ll.parse(["to-array",n],this)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,s,u,h){let g=typeof n=="number"?this.path.concat(n):this.path;g=typeof s=="string"?g.concat(s):g;const _=h?this.scope.concat(h):this.scope;return new yg(this.registry,g,u||null,_,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(n,...s){const u=`${this.key}${s.map(h=>`[${h}]`).join("")}`;this.errors.push(new Da(u,n))}checkSubtype(n,s){const u=fu(n,s);return u&&this.error(u),u}}function Nv(a){if(a instanceof _g)return Nv(a.boundExpression);if(a instanceof yo&&a.name==="error"||a instanceof Ss||a instanceof _u||a instanceof pd||a instanceof mh)return!1;const n=a instanceof Ll||a instanceof al;let s=!0;return a.eachChild(u=>{s=n?s&&Nv(u):s&&u instanceof cc}),!!s&&fh(a)&&ph(a,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function vg(a,n){const s=a.length-1;let u,h,g=0,_=s,x=0;for(;g<=_;)if(x=Math.floor((g+_)/2),u=a[x],h=a[x+1],u<=n){if(x===s||n<h)return x;g=x+1}else{if(!(u>n))throw new cs("Input is not a number.");_=x-1}return 0}class yp{constructor(n,s,u){this.type=n,this.input=s,this.labels=[],this.outputs=[];for(const[h,g]of u)this.labels.push(h),this.outputs.push(g)}static parse(n,s){if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");const u=s.parse(n[1],1,Jt);if(!u)return null;const h=[];let g=null;s.expectedType&&s.expectedType.kind!=="value"&&(g=s.expectedType);for(let _=1;_<n.length;_+=2){const x=_===1?-1/0:n[_],T=n[_+1],C=_,R=_+1;if(typeof x!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(h.length&&h[h.length-1][0]>=x)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const M=s.parse(T,R,g);if(!M)return null;g=g||M.type,h.push([x,M])}return new yp(g,u,h)}evaluate(n){const s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(n);const h=this.input.evaluate(n);if(h<=s[0])return u[0].evaluate(n);const g=s.length;return h>=s[g-1]?u[g-1].evaluate(n):u[vg(s,h)].evaluate(n)}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&n.push(this.labels[s]),n.push(this.outputs[s].serialize());return n}}const jb=.95047,Bb=1.08883,Vb=4/29,gh=6/29,Ub=3*gh*gh,EI=gh*gh*gh,SI=Math.PI/180,CI=180/Math.PI;function Lv(a){return a>EI?Math.pow(a,1/3):a/Ub+Vb}function Ov(a){return a>gh?a*a*a:Ub*(a-Vb)}function Fv(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function zv(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function $b(a){const n=zv(a.r),s=zv(a.g),u=zv(a.b),h=Lv((.4124564*n+.3575761*s+.1804375*u)/jb),g=Lv((.2126729*n+.7151522*s+.072175*u)/1);return{l:116*g-16,a:500*(h-g),b:200*(g-Lv((.0193339*n+.119192*s+.9503041*u)/Bb)),alpha:a.a}}function xg(a){let n=(a.l+16)/116,s=isNaN(a.a)?n:n+a.a/500,u=isNaN(a.b)?n:n-a.b/200;return n=1*Ov(n),s=jb*Ov(s),u=Bb*Ov(u),new Si(Fv(3.2404542*s-1.5371385*n-.4985314*u),Fv(-.969266*s+1.8760108*n+.041556*u),Fv(.0556434*s-.2040259*n+1.0572252*u),a.alpha)}function bg(a,n,s){const u=n-a;return a+s*(u>180||u<-180?u-360*Math.round(u/360):u)}const _h={forward:$b,reverse:xg,interpolate:function(a,n,s){return{l:fn(a.l,n.l,s),a:fn(a.a,n.a,s),b:fn(a.b,n.b,s),alpha:fn(a.alpha,n.alpha,s)}}},vp={forward:function(a){const{l:n,a:s,b:u}=$b(a),h=Math.atan2(u,s)*CI;return{h:h<0?h+360:h,c:Math.sqrt(s*s+u*u),l:n,alpha:a.a}},reverse:function(a){const n=a.h*SI,s=a.c;return xg({l:a.l,a:Math.cos(n)*s,b:Math.sin(n)*s,alpha:a.alpha})},interpolate:function(a,n,s){return{h:bg(a.h,n.h,s),c:fn(a.c,n.c,s),l:fn(a.l,n.l,s),alpha:fn(a.alpha,n.alpha,s)}}};var Gb=Object.freeze({__proto__:null,hcl:vp,lab:_h});class sa{constructor(n,s,u,h,g){this.type=n,this.operator=s,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(const[_,x]of g)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(n,s,u,h){let g=0;if(n.name==="exponential")g=wg(s,n.base,u,h);else if(n.name==="linear")g=wg(s,1,u,h);else if(n.name==="cubic-bezier"){const _=n.controlPoints;g=new mo(_[0],_[1],_[2],_[3]).solve(wg(s,1,u,h))}return g}static parse(n,s){let[u,h,g,..._]=n;if(!Array.isArray(h)||h.length===0)return s.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const C=h[1];if(typeof C!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:C}}else{if(h[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const C=h.slice(1);if(C.length!==4||C.some(R=>typeof R!="number"||R<0||R>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:C}}}if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length-1>3&&(n.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(g=s.parse(g,2,Jt),!g)return null;const x=[];let T=null;u==="interpolate-hcl"||u==="interpolate-lab"?T=Mo:s.expectedType&&s.expectedType.kind!=="value"&&(T=s.expectedType);for(let C=0;C<_.length;C+=2){const R=_[C],M=_[C+1],D=C+3,O=C+4;if(typeof R!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(x.length&&x[x.length-1][0]>=R)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const j=s.parse(M,O,T);if(!j)return null;T=T||j.type,x.push([R,j])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new sa(T,u,h,g,x):s.error(`Type ${Gr(T)} is not interpolatable.`)}evaluate(n){const s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(n);const h=this.input.evaluate(n);if(h<=s[0])return u[0].evaluate(n);const g=s.length;if(h>=s[g-1])return u[g-1].evaluate(n);const _=vg(s,h),x=sa.interpolationFactor(this.interpolation,h,s[_],s[_+1]),T=u[_].evaluate(n),C=u[_+1].evaluate(n);return this.operator==="interpolate"?lp[this.type.kind.toLowerCase()](T,C,x):this.operator==="interpolate-hcl"?vp.reverse(vp.interpolate(vp.forward(T),vp.forward(C),x)):_h.reverse(_h.interpolate(_h.forward(T),_h.forward(C),x))}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const s=[this.operator,n,this.input.serialize()];for(let u=0;u<this.labels.length;u++)s.push(this.labels[u],this.outputs[u].serialize());return s}}function wg(a,n,s,u){const h=u-s,g=a-s;return h===0?0:n===1?g/h:(Math.pow(n,g)-1)/(Math.pow(n,h)-1)}class xp{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expectected at least one argument.");let u=null;const h=s.expectedType;h&&h.kind!=="value"&&(u=h);const g=[];for(const x of n.slice(1)){const T=s.parse(x,1+g.length,u,void 0,{typeAnnotation:"omit"});if(!T)return null;u=u||T.type,g.push(T)}const _=h&&g.some(x=>fu(h,x.type));return new xp(_?wi:u,g)}evaluate(n){let s,u=null,h=0;for(const g of this.args){if(h++,u=g.evaluate(n),u&&u instanceof _o&&!u.available&&(s||(s=u),u=null,h===this.args.length))return s;if(u!==null)break}return u}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(s=>{n.push(s.serialize())}),n}}class dc{constructor(n,s){this.type=s.type,this.bindings=[].concat(n),this.result=s}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const s of this.bindings)n(s[1]);n(this.result)}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const u=[];for(let g=1;g<n.length-1;g+=2){const _=n[g];if(typeof _!="string")return s.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",g);const x=s.parse(n[g+1],g+1);if(!x)return null;u.push([_,x])}const h=s.parse(n[n.length-1],n.length-1,s.expectedType,u);return h?new dc(u,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[s,u]of this.bindings)n.push(s,u.serialize());return n.push(this.result.serialize()),n}}class Tg{constructor(n,s,u){this.type=n,this.index=s,this.input=u}static parse(n,s){if(n.length!==3)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=s.parse(n[1],1,Jt),h=s.parse(n[2],2,Xs(s.expectedType||wi));return u&&h?new Tg(h.type.itemType,u,h):null}evaluate(n){const s=this.index.evaluate(n),u=this.input.evaluate(n);if(s<0)throw new cs("Array index out of bounds: negative index");if(s>=u.length)throw new cs("Array index out of bounds: index exceeds array size");if(s!==Math.floor(s))throw new cs("Array index must be an integer. Use at-interpolated for fractional indices");return u[s]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Eg{constructor(n,s,u){this.type=n,this.index=s,this.input=u}static parse(n,s){if(n.length!==3)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=s.parse(n[1],1,Jt),h=s.parse(n[2],2,Xs(s.expectedType||wi));return u&&h?new Eg(h.type.itemType,u,h):null}evaluate(n){const s=this.index.evaluate(n),u=this.input.evaluate(n);if(s<0)throw new cs(`Array index out of bounds: ${s} < 0.`);if(s>u.length-1)throw new cs(`Array index out of bounds: ${s} > ${u.length-1}.`);if(s===Math.floor(s))return u[s];const h=Math.floor(s),g=Math.ceil(s),_=u[h],x=u[g];if(typeof _!="number"||typeof x!="number")throw new cs(`Cannot interpolate between non-number values at index ${s}.`);const T=s-h;return _*(1-T)+x*T}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class jv{constructor(n,s){this.type=Pi,this.needle=n,this.haystack=s}static parse(n,s){if(n.length!==3)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=s.parse(n[1],1,wi),h=s.parse(n[2],2,wi);return u&&h?yv(u.type,[Pi,Jn,Jt,ol,wi])?new jv(u,h):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gr(u.type)} instead`):null}evaluate(n){const s=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(u==null)return!1;if(!dp(s,["boolean","string","number","null"]))throw new cs(`Expected first argument to be of type boolean, string, number or null, but found ${Gr(_s(s))} instead.`);if(!dp(u,["string","array"]))throw new cs(`Expected second argument to be of type array or string, but found ${Gr(_s(u))} instead.`);return u.indexOf(s)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class yh{constructor(n,s,u){this.type=Jt,this.needle=n,this.haystack=s,this.fromIndex=u}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const u=s.parse(n[1],1,wi),h=s.parse(n[2],2,wi);if(!u||!h)return null;if(!yv(u.type,[Pi,Jn,Jt,ol,wi]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gr(u.type)} instead`);if(n.length===4){const g=s.parse(n[3],3,Jt);return g?new yh(u,h,g):null}return new yh(u,h)}evaluate(n){const s=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(!dp(s,["boolean","string","number","null"]))throw new cs(`Expected first argument to be of type boolean, string, number or null, but found ${Gr(_s(s))} instead.`);if(!dp(u,["string","array"]))throw new cs(`Expected second argument to be of type array or string, but found ${Gr(_s(u))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(n);return u.indexOf(s,h)}return u.indexOf(s)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class bp{constructor(n,s,u,h,g,_){this.inputType=n,this.type=s,this.input=u,this.cases=h,this.outputs=g,this.otherwise=_}static parse(n,s){if(n.length<5)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return s.error("Expected an even number of arguments.");let u,h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);const g={},_=[];for(let C=2;C<n.length-1;C+=2){let R=n[C];const M=n[C+1];Array.isArray(R)||(R=[R]);const D=s.concat(C);if(R.length===0)return D.error("Expected at least one branch label.");for(const j of R){if(typeof j!="number"&&typeof j!="string")return D.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return D.error("Numeric branch labels must be integer values.");if(u){if(D.checkSubtype(u,_s(j)))return null}else u=_s(j);if(g[String(j)]!==void 0)return D.error("Branch labels must be unique.");g[String(j)]=_.length}const O=s.parse(M,C,h);if(!O)return null;h=h||O.type,_.push(O)}const x=s.parse(n[1],1,wi);if(!x)return null;const T=s.parse(n[n.length-1],n.length-1,h);return T?x.type.kind!=="value"&&s.concat(1).checkSubtype(u,x.type)?null:new bp(u,h,x,g,_,T):null}evaluate(n){const s=this.input.evaluate(n);return(ng(_s(s),this.inputType)&&this.outputs[this.cases[s]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),u=[],h={};for(const _ of s){const x=h[this.cases[_]];x===void 0?(h[this.cases[_]]=u.length,u.push([this.cases[_],[_]])):u[x][1].push(_)}const g=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,x]of u)n.push(x.length===1?g(x[0]):x.map(g)),n.push(this.outputs[_].serialize());return n.push(this.otherwise.serialize()),n}}class wp{constructor(n,s,u){this.type=n,this.branches=s,this.otherwise=u}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return s.error("Expected an odd number of arguments.");let u;s.expectedType&&s.expectedType.kind!=="value"&&(u=s.expectedType);const h=[];for(let _=1;_<n.length-1;_+=2){const x=s.parse(n[_],_,Pi);if(!x)return null;const T=s.parse(n[_+1],_+1,u);if(!T)return null;h.push([x,T]),u=u||T.type}const g=s.parse(n[n.length-1],n.length-1,u);return g?new wp(u,h,g):null}evaluate(n){for(const[s,u]of this.branches)if(s.evaluate(n))return u.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[s,u]of this.branches)n(s),n(u);n(this.otherwise)}outputDefined(){return this.branches.every(([n,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(s=>{n.push(s.serialize())}),n}}class Sg{constructor(n,s,u,h){this.type=n,this.input=s,this.beginIndex=u,this.endIndex=h}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const u=s.parse(n[1],1,wi),h=s.parse(n[2],2,Jt);if(!u||!h)return null;if(!yv(u.type,[Xs(wi),Jn,wi]))return s.error(`Expected first argument to be of type array or string, but found ${Gr(u.type)} instead`);if(n.length===4){const g=s.parse(n[3],3,Jt);return g?new Sg(u.type,u,h,g):null}return new Sg(u.type,u,h)}evaluate(n){const s=this.input.evaluate(n),u=this.beginIndex.evaluate(n);if(!dp(s,["string","array"]))throw new cs(`Expected first argument to be of type array or string, but found ${Gr(_s(s))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(n);return s.slice(u,h)}return s.slice(u)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Bv{constructor(n,s){this.type=Xs(Jn),this.str=n,this.delimiter=s}static parse(n,s){if(n.length!==3)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=s.parse(n[1],1,Jn),h=s.parse(n[2],2,Jn);return u&&h?new Bv(u,h):void 0}evaluate(n){const s=this.str.evaluate(n),u=this.delimiter.evaluate(n);return s.split(u)}eachChild(n){n(this.str),n(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Vv(a,n){return a==="=="||a==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function Uv(a,n,s,u){return u.compare(n,s)===0}function vh(a,n,s){const u=a!=="=="&&a!=="!=";return class j7{constructor(g,_,x){this.type=Pi,this.lhs=g,this.rhs=_,this.collator=x,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const x=g[0];let T=_.parse(g[1],1,wi);if(!T)return null;if(!Vv(x,T.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${Gr(T.type)}'.`);let C=_.parse(g[2],2,wi);if(!C)return null;if(!Vv(x,C.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${Gr(C.type)}'.`);if(T.type.kind!==C.type.kind&&T.type.kind!=="value"&&C.type.kind!=="value")return _.error(`Cannot compare types '${Gr(T.type)}' and '${Gr(C.type)}'.`);u&&(T.type.kind==="value"&&C.type.kind!=="value"?T=new al(C.type,[T]):T.type.kind!=="value"&&C.type.kind==="value"&&(C=new al(T.type,[C])));let R=null;if(g.length===4){if(T.type.kind!=="string"&&C.type.kind!=="string"&&T.type.kind!=="value"&&C.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(R=_.parse(g[3],3,tg),!R)return null}return new j7(T,C,R)}evaluate(g){const _=this.lhs.evaluate(g),x=this.rhs.evaluate(g);if(u&&this.hasUntypedArgument){const T=_s(_),C=_s(x);if(T.kind!==C.kind||T.kind!=="string"&&T.kind!=="number")throw new cs(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${T.kind}, ${C.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const T=_s(_),C=_s(x);if(T.kind!=="string"||C.kind!=="string")return n(g,_,x)}return this.collator?s(g,_,x,this.collator.evaluate(g)):n(g,_,x)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[a];return this.eachChild(_=>{g.push(_.serialize())}),g}}}const II=vh("==",function(a,n,s){return n===s},Uv),AI=vh("!=",function(a,n,s){return n!==s},function(a,n,s,u){return!Uv(0,n,s,u)}),Hb=vh("<",function(a,n,s){return n<s},function(a,n,s,u){return u.compare(n,s)<0}),Wb=vh(">",function(a,n,s){return n>s},function(a,n,s,u){return u.compare(n,s)>0}),Cg=vh("<=",function(a,n,s){return n<=s},function(a,n,s,u){return u.compare(n,s)<=0}),PI=vh(">=",function(a,n,s){return n>=s},function(a,n,s,u){return u.compare(n,s)>=0});class Ig{constructor(n,s,u,h,g,_){this.type=Jn,this.number=n,this.locale=s,this.currency=u,this.unit=h,this.minFractionDigits=g,this.maxFractionDigits=_}static parse(n,s){if(n.length!==3)return s.error("Expected two arguments.");const u=s.parse(n[1],1,Jt);if(!u)return null;const h=n[2];if(typeof h!="object"||Array.isArray(h))return s.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=s.parseObjectValue(h.locale,2,"locale",Jn),!g))return null;let _=null;if(h.currency&&(_=s.parseObjectValue(h.currency,2,"currency",Jn),!_))return null;let x=null;if(h.unit&&(x=s.parseObjectValue(h.unit,2,"unit",Jn),!x))return null;let T=null;if(h["min-fraction-digits"]&&(T=s.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",Jt),!T))return null;let C=null;return h["max-fraction-digits"]&&(C=s.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",Jt),!C)?null:new Ig(u,g,_,x,T,C)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class $v{constructor(n){this.type=Jt,this.input=n}static parse(n,s){if(n.length!==2)return s.error(`Expected 1 argument, but found ${n.length-1} instead.`);const u=s.parse(n[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Gr(u.type)} instead.`):new $v(u):null}evaluate(n){const s=this.input.evaluate(n);if(typeof s=="string"||Array.isArray(s))return s.length;throw new cs(`Expected value to be of type string or array, but found ${Gr(_s(s))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(s=>{n.push(s.serialize())}),n}}function qb(a){return function(){a=1831565813+(a|=0)|0;let n=Math.imul(a^a>>>15,1|a);return n=n+Math.imul(n^n>>>7,61|n)^n,((n^n>>>14)>>>0)/4294967296}}const xh={"==":II,"!=":AI,">":Wb,"<":Hb,">=":PI,"<=":Cg,array:al,at:Tg,"at-interpolated":Eg,boolean:al,case:wp,coalesce:xp,collator:Ss,format:Nl,image:Rn,in:jv,"index-of":yh,interpolate:sa,"interpolate-hcl":sa,"interpolate-lab":sa,length:$v,let:dc,literal:cc,match:bp,number:al,"number-format":Ig,object:al,slice:Sg,step:yp,string:al,"to-boolean":Ll,"to-color":Ll,"to-number":Ll,"to-string":Ll,var:_g,within:_u,distance:pd,config:mh,split:Bv};function Gv(a,[n,s,u,h]){n=n.evaluate(a),s=s.evaluate(a),u=u.evaluate(a);const g=h?h.evaluate(a):1,_=dd(n,s,u,g);if(_)throw new cs(_);return new Si(n/255,s/255,u/255,g)}function Hv(a,[n,s,u,h]){n=n.evaluate(a),s=s.evaluate(a),u=u.evaluate(a);const g=h?h.evaluate(a):1,_=function(C,R,M,D){return typeof C=="number"&&C>=0&&C<=360?typeof R=="number"&&R>=0&&R<=100&&typeof M=="number"&&M>=0&&M<=100?D===void 0||typeof D=="number"&&D>=0&&D<=1?null:`Invalid hsla value [${[C,R,M,D].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof D=="number"?[C,R,M,D]:[C,R,M]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof D=="number"?[C,R,M,D]:[C,R,M]).join(", ")}]: 'h' must be between 0 and 360.`}(n,s,u,g);if(_)throw new cs(_);const x=`hsla(${n}, ${s}%, ${u}%, ${g})`,T=Si.parse(x);if(!T)throw new cs(`Failed to parse HSLA color: ${x}`);return T}function Zb(a,n){return a in n}function Wv(a,n){const s=n[a];return s===void 0?null:s}function xu(a){return{type:a}}function md(a){if(a instanceof mh)return new Set([a.key]);let n=new Set;return a.eachChild(s=>{n=new Set([...n,...md(s)])}),n}function Ag(a){if(a instanceof yo&&a.name==="is-active-floor")return!0;let n=!1;return a.eachChild(s=>{!n&&Ag(s)&&(n=!0)}),n}function Kb(a){return{result:"success",value:a}}function bu(a){return{result:"error",value:a}}function qv(a,n){return!!a&&!!a.parameters&&a.parameters.indexOf(n)>-1}function Tp(a){return a["property-type"]==="data-driven"}function Xb(a){return qv(a.expression,"measure-light")}function Yb(a){return qv(a.expression,"zoom")}function Pg(a){return!!a.expression&&a.expression.interpolated}function Rg(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Qb(a){return a}function Jb(a,n){const s=n.type==="color",u=a.stops&&typeof a.stops[0][0]=="object",h=u||!(u||a.property!==void 0),g=a.type||(Pg(n)?"exponential":"interval");if(s&&((a=Object.assign({},a)).stops&&(a.stops=a.stops.map(C=>[C[0],Si.parse(C[1])])),a.default=Si.parse(a.default?a.default:n.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!Gb[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let _,x,T;if(g==="exponential")_=ew;else if(g==="interval")_=MI;else if(g==="categorical"){_=RI,x=Object.create(null);for(const C of a.stops)x[C[0]]=C[1];T=typeof a.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);_=tw}if(u){const C={},R=[];for(let O=0;O<a.stops.length;O++){const j=a.stops[O],G=j[0].zoom;C[G]===void 0&&(C[G]={zoom:G,type:a.type,property:a.property,default:a.default,stops:[]},R.push(G)),C[G].stops.push([j[0].value,j[1]])}const M=[];for(const O of R)M.push([C[O].zoom,Jb(C[O],n)]);const D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:sa.interpolationFactor.bind(void 0,D),zoomStops:M.map(O=>O[0]),evaluate:({zoom:O},j)=>ew({stops:M,base:a.base},n,O).evaluate(O,j)}}if(h){const C=g==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:sa.interpolationFactor.bind(void 0,C),zoomStops:a.stops.map(R=>R[0]),evaluate:({zoom:R})=>_(a,n,R,x,T)}}return{kind:"source",evaluate(C,R){const M=R&&R.properties?R.properties[a.property]:void 0;return M===void 0?Fl(a.default,n.default):_(a,n,M,x,T)}}}function Fl(a,n,s){return a!==void 0?a:n!==void 0?n:s!==void 0?s:void 0}function RI(a,n,s,u,h){return Fl(typeof s===h?u[s]:void 0,a.default,n.default)}function MI(a,n,s){if(!ch(s))return Fl(a.default,n.default);const u=a.stops.length;if(u===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[u-1][0])return a.stops[u-1][1];const h=vg(a.stops.map(g=>g[0]),s);return a.stops[h][1]}function ew(a,n,s){const u=a.base!==void 0?a.base:1;if(!ch(s))return Fl(a.default,n.default);const h=a.stops.length;if(h===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[h-1][0])return a.stops[h-1][1];const g=vg(a.stops.map(R=>R[0]),s),_=function(R,M,D,O){const j=O-D,G=R-D;return j===0?0:M===1?G/j:(Math.pow(M,G)-1)/(Math.pow(M,j)-1)}(s,u,a.stops[g][0],a.stops[g+1][0]),x=a.stops[g][1],T=a.stops[g+1][1];let C=lp[n.type]||Qb;if(a.colorSpace&&a.colorSpace!=="rgb"){const R=Gb[a.colorSpace];C=(M,D)=>R.reverse(R.interpolate(R.forward(M),R.forward(D),_))}return typeof x.evaluate=="function"?{evaluate(...R){const M=x.evaluate.apply(void 0,R),D=T.evaluate.apply(void 0,R);if(M!==void 0&&D!==void 0)return C(M,D,_)}}:C(x,T,_)}function tw(a,n,s){return n.type==="color"?s=Si.parse(s):n.type==="formatted"?s=go.fromString(s.toString()):n.type==="resolvedImage"?s=_o.build(s.toString()):Xt(s)===n.type||n.type==="enum"&&n.values[s]||(s=void 0),Fl(s,a.default,n.default)}yo.register(xh,{error:[{kind:"error"},[Jn],(a,[n])=>{throw new cs(n.evaluate(a))}],typeof:[Jn,[wi],(a,[n])=>Gr(_s(n.evaluate(a)))],"to-rgba":[Xs(Jt,4),[Mo],(a,[n])=>n.evaluate(a).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Xs(Jt,4),[Mo],(a,[n])=>n.evaluate(a).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Mo,[Jt,Jt,Jt],Gv],rgba:[Mo,[Jt,Jt,Jt,Jt],Gv],hsl:[Mo,[Jt,Jt,Jt],Hv],hsla:[Mo,[Jt,Jt,Jt,Jt],Hv],has:{type:Pi,overloads:[[[Jn],(a,[n])=>Zb(n.evaluate(a),a.properties())],[[Jn,Dl],(a,[n,s])=>Zb(n.evaluate(a),s.evaluate(a))]]},get:{type:wi,overloads:[[[Jn],(a,[n])=>Wv(n.evaluate(a),a.properties())],[[Jn,Dl],(a,[n,s])=>Wv(n.evaluate(a),s.evaluate(a))]]},"feature-state":[wi,[Jn],(a,[n])=>Wv(n.evaluate(a),a.featureState||{})],properties:[Dl,[],a=>a.properties()],"geometry-type":[Jn,[],a=>a.geometryType()],worldview:[Jn,[],a=>a.globals.worldview||""],"is-active-floor":[Pi,xu(Jn),(a,n)=>{if(!(a.globals.activeFloors&&a.globals.activeFloors.size>0))return!1;const s=a.globals.activeFloors;return n.some(u=>{const h=u.evaluate(a);return s.has(h)})}],id:[wi,[],a=>a.id()],zoom:[Jt,[],a=>a.globals.zoom],pitch:[Jt,[],a=>a.globals.pitch||0],"distance-from-center":[Jt,[],a=>a.distanceFromCenter()],"measure-light":[Jt,[Jn],(a,[n])=>a.measureLight(n.evaluate(a))],"heatmap-density":[Jt,[],a=>a.globals.heatmapDensity||0],"line-progress":[Jt,[],a=>a.globals.lineProgress||0],"raster-value":[Jt,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[Jt,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[Jt,[],a=>a.globals.skyRadialProgress||0],accumulated:[wi,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[Jt,xu(Jt),(a,n)=>{let s=0;for(const u of n)s+=u.evaluate(a);return s}],"*":[Jt,xu(Jt),(a,n)=>{let s=1;for(const u of n)s*=u.evaluate(a);return s}],"-":{type:Jt,overloads:[[[Jt,Jt],(a,[n,s])=>n.evaluate(a)-s.evaluate(a)],[[Jt],(a,[n])=>-n.evaluate(a)]]},"/":[Jt,[Jt,Jt],(a,[n,s])=>n.evaluate(a)/s.evaluate(a)],"%":[Jt,[Jt,Jt],(a,[n,s])=>n.evaluate(a)%s.evaluate(a)],ln2:[Jt,[],()=>Math.LN2],pi:[Jt,[],()=>Math.PI],e:[Jt,[],()=>Math.E],"^":[Jt,[Jt,Jt],(a,[n,s])=>Math.pow(n.evaluate(a),s.evaluate(a))],sqrt:[Jt,[Jt],(a,[n])=>Math.sqrt(n.evaluate(a))],log10:[Jt,[Jt],(a,[n])=>Math.log(n.evaluate(a))/Math.LN10],ln:[Jt,[Jt],(a,[n])=>Math.log(n.evaluate(a))],log2:[Jt,[Jt],(a,[n])=>Math.log2(n.evaluate(a))],sin:[Jt,[Jt],(a,[n])=>Math.sin(n.evaluate(a))],cos:[Jt,[Jt],(a,[n])=>Math.cos(n.evaluate(a))],tan:[Jt,[Jt],(a,[n])=>Math.tan(n.evaluate(a))],asin:[Jt,[Jt],(a,[n])=>Math.asin(n.evaluate(a))],acos:[Jt,[Jt],(a,[n])=>Math.acos(n.evaluate(a))],atan:[Jt,[Jt],(a,[n])=>Math.atan(n.evaluate(a))],min:[Jt,xu(Jt),(a,n)=>Math.min(...n.map(s=>s.evaluate(a)))],max:[Jt,xu(Jt),(a,n)=>Math.max(...n.map(s=>s.evaluate(a)))],abs:[Jt,[Jt],(a,[n])=>Math.abs(n.evaluate(a))],round:[Jt,[Jt],(a,[n])=>{const s=n.evaluate(a);return s<0?-Math.round(-s):Math.round(s)}],floor:[Jt,[Jt],(a,[n])=>Math.floor(n.evaluate(a))],ceil:[Jt,[Jt],(a,[n])=>Math.ceil(n.evaluate(a))],"filter-==":[Pi,[Jn,wi],(a,[n,s])=>a.properties()[n.value]===s.value],"filter-id-==":[Pi,[wi],(a,[n])=>a.id()===n.value],"filter-type-==":[Pi,[Jn],(a,[n])=>a.geometryType()===n.value],"filter-<":[Pi,[Jn,wi],(a,[n,s])=>{const u=a.properties()[n.value],h=s.value;return typeof u==typeof h&&u<h}],"filter-id-<":[Pi,[wi],(a,[n])=>{const s=a.id(),u=n.value;return typeof s==typeof u&&s<u}],"filter->":[Pi,[Jn,wi],(a,[n,s])=>{const u=a.properties()[n.value],h=s.value;return typeof u==typeof h&&u>h}],"filter-id->":[Pi,[wi],(a,[n])=>{const s=a.id(),u=n.value;return typeof s==typeof u&&s>u}],"filter-<=":[Pi,[Jn,wi],(a,[n,s])=>{const u=a.properties()[n.value],h=s.value;return typeof u==typeof h&&u<=h}],"filter-id-<=":[Pi,[wi],(a,[n])=>{const s=a.id(),u=n.value;return typeof s==typeof u&&s<=u}],"filter->=":[Pi,[Jn,wi],(a,[n,s])=>{const u=a.properties()[n.value],h=s.value;return typeof u==typeof h&&u>=h}],"filter-id->=":[Pi,[wi],(a,[n])=>{const s=a.id(),u=n.value;return typeof s==typeof u&&s>=u}],"filter-has":[Pi,[wi],(a,[n])=>n.value in a.properties()],"filter-has-id":[Pi,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Pi,[Xs(Jn)],(a,[n])=>n.value.indexOf(a.geometryType())>=0],"filter-id-in":[Pi,[Xs(wi)],(a,[n])=>n.value.indexOf(a.id())>=0],"filter-in-small":[Pi,[Jn,Xs(wi)],(a,[n,s])=>s.value.indexOf(a.properties()[n.value])>=0],"filter-in-large":[Pi,[Jn,Xs(wi)],(a,[n,s])=>function(u,h,g,_){for(;g<=_;){const x=g+_>>1;if(h[x]===u)return!0;h[x]>u?_=x-1:g=x+1}return!1}(a.properties()[n.value],s.value,0,s.value.length-1)],all:{type:Pi,overloads:[[[Pi,Pi],(a,[n,s])=>n.evaluate(a)&&s.evaluate(a)],[xu(Pi),(a,n)=>{for(const s of n)if(!s.evaluate(a))return!1;return!0}]]},any:{type:Pi,overloads:[[[Pi,Pi],(a,[n,s])=>n.evaluate(a)||s.evaluate(a)],[xu(Pi),(a,n)=>{for(const s of n)if(s.evaluate(a))return!0;return!1}]]},"!":[Pi,[Pi],(a,[n])=>!n.evaluate(a)],"is-supported-script":[Pi,[Jn],(a,[n])=>{const s=a.globals&&a.globals.isSupportedScript;return!s||s(n.evaluate(a))}],upcase:[Jn,[Jn],(a,[n])=>n.evaluate(a).toUpperCase()],downcase:[Jn,[Jn],(a,[n])=>n.evaluate(a).toLowerCase()],concat:[Jn,xu(wi),(a,n)=>n.map(s=>Na(s.evaluate(a))).join("")],"resolved-locale":[Jn,[tg],(a,[n])=>n.evaluate(a).resolvedLocale()],random:[Jt,[Jt,Jt,wi],(a,n)=>{const[s,u,h]=n.map(_=>_.evaluate(a));if(s>u||s===u)return s;let g;if(typeof h=="string")g=function(_){let x=0;if(_.length===0)return x;for(let T=0;T<_.length;T++)x=(x<<5)-x+_.charCodeAt(T),x|=0;return x}(h);else{if(typeof h!="number")throw new cs(`Invalid seed input: ${h}`);g=h}return s+qb(g)()*(u-s)}]});class Mg{constructor(n,s,u,h,g){this.expression=n,this._warningHistory={},this._scope=u,this._options=h,this._iconImageUseTheme=g,this._evaluator=new og(u,h,g),this._defaultValue=s?function(_){return _.type==="color"&&(Rg(_.default)||Array.isArray(_.default))?new Si(0,0,0,0):_.type==="color"?Si.parse(_.default)||null:_.default===void 0?null:_.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null,this.configDependencies=md(n),this.isIndoorDependent=Ag(n)}evaluateWithoutErrorHandling(n,s,u,h,g,_,x,T){return this._evaluator.globals=n,this._evaluator.feature=s,this._evaluator.featureState=u,this._evaluator.canonical=h||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(n,s,u,h,g,_,x,T,C){this._evaluator||(this._evaluator=new og(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=n,this._evaluator.feature=s||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=T||null,this._evaluator.iconImageUseTheme=C||null;try{const R=this.expression.evaluate(this._evaluator);if(R==null||typeof R=="number"&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new cs(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(R)} instead.`);return R}catch(R){const M=R;return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${M.message}`)),this._defaultValue}}}function Ep(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in xh}function wu(a,n,s,u,h){const g=new yg(xh,[],n?function(x){const T={color:Mo,string:Jn,number:Jt,enum:Jn,boolean:Pi,formatted:cp,resolvedImage:up};return x.type==="array"?Xs(T[x.value]||wi,x.length):T[x.type]}(n):void 0,void 0,void 0,s,u,h),_=g.parse(a,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?Kb(new Mg(_,n,s,u,h)):bu(g.errors)}class bh{constructor(n,s,u,h){this.kind=n,this._styleExpression=s,this.isLightConstant=u,this.isLineProgressConstant=h,this.isStateDependent=n!=="constant"&&!_p(s.expression),this.configDependencies=md(s.expression),this.isIndoorDependent=Ag(s.expression)}evaluateWithoutErrorHandling(n,s,u,h,g,_){return this._styleExpression.evaluateWithoutErrorHandling(n,s,u,h,g,_)}evaluate(n,s,u,h,g,_,x){return this._styleExpression.evaluate(n,s,u,h,g,_,void 0,void 0,x)}}class gd{constructor(n,s,u,h,g,_){this.kind=n,this.zoomStops=u,this._styleExpression=s,this.isStateDependent=n!=="camera"&&!_p(s.expression),this.isIndoorDependent=Ag(s.expression),this.isLightConstant=g,this.isLineProgressConstant=_,this.configDependencies=md(s.expression),this.interpolationType=h}evaluateWithoutErrorHandling(n,s,u,h,g,_){return this._styleExpression.evaluateWithoutErrorHandling(n,s,u,h,g,_)}evaluate(n,s,u,h,g,_){return this._styleExpression.evaluate(n,s,u,h,g,_)}interpolationFactor(n,s,u){return this.interpolationType?sa.interpolationFactor(this.interpolationType,n,s,u):0}}function Zv(a,n,s,u,h){if((a=wu(a,n,s,u,h)).result==="error")return a;const g=a.value.expression,_=fh(g);if(!_&&!Tp(n))return bu([new Da("","data expressions not supported")]);const x=ph(g,["zoom","pitch","distance-from-center"]);if(!x&&!Yb(n))return bu([new Da("","zoom expressions not supported")]);const T=ph(g,["measure-light"]);if(!T&&!Xb(n))return bu([new Da("","measure-light expression not supported")]);const C=ph(g,["line-progress"]);if(!C&&!function(D){return qv(D.expression,"line-progress")}(n))return bu([new Da("","line-progress expression not supported")]);const R=n.expression&&n.expression.relaxZoomRestriction,M=cl(g);return M||x||R?M instanceof Da?bu([M]):M instanceof sa&&!Pg(n)?bu([new Da("",'"interpolate" expressions cannot be used with this property')]):Kb(M?new gd(_&&C?"camera":"composite",a.value,M.labels,M instanceof sa?M.interpolation:void 0,T,C):new bh(_&&C?"constant":"source",a.value,T,C)):bu([new Da("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class kg{constructor(n,s){this._parameters=n,this._specification=s,Object.assign(this,Jb(this._parameters,this._specification))}static deserialize(n){return new kg(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function cl(a){let n=null;if(a instanceof dc)n=cl(a.result);else if(a instanceof xp){for(const s of a.args)if(n=cl(s),n)break}else(a instanceof yp||a instanceof sa)&&a.input instanceof yo&&a.input.name==="zoom"&&(n=a);return n instanceof Da||a.eachChild(s=>{const u=cl(s);u instanceof Da?n=u:n&&u&&n!==u&&(n=new Da("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}var Kv,nw,iw=function(){if(nw)return Kv;nw=1,Kv=n;var a=3;function n(s,u,h){var g=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var _=new Int32Array(this.arrayBuffer);s=_[0],this.d=(u=_[1])+2*(h=_[2]);for(var x=0;x<this.d*this.d;x++){var T=_[a+x],C=_[a+x+1];g.push(T===C?null:_.subarray(T,C))}var R=_[a+g.length+1];this.keys=_.subarray(_[a+g.length],R),this.bboxes=_.subarray(R),this.insert=this._insertReadonly}else{this.d=u+2*h;for(var M=0;M<this.d*this.d;M++)g.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=s,this.padding=h,this.scale=u/s,this.uid=0;var D=h/u*s;this.min=-D,this.max=s+D}return n.prototype.insert=function(s,u,h,g,_){this._forEachCell(u,h,g,_,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(_)},n.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},n.prototype._insertCell=function(s,u,h,g,_,x){this.cells[_].push(x)},n.prototype.query=function(s,u,h,g,_){var x=this.min,T=this.max;if(s<=x&&u<=x&&T<=h&&T<=g&&!_)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(s,u,h,g,this._queryCell,C,{},_),C},n.prototype._queryCell=function(s,u,h,g,_,x,T,C){var R=this.cells[_];if(R!==null)for(var M=this.keys,D=this.bboxes,O=0;O<R.length;O++){var j=R[O];if(T[j]===void 0){var G=4*j;(C?C(D[G+0],D[G+1],D[G+2],D[G+3]):s<=D[G+2]&&u<=D[G+3]&&h>=D[G+0]&&g>=D[G+1])?(T[j]=!0,x.push(M[j])):T[j]=!1}}},n.prototype._forEachCell=function(s,u,h,g,_,x,T,C){for(var R=this._convertToCellCoord(s),M=this._convertToCellCoord(u),D=this._convertToCellCoord(h),O=this._convertToCellCoord(g),j=R;j<=D;j++)for(var G=M;G<=O;G++){var X=this.d*G+j;if((!C||C(this._convertFromCellCoord(j),this._convertFromCellCoord(G),this._convertFromCellCoord(j+1),this._convertFromCellCoord(G+1)))&&_.call(this,s,u,h,g,X,x,T,C))return}},n.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},n.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},n.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,u=a+this.cells.length+1+1,h=0,g=0;g<this.cells.length;g++)h+=this.cells[g].length;var _=new Int32Array(u+h+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var x=u,T=0;T<s.length;T++){var C=s[T];_[a+T]=x,_.set(C,x),x+=C.length}return _[a+s.length]=x,_.set(this.keys,x),_[a+s.length+1]=x+=this.keys.length,_.set(this.bboxes,x),x+=this.bboxes.length,_.buffer},Kv}(),wh=er(iw);const _d={};function jt(a,n,s={}){Object.defineProperty(a,"_classRegistryKey",{value:n,writable:!1}),_d[n]={klass:a,omit:s.omit||[]}}jt(Object,"Object"),wh.serialize=function(a,n){const s=a.toArrayBuffer();return n&&n.add(s),{buffer:s}},wh.deserialize=function(a){return new wh(a.buffer)},Object.defineProperty(wh,"name",{value:"Grid"}),jt(wh,"Grid"),delete st.prototype.constructor,jt(Si,"Color"),jt(Error,"Error"),jt(go,"Formatted"),jt(ig,"FormattedSection"),jt(Go,"AJAXError"),jt(_o,"ResolvedImage"),jt(kg,"StylePropertyFunction"),jt(Mg,"StyleExpression",{omit:["_evaluator"]}),jt(so,"ImageId"),jt(lc,"ImageVariant"),jt(gd,"ZoomDependentExpression"),jt(bh,"ZoomConstantExpression"),jt(yo,"CompoundExpression",{omit:["_evaluate"]});for(const a in xh)_d[xh[a]._classRegistryKey]||jt(xh[a],`Expression${a}`);function Sp(a){return a&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function hc(a,n){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Sp(a)||a instanceof ImageBitmap)return n&&n.add(a),a;if(ArrayBuffer.isView(a))return n&&n.add(a.buffer),a;if(a instanceof ImageData)return n&&n.add(a.data.buffer),a;if(Array.isArray(a)){const s=[];for(const u of a)s.push(hc(u,n));return s}if(a instanceof Map){const s={$name:"Map",entries:[]};for(const[u,h]of a.entries())s.entries.push(hc(u),hc(h,n));return s}if(a instanceof Set){const s={$name:"Set"};let u=0;for(const h of a.values())s[++u]=hc(h);return s}if(typeof a=="bigint")return{$name:"BigInt",value:a.toString()};if(typeof a=="object"){const s=a.constructor,u=s._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${s.name}".`);const h=s.serialize?s.serialize(a,n):{};if(!s.serialize){for(const g in a)a.hasOwnProperty(g)&&(_d[u].omit.indexOf(g)>=0||(h[g]=hc(a[g],n)));a instanceof Error&&(h.message=a.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(h.$name=u),h}throw new Error("can't serialize object of type "+typeof a)}function Tu(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Sp(a)||a instanceof ImageBitmap||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(Tu);if(typeof a=="object"){const n=a.$name||"Object";if(n==="Map"){const h=a.entries||[],g=new Map;for(let _=0;_<h.length;_+=2)g.set(Tu(h[_]),Tu(h[_+1]));return g}if(n==="Set"){const h=new Set;for(const g of Object.keys(a))g!=="$name"&&h.add(Tu(a[g]));return h}if(n==="BigInt")return BigInt(a.value);const{klass:s}=_d[n];if(!s)throw new Error(`Can't deserialize unregistered class "${n}".`);if(s.deserialize)return s.deserialize(a);const u=Object.create(s.prototype);for(const h of Object.keys(a))h!=="$name"&&(u[h]=Tu(a[h]));return u}throw new Error("can't deserialize object of type "+typeof a)}const ln={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519,Osage:a=>a>=66736&&a<=66815,"CJK Unified Ideographs Extension B":a=>a>=131072&&a<=173791};function Cp(a){for(const n of a)if(Dg(n.charCodeAt(0)))return!0;return!1}function Xv(a){for(const n of a)if(!rw(n.charCodeAt(0)))return!1;return!0}function rw(a){return!(ln.Arabic(a)||ln["Arabic Supplement"](a)||ln["Arabic Extended-A"](a)||ln["Arabic Presentation Forms-A"](a)||ln["Arabic Presentation Forms-B"](a))}function Dg(a){return!(a!==746&&a!==747&&(a<4352||!(ln["Bopomofo Extended"](a)||ln.Bopomofo(a)||ln["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||ln["CJK Compatibility Ideographs"](a)||ln["CJK Compatibility"](a)||ln["CJK Radicals Supplement"](a)||ln["CJK Strokes"](a)||!(!ln["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||ln["CJK Unified Ideographs Extension A"](a)||ln["CJK Unified Ideographs"](a)||ln["Enclosed CJK Letters and Months"](a)||ln["Hangul Compatibility Jamo"](a)||ln["Hangul Jamo Extended-A"](a)||ln["Hangul Jamo Extended-B"](a)||ln["Hangul Jamo"](a)||ln["Hangul Syllables"](a)||ln.Hiragana(a)||ln["Ideographic Description Characters"](a)||ln.Kanbun(a)||ln["Kangxi Radicals"](a)||ln["Katakana Phonetic Extensions"](a)||ln.Katakana(a)&&a!==12540||!(!ln["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!ln["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||ln["Unified Canadian Aboriginal Syllabics"](a)||ln["Unified Canadian Aboriginal Syllabics Extended"](a)||ln["Vertical Forms"](a)||ln["Yijing Hexagram Symbols"](a)||ln["Yi Syllables"](a)||ln["Yi Radicals"](a))))}function Ng(a){return!(Dg(a)||function(n){return!!(ln["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||ln["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||ln["Letterlike Symbols"](n)||ln["Number Forms"](n)||ln["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||ln["Control Pictures"](n)&&n!==9251||ln["Optical Character Recognition"](n)||ln["Enclosed Alphanumerics"](n)||ln["Geometric Shapes"](n)||ln["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||ln["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||ln["CJK Symbols and Punctuation"](n)||ln.Katakana(n)||ln["Private Use Area"](n)||ln["CJK Compatibility Forms"](n)||ln["Small Form Variants"](n)||ln["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(a))}function Lg(a){return ln.Arabic(a)||ln["Arabic Supplement"](a)||ln["Arabic Extended-A"](a)||ln["Arabic Presentation Forms-A"](a)||ln["Arabic Presentation Forms-B"](a)}function Yv(a){return a>=1424&&a<=2303||ln["Arabic Presentation Forms-A"](a)||ln["Arabic Presentation Forms-B"](a)}function fc(a,n){return!(!n&&Yv(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||ln.Khmer(a))}function kI(a){for(const n of a)if(Yv(n.charCodeAt(0)))return!0;return!1}const Ho={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Qv=null,vo=Ho.unavailable,pc=null;const Ip=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(vo=Ho.error),Qv&&Qv(a)};function Og(){Fg.fire(new kl("pluginStateChange",{pluginStatus:vo,pluginURL:pc}))}const Fg=new ud,Ap=function(){return vo},sw=function(){if(vo!==Ho.deferred||!pc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");vo=Ho.loading,Og(),pc&&ac({url:pc},a=>{a?Ip(a):(vo=Ho.loaded,Og())})},mc={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>vo===Ho.loaded||mc.applyArabicShaping!=null,isLoading:()=>vo===Ho.loading,setState(a){vo=a.pluginStatus,pc=a.pluginURL},isParsing:()=>vo===Ho.parsing,isParsed:()=>vo===Ho.parsed,getPluginURL:()=>pc};class Wi{constructor(n,s){this.zoom=n,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness,this.worldview=s.worldview,this.activeFloors=s.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(n){return function(s,u){for(const h of s)if(!fc(h.charCodeAt(0),u))return!1;return!0}(n,mc.isLoaded())}}class zg{constructor(n,s,u,h,g){this.property=n,this.value=s,this.expression=function(_,x,T,C,R){if(Rg(_))return new kg(_,x);if(Ep(_)||Array.isArray(_)&&_.length>0){const M=Zv(_,x,T,C,R);if(M.result==="error")throw new Error(M.value.map(D=>`${D.key}: ${D.message}`).join(", "));return M.value}{let M=_;return typeof _=="string"&&x.type==="color"&&(M=Si.parse(_)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>M}}}(s===void 0?n.specification.default:s,n.specification,u,h,g)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,s,u,h){return this.property.possiblyEvaluate(this,n,s,u,h)}}class Jv{constructor(n,s,u,h){this.property=n,this.value=new zg(n,void 0,s,u,h)}transitioned(n,s){return new aw(this.property,this.value,s,Object.assign({},n.transition,this.transition),n.now)}untransitioned(){return new aw(this.property,this.value,null,{},0)}}class ow{constructor(n,s,u,h){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._scope=s,this._options=u,this._iconImageUseTheme=h,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(n){return nt(this._values[n].value.value)}setValue(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new Jv(this._values[n].property,this._scope,this._options,this._iconImageUseTheme)),this._values[n].value=new zg(this._values[n].property,s===null?void 0:nt(s),this._scope,this._options,this._iconImageUseTheme),this._values[n].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[n].value.isIndoorDependent())}setTransitionOrValue(n,s){s&&(this._options=s);const u=this._properties.properties;if(n)for(const h in n){const g=n[h];if(h.endsWith("-transition")){const _=h.slice(0,-11);u[_]&&this.setTransition(_,g)}else u.hasOwnProperty(h)&&this.setValue(h,g)}}getTransition(n){return nt(this._values[n].transition)}setTransition(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new Jv(this._values[n].property)),this._values[n].transition=nt(s)||void 0}serialize(){const n={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(n[s]=u);const h=this.getTransition(s);h!==void 0&&(n[`${s}-transition`]=h)}return n}transitioned(n,s){const u=new lw(this._properties);for(const h of Object.keys(this._values))u._values[h]=this._values[h].transitioned(n,s._values[h]);return u}untransitioned(){const n=new lw(this._properties);for(const s of Object.keys(this._values))n._values[s]=this._values[s].untransitioned();return n}isIndoorDependent(){return this._isIndoorDependent}}class aw{constructor(n,s,u,h,g){const _=h.delay||0,x=h.duration||0;g=g||0,this.property=n,this.value=s,this.begin=g+_,this.end=this.begin+x,n.specification.transition&&(h.delay||h.duration)&&(this.prior=u)}possiblyEvaluate(n,s,u){const h=n.now||0,g=this.value.possiblyEvaluate(n,s,u),_=this.prior;if(_){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return _.possiblyEvaluate(n,s,u);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(n,s,u),g,rd(x))}}return g}}class lw{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,s,u){const h=new vd(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(n,s,u);return h}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class cw{constructor(n,s,u,h){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._scope=s,this._options=u,this._iconImageUseTheme=h,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(n){return nt(this._values[n].value)}setValue(n,s){this._values[n]=new zg(this._values[n].property,s===null?void 0:nt(s),this._scope,this._options,this._iconImageUseTheme),this._values[n].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[n].isIndoorDependent())}serialize(){const n={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(n[s]=u)}return n}possiblyEvaluate(n,s,u,h){const g=new vd(this._properties);for(const _ of Object.keys(this._values))g._values[_]=this._values[_].possiblyEvaluate(n,s,u,h);return g}isIndoorDependent(){return this._isIndoorDependent}}class yd{constructor(n,s,u,h){this.property=n,this.value=s,this.parameters=u,this.iconImageUseTheme=h}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,s,u,h){return this.property.evaluate(this.value,this.parameters,n,s,u,h,this.iconImageUseTheme)}}class vd{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class xt{constructor(n){this.specification=n}possiblyEvaluate(n,s){return n.expression.evaluate(s)}interpolate(n,s,u){const h=lp[this.specification.type];return h?h(n,s,u):n}}class It{constructor(n,s){this.specification=n,this.overrides=s}possiblyEvaluate(n,s,u,h,g){return n.expression.kind==="constant"||n.expression.kind==="camera"?new yd(this,{kind:"constant",value:n.expression.evaluate(s,null,{},u,h,void 0,g)},s):new yd(this,n.expression,s,g)}interpolate(n,s,u){if(n.value.kind!=="constant"||s.value.kind!=="constant")return n;if(n.value.value===void 0||s.value.value===void 0)return new yd(this,{kind:"constant",value:void 0},n.parameters);const h=lp[this.specification.type];return h?new yd(this,{kind:"constant",value:h(n.value.value,s.value.value,u)},n.parameters):n}evaluate(n,s,u,h,g,_,x){return n.kind==="constant"?n.value:n.evaluate(s,u,h,g,_,void 0,x)}}class xd{constructor(n){this.specification=n}possiblyEvaluate(n,s,u,h){return!!n.expression.evaluate(s,null,{},u,h)}interpolate(){return!1}}class wr{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new Wi(0,{});for(const u in n){const h=n[u];h.specification.overridable&&this.overridableProperties.push(u);const g=this.defaultPropertyValues[u]=new zg(h,void 0),_=this.defaultTransitionablePropertyValues[u]=new Jv(h);this.defaultTransitioningPropertyValues[u]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=g.possiblyEvaluate(s)}}}jt(It,"DataDrivenProperty"),jt(xt,"DataConstantProperty"),jt(xd,"ColorRampProperty");var Fe=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function uw(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function jg(a){if(Array.isArray(a))return a.map(jg);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const n={};for(const s in a)n[s]=jg(a[s]);return n}return uw(a)}function zl(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const n of a.slice(1))if(!zl(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function Bg(a,n="",s=null,u="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};zl(a)||(a=Vg(a));const h=a;let g=!0;try{g=function(R){if(!Th(R))return R;let M=jg(R);return dw(M),M=bd(M),M}(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let _=null,x=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){x=Fe[`filter_${u}`];const R=wu(g,x,n,s);if(R.result==="error")throw new Error(R.value.map(M=>`${M.key}: ${M.message}`).join(", "));_=(M,D,O)=>R.value.evaluate(M,D,{},O)}let T=null,C=null;if(g!==h){const R=wu(h,x,n,s);if(R.result==="error")throw new Error(R.value.map(M=>`${M.key}: ${M.message}`).join(", "));T=(M,D,O,j,G)=>R.value.evaluate(M,D,{},O,void 0,void 0,j,G),C=!fh(R.value.expression)}return{filter:_,dynamicFilter:T||void 0,needGeometry:hw(g),needFeature:!!C}}function bd(a){if(!Array.isArray(a))return a;const n=function(s){if(DI.has(s[0])){for(let u=1;u<s.length;u++)if(Th(s[u]))return!0}return s}(a);return n===!0?n:n.map(s=>bd(s))}function dw(a){let n=!1;const s=[];if(a[0]==="case"){for(let u=1;u<a.length-1;u+=2)n=n||Th(a[u]),s.push(a[u+1]);s.push(a[a.length-1])}else if(a[0]==="match"){n=n||Th(a[1]);for(let u=2;u<a.length-1;u+=2)s.push(a[u+1]);s.push(a[a.length-1])}else if(a[0]==="step"){n=n||Th(a[1]);for(let u=1;u<a.length-1;u+=2)s.push(a[u+1])}n&&(a.length=0,a.push("any",...s));for(let u=1;u<a.length;u++)dw(a[u])}function Th(a){if(!Array.isArray(a))return!1;if((n=a[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let s=1;s<a.length;s++)if(Th(a[s]))return!0;return!1}const DI=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function NI(a,n){return a<n?-1:a>n?1:0}function hw(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let n=1;n<a.length;n++)if(hw(a[n]))return!0;return!1}function Vg(a){if(!a)return!0;const n=a[0];return a.length<=1?n!=="any":n==="=="?Ug(a[1],a[2],"=="):n==="!="?Pp(Ug(a[1],a[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Ug(a[1],a[2],n):n==="any"?(s=a.slice(1),["any"].concat(s.map(Vg))):n==="all"?["all"].concat(a.slice(1).map(Vg)):n==="none"?["all"].concat(a.slice(1).map(Vg).map(Pp)):n==="in"?$g(a[1],a.slice(2)):n==="!in"?Pp($g(a[1],a.slice(2))):n==="has"?Gg(a[1]):n!=="!has"||Pp(Gg(a[1]));var s}function Ug(a,n,s){switch(a){case"$type":return[`filter-type-${s}`,n];case"$id":return[`filter-id-${s}`,n];default:return[`filter-${s}`,a,n]}}function $g(a,n){if(n.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(s=>typeof s!=typeof n[0])?["filter-in-large",a,["literal",n.sort(NI)]]:["filter-in-small",a,["literal",n]]}}function Gg(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Pp(a){return["!",a]}const wd="";function ul(a,n){return n?`${a}${wd}${n}`:a}let fw;const pw=()=>fw||(fw=new wr({"icon-size":new It(Fe.layout_symbol["icon-size"]),"icon-image":new It(Fe.layout_symbol["icon-image"]),"icon-rotate":new It(Fe.layout_symbol["icon-rotate"]),"icon-offset":new It(Fe.layout_symbol["icon-offset"]),"text-size":new It(Fe.layout_symbol["text-size"]),"text-rotate":new It(Fe.layout_symbol["text-rotate"]),"text-offset":new It(Fe.layout_symbol["text-offset"])}));class mw{constructor(n,s,u,h,g,_){const x=wu(n,Fe.appearance.condition);if(x.result==="success"&&(this.condition=x.value),this.name=s,u){this.properties=new vd(pw()),this.unevaluatedLayout=new cw(pw(),h,g,_);for(const T in u)this.unevaluatedLayout.setValue(T,u[T])}}isActive(n){return!(this.condition||!n.isHidden||this.name!=="hidden")||this.condition.evaluate(n.globals,n.feature,n.featureState,n.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(n){return this.properties.get(n)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(n){return this.unevaluatedLayout._values[n]}recalculate(n,s,u){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(n,void 0,s,u))}serialize(){const n={};return n.condition=this.condition.expression.serialize(),this.name&&(n.name=this.name),this.unevaluatedLayout&&(n.properties=this.unevaluatedLayout.serialize()),n}hasIconProperties(){const n=this.hasProperty("icon-image"),s=this.hasProperty("icon-size"),u=this.hasProperty("icon-offset"),h=this.hasProperty("icon-rotate");return n||s||u||h}hasTextProperties(){const n=this.hasProperty("text-size"),s=this.hasProperty("text-offset"),u=this.hasProperty("text-rotate");return n||s||u}hasProperty(n){return this.getUnevaluatedProperty(n).value!==void 0}}const gw="-transition",jl=new Set(["fill","line","background","hillshade","raster"]);class xo extends ud{constructor(n,s,u,h,g,_){if(super(),this.id=n.id,this.fqid=ul(this.id,u),this.type=n.type,this.scope=u,this.lut=h,this.options=g,this.iconImageUseTheme=_,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},n.type!=="custom"){if(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type&&n.type!=="background"&&n.type!=="sky"&&n.type!=="slot"){this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter;const x=wu(this.filter,Fe[`filter_${n.type}`]);x.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...x.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||x.value.isIndoorDependent)}if(n.slot&&(this.slot=n.slot),n.appearances&&this.setAppearances(n.appearances),s.layout&&(this._unevaluatedLayout=new cw(s.layout,this.scope,g,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),s.paint){this._transitionablePaint=new ow(s.paint,this.scope,g);for(const x in n.paint)this.setPaintProperty(x,n.paint[x]);for(const x in n.layout)this.setLayoutProperty(x,n.layout[x]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new vd(s.paint)}}}onAdd(n){}onRemove(n){}isDraped(n){return!this.is3D(!0)&&jl.has(this.type)}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,s){if(this.type==="custom"&&n==="visibility")return void(this.visibility=s);const u=this._unevaluatedLayout;u._properties.properties[n]&&(u.setValue(n,s),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),n==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(n){this.appearances=[],n.forEach(s=>{this.appearances.push(new mw(s.condition,s.name,s.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(n){return n.endsWith(gw)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}isPaintProperty(n){return!!this._transitionablePaint._properties.properties[n]}setPaintProperty(n,s){const u=this._transitionablePaint,h=u._properties.properties;if(n.endsWith(gw)){const M=n.slice(0,-11);return h[M]&&u.setTransition(M,s||void 0),!1}if(!h[n])return!1;const g=u._values[n],_=g.value.isDataDriven(),x=g.value;u.setValue(n,s),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(n);const T=u._values[n].value,C=T.isDataDriven(),R=n.endsWith("pattern")||n==="line-dasharray";return C||_||R||this._handleOverridablePaintPropertyUpdate(n,x,T)}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getDefaultProgramParams(n,s,u){return null}_handleOverridablePaintPropertyUpdate(n,s,u){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,s,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,s)}serialize(){const n={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(n.appearances=this.appearances.map(s=>s.serialize())),mt(n,(s,u)=>!(s===void 0||u==="layout"&&!Object.keys(s).length||u==="paint"&&!Object.keys(s).length))}is3D(n){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const n in this.paint._values){const s=this.paint.get(n);if(s instanceof yd&&Tp(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}for(const n of this.appearances)if(!_p(n.condition.expression))return!0;return!1}compileFilter(n){this._filterCompiled||(this._featureFilter=Bg(this.filter,this.scope,n),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(n){this._stats&&(n.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(n,s,u){return{}}queryRadius(n){}queryIntersectsFeature(n,s,u,h,g,_,x,T,C){}}const _w={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Rp{constructor(n,s){this._structArray=n,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const LI=new ArrayBuffer(0);class nr{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(n,s){return n._trim(),s&&n.arrayBuffer&&s.add(n.arrayBuffer),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const s=Object.create(this.prototype);return s.arrayBuffer=n.arrayBuffer,s.length=n.length,n.arrayBuffer?s.capacity=n.arrayBuffer.byteLength/s.bytesPerElement:(s.capacity=0,s.arrayBuffer=LI),s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this._reallocCount++,this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}reserveForAdditional(n){this.reserve(this.length+n)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...n){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...n){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Gn(a,n=1){let s=0,u=0;return{members:a.map(h=>{const g=_w[h.type].BYTES_PER_ELEMENT,_=s=yw(s,Math.max(n,g)),x=h.components||1;return u=Math.max(u,g),s+=g*x,{name:h.name,type:h.type,components:x,offset:_}}),size:yw(s,Math.max(u,n)),alignment:n}}function yw(a,n){return Math.ceil(a/n)*n}class Eu extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s){const u=this.length;return this.resize(u+1),this.emplace(u,n,s)}emplace(n,s,u){const h=2*n;return this.int16[h+0]=s,this.int16[h+1]=u,n}}Eu.prototype.bytesPerElement=4,jt(Eu,"StructArrayLayout2i4");class Eh extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u){const h=this.length;return this.resize(h+1),this.emplace(h,n,s,u)}emplace(n,s,u,h){const g=3*n;return this.int16[g+0]=s,this.int16[g+1]=u,this.int16[g+2]=h,n}}Eh.prototype.bytesPerElement=6,jt(Eh,"StructArrayLayout3i6");class Sh extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,n,s,u,h)}emplace(n,s,u,h,g){const _=4*n;return this.int16[_+0]=s,this.int16[_+1]=u,this.int16[_+2]=h,this.int16[_+3]=g,n}}Sh.prototype.bytesPerElement=8,jt(Sh,"StructArrayLayout4i8");class gc extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.float32[1*n+0]=s,n}}gc.prototype.bytesPerElement=4,jt(gc,"StructArrayLayout1f4");class ex extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u){const h=this.length;return this.resize(h+1),this.emplace(h,n,s,u)}emplace(n,s,u,h){const g=4*n,_=2*n;return this.int16[g+0]=s,this.int16[g+1]=u,this.float32[_+1]=h,n}}ex.prototype.bytesPerElement=8,jt(ex,"StructArrayLayout2i1f8");class tx extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u){const h=this.length;return this.resize(h+1),this.emplace(h,n,s,u)}emplace(n,s,u,h){const g=4*n;return this.int16[g+0]=s,this.int16[g+1]=u,this.int16[g+2]=h,n}}tx.prototype.bytesPerElement=8,jt(tx,"StructArrayLayout3i8");class nx extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,n,s,u,h,g)}emplace(n,s,u,h,g,_){const x=5*n;return this.int16[x+0]=s,this.int16[x+1]=u,this.int16[x+2]=h,this.int16[x+3]=g,this.int16[x+4]=_,n}}nx.prototype.bytesPerElement=10,jt(nx,"StructArrayLayout5i10");class Hg extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,g,_,x){const T=this.length;return this.resize(T+1),this.emplace(T,n,s,u,h,g,_,x)}emplace(n,s,u,h,g,_,x,T){const C=6*n,R=12*n,M=3*n;return this.int16[C+0]=s,this.int16[C+1]=u,this.uint8[R+4]=h,this.uint8[R+5]=g,this.uint8[R+6]=_,this.uint8[R+7]=x,this.float32[M+2]=T,n}}Hg.prototype.bytesPerElement=12,jt(Hg,"StructArrayLayout2i4ub1f12");class oa extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u){const h=this.length;return this.resize(h+1),this.emplace(h,n,s,u)}emplace(n,s,u,h){const g=3*n;return this.float32[g+0]=s,this.float32[g+1]=u,this.float32[g+2]=h,n}}oa.prototype.bytesPerElement=12,jt(oa,"StructArrayLayout3f12");class ko extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,n,s,u,h,g)}emplace(n,s,u,h,g,_){const x=6*n,T=3*n;return this.uint16[x+0]=s,this.uint16[x+1]=u,this.uint16[x+2]=h,this.uint16[x+3]=g,this.float32[T+2]=_,n}}ko.prototype.bytesPerElement=12,jt(ko,"StructArrayLayout4ui1f12");class Td extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,n,s,u,h)}emplace(n,s,u,h,g){const _=4*n;return this.uint16[_+0]=s,this.uint16[_+1]=u,this.uint16[_+2]=h,this.uint16[_+3]=g,n}}Td.prototype.bytesPerElement=8,jt(Td,"StructArrayLayout4ui8");class Wg extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u,h,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,n,s,u,h,g,_)}emplace(n,s,u,h,g,_,x){const T=6*n;return this.int16[T+0]=s,this.int16[T+1]=u,this.int16[T+2]=h,this.int16[T+3]=g,this.int16[T+4]=_,this.int16[T+5]=x,n}}Wg.prototype.bytesPerElement=12,jt(Wg,"StructArrayLayout6i12");class ix extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,u,h,g,_,x,T,C,R,M,D){const O=this.length;return this.resize(O+1),this.emplace(O,n,s,u,h,g,_,x,T,C,R,M,D)}emplace(n,s,u,h,g,_,x,T,C,R,M,D,O){const j=12*n;return this.int16[j+0]=s,this.int16[j+1]=u,this.int16[j+2]=h,this.int16[j+3]=g,this.uint16[j+4]=_,this.uint16[j+5]=x,this.uint16[j+6]=T,this.uint16[j+7]=C,this.int16[j+8]=R,this.int16[j+9]=M,this.int16[j+10]=D,this.int16[j+11]=O,n}}ix.prototype.bytesPerElement=24,jt(ix,"StructArrayLayout4i4ui4i24");class rx extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,n,s,u,h,g,_)}emplace(n,s,u,h,g,_,x){const T=10*n,C=5*n;return this.int16[T+0]=s,this.int16[T+1]=u,this.int16[T+2]=h,this.float32[C+2]=g,this.float32[C+3]=_,this.float32[C+4]=x,n}}rx.prototype.bytesPerElement=20,jt(rx,"StructArrayLayout3i3f20");class Su extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,n,s,u,h)}emplace(n,s,u,h,g){const _=4*n;return this.float32[_+0]=s,this.float32[_+1]=u,this.float32[_+2]=h,this.float32[_+3]=g,n}}Su.prototype.bytesPerElement=16,jt(Su,"StructArrayLayout4f16");class qg extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint32[1*n+0]=s,n}}qg.prototype.bytesPerElement=4,jt(qg,"StructArrayLayout1ul4");class aa extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s){const u=this.length;return this.resize(u+1),this.emplace(u,n,s)}emplace(n,s,u){const h=2*n;return this.uint16[h+0]=s,this.uint16[h+1]=u,n}}aa.prototype.bytesPerElement=4,jt(aa,"StructArrayLayout2ui4");class Zg extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,u,h,g,_,x,T,C,R,M,D,O){const j=this.length;return this.resize(j+1),this.emplace(j,n,s,u,h,g,_,x,T,C,R,M,D,O)}emplace(n,s,u,h,g,_,x,T,C,R,M,D,O,j){const G=20*n,X=10*n;return this.int16[G+0]=s,this.int16[G+1]=u,this.int16[G+2]=h,this.int16[G+3]=g,this.int16[G+4]=_,this.float32[X+3]=x,this.float32[X+4]=T,this.float32[X+5]=C,this.float32[X+6]=R,this.int16[G+14]=M,this.uint32[X+8]=D,this.uint16[G+18]=O,this.uint16[G+19]=j,n}}Zg.prototype.bytesPerElement=40,jt(Zg,"StructArrayLayout5i4f1i1ul2ui40");class Kg extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u,h,g,_,x){const T=this.length;return this.resize(T+1),this.emplace(T,n,s,u,h,g,_,x)}emplace(n,s,u,h,g,_,x,T){const C=8*n;return this.int16[C+0]=s,this.int16[C+1]=u,this.int16[C+2]=h,this.int16[C+4]=g,this.int16[C+5]=_,this.int16[C+6]=x,this.int16[C+7]=T,n}}Kg.prototype.bytesPerElement=16,jt(Kg,"StructArrayLayout3i2i2i16");class Xg extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,n,s,u,h,g)}emplace(n,s,u,h,g,_){const x=4*n,T=8*n;return this.float32[x+0]=s,this.float32[x+1]=u,this.float32[x+2]=h,this.int16[T+6]=g,this.int16[T+7]=_,n}}Xg.prototype.bytesPerElement=16,jt(Xg,"StructArrayLayout2f1f2i16");class sx extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,n,s,u,h,g,_)}emplace(n,s,u,h,g,_,x){const T=20*n,C=5*n;return this.uint8[T+0]=s,this.uint8[T+1]=u,this.float32[C+1]=h,this.float32[C+2]=g,this.float32[C+3]=_,this.float32[C+4]=x,n}}sx.prototype.bytesPerElement=20,jt(sx,"StructArrayLayout2ub4f20");class Jr extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,u){const h=this.length;return this.resize(h+1),this.emplace(h,n,s,u)}emplace(n,s,u,h){const g=3*n;return this.uint16[g+0]=s,this.uint16[g+1]=u,this.uint16[g+2]=h,n}}Jr.prototype.bytesPerElement=6,jt(Jr,"StructArrayLayout3ui6");class Ch extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,g,_,x,T,C,R,M,D,O,j,G,X,K,se,ae,de,ve){const me=this.length;return this.resize(me+1),this.emplace(me,n,s,u,h,g,_,x,T,C,R,M,D,O,j,G,X,K,se,ae,de,ve)}emplace(n,s,u,h,g,_,x,T,C,R,M,D,O,j,G,X,K,se,ae,de,ve,me){const Te=30*n,Ie=15*n,Re=60*n;return this.int16[Te+0]=s,this.int16[Te+1]=u,this.int16[Te+2]=h,this.float32[Ie+2]=g,this.float32[Ie+3]=_,this.uint16[Te+8]=x,this.uint16[Te+9]=T,this.uint32[Ie+5]=C,this.uint32[Ie+6]=R,this.uint32[Ie+7]=M,this.uint16[Te+16]=D,this.uint16[Te+17]=O,this.uint16[Te+18]=j,this.float32[Ie+10]=G,this.float32[Ie+11]=X,this.uint8[Re+48]=K,this.uint8[Re+49]=se,this.uint8[Re+50]=ae,this.uint32[Ie+13]=de,this.int16[Te+28]=ve,this.uint8[Re+58]=me,n}}Ch.prototype.bytesPerElement=60,jt(Ch,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ox extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,g,_,x,T,C,R,M,D,O,j,G,X,K,se,ae,de,ve,me,Te,Ie,Re,qe,Ne,Qe,it,rt,ht,pt,ct){const ut=this.length;return this.resize(ut+1),this.emplace(ut,n,s,u,h,g,_,x,T,C,R,M,D,O,j,G,X,K,se,ae,de,ve,me,Te,Ie,Re,qe,Ne,Qe,it,rt,ht,pt,ct)}emplace(n,s,u,h,g,_,x,T,C,R,M,D,O,j,G,X,K,se,ae,de,ve,me,Te,Ie,Re,qe,Ne,Qe,it,rt,ht,pt,ct,ut){const Ye=20*n,Ze=40*n,dt=80*n;return this.float32[Ye+0]=s,this.float32[Ye+1]=u,this.int16[Ze+4]=h,this.int16[Ze+5]=g,this.int16[Ze+6]=_,this.int16[Ze+7]=x,this.int16[Ze+8]=T,this.int16[Ze+9]=C,this.int16[Ze+10]=R,this.int16[Ze+11]=M,this.int16[Ze+12]=D,this.uint16[Ze+13]=O,this.uint16[Ze+14]=j,this.uint16[Ze+15]=G,this.uint16[Ze+16]=X,this.uint16[Ze+17]=K,this.uint16[Ze+18]=se,this.uint16[Ze+19]=ae,this.uint16[Ze+20]=de,this.uint16[Ze+21]=ve,this.uint16[Ze+22]=me,this.uint16[Ze+23]=Te,this.uint16[Ze+24]=Ie,this.uint16[Ze+25]=Re,this.uint16[Ze+26]=qe,this.uint16[Ze+27]=Ne,this.uint32[Ye+14]=Qe,this.float32[Ye+15]=it,this.float32[Ye+16]=rt,this.float32[Ye+17]=ht,this.float32[Ye+18]=pt,this.uint8[dt+76]=ct,this.uint16[Ze+39]=ut,n}}ox.prototype.bytesPerElement=80,jt(ox,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class ax extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,n,s,u,h,g,_)}emplace(n,s,u,h,g,_,x){const T=6*n;return this.float32[T+0]=s,this.float32[T+1]=u,this.float32[T+2]=h,this.float32[T+3]=g,this.float32[T+4]=_,this.float32[T+5]=x,n}}ax.prototype.bytesPerElement=24,jt(ax,"StructArrayLayout6f24");class Ed extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,n,s,u,h,g)}emplace(n,s,u,h,g,_){const x=5*n;return this.float32[x+0]=s,this.float32[x+1]=u,this.float32[x+2]=h,this.float32[x+3]=g,this.float32[x+4]=_,n}}Ed.prototype.bytesPerElement=20,jt(Ed,"StructArrayLayout5f20");class lx extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,g,_,x){const T=this.length;return this.resize(T+1),this.emplace(T,n,s,u,h,g,_,x)}emplace(n,s,u,h,g,_,x,T){const C=7*n;return this.float32[C+0]=s,this.float32[C+1]=u,this.float32[C+2]=h,this.float32[C+3]=g,this.float32[C+4]=_,this.float32[C+5]=x,this.float32[C+6]=T,n}}lx.prototype.bytesPerElement=28,jt(lx,"StructArrayLayout7f28");class cx extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,g,_,x,T,C,R,M){const D=this.length;return this.resize(D+1),this.emplace(D,n,s,u,h,g,_,x,T,C,R,M)}emplace(n,s,u,h,g,_,x,T,C,R,M,D){const O=11*n;return this.float32[O+0]=s,this.float32[O+1]=u,this.float32[O+2]=h,this.float32[O+3]=g,this.float32[O+4]=_,this.float32[O+5]=x,this.float32[O+6]=T,this.float32[O+7]=C,this.float32[O+8]=R,this.float32[O+9]=M,this.float32[O+10]=D,n}}cx.prototype.bytesPerElement=44,jt(cx,"StructArrayLayout11f44");class Ih extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,g,_,x,T,C){const R=this.length;return this.resize(R+1),this.emplace(R,n,s,u,h,g,_,x,T,C)}emplace(n,s,u,h,g,_,x,T,C,R){const M=9*n;return this.float32[M+0]=s,this.float32[M+1]=u,this.float32[M+2]=h,this.float32[M+3]=g,this.float32[M+4]=_,this.float32[M+5]=x,this.float32[M+6]=T,this.float32[M+7]=C,this.float32[M+8]=R,n}}Ih.prototype.bytesPerElement=36,jt(Ih,"StructArrayLayout9f36");class Bl extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s){const u=this.length;return this.resize(u+1),this.emplace(u,n,s)}emplace(n,s,u){const h=2*n;return this.float32[h+0]=s,this.float32[h+1]=u,n}}Bl.prototype.bytesPerElement=8,jt(Bl,"StructArrayLayout2f8");class Do extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,n,s,u,h)}emplace(n,s,u,h,g){const _=6*n;return this.uint32[3*n+0]=s,this.uint16[_+2]=u,this.uint16[_+3]=h,this.uint16[_+4]=g,n}}Do.prototype.bytesPerElement=12,jt(Do,"StructArrayLayout1ul3ui12");class Cu extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint16[1*n+0]=s,n}}Cu.prototype.bytesPerElement=2,jt(Cu,"StructArrayLayout1ui2");class ux extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,g,_,x,T,C,R,M,D,O,j,G,X){const K=this.length;return this.resize(K+1),this.emplace(K,n,s,u,h,g,_,x,T,C,R,M,D,O,j,G,X)}emplace(n,s,u,h,g,_,x,T,C,R,M,D,O,j,G,X,K){const se=16*n;return this.float32[se+0]=s,this.float32[se+1]=u,this.float32[se+2]=h,this.float32[se+3]=g,this.float32[se+4]=_,this.float32[se+5]=x,this.float32[se+6]=T,this.float32[se+7]=C,this.float32[se+8]=R,this.float32[se+9]=M,this.float32[se+10]=D,this.float32[se+11]=O,this.float32[se+12]=j,this.float32[se+13]=G,this.float32[se+14]=X,this.float32[se+15]=K,n}}ux.prototype.bytesPerElement=64,jt(ux,"StructArrayLayout16f64");class Yg extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,g,_,x){const T=this.length;return this.resize(T+1),this.emplace(T,n,s,u,h,g,_,x)}emplace(n,s,u,h,g,_,x,T){const C=10*n,R=5*n;return this.uint16[C+0]=s,this.uint16[C+1]=u,this.uint16[C+2]=h,this.uint16[C+3]=g,this.float32[R+2]=_,this.float32[R+3]=x,this.float32[R+4]=T,n}}Yg.prototype.bytesPerElement=20,jt(Yg,"StructArrayLayout4ui3f20");class dx extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.int16[1*n+0]=s,n}}dx.prototype.bytesPerElement=2,jt(dx,"StructArrayLayout1i2");class Qg extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint8[1*n+0]=s,n}}Qg.prototype.bytesPerElement=1,jt(Qg,"StructArrayLayout1ub1");class Jg extends Rp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Jg.prototype.size=40;class vw extends Zg{get(n){return new Jg(this,n)}}jt(vw,"CollisionBoxArray");class e_ extends Rp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}e_.prototype.size=60;class xw extends Ch{get(n){return new e_(this,n)}}jt(xw,"PlacedSymbolArray");class bw extends Rp{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(n){this._structArray.uint32[this._pos4+14]=n}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(n){this._structArray.float32[this._pos4+18]=n}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}bw.prototype.size=80;class hx extends ox{get(n){return new bw(this,n)}}jt(hx,"SymbolInstanceArray");class t_ extends gc{getoffsetX(n){return this.float32[1*n+0]}}jt(t_,"GlyphOffsetArray");class ww extends Eu{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}jt(ww,"SymbolLineVertexArray");class fx extends Rp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}fx.prototype.size=12;class px extends Do{get(n){return new fx(this,n)}}jt(px,"FeatureIndexArray");class Tw extends aa{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}jt(Tw,"FillExtrusionCentroidArray");class n_ extends Rp{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}n_.prototype.size=6;class Mp extends Eh{get(n){return new n_(this,n)}}jt(Mp,"FillExtrusionWallArray");const Ew=Gn([{name:"a_pos",components:2,type:"Int16"}],4),OI=Gn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Sw=Gn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class dr{constructor(n=[]){this.segments=n}_prepareSegment(n,s,u,h){let g=this.segments[this.segments.length-1];return n>dr.MAX_VERTEX_ARRAY_LENGTH&&Nt(`Max vertices per segment is ${dr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!g||g.vertexLength+n>dr.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:s,primitiveOffset:u,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g}prepareSegment(n,s,u,h){return this._prepareSegment(n,s.length,u.length,h)}get(){return this.segments}destroy(){for(const n of this.segments)for(const s in n.vaos)n.vaos[s].destroy()}static simpleSegment(n,s,u,h){return new dr([{vertexOffset:n,primitiveOffset:s,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])}}function i_(a,n){return 256*(a=Y(Math.floor(a),0,255))+Y(Math.floor(n),0,255)}dr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,jt(dr,"SegmentVector");const FI=Gn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),zI=Gn([{name:"a_pattern_b",components:4,type:"Uint16"}]),jI=Gn([{name:"a_dash",components:4,type:"Uint16"}]);class kp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(n,s,u,h){this.ids.push(mx(n)),this.positions.push(s,u,h)}eachPosition(n,s){const u=mx(n);let h=0,g=this.ids.length-1;for(;h<g;){const _=h+g>>1;this.ids[_]>=u?g=_:h=_+1}for(;this.ids[h]===u;)s(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(n,s){const u=new Float64Array(n.ids),h=new Uint32Array(n.positions);return gx(u,h,0,u.length-1),s&&(s.add(u.buffer),s.add(h.buffer)),{ids:u,positions:h}}static deserialize(n){const s=new kp;let u;s.ids=n.ids,s.positions=n.positions;for(const h of s.ids)h!==u&&s.uniqueIds.push(h),u=h;return s.indexed=!0,s}}function mx(a){const n=+a;return Number.isSafeInteger(n)?n:Jm(String(a))}function gx(a,n,s,u){for(;s<u;){const h=a[s+u>>1];let g=s-1,_=u+1;for(;;){do g++;while(a[g]<h);do _--;while(a[_]>h);if(g>=_)break;r_(a,g,_),r_(n,3*g,3*_),r_(n,3*g+1,3*_+1),r_(n,3*g+2,3*_+2)}_-s<u-_?(gx(a,n,s,_),s=_+1):(gx(a,n,_+1,u),u=_)}}function r_(a,n,s){const u=a[n];a[n]=a[s],a[s]=u}jt(kp,"FeaturePositionMap");class _c{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,s),this.initialized=!0),!!this.location}set(n,s,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class s_ extends _c{constructor(n){super(n),this.current=0}set(n,s,u){this.fetchUniformLocation(n,s)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class es extends _c{constructor(n){super(n),this.current=0}set(n,s,u){this.fetchUniformLocation(n,s)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class Vl extends _c{constructor(n){super(n),this.current=[0,0]}set(n,s,u){this.fetchUniformLocation(n,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Dp extends _c{constructor(n){super(n),this.current=[0,0,0]}set(n,s,u){this.fetchUniformLocation(n,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class o_ extends _c{constructor(n){super(n),this.current=[0,0,0,0]}set(n,s,u){this.fetchUniformLocation(n,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class Np extends _c{constructor(n){super(n),this.current=Si.transparent.toPremultipliedRenderColor(null)}set(n,s,u){this.fetchUniformLocation(n,s)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const BI=new Float32Array(16);class Lp extends _c{constructor(n){super(n),this.current=BI}set(n,s,u){if(this.fetchUniformLocation(n,s)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const a_=new Float32Array(9),VI=new Float32Array(4);class l_ extends _c{constructor(n){super(n),this.current=VI}set(n,s,u){if(this.fetchUniformLocation(n,s)){for(let h=0;h<4;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function _x(a){return[i_(255*a.r,255*a.g),i_(255*a.b,255*a.a)]}function Op(a,n,s,u,h,g,_,x){return!!a&&(a.kind==="composite"||a.kind==="source"?a.evaluate(new Wi(0,{brightness:g,worldview:x}),n,s,h,u,_)==="none":a.value==="none")}class Fp{constructor(n,s,u,h){this.value=n,this.uniformNames=s.map(g=>`u_${g}`),this.type=u,this.context=h}setUniform(n,s,u,h,g){const _=h.constantOr(this.value);s.set(n,g,_ instanceof Si?_.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(n,s){return this.type==="color"?new Np(n):new es(n)}}class Ah{constructor(n,s){this.uniformNames=s.map(u=>`u_${u}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(n,s){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br),this.patternTransition=s?s.tl.concat(s.br):this.pattern}setUniform(n,s,u,h,g){let _=null;g!=="u_pattern"&&g!=="u_dash"||(_=this.pattern),g==="u_pattern_b"&&(_=this.patternTransition),g==="u_pixel_ratio"&&(_=this.pixelRatio),_&&s.set(n,g,_)}getBinding(n,s){return s==="u_pattern"||s==="u_pattern_b"||s==="u_dash"?new o_(n):new es(n)}}class yc{constructor(n,s,u,h){this.expression=n,this.type=u,this.maxValue=0,this.paintVertexAttributes=s.map(g=>({name:`a_${g}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(n,s,u,h,g,_,x,T){const C=this.paintVertexArray.length,R=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Wi(0,{brightness:_,worldview:T}),s,{},g,h,x):this.expression.kind==="constant"&&this.expression.value,M=Op(this.lutExpression,s,{},h,g,_,x,T);this.paintVertexArray.resize(n),this._setPaintValue(C,n,R,M?null:this.context.lut)}updatePaintArray(n,s,u,h,g,_,x,T){const C=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:x,worldview:T},u,h,void 0,g):this.expression.kind==="constant"&&this.expression.value,R=Op(this.lutExpression,u,h,g,void 0,x,void 0,T);this._setPaintValue(n,s,C,R?null:this.context.lut)}_setPaintValue(n,s,u,h){if(this.type==="color"){const g=_x(u.toPremultipliedRenderColor(h));for(let _=n;_<s;_++)this.paintVertexArray.emplace(_,g[0],g[1])}else{for(let g=n;g<s;g++)this.paintVertexArray.emplace(g,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class vc{constructor(n,s,u,h,g,_){this.expression=n,this.uniformNames=s.map(x=>`u_${x}_t`),this.type=u,this.useIntegerZoom=h,this.context=g,this.maxValue=0,this.paintVertexAttributes=s.map(x=>({name:`a_${x}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(n,s,u,h,g,_,x,T){const C=this.expression.evaluate(new Wi(this.context.zoom,{brightness:_,worldview:T}),s,{},g,h,x),R=this.expression.evaluate(new Wi(this.context.zoom+1,{brightness:_,worldview:T}),s,{},g,h,x),M=Op(this.lutExpression,s,{},h,g,_,x,T),D=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(D,n,C,R,M?null:this.context.lut)}updatePaintArray(n,s,u,h,g,_,x,T){const C=this.expression.evaluate({zoom:this.context.zoom,brightness:x,worldview:T},u,h,void 0,g),R=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x,worldview:T},u,h,void 0,g),M=Op(this.lutExpression,u,h,g,void 0,x,void 0,T);this._setPaintValue(n,s,C,R,M?null:this.context.lut)}_setPaintValue(n,s,u,h,g){if(this.type==="color"){const _=_x(u.toPremultipliedRenderColor(g)),x=_x(u.toPremultipliedRenderColor(g));for(let T=n;T<s;T++)this.paintVertexArray.emplace(T,_[0],_[1],x[0],x[1])}else{for(let _=n;_<s;_++)this.paintVertexArray.emplace(_,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,s,u,h,g){const _=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,x=Y(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);s.set(n,g,x)}getBinding(n,s){return new es(n)}}class xc{constructor(n,s,u,h,g){this.expression=n,this.layerId=g,this.paintVertexAttributes=(u==="array"?jI:FI).members;for(let _=0;_<s.length;++_);this.paintVertexArray=new h,this.paintTransitionVertexArray=new Td}populatePaintArray(n,s,u,h){const g=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(g,n,s.patterns&&s.patterns[this.layerId],u)}updatePaintArray(n,s,u,h,g,_,x){this._setPaintValues(n,s,u.patterns&&u.patterns[this.layerId],_)}_setPaintValues(n,s,u,h){if(!h||!u)return;const g=h[u[0]],_=h[u[1]];if(g){if(g){const{tl:x,br:T,pixelRatio:C}=g;for(let R=n;R<s;R++)this.paintVertexArray.emplace(R,x[0],x[1],T[0],T[1],C)}if(_){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:x,br:T}=_;for(let C=n;C<s;C++)this.paintTransitionVertexArray.emplace(C,x[0],x[1],T[0],T[1])}}}upload(n){const s=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,s)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=n.createVertexBuffer(this.paintTransitionVertexArray,zI.members,s))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Iu{constructor(n,s,u=()=>!0){this.binders={},this._buffers=[],this.context=s;const h=[];for(const g in n.paint._values){const _=n.paint.get(g);if(g.endsWith("-use-theme")||!u(g)||!(_ instanceof yd&&Tp(_.property.specification)))continue;const x=$I(g,n.type),T=_.value,C=_.property.specification.type,R=!!_.property.useIntegerZoom,M=g==="line-dasharray"||g.endsWith("pattern"),D=n.paint.get(`${g}-use-theme`),O=g==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant"||D&&D.value.kind!=="constant";if(T.kind!=="constant"||O)if(T.kind==="source"||O||M){const j=yx(g,C,"source");this.binders[g]=M?new xc(T,x,C,j,n.id):new yc(T,x,C,j),h.push(`/a_${g}`)}else{const j=yx(g,C,"composite");this.binders[g]=new vc(T,x,C,R,s,j),h.push(`/z_${g}`)}else this.binders[g]=M?new Ah(T.value,x):new Fp(T.value,x,C,s),h.push(`/u_${g}`);D&&(this.binders[g].lutExpression=D.value)}this.cacheKey=h.sort().join("")}getMaxValue(n){const s=this.binders[n];return s instanceof yc||s instanceof vc?s.maxValue:0}populatePaintArrays(n,s,u,h,g,_,x,T){for(const C in this.binders){const R=this.binders[C];R.context=this.context,(R instanceof yc||R instanceof vc||R instanceof xc)&&R.populatePaintArray(n,s,u,h,g,_,x,T)}}setConstantPatternPositions(n,s){for(const u in this.binders){const h=this.binders[u];h instanceof Ah&&h.setConstantPatternPositions(n,s)}}getPatternTransitionVertexBuffer(n){const s=this.binders[n];return s instanceof xc?s.paintTransitionVertexBuffer:null}updatePaintArrays(n,s,u,h,g,_,x,T,C,R){let M=!1;const D=Object.keys(n),O=D.length!==0&&!T,j=O?D:s.uniqueIds;this.context.lut=g.lut;for(const G in this.binders){const X=this.binders[G];if(X.context=this.context,(X instanceof yc||X instanceof vc||X instanceof xc)&&X.expression&&X.expression.kind&&X.expression.kind!=="constant"&&(X.expression.isStateDependent===!0||X.expression.isLightConstant===!1)){const K=g.paint.get(G);X.expression=K.value;for(const se of j){const ae=n[se.toString()];s.eachPosition(se,(de,ve,me)=>{const Te=h.feature(de);X.updatePaintArray(ve,me,Te,ae,_,x,C,R)})}if(!O)for(const se of u.uniqueIds){const ae=n[se.toString()];u.eachPosition(se,(de,ve,me)=>{const Te=h.feature(de);X.updatePaintArray(ve,me,Te,ae,_,x,C,R)})}M=!0}}return M}defines(){const n=[];for(const s in this.binders){const u=this.binders[s];(u instanceof Fp||u instanceof Ah)&&n.push(...u.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){const s=[];for(const u in this.binders){const h=this.binders[u];if(h instanceof Fp||h instanceof Ah||h instanceof vc)for(const g of h.uniformNames)s.push({name:g,property:u,binding:h.getBinding(n,g)})}return s}setUniforms(n,s,u,h,g){for(const{name:_,property:x,binding:T}of u)this.binders[x].setUniform(n,T,g,h.get(x),_)}updatePaintBuffers(){this._buffers=[];for(const n in this.binders){const s=this.binders[n];(s instanceof yc||s instanceof vc||s instanceof xc)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer),s instanceof xc&&s.paintTransitionVertexBuffer&&this._buffers.push(s.paintTransitionVertexBuffer)}}upload(n){for(const s in this.binders){const u=this.binders[s];(u instanceof yc||u instanceof vc||u instanceof xc)&&u.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const s=this.binders[n];(s instanceof yc||s instanceof vc||s instanceof xc)&&s.destroy()}}}class dl{constructor(n,s,u=()=>!0){this.programConfigurations={};for(const h of n)this.programConfigurations[h.id]=new Iu(h,s,u);this.needsUpload=!1,this._featureMap=new kp,this._featureMapWithoutIds=new kp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(n,s,u,h,g,_,x,T,C){for(const R in this.programConfigurations)this.programConfigurations[R].populatePaintArrays(n,s,h,g,_,x,T,C);s.id!==void 0?this._featureMap.add(s.id,u,this._bufferOffset,n):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,n),this._idlessCounter+=1),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,s,u,h,g,_,x,T){for(const C of u)this.needsUpload=this.programConfigurations[C.id].updatePaintArrays(n,this._featureMap,this._featureMapWithoutIds,s,C,h,g,_,x||0,T)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const UI={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function $I(a,n){return UI[a]||[a.replace(`${n}-`,"").replace(/-/g,"_")]}const GI={"line-pattern":{source:ko,composite:ko},"fill-pattern":{source:ko,composite:ko},"fill-extrusion-pattern":{source:ko,composite:ko},"line-dasharray":{source:Td,composite:Td}},HI={color:{source:Bl,composite:Su},number:{source:gc,composite:Bl}};function yx(a,n,s){const u=GI[a];return u&&u[s]||HI[n][s]}jt(Fp,"ConstantBinder"),jt(Ah,"PatternConstantBinder"),jt(yc,"SourceExpressionBinder"),jt(xc,"PatternCompositeBinder"),jt(vc,"CompositeExpressionBinder"),jt(Iu,"ProgramConfiguration",{omit:["_buffers"]}),jt(dl,"ProgramConfigurationSet");const Ys=wt/Math.PI/2,Fa=5,c_=6,WI=16383,Ph=64,vx=[Ph,32,16],za=-Ys,ja=Ys;function Sd(a,n,s,u=Ys){return s=$n(s),[a*Math.sin(s)*u,-n*u,a*Math.cos(s)*u]}function Rh(a,n,s){return Sd(Math.cos($n(a)),Math.sin($n(a)),n,s)}const f=63710088e-1,r=2*Math.PI*f;class c{constructor(n,s){if(isNaN(n)||isNaN(s))throw new Error(`Invalid LngLat object: (${n}, ${s})`);if(this.lng=+n,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new c(fe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const s=Math.PI/180,u=this.lat*s,h=n.lat*s,g=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((n.lng-this.lng)*s);return f*Math.acos(Math.min(g,1))}toBounds(n=0){const s=360*n/40075017,u=s/Math.cos(Math.PI/180*this.lat);return new p({lng:this.lng-u,lat:this.lat-s},{lng:this.lng+u,lat:this.lat+s})}toEcef(n){return Rh(this.lat,this.lng,Ys+n*Ys/f)}static convert(n){if(n instanceof c)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new c(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new c(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class p{constructor(n,s){n&&(s?this.setSouthWest(n).setNorthEast(s):Array.isArray(n)&&n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))}setNorthEast(n){return this._ne=n instanceof c?new c(n.lng,n.lat):c.convert(n),this}setSouthWest(n){return this._sw=n instanceof c?new c(n.lng,n.lat):c.convert(n),this}extend(n){const s=this._sw,u=this._ne;let h,g;if(n instanceof c)h=n,g=n;else{if(!(n instanceof p))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(p.convert(n)):this.extend(c.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&(n.hasOwnProperty("lon")||n.hasOwnProperty("lng"))?this.extend(c.convert(n)):this;if(h=n._sw,g=n._ne,!h||!g)return this}return s||u?(s.lng=Math.min(h.lng,s.lng),s.lat=Math.min(h.lat,s.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new c(h.lng,h.lat),this._ne=new c(g.lng,g.lat)),this}getCenter(){return new c((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c(this.getWest(),this.getNorth())}getSouthEast(){return new c(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:s,lat:u}=c.convert(n);let h=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&h}static convert(n){if(n)return n instanceof p?n:new p(n)}}const y=0,b=25.5;function w(a){return r*Math.cos(a*Math.PI/180)}function S(a){return(180+a)/360}function P(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function k(a,n){return a/w(n)}function L(a){return 360*a-180}function V(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function B(a,n){return a*w(V(n))}const U=85.051129;function Z(a){return Math.cos($n(Y(a,-U,U)))}function W(a,n){const s=Y(n,y,b),u=Math.pow(2,s);return Z(a)*r/(512*u)}function ne(a){return 1/Math.cos(a*Math.PI/180)}function te(a,n=0){const s=Math.exp(Math.PI*(1-(a.y+n/wt)/(1<<a.z)*2));return 80150034*s/(s*s+1)/wt/(1<<a.z)}class le{constructor(n,s,u=0){this.x=+n,this.y=+s,this.z=+u}static fromLngLat(n,s=0){const u=c.convert(n);return new le(S(u.lng),P(u.lat),k(s,u.lat))}toLngLat(){return new c(L(this.x),V(this.y))}toAltitude(){return B(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/r*ne(V(this.y))}}function he(a,n,s,u,h,g,_,x,T){const C=(n+u)/2,R=(s+h)/2,M=new st(C,R);x(M),function(D,O,j,G,X,K){const se=j-X,ae=G-K;return Math.abs((G-O)*se-(j-D)*ae)/Math.hypot(se,ae)}(M.x,M.y,g.x,g.y,_.x,_.y)>=T?(he(a,n,s,C,R,g,M,x,T),he(a,C,R,u,h,M,_,x,T)):a.push(_)}function ce(a,n,s){let u=a[0],h=u.x,g=u.y;n(u);const _=[u];for(let x=1;x<a.length;x++){const T=a[x],{x:C,y:R}=T;n(T),he(_,h,g,C,R,u,T,n,s),h=C,g=R,u=T}return _}function Ee(a,n,s,u){if(u(n,s)){const h=n.add(s)._mult(.5);Ee(a,n,h,u),Ee(a,h,s,u)}else a.push(s)}function ye(a,n){let s=a[0];const u=[s];for(let h=1;h<a.length;h++){const g=a[h];Ee(u,s,g,n),s=g}return u}const we=Math.pow(2,14)-1,_e=-we-1;function pe(a,n){const s=Math.round(a.x*n),u=Math.round(a.y*n);return a.x=Y(s,_e,we),a.y=Y(u,_e,we),(s<a.x||s>a.x+1||u<a.y||u>a.y+1)&&Nt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function Se(a,n,s){const u=a.loadGeometry(),h=a.extent,g=wt/h;if(n&&s&&s.projection.isReprojectedInTileSpace){const _=1<<n.z,{scale:x,x:T,y:C,projection:R}=s,M=D=>{const O=L((n.x+D.x/h)/_),j=V((n.y+D.y/h)/_),G=R.project(O,j);D.x=(G.x*x-T)*h,D.y=(G.y*x-C)*h};for(let D=0;D<u.length;D++)if(a.type!==1)u[D]=ce(u[D],M,1);else{const O=[];for(const j of u[D])j.x<0||j.x>=h||j.y<0||j.y>=h||(M(j),O.push(j));u[D]=O}}for(const _ of u)for(const x of _)pe(x,g);return u}function De(a,n){return{type:a.type,id:a.id,properties:a.properties,geometry:n?Se(a):[]}}class Me{constructor(n,s,u,h,g){this.properties={},this.extent=u,this.type=0,this.id=void 0,this._pbf=n,this._geometry=-1,this._keys=h,this._values=g,n.readFields(He,this,s)}loadGeometry(){const n=this._pbf;n.pos=this._geometry;const s=n.readVarint()+n.pos,u=[];let h,g=1,_=0,x=0,T=0;for(;n.pos<s;){if(_<=0){const C=n.readVarint();g=7&C,_=C>>3}if(_--,g===1||g===2)x+=n.readSVarint(),T+=n.readSVarint(),g===1&&(h&&u.push(h),h=[]),h&&h.push(new st(x,T));else{if(g!==7)throw new Error(`unknown command ${g}`);h&&h.push(h[0].clone())}}return h&&u.push(h),u}bbox(){const n=this._pbf;n.pos=this._geometry;const s=n.readVarint()+n.pos;let u=1,h=0,g=0,_=0,x=1/0,T=-1/0,C=1/0,R=-1/0;for(;n.pos<s;){if(h<=0){const M=n.readVarint();u=7&M,h=M>>3}if(h--,u===1||u===2)g+=n.readSVarint(),_+=n.readSVarint(),g<x&&(x=g),g>T&&(T=g),_<C&&(C=_),_>R&&(R=_);else if(u!==7)throw new Error(`unknown command ${u}`)}return[x,C,T,R]}toGeoJSON(n,s,u){const h=this.extent*Math.pow(2,u),g=this.extent*n,_=this.extent*s,x=this.loadGeometry();function T(D){return[360*(D.x+g)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(D.y+_)/h)*Math.PI))-90]}function C(D){return D.map(T)}let R;if(this.type===1){const D=[];for(const j of x)D.push(j[0]);const O=C(D);R=D.length===1?{type:"Point",coordinates:O[0]}:{type:"MultiPoint",coordinates:O}}else if(this.type===2){const D=x.map(C);R=D.length===1?{type:"LineString",coordinates:D[0]}:{type:"MultiLineString",coordinates:D}}else{if(this.type!==3)throw new Error("unknown feature type");{const D=function(j){const G=j.length;if(G<=1)return[j];const X=[];let K,se;for(let ae=0;ae<G;ae++){const de=We(j[ae]);de!==0&&(se===void 0&&(se=de<0),se===de<0?(K&&X.push(K),K=[j[ae]]):K&&K.push(j[ae]))}return K&&X.push(K),X}(x),O=[];for(const j of D)O.push(j.map(C));R=O.length===1?{type:"Polygon",coordinates:O[0]}:{type:"MultiPolygon",coordinates:O}}}const M={type:"Feature",geometry:R,properties:this.properties};return this.id!=null&&(M.id=this.id),M}}function He(a,n,s){a===1?n.id=s.readVarint():a===2?function(u,h){const g=u.readVarint()+u.pos;for(;u.pos<g;){const _=h._keys[u.readVarint()],x=h._values[u.readVarint()];h.properties[_]=x}}(s,n):a===3?n.type=s.readVarint():a===4&&(n._geometry=s.pos)}function We(a){let n=0;for(let s,u,h=0,g=a.length,_=g-1;h<g;_=h++)s=a[h],u=a[_],n+=(u.x-s.x)*(s.y+u.y);return n}Me.types=["Unknown","Point","LineString","Polygon"];class tt{constructor(n,s){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(gt,this,s),this.length=this._features.length}feature(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];const s=this._pbf.readVarint()+this._pbf.pos;return new Me(this._pbf,s,this.extent,this._keys,this._values)}}function gt(a,n,s){a===15?n.version=s.readVarint():a===1?n.name=s.readString():a===5?n.extent=s.readVarint():a===2?n._features.push(s.pos):a===3?n._keys.push(s.readString()):a===4&&n._values.push(function(u){let h=null;const g=u.readVarint()+u.pos;for(;u.pos<g;){const _=u.readVarint()>>3;h=_===1?u.readString():_===2?u.readFloat():_===3?u.readDouble():_===4?u.readVarint64():_===5?u.readVarint():_===6?u.readSVarint():_===7?u.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h}(s))}class Ve{constructor(n,s){this.layers=n.readFields(Pe,{},s)}}function Pe(a,n,s){if(a===3){const u=new tt(s,s.readVarint()+s.pos);u.length&&(n[u.name]=u)}}const Xe="3d_elevation_id",Ue="level";class lt{constructor(){this._valid=!1}reset(n){return this.feature=n,this._valid=!0,this._geometry=n.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(n,s){return this._valid&&n(s(this._geometry)),this}require(n,s,u){return this.get(n,!0,s,u)}optional(n,s,u){return this.get(n,!1,s,u)}success(){return this._valid}get(n,s,u,h){const g=this.feature.properties.hasOwnProperty(n)?+this.feature.properties[n]:void 0;return this._valid&&g!==void 0&&!Number.isNaN(g)?u(h?h(g):g):s&&(this._valid=!1),this}}class St{constructor(n,s){this.featureFunc=n,this.vertexFunc=s}parseFeature(n,s,u){return this.featureFunc(n,s,u)}parseVertex(n,s,u){return this.vertexFunc(n,s,u)}}const Dt=new St((a,n,s)=>a.reset(n).require(Xe,u=>{s.id=u}).optional("fixed_height_relative",u=>{s.constantHeight=u},_t.decodeRelativeHeight).geometry(u=>{s.bounds=u},uc).success(),(a,n,s)=>a.reset(n).require(Xe,u=>{s.id=u}).require("elevation_idx",u=>{s.idx=u}).require("extent",u=>{s.extent=u}).require("height_relative",u=>{s.height=u},_t.decodeRelativeHeight).geometry(u=>{s.position=u},_t.getPoint).success()),bt=new St((a,n,s)=>a.reset(n).require(Xe,u=>{s.id=u}).optional("fixed_height",u=>{s.constantHeight=u},_t.decodeMetricHeight).geometry(u=>{s.bounds=u},uc).success(),(a,n,s)=>a.reset(n).require(Xe,u=>{s.id=u}).require("elevation_idx",u=>{s.idx=u}).require("extent",u=>{s.extent=u}).require("height",u=>{s.height=u},_t.decodeMetricHeight).geometry(u=>{s.position=u},_t.getPoint).success());class _t{static getPoint(n){return qs(n[0][0].x,n[0][0].y)}static decodeRelativeHeight(n){return 1e-4*n*5}static decodeMetricHeight(n){return 1e-4*n}static getVersionSchema(n){return n?n==="1.0.1"?bt:void 0:Dt}static parse(n){const s=[],u=[],h=n.length,g=new lt;for(let _=0;_<h;_++){const x=n.feature(_),T=x.properties.version,C=_t.getVersionSchema(T);if(C===void 0){Nt(`Unknown elevation feature version number ${T||"(unknown)"}`);continue}const R=x.properties.type;if(!R)continue;const M=Me.types[x.type];if(M==="Point"&&R==="curve_point"){const D={};C.parseVertex(g,x,D)&&s.push(D)}else if(M==="Polygon"&&R==="curve_meta"){const D={};C.parseFeature(g,x,D)&&u.push(D)}}return{vertices:s,features:u}}}class Gt{constructor(n,s){this.pos=n,this.dir=s}intersectsPlane(n,s,u){const h=nl(s,this.dir);if(Math.abs(h)<1e-6)return!1;const g=((n[0]-this.pos[0])*s[0]+(n[1]-this.pos[1])*s[1])/h;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,!0}}class Bt{constructor(n,s){this.pos=n,this.dir=s}intersectsPlane(n,s,u){const h=Fn(s,this.dir);if(Math.abs(h)<1e-6)return!1;const g=((n[0]-this.pos[0])*s[0]+(n[1]-this.pos[1])*s[1]+(n[2]-this.pos[2])*s[2])/h;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,u[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(n,s,u){if(function(O,j){var G=O[0],X=O[1],K=O[2],se=j[0],ae=j[1],de=j[2];return Math.abs(G-se)<=I*Math.max(1,Math.abs(G),Math.abs(se))&&Math.abs(X-ae)<=I*Math.max(1,Math.abs(X),Math.abs(ae))&&Math.abs(K-de)<=I*Math.max(1,Math.abs(K),Math.abs(de))}(this.pos,n)||s===0)return u[0]=u[1]=u[2]=0,!1;const[h,g,_]=this.dir,x=this.pos[0]-n[0],T=this.pos[1]-n[1],C=this.pos[2]-n[2],R=h*h+g*g+_*_,M=2*(x*h+T*g+C*_),D=M*M-4*R*(x*x+T*T+C*C-s*s);if(D<0){const O=Math.max(-M/2,0),j=x+h*O,G=T+g*O,X=C+_*O,K=Math.hypot(j,G,X);return u[0]=j*s/K,u[1]=G*s/K,u[2]=X*s/K,!1}{const O=(-M-Math.sqrt(D))/(2*R);if(O<0){const j=Math.hypot(x,T,C);return u[0]=x*s/j,u[1]=T*s/j,u[2]=C*s/j,!1}return u[0]=x+h*O,u[1]=T+g*O,u[2]=C+_*O,!0}}}class Mt{constructor(n,s,u,h,g){this.TL=n,this.TR=s,this.BR=u,this.BL=h,this.horizon=g}static fromInvProjectionMatrix(n,s,u){const h=[-1,1,1],g=[1,1,1],_=[1,-1,1],x=[-1,-1,1],T=Mi(h,h,n),C=Mi(g,g,n),R=Mi(_,_,n),M=Mi(x,x,n);return new Mt(T,C,R,M,s/u)}}function Lt(a,n,s){let u=1/0,h=-1/0;const g=[];for(const _ of a){xr(g,_,n);const x=Fn(g,s);u=Math.min(u,x),h=Math.max(h,x)}return[u,h]}function on(a,n){let s=!0;for(let u=0;u<a.planes.length;u++){const h=a.planes[u];let g=0;for(let _=0;_<n.length;_++)g+=+(Fn(h,n[_])+h[3]>=0);if(g===0)return 0;g!==n.length&&(s=!1)}return s?2:1}function Sn(a,n){for(const s of a.projections){const u=Lt(n,a.points[0],s.axis);if(s.projection[1]<u[0]||s.projection[0]>u[1])return 0}return 1}function Zn(a,n){let s=0;const u=[0,0,0,0];for(let _=0;_<a.length;_++)u[0]=a[_][0],u[1]=a[_][1],u[2]=a[_][2],u[3]=1,(h=u)[0]*(g=n)[0]+h[1]*g[1]+h[2]*g[2]+h[3]*g[3]>=0&&s++;var h,g;return s}class fi{constructor(n,s){this.points=n||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=Ht.fromPoints(this.points),this.projections=[],this.frustumEdges=[xr([],this.points[2],this.points[3]),xr([],this.points[0],this.points[3]),xr([],this.points[4],this.points[0]),xr([],this.points[5],this.points[1]),xr([],this.points[6],this.points[2]),xr([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const h=[0,-u[2],u[1]],g=[u[2],0,-u[0]];this.projections.push({axis:h,projection:Lt(this.points,this.points[0],h)}),this.projections.push({axis:g,projection:Lt(this.points,this.points[0],g)})}}static fromInvProjectionMatrix(n,s,u,h){const g=Math.pow(2,u),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const R=ks([],C,n),M=1/R[3]/s*g;return(D=R)[0]=(O=R)[0]*(j=[M,M,h?1/R[3]:M,M])[0],D[1]=O[1]*j[1],D[2]=O[2]*j[2],D[3]=O[3]*j[3],D;var D,O,j}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const R=pn([],si([],xr([],_[C[0]],_[C[1]]),xr([],_[C[2]],_[C[1]]))),M=-Fn(R,_[C[1]]);return R.concat(M)}),T=[];for(let C=0;C<_.length;C++)T.push([_[C][0],_[C][1],_[C][2]]);return new fi(T,x)}intersectsPrecise(n,s,u){for(let h=0;h<s.length;h++)if(!Zn(n,s[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!Zn(n,this.planes[h]))return 0;for(const h of u)for(const g of this.frustumEdges){const _=si([],h,g),x=nn(_);if(x===0)continue;gn(_,_,1/x);const T=Lt(this.points,this.points[0],_),C=Lt(n,this.points[0],_);if(T[0]>C[1]||C[0]>T[1])return 0}return 1}containsPoint(n){for(const s of this.planes){const u=s[3];if(Fn([s[0],s[1],s[2]],n)+u<0)return!1}return!0}}class Ht{static fromPoints(n){const s=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const h of n)Bn(s,s,h),En(u,u,h);return new Ht(s,u)}static fromTileIdAndHeight(n,s,u){const h=1<<n.canonical.z,g=n.canonical.x,_=n.canonical.y;return new Ht([g/h,_/h,s],[(g+1)/h,(_+1)/h,u])}static applyTransform(n,s){const u=n.getCorners();for(let h=0;h<u.length;++h)Mi(u[h],u[h],s);return Ht.fromPoints(u)}static applyTransformFast(n,s){const u=[s[12],s[13],s[14]],h=[...u];for(let g=0;g<3;g++)for(let _=0;_<3;_++){const x=s[4*_+g],T=x*n.min[_],C=x*n.max[_];u[g]+=Math.min(T,C),h[g]+=Math.max(T,C)}return new Ht(u,h)}static projectAabbCorners(n,s){const u=n.getCorners();for(let h=0;h<u.length;++h)Mi(u[h],u[h],s);return u}constructor(n,s){this.min=n,this.max=s,this.center=gn([],et([],this.min,this.max),.5)}quadrant(n){const s=[n%2==0,n<2],u=Kt(this.min),h=Kt(this.max);for(let g=0;g<s.length;g++)u[g]=s[g]?this.min[g]:this.center[g],h[g]=s[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new Ht(u,h)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,s=this.max;return[[n[0],n[1],n[2]],[s[0],n[1],n[2]],[s[0],s[1],n[2]],[n[0],s[1],n[2]],[n[0],n[1],s[2]],[s[0],n[1],s[2]],[s[0],s[1],s[2]],[n[0],s[1],s[2]]]}intersects(n){return this.intersectsAabb(n.bounds)?on(n,this.getCorners()):0}intersectsFlat(n){return this.intersectsAabb(n.bounds)?on(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(n,s){return s||this.intersects(n)?Sn(n,this.getCorners()):0}intersectsPreciseFlat(n,s){return s||this.intersectsFlat(n)?Sn(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(n){for(let s=0;s<3;++s)if(this.min[s]>n.max[s]||n.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(n){return!(this.min[0]>n.max[0]||n.min[0]>this.max[0]||this.min[1]>n.max[1]||n.min[1]>this.max[1])}encapsulate(n){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],n.min[s]),this.max[s]=Math.max(this.max[s],n.max[s])}encapsulatePoint(n){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],n[s]),this.max[s]=Math.max(this.max[s],n[s])}closestPoint(n){return[Math.max(Math.min(this.max[0],n[0]),this.min[0]),Math.max(Math.min(this.max[1],n[1]),this.min[1]),Math.max(Math.min(this.max[2],n[2]),this.min[2])]}}jt(Ht,"Aabb");class ui{constructor(n,s){this.feature=n,this.metersToTile=s,this.index=0}get(){const n=this.feature.vertices[this.index],s=this.feature.vertexProps[this.index].dir,u=s[1],h=-s[0],g=(n.extent+1)*this.metersToTile;return[new st(Math.trunc(n.position[0]+u*g),Math.trunc(n.position[1]+h*g)),new st(Math.trunc(n.position[0]-u*g),Math.trunc(n.position[1]-h*g))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Tn{constructor(n,s,u,h,g,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[jr(),jr(),jr(),jr(),jr(),jr(),jr()],this.id=n,this.heightRange={min:u,max:u},this.safeArea=s,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||h.length!==0)){this.vertices=h,this.edges=g,this.edges=this.edges.filter(x=>{return x.a<this.vertices.length&&x.b<this.vertices.length&&!((T=this.vertices[x.a].position)[0]===(C=this.vertices[x.b].position)[0]&&T[1]===C[1]);var T,C}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const x of this.vertices)this.vertexProps.push({dir:qs(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,x.height),this.heightRange.max=Math.max(this.heightRange.max,x.height);for(const x of this.edges){const T=this.vertices[x.a].position,C=this.vertices[x.b].position,R=Pa(jr(),C,T),M=$o(R),D=Ra(jr(),R,1/M);this.edgeProps.push({vec:R,dir:D,len:M});const O=this.vertexProps[x.a].dir,j=this.vertexProps[x.b].dir;Al(O,O,D),Al(j,j,D)}for(const x of this.vertexProps)x.dir[0]===0&&x.dir[1]===0||id(x.dir,x.dir);this.tessellate(_)}}pointElevation(n){if(this.constantHeight!=null)return this.constantHeight;const s=this.getClosestEdge(n);if(s==null)return 0;const[u,h]=s;return fn(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,h)}computeSlopeNormal(n,s){const u=this.getClosestEdge(n);if(!u)return Wt(0,0,1);const h=u[0],g=this.edges[h],_=this.edgeProps[h].vec,x=Wt(_[0],_[1],(this.vertices[g.b].height-this.vertices[g.a].height)*s),T=Wt(x[1],-x[0],0);si(T,T,x);const C=nn(T);return C>0?gn(T,T,1/C):Ke(T,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(n){if(this.edges.length===0)return;let s=0,u=Number.POSITIVE_INFINITY,h=0;const[g,_,x,T,C,R,M]=this._tmpVec2;Aa(M,n.x,n.y);const D=new Gt(M,null);for(let O=0;O<this.edges.length;O++){const j=this.edges[O],G=this.edgeProps[O].dir;D.dir=G;const X=this.vertices[j.a].position,K=this.vertices[j.b].position,se=D.intersectsPlane(X,this.vertexProps[j.a].dir,g),ae=D.intersectsPlane(K,this.vertexProps[j.b].dir,_);if(!se||!ae)continue;Pa(x,_,g),Pa(T,M,g);const de=nl(x,x),ve=de>0?nl(T,x)/de:0,me=Y(ve,0,1),Te=Math.abs((ve-me)*this.edgeProps[O].len);Pa(C,M,X),Aa(R,G[1],-G[0]);const Ie=Te+Math.abs(nl(C,R));Ie<u&&(s=O,u=Ie,h=me)}return[s,h]}tessellate(n){const s=zt(),u=zt(),h=zt(),g=zt();for(let _=this.edges.length-1;_>=0;--_){const x=this.edges[_].a,T=this.edges[_].b,{position:C,height:R,extent:M}=this.vertices[x],{position:D,height:O,extent:j}=this.vertices[T],G=this.vertexProps[x].dir,X=this.vertexProps[T].dir;if(Ke(s,C[0]/n,C[1]/n,R),Ke(u,D[0]/n,D[1]/n,O),Ke(h,G[1],-G[0],0),gn(h,h,M),Ke(g,X[1],-X[0],0),gn(g,g,j),this.distSqLines(Wt(s[0]+.5*h[0],s[1]+.5*h[1],s[2]+.5*h[2]),Wt(u[0]-.5*g[0],u[1]-.5*g[1],u[2]-.5*g[2]),Wt(s[0]-.5*h[0],s[1]-.5*h[1],s[2]-.5*h[2]),Wt(u[0]+.5*g[0],u[1]+.5*g[1],u[2]+.5*g[2]))<=.0025000000000000005)continue;const K=this.vertices.length,se=Al(jr(),C,D);this.vertices.push({position:Ra(se,se,.5),height:.5*(R+O),extent:.5*(M+j)});const ae=Al(jr(),G,X);this.vertexProps.push({dir:id(ae,ae)}),this.edges.splice(_,1),this.edgeProps.splice(_,1),this.edges.push({a:x,b:K}),this.edges.push({a:K,b:T});const de=Pa(jr(),this.vertices[K].position,C),ve=$o(de),me={vec:de,dir:Ra(jr(),de,1/ve),len:ve};this.edgeProps.push(me),this.edgeProps.push(me)}}distSqLines(n,s,u,h){const g=Ct(zt(),s,n),_=Ct(zt(),h,u),x=Ct(zt(),n,u),T=Fn(g,g),C=Fn(g,_),R=Fn(g,x),M=Fn(_,_),D=Fn(_,x),O=T*M-C*C;if(O===0)return Sr($i(g,u,h,Fn(x,_)/Fn(_,_)),n);const j=(T*D-C*R)/O;return Sr($i(g,n,s,(C*D-R*M)/O),$i(_,u,h,j))}}class _i{static parseFrom(n,s){const u=_t.parse(n);if(!u)return[];let{vertices:h,features:g}=u;const _=1/te(s);g.sort((R,M)=>R.id-M.id),h.sort((R,M)=>R.id-M.id||R.idx-M.idx),h=h.filter((R,M,D)=>M===D.findIndex(O=>O.id===R.id&&O.idx===R.idx));const x=new Array;let T=0;const C=h.length;for(const R of g){if(R.constantHeight){x.push(new Tn(R.id,R.bounds,R.constantHeight));continue}for(;T!==C&&h[T].id<R.id;)T++;if(T===C||h[T].id!==R.id)continue;const M=new Array,D=new Array,O=T;for(;T!==C&&h[T].id===R.id;){const j=h[T];if(M.push({position:j.position,height:j.height,extent:j.extent}),T!==O&&h[T-1].idx===j.idx-1){const G=T-O;D.push({a:G-1,b:G})}T++}x.push(new Tn(R.id,R.bounds,void 0,M,D,_))}return x}static getElevationFeature(n,s){if(!s)return;const u=+n.properties[Xe];return Number.isNaN(u)?void 0:s.find(h=>h.id===u)}}class Ri{constructor(n,s){this.zScale=1,this.xOffset=0,this.yOffset=0,n.equals(s)||(this.zScale=Math.pow(2,s.z-n.z),this.xOffset=(n.x*this.zScale-s.x)*wt,this.yOffset=(n.y*this.zScale-s.y)*wt)}constantElevation(n,s){if(n.constantHeight!=null)return this.computeBiasedHeight(n.constantHeight,s)}pointElevation(n,s,u){const h=this.constantElevation(s,u);return h??(n.x=n.x*this.zScale+this.xOffset,n.y=n.y*this.zScale+this.yOffset,this.computeBiasedHeight(s.pointElevation(n),u))}computeBiasedHeight(n,s){return s<=0?n:n+s*oe(0,s,n>=0?n:Math.abs(.5*n))}}jt(Tn,"ElevationFeature");class Ci{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new Eu,this.indexArray=new Jr,this.segments=new dr,this.programConfigurations=new dl(n.layers,{zoom:n.zoom,lut:n.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new gc),this.worldview=n.worldview,this.hasAppearances=null}updateFootprints(n,s){}updateAppearances(n,s,u,h){}populate(n,s,u,h){const g=this.layers[0],_=[];let x=null;g.type==="circle"&&(x=g.layout.get("circle-sort-key"));for(const{feature:C,id:R,index:M,sourceLayerIndex:D}of n){const O=this.layers[0]._featureFilter.needGeometry,j=De(C,O);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),j,u))continue;const G=x?x.evaluate(j,{},u):void 0,X={id:R,properties:C.properties,type:C.type,sourceLayerIndex:D,index:M,geometry:O?j.geometry:Se(C,u,h),patterns:{},sortKey:G};_.push(X)}x&&_.sort((C,R)=>C.sortKey-R.sortKey);let T=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new Wg,T=h.projection);for(const C of _){const{geometry:R,index:M,sourceLayerIndex:D}=C,O=n[M].feature;this.addFeature(C,R,M,s.availableImages,u,T,s.brightness,s.elevationFeatures),s.featureIndex.insert(O,R,M,D,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(n,s,u,h,g,_,x){this.programConfigurations.updatePaintArrays(n,s,g,u,h,_,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Ew.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,Sw.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=n.createVertexBuffer(this.elevatedLayoutVertexArray,OI.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(n,s,u,h,g,_,x,T){let C;this.elevationMode!=="none"&&(C=_i.getElevationFeature(n,T));for(const R of s)for(const M of R){const D=M.x,O=M.y;if(D<0||D>=wt||O<0||O>=wt)continue;if(_){const X=_.projectTilePoint(D,O,g),K=_.upVector(g,D,O);this.addGlobeExtVertex(X,K),this.addGlobeExtVertex(X,K),this.addGlobeExtVertex(X,K),this.addGlobeExtVertex(X,K)}const j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),G=j.vertexLength;if(this.addCircleVertex(D,O,-1,-1),this.addCircleVertex(D,O,1,-1),this.addCircleVertex(D,O,1,1),this.addCircleVertex(D,O,-1,1),this.elevationMode!=="none"){const X=C?C.pointElevation(new st(D,O)):0;this.hasElevation=this.hasElevation||X!==0;for(let K=0;K<4;K++)this.elevatedLayoutVertexArray.emplaceBack(X)}this.indexArray.emplaceBack(G,G+1,G+2),this.indexArray.emplaceBack(G,G+2,G+3),j.vertexLength+=4,j.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,{},h,g,x,void 0,this.worldview)}addCircleVertex(n,s,u,h){this.layoutVertexArray.emplaceBack(2*n+(u+1)/2,2*s+(h+1)/2)}addGlobeExtVertex(n,s){this.globeExtVertexArray.emplaceBack(n.x,n.y,n.z,s[0]*16384,s[1]*16384,s[2]*16384)}}function ci(a,n){for(let s=0;s<a.length;s++)if(Fi(n,a[s]))return!0;for(let s=0;s<n.length;s++)if(Fi(a,n[s]))return!0;return!!ir(a,n)}function Dn(a,n,s){return!!Fi(a,n)||!!Xi(n,a,s)}function mi(a,n){if(a.length===1)return hr(n,a[0]);for(let s=0;s<n.length;s++){const u=n[s];for(let h=0;h<u.length;h++)if(Fi(a,u[h]))return!0}for(let s=0;s<a.length;s++)if(hr(n,a[s]))return!0;for(let s=0;s<n.length;s++)if(ir(a,n[s]))return!0;return!1}function yr(a,n,s){if(a.length>1){if(ir(a,n))return!0;for(let u=0;u<n.length;u++)if(Xi(n[u],a,s))return!0}for(let u=0;u<a.length;u++)if(Xi(a[u],n,s))return!0;return!1}function ir(a,n){if(a.length===0||n.length===0)return!1;for(let s=0;s<a.length-1;s++){const u=a[s],h=a[s+1];for(let g=0;g<n.length-1;g++)if(yi(u,h,n[g],n[g+1]))return!0}return!1}function yi(a,n,s,u){return kn(a,s,u)!==kn(n,s,u)&&kn(a,n,s)!==kn(a,n,u)}function ni(a,n,s){return(a.x-s.x)*(n.y-s.y)-(a.y-s.y)*(n.x-s.x)}function Nn(a,n,s,u){const h=ni(a,n,u),g=ni(a,n,s);if(Math.sign(h)===Math.sign(g))return;const _=ni(s,u,a),x=_+g-h;return Math.sign(_)!==Math.sign(x)?[_/(_-x),g/(g-h)]:void 0}function Xi(a,n,s){const u=s*s;if(n.length===1)return a.distSqr(n[0])<u;for(let h=1;h<n.length;h++)if(Ar(a,n[h-1],n[h])<u)return!0;return!1}function Ar(a,n,s){const u=n.distSqr(s);if(u===0)return a.distSqr(n);const h=((a.x-n.x)*(s.x-n.x)+(a.y-n.y)*(s.y-n.y))/u;return a.distSqr(h<0?n:h>1?s:s.sub(n)._mult(h)._add(n))}function hr(a,n){let s,u,h,g=!1;for(let _=0;_<a.length;_++){s=a[_];for(let x=0,T=s.length-1;x<s.length;T=x++)u=s[x],h=s[T],u.y>n.y!=h.y>n.y&&n.x<(h.x-u.x)*(n.y-u.y)/(h.y-u.y)+u.x&&(g=!g)}return g}function Fi(a,n){let s=!1;for(let u=0,h=a.length-1;u<a.length;h=u++){const g=a[u],_=a[h];g.y>n.y!=_.y>n.y&&n.x<(_.x-g.x)*(n.y-g.y)/(_.y-g.y)+g.x&&(s=!s)}return s}function bo(a,n,s,u,h){for(const _ of a)if(n<=_.x&&s<=_.y&&u>=_.x&&h>=_.y)return!0;const g=[new st(n,s),new st(n,h),new st(u,h),new st(u,s)];if(a.length>2){for(const _ of g)if(Fi(a,_))return!0}for(let _=0;_<a.length-1;_++)if(Vs(a[_],a[_+1],g))return!0;return!1}function Vs(a,n,s){const u=s[0],h=s[2];if(a.x<u.x&&n.x<u.x||a.x>h.x&&n.x>h.x||a.y<u.y&&n.y<u.y||a.y>h.y&&n.y>h.y)return!1;const g=kn(a,n,s[0]);return g!==kn(a,n,s[1])||g!==kn(a,n,s[2])||g!==kn(a,n,s[3])}function ts(a,n,s,u,h,g){let _=n.y-a.y,x=a.x-n.x;if(g=g||0){const T=_*_+x*x;if(T===0)return!0;const C=Math.sqrt(T);_/=C,x/=C}return!((s.x-a.x)*_+(s.y-a.y)*x-g<0||(u.x-a.x)*_+(u.y-a.y)*x-g<0||(h.x-a.x)*_+(h.y-a.y)*x-g<0)}function Qs(a,n,s,u,h,g,_){return!(ts(a,n,u,h,g,_)||ts(n,s,u,h,g,_)||ts(s,a,u,h,g,_)||ts(u,h,a,n,s,_)||ts(h,g,a,n,s,_)||ts(g,u,a,n,s,_))}function Js(a,n,s){const u=n.paint.get(a).value;return u.kind==="constant"?u.value:s.programConfigurations.get(n.id).getMaxValue(a)}function Ds(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function la(a,n,s,u,h){if(!n[0]&&!n[1])return a;const g=st.convert(n)._mult(h);s==="viewport"&&g._rotate(-u);const _=[];for(let x=0;x<a.length;x++)_.push(a[x].sub(g));return _}function Ba(a,n,s,u){const h=st.convert(a)._mult(u);return n==="viewport"&&h._rotate(-s),h}let No,Tr;function Nr(a,n,s){var u=2*Math.PI*6378137/256/Math.pow(2,s);return[a*u-2*Math.PI*6378137/2,n*u-2*Math.PI*6378137/2]}jt(Ci,"CircleBucket",{omit:["layers"]});class zi{constructor(n,s,u){this.z=n,this.x=s,this.y=u,this.key=fr(0,n,n,s,u)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}isChildOf(n){const s=this.z-n.z;return n.z===0||n.z<this.z&&n.x===this.x>>s&&n.y===this.y>>s}url(n,s){const u=function(g,_,x){var T=Nr(256*g,256*(_=Math.pow(2,x)-_-1),x),C=Nr(256*(g+1),256*(_+1),x);return T[0]+","+T[1]+","+C[0]+","+C[1]}(this.x,this.y,this.z),h=function(g,_,x){let T,C="";for(let R=g;R>0;R--)T=1<<R-1,C+=(_&T?1:0)+(x&T?2:0);return C}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Vr{constructor(n,s){this.wrap=n,this.canonical=s,this.key=fr(n,s.z,s.z,s.x,s.y)}}class vr{constructor(n,s,u,h,g){this.overscaledZ=n,this.wrap=s,this.canonical=new zi(u,+h,+g),this.key=s===0&&n===u?this.canonical.key:fr(s,n,u,h,g)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const s=this.canonical.z-n;return n>this.canonical.z?new vr(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new vr(n,this.wrap,n,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(n,s=!0){if(this.overscaledZ===n&&s)return this.key;if(n>this.canonical.z)return fr(this.wrap*+s,n,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-n;return fr(this.wrap*+s,n,n,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const s=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.z<this.canonical.z&&n.canonical.x===this.canonical.x>>s&&n.canonical.y===this.canonical.y>>s}children(n){if(this.overscaledZ>=n)return[new vr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new vr(s,this.wrap,s,u,h),new vr(s,this.wrap,s,u+1,h),new vr(s,this.wrap,s,u,h+1),new vr(s,this.wrap,s,u+1,h+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new vr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new vr(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Vr(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function fr(a,n,s,u,h){const g=1<<Math.min(s,22);let _=g*(h%g)+u%g;return a&&s<22&&(_+=g*g*((a<0?-2*a-1:2*a)%(1<<2*(22-s)))),16*(32*_+s)+(n-s)}const Va=[a=>{let n=a.canonical.x-1,s=a.wrap;return n<0&&(n=(1<<a.canonical.z)-1,s--),new vr(a.overscaledZ,s,a.canonical.z,n,a.canonical.y)},a=>{let n=a.canonical.x+1,s=a.wrap;return n===1<<a.canonical.z&&(n=0,s++),new vr(a.overscaledZ,s,a.canonical.z,n,a.canonical.y)},a=>new vr(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new vr(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];jt(zi,"CanonicalTileID"),jt(vr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const zp=Gn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:hl}=zp,jp=Gn([{name:"a_pos_3",components:3,type:"Int16"}]);var Mh=Gn([{name:"a_pos",type:"Int16",components:2}]);function Ul(a){return a*Ys/f}const bc=[new Ht([za,za,za],[ja,ja,ja]),new Ht([za,za,za],[0,0,ja]),new Ht([0,za,za],[ja,0,ja]),new Ht([za,0,za],[0,ja,ja]),new Ht([0,0,za],[ja,ja,ja])];function kh(a,n,s,u=!0){const h=gn([],a._camera.position,a.worldSize),g=[n,s,1,1];ks(g,g,a.pixelMatrixInverse),Ja(g,g,1/g[3]);const _=pn([],xr([],g,h)),x=a.globeMatrix,T=[x[12],x[13],x[14]],C=xr([],T,h),R=nn(C),M=pn([],C),D=a.worldSize/(2*Math.PI),O=Fn(M,_),j=Math.asin(D/R);if(j<Math.acos(O)){if(!u)return null;const qe=[],Ne=[];gn(qe,_,R/O),pn(Ne,xr(Ne,qe,C)),pn(_,et(_,C,gn(_,Ne,Math.tan(j)*R)))}const G=[];new Bt(h,_).closestPointOnSphere(T,D,G);const X=pn([],Cr(x,0)),K=pn([],Cr(x,1)),se=pn([],Cr(x,2)),ae=Fn(X,G),de=Fn(K,G),ve=Fn(se,G),me=io(Math.asin(-de/D));let Te=io(Math.atan2(ae,ve));Te=a.center.lng+function(qe,Ne){const Qe=(Ne-qe+180)%360-180;return Qe<-180?Qe+360:Qe}(a.center.lng,Te);const Ie=S(Te),Re=Y(P(me),0,1);return new le(Ie,Re)}class Au{constructor(n,s,u){this.a=xr([],n,u),this.b=xr([],s,u),this.center=u;const h=pn([],this.a),g=pn([],this.b);this.angle=Math.acos(Fn(h,g))}}function wc(a,n){if(a.angle===0)return null;let s;return s=a.a[n]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[n]/a.a[n]/Math.sin(a.angle)-1/Math.tan(a.angle)),s<0||s>1?null:function(u,h,g,_){const x=Math.sin(g);return u*(Math.sin((1-_)*g)/x)+h*(Math.sin(_*g)/x)}(a.a[n],a.b[n],a.angle,Y(s,0,1))+a.center[n]}function fl(a){if(a.z<=1)return bc[a.z+2*a.y+a.x];const n=qI(Cw(a));return Ht.fromPoints(n)}function Tc(a,n,s){return gn(a,a,1-s),qt(a,a,n,s)}function PL(a,n,s){for(const u of a)Mi(u,u,n),gn(u,u,s)}function RL(a,n,s,u){const h=n/a.worldSize,g=a.globeMatrix;if(s.z<=1){const Re=fl(s).getCorners();return PL(Re,g,h),Ht.fromPoints(Re)}const _=Cw(s,u),x=qI(_,Ys+Ul(a._tileCoverLift));PL(x,g,h);const T=Number.MAX_VALUE,C=[-T,-T,-T],R=[T,T,T];if(_.contains(a.center)){for(const Ne of x)Bn(R,R,Ne),En(C,C,Ne);C[2]=0;const Re=a.point,qe=[Re.x*h,Re.y*h,0];return Bn(R,R,qe),En(C,C,qe),new Ht(R,C)}if(a._tileCoverLift>0){for(const Re of x)Bn(R,R,Re),En(C,C,Re);return new Ht(R,C)}const M=[g[12]*h,g[13]*h,g[14]*h],D=_.getCenter(),O=Y(a.center.lat,-U,U),j=Y(D.lat,-U,U),G=S(a.center.lng),X=P(O);let K=G-S(D.lng);const se=X-P(j);K>.5?K-=1:K<-.5&&(K+=1);let ae=0;Math.abs(K)>Math.abs(se)?ae=K>=0?1:3:(ae=se>=0?0:2,qt(M,M,[g[4]*h,g[5]*h,g[6]*h],-Math.sin($n(se>=0?_.getSouth():_.getNorth()))*Ys));const de=x[ae],ve=x[(ae+1)%4],me=new Au(de,ve,M),Te=[wc(me,0)||de[0],wc(me,1)||de[1],wc(me,2)||de[2]],Ie=Dh(a.zoom);if(Ie>0){const Re=function({x:Ne,y:Qe,z:it},rt,ht,pt,ct){const ut=1/(1<<it);let Ye=Ne*ut,Ze=Ye+ut,dt=Qe*ut,Tt=dt+ut,yt=0;const Yt=(Ye+Ze)/2-pt;return Yt>.5?yt=-1:Yt<-.5&&(yt=1),Ye=((Ye+yt)*rt-(pt*=rt))*ht+pt,Ze=((Ze+yt)*rt-pt)*ht+pt,dt=(dt*rt-(ct*=rt))*ht+ct,Tt=(Tt*rt-ct)*ht+ct,[[Ye,Tt,0],[Ze,Tt,0],[Ze,dt,0],[Ye,dt,0]]}(s,n,a._pixelsPerMercatorPixel,G,X);for(let Ne=0;Ne<x.length;Ne++)Tc(x[Ne],Re[Ne],Ie);const qe=et([],Re[ae],Re[(ae+1)%4]);gn(qe,qe,.5),Tc(Te,qe,Ie)}for(const Re of x)Bn(R,R,Re),En(C,C,Re);return R[2]=Math.min(de[2],ve[2]),Bn(R,R,Te),En(C,C,Te),new Ht(R,C)}function Cw({x:a,y:n,z:s},u=!1){const h=1/(1<<s),g=new c(L(a*h),n===(1<<s)-1&&u?-90:V((n+1)*h)),_=new c(L((a+1)*h),n===0&&u?90:V(n*h));return new p(g,_)}function qI(a,n=Ys){const s=$n(a.getNorth()),u=$n(a.getSouth()),h=Math.cos(s),g=Math.cos(u),_=Math.sin(s),x=Math.sin(u),T=a.getWest(),C=a.getEast();return[Sd(g,x,T,n),Sd(g,x,C,n),Sd(h,_,C,n),Sd(h,_,T,n)]}function xx(a,n,s,u){const h=1<<s.z,g=(a/wt+s.x)/h;return Rh(V((n/wt+s.y)/h),L(g),u)}function Iw({min:a,max:n}){return WI/Math.max(n[0]-a[0],n[1]-a[1],n[2]-a[2])}const ML=new Float64Array(16);function Aw(a){const n=Iw(a),s=Be(ML,[n,n,n]);return ie(s,s,Rt([],a.min))}function ZI(a){const n=(u=a.min,(s=ML)[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=u[0],s[13]=u[1],s[14]=u[2],s[15]=1,s);var s,u;const h=1/Iw(a);return ue(n,n,[h,h,h])}function KI(a){const n=wt/(2*Math.PI);return a/(2*Math.PI)/n}function kL(a,n){return wt/(512*Math.pow(2,a))*Iw(fl(n))}function DL(a,n,s,u,h){const g=KI(s),_=[a,n,-s/(2*Math.PI)],x=re(new Float64Array(16));return ie(x,x,_),ue(x,x,[g,g,g]),xe(x,x,$n(-h)),Oe(x,x,$n(-u)),x}function Dh(a){return oe(Fa,c_,a)}function NL(a,n){const s=Rh(n.lat,n.lng),u=function(j){const G=Rh(j._center.lat,j._center.lng);let X=si([],Wt(0,1,0),G);const K=ot([],-j.angle,G);X=Mi(X,X,K),ot(K,-j._pitch,X);const se=pn([],G);return gn(se,se,Ul(j.cameraToCenterDistance/j.pixelsPerMeter)),Mi(se,se,K),et([],G,se)}(a);return _=(h=Ct([],u,s))[0],x=h[1],T=h[2],C=(g=s)[0],R=g[1],M=g[2],O=(D=Math.sqrt((_*_+x*x+T*T)*(C*C+R*R+M*M)))&&Fn(h,g)/D,Math.acos(Math.min(Math.max(O,-1),1));var h,g,_,x,T,C,R,M,D,O}function XI(a,n){return NL(a,n)>Math.PI/2*1.01}const LL=$n(85),LZ=Math.cos(LL),OZ=Math.sin(LL),FZ=J(),OL=a=>{const n=[];return a.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n};function FL(a,n,s,u,h,g,_,x,T){if(g&&a.queryGeometry.isAboveHorizon)return!1;g&&(T*=a.pixelToTileUnitsFactor);const C=a.tileID.canonical,R=s.projection.upVectorScale(C,s.center.lat,s.worldSize).metersToTile;for(const M of n)for(const D of M){const O=D.add(x),j=h&&s.elevation?s.elevation.exaggeration()*h.getElevationAt(O.x,O.y,!0):0,G=s.projection.projectTilePoint(O.x,O.y,C);if(j>0){const ae=s.projection.upVector(C,O.x,O.y);G.x+=ae[0]*R*j,G.y+=ae[1]*R*j,G.z+=ae[2]*R*j}const X=g?O:zZ(G.x,G.y,G.z,u),K=g?a.tilespaceRays.map(ae=>BZ(ae,j)):a.queryGeometry.screenGeometry,se=ks([],[G.x,G.y,G.z,1],u);if(!_&&g?T*=se[3]/s.cameraToCenterDistance:_&&!g&&(T*=s.cameraToCenterDistance/se[3]),g){const ae=V((D.y/wt+C.y)/(1<<C.z));T/=s.projection.pixelsPerMeter(ae,1)/k(1,ae)}if(Dn(K,X,T))return!0}return!1}function zZ(a,n,s,u){const h=ks([],[a,n,s,1],u);return new st(h[0]/h[3],h[1]/h[3])}const zL=Wt(0,0,0),jZ=Wt(0,0,1);function BZ(a,n){const s=zt();return zL[2]=n,a.intersectsPlane(zL,jZ,s),new st(s[0],s[1])}class jL extends Ci{}let BL,VL,UL,$L;function GL(a,{width:n,height:s},u,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==n*s*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(n*s*u);return a.width=n,a.height=s,a.data=h,a}function HL(a,n,s){const{width:u,height:h}=n;u===a.width&&h===a.height||(YI(a,n,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,u),height:Math.min(a.height,h)},s,null),a.width=u,a.height=h,a.data=n.data)}function YI(a,n,s,u,h,g,_,x){if(h.width===0||h.height===0)return n;if(h.width>a.width||h.height>a.height||s.x>a.width-h.width||s.y>a.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>n.width||h.height>n.height||u.x>n.width-h.width||u.y>n.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const T=a.data,C=n.data,R=g===4&&x;for(let M=0;M<h.height;M++){const D=((s.y+M)*a.width+s.x)*g,O=((u.y+M)*n.width+u.x)*g;if(R)for(let j=0;j<h.width;j++){const G=D+j*g+3,X=O+j*g;C[X+0]=255,C[X+1]=255,C[X+2]=255,C[X+3]=T[G]}else if(_)for(let j=0;j<h.width;j++){const G=D+j*g,X=O+j*g,K=new Si(T[G+0]/255,T[G+1]/255,T[G+2]/255,T[G+3]).toNonPremultipliedRenderColor(_).toArray();C[X+0]=K[0],C[X+1]=K[1],C[X+2]=K[2],C[X+3]=K[3]}else for(let j=0;j<h.width*g;j++)C[O+j]=T[D+j]}return n}jt(jL,"HeatmapBucket",{omit:["layers"]});class Nh{constructor(n,s){GL(this,n,1,s)}resize(n){HL(this,new Nh(n),1)}clone(){return new Nh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,u,h,g){YI(n,s,u,h,g,1,null)}}class eo{constructor(n,s){GL(this,n,4,s)}resize(n){HL(this,new eo(n),4)}replace(n,s){s?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new eo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,u,h,g,_,x){YI(n,s,u,h,g,4,_,x)}}class WL{constructor(n,s){this.width=n.width,this.height=n.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}function bx(a){const n={},s=a.resolution||256,u=a.clips?a.clips.length:1,h=a.image||new eo({width:s,height:u}),g=(_,x,T)=>{n[a.evaluationKey]=T;const C=a.expression.evaluate(n),R=C?C.toNonPremultipliedRenderColor(null):null;R&&(h.data[_+x+0]=Math.floor(255*R.r),h.data[_+x+1]=Math.floor(255*R.g),h.data[_+x+2]=Math.floor(255*R.b),h.data[_+x+3]=Math.floor(255*R.a))};if(a.clips)for(let _=0,x=0;_<u;++_,x+=4*s)for(let T=0,C=0;T<s;T++,C+=4){const R=T/(s-1),{start:M,end:D}=a.clips[_];g(x,C,M*(1-R)+D*R)}else for(let _=0,x=0;_<s;_++,x+=4)g(0,x,_/(s-1));return h}jt(Nh,"AlphaImage"),jt(eo,"RGBAImage");const VZ=Gn([{name:"a_pos",components:2,type:"Int16"}],4),UZ=Gn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),$Z=Gn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),GZ=Gn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function u_(a,n,s=2){const u=n&&n.length,h=u?n[0]*s:a.length;let g=qL(a,0,h,s,!0);const _=[];if(!g||g.next===g.prev)return _;let x,T,C;if(u&&(g=function(R,M,D,O){const j=[];for(let G=0,X=M.length;G<X;G++){const K=qL(R,M[G]*O,G<X-1?M[G+1]*O:R.length,O,!1);K===K.next&&(K.steiner=!0),j.push(QZ(K))}j.sort(KZ);for(let G=0;G<j.length;G++)D=XZ(j[G],D);return D}(a,n,g,s)),a.length>80*s){x=a[0],T=a[1];let R=x,M=T;for(let D=s;D<h;D+=s){const O=a[D],j=a[D+1];O<x&&(x=O),j<T&&(T=j),O>R&&(R=O),j>M&&(M=j)}C=Math.max(R-x,M-T),C=C!==0?32767/C:0}return wx(g,_,s,x,T,C,0),_}function qL(a,n,s,u,h){let g;if(h===function(_,x,T,C){let R=0;for(let M=x,D=T-C;M<T;M+=C)R+=(_[D]-_[M])*(_[M+1]+_[D+1]),D=M;return R}(a,n,s,u)>0)for(let _=n;_<s;_+=u)g=YL(_/u|0,a[_],a[_+1],g);else for(let _=s-u;_>=n;_-=u)g=YL(_/u|0,a[_],a[_+1],g);return g&&d_(g,g.next)&&(Sx(g),g=g.next),g}function Bp(a,n){if(!a)return a;n||(n=a);let s,u=a;do if(s=!1,u.steiner||!d_(u,u.next)&&Cs(u.prev,u,u.next)!==0)u=u.next;else{if(Sx(u),u=n=u.prev,u===u.next)break;s=!0}while(s||u!==n);return n}function wx(a,n,s,u,h,g,_){if(!a)return;!_&&g&&function(T,C,R,M){let D=T;do D.z===0&&(D.z=QI(D.x,D.y,C,R,M)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==T);D.prevZ.nextZ=null,D.prevZ=null,function(O){let j,G=1;do{let X,K=O;O=null;let se=null;for(j=0;K;){j++;let ae=K,de=0;for(let me=0;me<G&&(de++,ae=ae.nextZ,ae);me++);let ve=G;for(;de>0||ve>0&&ae;)de!==0&&(ve===0||!ae||K.z<=ae.z)?(X=K,K=K.nextZ,de--):(X=ae,ae=ae.nextZ,ve--),se?se.nextZ=X:O=X,X.prevZ=se,se=X;K=ae}se.nextZ=null,G*=2}while(j>1)}(D)}(a,u,h,g);let x=a;for(;a.prev!==a.next;){const T=a.prev,C=a.next;if(g?WZ(a,u,h,g):HZ(a))n.push(T.i,a.i,C.i),Sx(a),a=C.next,x=C.next;else if((a=C)===x){_?_===1?wx(a=qZ(Bp(a),n),n,s,u,h,g,2):_===2&&ZZ(a,n,s,u,h,g):wx(Bp(a),n,s,u,h,g,1);break}}}function HZ(a){const n=a.prev,s=a,u=a.next;if(Cs(n,s,u)>=0)return!1;const h=n.x,g=s.x,_=u.x,x=n.y,T=s.y,C=u.y,R=Math.min(h,g,_),M=Math.min(x,T,C),D=Math.max(h,g,_),O=Math.max(x,T,C);let j=u.next;for(;j!==n;){if(j.x>=R&&j.x<=D&&j.y>=M&&j.y<=O&&Tx(h,x,g,T,_,C,j.x,j.y)&&Cs(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function WZ(a,n,s,u){const h=a.prev,g=a,_=a.next;if(Cs(h,g,_)>=0)return!1;const x=h.x,T=g.x,C=_.x,R=h.y,M=g.y,D=_.y,O=Math.min(x,T,C),j=Math.min(R,M,D),G=Math.max(x,T,C),X=Math.max(R,M,D),K=QI(O,j,n,s,u),se=QI(G,X,n,s,u);let ae=a.prevZ,de=a.nextZ;for(;ae&&ae.z>=K&&de&&de.z<=se;){if(ae.x>=O&&ae.x<=G&&ae.y>=j&&ae.y<=X&&ae!==h&&ae!==_&&Tx(x,R,T,M,C,D,ae.x,ae.y)&&Cs(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,de.x>=O&&de.x<=G&&de.y>=j&&de.y<=X&&de!==h&&de!==_&&Tx(x,R,T,M,C,D,de.x,de.y)&&Cs(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;ae&&ae.z>=K;){if(ae.x>=O&&ae.x<=G&&ae.y>=j&&ae.y<=X&&ae!==h&&ae!==_&&Tx(x,R,T,M,C,D,ae.x,ae.y)&&Cs(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;de&&de.z<=se;){if(de.x>=O&&de.x<=G&&de.y>=j&&de.y<=X&&de!==h&&de!==_&&Tx(x,R,T,M,C,D,de.x,de.y)&&Cs(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function qZ(a,n){let s=a;do{const u=s.prev,h=s.next.next;!d_(u,h)&&KL(u,s,s.next,h)&&Ex(u,h)&&Ex(h,u)&&(n.push(u.i,s.i,h.i),Sx(s),Sx(s.next),s=a=h),s=s.next}while(s!==a);return Bp(s)}function ZZ(a,n,s,u,h,g){let _=a;do{let x=_.next.next;for(;x!==_.prev;){if(_.i!==x.i&&JZ(_,x)){let T=XL(_,x);return _=Bp(_,_.next),T=Bp(T,T.next),wx(_,n,s,u,h,g,0),void wx(T,n,s,u,h,g,0)}x=x.next}_=_.next}while(_!==a)}function KZ(a,n){let s=a.x-n.x;return s===0&&(s=a.y-n.y,s===0)&&(s=(a.next.y-a.y)/(a.next.x-a.x)-(n.next.y-n.y)/(n.next.x-n.x)),s}function XZ(a,n){const s=function(h,g){let _=g;const x=h.x,T=h.y;let C,R=-1/0;if(d_(h,_))return _;do{if(d_(h,_.next))return _.next;if(T<=_.y&&T>=_.next.y&&_.next.y!==_.y){const G=_.x+(T-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(G<=x&&G>R&&(R=G,C=_.x<_.next.x?_:_.next,G===x))return C}_=_.next}while(_!==g);if(!C)return null;const M=C,D=C.x,O=C.y;let j=1/0;_=C;do{if(x>=_.x&&_.x>=D&&x!==_.x&&ZL(T<O?x:R,T,D,O,T<O?R:x,T,_.x,_.y)){const G=Math.abs(T-_.y)/(x-_.x);Ex(_,h)&&(G<j||G===j&&(_.x>C.x||_.x===C.x&&YZ(C,_)))&&(C=_,j=G)}_=_.next}while(_!==M);return C}(a,n);if(!s)return n;const u=XL(s,a);return Bp(u,u.next),Bp(s,s.next)}function YZ(a,n){return Cs(a.prev,a,n.prev)<0&&Cs(n.next,a,a.next)<0}function QI(a,n,s,u,h){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-s)*h|0)|a<<8))|a<<4))|a<<2))|a<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-u)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function QZ(a){let n=a,s=a;do(n.x<s.x||n.x===s.x&&n.y<s.y)&&(s=n),n=n.next;while(n!==a);return s}function ZL(a,n,s,u,h,g,_,x){return(h-_)*(n-x)>=(a-_)*(g-x)&&(a-_)*(u-x)>=(s-_)*(n-x)&&(s-_)*(g-x)>=(h-_)*(u-x)}function Tx(a,n,s,u,h,g,_,x){return!(a===_&&n===x)&&ZL(a,n,s,u,h,g,_,x)}function JZ(a,n){return a.next.i!==n.i&&a.prev.i!==n.i&&!function(s,u){let h=s;do{if(h.i!==s.i&&h.next.i!==s.i&&h.i!==u.i&&h.next.i!==u.i&&KL(h,h.next,s,u))return!0;h=h.next}while(h!==s);return!1}(a,n)&&(Ex(a,n)&&Ex(n,a)&&function(s,u){let h=s,g=!1;const _=(s.x+u.x)/2,x=(s.y+u.y)/2;do h.y>x!=h.next.y>x&&h.next.y!==h.y&&_<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next;while(h!==s);return g}(a,n)&&(Cs(a.prev,a,n.prev)||Cs(a,n.prev,n))||d_(a,n)&&Cs(a.prev,a,a.next)>0&&Cs(n.prev,n,n.next)>0)}function Cs(a,n,s){return(n.y-a.y)*(s.x-n.x)-(n.x-a.x)*(s.y-n.y)}function d_(a,n){return a.x===n.x&&a.y===n.y}function KL(a,n,s,u){const h=Rw(Cs(a,n,s)),g=Rw(Cs(a,n,u)),_=Rw(Cs(s,u,a)),x=Rw(Cs(s,u,n));return h!==g&&_!==x||!(h!==0||!Pw(a,s,n))||!(g!==0||!Pw(a,u,n))||!(_!==0||!Pw(s,a,u))||!(x!==0||!Pw(s,n,u))}function Pw(a,n,s){return n.x<=Math.max(a.x,s.x)&&n.x>=Math.min(a.x,s.x)&&n.y<=Math.max(a.y,s.y)&&n.y>=Math.min(a.y,s.y)}function Rw(a){return a>0?1:a<0?-1:0}function Ex(a,n){return Cs(a.prev,a,a.next)<0?Cs(a,n,a.next)>=0&&Cs(a,a.prev,n)>=0:Cs(a,n,a.prev)<0||Cs(a,a.next,n)<0}function XL(a,n){const s=JI(a.i,a.x,a.y),u=JI(n.i,n.x,n.y),h=a.next,g=n.prev;return a.next=n,n.prev=a,s.next=h,h.prev=s,u.next=s,s.prev=u,g.next=u,u.prev=g,u}function YL(a,n,s,u){const h=JI(a,n,s);return u?(h.next=u.next,h.prev=u,u.next.prev=h,u.next=h):(h.prev=h,h.next=h),h}function Sx(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function JI(a,n,s){return{i:a,x:n,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Cx(a,n){const s=a.length;if(s<=1)return[a];const u=[];let h,g;for(let _=0;_<s;_++){const x=Pn(a[_]);x!==0&&(a[_].area=Math.abs(x),g===void 0&&(g=x<0),g===x<0?(h&&u.push(h),h=[a[_]]):h.push(a[_]))}if(h&&u.push(h),n>1)for(let _=0;_<u.length;_++)u[_].length<=n||(lg(u[_],n,1,u[_].length-1,eK),u[_]=u[_].slice(0,n));return u}function eK(a,n){return n.area-a.area}function QL(a,n,s=1){if(!a)return null;const u=typeof a=="string"?_o.from(a).getPrimary():a.getPrimary(),h=typeof a=="string"?null:a.getSecondary();for(const g of[u,h]){if(!g)continue;const _=g.id.toString();n.has(_)||n.set(_,[]),g.scaleSelf(s),n.get(_).push(g)}return{primary:u.toString(),secondary:h?h.toString():null}}function eA(a,n,s,u){const h=u.patternDependencies;let g=!1;for(const _ of n){const x=_.paint.get(`${a}-pattern`);x.isConstant()||(g=!0),QL(x.constantOr(null),h,s)&&(g=!0)}return g}function tA(a,n,s,u,h,g){const _=g.patternDependencies;for(const x of n){const T=x.paint.get(`${a}-pattern`).value;if(T.kind!=="constant"){let C=T.evaluate({zoom:u},s,{},g.availableImages);C=C&&C.name?C.name:C;const R=QL(C,_,h);if(!R)continue;const{primary:M,secondary:D}=R;M&&(s.patterns[x.id]=[M,D].filter(Boolean))}}return s}class JL{constructor(){this.polygons=new Map}add(n,...s){const u=this.polygons.get(n);u?u.push(...s):this.polygons.set(n,s)}merge(n){for(const[s,u]of n.polygons)this.add(s,...u)}}class Cd{constructor(){this.portals=[]}static isOnBorder(n,s){return n<=0&&s<=0||n>=wt&&s>=wt}static evaluate(n){if(n.length===0)return new Cd;let s=[];for(const T of n)s.push(...T.portals);if(s.length===0)return new Cd;for(const T of s){const C=T.va,R=T.vb;(Cd.isOnBorder(C.x,R.x)||Cd.isOnBorder(C.y,R.y))&&(T.type="border")}const u=s.filter(T=>T.type!=="unevaluated"),h=s.filter(T=>T.type==="unevaluated");if(h.length===0)return new Cd;h.sort((T,C)=>T.hash===C.hash?T.isTunnel===C.isTunnel?0:T.isTunnel?-1:1:T.hash<C.hash?1:-1),s=u.concat(h);let g=u.length,_=g,x=g;do if(_++,_===s.length||s[g].hash!==s[_].hash){if(_-g==2){x<g&&(s[x]=s[g],s[g]=null);const T=s[x],C=s[_-1];T.type=T.isTunnel!==C.isTunnel?"tunnel":"polygon",T.connection={a:T.connection.a,b:C.connection.a},x++}g=_}while(g!==s.length);return s.splice(x),s.sort((T,C)=>T.hash<C.hash?1:-1),{portals:s}}}jt(Cd,"ElevationPortalGraph"),jt(JL,"ElevationPolygons");class tK{constructor(n,s,u){this.outPositions=n,this.outNormals=s,this.outIndices=u,this.vertexLookup=new Map}addVertex(n,s,u){let h=n[2];u!=null&&(h*=u);const g=`${n[0]},${n[1]},${n[2]},${s[0]},${s[1]},${s[2]}`,_=this.vertexLookup.get(g);if(_!=null)return _;const x=this.outPositions.length;this.vertexLookup.set(g,x);const T=Math.trunc(16384*s[0]),C=Math.trunc(16384*s[1]),R=Math.trunc(16384*s[2]);return this.outPositions.emplaceBack(n[0],n[1],h),this.outNormals.emplaceBack(T,C,R),x}addTriangle(n,s,u){this.outIndices.emplaceBack(n,s,u)}addTriangles(n,s,u){if(n.length===0)return;const h=u.length===1,g=zt(),_=zt();for(let x=0;x<n.length;x+=3){const T=s[n[x+0]],C=s[n[x+1]],R=s[n[x+2]],M=h?u[0]:u[n[x+1]],D=h?u[0]:u[n[x+2]];Ke(g,T.x,T.y,h?u[0]:u[n[x+0]]);const O=this.addVertex(g,_);Ke(g,C.x,C.y,M);const j=this.addVertex(g,_);Ke(g,R.x,R.y,D);const G=this.addVertex(g,_);this.outIndices.emplaceBack(O,j,G)}}addQuad(n,s,u,h,g,_){const x=this.addVertex(n,g,_),T=this.addVertex(s,g,_),C=this.addVertex(u,g,_),R=this.addVertex(h,g,_);this.addTriangle(x,T,C),this.addTriangle(C,R,x)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class ca{constructor(n,s,u,h){this.unevaluatedPortals=new Cd,this.portalPolygons=new JL,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new ex,this.vertexNormals=new tx,this.indexArray=new Jr,this.tileToMeters=te(n),this.bridgeProgramConfigurations=new dl(s,{zoom:u,lut:h},g=>g!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new dl(s,{zoom:u,lut:h},g=>g!=="fill-bridge-guard-rail-color")}addVertices(n,s){const u=this.unevalVertices.length;for(let h=0;h<n.length;h++)this.unevalVertices.push(n[h]),this.unevalHeights.push(s[h]);return u}addTriangles(n,s,u){const h=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const g of n)h.push(g+s)}addRenderableRing(n,s,u,h,g,_){const x=[new st(g.min.x,g.min.y),new st(g.max.x,g.min.y),new st(g.max.x,g.max.y),new st(g.min.x,g.max.y)];for(let T=0;T<u-1;T++){const C=s+T,R=C+1,M=this.unevalVertices[C],D=this.unevalVertices[R];if(!(M.x>=g.min.x&&M.x<=g.max.x&&M.y>=g.min.y&&M.y<=g.max.y||D.x>=g.min.x&&D.x<=g.max.x&&D.y>=g.min.y&&D.y<=g.max.y||Vs(M,D,x))||this.isOnBorder(M.x,D.x)||this.isOnBorder(M.y,D.y))continue;const O=ca.computeEdgeHash(this.unevalVertices[C],this.unevalVertices[R]);let j,G=this.vertexHashLookup.get(ca.computePosHash(M));G!=null?j=G.next:(G=this.vertexHashLookup.get(ca.computePosHash(D)),j=G!=null?G.prev:O),this.unevalEdges.push({polygonIdx:n,a:C,b:R,hash:O,portalHash:j,isTunnel:h,type:"unevaluated",featureInfo:_})}}addPortalCandidates(n,s,u,h,g){if(s.length===0)return;this.portalPolygons.add(n,{geometry:s,zLevel:g});const _=s[0];this.vertexHashLookup.clear();let x=ca.computeEdgeHash(_[_.length-2],_[_.length-1]);for(let T=0;T<_.length-1;T++){const C=_[T+0],R=_[T+1],M=qs(R.x-C.x,R.y-C.y),D=$o(M);if(D===0)continue;let O="unevaluated";const j=h.pointElevation(C),G=h.pointElevation(R);Math.abs(j)<.01&&Math.abs(G)<.01?O="entrance":(this.isOnBorder(C.x,R.x)||this.isOnBorder(C.y,R.y))&&(O="border");const X=ca.computeEdgeHash(C,R);this.unevaluatedPortals.portals.push({connection:{a:n,b:void 0},va:C,vb:R,vab:M,length:D,hash:X,isTunnel:u,type:O});const K=ca.computePosHash(C);this.vertexHashLookup.set(K,{prev:x,next:X}),x=X}}construct(n){if(this.unevalVertices.length===0)return;const s=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=D=>{D.primitiveLength=this.indexArray.length-D.primitiveOffset},h=new tK(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(n.portals,this.unevalEdges);const g=s(),_=s(),x=s(),T=(D,O)=>{D.sort((G,X)=>G.type===O&&X.type!==O?-1:G.type!==O&&X.type===O?1:0);const j=D.findIndex(G=>G.type!==O);return j>=0?j:D.length};let C=0;this.unevalEdges.length>0&&(C=T(this.unevalEdges,"none"),this.constructBridgeStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},this.tileToMeters)),u(x);const R=s(),M=s();if(this.unevalEdges.length>0){const D=this.unevalEdges.splice(C),O=T(D,"tunnel")+C;this.unevalEdges.push(...D),this.constructTunnelStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},{min:C,max:O})}u(R),h.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(M),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(_),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(g),this.maskSegments=dr.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.depthSegments=dr.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableBridgeSegments=dr.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableTunnelSegments=dr.simpleSegment(0,R.primitiveOffset,0,R.primitiveLength),this.shadowCasterSegments=dr.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength)}update(n,s,u,h,g,_,x,T){this.bridgeProgramConfigurations.updatePaintArrays(n,s,g,u,h,_,x,T),this.tunnelProgramConfigurations.updatePaintArrays(n,s,g,u,h,_,x,T)}upload(n){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=n.createVertexBuffer(this.vertexPositions,$Z.members),this.vertexBufferNormal=n.createVertexBuffer(this.vertexNormals,GZ.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(n),this.tunnelProgramConfigurations.upload(n))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(n,s,u,h,g){const _=(x,T)=>{for(let C=0;C<T.length-1;C++){const R=T[C].featureIndex,M=T[C+1].vertexStart,D=n.feature(R);x.populatePaintArrays(M,D,R,{},u,s,h,void 0,g)}};_(this.bridgeProgramConfigurations,this.bridgeFeatureSections),_(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(n,s,u,h,g){const _=new Map;for(let x=h;x<g;x++){const T=u[x],C=T.a,R=T.b,M=ca.computePosHash(n[C]),D=ca.computePosHash(n[R]);let O=_.get(M);O||(O={},_.set(M,O));let j=_.get(D);j||(j={},_.set(D,j)),s[C]<=0&&s[R]<=0||(O.to=R,j.from=C)}return _}isTerminalVertex(n,s){const u=ca.computePosHash(this.unevalVertices[n]),h=s.get(u);return!h||!h.from||!h.to}constructBridgeStructures(n,s,u,h,g,_){n.clearVertexLookup();const x=this.computeVertexConnections(s,u,h,g.min,g.max),T=1/_,C=.5*T,R=(ht,pt)=>Ke(ht,s[pt].x,s[pt].y,u[pt]*T),M=zt(),D=zt(),O=zt(),j=zt(),G=zt(),X=(ht,pt)=>{const ct=x.get(ca.computePosHash(s[pt])),ut=ct.from,Ye=ct.to;if(!ut||!Ye)return;R(M,ut),R(D,pt),R(O,Ye),ls(j),Kr(M,D)||(xr(G,D,M),pn(j,G)),Kr(O,D)||(xr(G,O,D),et(j,j,pn(G,G)));const Ze=sc(j);return Ze>0?gn(ht,j,1/Ze):void 0};let K=Number.POSITIVE_INFINITY;this.sortSubarray(h,g.min,g.max,(ht,pt)=>ht.featureInfo.featureIndex-pt.featureInfo.featureIndex);const se=zt(),ae=zt(),de=zt(),ve=zt(),me=zt(),Te=zt(),Ie=zt(),Re=zt(),qe=zt(),Ne=[zt(),zt(),zt(),zt()],Qe=[zt(),zt(),zt(),zt()],it=[{coord:new st(0,0),height:0},{coord:new st(0,0),height:0}],rt=(ht,pt)=>ht>pt;for(let ht=g.min;ht<g.max;ht++){const pt=h[ht];if(!pt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(it,s,u,pt,rt))continue;const[ct,ut]=it;if(Ke(se,ct.coord.x,ct.coord.y,T*ct.height),Ke(ae,ut.coord.x,ut.coord.y,T*ut.height),Kr(se,ae))continue;xr(de,ae,se),pn(de,de);const Ye=X(Re,pt.a)||de,Ze=X(qe,pt.b)||de;Ke(ve,Ye[1],-Ye[0],0),pn(ve,ve),Ke(me,Ze[1],-Ze[0],0),pn(me,me),si(Re,ve,Ye),pn(Te,Re),si(Re,me,Ze),pn(Ie,Re),et(Ne[0],se,gn(Re,xr(Re,ve,Te),C)),et(Ne[1],se,gn(Re,et(Re,ve,Te),C)),et(Ne[2],se,gn(Re,Te,C)),Ne[3]=se,et(Qe[0],ae,gn(Re,xr(Re,me,Ie),C)),et(Qe[1],ae,gn(Re,et(Re,me,Ie),C)),et(Qe[2],ae,gn(Re,Ie,C)),Qe[3]=ae,K=this.addFeatureSection(pt.featureInfo.featureIndex,K,this.bridgeFeatureSections,n);const dt=n.addVertex(Ne[0],ve,_),Tt=n.addVertex(Ne[1],ve,_),yt=n.addVertex(Qe[0],me,_),Yt=n.addVertex(Qe[1],me,_);n.addTriangle(dt,Tt,yt),n.addTriangle(Tt,Yt,yt);const kt=n.addVertex(Ne[1],Te,_),Ot=n.addVertex(Ne[2],Te,_),Ut=n.addVertex(Qe[1],Ie,_),jn=n.addVertex(Qe[2],Ie,_);n.addTriangle(kt,Ot,Ut),n.addTriangle(Ot,jn,Ut),Rt(ve,ve),Rt(me,me);const vt=n.addVertex(Ne[2],ve,_),$t=n.addVertex(Ne[3],ve,_),xn=n.addVertex(Qe[2],me,_),Kn=n.addVertex(Qe[3],me,_);n.addTriangle(vt,$t,xn),n.addTriangle($t,Kn,xn);const Qn=this.isTerminalVertex(pt.a,x),An=this.isTerminalVertex(pt.b,x);ct.height<.01&&Qn&&n.addQuad(Ne[3],Ne[2],Ne[1],Ne[0],Rt(Ye,Ye),_),ut.height<.01&&An&&n.addQuad(Qe[0],Qe[1],Qe[2],Qe[3],Ze,_)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:n.getVertexCount()})}constructTunnelStructures(n,s,u,h,g,_){n.clearVertexLookup();let x=Number.POSITIVE_INFINITY;const T=(K,se)=>K.featureInfo.featureIndex-se.featureInfo.featureIndex;this.sortSubarray(h,g.min,g.max,T),this.sortSubarray(h,_.min,_.max,T);const C=K=>pn(K,K),R=[{coord:new st(0,0),height:0},{coord:new st(0,0),height:0}],M=(K,se)=>K<se,D=zt(),O=zt(),j=zt(),G=zt(),X=zt();for(let K=g.min;K<g.max;K++){if(!this.prepareEdgePoints(R,s,u,h[K],M))continue;const[se,ae]=R,de=C(Ke(X,-(ae.coord.y-se.coord.y),ae.coord.x-se.coord.x,0));x=this.addFeatureSection(h[K].featureInfo.featureIndex,x,this.tunnelFeatureSections,n),n.addQuad(Ke(D,se.coord.x,se.coord.y,se.height),Ke(O,ae.coord.x,ae.coord.y,ae.height),Ke(j,ae.coord.x,ae.coord.y,h[K].isTunnel?-.1:0),Ke(G,se.coord.x,se.coord.y,h[K].isTunnel?-.1:0),de)}for(let K=_.min;K<_.max;K++){const se=h[K];se.isTunnel&&([se.a,se.b]=[se.b,se.a]);const ae=s[se.a],de=s[se.b],ve=C(Ke(X,-(de.y-ae.y),de.x-ae.x,0));x=this.addFeatureSection(se.featureInfo.featureIndex,x,this.tunnelFeatureSections,n),n.addQuad(Ke(D,de.x,de.y,0),Ke(O,ae.x,ae.y,0),Ke(j,ae.x,ae.y,u[se.a]+4),Ke(G,de.x,de.y,u[se.b]+4),ve),n.addQuad(Ke(D,ae.x,ae.y,0),Ke(O,de.x,de.y,0),Ke(j,de.x,de.y,u[se.b]+4),Ke(G,ae.x,ae.y,u[se.a]+4),ve)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:n.getVertexCount()})}setElevatedPoint(n,s,u,h){n.coord.x=s,n.coord.y=u,n.height=h}prepareEdgePoints(n,s,u,h,g){let _=s[h.a].x,x=s[h.a].y,T=s[h.b].x,C=s[h.b].y,R=u[h.a],M=u[h.b];const D=g(R,0),O=g(M,0);if(D&&O)return this.setElevatedPoint(n[0],_,x,R),this.setElevatedPoint(n[1],T,C,M),!0;if(!D&&!O)return!1;if(D){if(!O){const j=M/(M-R);T=fn(T,_,j),C=fn(C,x,j),M=fn(M,R,j)}}else{const j=R/(R-M);_=fn(_,T,j),x=fn(x,C,j),R=fn(R,M,j)}return this.setElevatedPoint(n[0],_,x,R),this.setElevatedPoint(n[1],T,C,M),!0}prepareEdges(n,s){if(s.length===0)return;s.sort((x,T)=>x.hash===T.hash?T.polygonIdx-x.polygonIdx:T.hash>x.hash?1:-1);let u=0,h=0,g=0,_=s[u].polygonIdx;do h++,(h===s.length||s[u].hash!==s[h].hash)&&((h-u==1||s[h-1].polygonIdx!==_)&&(g<u&&(s[g]=s[u],s[u]=null),s[g].type="none",g++),u=h,u!==s.length&&(_=s[u].polygonIdx));while(u!==s.length);if(s.splice(g),s.length!==0&&n.length!==0){s.sort((C,R)=>C.portalHash<R.portalHash?1:-1);let x=0,T=0;for(;x!==s.length&&T!==n.length;){const C=s[x],R=n[T];C.portalHash>R.hash?x++:R.hash>C.portalHash?T++:(C.type=R.type,x++)}}}isOnBorder(n,s){return n<=0&&s<=0||n>=wt&&s>=wt}addFeatureSection(n,s,u,h){return n!==s&&(s=n,u.push({featureIndex:n,vertexStart:h.getVertexCount()}),h.clearVertexLookup()),s}sortSubarray(n,s,u,h){const g=n.slice(s,u);g.sort(h),n.splice(s,g.length,...g)}static computeEdgeHash(n,s){return(n.y===s.y&&n.x>s.x||n.y>s.y)&&([n,s]=[s,n]),BigInt(ca.computePosHash(n))<<32n|BigInt(ca.computePosHash(s))}static computePosHash(n){return((65535&n.x)<<16|65535&n.y)>>>0}}var eO,tO={exports:{}},nO=(eO||(eO=1,function(a){function n(ge,be){return ge>be?1:ge<be?-1:0}var s=function(ge,be){ge===void 0&&(ge=n),be===void 0&&(be=!1),this._compare=ge,this._root=null,this._size=0,this._noDuplicates=!!be},u={size:{configurable:!0}};function h(ge,be,Je,ft,At){var Pt=At-ft;if(Pt>0){var Qt=ft+Math.floor(Pt/2),tn={key:be[Qt],data:Je[Qt],parent:ge};return tn.left=h(tn,be,Je,ft,Qt),tn.right=h(tn,be,Je,Qt+1,At),tn}return null}function g(ge,be,Je,ft,At){if(!(Je>=ft)){for(var Pt=ge[Je+ft>>1],Qt=Je-1,tn=ft+1;;){do Qt++;while(At(ge[Qt],Pt)<0);do tn--;while(At(ge[tn],Pt)>0);if(Qt>=tn)break;var Cn=ge[Qt];ge[Qt]=ge[tn],ge[tn]=Cn,Cn=be[Qt],be[Qt]=be[tn],be[tn]=Cn}g(ge,be,Je,tn,At),g(ge,be,tn+1,ft,At)}}s.prototype.rotateLeft=function(ge){var be=ge.right;be&&(ge.right=be.left,be.left&&(be.left.parent=ge),be.parent=ge.parent),ge.parent?ge===ge.parent.left?ge.parent.left=be:ge.parent.right=be:this._root=be,be&&(be.left=ge),ge.parent=be},s.prototype.rotateRight=function(ge){var be=ge.left;be&&(ge.left=be.right,be.right&&(be.right.parent=ge),be.parent=ge.parent),ge.parent?ge===ge.parent.left?ge.parent.left=be:ge.parent.right=be:this._root=be,be&&(be.right=ge),ge.parent=be},s.prototype._splay=function(ge){for(;ge.parent;){var be=ge.parent;be.parent?be.left===ge&&be.parent.left===be?(this.rotateRight(be.parent),this.rotateRight(be)):be.right===ge&&be.parent.right===be?(this.rotateLeft(be.parent),this.rotateLeft(be)):be.left===ge&&be.parent.right===be?(this.rotateRight(be),this.rotateLeft(be)):(this.rotateLeft(be),this.rotateRight(be)):be.left===ge?this.rotateRight(be):this.rotateLeft(be)}},s.prototype.splay=function(ge){for(var be,Je,ft,At,Pt;ge.parent;)(Je=(be=ge.parent).parent)&&Je.parent?((ft=Je.parent).left===Je?ft.left=ge:ft.right=ge,ge.parent=ft):(ge.parent=null,this._root=ge),At=ge.left,Pt=ge.right,ge===be.left?(Je&&(Je.left===be?(be.right?(Je.left=be.right,Je.left.parent=Je):Je.left=null,be.right=Je,Je.parent=be):(At?(Je.right=At,At.parent=Je):Je.right=null,ge.left=Je,Je.parent=ge)),Pt?(be.left=Pt,Pt.parent=be):be.left=null,ge.right=be,be.parent=ge):(Je&&(Je.right===be?(be.left?(Je.right=be.left,Je.right.parent=Je):Je.right=null,be.left=Je,Je.parent=be):(Pt?(Je.left=Pt,Pt.parent=Je):Je.left=null,ge.right=Je,Je.parent=ge)),At?(be.right=At,At.parent=be):be.right=null,ge.left=be,be.parent=ge)},s.prototype.replace=function(ge,be){ge.parent?ge===ge.parent.left?ge.parent.left=be:ge.parent.right=be:this._root=be,be&&(be.parent=ge.parent)},s.prototype.minNode=function(ge){if(ge===void 0&&(ge=this._root),ge)for(;ge.left;)ge=ge.left;return ge},s.prototype.maxNode=function(ge){if(ge===void 0&&(ge=this._root),ge)for(;ge.right;)ge=ge.right;return ge},s.prototype.insert=function(ge,be){var Je=this._root,ft=null,At=this._compare;if(this._noDuplicates)for(;Je;){if(ft=Je,At(Je.key,ge)===0)return;Je=At(Je.key,ge)<0?Je.right:Je.left}else for(;Je;)ft=Je,Je=At(Je.key,ge)<0?Je.right:Je.left;return Je={key:ge,data:be,left:null,right:null,parent:ft},ft?At(ft.key,Je.key)<0?ft.right=Je:ft.left=Je:this._root=Je,this.splay(Je),this._size++,Je},s.prototype.find=function(ge){for(var be=this._root,Je=this._compare;be;){var ft=Je(be.key,ge);if(ft<0)be=be.right;else{if(!(ft>0))return be;be=be.left}}return null},s.prototype.contains=function(ge){for(var be=this._root,Je=this._compare;be;){var ft=Je(ge,be.key);if(ft===0)return!0;be=ft<0?be.left:be.right}return!1},s.prototype.remove=function(ge){var be=this.find(ge);if(!be)return!1;if(this.splay(be),be.left)if(be.right){var Je=this.minNode(be.right);Je.parent!==be&&(this.replace(Je,Je.right),Je.right=be.right,Je.right.parent=Je),this.replace(be,Je),Je.left=be.left,Je.left.parent=Je}else this.replace(be,be.left);else this.replace(be,be.right);return this._size--,!0},s.prototype.removeNode=function(ge){if(!ge)return!1;if(this.splay(ge),ge.left)if(ge.right){var be=this.minNode(ge.right);be.parent!==ge&&(this.replace(be,be.right),be.right=ge.right,be.right.parent=be),this.replace(ge,be),be.left=ge.left,be.left.parent=be}else this.replace(ge,ge.left);else this.replace(ge,ge.right);return this._size--,!0},s.prototype.erase=function(ge){var be=this.find(ge);if(be){this.splay(be);var Je=be.left,ft=be.right,At=null;Je&&(Je.parent=null,At=this.maxNode(Je),this.splay(At),this._root=At),ft&&(Je?At.right=ft:this._root=ft,ft.parent=At),this._size--}},s.prototype.pop=function(){var ge=this._root,be=null;if(ge){for(;ge.left;)ge=ge.left;be={key:ge.key,data:ge.data},this.remove(ge.key)}return be},s.prototype.next=function(ge){var be=ge;if(be)if(be.right)for(be=be.right;be&&be.left;)be=be.left;else for(be=ge.parent;be&&be.right===ge;)ge=be,be=be.parent;return be},s.prototype.prev=function(ge){var be=ge;if(be)if(be.left)for(be=be.left;be&&be.right;)be=be.right;else for(be=ge.parent;be&&be.left===ge;)ge=be,be=be.parent;return be},s.prototype.forEach=function(ge){for(var be=this._root,Je=[],ft=!1,At=0;!ft;)be?(Je.push(be),be=be.left):Je.length>0?(ge(be=Je.pop(),At++),be=be.right):ft=!0;return this},s.prototype.range=function(ge,be,Je,ft){for(var At=[],Pt=this._compare,Qt=this._root;At.length!==0||Qt;)if(Qt)At.push(Qt),Qt=Qt.left;else{if(Pt((Qt=At.pop()).key,be)>0)break;if(Pt(Qt.key,ge)>=0&&Je.call(ft,Qt))return this;Qt=Qt.right}return this},s.prototype.keys=function(){for(var ge=this._root,be=[],Je=[],ft=!1;!ft;)ge?(be.push(ge),ge=ge.left):be.length>0?(ge=be.pop(),Je.push(ge.key),ge=ge.right):ft=!0;return Je},s.prototype.values=function(){for(var ge=this._root,be=[],Je=[],ft=!1;!ft;)ge?(be.push(ge),ge=ge.left):be.length>0?(ge=be.pop(),Je.push(ge.data),ge=ge.right):ft=!0;return Je},s.prototype.at=function(ge){for(var be=this._root,Je=[],ft=!1,At=0;!ft;)if(be)Je.push(be),be=be.left;else if(Je.length>0){if(be=Je.pop(),At===ge)return be;At++,be=be.right}else ft=!0;return null},s.prototype.load=function(ge,be,Je){if(ge===void 0&&(ge=[]),be===void 0&&(be=[]),Je===void 0&&(Je=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var ft=ge.length;return Je&&g(ge,be,0,ft-1,this._compare),this._root=h(null,ge,be,0,ft),this._size=ft,this},s.prototype.min=function(){var ge=this.minNode(this._root);return ge?ge.key:null},s.prototype.max=function(){var ge=this.maxNode(this._root);return ge?ge.key:null},s.prototype.isEmpty=function(){return this._root===null},u.size.get=function(){return this._size},s.createTree=function(ge,be,Je,ft,At){return new s(Je,At).load(ge,be,ft)},Object.defineProperties(s.prototype,u);var _=0,x=1,T=2,C=3,R=0,M=1,D=2,O=3;function j(ge,be,Je){be===null?(ge.inOut=!1,ge.otherInOut=!0):(ge.isSubject===be.isSubject?(ge.inOut=!be.inOut,ge.otherInOut=be.otherInOut):(ge.inOut=!be.otherInOut,ge.otherInOut=be.isVertical()?!be.inOut:be.inOut),be&&(ge.prevInResult=!G(be,Je)||be.isVertical()?be.prevInResult:be));var ft=G(ge,Je);ge.resultTransition=ft?function(At,Pt){var Qt,tn=!At.inOut,Cn=!At.otherInOut;switch(Pt){case R:Qt=tn&&Cn;break;case M:Qt=tn||Cn;break;case O:Qt=tn^Cn;break;case D:Qt=At.isSubject?tn&&!Cn:Cn&&!tn}return Qt?1:-1}(ge,Je):0}function G(ge,be){switch(ge.type){case _:switch(be){case R:return!ge.otherInOut;case M:return ge.otherInOut;case D:return ge.isSubject&&ge.otherInOut||!ge.isSubject&&!ge.otherInOut;case O:return!0}break;case T:return be===R||be===M;case C:return be===D;case x:return!1}return!1}var X=function(ge,be,Je,ft,At){this.left=be,this.point=ge,this.otherEvent=Je,this.isSubject=ft,this.type=At||_,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},K={inResult:{configurable:!0}};function se(ge,be){return ge[0]===be[0]&&ge[1]===be[1]}X.prototype.isBelow=function(ge){var be=this.point,Je=this.otherEvent.point;return this.left?(be[0]-ge[0])*(Je[1]-ge[1])-(Je[0]-ge[0])*(be[1]-ge[1])>0:(Je[0]-ge[0])*(be[1]-ge[1])-(be[0]-ge[0])*(Je[1]-ge[1])>0},X.prototype.isAbove=function(ge){return!this.isBelow(ge)},X.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},K.inResult.get=function(){return this.resultTransition!==0},X.prototype.clone=function(){var ge=new X(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ge.contourId=this.contourId,ge.resultTransition=this.resultTransition,ge.prevInResult=this.prevInResult,ge.isExteriorRing=this.isExteriorRing,ge.inOut=this.inOut,ge.otherInOut=this.otherInOut,ge},Object.defineProperties(X.prototype,K);var ae=11102230246251565e-32,de=134217729,ve=(3+8*ae)*ae;function me(ge,be,Je,ft,At){var Pt,Qt,tn,Cn,Ln=be[0],zn=ft[0],Hn=0,dn=0;zn>Ln==zn>-Ln?(Pt=Ln,Ln=be[++Hn]):(Pt=zn,zn=ft[++dn]);var vn=0;if(Hn<ge&&dn<Je)for(zn>Ln==zn>-Ln?(tn=Pt-((Qt=Ln+Pt)-Ln),Ln=be[++Hn]):(tn=Pt-((Qt=zn+Pt)-zn),zn=ft[++dn]),Pt=Qt,tn!==0&&(At[vn++]=tn);Hn<ge&&dn<Je;)zn>Ln==zn>-Ln?(tn=Pt-((Qt=Pt+Ln)-(Cn=Qt-Pt))+(Ln-Cn),Ln=be[++Hn]):(tn=Pt-((Qt=Pt+zn)-(Cn=Qt-Pt))+(zn-Cn),zn=ft[++dn]),Pt=Qt,tn!==0&&(At[vn++]=tn);for(;Hn<ge;)tn=Pt-((Qt=Pt+Ln)-(Cn=Qt-Pt))+(Ln-Cn),Ln=be[++Hn],Pt=Qt,tn!==0&&(At[vn++]=tn);for(;dn<Je;)tn=Pt-((Qt=Pt+zn)-(Cn=Qt-Pt))+(zn-Cn),zn=ft[++dn],Pt=Qt,tn!==0&&(At[vn++]=tn);return Pt===0&&vn!==0||(At[vn++]=Pt),vn}function Te(ge){return new Float64Array(ge)}var Ie=33306690738754716e-32,Re=22204460492503146e-32,qe=11093356479670487e-47,Ne=Te(4),Qe=Te(8),it=Te(12),rt=Te(16),ht=Te(4);function pt(ge,be,Je){var ft=function(At,Pt,Qt,tn,Cn,Ln){var zn=(Pt-Ln)*(Qt-Cn),Hn=(At-Cn)*(tn-Ln),dn=zn-Hn;if(zn===0||Hn===0||zn>0!=Hn>0)return dn;var vn=Math.abs(zn+Hn);return Math.abs(dn)>=Ie*vn?dn:-function(oi,di,hi,Ii,ji,Di,pi){var vi,On,Yn,lr,cn,Wn,Ni,Vi,qi,Lr,Gi,un,pr,Ai,rr,ns,vs,Hr,Wr=oi-ji,ds=hi-ji,Lo=di-Di,Hi=Ii-Di;Ne[0]=(rr=(Vi=Wr-(Ni=(Wn=de*Wr)-(Wn-Wr)))*(Lr=Hi-(qi=(Wn=de*Hi)-(Wn-Hi)))-((Ai=Wr*Hi)-Ni*qi-Vi*qi-Ni*Lr))-((Gi=rr-(vs=(Vi=Lo-(Ni=(Wn=de*Lo)-(Wn-Lo)))*(Lr=ds-(qi=(Wn=de*ds)-(Wn-ds)))-((ns=Lo*ds)-Ni*qi-Vi*qi-Ni*Lr)))+(cn=rr-Gi))+(cn-vs),Ne[1]=(pr=Ai-((un=Ai+Gi)-(cn=un-Ai))+(Gi-cn))-((Gi=pr-ns)+(cn=pr-Gi))+(cn-ns),Ne[2]=un-((Hr=un+Gi)-(cn=Hr-un))+(Gi-cn),Ne[3]=Hr;var Pr=function(Mu,Us){for(var wo=Us[0],da=1;da<4;da++)wo+=Us[da];return wo}(0,Ne),Or=Re*pi;if(Pr>=Or||-Pr>=Or||(vi=oi-(Wr+(cn=oi-Wr))+(cn-ji),Yn=hi-(ds+(cn=hi-ds))+(cn-ji),On=di-(Lo+(cn=di-Lo))+(cn-Di),lr=Ii-(Hi+(cn=Ii-Hi))+(cn-Di),vi===0&&On===0&&Yn===0&&lr===0)||(Or=qe*pi+ve*Math.abs(Pr),(Pr+=Wr*lr+Hi*vi-(Lo*Yn+ds*On))>=Or||-Pr>=Or))return Pr;ht[0]=(rr=(Vi=vi-(Ni=(Wn=de*vi)-(Wn-vi)))*(Lr=Hi-(qi=(Wn=de*Hi)-(Wn-Hi)))-((Ai=vi*Hi)-Ni*qi-Vi*qi-Ni*Lr))-((Gi=rr-(vs=(Vi=On-(Ni=(Wn=de*On)-(Wn-On)))*(Lr=ds-(qi=(Wn=de*ds)-(Wn-ds)))-((ns=On*ds)-Ni*qi-Vi*qi-Ni*Lr)))+(cn=rr-Gi))+(cn-vs),ht[1]=(pr=Ai-((un=Ai+Gi)-(cn=un-Ai))+(Gi-cn))-((Gi=pr-ns)+(cn=pr-Gi))+(cn-ns),ht[2]=un-((Hr=un+Gi)-(cn=Hr-un))+(Gi-cn),ht[3]=Hr;var Wo=me(4,Ne,4,ht,Qe);ht[0]=(rr=(Vi=Wr-(Ni=(Wn=de*Wr)-(Wn-Wr)))*(Lr=lr-(qi=(Wn=de*lr)-(Wn-lr)))-((Ai=Wr*lr)-Ni*qi-Vi*qi-Ni*Lr))-((Gi=rr-(vs=(Vi=Lo-(Ni=(Wn=de*Lo)-(Wn-Lo)))*(Lr=Yn-(qi=(Wn=de*Yn)-(Wn-Yn)))-((ns=Lo*Yn)-Ni*qi-Vi*qi-Ni*Lr)))+(cn=rr-Gi))+(cn-vs),ht[1]=(pr=Ai-((un=Ai+Gi)-(cn=un-Ai))+(Gi-cn))-((Gi=pr-ns)+(cn=pr-Gi))+(cn-ns),ht[2]=un-((Hr=un+Gi)-(cn=Hr-un))+(Gi-cn),ht[3]=Hr;var is=me(Wo,Qe,4,ht,it);ht[0]=(rr=(Vi=vi-(Ni=(Wn=de*vi)-(Wn-vi)))*(Lr=lr-(qi=(Wn=de*lr)-(Wn-lr)))-((Ai=vi*lr)-Ni*qi-Vi*qi-Ni*Lr))-((Gi=rr-(vs=(Vi=On-(Ni=(Wn=de*On)-(Wn-On)))*(Lr=Yn-(qi=(Wn=de*Yn)-(Wn-Yn)))-((ns=On*Yn)-Ni*qi-Vi*qi-Ni*Lr)))+(cn=rr-Gi))+(cn-vs),ht[1]=(pr=Ai-((un=Ai+Gi)-(cn=un-Ai))+(Gi-cn))-((Gi=pr-ns)+(cn=pr-Gi))+(cn-ns),ht[2]=un-((Hr=un+Gi)-(cn=Hr-un))+(Gi-cn),ht[3]=Hr;var Gl=me(is,it,4,ht,rt);return rt[Gl-1]}(At,Pt,Qt,tn,Cn,Ln,vn)}(ge[0],ge[1],be[0],be[1],Je[0],Je[1]);return ft>0?-1:ft<0?1:0}function ct(ge,be){var Je=ge.point,ft=be.point;return Je[0]>ft[0]?1:Je[0]<ft[0]?-1:Je[1]!==ft[1]?Je[1]>ft[1]?1:-1:function(At,Pt,Qt,tn){return At.left!==Pt.left?At.left?1:-1:pt(Qt,At.otherEvent.point,Pt.otherEvent.point)!==0?At.isBelow(Pt.otherEvent.point)?-1:1:!At.isSubject&&Pt.isSubject?1:-1}(ge,be,Je)}function ut(ge,be,Je){var ft=new X(be,!1,ge,ge.isSubject),At=new X(be,!0,ge.otherEvent,ge.isSubject);return se(ge.point,ge.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ge),ft.contourId=At.contourId=ge.contourId,ct(At,ge.otherEvent)>0&&(ge.otherEvent.left=!0,At.left=!1),ge.otherEvent.otherEvent=At,ge.otherEvent=ft,Je.push(At),Je.push(ft),Je}function Ye(ge,be){return ge[0]*be[1]-ge[1]*be[0]}function Ze(ge,be){return ge[0]*be[0]+ge[1]*be[1]}function dt(ge,be,Je){var ft=function(Cn,Ln,zn,Hn,dn){var vn=[Ln[0]-Cn[0],Ln[1]-Cn[1]],oi=[Hn[0]-zn[0],Hn[1]-zn[1]];function di(Wn,Ni,Vi){return[Wn[0]+Ni*Vi[0],Wn[1]+Ni*Vi[1]]}var hi=[zn[0]-Cn[0],zn[1]-Cn[1]],Ii=Ye(vn,oi),ji=Ii*Ii,Di=Ze(vn,vn);if(ji>0){var pi=Ye(hi,oi)/Ii;if(pi<0||pi>1)return null;var vi=Ye(hi,vn)/Ii;return vi<0||vi>1?null:pi===0||pi===1?[di(Cn,pi,vn)]:vi===0||vi===1?[di(zn,vi,oi)]:[di(Cn,pi,vn)]}if((ji=(Ii=Ye(hi,vn))*Ii)>0)return null;var On=Ze(vn,hi)/Di,Yn=On+Ze(vn,oi)/Di,lr=Math.min(On,Yn),cn=Math.max(On,Yn);return lr<=1&&cn>=0?lr===1?[di(Cn,lr>0?lr:0,vn)]:cn===0?[di(Cn,cn<1?cn:1,vn)]:[di(Cn,lr>0?lr:0,vn),di(Cn,cn<1?cn:1,vn)]:null}(ge.point,ge.otherEvent.point,be.point,be.otherEvent.point),At=ft?ft.length:0;if(At===0||At===1&&(se(ge.point,be.point)||se(ge.otherEvent.point,be.otherEvent.point))||At===2&&ge.isSubject===be.isSubject)return 0;if(At===1)return se(ge.point,ft[0])||se(ge.otherEvent.point,ft[0])||ut(ge,ft[0],Je),se(be.point,ft[0])||se(be.otherEvent.point,ft[0])||ut(be,ft[0],Je),1;var Pt=[],Qt=!1,tn=!1;return se(ge.point,be.point)?Qt=!0:ct(ge,be)===1?Pt.push(be,ge):Pt.push(ge,be),se(ge.otherEvent.point,be.otherEvent.point)?tn=!0:ct(ge.otherEvent,be.otherEvent)===1?Pt.push(be.otherEvent,ge.otherEvent):Pt.push(ge.otherEvent,be.otherEvent),Qt&&tn||Qt?(be.type=x,ge.type=be.inOut===ge.inOut?T:C,Qt&&!tn&&ut(Pt[1].otherEvent,Pt[0].point,Je),2):tn?(ut(Pt[0],Pt[1].point,Je),3):Pt[0]!==Pt[3].otherEvent?(ut(Pt[0],Pt[1].point,Je),ut(Pt[1],Pt[2].point,Je),3):(ut(Pt[0],Pt[1].point,Je),ut(Pt[3].otherEvent,Pt[2].point,Je),3)}function Tt(ge,be){if(ge===be)return 0;if(pt(ge.point,ge.otherEvent.point,be.point)!==0||pt(ge.point,ge.otherEvent.point,be.otherEvent.point)!==0)return se(ge.point,be.point)?ge.isBelow(be.otherEvent.point)?-1:1:ge.point[0]===be.point[0]?ge.point[1]<be.point[1]?-1:1:ct(ge,be)===1?be.isAbove(ge.point)?-1:1:ge.isBelow(be.point)?-1:1;if(ge.isSubject!==be.isSubject)return ge.isSubject?-1:1;var Je=ge.point,ft=be.point;return Je[0]===ft[0]&&Je[1]===ft[1]?(Je=ge.otherEvent.point)[0]===(ft=be.otherEvent.point)[0]&&Je[1]===ft[1]?0:ge.contourId>be.contourId?1:-1:ct(ge,be)===1?1:-1}var yt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Yt(ge,be,Je,ft){var At,Pt=ge+1,Qt=be[ge].point,tn=be.length;for(Pt<tn&&(At=be[Pt].point);Pt<tn&&At[0]===Qt[0]&&At[1]===Qt[1];){if(!Je[Pt])return Pt;++Pt<tn&&(At=be[Pt].point)}for(Pt=ge-1;Je[Pt]&&Pt>ft;)Pt--;return Pt}yt.prototype.isExterior=function(){return this.holeOf==null};var kt=Ut,Ot=Ut;function Ut(ge,be){if(!(this instanceof Ut))return new Ut(ge,be);if(this.data=ge||[],this.length=this.data.length,this.compare=be||jn,this.length>0)for(var Je=(this.length>>1)-1;Je>=0;Je--)this._down(Je)}function jn(ge,be){return ge<be?-1:ge>be?1:0}Ut.prototype={push:function(ge){this.data.push(ge),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ge=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ge}},peek:function(){return this.data[0]},_up:function(ge){for(var be=this.data,Je=this.compare,ft=be[ge];ge>0;){var At=ge-1>>1,Pt=be[At];if(Je(ft,Pt)>=0)break;be[ge]=Pt,ge=At}be[ge]=ft},_down:function(ge){for(var be=this.data,Je=this.compare,ft=this.length>>1,At=be[ge];ge<ft;){var Pt=1+(ge<<1),Qt=Pt+1,tn=be[Pt];if(Qt<this.length&&Je(be[Qt],tn)<0&&(Pt=Qt,tn=be[Qt]),Je(tn,At)>=0)break;be[ge]=tn,ge=Pt}be[ge]=At}},kt.default=Ot;var vt=Math.max,$t=Math.min,xn=0;function Kn(ge,be,Je,ft,At,Pt){var Qt,tn,Cn,Ln,zn,Hn;for(Qt=0,tn=ge.length-1;Qt<tn;Qt++)if(Ln=ge[Qt+1],zn=new X(Cn=ge[Qt],!1,void 0,be),Hn=new X(Ln,!1,zn,be),zn.otherEvent=Hn,Cn[0]!==Ln[0]||Cn[1]!==Ln[1]){zn.contourId=Hn.contourId=Je,Pt||(zn.isExteriorRing=!1,Hn.isExteriorRing=!1),ct(zn,Hn)>0?Hn.left=!0:zn.left=!0;var dn=Cn[0],vn=Cn[1];At[0]=$t(At[0],dn),At[1]=$t(At[1],vn),At[2]=vt(At[2],dn),At[3]=vt(At[3],vn),ft.push(zn),ft.push(Hn)}}var Qn=[];function An(ge,be,Je){typeof ge[0][0][0]=="number"&&(ge=[ge]),typeof be[0][0][0]=="number"&&(be=[be]);var ft=function(vn,oi,di){var hi=null;return vn.length*oi.length==0&&(di===R?hi=Qn:di===D?hi=vn:di!==M&&di!==O||(hi=vn.length===0?oi:vn)),hi}(ge,be,Je);if(ft)return ft===Qn?null:ft;var At=[1/0,1/0,-1/0,-1/0],Pt=[1/0,1/0,-1/0,-1/0],Qt=function(vn,oi,di,hi,Ii){var ji,Di,pi,vi,On,Yn,lr=new kt(null,ct);for(pi=0,vi=vn.length;pi<vi;pi++)for(On=0,Yn=(ji=vn[pi]).length;On<Yn;On++)(Di=On===0)&&xn++,Kn(ji[On],!0,xn,lr,di,Di);for(pi=0,vi=oi.length;pi<vi;pi++)for(On=0,Yn=(ji=oi[pi]).length;On<Yn;On++)Di=On===0,Ii===D&&(Di=!1),Di&&xn++,Kn(ji[On],!1,xn,lr,hi,Di);return lr}(ge,be,At,Pt,Je);if(ft=function(vn,oi,di,hi,Ii){var ji=null;return(di[0]>hi[2]||hi[0]>di[2]||di[1]>hi[3]||hi[1]>di[3])&&(Ii===R?ji=Qn:Ii===D?ji=vn:Ii!==M&&Ii!==O||(ji=vn.concat(oi))),ji}(ge,be,At,Pt,Je))return ft===Qn?null:ft;for(var tn=function(vn){var oi,di,hi=function(pi){var vi,On,Yn,lr,cn=[];for(On=0,Yn=pi.length;On<Yn;On++)((vi=pi[On]).left&&vi.inResult||!vi.left&&vi.otherEvent.inResult)&&cn.push(vi);for(var Wn=!1;!Wn;)for(Wn=!0,On=0,Yn=cn.length;On<Yn;On++)On+1<Yn&&ct(cn[On],cn[On+1])===1&&(lr=cn[On],cn[On]=cn[On+1],cn[On+1]=lr,Wn=!1);for(On=0,Yn=cn.length;On<Yn;On++)(vi=cn[On]).otherPos=On;for(On=0,Yn=cn.length;On<Yn;On++)(vi=cn[On]).left||(lr=vi.otherPos,vi.otherPos=vi.otherEvent.otherPos,vi.otherEvent.otherPos=lr);return cn}(vn),Ii={},ji=[],Di=function(){if(!Ii[oi]){var pi=ji.length,vi=function(cn,Wn,Ni){var Vi=new yt;if(cn.prevInResult!=null){var qi=cn.prevInResult,Lr=qi.outputContourId;if(qi.resultTransition>0){var Gi=Wn[Lr];if(Gi.holeOf!=null){var un=Gi.holeOf;Wn[un].holeIds.push(Ni),Vi.holeOf=un,Vi.depth=Wn[Lr].depth}else Wn[Lr].holeIds.push(Ni),Vi.holeOf=Lr,Vi.depth=Wn[Lr].depth+1}else Vi.holeOf=null,Vi.depth=Wn[Lr].depth}else Vi.holeOf=null,Vi.depth=0;return Vi}(hi[oi],ji,pi),On=function(cn){Ii[cn]=!0,cn<hi.length&&hi[cn]&&(hi[cn].outputContourId=pi)},Yn=oi,lr=oi;for(vi.points.push(hi[oi].point);On(Yn),On(Yn=hi[Yn].otherPos),vi.points.push(hi[Yn].point),!((Yn=Yt(Yn,hi,Ii,lr))==lr||Yn>=hi.length)&&hi[Yn];);ji.push(vi)}};for(oi=0,di=hi.length;oi<di;oi++)Di();return ji}(function(vn,oi,di,hi,Ii,ji){for(var Di,pi,vi,On=new s(Tt),Yn=[],lr=Math.min(hi[2],Ii[2]);vn.length!==0;){var cn=vn.pop();if(Yn.push(cn),ji===R&&cn.point[0]>lr||ji===D&&cn.point[0]>hi[2])break;if(cn.left){pi=Di=On.insert(cn),Di=Di!==(vi=On.minNode())?On.prev(Di):null,pi=On.next(pi);var Wn=Di?Di.key:null;if(j(cn,Wn,ji),pi&&dt(cn,pi.key,vn)===2&&(j(cn,Wn,ji),j(pi.key,cn,ji)),Di&&dt(Di.key,cn,vn)===2){var Ni=Di;j(Wn,(Ni=Ni!==vi?On.prev(Ni):null)?Ni.key:null,ji),j(cn,Wn,ji)}}else pi=Di=On.find(cn=cn.otherEvent),Di&&pi&&(Di=Di!==vi?On.prev(Di):null,pi=On.next(pi),On.remove(cn),pi&&Di&&dt(Di.key,pi.key,vn))}return Yn}(Qt,0,0,At,Pt,Je)),Cn=[],Ln=0;Ln<tn.length;Ln++){var zn=tn[Ln];if(zn.isExterior()){for(var Hn=[zn.points],dn=0;dn<zn.holeIds.length;dn++)Hn.push(tn[zn.holeIds[dn]].points);Cn.push(Hn)}}return Cn}var ki={UNION:M,DIFFERENCE:D,INTERSECTION:R,XOR:O};a.diff=function(ge,be){return An(ge,be,D)},a.intersection=function(ge,be){return An(ge,be,R)},a.operations=ki,a.union=function(ge,be){return An(ge,be,M)},a.xor=function(ge,be){return An(ge,be,O)},Object.defineProperty(a,"__esModule",{value:!0})}(tO.exports)),tO.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Mw(a,n,s,u){const h=[],g=u===0?(_,x,T,C,R,M)=>{_.push(new st(M,T+(M-x)/(C-x)*(R-T)))}:(_,x,T,C,R,M)=>{_.push(new st(x+(M-T)/(R-T)*(C-x),M))};for(const _ of a){const x=[];for(const T of _){if(T.length<=2)continue;const C=[];for(let D=0;D<T.length-1;D++){const O=T[D].x,j=T[D].y,G=T[D+1].x,X=T[D+1].y,K=u===0?O:j,se=u===0?G:X;K<n?se>n&&g(C,O,j,G,X,n):K>s?se<s&&g(C,O,j,G,X,s):C.push(T[D]),se<n&&K>=n&&g(C,O,j,G,X,n),se>s&&K<=s&&g(C,O,j,G,X,s)}let R=T[T.length-1];const M=u===0?R.x:R.y;M>=n&&M<=s&&C.push(R),C.length&&(R=C[C.length-1],C[0].x===R.x&&C[0].y===R.y||C.push(C[0]),x.push(C))}x.length&&h.push(x)}return h}function nK(a,n){const s=nA(a),u=nA([n]),h=nO.intersection(s,u);return h==null?[]:iO(h)}function iK(a,n){let u=nA(a,65536);const h=[];for(;n.valid();n.next()){const[g,_]=n.get(),x=g.x*65536,T=g.y*65536,C=_.x*65536,R=_.y*65536,M=C-x,D=R-T,O=Math.hypot(M,D);if(O===0)continue;const j=Math.trunc(D/O*3),G=-Math.trunc(M/O*3);h.push([[[x,T],[C,R],[C+j,R+G],[x+j,T+G],[x,T]]])}return h.length>0&&(u=nO.diff(u,h)),iO(u,1/65536)}function nA(a,n=1){return[a.map(s=>s.map(u=>[u.x*n,u.y*n]))]}function iO(a,n=1){return a.map(s=>s.map((u,h)=>{const g=u.map(_=>new st(_[0]*n,_[1]*n).round());return h>0&&g.reverse(),g}))}class iA{constructor(n,s){this.layoutVertexArray=new Eu,this.indexArray=new Jr,this.lineIndexArray=new aa,this.triangleSegments=new dr,this.lineSegments=new dr,this.programConfigurations=new dl(n.layers,{zoom:n.zoom,lut:n.lut}),this.uploaded=!1,s&&(this.elevatedLayoutVertexArray=new gc)}update(n,s,u,h,g,_,x,T){this.programConfigurations.updatePaintArrays(n,s,g,u,h,_,x,T)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,VZ.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.lineIndexBuffer=n.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=n.createVertexBuffer(this.elevatedLayoutVertexArray,UZ.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(n,s,u,h,g,_,x){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,s,u,h,g,_,void 0,x)}}class rA{constructor(n){this.zoom=n.zoom,this.pixelRatio=n.pixelRatio,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=n.lut,this.bufferData=new iA(n,!1),this.elevationBufferData=new iA(n,!0),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=n.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=n.sourceLayerIndex,this.worldview=n.worldview,this.hasAppearances=null}updateFootprints(n,s){}updateAppearances(n,s,u,h){}populate(n,s,u,h){this.hasPattern=eA("fill",this.layers,this.pixelRatio,s);const g=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:x,id:T,index:C,sourceLayerIndex:R}of n){const M=this.layers[0]._featureFilter.needGeometry,D=De(x,M);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),D,u))continue;const O=g?g.evaluate(D,{},u,s.availableImages):void 0,j={id:T,properties:x.properties,type:x.type,sourceLayerIndex:R,index:C,geometry:M?D.geometry:Se(x,u,h),patterns:{},sortKey:O};_.push(j)}g&&_.sort((x,T)=>x.sortKey-T.sortKey);for(const x of _){const{geometry:T,index:C,sourceLayerIndex:R}=x;if(this.hasPattern){const M=tA("fill",this.layers,x,this.zoom,this.pixelRatio,s);this.patternFeatures.push(M)}else this.addFeature(x,T,C,u,{},s.availableImages,s.brightness,s.elevationFeatures);s.featureIndex.insert(n[C].feature,T,C,R,this.index)}}update(n,s,u,h,g,_,x){this.bufferData.update(n,s,u,h,g,_,x,this.worldview),this.elevationBufferData.update(n,s,u,h,g,_,x,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(n,s,u,h,g,_,x,this.worldview)}addFeatures(n,s,u,h,g,_){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,s,u,h,_,n.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(n){this.bufferData.upload(n),this.elevationBufferData.upload(n),this.elevatedStructures&&this.elevatedStructures.upload(n)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(n,s,u,h,g,_=[],x,T){const C=Cx(s,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(n,C,h,u,T):this.addGeometry(C,this.bufferData),this.bufferData.populatePaintArrays(n,u,g,_,h,x,this.worldview),this.elevationBufferData.populatePaintArrays(n,u,g,_,h,x,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(n,s,u,h,g){this.elevatedStructures&&(this.elevatedStructures.construct(n),this.elevatedStructures.populatePaintArrays(s,u,h,g,this.worldview))}addElevatedRoadFeature(n,s,u,h,g){const _=new Array,x=_i.getElevationFeature(n,g);if(!x)return void this.addGeometry(s,this.bufferData);{const C=this.clipPolygonsToTile(s,1);C.length>0&&_.push({polygons:C,elevationFeature:x,elevationTileID:u})}const T={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(n,{},u),featureIndex:h};for(const C of _)if(C.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new ca(C.elevationTileID,this.layers,this.zoom,this.lut));const M=C.elevationFeature.isTunnel();let D=0;n.properties.hasOwnProperty(Ue)&&(D=+n.properties[Ue]);for(const O of C.polygons)this.elevatedStructures.addPortalCandidates(C.elevationFeature.id,O,M,C.elevationFeature,D)}C.elevationFeature.constantHeight==null&&(C.polygons=this.prepareElevatedPolygons(C.polygons,C.elevationFeature,C.elevationTileID));const R=new Ri(u,C.elevationTileID);this.addElevatedGeometry(C.polygons,R,C.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,h,T)}}addElevatedGeometry(n,s,u,h,g,_){const x={elevation:u,elevationSampler:s,bias:h,index:g,featureInfo:_},[T,C]=this.addGeometry(n,this.elevationBufferData,x);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:T,max:C}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,T),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,C))}addGeometry(n,s,u){let h=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,_=null;u&&(_=u.elevationSampler.constantElevation(u.elevation,u.bias),_!=null&&(h=_,g=_));const x=(T,C,R)=>{if(u!=null)if(C.push(T),_!=null)s.elevatedLayoutVertexArray.emplaceBack(_),R.push(_);else{const M=u.elevationSampler.pointElevation(T,u.elevation,u.bias);s.elevatedLayoutVertexArray.emplaceBack(M),R.push(M),h=Math.min(h,M),g=Math.max(g,M)}};for(const T of n){let C=0;for(const ae of T)C+=ae.length;const R=s.triangleSegments.prepareSegment(C,s.layoutVertexArray,s.indexArray),M=R.vertexLength,D=[],O=[],j=[],G=[],X=[],K=s.layoutVertexArray.length;for(const ae of T){if(ae.length===0)continue;ae!==T[0]&&O.push(D.length/2);const de=s.lineSegments.prepareSegment(ae.length,s.layoutVertexArray,s.lineIndexArray),ve=de.vertexLength;u&&X.push(s.layoutVertexArray.length-K),x(ae[0],j,G),s.layoutVertexArray.emplaceBack(ae[0].x,ae[0].y),s.lineIndexArray.emplaceBack(ve+ae.length-1,ve),D.push(ae[0].x),D.push(ae[0].y);for(let me=1;me<ae.length;me++)x(ae[me],j,G),s.layoutVertexArray.emplaceBack(ae[me].x,ae[me].y),s.lineIndexArray.emplaceBack(ve+me-1,ve+me),D.push(ae[me].x),D.push(ae[me].y);de.vertexLength+=ae.length,de.primitiveLength+=ae.length}const se=u_(D,O);for(let ae=0;ae<se.length;ae+=3)s.indexArray.emplaceBack(M+se[ae],M+se[ae+1],M+se[ae+2]);if(se.length>0&&u&&this.elevationMode==="hd-road-base"){const ae=u.elevation.isTunnel(),de=u.elevation.safeArea,ve=this.elevatedStructures.addVertices(j,G);this.elevatedStructures.addTriangles(se,ve,ae);const me=X.length;if(me>0){for(let Te=0;Te<me-1;Te++)this.elevatedStructures.addRenderableRing(u.index,X[Te]+ve,X[Te+1]-X[Te],ae,de,u.featureInfo);this.elevatedStructures.addRenderableRing(u.index,X[me-1]+ve,j.length-X[me-1],ae,de,u.featureInfo)}}R.vertexLength+=C,R.primitiveLength+=se.length/3}return[h,g]}prepareElevatedPolygons(n,s,u){const h=1/te(u),g=[];for(const _ of n){const x=iK(_,new ui(s,h));g.push(...x)}return g}clipPolygonsToTile(n,s){const u=-s,h=-s,g=wt+s,_=wt+s;let x=0;const T=[],C=[];for(;x<n.length;x++){const D=n[x],O=uc(D);(O.min.x>=u&&O.max.x<=g&&O.min.y>=h&&O.max.y<=_?T:C).push(D)}if(T.length===n.length)return n;const R=[new st(u,h),new st(g,h),new st(g,_),new st(u,_),new st(u,h)],M=T;for(const D of C)M.push(...nK(D,R));return M}}let rO,sO,oO,aO;jt(rA,"FillBucket",{omit:["layers","patternFeatures"]}),jt(iA,"FillBufferData"),jt(ca,"ElevatedStructures");class kw{constructor(n,s,u,h){if(this.triangleCount=s.length/3,this.min=new st(0,0),this.max=new st(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||n.length===0)return;const[g,_]=[n[0].clone(),n[0].clone()];for(let M=1;M<n.length;++M){const D=n[M];g.x=Math.min(g.x,D.x),g.y=Math.min(g.y,D.y),_.x=Math.max(_.x,D.x),_.y=Math.max(_.y,D.y)}if(h){const M=Math.ceil(Math.max(_.x-g.x,_.y-g.y)/h);u=Math.max(u,M)}if(u===0)return;this.min=g,this.max=_;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const T=Math.max(x.x,x.y)/u;this.cellsX=Math.max(1,Math.ceil(x.x/T)),this.cellsY=Math.max(1,Math.ceil(x.y/T)),this.xScale=1/T,this.yScale=1/T;const C=[];for(let M=0;M<this.triangleCount;M++){const D=n[s[3*M+0]].sub(this.min),O=n[s[3*M+1]].sub(this.min),j=n[s[3*M+2]].sub(this.min),G=Pu(Math.floor(Math.min(D.x,O.x,j.x)),this.xScale,this.cellsX),X=Pu(Math.floor(Math.max(D.x,O.x,j.x)),this.xScale,this.cellsX),K=Pu(Math.floor(Math.min(D.y,O.y,j.y)),this.yScale,this.cellsY),se=Pu(Math.floor(Math.max(D.y,O.y,j.y)),this.yScale,this.cellsY),ae=new st(0,0),de=new st(0,0),ve=new st(0,0),me=new st(0,0);for(let Te=K;Te<=se;++Te){ae.y=de.y=Te*T,ve.y=me.y=(Te+1)*T;for(let Ie=G;Ie<=X;++Ie)ae.x=ve.x=Ie*T,de.x=me.x=(Ie+1)*T,(Qs(D,O,j,ae,de,me)||Qs(D,O,j,ae,me,ve))&&C.push({cellIdx:Te*this.cellsX+Ie,triIdx:M})}}if(C.length===0)return;C.sort((M,D)=>M.cellIdx-D.cellIdx||M.triIdx-D.triIdx);let R=0;for(;R<C.length;){const M=C[R].cellIdx,D={start:this.payload.length,len:0};for(;R<C.length&&C[R].cellIdx===M;)++D.len,this.payload.push(C[R++].triIdx);this.cells[M]=D}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(n,s){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>n.x||n.y>this.max.y||this.min.y>n.y)return;const u=Pu(n.x-this.min.x,this.xScale,this.cellsX),h=Pu(n.y-this.min.y,this.yScale,this.cellsY),g=this.cells[h*this.cellsX+u];if(g){this._lazyInitLookup();for(let _=0;_<g.len;_++){const x=this.payload[g.start+_],T=Math.floor(x/8),C=1<<x%8;if(!(this.lookup[T]&C)&&(this.lookup[T]|=C,s.push(x),s.length===this.triangleCount))return}}}query(n,s,u){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>s.x||n.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();const h=Pu(n.x-this.min.x,this.xScale,this.cellsX),g=Pu(s.x-this.min.x,this.xScale,this.cellsX),_=Pu(n.y-this.min.y,this.yScale,this.cellsY),x=Pu(s.y-this.min.y,this.yScale,this.cellsY);for(let T=_;T<=x;T++)for(let C=h;C<=g;C++){const R=this.cells[T*this.cellsX+C];if(R)for(let M=0;M<R.len;M++){const D=this.payload[R.start+M],O=Math.floor(D/8),j=1<<D%8;if(!(this.lookup[O]&j)&&(this.lookup[O]|=j,u.push(D),u.length===this.triangleCount))return}}}}function Pu(a,n,s){return Math.max(0,Math.min(s-1,Math.floor(a*n)))}jt(kw,"TriangleGridIndex");class lO{constructor(n){this.zoom=n.zoom,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[],this.worldview=n.worldview,this.hasAppearances=null}updateFootprints(n,s){for(const u of this.footprints)s.push({footprint:u,id:n})}updateAppearances(n,s,u,h){}populate(n,s,u,h){const g=[];for(const{feature:_,id:x,index:T,sourceLayerIndex:C}of n){const R=this.layers[0]._featureFilter.needGeometry,M=De(_,R);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),M,u))continue;const D={id:x,properties:_.properties,type:_.type,sourceLayerIndex:C,index:T,geometry:R?M.geometry:Se(_,u,h),patterns:{}};g.push(D)}for(const _ of g){const{geometry:x,index:T,sourceLayerIndex:C}=_;this.addFeature(_,x,T,u,{},s.availableImages,s.brightness),s.featureIndex.insert(n[T].feature,x,T,C,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(n){}update(n,s,u,h,g,_,x){}destroy(){}addFeature(n,s,u,h,g,_=[],x){for(const T of Cx(s,2)){const C=[],R=[],M=[],D=new st(1/0,1/0),O=new st(-1/0,-1/0);for(const X of T)if(X.length!==0){X!==T[0]&&M.push(R.length/2);for(let K=0;K<X.length;K++)R.push(X[K].x),R.push(X[K].y),C.push(X[K]),D.x=Math.min(D.x,X[K].x),D.y=Math.min(D.y,X[K].y),O.x=Math.max(O.x,X[K].x),O.y=Math.max(O.y,X[K].y)}const j=u_(R,M),G=new kw(C,j,8,256);this.footprints.push({vertices:C,indices:j,grid:G,min:D,max:O})}}}jt(lO,"ClipBucket",{omit:["layers"]});const rK=Gn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),sK=Gn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),oK=Gn([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),aK=Gn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),lK=Gn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),cK=Gn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),uK=Gn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:dK}=rK,Ix=Number.MAX_SAFE_INTEGER,cO=Ix-1;function uO(a,n,s,u){return a.order<n||a.order===Ix||!(a.clipMask&s)||function(h,g){return g.length!==0&&g.find(_=>_===h)===void 0}(u,a.clipScope)}function Dw(a,n){return a.x-n.x||a.y-n.y}function dO(a,n){return Dw(a.min,n.min)===0&&Dw(a.max,n.max)===0}function sA(a,n){return!(a.min.x>n.max.x||a.max.x<n.min.x||a.min.y>n.max.y||a.max.y<n.min.y)}function Nw(a,n){if(a.length!==n.length)return!1;for(let s=0;s<a.length;s++)if(a[s].sourceId!==n[s].sourceId||!dO(a[s],n[s])||a[s].order!==n[s].order||a[s].clipMask!==n[s].clipMask||!Zs(a[s].clipScope,n[s].clipScope))return!1;return!0}function hO(a,n,s){const u=1/wt,h=1/(1<<s.canonical.z),g=(n.x*u+s.canonical.x)*h+s.wrap,_=(n.y*u+s.canonical.y)*h;return{min:new st((a.x*u+s.canonical.x)*h+s.wrap,(a.y*u+s.canonical.y)*h),max:new st(g,_)}}function hK(a,n,s){const u=1<<s.canonical.z,h=((n.x-s.wrap)*u-s.canonical.x)*wt,g=(n.y*u-s.canonical.y)*wt;return{min:new st(((a.x-s.wrap)*u-s.canonical.x)*wt,(a.y*u-s.canonical.y)*wt),max:new st(h,g)}}function oA(a,n,s,u,h,g,_){const x=a.indices,T=a.vertices,C=[];for(let R=u;R<u+h;R+=3){const M=n[s[R+0]+g],D=n[s[R+1]+g],O=n[s[R+2]+g],j=Math.min(M.x,D.x,O.x),G=Math.max(M.x,D.x,O.x),X=Math.min(M.y,D.y,O.y),K=Math.max(M.y,D.y,O.y);C.length=0,a.grid.query(new st(j,X),new st(G,K),C);for(let se=0;se<C.length;se++){const ae=C[se];if(Qs(T[x[3*ae+0]],T[x[3*ae+1]],T[x[3*ae+2]],M,D,O,_))return!0}}return!1}function fO(a,n,s,u){if(!a||!s)return!1;let h=a.vertices;if(!n.canonical.equals(u.canonical)||n.wrap!==u.wrap){if(s.vertices.length<a.vertices.length)return fO(s,u,a,n);const g=n.canonical,_=u.canonical,x=Math.pow(2,_.z-g.z);h=a.vertices.map(T=>new st((T.x+g.x*wt)*x-_.x*wt,(T.y+g.y*wt)*x-_.y*wt))}return oA(s,h,a.indices,0,a.indices.length,0,0)}function pO(a,n,s,u){const h=Math.pow(2,u.z-s.z);return new st((a+s.x*wt)*h-u.x*wt,(n+s.y*wt)*h-u.y*wt)}function mO(a,n){const s=[];n.grid.queryPoint(a,s);const u=n.indices,h=n.vertices;for(let g=0;g<s.length;g++){const _=s[g];if(Fi([h[u[3*_+0]],h[u[3*_+1]],h[u[3*_+2]]],a))return!0}return!1}const aA=[new st(0,0),new st(wt,0),new st(wt,wt),new st(0,wt)];function gO(a,n){const s=[];let u=[];if(!n||a.length<2)return[a];if(a.length===2)return Vs(a[0],a[1],aA)?[a]:[];for(let h=0;h<a.length+2;h++){const g=a[h%a.length],_=a[(h+1)%a.length],x=Vs(h===0?a[a.length-1]:a[(h-1)%a.length],g,aA),T=Vs(g,_,aA),C=x||T;C&&u.push(g),C&&T||u.length>0&&(u.length>1&&s.push(u),u=[])}return u.length>1&&s.push(u),s}const lA=Me.types,fK=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],pK=["fill-extrusion-flood-light-ground-radius"],mK=Math.pow(2,13),gK=Math.pow(2,15)-1,_O=new st(0,1),Id=2147483648,yO=7,vO=450;function Ax(a,n,s,u,h,g,_,x){a.emplaceBack((n<<1)+_,(s<<1)+g,(Math.floor(u*mK)<<1)+h,Math.round(x))}function Px(a,n,s){a.emplaceBack(n.x*wt,n.y*wt,s?1:0)}function Lw(a,n,s,u,h,g){a.emplaceBack(n.x,n.y,(s.x<<1)+u,(s.y<<1)+h,g)}function Rx(a,n,s){a.emplaceBack(n.x,n.y,n.z,s[0]*16384,s[1]*16384,s[2]*16384)}class xO{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class bO{constructor(){this.centroidXY=new st(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new st(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new st(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new st(this.max.x-this.min.x,this.max.y-this.min.y)}}class wO{constructor(){this.acc=new st(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(n,s){n.min.x===Number.MAX_VALUE&&(n.min.x=n.max.x=s.x,n.min.y=n.max.y=s.y)}appendEdge(n,s,u){this.accCount++,this.acc._add(s);let h=!!this.borders;s.x<n.min.x?(n.min.x=s.x,h=!0):s.x>n.max.x&&(n.max.x=s.x,h=!0),s.y<n.min.y?(n.min.y=s.y,h=!0):s.y>n.max.y&&(n.max.y=s.y,h=!0),((s.x===0||s.x===wt)&&s.x===u.x)!=((s.y===0||s.y===wt)&&s.y===u.y)&&this.processBorderOverlap(s,u),h&&this.checkBorderIntersection(s,u)}checkBorderIntersection(n,s){s.x<0!=n.x<0&&this.addBorderIntersection(0,fn(s.y,n.y,(0-s.x)/(n.x-s.x))),s.x>wt!=n.x>wt&&this.addBorderIntersection(1,fn(s.y,n.y,(wt-s.x)/(n.x-s.x))),s.y<0!=n.y<0&&this.addBorderIntersection(2,fn(s.x,n.x,(0-s.y)/(n.y-s.y))),s.y>wt!=n.y>wt&&this.addBorderIntersection(3,fn(s.x,n.x,(wt-s.y)/(n.y-s.y)))}addBorderIntersection(n,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[n];s<u[0]&&(u[0]=s),s>u[1]&&(u[1]=s)}processBorderOverlap(n,s){if(n.x===s.x){if(n.y===s.y)return;const u=n.x===0?0:1;this.addBorderIntersection(u,s.y),this.addBorderIntersection(u,n.y)}else{const u=n.y===0?2:3;this.addBorderIntersection(u,s.x),this.addBorderIntersection(u,n.x)}}centroid(){return this.accCount===0?new st(0,0):new st(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((n,s)=>n+ +(s[0]!==Number.MAX_VALUE),0):0}}function TO(a,n){const s=a.add(n)._unit(),u=Y(a.x*s.x+a.y*s.y,-1,1);var h,g,_;return h=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(h)))/4*gK*((g=a).x*(_=n).y-g.y*_.x<0?-1:1)}const _K=[a=>a.x<0,a=>a.x>wt,a=>a.y<0,a=>a.y>wt];function yK(a,n,s,u){const h=[4];if(u===0)return h;s._mult(u);const g=a.sub(s),_=n.sub(s),x=[a,n,g,_];for(let T=0;T<4;T++)for(const C of x)if(_K[T](C)){h.push(T);break}return h}class cA{constructor(n){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new nx,this.indexArray=new Jr,this.programConfigurations=new dl(n.layers,{zoom:n.zoom,lut:n.lut},s=>pK.includes(s)),this._segments=new dr,this.hiddenByLandmarkVertexArray=new Qg,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new dr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(n,s,u,h=!1){const g=n.length;if(g>2){let _=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*g,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let T;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const C=n[0],R=n[1];T=TO(C.sub(n[g-1])._perp()._unit(),R.sub(C)._perp()._unit())}for(let C=0;C<g;C++){const R=C===g-1?0:C+1,M=n[C],D=n[R],O=n[R===g-1?0:R+1],j=D.sub(M)._perp()._unit(),G=TO(j,O.sub(D)._perp()._unit()),X=T,K=G;if(uA(M,D,s)||h&&CO(M,s)&&CO(D,s)){T=G;continue}const se=x.vertexLength;Lw(this.vertexArray,M,D,1,1,X),Lw(this.vertexArray,M,D,1,0,X),Lw(this.vertexArray,M,D,0,1,K),Lw(this.vertexArray,M,D,0,0,K),x.vertexLength+=4;const ae=yK(M,D,j,u);for(const de of ae)this._segmentToGroundQuads[_].push({id:se,region:de}),this._segmentToRegionTriCounts[_][de]+=2,x.primitiveLength+=2;T=G}}}prepareBorderSegments(){if(!this.hasData())return;const n=this._segments.get(),s=n.length;for(let u=0;u<s;u++)this._segmentToGroundQuads[u].sort((h,g)=>h.region-g.region);for(let u=0;u<s;u++){const h=this._segmentToGroundQuads[u],g=n[u],_=this._segmentToRegionTriCounts[u];_.reduce((T,C)=>T+C,0);let x=0;for(let T=0;T<=4;T++){const C=_[T];if(C!==0){let R=this.regionSegments[T];R||(R=this.regionSegments[T]=new dr);const M={vertexOffset:g.vertexOffset,primitiveOffset:g.primitiveOffset+x,vertexLength:g.vertexLength,primitiveLength:C};R.get().push(M)}x+=C}for(let T=0;T<h.length;T++){const C=h[T].id;this.indexArray.emplaceBack(C,C+1,C+3),this.indexArray.emplaceBack(C,C+3,C+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(n,s,u,h,g,_,x){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,n,s,u,h,g,_,void 0,x)}upload(n){this.hasData()&&(this.vertexBuffer=n.createVertexBuffer(this.vertexArray,sK.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=n.createVertexBuffer(this.groundRadiusArray,oK.members)))}uploadPaintProperties(n){this.hasData()&&this.programConfigurations.upload(n)}update(n,s,u,h,g,_,x,T){this.hasData()&&this.programConfigurations.updatePaintArrays(n,s,u,h,g,_,x,T)}updateHiddenByLandmark(n){this.updateHiddenByLandmarkRange(n.groundVertexArrayOffset,n.groundVertexCount,!!(n.flags&Id))}updateHiddenByLandmarkRange(n,s,u){if(!this.hasData())return;const h=s+n;if(s!==0){for(let g=n;g<h;++g)this.hiddenByLandmarkVertexArray.emplace(g,u?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(n){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=n.createVertexBuffer(this.hiddenByLandmarkVertexArray,cK.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let n=0;n<=4;n++){const s=this.regionSegments[n];s&&s.destroy()}}}}class Ow{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.pixelRatio=n.pixelRatio,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Jr,this.footprintVertices=new Eu,this.footprintSegments=[],this.layoutVertexArray=new Sh,this.centroidVertexArray=new Tw,this.wallVertexArray=new Mp,this.indexArray=new Jr,this.programConfigurations=new dl(n.layers,{zoom:n.zoom,lut:n.lut},s=>fK.includes(s)),this.segments=new dr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new cA(n),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=n.worldview,this.hasAppearances=null}updateFootprints(n,s){}updateAppearances(n,s,u,h){}populate(n,s,u,h){this.features=[],this.hasPattern=eA("fill-extrusion",this.layers,this.pixelRatio,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=te(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:g,id:_,index:x,sourceLayerIndex:T}of n){const C=this.layers[0]._featureFilter.needGeometry,R=De(g,C);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),R,u))continue;const M={id:_,sourceLayerIndex:T,index:x,geometry:C?R.geometry:Se(g,u,h),properties:g.properties,type:g.type,patterns:{}},D=this.layoutVertexArray.length,O=lA[M.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:g.id,feature:tA("fill-extrusion",this.layers,M,this.zoom,this.pixelRatio,s)});else if(this.wallMode)for(const j of M.geometry)for(const G of gO(j,O))this.addFeature(g.id,M,[G],x,u,{},s.availableImages,h,s.brightness);else this.addFeature(g.id,M,M.geometry,x,u,{},s.availableImages,h,s.brightness);s.featureIndex.insert(g,M.geometry,x,T,this.index,D)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(n,s,u,h,g,_){for(const{featureId:x,feature:T}of this.features){const C=lA[T.type]==="Polygon",{geometry:R}=T;if(this.wallMode)for(const M of R)for(const D of gO(M,C))this.addFeature(x,T,[D],T.index,s,u,h,g,_);else this.addFeature(x,T,R,T.index,s,u,h,g,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(n,s,u,h,g,_,x){this.programConfigurations.updatePaintArrays(n,s,g,u,h,_,x,this.worldview),this.groundEffect.update(n,s,g,u,h,_,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,dK),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.wallVertexBuffer=n.createVertexBuffer(this.wallVertexArray,lK.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,uK.members,!0)),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.groundEffect.uploadHiddenByLandmark(n),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,aK.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,s,u,h,g,_,x,T,C){const R=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(s,{})/this.tileToMeter,M=[new st(0,0),new st(wt,wt)],D=T.projection,O=D.name==="globe",j=this.wallMode||lA[s.type]==="Polygon",G=new wO;G.centroidDataIndex=this.centroidData.length;const X=new bO;X.buildingId=n,s.properties&&s.properties.hasOwnProperty("building_id")&&(X.buildingId=s.properties.building_id);const K=this.layers[0].paint.get("fill-extrusion-base").evaluate(s,{},g)<=0,se=this.layers[0].paint.get("fill-extrusion-height").evaluate(s,{},g);let ae;if(X.height=se,X.vertexArrayOffset=this.layoutVertexArray.length,X.groundVertexArrayOffset=this.groundEffect.vertexArray.length,O&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Wg),this.wallMode){if(O)return void Nt("Non zero fill-extrusion-line-width is not yet supported on globe.");if(u.length!==1)return;ae=function(Ne){const Qe=Ne[0].x===Ne[Ne.length-1].x&&Ne[0].y===Ne[Ne.length-1].y;(function(Ot){let Ut=0;const jn=Ot.length;for(let vt=0;vt<jn;vt++)Ut+=(Ot[(vt+1)%jn].x-Ot[vt].x)*(Ot[(vt+1)%jn].y+Ot[vt].y);return Ut>=0})(Ne)||(Ne=Ne.reverse());const rt={geometry:[],joinNormals:[],indices:[]},ht=[],pt=[],ct=[];let ut=Ne.length;for(;ut>=2&&Ne[ut-1].equals(Ne[ut-2]);)ut--;if(ut<(Qe?3:2))return rt;let Ye,Ze,dt,Tt,yt,Yt=0;for(;Yt<ut-1&&Ne[Yt].equals(Ne[Yt+1]);)Yt++;Qe&&(Ye=Ne[ut-2],yt=Ne[Yt].sub(Ye)._unit()._perp());for(let Ot=Yt;Ot<ut;Ot++){if(dt=Ot===ut-1?Qe?Ne[Yt+1]:void 0:Ne[Ot+1],dt&&Ne[Ot].equals(dt))continue;yt&&(Tt=yt),Ye&&(Ze=Ye),Ye=Ne[Ot],yt=dt?dt.sub(Ye)._unit()._perp():Tt,Tt=Tt||yt;let Ut=Tt.add(yt);Ut.x===0&&Ut.y===0||Ut._unit();const jn=Ut.x*yt.x+Ut.y*yt.y,vt=jn!==0?1/jn:1/0,$t=Tt.x*yt.y-Tt.y*yt.x>0;let xn="miter";const Kn=2;xn==="miter"&&vt>Kn&&(xn="bevel"),xn==="bevel"&&(vt>100&&(xn="flipbevel"),vt<Kn&&(xn="miter"));const Qn=(An,ki,ge,be)=>{const Je=new st(An.x,An.y),ft=new st(An.x,An.y);Je.x+=ki.x*be,Je.y+=ki.y*be,ft.x-=ki.x*Math.max(ge,1),ft.y-=ki.y*Math.max(ge,1),ct.push(ki),ht.push(Je),pt.push(ft)};if(xn==="miter")Ut._mult(vt),Qn(Ye,Ut,0,0);else if(xn==="flipbevel")Ut=yt.mult(-1),Qn(Ye,Ut,0,0),Qn(Ye,Ut.mult(-1),0,0);else{const An=-Math.sqrt(vt*vt-1),ki=$t?An:0,ge=$t?0:An;Ze&&Qn(Ye,Tt,ki,ge),dt&&Qn(Ye,yt,ki,ge)}}rt.geometry=[...ht,...pt.reverse(),ht[0]],rt.joinNormals=[...ct,...ct.reverse(),ct[ct.length-1]];const kt=rt.geometry.length-1;for(let Ot=0;Ot<kt/2;Ot++)if(Ot+1<kt/2){let Ut=Ot,jn=Ot+1,vt=kt-1-Ot,$t=kt-2-Ot;Ut=Ut===0?kt-1:Ut-1,jn=jn===0?kt-1:jn-1,vt=vt===0?kt-1:vt-1,$t=$t===0?kt-1:$t-1,rt.indices.push(vt),rt.indices.push(jn),rt.indices.push(Ut),rt.indices.push(vt),rt.indices.push($t),rt.indices.push(jn)}return rt}(u[0]),u=[ae.geometry]}const de=(Ne,Qe)=>Ne<(Qe.length-1)/2||Ne===Qe.length-1,ve=this.wallMode?[u]:Cx(u,500);for(let Ne=ve.length-1;Ne>=0;Ne--){const Qe=ve[Ne];(Qe.length===0||(me=Qe[0]).every(it=>it.x<=0)||me.every(it=>it.x>=wt)||me.every(it=>it.y<=0)||me.every(it=>it.y>=wt))&&ve.splice(Ne,1)}var me;let Te;if(O)Te=RO(ve,M,g);else{Te=[];for(const Ne of ve)Te.push({polygon:Ne,bounds:M})}const Ie=j?this.edgeRadius:0,Re=Ie>0&&this.zoom<17,qe=(Ne,Qe)=>{if(Ne.length===0)return!1;const it=Ne[Ne.length-1];return Qe.x===it.x&&Qe.y===it.y};for(const{polygon:Ne,bounds:Qe}of Te){let it=0,rt=0;for(const ut of Ne)j&&!ut[0].equals(ut[ut.length-1])&&ut.push(ut[0]),rt+=j?ut.length-1:ut.length;const ht=this.segments.prepareSegment((j?5:4)*rt,this.layoutVertexArray,this.indexArray);X.footprintSegIdx<0&&(X.footprintSegIdx=this.footprintSegments.length),X.polygonSegIdx<0&&(X.polygonSegIdx=this.polygonSegments.length);const pt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ct=new xO;if(ct.vertexOffset=this.footprintVertices.length,ct.indexOffset=3*this.footprintIndices.length,ct.ringIndices=[],j){const ut=[],Ye=[];it=ht.vertexLength;for(let dt=0;dt<Ne.length;dt++){const Tt=Ne[dt];Tt.length&&dt!==0&&Ye.push(ut.length/2);const yt=[];let Yt,kt;Yt=Tt[1].sub(Tt[0])._perp()._unit(),ct.ringIndices.push(Tt.length-1);for(let Ot=1;Ot<Tt.length;Ot++){const Ut=Tt[Ot],jn=Tt[Ot===Tt.length-1?1:Ot+1],vt=Ut.clone();if(Ie){kt=jn.sub(Ut)._perp()._unit();const $t=Yt.add(kt)._unit(),xn=Ie*Math.min(4,1/(Yt.x*$t.x+Yt.y*$t.y));vt.x+=xn*$t.x,vt.y+=xn*$t.y,vt.x=Math.round(vt.x),vt.y=Math.round(vt.y),Yt=kt}if(!K||Ie!==0&&!Re||qe(yt,vt)||yt.push(vt),Ax(this.layoutVertexArray,vt.x,vt.y,0,0,1,1,0),this.wallMode){const $t=de(Ot,Tt);Px(this.wallVertexArray,ae.joinNormals[Ot],!$t)}ht.vertexLength++,this.footprintVertices.emplaceBack(Ut.x,Ut.y),ut.push(Ut.x,Ut.y),O&&Rx(this.layoutVertexExtArray,D.projectTilePoint(vt.x,vt.y,g),D.upVector(g,vt.x,vt.y))}K&&(Ie===0||Re)&&(yt.length!==0&&qe(yt,yt[0])&&yt.pop(),this.groundEffect.addData(yt,Qe,R))}const Ze=this.wallMode?ae.indices:u_(ut,Ye);for(let dt=0;dt<Ze.length;dt+=3)this.footprintIndices.emplaceBack(ct.vertexOffset+Ze[dt+0],ct.vertexOffset+Ze[dt+1],ct.vertexOffset+Ze[dt+2]),this.indexArray.emplaceBack(it+Ze[dt],it+Ze[dt+2],it+Ze[dt+1]),ht.primitiveLength++;ct.indexCount+=Ze.length,ct.vertexCount+=this.footprintVertices.length-ct.vertexOffset}for(let ut=0;ut<Ne.length;ut++){const Ye=Ne[ut];G.startRing(X,Ye[0]);let Ze=Ye.length>4&&IO(Ye[Ye.length-2],Ye[0],Ye[1]),dt=Ie?vK(Ye[Ye.length-2],Ye[0],Ye[1],Ie):0;const Tt=[];let yt,Yt,kt;Yt=Ye[1].sub(Ye[0])._perp()._unit();let Ot=!0;for(let Ut=1,jn=0;Ut<Ye.length;Ut++){let vt=Ye[Ut-1],$t=Ye[Ut];const xn=Ye[Ut===Ye.length-1?1:Ut+1];if(G.appendEdge(X,$t,vt),uA($t,vt,Qe)){Ie&&(Yt=xn.sub($t)._perp()._unit(),Ot=!Ot);continue}const Kn=$t.sub(vt)._perp(),Qn=Kn.x/(Math.abs(Kn.x)+Math.abs(Kn.y)),An=Kn.y>0?1:0,ki=vt.dist($t);if(jn+ki>32768&&(jn=0),Ie){kt=xn.sub($t)._perp()._unit();let ft=SO(vt,$t,xn,EO(Yt,kt),Ie);isNaN(ft)&&(ft=0);const At=$t.sub(vt)._unit();vt=vt.add(At.mult(dt))._round(),$t=$t.add(At.mult(-ft))._round(),dt=ft,Yt=kt,K&&this.zoom>=17&&(qe(Tt,vt)||Tt.push(vt),qe(Tt,$t)||Tt.push($t))}const ge=ht.vertexLength,be=Ye.length>4&&IO(vt,$t,xn);let Je=AO(jn,Ze,Ot);if(Ax(this.layoutVertexArray,vt.x,vt.y,Qn,An,0,0,Je),Ax(this.layoutVertexArray,vt.x,vt.y,Qn,An,0,1,Je),this.wallMode){const ft=de(Ut-1,Ye),At=ae.joinNormals[Ut-1];Px(this.wallVertexArray,At,ft),Px(this.wallVertexArray,At,ft)}if(jn+=ki,Je=AO(jn,be,!Ot),Ze=be,Ax(this.layoutVertexArray,$t.x,$t.y,Qn,An,0,0,Je),Ax(this.layoutVertexArray,$t.x,$t.y,Qn,An,0,1,Je),this.wallMode){const ft=de(Ut,Ye),At=ae.joinNormals[Ut];Px(this.wallVertexArray,At,ft),Px(this.wallVertexArray,At,ft)}if(ht.vertexLength+=4,this.indexArray.emplaceBack(ge+0,ge+1,ge+2),this.indexArray.emplaceBack(ge+1,ge+3,ge+2),ht.primitiveLength+=2,Ie){const ft=it+(Ut===1?Ye.length-2:Ut-2),At=Ut===1?it:ft+1;if(this.indexArray.emplaceBack(ge+1,ft,ge+3),this.indexArray.emplaceBack(ft,At,ge+3),ht.primitiveLength+=2,yt===void 0&&(yt=ge),!uA(xn,Ye[Ut],Qe)){const Pt=Ut===Ye.length-1?yt:ht.vertexLength;this.indexArray.emplaceBack(ge+2,ge+3,Pt),this.indexArray.emplaceBack(ge+3,Pt+1,Pt),this.indexArray.emplaceBack(ge+3,At,Pt+1),ht.primitiveLength+=3}Ot=!Ot}if(O){const ft=this.layoutVertexExtArray,At=D.projectTilePoint(vt.x,vt.y,g),Pt=D.projectTilePoint($t.x,$t.y,g),Qt=D.upVector(g,vt.x,vt.y),tn=D.upVector(g,$t.x,$t.y);Rx(ft,At,Qt),Rx(ft,At,Qt),Rx(ft,Pt,tn),Rx(ft,Pt,tn)}}j&&(it+=Ye.length-1),K&&Ie&&this.zoom>=17&&(Tt.length!==0&&qe(Tt,Tt[0])&&Tt.pop(),this.groundEffect.addData(Tt,Qe,R,Ie>0))}this.footprintSegments.push(ct),pt.triangleCount=this.indexArray.length-pt.triangleArrayOffset,this.polygonSegments.push(pt),++X.footprintSegLen,++X.polygonSegLen}if(X.vertexCount=this.layoutVertexArray.length-X.vertexArrayOffset,X.groundVertexCount=this.groundEffect.vertexArray.length-X.groundVertexArrayOffset,X.vertexCount!==0){if(X.centroidXY=G.borders?_O:this.encodeCentroid(G,X),this.centroidData.push(X),G.borders){this.featuresOnBorder.push(G);const Ne=this.featuresOnBorder.length-1;for(let Qe=0;Qe<G.borders.length;Qe++)G.borders[Qe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Qe].push(Ne)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,_,x,g,C,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(s,h,_,x,g,C,this.worldview),this.maxHeight=Math.max(this.maxHeight,se)}}sortBorders(){for(let n=0;n<this.borderFeatureIndices.length;n++)this.borderFeatureIndices[n].sort((s,u)=>this.featuresOnBorder[s].borders[n][0]-this.featuresOnBorder[u].borders[n][0])}splitToSubtiles(){const n=[];for(let x=0;x<this.centroidData.length;x++){const T=this.centroidData[x],C=+(T.min.y+T.max.y>wt),R=2*C+(+(T.min.x+T.max.x>wt)^C);for(let M=0;M<T.polygonSegLen;M++){const D=T.polygonSegIdx+M;n.push({centroidIdx:x,subtile:R,polygonSegmentIdx:D,triangleSegmentIdx:this.polygonSegments[D].triangleSegIdx})}}const s=new Jr;n.sort((x,T)=>x.triangleSegmentIdx===T.triangleSegmentIdx?x.subtile-T.subtile:x.triangleSegmentIdx-T.triangleSegmentIdx);let u=0,h=0,g=0;for(const x of n){if(x.triangleSegmentIdx!==u)break;g++}const _=n.length;for(;h!==n.length;){u=n[h].triangleSegmentIdx;let x=0,T=h,C=h;for(let R=T;R<g&&n[R].subtile===x;R++)C++;for(;T!==g;){const R=n[T];x=R.subtile;const M=this.centroidData[R.centroidIdx].min.clone(),D=this.centroidData[R.centroidIdx].max.clone(),O={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let j=T;j<C;j++){const G=n[j],X=this.polygonSegments[G.polygonSegmentIdx],K=this.centroidData[G.centroidIdx].min,se=this.centroidData[G.centroidIdx].max,ae=this.indexArray.uint16;for(let de=X.triangleArrayOffset;de<X.triangleArrayOffset+X.triangleCount;de++)s.emplaceBack(ae[3*de],ae[3*de+1],ae[3*de+2]);O.primitiveLength+=X.triangleCount,M.x=Math.min(M.x,K.x),M.y=Math.min(M.y,K.y),D.x=Math.max(D.x,se.x),D.y=Math.max(D.y,se.y)}O.primitiveLength>0&&this.triangleSubSegments.push({segment:O,min:M,max:D}),T=C;for(let j=T;j<g&&n[j].subtile===n[T].subtile;j++)C++}h=g;for(let R=h;R<_&&n[R].triangleSegmentIdx===n[h].triangleSegmentIdx;R++)g++}s._trim(),this.indexArray=s}getVisibleSegments(n,s,u){const h=new dr;if(this.wallMode){for(const G of this.triangleSubSegments)h.segments.push(G.segment);return h}let g=0,_=0;const x=1<<n.canonical.z;if(s){const G=s.getMinMaxForTile(n);G&&(g=G.min,_=G.max)}_+=this.maxHeight;const T=n.toUnwrapped();let C;const R=[T.canonical.x/x+T.wrap,T.canonical.y/x],M=[(T.canonical.x+1)/x+T.wrap,(T.canonical.y+1)/x],D=(G,X,K)=>[G[0]*(1-K[0])+X[0]*K[0],G[1]*(1-K[1])+X[1]*K[1]],O=[],j=[];for(const G of this.triangleSubSegments){O[0]=G.min.x/wt,O[1]=G.min.y/wt,j[0]=G.max.x/wt,j[1]=G.max.y/wt;const X=D(R,M,O),K=D(R,M,j);if(new Ht([X[0],X[1],g],[K[0],K[1],_]).intersectsPrecise(u)===0){C&&(h.segments.push(C),C=void 0);continue}const se=G.segment;C&&C.vertexOffset!==se.vertexOffset&&(h.segments.push(C),C=void 0),C?(C.vertexLength+=se.vertexLength,C.primitiveLength+=se.primitiveLength):C={vertexOffset:se.vertexOffset,primitiveLength:se.primitiveLength,vertexLength:se.vertexLength,primitiveOffset:se.primitiveOffset,sortKey:void 0,vaos:{}}}return C&&h.segments.push(C),h}encodeCentroid(n,s){const u=n.centroid(),h=s.span(),g=Math.min(7,Math.round(h.x*this.tileToMeter/10)),_=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new st(Y(u.x,1,wt-1)<<3|g,Y(u.y,1,wt-1)<<3|_)}encodeBorderCentroid(n){if(!n.borders)return new st(0,0);const s=n.borders,u=Number.MAX_VALUE;if(s[0][0]!==u||s[1][0]!==u){const h=s[0][0]!==u?0:1;return new st(6|(s[0][0]!==u?0:65528),(s[h][0]+s[h][1])/2<<3|6)}{const h=s[2][0]!==u?2:3;return new st((s[h][0]+s[h][1])/2<<3|6,6|(s[2][0]!==u?0:65528))}}showCentroid(n){const s=this.centroidData[n.centroidDataIndex];s.flags&=2147483647,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(n){this.groundEffect.updateHiddenByLandmark(n);const s=n.vertexArrayOffset,u=n.vertexCount+n.vertexArrayOffset,h=n.flags&Id?_O:n.centroidXY,g=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==h.y||g!==h.x){for(let _=s;_<u;++_)this.centroidVertexArray.emplace(_,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const n of this.centroidData)this.writeCentroidToBuffer(n)}updateReplacement(n,s,u){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const h=s.getReplacementRegionsForTile(n.toUnwrapped());if(Nw(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const g=[];for(const _ of this.activeReplacements){if(_.order<u)continue;const x=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-n.canonical.z));if(_.footprint.buildingIds)for(const T of this.centroidData)T.flags&Id||_.min.x>T.max.x||T.min.x>_.max.x||_.min.y>T.max.y||T.min.y>_.max.y||_.footprint.buildingIds.has(T.buildingId)&&(T.flags|=Id);else for(const T of this.centroidData)if(!(T.flags&Id||_.min.x>T.max.x||T.min.x>_.max.x||_.min.y>T.max.y||T.min.y>_.max.y))for(let C=0;C<T.footprintSegLen;C++){const R=this.footprintSegments[T.footprintSegIdx+C];if(g.length=0,xK(this.footprintVertices,R.vertexOffset,R.vertexCount,_.footprintTileId.canonical,n.canonical,g),oA(_.footprint,g,this.footprintIndices.uint16,R.indexOffset,R.indexCount,-R.vertexOffset,-x)){T.flags|=Id;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(n,s,u){let h=!1;for(let g=0;g<u.footprintSegLen;g++){const _=this.footprintSegments[u.footprintSegIdx+g];let x=0;for(const T of _.ringIndices){for(let C=x,R=T+x-1;C<T+x;R=C++){const M=this.footprintVertices.int16[2*(C+_.vertexOffset)+0],D=this.footprintVertices.int16[2*(C+_.vertexOffset)+1],O=this.footprintVertices.int16[2*(R+_.vertexOffset)+1];D>s!=O>s&&n<(this.footprintVertices.int16[2*(R+_.vertexOffset)+0]-M)*(s-D)/(O-D)+M&&(h=!h)}x=T}}return h}getHeightAtTileCoord(n,s){let u=Number.NEGATIVE_INFINITY,h=!0;const g=4*(n+wt)*wt+(s+wt);if(this.partLookup.hasOwnProperty(g)){const _=this.partLookup[g];return _?{height:_.height,hidden:!!(_.flags&Id)}:void 0}for(const _ of this.centroidData)n>_.max.x||_.min.x>n||s>_.max.y||_.min.y>s||_.height<=u||this.footprintContainsPoint(n,s,_)&&(u=_.height,this.partLookup[g]=_,h=!!(_.flags&Id));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.partLookup[g]=void 0}}function EO(a,n){const s=a.add(n)._unit();return a.x*s.x+a.y*s.y}function vK(a,n,s,u){const h=n.sub(a)._perp()._unit(),g=s.sub(n)._perp()._unit();return SO(a,n,s,EO(h,g),u)}function SO(a,n,s,u,h){const g=Math.sqrt(1-u*u);return Math.min(a.dist(n)/3,n.dist(s)/3,h*g/u)}function uA(a,n,s){return a.x<s[0].x&&n.x<s[0].x||a.x>s[1].x&&n.x>s[1].x||a.y<s[0].y&&n.y<s[0].y||a.y>s[1].y&&n.y>s[1].y}function CO(a,n){return a.x<n[0].x||a.x>n[1].x||a.y<n[0].y||a.y>n[1].y}function IO(a,n,s){if(a.x<0||a.x>=wt||n.x<0||n.x>=wt||s.x<0||s.x>=wt)return!1;const u=s.sub(n),h=u.perp(),g=a.sub(n);return(u.x*g.x+u.y*g.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(g.x*g.x+g.y*g.y))>-.866&&h.x*g.x+h.y*g.y<0}function AO(a,n,s){const u=n?2|a:-3&a;return s?1|u:-2&u}function PO(){const a=Math.PI/32,n=Math.tan(a),s=f;return s*Math.sqrt(1+2*n*n)-s}function RO(a,n,s){const u=1<<s.z,h=L(s.x/u),g=L((s.x+1)/u),_=V(s.y/u),x=V((s.y+1)/u);return function(T,C,R,M,D=0,O){const j=[];if(!T.length||!R||!M)return j;const G=(me,Te)=>{for(const Ie of me)j.push({polygon:Ie,bounds:Te})},X=Math.ceil(Math.log2(R)),K=Math.ceil(Math.log2(M)),se=X-K,ae=[];for(let me=0;me<Math.abs(se);me++)ae.push(se>0?0:1);for(let me=0;me<Math.min(X,K);me++)ae.push(0),ae.push(1);let de=T;if(de=Mw(de,C[0].y-D,C[1].y+D,1),de=Mw(de,C[0].x-D,C[1].x+D,0),!de.length)return j;const ve=[];for(ae.length?ve.push({polygons:de,bounds:C,depth:0}):G(de,C);ve.length;){const me=ve.pop(),Te=me.depth,Ie=ae[Te],Re=me.bounds[0],qe=me.bounds[1],Ne=Ie===0?Re.x:Re.y,Qe=Ie===0?qe.x:qe.y,it=O?O(Ie,Ne,Qe):.5*(Ne+Qe),rt=Mw(me.polygons,Ne-D,it+D,Ie),ht=Mw(me.polygons,it-D,Qe+D,Ie);if(rt.length){const pt=[Re,new st(Ie===0?it:qe.x,Ie===1?it:qe.y)];ae.length>Te+1?ve.push({polygons:rt,bounds:pt,depth:Te+1}):G(rt,pt)}if(ht.length){const pt=[new st(Ie===0?it:Re.x,Ie===1?it:Re.y),qe];ae.length>Te+1?ve.push({polygons:ht,bounds:pt,depth:Te+1}):G(ht,pt)}}return j}(a,n,Math.ceil((g-h)/11.25),Math.ceil((_-x)/11.25),1,(T,C,R)=>{if(T===0)return .5*(C+R);{const M=V((s.y+C/wt)/u);return(P(.5*(V((s.y+R/wt)/u)+M))*u-s.y)*wt}})}function xK(a,n,s,u,h,g){const _=Math.pow(2,u.z-h.z);for(let x=0;x<s;x++){let T=a.int16[2*(x+n)+0],C=a.int16[2*(x+n)+1];T=(T+h.x*wt)*_-u.x*wt,C=(C+h.y*wt)*_-u.y*wt,g.push(new st(T,C))}}let MO,kO;jt(Ow,"FillExtrusionBucket",{omit:["layers","features"]}),jt(bO,"PartData"),jt(xO,"FootprintSegment"),jt(wO,"BorderCentroidData"),jt(cA,"GroundEffect");class Vp extends st{constructor(n,s,u){super(n,s),this.z=u}}class DO extends Vp{constructor(n,s,u,h){super(n,s,u),this.w=h}}function NO(a,n,s,u){const h=s==="x"?"y":"x",g=(u-a[s])/(n[s]-a[s]);a[h]=Math.round(a[h]+(n[h]-a[h])*g),a[s]=u,a.hasOwnProperty("z")&&(a.z=fn(a.z,n.z,g)),a.hasOwnProperty("w")&&(a.w=fn(a.w,n.w,g))}function LO(a,n,s,u){const h=s,g=u;for(const _ of["x","y"]){let x=a,T=n;x[_]>=T[_]&&(x=n,T=a),x[_]<h&&T[_]>h&&NO(x,T,_,h),x[_]<g&&T[_]>g&&NO(T,x,_,g)}}function Fw(a,n,s,u,h,g){const _=[];for(let x=0;x<a.length;x++){const T=a[x];let C;const R=_.length;let M=0;for(let D=0;D<T.length-1;D++){let O=T[D],j=T[D+1],G=0;const X=M;let K,se;g&&(G=Math.hypot(j.x-O.x,j.y-O.y),M+=G,K=O,se=j),O.x<n&&j.x<n||(O.x<n?O=new st(n,O.y+(n-O.x)/(j.x-O.x)*(j.y-O.y))._round():j.x<n&&(j=new st(n,O.y+(n-O.x)/(j.x-O.x)*(j.y-O.y))._round()),O.y<s&&j.y<s||(O.y<s?O=new st(O.x+(s-O.y)/(j.y-O.y)*(j.x-O.x),s)._round():j.y<s&&(j=new st(O.x+(s-O.y)/(j.y-O.y)*(j.x-O.x),s)._round()),O.x>=u&&j.x>=u||(O.x>=u?O=new st(u,O.y+(u-O.x)/(j.x-O.x)*(j.y-O.y))._round():j.x>=u&&(j=new st(u,O.y+(u-O.x)/(j.x-O.x)*(j.y-O.y))._round()),O.y>=h&&j.y>=h||(O.y>=h?O=new st(O.x+(h-O.y)/(j.y-O.y)*(j.x-O.x),h)._round():j.y>=h&&(j=new st(O.x+(h-O.y)/(j.y-O.y)*(j.x-O.x),h)._round()),C&&O.equals(C[C.length-1])||(C=[O],_.push(C),g&&g.push({progress:{min:X+OO(K,se,O)*G,max:1},parentIndex:x,prevPoint:K,nextPoint:se})),C.push(j),g&&(g[g.length-1].progress.max=X+OO(K,se,j)*G,g[g.length-1].nextPoint=se)))))}if(g&&M>0)for(let D=R;D<_.length;D++)g[D].progress.min/=M,g[D].progress.max/=M}return _}function bK(a,n,s,u,h){if(a.length<2)return void u.push(a);const g=[];for(;n.valid();){const[C,R]=n.get();for(let M=0;M<a.length-1;M++){const D=a[M],O=a[M+1],j=Nn(D,O,C,R);if(j){const[G]=j,X=new st(fn(D.x,O.x,G),fn(D.y,O.y,G));g.push({t:M+G,distance:0,point:X})}}n.next()}if(g.length===0)return void u.push(a);g.sort((C,R)=>C.t-R.t);let _=0,x=0,T=[];for(u.push(T);_!==a.length;){if(x===g.length){for(;_!==a.length;)T.length!==0&&T[T.length-1].equals(a[_])||T.push(a[_]),_++;break}g[x].t<=_?(T.length!==0&&T[T.length-1].equals(g[x].point)||T.push(g[x].point),Math.trunc(g[x].t),x++):(T.length!==0&&T[T.length-1].equals(a[_])||T.push(a[_]),_++)}}function OO(a,n,s){return a.x!==n.x?(s.x-a.x)/(n.x-a.x):a.y!==n.y?(s.y-a.y)/(n.y-a.y):0}function Mx(a,n){return a.x*n.x+a.y*n.y}function FO(a,n){if(a.length===1){let s=0;const u=n[s++];let h;for(;!h||u.equals(h);)if(h=n[s++],!h)return 1/0;for(;s<n.length;s++){const g=n[s],_=a[0],x=h.sub(u),T=g.sub(u),C=_.sub(u),R=Mx(x,x),M=Mx(x,T),D=Mx(T,T),O=Mx(C,x),j=Mx(C,T),G=R*D-M*M,X=(D*O-M*j)/G,K=(R*j-M*O)/G,se=u.z*(1-X-K)+h.z*X+g.z*K;if(isFinite(se))return se}return 1/0}{let s=1/0;for(const u of n)s=Math.min(s,u.z);return s}}function zO(a,n,s){let u=1/0;mi(s,n)&&(u=FO(s,n[0]));for(let h=0;h<n.length;h++){const g=n[h],_=a[h];for(let x=0;x<g.length-1;x++){const T=g[x],C=[T,g[x+1],_[x+1],_[x],T];ci(s,C)&&(u=Math.min(u,FO(s,C)))}}return u!==1/0&&u}function jO(a,n,s,u,h,g,_,x,T,C,R){return a.projection.name==="globe"?function(M,D,O,j,G,X,K,se,ae,de,ve){const me=[],Te=[],Ie=M.projection.upVectorScale(ve,M.center.lat,M.worldSize).metersToTile,Re=[0,0,0,1],qe=[0,0,0,1],Ne=(it,rt,ht,pt)=>{it[0]=rt,it[1]=ht,it[2]=pt,it[3]=1},Qe=PO();O>0&&(O+=Qe),j+=Qe;for(const it of D){const rt=[],ht=[];for(const pt of it){const ct=pt.x+G.x,ut=pt.y+G.y,Ye=M.projection.projectTilePoint(ct,ut,ve),Ze=M.projection.upVector(ve,pt.x,pt.y);let dt=O,Tt=j;if(K){const yt=BO(ct,ut,O,j,K,se,ae,de);dt+=yt.base,Tt+=yt.top}O!==0?Ne(Re,Ye.x+Ze[0]*Ie*dt,Ye.y+Ze[1]*Ie*dt,Ye.z+Ze[2]*Ie*dt):Ne(Re,Ye.x,Ye.y,Ye.z),Ne(qe,Ye.x+Ze[0]*Ie*Tt,Ye.y+Ze[1]*Ie*Tt,Ye.z+Ze[2]*Ie*Tt),Mi(Re,Re,X),Mi(qe,qe,X),rt.push(new Vp(Re[0],Re[1],Re[2])),ht.push(new Vp(qe[0],qe[1],qe[2]))}me.push(rt),Te.push(ht)}return[me,Te]}(a,n,s,u,h,g,_,x,T,C,R):_?function(M,D,O,j,G,X,K,se,ae){const de=[],ve=[],me=[0,0,0,1];for(const Te of M){const Ie=[],Re=[];for(const qe of Te){const Ne=qe.x+j.x,Qe=qe.y+j.y,it=BO(Ne,Qe,D,O,X,K,se,ae);me[0]=Ne,me[1]=Qe,me[2]=it.base,me[3]=1,ks(me,me,G),me[3]=Math.max(me[3],1e-5);const rt=new Vp(me[0]/me[3],me[1]/me[3],me[2]/me[3]);me[0]=Ne,me[1]=Qe,me[2]=it.top,me[3]=1,ks(me,me,G),me[3]=Math.max(me[3],1e-5);const ht=new Vp(me[0]/me[3],me[1]/me[3],me[2]/me[3]);Ie.push(rt),Re.push(ht)}de.push(Ie),ve.push(Re)}return[de,ve]}(n,s,u,h,g,_,x,T,C):function(M,D,O,j,G){const X=[],K=[],se=G[8]*D,ae=G[9]*D,de=G[10]*D,ve=G[11]*D,me=G[8]*O,Te=G[9]*O,Ie=G[10]*O,Re=G[11]*O;for(const qe of M){const Ne=[],Qe=[];for(const it of qe){const rt=it.x+j.x,ht=it.y+j.y,pt=G[0]*rt+G[4]*ht+G[12],ct=G[1]*rt+G[5]*ht+G[13],ut=G[2]*rt+G[6]*ht+G[14],Ye=G[3]*rt+G[7]*ht+G[15],Ze=pt+se,dt=ct+ae,Tt=ut+de,yt=Math.max(Ye+ve,1e-5),Yt=pt+me,kt=ct+Te,Ot=ut+Ie,Ut=Math.max(Ye+Re,1e-5);Ne.push(new Vp(Ze/yt,dt/yt,Tt/yt)),Qe.push(new Vp(Yt/Ut,kt/Ut,Ot/Ut))}X.push(Ne),K.push(Qe)}return[X,K]}(n,s,u,h,g)}function BO(a,n,s,u,h,g,_,x){const T=_*h.getElevationAt(a,n,!0,!0),C=g[0]!==0,R=C?g[1]===0?_*(g[0]/yO-vO):_*function(M,D,O){const j=Math.floor(D[0]/8),G=Math.floor(D[1]/8),X=10*(D[0]-8*j),K=10*(D[1]-8*G),se=M.getElevationAt(j,G,!0,!0),ae=M.getMeterToDEM(O),de=Math.floor(.5*(X*ae-1)),ve=Math.floor(.5*(K*ae-1)),me=M.tileCoordToPixel(j,G),Te=2*de+1,Ie=2*ve+1,Re=function(ht,pt,ct,ut,Ye){return[ht.getElevationAtPixel(pt,ct,!0),ht.getElevationAtPixel(pt+Ye,ct,!0),ht.getElevationAtPixel(pt,ct+Ye,!0),ht.getElevationAtPixel(pt+ut,ct+Ye,!0)]}(M,me.x-de,me.y-ve,Te,Ie),qe=Math.abs(Re[0]-Re[1]),Ne=Math.abs(Re[2]-Re[3]),Qe=Math.abs(Re[0]-Re[2])+Math.abs(Re[1]-Re[3]),it=Math.min(.25,.5*ae*(qe+Ne)/Te),rt=Math.min(.25,.5*ae*Qe/Ie);return se+Math.max(it*X,rt*K)}(h,g,x):T;return{base:T+(s===0?-1:s),top:C?Math.max(R+u,T+s+2):T+u}}class wK{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class TK{constructor(){this.tasks={},this.taskQueue=[],Le(["process"],this),this.invoker=new wK(this.process),this.nextId=0}add(n,s){const u=this.nextId++,h=function({type:g,isSymbolTile:_,zoom:x}){return x=x||0,g==="message"?0:g!=="maybePrepare"||_?g!=="parseTile"||_?g==="parseTile"&&_?300-x:g==="maybePrepare"&&_?400-x:500:200-x:100-x}(s);if(h===0){try{n()}finally{}return null}return this.tasks[u]={fn:n,metadata:s,priority:h,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const s=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let n=null,s=1/0;for(let h=0;h<this.taskQueue.length;h++){const g=this.tasks[this.taskQueue[h]];g.priority<s&&(s=g.priority,n=h)}if(n===null)return null;const u=this.taskQueue[n];return this.taskQueue.splice(n,1),u}remove(){this.invoker.remove()}}class VO{constructor(n,s,u){this.target=n,this.parent=s,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Le(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new TK}send(n,s,u,h,g=!1,_){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=_,this.callbacks[x]=u);const T=new Set;return this.target.postMessage({id:x,type:n,hasCallback:!!u,targetMapId:h,mustQueue:g,sourceMapId:this.mapId,data:hc(s,T)},T),{cancel:()=>{u&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(n){const s=n.data;if(!s)return;const u=s.id;if(u&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){const h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h.cancel()}else if(s.mustQueue||ei(self)){const h=this.callbacks[u],g=this.scheduler.add(()=>this.processTask(u,s),h&&h.metadata||{type:"message"});g&&(this.cancelCallbacks[u]=g)}else this.processTask(u,s)}processTask(n,s){if(delete this.cancelCallbacks[n],s.type==="<response>"){const u=this.callbacks[n];delete this.callbacks[n],u&&(s.error?u(Tu(s.error)):u(null,Tu(s.data)))}else{const u=new Set,h=s.hasCallback?(_,x)=>{this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:_?hc(_):null,data:hc(x,u)},u)}:()=>{},g=Tu(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,g,h);else if(this.parent.getWorkerSource){const _=s.type.split("."),{source:x,scope:T}=g;this.parent.getWorkerSource(s.sourceMapId,_[0],x,T)[_[1]](g,h)}else h(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var kx={workerUrl:"",workerClass:null,workerParams:void 0};const dA="mapboxgl_preloaded_worker_pool";class Up{constructor(n){this.active={},this.name=n}acquire(n,s=Up.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<s;){const h=(u=`${this.name||""}WorkerPool: ${n}-${this.workers.length}`,kx.workerClass!=null?new kx.workerClass:new self.Worker(kx.workerUrl,Object.assign({name:u},kx.workerParams)));this.workers.push(h)}var u;return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.workers&&this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[dA]}numActive(){return Object.keys(this.active).length}}Up.workerCount=2;class h_{constructor(n,s,u="Worker",h=Up.workerCount){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=ke();const g=this.workerPool.acquire(this.id,h);for(let _=0;_<g.length;_++){const x=new h_.Actor(g[_],s,this.id);x.name=`${u} ${_}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,s,u){Ae(this.actors,(h,g)=>{h.send(n,s,g)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Dx,hA;function zw(){return Dx||(Dx=new Up),Dx}h_.Actor=VO;const fA=4096;class EK{constructor(n){this.module=n,this.memoryStack=this.module.malloc(fA),this.memoryStackNextFree=this.memoryStack}createIntArray(n){const s=this.memoryStackNextFree;return this.memoryStackNextFree+=n.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>fA?-1:(new Int32Array(this.module.heap32.buffer,s,n.length).set(n),s)}createFloatArray(n){const s=this.memoryStackNextFree;return this.memoryStackNextFree+=n.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>fA?-1:(new Float32Array(this.module.heapF32.buffer,s,n.length).set(n),s)}readStringBuffer(n){let s="";for(;this.module.heapU8[n]!==0;)s+=String.fromCharCode(this.module.heapU8[n]),++n;return s}setStyle(n){const s=n.normalScale;this.module.setStyle(s[0],s[1],s[2],n.tileToMeters)}setAOOptions(n,s){this.module.setAOOptions(n?1:0,s)}setMetricOptions(n,s){this.module.setMetricOptions(n?1:0,s)}setStructuralOptions(n){this.module.setStructuralOptions(n?1:0)}setFacadeOptions(n,s){this.module.setFacadeOptions(n,s?1:0)}setFauxFacadeOptions(n,s,u){this.module.setFauxFacadeOptions(n?1:0,s?1:0,u)}setFacadeClassifierOptions(n){this.module.setFacadeClassifierOptions(n)}generateMesh(n,s){this.memoryStackNextFree=this.memoryStack;for(const x of n){const T=this.createIntArray(x.ringIndices),C=this.createFloatArray(x.coordinates);if(T===-1||C===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(x.id,x.sourceId,x.minHeight,x.height,x.roofType,C,T,x.ringIndices.length-1)}for(const x of s){let T;T=x.entrances?JSON.parse(x.entrances):[];const C=this.createFloatArray(T),R=this.createFloatArray(x.coordinates);if(C===-1||R===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(x.sourceId,x.crossPerc,x.distanceToRoad,C,T.length,R,x.coordinates.length)}if(!this.module.generateMesh()){const x=this.module.getLastError();return this.readStringBuffer(x)}const u=this.module.getMeshCount(),h=new Array(u);for(let x=0;x<u;x++){const T=this.module.getPositionsPtr(x),C=this.module.getPositionsLength(x),R=new Float32Array(this.module.heapF32.buffer,T,C),M=this.module.getNormalsPtr(x),D=this.module.getNormalsLength(x),O=new Float32Array(this.module.heapF32.buffer,M,D),j=this.module.getAOPtr(x),G=this.module.getAOLength(x),X=new Float32Array(this.module.heapF32.buffer,j,G),K=this.module.getUVPtr(x),se=this.module.getUVLength(x),ae=new Float32Array(this.module.heapF32.buffer,K,se),de=this.module.getFauxFacadePtr(x),ve=this.module.getFauxFacadeLength(x),me=new Uint8Array(this.module.heapU8.buffer,de,ve),Te=this.module.getIndicesPtr(x),Ie=this.module.getIndicesLength(x),Re=new Int16Array(this.module.heap16.buffer,Te,Ie),qe=this.module.getBuildingPart(x);h[x]={positions:R,normals:O,ao:X,uv:ae,isFauxFacade:me,indices:Re,buildingPart:qe}}const g=this.module.getRingCount(),_=[];for(let x=0;x<g;x++){const T=this.module.getRingPtr(x),C=this.module.getRingLength(x),R=new Float32Array(this.module.heapF32.buffer,T,C);_.push(R)}return{meshes:h,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:_}}}let Nx,pA,Ec,f_,mA,p_=null,m_=null,UO=null,jw=null;function $O(){return ei(self)&&self.worker.dracoUrl?self.worker.dracoUrl:pA||qn.DRACO_URL}function GO(){if(ei(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(f_)return f_;const a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return f_=WebAssembly.validate(a)?qn.MESHOPT_SIMD_URL:qn.MESHOPT_URL,f_}function SK(){return jw}const Bw={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},CK={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Lx={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function HO(a,n,s){const u=s.json.bufferViews.length,h=s.buffers.length;n.bufferView=u,s.json.bufferViews[u]={buffer:h,byteLength:a.byteLength},s.buffers[h]=a}const gA="KHR_draco_mesh_compression";function IK(a,n){const s=a.extensions&&a.extensions[gA];if(!s)return;const u=new Ec.Decoder,h=KO(n,s.bufferView),g=new Ec.Mesh;if(!u.DecodeArrayToMesh(h,h.byteLength,g))throw new Error("Failed to decode Draco mesh");const _=n.json.accessors[a.indices],x=Bw[_.componentType],T=_.count*x.BYTES_PER_ELEMENT,C=Ec._malloc(T);x===Uint16Array?u.GetTrianglesUInt16Array(g,T,C):u.GetTrianglesUInt32Array(g,T,C),HO(Ec.memory.buffer.slice(C,C+T),_,n),Ec._free(C);for(const R of Object.keys(s.attributes)){const M=u.GetAttributeByUniqueId(g,s.attributes[R]),D=n.json.accessors[a.attributes[R]],O=CK[D.componentType],j=D.count*Lx[D.type]*Bw[D.componentType].BYTES_PER_ELEMENT,G=Ec._malloc(j);u.GetAttributeDataArrayForAllPoints(g,M,Ec[O],j,G),HO(Ec.memory.buffer.slice(G,G+j),D,n),Ec._free(G)}u.destroy(),g.destroy(),delete a.extensions[gA]}const Vw="EXT_meshopt_compression";function AK(a,n){if(!a.extensions||!a.extensions[Vw])return;const s=a.extensions[Vw],u=new Uint8Array(n.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),h=new Uint8Array(s.count*s.byteStride);mA.decodeGltfBuffer(h,s.count,s.byteStride,u,s.mode,s.filter),a.buffer=n.buffers.length,a.byteOffset=0,n.buffers[a.buffer]=h.buffer,delete a.extensions[Vw]}const WO=1179937895,qO=new TextDecoder("utf8");function ZO(a,n){return new URL(a,n).href}function PK(a,n,s,u){return fetch(ZO(a.uri,u)).then(h=>h.arrayBuffer()).then(h=>{n.buffers[s]=h})}function KO(a,n){const s=a.json.bufferViews[n];return new Uint8Array(a.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function RK(a,n,s,u){if(a.uri){const h=ZO(a.uri,u);return fetch(h).then(g=>g.blob()).then(g=>createImageBitmap(g)).then(g=>{n.images[s]=g})}if(a.bufferView!==void 0){const h=KO(n,a.bufferView),g=new Blob([h],{type:a.mimeType});return createImageBitmap(g).then(_=>{n.images[s]=_})}}function XO(a,n=0,s){const u={json:null,images:[],buffers:[]};if(new Uint32Array(a,n,1)[0]===WO){const R=new Uint32Array(a,n);let M=2;const D=(R[M++]>>2)-3,O=R[M++]>>2;if(M++,u.json=JSON.parse(qO.decode(R.subarray(M,M+O))),M+=O,M<D){const j=R[M++];M++;const G=n+(M<<2);u.buffers[0]=a.slice(G,G+j)}}else u.json=JSON.parse(qO.decode(new Uint8Array(a,n)));const{buffers:h,images:g,meshes:_,extensionsUsed:x,bufferViews:T}=u.json;let C=Promise.resolve();if(h){const R=[];for(let M=0;M<h.length;M++){const D=h[M];D.uri?R.push(PK(D,u,M,s)):u.buffers[M]||(u.buffers[M]=null)}C=Promise.all(R)}return C.then(()=>{const R=[],M=x&&x.includes(gA),D=x&&x.includes(Vw);if(M&&R.push(function(){if(!Ec)return Nx??(Nx=function(O){let j,G=null;function X(){j=new Uint8Array(G.buffer)}function K(){throw new Error("Unexpected Draco error.")}const se={a:{a:K,d:function(ae,de,ve){return j.copyWithin(ae,de,de+ve)},c:function(ae){const de=j.length,ve=Math.max(ae>>>0,Math.ceil(1.2*de)),me=Math.ceil((ve-de)/65536);try{return G.grow(me),X(),!0}catch{return!1}},b:K}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(O,se):O.then(ae=>ae.arrayBuffer()).then(ae=>WebAssembly.instantiate(ae,se))).then(ae=>{const{Rb:de,Qb:ve,P:me,T:Te,X:Ie,Ja:Re,La:qe,Qa:Ne,Va:Qe,Wa:it,eb:rt,jb:ht,f:pt,e:ct,yb:ut,zb:Ye,Ab:Ze,Bb:dt,Db:Tt,Gb:yt}=ae.instance.exports;G=ct;const Yt=(()=>{let kt=0,Ot=0,Ut=0,jn=0;return vt=>{Ut&&(de(jn),de(kt),Ot+=Ut,Ut=kt=0),kt||(Ot+=128,kt=ve(Ot));const $t=vt.length+7&-8;let xn=kt;$t>=Ot&&(Ut=$t,xn=jn=ve($t));for(let Kn=0;Kn<vt.length;Kn++)j[xn+Kn]=vt[Kn];return xn}})();return X(),pt(),{memory:ct,_free:de,_malloc:ve,Mesh:class{constructor(){this.ptr=me()}destroy(){Te(this.ptr)}},Decoder:class{constructor(){this.ptr=Re()}destroy(){ht(this.ptr)}DecodeArrayToMesh(kt,Ot,Ut){const jn=Yt(kt),vt=qe(this.ptr,jn,Ot,Ut.ptr);return!!Ie(vt)}GetAttributeByUniqueId(kt,Ot){return{ptr:Ne(this.ptr,kt.ptr,Ot)}}GetTrianglesUInt16Array(kt,Ot,Ut){Qe(this.ptr,kt.ptr,Ot,Ut)}GetTrianglesUInt32Array(kt,Ot,Ut){it(this.ptr,kt.ptr,Ot,Ut)}GetAttributeDataArrayForAllPoints(kt,Ot,Ut,jn,vt){rt(this.ptr,kt.ptr,Ot.ptr,Ut,jn,vt)}},DT_INT8:ut(),DT_UINT8:Ye(),DT_INT16:Ze(),DT_UINT16:dt(),DT_UINT32:Tt(),DT_FLOAT32:yt()}})}(fetch($O())),Nx.then(O=>{Ec=O,Nx=void 0}))}()),D&&R.push(function(){if(mA)return;const O=function(j){let G;const X=WebAssembly.instantiateStreaming(j,{}).then(ae=>{G=ae.instance,G.exports.__wasm_call_ctors()}),K={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},se={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:X,supported:!0,decodeGltfBuffer(ae,de,ve,me,Te,Ie){(function(Re,qe,Ne,Qe,it,rt,ht){const pt=Re.exports.sbrk,ct=Qe+3&-4,ut=pt(ct*it),Ye=pt(rt.length),Ze=new Uint8Array(Re.exports.memory.buffer);Ze.set(rt,Ye);const dt=qe(ut,Qe,it,Ye,rt.length);if(dt===0&&ht&&ht(ut,ct,it),Ne.set(Ze.subarray(ut,ut+Qe*it)),pt(ut-pt(0)),dt!==0)throw new Error(`Malformed buffer data: ${dt}`)})(G,G.exports[se[Te]],ae,de,ve,me,G.exports[K[Ie]])}}}(fetch(GO()));return O.ready.then(()=>{mA=O})}()),g)for(let O=0;O<g.length;O++)R.push(RK(g[O],u,O,s));return(R.length?Promise.all(R):Promise.resolve()).then(()=>{if(M&&_)for(const{primitives:O}of _)for(const j of O)IK(j,u);if(D&&_&&T)for(const O of T)AK(O,u);return u})})}function YO(a){return fetch(a).then(n=>n.arrayBuffer()).then(n=>XO(n,0,a))}function _A(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function yA(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class vA{constructor(n,s,u,h){this.context=n,this.format=u,this.useMipmap=h&&h.useMipmap,this.texture=n.gl.createTexture(),this.update(s,{premultiply:h&&h.premultiply})}update(n,s){const u=n&&n instanceof HTMLVideoElement&&n.width===0?n.videoWidth:n.width,h=n&&n instanceof HTMLVideoElement&&n.height===0?n.videoHeight:n.height,{context:g}=this,{gl:_}=g,{x,y:T}=s&&s.position?s.position:{x:0,y:0},C=x+u,R=T+h;!this.size||this.size[0]===C&&this.size[1]===R||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!s||s.premultiply!==!1));const M=n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap;if(!this.size&&C>0&&R>0){const D=this.useMipmap?Math.floor(Math.log2(Math.max(C,R)))+1:1;_.texStorage2D(_.TEXTURE_2D,D,this.format,C,R),this.size=[C,R]}this.size&&(M?_.texSubImage2D(_.TEXTURE_2D,0,x,T,_A(this.format),yA(this.format),n):"data"in n&&n.data&&_.texSubImage2D(_.TEXTURE_2D,0,x,T,u,h,_A(this.format),yA(this.format),n.data)),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(n,s,u=!1){const{context:h}=this,{gl:g}=h;g.bindTexture(g.TEXTURE_2D,this.texture),n!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,n),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap&&!u?n===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),s!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,s),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(n,s,u,h,g){const{context:_}=this,{gl:x}=_;x.bindTexture(x.TEXTURE_2D,this.texture),s!==this.magFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,s),this.magFilter=s),n!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap?n===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),u!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,u),this.wrapS=u),h!==this.wrapT&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,h),this.wrapT=h),g!==this.compareMode&&(g?(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.COMPARE_REF_TO_TEXTURE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_FUNC,g)):x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.NONE),this.compareMode=g)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class Ox{constructor(n,s){this.context=n,this.texture=s}bind(n,s){const{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),n!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,n),this.minFilter=n),s!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrapS=s)}}const MK=Gn([{name:"a_pos_3f",components:3,type:"Float32"}]),kK=Gn([{name:"a_color_3f",components:3,type:"Float32"}]),DK=Gn([{name:"a_color_4f",components:4,type:"Float32"}]),NK=Gn([{name:"a_uv_2f",components:2,type:"Float32"}]),LK=Gn([{name:"a_normal_3f",components:3,type:"Float32"}]),OK=Gn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),FK=Gn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function QO(a,n){const s=Uw(a.projection,a.zoom,a.width,a.height),u=function(g,_,x,T,C){const R=new c(x.lng-180*Lh,x.lat),M=new c(x.lng+180*Lh,x.lat),D=g.project(R.lng,R.lat),O=g.project(M.lng,M.lat),j=-Math.atan2(O.y-D.y,O.x-D.x),G=le.fromLngLat(x);G.y=Y(G.y,-1+Lh,1-Lh);const X=G.toLngLat(),K=g.project(X.lng,X.lat),se=le.fromLngLat(X);se.x+=Lh;const ae=se.toLngLat(),de=g.project(ae.lng,ae.lat),ve=eF(de.x-K.x,de.y-K.y,j),me=le.fromLngLat(X);me.y+=Lh;const Te=me.toLngLat(),Ie=g.project(Te.lng,Te.lat),Re=eF(Ie.x-K.x,Ie.y-K.y,j),qe=Math.abs(ve.x)/Math.abs(Re.y),Ne=re([]);ze(Ne,Ne,-j*(1-(C?0:T)));const Qe=re([]);return ue(Qe,Qe,[1,1-(1-qe)*T,1]),Qe[4]=-Re.x/Re.y*T,ze(Qe,Qe,j),ee(Qe,Ne,Qe),Qe}(a.projection,0,a.center,s,n),h=JO(a);return ue(u,u,[h,h,1]),u}function JO(a){const n=a.projection,s=Uw(a.projection,a.zoom,a.width,a.height),u=xA(n,a.center),h=xA(n,c.convert(n.center));return Math.pow(2,u*s+(1-s)*h)}function Uw(a,n,s,u,h=1/0){const g=a.range;if(!g)return 0;const _=Math.min(h,Math.max(s,u)),x=Math.log2(_/1024);return oe(g[0]+x,g[1]+x,n)}const Lh=1/4e4;function xA(a,n){const s=Y(n.lat,-U,U),u=new c(n.lng-180*Lh,s),h=new c(n.lng+180*Lh,s),g=a.project(u.lng,s),_=a.project(h.lng,s),x=le.fromLngLat(u),T=le.fromLngLat(h),C=_.x-g.x,R=_.y-g.y,M=T.x-x.x,D=T.y-x.y,O=Math.sqrt((M*M+D*D)/(C*C+R*R));return Math.log2(O)}function eF(a,n,s){const u=Math.cos(s),h=Math.sin(s);return{x:a*u-n*h,y:a*h+n*u}}function tF(a,n,s){re(a),ze(a,a,$n(n[2])),xe(a,a,$n(n[0])),Oe(a,a,$n(n[1])),ue(a,a,s),ee(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function $w(a,n,s,u,h,g,_,x){const T=[s[0]-n[0],s[1]-n[1],0],C=[u[0]-n[0],u[1]-n[1],0];if(nn(T)<1e-12||nn(C)<1e-12)return zs(a);const R=si([],T,C);pn(R,R),Ct(C,u,n),T[2]=(g-h)*x,C[2]=(_-h)*x;const M=T;return si(M,T,C),pn(M,M),Il(a,R,M)}function Gw(a,n,s=!1){const u=Dh(n.zoom),h=function(g,_,x){const T=_.worldSize,C=[g[12],g[13],g[14]],R=V(C[1]/T),M=L(C[0]/T),D=re([]),O=k(1,R)*T,j=k(1,0)*T*W(R,_.zoom),G=1/KI(T);let X=j*G;if(x){const de=Uw(_.projection,_.zoom,_.width,_.height,1024);X=G*_.projection.pixelSpaceConversion(_.center.lat,T,de)}const K=Rh(R,M);et(K,K,gn([],pn([],K),O*X*C[2]));const se=function(de){const ve=[de[0],de[1],de[2]];let me=[0,1,0];const Te=si([],me,ve);return si(me,ve,Te),_n(me)===0&&(me=[0,1,0],si(Te,ve,me)),pn(Te,Te),pn(me,me),pn(ve,ve),[Te[0],Te[1],Te[2],0,me[0],me[1],me[2],0,ve[0],ve[1],ve[2],0,de[0],de[1],de[2],1]}(K);ue(D,D,[X,X,X*O]),ie(D,D,[-C[0],-C[1],-C[2]]);const ae=ee([],_.globeMatrix,se);return ee(ae,ae,D),ee(ae,ae,g),ae}(a,n,s);if(u>0){const g=function(_,x){const T=x.worldSize,C=k(1,0)*T*W(x.center.lat,x.zoom)/KI(T),R=k(1,x.center.lat)*T,M=re([]);Oe(M,M,$n(x.center.lng)),xe(M,M,$n(x.center.lat)),ie(M,M,[0,0,Ys]),ue(M,M,[C,C,C*R]);const D=x.point;return ie(M,M,[-D.x,-D.y,0]),ee(M,M,_),ee(M,x.globeMatrix,M)}(a,n);return function(_,x,T){const C=(j,G,X)=>{const K=nn(j),se=nn(G),ae=Tc(j,G,X);return gn(ae,ae,1/nn(ae)*fn(K,se,X))},R=C([_[0],_[1],_[2]],[x[0],x[1],x[2]],T),M=C([_[4],_[5],_[6]],[x[4],x[5],x[6]],T),D=C([_[8],_[9],_[10]],[x[8],x[9],x[10]],T),O=Tc([_[12],_[13],_[14]],[x[12],x[13],x[14]],T);return[R[0],R[1],R[2],0,M[0],M[1],M[2],0,D[0],D[1],D[2],0,O[0],O[1],O[2],1]}(h,g,u)}return h}function bA(a,n,s,u){const h=Ht.projectAabbCorners(u,s);let g=Number.MAX_VALUE;for(let x=0;x<h.length;++x){const T=h[x];T[0]=(.5*T[0]+.5)*n.width,T[1]=(.5-.5*T[1])*n.height,T[2]<g&&(g=T[2])}const _=function(x){const T=[];let C=0;for(let O=1;O<x.length;O++)(x[O][0]<x[C][0]||x[O][0]===x[C][0]&&x[O][1]<x[C][1])&&(C=O);let R,M=C;const D=new Uint8Array(x.length);do{if(D[M])break;T.push(new st(x[M][0],x[M][1])),D[M]=1,R=(M+1)%x.length;for(let O=0;O<x.length;O++){if(x[O][0]===x[R][0]&&x[O][1]===x[R][1]||x[O][0]===x[M][0]&&x[O][1]===x[M][1])continue;const j=[x[O][0]-x[M][0],x[O][1]-x[M][1]],G=[x[R][0]-x[M][0],x[R][1]-x[M][1]],X=j[0]*G[1]-j[1]*G[0];(X>0||X===0&&j[0]*G[0]+j[1]*G[1]>=0&&j[0]*j[0]+j[1]*j[1]>G[0]*G[0]+G[1]*G[1])&&(R=O)}M=R}while(M!==C);return T.length>0&&T.push(T[0]),T}(h);if(ci(a,_))return g}const $p=64,g_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Hw(a,n,s,u,h,g,_,x,T,C=!1){const R=s.zoom,M=s.project(u),D=W(u.lat,R),O=1/D;re(a),ie(a,a,[M.x+_[0]*O,M.y+_[1]*O,_[2]]);let j=1,G=1;const X=s.worldSize;if(C){if(s.projection.name==="mercator"){let de=0;s.elevation&&(de=s.elevation.getAtPointOrZero(new le(M.x/X,M.y/X),0));const ve=ks([],[M.x,M.y,de,1],s.projMatrix)[3]/s.cameraToCenterDistance;j=ve,G=ve*W(s.center.lat,R)}else if(s.projection.name==="globe"){const de=Gw(a,s),ve=[0,0,0,1];ks(ve,ve,ee([],s.projMatrix,de));const me=ve[3]/s.cameraToCenterDistance,Te=Dh(R),Ie=s.projection.pixelsPerMeter(u.lat,X)*W(u.lat,R),Re=s.projection.pixelsPerMeter(s.center.lat,X)*W(s.center.lat,R);j=me/fn(Ie,Z(s.center.lat),Te),G=me*D/Ie,j*=Re,G*=Re}}else j=O;ue(a,a,[j,j,G]);const K=[...a],se=n.orientation,ae=[];if(tF(ae,[se[0]+(h?h[0]:0),se[1]+(h?h[1]:0),se[2]+(h?h[2]:0)],g),ee(a,K,ae),x&&s.elevation){let de=0;const ve=[];if(T&&s.elevation){de=function(Te,Ie,Re,qe,Ne){const Qe=Ie.elevation;if(!Qe)return 0;const it=Ht.projectAabbCorners(Re,qe),rt=k(1,Ne.lat)*Ie.worldSize,ht=function(Ot,Ut){const jn=[0,0,1],vt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const $t of vt){const xn=Ot[$t.corners[0]],Kn=Ot[$t.corners[1]],Qn=Ot[$t.corners[2]],An=[Kn[0]-xn[0],Kn[1]-xn[1],Ut*(Kn[2]-xn[2])],ki=si(An,An,[Qn[0]-xn[0],Qn[1]-xn[1],Ut*(Qn[2]-xn[2])]);pn(ki,ki),$t.dotProductWithUp=Fn(ki,jn)}return vt.sort(($t,xn)=>$t.dotProductWithUp-xn.dotProductWithUp),vt[0].corners}(it,rt),pt=it[ht[0]],ct=it[ht[1]],ut=it[ht[2]],Ye=it[ht[3]],Ze=Qe.getAtPointOrZero(new le(pt[0]/Ie.worldSize,pt[1]/Ie.worldSize),0),dt=Qe.getAtPointOrZero(new le(ct[0]/Ie.worldSize,ct[1]/Ie.worldSize),0),Tt=Qe.getAtPointOrZero(new le(ut[0]/Ie.worldSize,ut[1]/Ie.worldSize),0),yt=Qe.getAtPointOrZero(new le(Ye[0]/Ie.worldSize,Ye[1]/Ie.worldSize),0),Yt=(Ze+yt)/2,kt=(dt+Tt)/2;return Yt>kt?dt<Tt?$w(Te,ct,Ye,pt,dt,yt,Ze,rt):$w(Te,ut,pt,Ye,Tt,Ze,yt,rt):Ze<yt?$w(Te,pt,ct,ut,Ze,dt,Tt,rt):$w(Te,Ye,ut,ct,yt,Tt,dt,rt),Math.max(Yt,kt)}(ve,s,n.aabb,a,u);const me=ee([],Zt([],ve),ae);ee(a,K,me)}else de=s.elevation.getAtPointOrZero(new le(M.x/X,M.y/X),0);de!==0&&(a[14]+=de)}}class nF{constructor(n,s,u,h,g){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=n,this.uri=s,this.position=u!=null?new c(u[0],u[1]):new c(0,0),this.orientation=h??[0,0,0],this.nodes=g,this.uploaded=!1,this.aabb=new Ht([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(n,s){ee(n.globalMatrix,s,n.localMatrix);const u=this.nodeOverrides.get(n.name);if(u!==void 0){const _=[];g=u.orientation,re(h=_),Oe(h,h,$n(g[1])),ze(h,h,$n(g[2])),xe(h,h,$n(g[0])),ee(n.globalMatrix,n.globalMatrix,_)}var h,g;if(n.meshes)for(const _ of n.meshes){const x=Ht.applyTransformFast(_.aabb,n.globalMatrix);this.aabb.encapsulate(x)}if(n.children)for(const _ of n.children)this._applyTransformations(_,n.globalMatrix)}computeBoundsAndApplyParent(){const n=re([]);this.aabb=new Ht([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.nodes)this._applyTransformations(s,n)}computeModelMatrix(n,s,u,h,g,_,x=!1){Hw(this.matrix,this,n.transform,this.position,s,u,h,g,_,x)}upload(n){if(!this.uploaded){for(const s of this.nodes)wA(s,n);for(const s of this.nodes)Ww(s);this.uploaded=!0}}destroy(){for(const n of this.nodes)TA(n)}}function Fx(a,n,s=!1){a.uploaded||(a.gfxTexture=new vA(n,a.image,s?n.gl.R8:n.gl.RGBA8,{useMipmap:a.sampler.minFilter>=n.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function zK(a,n,s){a.indexBuffer=n.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=n.createVertexBuffer(a.vertexArray,MK.members,!1,!0),a.normalArray&&(a.normalBuffer=n.createVertexBuffer(a.normalArray,LK.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=n.createVertexBuffer(a.texcoordArray,NK.members,!1,!0)),a.colorArray&&(a.colorBuffer=n.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?kK:DK).members,!1,!0)),a.featureArray&&(a.pbrBuffer=n.createVertexBuffer(a.featureArray,FK.members,!0)),a.segments=dr.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);const u=a.material;u.pbrMetallicRoughness.baseColorTexture&&Fx(u.pbrMetallicRoughness.baseColorTexture,n),u.pbrMetallicRoughness.metallicRoughnessTexture&&Fx(u.pbrMetallicRoughness.metallicRoughnessTexture,n),u.normalTexture&&Fx(u.normalTexture,n),u.occlusionTexture&&Fx(u.occlusionTexture,n,s),u.emissionTexture&&Fx(u.emissionTexture,n)}function wA(a,n,s){if(a.meshes)for(const u of a.meshes)zK(u,n,s);if(a.children)for(const u of a.children)wA(u,n,s)}function Ww(a){if(a.meshes)for(const n of a.meshes)n.indexArray.destroy(),n.vertexArray.destroy(),n.colorArray&&n.colorArray.destroy(),n.normalArray&&n.normalArray.destroy(),n.texcoordArray&&n.texcoordArray.destroy(),n.featureArray&&n.featureArray.destroy();if(a.children)for(const n of a.children)Ww(n)}function TA(a){if(a.meshes)for(const s of a.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((n=s.material).pbrMetallicRoughness.baseColorTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),n.pbrMetallicRoughness.metallicRoughnessTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),n.normalTexture&&n.normalTexture.gfxTexture&&n.normalTexture.gfxTexture.destroy(),n.emissionTexture&&n.emissionTexture.gfxTexture&&n.emissionTexture.gfxTexture.destroy(),n.occlusionTexture&&n.occlusionTexture.gfxTexture&&n.occlusionTexture.gfxTexture.destroy()));var n;if(a.children)for(const s of a.children)TA(s)}function Gp(a,n){const s=a.json.bufferViews[n.bufferView],u=Bw[n.componentType];return new u(a.buffers[s.buffer],(n.byteOffset||0)+(s.byteOffset||0),n.count*(s.byteStride&&s.byteStride!==Lx[n.type]*u.BYTES_PER_ELEMENT?s.byteStride/u.BYTES_PER_ELEMENT:Lx[n.type]))}function EA(a,n,s,u){const h=Bw[n.componentType],g=function(R){switch(R){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),_=a.json.bufferViews[n.bufferView],x=_.byteStride?_.byteStride/h.BYTES_PER_ELEMENT:Lx[n.type],T=s.float32,C=T.length/s.capacity;for(let R=0,M=0;R<n.count*x;R+=x,M+=C)for(let D=0;D<C;D++)T[M+D]=u[R+D]*g;s._trim()}function jK(a,n,s){const u=a.indices,h=a.attributes,g={};g.indexArray=new Jr;const _=n.json.accessors[u],x=_.count/3;g.indexArray.reserve(x);const T=Gp(n,_);for(let D=0;D<x;D++)g.indexArray.emplaceBack(T[3*D],T[3*D+1],T[3*D+2]);g.indexArray._trim(),g.vertexArray=new oa;const C=n.json.accessors[h.POSITION];g.vertexArray.reserve(C.count);const R=Gp(n,C);for(let D=0;D<C.count;D++)g.vertexArray.emplaceBack(R[3*D],R[3*D+1],R[3*D+2]);if(g.vertexArray._trim(),g.aabb=new Ht(C.min,C.max),g.centroid=function(D,O){const j=[0,0,0],G=D.length;if(G>0){for(let X=0;X<G;X++){const K=3*D[X];j[0]+=O[K],j[1]+=O[K+1],j[2]+=O[K+2]}j[0]/=G,j[1]/=G,j[2]/=G}return j}(T,R),h.COLOR_0!==void 0){const D=n.json.accessors[h.COLOR_0],O=Lx[D.type],j=Gp(n,D);g.colorArray=O===3?new oa:new Su,g.colorArray.resize(D.count),EA(n,D,g.colorArray,j)}if(h.NORMAL!==void 0){g.normalArray=new oa;const D=n.json.accessors[h.NORMAL];g.normalArray.resize(D.count);const O=Gp(n,D);EA(n,D,g.normalArray,O)}if(h.TEXCOORD_0!==void 0&&s.length>0){g.texcoordArray=new Bl;const D=n.json.accessors[h.TEXCOORD_0];g.texcoordArray.resize(D.count);const O=Gp(n,D);EA(n,D,g.texcoordArray,O)}if(h._FEATURE_ID_RGBA4444!==void 0){const D=n.json.accessors[h._FEATURE_ID_RGBA4444];n.json.extensionsUsed&&n.json.extensionsUsed.includes("EXT_meshopt_compression")&&(g.featureData=Gp(n,D))}h._FEATURE_RGBA4444!==void 0&&(g.featureData=new Uint32Array(Gp(n,n.json.accessors[h._FEATURE_RGBA4444]).buffer));const M=a.material;return g.material=function(D,O){const{emissiveFactor:j=[0,0,0],alphaMode:G="OPAQUE",alphaCutoff:X=.5,normalTexture:K,occlusionTexture:se,emissiveTexture:ae,doubleSided:de,name:ve}=D,{baseColorFactor:me=[1,1,1,1],metallicFactor:Te=1,roughnessFactor:Ie=1,baseColorTexture:Re,metallicRoughnessTexture:qe}=D.pbrMetallicRoughness||{},Ne=se?O[se.index]:void 0;if(se&&se.extensions&&se.extensions.KHR_texture_transform&&Ne){const Qe=se.extensions.KHR_texture_transform;Ne.offsetScale=[Qe.offset[0],Qe.offset[1],Qe.scale[0],Qe.scale[1]]}return{name:ve,pbrMetallicRoughness:{baseColorFactor:new Si(...me),metallicFactor:Te,roughnessFactor:Ie,baseColorTexture:Re?O[Re.index]:void 0,metallicRoughnessTexture:qe?O[qe.index]:void 0},doubleSided:de,emissiveFactor:new Si(...j),alphaMode:G,alphaCutoff:X,normalTexture:K?O[K.index]:void 0,occlusionTexture:Ne,emissionTexture:ae?O[ae.index]:void 0,defined:D.defined===void 0}}(M!==void 0?n.json.materials[M]:{defined:!1},s),g}function iF(a,n,s){const{matrix:u,rotation:h,translation:g,scale:_,mesh:x,extras:T,children:C,name:R}=a,M={};if(M.name=R,M.localMatrix=u||function(D,O,j,G){var X=O[0],K=O[1],se=O[2],ae=O[3],de=X+X,ve=K+K,me=se+se,Te=X*de,Ie=X*ve,Re=X*me,qe=K*ve,Ne=K*me,Qe=se*me,it=ae*de,rt=ae*ve,ht=ae*me,pt=G[0],ct=G[1],ut=G[2];return D[0]=(1-(qe+Qe))*pt,D[1]=(Ie+ht)*pt,D[2]=(Re-rt)*pt,D[3]=0,D[4]=(Ie-ht)*ct,D[5]=(1-(Te+Qe))*ct,D[6]=(Ne+it)*ct,D[7]=0,D[8]=(Re+rt)*ut,D[9]=(Ne-it)*ut,D[10]=(1-(Te+qe))*ut,D[11]=0,D[12]=j[0],D[13]=j[1],D[14]=j[2],D[15]=1,D}([],h||[0,0,0,1],g||[0,0,0],_||[1,1,1]),M.globalMatrix=H(M.localMatrix),x!==void 0){M.meshes=s[x];const D=M.anchor=[0,0];for(const O of M.meshes){const{min:j,max:G}=O.aabb;D[0]+=j[0]+G[0],D[1]+=j[1]+G[1]}D[0]=Math.floor(D[0]/M.meshes.length/2),D[1]=Math.floor(D[1]/M.meshes.length/2)}if(T&&(T.id&&(M.id=T.id),T.lights&&(M.lights=function(D){if(!D.length)return[];const O=function(se){const ae=atob(se),de=new Uint8Array(ae.length);for(let ve=0;ve<ae.length;ve++)de[ve]=ae.codePointAt(ve);return de}(D),j=[],G=O.length/24,X=new Uint16Array(O.buffer),K=new Float32Array(O.buffer);for(let se=0;se<G;se++){const ae=X[2*se*6]/30,de=X[2*se*6+1]/30,ve=X[2*se*6+10]/100,me=K[6*se+1],Te=K[6*se+2],Ie=K[6*se+3],Re=K[6*se+4],qe=Ie-me,Ne=Re-Te,Qe=Math.hypot(qe,Ne);j.push({pos:[me+.5*qe,Te+.5*Ne,de],normal:[Ne/Qe,-qe/Qe,0],width:Qe,height:ae,depth:ve,points:[me,Te,Ie,Re]})}return j}(T.lights)),T.MAPBOX_geometry_bloom&&(M.isGeometryBloom=T.MAPBOX_geometry_bloom)),C){const D=[];for(const O of C)D.push(iF(n.json.nodes[O],n,s));M.children=D}return M}function BK(a){if(a.vertices.length===0||a.indices.length===0)return null;const n=new kw(a.vertices,a.indices,8,256),[s,u]=[n.min.clone(),n.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:n,min:s,max:u}}function VK(a){if(!a.extras||!a.extras.ground)return null;const n=a.extras.ground;if(!n||!Array.isArray(n)||n.length===0)return null;const s=n[0];if(!s||!Array.isArray(s)||s.length===0)return null;const u=[];for(const _ of s){if(!Array.isArray(_)||_.length!==2)continue;const x=_[0],T=_[1];typeof x=="number"&&typeof T=="number"&&u.push(new st(x,T))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let h=0;for(let _=0;_<u.length;_++){const x=u[_],T=u[(_+1)%u.length],C=u[(_+2)%u.length];h+=(x.x-T.x)*(C.y-T.y)-(C.x-T.x)*(x.y-T.y)}h>0&&u.reverse();const g=u_(u.flatMap(_=>[_.x,_.y]),[]);return g.length===0?null:{vertices:u,indices:g}}function UK(a,n){const s=[],u=[];let h=0;const g=[];for(const _ of a){h=s.length;const x=_.vertexArray.float32,T=_.indexArray.uint16;for(let C=0;C<_.vertexArray.length;C++)g[0]=x[3*C+0],g[1]=x[3*C+1],g[2]=x[3*C+2],Mi(g,g,n),s.push(new st(g[0],g[1]));for(let C=0;C<3*_.indexArray.length;C++)u.push(T[C]+h)}if(u.length%3!=0)return null;for(let _=0;_<u.length;_+=3){const x=s[u[_+0]],T=s[u[_+1]],C=s[u[_+2]];(x.x-T.x)*(C.y-T.y)-(C.x-T.x)*(x.y-T.y)>0&&([u[_+1],u[_+2]]=[u[_+2],u[_+1]])}return{vertices:s,indices:u}}function SA(a){const n=function(T,C){const R=[],M=WebGL2RenderingContext;if(T.json.textures)for(const D of T.json.textures){const O={magFilter:M.LINEAR,minFilter:M.NEAREST,wrapS:M.REPEAT,wrapT:M.REPEAT};D.sampler!==void 0&&Object.assign(O,T.json.samplers[D.sampler]),R.push({image:C[D.source],sampler:O,uploaded:!1})}return R}(a,a.images),s=function(T,C){const R=[];for(const M of T.json.meshes){const D=[];for(const O of M.primitives)D.push(jK(O,T,C));R.push(D)}return R}(a,n),{scenes:u,scene:h,nodes:g}=a.json,_=u?u[h||0].nodes:[...g.keys()],x=[];for(const T of _)x.push(iF(g[T],a,s));return function(T,C,R){const M={},D=new Set;for(let O=0;O<T.length;O++){const j=R[C[O]];if(!j.extras)continue;const G=j.extras["mapbox:footprint:version"],X=j.extras["mapbox:footprint:id"];(G||X)&&D.add(O),G==="1.0.0"&&X&&(M[X]=O)}for(let O=0;O<T.length;O++){if(D.has(O))continue;const j=T[O],G=R[C[O]];if(!G.extras)continue;let X=null;j.id in M&&(X=UK(T[M[j.id]].meshes,j.localMatrix)),X||(X=VK(G)),X&&(j.footprint=BK(X))}if(D.size>0){const O=Array.from(D.values()).sort((j,G)=>j-G);for(let j=O.length-1;j>=0;j--)T.splice(O[j],1)}}(x,_,a.json.nodes),x}function $K(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);const n=a.vertexArray.float32,s=a.aabb.min[0]-1,u=a.aabb.min[1]-1,h=$p/(a.aabb.max[0]-s+2),g=$p/(a.aabb.max[1]-u+2);for(let _=0;_<n.length;_+=3){const x=n[_+2],T=(n[_+0]-s)*h|0,C=(n[_+1]-u)*g|0;x>a.heightmap[C*$p+T]&&(a.heightmap[C*$p+T]=x)}}function rF(a,n,s,u,h){s.reserve(s.length+4*a.length),u.reserve(u.length+10*a.length),h.reserve(h.length+10*a.length);let g=u.length;for(const _ of a){const x=Math.min(10,Math.max(4,1.3*_.height))*n,T=[-_.normal[1],_.normal[0],0],C=Math.min(.29,.1*_.width/_.depth),R=_.width-2*_.depth*n*(C+.01),M=qt([],_.pos,T,R/2),D=qt([],_.pos,T,-R/2),O=[M[0],M[1],M[2]+_.height],j=[D[0],D[1],D[2]+_.height],G=qt([],_.normal,T,C);gn(G,G,x);const X=qt([],_.normal,T,-C);gn(X,X,x),et(G,M,G),et(X,D,X),M[2]+=.1,D[2]+=.1,u.emplaceBack(G[0],G[1],G[2]),u.emplaceBack(X[0],X[1],X[2]),u.emplaceBack(M[0],M[1],M[2]),u.emplaceBack(D[0],D[1],D[2]),u.emplaceBack(O[0],O[1],O[2]),u.emplaceBack(j[0],j[1],j[2]),u.emplaceBack(M[0],M[1],M[2]),u.emplaceBack(D[0],D[1],D[2]),u.emplaceBack(G[0],G[1],G[2]),u.emplaceBack(X[0],X[1],X[2]);const K=R/x/2;h.emplaceBack(-K-C,-1,K,.8),h.emplaceBack(K+C,-1,K,.8),h.emplaceBack(-K,0,K,1.3),h.emplaceBack(K,0,K,1.3),h.emplaceBack(K+C,-.8,K,.7),h.emplaceBack(K+C,-.8,K,.7),h.emplaceBack(0,0,K,1.3),h.emplaceBack(0,0,K,1.3),h.emplaceBack(K+C,-1.2,K,.8),h.emplaceBack(K+C,-1.2,K,.8),s.emplaceBack(6+g,4+g,8+g),s.emplaceBack(7+g,9+g,5+g),s.emplaceBack(0+g,1+g,2+g),s.emplaceBack(1+g,3+g,2+g),g+=10}}function GK(a,n){const s={};s.indexArray=new Jr,s.vertexArray=new oa,s.colorArray=new Su,rF(a,n,s.indexArray,s.vertexArray,s.colorArray);const u={defined:!0};u.emissiveFactor=Si.black;const h={};return h.baseColorFactor=Si.white,u.pbrMetallicRoughness=h,s.material=u,s.aabb=new Ht([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}const sF=Gn([{name:"a_pos_3f",components:3,type:"Float32"}]),HK=Gn([{name:"a_normal_3",components:3,type:"Int16"}]),WK=Gn([{name:"a_centroid_3",components:3,type:"Int16"}]),oF=Gn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),qK=Gn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),ZK=Gn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),KK=Gn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),XK=Gn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),YK=Gn([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),aF=Me.types,qw=32767;function QK(a,n){const s=wt+n;for(const u of a)for(const h of u)if(h.x<-n||h.x>s||h.y<-n||h.y>s)return!1;return!0}function JK(a){switch(a){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${a}`)}}class CA{constructor(){this.layoutVertexArray=new oa,this.layoutAttenuationArray=new Su,this.layoutColorArray=new aa,this.indexArray=new Jr,this.indexArrayForConflation=new Jr,this.segmentsBucket=new dr}}class IA{constructor(n){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new dr,this.entranceBloom=new CA;const s=66560;this.layoutVertexArray=new oa,this.layoutVertexArray.reserve(s),this.layoutNormalArray=new Eh,this.layoutNormalArray.reserve(s),this.layoutCentroidArray=new Eh,this.layoutCentroidArray.reserve(s),this.layoutColorArray=new aa,this.layoutColorArray.reserve(s),this.layoutFloodLightDataArray=new Cu,this.layoutFloodLightDataArray.reserve(s),this.layoutAOArray=new Qg,this.layoutAOArray.reserve(s),this.indexArray=new Jr,this.indexArray.reserve(66560),this.indexArrayForConflation=new Jr,this.segmentsBucket=new dr,this.entranceBloom=new CA,n&&(this.layoutFacadePaintArray=new aa,this.layoutFacadeDataArray=new Td,this.layoutFacadeVerticalRangeArray=new aa)}reserve(n,s,u){this.layoutVertexArray.reserveForAdditional(n),this.layoutCentroidArray.reserveForAdditional(n),this.layoutFloodLightDataArray.reserveForAdditional(n),this.layoutNormalArray.reserveForAdditional(n),this.layoutAOArray.reserveForAdditional(n),this.layoutColorArray.reserveForAdditional(n),this.indexArray.reserveForAdditional(s),u&&(this.layoutFacadePaintArray.reserveForAdditional(n),this.layoutFacadeDataArray.reserveForAdditional(n),this.layoutFacadeVerticalRangeArray.reserveForAdditional(n))}}class lF{constructor(n){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Bl,this.footprintsIndices=new Cu,this.footprintsMin=new st(1/0,1/0),this.footprintsMax=new st(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new IA(!1),this.buildingWithFacade=new IA(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=n.zoom,this.canonical=n.canonical,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.hasPattern=!1,this.worldview=n.worldview,this.lut=n.lut,this.programConfigurations=new dl(n.layers,{zoom:n.zoom,lut:n.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=n.projection,this.groundEffect=new cA(n),this.groundEffect.groundRadiusArray=new gc,this.hasAppearances=null}updateFootprints(n,s){const u=new kw([],[],1),h={vertices:[],indices:new Uint32Array(0),grid:u,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};s.push({footprint:h,id:n})}updateAppearances(n,s,u,h){}prepare(){return function(){if(jw!=null||UO!=null)return null;if(m_!=null)return m_;const n=fetch(qn.BUILDING_GEN_URL);return m_=function(s){let u,h,g,_,x;function T(){u=new Uint8Array(x.buffer),h=new Int16Array(x.buffer),g=new Int32Array(x.buffer),_=new Float32Array(x.buffer)}function C(){throw new Error("Unexpected BuildingGen error.")}const R=()=>{},M={a:{a:C,f:function(D){const O=u.length,j=Math.max(D>>>0,Math.ceil(1.2*O)),G=Math.ceil((j-O)/65536);try{return x.grow(G),T(),!0}catch{return!1}},g:C,b:R,c:R,d:R,e:R}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(s,M):s.then(D=>D.arrayBuffer()).then(D=>WebAssembly.instantiate(D,M))).then(D=>{const O=D.instance.exports;return(0,O.g)(),x=O.f,T(),new EK({setStyle:O.h,setAOOptions:O.i,setMetricOptions:O.j,setStructuralOptions:O.k,setFacadeOptions:O.l,setFauxFacadeOptions:O.m,setFacadeClassifierOptions:O.n,addFeature:O.o,addFacade:O.p,generateMesh:O.q,getLastError:O.r,getOuterRingLength:O.s,getMeshCount:O.t,getPositionsPtr:O.u,getPositionsLength:O.v,getNormalsPtr:O.w,getNormalsLength:O.x,getAOPtr:O.y,getAOLength:O.z,getUVPtr:O.A,getUVLength:O.B,getFauxFacadePtr:O.C,getFauxFacadeLength:O.D,getIndicesPtr:O.E,getIndicesLength:O.F,getBuildingPart:O.G,getRingCount:O.H,getRingPtr:O.I,getRingLength:O.J,malloc:O.K,free:O.L,heapU8:u,heap16:h,heap32:g,heapF32:_})})}(n).then(s=>(m_=null,jw=s,jw)).catch(s=>{Nt("Could not load building-gen"),m_=null,UO=s}),m_}()}populate(n,s,u,h){const g=SK();if(!g)return;const _=te(u);this.tileToMeter=_,this.brightness=s.brightness,g.setStyle({normalScale:[1,-1,_],tileToMeters:_}),g.setAOOptions(!1,.3),g.setMetricOptions(!1,16),g.setStructuralOptions(!0),g.setFacadeClassifierOptions(3);const x=new Map,T=new Map;let C=0;for(const{feature:K}of n){if(aF[K.type]!=="LineString"){x.set(K.id,K.properties.source_id);continue}const se=this.layers[0]._featureFilter.needGeometry;if(se&&!this.layers[0]._featureFilter.filter(new Wi(this.zoom),K,u))continue;const ae=De(K,se);if(!se&&!this.layers[0]._featureFilter.filter(new Wi(this.zoom),ae,u))continue;const de=se?ae.geometry:Se(K,u,h),ve=[];for(const Re of de)for(const qe of Re)ve.push(qe.x),ve.push(qe.y);const me={coordinates:ve,crossPerc:K.properties.cross_perc,distanceToRoad:K.properties.distance_to_road,entrances:K.properties.entrances,sourceId:0},Te=K.properties.source_id;let Ie=T.get(Te);Ie||(Ie=[],T.set(Te,Ie)),Ie.push(me),++C}this.maxHeight=0;const R=new Array,M=new Set,D=K=>{K!=null&&M.add(K)},O=(K,se)=>{K!=null&&R.push({buildingId:K,footprintIndex:se})},j=64*(n.length-C),G=j/2;this.buildingWithFacade.reserve(j,G,!0),this.buildingWithoutFacade.reserve(2*j,2*G,!1),this.footprintsIndices.reserve(16*(n.length-C)),this.footprintsVertices.reserve(8*(n.length-C));for(const{feature:K,id:se,index:ae,sourceLayerIndex:de}of n){if(aF[K.type]==="LineString")continue;const ve=this.layers[0]._featureFilter.needGeometry;if(ve&&!this.layers[0]._featureFilter.filter(new Wi(this.zoom),K,u))continue;let me=null;if(K.properties&&K.properties.hasOwnProperty("building_id")&&(me=K.properties.building_id,M.has(me)))continue;const Te=De(K,ve);if(!ve&&!this.layers[0]._featureFilter.filter(new Wi(this.zoom),Te,u))continue;const Ie=ve?Te.geometry:Se(K,u,h),Re=Cx(Ie,500);let qe=!1;for(const un of Re)if(un.length!==1){qe=!0;break}if(qe){D(me);continue}if(!QK(Ie,163)){D(me);continue}const Ne=this.layers[0],Qe=JK(Ne.layout.get("building-roof-shape").evaluate(K,{},u)),it=Ne.layout.get("building-base").evaluate(K,{},u),rt=Ne.layout.get("building-height").evaluate(K,{},u),ht=Ne.layout.get("building-flood-light-ground-radius").evaluate(K,{},u),pt=Ne.paint.get("building-ambient-occlusion-intensity"),ct=ht/this.tileToMeter;K.properties["building-part"]="roof";const ut=Ne.paint.get("building-color").evaluate(K,{},this.canonical).toPremultipliedRenderColor(this.lut),Ye=Ne.paint.get("building-emissive-strength").evaluate(K,{},this.canonical);K.properties["building-part"]="wall";const Ze=Ne.paint.get("building-color").evaluate(K,{},this.canonical).toPremultipliedRenderColor(this.lut),dt=Ne.paint.get("building-emissive-strength").evaluate(K,{},this.canonical);K.properties["building-part"]="window";const Tt=Ne.paint.get("building-color").evaluate(K,{},this.canonical).toPremultipliedRenderColor(this.lut),yt=Ne.paint.get("building-emissive-strength").evaluate(K,{},this.canonical);K.properties["building-part"]="door";const Yt=Ne.paint.get("building-color").evaluate(K,{},this.canonical).toPremultipliedRenderColor(this.lut),kt=Ne.paint.get("building-emissive-strength").evaluate(K,{},this.canonical);let Ot=Ne.layout.get("building-flood-light-wall-radius").evaluate(K,{},u);Ot=Y(Ot,0,2048);const Ut=Ot/2048*qw,jn=x.get(se),vt=T.get(jn)||[],$t=vt.length!==0&&Ne.layout.get("building-facade").evaluate(K,{},u);g.setFacadeOptions(4,!0),g.setFauxFacadeOptions($t,!1,1);let xn=0,Kn=0,Qn=0,An=0,ki=0,ge=0,be=0,Je=0,ft=0,At=0,Pt=0;if($t){let un=Math.round(Ne.layout.get("building-facade-floors").evaluate(K,{},u));if(it===0){un=Math.max(1,un-(vt.length>0?1:0));let Ai=4;if(rt>100){const rr=[10,13,15];Ai=rr[K.id?K.id%rr.length:0]}else rt<=10&&(Ai=3);g.setFacadeOptions(Ai,!0),ki=(rt<15?1.3:1.61803)*Ai/_}else ki=it/_;ge=rt/_,ki=Math.min(ki,ge),Qn=Ne.layout.get("building-facade-unit-width").evaluate(K,{},u)/_,An=(ge-ki)/un,g.setFauxFacadeOptions(!0,!0,Qn);const pr=Ne.layout.get("building-facade-window").evaluate(K,{},u);xn=pr[0],Kn=pr[1],be=Math.floor(65535*Math.min(1,ki/wt)),Je=Math.floor(65535*Math.min(1,ge/wt)),ft=Math.floor(255*xn)<<8|Math.floor(255*Kn),At=Math.floor(65535*Math.min(1,Qn/wt)),Pt=Math.floor(65535*Math.min(1,An/wt))}const Qt=Array(Re.length),tn={x:1/0,y:1/0},Cn={x:-1/0,y:-1/0},Ln={x:0,y:0};let zn=0;for(let un=0;un<Re.length;un++){const pr=Re[un];if(pr.length>0){const Ai=[],rr=Array(pr.length+1);rr[0]=0;for(let ns=0;ns<pr.length;ns++){const vs=pr[ns];for(let Hr=0;Hr<vs.length;Hr++){const Wr=vs[vs.length-Hr-1];tn.x=Math.min(tn.x,Wr.x),tn.y=Math.min(tn.y,Wr.y),Cn.x=Math.max(Cn.x,Wr.x),Cn.y=Math.max(Cn.y,Wr.y),Ln.x+=Wr.x,Ln.y+=Wr.y,zn++,Ai.push(Wr.x),Ai.push(Wr.y)}rr[ns+1]=Ai.length}Qt[un]={id:K.id?K.id:0,height:rt,minHeight:it,sourceId:0,roofType:Qe,coordinates:Ai,ringIndices:rr}}}Ln.x/=zn||1,Ln.y/=zn||1;const Hn=g.generateMesh(Qt,vt);if(typeof Hn=="string"){Nt(`Unable to generate building ${K.id}: ${Hn}`),D(me);continue}if(Hn.meshes.length===0||Hn.modifiedPolygonRings.length===0){D(me);continue}const dn=$t?this.buildingWithFacade:this.buildingWithoutFacade;let vn=0;for(const un of Hn.meshes)vn+=un.positions.length/3;const oi=dn.segmentsBucket.prepareSegment(vn,dn.layoutVertexArray,dn.indexArray),di=[];let hi=null,Ii=0,ji=-1;const Di=dn.layoutVertexArray.length,pi=Di+vn;dn.layoutVertexArray.resize(pi),dn.layoutCentroidArray.resize(pi),dn.layoutNormalArray.resize(pi),dn.layoutAOArray.resize(pi),dn.layoutColorArray.resize(pi),dn.layoutFloodLightDataArray.resize(pi),$t&&(dn.layoutFacadePaintArray.resize(pi),dn.layoutFacadeDataArray.resize(pi),dn.layoutFacadeVerticalRangeArray.resize(pi));const vi=dn.indexArray.length;let On=0,Yn=Di;for(const un of Hn.meshes){let pr,Ai;if(un.buildingPart===1)pr=ut,Ai=Ye;else if(un.buildingPart===0)pr=Ze,Ai=dt;else if(un.buildingPart===2)pr=Tt,Ai=yt;else{if(un.buildingPart!==3)continue;pr=Yt,Ai=kt}if(Ai=Y(Ai,0,1),un.buildingPart===3){const Hi=new Array;for(let is=0;is<un.positions.length;is+=12){const Gl=un.positions[is+0],Mu=un.positions[is+1],Us=un.positions[is+3],wo=un.positions[is+4],da=un.positions[is+2],jh=un.positions[is+8]-da,P_=1,Pc=Us-Gl,Rc=wo-Mu,a0=Math.hypot(Pc,Rc);Hi.push({pos:[Gl+.5*Pc,Mu+.5*Rc,da],normal:[Rc/a0,-Pc/a0,0],width:a0,height:jh,depth:P_,points:[Gl,Mu,Us,wo]})}const Pr=dn.entranceBloom.segmentsBucket.prepareSegment(10*Hi.length,dn.entranceBloom.layoutVertexArray,dn.entranceBloom.indexArray),Or=dn.entranceBloom.layoutVertexArray.length;Ii=dn.entranceBloom.indexArray.length,rF(Hi,.5/this.tileToMeter,dn.entranceBloom.indexArray,dn.entranceBloom.layoutVertexArray,dn.entranceBloom.layoutAttenuationArray);const Wo=dn.entranceBloom.layoutVertexArray.length-Or;ji=dn.entranceBloom.indexArray.length-Ii;for(let is=0;is<Wo;is++)dn.entranceBloom.layoutColorArray.emplaceBack(255*Yt.r<<8|255*Yt.g,255*Yt.b<<8|51*kt);Pr.vertexLength+=Wo,Pr.primitiveLength+=ji,hi={part:un.buildingPart,vertexOffset:Or,vertexLength:Wo}}dn.layoutVertexArray.float32.set(un.positions,3*Yn);const rr=un.positions.length/3;for(let Hi=0;Hi<rr;++Hi){const Pr=3*Hi;On=Math.max(On,un.positions[Pr+2]);const Or=un.normals[Pr+1]*qw,Wo=un.normals[Pr+2]*qw,is=3*(Yn+Hi);dn.layoutNormalArray.int16[is]=un.normals[Pr]*qw,dn.layoutNormalArray.int16[is+1]=Or,dn.layoutNormalArray.int16[is+2]=Wo;const Gl=un.ao[Hi];dn.layoutAOArray.uint8[Yn+Hi]=255*Gl;const Mu=1+(Gl-1)*pt,Us=255*pr.b*Mu<<8|255*Ai;dn.layoutColorArray.uint16[2*(Yn+Hi)]=255*pr.r*Mu<<8|255*pr.g*Mu,dn.layoutColorArray.uint16[2*(Yn+Hi)+1]=Us}const ns=Math.floor(Ln.x),vs=Math.floor(Ln.y),Hr=Math.floor(rt);for(let Hi=0;Hi<rr;++Hi){const Pr=3*(Yn+Hi);dn.layoutCentroidArray.int16[Pr]=ns,dn.layoutCentroidArray.int16[Pr+1]=vs,dn.layoutCentroidArray.int16[Pr+2]=Hr}if(dn.layoutFloodLightDataArray.uint16.fill(un.buildingPart===0?Ut:0,Yn,Yn+rr),$t){const Hi=255*Tt.r<<8|255*Tt.g,Pr=255*Tt.b<<8|255*yt;for(let Or=0;Or<rr;++Or){const Wo=2*(Yn+Or);dn.layoutFacadePaintArray.uint16[Wo]=Hi,dn.layoutFacadePaintArray.uint16[Wo+1]=Pr}for(let Or=0;Or<rr;++Or)if(un.isFauxFacade[Or]){const Wo=Math.min(65535,Math.floor(un.uv[2*Or]*Hn.outerRingLength));dn.layoutFacadeDataArray.emplace(Yn+Or,1|Wo,ft,At,Pt),dn.layoutFacadeVerticalRangeArray.emplace(Yn+Or,be,Je)}else dn.layoutFacadeDataArray.emplace(Yn+Or,0,0,0,0),dn.layoutFacadeVerticalRangeArray.emplace(Yn+Or,0,0)}const Wr=oi.vertexLength,ds=un.indices.length/3,Lo=dn.indexArray.length;dn.indexArray.resize(Lo+ds);for(let Hi=0;Hi<ds;++Hi){const Pr=3*Hi,Or=3*Lo+Pr;dn.indexArray.uint16[Or]=Wr+un.indices[Pr],dn.indexArray.uint16[Or+1]=Wr+un.indices[Pr+1],dn.indexArray.uint16[Or+2]=Wr+un.indices[Pr+2]}un.buildingPart!==1&&un.buildingPart!==0&&un.buildingPart!==2&&un.buildingPart!==3||di.push({part:un.buildingPart,vertexOffset:Yn,vertexLength:un.positions.length/3}),Yn+=rr,oi.vertexLength+=rr,oi.primitiveLength+=un.indices.length/3}this.maxHeight=Math.max(this.maxHeight,On);const lr=dn.indexArray.length-vi,cn=this.footprintsIndices.length,Wn=this.footprintsVertices.length,Ni=[],Vi=new st(1/0,1/0),qi=new st(-1/0,-1/0),Lr=this.groundEffect.vertexArray.length;for(const un of Hn.modifiedPolygonRings){const pr=[],Ai=new st(1/0,1/0),rr=new st(-1/0,-1/0);for(let ns=0;ns<un.length;ns+=2){const vs=un.length-ns-2;Ai.x=Math.min(Ai.x,un[vs]),Ai.y=Math.min(Ai.y,un[vs+1]),rr.x=Math.max(rr.x,un[vs]),rr.y=Math.max(rr.y,un[vs+1]);const Hr=new st(un[vs],un[vs+1]);pr.push(Hr),Ni.push(Hr.x,Hr.y),this.footprintsVertices.emplaceBack(Hr.x,Hr.y)}Vi.x=Math.min(Vi.x,Ai.x),Vi.y=Math.min(Vi.y,Ai.y),qi.x=Math.max(qi.x,rr.x),qi.y=Math.max(qi.y,rr.y),this.groundEffect.addData(pr,[Ai,rr],ct)}const Gi=this.groundEffect.vertexArray.length-Lr;this.groundEffect.groundRadiusArray.reserveForAdditional(Gi);for(let un=0;un<Gi;un++)this.groundEffect.groundRadiusArray.emplaceBack(ht);(tn.x<0||Cn.x>wt||tn.y<0||Cn.y>wt)&&this.featuresOnBorder.push({featureId:K.id,footprintIndex:this.footprints.length});{const un=u_(Ni,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+un.length),this.footprintsIndices.uint16.set(un,cn),this.buildingIds.add(me??K.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,Vi.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,Vi.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,qi.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,qi.y);const pr={footprintVertexOffset:Wn,footprintVertexLength:this.footprintsVertices.length-Wn,footprintIndexOffset:cn,footprintIndexLength:this.footprintsIndices.length-cn,min:Vi,max:qi,hiddenFlags:0,indicesOffset:vi,indicesLength:lr,bloomIndicesOffset:Ii,bloomIndicesLength:ji,groundEffectVertexOffset:Lr,groundEffectVertexLength:Gi,hasFauxFacade:$t,height:On,promoteId:se,feature:Te,parts:di,buildingBloom:hi},Ai=this.footprints.length;K.id!==void 0&&this.featureFootprintLookup.set(K.id,Ai),O(me,Ai),this.footprints.push(pr)}this.programConfigurations.populatePaintArrays(dn.layoutVertexArray.length,K,ae,{},s.availableImages,u,s.brightness),this.groundEffect.addPaintPropertiesData(K,ae,{},s.availableImages,u,s.brightness),s.featureIndex.insert(K,Ie,ae,de,this.index,Di)}R.forEach(({buildingId:K,footprintIndex:se})=>{M.has(K)&&(this.footprints[se].hiddenFlags|=4)});const X=new Set;this.buildingIds.forEach((K,se,ae)=>{M.has(K)||X.add(K)}),this.buildingIds=X,this.groundEffect.prepareBorderSegments()}update(n,s,u,h,g,_,x){this.programConfigurations.updatePaintArrays(n,s,g,u,h,_,x),this.groundEffect.update(n,s,g,u,h,_,x),this.evaluate(this.layers[0],n),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){const s=u=>{u.layoutVertexBuffer=n.createVertexBuffer(u.layoutVertexArray,sF.members),u.layoutNormalBuffer=n.createVertexBuffer(u.layoutNormalArray,HK.members),u.layoutCentroidBuffer=n.createVertexBuffer(u.layoutCentroidArray,WK.members),u.layoutFloodLightDataBuffer=n.createVertexBuffer(u.layoutFloodLightDataArray,YK.members),u.layoutFacadeDataArray&&u.layoutFacadeDataArray.length&&(u.layoutFacadeDataBuffer=n.createVertexBuffer(u.layoutFacadeDataArray,ZK.members)),u.layoutFacadeVerticalRangeArray&&u.layoutFacadeVerticalRangeArray.length&&(u.layoutFacadeVerticalRangeBuffer=n.createVertexBuffer(u.layoutFacadeVerticalRangeArray,KK.members)),u.entranceBloom.layoutVertexArray.length&&(u.entranceBloom.layoutVertexBuffer=n.createVertexBuffer(u.entranceBloom.layoutVertexArray,sF.members),u.entranceBloom.layoutAttenuationBuffer=n.createVertexBuffer(u.entranceBloom.layoutAttenuationArray,XK.members)),this.uploadUpdatedColorBuffer(n),this.uploadUpdatedIndexBuffer(n)};this.uploaded||(s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){const n=s=>{s.layoutVertexBuffer&&(s.layoutVertexBuffer.destroy(),s.layoutNormalBuffer.destroy(),s.layoutColorBuffer.destroy(),s.segmentsBucket.destroy(),s.indexBuffer&&s.indexBuffer.destroy(),s.entranceBloom.layoutVertexBuffer&&(s.entranceBloom.layoutVertexBuffer.destroy(),s.entranceBloom.layoutColorBuffer.destroy(),s.entranceBloom.layoutAttenuationBuffer.destroy(),s.entranceBloom.indexBuffer.destroy(),s.entranceBloom.segmentsBucket.destroy()))};n(this.buildingWithoutFacade),n(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(n,s,u=!0){let h=!1;const g=u?s:0,_=0|(u?-1:~s);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const x of n){const T=this.footprints[x],C=T.hiddenFlags&_|g;T.hiddenFlags!==C&&(T.hiddenFlags=C,h=!0,this.groundEffect.updateHiddenByLandmarkRange(T.groundEffectVertexOffset,T.groundEffectVertexLength,T.hiddenFlags!==0))}return h&&(this.indexArrayForConflationUploaded=!1),h}uploadUpdatedIndexBuffer(n){if(this.groundEffect.uploadHiddenByLandmark(n),this.indexArrayForConflationUploaded)return;const s=h=>{h.indexArray.length!==0&&(h.indexArrayForConflation.resize(h.indexArray.length),h.indexArrayForConflation.uint16.set(h.indexArray.uint16),h.entranceBloom.indexArrayForConflation.resize(h.entranceBloom.indexArray.length),h.entranceBloom.indexArrayForConflation.uint16.set(h.entranceBloom.indexArray.uint16))};s(this.buildingWithoutFacade),s(this.buildingWithFacade);for(const h of this.footprints){const g=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,_=h.indicesOffset+h.indicesLength;if(h.hiddenFlags!==0){for(let T=h.indicesOffset;T<_;T++)g.indexArrayForConflation.uint16[3*T+0]=0,g.indexArrayForConflation.uint16[3*T+1]=0,g.indexArrayForConflation.uint16[3*T+2]=0;const x=h.bloomIndicesOffset+h.bloomIndicesLength;for(let T=h.bloomIndicesOffset;T<x;T++)g.entranceBloom.indexArrayForConflation.uint16[3*T+0]=0,g.entranceBloom.indexArrayForConflation.uint16[3*T+1]=0,g.entranceBloom.indexArrayForConflation.uint16[3*T+2]=0}}const u=h=>{h.indexArray.length!==0&&(h.indexBuffer?h.indexBuffer.updateData(h.indexArrayForConflation):h.indexBuffer=n.createIndexBuffer(h.indexArrayForConflation,!0),h.entranceBloom.indexBuffer?h.entranceBloom.indexBuffer.updateData(h.entranceBloom.indexArrayForConflation):h.entranceBloom.indexBuffer=n.createIndexBuffer(h.entranceBloom.indexArrayForConflation,!0))};u(this.buildingWithoutFacade),u(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(n){const s=u=>{u.layoutColorBuffer?u.layoutColorBuffer.updateData(u.layoutColorArray):u.layoutColorBuffer=n.createVertexBuffer(u.layoutColorArray,oF.members,!0),u.layoutFacadePaintArray&&(u.layoutFacadePaintBuffer?u.layoutFacadePaintBuffer.updateData(u.layoutFacadePaintArray):u.layoutFacadePaintBuffer=n.createVertexBuffer(u.layoutFacadePaintArray,qK.members,!0)),u.entranceBloom.layoutColorBuffer?u.entranceBloom.layoutColorBuffer.updateData(u.entranceBloom.layoutColorArray):u.entranceBloom.layoutColorBuffer=n.createVertexBuffer(u.entranceBloom.layoutColorArray,oF.members,!0)};s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(n,s){const u=n.paint.get("building-ambient-occlusion-intensity");for(const h of this.footprints){if(4&h.hiddenFlags)continue;const g=s[h.promoteId],_=h.feature;_.properties["building-part"]="roof";const x=n.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),T=n.paint.get("building-emissive-strength").evaluate(_,g,this.canonical);_.properties["building-part"]="wall";const C=n.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),R=n.paint.get("building-emissive-strength").evaluate(_,g,this.canonical);_.properties["building-part"]="window";const M=n.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),D=n.paint.get("building-emissive-strength").evaluate(_,g,this.canonical);_.properties["building-part"]="door";const O=n.paint.get("building-color").evaluate(_,g,this.canonical).toPremultipliedRenderColor(this.lut),j=n.paint.get("building-emissive-strength").evaluate(_,g,this.canonical),G=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const K of h.parts){let se,ae=x;K.part===1?(ae=x,se=T):K.part===0?(ae=C,se=R):K.part===2?(ae=M,se=D):K.part===3&&(ae=O,se=j),se=Y(se,0,1);for(let de=0;de<K.vertexLength;de++){const ve=K.vertexOffset+de,me=1+(G.layoutAOArray.uint8[ve]/255-1)*u;G.layoutColorArray.emplace(ve,ae.r*me*255<<8|ae.g*me*255,ae.b*me*255<<8|255*se),h.hasFauxFacade&&G.layoutFacadePaintArray.emplace(ve,255*M.r<<8|255*M.g,255*M.b<<8|255*D)}}const X=h.buildingBloom;if(X)for(let K=0;K<X.vertexLength;K++)G.entranceBloom.layoutColorArray.emplace(X.vertexOffset+K,255*O.r<<8|255*O.g,255*O.b<<8|51*j)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(n,s,u){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const h=s.getReplacementRegionsForTile(n.toUnwrapped());if(Nw(this.activeReplacements,h))return;this.activeReplacements=h;for(const _ of this.footprints)_.hiddenFlags&=-2;const g=[];for(const _ of this.activeReplacements){if(_.order<=cO)continue;const x=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-n.canonical.z));for(const T of this.footprints)T.min.x>_.max.x||T.max.x<_.min.x||T.min.y>_.max.y||T.max.y<_.min.y||(g.length=0,tX(this.footprintsVertices,T.footprintVertexOffset,T.footprintVertexLength,_.footprintTileId.canonical,n.canonical,g),oA(_.footprint,g,this.footprintsIndices.uint16,T.footprintIndexOffset,T.footprintIndexLength,0,-x)&&(T.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(_.groundEffectVertexOffset,_.groundEffectVertexLength,_.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(n){if(n.id!==void 0){const s=this.featureFootprintLookup.get(n.id);return this.footprints[s]}return null}getHeightAtTileCoord(n,s){let u=Number.NEGATIVE_INFINITY,h=!0;const g=4*(n+wt)*wt+(s+wt);if(this.footprintLookup.hasOwnProperty(g)){const x=this.footprintLookup[g];return x?{height:x.height,hidden:x.hiddenFlags!==0}:void 0}const _=new st(n,s);for(const x of this.footprints)n>x.max.x||x.min.x>n||s>x.max.y||x.min.y>s||x.height<=u||eX(_,this.footprintsVertices.float32.subarray(2*x.footprintVertexOffset,2*(x.footprintVertexOffset+x.footprintVertexLength)),this.footprintsIndices.uint16.subarray(x.footprintIndexOffset,x.footprintIndexOffset+x.footprintIndexLength))&&(u=x.height,this.footprintLookup[g]=x,h=x.hiddenFlags!==0);if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.footprintLookup[g]=void 0}}function eX(a,n,s){for(let u=0;u<s.length;u+=3){const h=s[u],g=s[u+1],_=s[u+2],x=n[2*h+0],T=n[2*h+1],C=n[2*g+0],R=n[2*g+1],M=n[2*_+0],D=n[2*_+1],O=(x-M)*(a.y-D)-(T-D)*(a.x-M),j=(C-x)*(a.y-T)-(R-T)*(a.x-x);if(O<0!=j<0&&O!==0&&j!==0)continue;const G=(M-C)*(a.y-R)-(D-R)*(a.x-C);if(G===0||G<0==O+j<=0)return!0}return!1}function tX(a,n,s,u,h,g){const _=Math.pow(2,u.z-h.z);for(let x=0;x<s;x++){let T=a.float32[2*(x+n)+0],C=a.float32[2*(x+n)+1];T=(T+h.x*wt)*_-u.x*wt,C=(C+h.y*wt)*_-u.y*wt,g.push(new st(T,C))}}let cF,uF;jt(lF,"BuildingBucket",{omit:["layers"]}),jt(IA,"BuildingGeometry"),jt(CA,"BuildingBloomGeometry");const nX=Gn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),iX=Gn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:rX}=nX,sX=Gn([{name:"a_packed",components:3,type:"Float32"}]),{members:oX}=sX,aX=Gn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:lX}=aX;class dF{constructor(n,s){this.width=n,this.height=s,this.nextRow=0,this.image=new Nh({width:n,height:s}),this.positions={},this.uploaded=!1}getDash(n,s){const u=this.getKey(n,s);return this.positions[u]}trim(){const n=this.width,s=this.height=Ge(this.nextRow);this.image.resize({width:n,height:s})}getKey(n,s){return n.join(",")+s}getDashRanges(n,s,u){const h=[];let g=n.length%2==1?-n[n.length-1]*u:0,_=n[0]*u,x=!0;h.push({left:g,right:_,isDash:x,zeroLength:n[0]===0});let T=n[0];for(let C=1;C<n.length;C++){x=!x;const R=n[C];g=T*u,T+=R,_=T*u,h.push({left:g,right:_,isDash:x,zeroLength:R===0})}return h}addRoundDash(n,s,u){const h=s/2;for(let g=-u;g<=u;g++){const _=this.width*(this.nextRow+u+g);let x=0,T=n[x];for(let C=0;C<this.width;C++){C/T.right>1&&(T=n[++x]);const R=Math.abs(C-T.left),M=Math.abs(C-T.right),D=Math.min(R,M);let O;const j=g/u*(h+1);if(T.isDash){const G=h-Math.abs(j);O=Math.sqrt(D*D+G*G)}else O=h-Math.sqrt(D*D+j*j);this.image.data[_+C]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(n,s){for(let T=n.length-1;T>=0;--T){const C=n[T],R=n[T+1];C.zeroLength?n.splice(T,1):R&&R.isDash===C.isDash&&(R.left=C.left,n.splice(T,1))}const u=n[0],h=n[n.length-1];u.isDash===h.isDash&&(u.left=h.left-this.width,h.right=u.right+this.width);const g=this.width*this.nextRow;let _=0,x=n[_];for(let T=0;T<this.width;T++){T/x.right>1&&(x=n[++_]);const C=Math.abs(T-x.left),R=Math.abs(T-x.right),M=Math.min(C,R);this.image.data[g+T]=Math.max(0,Math.min(255,(x.isDash?M:-M)+s+128))}}addDash(n,s){const u=this.getKey(n,s);if(this.positions[u])return this.positions[u];const h=s==="round",g=h?7:0,_=2*g+1;if(this.nextRow+_>this.height)return Nt("LineAtlas out of space"),null;n.length===0&&n.push(1);let x=0;for(let R=0;R<n.length;R++)n[R]<0&&(Nt("Negative value is found in line dasharray, replacing values with 0"),n[R]=0),x+=n[R];if(x!==0){const R=this.width/x,M=this.getDashRanges(n,this.width,R);h?this.addRoundDash(M,R,g):this.addRegularDash(M,s==="square"?.5*R:0)}const T=this.nextRow+g;this.nextRow+=_;const C={tl:[T,g],br:[x,0]};return this.positions[u]=C,C}}jt(dF,"LineAtlas");const cX=Me.types,uX=Math.cos(Math.PI/180*37.5),dX=Math.cos(Math.PI/180*5);class AA{constructor(n){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=n.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=n.overscaling,this.pixelRatio=n.pixelRatio,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Hg,this.layoutVertexArray2=new oa,this.patternVertexArray=new oa,this.indexArray=new Jr,this.programConfigurations=new dl(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new dr,this.maxLineLength=0,this.zOffsetVertexArray=new oa,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=n.tessellationStep?n.tessellationStep:wt/64,this.worldview=n.worldview,this.hasAppearances=null}updateFootprints(n,s){}updateAppearances(n,s,u,h){}populate(n,s,u,h){this.hasPattern=eA("line",this.layers,this.pixelRatio,s);const g=this.layers[0].layout.get("line-sort-key");this.tileToMeter=te(u);const _=this.layers[0].layout.get("line-elevation-reference");if(_==="hd-road-markup")this.elevationType="road";else{const D=this.layers[0].layout.get("line-z-offset"),O=D.isConstant()&&!D.constantOr(0);this.elevationType=_!=="sea"&&_!=="ground"&&O?"none":"offset",this.elevationType==="offset"&&_==="none"&&Nt(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const x=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&x!==void 0;const T=[];for(const{feature:D,id:O,index:j,sourceLayerIndex:G}of n){const X=this.layers[0]._featureFilter.needGeometry,K=De(D,X);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),K,u))continue;const se=g?g.evaluate(K,{},u):void 0,ae={id:O,properties:D.properties,type:D.type,sourceLayerIndex:G,index:j,geometry:X?K.geometry:Se(D,u,h),patterns:{},sortKey:se};T.push(ae)}g&&T.sort((D,O)=>D.sortKey-O.sortKey);const{lineAtlas:C,featureIndex:R}=s,M=this.addConstantDashes(C);for(const D of T){const{geometry:O,index:j,sourceLayerIndex:G}=D;if(M&&this.addFeatureDashes(D,C),this.hasPattern){const X=tA("line",this.layers,D,this.zoom,this.pixelRatio,s);this.patternFeatures.push(X)}else this.addFeature(D,O,j,u,C.positions,s.availableImages,s.brightness,s.elevationFeatures);R.insert(n[j].feature,O,j,G,this.index)}}addConstantDashes(n){let s=!1;for(const u of this.layers){const h=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if(h.kind!=="constant"||g.kind!=="constant")s=!0;else{const _=g.value,x=h.value;if(!x)continue;n.addDash(x,_)}}return s}addFeatureDashes(n,s){const u=this.zoom;for(const h of this.layers){const g=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if(g.kind==="constant"&&_.kind==="constant")continue;let x,T;if(g.kind==="constant"){if(x=g.value,!x)continue}else x=g.evaluate({zoom:u},n);T=_.kind==="constant"?_.value:_.evaluate({zoom:u},n),s.addDash(x,T),n.patterns[h.id]=[s.getKey(x,T)]}}update(n,s,u,h,g,_,x,T){this.programConfigurations.updatePaintArrays(n,s,g,u,h,_,x,T)}addFeatures(n,s,u,h,g,_){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,s,u,h,_,n.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,oX)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=n.createVertexBuffer(this.patternVertexArray,lX)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,iX.members,!0)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,rX),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n,s){let u,h;if(s&&s>0?(u=`mapbox_clip_start_${s}`,h=`mapbox_clip_end_${s}`):(u="mapbox_clip_start",h="mapbox_clip_end"),n.properties&&n.properties.hasOwnProperty(u)&&n.properties.hasOwnProperty(h))return{start:+n.properties[u],end:+n.properties[h]}}addFeature(n,s,u,h,g,_,x,T){const C=this.layers[0].layout,R=C.get("line-join").evaluate(n,{}),M=C.get("line-cap").evaluate(n,{}),D=C.get("line-miter-limit"),O=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(n),this.lineFeature=n;const j=!(!n.properties||!n.properties.hasOwnProperty("mapbox_line_metrics"))&&n.properties.mapbox_line_metrics;this.zOffsetValue=C.get("line-z-offset").value;const G=this.layers[0].paint.get("line-width").value;if(G.kind!=="constant"&&G.isLineProgressConstant===!1&&(this.variableWidthValue=G),this.elevationType==="road"){const X=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(n,s,h,T,R,M,D,O)){const[K,se]=this.clipRuntimeLinesToTile(s,1);for(let ae=0;ae<K.length;ae++){const de=K[ae],ve=se[ae],me={progress:{min:ve.progress.min,max:ve.progress.max},nextDir:this.computeSegNextDir(ve,de),prevDir:this.computeSegPrevDir(ve,de)};this.addLine(de,n,h,R,M,D,O,me,j&&ve.parentIndex>0?ve.parentIndex:null)}this.fillNonElevatedRoadSegment(X)}}else for(let X=0;X<s.length;X++)this.addLine(s[X],n,h,R,M,D,O,void 0,j&&X>0?X:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,g,_,h,x,void 0,this.worldview)}computeSegNextDir(n,s){return n.nextPoint.sub(s.at(-2)).unit()}computeSegPrevDir(n,s){return s[1].sub(n.prevPoint).unit()}clipLinesToTile(n,s){return Fw(n,-s,-s,wt+s,wt+s)}clipRuntimeLinesToTile(n,s){const u=[];return[Fw(n,-s,-s,wt+s,wt+s,u),u]}addElevatedRoadFeature(n,s,u,h,g,_,x,T){const C=[],R=_i.getElevationFeature(n,h);if(R){const M=this.clipLinesToTile(s,1),D=this.prepareElevatedLines(M,R,u);for(const O of D)C.push({geometry:O,elevation:R,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(C.length===0)return!1;for(const M of C){const D=this.layoutVertexArray.length;this.addLine(M.geometry,n,u,g,_,x,T);const O=new Ri(u,M.elevationTileID);if(M.elevation)for(let j=D;j<this.layoutVertexArray.length;j++){const G=new st(this.layoutVertexArray.int16[6*j]>>1,this.layoutVertexArray.int16[6*j+1]>>1),X=O.pointElevation(G,M.elevation,.05);this.updateHeightRange(X),this.zOffsetVertexArray.emplaceBack(X,0,0)}else this.fillNonElevatedRoadSegment(D)}return!0}prepareElevatedLines(n,s,u){if(s.constantHeight!=null)return n;const h=[],g=1/te(u);for(const _ of n)bK(_,new ui(s,g),0,h);return h}fillNonElevatedRoadSegment(n){for(let s=n;s<this.layoutVertexArray.length;s++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(n){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,n),this.heightRange.max=Math.max(this.heightRange.max,n)):this.heightRange={min:n,max:n}}addLine(n,s,u,h,g,_,x,T,C){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=C?this.lineFeatureClips(s,C):this.lineClips;const R=h==="none";this.patternJoinNone=this.hasPattern&&R,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const M=T&&T.progress.min>0,D=T&&T.progress.max<1;if(this.lineClips){let Re={min:this.lineClips.start,max:this.lineClips.end},qe=1;if(T){const it=this.lineClips.end-this.lineClips.start;Re=function(rt,ht,pt){return{min:Bi(rt.min,ht,pt),max:Bi(rt.max,ht,pt)}}(T.progress,{min:0,max:1},Re),it>0&&(qe=(Re.max-Re.min)/it)}const Ne=+s.properties.mapbox_clip_feature_len,Qe=+s.properties.mapbox_clip_seg_len;if(Number.isNaN(Ne)||Number.isNaN(Qe)){for(let rt=0;rt<n.length-1;rt++)this.totalDistance+=n[rt].dist(n[rt+1]);const it=this.totalDistance/(Re.max-Re.min);this.totalFeatureLength=Number.isFinite(it)?it:0,this.lineClips.start=Re.min,this.lineClips.end=Re.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ne,this.distance=Qe*qe,this.lineClips.start=Re.min,this.lineClips.end=Re.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const O=cX[s.type]==="Polygon";let j=n.length;for(;j>=2&&n[j-1].equals(n[j-2]);)j--;let G=0;for(;G<j-1&&n[G].equals(n[G+1]);)G++;if(j<(O?3:2))return;h==="bevel"&&(_=1.05);const X=this.segments.prepareSegment(10*j,this.layoutVertexArray,this.indexArray);let K,se,ae,de,ve,me,Te,Ie;T&&T.prevDir&&(me=T.prevDir.perp()),T&&T.nextDir&&(Te=T.nextDir.perp()),this.e1=this.e2=-1,O&&(K=n[j-2],ve=n[G].sub(K)._unit()._perp());for(let Re=G;Re<j;Re++){if(ae=Re===j-1?O?n[G+1]:void 0:n[Re+1],ae&&n[Re].equals(ae))continue;ve&&(de=ve),K&&(se=K),K=n[Re],Ie=this.evaluateLineProgressFeatures(se?se.dist(K):0),ve=ae?ae.sub(K)._unit()._perp():de,de=de||ve;const qe=se&&ae;let Ne=qe?h:O||R?"butt":g;const Qe=de.x*ve.x+de.y*ve.y;if(R){const Ze=function(dt){if(dt.patternJoinNone){const Tt=dt.segmentPoints.length/2,yt=dt.lineSoFar-dt.segmentStart;for(let Yt=0;Yt<Tt;++Yt){const kt=dt.segmentPoints[2*Yt+1],Ot=Math.round(dt.segmentPoints[2*Yt])+.5+.25*kt;dt.patternVertexArray.emplaceBack(Ot,yt,dt.segmentStart),dt.patternVertexArray.emplaceBack(Ot,yt,dt.segmentStart)}dt.segmentPoints.length=0}dt.e1=dt.e2=-1};if(qe&&Qe<dX){this.updateDistance(se,K),this.addCurrentVertex(K,de,1,1,X,Ie),Ze(this),this.addCurrentVertex(K,ve,-1,-1,X,Ie);continue}if(se){if(!ae){this.updateDistance(se,K),this.addCurrentVertex(K,de,1,1,X,Ie),Ze(this);continue}Ne="miter"}}let it=de.add(ve);it.x===0&&it.y===0||it._unit();const rt=it.x*ve.x+it.y*ve.y,ht=rt!==0?1/rt:1/0,pt=2*Math.sqrt(2-2*rt),ct=rt<uX&&se&&ae,ut=de.x*ve.y-de.y*ve.x>0,Ye=this.overscaling<=16?15*wt/(512*this.overscaling):0;if(qe&&Ne==="round"){if(ht<x)Ne="miter";else if(ht<=2){const Ze=PA(K,-10,wt+10);Ne=this.elevationType==="offset"&&(Ze||this.hasCrossSlope)?"miter":"fakeround"}}if(Ne==="miter"&&ht>_&&(Ne="bevel"),Ne==="bevel"&&(ht>2&&(Ne="flipbevel"),ht<_&&(Ne="miter")),se&&!(Ne==="miter"&&ct)&&this.updateDistance(se,K),Ne==="miter")if(ct){const Ze=K.dist(se);if(Ze>2*Ye){const Tt=K.sub(K.sub(se)._mult(Ye/Ze)._round());this.updateDistance(se,Tt),this.addCurrentVertex(Tt,de,0,0,X,Ie),se=Tt}this.updateDistance(se,K),it._mult(ht),this.addCurrentVertex(K,it,0,0,X,Ie);const dt=K.dist(ae);if(dt>2*Ye){const Tt=K.add(ae.sub(K)._mult(Ye/dt)._round());this.updateDistance(K,Tt),this.addCurrentVertex(Tt,ve,0,0,X,Ie),K=Tt}}else it._mult(ht),this.addCurrentVertex(K,it,0,0,X,Ie);else if(Ne==="flipbevel"){if(ht>100)it=ve.mult(-1);else{const Ze=ht*de.add(ve).mag()/de.sub(ve).mag();it._perp()._mult(Ze*(ut?-1:1))}this.addCurrentVertex(K,it,0,0,X,Ie),this.addCurrentVertex(K,it.mult(-1),0,0,X,Ie)}else if(Ne==="bevel"||Ne==="fakeround"){Ie!=null&&se&&this.addCurrentVertex(K,Te||de,-1,-1,X,Ie);const Ze=K.dist(se)<=2*Ye&&Ne!=="bevel",dt=it.mult(ut?1:-1);dt._mult(ht);const Tt=ve.mult(ut?-1:1),yt=de.mult(ut?-1:1),Yt=this.evaluateLineProgressFeatures(this.distance);if(Ie==null&&(this.addHalfVertex(K,dt.x,dt.y,!1,!ut,0,X,Yt),Ze||this.addHalfVertex(K,dt.x+2*yt.x,dt.y+2*yt.y,!1,ut,0,X,Yt)),Ne==="fakeround"){const kt=Math.round(180*pt/Math.PI/20);this.addHalfVertex(K,yt.x,yt.y,!1,ut,0,X,Yt);for(let Ot=0;Ot<kt;Ot++){let Ut=Ot/kt;if(Ut!==.5){const vt=Ut-.5;Ut+=Ut*vt*(Ut-1)*((1.0904+Qe*(Qe*(3.55645-1.43519*Qe)-3.2452))*vt*vt+(.848013+Qe*(.215638*Qe-1.06021)))}const jn=Tt.sub(yt)._mult(Ut)._add(yt)._unit();this.addHalfVertex(K,jn.x,jn.y,!1,ut,0,X,Yt)}this.addHalfVertex(K,Tt.x,Tt.y,!1,ut,0,X,Yt)}Ze||Ie!=null||this.addHalfVertex(K,dt.x+2*Tt.x,dt.y+2*Tt.y,!1,ut,0,X,Yt),Ie!=null&&ae&&this.addCurrentVertex(K,me||ve,1,1,X,Ie)}else if(Ne==="butt")this.addCurrentVertex(K,it,0,0,X,Ie);else if(Ne==="square"){if(!se){const Ze=M?0:-1;this.addCurrentVertex(K,it,Ze,Ze,X,Ie)}if(this.addCurrentVertex(K,it,0,0,X,Ie),se){const Ze=D?0:1;this.addCurrentVertex(K,it,Ze,Ze,X,Ie)}}else if(Ne==="round"){if(se){const Ze=!qe&&Te?Te:de;this.addCurrentVertex(K,Ze,0,0,X,Ie),!qe&&D||this.addCurrentVertex(K,Ze,1,1,X,Ie,!0)}if(ae){const Ze=!qe&&me?me:ve;!qe&&M||this.addCurrentVertex(K,Ze,-1,-1,X,Ie,!0),this.addCurrentVertex(K,Ze,0,0,X,Ie)}}}}addVerticesTo(n,s,u,h,g,_,x,T,C,R){const M=(s.w-n.w)/this.tessellationStep|0;let D=0;const O=this.scaledDistance;if(M>1){this.lineSoFar=n.w;const G=(s.x-n.x)/M,X=(s.y-n.y)/M,K=(s.z-n.z)/M,se=(s.w-n.w)/M;for(let ae=1;ae<M;++ae){n.x+=G,n.y+=X,n.z+=K,this.lineSoFar+=se,D+=se;const de=this.evaluateLineProgressFeatures(this.prevDistance+D);this.scaledDistance=(this.prevDistance+D)/this.totalDistance,this.addHalfVertex(n,u,h,R,!1,x,C,de),this.addHalfVertex(n,g,_,R,!0,-T,C,de)}}this.lineSoFar=s.w,this.scaledDistance=O;const j=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(s,u,h,R,!1,x,C,j),this.addHalfVertex(s,g,_,R,!0,-T,C,j)}evaluateLineProgressFeatures(n){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+n)/this.totalFeatureLength):Nt(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let s=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(s=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:s}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:s}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:s}}addCurrentVertex(n,s,u,h,g,_,x=!1){const T=s.x+s.y*u,C=s.y-s.x*u,R=s.y*h-s.x,M=-s.y-s.x*h;if(_!=null){const D=this.elevationType==="offset",O=-10,j=wt+10,G=_.zOffset,X=new DO(n.x,n.y,G,this.lineSoFar),K=!!D&&PA(n,O,j),se=this.lineSoFar,ae=this.distance;if(this.currentVertex)if(K){const de=this.currentVertexIsOutside,ve=this.currentVertex,me=new DO(n.x,n.y,G,this.lineSoFar);if(LO(ve,me,O,j),!PA(me,O,j)){if(de){this.e1=this.e2=-1,this.distance-=ve.dist(X),this.lineSoFar=ve.w;const Te=this.evaluateLineProgressFeatures(ve.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ve,T,C,x,!1,u,g,Te),this.addHalfVertex(ve,R,M,x,!0,-h,g,Te),this.prevDistance=this.distance}this.distance=this.prevDistance+ve.dist(me),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ve,me,T,C,R,M,u,h,g,x),this.distance=ae,this.scaledDistance=this.distance/this.totalDistance}}else{const de=this.currentVertex;if(this.currentVertexIsOutside){LO(de,X,O,j),this.e1=this.e2=-1,this.distance-=de.dist(X),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=de.w;const ve=this.evaluateLineProgressFeatures(de.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(de,T,C,x,!1,u,g,ve),this.addHalfVertex(de,R,M,x,!0,-h,g,ve),this.prevDistance=this.distance,this.distance=ae,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(de,X,T,C,R,M,u,h,g,x)}else K||(this.addHalfVertex(n,T,C,x,!1,u,g,_),this.addHalfVertex(n,R,M,x,!0,-h,g,_));this.currentVertex=X,this.currentVertexIsOutside=K,this.lineSoFar=se}else this.addHalfVertex(n,T,C,x,!1,u,g,_),this.addHalfVertex(n,R,M,x,!0,-h,g,_)}addHalfVertex({x:n,y:s},u,h,g,_,x,T,C){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((n<<1)+(g?1:0),(s<<1)+(_?1:0),Math.round(63*u)+128,Math.round(63*h)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const M=fn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,M)}const R=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),T.primitiveLength++),_?this.e2=R:this.e1=R,C!=null&&this.zOffsetVertexArray.emplaceBack(C.zOffset,C.variableWidth,C.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(n,s){this.prevDistance=this.distance,this.distance+=n.dist(s),this.updateScaledDistance()}}function PA(a,n,s){return a.x<n||a.x>s||a.y<n||a.y>s}let hF,fF;function pF(a,n,s){return n*(wt/(a.tileSize*Math.pow(2,s-a.tileID.overscaledZ)))}jt(AA,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const mF=(a,n,s)=>(1-s)*a+s*n;function gF(a,n){return 1/pF(a,1,n.tileZoom)}function _F(a,n,s,u){return a.translatePosMatrix(u||n.tileID.projMatrix,n,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const yF=a=>{const n=[];vF(a)&&n.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&n.push("RENDER_LINE_GRADIENT");const s=a.paint.get("line-trim-offset");s[0]===0&&s[1]===0||n.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&n.push("RENDER_LINE_BORDER");const u=a.layout.get("line-join").constantOr("miter")==="none",h=!!a.paint.get("line-pattern").constantOr(1);return u&&h&&n.push("LINE_JOIN_NONE"),n};function vF(a){const n=a.paint.get("line-dasharray").value;return n.kind!=="constant"||n.value}let RA;const xF=()=>RA||(RA={layout:hF||(hF=new wr({"line-cap":new It(Fe.layout_line["line-cap"]),"line-join":new It(Fe.layout_line["line-join"]),"line-miter-limit":new xt(Fe.layout_line["line-miter-limit"]),"line-round-limit":new xt(Fe.layout_line["line-round-limit"]),"line-sort-key":new It(Fe.layout_line["line-sort-key"]),"line-z-offset":new It(Fe.layout_line["line-z-offset"]),"line-elevation-reference":new xt(Fe.layout_line["line-elevation-reference"]),"line-cross-slope":new xt(Fe.layout_line["line-cross-slope"]),visibility:new xt(Fe.layout_line.visibility),"line-width-unit":new xt(Fe.layout_line["line-width-unit"])})),paint:fF||(fF=new wr({"line-opacity":new It(Fe.paint_line["line-opacity"]),"line-color":new It(Fe.paint_line["line-color"]),"line-translate":new xt(Fe.paint_line["line-translate"]),"line-translate-anchor":new xt(Fe.paint_line["line-translate-anchor"]),"line-width":new It(Fe.paint_line["line-width"]),"line-gap-width":new It(Fe.paint_line["line-gap-width"]),"line-offset":new It(Fe.paint_line["line-offset"]),"line-blur":new It(Fe.paint_line["line-blur"]),"line-dasharray":new It(Fe.paint_line["line-dasharray"]),"line-pattern":new It(Fe.paint_line["line-pattern"]),"line-pattern-cross-fade":new xt(Fe.paint_line["line-pattern-cross-fade"]),"line-gradient":new xd(Fe.paint_line["line-gradient"]),"line-trim-offset":new xt(Fe.paint_line["line-trim-offset"]),"line-trim-fade-range":new xt(Fe.paint_line["line-trim-fade-range"]),"line-trim-color":new xt(Fe.paint_line["line-trim-color"]),"line-emissive-strength":new It(Fe.paint_line["line-emissive-strength"]),"line-border-width":new It(Fe.paint_line["line-border-width"]),"line-border-color":new It(Fe.paint_line["line-border-color"]),"line-occlusion-opacity":new xt(Fe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},RA);class hX extends It{possiblyEvaluate(n,s){return s=new Wi(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition,worldview:s.worldview}),super.possiblyEvaluate(n,s)}evaluate(n,s,u,h){return s=Object.assign({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(n,s,u,h)}}let zx;function bF(a,n){return n>0?n+2*a:a}const fX=Gn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),pX=Gn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),mX=Gn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Gn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const gX=Gn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),_X=Gn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),yX=Gn([{name:"a_texb",components:2,type:"Uint16"}]),vX=Gn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),xX=Gn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Gn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const wF=Gn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),bX=Gn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Gn([{name:"triangle",components:3,type:"Uint16"}]),Gn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Gn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Gn([{type:"Float32",name:"offsetX"}]),Gn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ys=24;function wX(a,n,s){return a.sections.forEach(u=>{u.text=function(h,g,_){const x=g.layout.get("text-transform").evaluate(_,{});return x==="uppercase"?h=h.toLocaleUpperCase():x==="lowercase"&&(h=h.toLocaleLowerCase()),mc.applyArabicShaping&&(h=mc.applyArabicShaping(h)),h}(u.text,n,s)}),a}const jx={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function TX(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}function EX(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}const MA=4294967296,TF=1/MA,EF=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let Zw=class{constructor(a=new Uint8Array(16)){this.buf=ArrayBuffer.isView(a)?a:new Uint8Array(a),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(a,n,s=this.length){for(;this.pos<s;){const u=this.readVarint(),h=u>>3,g=this.pos;this.type=7&u,a(h,n,this),this.pos===g&&this.skip(u)}return n}readMessage(a,n){return this.readFields(a,n,this.readVarint()+this.pos)}readFixed32(){const a=this.dataView.getUint32(this.pos,!0);return this.pos+=4,a}readSFixed32(){const a=this.dataView.getInt32(this.pos,!0);return this.pos+=4,a}readFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*MA;return this.pos+=8,a}readSFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*MA;return this.pos+=8,a}readFloat(){const a=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,a}readDouble(){const a=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,a}readVarint(a){const n=this.buf;let s,u;return u=n[this.pos++],s=127&u,u<128?s:(u=n[this.pos++],s|=(127&u)<<7,u<128?s:(u=n[this.pos++],s|=(127&u)<<14,u<128?s:(u=n[this.pos++],s|=(127&u)<<21,u<128?s:(u=n[this.pos],s|=(15&u)<<28,function(h,g,_){const x=_.buf;let T,C;if(C=x[_.pos++],T=(112&C)>>4,C<128||(C=x[_.pos++],T|=(127&C)<<3,C<128)||(C=x[_.pos++],T|=(127&C)<<10,C<128)||(C=x[_.pos++],T|=(127&C)<<17,C<128)||(C=x[_.pos++],T|=(127&C)<<24,C<128)||(C=x[_.pos++],T|=(1&C)<<31,C<128))return __(h,T,g);throw new Error("Expected varint not more than 10 bytes")}(s,a,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const a=this.readVarint();return a%2==1?(a+1)/-2:a/2}readBoolean(){return!!this.readVarint()}readString(){const a=this.readVarint()+this.pos,n=this.pos;return this.pos=a,a-n>=12&&EF?EF.decode(this.buf.subarray(n,a)):function(s,u,h){let g="",_=u;for(;_<h;){const x=s[_];let T,C,R,M=null,D=x>239?4:x>223?3:x>191?2:1;if(_+D>h)break;D===1?x<128&&(M=x):D===2?(T=s[_+1],(192&T)==128&&(M=(31&x)<<6|63&T,M<=127&&(M=null))):D===3?(T=s[_+1],C=s[_+2],(192&T)==128&&(192&C)==128&&(M=(15&x)<<12|(63&T)<<6|63&C,(M<=2047||M>=55296&&M<=57343)&&(M=null))):D===4&&(T=s[_+1],C=s[_+2],R=s[_+3],(192&T)==128&&(192&C)==128&&(192&R)==128&&(M=(15&x)<<18|(63&T)<<12|(63&C)<<6|63&R,(M<=65535||M>=1114112)&&(M=null))),M===null?(M=65533,D=1):M>65535&&(M-=65536,g+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),g+=String.fromCharCode(M),_+=D}return g}(this.buf,n,a)}readBytes(){const a=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,a);return this.pos=a,n}readPackedVarint(a=[],n){const s=this.readPackedEnd();for(;this.pos<s;)a.push(this.readVarint(n));return a}readPackedSVarint(a=[]){const n=this.readPackedEnd();for(;this.pos<n;)a.push(this.readSVarint());return a}readPackedBoolean(a=[]){const n=this.readPackedEnd();for(;this.pos<n;)a.push(this.readBoolean());return a}readPackedFloat(a=[]){const n=this.readPackedEnd();for(;this.pos<n;)a.push(this.readFloat());return a}readPackedDouble(a=[]){const n=this.readPackedEnd();for(;this.pos<n;)a.push(this.readDouble());return a}readPackedFixed32(a=[]){const n=this.readPackedEnd();for(;this.pos<n;)a.push(this.readFixed32());return a}readPackedSFixed32(a=[]){const n=this.readPackedEnd();for(;this.pos<n;)a.push(this.readSFixed32());return a}readPackedFixed64(a=[]){const n=this.readPackedEnd();for(;this.pos<n;)a.push(this.readFixed64());return a}readPackedSFixed64(a=[]){const n=this.readPackedEnd();for(;this.pos<n;)a.push(this.readSFixed64());return a}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(a){const n=7&a;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(a,n){this.writeVarint(a<<3|n)}realloc(a){let n=this.length||16;for(;n<this.pos+a;)n*=2;if(n!==this.length){const s=new Uint8Array(n);s.set(this.buf),this.buf=s,this.dataView=new DataView(s.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeSFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*TF),!0),this.pos+=8}writeSFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*TF),!0),this.pos+=8}writeVarint(a){(a=+a||0)>268435455||a<0?function(n,s){let u,h;if(n>=0?(u=n%4294967296|0,h=n/4294967296|0):(u=~(-n%4294967296),h=~(-n/4294967296),4294967295^u?u=u+1|0:(u=0,h=h+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(g,_,x){x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,x.buf[x.pos]=127&(g>>>=7)}(u,0,s),function(g,_){const x=(7&g)<<4;_.buf[_.pos++]|=x|((g>>>=3)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g)))))}(h,s)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))}writeSVarint(a){this.writeVarint(a<0?2*-a-1:2*a)}writeBoolean(a){this.writeVarint(+a)}writeString(a){a=String(a),this.realloc(4*a.length),this.pos++;const n=this.pos;this.pos=function(u,h,g){for(let _,x,T=0;T<h.length;T++){if(_=h.charCodeAt(T),_>55295&&_<57344){if(!x){_>56319||T+1===h.length?(u[g++]=239,u[g++]=191,u[g++]=189):x=_;continue}if(_<56320){u[g++]=239,u[g++]=191,u[g++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(u[g++]=239,u[g++]=191,u[g++]=189,x=null);_<128?u[g++]=_:(_<2048?u[g++]=_>>6|192:(_<65536?u[g++]=_>>12|224:(u[g++]=_>>18|240,u[g++]=_>>12&63|128),u[g++]=_>>6&63|128),u[g++]=63&_|128)}return g}(this.buf,a,this.pos);const s=this.pos-n;s>=128&&SF(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s}writeFloat(a){this.realloc(4),this.dataView.setFloat32(this.pos,a,!0),this.pos+=4}writeDouble(a){this.realloc(8),this.dataView.setFloat64(this.pos,a,!0),this.pos+=8}writeBytes(a){const n=a.length;this.writeVarint(n),this.realloc(n);for(let s=0;s<n;s++)this.buf[this.pos++]=a[s]}writeRawMessage(a,n){this.pos++;const s=this.pos;a(n,this);const u=this.pos-s;u>=128&&SF(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u}writeMessage(a,n,s){this.writeTag(a,2),this.writeRawMessage(n,s)}writePackedVarint(a,n){n.length&&this.writeMessage(a,SX,n)}writePackedSVarint(a,n){n.length&&this.writeMessage(a,CX,n)}writePackedBoolean(a,n){n.length&&this.writeMessage(a,PX,n)}writePackedFloat(a,n){n.length&&this.writeMessage(a,IX,n)}writePackedDouble(a,n){n.length&&this.writeMessage(a,AX,n)}writePackedFixed32(a,n){n.length&&this.writeMessage(a,RX,n)}writePackedSFixed32(a,n){n.length&&this.writeMessage(a,MX,n)}writePackedFixed64(a,n){n.length&&this.writeMessage(a,kX,n)}writePackedSFixed64(a,n){n.length&&this.writeMessage(a,DX,n)}writeBytesField(a,n){this.writeTag(a,2),this.writeBytes(n)}writeFixed32Field(a,n){this.writeTag(a,5),this.writeFixed32(n)}writeSFixed32Field(a,n){this.writeTag(a,5),this.writeSFixed32(n)}writeFixed64Field(a,n){this.writeTag(a,1),this.writeFixed64(n)}writeSFixed64Field(a,n){this.writeTag(a,1),this.writeSFixed64(n)}writeVarintField(a,n){this.writeTag(a,0),this.writeVarint(n)}writeSVarintField(a,n){this.writeTag(a,0),this.writeSVarint(n)}writeStringField(a,n){this.writeTag(a,2),this.writeString(n)}writeFloatField(a,n){this.writeTag(a,5),this.writeFloat(n)}writeDoubleField(a,n){this.writeTag(a,1),this.writeDouble(n)}writeBooleanField(a,n){this.writeVarintField(a,+n)}};function __(a,n,s){return s?4294967296*n+(a>>>0):4294967296*(n>>>0)+(a>>>0)}function SF(a,n,s){const u=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));s.realloc(u);for(let h=s.pos-1;h>=a;h--)s.buf[h+u]=s.buf[h]}function SX(a,n){for(let s=0;s<a.length;s++)n.writeVarint(a[s])}function CX(a,n){for(let s=0;s<a.length;s++)n.writeSVarint(a[s])}function IX(a,n){for(let s=0;s<a.length;s++)n.writeFloat(a[s])}function AX(a,n){for(let s=0;s<a.length;s++)n.writeDouble(a[s])}function PX(a,n){for(let s=0;s<a.length;s++)n.writeBoolean(a[s])}function RX(a,n){for(let s=0;s<a.length;s++)n.writeFixed32(a[s])}function MX(a,n){for(let s=0;s<a.length;s++)n.writeSFixed32(a[s])}function kX(a,n){for(let s=0;s<a.length;s++)n.writeFixed64(a[s])}function DX(a,n){for(let s=0;s<a.length;s++)n.writeSFixed64(a[s])}const kA=3;function NX(a,n,s){n.glyphs=[],a===1&&s.readMessage(LX,n)}function LX(a,n,s){if(a===3){const{id:u,bitmap:h,width:g,height:_,left:x,top:T,advance:C}=s.readMessage(OX,{});n.glyphs.push({id:u,bitmap:new Nh({width:g+2*kA,height:_+2*kA},h),metrics:{width:g,height:_,left:x,top:T,advance:C}})}else a===4?n.ascender=s.readSVarint():a===5&&(n.descender=s.readSVarint())}function OX(a,n,s){a===1?n.id=s.readVarint():a===2?n.bitmap=s.readBytes():a===3?n.width=s.readVarint():a===4?n.height=s.readVarint():a===5?n.left=s.readSVarint():a===6?n.top=s.readSVarint():a===7&&(n.advance=s.readVarint())}const CF=kA,ua={horizontal:1,vertical:2,horizontalOnly:3};class Bx{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(n,s){const u=new Bx;return u.scale=n||1,u.fontStack=s,u}static forImage(n){const s=new Bx;return s.image=n,s}}class y_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,s,u){const h=new y_;for(let g=0;g<n.sections.length;g++){const _=n.sections[g];_.image?h.addImageSection(_,u):h.addTextSection(_,s)}return h}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCodePoint(n){return this.text.codePointAt(n)}verticalizePunctuation(n){this.text=function(s,u){let h="";for(let g=0;g<s.length;g++){const _=s.charCodeAt(g+1)||null,x=s.charCodeAt(g-1)||null;h+=!u&&(_&&Ng(_)&&!jx[s[g+1]]||x&&Ng(x)&&!jx[s[g-1]])||!jx[s[g]]?s[g]:jx[s[g]]}return h}(this.text,n)}trim(){let n=0;for(let u=0;u<this.text.length&&Kw[this.text.charCodeAt(u)];u++)n++;let s=this.text.length;for(let u=this.text.length-1;u>=0&&u>=n&&Kw[this.text.charCodeAt(u)];u--)s--;this.text=this.text.substring(n,s),this.sectionIndex=this.sectionIndex.slice(n,s)}substring(n,s){const u=new y_;return u.text=this.text.substring(n,s),u.sectionIndex=this.sectionIndex.slice(n,s),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,s)=>Math.max(n,this.sections[s].scale),0)}addTextSection(n,s){this.text+=n.text,this.sections.push(Bx.forText(n.scale,n.fontStack||s));const u=this.sections.length-1;for(let h=0;h<n.text.length;++h)this.sectionIndex.push(u)}addImageSection(n,s){const u=n.image?n.image.getPrimary():null;if(!u)return void Nt("Can't add FormattedSection with an empty image.");u.scaleSelf(s);const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(Bx.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Nt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function DA(a,n,s,u,h,g,_,x,T,C,R,M,D,O,j,G=1){const X=y_.fromFeature(a,h,G);M===ua.vertical&&X.verticalizePunctuation(D);let K=[];const se=function(Te,Ie,Re,qe,Ne,Qe){if(!Te)return[];const it=[],rt=function(ut,Ye,Ze,dt,Tt,yt){let Yt=0;for(let kt=0;kt<ut.length();kt++){const Ot=ut.getSection(kt);Yt+=IF(ut.getCodePoint(kt),Ot,dt,Tt,Ye,yt)}return Yt/Math.max(1,Math.ceil(Yt/Ze))}(Te,Ie,Re,qe,Ne,Qe),ht=Te.text.indexOf("")>=0;let pt=0;for(let ut=0;ut<Te.length();ut++){const Ye=Te.getSection(ut),Ze=Te.getCodePoint(ut);if(Kw[Ze]||(pt+=IF(Ze,Ye,qe,Ne,Ie,Qe)),ut<Te.length()-1){const dt=!((ct=Ze)<11904||!(ln["Bopomofo Extended"](ct)||ln.Bopomofo(ct)||ln["CJK Compatibility Forms"](ct)||ln["CJK Compatibility Ideographs"](ct)||ln["CJK Compatibility"](ct)||ln["CJK Radicals Supplement"](ct)||ln["CJK Strokes"](ct)||ln["CJK Symbols and Punctuation"](ct)||ln["CJK Unified Ideographs Extension A"](ct)||ln["CJK Unified Ideographs"](ct)||ln["Enclosed CJK Letters and Months"](ct)||ln["Halfwidth and Fullwidth Forms"](ct)||ln.Hiragana(ct)||ln["Ideographic Description Characters"](ct)||ln["Kangxi Radicals"](ct)||ln["Katakana Phonetic Extensions"](ct)||ln.Katakana(ct)||ln["Vertical Forms"](ct)||ln["Yi Radicals"](ct)||ln["Yi Syllables"](ct)));(FX[Ze]||dt||Ye.image)&&it.push(PF(ut+1,pt,rt,it,zX(Ze,Te.getCodePoint(ut+1),dt&&ht),!1))}}var ct;return RF(PF(Te.length(),pt,rt,it,0,!0))}(X,C,g,n,u,O),{processBidirectionalText:ae,processStyledBidirectionalText:de}=mc;if(ae&&X.sections.length===1){const Te=ae(X.toString(),se);for(const Ie of Te){const Re=new y_;Re.text=Ie,Re.sections=X.sections;for(let qe=0;qe<Ie.length;qe++)Re.sectionIndex.push(0);K.push(Re)}}else if(de){const Te=de(X.text,X.sectionIndex,se);for(const Ie of Te){const Re=new y_;Re.text=Ie[0],Re.sectionIndex=Ie[1],Re.sections=X.sections,K.push(Re)}}else K=function(Te,Ie){const Re=[],qe=Te.text;let Ne=0;for(const Qe of Ie)Re.push(Te.substring(Ne,Qe)),Ne=Qe;return Ne<qe.length&&Re.push(Te.substring(Ne,qe.length)),Re}(X,se);const ve=[],me={positionedLines:ve,text:X.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Te,Ie,Re,qe,Ne,Qe,it,rt,ht,pt,ct,ut){let Ye=0,Ze=0,dt=0;const Tt=rt==="right"?1:rt==="left"?0:.5;let yt=!1;for(const vt of Ne){const $t=vt.getSections();for(const xn of $t){if(xn.image)continue;const Kn=Ie[xn.fontStack];if(Kn&&(yt=Kn.ascender!==void 0&&Kn.descender!==void 0,!yt))break}if(!yt)break}let Yt=0;for(const vt of Ne){vt.trim();const $t=vt.getMaxScale(),xn=($t-1)*ys,Kn={positionedGlyphs:[],lineOffset:0};Te.positionedLines[Yt]=Kn;const Qn=Kn.positionedGlyphs;let An=0;if(!vt.length()){Ze+=Qe,++Yt;continue}let ki=0,ge=0;for(let Je=0;Je<vt.length();Je++){const ft=vt.getSection(Je),At=vt.getSectionIndex(Je),Pt=vt.getCodePoint(Je);let Qt=ft.scale,tn=null,Cn=null,Ln=null,zn=ys,Hn=0,dn=ht;dn===ua.vertical&&((kt=Pt)===12312||kt===12313||kt===12316||kt===12540||kt===12448)&&(dn=ua.horizontal);const vn=!(dn===ua.horizontal||!ct&&!Dg(Pt)||ct&&(Kw[Pt]||Lg(Pt)));if(ft.image){const oi=qe.get(ft.image.toString());if(!oi)continue;Ln=ft.image,Te.iconsInText=Te.iconsInText||!0,Cn=oi.paddedRect;const di=oi.displaySize;Qt=Qt*ys/ut,tn={width:di[0],height:di[1],left:0,top:-CF,advance:vn?di[1]:di[0],localGlyph:!1},Hn=yt?-tn.height*Qt:$t*ys-17-di[1]*Qt,zn=tn.advance;const hi=(vn?di[0]:di[1])*Qt-ys*$t;hi>0&&hi>An&&(An=hi)}else{const oi=Re[ft.fontStack];if(!oi)continue;oi[Pt]&&(Cn=oi[Pt]);const di=Ie[ft.fontStack];if(!di)continue;const hi=di.glyphs[Pt];if(!hi)continue;if(tn=hi.metrics,zn=Pt!==8203?ys:0,yt){const Ii=di.ascender!==void 0?Math.abs(di.ascender):0,ji=di.descender!==void 0?Math.abs(di.descender):0,Di=(Ii+ji)*Qt;ki<Di&&(ki=Di,ge=(Ii-ji)/2*Qt),Hn=-Ii*Qt}else Hn=($t-Qt)*ys-17}vn?(Te.verticalizable=!0,Qn.push({glyph:Pt,image:Ln,x:Ye,y:Ze+Hn,vertical:vn,scale:Qt,localGlyph:tn.localGlyph,fontStack:ft.fontStack,sectionIndex:At,metrics:tn,rect:Cn}),Ye+=zn*Qt+pt):(Qn.push({glyph:Pt,image:Ln,x:Ye,y:Ze+Hn,vertical:vn,scale:Qt,localGlyph:tn.localGlyph,fontStack:ft.fontStack,sectionIndex:At,metrics:tn,rect:Cn}),Ye+=tn.advance*Qt+pt)}Qn.length!==0&&(dt=Math.max(Ye-pt,dt),yt?MF(Qn,Tt,An,ge,Qe*$t/2):MF(Qn,Tt,An,0,Qe/2)),Ye=0;const be=Qe*$t+An;Kn.lineOffset=Math.max(An,xn),Ze+=be,++Yt}var kt;const Ot=Ze,{horizontalAlign:Ut,verticalAlign:jn}=NA(it);(function(vt,$t,xn,Kn,Qn,An){const ki=($t-xn)*Qn,ge=-An*Kn;for(const be of vt)for(const Je of be.positionedGlyphs)Je.x+=ki,Je.y+=ge})(Te.positionedLines,Tt,Ut,jn,dt,Ot),Te.top+=-jn*Ot,Te.bottom=Te.top+Ot,Te.left+=-Ut*dt,Te.right=Te.left+dt,Te.hasBaseline=yt}(me,n,s,u,K,_,x,T,M,C,D,j),!function(Te){for(const Ie of Te)if(Ie.positionedGlyphs.length!==0)return!1;return!0}(ve))return me}const Kw={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},FX={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function IF(a,n,s,u,h,g){if(n.image){const _=u.get(n.image.toString());return _?_.displaySize[0]*n.scale*ys/g+h:0}{const _=s[n.fontStack],x=_&&_.glyphs[a];return x?x.metrics.advance*n.scale+h:0}}function AF(a,n,s,u){const h=Math.pow(a-n,2);return u?a<n?h/2:2*h:h+Math.abs(s)*s}function zX(a,n,s){let u=0;return a===10&&(u-=1e4),s&&(u+=150),a!==40&&a!==65288||(u+=50),n!==41&&n!==65289||(u+=50),u}function PF(a,n,s,u,h,g){let _=null,x=AF(n,s,h,g);for(const T of u){const C=AF(n-T.x,s,h,g)+T.badness;C<=x&&(_=T,x=C)}return{index:a,x:n,priorBreak:_,badness:x}}function RF(a){return a?RF(a.priorBreak).concat(a.index):[]}function NA(a){let n=.5,s=.5;switch(a){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:n,verticalAlign:s}}function MF(a,n,s,u,h){if(!(n||s||u||h))return;const g=a.length-1,_=a[g],x=(_.x+_.metrics.advance*_.scale)*n;for(let T=0;T<=g;T++)a[T].x-=x,a[T].y+=s+u+h}function LA(a){return a.imagePrimary!==void 0&&a.top!==void 0&&a.bottom!==void 0&&a.left!==void 0&&a.right!==void 0}function Xw(a,n,s,u){const{horizontalAlign:h,verticalAlign:g}=NA(u),_=s[0]-a.displaySize[0]*h,x=s[1]-a.displaySize[1]*g;return{imagePrimary:a,imageSecondary:n,top:x,bottom:x+a.displaySize[1],left:_,right:_+a.displaySize[0]}}function OA(a,n,s,u,h,g){const _=a.imagePrimary;let x;if(_.content){const X=_.content,K=_.pixelRatio||1;x=[X[0]/K,X[1]/K,_.displaySize[0]-X[2]/K,_.displaySize[1]-X[3]/K]}const T=n.left*g,C=n.right*g;let R,M,D,O;s==="width"||s==="both"?(O=h[0]+T-u[3],M=h[0]+C+u[1]):(O=h[0]+(T+C-_.displaySize[0])/2,M=O+_.displaySize[0]);const j=n.top*g,G=n.bottom*g;return s==="height"||s==="both"?(R=h[1]+j-u[0],D=h[1]+G+u[2]):(R=h[1]+(j+G-_.displaySize[1])/2,D=R+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:R,right:M,bottom:D,left:O,collisionPadding:x}}function kF(a){return!a.imagePrimary.stretchX}function DF(a){return!a.imagePrimary.stretchY}function NF(a){return{width:a.right-a.left,height:a.bottom-a.top}}const Sc=128;function v_(a,n,s){const{expression:u}=n;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Wi(a+1,{worldview:s}))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:g}=u;let _=0;for(;_<h.length&&h[_]<=a;)_++;_=Math.max(0,_-1);let x=_;for(;x<h.length&&h[x]<a+1;)x++;x=Math.min(h.length-1,x);const T=h[_],C=h[x];return u.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:C,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:C,minSize:u.evaluate(new Wi(T,{worldview:s})),maxSize:u.evaluate(new Wi(C,{worldview:s})),interpolationType:g}}}function FA(a,{uSize:n,uSizeT:s},{lowerSize:u,upperSize:h}){return a.kind==="source"?u/Sc:a.kind==="composite"?fn(u/Sc,h/Sc,s):n}function x_(a,n,s=1){let u=0,h=0;if(a.kind==="constant")h=a.layoutSize*s;else if(a.kind!=="source"){const{interpolationType:g,minZoom:_,maxZoom:x}=a,T=g?Y(sa.interpolationFactor(g,n,_,x),0,1):0;a.kind==="camera"?h=fn(a.minSize,a.maxSize,T)*s:u=T*s}return{uSizeT:u,uSize:h}}class Ad extends st{constructor(n,s,u,h,g){super(n,s),this.angle=h,this.z=u,g!==void 0&&(this.segment=g)}clone(){return new Ad(this.x,this.y,this.z,this.angle,this.segment)}}function LF(a,n,s,u,h){if(n.segment===void 0)return!0;let g=n,_=n.segment+1,x=0;for(;x>-s/2;){if(_--,_<0)return!1;x-=a[_].dist(g),g=a[_]}x+=a[_].dist(a[_+1]),_++;const T=[];let C=0;for(;x<s/2;){const R=a[_],M=a[_+1];if(!M)return!1;let D=a[_-1].angleTo(R)-R.angleTo(M);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:x,angleDelta:D}),C+=D;x-T[0].distance>u;)C-=T.shift().angleDelta;if(C>h)return!1;_++,x+=R.dist(M)}return!0}function OF(a){let n=0;for(let s=0;s<a.length-1;s++)n+=a[s].dist(a[s+1]);return n}function FF(a,n,s){return a?.6*n*s:0}function zF(a,n){return Math.max(a?a.right-a.left:0,n?n.right-n.left:0)}function jX(a,n,s,u,h,g){const _=FF(s,h,g),x=zF(s,u)*g;let T=0;const C=OF(a)/2;for(let R=0;R<a.length-1;R++){const M=a[R],D=a[R+1],O=M.dist(D);if(T+O>C){const j=(C-T)/O,G=fn(M.x,D.x,j),X=fn(M.y,D.y,j),K=new Ad(G,X,0,D.angleTo(M),R);return!_||LF(a,K,x,_,n)?K:void 0}T+=O}}function BX(a,n,s,u,h,g,_,x,T){const C=FF(u,g,_),R=zF(u,h),M=R*_,D=a[0].x===0||a[0].x===T||a[0].y===0||a[0].y===T;return n-M<n/4&&(n=M+n/4),jF(a,D?n/2*x%n:(R/2+2*g)*_*x%n,n,C,s,M,D,!1,T)}function jF(a,n,s,u,h,g,_,x,T){const C=g/2,R=OF(a);let M=0,D=n-s,O=[];for(let j=0;j<a.length-1;j++){const G=a[j],X=a[j+1],K=G.dist(X),se=X.angleTo(G);for(;D+s<M+K;){D+=s;const ae=(D-M)/K,de=fn(G.x,X.x,ae),ve=fn(G.y,X.y,ae);if(de>=0&&de<T&&ve>=0&&ve<T&&D-C>=0&&D+C<=R){const me=new Ad(de,ve,0,se,j);u&&!LF(a,me,g,u,h)||O.push(me)}}M+=K}return x||O.length||_||(O=jF(a,M/2,s,u,h,g,_,!0,T)),O}function BF(a){let n=0,s=0;for(const _ of a)n+=_.w*_.h,s=Math.max(s,_.w);a.sort((_,x)=>x.h-_.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),s),h:1/0}];let h=0,g=0;for(const _ of a)for(let x=u.length-1;x>=0;x--){const T=u[x];if(!(_.w>T.w||_.h>T.h)){if(_.x=T.x,_.y=T.y,g=Math.max(g,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===T.w&&_.h===T.h){const C=u.pop();C&&x<u.length&&(u[x]=C)}else _.h===T.h?(T.x+=_.w,T.w-=_.w):_.w===T.w?(T.y+=_.h,T.h-=_.h):(u.push({x:T.x+_.w,y:T.y,w:T.w-_.w,h:_.h}),T.y+=_.h,T.h-=_.h);break}}return{w:h,h:g,fill:n/(h*g)||0}}jt(Ad,"Anchor");const Hp=1;class Vx{static getImagePositionScale(n,s,u){if(s&&n){const{sx:h,sy:g}=n;return{x:h,y:g}}return{x:u,y:u}}constructor(n,s,u,h){this.paddedRect=n;const{pixelRatio:g,version:_,stretchX:x,stretchY:T,content:C,sdf:R,usvg:M}=s;this.pixelRatio=g,this.stretchX=x,this.stretchY=T,this.content=C,this.version=_,this.padding=u,this.sdf=R,this.usvg=M,this.scale=Vx.getImagePositionScale(h,M,g)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function zA(a,n,s){const u=lc.parse(a),h=function(g,_,x=[1,1]){return{x:0,y:0,w:(g.data?g.data.width:g.width*x[0])+2*_,h:(g.data?g.data.height:g.height*x[1])+2*_}}(n,s,[u.sx,u.sy]);return{bin:h,imagePosition:new Vx(h,n,s,u),imageVariant:u}}class VF{constructor(n,s,u){const h=new Map,g=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(n,h,Hp,_),this.addImages(s,g,2,_);const{w:x,h:T}=BF(_),C=new eo({width:x||1,height:T||1});for(const[R,M]of n.entries()){const D=h.get(R).paddedRect;eo.copy(M.data,C,{x:0,y:0},{x:D.x+Hp,y:D.y+Hp},M.data,null,M.sdf)}for(const[R,M]of s.entries()){const D=g.get(R),O=D.paddedRect;let j=D.padding;const G=O.x+j,X=O.y+j,K=M.data.width,se=M.data.height;j=j>1?j-1:j,eo.copy(M.data,C,{x:0,y:0},{x:G,y:X},M.data,u),eo.copy(M.data,C,{x:0,y:se-j},{x:G,y:X-j},{width:K,height:j},u),eo.copy(M.data,C,{x:0,y:0},{x:G,y:X+se},{width:K,height:j},u),eo.copy(M.data,C,{x:K-j,y:0},{x:G-j,y:X},{width:j,height:se},u),eo.copy(M.data,C,{x:0,y:0},{x:G+K,y:X},{width:j,height:se},u),eo.copy(M.data,C,{x:K-j,y:se-j},{x:G-j,y:X-j},{width:j,height:j},u),eo.copy(M.data,C,{x:0,y:se-j},{x:G+K,y:X-j},{width:j,height:j},u),eo.copy(M.data,C,{x:0,y:0},{x:G+K,y:X+se},{width:j,height:j},u),eo.copy(M.data,C,{x:K-j,y:0},{x:G-j,y:X+se},{width:j,height:j},u)}this.lut=u,this.image=C,this.iconPositions=h,this.patternPositions=g}addImages(n,s,u,h){for(const[g,_]of n.entries()){const{bin:x,imagePosition:T,imageVariant:C}=zA(g,_,u);s.set(g,T),h.push(x),_.hasRenderCallback&&this.haveRenderCallbacks.push(C.id)}}patchUpdatedImages(n,s,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>n.hasImage(h,u)),n.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const h of n.getUpdatedImages(u)){for(const g of this.iconPositions.keys()){const _=lc.parse(g);if(so.isEqual(_.id,h)){const x=n.getImage(h,u);this.patchUpdatedImage(this.iconPositions.get(g),x,s,null)}}for(const g of this.patternPositions.keys()){const _=lc.parse(g);if(so.isEqual(_.id,h)){const x=n.getImage(h,u);this.patchUpdatedImage(this.patternPositions.get(g),x,s,this.lut)}}}}patchUpdatedImage(n,s,u,h=null){if(!n||!s||n.version===s.version)return;n.version=s.version;const[g,_]=n.tl,x=n.sdf;if(this.lut||x){const T={width:s.data.width,height:s.data.height},C=new eo(T);eo.copy(s.data,C,{x:0,y:0},{x:0,y:0},T,h,x),u.update(C,{position:{x:g,y:_}})}else u.update(s.data,{position:{x:g,y:_}})}}jt(Vx,"ImagePosition"),jt(VF,"ImageAtlas");const Ux=1e20;function UF(a,n,s,u,h,g,_,x,T){for(let C=n;C<n+u;C++)$F(a,s*g+C,g,h,_,x,T);for(let C=s;C<s+h;C++)$F(a,C*g+n,1,u,_,x,T)}function $F(a,n,s,u,h,g,_){g[0]=0,_[0]=-Ux,_[1]=Ux,h[0]=a[n];for(let x=1,T=0,C=0;x<u;x++){h[x]=a[n+x*s];const R=x*x;do{const M=g[T];C=(h[x]-h[M]+R-M*M)/(x-M)/2}while(C<=_[T]&&--T>-1);T++,g[T]=x,_[T]=C,_[T+1]=Ux}for(let x=0,T=0;x<u;x++){for(;_[T+1]<x;)T++;const C=g[T],R=x-C;a[n+x*s]=h[C]+R*R}}const Cc=2,jA={none:0,ideographs:1,all:2};class b_{constructor(n,s,u){this.requestManager=n,this.localGlyphMode=s,this.localFontFamily=u,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n){this.url=n}getGlyphs(n,s){const u=[],h=this.url||qn.GLYPHS_URL;for(const g in n)for(const _ of n[g])u.push({stack:g,id:_});Ae(u,({stack:g,id:_},x)=>{let T=this.entries[g];T||(T=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=T.glyphs[_];if(C!==void 0)return void x(null,{stack:g,id:_,glyph:C});if(C=this._tinySDF(T,g,_),C)return T.glyphs[_]=C,void x(null,{stack:g,id:_,glyph:C});const R=Math.floor(_/256);if(256*R>65535)return Nt("glyphs > 65535 not supported"),void x(null,{stack:g,id:_,glyph:C});if(T.ranges[R])return void x(null,{stack:g,id:_,glyph:C});let M=T.requests[R];M||(M=T.requests[R]=[],b_.loadGlyphRange(g,R,h,this.requestManager,(D,O)=>{if(O){T.ascender=O.ascender,T.descender=O.descender;for(const j in O.glyphs)this._doesCharSupportLocalGlyph(+j)||(T.glyphs[+j]=O.glyphs[+j]);T.ranges[R]=!0}for(const j of M)j(D,O);delete T.requests[R]})),M.push((D,O)=>{D?x(D):O&&x(null,{stack:g,id:_,glyph:O.glyphs[_]||null})})},(g,_)=>{if(g)s(g);else if(_){const x={};for(const{stack:T,id:C,glyph:R}of _)x[T]===void 0&&(x[T]={}),x[T].glyphs===void 0&&(x[T].glyphs={}),x[T].glyphs[C]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics},x[T].ascender=this.entries[T].ascender,x[T].descender=this.entries[T].descender;s(null,x)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==jA.none&&(this.localGlyphMode===jA.all?!!this.localFontFamily:!!this.localFontFamily&&(ln["CJK Unified Ideographs"](n)||ln["Hangul Syllables"](n)||ln.Hiragana(n)||ln.Katakana(n)||ln["CJK Symbols and Punctuation"](n)||ln["CJK Unified Ideographs Extension A"](n)||ln["CJK Unified Ideographs Extension B"](n)||ln.Osage(n)))}_tinySDF(n,s,u){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(u))return;let g=n.tinySDF;if(!g){let G="400";/bold/i.test(s)?G="900":/medium/i.test(s)?G="500":/light/i.test(s)&&(G="200"),g=n.tinySDF=new b_.TinySDF({fontFamily:h,fontWeight:G,fontSize:24*Cc,buffer:3*Cc,radius:8*Cc}),g.fontWeight=G}if(this.localGlyphs[g.fontWeight][u])return this.localGlyphs[g.fontWeight][u];const _=String.fromCodePoint(u),{data:x,width:T,height:C,glyphWidth:R,glyphHeight:M,glyphLeft:D,glyphTop:O,glyphAdvance:j}=g.draw(_);return this.localGlyphs[g.fontWeight][u]={id:u,bitmap:new Nh({width:T,height:C},x),metrics:{width:R/Cc,height:M/Cc,left:D/Cc,top:O/Cc-27,advance:j/Cc,localGlyph:!0}}}}b_.loadGlyphRange=function(a,n,s,u,h){const g=256*n,_=g+255,x=u.transformRequest(u.normalizeGlyphsURL(s).replace("{fontstack}",a).replace("{range}",`${g}-${_}`),np.Glyphs);ac(x,(T,C)=>{if(T)h(T);else if(C){const R={},M=function(D){return new Zw(D).readFields(NX,{})}(C);for(const D of M.glyphs)R[D.id]=D;h(null,{glyphs:R,ascender:M.ascender,descender:M.descender})}})},b_.TinySDF=class{constructor({fontSize:a=24,buffer:n=3,radius:s=8,cutoff:u=.25,fontFamily:h="sans-serif",fontWeight:g="normal",fontStyle:_="normal",lang:x=null}={}){this.buffer=n,this.cutoff=u,this.radius=s,this.lang=x;const T=this.size=a+4*n,C=this._createCanvas(T),R=this.ctx=C.getContext("2d",{willReadFrequently:!0});R.font=`${_} ${g} ${a}px ${h}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(a){const n=document.createElement("canvas");return n.width=n.height=a,n}draw(a){const{width:n,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:h,actualBoundingBoxRight:g}=this.ctx.measureText(a),_=Math.ceil(s),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-h))),T=Math.min(this.size-this.buffer,_+Math.ceil(u)),C=x+2*this.buffer,R=T+2*this.buffer,M=Math.max(C*R,0),D=new Uint8ClampedArray(M),O={data:D,width:C,height:R,glyphWidth:x,glyphHeight:T,glyphTop:_,glyphLeft:0,glyphAdvance:n};if(x===0||T===0)return O;const{ctx:j,buffer:G,gridInner:X,gridOuter:K}=this;this.lang&&(j.lang=this.lang),j.clearRect(G,G,x,T),j.fillText(a,G,G+_);const se=j.getImageData(G,G,x,T);K.fill(Ux,0,M),X.fill(0,0,M);for(let ae=0;ae<T;ae++)for(let de=0;de<x;de++){const ve=se.data[4*(ae*x+de)+3]/255;if(ve===0)continue;const me=(ae+G)*C+de+G;if(ve===1)K[me]=0,X[me]=Ux;else{const Te=.5-ve;K[me]=Te>0?Te*Te:0,X[me]=Te<0?Te*Te:0}}UF(K,0,0,C,R,C,this.f,this.v,this.z),UF(X,G,G,x,T,C,this.f,this.v,this.z);for(let ae=0;ae<M;ae++){const de=Math.sqrt(K[ae])-Math.sqrt(X[ae]);D[ae]=Math.round(255-255*(de/this.radius+this.cutoff))}return O}};const Ru=Hp;function GF(a,n){return a+n[1]-n[0]}function BA(a,n,s,u,h=1){const g=[],_=a.imagePrimary,x=_.pixelRatio,T=_.paddedRect.w-2*Ru,C=_.paddedRect.h-2*Ru,R=(a.right-a.left)*h,M=(a.bottom-a.top)*h,D=_.stretchX||[[0,T]],O=_.stretchY||[[0,C]],j=D.reduce(GF,0),G=O.reduce(GF,0),X=T-j,K=C-G;let se=0,ae=j,de=0,ve=G,me=0,Te=X,Ie=0,Re=K;if(_.content&&u){const Ne=_.content;se=Yw(D,0,Ne[0]),de=Yw(O,0,Ne[1]),ae=Yw(D,Ne[0],Ne[2]),ve=Yw(O,Ne[1],Ne[3]),me=Ne[0]-se,Ie=Ne[1]-de,Te=Ne[2]-Ne[0]-ae,Re=Ne[3]-Ne[1]-ve}const qe=(Ne,Qe,it,rt)=>{const ht=Qw(Ne.stretch-se,ae,R,a.left*h),pt=Jw(Ne.fixed-me,Te,Ne.stretch,j),ct=Qw(Qe.stretch-de,ve,M,a.top*h),ut=Jw(Qe.fixed-Ie,Re,Qe.stretch,G),Ye=Qw(it.stretch-se,ae,R,a.left*h),Ze=Jw(it.fixed-me,Te,it.stretch,j),dt=Qw(rt.stretch-de,ve,M,a.top*h),Tt=Jw(rt.fixed-Ie,Re,rt.stretch,G),yt=new st(ht,ct),Yt=new st(Ye,ct),kt=new st(Ye,dt),Ot=new st(ht,dt),Ut=new st(pt/x,ut/x),jn=new st(Ze/x,Tt/x),vt=n*Math.PI/180;if(vt){const ki=Math.sin(vt),ge=Math.cos(vt),be=[ge,-ki,ki,ge];yt._matMult(be),Yt._matMult(be),Ot._matMult(be),kt._matMult(be)}const $t=Ne.stretch+Ne.fixed,xn=it.stretch+it.fixed,Kn=Qe.stretch+Qe.fixed,Qn=rt.stretch+rt.fixed,An=a.imageSecondary;return{tl:yt,tr:Yt,bl:Ot,br:kt,texPrimary:{x:_.paddedRect.x+Ru+$t,y:_.paddedRect.y+Ru+Kn,w:xn-$t,h:Qn-Kn},texSecondary:An?{x:An.paddedRect.x+Ru+$t,y:An.paddedRect.y+Ru+Kn,w:xn-$t,h:Qn-Kn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ut,pixelOffsetBR:jn,minFontScaleX:Te/x/R,minFontScaleY:Re/x/M,isSDF:s}};if(u&&(_.stretchX||_.stretchY)){const Ne=HF(D,X,j),Qe=HF(O,K,G);for(let it=0;it<Ne.length-1;it++){const rt=Ne[it],ht=Ne[it+1];for(let pt=0;pt<Qe.length-1;pt++)g.push(qe(rt,Qe[pt],ht,Qe[pt+1]))}}else g.push(qe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:C+1}));return g}function VX(a,n){const s=a.stretchY||[[0,a.paddedRect.h-2*Ru]];return n&&(a.stretchX||a.stretchY)?WF(a.stretchX||[[0,a.paddedRect.w-2*Ru]])*WF(s):1}function Yw(a,n,s){let u=0;for(const h of a)u+=Math.max(n,Math.min(s,h[1]))-Math.max(n,Math.min(s,h[0]));return u}function HF(a,n,s){const u=[{fixed:-Ru,stretch:0}];for(const[h,g]of a){const _=u[u.length-1];u.push({fixed:h-_.stretch,stretch:_.stretch}),u.push({fixed:h-_.stretch,stretch:_.stretch+(g-h)})}return u.push({fixed:n+Ru,stretch:s}),u}function WF(a){return 2*a.length+1}function Qw(a,n,s,u){return a/n*s+u}function Jw(a,n,s,u){return a-n*s/u}function UX(a,n,s,u){const h=n+a.positionedLines[u].lineOffset;return u===0?s+h/2:s+(h+(n+a.positionedLines[u-1].lineOffset))/2}function $X(a,n=1,s=!1){let u=1/0,h=1/0,g=-1/0,_=-1/0;const x=a[0];for(let O=0;O<x.length;O++){const j=x[O];(!O||j.x<u)&&(u=j.x),(!O||j.y<h)&&(h=j.y),(!O||j.x>g)&&(g=j.x),(!O||j.y>_)&&(_=j.y)}const T=Math.min(g-u,_-h);let C=T/2;const R=new dg([],GX);if(T===0)return new st(u,h);for(let O=u;O<g;O+=T)for(let j=h;j<_;j+=T)R.push(new w_(O+C,j+C,C,a));let M=function(O){let j=0,G=0,X=0;const K=O[0];for(let se=0,ae=K.length,de=ae-1;se<ae;de=se++){const ve=K[se],me=K[de],Te=ve.x*me.y-me.x*ve.y;G+=(ve.x+me.x)*Te,X+=(ve.y+me.y)*Te,j+=3*Te}return new w_(G/j,X/j,0,O)}(a),D=R.length;for(;R.length;){const O=R.pop();(O.d>M.d||!M.d)&&(M=O,s&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,D)),O.max-M.d<=n||(C=O.h/2,R.push(new w_(O.p.x-C,O.p.y-C,C,a)),R.push(new w_(O.p.x+C,O.p.y-C,C,a)),R.push(new w_(O.p.x-C,O.p.y+C,C,a)),R.push(new w_(O.p.x+C,O.p.y+C,C,a)),D+=4)}return s&&(console.log(`num probes: ${D}`),console.log(`best distance: ${M.d}`)),M.p}function GX(a,n){return n.max-a.max}class w_{constructor(n,s,u,h){this.p=new st(n,s),this.h=u,this.d=function(g,_){let x=!1,T=1/0;for(let C=0;C<_.length;C++){const R=_[C];for(let M=0,D=R.length,O=D-1;M<D;O=M++){const j=R[M],G=R[O];j.y>g.y!=G.y>g.y&&g.x<(G.x-j.x)*(g.y-j.y)/(G.y-j.y)+j.x&&(x=!x),T=Math.min(T,Ar(g,j,G))}}return(x?1:-1)*Math.sqrt(T)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const HX=Object.keys,VA=Number.POSITIVE_INFINITY,WX=Math.sqrt(2);function Oh(a,n,s,u,h){const g=LA(a)&&a.collisionPadding?a.collisionPadding:[0,0,0,0],_={top:a.top-g[1],bottom:a.bottom+g[3],left:a.left-g[0],right:a.right+g[2],scaled:!1};return u!==void 0&&function(x,T){x.top*=T,x.bottom*=T,x.left*=T,x.right*=T,x.scaled=!0}(_,u),s&&function(x,T){if(!T)return;const C=$n(T),R=new st(x.left,x.top),M=new st(x.right,x.top),D=new st(x.left,x.bottom),O=new st(x.right,x.bottom),j=new st(0,0);R._rotateAround(C,j),M._rotateAround(C,j),D._rotateAround(C,j),O._rotateAround(C,j),x.left=Math.min(R.x,M.x,D.x,O.x),x.right=Math.max(R.x,M.x,D.x,O.x),x.top=Math.min(R.y,M.y,D.y,O.y),x.bottom=Math.max(R.y,M.y,D.y,O.y)}(_,s),h&&(_.left+=h[0],_.right+=h[0],_.top+=h[1],_.bottom+=h[1]),n?{top:Math.min(n.top,_.top),bottom:Math.max(n.bottom,_.bottom),left:Math.min(n.left,_.left),right:Math.max(n.right,_.right),scaled:n.scaled||_.scaled}:_}function qF(a,[n,s]){let u=0,h=0;if(s===VA){n<0&&(n=0);const g=n/WX;switch(a){case"top-right":case"top-left":h=g-7;break;case"bottom-right":case"bottom-left":h=7-g;break;case"bottom":h=7-n;break;case"top":h=n-7}switch(a){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=n;break;case"right":u=-n}}else{switch(n=Math.abs(n),s=Math.abs(s),a){case"top-right":case"top-left":case"top":h=s-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-s}switch(a){case"top-right":case"bottom-right":case"right":u=-n;break;case"top-left":case"bottom-left":case"left":u=n}}return[u,h]}function qX(a,n,s,u,h,g,_,x,T,C,R,M,D,O){const j=a.layers[0],G=j.appearances;if(G.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const X={iconBBox:null,iconVerticalBBox:null},K={textBBox:null,textVerticalBBox:null},{baseIconRotate:se,baseTextRotate:ae,iconScaleFactor:de}=function(me,Te,Ie){const Re=me.get("icon-rotate").evaluate(Te,{},Ie),qe=me.get("text-rotate").evaluate(Te,{},Ie),[Ne,Qe]=me.get("icon-size-scale-range");return{baseIconRotate:Re,baseTextRotate:qe,iconScaleFactor:Y(1,Ne,Qe)}}(u,h,g);n&&(X.iconBBox=Oh(n,X.iconBBox,se,_),s)&&(X.iconVerticalBBox=Oh(s,X.iconVerticalBBox,se+90,_));const ve=tT(M.horizontal);ve&&(K.textBBox=Oh(ve,K.textBBox,ae,1,O)),M.vertical&&(K.textVerticalBBox=Oh(M.vertical,K.textVerticalBBox,ae+90,1,O));for(const me of G)me.hasIconProperties()&&ZX(X,a,j,me,h,g,x,se,_,T,n,C,de,R),me.hasTextProperties()&&KX(K,j,me,h,g,O,ae,D,ve,M.vertical);return{iconBBox:X.iconBBox,iconVerticalBBox:X.iconVerticalBBox,textBBox:K.textBBox,textVerticalBBox:K.textVerticalBBox}}function ZX(a,n,s,u,h,g,_,x,T,C,R,M,D,O){const{appearanceIconOffset:j,appearanceIconRotate:G,appearanceIconSize:X}=function(de,ve,me,Te,Ie,Re,qe,Ne){const Qe=de.hasProperty("icon-offset")?ve.getAppearanceValueAndResolveTokens(de,"icon-offset",me,Te,[]):null,it=Qe&&Array.isArray(Qe)?Qe:Ie,rt=de.hasProperty("icon-rotate")?ve.getAppearanceValueAndResolveTokens(de,"icon-rotate",me,Te,[]):null,ht=typeof rt=="number"?rt:Re,pt=de.hasProperty("icon-size")?ve.getAppearanceValueAndResolveTokens(de,"icon-size",me,Te,[]):null;return{appearanceIconOffset:it,appearanceIconRotate:ht,appearanceIconSize:typeof pt=="number"?pt*Ne.iconScaleFactor:qe}}(u,s,h,g,_,x,T,C);let K=null,se=null,ae=null;u.hasProperty("icon-image")?ae=function(de,ve,me,Te,Ie,Re,qe){let Ne=null;const Qe=ve.getAppearanceValueAndResolveTokens(me,"icon-image",Te,Ie,[]);if(Qe){const it=de.getResolvedImageFromTokens(Qe),rt=me.getUnevaluatedProperty("icon-size"),ht=$x(it,v_(de.zoom,rt,de.worldview),rt,Ie,de.zoom,Te,de.pixelRatio,qe,de.worldview);Ne=Re.get(ht.iconPrimary.toString())}return Ne}(n,s,u,h,g,M,D):R&&(ae=R.imagePrimary),ae&&(K=Xw(ae,null,j,O),n.allowVerticalPlacement&&(se=Xw(ae,null,j,O))),K&&(a.iconBBox=Oh(K,a.iconBBox,G,X)),se&&(a.iconVerticalBBox=Oh(se,a.iconVerticalBBox,G+90,X))}function KX(a,n,s,u,h,g,_,x,T,C){const{appearanceTextOffset:R,appearanceTextRotate:M,appearanceTextSize:D}=function(j,G,X,K,se,ae,de){const ve=j.hasProperty("text-offset")?G.getAppearanceValueAndResolveTokens(j,"text-offset",X,K,[]):null,me=ve&&Array.isArray(ve)?[ve[0]*ys,ve[1]*ys]:se,Te=j.hasProperty("text-rotate")?G.getAppearanceValueAndResolveTokens(j,"text-rotate",X,K,[]):null,Ie=typeof Te=="number"?Te:ae,Re=j.hasProperty("text-size")?G.getAppearanceValueAndResolveTokens(j,"text-size",X,K,[]):null;return{appearanceTextOffset:me,appearanceTextRotate:Ie,appearanceTextSize:typeof Re=="number"?Re:de}}(s,n,u,h,g,_,x),O=D/x;T&&(a.textBBox=Oh(T,a.textBBox,M,O,R)),C&&(a.textVerticalBBox=Oh(C,a.textVerticalBBox,M+90,O,R))}function eT(a,n,s,u,h,g,_,x,T){if(!n||!n.usvg)return;const C=NF(u),R=NF(h),M=g!=="both"&&g!=="width"||!kF(u)?1:R.width/C.width,D=g!=="both"&&g!=="height"||!DF(u)?1:R.height/C.height;s.scaleSelf(M,D);const O=s.toString();_.set(O,s),x.set(O,n);const{imagePosition:j}=zA(O,n,Hp);T.set(O,j)}function ZF(a,n,s,u,h,g,_,x,T){if(!a)return;const C=function(R,M,D,O,j,G){if(R.kind==="camera")return R.maxSize;if(R.kind==="composite"){const X=M.possiblyEvaluate(new Wi(R.maxZoom,{worldview:G}),D).evaluate(j,{},D),K=M.possiblyEvaluate(new Wi(R.minZoom,{worldview:G}),D).evaluate(j,{},D);return Math.max(X,K)}return M.possiblyEvaluate(new Wi(O,{worldview:G})).evaluate(j,{},D)}(n,s,u,h,g,T);return a.scaleSelf(C*x*_)}function $x(a,n,s,u,h,g,_,x,T){return{iconPrimary:ZF(a.getPrimary(),n,s,u,h,g,_,x,T),iconSecondary:ZF(a.getSecondary(),n,s,u,h,g,_,x,T)}}function XX(a,n,s){if(!n)return;const u=s.get(a.toString()),h=s.get(n.toString());u&&h&&(u.paddedRect.w===h.paddedRect.w&&u.paddedRect.h===h.paddedRect.h||Nt(`Mismatch in icon variant sizes: ${a.toString()} and ${n.toString()}`),u.usvg!==h.usvg&&Nt(`Mismatch in icon variant image types: ${a.id} and ${n.id}`))}function KF(a,n,s,u){if(!a)return;const h=n.get(s.toString());if(a.imagePrimary=h,u){const g=n.get(u.toString());a.imageSecondary=g}}function YX(a,n){for(const s in a.horizontal)XF(a.horizontal[s],n);XF(a.vertical,n)}function XF(a,n){if(a){for(const s of a.positionedLines)for(const u of s.positionedGlyphs)if(u.image!==null){const h=u.image.toString();u.rect=n.get(h).paddedRect}}}function UA(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function QX(a,n,s,u,h,g,_,x,T){const C=tT(g.horizontal)||g.vertical,R=s.get("icon-text-fit-padding").evaluate(u,{},h);let M,D=n;return n&&T!=="none"&&(a.allowVerticalPlacement&&g.vertical&&(M=OA(n,g.vertical,T,R,x,_)),C&&(D=OA(n,C,T,R,x,_))),{defaultShapedIcon:D,verticallyShapedIcon:M}}function JX(a,n,s,u,h,g,_,x,T,C,R,M,D,O,j,G,X,K,se,ae,de,ve,me,Te){let Ie=_.textMaxSize.evaluate(n,{},D);Ie===void 0?Ie=x*_.textScaleFactor:Ie*=_.textScaleFactor;const Re=a.layers[0].layout,qe=ys,Ne=x*_.textScaleFactor/qe,Qe=tT(s.horizontal)||s.vertical;if(X!=="none"&&a.appearanceFeatureData&&n.index<a.appearanceFeatureData.length){const kt=a.appearanceFeatureData[n.index];kt&&(kt.textShaping=Qe,kt.iconTextFitPadding=Re.get("icon-text-fit-padding").evaluate(n,{},D),kt.fontScale=Ne)}const it=O.name==="globe",rt=a.tilePixelRatio*Ie/qe,ht=(dt=a.overscaling,a.zoom>18&&dt>2&&(dt>>=1),Math.max(wt/(512*dt),1)*Re.get("symbol-spacing")),pt=Re.get("text-padding")*a.tilePixelRatio,ct=Re.get("icon-padding")*a.tilePixelRatio,ut=$n(Re.get("text-max-angle")),Ye=Re.get("icon-rotation-alignment")==="map"&&ae!=="point",Ze=ht/2;var dt;a.hasAnyIconTextFit===!1&&X!=="none"&&(a.hasAnyIconTextFit=!0);const Tt=n.properties?+n.properties[Xe]:null,yt=Tt&&a.elevationFeatureIdToIndex?a.elevationFeatureIdToIndex.get(Tt):65535,Yt=(kt,Ot,Ut)=>{if(Ot.x<0||Ot.x>=wt||Ot.y<0||Ot.y>=wt)return;let jn=null;if(it){const{x:vt,y:$t,z:xn}=O.projectTilePoint(Ot.x,Ot.y,Ut);jn={anchor:new Ad(vt,$t,xn,0,void 0),up:O.upVector(Ut,Ot.x,Ot.y)}}(function(vt,$t,xn,Kn,Qn,An,ki,ge,be,Je,ft,At,Pt,Qt,tn,Cn,Ln,zn,Hn,dn,vn,oi,di,hi,Ii,ji,Di,pi,vi,On,Yn,lr,cn){const Wn=vt.addToLineVertexArray($t,Kn);let Ni,Vi,qi,Lr,Gi,un,pr,Ai=0,rr=0,ns=0,vs=0,Hr=-1,Wr=-1;const ds={};let Lo=Jm("");const Hi=xn?xn.anchor:$t,Pr=pi!=="none";let Or=0,Wo=0;if(be._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Us=be.layout.get("text-offset").evaluate(vn,{},Ii);Or=Us[0]*ys,Wo=Us[1]*ys}else Or=be.layout.get("text-radial-offset").evaluate(vn,{},Ii)*ys,Wo=VA;if(vt.allowVerticalPlacement&&Qn.vertical){const Us=Qn.vertical;if(tn)un=$A(Us),ge&&(pr=$A(ge));else{const wo=be.layout.get("text-rotate").evaluate(vn,{},Ii)+90;qi=nT(Je,Hi,$t,ft,At,Pt,Us,Qt,wo,Cn,lr),ge&&(Lr=nT(Je,Hi,$t,ft,At,Pt,ge,zn,wo,null,Yn))}}if(An){const Us=vt.iconSizeData,wo=be.layout.get("icon-rotate").evaluate(vn,{},Ii),da=BA(An,wo,di,Pr,oi.iconScaleFactor),jh=ge?BA(ge,wo,di,Pr,oi.iconScaleFactor):void 0;Vi=nT(Je,Hi,$t,ft,At,Pt,An,zn,wo,null,On);const P_=function(Rc,a0,m3,dQ,g3,_3,hQ,fQ){const y3=Rc.layers[0],v3=y3.appearances;let R_=a0.length;if(m3&&(R_=Math.max(R_,m3.length)),v3.length===0)return R_;const[pQ,mQ]=dQ.get("icon-size-scale-range"),gQ=Y(1,pQ,mQ);for(const x3 of v3){const b3=x3.getUnevaluatedProperties();if(b3._values["icon-image"].value!==void 0){const w3=y3.getAppearanceValueAndResolveTokens(x3,"icon-image",g3,_3,[]);if(w3){const T3=Rc.getResolvedImageFromTokens(w3);if(T3){const E3=b3._values["icon-size"],_Q=$x(T3,v_(Rc.zoom,E3,Rc.worldview),E3,_3,Rc.zoom,g3,Rc.pixelRatio,gQ,Rc.worldview),yQ=hQ.get(_Q.iconPrimary.toString());R_=Math.max(R_,VX(yQ,fQ))}}}}return R_}(vt,da,jh,be.layout,vn,Ii,vt.iconAtlasPositions,Pr);Ai=4*P_;let Pc=null;Us.kind==="source"?(Pc=[Sc*be.layout.get("icon-size").evaluate(vn,{},Ii)*oi.iconScaleFactor],Pc[0]>Pd&&Nt(`${vt.layerIds[0]}: Value for "icon-size" is >= ${Gx}. Reduce your "icon-size".`)):Us.kind==="composite"&&(Pc=[Sc*oi.compositeIconSizes[0].evaluate(vn,{},Ii)*oi.iconScaleFactor,Sc*oi.compositeIconSizes[1].evaluate(vn,{},Ii)*oi.iconScaleFactor],(Pc[0]>Pd||Pc[1]>Pd)&&Nt(`${vt.layerIds[0]}: Value for "icon-size" is >= ${Gx}. Reduce your "icon-size".`)),vt.addSymbols(vt.icon,da,Pc,dn,Hn,vn,void 0,xn,$t,Wn.lineStartIndex,Wn.lineLength,-1,hi,Ii,ji,Di,vt.symbolInstances.length,P_),Hr=vt.icon.placedSymbolArray.length-1,jh&&(rr=4*P_,vt.addSymbols(vt.icon,jh,Pc,dn,Hn,vn,ua.vertical,xn,$t,Wn.lineStartIndex,Wn.lineLength,-1,hi,Ii,ji,Di,vt.symbolInstances.length,P_),Wr=vt.icon.placedSymbolArray.length-1)}for(const Us in Qn.horizontal){const wo=Us,da=Qn.horizontal[wo];Ni||(Lo=Jm(da.text),tn?Gi=$A(da):Ni=nT(Je,Hi,$t,ft,At,Pt,da,Qt,be.layout.get("text-rotate").evaluate(vn,{},Ii),Cn,lr));const jh=da.positionedLines.length===1;if(ns+=YF(vt,xn,$t,da,ki,be,tn,vn,Cn,Wn,Qn.vertical?ua.horizontal:ua.horizontalOnly,jh?HX(Qn.horizontal):[wo],ds,Hr,oi,hi,Ii,vt.symbolInstances.length,ji),jh)break}Qn.vertical&&(vs+=YF(vt,xn,$t,Qn.vertical,ki,be,tn,vn,Cn,Wn,ua.vertical,["vertical"],ds,Wr,oi,hi,Ii,vt.symbolInstances.length,ji));let is=-1;const Gl=(Us,wo)=>Us?Math.max(Us,wo):wo;is=Gl(Gi,is),is=Gl(un,is),is=Gl(pr,is);const Mu=is>-1?1:0;vt.glyphOffsetArray.length>=65535&&Nt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vn.sortKey!==void 0&&vt.addToSortKeyRanges(vt.symbolInstances.length,vn.sortKey),vt.symbolInstances.emplaceBack($t.x,$t.y,Hi.x,Hi.y,Hi.z,ds.right>=0?ds.right:-1,ds.center>=0?ds.center:-1,ds.left>=0?ds.left:-1,ds.vertical>=0?ds.vertical:-1,Hr,Wr,Lo,Ni!==void 0?Ni:vt.collisionBoxArray.length,Ni!==void 0?Ni+1:vt.collisionBoxArray.length,qi!==void 0?qi:vt.collisionBoxArray.length,qi!==void 0?qi+1:vt.collisionBoxArray.length,Vi!==void 0?Vi:vt.collisionBoxArray.length,Vi!==void 0?Vi+1:vt.collisionBoxArray.length,Lr||vt.collisionBoxArray.length,Lr?Lr+1:vt.collisionBoxArray.length,ft,ns,vs,Ai,rr,Mu,0,Or,Wo,is,0,Pr?1:0,vi)})(a,Ot,jn,kt,s,u,g,h,a.layers[0],a.collisionBoxArray,n.index,n.sourceLayerIndex,a.index,pt,se,C,0,ct,Ye,K,n,_,R,M,D,j,G,X,yt,de,ve,me)};if(ae==="line")for(const kt of Fw(n.geometry,0,0,wt,wt)){const Ot=BX(kt,ht,ut,s.vertical||Qe,u,qe,rt,a.overscaling,wt);for(const Ut of Ot)Qe&&eY(a,Qe.text,Ze,Ut)||Yt(kt,Ut,D)}else if(ae==="line-center"){for(const kt of n.geometry)if(kt.length>1){const Ot=jX(kt,ut,s.vertical||Qe,u,qe,rt);Ot&&Yt(kt,Ot,D)}}else if(n.type==="Polygon")for(const kt of Cx(n.geometry,0)){const Ot=$X(kt,16);Yt(kt[0],new Ad(Ot.x,Ot.y,0,0,void 0),D)}else if(n.type==="LineString")for(const kt of n.geometry)Yt(kt,new Ad(kt[0].x,kt[0].y,0,0,void 0),D);else if(n.type==="Point")for(const kt of n.geometry)for(const Ot of kt)Yt([Ot],new Ad(Ot.x,Ot.y,0,0,void 0),D)}const Gx=255,Pd=Gx*Sc;function YF(a,n,s,u,h,g,_,x,T,C,R,M,D,O,j,G,X,K,se){const ae=function(me,Te,Ie,Re,qe,Ne,Qe,it){const rt=[];if(Te.positionedLines.length===0)return rt;const ht=Re.layout.get("text-rotate").evaluate(Ne,{})*Math.PI/180,pt=function(dt){const Tt=dt[0],yt=dt[1],Yt=Tt*yt;return Yt>0?[Tt,-yt]:Yt<0?[-Tt,yt]:Tt===0?[yt,Tt]:[yt,-Tt]}(Ie);let ct=Math.abs(Te.top-Te.bottom);for(const dt of Te.positionedLines)ct-=dt.lineOffset;const ut=Te.positionedLines.length,Ye=ct/ut;let Ze=Te.top-Ie[1];for(let dt=0;dt<ut;++dt){const Tt=Te.positionedLines[dt];Ze=UX(Te,Ye,Ze,dt);for(const yt of Tt.positionedGlyphs){if(!yt.rect)continue;const Yt=yt.rect||{};let kt=CF+1,Ot=!0,Ut=1,jn=0;if(yt.image){const Ln=Qe.get(yt.image.toString());if(!Ln)continue;if(Ln.sdf){Nt("SDF images are not supported in formatted text and will be ignored.");continue}Ot=!1,Ut=Ln.pixelRatio,kt=Hp/Ut}const vt=(qe||it)&&yt.vertical,$t=yt.metrics.advance*yt.scale/2,xn=yt.metrics,Kn=yt.rect;if(Kn===null)continue;it&&Te.verticalizable&&(jn=yt.image?$t-yt.metrics.width*yt.scale/2:0);const Qn=qe?[yt.x+$t,yt.y]:[0,0];let An=[0,0],ki=[0,0],ge=!1;qe||(vt?(ki=[yt.x+$t+pt[0],yt.y+pt[1]-jn],ge=!0):An=[yt.x+$t+Ie[0],yt.y+Ie[1]-jn]);const be=Kn.w*yt.scale/(Ut*(yt.localGlyph?Cc:1)),Je=Kn.h*yt.scale/(Ut*(yt.localGlyph?Cc:1));let ft,At,Pt,Qt;if(vt){const Ln=yt.y-Ze,zn=new st(-$t,$t-Ln),Hn=-Math.PI/2,dn=new st(...ki);ft=new st(-$t+An[0],An[1]),ft._rotateAround(Hn,zn)._add(dn),ft.x+=-Ln+$t,ft.y-=(xn.left-kt)*yt.scale;const vn=yt.image?xn.advance*yt.scale:ys*yt.scale,oi=String.fromCodePoint(yt.glyph);TX(oi)?ft.x+=(1-kt)*yt.scale:EX(oi)?ft.x+=vn-xn.height*yt.scale+(-kt-1)*yt.scale:ft.x+=yt.image||xn.width+2*kt===Kn.w&&xn.height+2*kt===Kn.h?(vn-Je)/2:(vn-(xn.height+2*kt)*yt.scale)/2,At=new st(ft.x,ft.y-be),Pt=new st(ft.x+Je,ft.y),Qt=new st(ft.x+Je,ft.y-be)}else{const Ln=(xn.left-kt)*yt.scale-$t+An[0],zn=(-xn.top-kt)*yt.scale+An[1],Hn=Ln+be,dn=zn+Je;ft=new st(Ln,zn),At=new st(Hn,zn),Pt=new st(Ln,dn),Qt=new st(Hn,dn)}if(ht){let Ln;Ln=qe?new st(0,0):ge?new st(pt[0],pt[1]):new st(Ie[0],Ie[1]),ft._rotateAround(ht,Ln),At._rotateAround(ht,Ln),Pt._rotateAround(ht,Ln),Qt._rotateAround(ht,Ln)}const tn=new st(0,0),Cn=new st(0,0);rt.push({tl:ft,tr:At,bl:Pt,br:Qt,texPrimary:Yt,texSecondary:void 0,writingMode:Te.writingMode,glyphOffset:Qn,sectionIndex:yt.sectionIndex,isSDF:Ot,pixelOffsetTL:tn,pixelOffsetBR:Cn,minFontScaleX:0,minFontScaleY:0})}}return rt}(0,u,T,g,_,x,h,a.allowVerticalPlacement),de=a.textSizeData;let ve=null;de.kind==="source"?(ve=[Sc*g.layout.get("text-size").evaluate(x,{},X)*j.textScaleFactor],ve[0]>Pd&&Nt(`${a.layerIds[0]}: Value for "text-size" is >= ${Gx}. Reduce your "text-size".`)):de.kind==="composite"&&(ve=[Sc*j.compositeTextSizes[0].evaluate(x,{},X)*j.textScaleFactor,Sc*j.compositeTextSizes[1].evaluate(x,{},X)*j.textScaleFactor],(ve[0]>Pd||ve[1]>Pd)&&Nt(`${a.layerIds[0]}: Value for "text-size" is >= ${Gx}. Reduce your "text-size".`)),a.addSymbols(a.text,ae,ve,T,_,x,R,n,s,C.lineStartIndex,C.lineLength,O,G,X,se,!1,K,ae.length);for(const me of M)D[me]=a.text.placedSymbolArray.length-1;return 4*ae.length}function tT(a){for(const n in a)return a[n];return null}function nT(a,n,s,u,h,g,_,x,T,C,R){let M,D,O,j;if(M=R?R.top:_.top,D=R?R.bottom:_.bottom,O=R?R.left:_.left,j=R?R.right:_.right,LA(_)&&_.collisionPadding){const G=_.collisionPadding;O-=G[0],M-=G[1],j+=G[2],D+=G[3]}if(T){const G=new st(O,M),X=new st(j,M),K=new st(O,D),se=new st(j,D),ae=$n(T);let de=new st(0,0);C&&(de=new st(C[0],C[1])),G._rotateAround(ae,de),X._rotateAround(ae,de),K._rotateAround(ae,de),se._rotateAround(ae,de),O=Math.min(G.x,X.x,K.x,se.x),j=Math.max(G.x,X.x,K.x,se.x),M=Math.min(G.y,X.y,K.y,se.y),D=Math.max(G.y,X.y,K.y,se.y)}return a.emplaceBack(n.x,n.y,n.z,s.x,s.y,O,M,j,D,x,u,h,g),a.length-1}function $A(a){LA(a)&&a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const n=a.bottom-a.top;return n>0?Math.max(10,n):null}function eY(a,n,s,u){const h=a.compareText;if(n in h){const g=h[n];for(let _=g.length-1;_>=0;_--)if(u.dist(g[_])<s)return!0}else h[n]=[];return h[n].push(u),!1}function QF(a,n){const s=a.fovAboveCenter,u=a.elevation?a.elevation.getMinElevationBelowMSL()*n:0,h=(a._camera.position[2]*a.worldSize-u)/Math.cos(a._pitch),g=Math.sin(s)*h/Math.sin(Math.max(Math.PI/2-a._pitch-s,.01));let _=Math.sin(a._pitch)*g+h;const x=h*(1/a._horizonShift);if(!a.elevation||a.elevation.exaggeration()===0){let T=Math.max(a.zoom-17,0);a.isOrthographic&&(T/=10),_*=1+T}return Math.min(1.01*_,x)}function Hx(a,n){if(!n.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:n};const s=Math.pow(2,-a.z),u=a.x*s,h=(a.x+1)*s,g=a.y*s,_=(a.y+1)*s,x=L(u),T=L(h),C=V(g),R=V(_),M=n.project(x,C),D=n.project(T,C),O=n.project(T,R),j=n.project(x,R);let G=Math.min(M.x,D.x,O.x,j.x),X=Math.min(M.y,D.y,O.y,j.y),K=Math.max(M.x,D.x,O.x,j.x),se=Math.max(M.y,D.y,O.y,j.y);const ae=s/16;function de(me,Te,Ie,Re,qe,Ne){const Qe=(Ie+qe)/2,it=(Re+Ne)/2,rt=n.project(L(Qe),V(it)),ht=Math.max(0,G-rt.x,X-rt.y,rt.x-K,rt.y-se);G=Math.min(G,rt.x),K=Math.max(K,rt.x),X=Math.min(X,rt.y),se=Math.max(se,rt.y),ht>ae&&(de(me,rt,Ie,Re,Qe,it),de(rt,Te,Qe,it,qe,Ne))}de(M,D,u,g,h,g),de(D,O,h,g,h,_),de(O,j,h,_,u,_),de(j,M,u,_,u,g),G-=ae,X-=ae,K+=ae,se+=ae;const ve=1/Math.max(K-G,se-X);return{scale:ve,x:G*ve,y:X*ve,x2:K*ve,y2:se*ve,projection:n}}function JF(a,{x:n,y:s},u=0){return new st(((n-u)*a.scale-a.x)*wt,(s*a.scale-a.y)*wt)}const tY=re(new Float32Array(16));class Fh{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,s){return{x:0,y:0,z:0}}unproject(n,s){return new c(0,0)}projectTilePoint(n,s,u){return{x:n,y:s,z:0}}locationPoint(n,s,u,h=!0){return n._coordinatePoint(n.locationCoordinate(s,u),h)}pixelsPerMeter(n,s){return k(1,n)*s}pixelSpaceConversion(n,s,u){return 1}farthestPixelDistance(n){return QF(n,n.pixelsPerMeter)}pointCoordinate(n,s,u,h){const g=n.horizonLineFromTop(!1),_=new st(s,Math.max(g,u));return n.rayIntersectionCoordinate(n.pointRayIntersection(_,h))}pointCoordinate3D(n,s,u){const h=new st(s,u);if(n.elevation)return n.elevation.pointCoordinate(h);{const g=this.pointCoordinate(n,h.x,h.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(n,s){if(n.elevation&&n.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(n,s.x,s.y);const u=n.horizonLineFromTop();return s.y<u}createInversionMatrix(n,s){return tY}createTileMatrix(n,s,u){let h,g,_;const x=u.canonical,T=re(new Float64Array(16));if(this.isReprojectedInTileSpace){const C=Hx(x,this);h=1,g=C.x+u.wrap*C.scale,_=C.y,ue(T,T,[h/C.scale,h/C.scale,n.pixelsPerMeter/s])}else h=s/n.zoomScale(x.z),g=(x.x+Math.pow(2,x.z)*u.wrap)*h,_=x.y*h;return ie(T,T,[g,_,0]),ue(T,T,[h/wt,h/wt,1]),T}upVector(n,s,u){return[0,0,1]}upVectorScale(n,s,u){return{metersToTile:1}}}class nY extends Fh{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[s,u]=this.parallels=n.parallels||[29.5,45.5],h=Math.sin($n(s));this.n=(h+Math.sin($n(u)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(n,s){const{n:u,c:h,r0:g}=this,_=$n(n-this.center[0]),x=$n(s),T=Math.sqrt(h-2*u*Math.sin(x))/u;return{x:T*Math.sin(_*u),y:T*Math.cos(_*u)-g,z:0}}unproject(n,s){const{n:u,c:h,r0:g}=this,_=g+s;let x=Math.atan2(n,Math.abs(_))*Math.sign(_);_*u<0&&(x-=Math.PI*Math.sign(n)*Math.sign(_));const T=$n(this.center[0])*u;x=fe(x,-Math.PI-T,Math.PI-T);const C=Y(io(x/u)+this.center[0],-180,180),R=Math.asin(Y((h-(n*n+_*_)*u*u)/(2*u),-1,1)),M=Y(io(R),-U,U);return new c(C,M)}}const Wx=1.340264,qx=-.081106,Zx=893e-6,Kx=.003796,iT=Math.sqrt(3)/2;class iY extends Fh{project(n,s){s=s/180*Math.PI,n=n/180*Math.PI;const u=Math.asin(iT*Math.sin(s)),h=u*u,g=h*h*h;return{x:.5*(n*Math.cos(u)/(iT*(Wx+3*qx*h+g*(7*Zx+9*Kx*h)))/Math.PI+.5),y:1-.5*(u*(Wx+qx*h+g*(Zx+Kx*h))/Math.PI+1),z:0}}unproject(n,s){n=(2*n-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,h=u*u,g=h*h*h;for(let R,M,D,O=0;O<12&&(M=u*(Wx+qx*h+g*(Zx+Kx*h))-s,D=Wx+3*qx*h+g*(7*Zx+9*Kx*h),R=M/D,u=Y(u-R,-Math.PI/3,Math.PI/3),h=u*u,g=h*h*h,!(Math.abs(R)<1e-12));++O);const _=iT*n*(Wx+3*qx*h+g*(7*Zx+9*Kx*h))/Math.cos(u),x=Math.asin(Math.sin(u)/iT),T=Y(180*_/Math.PI,-180,180),C=Y(180*x/Math.PI,-U,U);return new c(T,C)}}class rY extends Fh{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,s){return{x:.5+n/360,y:.5-s/360,z:0}}unproject(n,s){const u=360*(n-.5),h=Y(360*(.5-s),-U,U);return new c(u,h)}}const T_=Math.PI/2;function rT(a){return Math.tan((T_+a)/2)}class sY extends Fh{constructor(n){super(n),this.center=n.center||[0,30];const[s,u]=this.parallels=n.parallels||[30,30];let h=$n(s),g=$n(u);this.southernCenter=h+g<0,this.southernCenter&&(h=-h,g=-g);const _=Math.cos(h),x=rT(h);this.n=h===g?Math.sin(h):Math.log(_/Math.cos(g))/Math.log(rT(g)/x),this.f=_*Math.pow(rT(h),this.n)/this.n}project(n,s){s=$n(s),this.southernCenter&&(s=-s),n=$n(n-this.center[0]);const u=1e-6,{n:h,f:g}=this;g>0?s<-T_+u&&(s=-T_+u):s>T_-u&&(s=T_-u);const _=g/Math.pow(rT(s),h);let x=_*Math.sin(h*n),T=g-_*Math.cos(h*n);return x=.5*(x/Math.PI+.5),T=.5*(T/Math.PI+.5),{x,y:this.southernCenter?T:1-T,z:0}}unproject(n,s){n=(2*n-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:u,f:h}=this,g=h-s,_=Math.sign(g),x=Math.sign(u)*Math.sqrt(n*n+g*g);let T=Math.atan2(n,Math.abs(g))*_;g*u<0&&(T-=Math.PI*Math.sign(n)*_);const C=Y(io(T/u)+this.center[0],-180,180),R=Y(io(2*Math.atan(Math.pow(h/x,1/u))-T_),-U,U);return new c(C,this.southernCenter?-R:R)}}class ez extends Fh{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,s){return{x:S(n),y:P(s),z:0}}unproject(n,s){const u=L(n),h=V(s);return new c(u,h)}}const tz=$n(U);class oY extends Fh{project(n,s){const u=(s=$n(s))*s,h=u*u;return{x:.5*((n=$n(n))*(.8707-.131979*u+h*(h*(.003971*u-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+u*(.015085+h*(.028874*u-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(n,s){n=(2*n-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,h=25,g=0,_=u*u;do{_=u*u;const C=_*_;g=(u*(1.007226+_*(.015085+C*(.028874*_-.044475-.005916*C)))-s)/(1.007226+_*(.045255+C*(.259866*_-.311325-.005916*11*C))),u=Y(u-g,-tz,tz)}while(Math.abs(g)>1e-6&&--h>0);_=u*u;const x=Y(io(n/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),T=io(u);return new c(x,T)}}const nz=$n(U);class aY extends Fh{project(n,s){s=$n(s),n=$n(n);const u=Math.cos(s),h=2/Math.PI,g=Math.acos(u*Math.cos(n/2)),_=Math.sin(g)/g,x=.5*(n*h+2*u*Math.sin(n/2)/_)||0,T=.5*(s+Math.sin(s)/_)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(n,s){let u=n=(2*n-.5)*Math.PI,h=s=(2*(1-s)-1)*Math.PI,g=25;const _=1e-6;let x=0,T=0;do{const C=Math.cos(h),R=Math.sin(h),M=2*R*C,D=R*R,O=C*C,j=Math.cos(u/2),G=Math.sin(u/2),X=2*j*G,K=G*G,se=1-O*j*j,ae=se?1/se:0,de=se?Math.acos(C*j)*Math.sqrt(1/se):0,ve=.5*(2*de*C*G+2*u/Math.PI)-n,me=.5*(de*R+h)-s,Te=.5*ae*(O*K+de*C*j*D)+1/Math.PI,Ie=ae*(X*M/4-de*R*G),Re=.125*ae*(M*G-de*R*O*X),qe=.5*ae*(D*j+de*K*C)+.5,Ne=Ie*Re-qe*Te;x=(me*Ie-ve*qe)/Ne,T=(ve*Re-me*Te)/Ne,u=Y(u-x,-Math.PI,Math.PI),h=Y(h-T,-nz,nz)}while((Math.abs(x)>_||Math.abs(T)>_)&&--g>0);return new c(io(u),io(h))}}class iz extends Fh{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos($n(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,s){const{scale:u,cosPhi:h}=this;return{x:$n(n)*h*u+.5,y:-Math.sin($n(s))/h*u+.5,z:0}}unproject(n,s){const{scale:u,cosPhi:h}=this,g=-(s-.5)/u,_=Y(io((n-.5)/u)/h,-180,180),x=Math.asin(Y(g*h,-1,1)),T=Y(io(x),-U,U);return new c(_,T)}}class lY extends ez{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,s,u){const h=xx(n,s,u);return Mi(h,h,Aw(fl(u))),{x:h[0],y:h[1],z:h[2]}}locationPoint(n,s,u){const h=Rh(s.lat,s.lng),g=pn([],h),_=u?n._centerAltitude+u:n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(s),n._centerAltitude):n._centerAltitude;qt(h,h,g,k(1,0)*wt*_);const x=re(new Float64Array(16));return ee(x,n.pixelMatrix,n.globeMatrix),Mi(h,h,x),new st(h[0],h[1])}pixelsPerMeter(n,s){return k(1,0)*s}pixelSpaceConversion(n,s,u){const h=k(1,n)*s,g=fn(k(1,45)*s,h,u);return this.pixelsPerMeter(n,s)/g}createTileMatrix(n,s,u){const h=ZI(fl(u.canonical));return ee(new Float64Array(16),n.globeMatrix,h)}createInversionMatrix(n,s){const{center:u}=n,h=Aw(fl(s));return Oe(h,h,$n(u.lng)),xe(h,h,$n(u.lat)),ue(h,h,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(n,s,u,h){return kh(n,s,u,!0)||new le(0,0)}pointCoordinate3D(n,s,u){const h=this.pointCoordinate(n,s,u,0);return[h.x,h.y,h.z]}isPointAboveHorizon(n,s){return!kh(n,s.x,s.y,!1)}farthestPixelDistance(n){const s=function(h,g){const _=h.cameraToCenterDistance,x=h._centerAltitude*g,T=h._camera,C=h._camera.forward(),R=et([],gn([],C,-_),[0,0,x]),M=h.worldSize/(2*Math.PI),D=[0,0,-M],O=h.width/h.height,j=Math.tan(h.fovAboveCenter),G=gn([],T.up(),j),X=gn([],T.right(),j*O),K=pn([],et([],et([],C,G),X)),se=[];let ae;if(new Bt(R,K).closestPointOnSphere(D,M,se)){const de=et([],se,D),ve=xr([],de,R);ae=Math.cos(h.fovAboveCenter)*nn(ve)}else{const de=xr([],R,D),ve=xr([],D,R);pn(ve,ve);const me=nn(de)-M;ae=Math.sqrt(me*(me+2*M));const Te=Math.acos(ae/(M+me))-Math.acos(Fn(C,ve));ae*=Math.cos(Te)}return 1.01*ae}(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),u=Dh(n.zoom);if(u>0){const h=QF(n,k(1,n.center.lat)*n.worldSize),g=n.worldSize/(2*Math.PI),_=Math.max(n.width,n.height)/n.worldSize*Math.PI;return fn(s,h+g*(1-Math.cos(_)),Math.pow(u,10))}return s}upVector(n,s,u){return xx(s,u,n,1)}upVectorScale(n){return{metersToTile:Ul(Iw(fl(n)))}}}function rz(a){const n=a.parallels,s=!!n&&Math.abs(n[0]+n[1])<.01;switch(a.name){case"mercator":return new ez(a);case"equirectangular":return new rY(a);case"naturalEarth":return new oY(a);case"equalEarth":return new iY(a);case"winkelTripel":return new aY(a);case"albers":return s?new iz(a):new nY(a);case"lambertConformalConic":return s?new iz(a):new sY(a);case"globe":return new lY(a)}throw new Error(`Invalid projection name: ${a.name}`)}const cY=Me.types,uY=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Xx(a,n,s,u,h,g,_,x,T,C,R,M,D){const O=x?Math.min(Pd,Math.round(x[0])):0,j=x?Math.min(Pd,Math.round(x[1])):0;a.emplaceBack(n,s,Math.round(32*u),Math.round(32*h),g,_,(O<<1)+(T?1:0),0+(j<<1),16*C,16*R,256*M,256*D)}function Yx(a,n,s){a.emplaceBack(n,s)}function Qx(a,n,s,u,h,g,_){a.emplaceBack(n,s,u,h,g,_)}const sT=(a,n,s,u)=>{for(let h=0;h<n;h++)a.emplaceBack(s[0],s[1],s[2],u[0],u[1],u[2])};function E_(a,n,s,u,h){a.emplaceBack(n,s,u,h),a.emplaceBack(n,s,u,h),a.emplaceBack(n,s,u,h),a.emplaceBack(n,s,u,h)}function dY(a){for(const n of a.sections)if(kI(n.text))return!0;return!1}class GA{constructor(n){this.layoutVertexArray=new ix,this.indexArray=new Jr,this.programConfigurations=n,this.segments=new dr,this.dynamicLayoutVertexArray=new Su,this.opacityVertexArray=new qg,this.placedSymbolArray=new xw,this.iconTransitioningVertexArray=new aa,this.globeExtVertexArray=new rx,this.zOffsetVertexArray=new gc,this.orientationVertexArray=new ax,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(n,s){const u=[],h=this.layoutVertexArray.uint16;for(let g=0;g<s;++g){const _=12*(n+g);u.push(...h.slice(_,_+12))}return u}updateIconVertexData(n,s,u,h,g,_,x,T,C,R,M,D,O){const j=this.layoutVertexArray.uint16,G=12*n;j[G]=s,j[G+1]=u,j[G+2]=h,j[G+3]=g,j[G+4]=_,j[G+5]=x,j[G+6]=T,j[G+7]=C,j[G+8]=R,j[G+9]=M,j[G+10]=D,j[G+11]=O}upload(n,s,u,h,g,_){this.isEmpty()||(u&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,fX.members,!!_),this.indexBuffer=n.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,mX.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,uY,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=n.createVertexBuffer(this.iconTransitioningVertexArray,yX.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,pX.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||g)&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,gX.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=n.createVertexBuffer(this.orientationVertexArray,_X.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}jt(GA,"SymbolBuffers");class HA{constructor(n,s,u){this.layoutVertexArray=new n,this.layoutAttributes=s,this.indexArray=new u,this.segments=new dr,this.collisionVertexArray=new sx,this.collisionVertexArrayExt=new Su}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,vX.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,xX.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}jt(HA,"CollisionBuffers");class oT{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(_=>_.fqid),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=re([]),this.placementViewportMatrix=re([]);const s=this.layers[0]._unevaluatedLayout._values;this.worldview=n.worldview,this.localizable=n.localizable,this.textSizeData=v_(this.zoom,s["text-size"],this.worldview),this.iconSizeData=v_(this.zoom,s["icon-size"],this.worldview);const u=this.layers[0].layout,h=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.lut=n.lut,this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(_=>ua[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=n.sourceID,this.projection=n.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(n){const s=this.layers[0].getAppearances();return!(!s||s.length===0)&&s.some(u=>u.getProperty(n)!=null)}createArrays(){this.text=new GA(new dl(this.layers,{zoom:this.zoom,lut:this.lut},n=>n.startsWith("text")||n.startsWith("symbol"))),this.icon=new GA(new dl(this.layers,{zoom:this.zoom,lut:this.lut},n=>n.startsWith("icon")||n.startsWith("symbol"))),this.glyphOffsetArray=new t_,this.lineVertexArray=new ww,this.symbolInstances=new hx}calculateGlyphDependencies(n,s,u,h,g){for(const _ of n){const x=_.codePointAt(0);if(x===void 0)break;if(s[x]=!0,h&&g&&x<=65535){const T=jx[_];T&&(s[T.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(n,s,u,h,g,_){let x=1;const T=n.getUnevaluatedProperties()._values["icon-size"],C=v_(this.zoom,T,this.worldview),R=x_(C,s);if(C.kind!=="constant"&&C.kind!=="camera"||(x=R.uSize),C.kind==="composite"){const{minZoom:M,maxZoom:D}=C,O=T.possiblyEvaluate(new Wi(M,{worldview:this.worldview}),h),j=T.possiblyEvaluate(new Wi(D,{worldview:this.worldview}),h),G=O.evaluate(u,{},h,g);x=G+(j.evaluate(u,{},h,g)-G)*R.uSizeT}return C.kind==="source"&&(x=T.possiblyEvaluate(new Wi(this.zoom,{worldview:this.worldview}),h).evaluate(u,{},h,g)),x*_}updateFootprints(n,s){}updateReplacement(n,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const u=s.getReplacementRegionsForTile(n.toUnwrapped(),!0);return!Nw(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}getResolvedImageFromTokens(n){return typeof n=="string"?_o.build(n):n}populate(n,s,u,h){const g=this.layers[0],_=g.layout,x=this.projection.name==="globe",T=_.get("text-font"),C=_.get("text-field"),R=_.get("icon-image"),[M,D]=_.get("icon-size-scale-range"),O=Y(s.scaleFactor||1,M,D),j=(C.value.kind!=="constant"||C.value.value instanceof go&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),G=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,X=this.hasAnyAppearanceProperty("icon-image"),K=_.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!j&&!G&&!X)return;const se=s.iconDependencies,ae=s.glyphDependencies,de=s.availableImages,ve=new Wi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),me=Te=>{const Ie=Te.id.toString();se.has(Ie)?se.get(Ie).push(Te):se.set(Ie,[Te])};for(const Te of n){const{feature:Ie,id:Re,index:qe,sourceLayerIndex:Ne}=Te,Qe=g._featureFilter.needGeometry,it=De(Ie,Qe);if(!g._featureFilter.filter(ve,it,u))continue;if(Qe||(it.geometry=Se(Ie,u,h)),x&&Ie.type!==1&&u.z<=5){const dt=it.geometry,Tt=.98078528056,yt=(Yt,kt)=>Fn(xx(Yt.x,Yt.y,u,1),xx(kt.x,kt.y,u,1))<Tt;for(let Yt=0;Yt<dt.length;Yt++)dt[Yt]=ye(dt[Yt],yt)}let rt,ht;if(j){const dt=g.getValueAndResolveTokens("text-field",it,u,de),Tt=go.factory(dt);dY(Tt)&&(this.hasRTLText=!0),(!this.hasRTLText||Ap()==="unavailable"||this.hasRTLText&&mc.isParsed())&&(rt=wX(Tt,g,it))}if(G){const dt=g.getValueAndResolveTokens("icon-image",it,u,de);ht=this.getResolvedImageFromTokens(dt)}const pt=this.layers[0];let ct=!1;if(!ht&&X){const dt=pt.getAppearances();for(const Tt of dt)if(Tt.getProperty("icon-image")){const yt=pt.getAppearanceValueAndResolveTokens(Tt,"icon-image",it,u,de);if(yt){ht=this.getResolvedImageFromTokens(yt),ct=!0;break}}}if(!rt&&!ht)continue;const ut=this.sortFeaturesByKey?K.evaluate(it,{},u):void 0,Ye={id:Re,text:rt,icon:ht,index:qe,sourceLayerIndex:Ne,geometry:it.geometry,properties:Ie.properties,type:cY[Ie.type],sortKey:ut};if(this.features.push(Ye),this.featureToAppearanceIndex[qe]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:Re,properties:Ie.properties,usesAppearanceIconAsPlaceholder:ct,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),ht){const dt=pt._unevaluatedLayout._values,{iconPrimary:Tt,iconSecondary:yt}=$x(ht,this.iconSizeData,dt["icon-size"],u,this.zoom,Ye,this.pixelRatio,O,this.worldview);me(Tt),yt&&(this.hasAnySecondaryIcon=!0,me(yt))}const Ze=pt.getAppearances();if(Ze.length!==0&&Ze.forEach(dt=>{if(!dt.getProperty("icon-image"))return;const Tt=this.getCombinedIconPrimary(dt,pt,it,u,de,Ye,O);Tt&&me(Tt)}),rt){const dt=T.evaluate(it,{},u).join(","),Tt=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ua.vertical)>=0;for(const yt of rt.sections)if(yt.image){const Yt=yt.image.getPrimary().scaleSelf(this.pixelRatio),kt=Yt.id.toString(),Ot=se.get(kt)||[];Ot.push(Yt),se.set(kt,Ot)}else{const Yt=Cp(rt.toString()),kt=yt.fontStack||dt,Ot=ae[kt]=ae[kt]||{};this.calculateGlyphDependencies(yt.text,Ot,Tt,this.allowVerticalPlacement,Yt)}}}if(_.get("symbol-placement")==="line"&&(this.features=function(Te){const Ie={},Re={},qe=[];let Ne=0;function Qe(pt){qe.push(Te[pt]),Ne++}function it(pt,ct,ut){const Ye=Re[pt];return delete Re[pt],Re[ct]=Ye,qe[Ye].geometry[0].pop(),qe[Ye].geometry[0]=qe[Ye].geometry[0].concat(ut[0]),Ye}function rt(pt,ct,ut){const Ye=Ie[ct];return delete Ie[ct],Ie[pt]=Ye,qe[Ye].geometry[0].shift(),qe[Ye].geometry[0]=ut[0].concat(qe[Ye].geometry[0]),Ye}function ht(pt,ct,ut){const Ye=ut?ct[0][ct[0].length-1]:ct[0][0];return`${pt}:${Ye.x}:${Ye.y}`}for(let pt=0;pt<Te.length;pt++){const ct=Te[pt],ut=ct.geometry,Ye=ct.text?ct.text.toString():null;if(!Ye){Qe(pt);continue}const Ze=ht(Ye,ut),dt=ht(Ye,ut,!0);if(Ze in Re&&dt in Ie&&Re[Ze]!==Ie[dt]){const Tt=rt(Ze,dt,ut),yt=it(Ze,dt,qe[Tt].geometry);delete Ie[Ze],delete Re[dt],Re[ht(Ye,qe[yt].geometry,!0)]=yt,qe[Tt].geometry=null}else Ze in Re?it(Ze,dt,ut):dt in Ie?rt(Ze,dt,ut):(Qe(pt),Ie[Ze]=Ne-1,Re[dt]=Ne-1)}return qe.filter(pt=>pt.geometry)}(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",s.elevationFeatures){!this.elevationFeatures&&s.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Te of s.elevationFeatures)this.elevationFeatureIdToIndex.set(Te.id,this.elevationFeatures.length),this.elevationFeatures.push(Te)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Te,Ie)=>Te.sortKey-Ie.sortKey)}getCombinedIconPrimary(n,s,u,h,g,_,x){let T,C;const R=n.getUnevaluatedProperties();if(R._values["icon-image"].value!==void 0){const M=s.getAppearanceValueAndResolveTokens(n,"icon-image",u,h,g);T=this.getResolvedImageFromTokens(M)}else{const M=s.getValueAndResolveTokens("icon-image",u,h,g);T=this.getResolvedImageFromTokens(M)}if(T){const M=R._values["icon-size"]||s._unevaluatedLayout._values["icon-size"];C=$x(T,v_(this.zoom,M,this.worldview),M,h,this.zoom,_,this.pixelRatio,x,this.worldview).iconPrimary}return C}updateAppearanceBasedIconTextures(n,s,u,h){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const g=this.layers[0];let _=!1,x=0;const T=g.layout,[C,R]=T.get("icon-size-scale-range"),M=Y(1,C,R);for(let D=0;D<this.symbolInstances.length;D++){const O=this.symbolInstances.get(D),j=this.featureToAppearanceIndex[O.featureIndex],G=j!==void 0?this.appearanceFeatureData[j]:void 0;if(G&&O.placedIconSymbolIndex>=0){const X=G.id,K=s&&X!==void 0?s[String(X)]:void 0,se={type:"Point",id:G.id,properties:G.properties,geometry:[]},ae=this.layers[0].appearances&&this.layers[0].appearances.find(de=>de.isActive({globals:h,feature:se,canonical:n,featureState:K}));if(G.activeAppearance===ae){x+=O.numIconVertices;continue}if(ae){G.activeAppearance=ae;const de=this.getCombinedIconPrimary(ae,g,se,n,u,{sortKey:void 0,text:void 0,icon:null,index:O.featureIndex,sourceLayerIndex:O.featureIndex,geometry:[],properties:G.properties,type:"Point",id:G.id},M);if(!de)continue;const ve=de.toString(),me=this.iconAtlasPositions&&this.iconAtlasPositions.get(ve);if(me){const Te=g.getAppearanceValueAndResolveTokens(ae,"icon-offset",se,n,u),Ie=Te&&Array.isArray(Te)?Te:[0,0];let Re=Xw(me,void 0,Ie,g.layout.get("icon-anchor").evaluate(se,{},n));const qe=g.getAppearanceValueAndResolveTokens(ae,"icon-rotate",se,n,u),Ne=typeof qe=="number"?qe:0,Qe=me.sdf,it=g.layout.get("icon-text-fit").constantOr("none");it!=="none"&&G.textShaping&&G.iconTextFitPadding&&G.fontScale&&(Re=OA(Re,G.textShaping,it,G.iconTextFitPadding,Ie,G.fontScale));const rt=this.calculateEffectiveAppearanceIconSize(ae,h.zoom,se,n,u,M),ht=0,pt=1+(Math.min(Pd,Math.round(rt*Sc))<<1),ct=BA(Re,Ne,Qe,it!=="none",M);G.isUsingAppearanceVertexData||(G.isUsingAppearanceVertexData=!0,G.layoutBasedVertexData=this.icon.getIconVertexData(x,O.numIconVertices));for(let Ye=0;Ye<ct.length;++Ye){const Ze=ct[Ye],dt=G.layoutBasedVertexData[0]||O.tileAnchorX,Tt=G.layoutBasedVertexData[1]||O.tileAnchorY,yt=16*Ze.pixelOffsetTL.x,Yt=16*Ze.pixelOffsetTL.y,kt=16*Ze.pixelOffsetBR.x,Ot=16*Ze.pixelOffsetBR.y,Ut=16*Ze.minFontScaleX,jn=16*Ze.minFontScaleY;this.icon.updateIconVertexData(x,dt,Tt,Math.round(32*Ze.tl.x),Math.round(32*Ze.tl.y),Ze.texPrimary.x,Ze.texPrimary.y,ht,pt,yt,Yt,Ut,jn),this.icon.updateIconVertexData(x+1,dt,Tt,Math.round(32*Ze.tr.x),Math.round(32*Ze.tr.y),Ze.texPrimary.x+Ze.texPrimary.w,Ze.texPrimary.y,ht,pt,kt,Yt,Ut,jn),this.icon.updateIconVertexData(x+2,dt,Tt,Math.round(32*Ze.bl.x),Math.round(32*Ze.bl.y),Ze.texPrimary.x,Ze.texPrimary.y+Ze.texPrimary.h,ht,pt,yt,Ot,Ut,jn),this.icon.updateIconVertexData(x+3,dt,Tt,Math.round(32*Ze.br.x),Math.round(32*Ze.br.y),Ze.texPrimary.x+Ze.texPrimary.w,Ze.texPrimary.y+Ze.texPrimary.h,ht,pt,kt,Ot,Ut,jn),x+=4}const ut=O.numIconVertices-4*ct.length;for(let Ye=0;Ye<ut;++Ye)this.icon.updateIconVertexData(x+Ye,0,0,0,0,0,0,0,0,0,0,0,0);_=!0}else x+=O.numIconVertices}else if(G.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(x,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(x+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(x+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(x+3,0,0,0,0,0,0,0,0,0,0,0,0),_=!0),x+=O.numIconVertices,G.activeAppearance=null;else if(G.isUsingAppearanceVertexData){const ve=G.layoutBasedVertexData.length/12;for(let me=0;me<ve;++me){const Te=me*12;this.icon.updateIconVertexData(x+me,G.layoutBasedVertexData[Te+0],G.layoutBasedVertexData[Te+1],G.layoutBasedVertexData[Te+2],G.layoutBasedVertexData[Te+3],G.layoutBasedVertexData[Te+4],G.layoutBasedVertexData[Te+5],G.layoutBasedVertexData[Te+6],G.layoutBasedVertexData[Te+7],G.layoutBasedVertexData[Te+8],G.layoutBasedVertexData[Te+9],G.layoutBasedVertexData[Te+10],G.layoutBasedVertexData[Te+11])}x+=ve,G.isUsingAppearanceVertexData=!1,G.activeAppearance=null,_=!0}else x+=O.numIconVertices,G.activeAppearance=null}}return _}update(n,s,u,h,g,_,x){this.text.programConfigurations.updatePaintArrays(n,s,g,u,h,_,x,this.worldview),this.icon.programConfigurations.updatePaintArrays(n,s,g,u,h,_,x,this.worldview)}updateRoadElevation(n){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let s=!1;const u=te(n),h=1/u;let g=!1,_=!1;for(let x=0;x<this.symbolInstances.length;x++){const T=this.symbolInstances.get(x),C=Wt(1,0,0),R=Wt(0,1,0),{numHorizontalGlyphVertices:M,numVerticalGlyphVertices:D,numIconVertices:O,numVerticalIconVertices:j}=T,G=M>0||D>0,X=O>0,K=this.elevationFeatures[T.elevationFeatureIndex];if(K){const se=new st(T.tileAnchorX,T.tileAnchorY),ae=.075+K.pointElevation(se);T.zOffset!==ae&&(s=!0,T.zOffset=ae),ae!==0&&(this.hasAnyZOffset=!0);const de=K.computeSlopeNormal(se,h),ve=Il(el(),Wt(0,0,1),de);fo(C,C,ve),fo(R,R,ve),C[2]*=u,R[2]*=u,C[0]===1&&C[1]===0&&C[2]===0&&R[0]===0&&R[1]===1&&R[2]===0||(g=g||G,_=_||X)}if(G&&(sT(this.text.orientationVertexArray,M,C,R),sT(this.text.orientationVertexArray,D,C,R)),X){const{placedIconSymbolIndex:se,verticalPlacedIconSymbolIndex:ae}=T;se>=0&&sT(this.icon.orientationVertexArray,O,C,R),ae>=0&&sT(this.icon.orientationVertexArray,j,C,R)}}g||(this.text.orientationVertexArray=void 0),_||(this.icon.orientationVertexArray=void 0),s&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const n=(g,_,x)=>{u+=_,u>g.length&&g.resize(u);for(let T=-_;T<0;T++)g.emplace(T+u,x)},s=(g,_,x)=>{h+=_,h>g.length&&g.resize(h);for(let T=-_;T<0;T++)g.emplace(T+h,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,h=0;for(let g=0;g<this.symbolInstances.length;g++){const _=this.symbolInstances.get(g),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:T,numIconVertices:C}=_,R=_.zOffset,M=C>0;if((x>0||T>0)&&(n(this.text.zOffsetVertexArray,x,R),n(this.text.zOffsetVertexArray,T,R)),M){const{placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:O}=_;D>=0&&s(this.icon.zOffsetVertexArray,C,R),O>=0&&s(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,R)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n,s,u,h,g){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(_=>_.appearances&&_.appearances.length>0)),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(n,s,u,h){return!!(n&&s&&u)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(n,s,u,h)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=rz(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,s){const u=this.lineVertexArray.length;if(n.segment!==void 0)for(const{x:h,y:g}of s)this.lineVertexArray.emplaceBack(h,g);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(n,s,u,h,g,_,x,T,C,R,M,D,O,j,G,X,K,se){const ae=n.indexArray,de=n.layoutVertexArray,ve=n.globeExtVertexArray,me=n.segments.prepareSegment(4*se,de,ae,this.canOverlap?_.sortKey:void 0),Te=this.glyphOffsetArray.length,Ie=me.vertexLength,Re=this.allowVerticalPlacement&&x===ua.vertical?Math.PI/2:0,qe=_.text&&_.text.sections;for(let it=0;it<s.length;it++){const{tl:rt,tr:ht,bl:pt,br:ct,texPrimary:ut,texSecondary:Ye,pixelOffsetTL:Ze,pixelOffsetBR:dt,minFontScaleX:Tt,minFontScaleY:yt,glyphOffset:Yt,isSDF:kt,sectionIndex:Ot}=s[it],Ut=me.vertexLength,jn=Yt[1];if(Xx(de,C.x,C.y,rt.x,jn+rt.y,ut.x,ut.y,u,kt,Ze.x,Ze.y,Tt,yt),Xx(de,C.x,C.y,ht.x,jn+ht.y,ut.x+ut.w,ut.y,u,kt,dt.x,Ze.y,Tt,yt),Xx(de,C.x,C.y,pt.x,jn+pt.y,ut.x,ut.y+ut.h,u,kt,Ze.x,dt.y,Tt,yt),Xx(de,C.x,C.y,ct.x,jn+ct.y,ut.x+ut.w,ut.y+ut.h,u,kt,dt.x,dt.y,Tt,yt),T){const{x:vt,y:$t,z:xn}=T.anchor,[Kn,Qn,An]=T.up;Qx(ve,vt,$t,xn,Kn,Qn,An),Qx(ve,vt,$t,xn,Kn,Qn,An),Qx(ve,vt,$t,xn,Kn,Qn,An),Qx(ve,vt,$t,xn,Kn,Qn,An),E_(n.dynamicLayoutVertexArray,vt,$t,xn,Re)}else E_(n.dynamicLayoutVertexArray,C.x,C.y,C.z,Re);if(X){const vt=Ye||ut;Yx(n.iconTransitioningVertexArray,vt.x,vt.y),Yx(n.iconTransitioningVertexArray,vt.x+vt.w,vt.y),Yx(n.iconTransitioningVertexArray,vt.x,vt.y+vt.h),Yx(n.iconTransitioningVertexArray,vt.x+vt.w,vt.y+vt.h)}ae.emplaceBack(Ut,Ut+1,Ut+2),ae.emplaceBack(Ut+1,Ut+2,Ut+3),me.vertexLength+=4,me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Yt[0]),it!==s.length-1&&Ot===s[it+1].sectionIndex||n.programConfigurations.populatePaintArrays(de.length,_,_.index,{},O,j,G,qe&&qe[Ot],this.worldview)}const Ne=se-s.length;Ne!==0&&this._addNullVertices(Ne,de,u,T,ve,n,X,me,ae);const Qe=T?T.anchor:C;n.placedSymbolArray.emplaceBack(Qe.x,Qe.y,Qe.z,C.x,C.y,Te,this.glyphOffsetArray.length-Te,Ie,R,M,C.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],x,0,0,0,D,0),n.symbolInstanceIndices.push(K)}_addNullVertices(n,s,u,h,g,_,x,T,C){for(let R=0;R<n;R++){for(let D=0;D<4;D++)Xx(s,0,0,0,0,0,0,u,!1,0,0,0,0),h&&Qx(g,0,0,0,0,0,0),E_(_.dynamicLayoutVertexArray,0,0,0,0),x&&Yx(_.iconTransitioningVertexArray,0,0);const M=T.vertexLength;C.emplaceBack(M,M+1,M+2),C.emplaceBack(M+1,M+2,M+3),T.vertexLength+=4,T.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(n,s,u,h,g,_,x){n.emplaceBack(s,u,h,g,_,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(n,s,u,h,g,_,x){const T=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),C=T.vertexLength,R=x.tileAnchorX,M=x.tileAnchorY;for(let O=0;O<4;O++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,s,n.padding,x.zOffset),this._commitLayoutVertex(u.layoutVertexArray,h,g,_,R,M,new st(n.x1,n.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,g,_,R,M,new st(n.x2,n.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,g,_,R,M,new st(n.x2,n.y2)),this._commitLayoutVertex(u.layoutVertexArray,h,g,_,R,M,new st(n.x1,n.y2)),T.vertexLength+=4;const D=u.indexArray;D.emplaceBack(C,C+1),D.emplaceBack(C+1,C+2),D.emplaceBack(C+2,C+3),D.emplaceBack(C+3,C),T.primitiveLength+=4}_addTextDebugCollisionBoxes(n,s,u,h,g,_){for(let x=h;x<g;x++){const T=u.get(x),C=this.getSymbolInstanceTextSize(n,_,s,x);this._addCollisionDebugVertices(T,C,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(n,s,u,h,g,_){for(let x=h;x<g;x++){const T=u.get(x),C=this.getSymbolInstanceIconSize(n,s,_.placedIconSymbolIndex);this._addCollisionDebugVertices(T,C,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}generateCollisionDebugBuffers(n,s,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new HA(Kg,wF.members,aa),this.iconCollisionBox=new HA(Kg,wF.members,aa);const h=x_(this.iconSizeData,n),g=x_(this.textSizeData,n,u);for(let _=0;_<this.symbolInstances.length;_++){const x=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(g,n,s,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(g,n,s,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,n,s,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,n,s,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(n,s,u,h){const g=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:h),_=FA(this.textSizeData,n,g)/ys;return this.tilePixelRatio*_}getSymbolInstanceIconSize(n,s,u){const h=this.icon.placedSymbolArray.get(u),g=FA(this.iconSizeData,n,h);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(n,s,u,h){n.emplaceBack(s,-u,-u,h),n.emplaceBack(s,u,-u,h),n.emplaceBack(s,u,u,h),n.emplaceBack(s,-u,u,h)}_updateTextDebugCollisionBoxes(n,s,u,h,g,_,x){for(let T=h;T<g;T++){const C=u.get(T),R=this.getSymbolInstanceTextSize(n,_,s,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,R,C.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(n,s,u,h,g,_,x){for(let T=h;T<g;T++){const C=u.get(T),R=this.getSymbolInstanceIconSize(n,s,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,R,C.padding,_.zOffset)}}updateCollisionDebugBuffers(n,s,u,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const g=x_(this.iconSizeData,n,h),_=x_(this.textSizeData,n,u);for(let x=0;x<this.symbolInstances.length;x++){const T=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(_,n,s,T.textBoxStartIndex,T.textBoxEndIndex,T,u),this._updateTextDebugCollisionBoxes(_,n,s,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T,u),this._updateIconDebugCollisionBoxes(g,n,s,T.iconBoxStartIndex,T.iconBoxEndIndex,T,h),this._updateIconDebugCollisionBoxes(g,n,s,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,s,u,h,g,_,x,T,C){const R={};if(s<u){const{x1:M,y1:D,x2:O,y2:j,padding:G,projectedAnchorX:X,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:ae,tileAnchorY:de,featureIndex:ve}=n.get(s);R.textBox={x1:M,y1:D,x2:O,y2:j,padding:G,projectedAnchorX:X,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:ae,tileAnchorY:de},R.textFeatureIndex=ve}if(h<g){const{x1:M,y1:D,x2:O,y2:j,padding:G,projectedAnchorX:X,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:ae,tileAnchorY:de,featureIndex:ve}=n.get(h);R.verticalTextBox={x1:M,y1:D,x2:O,y2:j,padding:G,projectedAnchorX:X,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:ae,tileAnchorY:de},R.verticalTextFeatureIndex=ve}if(_<x){const{x1:M,y1:D,x2:O,y2:j,padding:G,projectedAnchorX:X,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:ae,tileAnchorY:de,featureIndex:ve}=n.get(_);R.iconBox={x1:M,y1:D,x2:O,y2:j,padding:G,projectedAnchorX:X,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:ae,tileAnchorY:de},R.iconFeatureIndex=ve}if(T<C){const{x1:M,y1:D,x2:O,y2:j,padding:G,projectedAnchorX:X,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:ae,tileAnchorY:de,featureIndex:ve}=n.get(T);R.verticalIconBox={x1:M,y1:D,x2:O,y2:j,padding:G,projectedAnchorX:X,projectedAnchorY:K,projectedAnchorZ:se,tileAnchorX:ae,tileAnchorY:de},R.verticalIconFeatureIndex=ve}return R}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const u=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(n,s){const u=n.placedSymbolArray.get(s),h=u.vertexStartIndex+4*u.numGlyphs;for(let g=u.vertexStartIndex;g<h;g+=4)n.indexArray.emplaceBack(g,g+1,g+2),n.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(n),u=Math.cos(n),h=[],g=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const T=this.symbolInstances.get(x);h.push(0|Math.round(s*T.tileAnchorX+u*T.tileAnchorY)),g.push(T.featureIndex)}return _.sort((x,T)=>h[x]-h[T]||g[T]-g[x]),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let n=0;n<this.symbolInstances.length;++n)this.symbolInstanceIndexesSortedZOffset.push(n)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((n,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(n).zOffset)}addToSortKeyRanges(n,s){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===s?u.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const u=this.symbolInstances.get(s);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:C}=u;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),g>=0&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),_>=0&&_!==g&&_!==h&&this.addIndicesForPlacedSymbol(this.text,_),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(n){const s=this.symbolInstances.get(this.text.symbolInstanceIndices[n]).elevationFeatureIndex;let u;return this.elevationFeatures&&s<this.elevationFeatures.length&&(u=this.elevationFeatures[s]),u}}function sz(a,n){return n.replace(/{([^{}]+)}/g,(s,u)=>u in a?String(a[u]):"")}let oz,az,WA;jt(oT,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),oT.addDynamicAttributes=E_;class lz{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:ol,this.defaultValue=n}evaluate(n){if(n.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(n.formattedSection))return s.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}jt(lz,"FormatSectionOverride",{omit:["defaultValue"]});const qA=()=>WA||(WA={layout:oz||(oz=new wr({"symbol-placement":new xt(Fe.layout_symbol["symbol-placement"]),"symbol-spacing":new xt(Fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new xt(Fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new It(Fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new xt(Fe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new xt(Fe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new xt(Fe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new xt(Fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new xt(Fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new xt(Fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new xt(Fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new It(Fe.layout_symbol["icon-size"]),"icon-size-scale-range":new xt(Fe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new It(Fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new It(Fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new It(Fe.layout_symbol["icon-image"]),"icon-image-use-theme":new xt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new It(Fe.layout_symbol["icon-rotate"]),"icon-padding":new xt(Fe.layout_symbol["icon-padding"]),"icon-keep-upright":new xt(Fe.layout_symbol["icon-keep-upright"]),"icon-offset":new It(Fe.layout_symbol["icon-offset"]),"icon-anchor":new It(Fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new xt(Fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new xt(Fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new xt(Fe.layout_symbol["text-rotation-alignment"]),"text-field":new It(Fe.layout_symbol["text-field"]),"text-font":new It(Fe.layout_symbol["text-font"]),"text-size":new It(Fe.layout_symbol["text-size"]),"text-size-scale-range":new xt(Fe.layout_symbol["text-size-scale-range"]),"text-max-width":new It(Fe.layout_symbol["text-max-width"]),"text-line-height":new It(Fe.layout_symbol["text-line-height"]),"text-letter-spacing":new It(Fe.layout_symbol["text-letter-spacing"]),"text-justify":new It(Fe.layout_symbol["text-justify"]),"text-radial-offset":new It(Fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new xt(Fe.layout_symbol["text-variable-anchor"]),"text-anchor":new It(Fe.layout_symbol["text-anchor"]),"text-max-angle":new xt(Fe.layout_symbol["text-max-angle"]),"text-writing-mode":new xt(Fe.layout_symbol["text-writing-mode"]),"text-rotate":new It(Fe.layout_symbol["text-rotate"]),"text-padding":new xt(Fe.layout_symbol["text-padding"]),"text-keep-upright":new xt(Fe.layout_symbol["text-keep-upright"]),"text-transform":new It(Fe.layout_symbol["text-transform"]),"text-offset":new It(Fe.layout_symbol["text-offset"]),"text-allow-overlap":new xt(Fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new xt(Fe.layout_symbol["text-ignore-placement"]),"text-optional":new xt(Fe.layout_symbol["text-optional"]),visibility:new xt(Fe.layout_symbol.visibility)})),paint:az||(az=new wr({"icon-opacity":new It(Fe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new It(Fe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new It(Fe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new It(Fe.paint_symbol["text-emissive-strength"]),"icon-color":new It(Fe.paint_symbol["icon-color"]),"icon-halo-color":new It(Fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new It(Fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new It(Fe.paint_symbol["icon-halo-blur"]),"icon-translate":new xt(Fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new xt(Fe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new xt(Fe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new It(Fe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new It(Fe.paint_symbol["text-occlusion-opacity"]),"text-color":new It(Fe.paint_symbol["text-color"],{runtimeType:Mo,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new It(Fe.paint_symbol["text-halo-color"]),"text-halo-width":new It(Fe.paint_symbol["text-halo-width"]),"text-halo-blur":new It(Fe.paint_symbol["text-halo-blur"]),"text-translate":new xt(Fe.paint_symbol["text-translate"]),"text-translate-anchor":new xt(Fe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new xt(Fe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new xt(Fe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new xt(Fe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new xt(Fe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new It(Fe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},WA);class aT extends xo{constructor(n,s,u,h){super(n,qA(),s,u,h,n.layout?n.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=re([]),this.hasOcclusionOpacityProperties=n.paint!==void 0&&("icon-occlusion-opacity"in n.paint||"text-occlusion-opacity"in n.paint)}_handleSpecialPaintPropertyUpdate(n){n!=="icon-occlusion-opacity"&&n!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(n,s){super.recalculate(n,s),this.appearances&&this.appearances.forEach(h=>{h.recalculate(n,s,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const h=[];for(const g of u)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(n,s,u,h){return this._saturation===n&&this._contrast===s&&this._brightnessMin===u&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(g,_,x,T){g=_r(g),_=ai(_);const C=J(),R=g/3,M=1-2*R,D=[M,R,R,0,R,M,R,0,R,R,M,0,0,0,0,1],O=.5-.5*_,j=T-x;return ee(C,[j,0,0,0,0,j,0,0,0,0,j,0,x,x,x,1],[_,0,0,0,0,_,0,0,0,0,_,0,O,O,O,1]),ee(C,C,D),C}(n,s,u,h),this._saturation=n,this._contrast=s,this._brightnessMin=u,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(n,s,u,h){const g=this.layout.get(n).evaluate(s,{},u,h),_=this._unevaluatedLayout._values[n];return _.isDataDriven()||Ep(_.value)||!g?g:sz(s.properties,g)}getAppearanceValueAndResolveTokens(n,s,u,h,g){const _=n.getProperty(s);if(!_)return;const x=_.evaluate(u,{},h,g),T=n.getUnevaluatedProperties()._values[s];return T.isDataDriven()||Ep(T.value)||!x||typeof x!="string"?x:sz(u.properties,x)}createBucket(n){return new oT(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of qA().paint.overridableProperties){if(!aT.hasPaintOverride(this.layout,n))continue;const s=this.paint.get(n),u=new lz(s),h=new Mg(u,s.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let g=null;g=s.value.kind==="constant"||s.value.kind==="source"?new bh("source",h):new gd("composite",h,s.value.zoomStops,s.value.interpolationType),this.paint._values[n]=new yd(s.property,g,s.parameters)}}_handleOverridablePaintPropertyUpdate(n,s,u){return!(!this.layout||s.isDataDriven()||u.isDataDriven())&&aT.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,s){const u=n.get("text-field"),h=qA().paint.properties[s];let g=!1;const _=x=>{for(const T of x)if(h.overrides&&h.overrides.hasOverride(T))return void(g=!0)};if(u.value.kind==="constant"&&u.value.value instanceof go)_(u.value.value.sections);else if(u.value.kind==="source"){const x=C=>{g||(C instanceof cc&&_s(C.value)===cp?_(C.value.sections):C instanceof Nl?_(C.sections):C.eachChild(x))},T=u.value;T._styleExpression&&x(T._styleExpression.expression)}return g}getProgramIds(){return["symbol"]}getDefaultProgramParams(n,s,u){return{config:new Iu(this,{zoom:s,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let cz,uz,dz,hz;var ZA=Gn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function lT(a,n,s,u,h,g,_,x){const T=[a,n,1,s,u,1,h,g,1],C=[_,x,1],R=z([],T),[M,D,O]=Ts(C,C,R);return $(T,T,[M,0,0,0,D,0,0,0,O])}function fz(a,n,s,u,h,g,_,x){const T=function(C,R,M,D,O,j,G,X){const K=lT(0,0,1,0,1,1,0,1),se=lT(C,R,M,D,O,j,G,X);return $(se,se,z([],K))}(a,n,s,u,h,g,_,x);return[T[2]/T[8]/wt,T[5]/T[8]/wt]}function cT(a){return[a[0],Math.min(Math.max(a[1],-U),U)]}class pz extends ud{constructor(n,s,u,h){super(),this.id=n,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=s,this._dirty=!1}load(n,s){if(this._loaded=s||!1,this.fire(new kl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return n&&(this.coordinates=n),this._loaded=!0,void this._finishLoading();this._imageRequest=Qm(this.map._requestManager.transformRequest(this.url,np.Image),(u,h)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new op(u)):h&&(this.image=h instanceof HTMLImageElement?gs.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}setTexture(n){if(!(n.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Ox(this.map.painter.context,n.handle),this.width=n.dimensions[0],this.height=n.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new kl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(n){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Ox||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(n){if(this.coordinates=n,this._boundsArray=void 0,this._unsupportedCoords=!1,!n.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=n[0][1],u=n[0][1];for(const g of n)g[1]>u&&(u=g[1]),g[1]<s&&(s=g[1]);const h=(u+s)/2;if(h>U?this.onNorthPole=!0:h<-U&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const g=n.map(le.fromLngLat);this.tileID=function(_){let x=1/0,T=1/0,C=-1/0,R=-1/0;for(const G of _)x=Math.min(x,G.x),T=Math.min(T,G.y),C=Math.max(C,G.x),R=Math.max(R,G.y);const M=Math.max(C-x,R-T),D=Math.max(0,Math.floor(-Math.log2(M))),O=Math.pow(2,D);let j=Math.floor((x+C)/2*O);return j>1&&(j-=1),new zi(D,j,Math.floor((T+R)/2*O))}(g),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new kl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Ox||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(n){for(const K in this.tiles){const se=this.tiles[K];se.state!=="loaded"&&(se.state="loaded",se.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const s=Hx(new zi(0,0,0),this.map.transform.projection),u=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(K){const se=K[1].x-K[0].x,ae=K[1].y-K[0].y,de=K[2].x-K[1].x,ve=K[2].y-K[1].y,me=K[3].x-K[2].x,Te=K[3].y-K[2].y,Ie=K[0].x-K[3].x,Re=K[0].y-K[3].y,qe=se*ve-de*ae,Ne=de*Te-me*ve,Qe=me*Re-Ie*Te,it=Ie*ae-se*Re;return qe>0&&Ne>0&&Qe>0&&it>0||qe<0&&Ne<0&&Qe<0&&it<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=Hx(this.tileID,this.map.transform.projection),[g,_,x,T]=this.coordinates.map(K=>{const se=h.projection.project(K[0],K[1]);return JF(h,se)._round()});this.perspectiveTransform=fz(g.x,g.y,_.x,_.y,x.x,x.y,T.x,T.y);const C=this._boundsArray=new Sh;C.emplaceBack(g.x,g.y,0,0),C.emplaceBack(_.x,_.y,wt,0),C.emplaceBack(T.x,T.y,0,wt),C.emplaceBack(x.x,x.y,wt,wt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=n.createVertexBuffer(C,ZA.members),this.boundsSegments=dr.simpleSegment(0,0,4,2);const R=[],M=[cT((D=this.coordinates)[0]),cT(D[1]),cT(D[2]),cT(D[3])];var D;const[O,j,G,X]=function(K){let se=K[0][0],ae=se,de=K[0][1],ve=de;for(let me=1;me<K.length;me++)K[me][0]<se?se=K[me][0]:K[me][0]>ae&&(ae=K[me][0]),K[me][1]<de?de=K[me][1]:K[me][1]>ve&&(ve=K[me][1]);return[se,de,ae-se,ve-de]}(M);{const K=new Sh,[se,ae,de,ve]=function(ct){let ut=ct[0].x,Ye=ut,Ze=ct[0].y,dt=Ze;for(let Tt=1;Tt<ct.length;Tt++)ct[Tt].x<ut?ut=ct[Tt].x:ct[Tt].x>Ye&&(Ye=ct[Tt].x),ct[Tt].y<Ze?Ze=ct[Tt].y:ct[Tt].y>dt&&(dt=ct[Tt].y);return[ut,Ze,Ye-ut,dt-Ze]}(u),me=ct=>[(ct.x-se)/de,(ct.y-ae)/ve],[Te,Ie,Re,qe]=u.map(me),Ne=function(ct,ut,Ye,Ze,dt,Tt,yt,Yt){const kt=lT(0,0,1,0,1,1,0,1);return $(kt,kt,z([],lT(ct,ut,Ye,Ze,dt,Tt,yt,Yt)))}(Te[0],Te[1],Ie[0],Ie[1],Re[0],Re[1],qe[0],qe[1]);this.elevatedGlobePerspectiveTransform=fz(Te[0],Te[1],Ie[0],Ie[1],Re[0],Re[1],qe[0],qe[1]);const Qe=(ct,ut)=>{R.push(ct.lng);const Ye=Math.round((ct.lng-O)/G*wt),Ze=Math.round((ct.lat-j)/X*wt),dt=me(ut),Tt=Ts([],[dt[0],dt[1],1],Ne),yt=Math.round(Tt[0]/Tt[2]*wt),Yt=Math.round(Tt[1]/Tt[2]*wt);K.emplaceBack(Ye,Ze,yt,Yt)},it=u[3].x-u[0].x,rt=u[3].y-u[0].y,ht=u[2].x-u[1].x,pt=u[2].y-u[1].y;for(let ct=0;ct<65;ct++){const ut=ct/64,Ye=[u[0].x+ut*it,u[0].y+ut*rt],Ze=[u[1].x+ut*ht,u[1].y+ut*pt],dt=Ze[0]-Ye[0],Tt=Ze[1]-Ye[1];for(let yt=0;yt<65;yt++){const Yt=yt/64,kt={x:Ye[0]+dt*Yt,y:Ye[1]+Tt*Yt};Qe(s.projection.unproject(kt.x,kt.y),kt)}}this.elevatedGlobeVertexBuffer=n.createVertexBuffer(K,ZA.members)}{this.maxLongitudeTriangleSize=0;let K=[],se=new Jr;const ae=(de,ve,me)=>{se.emplaceBack(de,ve,me);const Te=R[de],Ie=R[ve],Re=R[me],qe=Math.min(Math.min(Te,Ie),Re),Ne=Math.max(Math.max(Te,Ie),Re)-qe;Ne>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ne),K.push(qe+Ne/2)};for(let de=0;de<64;de++)for(let ve=0;ve<64;ve++){const me=65*de+ve,Te=me+1,Ie=me+65,Re=Ie+1;ae(me,Ie,Te),ae(Te,Ie,Re)}[K,se]=function(de,ve){const me=Array.from({length:de.length},(Re,qe)=>qe);me.sort((Re,qe)=>de[Re]-de[qe]);const Te=[],Ie=new Jr;for(let Re=0;Re<me.length;Re++){const qe=me[Re];Te.push(de[qe]);const Ne=3*qe,Qe=Ne+1;Ie.emplaceBack(ve.uint16[Ne],ve.uint16[Qe],ve.uint16[Qe+1])}return[Te,Ie]}(K,se),this.elevatedGlobeTrianglesCenterLongitudes=K,this.elevatedGlobeIndexBuffer=n.createIndexBuffer(se)}this.elevatedGlobeSegments=dr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,G/wt,0,X/wt,0,0,j,O,0])}prepare(){const n=Object.keys(this.tiles).length!==0;if(this.tileID&&!n)return;const s=this.map.painter.context,u=s.gl;!this._dirty||this.texture instanceof Ox||(this.texture?this.texture.update(this.image):(this.texture=new vA(s,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),n&&this._prepareData(s)}loadTile(n,s){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},s(null)):(n.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(n){const s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let h=(g=n+180)+360*Math.round((u[0]-g)/360);var g;const _=new dr,x=(M,D)=>{_.segments.push({vertexOffset:0,primitiveOffset:M,vertexLength:s.segments[0].vertexLength,primitiveLength:D,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-h)<=T){const M=gr(u,0,u.length,h+T);return M===u.length||x(M,Xr(u,M+1,u.length,h+360-T)-M),_}h<u[0]&&(h+=360);const C=Xr(u,0,u.length,h-T);if(C===u.length)return x(0,u.length),_;x(0,C-0);const R=gr(u,C+1,u.length,h+T);return R!==u.length&&x(R,u.length-R),_}}const hY=(Math.pow(256,2)-1)/16907520;class mz extends xo{constructor(n,s,u,h){super(n,{layout:dz||(dz=new wr({visibility:new xt(Fe.layout_raster.visibility)})),paint:hz||(hz=new wr({"raster-opacity":new xt(Fe.paint_raster["raster-opacity"]),"raster-color":new xd(Fe.paint_raster["raster-color"]),"raster-color-mix":new xt(Fe.paint_raster["raster-color-mix"]),"raster-color-range":new xt(Fe.paint_raster["raster-color-range"]),"raster-hue-rotate":new xt(Fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new xt(Fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new xt(Fe.paint_raster["raster-brightness-max"]),"raster-saturation":new xt(Fe.paint_raster["raster-saturation"]),"raster-contrast":new xt(Fe.paint_raster["raster-contrast"]),"raster-resampling":new xt(Fe.paint_raster["raster-resampling"]),"raster-fade-duration":new xt(Fe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new xt(Fe.paint_raster["raster-emissive-strength"]),"raster-array-band":new xt(Fe.paint_raster["raster-array-band"]),"raster-elevation":new xt(Fe.paint_raster["raster-elevation"]),"raster-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},s,u,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(n){return!(n&&n._source instanceof pz&&(n._source.onNorthPole||n._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(n){n!=="raster-color"&&n!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(n){if(!this.hasColorMap()||!this._curRampRange)return;const s=this._transitionablePaint._values["raster-color"].value.expression,[u,h]=n||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(h)||u===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=bx({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,h])}}let gz,_z,yz,vz,xz;class bz extends xo{constructor(n,s,u,h){super(n,{layout:gz||(gz=new wr({visibility:new xt(Fe["layout_raster-particle"].visibility)})),paint:_z||(_z=new wr({"raster-particle-array-band":new xt(Fe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new xt(Fe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new xd(Fe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new xt(Fe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new xt(Fe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new xt(Fe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new xt(Fe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new xt(Fe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},s,u,h),this._updateColorRamp(),this.lastInvalidatedAt=gs.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(n){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(n){return!1}_handleSpecialPaintPropertyUpdate(n){n!=="raster-particle-color"&&n!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),n==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const n=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=bx({expression:n,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=gs.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class fY extends xo{constructor(n,s){super(n,{},s,null),this.implementation=n,n.slot&&(this.slot=n.slot)}is3D(n){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(n){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}function KA(a,n,s){const u=[0,0,1],h=zs([]);return tl(h,h,s?-$n(a)+Math.PI:$n(a)),Hs(h,h,-$n(n)),fo(u,u,h),pn(u,u)}const wz={None:0,Model:1,Symbol:2,FillExtrusion:4};class uT{constructor(n,s,u,h){this.message=(n?`${n}: `:"")+u,h&&(this.identifier=h),s!=null&&s.__line__&&(this.line=s.__line__)}}function XA(a,n){const s=a.indexOf("://")===-1;try{return new URL(a,s&&n?"http://example.com":void 0),!0}catch{return!1}}class Tz{constructor(n,s){this.feature=n,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Ez{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new ux,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(n){const s=16*n,u=this.instancedDataArray.float32;let h=Math.floor(u[s+2]);const g=1.05*(u[s+2]-h);return h/=100,[u[s]%1*1.05,u[s+1]%1*1.05,g,h]}tileCoordinatesForInstance(n){const s=16*n,u=this.instancedDataArray.float32;let h=u[s+0];return h=h>wt?h-wt:h,new st(Math.trunc(h),Math.trunc(u[s+1]))}translationForInstance(n){const s=16*n,u=this.instancedDataArray.float32;return[u[s+4],u[s+5],u[s+6]]}rotationScaleForInstance(n){const s=16*n,u=this.instancedDataArray.float32;return[u[s+7],u[s+8],u[s+9],u[s+10],u[s+11],u[s+12],u[s+13],u[s+14],u[s+15]]}transformForInstance(n){const s=16*n,u=this.instancedDataArray.float32;return[u[s+7],u[s+8],u[s+9],u[s+4],u[s+10],u[s+11],u[s+12],u[s+5],u[s+13],u[s+14],u[s+15],u[s+6],0,0,0,1]}}class YA{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaledZ=this.canonical.z+Math.log2(n.overscaling),this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=n.projection,this.index=n.index,this.worldview=n.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=n.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(n,s){}updateAppearances(n,s,u,h){}populate(n,s,u,h){this.tileToMeter=te(u);const g=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:x,index:T,sourceLayerIndex:C}of n){const R=x??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),M=De(_,g);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),M,u))continue;const D={id:R,sourceLayerIndex:C,index:T,geometry:g?M.geometry:Se(_,u,h),properties:_.properties,type:_.type,patterns:{}},O=this.addFeature(D,D.geometry,M);O&&s.featureIndex.insert(_,D.geometry,T,C,this.index,this.instancesPerModel[O].instancedDataArray.length,wt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const n=this.layers[0].modelManager,s=this.layers[0].scope;let u=0;for(const h of this.modelUris){const g=n.getModel(h,s);if(!g)continue;const _=this.instancesPerModel[h];if(_){const x=.5*Ji(g.aabb.max,g.aabb.min)*_.maxScale+_.maxXYTranslationDistance,T=Math.min(wt,Math.max(x/this.tileToMeter,wt/32));u=Math.max(T,u)}}return u}update(n,s,u,h){for(const g in this.instancesPerModel){const _=this.instancesPerModel[g];for(const x in n)_.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(_.features[_.idToFeaturesIndex[x]],n[x],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let n=!1;for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];for(const h of u.features){const g=this.layers[0],_=h.feature,x=this.canonical,T=g.paint.get("model-rotation").evaluate(_,{},x),C=g.paint.get("model-scale").evaluate(_,{},x),R=g.paint.get("model-translation").evaluate(_,{},x);Kr(h.rotation,T)&&Kr(h.scale,C)&&Kr(h.translation,R)||(this.evaluate(h,h.featureStates,u,!0),n=!0)}}return n}updateReplacement(n,s,u,h){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const g=s.getReplacementRegionsForTile(n.toUnwrapped(),!0);if(Nw(this.activeReplacements,g))return!1;this.activeReplacements=g;let _=!1;for(const x in this.instancesPerModel){const T=this.instancesPerModel[x],C=T.instancedDataArray;for(const R of T.features){const M=R.instancedDataOffset,D=R.instancedDataCount;for(let O=0;O<D;O++){const j=16*(O+M);let G=C.float32[j+0];const X=G>wt;G=X?G-wt:G;const K=Math.floor(G),se=Math.floor(C.float32[j+1]);let ae=!1;for(const de of this.activeReplacements)if(!uO(de,u,wz.Model,h)&&!(de.min.x>K||K>de.max.x||de.min.y>se||se>de.max.y)&&(ae=mO(pO(K,se,n.canonical,de.footprintTileId.canonical),de.footprint),ae))break;C.float32[j]=ae?G+wt:G,_=_||ae!==X}}}return _}isEmpty(){for(const n in this.instancesPerModel)if(this.instancesPerModel[n].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(n){if(!this.uploaded)for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=n.createVertexBuffer(u.instancedDataArray,OK.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(n){for(const u in this.instancesPerModel){const h=this.instancesPerModel[u];h.instancedDataArray.length!==0&&h.instancedDataBuffer&&h.instancedDataBuffer.destroy()}const s=this.layers[0].modelManager;if(n&&s&&this.modelUris&&this.modelsRequested)for(const u of this.modelUris)s.removeModel(u,"",!0)}addFeature(n,s,u){const h=this.layers[0],g=h.layout.get("model-id").evaluate(u,{},this.canonical);if(!g)return Nt(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),g;(XA(g,!1)||this.styleDefinedModelURLs[g]!==void 0)&&(this.modelUris.includes(g)||this.modelUris.push(g)),this.instancesPerModel[g]||(this.instancesPerModel[g]=new Ez);const _=this.instancesPerModel[g],x=_.instancedDataArray,T=new Tz(u,x.length);for(const C of s)for(const R of C){if(R.x<0||R.x>=wt||R.y<0||R.y>=wt)continue;if(this.lookupDim!==0){const D=(this.lookupDim-1)/wt,O=this.lookupDim*(R.y*D|0)+R.x*D|0;if(this.lookup){if(this.lookup[O]!==0)continue;this.lookup[O]=1}}this.instanceCount++;const M=x.length;x.resize(M+1),_.instancesEvaluatedElevation.push(0),x.float32[16*M]=R.x,x.float32[16*M+1]=R.y}return T.instancedDataCount=_.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(n.id&&(_.idToFeaturesIndex[n.id]=_.features.length),_.features.push(T),this.evaluate(T,{},_,!1)),g}getModelUris(){return this.modelUris}evaluate(n,s,u,h){const g=this.layers[0],_=n.feature,x=this.canonical,T=n.rotation=g.paint.get("model-rotation").evaluate(_,s,x),C=n.scale=g.paint.get("model-scale").evaluate(_,s,x),R=n.translation=g.paint.get("model-translation").evaluate(_,s,x),M=Object.assign({},g.paint.get("model-color").evaluate(_,s,x));M.a=g.paint.get("model-color-mix-intensity").evaluate(_,s,x);const D=[];this.maxVerticalOffset<R[2]&&(this.maxVerticalOffset=R[2]);const O=R[0]*R[0]+R[1]*R[1],j=O>0?Math.sqrt(O):0;u.maxScale=Math.max(Math.max(u.maxScale,C[0]),Math.max(C[1],C[2])),u.maxXYTranslationDistance=Math.max(u.maxXYTranslationDistance,j),this.maxScale=Math.max(Math.max(this.maxScale,C[0]),Math.max(C[1],C[2])),tF(D,T,C);const G=Math.round(100*M.a)+M.b/1.05;for(let X=0;X<n.instancedDataCount;++X){const K=n.instancedDataOffset+X,se=16*K,ae=u.instancedDataArray.float32;let de=0;h&&(de=ae[se+6]-u.instancesEvaluatedElevation[K]);const ve=0|ae[se+1];ae[se]=(0|ae[se])+M.r/1.05,ae[se+1]=ve+M.g/1.05,ae[se+2]=G,ae[se+3]=1/(x.z>10?this.tileToMeter:te(x,ve)),ae[se+4]=R[0],ae[se+5]=R[1],ae[se+6]=R[2]+de,ae[se+7]=D[0],ae[se+8]=D[1],ae[se+9]=D[2],ae[se+10]=D[4],ae[se+11]=D[5],ae[se+12]=D[6],ae[se+13]=D[8],ae[se+14]=D[9],ae[se+15]=D[10],u.instancesEvaluatedElevation[K]=R[2]}}}let Sz,Cz;jt(YA,"ModelBucket",{omit:["layers"]}),jt(Ez,"PerModelAttributes"),jt(Tz,"ModelFeature");class S_{constructor(n,s,u){this._demTile=n,this._dem=this._demTile.dem,this._scale=s,this._offset=u}static create(n,s,u){const h=u||n.findDEMTileFor(s);if(!h||!h.dem)return;const g=h.dem,_=h.tileID,x=1<<s.canonical.z-_.canonical.z;return new S_(h,g.dim/wt/x,[(s.canonical.x/x-_.canonical.x)*g.dim,(s.canonical.y/x-_.canonical.y)*g.dim])}tileCoordToPixel(n,s){const u=s*this._scale+this._offset[1];return new st(Math.floor(n*this._scale+this._offset[0]),Math.floor(u))}getElevationAt(n,s,u,h){const g=n*this._scale+this._offset[0],_=s*this._scale+this._offset[1],x=Math.floor(g),T=Math.floor(_),C=this._dem;return h=!!h,u?fn(fn(C.get(x,T,h),C.get(x,T+1,h),_-T),fn(C.get(x+1,T,h),C.get(x+1,T+1,h),_-T),g-x):C.get(x,T,h)}getElevationAtPixel(n,s,u){return this._dem.get(n,s,!!u)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*k(1,n)*this._dem.stride}}const QA=new Float32Array(262144),Wp=new Uint8Array(262144);function Iz(a){let n=0;if(a.meshes)for(const s of a.meshes)n=Math.max(n,s.aabb.max[2]);if(a.children)for(const s of a.children)n=Math.max(n,Iz(s));return n}function Az(a,n,s){if(a.meshes)for(const u of a.meshes){if(u.aabb.min[0]===1/0)continue;const h=Ht.applyTransform(u.aabb,a.globalMatrix);s.insert(n,h.min[0],h.min[1],h.max[0],h.max[1])}if(a.children)for(const u of a.children)Az(u,n,s)}const Pz=["","wall","door","roof","window","lamp","logo"];class Rz{constructor(n){this.node=n,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:n.id,geometry:[],properties:{height:Iz(n)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Ht([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let n=0;const s=new Ht([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==n&&(u.transformedAabb=Ht.applyTransformFast(u.aabb,this.node.globalMatrix),s.encapsulate(u.transformedAabb)),n++;this.aabb=s}return this.aabb}}class dT{constructor(n,s,u,h,g,_,x,T){this.id=u,this.layers=n,this.layerIds=this.layers.map(C=>C.fqid),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.modelTraits|=g_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=g_.HasMapboxMeshFeatures),g&&(this.modelTraits|=g_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.worldview=T,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const C of s)this.nodesInfo.push(new Rz(C)),Az(C,x.featureIndexArray.length,x.grid),x.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,x.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(n,s){for(const u of this.getNodesInfo()){const h=u.node;h.footprint&&s.push({footprint:h.footprint,id:n})}}updateAppearances(n,s,u,h){}update(n){const s=Object.keys(n).length!==0;if(s&&!this.stateDependentLayers.length)return;const u=s?this.stateDependentLayers:this.layers;if(!Zs(n,this.states))for(const h of u)this.evaluate(h,n);this.states=structuredClone(n)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(n){if(!this.needsUpload)return;const s=this.getNodesInfo();for(const u of s){const h=u.node;this.uploaded?this.updatePbrBuffer(h):wA(h,n,!0)}for(const u of s)Ww(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(n){let s=!1;if(!n.meshes)return s;for(const u of n.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),s=!0);return s}needsReEvaluation(n,s,u){const h=n.transform.projectionOptions,g=n.style.getBrightness(),_=this.brightness!==g;if(!this.uploaded||this.dirty||h.name!==this.projection.name||Jx(u.paint.get("model-color").value,_)||Jx(u.paint.get("model-color-mix-intensity").value,_)||Jx(u.paint.get("model-roughness").value,_)||Jx(u.paint.get("model-emissive-strength").value,_)||Jx(u.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=h,this.brightness=g;const x=this.getNodesInfo();for(const T of x)T.state=null;return!0}return!1}evaluateTransform(n,s){if(n.transform.zoom===this.zoom)return;this.zoom=n.transform.zoom;const u=this.getNodesInfo(),h=this.id.canonical;for(const g of u){const _=g.feature;g.evaluatedTranslation=s.paint.get("model-translation").evaluate(_,{},h),g.evaluatedScale=s.paint.get("model-scale").evaluate(_,{},h)}}evaluate(n,s){const u=this.getNodesInfo();for(const h of u){if(!h.node.meshes)continue;const g=h.feature,_=s&&s[g.id];if(Zs(_,h.state))continue;h.state=structuredClone(_);const x=h.node.meshes&&h.node.meshes[0].featureData,T=h.evaluatedColor[2],C=h.evaluatedRMEA[2],R=this.id.canonical;if(h.hasTranslucentParts=!1,x){for(let M=0;M<Pz.length;M++){const D=Pz[M];D.length&&(g.properties.part=D);const O=n.paint.get("model-color").evaluate(g,_,R).toPremultipliedRenderColor(null),j=n.paint.get("model-color-mix-intensity").evaluate(g,_,R);h.evaluatedColor[M]=[O.r,O.g,O.b,j],h.evaluatedRMEA[M][0]=n.paint.get("model-roughness").evaluate(g,_,R),h.evaluatedRMEA[M][2]=n.paint.get("model-emissive-strength").evaluate(g,_,R),h.evaluatedRMEA[M][3]=O.a,h.emissionHeightBasedParams[M]=n.paint.get("model-height-based-emissive-strength-multiplier").evaluate(g,_,R),!h.hasTranslucentParts&&O.a<1&&(h.hasTranslucentParts=!0)}delete g.properties.part,mY(h,T!==h.evaluatedColor[2]||C!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=n.paint.get("model-emissive-strength").evaluate(g,_,R);h.evaluatedTranslation=n.paint.get("model-translation").evaluate(g,_,R),h.evaluatedScale=n.paint.get("model-scale").evaluate(g,_,R),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(n,s,u,h){const g=n.findDEMTileFor(u);if(g&&(g.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(g.dem&&g.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=g.tileID.overscaledZ;const _=S_.create(n,u,g);if(!_)return;this.modelTraits&g_.HasMapboxMeshFeatures&&this.updateDEM(n,_,u,h);for(const x of this.getNodesInfo()){const T=x.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;const C=T.footprint.vertices;let R=_.getElevationAt(C[0].x,C[0].y,!0,!0);for(let M=1;M<C.length;M++)R=Math.min(R,_.getElevationAt(C[M].x,C[M].y,!0,!0));T.elevation=R}}this.terrainTile=g.tileID.canonical,this.terrainExaggeration=s}}updateDEM(n,s,u,h){let g=s._dem._modifiedForSources[h];if(g===void 0&&(s._dem._modifiedForSources[h]=[],g=s._dem._modifiedForSources[h]),g.includes(u.canonical))return;const _=s._dem.dim;g.push(u.canonical);let x=!1;for(const T of this.getNodesInfo()){const C=T.node;if(!C.footprint||!C.footprint.grid)continue;const R=C.footprint.grid,M=s.tileCoordToPixel(R.min.x,R.min.y),D=s.tileCoordToPixel(R.max.x,R.max.y),O=Math.min(Math.min(_-D.y,M.x),Math.min(M.y,_-D.x));if(O<0)continue;const j=Y(O,2,5);let G=Math.max(0,M.x-j),X=Math.max(0,M.y-j),K=Math.min(D.x+j,_-1),se=Math.min(D.y+j,_-1);for(let me=X;me<=se;++me)for(let Te=G;Te<=K;++Te)Wp[me*_+Te]=255;let ae=0,de=0;for(let me=0;me<R.cellsY;++me)for(let Te=0;Te<R.cellsX;++Te){if(!R.cells[me*R.cellsX+Te])continue;const Ie=s.tileCoordToPixel(R.min.x+Te/R.xScale,R.min.y+me/R.yScale),Re=s.tileCoordToPixel(R.min.x+(Te+1)/R.xScale,R.min.y+(me+1)/R.yScale);for(let qe=Ie.y;qe<=Math.min(Re.y+1,_-1);++qe)for(let Ne=Ie.x;Ne<=Math.min(Re.x+1,_-1);++Ne)Wp[qe*_+Ne]===255&&(Wp[qe*_+Ne]=0,ae+=s.getElevationAtPixel(Ne,qe),de++)}const ve=ae/de;G=Math.max(1,M.x-j),X=Math.max(1,M.y-j),K=Math.min(D.x+j,_-2),se=Math.min(D.y+j,_-2),x=!0;for(let me=X;me<=se;++me)for(let Te=G;Te<=K;++Te)Wp[me*_+Te]===0&&(QA[me*_+Te]=s._dem.set(Te,me,ve));for(let me=1;me<j;++me){G=Math.max(1,M.x-me),X=Math.max(1,M.y-me),K=Math.min(D.x+me,_-2),se=Math.min(D.y+me,_-2);for(let Te=X;Te<=se;++Te)for(let Ie=G;Ie<=K;++Ie){const Re=Te*_+Ie;if(Wp[Re]===255){let qe=0,Ne=0,Qe=-1,it=-1;for(let rt=-1;rt<=1;++rt)for(let ht=-1;ht<=1;++ht){const pt=(Te+rt)*_+Ie+ht;if(Wp[pt]>=me)continue;const ct=QA[pt],ut=Math.abs(ct);ut>Ne&&(qe=ct,Ne=ut,Qe=ht,it=rt)}if(Ne>.1){const rt=1-(me+.5*Math.abs(Qe*it))/j;let ht=s._dem.get(Ie,Te)+qe*rt;const pt=s._dem.get(Ie+Qe,Te+it),ct=s._dem.get(Ie-Qe,Te-it,!0);(ht-pt)*(ht-ct)>0&&(ht=(pt+ct)/2),QA[Re]=s._dem.set(Ie,Te,ht),Wp[Re]=me}}}}}x&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=gs.now())}setFilter(n){this.filter=n?Bg(n):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(n=>this.filter.filter(new Wi(this.id.overscaledZ,{worldview:this.worldview}),n.feature,this.id.canonical)):this.nodesInfo}destroy(){const n=this.getNodesInfo();for(const s of n)Ww(s.node),TA(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(n,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const u=s.getReplacementRegionsForTile(n.toUnwrapped());for(const h of this.getNodesInfo()){const g=h.node.footprint;h.hiddenByReplacement=!!g&&!u.find(_=>_.footprint===g)}}getHeightAtTileCoord(n,s){const u=[],h=[0,0,0],g=re([]);for(const _ of this.getNodesInfo()){const x=_.node.meshes[0],T=x.transformedAabb;if(n<T.min[0]||s<T.min[1]||n>T.max[0]||s>T.max[1])continue;if(_.node.hidden===!0)return{height:1/0,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};Q(g,_.node.globalMatrix),h[0]=n,h[1]=s,Mi(h,h,g);const C=(h[0]-x.aabb.min[0])/(x.aabb.max[0]-x.aabb.min[0])*$p|0,R=Math.min(63,(h[1]-x.aabb.min[1])/(x.aabb.max[1]-x.aabb.min[1])*$p|0)*$p+Math.min(63,C),M=x.heightmap[R];if(!(M<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:M,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new st(n,s),new st(n,s),u),u.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function Jx(a,n){return a instanceof bh&&!a.isLightConstant&&n}function pY(a,n,s,u,h,g,_,x){let T=(61440&n|(61440&n)>>4)>>8,C=(3840&n|(3840&n)>>4)>>4,R=240&n|(240&n)>>4;s[3]>0&&(T=fn(T,255*s[0],s[3]),C=fn(C,255*s[1],s[3]),R=fn(R,255*s[2],s[3]));const M=T<<8|C,D=R<<8|Math.floor(255*u[3]),O=function(me){const Te=Y(me,0,2);return Math.min(Math.round(.5*Te*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],j=Y(h[0],0,1),G=Y(h[1],0,1),X=Y(h[2],0,1),K=Y(h[3],0,1);let se,ae,de,ve;if(j!==G&&_!==g&&G!==j){const me=_-g;ae=1/(me*(G-j)),de=-(g+me*j)/(me*(G-j));const Te=Y(h[4],-1,1);ve=Math.pow(10,Te),se=255*X<<8|255*K}else se=65535,ae=0,de=1,ve=1;if(a.emplaceBack(M,D,O,se,ae,de,ve),x){const me=x.length;x.clear();for(let Te=0;Te<me;Te++)x.emplaceBack(M,D,O,se,ae,de,ve)}}function mY(a,n,s){const u=a.node;let h=0;const g=s&g_.HasMeshoptCompression;for(const _ of u.meshes){if(u.lights&&u.lightMeshIndex===h||!_.featureData)continue;_.featureArray=new Yg,_.featureArray.reserve(_.featureData.length);let x=n;for(const T of _.featureData){const C=g?65535&T:T>>16&65535,R=g?T>>16&65535:65535&T,M=(15&R)<8?15&R:0,D=a.evaluatedRMEA[M],O=a.evaluatedColor[M],j=a.emissionHeightBasedParams[M];let G;if(x&&M===2&&u.lights&&(G=new Yg,G.resize(10*u.lights.length)),pY(_.featureArray,C,O,D,j,_.aabb.min[2],_.aabb.max[2],G),G&&x){x=!1;const X=u.meshes[u.lightMeshIndex];X.featureArray=G,X.featureArray._trim()}}_.featureArray._trim(),h++}}jt(dT,"Tiled3dModelBucket",{omit:["layers"]}),jt(Rz,"Tiled3dModelFeature");const gY=["id","tile","layer","source","sourceLayer","state"];class qp{constructor(n,s,u,h,g){this.type="Feature",this._vectorTileFeature=n,this._z=s,this._x=u,this._y=h,this.properties=n?n.properties:{},this.id=g}clone(){const n=new qp(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(n.state=Object.assign({},this.state)),this.layer&&(n.layer=Object.assign({},this.layer)),this.source&&(n.source=this.source),this.sourceLayer&&(n.sourceLayer=this.sourceLayer),n}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const s of gY)this[s]!==void 0&&(n[s]=this[s]);return n}}class Zp extends ud{constructor(n,s,u,h){super(),this.id=n,this.type="model",this.models=[],this._loaded=!1,this._options=s,this._modelsInfo=new Map}load(){const n=[];for(const s in this._options.models){const u=this._options.models[s],h=this._modelsInfo.get(s);if(h){const g=h.model;g.position=u.position!=null?new c(u.position[0],u.position[1]):new c(0,0),g.orientation=u.orientation!=null?u.orientation:[0,0,0],h.modelSpec=u,Zp.applyModelSpecification(g,u),g.computeBoundsAndApplyParent(),this.models.push(g)}else{const g=YO(this.map._requestManager.transformRequest(u.uri,np.Model).url).then(_=>{if(!_)return;const x=SA(_),T=new nF(s,u.uri,u.position,u.orientation,x);Zp.applyModelSpecification(T,u),T.computeBoundsAndApplyParent(),this.models.push(T),this._modelsInfo.set(s,{modelSpec:u,model:T})}).catch(_=>{this.fire(new op(new Error(`Could not load model ${s} from ${u.uri}: ${_.message}`)))});n.push(g)}}Promise.allSettled(n).then(()=>{this._loaded=!0,this.fire(new kl("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this._loaded=!0,this.fire(new op(new Error(`Could not load models: ${s.message}`)))})}static applyModelSpecification(n,s){s.nodeOverrides&&Zp.convertNodeOverrides(n,s.nodeOverrides),s.materialOverrides&&Zp.convertMaterialOverrides(n,s.materialOverrides),s.nodeOverrideNames&&(n.nodeOverrideNames=[...s.nodeOverrideNames]),s.materialOverrideNames&&(n.materialOverrideNames=[...s.materialOverrideNames]),s.featureProperties&&(n.featureProperties=s.featureProperties)}static convertNodeOverrides(n,s){if(Array.isArray(s)&&s.every(u=>typeof u=="string")){n.nodeOverrideNames=[];for(const u of s)n.nodeOverrideNames.push(u)}else Object.entries(s).forEach(([u,h])=>{const g={orientation:[0,0,0]};if(h.hasOwnProperty("orientation")){const _=h.orientation;_&&(g.orientation=_)}n.nodeOverrides.set(u,g)})}static convertMaterialOverrides(n,s){if(Array.isArray(s)&&s.every(u=>typeof u=="string")){n.materialOverrideNames=[];for(const u of s)n.materialOverrideNames.push(u)}else Object.entries(s).forEach(([u,h])=>{const g={color:new Si(1,1,1),colorMix:0,emissionStrength:0,opacity:1},_=h["model-color"];_!==void 0&&(g.color.r=_[0],g.color.g=_[1],g.color.b=_[2]);const x=h["model-color-mix-intensity"];x!==void 0&&(g.colorMix=x);const T=h["model-emissive-strength"];T!==void 0&&(g.emissionStrength=T);const C=h["model-opacity"];C!==void 0&&(g.opacity=C),n.materialOverrides.set(u,g)})}onAdd(n){this.map=n,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(n,s){}serialize(){return this._options}setProperty(n,s){return!1}reload(){const n=ul(this.id,this.scope);this.map.style.clearSource(n),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(n){this.models=[];const s=new Map;for(const u in n){const h=n[u];if(this._modelsInfo.has(u)){const g=this._modelsInfo.get(u);g&&g.modelSpec.uri===h.uri&&s.set(u,g)}}this._modelsInfo=s,this._options.models=n,this._loaded=!1,this.load()}}function JA(a,n,s,u){const h=1<<a.z;n.lat=V((u/wt+a.y)/h),n.lng=L((s/wt+a.x)/h)}function _Y(a,n,s,u){const h=a.getNodesInfo()[n];if(!h||h.hiddenByReplacement||!h.node.meshes)return;let g=Number.MAX_VALUE;const _=h.node,x=s.tile,T=u.calculatePosMatrix(x.tileID.toUnwrapped(),u.worldSize),C=h.evaluatedScale;let R=0;u.elevation&&_.elevation&&(R=_.elevation*u.elevation.exaggeration()),ie(T,T,[(_.anchor?_.anchor[0]:0)*(C[0]-1),(_.anchor?_.anchor[1]:0)*(C[1]-1),R]),ue(T,T,C);const M=s.queryGeometry,D=M.isPointQuery()?M.screenBounds:M.screenGeometry,O=function(G){const X=ee([],T,G.globalMatrix);ee(X,u.expandedFarZProjMatrix,X);for(let K=0;K<G.meshes.length;++K){const se=G.meshes[K];if(K===G.lightMeshIndex)continue;const ae=bA(D,u,X,se.aabb);ae!=null&&(g=Math.min(ae,g))}if(G.children)for(const K of G.children)O(K)};if(O(_),g===Number.MAX_VALUE)return;const j=new c(0,0);return JA(x.tileID.canonical,j,h.node.anchor[0],h.node.anchor[1]),{intersectionZ:g,position:j,feature:h.feature}}const yY={circle:class extends xo{constructor(a,n,s,u){super(a,{layout:No||(No=new wr({"circle-sort-key":new It(Fe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new xt(Fe.layout_circle["circle-elevation-reference"]),visibility:new xt(Fe.layout_circle.visibility)})),paint:Tr||(Tr=new wr({"circle-radius":new It(Fe.paint_circle["circle-radius"]),"circle-color":new It(Fe.paint_circle["circle-color"]),"circle-blur":new It(Fe.paint_circle["circle-blur"]),"circle-opacity":new It(Fe.paint_circle["circle-opacity"]),"circle-translate":new xt(Fe.paint_circle["circle-translate"]),"circle-translate-anchor":new xt(Fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new xt(Fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new xt(Fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new It(Fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new It(Fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new It(Fe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new xt(Fe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},n,s,u)}createBucket(a){return new Ci(a)}queryRadius(a){const n=a;return Js("circle-radius",this,n)+Js("circle-stroke-width",this,n)+Ds(this.paint.get("circle-translate"))}queryIntersectsFeature(a,n,s,u,h,g,_,x){const T=Ba(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(n,s)+this.paint.get("circle-stroke-width").evaluate(n,s);return FL(a,u,g,_,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,C)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,n,s){const u=OL(this);return{config:new Iu(this,{zoom:n,lut:s}),defines:u,overrideFog:!1}}is3D(a){return!a&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends xo{createBucket(a){return new jL(a)}constructor(a,n,s,u){super(a,{layout:BL||(BL=new wr({visibility:new xt(Fe.layout_heatmap.visibility)})),paint:VL||(VL=new wr({"heatmap-radius":new It(Fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new It(Fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new xt(Fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xd(Fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new xt(Fe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},n,s,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=bx({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(a){return Js("heatmap-radius",this,a)}queryIntersectsFeature(a,n,s,u,h,g,_,x){const T=this.paint.get("heatmap-radius").evaluate(n,s);return FL(a,u,g,_,x,!0,!0,new st(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,n,s){return a==="heatmap"?{config:new Iu(this,{zoom:n,lut:s}),overrideFog:!1}:{}}},hillshade:class extends xo{constructor(a,n,s,u){super(a,{layout:UL||(UL=new wr({visibility:new xt(Fe.layout_hillshade.visibility)})),paint:$L||($L=new wr({"hillshade-illumination-direction":new xt(Fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new xt(Fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new xt(Fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new xt(Fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new xt(Fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new xt(Fe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new xt(Fe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},n,s,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,n,s){return{overrideFog:!1}}},fill:class extends xo{constructor(a,n,s,u){super(a,{layout:rO||(rO=new wr({"fill-sort-key":new It(Fe.layout_fill["fill-sort-key"]),visibility:new xt(Fe.layout_fill.visibility),"fill-elevation-reference":new xt(Fe.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new It(Fe.layout_fill["fill-construct-bridge-guard-rail"])})),paint:sO||(sO=new wr({"fill-antialias":new xt(Fe.paint_fill["fill-antialias"]),"fill-opacity":new It(Fe.paint_fill["fill-opacity"]),"fill-color":new It(Fe.paint_fill["fill-color"]),"fill-outline-color":new It(Fe.paint_fill["fill-outline-color"]),"fill-translate":new xt(Fe.paint_fill["fill-translate"]),"fill-translate-anchor":new xt(Fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new It(Fe.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new xt(Fe.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new xt(Fe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new It(Fe.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new It(Fe.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new It(Fe.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},n,s,u)}getProgramIds(){const a=this.paint.get("fill-pattern"),n=a&&a.constantOr(1),s=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(a,n,s){return{config:new Iu(this,{zoom:n,lut:s}),overrideFog:!1}}recalculate(a,n){super.recalculate(a,n);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new rA(a)}queryRadius(){return Ds(this.paint.get("fill-translate"))}queryIntersectsFeature(a,n,s,u,h,g){return!a.queryGeometry.isAboveHorizon&&mi(la(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(a){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const n=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return a!=null?n&&!a:n}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends xo{constructor(a,n,s,u){super(a,{layout:MO||(MO=new wr({visibility:new xt(Fe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new xt(Fe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:kO||(kO=new wr({"fill-extrusion-opacity":new xt(Fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new It(Fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new xt(Fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new xt(Fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new It(Fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new xt(Fe["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new It(Fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new It(Fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new xt(Fe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new xt(Fe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new xt(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new xt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new xt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new xt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new xt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new xt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new xt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new xt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new It(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new It(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new xt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new xt(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new xt(Fe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new xt(Fe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new It(Fe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new It(Fe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new xt(Fe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},n,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new Ow(a)}queryRadius(){return Ds(this.paint.get("fill-extrusion-translate"))}is3D(a){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,n,s,u,h,g,_,x,T){const C=Ba(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),R=this.paint.get("fill-extrusion-height").evaluate(n,s),M=this.paint.get("fill-extrusion-base").evaluate(n,s),D=[0,0],O=x&&g.elevation,j=g.elevation?g.elevation.exaggeration():1,G=a.tile.getBucket(this);if(O&&G instanceof Ow){const de=G.centroidVertexArray,ve=T+1;ve<de.length&&(D[0]=de.geta_centroid_pos0(ve),D[1]=de.geta_centroid_pos1(ve))}if(D[0]===0&&D[1]===1)return!1;g.projection.name==="globe"&&(u=RO([u],[new st(0,0),new st(wt,wt)],a.tileID.canonical).map(de=>de.polygon).flat());const X=O?x:null,[K,se]=jO(g,u,M,R,C,_,X,D,j,g.center.lat,a.tileID.canonical),ae=a.queryGeometry;return zO(K,se,ae.isPointQuery()?ae.screenBounds:ae.screenGeometry)}},building:class extends xo{constructor(a,n,s,u){super(a,{layout:cF||(cF=new wr({visibility:new xt(Fe.layout_building.visibility),"building-facade":new It(Fe.layout_building["building-facade"]),"building-facade-floors":new It(Fe.layout_building["building-facade-floors"]),"building-facade-unit-width":new It(Fe.layout_building["building-facade-unit-width"]),"building-facade-window":new It(Fe.layout_building["building-facade-window"]),"building-roof-shape":new It(Fe.layout_building["building-roof-shape"]),"building-height":new It(Fe.layout_building["building-height"]),"building-base":new It(Fe.layout_building["building-base"]),"building-flood-light-wall-radius":new It(Fe.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new It(Fe.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new It(Fe.layout_building["building-flip-roof-orientation"])})),paint:uF||(uF=new wr({"building-opacity":new xt(Fe.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new xt(Fe.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new xt(Fe.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new xt(Fe.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new xt(Fe.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new xt(Fe.paint_building["building-vertical-scale"]),"building-cast-shadows":new xt(Fe.paint_building["building-cast-shadows"]),"building-color":new It(Fe.paint_building["building-color"]),"building-emissive-strength":new It(Fe.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new xt(Fe.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new xt(Fe.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new xt(Fe.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new xt(Fe.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new xt(Fe.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},n,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new lF(a)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(a){return!0}queryRadius(a){return 0}queryIntersectsFeature(a,n,s,u,h,g,_,x,T){let C=this.layout.get("building-height").evaluate(n,s);const R=this.layout.get("building-base").evaluate(n,s),M=a.tile.getBucket(this).getFootprint(n);if(M){if(M.hiddenFlags!==0)return!1;C=M.height}const[D,O]=jO(g,u,R,C,new st(0,0),_,null,[0,0],1,g.center.lat,a.tileID.canonical),j=a.queryGeometry;return zO(D,O,j.isPointQuery()?j.screenBounds:j.screenGeometry)}},line:class extends xo{constructor(a,n,s,u){const h=xF();super(a,h,n,s,u),h.layout&&(this.layout=new vd(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof yp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(a,n){super.recalculate(a,n),this.paint._values["line-floorwidth"]=(()=>{if(zx)return zx;const s=xF();return zx=new hX(s.paint.properties["line-width"].specification),zx.useIntegerZoom=!0,zx})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new AA(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,n,s){const u=yF(this);return{config:new Iu(this,{zoom:n,lut:s}),defines:u,overrideFog:!1}}queryRadius(a){const n=a,s=bF(Js("line-width",this,n),Js("line-gap-width",this,n)),u=Js("line-offset",this,n);return s/2+Math.abs(u)+Ds(this.paint.get("line-translate"))}queryIntersectsFeature(a,n,s,u,h,g){if(a.queryGeometry.isAboveHorizon)return!1;const _=la(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),x=a.pixelToTileUnitsFactor/2*bF(this.paint.get("line-width").evaluate(n,s),this.paint.get("line-gap-width").evaluate(n,s)),T=this.paint.get("line-offset").evaluate(n,s);return T&&(u=function(C,R){const M=[],D=new st(0,0);for(let O=0;O<C.length;O++){const j=C[O],G=[];for(let X=0;X<j.length;X++){const K=j[X],se=j[X+1],ae=X===0?D:K.sub(j[X-1])._unit()._perp(),de=X===j.length-1?D:se.sub(K)._unit()._perp(),ve=ae._add(de)._unit();ve._mult(1/(ve.x*de.x+ve.y*de.y)),G.push(ve._mult(R)._add(K))}M.push(G)}return M}(u,T*a.pixelToTileUnitsFactor)),function(C,R,M){for(let D=0;D<R.length;D++){const O=R[D];if(C.length>=3){for(let j=0;j<O.length;j++)if(Fi(C,O[j]))return!0}if(yr(C,O,M))return!0}return!1}(_,u,x)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(a){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:aT,background:class extends xo{constructor(a,n,s,u){super(a,{layout:cz||(cz=new wr({visibility:new xt(Fe.layout_background.visibility)})),paint:uz||(uz=new wr({"background-pitch-alignment":new xt(Fe.paint_background["background-pitch-alignment"]),"background-color":new xt(Fe.paint_background["background-color"]),"background-pattern":new xt(Fe.paint_background["background-pattern"]),"background-opacity":new xt(Fe.paint_background["background-opacity"]),"background-emissive-strength":new xt(Fe.paint_background["background-emissive-strength"]),"background-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},n,s,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,n,s){return{overrideFog:!1}}is3D(a){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:mz,"raster-particle":bz,sky:class extends xo{constructor(a,n,s,u){super(a,{layout:yz||(yz=new wr({visibility:new xt(Fe.layout_sky.visibility)})),paint:vz||(vz=new wr({"sky-type":new xt(Fe.paint_sky["sky-type"]),"sky-atmosphere-sun":new xt(Fe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new xt(Fe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new xt(Fe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new xt(Fe.paint_sky["sky-gradient-radius"]),"sky-gradient":new xd(Fe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new xt(Fe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new xt(Fe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new xt(Fe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},n,s,u),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=bx({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(a,n){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),h=!u,g=a.style.light,_=g.properties.get("position");return h&&g.properties.get("anchor")==="viewport"&&Nt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?KA(_.azimuthal,90-_.polar,n):KA(u[0],90-u[1],n)}const s=this.paint.get("sky-gradient-center");return KA(s[0],90-s[1],n)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends xo{constructor(a,n,s,u){super(a,{paint:xz||(xz=new wr({}))},n,null)}},model:class extends xo{constructor(a,n,s,u){super(a,{layout:Sz||(Sz=new wr({visibility:new xt(Fe.layout_model.visibility),"model-id":new It(Fe.layout_model["model-id"])})),paint:Cz||(Cz=new wr({"model-opacity":new It(Fe.paint_model["model-opacity"]),"model-rotation":new It(Fe.paint_model["model-rotation"]),"model-scale":new It(Fe.paint_model["model-scale"]),"model-translation":new It(Fe.paint_model["model-translation"]),"model-color":new It(Fe.paint_model["model-color"]),"model-color-mix-intensity":new It(Fe.paint_model["model-color-mix-intensity"]),"model-type":new xt(Fe.paint_model["model-type"]),"model-cast-shadows":new xt(Fe.paint_model["model-cast-shadows"]),"model-receive-shadows":new xt(Fe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new xt(Fe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new It(Fe.paint_model["model-emissive-strength"]),"model-roughness":new It(Fe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new It(Fe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new xt(Fe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new xt(Fe.paint_model["model-front-cutoff"]),"model-elevation-reference":new xt(Fe.paint_model["model-elevation-reference"]),"model-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},n,s,u),this.layer=a,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new YA(a)}getProgramIds(){return["model"]}is3D(a){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof dT?wt-1:0}queryRenderedFeatures(a,n,s){const u=n.getSource();if(!(u&&u instanceof Zp))return{};const h=u,g={};g[this.id]=[];const _=g[this.id];let x=0;for(const T of h.models){const C=n.getFeatureState(this.sourceLayer,T.id),R={type:"Unknown",id:T.id,properties:T.featureProperties},M=this.paint.get("model-rotation").evaluate(R,C),D=this.paint.get("model-scale").evaluate(R,C),O=this.paint.get("model-translation").evaluate(R,C),j=this.paint.get("model-elevation-reference");let G=[];Hw(G,T,s,T.position,M,D,O,j==="ground",j==="ground",!1),s.projection.name==="globe"&&(G=Gw(G,s));const X=ee([],s.projMatrix,G),K=bA(a.isPointQuery()?a.screenBounds:a.screenGeometry,s,X,T.aabb);if(K!=null){const se=new qp(void 0,0,0,0,T.id);se.layer=this.layer,se.properties=structuredClone(T.featureProperties),se.properties.layer=this.id,se.properties.uri=T.uri,se.properties.orientation=T.orientation,se.sourceLayer=this.sourceLayer,se.geometry={type:"Point",coordinates:[T.position.lng,T.position.lat]},se.state=C,se.source=this.source,_.push({featureIndex:x,feature:se,intersectionZ:K})}++x}return g}queryIntersectsFeature(a,n,s,u,h,g){if(!this.modelManager)return!1;const _=this.modelManager,x=a.tile.getBucket(this);if(!(x&&x instanceof YA))return!1;for(const T in x.instancesPerModel){const C=x.instancesPerModel[T],R=n.id!==void 0?n.id:n.properties&&n.properties.hasOwnProperty("id")?n.properties.id:void 0;if(C.idToFeaturesIndex.hasOwnProperty(R)){const M=C.features[C.idToFeaturesIndex[R]],D=_.getModel(T,this.scope);if(!D)return!1;let O=[];const j=new c(0,0),G=x.canonical;let X=Number.MAX_VALUE;for(let K=0;K<M.instancedDataCount;++K){const se=16*(M.instancedDataOffset+K),ae=C.instancedDataArray.float32,de=[ae[se+4],ae[se+5],ae[se+6]];JA(G,j,Math.floor(ae[se]),Math.floor(ae[se+1])),Hw(O,D,g,j,M.rotation,M.scale,de,!1,!1,!1),g.projection.name==="globe"&&(O=Gw(O,g));const ve=ee([],g.projMatrix,O),me=a.queryGeometry,Te=bA(me.isPointQuery()?me.screenBounds:me.screenGeometry,g,ve,D.aabb);Te!=null&&(X=Math.min(Te,X))}return X!==Number.MAX_VALUE&&X}}return!1}_handleOverridablePaintPropertyUpdate(a,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){const n=this._transitionablePaint._values[a];return n!=null&&n.value!=null&&n.value.expression!=null&&n.value.expression instanceof gd}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends xo{constructor(a,n,s,u){super(a,{layout:oO||(oO=new wr({"clip-layer-types":new xt(Fe.layout_clip["clip-layer-types"]),"clip-layer-scope":new xt(Fe.layout_clip["clip-layer-scope"])})),paint:aO||(aO=new wr({}))},n,s,u)}recalculate(a,n){super.recalculate(a,n)}createBucket(a){return new lO(a)}is3D(a){return!0}}},e2=new Si(0,0,0),t2={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},n2={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},hT={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},vY={PAINT_ORDER_FILL_AND_STROKE:1},e0={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},Mz={MASK_TYPE_LUMINANCE:1};function xY(a,n,s){a===1&&n.icons.push(function(u,h){return function(g){if(g.usvg_tree.height||(g.usvg_tree.height=g.usvg_tree.width),!g.metadata)return g;const{metadata:_}=g;if(_.content_area){const{content_area:x}=_;x.left==null&&(x.left=0),x.top==null&&(x.top=x.left),x.width==null&&(x.width=g.usvg_tree.width),x.height==null&&(x.height=x.width)}if(_.text_placeholder){const{text_placeholder:x}=_;x.top==null&&(x.top=x.left),x.height==null&&(x.height=x.width)}return _.stretch_x&&_.stretch_x.length&&kz(_,"x"),_.stretch_y&&_.stretch_y.length&&kz(_,"y"),g}(u.readFields(bY,{name:void 0},h))}(s,s.readVarint()+s.pos))}function kz(a,n){const s=[],u=a[`stretch_${n}`];let h=null;for(let g=0;g<u.length;g++)h===null?h=s.length===0?u[0]:s[s.length-1][1]+u[g]:(s.push([h,h+u[g]]),h=null);a[`stretch_${n}_areas`]=s}function bY(a,n,s){a===1?n.name=s.readString():a===2?n.metadata=function(u,h){return u.readFields(wY,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)}(s,s.readVarint()+s.pos):a===3&&(n.usvg_tree=function(u,h){return u.readFields(SY,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)}(s,s.readVarint()+s.pos),n.data="usvg_tree")}function wY(a,n,s){a===1?n.stretch_x=s.readPackedVarint():a===2?n.stretch_y=s.readPackedVarint():a===3?n.content_area=Dz(s,s.readVarint()+s.pos):a===4?n.variables.push(function(u,h){return u.readFields(EY,{name:void 0},h)}(s,s.readVarint()+s.pos)):a===5&&(n.text_placeholder=Dz(s,s.readVarint()+s.pos))}function Dz(a,n){return a.readFields(TY,{},n)}function TY(a,n,s){a===1?n.left=s.readVarint():a===2?n.width=s.readVarint():a===3?n.top=s.readVarint():a===4&&(n.height=s.readVarint())}function EY(a,n,s){a===1?n.name=s.readString():a===2&&(n.rgb_color=mT(s.readVarint()),n.value="rgb_color")}function SY(a,n,s){a===1?n.width=n.height=s.readVarint():a===2?n.height=s.readVarint():a===3?n.children.push(fT(s,s.readVarint()+s.pos)):a===4?n.linear_gradients.push(function(u,h){return u.readFields(kY,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)}(s,s.readVarint()+s.pos)):a===5?n.radial_gradients.push(function(u,h){return u.readFields(NY,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)}(s,s.readVarint()+s.pos)):a===7?n.clip_paths.push(function(u,h){return u.readFields(LY,{children:[]},h)}(s,s.readVarint()+s.pos)):a===8&&n.masks.push(function(u,h){const g=u.readFields(OY,{left:0,width:20,mask_type:Mz.MASK_TYPE_LUMINANCE,children:[]},h);return g.height==null&&(g.height=g.width),g.top==null&&(g.top=g.left),g}(s,s.readVarint()+s.pos))}function fT(a,n){return a.readFields(CY,{},n)}function CY(a,n,s){a===1?(n.group=function(u,h){return u.readFields(IY,{opacity:255,children:[]},h)}(s,s.readVarint()+s.pos),n.node="group"):a===2&&(n.path=function(u,h){return u.readFields(PY,{paint_order:1,commands:[],step:1,diffs:[],rule:t2.PATH_RULE_NON_ZERO},h)}(s,s.readVarint()+s.pos),n.node="path")}function IY(a,n,s){a===1?n.transform=pT(s,s.readVarint()+s.pos):a===2?n.opacity=s.readVarint():a===5?n.clip_path_idx=s.readVarint():a===6?n.mask_idx=s.readVarint():a===7&&n.children.push(fT(s,s.readVarint()+s.pos))}function pT(a,n){return a.readFields(AY,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},n)}function AY(a,n,s){a===1?n.sx=s.readFloat():a===2?n.ky=s.readFloat():a===3?n.kx=s.readFloat():a===4?n.sy=s.readFloat():a===5?n.tx=s.readFloat():a===6&&(n.ty=s.readFloat())}function PY(a,n,s){a===1?n.fill=function(u,h){return u.readFields(RY,{rgb_color:e2,paint:"rgb_color",opacity:255},h)}(s,s.readVarint()+s.pos):a===2?n.stroke=function(u,h){return u.readFields(MY,{rgb_color:e2,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)}(s,s.readVarint()+s.pos):a===3?n.paint_order=s.readVarint():a===5?s.readPackedVarint(n.commands):a===6?n.step=s.readFloat():a===7?s.readPackedSVarint(n.diffs):a===8&&(n.rule=s.readVarint())}function RY(a,n,s){a===1?(n.rgb_color=mT(s.readVarint()),n.paint="rgb_color"):a===2?(n.linear_gradient_idx=s.readVarint(),n.paint="linear_gradient_idx"):a===3?(n.radial_gradient_idx=s.readVarint(),n.paint="radial_gradient_idx"):a===5&&(n.opacity=s.readVarint())}function mT(a){return new Si((a>>16&255)/255,(a>>8&255)/255,(255&a)/255,1)}function MY(a,n,s){a===1?(n.rgb_color=mT(s.readVarint()),n.paint="rgb_color"):a===2?(n.linear_gradient_idx=s.readVarint(),n.paint="linear_gradient_idx"):a===3?(n.radial_gradient_idx=s.readVarint(),n.paint="radial_gradient_idx"):a===5?s.readPackedFloat(n.dasharray):a===6?n.dashoffset=s.readFloat():a===7?n.miterlimit=s.readFloat():a===8?n.opacity=s.readVarint():a===9?n.width=s.readFloat():a===10?n.linecap=s.readVarint():a===11&&(n.linejoin=s.readVarint())}function kY(a,n,s){a===1?n.transform=pT(s,s.readVarint()+s.pos):a===2?n.spread_method=s.readVarint():a===3?n.stops.push(Nz(s,s.readVarint()+s.pos)):a===4?n.x1=s.readFloat():a===5?n.y1=s.readFloat():a===6?n.x2=s.readFloat():a===7&&(n.y2=s.readFloat())}function Nz(a,n){return a.readFields(DY,{offset:0,opacity:255,rgb_color:e2},n)}function DY(a,n,s){a===1?n.offset=s.readFloat():a===2?n.opacity=s.readVarint():a===3&&(n.rgb_color=mT(s.readVarint()))}function NY(a,n,s){a===1?n.transform=pT(s,s.readVarint()+s.pos):a===2?n.spread_method=s.readVarint():a===3?n.stops.push(Nz(s,s.readVarint()+s.pos)):a===4?n.cx=s.readFloat():a===5?n.cy=s.readFloat():a===6?n.r=s.readFloat():a===7?n.fx=s.readFloat():a===8?n.fy=s.readFloat():a===9&&(n.fr=s.readFloat())}function LY(a,n,s){a===1?n.transform=pT(s,s.readVarint()+s.pos):a===2?n.clip_path_idx=s.readVarint():a===3&&n.children.push(fT(s,s.readVarint()+s.pos))}function OY(a,n,s){a===1?n.left=n.top=s.readFloat():a===2?n.width=n.height=s.readFloat():a===3?n.top=s.readFloat():a===4?n.height=s.readFloat():a===5?n.mask_type=s.readVarint():a===6?n.mask_idx=s.readVarint():a===7&&n.children.push(fT(s,s.readVarint()+s.pos))}class FY{static calculate(n={},s=[]){const u=new Map,h=new Map;if(Object.keys(n).length===0)return u;s.forEach(g=>{h.set(g.name,g.rgb_color||new Si(0,0,0))});for(const[g,_]of Object.entries(n))h.has(g)?u.set(h.get(g).toString(),_):console.warn(`Ignoring unknown image variable "${g}"`);return u}}function C_(a,n=255,s){const u=n/255,h=a.toString(),g=s.has(h)?s.get(h).clone():a.clone();return g.a*=u,g.toString()}function t0(a,n){if(!Pl()){const s=document.createElement("canvas");return s.width=a,s.height=n,s}return new OffscreenCanvas(a,n)}let i2,n0=null;function r2(a,n,s,u,h){for(const g of u.children)Lz(a,n,s,g,h)}function Lz(a,n,s,u,h){u.group?(a.save(),function(g,_,x,T,C){const R=T.mask_idx!=null?x.masks[T.mask_idx]:null,M=T.clip_path_idx!=null?x.clip_paths[T.clip_path_idx]:null;if(T.transform&&(_=I_(T.transform).preMultiplySelf(_)),!function(j,G,X){return j.opacity!==255||G||X}(T,M!=null,R!=null))return void r2(g,_,x,T,C);const D=t0(g.canvas.width,g.canvas.height),O=D.getContext("2d");r2(O,_,x,T,C),M&&Uz(O,_,x,M),R&&$z(O,_,x,R,C),g.globalAlpha=T.opacity/255,g.drawImage(D,0,0)}(a,n,s,u.group,h),a.restore()):u.path&&(a.save(),function(g,_,x,T,C){g.setTransform(_),T.paint_order===vY.PAINT_ORDER_FILL_AND_STROKE?(Oz(g,x,T,C),zz(g,x,T,C)):(zz(g,x,T,C),Oz(g,x,T,C))}(a,n,s,u.path,h),a.restore())}function Oz(a,n,s,u){const h=s.fill;if(!h)return;const g=h.opacity/255;switch(a.save(),a.beginPath(),Gz(s,a),h.paint){case"rgb_color":a.fillStyle=C_(h.rgb_color,h.opacity,u);break;case"linear_gradient_idx":{const _=n.linear_gradients[h.linear_gradient_idx];_.transform&&a.setTransform(I_(_.transform).preMultiplySelf(a.getTransform())),a.fillStyle=jz(a,_,g,u);break}case"radial_gradient_idx":{const _=n.radial_gradients[h.radial_gradient_idx];_.transform&&a.setTransform(I_(_.transform).preMultiplySelf(a.getTransform())),a.fillStyle=Bz(a,_,g,u)}}a.fill(Fz(s)),a.restore()}function Fz(a){return a.rule===t2.PATH_RULE_NON_ZERO?"nonzero":a.rule===t2.PATH_RULE_EVEN_ODD?"evenodd":void 0}function zz(a,n,s,u){const h=s.stroke;if(!h)return;const g=Hz(s);a.lineWidth=h.width,a.miterLimit=h.miterlimit,a.setLineDash(h.dasharray),a.lineDashOffset=h.dashoffset;const _=h.opacity/255;switch(h.paint){case"rgb_color":a.strokeStyle=C_(h.rgb_color,h.opacity,u);break;case"linear_gradient_idx":a.strokeStyle=jz(a,n.linear_gradients[h.linear_gradient_idx],_,u,!0);break;case"radial_gradient_idx":a.strokeStyle=Bz(a,n.radial_gradients[h.radial_gradient_idx],_,u,!0)}switch(h.linejoin){case hT.LINE_JOIN_MITER_CLIP:case hT.LINE_JOIN_MITER:a.lineJoin="miter";break;case hT.LINE_JOIN_ROUND:a.lineJoin="round";break;case hT.LINE_JOIN_BEVEL:a.lineJoin="bevel"}switch(h.linecap){case n2.LINE_CAP_BUTT:a.lineCap="butt";break;case n2.LINE_CAP_ROUND:a.lineCap="round";break;case n2.LINE_CAP_SQUARE:a.lineCap="square"}a.stroke(g)}function jz(a,n,s,u,h=!1){if(n.stops.length===1){const D=n.stops[0];return C_(D.rgb_color,D.opacity*s,u)}const{x1:g,y1:_,x2:x,y2:T}=n;let C=new DOMPoint(g,_),R=new DOMPoint(x,T);if(h){const D=I_(n.transform);C=D.transformPoint(C),R=D.transformPoint(R)}const M=a.createLinearGradient(C.x,C.y,R.x,R.y);for(const D of n.stops)M.addColorStop(D.offset,C_(D.rgb_color,D.opacity*s,u));return M}function Bz(a,n,s,u,h=!1){if(n.stops.length===1){const K=n.stops[0];return C_(K.rgb_color,K.opacity*s,u)}const g=I_(n.transform),{fx:_,fy:x,fr:T,cx:C,cy:R,r:M}=n;let D=new DOMPoint(_,x),O=new DOMPoint(C,R),j=T,G=M;if(h){D=g.transformPoint(D),O=g.transformPoint(O);const K=(g.a+g.d)/2;j=T*K,G=n.r*K}const X=a.createRadialGradient(D.x,D.y,j,O.x,O.y,G);for(const K of n.stops)X.addColorStop(K.offset,C_(K.rgb_color,K.opacity*s,u));return X}function Vz(a,n,s,u){const h=u.transform?I_(u.transform).preMultiplySelf(n):n,g=t0(a.canvas.width,a.canvas.height),_=g.getContext("2d");for(const T of u.children)if(T.group)Vz(_,h,s,T.group);else if(T.path){const C=T.path,R=new Path2D;R.addPath(Hz(C),h),_.fill(R,Fz(C))}const x=u.clip_path_idx!=null?s.clip_paths[u.clip_path_idx]:null;x&&Uz(_,h,s,x),a.globalCompositeOperation="source-over",a.drawImage(g,0,0)}function Uz(a,n,s,u){const h=t0(a.canvas.width,a.canvas.height);Vz(h.getContext("2d"),n,s,u),a.globalCompositeOperation="destination-in",a.drawImage(h,0,0)}function $z(a,n,s,u,h){if(u.children.length===0)return;const g=u.mask_idx!=null?s.masks[u.mask_idx]:null;g&&$z(a,n,s,g,h);const _=a.canvas.width,x=a.canvas.height,T=t0(_,x),C=T.getContext("2d"),R=u.width,M=u.height,D=u.left,O=u.top,j=new Path2D,G=new Path2D;G.rect(D,O,R,M),j.addPath(G,n),C.clip(j);for(const se of u.children)Lz(C,n,s,se,h);const X=C.getImageData(0,0,_,x),K=X.data;if(u.mask_type===Mz.MASK_TYPE_LUMINANCE)for(let se=0;se<K.length;se+=4)K[se+3]=K[se+3]/255*(.2126*K[se]+.7152*K[se+1]+.0722*K[se+2]);C.putImageData(X,0,0),a.globalCompositeOperation="destination-in",a.drawImage(T,0,0)}function I_(a){return a?new DOMMatrix([a.sx,a.ky,a.kx,a.sy,a.tx,a.ty]):new DOMMatrix}function Gz(a,n){const s=a.step;let u=a.diffs[0]*s,h=a.diffs[1]*s;n.moveTo(u,h);for(let g=0,_=2;g<a.commands.length;g++)switch(a.commands[g]){case e0.PATH_COMMAND_MOVE:u+=a.diffs[_++]*s,h+=a.diffs[_++]*s,n.moveTo(u,h);break;case e0.PATH_COMMAND_LINE:u+=a.diffs[_++]*s,h+=a.diffs[_++]*s,n.lineTo(u,h);break;case e0.PATH_COMMAND_QUAD:{const x=u+a.diffs[_++]*s,T=h+a.diffs[_++]*s;u=x+a.diffs[_++]*s,h=T+a.diffs[_++]*s,n.quadraticCurveTo(x,T,u,h);break}case e0.PATH_COMMAND_CUBIC:{const x=u+a.diffs[_++]*s,T=h+a.diffs[_++]*s,C=x+a.diffs[_++]*s,R=T+a.diffs[_++]*s;u=C+a.diffs[_++]*s,h=R+a.diffs[_++]*s,n.bezierCurveTo(x,T,C,R,u,h);break}case e0.PATH_COMMAND_CLOSE:n.closePath()}return n}function Hz(a){return Gz(a,new Path2D)}class gT{constructor(n){this.capacity=n,this.cache=new Map}get(n){if(!this.cache.has(n))return;const s=this.cache.get(n);return this.cache.delete(n),this.cache.set(n,s),s}put(n,s){this.cache.has(n)?this.cache.delete(n):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(n,s)}delete(n){this.cache.delete(n)}}jt(gT,"LRUCache");class s2{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(n){return new eo(n,n.data)}getFromCache(n,s,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new gT(150)),this.cacheMap.get(u).get(ul(n.toString(),s))}setInCache(n,s,u,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new gT(150));const g=this.cacheDependenciesMap.get(h),_=ul(n.id.toString(),u);g.get(_)||g.set(_,new Set);const x=this.cacheMap.get(h),T=n.toString();g.get(_).add(T),x.put(ul(n.toString(),u),s)}removeImagesFromCacheByIds(n,s,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const h=this.cacheMap.get(u),g=this.cacheDependenciesMap.get(u);for(const _ of n){const x=ul(_.toString(),s);if(g.has(x)){for(const T of g.get(x))h.delete(T);g.delete(x)}}}rasterize(n,s,u,h){const g=this.getFromCache(n,u,h);if(g)return g.clone();const _=function(T,C){const R=FY.calculate(C.params,T.metadata?T.metadata.variables:[]),M=T.usvg_tree,D=M.width,O=M.height,j=Math.max(1,Math.round(D*C.sx)),G=Math.max(1,Math.round(O*C.sy)),X=new DOMMatrix([j/D,0,0,G/O,0,0]);return n0===null&&(n0=t0(10,10),i2=n0.getContext("2d",{willReadFrequently:!0})),n0.width=j,n0.height=G,r2(i2,X,M,M,R),i2.getImageData(0,0,j,G)}(s.icon,n),x=s2._getImage(_);return this.setInCache(n,x,u,h),x.clone()}}class Wz{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,s){const u=this.toIdx(n,s);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(n,s){return this.leaves[this.toIdx(n,s)]}toIdx(n,s){return s*this.size+n}}function qz(a,n,s,u){let h=0,g=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(u[_])<1e-15){if(s[_]<a[_]||s[_]>n[_])return null}else{const x=1/u[_];let T=(a[_]-s[_])*x,C=(n[_]-s[_])*x;if(T>C){const R=T;T=C,C=R}if(T>h&&(h=T),C<g&&(g=C),h>g)return null}return h}function Zz(a,n,s,u,h,g,_,x,T,C,R){const M=u-a,D=h-n,O=g-s,j=_-a,G=x-n,X=T-s,K=R[1]*X-R[2]*G,se=R[2]*j-R[0]*X,ae=R[0]*G-R[1]*j,de=M*K+D*se+O*ae;if(Math.abs(de)<1e-15)return null;const ve=1/de,me=C[0]-a,Te=C[1]-n,Ie=C[2]-s,Re=(me*K+Te*se+Ie*ae)*ve;if(Re<0||Re>1)return null;const qe=Te*O-Ie*D,Ne=Ie*M-me*O,Qe=me*D-Te*M,it=(R[0]*qe+R[1]*Ne+R[2]*Qe)*ve;return it<0||Re+it>1?null:(j*qe+G*Ne+X*Qe)*ve}function Kz(a,n,s){return(a-n)/(s-n)}function Xz(a,n,s,u,h,g,_,x,T){const C=1<<s,R=g-u,M=_-h,D=(a+1)/C*R+u,O=(n+0)/C*M+h,j=(n+1)/C*M+h;x[0]=(a+0)/C*R+u,x[1]=O,T[0]=D,T[1]=j}class Yz{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(g){const _=Math.ceil(Math.log2(g.dim/8)),x=[];let T=Math.ceil(Math.pow(2,_));const C=1/T,R=(O,j,G,X,K)=>{const se=X?1:0,ae=(O+1)*G-se,de=j*G,ve=(j+1)*G-se;K[0]=O*G,K[1]=de,K[2]=ae,K[3]=ve};let M=new Wz(T);const D=[];for(let O=0;O<T*T;O++){R(O%T,Math.floor(O/T),C,!1,D);const j=zh(D[0],D[1],g),G=zh(D[2],D[1],g),X=zh(D[2],D[3],g),K=zh(D[0],D[3],g);M.minimums.push(Math.min(j,G,X,K)),M.maximums.push(Math.max(j,G,X,K)),M.leaves.push(1)}for(x.push(M),T/=2;T>=1;T/=2){const O=x[x.length-1];M=new Wz(T);for(let j=0;j<T*T;j++){R(j%T,Math.floor(j/T),2,!0,D);const G=O.getElevation(D[0],D[1]),X=O.getElevation(D[2],D[1]),K=O.getElevation(D[2],D[3]),se=O.getElevation(D[0],D[3]),ae=O.isLeaf(D[0],D[1]),de=O.isLeaf(D[2],D[1]),ve=O.isLeaf(D[2],D[3]),me=O.isLeaf(D[0],D[3]),Te=Math.min(G.min,X.min,K.min,se.min),Ie=Math.max(G.max,X.max,K.max,se.max),Re=ae&&de&&ve&&me;M.maximums.push(Ie),M.minimums.push(Te),M.leaves.push(Ie-Te<=5&&Re?1:0)}x.push(M)}return x}(this.dem),u=s.length-1,h=s[u];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(s,0,0,u,0)}raycastRoot(n,s,u,h,g,_,x=1){return qz([n,s,-100],[u,h,this.maximums[0]*x],g,_)}raycast(n,s,u,h,g,_,x=1){if(!this.nodeCount)return null;const T=this.raycastRoot(n,s,u,h,g,_,x);if(T==null)return null;const C=[],R=[],M=[],D=[],O=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;O.length>0;){const{idx:j,t:G,nodex:X,nodey:K,depth:se}=O.pop();if(this.leaves[j]){Xz(X,K,se,n,s,u,h,M,D);const de=1<<se,ve=(X+0)/de,me=(X+1)/de,Te=(K+0)/de,Ie=(K+1)/de,Re=zh(ve,Te,this.dem)*x,qe=zh(me,Te,this.dem)*x,Ne=zh(me,Ie,this.dem)*x,Qe=zh(ve,Ie,this.dem)*x,it=Zz(M[0],M[1],Re,D[0],M[1],qe,D[0],D[1],Ne,g,_),rt=Zz(D[0],D[1],Ne,M[0],D[1],Qe,M[0],M[1],Re,g,_),ht=Math.min(it!==null?it:Number.MAX_VALUE,rt!==null?rt:Number.MAX_VALUE);if(ht!==Number.MAX_VALUE)return ht;{const pt=qt([],g,_,G);if(Qz(Re,qe,Qe,Ne,Kz(pt[0],M[0],D[0]),Kz(pt[1],M[1],D[1]))>=pt[2])return G}continue}let ae=0;for(let de=0;de<this._siblingOffset.length;de++){Xz((X<<1)+this._siblingOffset[de][0],(K<<1)+this._siblingOffset[de][1],se+1,n,s,u,h,M,D),M[2]=-100,D[2]=this.maximums[this.childOffsets[j]+de]*x;const ve=qz(M,D,g,_);if(ve!=null){const me=ve;C[de]=me;let Te=!1;for(let Ie=0;Ie<ae&&!Te;Ie++)me>=C[R[Ie]]&&(R.splice(Ie,0,de),Te=!0);Te||(R[ae]=de),ae++}}for(let de=0;de<ae;de++){const ve=R[de];O.push({idx:this.childOffsets[j]+ve,t:C[ve],nodex:(X<<1)+this._siblingOffset[ve][0],nodey:(K<<1)+this._siblingOffset[ve][1],depth:se+1})}}return null}_addNode(n,s,u){return this.minimums.push(n),this.maximums.push(s),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(n,s,u,h,g){if(n[h].isLeaf(s,u)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const _=h-1,x=n[_];let T=0,C=0;for(let R=0;R<this._siblingOffset.length;R++){const M=2*s+this._siblingOffset[R][0],D=2*u+this._siblingOffset[R][1],O=x.getElevation(M,D),j=x.isLeaf(M,D),G=this._addNode(O.min,O.max,j);j&&(T|=1<<R),C||(C=G)}for(let R=0;R<this._siblingOffset.length;R++)T&1<<R||this._construct(n,2*s+this._siblingOffset[R][0],2*u+this._siblingOffset[R][1],_,C+R)}}function Qz(a,n,s,u,h,g){return fn(fn(a,s,g),fn(n,u,g),h)}function zh(a,n,s){const u=s.dim,h=Y(a*u-.5,0,u-1),g=Y(n*u-.5,0,u-1),_=Math.floor(h),x=Math.floor(g),T=Math.min(_+1,u-1),C=Math.min(x+1,u-1);return Qz(s.get(_,x),s.get(T,x),s.get(_,C),s.get(T,C),h-_,g-x)}const zY={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function jY(a,n,s){return(256*a*256+256*n+s)/10-1e4}function BY(a,n,s){return 256*a+n+s/256-32768}class _T{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,s,u,h=!1){if(this.uid=n,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void Nt(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const g=this.dim=s.height-2,_=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let T=0;T<g;T++)_[this._idx(-1,T)]=_[this._idx(0,T)],_[this._idx(g,T)]=_[this._idx(g-1,T)],_[this._idx(T,-1)]=_[this._idx(T,0)],_[this._idx(T,g)]=_[this._idx(T,g-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(g,-1)]=_[this._idx(g-1,0)],_[this._idx(-1,g)]=_[this._idx(0,g-1)],_[this._idx(g,g)]=_[this._idx(g-1,g-1)]}const x=u==="terrarium"?BY:jY;for(let T=0;T<_.length;++T){const C=4*T;this.floatView[T]=x(this.pixels[C],this.pixels[C+1],this.pixels[C+2])}this._timestamp=gs.now()}_buildQuadTree(){this._tree=new Yz(this)}get(n,s,u=!1){u&&(n=Y(n,-1,this.dim),s=Y(s,-1,this.dim));const h=this._idx(n,s);return this.floatView[h]}set(n,s,u){const h=this._idx(n,s),g=this.floatView[h];return this.floatView[h]=u,u-g}static getUnpackVector(n){return zY[n]}_idx(n,s){if(n<-1||n>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(n+1)}static pack(n,s){const u=[0,0,0,0],h=_T.getUnpackVector(s);let g=Math.floor((n+h[3])/h[2]);return u[2]=g%256,g=Math.floor(g/256),u[1]=g%256,g=Math.floor(g/256),u[0]=g,u}getPixels(){return new WL({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,s,u){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let h=s*this.dim,g=s*this.dim+this.dim,_=u*this.dim,x=u*this.dim+this.dim;switch(s){case-1:h=g-1;break;case 1:g=h+1}switch(u){case-1:_=x-1;break;case 1:x=_+1}const T=-s*this.dim,C=-u*this.dim;for(let R=_;R<x;R++)for(let M=h;M<g;M++){const D=4*this._idx(M,R),O=4*this._idx(M+T,R+C);this.pixels[D+0]=n.pixels[O+0],this.pixels[D+1]=n.pixels[O+1],this.pixels[D+2]=n.pixels[O+2],this.pixels[D+3]=n.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function VY(a,n,s){a===1?n.headerLength=s.readFixed32():a===2?n.x=s.readVarint():a===3?n.y=s.readVarint():a===4?n.z=s.readVarint():a===5&&n.layers.push(function(u,h){return u.readFields(WY,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)}(s,s.readVarint()+s.pos))}function UY(a,n,s){a===1?(n.delta_filter=function(u,h){return u.readFields($Y,{blockSize:0},h)}(s,s.readVarint()+s.pos),n.filter="delta_filter"):a===2?(s.readVarint(),n.filter="zigzag_filter"):a===3?(s.readVarint(),n.filter="bitshuffle_filter"):a===4&&(s.readVarint(),n.filter="byteshuffle_filter")}function $Y(a,n,s){a===1&&(n.blockSize=s.readVarint())}function GY(a,n,s){a===1?(s.readVarint(),n.codec="gzip_data"):a===2?(s.readVarint(),n.codec="jpeg_image"):a===3?(s.readVarint(),n.codec="webp_image"):a===4&&(s.readVarint(),n.codec="png_image")}function HY(a,n,s){let u=0,h=0;a===1?n.firstByte=s.readFixed64():a===2?n.lastByte=s.readFixed64():a===3?n.filters.push(function(g,_){return g.readFields(UY,{},_)}(s,s.readVarint()+s.pos)):a===4?n.codec=function(g,_){return g.readFields(GY,{},_)}(s,s.readVarint()+s.pos):a===5?h=s.readFloat():a===6?u=s.readFloat():a===7?n.bands.push(s.readString()):a===8?n.offset=s.readDouble():a===9&&(n.scale=s.readDouble()),n.offset===0&&(n.offset=h),n.scale===0&&(n.scale=u)}function WY(a,n,s){a===1?n.version=s.readVarint():a===2?n.name=s.readString():a===3?n.units=s.readString():a===4?n.tileSize=s.readVarint():a===5?n.buffer=s.readVarint():a===6?n.pixelFormat=s.readVarint():a===7&&n.dataIndex.push(function(u,h){return u.readFields(HY,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)}(s,s.readVarint()+s.pos))}function qY(a,n,s){if(a===2)(function(u,h,g){u.readFields(ZY,g,h)})(s,s.readVarint()+s.pos,n);else if(a===3)throw new Error("Not implemented")}function ZY(a,n,s){if(a===1){let u=0;const h=s.readVarint()+s.pos;for(;s.pos<h;)n[u++]=s.readVarint()}}function KY(a,n){if(n.length!==4)throw new Error(`Expected data of dimension 4 but got ${n.length}.`);let s=n[3];for(let u=2;u>=1;u--){const h=u===1?1:0,g=u===2?1:0;for(let _=0;_<n[0];_++){const x=n[1]*_;for(let T=h;T<n[1];T++){const C=n[2]*(T+x);for(let R=g;R<n[2];R++){const M=n[3]*(R+C);for(let D=0;D<n[3];D++){const O=M+D;a[O]+=a[O-s]}}}}s*=n[u]}return a}function XY(a){for(let n=0,s=a.length;n<s;n++)a[n]=a[n]>>>1^-(1&a[n]);return a}function YY(a,n){switch(n){case"uint32":return a;case"uint16":for(let s=0;s<a.length;s+=2){const u=a[s],h=a[s+1];a[s]=(240&u)>>4|(61440&u)>>8|(240&h)<<4|61440&h,a[s+1]=15&u|(3840&u)>>4|(15&h)<<8|(3840&h)<<4}return a;case"uint8":for(let s=0;s<a.length;s+=4){const u=a[s],h=a[s+1],g=a[s+2],_=a[s+3];a[s+0]=(192&u)>>6|(192&h)>>4|(192&g)>>2|192&_,a[s+1]=(48&u)>>4|(48&h)>>2|48&g|(48&_)<<2,a[s+2]=(12&u)>>2|12&h|(12&g)<<2|(12&_)<<4,a[s+3]=3&u|(3&h)<<2|(3&g)<<4|(3&_)<<6}return a;default:throw new Error(`Invalid pixel format, "${n}"`)}}jt(_T,"DEMData"),jt(Yz,"DemMinMaxQuadTree",{omit:["dem"]});var pl=Uint8Array,i0=Uint16Array,QY=Int32Array,Jz=new pl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e3=new pl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),JY=new pl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t3=function(a,n){for(var s=new i0(31),u=0;u<31;++u)s[u]=n+=1<<a[u-1];var h=new QY(s[30]);for(u=1;u<30;++u)for(var g=s[u];g<s[u+1];++g)h[g]=g-s[u]<<5|u;return{b:s,r:h}},n3=t3(Jz,2),i3=n3.b,eQ=n3.r;i3[28]=258,eQ[258]=28;for(var tQ=t3(e3,0).b,r3=new i0(32768),us=0;us<32768;++us){var A_=(43690&us)>>1|(21845&us)<<1;r3[us]=((65280&(A_=(61680&(A_=(52428&A_)>>2|(13107&A_)<<2))>>4|(3855&A_)<<4))>>8|(255&A_)<<8)>>1}var r0=function(a,n,s){for(var u=a.length,h=0,g=new i0(n);h<u;++h)a[h]&&++g[a[h]-1];var _,x=new i0(n);for(h=1;h<n;++h)x[h]=x[h-1]+g[h-1]<<1;_=new i0(1<<n);var T=15-n;for(h=0;h<u;++h)if(a[h])for(var C=h<<4|a[h],R=n-a[h],M=x[a[h]-1]++<<R,D=M|(1<<R)-1;M<=D;++M)_[r3[M]>>T]=C;return _},s0=new pl(288);for(us=0;us<144;++us)s0[us]=8;for(us=144;us<256;++us)s0[us]=9;for(us=256;us<280;++us)s0[us]=7;for(us=280;us<288;++us)s0[us]=8;var s3=new pl(32);for(us=0;us<32;++us)s3[us]=5;var nQ=r0(s0,9),iQ=r0(s3,5),o2=function(a){for(var n=a[0],s=1;s<a.length;++s)a[s]>n&&(n=a[s]);return n},Ic=function(a,n,s){var u=n/8|0;return(a[u]|a[u+1]<<8)>>(7&n)&s},a2=function(a,n){var s=n/8|0;return(a[s]|a[s+1]<<8|a[s+2]<<16)>>(7&n)},rQ=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ac=function(a,n,s){var u=new Error(n||rQ[a]);if(u.code=a,Error.captureStackTrace&&Error.captureStackTrace(u,Ac),!s)throw u;return u},sQ=new pl(0),oQ=typeof TextDecoder<"u"&&new TextDecoder;try{oQ.decode(sQ,{stream:!0})}catch{}const aQ={gzip_data:"gzip"};class $l extends Error{constructor(n){super(n),this.name="MRTError"}}const lQ={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},o3={uint32:1,uint16:2,uint8:4},cQ={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let l2;class yT{constructor(n=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=n}getLayer(n){const s=this.layers[n];if(!s)throw new $l(`Layer '${n}' not found`);return s}getHeaderLength(n){const s=new Uint8Array(n),u=new DataView(n);if(s[0]!==13)throw new $l("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(n){const s=new Uint8Array(n),u=this.getHeaderLength(n);if(s.length<u)throw new $l(`Expected header with length >= ${u} but got buffer of length ${s.length}`);const h=new l2(s.subarray(0,u)).readFields(VY,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new $l(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const g of h.layers)this.layers[g.name]=new a3(g,{cacheSize:this._cacheSize});return this}createDecodingTask(n){const s=[],u=this.getLayer(n.layerName);for(let h of n.blockIndices){const g=u.dataIndex[h],_=g.firstByte-n.firstByte,x=g.lastByte-n.firstByte;if(u._blocksInProgress.has(h))continue;const T={layerName:u.name,firstByte:_,lastByte:x,pixelFormat:u.pixelFormat,blockIndex:h,blockShape:[g.bands.length].concat(u.bandShape),buffer:u.buffer,codec:g.codec.codec,filters:g.filters.map(C=>C.filter)};u._blocksInProgress.add(h),s.push(T)}return new l3(s,()=>{s.forEach(h=>u._blocksInProgress.delete(h.blockIndex))},(h,g)=>{if(s.forEach(_=>u._blocksInProgress.delete(_.blockIndex)),h)throw h;g.forEach(_=>{this.getLayer(_.layerName).processDecodedData(_)})})}}class a3{constructor({version:n,name:s,units:u,tileSize:h,pixelFormat:g,buffer:_,dataIndex:x},T){if(this.version=n,this.version!==1)throw new $l(`Cannot parse raster layer encoded with MRT version ${n}`);this.name=s,this.units=u,this.tileSize=h,this.buffer=_,this.pixelFormat=lQ[g],this.dataIndex=x,this.bandShape=[h+2*_,h+2*_,o3[this.pixelFormat]],this._decodedBlocks=new gT(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return o3[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:n})=>n).flat()}processDecodedData(n){const s=n.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,n.data)}getBlockForBand(n){let s=0;switch(typeof n){case"string":for(const[u,h]of this.dataIndex.entries()){for(const[g,_]of h.bands.entries())if(_===n)return{bandIndex:s+g,blockIndex:u,blockBandIndex:g};s+=h.bands.length}break;case"number":for(const[u,h]of this.dataIndex.entries()){if(n>=s&&n<s+h.bands.length)return{bandIndex:n,blockIndex:u,blockBandIndex:n-s};s+=h.bands.length}break;default:throw new $l(`Invalid band \`${JSON.stringify(n)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(n){let s=1/0,u=-1/0;const h=[],g=new Set;for(const _ of n){const{blockIndex:x}=this.getBlockForBand(_);if(x<0)throw new $l(`Invalid band: ${JSON.stringify(_)}`);const T=this.dataIndex[x];h.includes(x)||h.push(x),g.add(x),s=Math.min(s,T.firstByte),u=Math.max(u,T.lastByte)}if(g.size>this.cacheSize)throw new $l(`Number of blocks to decode (${g.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:u,blockIndices:h}}hasBand(n){const{blockIndex:s}=this.getBlockForBand(n);return s>=0}hasDataForBand(n){const{blockIndex:s}=this.getBlockForBand(n);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(n){const{blockIndex:s,blockBandIndex:u}=this.getBlockForBand(n);if(s<0)throw new $l(`Band not found: ${JSON.stringify(n)}`);const h=this._decodedBlocks.get(s.toString());if(!h)throw new $l(`Data for band ${JSON.stringify(n)} of layer "${this.name}" not decoded.`);const g=this.dataIndex[s],_=this.bandShape.reduce((C,R)=>C*R,1),x=u*_,T=h.subarray(x,x+_);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:g.offset,scale:g.scale}}}yT.setPbf=function(a){l2=a};class l3{constructor(n,s,u){this.tasks=n,this._onCancel=s,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(n,s){this._finalized||(this._onComplete(n,s),this._finalized=!0)}}yT.performDecoding=function(a,n){const s=new Uint8Array(a);return Promise.all(n.tasks.map(u=>{const{layerName:h,firstByte:g,lastByte:_,pixelFormat:x,blockShape:T,blockIndex:C,filters:R,codec:M}=u,D=s.subarray(g,_+1),O=new Uint32Array(T[0]*T[1]*T[2]);let j;if(M!=="gzip_data")throw new $l(`Unhandled codec: ${M}`);return j=function(G,X){if(!globalThis.DecompressionStream&&X==="gzip_data")return Promise.resolve(((de=function(Te){Te[0]==31&&Te[1]==139&&Te[2]==8||Ac(6,"invalid gzip data");var Ie=Te[3],Re=10;4&Ie&&(Re+=2+(Te[10]|Te[11]<<8));for(var qe=(Ie>>3&1)+(Ie>>4&1);qe>0;qe-=!Te[Re++]);return Re+(2&Ie)}(ae=G))+8>ae.length&&Ac(6,"invalid gzip data"),function(Te,Ie,Re,qe){var Ne=Te.length;if(!Ne||Ie.f&&!Ie.l)return Re||new pl(0);var Qe=!Re,it=Qe||Ie.i!=2,rt=Ie.i;Qe&&(Re=new pl(3*Ne));var ht,pt,ct=function(Di){var pi=Re.length;if(Di>pi){var vi=new pl(Math.max(2*pi,Di));vi.set(Re),Re=vi}},ut=Ie.f||0,Ye=Ie.p||0,Ze=Ie.b||0,dt=Ie.l,Tt=Ie.d,yt=Ie.m,Yt=Ie.n,kt=8*Ne;do{if(!dt){ut=Ic(Te,Ye,1);var Ot=Ic(Te,Ye+1,3);if(Ye+=3,!Ot){var Ut=Te[(Je=4+((Ye+7)/8|0))-4]|Te[Je-3]<<8,jn=Je+Ut;if(jn>Ne){rt&&Ac(0);break}it&&ct(Ze+Ut),Re.set(Te.subarray(Je,jn),Ze),Ie.b=Ze+=Ut,Ie.p=Ye=8*jn,Ie.f=ut;continue}if(Ot==1)dt=nQ,Tt=iQ,yt=9,Yt=5;else if(Ot==2){var vt=Ic(Te,Ye,31)+257,$t=Ic(Te,Ye+10,15)+4,xn=vt+Ic(Te,Ye+5,31)+1;Ye+=14;for(var Kn=new pl(xn),Qn=new pl(19),An=0;An<$t;++An)Qn[JY[An]]=Ic(Te,Ye+3*An,7);Ye+=3*$t;var ki=o2(Qn),ge=(1<<ki)-1,be=r0(Qn,ki);for(An=0;An<xn;){var Je,ft=be[Ic(Te,Ye,ge)];if(Ye+=15&ft,(Je=ft>>4)<16)Kn[An++]=Je;else{var At=0,Pt=0;for(Je==16?(Pt=3+Ic(Te,Ye,3),Ye+=2,At=Kn[An-1]):Je==17?(Pt=3+Ic(Te,Ye,7),Ye+=3):Je==18&&(Pt=11+Ic(Te,Ye,127),Ye+=7);Pt--;)Kn[An++]=At}}var Qt=Kn.subarray(0,vt),tn=Kn.subarray(vt);yt=o2(Qt),Yt=o2(tn),dt=r0(Qt,yt),Tt=r0(tn,Yt)}else Ac(1);if(Ye>kt){rt&&Ac(0);break}}it&&ct(Ze+131072);for(var Cn=(1<<yt)-1,Ln=(1<<Yt)-1,zn=Ye;;zn=Ye){var Hn=(At=dt[a2(Te,Ye)&Cn])>>4;if((Ye+=15&At)>kt){rt&&Ac(0);break}if(At||Ac(2),Hn<256)Re[Ze++]=Hn;else{if(Hn==256){zn=Ye,dt=null;break}var dn=Hn-254;Hn>264&&(dn=Ic(Te,Ye,(1<<(di=Jz[An=Hn-257]))-1)+i3[An],Ye+=di);var vn=Tt[a2(Te,Ye)&Ln],oi=vn>>4;if(vn||Ac(3),Ye+=15&vn,tn=tQ[oi],oi>3){var di=e3[oi];tn+=a2(Te,Ye)&(1<<di)-1,Ye+=di}if(Ye>kt){rt&&Ac(0);break}it&&ct(Ze+131072);var hi=Ze+dn;if(Ze<tn){var Ii=0-tn,ji=Math.min(tn,hi);for(Ii+Ze<0&&Ac(3);Ze<ji;++Ze)Re[Ze]=(void 0)[Ii+Ze]}for(;Ze<hi;++Ze)Re[Ze]=Re[Ze-tn]}}Ie.l=dt,Ie.p=zn,Ie.b=Ze,Ie.f=ut,dt&&(ut=1,Ie.m=yt,Ie.d=Tt,Ie.n=Yt)}while(!ut);return Ze!=Re.length&&Qe?(ht=Re,((pt=Ze)==null||pt>ht.length)&&(pt=ht.length),new pl(ht.subarray(0,pt))):Re.subarray(0,Ze)}(ae.subarray(de,-8),{i:2},new pl(((K=ae)[(se=K.length)-4]|K[se-3]<<8|K[se-2]<<16|K[se-1]<<24)>>>0))));var K,se,ae,de;const ve=aQ[X];if(!ve)throw new Error(`Unhandled codec: ${X}`);const me=new globalThis.DecompressionStream(ve);return new Response(new Blob([G]).stream().pipeThrough(me)).arrayBuffer().then(Te=>new Uint8Array(Te))}(D,M).then(G=>(function(X,K){X.readFields(qY,K)}(new l2(G),O),new cQ[x](O.buffer))),j.then(G=>{for(let X=R.length-1;X>=0;X--)switch(R[X]){case"delta_filter":KY(G,T);break;case"zigzag_filter":XY(G);break;case"bitshuffle_filter":YY(G,x);break;default:throw new $l(`Unhandled filter "${R[X]}"`)}return{layerName:h,blockIndex:C,data:G}}).catch(G=>{throw G})}))},jt(l3,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),jt(yT,"MapboxRasterTile"),jt(a3,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class c3{constructor(n){this._stringToNumber={},this._numberToString=[];for(let s=0;s<n.length;s++){const u=n[s];this._stringToNumber[u]=s,this._numberToString[s]=u}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}class u3{constructor(n,s){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new wh(wt,16,0),this.featureIndexArray=new px,this.promoteId=s,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(n,s,u,h,g,_=0,x=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,g,_);const C=this.grid;for(let R=0;R<s.length;R++){const M=s[R],D=[1/0,1/0,-1/0,-1/0];for(let O=0;O<M.length;O++){const j=M[O];D[0]=Math.min(D[0],j.x),D[1]=Math.min(D[1],j.y),D[2]=Math.max(D[2],j.x),D[3]=Math.max(D[3],j.y)}x!==0&&(D[0]-=x,D[1]-=x,D[2]+=x,D[3]+=x),D[0]<wt&&D[1]<wt&&D[2]>=0&&D[3]>=0&&C.insert(T,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ve(new Zw(this.rawTileData)).layers,this.sourceLayerCoder=new c3(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,s){const{tilespaceGeometry:u,transform:h,tileTransform:g,pixelPosMatrix:_,availableImages:x,worldview:T}=s;this.loadVTLayers(),this.serializedLayersCache.clear();const C=s.queryRadius?s.queryRadius:0,R=u.bufferedTilespaceBounds,M=this.grid.query(R.min.x,R.min.y,R.max.x,R.max.y,(G,X,K,se)=>bo(u.bufferedTilespaceGeometry,G-C,X-C,K+C,se+C));M.sort(uQ);let D=null;h.elevation&&M.length>0&&(D=S_.create(h.elevation,this.tileID));const O={};let j;for(let G=0;G<M.length;G++){const X=M[G];if(X===j)continue;j=X;const K=this.featureIndexArray.get(X);let se=null;this.is3DTile?this.loadMatchingModelFeature(O,K,n,u,h,T):this.loadMatchingFeature(O,K,n,x,T,(ae,de,ve,me=0)=>(se||(se=Se(ae,this.tileID.canonical,g)),de.queryIntersectsFeature(u,ae,ve,se,this.z,h,_,D,me)))}return O}loadMatchingFeature(n,s,u,h,g,_){const{featureIndex:x,bucketIndex:T,sourceLayerIndex:C,layoutVertexArrayOffset:R}=s,M=this.bucketLayerIDs[T],D=u.layers,O=Object.keys(D);if(O.length&&!Ft(O,M))return;const j=u.sourceCache,G=this.sourceLayerCoder.decode(C),X=this.vtLayers[G].feature(x),K=this.getId(X,G);for(let se=0;se<M.length;se++){const ae=M[se];if(!D[ae])continue;const{styleLayer:de,targets:ve}=D[ae];let me={};K!==void 0&&(me=j.getFeatureState(de.sourceLayer,K));const Te=!_||_(X,de,me,R);if(!Te)continue;const Ie=new qp(X,this.z,this.x,this.y,K);Ie.tile=this.tileID.canonical,Ie.state=me;let Re=this.serializedLayersCache.get(ae);Re||(Re=de.serialize(),Re.id=ae,this.serializedLayersCache.set(ae,Re)),Ie.source=Re.source,Ie.sourceLayer=Re["source-layer"],Ie.layer=Object.assign({},Re),Ie.layer.paint=d3(Re.paint,de.paint,X,me,h),Ie.layer.layout=d3(Re.layout,de.layout,X,me,h);let qe=!1;for(const Ne of ve){this.updateFeatureProperties(Ie,Ne);const{filter:Qe}=Ne;if(Qe){if(X.properties=Ie.properties,Qe.needGeometry){const it=De(X,!0);if(!Qe.filter(new Wi(this.tileID.overscaledZ,{worldview:g}),it,this.tileID.canonical))continue}else if(!Qe.filter(new Wi(this.tileID.overscaledZ,{worldview:g}),X))continue}qe=!0,Ne.targetId&&this.addFeatureVariant(Ie,Ne)}qe&&this.appendToResult(n,ae,x,Ie,Te)}}loadMatchingModelFeature(n,s,u,h,g,_){const{featureIndex:x,bucketIndex:T}=s,C=this.bucketLayerIDs[T],R=u.layers,M=Object.keys(R);if(!M.length||Ft(M,C))for(let D=0;D<C.length;D++){const O=C[D],{styleLayer:j,targets:G}=R[O];if(j.type!=="model")continue;const X=h.tile,K=X.getBucket(j);if(!(K&&K instanceof dT))continue;const se=_Y(K,x,h,g);if(!se)continue;const{z:ae,x:de,y:ve}=X.tileID.canonical,{feature:me,intersectionZ:Te,position:Ie}=se;let Re={};me.id!==void 0&&(Re=u.sourceCache.getFeatureState(j.sourceLayer,me.id));const qe=new qp({},ae,de,ve,me.id);qe.tile=this.tileID.canonical,qe.state=Re,qe.properties=me.properties,qe.geometry={type:"Point",coordinates:[Ie.lng,Ie.lat]};let Ne=this.serializedLayersCache.get(O);Ne||(Ne=j.serialize(),Ne.id=O,this.serializedLayersCache.set(O,Ne)),qe.source=Ne.source,qe.sourceLayer=Ne["source-layer"],qe.layer=Object.assign({},Ne);let Qe=!1;for(const it of G){this.updateFeatureProperties(qe,it);const{filter:rt}=it;if(rt){if(me.properties=qe.properties,rt.needGeometry){if(!rt.filter(new Wi(this.tileID.overscaledZ,{worldview:_}),me,this.tileID.canonical))continue}else if(!rt.filter(new Wi(this.tileID.overscaledZ,{worldview:_}),me))continue}Qe=!0,it.targetId&&this.addFeatureVariant(qe,it)}Qe&&this.appendToResult(n,O,x,qe,Te)}}updateFeatureProperties(n,s,u){if(s.properties){const h={};for(const g in s.properties){const _=s.properties[g].evaluate({zoom:this.z},n._vectorTileFeature,n.state,n.tile,u);_!=null&&(h[g]=_)}n.properties=h}}addFeatureVariant(n,s,u){const h={target:s.target,namespace:s.namespace,uniqueFeatureID:s.uniqueFeatureID};s.properties&&(h.properties=n.properties),n.variants=n.variants||{},n.variants[s.targetId]=n.variants[s.targetId]||[],n.variants[s.targetId].push(h)}appendToResult(n,s,u,h,g){let _=n[s];_===void 0&&(_=n[s]=[]),_.push({featureIndex:u,feature:h,intersectionZ:g})}lookupSymbolFeatures(n,s,u,h,g,_){const x={};this.loadVTLayers();for(const T of n)this.loadMatchingFeature(x,{bucketIndex:s,sourceLayerIndex:u,featureIndex:T,layoutVertexArrayOffset:0},h,g,_);return x}loadFeature(n){const{featureIndex:s,sourceLayerIndex:u}=n;this.loadVTLayers();const h=this.sourceLayerCoder.decode(u),g=this.vtFeatures[h];if(g[s])return g[s];const _=this.vtLayers[h].feature(s);return g[s]=_,_}hasLayer(n){for(const s of this.bucketLayerIDs)for(const u of s)if(n===u)return!0;return!1}getId(n,s){let u=n.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[s];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){const g=wu(h);if(g.result!=="success"){const _=g.value.map(x=>`${x.key}: ${x.message}`).join(", ");return void Nt(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=g.value}u=this.promoteIdExpression.evaluate({zoom:0},n)}else u=n.properties[h];typeof u=="boolean"&&(u=Number(u))}return u}}function d3(a,n,s,u,h){return $e(a,(g,_)=>{const x=n instanceof vd?n.get(_):null;return x&&x.evaluate?x.evaluate(s,u,void 0,h):x})}function uQ(a,n){return n-a}jt(u3,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const h3=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class c2{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,u]=new Uint8Array(n,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=u>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const g=h3[15&u];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(n,2,1),[x]=new Uint32Array(n,4,1);return new c2(x,_,g,n)}constructor(n,s=64,u=Float64Array,h){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=u,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const g=h3.indexOf(this.ArrayType),_=2*n*this.ArrayType.BYTES_PER_ELEMENT,x=n*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-x%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${u}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+x+T,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+_+x+T),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+x+T,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=n)}add(n,s){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=n,this.coords[this._pos++]=s,u}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return u2(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,s,u,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:x}=this,T=[0,g.length-1,0],C=[];for(;T.length;){const R=T.pop()||0,M=T.pop()||0,D=T.pop()||0;if(M-D<=x){for(let X=D;X<=M;X++){const K=_[2*X],se=_[2*X+1];K>=n&&K<=u&&se>=s&&se<=h&&C.push(g[X])}continue}const O=D+M>>1,j=_[2*O],G=_[2*O+1];j>=n&&j<=u&&G>=s&&G<=h&&C.push(g[O]),(R===0?n<=j:s<=G)&&(T.push(D),T.push(O-1),T.push(1-R)),(R===0?u>=j:h>=G)&&(T.push(O+1),T.push(M),T.push(1-R))}return C}within(n,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:_}=this,x=[0,h.length-1,0],T=[],C=u*u;for(;x.length;){const R=x.pop()||0,M=x.pop()||0,D=x.pop()||0;if(M-D<=_){for(let X=D;X<=M;X++)p3(g[2*X],g[2*X+1],n,s)<=C&&T.push(h[X]);continue}const O=D+M>>1,j=g[2*O],G=g[2*O+1];p3(j,G,n,s)<=C&&T.push(h[O]),(R===0?n-u<=j:s-u<=G)&&(x.push(D),x.push(O-1),x.push(1-R)),(R===0?n+u>=j:s+u>=G)&&(x.push(O+1),x.push(M),x.push(1-R))}return T}}function u2(a,n,s,u,h,g){if(h-u<=s)return;const _=u+h>>1;f3(a,n,_,u,h,g),u2(a,n,s,u,_-1,1-g),u2(a,n,s,_+1,h,1-g)}function f3(a,n,s,u,h,g){for(;h>u;){if(h-u>600){const C=h-u+1,R=s-u+1,M=Math.log(C),D=.5*Math.exp(2*M/3),O=.5*Math.sqrt(M*D*(C-D)/C)*(R-C/2<0?-1:1);f3(a,n,s,Math.max(u,Math.floor(s-R*D/C+O)),Math.min(h,Math.floor(s+(C-R)*D/C+O)),g)}const _=n[2*s+g];let x=u,T=h;for(o0(a,n,u,s),n[2*h+g]>_&&o0(a,n,u,h);x<T;){for(o0(a,n,x,T),x++,T--;n[2*x+g]<_;)x++;for(;n[2*T+g]>_;)T--}n[2*u+g]===_?o0(a,n,u,T):(T++,o0(a,n,T,h)),T<=s&&(u=T+1),s<=T&&(h=T-1)}}function o0(a,n,s,u){d2(a,s,u),d2(n,2*s,2*u),d2(n,2*s+1,2*u+1)}function d2(a,n,s){const u=a[n];a[n]=a[s],a[s]=u}function p3(a,n,s,u){const h=a-s,g=n-u;return h*h+g*g}o.$=sg,o.A=lc,o.B=ul,o.C=2,o.D=h_,o.E=ud,o.F=Vx,o.G=BF,o.H=rg,o.I=so,o.J=uw,o.K=Xt,o.L=ch,o.M=Pg,o.N=Tp,o.O=Yb,o.P=st,o.Q=Ep,o.R=np,o.S=jg,o.T=vA,o.U=wu,o.V=uT,o.W=Zv,o.X=ph,o.Y=fh,o.Z=_p,o._=yo,o.a=function(a){return qn.API_CDN_URL_REGEX.test(a)},o.a$=V,o.a0=yn,o.a1=ka,o.a2=zl,o.a3=class extends uT{},o.a4=Rg,o.a5=Xb,o.a6=Fe,o.a7=function(a){const n=a.value;return n?yn(n)?XA(n,!0)?[]:[new uT(a.key,n,`invalid url "${n}"`)]:[new uT(a.key,n,`string expected, "${Xt(n)}" found`)]:[]},o.a8=ow,o.a9=wr,o.aA=Y,o.aB=ee,o.aC=ks,o.aD=Ys,o.aE=Fi,o.aF=S,o.aG=ce,o.aH=function(a,n){const s={};for(let u=0;u<n.length;u++){const h=n[u];h in a&&(s[h]=a[h])}return s},o.aI=p,o.aJ=P,o.aK=class{constructor(a){this.entries={},this.scheduler=a}request(a,n,s,u){const h=this.entries[a]=this.entries[a]||{callbacks:[]};if(h.result){const[g,_]=h.result;return this.scheduler?this.scheduler.add(()=>{u(g,_)},n):u(g,_),()=>{}}return h.callbacks.push(u),h.cancel||(h.cancel=s((g,_)=>{h.result=[g,_];for(const x of h.callbacks)this.scheduler?this.scheduler.add(()=>{x(g,_)},n):x(g,_);setTimeout(()=>delete this.entries[a],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(g=>g!==u),h.callbacks.length||(h.cancel(),delete this.entries[a]))}}},o.aL=function(a,n,s){const u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},h=>{const g=ac(a.request,(_,x,T)=>{_?h(_):x&&h(null,{rawData:x,vectorTile:s?void 0:new Ve(new Zw(x)),responseHeaders:new Map(T.entries())})});return()=>{g.cancel(),h()}},n)},o.aM=function(a){return a?{cacheControl:a.get("Cache-Control"),expires:a.get("Expires")}:{cacheControl:void 0,expires:void 0}},o.aN=Go,o.aO=function(a){Ma++,Ma>Zm&&(a.getActor().send("enforceCacheSizeLimit",qm),Ma=0)},o.aP=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log2(a)))},o.aQ=vr,o.aR=mz,o.aS=bz,o.aT=c,o.aU=pz,o.aV=function(a,n){const s=document.createElement("video");s.muted=!0,s.onloadstart=function(){n(null,s)};for(let u=0;u<a.length;u++){const h=document.createElement("source");fI(a[u])||(s.crossOrigin="Anonymous"),h.src=a[u],s.appendChild(h)}return{cancel:()=>{}}},o.aW=Ox,o.aX=Zp,o.aY=Le,o.aZ=Hx,o.a_=L,o.aa=xt,o.ab=class{constructor(a){this.specification=a}possiblyEvaluate(a,n){return In(a.expression.evaluate(n))}interpolate(a,n,s){return{x:fn(a.x,n.x,s),y:fn(a.y,n.y,s),z:fn(a.z,n.z,s),azimuthal:fn(a.azimuthal,n.azimuthal,s),polar:fn(a.polar,n.polar,s)}}},o.ac=Wi,o.ad=gd,o.ae=le,o.af=Mi,o.ag=nn,o.ah=oe,o.ai=vd,o.aj=Dh,o.ak=fn,o.al=wt,o.am=_v,o.an=$n,o.ao=Si,o.ap=class{constructor(a){this.specification=a}possiblyEvaluate(a,n){return function([s,u]){const h=In([1,s,u]);return{x:h.x,y:h.y,z:h.z}}(a.expression.evaluate(n))}interpolate(a,n,s){return{x:fn(a.x,n.x,s),y:fn(a.y,n.y,s),z:fn(a.z,n.z,s)}}},o.aq=function(a,n,s=0,u=!0){const h=new st(s,s),g=a.sub(h),_=n.add(h),x=[g,new st(_.x,g.y),_,new st(g.x,_.y)];return u&&x.push(g.clone()),x},o.ar=function(a,n){const s=[];for(let u=0;u<a.length;u++){const h=fe(u-1,-1,a.length-1),g=fe(u+1,-1,a.length-1),_=a[u],x=a[g],T=a[h].sub(_).unit(),C=x.sub(_).unit(),R=C.angleWithSep(T.x,T.y),M=T.add(C).unit().mult(-1*n/Math.sin(R/2));s.push(_.add(M))}return s},o.as=JF,o.at=bo,o.au=function(a,n,s=0){return Wt(((n.x-s)*a.scale-a.x)*wt,(n.y*a.scale-a.y)*wt,B(n.z,n.y))},o.av=xr,o.aw=pn,o.ax=Bt,o.ay=pF,o.az=function(a){let n=1/0,s=1/0,u=-1/0,h=-1/0;for(const g of a)n=Math.min(n,g.x),s=Math.min(s,g.y),u=Math.max(u,g.x),h=Math.max(h,g.y);return{min:new st(n,s),max:new st(u,h)}},o.b=function(a){return qn.API_FONTS_REGEX.test(a)},o.b$=pO,o.b0=Jr,o.b1=Sh,o.b2=ke,o.b3=vw,o.b4=oT,o.b5=function(){mc.isLoading()||mc.isLoaded()||Ap()!=="deferred"||sw()},o.b6=Bg,o.b7=De,o.b8=qp,o.b9=br,o.bA=re,o.bB=ze,o.bC=J,o.bD=function(a,n){const{x:s,y:u}=a.point,h=DL(s,u,a.worldSize/a._pixelsPerMercatorPixel,0,0);return ee(h,h,ZI(fl(n)))},o.bE=N,o.bF=ls,o.bG=Ji,o.bH=qt,o.bI=si,o.bJ=Fn,o.bK=x_,o.bL=ua,o.bM=FA,o.bN=function(a,n,s,u,h){const g=5*n+2;a.float32[g+0]=s,a.float32[g+1]=u,a.float32[g+2]=h},o.bO=E_,o.bP=qs,o.bQ=Ra,o.bR=Al,o.bS=gi,o.bT=fe,o.bU=function(a,n,s,u){var h=new A(4);return h[0]=a,h[1]=n,h[2]=s,h[3]=u,h},o.bV=class{isDataAvailableAtPoint(a){const n=this._source();if(this.isUsingMockSource()||!n||a.y<0||a.y>1)return!1;const s=n.getSource().maxzoom,u=1<<s,h=Math.floor(a.x),g=Math.floor((a.x-h)*u),_=Math.floor(a.y*u),x=this.findDEMTileFor(new vr(s,h,s,g,_));return!(!x||!x.dem)}getAtPointOrZero(a,n=0){return this.getAtPoint(a,n)||0}getAtPoint(a,n,s=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const u=this._source();if(!u||a.y<0||a.y>1)return n;const h=u.getSource().maxzoom,g=1<<h,_=Math.floor(a.x),x=a.x-_,T=new vr(h,_,h,Math.floor(x*g),Math.floor(a.y*g)),C=this.findDEMTileFor(T);if(!C||!C.dem)return n;const R=C.dem,M=1<<C.tileID.canonical.z,D=(x*M-C.tileID.canonical.x)*R.dim,O=(a.y*M-C.tileID.canonical.y)*R.dim,j=Math.floor(D),G=Math.floor(O);return(s?this.exaggeration():1)*fn(fn(R.get(j,G),R.get(j,G+1),O-G),fn(R.get(j+1,G),R.get(j+1,G+1),O-G),D-j)}static getAtTileOffset(a,n,s,u){const h=1<<a.canonical.z;return u?u.pointElevation(n):s?s.getAtPointOrZero(new le(a.wrap+(a.canonical.x+n.x/wt)/h,(a.canonical.y+n.y/wt)/h)):0}static getAtTileOffsetFunc(a,n,s,u){return(h,g,_)=>{const x=this.getAtTileOffset(a,h,g,_),T=u.upVector(a.canonical,h.x,h.y);return gn(T,T,x*u.upVectorScale(a.canonical,n,s).metersToTile),T}}getForTilePoints(a,n,s,u){if(this.isUsingMockSource())return!1;const h=S_.create(this,a,u);return!!h&&(n.forEach(g=>{g[2]=this.exaggeration()*h.getElevationAt(g[0],g[1],s)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(a);if(!n||!n.dem)return null;const s=n.dem.tree,u=n.tileID,h=1<<a.canonical.z-u.canonical.z;let g=a.canonical.x/h-u.canonical.x,_=a.canonical.y/h-u.canonical.y,x=0;for(let T=0;T<a.canonical.z-u.canonical.z&&!s.leaves[x];T++){g*=2,_*=2;const C=2*Math.floor(_)+Math.floor(g);x=s.childOffsets[x]+C,g%=1,_%=1}return{min:this.exaggeration()*s.minimums[x],max:this.exaggeration()*s.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,n,s){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const a=this.visibleDemTiles;if(a.length===0)return null;let n=!1,s=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const h of a){const g=this.getMinMaxForTile(h.tileID);g&&(s=Math.min(s,g.min),u=Math.max(u,g.max),n=!0)}return n?{min:s,max:u}:null}},o.bW=Fw,o.bX=ci,o.bY=ys,o.bZ=uO,o.b_=wz,o.ba=AA,o.bb=rA,o.bc=Se,o.bd=Eu,o.be=Cu,o.bf=Mh,o.bg=dr,o.bh=u_,o.bi=ZA,o.bj=function(a,n){const s=Dh(n.zoom);if(s===0)return fl(a);const u=Cw(a),h=qI(u),g=S(u.getWest())*n.worldSize,_=S(u.getEast())*n.worldSize,x=P(u.getNorth())*n.worldSize,T=P(u.getSouth())*n.worldSize,C=[g,x,0],R=[_,x,0],M=[g,T,0],D=[_,T,0],O=Q([],n.globeMatrix);return Mi(C,C,O),Mi(R,R,O),Mi(M,M,O),Mi(D,D,O),h[0]=Tc(h[0],M,s),h[1]=Tc(h[1],D,s),h[2]=Tc(h[2],R,s),h[3]=Tc(h[3],C,s),Ht.fromPoints(h)},o.bk=Aw,o.bl=Q,o.bm=xx,o.bn=Tc,o.bo=Eh,o.bp=jp,o.bq=Be,o.br=ie,o.bs=yT,o.bt=Zw,o.bu=ac,o.bv=function(a,n){const s=[];for(const u in a)u in n||s.push(u);return s},o.bw=Ae,o.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.by=Zs,o.bz=H,o.c=Bs,o.c$=function(a,n,s){let u=0;for(let h=0;h<2;++h)a[h]>0&&(u+=(a[h]-0)*(a[h]-0)),n[h]<0&&(u+=(0-n[h])*(0-n[h]));return u},o.c0=mO,o.c1=NA,o.c2=qF,o.c3=UA,o.c4=c2,o.c5=gn,o.c6=sc,o.c7=zs,o.c8=function(a,n,s){s*=.5;var u=n[0],h=n[1],g=n[2],_=n[3],x=Math.sin(s),T=Math.cos(s);return a[0]=u*T+h*x,a[1]=h*T-u*x,a[2]=g*T+_*x,a[3]=_*T-g*x,a},o.c9=Hs,o.cA=zt,o.cB=fi,o.cC=JO,o.cD=zi,o.cE=RL,o.cF=function(a,n,s,u,h,g,_,x,T){if(T.name==="globe")return RL(a,n,new zi(s,u,h),!1);const C=Hx({z:s,x:u,y:h},T);return new Ht([(g+C.x/C.scale)*n,n*(C.y/C.scale),_],[(g+C.x2/C.scale)*n,n*(C.y2/C.scale),x])},o.cG=function(a,n,s){return a[0]=Math.min(n[0],s[0]),a[1]=Math.min(n[1],s[1]),a[2]=Math.min(n[2],s[2]),a[3]=Math.min(n[3],s[3]),a},o.cH=function(a,n,s){return a[0]=Math.max(n[0],s[0]),a[1]=Math.max(n[1],s[1]),a[2]=Math.max(n[2],s[2]),a[3]=Math.max(n[3],s[3]),a},o.cI=function(a){const n=Math.round((a+45+360)%360/90)%4;return fv[n]},o.cJ=U,o.cK=Ja,o.cL=c_,o.cM=function(a){const n=re(new Float64Array(16));ee(n,a.pixelMatrix,a.globeMatrix);const s=[0,za,0],u=[0,ja,0];return Mi(s,s,n),Mi(u,u,n),[s[0]>0&&s[0]<=a.width&&s[1]>0&&s[1]<=a.height&&!XI(a,new c(a.center.lat,90)),u[0]>0&&u[0]<=a.width&&u[1]>0&&u[1]<=a.height&&!XI(a,new c(a.center.lat,-90))]},o.cN=function(a,n){const{scale:s}=a.tileTransform,u=s*wt/(a.tileSize*Math.pow(2,n.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return function(h,g,_){var x=g[1],T=g[2],C=g[3],R=_[0],M=_[1];return h[0]=g[0]*R,h[1]=x*R,h[2]=T*M,h[3]=C*M,h}(new Float32Array(4),n.inverseAdjustmentMatrix,[u,u])},o.cO=Uw,o.cP=at,o.cQ=QO,o.cR=function(a){const n=QO(a,!0);return N([],[n[0],n[1],n[4],n[5]])},o.cS=ue,o.cT=Mt,o.cU=xe,o.cV=function(a){const{x:n,y:s}=a.point,{lng:u,lat:h}=a._center;return DL(n,s,a.worldSize,u,h)},o.cW=en,o.cX=io,o.cY=fr,o.cZ=Vs,o.c_=Fa,o.ca=Cr,o.cb=function(a,n){return a[0]=-n[0],a[1]=-n[1],a[2]=-n[2],a[3]=n[3],a},o.cc=Zt,o.cd=function(a,n,s,u,h){var g=1/Math.tan(n/2);if(a[0]=g/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=g,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,h!=null&&h!==1/0){var _=1/(u-h);a[10]=(h+u)*_,a[14]=2*h*u*_}else a[10]=-1,a[14]=-2*u;return a},o.ce=function(a,n,s,u,h,g,_){var x=1/(n-s),T=1/(u-h),C=1/(g-_);return a[0]=-2*x,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*T,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*C,a[11]=0,a[12]=(n+s)*x,a[13]=(h+u)*T,a[14]=(_+g)*C,a[15]=1,a},o.cf=k,o.cg=function(a,n,s){a[4*n+0]=s[0],a[4*n+1]=s[1],a[4*n+2]=s[2],a[4*n+3]=s[3]},o.ch=s_,o.ci=Dp,o.cj=es,o.ck=Vl,o.cl=Lp,o.cm=rz,o.cn=function(){var a=new A(4);return A!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},o.co=function(a,n,s){var u=n[0],h=n[1],g=n[2],_=n[3],x=Math.sin(s),T=Math.cos(s);return a[0]=u*T+g*x,a[1]=h*T+_*x,a[2]=u*-x+g*T,a[3]=h*-x+_*T,a},o.cp=function(a,n){return a[0]===n[0]&&a[1]===n[1]&&a[2]===n[2]&&a[3]===n[3]},o.cq=Kr,o.cr=function(a){var n=a[0],s=a[1],u=a[2],h=a[3];return Math.sqrt(n*n+s*s+u*u+h*h)},o.cs=Cl,o.ct=fo,o.cu=Vr,o.cv=3,o.cw=2,o.cx=7,o.cy=6,o.cz=$i,o.d=function(a){return qn.API_TILEJSON_REGEX.test(a)},o.d$=class{constructor(a,n,s,u){this.context=a,this.format=u,this.size=s,this.texture=a.gl.createTexture();const[h,g,_]=this.size,{gl:x}=a;x.bindTexture(x.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in n&&n.data&&x.texImage3D(x.TEXTURE_3D,0,this.format,h,g,_,0,_A(this.format),yA(this.format),n.data)}bind(a,n){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_3D,this.texture),a!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,a),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,a),this.minFilter=a),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},o.d0=function(a){return a*a*a*a*a},o.d1=w,o.d2=45,o.d3=o_,o.d4=function(a,n,s){const u=Math.sqrt(a*a+n*n+s*s),h=u>0?Math.acos(s/u)*js:0;let g=a!==0||n!==0?Math.atan2(-n,-a)*js+90:0;return g<0&&(g+=360),[u,g,h]},o.d5=Wt,o.d6=In,o.d7=te,o.d8=et,o.d9=Ht,o.dA=function(a){return a({pluginStatus:vo,pluginURL:pc}),Fg.on("pluginStateChange",a),a},o.dB=Np,o.dC=class extends _c{constructor(a){super(a),this.current=a_}set(a,n,s){if(this.fetchUniformLocation(a,n)){for(let u=0;u<9;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},o.dD=rd,o.dE=function(a,n,s){const u=Dh(s.zoom),h=a.style.map._antialias,g=a.terrain&&a.terrain.exaggeration()>0;return u===0&&!h&&!g},o.dF=function(a){const n=a.pixelsPerMeter,s=n/k(1,a.center.lat),u=re(new Float64Array(16));return ie(u,u,[a.point.x,a.point.y,0]),ue(u,u,[s,s,n]),Float32Array.from(u)},o.dG=Cw,o.dH=function(a){const n=U-5;a=Y(a,-n,n)/n*90;const s=Math.pow(Math.abs(Math.sin($n(a))),3);return Math.round(s*(vx.length-1))},o.dI=function(a,n,s,u){const h=n.getNorth(),g=n.getSouth(),_=n.getWest(),x=n.getEast(),T=1<<a.z,C=x-_,R=h-g,M=C/Ph,D=-R/vx[s],O=[0,M,0,D,0,0,h,_,0];if(a.z>0){const j=180/u;$(O,O,[j/C+1,0,0,0,j/R+1,0,-.5*j/M,.5*j/D,1])}return O[2]=T,O[5]=a.x,O[8]=a.y,O},o.dJ=fl,o.dK=function(a,n,s){const u=re(new Float64Array(16)),h=(n/(1<<a)-.5)*Math.PI*2;return Oe(u,s.globeMatrix,h),Float32Array.from(u)},o.dL=WL,o.dM=Ul,o.dN=function(a,n){return[Math.pow(a[0],2.2)*n,Math.pow(a[1],2.2)*n,Math.pow(a[2],2.2)*n]},o.dO=F,o.dP=function(a,n){var s=Math.sin(n),u=Math.cos(n);return a[0]=u,a[1]=s,a[2]=0,a[3]=-s,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},o.dQ=Ts,o.dR=kL,o.dS=ai,o.dT=_r,o.dU=256,o.dV=function(a,n){const s=[0,0,0];return Mi(s,s,Aw(fl(n.canonical))),Mi(s,s,a),s},o.dW=a=>({u_matrix:new Lp(a),u_texsize:new Vl(a),u_pixels_to_tile_units:new l_(a),u_device_pixel_ratio:new es(a),u_width_scale:new es(a),u_floor_width_scale:new es(a),u_image:new s_(a),u_units_to_pixels:new Vl(a),u_tile_units_to_pixels:new es(a),u_alpha_discard_threshold:new es(a),u_trim_offset:new Vl(a),u_trim_fade_range:new Vl(a),u_trim_color:new o_(a),u_zbias_factor:new es(a),u_tile_to_meter:new es(a),u_ground_shadow_factor:new Dp(a),u_pattern_transition:new es(a)}),o.dX=a=>({u_matrix:new Lp(a),u_pixels_to_tile_units:new l_(a),u_device_pixel_ratio:new es(a),u_width_scale:new es(a),u_floor_width_scale:new es(a),u_units_to_pixels:new Vl(a),u_dash_image:new s_(a),u_gradient_image:new s_(a),u_image_height:new es(a),u_texsize:new Vl(a),u_tile_units_to_pixels:new es(a),u_alpha_discard_threshold:new es(a),u_trim_offset:new Vl(a),u_trim_fade_range:new Vl(a),u_trim_color:new o_(a),u_zbias_factor:new es(a),u_tile_to_meter:new es(a),u_ground_shadow_factor:new Dp(a)}),o.dY=a=>({u_camera_to_center_distance:new es(a),u_extrude_scale:new l_(a),u_device_pixel_ratio:new es(a),u_matrix:new Lp(a),u_inv_rot_matrix:new Lp(a),u_merc_center:new Vl(a),u_tile_id:new Dp(a),u_zoom_transition:new es(a),u_up_dir:new Dp(a),u_emissive_strength:new es(a)}),o.dZ=Xg,o.d_=bX,o.da=Ct,o.db=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},o.dc=YO,o.dd=SA,o.de=nF,o.df=XA,o.dg=function(a,n){return a.readFields(xY,{icons:[]},n)},o.dh=zw,o.di=b_,o.dj=jA,o.dk=Ym,o.dl=Ip,o.dm=oh,o.dn=Jm,o.dp=nt,o.dq=function(a){const n=a.indexOf(wd);return n>=0?a.slice(0,n):a},o.dr=function(a){return a.indexOf(wd)>=0},o.ds=function(a){const n=a.lastIndexOf(wd);return n>=0?a.slice(n+1):""},o.dt=function(a){const n=[],s=a.id;return s===void 0&&n.push({message:`layers.${s}: missing required property "id"`}),a.render===void 0&&n.push({message:`layers.${s}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&n.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),n},o.du=function(a,n,s,u){return a.type==="custom"?new fY(a,n):new yY[a.type](a,n,s,u)},o.dv=mt,o.dw=function(a){const n=a.indexOf(wd);return n>=0?a.slice(n+1):""},o.dx=class extends qp{constructor(a,n){super(a._vectorTileFeature,a._z,a._x,a._y,a.id),a.state&&(this.state=Object.assign({},a.state)),this.target=n.target,this.namespace=n.namespace,n.properties&&(this.properties=n.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=a.source,this.sourceLayer=a.sourceLayer,this.layer=a.layer)}toJSON(){const a=super.toJSON();return a.target=this.target,a.namespace=this.namespace,a}},o.dy=Fg,o.dz=cd,o.e=qn,o.e$=Ke,o.e0=OL,o.e1=(a,n,s,u,h,g)=>{const _=a.transform,x=_.projection.name==="globe";let T;if(g.paint.get("circle-pitch-alignment")==="map")if(x){const R=kL(_.zoom,n.canonical)*_._pixelsPerMercatorPixel;T=Float32Array.from([R,0,0,R])}else T=_.calculatePixelsToTileUnitsMatrix(s);else T=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const C={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(_.projection),u_matrix:a.translatePosMatrix(n.projMatrix,s,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:gs.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:FZ,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:g.paint.get("circle-emissive-strength")};if(x){C.u_inv_rot_matrix=u,C.u_merc_center=h,C.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],C.u_zoom_transition=Dh(_.zoom);const R=h[0]*wt,M=h[1]*wt;C.u_up_dir=_.projection.upVector(new zi(0,0,0),R,M)}return C},o.e2=yF,o.e3=_o,o.e4=(a,n,s,u,h,g,_,x,T,C)=>{const R=a.transform,M=R.pitch<15?mF(.07,.7,Y((14-R.zoom)/5,0,1)):.07,D=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:_F(a,n,s,u),u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:R.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:h,u_width_scale:g,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:gF(n,R),u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(D?null:s.lut).toArray01(),u_zbias_factor:M,u_tile_to_meter:te(n.tileID.canonical,0),u_ground_shadow_factor:T,u_pattern_transition:C}},o.e5=(a,n,s,u,h,g,_,x,T,C)=>{const R=a.transform,M=R.calculatePixelsToTileUnitsMatrix(n),D=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none",O=R.pitch<15?mF(.07,.7,Y((14-R.zoom)/5,0,1)):.07;return{u_matrix:_F(a,n,s,u),u_pixels_to_tile_units:M,u_device_pixel_ratio:g,u_width_scale:_,u_floor_width_scale:x,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:vF(s)&&n.lineAtlasTexture?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:gF(n,a.transform),u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(D?null:s.lut).toArray01(),u_zbias_factor:O,u_tile_to_meter:te(n.tileID.canonical,0),u_ground_shadow_factor:C}},o.e6=Ge,o.e7=bx,o.e8=B,o.e9=Va,o.eA=function(a,n){var s=2*Math.acos(n[3]),u=Math.sin(s/2);return u>I?(a[0]=n[0]/u,a[1]=n[1]/u,a[2]=n[2]/u):(a[0]=1,a[1]=0,a[2]=0),s},o.eB=JA,o.eC=Hw,o.eD=Gw,o.eE=[1,1,1],o.eF=S_,o.eG=na,o.eH=function(a,n,s,u){var h=n[0],g=n[1],_=n[2],x=n[3];return a[0]=h+u*(s[0]-h),a[1]=g+u*(s[1]-g),a[2]=_+u*(s[2]-_),a[3]=x+u*(s[3]-x),a},o.eI=g_,o.eJ=aa,o.eK=Bl,o.eL=function(a,n,s,u,h,g,_,x,T,C,R,M,D,O,j,G){var X=new A(16);return X[0]=a,X[1]=n,X[2]=s,X[3]=u,X[4]=h,X[5]=g,X[6]=_,X[7]=x,X[8]=T,X[9]=C,X[10]=R,X[11]=M,X[12]=D,X[13]=O,X[14]=j,X[15]=G,X},o.eM=f,o.eN=Ih,o.eO=cx,o.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new st(1/0,1/0),max:new st(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,n=!1){const s=hO(new st(0,0),new st(wt,wt),a),u=[];if(n&&!sA(s,this._globalClipBounds))return u;for(const h of this._activeRegions){if(h.hiddenByOverlap||!sA(s,h))continue;const g=hK(h.min,h.max,a);u.push({min:g.min,max:g.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return u}setSources(a){this._setSources(a.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const s=[];for(const u of n.cache.getVisibleCoordinates()){const h=n.cache.getTile(u).buckets[n.layer];h&&h.updateFootprints(u.toUnwrapped(),s)}return s},getOrder:()=>n.order,getClipMask:()=>n.clipMask,getClipScope:()=>n.clipScope})))}_addSource(a){const n=a.getFootprints();if(n.length===0)return;const s=a.getOrder(),u=a.getClipMask(),h=a.getClipScope();for(const g of n){if(!g.footprint)continue;const _=hO(g.footprint.min,g.footprint.max,g.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:g.id,footprint:g.footprint,order:s,clipMask:u,clipScope:h})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort((n,s)=>n.priority-s.priority||Dw(n.min,s.min)||Dw(n.max,s.max)||n.order-s.order||n.clipMask-s.clipMask||function(u,h){const g=(_,x)=>_+x;return u.length-h.length||u.reduce(g,"").localeCompare(h.reduce(g,""))}(n.clipScope,s.clipScope));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let n=0;for(;!a&&n!==this._activeRegions.length;){const s=this._activeRegions[n],u=this._prevRegions[n];a=s.priority!==u.priority||!dO(s,u)||s.order!==u.order||s.clipMask!==u.clipMask||!Zs(s.clipScope,u.clipScope),this._activeRegions[n].hiddenByOverlap=u.hiddenByOverlap,++n}}if(a){++this._updateTime;for(const s of this._activeRegions)s.order!==Ix&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));const n=s=>{const u=this._activeRegions;if(s>=u.length)return s;const h=u[s].priority;for(;s<u.length&&u[s].priority===h;)++s;return s};if(this._sourceIds.length>1){let s=0,u=n(s);for(;s!==u;){let h=s;const g=s;for(;h!==u;){const _=this._activeRegions[h];_.hiddenByOverlap=!1;for(let x=0;x<g;x++){const T=this._activeRegions[x];if(!T.hiddenByOverlap&&_.order===Ix&&sA(_,T)&&(_.hiddenByOverlap=fO(_.footprint,_.tileId,T.footprint,T.tileId),_.hiddenByOverlap))break}++h}s=u,u=n(s)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=a.length-1;n>=0;n--)this._addSource(a[n]);this._computeReplacement()}},o.eQ=Ix,o.eR=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,n){const s=new Eu,u=new Jr,h=[],g=a+1+2,_=n[0]+1,x=n[0]+1+(1+n.length),T=(C,R,M)=>{let D=C===g-1?C-2:C===0?C:C-1;return D+=M?24575:0,[D,R]};for(let C=0;C<g;++C)s.emplaceBack(...T(C,0,!0));for(let C=0;C<_;++C)for(let R=0;R<g;++R)s.emplaceBack(...T(R,C,(R===0||R===g-1)&&!0));for(let C=0;C<n.length;++C){const R=n[C];for(let M=0;M<g;++M)s.emplaceBack(...T(M,R,!0))}for(let C=0;C<n.length;++C){const R=u.length,M=n[C]+1+2,D=new Jr;for(let G=0;G<M-1;G++){const X=G===M-2,K=X?g*(x-n.length+C-G):g;for(let se=0;se<g-1;se++){const ae=G*g+se;G===0||X||se===0||se===g-2?(D.emplaceBack(ae+1,ae,ae+K),D.emplaceBack(ae+K,ae+K+1,ae+1)):(u.emplaceBack(ae+1,ae,ae+K),u.emplaceBack(ae+K,ae+K+1,ae+1))}}const O=dr.simpleSegment(0,R,s.length,u.length-R);for(let G=0;G<D.uint16.length;G+=3)u.emplaceBack(D.uint16[G],D.uint16[G+1],D.uint16[G+2]);const j=dr.simpleSegment(0,R,s.length,u.length-R);h.push({withoutSkirts:O,withSkirts:j})}return{vertices:s,indices:u,segments:h}}_createGrid(a){const n=this._fillGridMeshWithLods(Ph,vx);this._gridSegments=n.segments,this._gridBuffer=a.createVertexBuffer(n.vertices,Mh.members),this._gridIndexBuffer=a.createIndexBuffer(n.indices,!0)}_createPoles(a){const n=new Jr;for(let _=0;_<=Ph;_++)n.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=a.createIndexBuffer(n,!0);const s=new Ed,u=new Ed,h=new Ed,g=new Ed;this._poleSegments=[];for(let _=0,x=0;_<Fa;_++){const T=360/(1<<_);s.emplaceBack(0,-Ys,0,.5,0),u.emplaceBack(0,-Ys,0,.5,1),h.emplaceBack(0,-Ys,0,.5,.5),g.emplaceBack(0,-Ys,0,.5,.5);for(let C=0;C<=Ph;C++){let R=C/Ph,M=0;const D=fn(0,T,R),[O,j,G]=Sd(LZ,OZ,D,Ys);s.emplaceBack(O,j,G,R,M),u.emplaceBack(O,j,G,R,1-M);const X=$n(D);R=.5+.5*Math.sin(X),M=.5+.5*Math.cos(X),h.emplaceBack(O,j,G,R,M),g.emplaceBack(O,j,G,R,1-M)}this._poleSegments.push(dr.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(s,hl,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(u,hl,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(h,hl,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(g,hl,!1)}getGridBuffers(a,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},o.eS=cO,o.eT=ep,o.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.eV=je,o.eW=ne,o.eX=function(a,n,s){return a[0]=n[0]/s[0],a[1]=n[1]/s[1],a[2]=n[2]/s[2],a},o.eY=Sl,o.eZ=Rh,o.e_=_n,o.ea=Ow,o.eb=PO,o.ec=Id,o.ed=vO,o.ee=yO,o.ef=W,o.eg=function(a,n){if(a===n){var s=n[1],u=n[2],h=n[3],g=n[6],_=n[7],x=n[11];a[1]=n[4],a[2]=n[8],a[3]=n[12],a[4]=s,a[6]=n[9],a[7]=n[13],a[8]=u,a[9]=g,a[11]=n[14],a[12]=h,a[13]=_,a[14]=x}else a[0]=n[0],a[1]=n[4],a[2]=n[8],a[3]=n[12],a[4]=n[1],a[5]=n[5],a[6]=n[9],a[7]=n[13],a[8]=n[2],a[9]=n[6],a[10]=n[10],a[11]=n[14],a[12]=n[3],a[13]=n[7],a[14]=n[11],a[15]=n[15];return a},o.eh=hY,o.ei=Gn,o.ej=dx,o.ek=256,o.el=ZI,o.em=oa,o.en=Oe,o.eo=function(a,n){return a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[4],a[4]=n[5],a[5]=n[6],a[6]=n[8],a[7]=n[9],a[8]=n[10],a},o.ep=Ed,o.eq=qb,o.er=lx,o.es=function(a,n,s,u,h){return Y((a-n)/(s-n)*(h-u)+u,u,h)},o.et=tl,o.eu=function(a,n){var s=n[0],u=n[1],h=n[2],g=n[3],_=n[4],x=n[5],T=n[6],C=n[7],R=n[8],M=R*_-x*C,D=-R*g+x*T,O=C*g-_*T,j=s*M+u*D+h*O;return j?(a[0]=M*(j=1/j),a[1]=(-R*u+h*C)*j,a[2]=(x*u-h*_)*j,a[3]=D*j,a[4]=(R*s-h*T)*j,a[5]=(-x*s+h*g)*j,a[6]=O*j,a[7]=(-C*s+u*T)*j,a[8]=(_*s-u*g)*j,a):null},o.ev=2,o.ew=Rt,o.ex=el,o.ey=Et,o.ez=function(a,n){var s=new A(3);Et(s,n);var u=1/s[0],h=1/s[1],g=1/s[2],_=n[0]*u,x=n[1]*h,T=n[2]*g,C=n[4]*u,R=n[5]*h,M=n[6]*g,D=n[8]*u,O=n[9]*h,j=n[10]*g,G=_+R+j,X=0;return G>0?(X=2*Math.sqrt(G+1),a[3]=.25*X,a[0]=(M-O)/X,a[1]=(D-T)/X,a[2]=(x-C)/X):_>R&&_>j?(X=2*Math.sqrt(1+_-R-j),a[3]=(M-O)/X,a[0]=.25*X,a[1]=(x+C)/X,a[2]=(D+T)/X):R>j?(X=2*Math.sqrt(1+R-_-j),a[3]=(D-T)/X,a[0]=(x+C)/X,a[1]=.25*X,a[2]=(M+O)/X):(X=2*Math.sqrt(1+j-_-R),a[3]=(x-C)/X,a[0]=(D+T)/X,a[1]=(M+O)/X,a[2]=.25*X),a},o.f=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,(n,s)=>String.fromCharCode(+("0x"+s))))},o.f0=function([a,n,s]){const u=Math.hypot(a,n,s),h=Math.atan2(a,s),g=.5*Math.PI-Math.acos(-n/u);return new c(io(h),io(g))},o.f1=po,o.f2=xA,o.f3=function(a){const n=a.navigator?a.navigator.userAgent:null;return!!function(s){if($r==null){const u=s.navigator?s.navigator.userAgent:null;$r=!!s.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return $r}(a)&&!(!n||!(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.f4=function(a,n){qm=a,Zm=n},o.f5=XI,o.f6=NL,o.f7=function(a){const n=[0,0,0],s=re(new Float64Array(16));return ee(s,a.pixelMatrix,a.globeMatrix),Mi(n,n,s),new st(n[0],n[1])},o.f8=function(){const a=Dx;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(dA),Dx=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.f9=function(){zw().acquire(dA)},o.fA=_T,o.fB=Me,o.fC=function(a){let n=0;if(new Uint32Array(a,0,1)[0]!==WO){const s=new Uint32Array(a,0,7),[,,u,h,g,_]=s;n=s.byteLength+h+g+_+g,(u!==a.byteLength||n>=a.byteLength)&&Nt("Invalid b3dm header information.")}return XO(a,n)},o.fD=function(a,n){const s=SA(a);for(const u of s){for(const h of u.meshes)$K(h);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(GK(u.lights,n)))}return s},o.fE=dT,o.fF=ei,o.fG=VO,o.fH=mc,o.fI=Ho,o.fJ=function(a){sl(),Rl!=null&&Rl.then(n=>{n.keys().then(s=>{for(let u=0;u<s.length-a;u++)n.delete(s[u]).catch(h=>Nt(h.message))}).catch(s=>Nt(s.message))}).catch(n=>Nt(n.message))},o.fa=Ap,o.fb=function(a,n,s=!1){if(vo===Ho.deferred||vo===Ho.loading||vo===Ho.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");pc=gs.resolveURL(a),vo=Ho.deferred,Qv=n,Og(),s||sw()},o.fc=function(a){f_=gs.resolveURL(a),p_||(p_=new h_(zw(),new ud)),p_.broadcast("setMeshoptUrl",f_)},o.fd=GO,o.fe=function(a){pA=gs.resolveURL(a),p_||(p_=new h_(zw(),new ud)),p_.broadcast("setDracoUrl",pA)},o.ff=$O,o.fg=kx,o.fh=function(a){const n=rl();if(!n)return;const s=n.delete(Wm);a&&s.then(()=>a()).catch(a)},o.fi=Up,o.fj=jt,o.fk=Nh,o.fl=Cc,o.fm=c3,o.fn=u3,o.fo=dF,o.fp=Xe,o.fq="hd_road_elevation",o.fr=_i,o.fs=$e,o.ft=Cd,o.fu=zA,o.fv=Hp,o.fw=function(a,n,s,u,h,g,_,x=1,T,C,R){a.createArrays(),a.tilePixelRatio=wt/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const M=a.layers[0].layout,D=a.layers[0]._unevaluatedLayout._values,O={};O.scaleFactor=x,O.textSizeScaleRange=M.get("text-size-scale-range"),O.iconSizeScaleRange=M.get("icon-size-scale-range");const[j,G]=O.textSizeScaleRange,[X,K]=O.iconSizeScaleRange;O.textScaleFactor=Y(O.scaleFactor,j,G),O.iconScaleFactor=Y(O.scaleFactor,X,K);const se=D["text-size"],ae=D["icon-size"];if(a.textSizeData.kind==="composite"){const{minZoom:Re,maxZoom:qe}=a.textSizeData;O.compositeTextSizes=[se.possiblyEvaluate(new Wi(Re,{worldview:R}),g),se.possiblyEvaluate(new Wi(qe,{worldview:R}),g)]}if(a.iconSizeData.kind==="composite"){const{minZoom:Re,maxZoom:qe}=a.iconSizeData;O.compositeIconSizes=[ae.possiblyEvaluate(new Wi(Re,{worldview:R}),g),ae.possiblyEvaluate(new Wi(qe,{worldview:R}),g)]}O.layoutTextSize=se.possiblyEvaluate(new Wi(_+1,{worldview:R}),g),O.layoutIconSize=ae.possiblyEvaluate(new Wi(_+1,{worldview:R}),g),O.textMaxSize=se.possiblyEvaluate(new Wi(18,{worldview:R}),g);const de=M.get("symbol-placement"),ve=M.get("text-rotation-alignment")==="map"&&de!=="point",me=M.get("text-size");let Te=!1;const Ie=[];for(const Re of a.features){const qe=M.get("text-font").evaluate(Re,{},g).join(","),Ne=me.evaluate(Re,{},g)*O.textScaleFactor,Qe=O.layoutTextSize.evaluate(Re,{},g)*O.textScaleFactor,it=O.layoutIconSize.evaluate(Re,{},g)*O.iconScaleFactor,rt={horizontal:{},vertical:void 0},ht=Re.text;let pt,ct=[0,0];if(ht){const An=ht.toString(),ki=M.get("text-letter-spacing").evaluate(Re,{},g)*ys,ge=M.get("text-line-height").evaluate(Re,{},g)*ys,be=Xv(An)?ki:0,Je=M.get("text-anchor").evaluate(Re,{},g),ft=M.get("text-variable-anchor");if(!ft){const Cn=M.get("text-radial-offset").evaluate(Re,{},g);if(Cn)ct=qF(Je,[Cn*ys,VA]);else{const Ln=M.get("text-offset").evaluate(Re,{},g);ct=[Ln[0]*ys,Ln[1]*ys]}}let At=ve?"center":M.get("text-justify").evaluate(Re,{},g);const Pt=de==="point",Qt=Pt?M.get("text-max-width").evaluate(Re,{},g)*ys:1/0,tn=Cn=>{a.allowVerticalPlacement&&Cp(An)&&(rt.vertical=DA(ht,n,s,h,qe,Qt,ge,Je,Cn,be,ct,ua.vertical,!0,Qe,Ne,T))};if(!ve&&ft){const Cn=At==="auto"?ft.map(zn=>UA(zn)):[At];let Ln=!1;for(let zn=0;zn<Cn.length;zn++){const Hn=Cn[zn];if(!rt.horizontal[Hn])if(Ln)rt.horizontal[Hn]=rt.horizontal[0];else{const dn=DA(ht,n,s,h,qe,Qt,ge,"center",Hn,be,ct,ua.horizontal,!1,Qe,Ne,T);dn&&(rt.horizontal[Hn]=dn,Ln=dn.positionedLines.length===1)}}tn("left")}else{if(At==="auto"&&(At=UA(Je)),Pt||M.get("text-writing-mode").indexOf("horizontal")>=0||!Cp(An)){const Cn=DA(ht,n,s,h,qe,Qt,ge,Je,At,be,ct,ua.horizontal,!1,Qe,Ne,T);Cn&&(rt.horizontal[At]=Cn)}tn(Pt?"left":At)}}let ut,Ye,Ze,dt,Tt,yt,Yt=!1;const kt=M.get("icon-text-fit").evaluate(Re,{},g);if(Re.icon&&Re.icon.hasPrimary()){const An=$x(Re.icon,a.iconSizeData,D["icon-size"],g,a.zoom,Re,T,O.iconScaleFactor,R);ut=An.iconPrimary,Ze=An.iconSecondary;const ki=ut.toString();if(Ye=u.get(ki),Ye&&(Tt=M.get("icon-offset").evaluate(Re,{},g),yt=M.get("icon-anchor").evaluate(Re,{},g),pt=Xw(h.get(ki),Ze?h.get(Ze.toString()):void 0,Tt,yt),Yt=Ye.sdf,a.sdfIcons===void 0?a.sdfIcons=Ye.sdf:a.sdfIcons!==Ye.sdf&&Nt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ye.pixelRatio!==a.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0)),Ze){const ge=Ze.toString();dt=u.get(ge)}}Te=Te||!(!Re.icon||!Re.icon.hasSecondary());const Ot=tT(rt.horizontal)||rt.vertical;a.iconsInText||(a.iconsInText=!!Ot&&Ot.iconsInText);const Ut=Qe*O.textScaleFactor/ys,{defaultShapedIcon:jn,verticallyShapedIcon:vt}=QX(a,pt,M,Re,g,rt,Ut,Tt,kt);kt!=="none"&&pt&&(kF(pt)||DF(pt))&&(eT(0,Ye,ut,pt,jn,kt,C,u,h),eT(0,dt,Ze,pt,jn,kt,C,u,h),vt&&(eT(0,Ye,ut,pt,vt,kt,C,u,h),eT(0,dt,Ze,pt,vt,kt,C,u,h))),pt=jn;const{iconBBox:$t,iconVerticalBBox:xn,textBBox:Kn,textVerticalBBox:Qn}=qX(a,pt,vt,M,Re,g,it,Tt,O,h,yt,rt,Qe,ct);Ie.push({feature:Re,shapedTextOrientations:rt,shapedText:Ot,shapedIcon:pt,iconPrimary:ut,iconSecondary:Ze,iconOffset:Tt,iconAnchor:yt,verticallyShapedIcon:vt,layoutTextSize:Qe,layoutIconSize:it,textOffset:ct,isSDFIcon:Yt,iconTextFit:kt,iconCollisionBounds:$t,iconVerticalCollisionBounds:xn,textCollisionBounds:Kn,textVerticalCollisionBounds:Qn})}return{featureData:Ie,sizes:O,hasAnySecondaryIcon:Te,textAlongLine:ve,symbolPlacement:de}},o.fx=VF,o.fy=function(a,n,s,u,h,g,_,x,T,C){a.iconAtlasPositions=C.iconPositions;const{featureData:R,hasAnySecondaryIcon:M,sizes:D,textAlongLine:O,symbolPlacement:j}=n;for(const G of R){const{shapedIcon:X,verticallyShapedIcon:K,feature:se,shapedTextOrientations:ae,shapedText:de,layoutTextSize:ve,textOffset:me,isSDFIcon:Te,iconPrimary:Ie,iconSecondary:Re,iconTextFit:qe,iconOffset:Ne,iconCollisionBounds:Qe,iconVerticalCollisionBounds:it,textCollisionBounds:rt}=G;KF(X,C.iconPositions,Ie,Re),KF(K,C.iconPositions,Ie,Re),YX(ae,C.iconPositions),XX(Ie,Re,C.iconPositions),(de||X)&&JX(a,se,ae,X,K,T,D,ve,0,me,Te,u,h,_,x,M,qe,Ne,O,j,Qe,it,rt)}s&&a.generateCollisionDebugBuffers(g,a.collisionBoxArray,D.textScaleFactor)},o.fz=Ve,o.g=function(a,n){return cd(Object.assign(a,{method:"GET"}),n)},o.h=function(a){return a.indexOf("mapbox:")===0},o.i=function(a){return qn.API_STYLE_REGEX.test(a)&&!Bs(a)},o.j=Ir,o.k=Ml,o.l=function(a){return decodeURIComponent(atob(a).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.m=function(a,n){return cd(Object.assign(a,{type:"json"}),n)},o.n=Qm,o.o=gs,o.p=function(a,n){return cd(Object.assign(a,{method:"POST"}),n)},o.q=eo,o.r=Pl,o.s=function(a){try{const n=self[a];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=function(){return hA||(hA=new Up("ImageRasterizer")),hA},o.u=function(){return function a(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()},o.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},o.w=Nt,o.x=s2,o.y=op,o.z=kl}),m(["./shared"],function(o){function I(je){const Y=je?je.url.toString():void 0;return Y?performance.getEntriesByName(Y):[]}function A(je){if(typeof je=="number"||typeof je=="boolean"||typeof je=="string"||je==null)return JSON.stringify(je);if(Array.isArray(je)){let oe="[";for(const fe of je)oe+=`${A(fe)},`;return`${oe}]`}let Y="{";for(const oe of Object.keys(je).sort())Y+=`${oe}:${A(je[oe])},`;return`${Y}}`}function N(je){let Y="";for(const oe of o.bx)Y+=`/${A(je[oe])}`;return Y}class F{constructor(Y){this.keyCache={},this._layers={},this._layerConfigs={},Y&&this.replace(Y)}replace(Y,oe){this._layerConfigs={},this._layers={},this.update(Y,[],oe)}update(Y,oe,fe){this._options=fe;for(const Ce of Y)this._layerConfigs[Ce.id]=Ce,(this._layers[Ce.id]=o.du(Ce,this.scope,null,this._options)).compileFilter(fe),this.keyCache[Ce.id]&&delete this.keyCache[Ce.id];for(const Ce of oe)delete this.keyCache[Ce],delete this._layerConfigs[Ce],delete this._layers[Ce];this.familiesBySource={};const Ae=function(Ce,ke){const Ge={};for(let $e=0;$e<Ce.length;$e++){const mt=Ce[$e];let nt=ke&&ke[mt.id];nt||(mt.type==="symbol"?nt=mt.id:(nt=N(mt),mt.type==="line"&&mt.paint&&function sn(Nt){return typeof Nt=="string"&&Nt==="line-progress"||(Array.isArray(Nt)?Nt.some(sn):!(!Nt||typeof Nt!="object")&&Object.values(Nt).some(sn))}(mt.paint["line-width"])&&(nt+=`/${A(mt.paint["line-width"])}`))),ke&&(ke[mt.id]=nt);let Ft=Ge[nt];Ft||(Ft=Ge[nt]=[]),Ft.push(mt)}const Le=[];for(const $e in Ge)Le.push(Ge[$e]);return Le}(Object.values(this._layerConfigs),this.keyCache);for(const Ce of Ae){const ke=Ce.map(Ft=>this._layers[Ft.id]),Ge=ke[0];if(Ge.visibility==="none")continue;const Le=Ge.source||"";let $e=this.familiesBySource[Le];$e||($e=this.familiesBySource[Le]={});const mt=Ge.sourceLayer||"_geojsonTileLayer";let nt=$e[mt];nt||(nt=$e[mt]=[]),nt.push(ke)}}}const z=1*o.fl;class ${constructor(Y){const oe={},fe=[];for(const Ge in Y){const Le=Y[Ge],$e=oe[Ge]={};for(const mt in Le.glyphs){const nt=Le.glyphs[+mt];if(!nt||nt.bitmap.width===0||nt.bitmap.height===0)continue;const Ft=nt.metrics.localGlyph?z:1,sn={x:0,y:0,w:nt.bitmap.width+2*Ft,h:nt.bitmap.height+2*Ft};fe.push(sn),$e[mt]=sn}}const{w:Ae,h:Ce}=o.G(fe),ke=new o.fk({width:Ae||1,height:Ce||1});for(const Ge in Y){const Le=Y[Ge];for(const $e in Le.glyphs){const mt=Le.glyphs[+$e];if(!mt||mt.bitmap.width===0||mt.bitmap.height===0)continue;const nt=oe[Ge][$e],Ft=mt.metrics.localGlyph?z:1;o.fk.copy(mt.bitmap,ke,{x:0,y:0},{x:nt.x+Ft,y:nt.y+Ft},mt.bitmap)}}this.image=ke,this.positions=oe}}function J(je,Y,oe){je[Y]?oe&&(je[Y].center=oe):je[Y]={floorIds:new Set,center:oe||[0,0],floors:{}}}function H(je,Y,oe,fe){for(const Ae of Y)J(je,Ae),je[Ae].floors[oe]=fe,je[Ae].floorIds.add(oe)}function re(je){return{id:je.properties.id.toString(),center:je.properties.center.toString().split(";").map(Number)}}function Q(je){return{id:je.properties.id.toString(),isDefault:!!je.properties.is_default&&je.properties.is_default,connections:je.properties.connected_floor_ids?new Set(je.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:je.properties.conflicted_floor_ids?new Set(je.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:je.properties.building_ids?new Set(je.properties.building_ids.toString().split(";")):new Set,name:je.properties.name.toString(),zIndex:je.properties.z_index}}function ee(je,Y){return Y.every(oe=>je.properties&&je.properties[oe]!=null)}function ie(je){return ee(je,["type","id","name"])&&je.properties.type==="building"}function ue(je){return ee(je,["type","id","name","z_index"])&&je.properties.type==="floor"}o.fj($,"GlyphAtlas");class xe{constructor(Y){this.tileID=new o.aQ(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.lut=Y.lut,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.scope=Y.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.request&&Y.request.collectResourceTiming,this.promoteId=Y.promoteId,this.isSymbolTile=Y.isSymbolTile,this.tileTransform=o.aZ(Y.tileID.canonical,Y.projection),this.projection=Y.projection,this.worldview=Y.worldview,this.localizableLayerIds=Y.localizableLayerIds,this.brightness=Y.brightness,this.extraShadowCaster=!!Y.extraShadowCaster,this.tessellationStep=Y.tessellationStep,this.scaleFactor=Y.scaleFactor,this.worldview=Y.worldview,this.indoor=Y.indoor}parse(Y,oe,fe,Ae,Ce,ke){this.status="parsing",this.data=Y,this.collisionBoxArray=new o.b3;const Ge=new o.fm(Object.keys(Y.layers).sort()),Le=new o.fn(this.tileID,this.promoteId);Le.bucketLayerIDs=[];const $e={},mt=new o.fo(256,256),nt={featureIndex:Le,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:mt,availableImages:fe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const kn=this.indoor.indoorState.activeFloorsVisible,Pn=function(In,ei,br){const $r=function(gr,ai){if(!gr)return o.w("No source layers defined in indoor specification"),ai;if(gr.size===0)return ai;const _r=gr.difference(ai);for(const Bi of _r)o.w(`Missing source layer required in indoor specification: ${Bi}`);return ai.intersection(ai)}(ei.sourceLayers,new Set(Object.keys(In.layers))),Cr=ei.indoorState,Xr=function(gr,ai,_r,Bi){const qn=new Set,Ir=new Set,Bs=new Set,Ks=new Map,Po={},sd=Es=>{const ia=Ks.get(Es)||new Set;for(const ro of qn)if((Ks.get(ro)||new Set).has(Es)||ia.has(ro))return!0;return!1};for(const Es of ai){const ia=gr.layers[Es];if(ia)for(let ro=0;ro<ia.length;ro++){const Pl=ia.feature(ro);if(ie(Pl)){const{id:gs,center:od}=re(Pl);J(Po,gs,od),qn.add(gs)}else if(ue(Pl)){const{id:gs,isDefault:od,connections:oh,conflicts:Wm,buildings:qm,name:Zm,zIndex:tp}=Q(Pl);H(Po,qm,gs,{name:Zm,zIndex:tp}),Ks.set(gs,Wm),(gs===Bi||oh.has(Bi))&&qn.add(gs),Ir.add(gs),od&&Bs.add(gs)}}else o.w(`indoor source layer not found: ${Es}`)}if(_r)for(const Es of _r)Ir.has(Es)&&(sd(Es)||qn.add(Es));for(const Es of Bs)qn.has(Es)||sd(Es)||qn.add(Es);return{buildings:Po,activeFloors:qn}}(In,$r,Cr.lastActiveFloors,Cr.selectedFloorId);return br.send("setIndoorData",Xr),Xr}(Y,this.indoor,Ce);nt.activeFloors=kn?Pn.activeFloors:void 0}const Ft=[],sn=oe.familiesBySource[this.source];for(const kn in sn){const Pn=Y.layers[kn];if(!Pn)continue;let In=!1,ei=!1,br=!1;for(const ai of sn[kn])ai[0].type==="symbol"?In=!0:ei=!0,ai[0].is3D()&&ai[0].type!=="model"&&(br=!0);if(this.extraShadowCaster&&!br||this.isSymbolTile===!0&&!In||this.isSymbolTile===!1&&!ei)continue;Pn.version===1&&o.w(`Vector tile source "${this.source}" layer "${kn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const $r=Ge.encode(kn),Cr=[],Xr=this.localizableLayerIds&&this.localizableLayerIds.has(kn);let gr=!1;for(let ai=0,_r=0;ai<Pn.length;ai++){const Bi=Pn.feature(ai),qn=Le.getId(Bi,kn),Ir=Bi.properties?Bi.properties.worldview:null;if(Xr&&this.worldview&&typeof Ir=="string")if(Ir==="all")Bi.properties.$localized=!0;else{if(!Ir.split(",").includes(this.worldview))continue;Bi.properties.$localized=!0,Bi.properties.worldview=this.worldview}!gr&&Bi.properties&&Bi.properties.hasOwnProperty(o.fp)&&(gr=!0),Cr.push({feature:Bi,id:qn,index:_r,sourceLayerIndex:$r}),_r++}gr&&!nt.elevationFeatures&&Y.layers.hasOwnProperty(o.fq)&&(nt.elevationFeatures=o.fr.parseFrom(Y.layers[o.fq],this.canonical));for(const ai of sn[kn]){const _r=ai[0];if(this.extraShadowCaster&&(!_r.is3D()||_r.type==="model")||this.isSymbolTile!==void 0&&_r.type==="symbol"!==this.isSymbolTile||_r.minzoom&&this.zoom<Math.floor(_r.minzoom)||_r.maxzoom&&this.zoom>=_r.maxzoom||_r.visibility==="none")continue;Oe(ai,this.zoom,nt.brightness,fe,this.worldview);const Bi=$e[_r.id]=_r.createBucket({index:Le.bucketLayerIDs.length,layers:ai,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:$r,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ae,worldview:this.worldview,localizable:Xr});Le.bucketLayerIDs.push(ai.map(Ir=>o.B(Ir.id,Ir.scope)));let qn=Bi.prepare?Bi.prepare():null;qn!=null?(qn=qn.then(()=>Bi.populate(Cr,nt,this.tileID.canonical,this.tileTransform)),Ft.push(qn)):Bi.populate(Cr,nt,this.tileID.canonical,this.tileTransform)}}const Nt=()=>{let kn,Pn,In,ei,br,$r;mt.trim();const Cr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Xr=()=>{if(kn)return this.status="done",ke(kn);if(this.extraShadowCaster)this.status="done",ke(null,{buckets:Object.values($e).filter(ai=>!ai.isEmpty()),featureIndex:Le,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:nt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Pn&&In&&ei){const ai=new $(Pn),_r=new Map;for(const[Ir,Bs]of In.entries()){const{imagePosition:Ks}=o.fu(Ir,Bs,o.fv);_r.set(Ir,Ks)}const Bi={};for(const Ir in $e){const Bs=$e[Ir];Bs instanceof o.b4&&(Oe(Bs.layers,this.zoom,nt.brightness,fe,this.worldview),Bi[Ir]=o.fw(Bs,Pn,ai.positions,In,_r,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,br,this.worldview))}const qn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ce,In,br,()=>{qn.iconsPending=!1,gr(Bi,ai,qn)}),this.rasterizeIfNeeded(Ce,ei,$r,()=>{qn.patternsPending=!1,gr(Bi,ai,qn)})}},gr=(ai,_r,Bi,qn)=>{if(Bi.iconsPending||Bi.patternsPending)return;const Ir=new o.fx(In,ei,this.lut);for(const Bs in $e){const Ks=$e[Bs];if(Bs in ai)o.fy(Ks,ai[Bs],this.showCollisionBoxes,fe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,In,Ir);else if(Ks.hasPattern&&(Ks instanceof o.ba||Ks instanceof o.bb||Ks instanceof o.ea)){Oe(Ks.layers,this.zoom,nt.brightness,fe,this.worldview);const Po=Object.fromEntries(Ir.patternPositions);Ks.addFeatures(nt,this.tileID.canonical,Po,fe,this.tileTransform,this.brightness)}}this.status="done",ke(null,{buckets:Object.values($e).filter(Bs=>!Bs.isEmpty()),featureIndex:Le,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:_r.image,lineAtlas:mt,imageAtlas:Ir,brightness:nt.brightness})};if(!this.extraShadowCaster){const ai=o.fs(nt.glyphDependencies,qn=>Object.keys(qn).map(Number));Object.keys(ai).length?Ce.send("getGlyphs",{uid:this.uid,stacks:ai},(qn,Ir)=>{kn||(kn=qn,Pn=Ir,Xr())},void 0,!1,Cr):Pn={};const _r=Array.from(nt.iconDependencies.keys()).map(qn=>o.I.parse(qn));_r.length?Ce.send("getImages",{images:_r,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(qn,Ir)=>{kn||(kn=qn,In=new Map,br=this.updateImageMapAndGetImageTaskQueue(In,Ir,nt.iconDependencies),Xr())},void 0,!1,Cr):(In=new Map,br=new Map);const Bi=Array.from(nt.patternDependencies.keys()).map(qn=>o.I.parse(qn));Bi.length?Ce.send("getImages",{images:Bi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(qn,Ir)=>{kn||(kn=qn,ei=new Map,$r=this.updateImageMapAndGetImageTaskQueue(ei,Ir,nt.patternDependencies),Xr())},void 0,!1,Cr):(ei=new Map,$r=new Map)}if(nt.elevationFeatures&&nt.elevationFeatures.length>0){const ai=[];for(const Bi of Object.values($e))if(Bi instanceof o.bb){const qn=Bi.getUnevaluatedPortalGraph();qn&&ai.push(qn)}const _r=o.ft.evaluate(ai);for(const Bi of Object.values($e))if(Bi instanceof o.bb){const qn=Y.layers[Ge.decode(Bi.sourceLayerIndex)];Bi.setEvaluatedPortalGraph(_r,qn,this.tileID.canonical,nt.availableImages,nt.brightness)}}Xr()};Ft.length>0?Promise.allSettled(Ft).then(Nt).catch(ke):Nt()}updateParameters(Y){this.scaleFactor=Y.scaleFactor,this.showCollisionBoxes=Y.showCollisionBoxes,this.projection=Y.projection,this.brightness=Y.brightness,this.tileTransform=o.aZ(Y.tileID.canonical,Y.projection),this.extraShadowCaster=Y.extraShadowCaster,this.lut=Y.lut,this.worldview=Y.worldview,this.indoor=Y.indoor}rasterizeIfNeeded(Y,oe,fe,Ae){Array.from(oe.values()).some(Ce=>Ce.usvg)?this.rasterize(Y,oe,fe,Ae):Ae()}updateImageMapAndGetImageTaskQueue(Y,oe,fe){const Ae=new Map;for(const Ce of oe.keys()){const ke=fe.get(Ce)||[];for(const Ge of ke){const Le=Ge.toString(),$e=oe.get(Ge.id.toString());$e.usvg?Ae.has(Le)||(Ae.set(Le,Ge),Y.set(Le,Object.assign({},$e))):Y.set(Le,$e)}}return Ae}rasterize(Y,oe,fe,Ae){this.rasterizeTask=Y.send("rasterizeImages",{scope:this.scope,tasks:fe},(Ce,ke)=>{if(!Ce)for(const[Ge,Le]of ke.entries()){const $e=Object.assign(oe.get(Ge),{data:Le});oe.set(Ge,$e)}Ae()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Oe(je,Y,oe,fe,Ae){const Ce=new o.ac(Y,{brightness:oe,worldview:Ae});for(const ke of je)ke.recalculate(Ce,fe)}class ze extends o.E{constructor(Y,oe,fe,Ae,Ce,ke,Ge){super(),this.actor=Y,this.layerIndex=oe,this.availableImages=fe,this.availableModels=Ae,this.loadVectorData=ke||o.aL,this.loading={},this.loaded={},this.deduped=new o.aK(Y.scheduler),this.isSpriteLoaded=Ce,this.scheduler=Y.scheduler,this.brightness=Ge}loadTile(Y,oe){const fe=Y.uid,Ae=Y&&Y.request,Ce=Ae&&Ae.collectResourceTiming,ke=this.loading[fe]=new xe(Y);ke.abort=this.loadVectorData(Y,(Ge,Le)=>{const $e=!this.loading[fe];if(delete this.loading[fe],ke.cancelRasterize(),$e||Ge||!Le)return ke.status="done",$e||(this.loaded[fe]=ke),oe(Ge);const mt=Le.rawData,nt={},Ft=o.aM(Le.responseHeaders);Ft&&Ft.expires&&(nt.expires=Ft.expires),Ft&&Ft.cacheControl&&(nt.cacheControl=Ft.cacheControl),ke.vectorTile=Le.vectorTile||new o.fz(new o.bt(mt));const sn=()=>{ke.parse(ke.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Nt,kn)=>{if(Nt||!kn)return oe(Nt);const Pn={};if(Ce){const In=I(Ae);In.length>0&&(Pn.resourceTiming=JSON.parse(JSON.stringify(In)))}oe(null,Object.assign({rawTileData:mt.slice(0),responseHeaders:Le.responseHeaders},kn,nt,Pn))})};this.isSpriteLoaded?sn():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(sn,{type:"parseTile",isSymbolTile:Y.isSymbolTile,zoom:Y.tileZoom}):sn()}),this.loaded=this.loaded||{},this.loaded[fe]=ke})}reloadTile(Y,oe){const fe=this.loaded,Ae=Y.uid;if(fe&&fe[Ae]){const Ce=fe[Ae];Ce.updateParameters(Y);const ke=(Ge,Le)=>{const $e=Ce.reloadCallback;$e&&(delete Ce.reloadCallback,Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,$e)),oe(Ge,Le)};Ce.status==="parsing"?Ce.reloadCallback=ke:Ce.status==="done"&&(Ce.vectorTile?Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ke):ke())}else oe(null,void 0)}abortTile(Y,oe){const fe=Y.uid,Ae=this.loading[fe];Ae&&(Ae.abort&&Ae.abort(),delete this.loading[fe]),oe()}removeTile(Y,oe){const fe=this.loaded,Ae=Y.uid;fe&&fe[Ae]&&delete fe[Ae],oe()}}class Be{loadTile(Y,oe){const{uid:fe,encoding:Ae,rawImageData:Ce,padding:ke}=Y,Ge=ImageBitmap&&Ce instanceof ImageBitmap?this.getImageData(Ce,ke):Ce;oe(null,new o.fA(fe,Ge,Ae,ke<1))}reloadTile(Y,oe){oe(null,null)}abortTile(Y,oe){oe()}removeTile(Y,oe){oe()}getImageData(Y,oe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);const fe=this.offscreenCanvasContext.getImageData(-oe,-oe,Y.width+2*oe,Y.height+2*oe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),fe}}o.bs.setPbf(o.bt);class ot{constructor(Y){this._mrt=new o.bs(Y.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Y.uid,this.tileID=Y.tileID,this.source=Y.source}parse(Y,oe){const fe=this._mrt;this.status="parsing",this._entireBuffer=Y;try{fe.parseHeader(Y),this._isHeaderLoaded=!0;const Ae=[];for(const Ce in fe.layers){const ke=fe.getLayer(Ce),Ge=ke.getDataRange(ke.getBandList()),Le=fe.createDecodingTask(Ge),$e=Y.slice(Ge.firstByte,Ge.lastByte+1),mt=o.bs.performDecoding($e,Le).then(nt=>Le.complete(null,nt)).catch(nt=>Le.complete(nt,null));Ae.push(mt)}Promise.allSettled(Ae).then(()=>oe(null,fe)).catch(Ce=>oe(Ce))}catch(Ae){oe(Ae)}}}class Et{constructor(Y){this.actor=Y,this.loading={},this.loaded={}}loadTile(Y,oe){const fe=Y.uid,Ae=Y.request,Ce=this.loading[fe]=new ot(Y),{cancel:ke}=o.bu(Ae,(Ge,Le,$e)=>{const mt=!this.loading[fe];if(delete this.loading[fe],mt||Ge||!Le)return Ce.status="done",mt||(this.loaded[fe]=Ce),oe(Ge);Ce.parse(Le,(nt,Ft)=>{if(nt||!Ft)return oe(nt);oe(null,Ft,$e)}),this.loaded[fe]=Ce});Ce.abort=ke}reloadTile(Y,oe){oe(null,void 0)}abortTile(Y,oe){const fe=Y.uid,Ae=this.loading[fe];Ae&&(Ae.abort&&Ae.abort(),delete this.loading[fe]),oe()}removeTile(Y,oe){const fe=Y.uid;this.loaded[fe]&&delete this.loaded[fe],oe()}decodeRasterArray(Y,oe){o.bs.performDecoding(Y.buffer,Y.task).then(fe=>oe(null,fe)).catch(fe=>oe(fe))}}const Zt=o.fB.prototype.toGeoJSON;class at{constructor(Y){this._feature=Y,this.extent=o.al,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){const Y=[];for(const oe of this._feature.geometry)Y.push([new o.P(oe[0],oe[1])]);return Y}{const Y=[];for(const oe of this._feature.geometry){const fe=[];for(const Ae of oe)fe.push(new o.P(Ae[0],Ae[1]));Y.push(fe)}return Y}}toGeoJSON(Y,oe,fe){return Zt.call(this,Y,oe,fe)}}class zt{constructor(Y,oe){this.name=Y,this.extent=o.al,this.length=oe.length,this._jsonFeatures=oe}feature(Y){return new at(this._jsonFeatures[Y])}}class Kt{constructor(Y){this.layers={},this.extent=o.al;for(const oe of Object.keys(Y))this.layers[oe]=new zt(oe,Y[oe])}}const nn=64/4096,Wt=128;class Ke{constructor(){this.features=new Map}clear(){this.features.clear()}load(Y=[],oe){for(const fe of Y){const Ae=fe.id;if(Ae==null)continue;let Ce=this.features.get(Ae);Ce&&this.updateCache(Ce,oe),fe.geometry?(Ce=Ct(fe),this.updateCache(Ce,oe),this.features.set(Ae,Ce)):this.features.delete(Ae),this.updateCache(Ce,oe)}}updateCache(Y,oe){for(const{canonical:fe,uid:Ae}of Object.values(oe)){const{z:Ce,x:ke,y:Ge}=fe;et(Y,Math.pow(2,Ce),ke,Ge)&&delete oe[Ae]}}getTile(Y,oe,fe){const Ae=Math.pow(2,Y),Ce=[];for(const ke of this.features.values())et(ke,Ae,oe,fe)&&Ce.push(gn(ke,Ae,oe,fe));return{features:Ce}}getFeatures(){return[...this.features.values()]}}function et({minX:je,minY:Y,maxX:oe,maxY:fe},Ae,Ce,ke){return je<(Ce+1+nn)/Ae&&Y<(ke+1+nn)/Ae&&oe>(Ce-nn)/Ae&&fe>(ke-nn)/Ae}function Ct(je){const{id:Y,geometry:oe,properties:fe}=je;if(!oe)return;if(oe.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ae,coordinates:Ce}=oe,ke={id:Y,type:1,geometry:[],tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ge=ke.geometry;if(Ae==="Point")en(Ce,Ge,ke);else if(Ae==="MultiPoint")for(const Le of Ce)en(Le,Ge,ke);else if(Ae==="LineString")ke.type=2,Bn(Ce,Ge,ke);else if(Ae==="MultiLineString")ke.type=2,En(Ce,Ge,ke);else if(Ae==="Polygon")ke.type=3,En(Ce,Ge,ke,!0);else{if(Ae!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ke.type=3;for(const Le of Ce)En(Le,Ge,ke,!0)}return ke}function en([je,Y],oe,fe){const Ae=o.aF(je);let Ce=o.aJ(Y);Ce=Ce<0?0:Ce>1?1:Ce,oe.push(Ae,Ce),fe.minX=Math.min(fe.minX,Ae),fe.minY=Math.min(fe.minY,Ce),fe.maxX=Math.max(fe.maxX,Ae),fe.maxY=Math.max(fe.maxY,Ce)}function Bn(je,Y,oe,fe=!1,Ae=!1){const Ce=[];for(const ke of je)en(ke,Ce,oe);Y.push(Ce),fe&&function(ke,Ge){let Le=0;for(let $e=0,mt=ke.length,nt=mt-2;$e<mt;nt=$e,$e+=2)Le+=(ke[$e]-ke[nt])*(ke[$e+1]+ke[nt+1]);if(Le>0===Ge)for(let $e=0,mt=ke.length;$e<mt/2;$e+=2){const nt=ke[$e],Ft=ke[$e+1];ke[$e]=ke[mt-2-$e],ke[$e+1]=ke[mt-1-$e],ke[mt-2-$e]=nt,ke[mt-1-$e]=Ft}}(Ce,Ae)}function En(je,Y,oe,fe=!1){for(let Ae=0;Ae<je.length;Ae++)Bn(je[Ae],Y,oe,fe,Ae===0)}function gn(je,Y,oe,fe){const{id:Ae,type:Ce,geometry:ke,tags:Ge}=je,Le=[];if(Ce===1)(function($e,mt,nt,Ft,sn){for(let Nt=0;Nt<$e.length;Nt+=2){const kn=Math.round(o.al*($e[Nt+0]*mt-nt)),Pn=Math.round(o.al*($e[Nt+1]*mt-Ft));sn.push([kn,Pn])}})(ke,Y,oe,fe,Le);else if(Ce===2)for(const $e of ke)qt($e,Y,oe,fe,Le);else if(Ce===3)for(const $e of ke)Ji($e,Y,oe,fe,Le);return{id:Ae,type:Ce,geometry:Le,tags:Ge}}function qt(je,Y,oe,fe,Ae){const Ce=-Wt,ke=o.al+Wt;let Ge;for(let Le=0;Le<je.length-2;Le+=2){let $e=Math.round(o.al*(je[Le+0]*Y-oe)),mt=Math.round(o.al*(je[Le+1]*Y-fe)),nt=Math.round(o.al*(je[Le+2]*Y-oe)),Ft=Math.round(o.al*(je[Le+3]*Y-fe));const sn=nt-$e,Nt=Ft-mt;$e<Ce&&nt<Ce||($e<Ce?(mt+=Math.round(Nt*((Ce-$e)/sn)),$e=Ce):nt<Ce&&(Ft=mt+Math.round(Nt*((Ce-$e)/sn)),nt=Ce),mt<Ce&&Ft<Ce||(mt<Ce?($e+=Math.round(sn*((Ce-mt)/Nt)),mt=Ce):Ft<Ce&&(nt=$e+Math.round(sn*((Ce-mt)/Nt)),Ft=Ce),$e>=ke&&nt>=ke||($e>=ke?(mt+=Math.round(Nt*((ke-$e)/sn)),$e=ke):nt>=ke&&(Ft=mt+Math.round(Nt*((ke-$e)/sn)),nt=ke),mt>=ke&&Ft>=ke||(mt>=ke?($e+=Math.round(sn*((ke-mt)/Nt)),mt=ke):Ft>=ke&&(nt=$e+Math.round(sn*((ke-mt)/Nt)),Ft=ke),Ge&&$e===Ge[Ge.length-1][0]&&mt===Ge[Ge.length-1][1]||(Ge=[[$e,mt]],Ae.push(Ge)),Ge.push([nt,Ft])))))}}function Ji(je,Y,oe,fe,Ae){const Ce=(oe-nn)/Y,ke=(fe-nn)/Y,Ge=(oe+1+nn)/Y,Le=(fe+1+nn)/Y;function $e(Ft,sn){let Nt=0;return Ft<Ce?Nt|=1:Ft>Ge&&(Nt|=2),sn<ke?Nt|=4:sn>Le&&(Nt|=8),Nt}let mt=[];for(let Ft=1;Ft<=8;Ft*=2){let sn=je[je.length-2],Nt=je[je.length-1],kn=!($e(sn,Nt)&Ft);for(let Pn=0;Pn<je.length;Pn+=2){const In=je[Pn],ei=je[Pn+1],br=!($e(In,ei)&Ft);br!==kn&&(8&Ft?mt.push(sn+(In-sn)*(Le-Nt)/(ei-Nt),Le):4&Ft?mt.push(sn+(In-sn)*(ke-Nt)/(ei-Nt),ke):2&Ft?mt.push(Ge,Nt+(ei-Nt)*(Ge-sn)/(In-sn)):1&Ft&&mt.push(Ce,Nt+(ei-Nt)*(Ce-sn)/(In-sn))),br&&mt.push(In,ei),sn=In,Nt=ei,kn=br}if(!(je=mt).length||Ft===8)break;mt=[]}const nt=[];for(let Ft=0;Ft<mt.length;Ft+=2)nt.push([Math.round(o.al*(mt[Ft]*Y-oe)),Math.round(o.al*(mt[Ft+1]*Y-fe))]);Ae.push(nt)}function Sr({name:je,features:Y},oe){oe.writeStringField(1,je),oe.writeVarintField(5,o.al);const fe=new Map,Ae=new Map,Ce={keys:fe,values:Ae,feature:null};for(const ke of Y)Ce.feature=ke,oe.writeMessage(2,_n,Ce);for(const ke of fe.keys())oe.writeStringField(3,ke);for(const ke of Ae.keys())oe.writeMessage(4,$i,ke)}function _n(je,Y){const oe=je.feature;oe.id!==void 0&&Number.isSafeInteger(+oe.id)&&Y.writeVarintField(1,+oe.id),oe.tags&&Y.writeMessage(2,Rt,je),Y.writeVarintField(3,oe.type),Y.writeMessage(4,si,oe)}function Rt({keys:je,values:Y,feature:oe},fe){for(const Ae of Object.keys(oe.tags)){let Ce=oe.tags[Ae];if(Ce===null)continue;let ke=je.get(Ae);ke===void 0&&(ke=je.size,je.set(Ae,ke)),fe.writeVarint(ke);const Ge=typeof Ce;Ge!=="string"&&Ge!=="boolean"&&Ge!=="number"&&(Ce=JSON.stringify(Ce));let Le=Y.get(Ce);Le===void 0&&(Le=Y.size,Y.set(Ce,Le)),fe.writeVarint(Le)}}function pn(je,Y){return(Y<<3)+(7&je)}function Fn(je){return je<<1^je>>31}function si(je,Y){const{geometry:oe,type:fe}=je;let Ae=0,Ce=0;if(fe===1){Y.writeVarint(pn(1,oe.length));for(const ke of oe){const Ge=ke[0]-Ae,Le=ke[1]-Ce;Y.writeVarint(Fn(Ge)),Y.writeVarint(Fn(Le)),Ae+=Ge,Ce+=Le}}else for(const ke of oe){Y.writeVarint(pn(1,1));const Ge=ke.length-(fe===3?1:0);for(let Le=0;Le<Ge;Le++){Le===1&&Y.writeVarint(pn(2,Ge-1));const $e=ke[Le][0]-Ae,mt=ke[Le][1]-Ce;Y.writeVarint(Fn($e)),Y.writeVarint(Fn(mt)),Ae+=$e,Ce+=mt}fe===3&&Y.writeVarint(pn(7,1))}}function $i(je,Y){const oe=typeof je;oe==="string"?Y.writeStringField(1,je):oe==="boolean"?Y.writeBooleanField(7,je):oe==="number"&&(je%1!=0?Y.writeDoubleField(3,je):je<0?Y.writeSVarintField(6,je):Y.writeVarintField(5,je))}const Mi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:je=>je},Ts=Math.fround||(fo=new Float32Array(1),je=>(fo[0]=+je,fo[0]));var fo;const ls=3,Kr=5,xr=6;class Sl{constructor(Y){this.options=Object.assign(Object.create(Mi),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){const{log:oe,minZoom:fe,maxZoom:Ae}=this.options;oe&&console.time("total time");const Ce=`prepare ${Y.length} points`;oe&&console.time(Ce),this.points=Y;const ke=[];for(let Le=0;Le<Y.length;Le++){const $e=Y[Le];if(!$e.geometry)continue;const[mt,nt]=$e.geometry.coordinates,Ft=Ts(Ja(mt)),sn=Ts(po(nt));ke.push(Ft,sn,1/0,Le,-1,1),this.options.reduce&&ke.push(0)}let Ge=this.trees[Ae+1]=this._createTree(ke);oe&&console.timeEnd(Ce);for(let Le=Ae;Le>=fe;Le--){const $e=+Date.now();Ge=this.trees[Le]=this._createTree(this._cluster(Ge,Le)),oe&&console.log("z%d: %d clusters in %dms",Le,Ge.numItems,+Date.now()-$e)}return oe&&console.timeEnd("total time"),this}getClusters(Y,oe){let fe=((Y[0]+180)%360+360)%360-180;const Ae=Math.max(-90,Math.min(90,Y[1]));let Ce=Y[2]===180?180:((Y[2]+180)%360+360)%360-180;const ke=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)fe=-180,Ce=180;else if(fe>Ce){const nt=this.getClusters([fe,Ae,180,ke],oe),Ft=this.getClusters([-180,Ae,Ce,ke],oe);return nt.concat(Ft)}const Ge=this.trees[this._limitZoom(oe)],Le=Ge.range(Ja(fe),po(ke),Ja(Ce),po(Ae)),$e=Ge.data,mt=[];for(const nt of Le){const Ft=this.stride*nt;mt.push($e[Ft+Kr]>1?sc($e,Ft,this.clusterProps):this.points[$e[Ft+ls]])}return mt}getChildren(Y){const oe=this._getOriginId(Y),fe=this._getOriginZoom(Y),Ae="No cluster with the specified id.",Ce=this.trees[fe];if(!Ce)throw new Error(Ae);const ke=Ce.data;if(oe*this.stride>=ke.length)throw new Error(Ae);const Ge=this.options.radius/(this.options.extent*Math.pow(2,fe-1)),Le=Ce.within(ke[oe*this.stride],ke[oe*this.stride+1],Ge),$e=[];for(const mt of Le){const nt=mt*this.stride;ke[nt+4]===Y&&$e.push(ke[nt+Kr]>1?sc(ke,nt,this.clusterProps):this.points[ke[nt+ls]])}if($e.length===0)throw new Error(Ae);return $e}getLeaves(Y,oe,fe){const Ae=[];return this._appendLeaves(Ae,Y,oe=oe||10,fe=fe||0,0),Ae}getTile(Y,oe,fe){const Ae=this.trees[this._limitZoom(Y)],Ce=Math.pow(2,Y),{extent:ke,radius:Ge}=this.options,Le=Ge/ke,$e=(fe-Le)/Ce,mt=(fe+1+Le)/Ce,nt={features:[]};return this._addTileFeatures(Ae.range((oe-Le)/Ce,$e,(oe+1+Le)/Ce,mt),Ae.data,oe,fe,Ce,nt),oe===0&&this._addTileFeatures(Ae.range(1-Le/Ce,$e,1,mt),Ae.data,Ce,fe,Ce,nt),oe===Ce-1&&this._addTileFeatures(Ae.range(0,$e,Le/Ce,mt),Ae.data,-1,fe,Ce,nt),nt.features.length?nt:null}getClusterExpansionZoom(Y){let oe=this._getOriginZoom(Y)-1;for(;oe<=this.options.maxZoom;){const fe=this.getChildren(Y);if(oe++,fe.length!==1)break;Y=fe[0].properties.cluster_id}return oe}_appendLeaves(Y,oe,fe,Ae,Ce){const ke=this.getChildren(oe);for(const Ge of ke){const Le=Ge.properties;if(Le&&Le.cluster?Ce+Le.point_count<=Ae?Ce+=Le.point_count:Ce=this._appendLeaves(Y,Le.cluster_id,fe,Ae,Ce):Ce<Ae?Ce++:Y.push(Ge),Y.length===fe)break}return Ce}_createTree(Y){const oe=new o.c4(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let fe=0;fe<Y.length;fe+=this.stride)oe.add(Y[fe],Y[fe+1]);return oe.finish(),oe.data=Y,oe}_addTileFeatures(Y,oe,fe,Ae,Ce,ke){for(const Ge of Y){const Le=Ge*this.stride,$e=oe[Le+Kr]>1;let mt,nt,Ft;if($e)mt=na(oe,Le,this.clusterProps),nt=oe[Le],Ft=oe[Le+1];else{const kn=this.points[oe[Le+ls]];mt=kn.properties;const[Pn,In]=kn.geometry.coordinates;nt=Ja(Pn),Ft=po(In)}const sn={type:1,geometry:[[Math.round(this.options.extent*(nt*Ce-fe)),Math.round(this.options.extent*(Ft*Ce-Ae))]],tags:mt};let Nt;Nt=$e||this.options.generateId?oe[Le+ls]:this.points[oe[Le+ls]].id,Nt!==void 0&&(sn.id=Nt),ke.features.push(sn)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,oe){const{radius:fe,extent:Ae,reduce:Ce,minPoints:ke}=this.options,Ge=fe/(Ae*Math.pow(2,oe)),Le=Y.data,$e=[],mt=this.stride;for(let nt=0;nt<Le.length;nt+=mt){if(Le[nt+2]<=oe)continue;Le[nt+2]=oe;const Ft=Le[nt],sn=Le[nt+1],Nt=Y.within(Le[nt],Le[nt+1],Ge),kn=Le[nt+Kr];let Pn=kn;for(const In of Nt){const ei=In*mt;Le[ei+2]>oe&&(Pn+=Le[ei+Kr])}if(Pn>kn&&Pn>=ke){let In,ei=Ft*kn,br=sn*kn,$r=-1;const Cr=(nt/mt<<5)+(oe+1)+this.points.length;for(const Xr of Nt){const gr=Xr*mt;if(Le[gr+2]<=oe)continue;Le[gr+2]=oe;const ai=Le[gr+Kr];ei+=Le[gr]*ai,br+=Le[gr+1]*ai,Le[gr+4]=Cr,Ce&&(In||(In=this._map(Le,nt,!0),$r=this.clusterProps.length,this.clusterProps.push(In)),Ce(In,this._map(Le,gr)))}Le[nt+4]=Cr,$e.push(ei/Pn,br/Pn,1/0,Cr,-1,Pn),Ce&&$e.push($r)}else{for(let In=0;In<mt;In++)$e.push(Le[nt+In]);if(Pn>1)for(const In of Nt){const ei=In*mt;if(!(Le[ei+2]<=oe)){Le[ei+2]=oe;for(let br=0;br<mt;br++)$e.push(Le[ei+br])}}}}return $e}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,oe,fe){if(Y[oe+Kr]>1){const ke=this.clusterProps[Y[oe+xr]];return fe?Object.assign({},ke):ke}const Ae=this.points[Y[oe+ls]].properties,Ce=this.options.map(Ae);return fe&&Ce===Ae?Object.assign({},Ce):Ce}}function sc(je,Y,oe){return{type:"Feature",id:je[Y+ls],properties:na(je,Y,oe),geometry:{type:"Point",coordinates:[(fe=je[Y],360*(fe-.5)),ks(je[Y+1])]}};var fe}function na(je,Y,oe){const fe=je[Y+Kr],Ae=fe>=1e4?`${Math.round(fe/1e3)}k`:fe>=1e3?Math.round(fe/100)/10+"k":fe,Ce=je[Y+xr],ke=Ce===-1?{}:Object.assign({},oe[Ce]);return Object.assign(ke,{cluster:!0,cluster_id:je[Y+ls],point_count:fe,point_count_abbreviated:Ae})}function Ja(je){return je/360+.5}function po(je){const Y=Math.sin(je*Math.PI/180),oe=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return oe<0?0:oe>1?1:oe}function ks(je){const Y=(180-360*je)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function el(je,Y,oe,fe){let Ae=fe;const Ce=Y+(oe-Y>>1);let ke,Ge=oe-Y;const Le=je[Y],$e=je[Y+1],mt=je[oe],nt=je[oe+1];for(let Ft=Y+3;Ft<oe;Ft+=3){const sn=zs(je[Ft],je[Ft+1],Le,$e,mt,nt);if(sn>Ae)ke=Ft,Ae=sn;else if(sn===Ae){const Nt=Math.abs(Ft-Ce);Nt<Ge&&(ke=Ft,Ge=Nt)}}Ae>fe&&(ke-Y>3&&el(je,Y,ke,fe),je[ke+2]=Ae,oe-ke>3&&el(je,ke,oe,fe))}function zs(je,Y,oe,fe,Ae,Ce){let ke=Ae-oe,Ge=Ce-fe;if(ke!==0||Ge!==0){const Le=((je-oe)*ke+(Y-fe)*Ge)/(ke*ke+Ge*Ge);Le>1?(oe=Ae,fe=Ce):Le>0&&(oe+=ke*Le,fe+=Ge*Le)}return ke=je-oe,Ge=Y-fe,ke*ke+Ge*Ge}function Hs(je,Y,oe,fe){const Ae={id:je??null,type:Y,geometry:oe,tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")tl(Ae,oe);else if(Y==="Polygon")tl(Ae,oe[0]);else if(Y==="MultiLineString")for(const Ce of oe)tl(Ae,Ce);else if(Y==="MultiPolygon")for(const Ce of oe)tl(Ae,Ce[0]);return Ae}function tl(je,Y){for(let oe=0;oe<Y.length;oe+=3)je.minX=Math.min(je.minX,Y[oe]),je.minY=Math.min(je.minY,Y[oe+1]),je.maxX=Math.max(je.maxX,Y[oe]),je.maxY=Math.max(je.maxY,Y[oe+1])}function Ws(je,Y,oe,fe){if(!Y.geometry)return;const Ae=Y.geometry.coordinates;if(Ae&&Ae.length===0)return;const Ce=Y.geometry.type,ke=Math.pow(oe.tolerance/((1<<oe.maxZoom)*oe.extent),2);let Ge=[],Le=Y.id;if(oe.promoteId?Le=Y.properties[oe.promoteId]:oe.generateId&&(Le=fe||0),Ce==="Point")Ia(Ae,Ge);else if(Ce==="MultiPoint")for(const $e of Ae)Ia($e,Ge);else if(Ce==="LineString")oc(Ae,Ge,ke,!1);else if(Ce==="MultiLineString"){if(oe.lineMetrics){for(const $e of Ae)Ge=[],oc($e,Ge,ke,!1),je.push(Hs(Le,"LineString",Ge,Y.properties));return}Cl(Ae,Ge,ke,!1)}else if(Ce==="Polygon")Cl(Ae,Ge,ke,!0);else{if(Ce!=="MultiPolygon"){if(Ce==="GeometryCollection"){for(const $e of Y.geometry.geometries)Ws(je,{id:Le,geometry:$e,properties:Y.properties},oe,fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const $e of Ae){const mt=[];Cl($e,mt,ke,!0),Ge.push(mt)}}je.push(Hs(Le,Ce,Ge,Y.properties))}function Ia(je,Y){Y.push(Il(je[0]),jr(je[1]),0)}function oc(je,Y,oe,fe){let Ae,Ce,ke=0;for(let Le=0;Le<je.length;Le++){const $e=Il(je[Le][0]),mt=jr(je[Le][1]);Y.push($e,mt,0),Le>0&&(ke+=fe?(Ae*mt-$e*Ce)/2:Math.sqrt(Math.pow($e-Ae,2)+Math.pow(mt-Ce,2))),Ae=$e,Ce=mt}const Ge=Y.length-3;Y[2]=1,el(Y,0,Ge,oe),Y[Ge+2]=1,Y.size=Math.abs(ke),Y.start=0,Y.end=Y.size}function Cl(je,Y,oe,fe){for(let Ae=0;Ae<je.length;Ae++){const Ce=[];oc(je[Ae],Ce,oe,fe),Y.push(Ce)}}function Il(je){return je/360+.5}function jr(je){const Y=Math.sin(je*Math.PI/180),oe=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return oe<0?0:oe>1?1:oe}function qs(je,Y,oe,fe,Ae,Ce,ke,Ge){if(fe/=Y,Ce>=(oe/=Y)&&ke<fe)return je;if(ke<oe||Ce>=fe)return null;const Le=[];for(const $e of je){const mt=$e.geometry;let nt=$e.type;const Ft=Ae===0?$e.minX:$e.minY,sn=Ae===0?$e.maxX:$e.maxY;if(Ft>=oe&&sn<fe){Le.push($e);continue}if(sn<oe||Ft>=fe)continue;let Nt=[];if(nt==="Point"||nt==="MultiPoint")Aa(mt,Nt,oe,fe,Ae);else if(nt==="LineString")Al(mt,Nt,oe,fe,Ae,!1,Ge.lineMetrics);else if(nt==="MultiLineString")Ra(mt,Nt,oe,fe,Ae,!1);else if(nt==="Polygon")Ra(mt,Nt,oe,fe,Ae,!0);else if(nt==="MultiPolygon")for(const kn of mt){const Pn=[];Ra(kn,Pn,oe,fe,Ae,!0),Pn.length&&Nt.push(Pn)}if(Nt.length){if(Ge.lineMetrics&&nt==="LineString"){for(const kn of Nt)Le.push(Hs($e.id,nt,kn,$e.tags));continue}nt!=="LineString"&&nt!=="MultiLineString"||(Nt.length===1?(nt="LineString",Nt=Nt[0]):nt="MultiLineString"),nt!=="Point"&&nt!=="MultiPoint"||(nt=Nt.length===3?"Point":"MultiPoint"),Le.push(Hs($e.id,nt,Nt,$e.tags))}}return Le.length?Le:null}function Aa(je,Y,oe,fe,Ae){for(let Ce=0;Ce<je.length;Ce+=3){const ke=je[Ce+Ae];ke>=oe&&ke<=fe&&$o(Y,je[Ce],je[Ce+1],je[Ce+2])}}function Al(je,Y,oe,fe,Ae,Ce,ke){let Ge=Pa(je);const Le=Ae===0?id:nl;let $e,mt,nt=je.start;for(let Pn=0;Pn<je.length-3;Pn+=3){const In=je[Pn],ei=je[Pn+1],br=je[Pn+2],$r=je[Pn+3],Cr=je[Pn+4],Xr=Ae===0?In:ei,gr=Ae===0?$r:Cr;let ai=!1;ke&&($e=Math.sqrt(Math.pow(In-$r,2)+Math.pow(ei-Cr,2))),Xr<oe?gr>oe&&(mt=Le(Ge,In,ei,$r,Cr,oe),ke&&(Ge.start=nt+$e*mt)):Xr>fe?gr<fe&&(mt=Le(Ge,In,ei,$r,Cr,fe),ke&&(Ge.start=nt+$e*mt)):$o(Ge,In,ei,br),gr<oe&&Xr>=oe&&(mt=Le(Ge,In,ei,$r,Cr,oe),ai=!0),gr>fe&&Xr<=fe&&(mt=Le(Ge,In,ei,$r,Cr,fe),ai=!0),!Ce&&ai&&(ke&&(Ge.end=nt+$e*mt),Y.push(Ge),Ge=Pa(je)),ke&&(nt+=$e)}let Ft=je.length-3;const sn=je[Ft],Nt=je[Ft+1],kn=Ae===0?sn:Nt;kn>=oe&&kn<=fe&&$o(Ge,sn,Nt,je[Ft+2]),Ft=Ge.length-3,Ce&&Ft>=3&&(Ge[Ft]!==Ge[0]||Ge[Ft+1]!==Ge[1])&&$o(Ge,Ge[0],Ge[1],Ge[2]),Ge.length&&Y.push(Ge)}function Pa(je){const Y=[];return Y.size=je.size,Y.start=je.start,Y.end=je.end,Y}function Ra(je,Y,oe,fe,Ae,Ce){for(const ke of je)Al(ke,Y,oe,fe,Ae,Ce,!1)}function $o(je,Y,oe,fe){je.push(Y,oe,fe)}function id(je,Y,oe,fe,Ae,Ce){const ke=(Ce-Y)/(fe-Y);return $o(je,Ce,oe+(Ae-oe)*ke,1),ke}function nl(je,Y,oe,fe,Ae,Ce){const ke=(Ce-oe)/(Ae-oe);return $o(je,Y+(fe-Y)*ke,Ce,1),ke}function Oi(je,Y){const oe=[];for(let fe=0;fe<je.length;fe++){const Ae=je[fe],Ce=Ae.type;let ke;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")ke=ms(Ae.geometry,Y);else if(Ce==="MultiLineString"||Ce==="Polygon"){ke=[];for(const Ge of Ae.geometry)ke.push(ms(Ge,Y))}else if(Ce==="MultiPolygon"){ke=[];for(const Ge of Ae.geometry){const Le=[];for(const $e of Ge)Le.push(ms($e,Y));ke.push(Le)}}oe.push(Hs(Ae.id,Ce,ke,Ae.tags))}return oe}function ms(je,Y){const oe=[];oe.size=je.size,je.start!==void 0&&(oe.start=je.start,oe.end=je.end);for(let fe=0;fe<je.length;fe+=3)oe.push(je[fe]+Y,je[fe+1],je[fe+2]);return oe}function gi(je,Y){if(je.transformed)return je;const oe=1<<je.z,fe=je.x,Ae=je.y;for(const Ce of je.features){const ke=Ce.geometry,Ge=Ce.type;if(Ce.geometry=[],Ge===1)for(let Le=0;Le<ke.length;Le+=2)Ce.geometry.push(er(ke[Le],ke[Le+1],Y,oe,fe,Ae));else for(let Le=0;Le<ke.length;Le++){const $e=[];for(let mt=0;mt<ke[Le].length;mt+=2)$e.push(er(ke[Le][mt],ke[Le][mt+1],Y,oe,fe,Ae));Ce.geometry.push($e)}}return je.transformed=!0,je}function er(je,Y,oe,fe,Ae,Ce){return[Math.round(oe*(je*fe-Ae)),Math.round(oe*(Y*fe-Ce))]}function tr(je,Y,oe,fe,Ae){const Ce=Y===Ae.maxZoom?0:Ae.tolerance/((1<<Y)*Ae.extent),ke={features:[],numPoints:0,numSimplified:0,numFeatures:je.length,source:null,x:oe,y:fe,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ge of je)mo(ke,Ge,Ce,Ae);return ke}function mo(je,Y,oe,fe){const Ae=Y.geometry,Ce=Y.type,ke=[];if(je.minX=Math.min(je.minX,Y.minX),je.minY=Math.min(je.minY,Y.minY),je.maxX=Math.max(je.maxX,Y.maxX),je.maxY=Math.max(je.maxY,Y.maxY),Ce==="Point"||Ce==="MultiPoint")for(let Ge=0;Ge<Ae.length;Ge+=3)ke.push(Ae[Ge],Ae[Ge+1]),je.numPoints++,je.numSimplified++;else if(Ce==="LineString")st(ke,Ae,je,oe,!1,!1);else if(Ce==="MultiLineString"||Ce==="Polygon")for(let Ge=0;Ge<Ae.length;Ge++)st(ke,Ae[Ge],je,oe,Ce==="Polygon",Ge===0);else if(Ce==="MultiPolygon")for(let Ge=0;Ge<Ae.length;Ge++){const Le=Ae[Ge];for(let $e=0;$e<Le.length;$e++)st(ke,Le[$e],je,oe,!0,$e===0)}if(ke.length){let Ge=Y.tags||null;if(Ce==="LineString"&&fe.lineMetrics){Ge={};for(const $e in Y.tags)Ge[$e]=Y.tags[$e];Ge.mapbox_clip_start=Ae.start/Ae.size,Ge.mapbox_clip_end=Ae.end/Ae.size}const Le={geometry:ke,type:Ce==="Polygon"||Ce==="MultiPolygon"?3:Ce==="LineString"||Ce==="MultiLineString"?2:1,tags:Ge};Y.id!==null&&(Le.id=Y.id),je.features.push(Le)}}function st(je,Y,oe,fe,Ae,Ce){const ke=fe*fe;if(fe>0&&Y.size<(Ae?ke:fe))return void(oe.numPoints+=Y.length/3);const Ge=[];for(let Le=0;Le<Y.length;Le+=3)(fe===0||Y[Le+2]>ke)&&(oe.numSimplified++,Ge.push(Y[Le],Y[Le+1])),oe.numPoints++;Ae&&function(Le,$e){let mt=0;for(let nt=0,Ft=Le.length,sn=Ft-2;nt<Ft;sn=nt,nt+=2)mt+=(Le[nt]-Le[sn])*(Le[nt+1]+Le[sn+1]);if(mt>0===$e)for(let nt=0,Ft=Le.length;nt<Ft/2;nt+=2){const sn=Le[nt],Nt=Le[nt+1];Le[nt]=Le[Ft-2-nt],Le[nt+1]=Le[Ft-1-nt],Le[Ft-2-nt]=sn,Le[Ft-1-nt]=Nt}}(Ge,Ce),je.push(Ge)}const Zs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class il{constructor(Y,oe){const fe=(oe=this.options=function(Ce,ke){for(const Ge in ke)Ce[Ge]=ke[Ge];return Ce}(Object.create(Zs),oe)).debug;if(fe&&console.time("preprocess data"),oe.maxZoom<0||oe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(oe.promoteId&&oe.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ae=function(Ce,ke){const Ge=[];if(Ce.type==="FeatureCollection")for(let Le=0;Le<Ce.features.length;Le++)Ws(Ge,Ce.features[Le],ke,Le);else Ws(Ge,Ce.type==="Feature"?Ce:{geometry:Ce},ke);return Ge}(Y,oe);this.tiles={},this.tileCoords=[],fe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",oe.indexMaxZoom,oe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ae=function(Ce,ke){const Ge=ke.buffer/ke.extent;let Le=Ce;const $e=qs(Ce,1,-1-Ge,Ge,0,-1,2,ke),mt=qs(Ce,1,1-Ge,2+Ge,0,-1,2,ke);return($e||mt)&&(Le=qs(Ce,1,-Ge,1+Ge,0,-1,2,ke)||[],$e&&(Le=Oi($e,1).concat(Le)),mt&&(Le=Le.concat(Oi(mt,-1)))),Le}(Ae,oe),Ae.length&&this.splitTile(Ae,0,0,0),fe&&(Ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,oe,fe,Ae,Ce,ke,Ge){const Le=[Y,oe,fe,Ae],$e=this.options,mt=$e.debug;for(;Le.length;){Ae=Le.pop(),fe=Le.pop(),oe=Le.pop(),Y=Le.pop();const nt=1<<oe,Ft=js(oe,fe,Ae);let sn=this.tiles[Ft];if(!sn&&(mt>1&&console.time("creation"),sn=this.tiles[Ft]=tr(Y,oe,fe,Ae,$e),this.tileCoords.push({z:oe,x:fe,y:Ae}),mt)){mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",oe,fe,Ae,sn.numFeatures,sn.numPoints,sn.numSimplified),console.timeEnd("creation"));const ai=`z${oe}`;this.stats[ai]=(this.stats[ai]||0)+1,this.total++}if(sn.source=Y,Ce==null){if(oe===$e.indexMaxZoom||sn.numPoints<=$e.indexMaxPoints)continue}else{if(oe===$e.maxZoom||oe===Ce)continue;if(Ce!=null){const ai=Ce-oe;if(fe!==ke>>ai||Ae!==Ge>>ai)continue}}if(sn.source=null,Y.length===0)continue;mt>1&&console.time("clipping");const Nt=.5*$e.buffer/$e.extent,kn=.5-Nt,Pn=.5+Nt,In=1+Nt;let ei=null,br=null,$r=null,Cr=null,Xr=qs(Y,nt,fe-Nt,fe+Pn,0,sn.minX,sn.maxX,$e),gr=qs(Y,nt,fe+kn,fe+In,0,sn.minX,sn.maxX,$e);Y=null,Xr&&(ei=qs(Xr,nt,Ae-Nt,Ae+Pn,1,sn.minY,sn.maxY,$e),br=qs(Xr,nt,Ae+kn,Ae+In,1,sn.minY,sn.maxY,$e),Xr=null),gr&&($r=qs(gr,nt,Ae-Nt,Ae+Pn,1,sn.minY,sn.maxY,$e),Cr=qs(gr,nt,Ae+kn,Ae+In,1,sn.minY,sn.maxY,$e),gr=null),mt>1&&console.timeEnd("clipping"),Le.push(ei||[],oe+1,2*fe,2*Ae),Le.push(br||[],oe+1,2*fe,2*Ae+1),Le.push($r||[],oe+1,2*fe+1,2*Ae),Le.push(Cr||[],oe+1,2*fe+1,2*Ae+1)}}getTile(Y,oe,fe){Y=+Y,oe=+oe,fe=+fe;const Ae=this.options,{extent:Ce,debug:ke}=Ae;if(Y<0||Y>24)return null;const Ge=1<<Y,Le=js(Y,oe=oe+Ge&Ge-1,fe);if(this.tiles[Le])return gi(this.tiles[Le],Ce);ke>1&&console.log("drilling down to z%d-%d-%d",Y,oe,fe);let $e,mt=Y,nt=oe,Ft=fe;for(;!$e&&mt>0;)mt--,nt>>=1,Ft>>=1,$e=this.tiles[js(mt,nt,Ft)];return $e&&$e.source?(ke>1&&(console.log("found parent tile z%d-%d-%d",mt,nt,Ft),console.time("drilling down")),this.splitTile($e.source,mt,nt,Ft,Y,oe,fe),ke>1&&console.timeEnd("drilling down"),this.tiles[Le]?gi(this.tiles[Le],Ce):null):null}}function js(je,Y,oe){return 32*((1<<je)*oe+Y)+je}function $n(je,Y){const oe=je.tileID.canonical;if(!this._geoJSONIndex)return void Y(null,null);const fe=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!fe)return void Y(null,null);const Ae=$e=>$e.tags&&"3d_elevation_id"in $e.tags&&"source"in $e.tags&&$e.tags.source==="elevation",Ce=fe.features.filter($e=>Ae($e));let ke={_geojsonTileLayer:fe.features};Ce.length>0&&(ke={_geojsonTileLayer:fe.features.filter($e=>!Ae($e)),hd_road_elevation:Ce});const Ge=new Kt(ke),Le=function($e){const mt=new o.bt;for(const nt of Object.keys($e))mt.writeMessage(3,Sr,{name:nt,features:$e[nt]});return mt.finish()}(ke).buffer;Y(null,{vectorTile:Ge,rawData:Le})}class io extends ze{constructor(Y,oe,fe,Ae,Ce,ke,Ge){super(Y,oe,fe,Ae,Ce,$n,Ge),ke&&(this.loadGeoJSON=ke),this._dynamicIndex=new Ke}loadData(Y,oe){const fe=Y&&Y.request,Ae=fe&&fe.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(Y,(Ce,ke)=>{if(Ce||!ke)return oe(Ce);if(typeof ke!="object")return oe(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));{try{if(Y.filter){const Le=o.U(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Le.result==="error")throw new Error(Le.value.map($e=>`${$e.key}: ${$e.message}`).join(", "));ke.features=ke.features.filter($e=>Le.value.evaluate({zoom:0},$e))}Y.dynamic?(ke.type==="Feature"&&(ke={type:"FeatureCollection",features:[ke]}),Y.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ke.features,this.loaded),Y.cluster&&(ke.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Y.cluster?new Sl(function({superclusterOptions:Le,clusterProperties:$e}){if(!$e||!Le)return Le;const mt={},nt={},Ft={accumulated:null,zoom:0},sn={properties:null},Nt=Object.keys($e);for(const kn of Nt){const[Pn,In]=$e[kn],ei=o.U(In),br=o.U(typeof Pn=="string"?[Pn,["accumulated"],["get",kn]]:Pn);mt[kn]=ei.value,nt[kn]=br.value}return Le.map=kn=>{sn.properties=kn;const Pn={};for(const In of Nt)Pn[In]=mt[In].evaluate(Ft,sn);return Pn},Le.reduce=(kn,Pn)=>{sn.properties=Pn;for(const In of Nt)Ft.accumulated=kn[In],kn[In]=nt[In].evaluate(Ft,sn)},Le}(Y)).load(ke.features):Y.dynamic?this._dynamicIndex:function(Le,$e){return new il(Le,$e)}(ke,Y.geojsonVtOptions)}catch(Le){return oe(Le)}const Ge={};if(Ae){const Le=I(fe);Le&&(Ge.resourceTiming={},Ge.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Le)))}oe(null,Ge)}})}reloadTile(Y,oe){const fe=this.loaded;return fe&&fe[Y.uid]?Y.partial?oe(null,void 0):super.reloadTile(Y,oe):this.loadTile(Y,oe)}loadGeoJSON(Y,oe){if(Y.request)o.m(Y.request,oe);else{if(typeof Y.data!="string")return oe(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return oe(null,JSON.parse(Y.data))}catch{return oe(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(Y,oe){try{oe(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(fe){oe(fe)}}getClusterChildren(Y,oe){try{oe(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(fe){oe(fe)}}getClusterLeaves(Y,oe){try{oe(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(fe){oe(fe)}}}class fv{constructor(Y,oe,fe){this.tileID=new o.aQ(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Y.projection,this.brightness=oe,this.worldview=fe}parse(Y,oe,fe,Ae){this.status="parsing";const Ce=new o.aQ(fe.tileID.overscaledZ,fe.tileID.wrap,fe.tileID.canonical.z,fe.tileID.canonical.x,fe.tileID.canonical.y),ke=[],Ge=oe.familiesBySource[fe.source],Le=new o.fn(Ce,fe.promoteId);Le.bucketLayerIDs=[],Le.is3DTile=!0,o.fC(Y).then($e=>{if(!$e)return Ae(new Error("Could not parse tile"));const mt=$e.json.extensionsUsed&&$e.json.extensionsUsed.includes("MAPBOX_mesh_features")||$e.json.asset.extras&&$e.json.asset.extras.MAPBOX_mesh_features,nt=$e.json.extensionsUsed&&$e.json.extensionsUsed.includes("EXT_meshopt_compression"),Ft=new o.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const sn in Ge)for(const Nt of Ge[sn]){const kn=Nt[0];Le.bucketLayerIDs.push(Nt.map(ei=>o.B(ei.id,ei.scope))),kn.recalculate(Ft,[]);const Pn=o.fD($e,1/o.d7(fe.tileID.canonical)),In=new o.fE(Nt,Pn,Ce,mt,nt,this.brightness,Le,this.worldview);mt||(In.needsUpload=!0),ke.push(In),In.evaluate(kn)}this.status="done",Ae(null,{buckets:ke,featureIndex:Le,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch($e=>Ae(new Error($e.message)))}}class rd{constructor(Y,oe,fe,Ae,Ce,ke,Ge,Le){this.actor=Y,this.layerIndex=oe,this.availableImages=fe,this.availableModels=Ae,this.brightness=Ge,this.loading={},this.loaded={},this.worldview=Le}loadTile(Y,oe){const fe=Y.uid,Ae=this.loading[fe]=new fv(Y,this.brightness,this.worldview);o.bu(Y.request,(Ce,ke)=>{const Ge=!this.loading[fe];return delete this.loading[fe],Ge||Ce?(Ae.status="done",Ge||(this.loaded[fe]=Ae),oe(Ce)):ke&&ke.byteLength!==0?void Ae.parse(ke,this.layerIndex,Y,(Le,$e)=>{Ae.status="done",this.loaded=this.loaded||{},this.loaded[fe]=Ae,Le||!$e?oe(Le):oe(null,$e)}):(Ae.status="done",this.loaded[fe]=Ae,oe())})}reloadTile(Y,oe){const fe=this.loaded,Ae=Y.uid;if(fe&&fe[Ae]){const Ce=fe[Ae];Ce.projection=Y.projection,Ce.brightness=Y.brightness;const ke=(Ge,Le)=>{Ce.reloadCallback&&(delete Ce.reloadCallback,this.loadTile(Y,oe)),oe(Ge,Le)};Ce.status==="parsing"?Ce.reloadCallback=ke:Ce.status==="done"&&this.loadTile(Y,oe)}}abortTile(Y,oe){const fe=Y.uid;this.loading[fe]&&delete this.loading[fe],oe()}removeTile(Y,oe){const fe=this.loaded,Ae=Y.uid;fe&&fe[Ae]&&delete fe[Ae],oe()}}class ep{constructor(Y){this.self=Y,this.actor=new o.fG(Y,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.cm({name:"mercator"}),this.workerSourceTypes={vector:ze,geojson:io,"raster-dem":Be,"raster-array":Et,"batched-model":rd},this.workerSources={},this.self.registerWorkerSource=(oe,fe)=>{if(this.workerSourceTypes[oe])throw new Error(`Worker source with name "${oe}" already registered.`);this.workerSourceTypes[oe]=fe},this.self.registerRTLTextPlugin=oe=>{if(o.fH.isParsed())throw new Error("RTL text plugin already registered.");o.fH.setState({pluginStatus:o.fI.parsed,pluginURL:o.fH.getPluginURL()}),o.fH.applyArabicShaping=oe.applyArabicShaping,o.fH.processBidirectionalText=oe.processBidirectionalText,o.fH.processStyledBidirectionalText=oe.processStyledBidirectionalText;for(const fe of this.rtlPluginParsingListeners)fe(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(Y,oe,fe){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.availableModels[Y],delete this.workerSources[Y],fe()}checkIfReady(Y,oe,fe){fe()}setReferrer(Y,oe){this.referrer=oe}spriteLoaded(Y,oe){this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={});const{scope:fe,isLoaded:Ae}=oe;if(this.isSpriteLoaded[Y][fe]=Ae,this.workerSources[Y]&&this.workerSources[Y][fe])for(const Ce in this.workerSources[Y][fe]){const ke=this.workerSources[Y][fe][Ce];for(const Ge in ke){const Le=ke[Ge];Le instanceof ze&&(Le.isSpriteLoaded=Ae,Le.fire(new o.z("isSpriteLoaded")))}}}setImages(Y,oe,fe){this.availableImages[Y]||(this.availableImages[Y]={});const{scope:Ae,images:Ce}=oe;if(this.availableImages[Y][Ae]=Ce,this.workerSources[Y]&&this.workerSources[Y][Ae]){for(const ke in this.workerSources[Y][Ae]){const Ge=this.workerSources[Y][Ae][ke];for(const Le in Ge)Ge[Le].availableImages=Ce}fe()}else fe()}setModels(Y,{scope:oe,models:fe},Ae){if(this.availableModels[Y]||(this.availableModels[Y]={}),this.availableModels[Y][oe]=fe,this.workerSources[Y]&&this.workerSources[Y][oe]){for(const Ce in this.workerSources[Y][oe]){const ke=this.workerSources[Y][oe][Ce];for(const Ge in ke)ke[Ge].availableModels=fe}Ae()}else Ae()}setProjection(Y,oe){this.projections[Y]=o.cm(oe)}setBrightness(Y,oe,fe){this.brightness=oe,fe()}setWorldview(Y,oe,fe){this.worldview=oe,fe()}setLayers(Y,oe,fe){this.getLayerIndex(Y,oe.scope).replace(oe.layers,oe.options),fe()}updateLayers(Y,oe,fe){this.getLayerIndex(Y,oe.scope).update(oe.layers,oe.removedIds,oe.options),fe()}loadTile(Y,oe,fe){oe.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,oe.type,oe.source,oe.scope).loadTile(oe,fe)}decodeRasterArray(Y,oe,fe){this.getWorkerSource(Y,oe.type,oe.source,oe.scope).decodeRasterArray(oe,fe)}reloadTile(Y,oe,fe){oe.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,oe.type,oe.source,oe.scope).reloadTile(oe,fe)}abortTile(Y,oe,fe){this.getWorkerSource(Y,oe.type,oe.source,oe.scope).abortTile(oe,fe)}removeTile(Y,oe,fe){this.getWorkerSource(Y,oe.type,oe.source,oe.scope).removeTile(oe,fe)}removeSource(Y,oe,fe){if(!(this.workerSources[Y]&&this.workerSources[Y][oe.scope]&&this.workerSources[Y][oe.scope][oe.type]&&this.workerSources[Y][oe.scope][oe.type][oe.source]))return;const Ae=this.workerSources[Y][oe.scope][oe.type][oe.source];delete this.workerSources[Y][oe.scope][oe.type][oe.source],Ae.removeSource!==void 0?Ae.removeSource(oe,fe):fe()}loadWorkerSource(Y,oe,fe){try{this.self.importScripts(oe.url),fe()}catch(Ae){fe(Ae)}}syncRTLPluginState(Y,oe,fe){if(o.fH.isParsed())fe(null,!0);else if(o.fH.isParsing())this.rtlPluginParsingListeners.push(fe);else try{o.fH.setState(oe);const Ae=o.fH.getPluginURL();!o.fH.isLoaded()||o.fH.isParsed()||o.fH.isParsing()||Ae==null||(o.fH.setState({pluginStatus:o.fI.parsing,pluginURL:o.fH.getPluginURL()}),this.self.importScripts(Ae),o.fH.isParsed()?fe(null,!0):this.rtlPluginParsingListeners.push(fe))}catch(Ae){fe(Ae)}}setDracoUrl(Y,oe){this.dracoUrl=oe}getAvailableImages(Y,oe){this.availableImages[Y]||(this.availableImages[Y]={});let fe=this.availableImages[Y][oe];return fe||(fe=[]),fe}getAvailableModels(Y,oe){this.availableModels[Y]||(this.availableModels[Y]={});let fe=this.availableModels[Y][oe];return fe||(fe={}),fe}getLayerIndex(Y,oe){this.layerIndexes[Y]||(this.layerIndexes[Y]={});let fe=this.layerIndexes[Y][oe];return fe||(fe=this.layerIndexes[Y][oe]=new F,fe.scope=oe),fe}getWorkerSource(Y,oe,fe,Ae){const Ce=this.workerSources;return Ce[Y]||(Ce[Y]={}),Ce[Y][Ae]||(Ce[Y][Ae]={}),Ce[Y][Ae][oe]||(Ce[Y][Ae][oe]={}),this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),Ce[Y][Ae][oe][fe]||(Ce[Y][Ae][oe][fe]=new this.workerSourceTypes[oe]({send:(ke,Ge,Le,$e,mt,nt)=>this.actor.send(ke,Ge,Le,Y,mt,nt),scheduler:this.actor.scheduler},this.getLayerIndex(Y,Ae),this.getAvailableImages(Y,Ae),this.getAvailableModels(Y,Ae),this.isSpriteLoaded[Y][Ae],void 0,this.brightness,this.worldview)),Ce[Y][Ae][oe][fe]}rasterizeImagesWorker(Y,oe,fe){const Ae=new Map;for(const[Ce,{image:ke,imageVariant:Ge}]of oe.tasks.entries()){const Le=this.imageRasterizer.rasterize(Ge,ke,oe.scope,Y);Ae.set(Ce,Le)}fe(void 0,Ae)}removeRasterizedImages(Y,oe,fe){this.imageRasterizer.removeImagesFromCacheByIds(oe.imageIds,oe.scope,Y),fe()}enforceCacheSizeLimit(Y,oe){o.fJ(oe)}getWorkerPerformanceMetrics(Y,oe,fe){fe(void 0,void 0)}}return o.fF(self)&&(self.worker=new ep(self)),ep}),m(["./shared"],function(o){var I="3.17.0";const A={create:"create",load:"load",fullLoad:"fullLoad"},N={mark(f){performance.mark(f)},measure(f,r,c){performance.measure(f,r,c)}};function F(f){const r=f.name.split("?")[0];return o.a(r)&&r.includes("mapbox-gl.js")?"javascript":o.a(r)&&r.includes("mapbox-gl.css")?"css":o.b(r)?"fontRange":o.c(r)?"sprite":o.i(r)?"style":o.d(r)?"tilejson":"other"}var z,$={},J=function(){if(z)return $;function f(p){return!r(p)}function r(p){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,w,S=new Blob([""],{type:"text/javascript"}),P=URL.createObjectURL(S);try{w=new Worker(P),b=!0}catch{b=!1}return w&&w.terminate(),URL.revokeObjectURL(P),b}()?function(){var b=document.createElement("canvas");b.width=b.height=1;var w=b.getContext("2d");if(!w)return!1;var S=w.getImageData(0,0,1,1);return S&&S.width===b.width}()?(c[y=p&&p.failIfMajorPerformanceCaveat]===void 0&&(c[y]=function(b){var w,S=function(P){var k=document.createElement("canvas"),L=Object.create(f.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=P,k.getContext("webgl2",L)}(b);if(!S)return!1;try{w=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!w||S.isContextLost())&&(S.shaderSource(w,"void main() {}"),S.compileShader(w),S.getShaderParameter(w,S.COMPILE_STATUS)===!0)}(y)),c[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}z=1,$.supported=f,$.notSupportedReason=r;var c={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},$}();function H(f,r,c){const p=document.createElement(f);return r!=null&&(p.className=r),c&&c.appendChild(p),p}function re(f,r,c){const p=document.createElementNS("http://www.w3.org/2000/svg",f);for(const y of Object.keys(r))p.setAttributeNS(null,y,String(r[y]));return c&&c.appendChild(p),p}const Q=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ee=Q&&Q.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ie;function ue(){Q&&ee&&(ie=Q[ee],Q[ee]="none")}function xe(){Q&&ee&&(Q[ee]=ie)}function Oe(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",Oe,!0)}function ze(){window.addEventListener("click",Oe,!0),window.setTimeout(()=>{window.removeEventListener("click",Oe,!0)},0)}function Be(f,r){const c=f.getBoundingClientRect();return Zt(f,c,r)}function ot(f,r){const c=f.getBoundingClientRect(),p=[];for(let y=0;y<r.length;y++)p.push(Zt(f,c,r[y]));return p}function Et(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function Zt(f,r,c){const p=f.offsetWidth===r.width?1:f.offsetWidth/r.width;return new o.P((c.clientX-r.left)*p,(c.clientY-r.top)*p)}const at="01",zt="NO_ACCESS_TOKEN";class Kt{constructor(r,c,p){this._transformRequestFn=r,this._customAccessToken=c,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const r=function(){let c="";for(let p=0;p<10;p++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",at,c].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,c){return this._transformRequestFn&&this._transformRequestFn(r,c)||{url:r}}normalizeStyleURL(r,c){if(!o.h(r))return r;const p=Wt(r);return p.params.push(`sdk=js-${I}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeGlyphsURL(r,c){if(!o.h(r))return r;const p=Wt(r);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeModelURL(r,c){if(!o.h(r))return r;const p=Wt(r);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeSourceURL(r,c,p,y){if(!o.h(r))return r;const b=Wt(r);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),p&&b.params.push(`language=${p}`),y&&b.params.push(`worldview=${y}`),this._makeAPIURL(b,this._customAccessToken||c)}normalizeIconsetURL(r,c){const p=Wt(r);return o.h(r)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||c)):Ke(p)}normalizeSpriteURL(r,c,p,y){const b=Wt(r);return o.h(r)?(b.path=`/styles/v1${b.path}/sprite${c}${p}`,this._makeAPIURL(b,this._customAccessToken||y)):(b.path+=`${c}${p}`,Ke(b))}normalizeTileURL(r,c,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!o.h(r))return r;const y=Wt(r);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||p&&y.authority!=="raster"&&p===512?"@2x":""}${o.k.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${o.e.RASTER_URL_PREFIX}${y.path}`:y.authority==="rasterarrays"?y.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${y.path}`:y.authority==="3dtiles"?y.path=`/${o.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${o.e.TILE_URL_VERSION}${y.path}`);const b=this._customAccessToken||function(w){for(const S of w){const P=S.match(/^access_token=(.*)$/);if(P)return P[1]}return null}(y.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,b)}canonicalizeTileURL(r,c){const p=Wt(r);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return r;let y="mapbox://";p.path.match(/^\/raster\/v1\//)?y+=`raster/${p.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${p.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${p.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let b=p.params;return c&&(b=b.filter(w=>!w.match(/^access_token=/))),b.length&&(y+=`?${b.join("&")}`),y}canonicalizeTileset(r,c){const p=!!c&&o.h(c),y=[];for(const b of r.tiles||[])o.j(b)?y.push(this.canonicalizeTileURL(b,p)):y.push(b);return y}_makeAPIURL(r,c){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=Wt(o.e.API_URL);if(r.protocol=y.protocol,r.authority=y.authority,r.protocol==="http"){const b=r.params.indexOf("secure");b>=0&&r.params.splice(b,1)}if(y.path!=="/"&&(r.path=`${y.path}${r.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return Ke(r);if(c=c||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return r.params=r.params.filter(b=>b.indexOf("access_token")===-1),r.params.push(`access_token=${c||""}`),Ke(r)}}const nn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Wt(f){const r=f.match(nn);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Ke(f){const r=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${r}`}const et="mapbox.eventData";function Ct(f){if(!f)return null;const r=f.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(o.l(r[1]))}catch{return null}}class en{constructor(r){this.type=r,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const c=Ct(o.e.ACCESS_TOKEN);let p="";return p=c&&c.u?o.f(c.u):o.e.ACCESS_TOKEN||"",r?`${et}.${r}:${p}`:`${et}:${p}`}fetchEventData(){const r=o.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid"),y=this.getStorageKey("uuidTimestamp");if(r)try{const b=localStorage.getItem(c);b&&(this.eventData=JSON.parse(b));const w=localStorage.getItem(p);w&&(this.anonId=w);const S=localStorage.getItem(y);S&&(this.anonIdTimestamp=Number(S));const P=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<P)&&this.refreshUUID()}catch{o.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=o.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const r=o.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid"),y=this.getStorageKey("uuidTimestamp"),b=this.anonId,w=this.anonIdTimestamp;if(r&&b)try{localStorage.setItem(p,b),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData)),w&&localStorage.setItem(y,w.toString())}catch{o.w("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,c,p,y){if(!o.e.EVENTS_URL)return;const b=Wt(o.e.EVENTS_URL);b.params.push(`access_token=${y||o.e.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(r).toISOString()},S=c?Object.assign(w,c):w,P={url:Ke(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};this.pendingRequest=o.p(P,k=>{this.pendingRequest=null,p(k),this.saveEventData(),this.processRequests(y)})}queueRequest(r,c){this.queue.push(r),this.processRequests(c)}}class Bn extends en{constructor(r){super("metrics"),r&&(this.data=r)}postMetricsEvent(r){if(!o.e.EVENTS_URL||!r&&!o.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID();const c=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:c},r)}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:c,payload:p}=this.queue.shift();this.postEvent(c,p,()=>{},r)}}const En=new class extends en{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,r){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(c=>o.h(c)||o.j(c))&&this.queueRequest(Date.now(),r)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Ct(o.e.ACCESS_TOKEN),c=r?r.u:o.e.ACCESS_TOKEN;let p=c!==this.eventData.tokenU;o.v(this.anonId)||(this.refreshUUID(),p=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),w=new Date(y),S=(y-this.eventData.lastSuccess)/864e5;p=p||S>=1||S<-1||b.getDate()!==w.getDate()}else p=!0;p?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:at,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=y,this.eventData.tokenU=c)},f):this.processRequests()}},gn=En.postTurnstileEvent.bind(En),qt=new class extends en{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,r,c,p){this.skuToken=r,this.errorCb=p,o.e.EVENTS_URL&&(c||o.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},c):this.errorCb(new Error(zt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:c}=this.queue.shift();r&&this.success[r]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID(),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:at,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):r&&(this.success[r]=!0)},f))}remove(){this.errorCb=null}},Ji=qt.postMapLoadEvent.bind(qt),Sr=new class extends en{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let r=this.mapInstanceIdMap.get(f);return r||(r=o.u(),this.mapInstanceIdMap.set(f,r)),r}getEventId(f){const r=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,r+1),r}postStyleLoadEvent(f,r){const{map:c,style:p,importedStyles:y}=r;if(!o.e.EVENTS_URL||!f&&!o.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(c),w={mapInstanceId:b,eventId:this.getEventId(b),style:p};y.length&&(w.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:w},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,payload:c}=this.queue.shift();this.postEvent(r,c,()=>{},f)}},_n=Sr.postStyleLoadEvent.bind(Sr),Rt=new Bn({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),pn=Rt.postMetricsEvent.bind(Rt),Fn=new Bn({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),si=Fn.postMetricsEvent.bind(Fn),$i=new class extends en{constructor(){super("gljs.performance")}postPerformanceEvent(f,r){o.e.EVENTS_URL&&(f||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:c}=this.queue.shift(),p=function(y){const b=performance.getEntriesByType("resource"),w=performance.getEntriesByType("mark"),S=function(U){const Z={};if(U){for(const W in U)if(W!=="other")for(const ne of U[W]){const te=`${W}ResolveRangeMin`,le=`${W}ResolveRangeMax`,he=`${W}RequestCount`,ce=`${W}RequestCachedCount`;Z[te]=Math.min(Z[te]||1/0,ne.startTime),Z[le]=Math.max(Z[le]||-1/0,ne.responseEnd);const Ee=ye=>{Z[ye]===void 0&&(Z[ye]=0),++Z[ye]};ne.transferSize!==void 0&&ne.transferSize===0&&Ee(ce),Ee(he)}}return Z}(function(U,Z){const W={};if(U)for(const ne of U){const te=Z(ne);W[te]===void 0&&(W[te]=[]),W[te].push(ne)}return W}(b,F)),P=window.devicePixelRatio,k=navigator.connection||navigator.mozConnection||navigator.webkitConnection,L=k?k.effectiveType:void 0,V={counters:[],metadata:[],attributes:[]},B=(U,Z,W)=>{W!=null&&U.push({name:Z,value:W.toString()})};for(const U in S)B(V.counters,U,S[U]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(B(V.counters,"interactionRangeMin",y.interactionRange[0]),B(V.counters,"interactionRangeMax",y.interactionRange[1])),w)for(const U of Object.values(A)){const Z=w.find(W=>W.name===U);Z&&B(V.counters,U,Z.startTime)}return B(V.counters,"visibilityHidden",y.visibilityHidden),B(V.attributes,"style",function(U){if(U)for(const Z of U){const W=Z.name.split("?")[0];if(o.i(W)){const ne=W.split("/").slice(-2);if(ne.length===2)return`mapbox://styles/${ne[0]}/${ne[1]}`}}}(b)),B(V.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),B(V.attributes,"fogEnabled",y.fogEnabled?"true":"false"),B(V.attributes,"projection",y.projection),B(V.attributes,"zoom",y.zoom),B(V.metadata,"devicePixelRatio",P),B(V.metadata,"connectionEffectiveType",L),B(V.metadata,"navigatorUserAgent",navigator.userAgent),B(V.metadata,"screenWidth",window.screen.width),B(V.metadata,"screenHeight",window.screen.height),B(V.metadata,"windowWidth",window.innerWidth),B(V.metadata,"windowHeight",window.innerHeight),B(V.metadata,"mapWidth",y.width/P),B(V.metadata,"mapHeight",y.height/P),B(V.metadata,"webglRenderer",y.renderer),B(V.metadata,"webglVendor",y.vendor),B(V.metadata,"sdkVersion",I),B(V.metadata,"sdkIdentifier","mapbox-gl-js"),V}(c);for(const y of p.metadata);for(const y of p.counters);for(const y of p.attributes);this.postEvent(r,p,()=>{},f)}},Mi=$i.postPerformanceEvent.bind($i),Ts=new class extends en{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,r,c,p){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const y=Wt(o.e.API_URL+o.e.SESSION_PATH);y.params.push(`sku=${r||""}`),y.params.push(`access_token=${p||o.e.ACCESS_TOKEN||""}`);const b={url:Ke(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(b,w=>{this.pendingRequest=null,c(w),this.saveEventData(),this.processRequests(p)})}getSessionAPI(f,r,c,p){this.skuToken=r,this.errorCb=p,o.e.SESSION_PATH&&o.e.API_URL&&(c||o.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},c):this.errorCb(new Error(zt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:c}=this.queue.shift();r&&this.success[r]||this.getSession(c,this.skuToken,p=>{p?this.errorCb(p):r&&(this.success[r]=!0)},f)}remove(){this.errorCb=null}},fo=Ts.getSessionAPI.bind(Ts),ls=new Set;function Kr(f,r){r?ls.add(f):ls.delete(f)}class xr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,c){this._updatedSourceCaches[r]=c,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){const c=r.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(r.id),this.setDirty()}removeLayer(r){const c=r.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][r.id]=r,this._updatedLayers[c].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){const r={};for(const c in this._updatedLayers)r[c]=r[c]||{},r[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)r[c]=r[c]||{},r[c].removedIds=Object.keys(this._removedLayers[c]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(r){return this._updatedImages[r]?Array.from(this._updatedImages[r].values()):[]}updateImage(r,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(o.I.toString(r)),this.setDirty()}resetUpdatedImages(r){this._updatedImages[r]&&this._updatedImages[r].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Sl(f){const{userImage:r}=f;return!!(r&&r.render&&r.render())&&(f.data.replace(new Uint8Array(r.data.buffer)),!0)}class sc extends o.E{constructor(r){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=r,r!=="raster"&&o.r()&&(this.imageRasterizerDispatcher=new o.D(o.t(),this,"Image Rasterizer Worker",1))}addScope(r){this.loaded.set(r,!1),this.imageProviders.set(r,new Map),this.images.set(r,new Map),this.updatedImages.set(r,new Set),this.callbackDispatchedThisFrame.set(r,new Set),this.patterns.set(r,new Map),this.atlasImage.set(r,new o.q({width:1,height:1}))}removeScope(r){this.loaded.delete(r),this.imageProviders.delete(r),this.images.delete(r),this.updatedImages.delete(r),this.callbackDispatchedThisFrame.delete(r),this.patterns.delete(r),this.atlasImage.delete(r);const c=this.atlasTexture.get(r);c&&(c.destroy(),this.atlasTexture.delete(r))}addImageProvider(r,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(r.id,r)}removeImageProvider(r,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(r)}getPendingImageProviders(){const r=[];for(const c of this.imageProviders.values())for(const p of c.values())p.hasPendingRequests()&&r.push(p);return r}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.x),this._imageRasterizer}isLoaded(){for(const r of this.loaded.keys())if(!this.loaded.get(r))return!1;return!0}setLoaded(r,c){if(this.loaded.get(c)!==r&&(this.loaded.set(c,r),r)){for(const{ids:p,callback:y}of this.requestors)this._notify(p,c,y);this.requestors=[]}}hasImage(r,c){return!!this.getImage(r,c)}getImage(r,c){return this.images.get(c).get(r.toString())}addImage(r,c,p){this._validate(r,p)&&this.images.get(c).set(r.toString(),p)}_validate(r,c){let p=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new o.y(new Error(`Image "${r.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new o.y(new Error(`Image "${r.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(c.content,c)||(this.fire(new o.y(new Error(`Image "${r.name}" has invalid "content" value`))),p=!1),p}_validateStretch(r,c){if(!r)return!0;let p=0;for(const y of r){if(y[0]<p||y[1]<y[0]||c<y[1])return!1;p=y[1]}return!0}_validateContent(r,c){return r?r.length!==4||!c.usvg&&(r[0]<0||c.data.width<r[0]||r[1]<0||c.data.height<r[1]||r[2]<0||c.data.width<r[2]||r[3]<0||c.data.height<r[3])?!1:!(r[2]<r[0]||r[3]<r[1]):!0}updateImage(r,c,p){const y=this.images.get(c).get(r.toString());p.version=y.version+1,this.images.get(c).set(r.toString(),p),this.updatedImages.get(c).add(r),this.removeFromImageRasterizerCache(r,c)}clearUpdatedImages(r){this.updatedImages.get(r).clear()}removeFromImageRasterizerCache(r,c){this.spriteFormat!=="raster"&&(o.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[r],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([r],c))}removeImage(r,c){const p=this.images.get(c),y=p.get(r.toString());p.delete(r.toString()),this.patterns.get(c).delete(r.toString()),this.removeFromImageRasterizerCache(r,c),y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(r){return Array.from(this.images.get(r).keys()).map(c=>o.I.from(c))}getImages(r,c,p){const y=[],b=[],w=this.imageProviders.get(c);for(const L of r){if(!L.iconsetId){y.push(L);continue}const V=w.get(L.iconsetId);V&&(this.getImage(L,c)?b.push(L):V.addPendingRequest(L))}if(y.length===0)return void this._notify(b,c,p);let S=!0;const P=!!this.loaded.get(c),k=this.images.get(c);if(!P)for(const L of y)k.has(L.toString())||(S=!1);P||S?this._notify(y,c,p):this.requestors.push({ids:y,scope:c,callback:p})}rasterizeImages(r,c){const p=new Map,{tasks:y,scope:b}=r;for(const[w,S]of y.entries()){const P=this.getImage(S.id,b);P&&p.set(w,{image:P,imageVariant:S})}this._rasterizeImages(b,p,c)}_rasterizeImages(r,c,p){if(o.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:r},p);else{const y=new Map;for(const[b,{image:w,imageVariant:S}]of c.entries())y.set(b,this.imageRasterizer.rasterize(S,w,r,0));p(void 0,y)}}getUpdatedImages(r){return this.updatedImages.get(r)||new Set}_notify(r,c,p){const y=this.images.get(c),b=new Map;for(const w of r){if(!y.get(w.toString())){if(w.iconsetId)continue;this.fire(new o.z("styleimagemissing",{id:w.name}))}const S=y.get(w.toString());if(!S){o.w(`Image "${w.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const P={data:S.usvg?null:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,usvg:S.usvg,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)};S.usvg&&Object.assign(P,{width:S.icon.usvg_tree.width,height:S.icon.usvg_tree.height}),b.set(o.I.toString(w),P)}p(null,b)}getPixelSize(r){const{width:c,height:p}=this.atlasImage.get(r);return{width:c,height:p}}getPattern(r,c,p){const y=r.toString(),b=this.patterns.get(c),w=b.get(y),S=this.getImage(r,c);if(!S)return null;if(w){if(w.position.version===S.version)return w.position;w.position.version=S.version}else{if(S.usvg&&!S.data){const P=this.getPatternInFlightId(y,c);if(this.patternsInFlight.has(P))return null;this.patternsInFlight.add(P);const k=new o.A(r).scaleSelf(o.o.devicePixelRatio),L=new Map([[k.toString(),{image:S,imageVariant:k}]]);return this._rasterizeImages(c,L,(V,B)=>this.storePatternImage(k,c,S,p,B)),null}this.storePattern(r,c,S)}return this._updatePatternAtlas(c,p),b.get(y).position}getPatternInFlightId(r,c){return o.B(r,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(r,c,p,y,b){const w=r.toString(),S=b?b.get(w):void 0;S&&(p.data=S,this.storePattern(r.id,c,p),this._updatePatternAtlas(c,y),this.patternsInFlight.delete(this.getPatternInFlightId(r.id.toString(),c)))}storePattern(r,c,p){const y={w:p.data.width+2*o.C,h:p.data.height+2*o.C,x:0,y:0},b=new o.F(y,p,o.C);this.patterns.get(c).set(r.toString(),{bin:y,position:b})}destroyAtlasTextures(){for(const r of this.atlasTexture.values())r&&r.destroy();this.atlasTexture.clear()}bind(r,c){const p=r.gl;let y=this.atlasTexture.get(c);y?this.dirty&&(y.update(this.atlasImage.get(c)),this.dirty=!1):(y=new o.T(r,this.atlasImage.get(c),p.RGBA8),this.atlasTexture.set(c,y)),y.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(r,c){const p=this.patterns.get(r),y=Array.from(p.values()).map(({bin:k})=>k),{w:b,h:w}=o.G(y),S=this.atlasImage.get(r);S.resize({width:b||1,height:w||1});const P=this.images.get(r);for(const[k,{bin:L,position:V}]of p.entries()){let B=V.padding;const U=L.x+B,Z=L.y+B,W=P.get(k).data,ne=W.width,te=W.height;B=B>1?B-1:B,o.q.copy(W,S,{x:0,y:0},{x:U,y:Z},{width:ne,height:te},c),o.q.copy(W,S,{x:0,y:te-B},{x:U,y:Z-B},{width:ne,height:B},c),o.q.copy(W,S,{x:0,y:0},{x:U,y:Z+te},{width:ne,height:B},c),o.q.copy(W,S,{x:ne-B,y:0},{x:U-B,y:Z},{width:B,height:te},c),o.q.copy(W,S,{x:0,y:0},{x:U+ne,y:Z},{width:B,height:te},c),o.q.copy(W,S,{x:ne-B,y:te-B},{x:U-B,y:Z-B},{width:B,height:B},c),o.q.copy(W,S,{x:0,y:te-B},{x:U+ne,y:Z-B},{width:B,height:B},c),o.q.copy(W,S,{x:0,y:0},{x:U+ne,y:Z+te},{width:B,height:B},c),o.q.copy(W,S,{x:ne-B,y:0},{x:U-B,y:Z+te},{width:B,height:B},c)}this.dirty=!0}beginFrame(){for(const r of this.images.keys())this.callbackDispatchedThisFrame.set(r,new Set)}dispatchRenderCallbacks(r,c){const p=this.images.get(c);for(const y of r){if(this.callbackDispatchedThisFrame.get(c).has(y.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(y.toString());const b=p.get(y.toString());Sl(b)&&this.updateImage(y,c,b)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function na(f){const r=f.value,c=f.valueSpec,p=f.style,y=f.styleSpec,b=f.key,w=f.arrayElementValidator||Oi;if(!Array.isArray(r))return[new o.V(b,r,`array expected, ${o.K(r)} found`)];if(c.length&&r.length!==c.length)return[new o.V(b,r,`array length ${c.length} expected, length ${r.length} found`)];if(c["min-length"]&&r.length<c["min-length"])return[new o.V(b,r,`array length at least ${c["min-length"]} expected, length ${r.length} found`)];let S={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};y.$version<7&&(S.function=c.function),o.H(c.value)&&(S=c.value);let P=[];for(let k=0;k<r.length;k++)P=P.concat(w({array:r,arrayIndex:k,value:r[k],valueSpec:S,style:p,styleSpec:y,key:`${b}[${k}]`},!0));return P}function Ja(f){const r=f.key,c=f.value,p=f.valueSpec;if(!o.L(c))return[new o.V(r,c,`number expected, ${o.K(c)} found`)];if(c!=c)return[new o.V(r,c,"number expected, NaN found")];if("minimum"in p){let y=p.minimum;if(Array.isArray(p.minimum)&&(y=p.minimum[f.arrayIndex]),c<y)return[new o.V(r,c,`${c} is less than the minimum value ${y}`)]}if("maximum"in p){let y=p.maximum;if(Array.isArray(p.maximum)&&(y=p.maximum[f.arrayIndex]),c>y)return[new o.V(r,c,`${c} is greater than the maximum value ${y}`)]}return[]}function po(f){const r=f.key,c=f.value;if(!o.H(c))return[new o.V(r,c,`object expected, ${o.K(c)} found`)];const p=f.valueSpec,y=o.J(c.type);let b,w,S,P={};const k=y!=="categorical"&&c.property===void 0,L=!k,V=function(W){const ne=W.stops;return Array.isArray(ne)&&Array.isArray(ne[0])&&o.H(ne[0][0])}(c),B=ms({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(W){if(y==="identity")return[new o.V(W.key,W.value,'identity function may not have a "stops" property')];let ne=[];const te=W.value;return ne=ne.concat(na({key:W.key,value:te,valueSpec:W.valueSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:U})),Array.isArray(te)&&te.length===0&&ne.push(new o.V(W.key,te,"array must have at least one stop")),ne},default:function(W){return Oi({key:W.key,value:W.value,valueSpec:p,style:W.style,styleSpec:W.styleSpec})}}});return y==="identity"&&k&&B.push(new o.V(f.key,f.value,'missing required property "property"')),y==="identity"||c.stops||B.push(new o.V(f.key,f.value,'missing required property "stops"')),y==="exponential"&&p.expression&&!o.M(p)&&B.push(new o.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(L&&!o.N(p)?B.push(new o.V(f.key,f.value,"property functions not supported")):k&&!o.O(p)&&B.push(new o.V(f.key,f.value,"zoom functions not supported"))),y!=="categorical"&&!V||c.property!==void 0||B.push(new o.V(f.key,f.value,'"property" property is required')),B;function U(W){let ne=[];const te=W.value,le=W.key;if(!Array.isArray(te))return[new o.V(le,te,`array expected, ${o.K(te)} found`)];if(te.length!==2)return[new o.V(le,te,`array length 2 expected, length ${te.length} found`)];if(V){if(!o.H(te[0]))return[new o.V(le,te,`object expected, ${o.K(te[0])} found`)];const he=te[0];if(he.zoom===void 0)return[new o.V(le,te,"object stop key must have zoom")];if(he.value===void 0)return[new o.V(le,te,"object stop key must have value")];const ce=o.J(he.zoom);if(typeof ce!="number")return[new o.V(le,he.zoom,"stop zoom values must be numbers")];if(S&&S>ce)return[new o.V(le,he.zoom,"stop zoom values must appear in ascending order")];ce!==S&&(S=ce,w=void 0,P={}),ne=ne.concat(ms({key:`${le}[0]`,value:te[0],valueSpec:{zoom:{}},style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:Ja,value:Z}}))}else ne=ne.concat(Z({key:`${le}[0]`,value:te[0],style:W.style,styleSpec:W.styleSpec},te));return o.Q(o.S(te[1]))?ne.concat([new o.V(`${le}[1]`,te[1],"expressions are not allowed in function stops.")]):ne.concat(Oi({key:`${le}[1]`,value:te[1],valueSpec:p,style:W.style,styleSpec:W.styleSpec}))}function Z(W,ne){const te=o.K(W.value),le=o.J(W.value),he=W.value!==null?W.value:ne;if(b){if(te!==b)return[new o.V(W.key,he,`${te} stop domain type must match previous stop domain type ${b}`)]}else b=te;if(te!=="number"&&te!=="string"&&te!=="boolean"&&typeof le!="number"&&typeof le!="string"&&typeof le!="boolean")return[new o.V(W.key,he,"stop domain value must be a number, string, or boolean")];if(te!=="number"&&y!=="categorical"){let ce=`number expected, ${te} found`;return o.N(p)&&y===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(W.key,he,ce)]}return y!=="categorical"||te!=="number"||typeof le=="number"&&isFinite(le)&&Math.floor(le)===le?y!=="categorical"&&te==="number"&&typeof le=="number"&&typeof w=="number"&&w!==void 0&&le<w?[new o.V(W.key,he,"stop domain values must appear in ascending order")]:(w=le,y==="categorical"&&le in P?[new o.V(W.key,he,"stop domain values must be unique")]:(P[le]=!0,[])):[new o.V(W.key,he,`integer expected, found ${String(le)}`)]}}function ks(f){const r=(f.expressionContext==="property"?o.W:o.U)(o.S(f.value),f.valueSpec);if(r.result==="error")return r.value.map(p=>new o.V(`${f.key}${p.key}`,f.value,p.message));const c=r.value.expression||r.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!c.outputDefined())return[new o.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!o.Z(c))return[new o.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return el(c,f);if(f.expressionContext==="appearance")return zs(c,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!o.X(c,["zoom","feature-state"]))return[new o.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!o.Y(c))return[new o.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function el(f,r){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const y of r.valueSpec.expression.parameters)c.delete(y);if(c.size===0)return[];const p=[];return f instanceof o._&&c.has(f.name)?[new o.V(r.key,r.value,`["${f.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(f.eachChild(y=>{p.push(...el(y,r))}),p)}function zs(f,r){const c=new Set;if(r.valueSpec&&r.valueSpec.expression)for(const y of r.valueSpec.expression.parameters)c.add(y);if(c.size===0)return[];const p=[];return f instanceof o._&&!c.has(f.name)?[new o.V(r.key,r.value,`["${f.name}"] is not an allowed parameter`)]:(f.eachChild(y=>{p.push(...zs(y,r))}),p)}function Hs(f){const r=f.key,c=f.value,p=f.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(o.J(c))===-1&&y.push(new o.V(r,c,`expected one of [${p.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(p.values).indexOf(o.J(c))===-1&&y.push(new o.V(r,c,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(c)} found`)),y}function tl(f){return o.a2(o.S(f.value))?ks(Object.assign({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Ws(f)}function Ws(f){const r=f.value,c=f.key;if(!Array.isArray(r))return[new o.V(c,r,`array expected, ${o.K(r)} found`)];if(r.length<1)return[new o.V(c,r,"filter array must have at least 1 element")];const p=f.styleSpec;let y=Hs({key:`${c}[0]`,value:r[0],valueSpec:p.filter_operator});const b=()=>{r.length>=2&&(o.a0(r[1])||y.push(new o.V(`${c}[1]`,r[1],`string expected, ${o.K(r[1])} found`)));for(let w=2;w<r.length;w++)o.J(r[1])==="$type"?y=y.concat(Hs({key:`${c}[${w}]`,value:r[w],valueSpec:p.geometry_type})):o.a0(r[w])||o.L(r[w])||o.$(r[w])||y.push(new o.V(`${c}[${w}]`,r[w],`string, number, or boolean expected, ${o.K(r[w])} found.`))};switch(o.J(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&o.J(r[1])==="$type"&&y.push(new o.V(c,r,`"$type" cannot be use with operator "${r[0]}"`)),r.length!==3&&y.push(new o.V(c,r,`filter array for operator "${r[0]}" must have 3 elements`)),b();break;case"==":case"!=":r.length!==3&&y.push(new o.V(c,r,`filter array for operator "${r[0]}" must have 3 elements`)),b();break;case"in":case"!in":b();break;case"any":case"all":case"none":for(let w=1;w<r.length;w++)y=y.concat(Ws({key:`${c}[${w}]`,value:r[w],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":r.length!==2?y.push(new o.V(c,r,`filter array for "${r[0]}" operator must have 2 elements`)):o.a0(r[1])||y.push(new o.V(`${c}[1]`,r[1],`string expected, ${o.K(r[1])} found`))}return y}function Ia(f,r){const c=f.key,p=f.style,y=f.layer,b=f.styleSpec,w=f.value,S=f.objectKey,P=b[`${r}_${f.layerType}`];if(!P)return[];const k=S.match(/^(.*)-use-theme$/);if(k&&P[k[1]])return o.Q(o.S(w))?[].concat(Oi({key:c,value:w,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:b,expressionContext:"property",propertyType:r,propertyKey:S})):Oi({key:c,value:w,valueSpec:{type:"string"},style:p,styleSpec:b});const L=S.match(/^(.*)-transition$/);if(r==="paint"&&L&&P[L[1]]&&P[L[1]].transition)return Oi({key:c,value:w,valueSpec:b.transition,style:p,styleSpec:b});const V=f.valueSpec||P[S];if(!V)return[new o.a3(c,w,`unknown property "${S}"`)];let B;if(o.a0(w)&&o.N(V)&&!V.tokens&&(B=/^{([^}]+)}$/.exec(w))){const Z=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new o.V(c,w,`"${S}" does not support interpolation syntax
Use an identity property function instead: ${Z}.`)]}const U=[];if(f.layerType==="symbol")S!=="text-field"||!p||p.glyphs||p.imports||U.push(new o.V(c,w,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&o.a4(o.S(w))&&o.J(w.type)==="identity"&&U.push(new o.V(c,w,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&r==="paint"&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&o.N(V)&&(o.a5(V)||o.O(V))){const Z=o.W(o.S(w),V).value,W="expression"in Z&&Z.expression||"_styleExpression"in Z&&Z._styleExpression&&Z._styleExpression.expression;W&&!o.X(W,["measure-light"])&&(S==="model-emissive-strength"&&o.Y(W)&&o.Z(W)||U.push(new o.V(c,w,`${S} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return U.concat(Oi({key:f.key,value:w,valueSpec:V,style:p,styleSpec:b,expressionContext:"property",propertyType:r,propertyKey:S}))}function oc(f){return Ia(f,"paint")}function Cl(f){return Ia(f,"layout")}function Il(f){let r=[];const c=f.value,p=f.key,y=f.style,b=f.styleSpec;if(!o.H(c))return[new o.V(p,c,"object expected")];c.type||c.ref||r.push(new o.V(p,c,'either "type" or "ref" is required'));let w=o.J(c.type);const S=o.J(c.ref);if(c.id){const P=o.J(c.id);for(let k=0;k<f.arrayIndex;k++){const L=y.layers[k];o.J(L.id)===P&&r.push(new o.V(p,c.id,`duplicate layer id "${P}", previously used at line ${L.id.__line__}`))}}if("ref"in c){let P;["type","source","source-layer","filter","layout"].forEach(k=>{k in c&&r.push(new o.V(p,c[k],`"${k}" is prohibited for ref layers`))}),y.layers.forEach(k=>{o.J(k.id)===S&&(P=k)}),P?P.ref?r.push(new o.V(p,c.ref,"ref cannot reference another ref layer")):w=o.J(P.type):typeof S=="string"&&r.push(new o.V(p,c.ref,`ref layer "${S}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(c.source)if(o.a0(c.source)){const P=y.sources&&y.sources[c.source],k=P&&o.J(P.type);P?k==="vector"&&w==="raster"?r.push(new o.V(p,c.source,`layer "${c.id}" requires a raster source`)):k==="raster"&&w!=="raster"?r.push(new o.V(p,c.source,`layer "${c.id}" requires a vector source`)):k!=="vector"||c["source-layer"]?k==="raster-dem"&&w!=="hillshade"?r.push(new o.V(p,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):k!=="raster-array"||["raster","raster-particle"].includes(w)?w==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&k==="geojson"&&!P.lineMetrics?r.push(new o.V(p,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):w==="raster-particle"&&k!=="raster-array"&&r.push(new o.V(p,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):r.push(new o.V(p,c.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new o.V(p,c,`layer "${c.id}" must specify a "source-layer"`)):r.push(new o.V(p,c.source,`source "${c.source}" not found`))}else r.push(new o.V(`${p}.source`,c.source,'"source" must be a string'));else r.push(new o.V(p,c,'missing required property "source"'));return r=r.concat(ms({key:p,value:c,valueSpec:b.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Oi({key:`${p}.type`,value:c.type,valueSpec:b.layer.type,style:f.style,styleSpec:f.styleSpec,object:c,objectKey:"type"}),filter:P=>tl(Object.assign({layerType:w},P)),layout:P=>ms({layer:c,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":k=>Cl(Object.assign({layerType:w},k))}}),paint:P=>ms({layer:c,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":k=>oc(Object.assign({layerType:w,layer:c},k))}}),appearances(P){const k=na({key:P.key,value:P.value,valueSpec:P.valueSpec,style:P.style,styleSpec:P.styleSpec,arrayElementValidator:B=>function(U){const{key:Z,layer:W,layerType:ne}=U,te=o.J(U.value),le=o.J(te.name),he=o.J(te.condition),ce=ms({key:Z,value:te,valueSpec:U.styleSpec.appearance,style:U.style,styleSpec:U.styleSpec,objectElementValidators:{condition:Ee=>function(ye){const we=[];return we.push(...ks({key:ye.key,value:ye.object.condition,valueSpec:o.a6.appearance.condition,expressionContext:"appearance"})),we}(Object.assign({layer:W,layerType:ne},Ee)),properties:Ee=>function(ye){const we=[],{styleSpec:_e,layer:pe,layerType:Se}=ye,De=_e[`paint_${Se}`],Me=_e[`layout_${Se}`],He=ye.object[ye.objectKey];for(const We in He){const tt=We in De?"paint":We in Me?"layout":void 0;if(!tt){we.push(new o.V(ye.key,We,`unknown property "${We}" for layer type "${Se}"`));continue}const gt=Object.assign({},ye,{key:`${ye.key}.${We}`,object:He,objectKey:We,layer:pe,layerType:Se,value:He[We],valueSpec:tt==="paint"?De[We]:Me[We]});we.push(...Ia(gt,tt))}return we}(Object.assign({layer:W,layerType:ne},Ee))}});return le!=="hidden"&&he===void 0&&ce.push(new o.V(U.key,"name",'Appearance with name different than "hidden" must have a condition')),ce}(Object.assign({layerType:w,layer:c},B))}),L=Array.isArray(P.value)?P.value:[],V=new Set;return L.forEach((B,U)=>{const Z=o.J(B.name);if(Z)if(V.has(Z)){const W=o.J(c.id);k.push(new o.V(P.key,Z,`Duplicated appearance name "${Z}" for layer "${W}"`))}else V.add(Z)}),k}}})),r}function jr({key:f,value:r}){return o.a0(r)?[]:[new o.V(f,r,`string expected, ${o.K(r)} found`)]}const qs={promoteId:function f({key:r,value:c}){if(o.a0(c))return jr({key:r,value:c});if(Array.isArray(c)){const y=[],b=o.S(c),w=o.U(b);return w.result==="error"&&w.value.forEach(S=>{y.push(new o.V(`${r}${S.key}`,null,`${S.message}`))}),o.X(w.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||y.push(new o.V(`${r}`,null,"promoteId expression should be only feature dependent")),y}if(!o.H(c))return[new o.V(r,c,`string, expression or object expected, "${o.K(c)}" found`)];const p=[];for(const y in c)p.push(...f({key:`${r}.${y}`,value:c[y]}));return p}};function Aa(f){const r=f.value,c=f.key,p=f.styleSpec,y=f.style;if(!o.H(r))return[new o.V(c,r,`object expected, ${o.K(r)} found`)];if(!("type"in r))return[new o.V(c,r,'"type" is required')];const b=o.J(r.type);let w=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&("url"in r||"tiles"in r||w.push(new o.a3(c,r,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(ms({key:c,value:r,valueSpec:p[`source_${b.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:qs})),w;case"geojson":if(w=ms({key:c,value:r,valueSpec:p.source_geojson,style:y,styleSpec:p,objectElementValidators:qs}),"cluster"in r&&"clusterProperties"in r){if(!o.H(r.clusterProperties))return[new o.V(`${c}.clusterProperties`,r,`object expected, ${o.K(r)} found`)];for(const S in r.clusterProperties){const P=r.clusterProperties[S];if(!Array.isArray(P))return[new o.V(`${c}.clusterProperties.${S}`,P,"array expected")];const[k,L]=P,V=typeof k=="string"?[k,["accumulated"],["get",S]]:k;w.push(...ks({key:`${c}.${S}.map`,value:L,expressionContext:"cluster-map"})),w.push(...ks({key:`${c}.${S}.reduce`,value:V,expressionContext:"cluster-reduce"}))}}return w;case"video":return ms({key:c,value:r,valueSpec:p.source_video,style:y,styleSpec:p});case"image":return ms({key:c,value:r,valueSpec:p.source_image,style:y,styleSpec:p});case"canvas":return[new o.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Hs({key:`${c}.type`,value:r.type,valueSpec:{values:Al(p)}})}}function Al(f){return f.source.reduce((r,c)=>{const p=f[c];return p.type.type==="enum"&&(r=r.concat(Object.keys(p.type.values||{}))),r},[])}function Pa(f){const r=f.value,c=f.styleSpec,p=c.light,y=f.style;if(r===void 0)return[];if(!o.H(r))return[new o.V("light",r,`object expected, ${o.K(r)} found`)];let b=[];for(const w in r){const S=w.match(/^(.*)-transition$/),P=w.match(/^(.*)-use-theme$/);b=b.concat(P&&p[P[1]]?Oi({key:w,value:r[w],valueSpec:{type:"string"},style:y,styleSpec:c}):S&&p[S[1]]&&p[S[1]].transition?Oi({key:w,value:r[w],valueSpec:c.transition,style:y,styleSpec:c}):p[w]?Oi({key:w,value:r[w],valueSpec:p[w],style:y,styleSpec:c}):[new o.V(w,r[w],`unknown property "${w}"`)])}return b}function Ra(f){const r=f.value;if(!r)return[];const c=f.key;if(!o.H(r))return[new o.V(c,r,`object expected, ${o.K(r)} found`)];let p=[];const y=f.styleSpec,b=y["light-3d"],w=f.style,S=f.style.lights;for(const L of["type","id"])if(!(L in r))return p=p.concat([new o.V(c,r,`missing property "${L}"`)]),p;if(!o.a0(r.type))return p=p.concat([new o.V(`${c}.type`,r.type,"string expected")]),p;if(S)for(let L=0;L<f.arrayIndex;L++){const V=o.J(r.type),B=S[L];o.J(B.type)===V&&p.push(new o.V(c,r.id,`duplicate light type "${r.type}", previously defined at line ${B.id.__line__}`))}const P=`properties_light_${r.type}`;if(!(P in y))return p=p.concat([new o.V(`${c}.type`,r,`Invalid light type ${r.type}`)]),p;const k=y[P];for(const L in r)if(L==="properties"){const V=r[L];if(!o.H(V))return p=p.concat([new o.V("properties",V,`object expected, ${o.K(V)} found`)]),p;for(const B in V){const U=B.match(/^(.*)-transition$/),Z=B.match(/^(.*)-use-theme$/);p=p.concat(Z&&k[Z[1]]?Oi({key:L,value:V[B],valueSpec:{type:"string"},style:w,styleSpec:y}):U&&k[U[1]]&&k[U[1]].transition?Oi({key:L,value:r[L],valueSpec:y.transition,style:w,styleSpec:y}):k[B]?Oi({key:B,value:V[B],valueSpec:k[B],style:w,styleSpec:y}):[new o.a3(f.key,V[B],`unknown property "${B}"`)])}}else p=p.concat(b[L]?Oi({key:L,value:r[L],valueSpec:b[L],style:w,styleSpec:y}):[new o.a3(L,r[L],`unknown property "${L}"`)]);return p}function $o(f){const r=f.value,c=f.key,p=f.style,y=f.styleSpec,b=y.terrain;if(r==null)return[];if(!o.H(r))return[new o.V("terrain",r,`object expected, ${o.K(r)} found`)];let w=[];for(const S in r){const P=S.match(/^(.*)-transition$/),k=S.match(/^(.*)-use-theme$/);w=w.concat(k&&b[k[1]]?Oi({key:S,value:r[S],valueSpec:{type:"string"},style:p,styleSpec:y}):P&&b[P[1]]&&b[P[1]].transition?Oi({key:S,value:r[S],valueSpec:y.transition,style:p,styleSpec:y}):b[S]?Oi({key:S,value:r[S],valueSpec:b[S],style:p,styleSpec:y}):[new o.a3(S,r[S],`unknown property "${S}"`)])}if(r.source)if(o.a0(r.source)){const S=p.sources&&p.sources[r.source],P=S&&o.J(S.type);S?P!=="raster-dem"&&w.push(new o.V(`${c}.source`,r.source,`terrain cannot be used with a source of type ${P}, it only be used with a "raster-dem" source type`)):w.push(new o.V(`${c}.source`,r.source,`source "${r.source}" not found`))}else w.push(new o.V(`${c}.source`,r.source,"source must be a string"));else w.push(new o.V(c,r,'terrain is missing required property "source"'));return w}function id(f){const r=f.value,c=f.style,p=f.styleSpec,y=p.fog;if(r===void 0)return[];if(!o.H(r))return[new o.V("fog",r,`object expected, ${o.K(r)} found`)];let b=[];for(const w in r){const S=w.match(/^(.*)-transition$/),P=w.match(/^(.*)-use-theme$/);b=b.concat(P&&y[P[1]]?Oi({key:w,value:r[w],valueSpec:{type:"string"},style:c,styleSpec:p}):S&&y[S[1]]&&y[S[1]].transition?Oi({key:w,value:r[w],valueSpec:p.transition,style:c,styleSpec:p}):y[w]?Oi({key:w,value:r[w],valueSpec:y[w],style:c,styleSpec:p}):[new o.a3(w,r[w],`unknown property "${w}"`)])}return b}const nl={"*":()=>[],array:na,boolean:function(f){const r=f.value,c=f.key;return o.$(r)?[]:[new o.V(c,r,`boolean expected, ${o.K(r)} found`)]},number:Ja,color:function({key:f,value:r}){return o.a0(r)?o.a1.parseCSSColor(r)===null?[new o.V(f,r,`color expected, "${r}" found`)]:[]:[new o.V(f,r,`color expected, ${o.K(r)} found`)]},enum:Hs,filter:tl,function:po,layer:Il,object:ms,source:Aa,model:o.a7,light:Pa,"light-3d":Ra,terrain:$o,fog:id,string:jr,formatted:function(f){return jr(f).length===0?[]:ks(f)},resolvedImage:function(f){return jr(f).length===0?[]:ks(f)},projection:function(f){const r=f.value,c=f.styleSpec,p=c.projection,y=f.style;if(o.H(r)){let b=[];for(const w in r)b=b.concat(Oi({key:w,value:r[w],valueSpec:p[w],style:y,styleSpec:c}));return b}return o.a0(r)?[]:[new o.V("projection",r,`object or string expected, ${o.K(r)} found`)]},import:function(f){const r=f.key,{value:c,styleSpec:p}=f;if(!o.H(c))return[new o.V(r,c,"import must be an object")];const{data:y,...b}=c;Object.defineProperty(b,"__line__",{value:c.__line__,enumerable:!1});let w=ms(Object.assign({},f,{value:b,valueSpec:p.import}));return o.J(b.id)===""&&w.push(new o.V(`${f.key}.id`,b,"import id can't be an empty string")),y&&(w=w.concat(er(y,p,{key:`${f.key}.data`}))),w},iconset:function(f){const r=f.value,c=f.key,p=f.styleSpec,y=f.style;if(!o.H(r))return[new o.V(c,r,"object expected")];if(!r.type)return[new o.V(c,r,'"type" is required')];const b=o.J(r.type);let w=[];if(w=w.concat(ms({key:c,value:r,valueSpec:p[`iconset_${b}`],style:y,styleSpec:p})),function(S,P){return!(S!=="source"||!P.source)}(b,r)){const S=y.sources&&y.sources[r.source],P=S&&o.J(S.type);S?P!=="raster-array"&&w.push(new o.V(c,r.source,`iconset cannot be used with a source of type ${String(P)}, it only be used with a "raster-array" source type`)):w.push(new o.V(c,r.source,`source "${r.source}" not found`))}return w}};function Oi(f,r=!1){const c=f.value,p=f.valueSpec,y=f.styleSpec;if(p.expression){if(o.a4(o.J(c)))return po(f);if(o.Q(o.S(c)))return ks(f)}if(p.type&&nl[p.type]){const b=nl[p.type](f);return r===!0&&b.length>0&&Array.isArray(f.value)?ks(f):b}return ms(Object.assign({},f,{valueSpec:p.type?y[p.type]:p}))}function ms(f){const r=f.key,c=f.value,p=f.valueSpec||{},y=f.objectElementValidators||{},b=f.style,w=f.styleSpec;if(!o.H(c))return[new o.V(r,c,`object expected, ${o.K(c)} found`)];let S=[];for(const P in c){const k=P.split(".")[0];let L;y[k]?L=y[k]:p[k]?L=Oi:y["*"]?L=y["*"]:p["*"]&&(L=Oi),L?S=S.concat(L({key:(r&&`${r}.`)+P,value:c[P],valueSpec:p[k]||p["*"],style:b,styleSpec:w,object:c,objectKey:P},c)):S.push(new o.a3(r,c[P],`unknown property "${P}"`))}for(const P in p){if(y[P])continue;const k=p[P];k.required&&k.default===void 0&&c[P]===void 0&&S.push(new o.V(r,c,`missing required property "${P}"`))}return S}function gi({key:f,value:r}){const c=jr({key:f,value:r});if(c.length)return c;const p=r;return p.indexOf("{fontstack}")===-1&&c.push(new o.V(f,r,'"glyphs" url must include a "{fontstack}" token')),p.indexOf("{range}")===-1&&c.push(new o.V(f,r,'"glyphs" url must include a "{range}" token')),c}function er(f,r=o.a6,c={}){return ms({key:c.key||"",value:f,valueSpec:Object.assign(r.$root,{"*":{type:"*"}}),styleSpec:r,style:f,objectElementValidators:{glyphs:gi}})}function tr(f,r=o.a6){return oe(er(f,r))}const mo=f=>oe(Aa(f)),st=f=>oe(Pa(f)),Zs=f=>oe(Ra(f)),il=f=>oe($o(f)),js=f=>oe(id(f)),$n=f=>oe(function(r){const c=r.value,p=r.style,y=r.styleSpec,b=y.snow;if(c===void 0)return[];if(!o.H(c))return[new o.V("snow",c,`object expected, ${o.K(c)} found`)];let w=[];for(const S in c){const P=S.match(/^(.*)-transition$/);w=w.concat(P&&b[P[1]]&&b[P[1]].transition?Oi({key:S,value:c[S],valueSpec:y.transition,style:p,styleSpec:y}):b[S]?Oi({key:S,value:c[S],valueSpec:b[S],style:p,styleSpec:y}):[new o.a3(S,c[S],`unknown property "${S}"`)])}return w}(f)),io=f=>oe(function(r){const c=r.value,p=r.style,y=r.styleSpec,b=y.rain;if(c===void 0)return[];if(!o.H(c))return[new o.V("rain",c,`object expected, ${o.K(c)} found`)];let w=[];for(const S in c){const P=S.match(/^(.*)-transition$/);w=w.concat(P&&b[P[1]]&&b[P[1]].transition?Oi({key:S,value:c[S],valueSpec:y.transition,style:p,styleSpec:y}):b[S]?Oi({key:S,value:c[S],valueSpec:b[S],style:p,styleSpec:y}):[new o.a3(S,c[S],`unknown property "${S}"`)])}return w}(f)),fv=f=>oe(Il(f)),rd=f=>oe(tl(f)),ep=f=>oe(oc(f)),je=f=>oe(Cl(f)),Y=f=>oe(o.a7(f));function oe(f){return f.slice().sort((r,c)=>r.line&&c.line?r.line-c.line:0)}function fe(f,r){let c=!1;if(r&&r.length)for(const p of r)p instanceof o.a3?o.w(p.message):(f.fire(new o.y(new Error(p.message))),c=!0);return c}const Ae=o.a6.light;let Ce;class ke extends o.E{constructor(r,c="flat"){super(),this._transitionable=new o.a8(Ce||(Ce=new o.a9({anchor:new o.aa(Ae.anchor),position:new o.ab(Ae.position),color:new o.aa(Ae.color),intensity:new o.aa(Ae.intensity)}))),this.setLight(r,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,c,p={}){this._validate(st,r,p)||(this._transitionable.setTransitionOrValue(r),this.id=c)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,p){return(!p||p.validate!==!1)&&fe(this,r.call(tr,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}const Ge=o.a6.terrain;let Le=class extends o.E{constructor(f,r,c,p,y){super(),this.scope=c,this._transitionable=new o.a8(new o.a9({source:new o.aa(Ge.source),exaggeration:new o.aa(Ge.exaggeration)}),c,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r,this.worldview=y}get(){return this._transitionable.serialize()}set(f,r){this._transitionable.setTransitionOrValue(f,r)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new o.ac(f,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const r=f.value.expression;if(!r)return null;let c=-1,p=-1,y=1;for(const b of r.zoomStops)y=r.evaluate(new o.ac(b,{worldview:this.worldview})),y>.01?(c=b,p=-1):p=b;return y<.01&&c>0&&p>c?[c,p]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof o.ad}};const $e=45,mt=65,nt=.05;function Ft(f,r,c,p){const y=o.ah($e,mt,c),[b,w]=sn(f,p);let S=1-Math.min(1,Math.exp((r-b)/(w-b)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*y*f.alpha}function sn(f,r){const c=.5/Math.tan(.5*r);return[f.range[0]+c,f.range[1]+c]}function Nt(f,r,c,p,y){const b=o.af([],[r,c,p],y.mercatorFogMatrix);return Ft(f,o.ag(b),y.pitch,y._fov)}function kn(f,r,c,p,y,b,w){const S=[[c,p,0],[y,p,0],[y,b,0],[c,b,0]];let P=Number.MAX_VALUE,k=-Number.MAX_VALUE;for(const L of S){const V=o.af([],L,r),B=o.ag(V);P=Math.min(P,B),k=Math.max(k,B)}return[Ft(f,P,w.pitch,w._fov),Ft(f,k,w.pitch,w._fov)]}const Pn=o.a6.fog;class In extends o.E{constructor(r,c,p,y){super();const b=new o.a9({range:new o.aa(Pn.range),color:new o.aa(Pn.color),"color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.aa(Pn["high-color"]),"high-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.aa(Pn["space-color"]),"space-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.aa(Pn["horizon-blend"]),"star-intensity":new o.aa(Pn["star-intensity"]),"vertical-range":new o.aa(Pn["vertical-range"])});this._transitionable=new o.a8(b,p,new Map(y)),this.set(r,y),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new o.ai(b),this.scope=p}get state(){const r=this._transform,c=r.projection.name==="globe",p=o.aj(r.zoom),y=this.properties.get("range"),b=[.5,3];return{range:c?[o.ak(b[0],y[0],p),o.ak(b[1],y[1],p)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,c,p={}){if(this._validate(js,r,p))return;const y=Object.assign({},r);for(const b of Object.keys(Pn))y[b]===void 0&&(y[b]=Pn[b].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.ah($e,mt,r))*c.a}getOpacityAtLatLng(r,c){return this._transform.projection.supportsFog?function(p,y,b){const w=o.ae.fromLngLat(y),S=b.elevation?b.elevation.getAtPointOrZero(w):0;return Nt(p,w.x,w.y,S,b)}(this.state,r,c):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(r.toUnwrapped());return kn(this.state,c,0,0,o.al,o.al,this._transform)}getOpacityForBounds(r,c,p,y,b){return this._transform.projection.supportsFog?kn(this.state,r,c,p,y,b,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?sn(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const p of c){const y=r.points[p];let b;if(y[2]>=0)b=y;else{const w=r.points[p-4];b=o.am(w,y,w[2]/(w[2]-y[2]))}if(Nt(this.state,b[0],b[1],0,this._transform)>=nt)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,p){return(!p||p.validate!==!1)&&fe(this,r.call(tr,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}let ei,br,$r,Cr,Xr=class extends o.E{constructor(f,r,c,p){super();const y=ei||(ei=new o.a9({density:new o.aa(o.a6.snow.density),intensity:new o.aa(o.a6.snow.intensity),color:new o.aa(o.a6.snow.color),opacity:new o.aa(o.a6.snow.opacity),vignette:new o.aa(o.a6.snow.vignette),"vignette-color":new o.aa(o.a6.snow["vignette-color"]),"center-thinning":new o.aa(o.a6.snow["center-thinning"]),direction:new o.aa(o.a6.snow.direction),"flake-size":new o.aa(o.a6.snow["flake-size"])}));this._transitionable=new o.a8(y,c,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(y),this.scope=c}get state(){const f=this.properties.get("opacity"),r=this.properties.get("color"),c=this.properties.get("direction"),p=o.an(c[0]),y=-Math.max(o.an(c[1]),.01),b=[Math.cos(p)*Math.cos(y),Math.sin(p)*Math.cos(y),Math.sin(y)],w=this.properties.get("vignette"),S=this.properties.get("vignette-color");return S.a=w,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(r.r,r.g,r.b,r.a*f),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(f,r,c={}){if(this._validate($n,f,c))return;const p=Object.assign({},f),y=o.a6.snow;for(const b of Object.keys(y))p[b]===void 0&&(p[b]=y[b].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,r,c){return(!c||c.validate!==!1)&&fe(this,f.call(tr,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}},gr=class extends o.E{constructor(f,r,c,p){super();const y=br||(br=new o.a9({density:new o.aa(o.a6.rain.density),intensity:new o.aa(o.a6.rain.intensity),color:new o.aa(o.a6.rain.color),opacity:new o.aa(o.a6.rain.opacity),vignette:new o.aa(o.a6.rain.vignette),"vignette-color":new o.aa(o.a6.rain["vignette-color"]),"center-thinning":new o.aa(o.a6.rain["center-thinning"]),direction:new o.aa(o.a6.rain.direction),"droplet-size":new o.aa(o.a6.rain["droplet-size"]),"distortion-strength":new o.aa(o.a6.rain["distortion-strength"])}));this._transitionable=new o.a8(y,c,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(y),this.scope=c}get state(){const f=this.properties.get("opacity"),r=this.properties.get("color"),c=this.properties.get("direction"),p=o.an(c[0]),y=-Math.max(o.an(c[1]),.01),b=[Math.cos(p)*Math.cos(y),Math.sin(p)*Math.cos(y),Math.sin(y)],w=this.properties.get("vignette-color");return w.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(r.r,r.g,r.b,r.a*f),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(f,r,c={}){if(this._validate(io,f,c))return;const p=Object.assign({},f),y=o.a6.rain;for(const b of Object.keys(y))p[b]===void 0&&(p[b]=y[b].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,r,c){return(!c||c.validate!==!1)&&fe(this,f.call(tr,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}};class ai extends o.E{constructor(r,c,p,y){super(),this.scope=p,this._options=r,this.properties=new o.ai(c),this._transitionable=new o.a8(c,p,new Map(y)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,c){this._options=r,this._transitionable.setTransitionOrValue(r.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class _r{constructor(r,c,p){this.screenBounds=r,this.cameraPoint=p.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(r,c){let p,y;if(r instanceof o.P||typeof r[0]=="number"){const b=o.P.convert(r);p=[b],y=c.isPointAboveHorizon(b)}else{const b=o.P.convert(r[0]),w=o.P.convert(r[1]),S=b.add(w)._div(2);p=[b,w],y=o.aq(b,w).every(P=>c.isPointAboveHorizon(P))&&c.isPointAboveHorizon(S)}return new _r(p,y,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return o.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],y=o.aq(c,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<p.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?y[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(y[3]=this.cameraPoint)),o.ar(y,r)}bufferedCameraGeometryGlobe(r){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],y=o.aq(c,p,r),b=this.cameraPoint.clone();switch(3*((b.y>c.y)+(b.y>p.y))+((b.x>c.x)+(b.x>p.x))){case 0:y[0]=b,y[4]=b.clone();break;case 1:y.splice(1,0,b);break;case 2:y[1]=b;break;case 3:y.splice(4,0,b);break;case 5:y.splice(2,0,b);break;case 6:y[3]=b;break;case 7:y.splice(3,0,b);break;case 8:y[2]=b}return y}containsTile(r,c,p,y=0){const b=Math.max(r.queryPadding,r.evaluateQueryRenderedFeaturePadding())/c._pixelsPerMercatorPixel+1,w=p?this._bufferedCameraMercator(b,c):this._bufferedScreenMercator(b,c);let S=r.tileID.wrap+(w.unwrapped?y:0);const P=w.polygon.map(ne=>o.as(r.tileTransform,ne,S));if(!o.at(P,0,0,o.al,o.al))return;S=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const k=this.screenGeometryMercator.polygon.map(ne=>o.au(r.tileTransform,ne,S)),L=k.map(ne=>new o.P(ne[0],ne[1])),V=c.getFreeCameraOptions().position||new o.ae(0,0,0),B=o.au(r.tileTransform,V,S),U=k.map(ne=>{const te=o.av(ne,ne,B);return o.aw(te,te),new o.ax(B,te)}),Z=o.ay(r,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:U,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(W=o.az(P),W.min.x=o.aA(W.min.x,0,o.al),W.min.y=o.aA(W.min.y,0,o.al),W.max.x=o.aA(W.max.x,0,o.al),W.max.y=o.aA(W.max.y,0,o.al),W),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:Z};var W}_bufferedScreenMercator(r,c){const p=Ir(r);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let y;return y=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),c):{polygon:this.bufferedScreenGeometry(r).map(b=>c.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[p]=y,y}}_bufferedCameraMercator(r,c){const p=Ir(r);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let y;return y=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),c):{polygon:this.bufferedCameraGeometry(r).map(b=>c.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[p]=y,y}}_projectAndResample(r,c){const p=function(b,w){const S=o.aB([],w.pixelMatrix,w.globeMatrix),P=[0,-o.aD,0,1],k=[0,o.aD,0,1],L=[0,0,0,1];o.aC(P,P,S),o.aC(k,k,S),o.aC(L,L,S);const V=new o.P(P[0]/P[3],P[1]/P[3]),B=new o.P(k[0]/k[3],k[1]/k[3]),U=o.aE(b,V)&&P[3]<L[3],Z=o.aE(b,B)&&k[3]<L[3];if(!U&&!Z)return null;const W=function(we,_e,pe){for(let Se=1;Se<we.length;Se++){const De=qn(_e.pointCoordinate3D(we[Se-1]).x),Me=qn(_e.pointCoordinate3D(we[Se]).x);if(pe<0){if(De<Me)return{idx:Se,t:-De/(Me-1-De)}}else if(Me<De)return{idx:Se,t:(1-De)/(Me+1-De)}}return null}(b,w,U?-1:1);if(!W)return null;const{idx:ne,t:te}=W;let le=ne>1?Bi(b.slice(0,ne),w):[],he=ne<b.length?Bi(b.slice(ne),w):[];le=le.map(we=>new o.P(qn(we.x),we.y)),he=he.map(we=>new o.P(qn(we.x),we.y));const ce=[...le];ce.length===0&&ce.push(he[he.length-1]);const Ee=o.ak(ce[ce.length-1].y,(he.length===0?le[0]:he[0]).y,te);let ye;return ye=U?[new o.P(0,Ee),new o.P(0,0),new o.P(1,0),new o.P(1,Ee)]:[new o.P(1,Ee),new o.P(1,1),new o.P(0,1),new o.P(0,Ee)],ce.push(...ye),he.length===0?ce.push(le[0]):ce.push(...he),{polygon:ce.map(we=>new o.ae(we.x,we.y)),unwrapped:!1}}(r,c);if(p)return p;const y=function(b,w){let S=!1,P=-1/0,k=0;for(let V=0;V<b.length-1;V++)b[V].x>P&&(P=b[V].x,k=V);for(let V=0;V<b.length-1;V++){const B=(k+V)%(b.length-1),U=b[B],Z=b[B+1];Math.abs(U.x-Z.x)>.5&&(U.x<Z.x?(U.x+=1,B===0&&(b[b.length-1].x+=1)):(Z.x+=1,B+1===b.length-1&&(b[0].x+=1)),S=!0)}const L=o.aF(w.center.lng);return S&&L<Math.abs(L-1)&&b.forEach(V=>{V.x-=1}),{polygon:b,unwrapped:S}}(Bi(r,c).map(b=>new o.P(qn(b.x),b.y)),c);return{polygon:y.polygon.map(b=>new o.ae(b.x,b.y)),unwrapped:y.unwrapped}}}function Bi(f,r){return o.aG(f,c=>{const p=r.pointCoordinate3D(c);c.x=p.x,c.y=p.y},1/256)}function qn(f){return f<0?1+f%1:f%1}function Ir(f){return 100*f|0}function Bs(f,r,c,p,y){const b=function(S,P){if(S)return y(S);if(P){if(f.url&&P.tiles&&f.tiles&&delete f.tiles,P.variants){if(!Array.isArray(P.variants))return y(new Error("variants must be an array"));for(const L of P.variants){if(L==null||typeof L!="object"||L.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(L.capabilities))return y(new Error("capabilities must be an array"));if(L.capabilities.length===1&&L.capabilities[0]==="meshopt"){P=Object.assign(P,L);break}}}const k=o.aH(Object.assign({},P,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);k.tiles=r.canonicalizeTileset(k,f.url),y(null,k)}},w=function(S,P,k){if(!S)return null;if(!P&&!k)return S;k=k||S.worldview_default;const L=Object.values(S.language||{});if(L.length===0)return null;const V=Object.values(S.worldview||{});if(V.length===0)return null;const B=L.every(Z=>Z===P),U=V.every(Z=>Z===k);return B&&U?S:P in(S.language_options||{})||k in(S.worldview_options||{})?null:S.language_options&&S.worldview_options?S:null}(f.data,c,p);return w?o.o.frame(()=>b(null,w)):f.url?o.m(r.transformRequest(r.normalizeSourceURL(f.url,null,c,p),o.R.Source),b):o.o.frame(()=>{const{data:S,...P}=f;b(null,P)})}function Ks(f,r){const c=Math.pow(2,r.z),p=Math.floor(o.aF(f.getWest())*c),y=Math.floor(o.aJ(f.getNorth())*c),b=Math.ceil(o.aF(f.getEast())*c),w=Math.ceil(o.aJ(f.getSouth())*c);return r.x>=p&&r.x<b&&r.y>=y&&r.y<w}class Po{constructor(r,c,p){this.bounds=r?o.aI.convert(this.validateBounds(r)):null,this.minzoom=c||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}addExtraBounds(r){if(r){this.extraBounds||(this.extraBounds=[]);for(const c of r)this.extraBounds.push(o.aI.convert(this.validateBounds(c)))}}contains(r){if(r.z>this.maxzoom||r.z<this.minzoom||this.bounds&&!Ks(this.bounds,r))return!1;if(!this.extraBounds)return!0;for(const c of this.extraBounds)if(Ks(c,r))return!0;return!1}static fromTileJSON(r){if(!r.bounds&&!r.extra_bounds)return null;const c=new Po(r.bounds,r.minzoom,r.maxzoom);return c.addExtraBounds(r.extra_bounds),c}}class sd extends o.E{constructor(r,c,p,y){if(super(),this.id=r,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,o.aH(c,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new o.aK}load(r){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=Bs(this._options,this.map._requestManager,c,p,(y,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new o.y(y));else if(b){if(Object.assign(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const w of b.vector_layers)this.vectorLayerIds.push(w.id),b.worldview&&b.worldview[w.source]&&this.localizableLayerIds.add(w.id)}this.tileBounds=Po.fromTileJSON(b),gn(b.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}r&&r(y)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(r,c){const p=r.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(p),b=this.map._requestManager.transformRequest(y,o.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,S=w?{image:w.image.clone()}:null,P={request:b,data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,lut:S,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&o.h(p)&&(P.localizableLayerIds=this.localizableLayerIds),P.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=c:r.request=r.actor.send("reloadTile",P,k.bind(this));else if(r.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",P,k.bind(this),void 0,!0);else{const L=o.aL.call({deduped:this._deduped},P,(V,B)=>{if(V||!B)k.call(this,V);else{const U=o.aM(B.responseHeaders);P.data={rawData:B.rawData.slice(0),expires:U.expires,cacheControl:U.cacheControl},r.actor&&r.actor.send("loadTile",P,k.bind(this),void 0,!0)}},!0);r.request={cancel:L}}function k(L,V){return delete r.request,r.aborted?c(null):L&&L instanceof o.aN&&L.status!==404?c(L):(V&&V.resourceTiming&&(r.resourceTiming=V.resourceTiming),this.map._refreshExpiredTiles&&V&&r.setExpiryData(V),r.loadVectorData(V,this.map.painter),o.aO(this.dispatcher),c(null,V),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,c){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Es extends o.E{constructor(r,c,p,y){super(),this.id=r,this.dispatcher=p,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},c),Object.assign(this,o.aH(c,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const c=this.map.getWorldview();this._tileJSONRequest=Bs(this._options,this.map._requestManager,null,c,(p,y)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new o.y(p)):y&&(Object.assign(this,y),y.raster_layers&&(this.rasterLayers=y.raster_layers,this.rasterLayerIds=this.rasterLayers.map(b=>b.id)),this.tileBounds=Po.fromTileJSON(y),gn(y.tiles),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),r&&r(p)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,c){const p=o.o.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);r.request=o.n(this.map._requestManager.transformRequest(y,o.R.Tile),(b,w,S)=>{if(delete r.request,r.aborted)return r.state="unloaded",c(null);if(b)return r.state="errored",c(b);if(!w)return c(null);const P=o.aM(S);this.map._refreshExpiredTiles&&r.setExpiryData(P),r.setTexture(w,this.map.painter),r.state="loaded",o.aO(this.dispatcher),c(null)})}abortTile(r,c){r.request&&(r.request.cancel(),delete r.request),c&&c()}unloadTile(r,c){r.texture&&r.texture instanceof o.T?(r.destroy(!1),r.texture&&r.texture instanceof o.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function ia([f,r],c,p,{scaled:y=!0}={}){const{tileSize:b,buffer:w}=p,{x:S,y:P,z:k}=c;if(!isFinite(S)||!isFinite(P)||!isFinite(k))throw new Error("Invalid MRT header");const L=2**k,V=L*o.aF(f),B=L*o.aJ(r);return function([U,Z],W,{scaled:ne=!0}={}){if(!W)throw new Error("bandView is undefined");const{data:te,tileSize:le,buffer:he,offset:ce,scale:Ee,dimension:ye}=W;if(U<-he||U>le+he||Z<-he||Z>le+he)throw new Error(`Point (${U}, ${Z}) out of bounds for tileSize=${le}, buffer=${he}`);const we=(Z+he)*(le+2*he)+(U+he);if(new Uint32Array(te.buffer)[we]===4294967295)return null;let _e=[];_e=ne?[]:new W.data.constructor(ye);for(let pe=0;pe<ye;pe++)_e[pe]=Math.round(1e12*(te[ye*we+pe]*Ee+ce))/1e12;return _e}([Math.min(Math.max(-w,Math.floor((V-S)*b)),b-1+w),Math.min(Math.max(-w,Math.floor((B-P)*b)),b-1+w)],p,{scaled:y})}class ro extends Es{constructor(r,c,p,y){super(r,c,p,y),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},c)}triggerRepaint(r){const c=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);c&&c.enabled&&p&&c._clearRenderCacheForTile(p.id,r.tileID),this.map.triggerRepaint()}loadTile(r,c){const p=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(p,o.R.Tile),b={request:y,uid:r.uid,tileID:r.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};r.source=this.id,r.scope=this.scope,r.requestParams=y,r.actor||(r.actor=this.dispatcher.getActor());const w=(S,P,k)=>{if(delete r.request,r.aborted)return r.state="unloaded",c(null);if(S)return S.name==="AbortError"?void 0:(r.state="errored",c(S));if(this.map._refreshExpiredTiles&&P){const L=o.aM(k);r.setExpiryData(L)}if(this.partial&&r.state!=="expired")r.state="empty";else if(!this.partial){if(!P)return c(null);r.state="loaded",r._isHeaderLoaded=!0,r._mrt=P}c(null)};r.request=this.partial?r.fetchHeader(void 0,w.bind(this)):r.actor.send("loadTile",b,w.bind(this),void 0,!0)}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,c){const p=r.texturePerLayer;if(r.flushAllQueues(),p.size){r.destroy(!1);for(const y of p.values())this.map.painter.saveTileTexture(y)}else r.destroy()}prepareTile(r,c,p,y){r._isHeaderLoaded&&(r.state!=="empty"&&(r.state="reloading"),r.fetchBandForRender(c,p,y,(b,w)=>{if(b)return r.state="errored",this.fire(new o.y(b)),void this.triggerRepaint(r);w&&(r._isHeaderLoaded=!0,r.setTexturePerLayer(p,w,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:b})=>b===r),p=c&&c.fields,y=p&&p.bands&&p.bands;return y?y[0]:0}getTextureDescriptor(r,c,p){if(!r)return;const y=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let b=null;c instanceof o.aR?b=c.paint.get("raster-array-band"):c instanceof o.aS&&(b=c.paint.get("raster-particle-array-band"));const w=b||this.getInitialBand(y);if(w==null)return;if(!r.textureDescriptorPerLayer.get(c.id))return void this.prepareTile(r,y,c.id,w);if(r.updateNeeded(c.id,w)&&!p)return;const S=r.textureDescriptorPerLayer.get(c.id);return Object.assign({},S,{texture:r.texturePerLayer.get(c.id)})}getImages(r,c){const p=new Map;for(const y of r)for(const b of c){const[w,S]=b.split("/"),P=y.getLayer(w);if(!P||!P.hasBand(S)||!P.hasDataForBand(S))continue;const{bytes:k,tileSize:L,buffer:V}=P.getBandView(S),B=L+2*V,U={data:new o.q({width:B,height:B},k),pixelRatio:2,sdf:!1,usvg:!1,version:0};p.set(b,U)}return p}queryRasterArrayValueByBandId(r,c,p){const y=c._mrt;return new Promise(b=>{const w={},S=new Set;for(const[P,k]of Object.entries(y.layers)){if(p.layerName&&P!==p.layerName)continue;const L={};w[P]=L;for(const{bands:V}of k.dataIndex)for(const B of V)p.bands&&!p.bands.includes(B)||(S.add(o.B(P,B)),c.fetchBand(P,null,B,U=>{o.o.frame(()=>{L[B]=U?null:ia([r.lng,r.lat],y,k.getBandView(B)),S.delete(o.B(P,B)),S.size===0&&b(w)})},!1))}S.size===0&&b(w)})}_loadTileForQuery(r,c){if(this._loadTileLoaded[r.uid])return void c(null,r._mrt);if(this._loadTilePending[r.uid])return void this._loadTilePending[r.uid].push(c);this._loadTilePending[r.uid]=[c];const p=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(p,o.R.Tile);r.actor.send("loadTile",{request:y,uid:r.uid,tileID:r.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(b,w,S)=>{if(b)return this._loadTilePending[r.uid].forEach(P=>P(b,null)),void delete this._loadTilePending[r.uid];if(!w)return this._loadTilePending[r.uid].forEach(P=>P(null,null)),void delete this._loadTilePending[r.uid];if(this.map._refreshExpiredTiles&&w){const P=o.aM(S);r.setExpiryData(P)}r._mrt=w,r._isHeaderLoaded=!0,r.state="loaded",this._loadTilePending[r.uid].forEach(P=>P(null,w)),this._loadTileLoaded[r.uid]=!0,delete this._loadTilePending[r.uid]},void 0,!0)}queryRasterArrayValueByAllBands(r,c,p){return new Promise((y,b)=>{this._loadTileForQuery(c,(w,S)=>{w?b(w):y(S?this.queryRasterArrayValueByBandId(r,c,p):null)})})}queryRasterArrayValue(r,c){const p=o.aT.convert(r),y=this.findLoadedParent(p);return y&&y._mrt?c.bands||!this.partial?this.queryRasterArrayValueByBandId(p,y,c):this.queryRasterArrayValueByAllBands(p,y,c):Promise.resolve(null)}findLoadedParent(r){const c=o.ae.fromLngLat(r,this.map.transform.tileSize),p=this.maxzoom+1,y=1<<p,b=Math.floor(c.x),w=Math.floor((c.x-b)*y),S=Math.floor(c.y*y),P=this.map.style.getSourceCache(this.id),k=new o.aQ(p,b,p,w,S);return P.findLoadedParent(k,this.minzoom)}}const Pl={vector:sd,raster:Es,"raster-dem":class extends Es{constructor(f,r,c,p){super(f,r,c,p),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(f,r){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(y,b){y&&(f.state="errored",r(y)),b&&(f.dem=b,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",r(null))}f.request=o.n(this.map._requestManager.transformRequest(c,o.R.Tile),(function(y,b,w){if(delete f.request,f.aborted)f.state="unloaded",r(null);else if(y)f.state="errored",r(y);else if(b){const S=o.aM(w);this.map._refreshExpiredTiles&&f.setExpiryData(S);const P=ImageBitmap&&b instanceof ImageBitmap&&o.r(),k=1-(b.width-o.aP(b.width))/2;k<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const L=P?b:o.o.getImageData(b,k),V={uid:f.uid,tileID:f.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:k};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadTile",V,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const r=f.canonical,c=Math.pow(2,r.z),p=(r.x-1+c)%c,y=r.x===0?f.wrap-1:f.wrap,b=(r.x+1+c)%c,w=r.x+1===c?f.wrap+1:f.wrap,S={};return S[new o.aQ(f.overscaledZ,y,r.z,p,r.y).key]={backfilled:!1},S[new o.aQ(f.overscaledZ,w,r.z,b,r.y).key]={backfilled:!1},r.y>0&&(S[new o.aQ(f.overscaledZ,y,r.z,p,r.y-1).key]={backfilled:!1},S[new o.aQ(f.overscaledZ,f.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},S[new o.aQ(f.overscaledZ,w,r.z,b,r.y-1).key]={backfilled:!1}),r.y+1<c&&(S[new o.aQ(f.overscaledZ,y,r.z,p,r.y+1).key]={backfilled:!1},S[new o.aQ(f.overscaledZ,f.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},S[new o.aQ(f.overscaledZ,w,r.z,b,r.y+1).key]={backfilled:!1}),S}},"raster-array":ro,geojson:class extends o.E{constructor(f,r,c,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(p),this._data=r.data,this._options=Object.assign({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.minzoom!==void 0&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const y=o.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*y,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*y,extent:o.al,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.al,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*y,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new o.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new o.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const r=new Map;for(const c of this._data.features)r.set(c.id,c);for(const c of f.features)r.set(c.id,c);this._data.features=[...r.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},r),this}getClusterChildren(f,r){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},r),this}getClusterLeaves(f,r,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:r,offset:c},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.z("dataloading",{dataType:"source"})),this._loaded=!1;const r=Object.assign({append:f},this.workerOptions);r.scope=this.scope;const c=this._data;typeof c=="string"?(r.request=this.map._requestManager.transformRequest(o.o.resolveURL(c),o.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,(p,y)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new o.y(p));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(b.resourceTiming=y.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new o.z("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const f=o.B(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,r){const c=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,y=p?{image:p.image.clone()}:null,b=this._partialReload,w={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:f.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:b,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};f.request=this.actor.send(c,w,(S,P)=>b&&!P?(f.state="loaded",r(null)):(delete f.request,f.destroy(!1),f.aborted?r(null):S?r(S):(f.loadVectorData(P,this.map.painter,c==="reloadTile"),r(null))),void 0,c==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,r){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aU{constructor(f,r,c,p){super(f,r,c,p),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const r of f.urls)this.urls.push(this.map._requestManager.transformRequest(r,o.R.Source).url);o.aV(this.urls,(r,c)=>{this._loaded=!0,r?this.fire(new o.y(r)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const r=this.video.seekable;f<r.start(0)||f>r.end(0)?this.fire(new o.y(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,r=f.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(f,this.video,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aU,model:o.aX,"batched-model":class extends o.E{constructor(f,r,c,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(f))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=Bs(this._options,this.map._requestManager,r,c,(p,y)=>{this._tileJSONRequest=null,this._loaded=!0,p?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new o.y(p))):y&&(Object.assign(this,y),y.bounds&&(this.tileBounds=new Po(y.bounds,this.minzoom,this.maxzoom)),gn(y.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,r){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(c,o.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.o.devicePixelRatio,promoteId:this.promoteId};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=r;else{if(f.buckets){const b=Object.values(f.buckets);for(const w of b)w.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,y.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,y.bind(this),void 0,!0);function y(b,w){return f.aborted?r(null):b&&b.status!==404?r(b):(this.map._refreshExpiredTiles&&w&&f.setExpiryData(w),f.loadModelData(w,this.map.painter),f.state="loaded",void r(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends o.aU{constructor(f,r,c,p){super(f,r,c,p),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(b=>typeof b!="number"))||this.fire(new o.y(new o.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.y(new o.V(`sources.${f}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.y(new o.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new o.y(new o.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.y(new o.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof o.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(r,this.canvas,r.gl.RGBA8,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends o.E{constructor(f,r,c,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=r,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Po(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,o.aH(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:r,y:c,z:p}=f.canonical;return this._implementation.hasTile({x:r,y:c,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,r){const{x:c,y:p,z:y}=f.tileID.canonical,b=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:c,y:p,z:y},{signal:b.signal})).then((function(w){return delete f.request,f.aborted?(f.state="unloaded",r(null)):w===void 0?(f.state="errored",r(null)):w===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",r(null)):function(S){return S instanceof ImageData||S instanceof HTMLCanvasElement||S instanceof ImageBitmap||S instanceof HTMLImageElement}(w)?(this.loadTileData(f,w),f.state="loaded",void r(null)):(f.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.name!=="AbortError"&&(f.state="errored",r(w))}),f.request.cancel=()=>b.abort()}loadTileData(f,r){f.setTexture(r,this.map.painter)}unloadTile(f,r){if(f.texture&&f.texture instanceof o.T?(f.destroy(!1),f.texture&&f.texture instanceof o.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:c,y:p,z:y}=f.tileID.canonical;this._implementation.unloadTile({x:c,y:p,z:y})}r&&r()}abortTile(f,r){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),r&&r()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=o.B(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}}},gs=function(f,r,c,p){const y=new Pl[r.type](f,r,c,p);if(y.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${y.id}`);return o.aY(["load","abort","unload","serialize","prepare"],y),y};function od(f,r,c=""){return`${c}:${r.id||""}:${r.layer.id}:${function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:y,importId:b}=p;return`featureset:${y}${b?`:import:${b}`:""}`}}(f.target)}`}function oh(f,r,c,p=""){if(f.uniqueFeatureID){const y=od(f,r,p);if(c.has(y))return!0;c.add(y)}return!1}function Wm(f,r,c,p,y=!1){const b=r.sourceCache.transform,w=r.sourceCache.tilesIn(f,r.has3DLayers,y);w.sort(tp);const S=[];for(const P of w){const k=P.tile.queryRenderedFeatures(r,P,c,p,b,y);Object.keys(k).length&&S.push({wrappedTileID:P.tile.tileID.wrapped().key,queryResults:k})}for(const P in r.layers){const k=r.layers[P];if(k.styleLayer){const L=k.styleLayer.queryRenderedFeatures(f,r.sourceCache,p);Object.keys(L).length&&S.push({wrappedTileID:0,queryResults:L})}}return S.length===0?{}:function(P){const k={},L={};for(const V of P){const B=V.queryResults,U=V.wrappedTileID,Z=L[U]=L[U]||{};for(const W in B){const ne=B[W],te=Z[W]=Z[W]||{},le=k[W]=k[W]||[];for(const he of ne)te[he.featureIndex]||(te[he.featureIndex]=!0,le.push(he))}}return k}(S)}function qm(f,r,c,p,y,b){const w={},S=p.queryRenderedSymbols(f),P=[];for(const k of Object.keys(S).map(Number))P.push(y[k]);P.sort(tp);for(const k of P){const L=k.featureIndex.lookupSymbolFeatures(S[k.bucketInstanceId],k.bucketIndex,k.sourceLayerIndex,r,c,b);for(const V in L){const B=w[V]=w[V]||[],U=L[V];U.sort((Z,W)=>{const ne=k.featureSortOrder;if(ne){const te=ne.indexOf(Z.featureIndex);return ne.indexOf(W.featureIndex)-te}return W.featureIndex-Z.featureIndex});for(const Z of U)B.push(Z)}}return w}function Zm(f,r){const c=f.getRenderableIds().map(b=>f.getTileByID(b)),p=[],y={};for(let b=0;b<c.length;b++){const w=c[b],S=w.tileID.canonical.key;y[S]||(y[S]=!0,w.querySourceFeatures(p,r))}return p}function tp(f,r){const c=f.tileID,p=r.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}function Rl(f,r){const c={};if(!r)return c;for(const p of f){const y=p.layerIds.map(b=>r.getLayer(b)).filter(Boolean);if(y.length!==0){p.layers=y,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(b=>y.filter(w=>w.id===b)[0]));for(const b of y)c[b.fqid]=p}}return c}const Ro=32,rl=33,sl=new Uint16Array(8184);for(let f=0;f<2046;f++){let r=f+2,c=0,p=0,y=0,b=0,w=0,S=0;for(1&r?y=b=w=Ro:c=p=S=Ro;(r>>=1)>1;){const k=c+y>>1,L=p+b>>1;1&r?(y=c,b=p,c=w,p=S):(c=y,p=b,y=w,b=S),w=k,S=L}const P=4*f;sl[P+0]=c,sl[P+1]=p,sl[P+2]=y,sl[P+3]=b}const Ma=new Uint16Array(2178),Ml=new Uint8Array(1089),uu=new Uint16Array(1089);function ad(f){return f===0?-.03125:f===32?.03125:0}const Km={type:2,extent:o.al,loadGeometry:()=>[[new o.P(0,0),new o.P(o.al+1,0),new o.P(o.al+1,o.al+1),new o.P(0,o.al+1),new o.P(0,0)]]};class ld{constructor(r,c,p,y,b,w){this.tileID=r,this.uid=o.b2(),this.uses=0,this.tileSize=c,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection),this.worldview=w,this._hasAppearances=null}registerFadeDuration(r){const c=r+this.timeAdded;c<o.o.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,c,p){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=Rl(r.buckets,c.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const b=this.buckets[y];if(b instanceof o.b4){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const b=this.buckets[y];if(b instanceof o.b4&&b.hasRTLText){this.hasRTLText=!0,o.b5();break}}this.queryPadding=0;for(const y in this.buckets){const b=this.buckets[y],w=c.style.getOwnLayer(y);if(!w)continue;const S=w.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,S)}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas),this._lastUpdatedBrightness=r.brightness}else this.collisionBoxArray=new o.b3}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(r,c,p){r&&(r.resourceTiming&&(this.resourceTiming=r.resourceTiming),this.buckets=Object.assign({},this.buckets,Rl(r.buckets,c.style)),r.featureIndex&&(this.latestFeatureIndex=r.featureIndex))}getBucket(r){return this.buckets[r.fqid]}upload(r,c){for(const b in this.buckets){const w=this.buckets[b];if(w.uploadPending()){let S={},P=[],k={zoom:0,pitch:0,brightness:0,worldview:""};if(c){if(c.style){P=c.style.listImages();const L=w.layers[0],V=L.sourceLayer||"_geojsonTileLayer",B=c.style.getLayerSourceCache(L);B&&(S=B._state.getState(V,void 0))}k={zoom:c.transform.zoom||0,pitch:c.transform.pitch||0,brightness:c.style.getBrightness()||0,worldview:c.worldview||""}}w.upload(r,this.tileID.canonical,S,P,k)}}const p=r.gl,y=this.imageAtlas;y&&!y.uploaded&&(this.imageAtlasTexture=new o.T(r,y.image,p.RGBA8,{useMipmap:!!y.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(r,this.glyphAtlasImage,p.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(r,this.lineAtlas.image,p.R8),this.lineAtlas.uploaded=!0)}prepare(r,c,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture,p),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=c.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(c)),(this._lastUpdatedBrightness||y||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}evaluateQueryRenderedFeaturePadding(){let r=0;for(const c in this.buckets){const p=this.buckets[c];p.evaluateQueryRenderedFeaturePadding&&(r=Math.max(r,p.evaluateQueryRenderedFeaturePadding()))}return r}queryRenderedFeatures(r,c,p,y,b,w){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const S=this.evaluateQueryRenderedFeaturePadding(),P=function(k,L){const V=o.bq([],[.5*k.width,.5*-k.height,1]);return o.br(V,V,[1,-1,0]),o.aB(V,V,k.calculateProjMatrix(L.toUnwrapped())),Float32Array.from(V)}(b,this.tileID);return this.latestFeatureIndex.query(r,{tilespaceGeometry:c,pixelPosMatrix:P,transform:y,availableImages:p,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:S})}querySourceFeatures(r,c){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const y=p.loadVTLayers(),b=c?c.sourceLayer:"",w=y._geojsonTileLayer||y[b];if(!w)return;const S=o.b6(c&&c.filter),{z:P,x:k,y:L}=this.tileID.canonical,V={z:P,x:k,y:L};for(let B=0;B<w.length;B++){const U=w.feature(B);if(S.needGeometry){const ne=o.b7(U,!0);if(!S.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),ne,this.tileID.canonical))continue}else if(!S.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),U))continue;const Z=p.getId(U,b),W=new o.b8(U,P,k,L,Z);W.tile=V,r.push(W)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(r){const c=this.expirationTime;if(r.cacheControl){const p=o.b9(r.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const p=Date.now();let y=!1;if(this.expirationTime>p)y=!1;else if(c)if(this.expirationTime<c)y=!0;else{const b=this.expirationTime-c;b?this.expirationTime=p+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(r){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&r&&this.updateBuckets(r)}hasAppearances(r){for(const c in this.buckets)if(r.style.hasLayer(c)&&this.buckets[c].layers.some(p=>p.appearances&&p.appearances.length>0))return!0;return!1}updateBuckets(r,c){if(!this.latestFeatureIndex||!r.style)return;const p=r.style.listImages(),y=r.style.getBrightness();for(const b in this.buckets){if(!r.style.hasLayer(b))continue;const w=this.buckets[b],S=w.layers[0],P=S.sourceLayer||"_geojsonTileLayer",k=r.style.getLayerSourceCache(S);let L={};k&&(L=k._state.getState(P,void 0));const V=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},B=Object.keys(L).length>0&&!c;w.hasAppearances=w.layers.some(W=>W.appearances&&W.appearances.length>0);const U=B?w.stateDependentLayers:w.layers;if(B&&w.stateDependentLayers.length!==0||c){const W=this.latestFeatureIndex.loadVTLayers();w.update(L,W[P],p,V,U,c,y)}if(B&&w.stateDependentLayers.length!==0||c||w.hasAppearances){const W={zoom:r.transform.zoom,pitch:r.transform.pitch,brightness:r.style.getBrightness()||0,worldview:r.worldview};w.updateAppearances(this.tileID.canonical,L,p,W)}(w instanceof o.ba||w instanceof o.bb)&&r._terrain&&r._terrain.enabled&&k&&w.uploadPending()&&r._terrain._clearRenderCacheForTile(k.id,this.tileID);const Z=r&&r.style&&r.style.getOwnLayer(b);Z&&(this.queryPadding=Math.max(this.queryPadding,Z.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=o.o.now()+r}setTexture(r,c){const p=c.context,y=p.gl;this.texture=this.texture||c.getTileTexture(r.width),this.texture&&this.texture instanceof o.T?this.texture.update(r):(this.texture=new o.T(p,r,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(r,c){const p={};for(const y of c)p[y]=!0;this.dependencies[r]=p}hasDependency(r,c){for(const p of r){const y=this.dependencies[p];if(y){for(const b of c)if(y[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const p=o.bc(Km,this.tileID.canonical,this.tileTransform)[0],y=new o.bd,b=new o.be;for(let w=0;w<p.length;w++){const{x:S,y:P}=p[w];y.emplaceBack(S,P),b.emplaceBack(w)}b.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(b),this._tileDebugBuffer=r.createVertexBuffer(y,o.bf.members),this._tileDebugSegments=o.bg.simpleSegment(0,0,y.length,b.length)}_makeTileBoundsBuffers(r,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const p=o.bc(Km,this.tileID.canonical,this.tileTransform)[0];let y,b;if(this.isRaster){const w=function(S,P){const k=o.aZ(S,P),L=Math.pow(2,S.z);for(let ne=0;ne<rl;ne++)for(let te=0;te<rl;te++){const le=o.a_((S.x+(te+ad(te))/Ro)/L),he=o.a$((S.y+(ne+ad(ne))/Ro)/L),ce=P.project(le,he),Ee=ne*rl+te;Ma[2*Ee+0]=Math.round((ce.x*k.scale-k.x)*o.al),Ma[2*Ee+1]=Math.round((ce.y*k.scale-k.y)*o.al)}Ml.fill(0),uu.fill(0);for(let ne=2045;ne>=0;ne--){const te=4*ne,le=sl[te+0],he=sl[te+1],ce=sl[te+2],Ee=sl[te+3],ye=le+ce>>1,we=he+Ee>>1,_e=ye+we-he,pe=we+le-ye,Se=he*rl+le,De=Ee*rl+ce,Me=we*rl+ye,He=Math.hypot((Ma[2*Se+0]+Ma[2*De+0])/2-Ma[2*Me+0],(Ma[2*Se+1]+Ma[2*De+1])/2-Ma[2*Me+1])>=16;Ml[Me]=Ml[Me]||(He?1:0),ne<1022&&(Ml[Me]=Ml[Me]||Ml[(he+pe>>1)*rl+(le+_e>>1)]||Ml[(Ee+pe>>1)*rl+(ce+_e>>1)])}const V=new o.b1,B=new o.b0;let U=0;function Z(ne,te){const le=te*rl+ne;return uu[le]===0&&(V.emplaceBack(Ma[2*le+0],Ma[2*le+1],ne*o.al/Ro,te*o.al/Ro),uu[le]=++U),uu[le]-1}function W(ne,te,le,he,ce,Ee){const ye=ne+le>>1,we=te+he>>1;if(Math.abs(ne-ce)+Math.abs(te-Ee)>1&&Ml[we*rl+ye])W(ce,Ee,ne,te,ye,we),W(le,he,ce,Ee,ye,we);else{const _e=Z(ne,te),pe=Z(le,he),Se=Z(ce,Ee);B.emplaceBack(_e,pe,Se)}}return W(0,0,Ro,Ro,Ro,0),W(Ro,Ro,0,0,0,Ro),{vertices:V,indices:B}}(this.tileID.canonical,c);y=w.vertices,b=w.indices}else{y=new o.b1,b=new o.b0;for(const{x:S,y:P}of p)y.emplaceBack(S,P,0,0);const w=o.bh(y.int16.subarray(0,4*y.length),void 0,4);for(let S=0;S<w.length;S+=3)b.emplaceBack(w[S],w[S+1],w[S+2])}this._tileBoundsBuffer=r.createVertexBuffer(y,o.bi.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(b),this._tileBoundsSegments=o.bg.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugBuffers(r,c){const p=c.projection;if(!p||p.name!=="globe"||c.freezeTileCoverage)return;const y=this.tileID.canonical,b=o.bj(y,c),w=o.bk(b),S=o.aj(c.zoom);let P;S>0&&(P=o.bl(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,y,c,w,P,S),this._makeGlobeTileDebugTextBuffer(r,y,c,w,P,S)}_globePoint(r,c,p,y,b,w,S){let P=o.bm(r,c,p);if(w){const k=1<<p.z,L=o.aF(y.center.lng),V=o.aJ(y.center.lat),B=(p.x+.5)/k-L;let U=0;B>.5?U=-1:B<-.5&&(U=1);let Z=(r/o.al+p.x)/k+U,W=(c/o.al+p.y)/k;Z=(Z-L)*y._pixelsPerMercatorPixel+L,W=(W-V)*y._pixelsPerMercatorPixel+V;const ne=[Z*y.worldSize,W*y.worldSize,0];o.af(ne,ne,w),P=o.bn(P,ne,S)}return o.af(P,P,b)}_makeGlobeTileDebugBorderBuffer(r,c,p,y,b,w){const S=new o.bd,P=new o.be,k=new o.bo,L=(B,U,Z,W,ne)=>{const te=(Z-B)/(ne-1),le=(W-U)/(ne-1),he=S.length;for(let ce=0;ce<ne;ce++){const Ee=B+ce*te,ye=U+ce*le;S.emplaceBack(Ee,ye);const we=this._globePoint(Ee,ye,c,p,y,b,w);k.emplaceBack(we[0],we[1],we[2]),P.emplaceBack(he+ce)}},V=o.al;L(0,0,V,0,16),L(V,0,V,V,16),L(V,V,0,V,16),L(0,V,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(P),this._tileDebugBuffer=r.createVertexBuffer(S,o.bf.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(k,o.bp.members),this._tileDebugSegments=o.bg.simpleSegment(0,0,S.length,P.length)}_makeGlobeTileDebugTextBuffer(r,c,p,y,b,w){const S=o.al/4,P=new o.bd,k=new o.b0,L=new o.bo,V=25;k.reserve(32),P.reserve(V),L.reserve(V);const B=(U,Z)=>V*U+Z;for(let U=0;U<V;U++){const Z=U*S;for(let W=0;W<V;W++){const ne=W*S;P.emplaceBack(ne,Z);const te=this._globePoint(ne,Z,c,p,y,b,w);L.emplaceBack(te[0],te[1],te[2])}}for(let U=0;U<4;U++)for(let Z=0;Z<4;Z++){const W=B(U,Z),ne=B(U,Z+1),te=B(U+1,Z),le=B(U+1,Z+1);k.emplaceBack(W,ne,te),k.emplaceBack(te,ne,le)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(k),this._tileDebugTextBuffer=r.createVertexBuffer(P,o.bf.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(L,o.bp.members),this._tileDebugTextSegments=o.bg.simpleSegment(0,0,V,32)}destroy(r=!0){for(const c in this.buckets)this.buckets[c].destroy(r);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),r&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof o.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.bs.setPbf(o.bt);class Xm extends ld{constructor(r,c,p,y,b){super(r,c,p,y,b),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(r){return this._mrt&&this._mrt.getLayer(r)}setTexturePerLayer(r,c,p){const y=p.context,b=y.gl;let w=this.texturePerLayer.get(r)||p.getTileTexture(c.width);w&&w instanceof o.T?w.update(c,{premultiply:!1}):w=new o.T(y,c,b.RGBA8,{premultiply:!1}),this.texturePerLayer.has(r)||this.texturePerLayer.set(r,w)}flushQueues(r){const c=this._workQueuePerLayer.get(r)||[],p=this._fetchQueuePerLayer.get(r)||[];for(;c.length;)c.pop()();for(;p.length;)p.pop()()}flushAllQueues(){for(const r of this._workQueuePerLayer.keys()){const c=this._workQueuePerLayer.get(r)||[];for(;c.length;)c.pop()()}for(const r of this._fetchQueuePerLayer.keys()){const c=this._fetchQueuePerLayer.get(r)||[];for(;c.length;)c.pop()()}}fetchHeader(r=16384,c){const p=this._mrt=new o.bs(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(r-1)}});return this.entireBuffer=null,this.request=o.bu(y,(b,w,S)=>{if(b)c(b);else try{const P=p.getHeaderLength(w);if(P>r)return void(this.request=this.fetchHeader(P,c));p.parseHeader(w),this._isHeaderLoaded=!0;let k=0;for(const L of Object.values(p.layers))k=Math.max(k,L.dataIndex[L.dataIndex.length-1].lastByte);w.byteLength>=k&&(this.entireBuffer=w),c(null,this.entireBuffer||w,S)}catch(P){c(P)}}),this.request}fetchBandForRender(r,c,p,y){this.fetchBand(r,c,p,b=>{if(b)return void y(b);this.updateTextureDescriptor(r,c,p);const w=this.textureDescriptorPerLayer.get(c);y(null,w?w.img:null)})}fetchBand(r,c,p,y,b=!0){const w=this._mrt;if(!this._isHeaderLoaded||!w)return void y(new Error("Tile header is not ready"));const S=this.actor;if(!S)return void y(new Error("Can't fetch tile band without an actor"));let P;const k=o.B(String(p),o.B(this.tileID.key,r));let L=this._taskQueue.get(k);L?L.add(y):(L=new Set,L.add(y),this._taskQueue.set(k,L));const V=(W,ne)=>{P.complete(W,ne),W?y(W):(L.forEach(te=>te(null,ne)),this._taskQueue.delete(k))},B=(W,ne)=>{if(W)return y(W);const te=S.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ne,task:P},V,void 0,!0);if(c!==null){const le=this._workQueuePerLayer.get(c)||[];le.push(()=>{te&&te.cancel(),P.cancel()}),this._workQueuePerLayer.has(c)||this._workQueuePerLayer.set(c,le)}};let U;try{U=w.getLayer(r)}catch(W){if(this.state==="reloading")return;throw W}if(!U)return void y(new Error(`Unknown sourceLayer "${r}"`));if(U.hasDataForBand(p))return L.forEach(W=>W(null,null)),void this._taskQueue.delete(k);const Z=U.getDataRange([p]);if(P=w.createDecodingTask(Z),!P||P.tasks.length)if(c!==null&&this.flushQueues(c),this.entireBuffer)B(null,this.entireBuffer.slice(Z.firstByte,Z.lastByte+1));else{const W=Object.assign({},this.requestParams,{headers:{Range:`bytes=${Z.firstByte}-${Z.lastByte}`}}),ne=o.bu(W,B);if(c!==null){const te=this._fetchQueuePerLayer.get(c)||[];te.push(()=>{ne.cancel(),P.cancel()}),this._fetchQueuePerLayer.has(c)||this._fetchQueuePerLayer.set(c,te)}}}updateNeeded(r,c){return(!this.textureDescriptorPerLayer.get(r)||this.textureDescriptorPerLayer.get(r).band!==c||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(r,c,p){if(!this._mrt)return;const y=this._mrt.getLayer(r);if(!y||!y.hasBand(p)||!y.hasDataForBand(p))return;const{bytes:b,tileSize:w,buffer:S,offset:P,scale:k}=y.getBandView(p),L=w+2*S,V=new o.q({width:L,height:L},b),B=this.texturePerLayer.get(c);B&&B instanceof o.T&&B.update(V,{premultiply:!1}),this.textureDescriptorPerLayer.set(c,{layer:r,band:p,img:V,buffer:S,offset:P,tileSize:w,format:y.pixelFormat,mix:[k,256*k,65536*k,16777216*k]})}destroy(r=!1){if(super.destroy(r),delete this._mrt,!r)for(const c of this.texturePerLayer.values())c&&c instanceof o.T&&c.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class wb{constructor(r,c){this.max=r,this.onRemove=c,this.reset()}reset(){for(const r in this.data)for(const c of this.data[r])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(r,c,p){const y=r.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const b={value:c,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(r,b)},p)),this.data[y].push(b),this.order.push(y),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const c=this.data[r].shift();return c.timeout&&clearTimeout(c.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),c.value}getByKey(r){const c=this.data[r];return c?c[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,c){if(!this.has(r))return this;const p=r.wrapped().key,y=c===void 0?0:this.data[p].indexOf(c),b=this.data[p][y];return this.data[p].splice(y,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(r){const c=[];for(const p in this.data)for(const y of this.data[p])r(y.value)||c.push(y);for(const p of c)this.remove(p.value.tileID,p)}}class np{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,c,p){const y=String(c);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][y]=this.stateChanges[r][y]||{},Object.assign(this.stateChanges[r][y],p),this.deletedStates[r]===null){this.deletedStates[r]={};for(const b in this.state[r])b!==y&&(this.deletedStates[r][b]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][y]===null){this.deletedStates[r][y]={};for(const b in this.state[r][y])p[b]||(this.deletedStates[r][y][b]=null)}else for(const b in p)this.deletedStates[r]&&this.deletedStates[r][y]&&this.deletedStates[r][y][b]===null&&delete this.deletedStates[r][y][b]}removeFeatureState(r,c,p){if(this.deletedStates[r]===null)return;const y=String(c);if(this.deletedStates[r]=this.deletedStates[r]||{},p&&c!==void 0)this.deletedStates[r][y]!==null&&(this.deletedStates[r][y]=this.deletedStates[r][y]||{},this.deletedStates[r][y][p]=null);else if(c!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][y])for(p in this.deletedStates[r][y]={},this.stateChanges[r][y])this.deletedStates[r][y][p]=null;else this.deletedStates[r][y]=null;else this.deletedStates[r]=null}getState(r,c){const p=this.state[r]||{},y=this.stateChanges[r]||{},b=this.deletedStates[r];if(b===null)return{};if(c!==void 0){const S=String(c),P=Object.assign({},p[S],y[S]);if(b){const k=b[c];if(k===null)return{};for(const L in k)delete P[L]}return P}const w=Object.assign({},p,y);if(b)for(const S in b)delete w[S];return w}initializeTileState(r,c){r.refreshFeatureState(c)}coalesceChanges(r,c){const p={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const b={};for(const w in this.stateChanges[y])this.state[y][w]||(this.state[y][w]={}),Object.assign(this.state[y][w],this.stateChanges[y][w]),b[w]=this.state[y][w];p[y]=b}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const b={};if(this.deletedStates[y]===null)for(const w in this.state[y])b[w]={},this.state[y][w]={};else for(const w in this.deletedStates[y]){if(this.deletedStates[y][w]===null)this.state[y][w]={};else if(this.state[y][w])for(const S of Object.keys(this.deletedStates[y][w]))delete this.state[y][w][S];b[w]=this.state[y][w]}p[y]=p[y]||{},Object.assign(p[y],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const y in r)r[y].refreshFeatureState(c)}}class Go extends o.E{constructor(r,c,p){super(),this.id=r,this._onlySymbols=p,c.on("data",y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new wb(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new np,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles)if(!this._tiles[r].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,c){return r.isSymbolTile=this._onlySymbols,r.isExtraShadowCaster=this._shadowCasterTiles[r.tileID.key],this._source.loadTile(r,c)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r)}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r)}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const p=this._tiles[c];p.upload(r,this.map?this.map.painter:void 0),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(Ym).map(r=>r.key)}getRenderableIds(r,c){const p=[];for(const y in this._tiles)this._isIdRenderable(+y,r,c)&&p.push(this._tiles[y]);return r?p.sort((y,b)=>{const w=y.tileID,S=b.tileID,P=new o.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),k=new o.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-S.overscaledZ||k.y-P.y||k.x-P.x}).map(y=>y.tileID.key):p.map(y=>y.tileID).sort(Ym).map(y=>y.key)}hasRenderableParent(r){const c=this.findLoadedParent(r,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(r,c,p){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(c||!this._tiles[r].holdingForFade())&&(p||!this._shadowCasterTiles[r])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,c){const p=this._tiles[r];p&&(p.state!=="loading"&&(p.state=c),this._loadTile(p,this._tileLoaded.bind(this,p,r,c)))}_tileLoaded(r,c,p,y,b){if(y){if(r.state="errored",y.status!==404)this._source.fire(new o.y(y,{tile:r}));else{if(this._source.fire(new o.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:r})),!(r.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const S=this.map.painter.terrain;this.update(this.transform,S.getScaledDemTileSize(),!0),S.resetTileLookupCache(this.id)}else this.update(this.transform)}return}r.timeAdded=o.o.now(),p==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(c,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null);let w=new Map;b&&b.responseHeaders&&(w=b.responseHeaders),this._source.fire(new o.z("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id,responseHeaders:w}))}_backfillDEM(r){const c=this.getRenderableIds();for(let y=0;y<c.length;y++){const b=c[y];if(r.neighboringTiles&&r.neighboringTiles[b]){const w=this.getTileByID(b);p(r,w),p(w,r)}}function p(y,b){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let w=b.tileID.canonical.x-y.tileID.canonical.x;const S=b.tileID.canonical.y-y.tileID.canonical.y,P=Math.pow(2,y.tileID.canonical.z),k=b.tileID.key;w===0&&S===0||Math.abs(S)>1||(Math.abs(w)>1&&(Math.abs(w+P)===1?w+=P:Math.abs(w-P)===1&&(w-=P)),b.dem&&y.dem&&(y.dem.backfillBorder(b.dem,w,S),y.neighboringTiles&&y.neighboringTiles[k]&&(y.neighboringTiles[k].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,c,p,y){for(const b in this._tiles){let w=this._tiles[b];if(y[b]||!w.hasData()||w.tileID.overscaledZ<=c||w.tileID.overscaledZ>p)continue;let S=w.tileID;for(;w&&w.tileID.overscaledZ>c+1;){const k=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[k.key],w&&w.hasData()&&(S=k)}let P=S;for(;P.overscaledZ>c;)if(P=P.scaledTo(P.overscaledZ-1),r[P.key]){y[S.key]=S;break}}}findLoadedParent(r,c){if(r.key in this._loadedParentTiles){const p=this._loadedParentTiles[r.key];return p&&p.tileID.overscaledZ>=c?p:null}for(let p=r.overscaledZ-1;p>=c;p--){const y=r.scaledTo(p),b=this._getLoadedTile(y);if(b)return b}}_getLoadedTile(r){const c=this._tiles[r.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,c){c=c||this._source.tileSize;const p=Math.ceil(r.width/c)+1,y=Math.ceil(r.height/c)+1,b=Math.floor(p*y*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(S)}handleWrapJump(r){const c=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,c){const p={};for(const y in this._tiles){const b=this._tiles[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+c),p[b.tileID.key]=b}this._tiles=p;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(r,c,p,y,b){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(r,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const w=this._source.type==="batched-model";let S,P=this._source.maxzoom;const k=this.map&&this.map.painter?this.map.painter._terrain:null;if(k&&k.sourceCache===this&&k.attenuationRange()){const B=k.attenuationRange()[0],U=Math.floor(B)-Math.log2(k.getDemUpscale());P>U&&(P=U)}if(this.used||this.usedForTerrain){if(this._source.tileID)S=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(B=>new o.aQ(B.canonical.z,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y));else if(this.tileCoverLift!==0){const B=r.clone();B.tileCoverLift=this.tileCoverLift,S=B.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:P,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.minzoom<=1&&r.projection.name==="globe"&&(S.push(new o.aQ(1,0,1,0,0)),S.push(new o.aQ(1,0,1,1,0)),S.push(new o.aQ(1,0,1,0,1)),S.push(new o.aQ(1,0,1,1,1)))}else if(S=r.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:P,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.hasTile){const B=this._source.hasTile.bind(this._source);S=S.filter(U=>B(U))}}else S=[];if(S.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!cd(this._source.type)){const B=r.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),U=Math.min(B,this._source.maxzoom);if(w){const Z=r.extendTileCover(S,U);for(const W of Z)S.push(W)}else if(b){const Z=r.extendTileCoverToNearPlane(S,this.transform.getFrustum(U),U);for(const W of Z)S.push(W)}else if(this.castsShadows&&y){const Z=r.extendTileCover(S,U,y,16);for(const W of Z)this._shadowCasterTiles[W.key]=!0,S.push(W)}}const L=this._updateRetainedTiles(S);if(cd(this._source.type)&&S.length!==0){const B={},U={},Z=Object.keys(L);for(const ne of Z){const te=L[ne],le=this._tiles[ne];if(!le||le.fadeEndTime&&le.fadeEndTime<=o.o.now())continue;const he=this.findLoadedParent(te,Math.max(te.overscaledZ-Go.maxOverzooming,this._source.minzoom));he&&(this._addTile(he.tileID),B[he.tileID.key]=he.tileID),U[ne]=te}const W=S[S.length-1].overscaledZ;for(const ne in this._tiles){const te=this._tiles[ne];if(L[ne]||!te.hasData())continue;let le=te.tileID;for(;le.overscaledZ>W;){le=le.scaledTo(le.overscaledZ-1);const he=this._tiles[le.key];if(he&&he.hasData()&&U[le.key]){L[ne]=te.tileID;break}}}for(const ne in B)L[ne]||(this._coveredTiles[ne]=!0,L[ne]=B[ne])}for(const B in L)this._tiles[B].clearFadeHold();const V=o.bv(this._tiles,L);for(const B of V){const U=this._tiles[B];U.hasSymbolBuckets&&!U.holdingForFade()?U.setHoldDuration(this.map._fadeDuration):U.hasSymbolBuckets&&!U.symbolFadeFinished()||this._removeTile(+B)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const c={};if(r.length===0)return c;const p={},y=r.reduce((k,L)=>Math.min(k,L.overscaledZ),1/0),b=r[0].overscaledZ,w=Math.max(b-Go.maxOverzooming,this._source.minzoom),S=Math.max(b+Go.maxUnderzooming,this._source.minzoom),P={};for(const k of r){const L=this._addTile(k);c[k.key]=k,L.hasData()||y<this._source.maxzoom&&(P[k.key]=k)}this._retainLoadedChildren(P,y,S,c);for(const k of r){let L=this._tiles[k.key];if(L.hasData())continue;if(k.canonical.z>=this._source.maxzoom){const B=k.children(this._source.maxzoom)[0],U=this.getTile(B);if(U&&U.hasData()){c[B.key]=B;continue}}else{const B=k.children(this._source.maxzoom);if(c[B[0].key]&&c[B[1].key]&&c[B[2].key]&&c[B[3].key])continue}let V=L.wasRequested();for(let B=k.overscaledZ-1;B>=w;--B){const U=k.scaledTo(B);if(p[U.key]||(p[U.key]=!0,L=this.getTile(U),!L&&V&&(L=this._addTile(U)),L&&(c[U.key]=U,V=L.wasRequested(),L.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const c=[];let p,y=this._tiles[r].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){p=this._loadedParentTiles[y.key];break}c.push(y.key);const b=y.scaledTo(y.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;y=b}for(const b of c)this._loadedParentTiles[b]=p}}_addTile(r){let c=this._tiles[r.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[r.key]||this._reloadTile(r.key,"reloading"),c;c=this._cache.getAndRemove(r),c&&(this._setTileReloadTimer(r.key,c),c.tileID=r,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,c)));const p=!!c;if(!p){const y=this.map?this.map.painter:null,b=this._source.tileSize*r.overscaleFactor();c=this._source.type==="raster-array"?new Xm(r,b,this.transform.tileZoom,y,this._isRaster):new ld(r,b,this.transform.tileZoom,y,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,r.key,c.state))}return c.uses++,this._tiles[r.key]=c,p||this._source.fire(new o.z("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(r,c){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const p=c.getExpiryTimeout();p&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},p))}_removeTile(r){const c=this._tiles[r];c&&(c.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,c,p){const y=[],b=this.transform;if(!b)return y;const w=b.projection.name==="globe",S=o.aF(b.center.lng);for(const P in this._tiles){const k=this._tiles[P];if(p&&k.clearQueryDebugViz(),k.holdingForFade())continue;let L;if(w){const V=k.tileID.canonical;if(V.z===0){const B=[Math.abs(o.aA(S,...ac(V,-1))-S),Math.abs(o.aA(S,...ac(V,1))-S)];L=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(o.aA(S,...ac(V,-1))-S),Math.abs(o.aA(S,...ac(V,0))-S),Math.abs(o.aA(S,...ac(V,1))-S)];L=[B.indexOf(Math.min(...B))-1]}}else L=[0];for(const V of L){const B=r.containsTile(k,b,c,V);B&&y.push(B)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(r){return this._getRenderableCoordinates(r)}_getRenderableCoordinates(r,c){const p=this.getRenderableIds(r,c).map(b=>this._tiles[b].tileID),y=this.transform.projection.name==="globe";for(const b of p)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=y?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return p}sortCoordinatesByDistance(r){const c=r.slice(),p=this.transform._camera.position,y=this.transform._camera.forward(),b={};for(const w of c){const S=1/(1<<w.canonical.z);b[w.key]=((w.canonical.x+.5)*S+w.wrap-p[0])*y[0]+((w.canonical.y+.5)*S-p[1])*y[1]-p[2]*y[2]}return c.sort((w,S)=>b[w.key]-b[S.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(cd(this._source.type))for(const r in this._tiles){const c=this._tiles[r];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=o.o.now())return!0}return!1}setFeatureState(r,c,p){this._state.updateState(r=r||"_geojsonTileLayer",c,p)}removeFeatureState(r,c,p){this._state.removeFeatureState(r=r||"_geojsonTileLayer",c,p)}getFeatureState(r,c){return this._state.getState(r=r||"_geojsonTileLayer",c)}setDependencies(r,c,p){const y=this._tiles[r];y&&y.setDependencies(c,p)}reloadTilesForDependencies(r,c){for(const p in this._tiles)this._tiles[p].hasDependency(r,c)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(r,c))}_preloadTiles(r,c){if(!this._sourceLoaded){const P=()=>{this._sourceLoaded&&(this._source.off("data",P),this._preloadTiles(r,c))};return void this._source.on("data",P)}const p=new Map,y=Array.isArray(r)?r:[r],b=this.map.painter.terrain,w=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const P of y){const k=P.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of k)p.set(L.key,L);this.usedForTerrain&&P.updateElevation(!1)}const S=Array.from(p.values());o.bw(S,(P,k)=>{const L=new ld(P,this._source.tileSize*P.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(L,V=>{this._source.type==="raster-dem"&&L.dem&&this._backfillDEM(L),k(V,L)})},c)}}function Ym(f,r){const c=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*r.wrap)-+(r.wrap<0);return f.overscaledZ-r.overscaledZ||p-c||r.canonical.y-f.canonical.y||r.canonical.x-f.canonical.x}function cd(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function ac(f,r){const c=1<<f.z;return[f.x/c+r,(f.x+1)/c+r]}Go.maxOverzooming=10,Go.maxUnderzooming=3;class fI{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const r=!1,c=!1;for(const p in this.style._mergedLayers){const y=this.style._mergedLayers[p];if(y.type==="fill-extrusion"||y.type==="building")this.layers.push({layer:y,visible:r,visibilityChanged:c});else if(y.type==="model"){const b=this.style.getLayerSource(y);b&&b.type==="batched-model"&&this.layers.push({layer:y,visible:r,visibilityChanged:c})}}}onNewFrame(r){this.layersGotHidden=!1;for(const c of this.layers){const p=c.layer;let y=!1;p.type==="fill-extrusion"?y=!p.isHidden(r)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="building"?y=!p.isHidden(r)&&p.paint.get("building-opacity")>0:p.type==="model"&&(y=!p.isHidden(r)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&c.visible,c.visible=y}}updateZOffset(r,c){this.currentBuildingBuckets=[];for(const y of this.layers){const b=y.layer,w=this.style.getLayerSourceCache(b);let S=1;b.type==="fill-extrusion"?S=y.visible?b.paint.get("fill-extrusion-vertical-scale"):0:b.type==="building"&&(S=y.visible?b.paint.get("building-vertical-scale"):0);let P=w?w.getTile(c):null;if(!P&&w)for(const k in w._tiles){const L=w._tiles[k];if(c.canonical.isChildOf(L.tileID.canonical)){P=L;break}}this.currentBuildingBuckets.push({bucket:P?P.getBucket(b):null,tileID:P?P.tileID:c,verticalScale:S})}r.hasAnyZOffset=!1;let p=!1;for(let y=0;y<r.symbolInstances.length;y++){const b=r.symbolInstances.get(y),w=b.zOffset,S=this._getHeightAtTileOffset(c,b.tileAnchorX,b.tileAnchorY);b.zOffset=S!==Number.NEGATIVE_INFINITY?S:w,p||w===b.zOffset||(p=!0),r.hasAnyZOffset||b.zOffset===0||(r.hasAnyZOffset=!0)}p&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,c,p,y){let b=c,w=p;if(r.canonical.z!==y.canonical.z){const S=y.canonical,P=1/(1<<r.canonical.z-S.z);b=(c+r.canonical.x*o.al)*P-S.x*o.al|0,w=(p+r.canonical.y*o.al)*P-S.y*o.al|0}return{tileX:b,tileY:w}}_getHeightAtTileOffset(r,c,p){let y,b;for(let w=0;w<this.layers.length;++w){const S=this.layers[w].layer;if(S.type!=="fill-extrusion"&&S.type!=="building")continue;const{bucket:P,tileID:k,verticalScale:L}=this.currentBuildingBuckets[w];if(!P)continue;const{tileX:V,tileY:B}=this._mapCoordToOverlappingTile(r,c,p,k),U=P.getHeightAtTileCoord(V,B);U&&U.height!==void 0&&(U.hidden?y=U.height:b=Math.max(U.height*L,b||0))}if(b!==void 0)return b;for(let w=0;w<this.layers.length;++w){const S=this.layers[w];if(S.layer.type!=="model"||!S.visible)continue;const{bucket:P,tileID:k}=this.currentBuildingBuckets[w];if(!P)continue;const{tileX:L,tileY:V}=this._mapCoordToOverlappingTile(r,c,p,k),B=P.getHeightAtTileCoord(L,V);if(B&&!B.hidden)return B.height===void 0&&y!==void 0?Math.min(B.maxHeight,y)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Tb(f,r){const c={};for(const p in f)p!=="ref"&&(c[p]=f[p]);return o.bx.forEach(p=>{p in r&&(c[p]=r[p])}),c}function ip(f){f=f.slice();const r=Object.create(null);for(let c=0;c<f.length;c++)r[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=Tb(f[c],r[f[c].ref]));return f}const li={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Qm(f,r,c){c.push({command:li.addSource,args:[f,r[f]]})}function pv(f,r,c){r.push({command:li.removeSource,args:[f]}),c[f]=!0}function Eb(f,r,c,p){pv(f,c,p),Qm(f,r,c)}function Sb(f,r,c){let p;for(p in f[c])if(f[c].hasOwnProperty(p)&&p!=="data"&&!o.by(f[c][p],r[c][p]))return!1;for(p in r[c])if(r[c].hasOwnProperty(p)&&p!=="data"&&!o.by(f[c][p],r[c][p]))return!1;return!0}function du(f,r,c,p,y,b){let w;for(w in r=r||{},f=f||{})f.hasOwnProperty(w)&&(o.by(f[w],r[w])||c.push({command:b,args:[p,w,r[w],y]}));for(w in r)r.hasOwnProperty(w)&&!f.hasOwnProperty(w)&&(o.by(f[w],r[w])||c.push({command:b,args:[p,w,r[w],y]}))}function rp(f){return f.id}function sp(f,r){return f[r.id]=r,f}function mv(f,r,c){const p=r.createTileMatrix(f,f.worldSize,c.toUnwrapped());return o.aB(new Float32Array(16),f.projMatrix,p)}function Jm(f,r,c){if(r.projection.name===c.projection.name)return f.projMatrix;const p=c.clone();return p.setProjection(r.projection),mv(p,r.getProjection(),f)}function kl(f,r,c){return r.name===c.projection.name?f.projMatrix:mv(c,r,f)}class op{constructor(r,c){this.reset(r,c)}reset(r,c){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.aA(r,0,1);let c=1,p=this._distances[c];const y=r*this.paddedLength+this.padding;for(;p<y&&c<this._distances.length;)p=this._distances[++c];const b=c-1,w=this._distances[b],S=p-w,P=S>0?(y-w)/S:0;return this.points[b].mult(1-P).add(this.points[c].mult(P))}}class gv{constructor(r,c,p){const y=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(c/p);for(let w=0;w<this.xCellCount*this.yCellCount;w++)y.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=c,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,c,p,y,b){this._forEachCell(c,p,y,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(b)}insertCircle(r,c,p,y){this._forEachCell(c-y,p-y,c+y,p+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(c),this.circles.push(p),this.circles.push(y)}_insertBoxCell(r,c,p,y,b,w){this.boxCells[b].push(w)}_insertCircleCell(r,c,p,y,b,w){this.circleCells[b].push(w)}_query(r,c,p,y,b,w){if(p<0||r>this.width||y<0||c>this.height)return!b&&[];const S=[];if(r<=0&&c<=0&&this.width<=p&&this.height<=y){if(b)return!0;for(let P=0;P<this.boxKeys.length;P++)S.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const k=this.circles[3*P],L=this.circles[3*P+1],V=this.circles[3*P+2];S.push({key:this.circleKeys[P],x1:k-V,y1:L-V,x2:k+V,y2:L+V})}return w?S.filter(w):S}return this._forEachCell(r,c,p,y,this._queryCell,S,{hitTest:b,seenUids:{box:{},circle:{}}},w),b?S.length>0:S}_queryCircle(r,c,p,y,b){const w=r-p,S=r+p,P=c-p,k=c+p;if(S<0||w>this.width||k<0||P>this.height)return!y&&[];const L=[];return this._forEachCell(w,P,S,k,this._queryCellCircle,L,{hitTest:y,circle:{x:r,y:c,radius:p},seenUids:{box:{},circle:{}}},b),y?L.length>0:L}query(r,c,p,y,b){return this._query(r,c,p,y,!1,b)}hitTest(r,c,p,y,b){return this._query(r,c,p,y,!0,b)}hitTestCircle(r,c,p,y){return this._queryCircle(r,c,p,!0,y)}_queryCell(r,c,p,y,b,w,S,P){const k=S.seenUids,L=this.boxCells[b];if(L!==null){const B=this.bboxes;for(const U of L)if(!k.box[U]){k.box[U]=!0;const Z=4*U;if(r<=B[Z+2]&&c<=B[Z+3]&&p>=B[Z+0]&&y>=B[Z+1]&&(!P||P(this.boxKeys[U]))){if(S.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[U],x1:B[Z],y1:B[Z+1],x2:B[Z+2],y2:B[Z+3]})}}}const V=this.circleCells[b];if(V!==null){const B=this.circles;for(const U of V)if(!k.circle[U]){k.circle[U]=!0;const Z=3*U;if(this._circleAndRectCollide(B[Z],B[Z+1],B[Z+2],r,c,p,y)&&(!P||P(this.circleKeys[U]))){if(S.hitTest)return w.push(!0),!0;{const W=B[Z],ne=B[Z+1],te=B[Z+2];w.push({key:this.circleKeys[U],x1:W-te,y1:ne-te,x2:W+te,y2:ne+te})}}}}}_queryCellCircle(r,c,p,y,b,w,S,P){const k=S.circle,L=S.seenUids,V=this.boxCells[b];if(V!==null){const U=this.bboxes;for(const Z of V)if(!L.box[Z]){L.box[Z]=!0;const W=4*Z;if(this._circleAndRectCollide(k.x,k.y,k.radius,U[W+0],U[W+1],U[W+2],U[W+3])&&(!P||P(this.boxKeys[Z])))return w.push(!0),!0}}const B=this.circleCells[b];if(B!==null){const U=this.circles;for(const Z of B)if(!L.circle[Z]){L.circle[Z]=!0;const W=3*Z;if(this._circlesCollide(U[W],U[W+1],U[W+2],k.x,k.y,k.radius)&&(!P||P(this.circleKeys[Z])))return w.push(!0),!0}}}_forEachCell(r,c,p,y,b,w,S,P){const k=this._convertToXCellCoord(r),L=this._convertToYCellCoord(c),V=this._convertToXCellCoord(p),B=this._convertToYCellCoord(y);for(let U=k;U<=V;U++)for(let Z=L;Z<=B;Z++)if(b.call(this,r,c,p,y,this.xCellCount*Z+U,w,S,P))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,c,p,y,b,w){const S=y-r,P=b-c,k=p+w;return k*k>S*S+P*P}_circleAndRectCollide(r,c,p,y,b,w,S){const P=(w-y)/2,k=Math.abs(r-(y+P));if(k>P+p)return!1;const L=(S-b)/2,V=Math.abs(c-(b+L));if(V>L+p)return!1;if(k<=P||V<=L)return!0;const B=k-P,U=V-L;return B*B+U*U<=p*p}}const hu={unknown:0,flipRequired:1,flipNotRequired:2},ud=Math.tan(85*Math.PI/180);function so(f,r,c,p,y,b,w){const S=o.bC();if(c)if(b.name==="globe"){const P=o.bD(y,r);o.aB(S,S,P)}else{const P=o.bE([],w);S[0]=P[0],S[1]=P[1],S[4]=P[2],S[5]=P[3],p||o.bB(S,S,y.angle)}else o.aB(S,y.labelPlaneMatrix,f);return S}function eg(f,r,c,p,y,b,w){const S=so(f,r,c,p,y,b,w);return b.name==="globe"&&c||(S[2]=S[6]=S[10]=S[14]=0),S}function ap(f,r,c,p,y,b,w){if(c){if(b.name==="globe"){const S=so(f,r,c,p,y,b,w);return o.bl(S,S),o.aB(S,f,S),S}{const S=o.bz(f),P=o.bA([]);return P[0]=w[0],P[1]=w[1],P[4]=w[2],P[5]=w[3],o.aB(S,S,P),p||o.bB(S,S,-y.angle),S}}return y.glCoordMatrix}function ka(f,r,c,p){const y=[f,r,c,1];c?o.aC(y,y,p):Jt(y,y,p);const b=y[3];return y[0]/=b,y[1]/=b,y[2]/=b,y}function Si(f,r){return Math.min(.5+f/r*.5,1.5)}function Cb(f,r){const c=f[0]/f[3],p=f[1]/f[3];return c>=-r[0]&&c<=r[0]&&p>=-r[1]&&p<=r[1]}function Ib(f,r,c,p,y,b,w,S,P,k,L=1){const V=c.transform,B=p?f.textSizeData:f.iconSizeData,U=o.bK(B,c.transform.zoom,L),Z=V.projection.name==="globe",W=[256/c.width*2+1,256/c.height*2+1],ne=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;ne.clear();let te=null;Z&&(te=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const le=f.lineVertexArray,he=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,ce=c.transform.width/c.transform.height;let Ee,ye=!1;for(let we=0;we<he.length;we++){const _e=he.get(we),{numGlyphs:pe,writingMode:Se}=_e;if(Se!==o.bL.vertical||ye||Ee===o.bL.horizontal||(ye=!0),Ee=Se,(_e.hidden||Se===o.bL.vertical)&&!ye){ol(pe,ne);continue}ye=!1;const De=new o.P(_e.tileAnchorX,_e.tileAnchorY),Me=f.elevationType==="road",He=!!V.elevation||Me;let{x:We,y:tt,z:gt}=V.projection.projectTilePoint(De.x,De.y,k.canonical),Ve=null;if(He){const Lt=Me?f.getElevationFeatureForText(we):null;Ve={getElevation:P,elevation:V.elevation,elevationFeature:Lt};const[on,Sn,Zn]=P(De,V.elevation,Lt);We+=on,tt+=Sn,gt+=Zn}const Pe=[We,tt,gt,1];if(o.aC(Pe,Pe,r),!Cb(Pe,W)){ol(pe,ne);continue}const Xe=Pe[3],Ue=Si(c.transform.getCameraToCenterDistance(V.projection),Xe),lt=o.bM(B,U,_e),St=w?lt/Ue:lt*Ue,Dt=ka(We,tt,gt,y);if(Dt[3]<=0){ol(pe,ne);continue}let bt={};const _t=o.an(f.layers[0].layout.get("text-max-angle")),Gt=Math.cos(_t),Bt=w?null:Ve,Mt=_v(_e,St,!1,S,r,y,b,f.glyphOffsetArray,le,ne,te,Dt,De,bt,ce,Bt,V.projection,k,w,Gt);ye=Mt.useVertical,Bt&&Mt.needsFlipping&&(bt={}),(Mt.notEnoughRoom||ye||Mt.needsFlipping&&_v(_e,St,!0,S,r,y,b,f.glyphOffsetArray,le,ne,te,Dt,De,bt,ce,Bt,V.projection,k,w,Gt).notEnoughRoom)&&ol(pe,ne)}p?(f.text.dynamicLayoutVertexBuffer.updateData(ne),te&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(te)):(f.icon.dynamicLayoutVertexBuffer.updateData(ne),te&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(te))}function Ab(f,r,c,p,y,b,w,S,P,k,L,V,B,U,Z,W,ne){const{lineStartIndex:te,glyphStartIndex:le,segment:he}=S,ce=le+S.numGlyphs,Ee=te+S.lineLength,ye=r.getoffsetX(le),we=r.getoffsetX(ce-1),_e=ah(f*ye,c,p,y,b,w,he,te,Ee,P,k,L,V,B,!0,U,Z,W,ne);if(!_e)return null;const pe=ah(f*we,c,p,y,b,w,he,te,Ee,P,k,L,V,B,!0,U,Z,W,ne);return pe?{first:_e,last:pe}:null}function fn(f,r,c,p){return f===o.bL.horizontal&&Math.abs(p)>Math.abs(c)?{useVertical:!0}:f===o.bL.vertical?p>0?{needsFlipping:!0}:null:r!==hu.unknown&&function(y,b){return y===0||Math.abs(b/y)>ud}(c,p)?r===hu.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function _v(f,r,c,p,y,b,w,S,P,k,L,V,B,U,Z,W,ne,te,le,he){const ce=r/24,Ee=f.lineOffsetX*ce,ye=f.lineOffsetY*ce,{lineStartIndex:we,glyphStartIndex:_e,numGlyphs:pe,segment:Se,writingMode:De,flipState:Me}=f,He=we+f.lineLength,We=tt=>{if(L){const[Xe,Ue,lt]=tt.up,St=k.length;o.bN(L,St+0,Xe,Ue,lt),o.bN(L,St+1,Xe,Ue,lt),o.bN(L,St+2,Xe,Ue,lt),o.bN(L,St+3,Xe,Ue,lt)}const[gt,Ve,Pe]=tt.point;o.bO(k,gt,Ve,Pe,tt.angle)};if(pe>1){const tt=Ab(ce,S,Ee,ye,c,V,B,f,P,b,U,W,!1,ne,te,le,he);if(!tt)return{notEnoughRoom:!0};if(p&&!c){let[gt,Ve,Pe]=tt.first.point,[Xe,Ue,lt]=tt.last.point;[gt,Ve]=ka(gt,Ve,Pe,w),[Xe,Ue]=ka(Xe,Ue,lt,w);const St=fn(De,Me,(Xe-gt)*Z,Ue-Ve);if(f.flipState=St&&St.needsFlipping?hu.flipRequired:hu.flipNotRequired,St)return St}We(tt.first);for(let gt=_e+1;gt<_e+pe-1;gt++){const Ve=ah(ce*S.getoffsetX(gt),Ee,ye,c,V,B,Se,we,He,P,b,U,W,!1,!1,ne,te,le,he);if(!Ve)return k.length-=4*(gt-_e),{notEnoughRoom:!0};We(Ve)}We(tt.last)}else{if(p&&!c){const gt=ka(B.x,B.y,0,y),Ve=we+Se+1,Pe=new o.P(P.getx(Ve),P.gety(Ve)),Xe=ka(Pe.x,Pe.y,0,y),Ue=Xe[3]>0?Xe:Da(B,Pe,gt,1,y,void 0,ne,te.canonical),lt=fn(De,Me,(Ue[0]-gt[0])*Z,Ue[1]-gt[1]);if(f.flipState=lt&&lt.needsFlipping?hu.flipRequired:hu.flipNotRequired,lt)return lt}const tt=ah(ce*S.getoffsetX(_e),Ee,ye,c,V,B,Se,we,He,P,b,U,W,!1,!1,ne,te,le,he);if(!tt)return{notEnoughRoom:!0};We(tt)}return{}}function lp(f,r,c,p,y){const{x:b,y:w,z:S}=p.projectTilePoint(f.x,f.y,r);if(!y)return ka(b,w,S,c);const[P,k,L]=y.getElevation(f,y.elevation,y.elevationFeature);return ka(b+P,w+k,S+L,c)}function Da(f,r,c,p,y,b,w,S){const P=lp(f.sub(r)._unit()._add(f),S,y,w,b);return o.av(P,c,P),o.aw(P,P),o.bH(P,c,P,p)}function ah(f,r,c,p,y,b,w,S,P,k,L,V,B,U,Z,W,ne,te,le){const he=p?f-r:f+r;let ce=he>0?1:-1,Ee=0;p&&(ce*=-1,Ee=Math.PI),ce<0&&(Ee+=Math.PI);let ye=S+w+(ce>0?0:1)|0,we=y,_e=y,pe=0,Se=0;const De=Math.abs(he),Me=[],He=[];let We=b,tt=We,gt=o.bF([]);const Ve=()=>Da(tt,We,_e,De-pe+1,L,B,W,ne.canonical);for(;pe+Se<=De;){if(ye+=ce,ye<S||ye>=P)return null;if(_e=we,tt=We,Me.push(_e),U&&He.push(tt),We=new o.P(k.getx(ye),k.gety(ye)),we=V[ye],!we){const Bt=lp(We,ne.canonical,L,W,B);we=Bt[3]>0?V[ye]=Bt:Ve()}pe+=Se;const _t=o.av([],we,_e),Gt=o.bG(_e,we);if(c&&Gt>0&&Se>0&&o.bJ(gt,_t)/(Se*Gt)<le)return null;Se=Gt,gt=_t}Z&&B&&(V[ye]&&(we=Ve(),Se=o.bG(_e,we),gt=o.av([],we,_e)),V[ye]=we);const Pe=(De-pe)/Se,Xe=We.sub(tt)._mult(Pe)._add(tt),Ue=o.bH([],_e,gt,Pe);let lt=[0,0,1],St=gt[0],Dt=gt[1];if(te&&(lt=W.upVector(ne.canonical,Xe.x,Xe.y),lt[0]!==0||lt[1]!==0||lt[2]!==1)){const _t=[lt[2],0,-lt[0]],Gt=o.bI([],lt,_t);o.aw(_t,_t),o.aw(Gt,Gt),St=o.bJ(gt,_t),Dt=o.bJ(gt,Gt)}if(c){const _t=o.bI([],lt,gt);o.aw(_t,_t),o.bH(Ue,Ue,_t,c*ce)}const bt=Ee+Math.atan2(Dt,St);return Me.push(Ue),U&&He.push(Xe),{point:Ue,angle:bt,path:Me,tilePath:He,up:lt}}function ol(f,r){const c=r.length,p=c+4*f;r.resize(p),r.float32.fill(-1/0,4*c,4*p)}function Jt(f,r,c){const p=r[0],y=r[1];return f[0]=c[0]*p+c[4]*y+c[12],f[1]=c[1]*p+c[5]*y+c[13],f[3]=c[3]*p+c[7]*y+c[15],f}const Jn=100;class Pi{constructor(r,c,p=new gv(r.width+200,r.height+200,25),y=new gv(r.width+200,r.height+200,25)){this.transform=r,this.grid=p,this.ignoredGrid=y,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Jn,this.screenBottomBoundary=r.height+Jn,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=c}placeCollisionBox(r,c,p,y,b,w,S,P,k,L,V){let B=p.projectedAnchorX,U=p.projectedAnchorY,Z=p.projectedAnchorZ;const W=p.tileAnchorX,ne=p.tileAnchorY,te=p.elevation,le=p.tileID,he=r.getProjection();if(te&&le){const[He,We,tt]=he.upVector(le.canonical,p.tileAnchorX,p.tileAnchorY),gt=he.upVectorScale(le.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=He*te*gt,U+=We*te*gt,Z+=tt*te*gt}const ce=r.projection.name==="globe",Ee=r.projection.name==="globe"?o.aj(this.transform.zoom):0;if(le&&ce&&Ee<1&&!w){const He=1<<le.canonical.z,We=o.bP(W,ne);o.bQ(We,We,1/o.al),o.bR(We,We,o.bP(le.canonical.x,le.canonical.y)),o.bQ(We,We,1/He),o.bS(We,We,o.bP(y[0],y[1])),We[0]=o.bT(We[0],-.5,.5),o.bQ(We,We,o.al);const tt=o.bU(We[0],We[1],o.al/(2*Math.PI),1);o.aC(tt,tt,b),B=o.ak(B,tt[0],Ee),U=o.ak(U,tt[1],Ee),Z=o.ak(Z,tt[2],Ee)}const ye=this.projectAndGetPerspectiveRatio(L,B,U,Z,p.tileID,he.name==="globe"||!!te||this.transform.pitch>0,he),we=k*ye.perspectiveRatio,_e=(p.x1*c+S.x-p.padding)*we+ye.point.x,pe=(p.y1*c+S.y-p.padding)*we+ye.point.y,Se=(p.x2*c+S.x+p.padding)*we+ye.point.x,De=(p.y2*c+S.y+p.padding)*we+ye.point.y,Me=ye.perspectiveRatio<=.55||ye.occluded;return!this.isInsideGrid(_e,pe,Se,De)||!P&&this.grid.hitTest(_e,pe,Se,De,V)||Me?{box:[],offscreen:!1,occluded:ye.occluded}:{box:[_e,pe,Se,De],offscreen:this.isOffscreen(_e,pe,Se,De),occluded:!1}}placeCollisionCircles(r,c,p,y,b,w,S,P,k,L,V,B,U,Z,W,ne){const te=[],le=this.transform.elevation,he=r.getProjection(),ce=r.elevationType==="road",Ee=!!le||ce,ye=o.bV.getAtTileOffsetFunc(ne,this.transform.center.lat,this.transform.worldSize,he),we=new o.P(p.tileAnchorX,p.tileAnchorY),_e=new o.P(p.tileAnchorX,p.tileAnchorY);let{x:pe,y:Se,z:De}=he.projectTilePoint(_e.x,_e.y,ne.canonical),Me=null;if(Ee){const Gt=ce?r.getElevationFeatureForText(y):null;Me={getElevation:ye,elevation:le,elevationFeature:Gt};const[Bt,Mt,Lt]=ye(we,le,Gt);pe+=Bt,Se+=Mt,De+=Lt}const He=he.name==="globe",We=this.projectAndGetPerspectiveRatio(P,pe,Se,De,ne,He||!!le||this.transform.pitch>0,he),{perspectiveRatio:tt}=We,gt=(B?S/tt:S*tt)/o.bY,Ve=ka(pe,Se,De,k),Pe=p.lineOffsetX*gt,Xe=p.lineOffsetY*gt,Ue=o.an(r.layers[0].layout.get("text-max-angle")),lt=Math.cos(Ue),St=We.signedDistanceFromCamera>0?Ab(gt,w,Pe,Xe,ce&&p.flipState===1,Ve,_e,p,b,k,{},Ee&&!B?Me:null,B&&Ee,he,ne,B,lt):null;let Dt=!1,bt=!1,_t=!0;if(St&&!We.occluded){const Gt=.5*Z*tt+W,Bt=new o.P(-100,-100),Mt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Lt=new op,{first:on,last:Sn}=St,Zn=on.path.length;let fi=[];for(let Tn=Zn-1;Tn>=1;Tn--)fi.push(on.path[Tn]);for(let Tn=1;Tn<Sn.path.length;Tn++)fi.push(Sn.path[Tn]);const Ht=2.5*Gt;L&&(fi=fi.map(([Tn,_i,Ri],Ci)=>(Ee&&!He&&(Ri=ye(Ci<Zn-1?on.tilePath[Zn-1-Ci]:Sn.tilePath[Ci-Zn+2],le,Me.elevationFeature)[2]),ka(Tn,_i,Ri,L))),fi.some(Tn=>Tn[3]<=0)&&(fi=[]));let ui=[];if(fi.length>0){let Tn=1/0,_i=-1/0,Ri=1/0,Ci=-1/0;for(const ci of fi)Tn=Math.min(Tn,ci[0]),Ri=Math.min(Ri,ci[1]),_i=Math.max(_i,ci[0]),Ci=Math.max(Ci,ci[1]);_i>=Bt.x&&Tn<=Mt.x&&Ci>=Bt.y&&Ri<=Mt.y&&(ui=[fi.map(ci=>new o.P(ci[0],ci[1]))],(Tn<Bt.x||_i>Mt.x||Ri<Bt.y||Ci>Mt.y)&&(ui=o.bW(ui,Bt.x,Bt.y,Mt.x,Mt.y)))}for(const Tn of ui){Lt.reset(Tn,.25*Gt);let _i=0;_i=Lt.length<=.5*Gt?1:Math.ceil(Lt.paddedLength/Ht)+1;for(let Ri=0;Ri<_i;Ri++){const Ci=Ri/Math.max(_i-1,1),ci=Lt.lerp(Ci),Dn=ci.x+Jn,mi=ci.y+Jn;te.push(Dn,mi,Gt,0);const yr=Dn-Gt,ir=mi-Gt,yi=Dn+Gt,ni=mi+Gt;if(_t=_t&&this.isOffscreen(yr,ir,yi,ni),bt=bt||this.isInsideGrid(yr,ir,yi,ni),!c&&this.grid.hitTestCircle(Dn,mi,Gt,U)&&(Dt=!0,!V))return{circles:[],offscreen:!1,collisionDetected:Dt,occluded:!1}}}}return{circles:!V&&Dt||!bt?[]:te,offscreen:_t,collisionDetected:Dt,occluded:We.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let p=1/0,y=1/0,b=-1/0,w=-1/0;for(const L of r){const V=new o.P(L.x+Jn,L.y+Jn);p=Math.min(p,V.x),y=Math.min(y,V.y),b=Math.max(b,V.x),w=Math.max(w,V.y),c.push(V)}const S=this.grid.query(p,y,b,w).concat(this.ignoredGrid.query(p,y,b,w)),P={},k={};for(const L of S){const V=L.key;if(P[V.bucketInstanceId]===void 0&&(P[V.bucketInstanceId]={}),P[V.bucketInstanceId][V.featureIndex])continue;const B=[new o.P(L.x1,L.y1),new o.P(L.x2,L.y1),new o.P(L.x2,L.y2),new o.P(L.x1,L.y2)];o.bX(c,B)&&(P[V.bucketInstanceId][V.featureIndex]=!0,k[V.bucketInstanceId]===void 0&&(k[V.bucketInstanceId]=[]),k[V.bucketInstanceId].push(V.featureIndex))}return k}insertCollisionBox(r,c,p,y,b){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:b},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,c,p,y,b){const w=c?this.ignoredGrid:this.grid,S={bucketInstanceId:p,featureIndex:y,collisionGroupID:b};for(let P=0;P<r.length;P+=4)w.insertCircle(S,r[P],r[P+1],r[P+2])}projectAndGetPerspectiveRatio(r,c,p,y,b,w,S){const P=[c,p,y,1];let k=!1;y||this.transform.pitch>0?(o.aC(P,P,r),this.fogState&&b&&S.name!=="globe"&&(k=function(B,U,Z,W,ne,te){const le=te.calculateFogTileMatrix(ne),he=[U,Z,W];return o.af(he,he,le),Ft(B,o.ag(he),te.pitch,te._fov)}(this.fogState,c,p,y,b.toUnwrapped(),this.transform)>.9)):Jt(P,P,r);const L=P[3];return{point:new o.P((P[0]/L+1)/2*this.transform.width+Jn,(-P[1]/L+1)/2*this.transform.height+Jn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/L*.5,1.5),signedDistanceFromCamera:L,occluded:w&&P[2]>L||k}}isOffscreen(r,c,p,y){return p<Jn||r>=this.screenRightBoundary||y<Jn||c>this.screenBottomBoundary}isInsideGrid(r,c,p,y){return p>=0&&r<this.gridRightBoundary&&y>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const r=o.bA([]);return o.br(r,r,[-100,-100,0]),r}}class Mo{constructor(r,c,p,y){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?c:-c))):y&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Dl{constructor(r,c,p,y,b,w=!1){this.text=new Mo(r?r.text:null,c,p,b),this.icon=new Mo(r?r.icon:null,c,y,b),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class wi{constructor(r,c,p,y=!1){this.text=r,this.icon=c,this.skipFade=p,this.clipped=y}}class tg{constructor(){this.invProjMatrix=o.bC(),this.viewportMatrix=o.bC(),this.circles=[]}}class cp{constructor(r,c,p,y,b){this.bucketInstanceId=r,this.featureIndex=c,this.sourceLayerIndex=p,this.bucketIndex=y,this.tileID=b}}class up{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const c=++this.maxGroupID;this.collisionGroups[r]={ID:c,predicate:p=>p.collisionGroupID===c}}return this.collisionGroups[r]}}function Xs(f,r,c,p,y){const{horizontalAlign:b,verticalAlign:w}=o.c1(f),S=-(b-.5)*r,P=-(w-.5)*c,k=o.c2(f,p);return new o.P(S+k[0]*y,P+k[1]*y)}function Gr(f,r,c,p,y){const b=new o.P(f,r);return c&&b._rotate(p?y:-y),b}class pI{constructor(r,c,p,y,b,w){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Pi(this.transform,b),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new up(p),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(r,c,p,y,b=1){const w=p.getBucket(c),S=p.latestFeatureIndex;if(!w||!S||c.fqid!==w.layerIds[0])return;const P=w.layers[0].layout,k=w.layers[0].paint,L=p.collisionBoxArray,V=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),B=p.tileSize/o.al,U=p.tileID.toUnwrapped();this.transform.setProjection(w.projection);const Z=(W=p.tileID,ne=w.getProjection(),te=this.transform,ne.name===this.projection?te.calculateProjMatrix(W.toUnwrapped()):mv(te,ne,W));var W,ne,te;const le=P.get("text-pitch-alignment")==="map",he=P.get("text-rotation-alignment")==="map";c.compileFilter(c.options);const ce=c.dynamicFilter(),Ee=c.dynamicFilterNeedsFeature(),ye=this.transform.calculatePixelsToTileUnitsMatrix(p),we=eg(Z,p.tileID.canonical,le,he,this.transform,w.getProjection(),ye);let _e=null;const pe=w.getProjection().createInversionMatrix(this.transform,p.tileID.canonical);if(le){const Pe=ap(Z,p.tileID.canonical,le,he,this.transform,w.getProjection(),ye);_e=o.aB([],this.transform.labelPlaneMatrix,Pe)}let Se=null;ce&&p.latestFeatureIndex&&(Se={unwrappedTileID:U,dynamicFilter:ce,dynamicFilterNeedsFeature:Ee}),this.retainedQueryData[w.bucketInstanceId]=new cp(w.bucketInstanceId,S,w.sourceLayerIndex,w.index,p.tileID);const[De,Me]=w.layers[0].layout.get("text-size-scale-range"),He=o.aA(b,De,Me),[We,tt]=P.get("icon-size-scale-range"),gt=o.aA(b,We,tt),Ve={bucket:w,layout:P,paint:k,posMatrix:Z,invMatrix:pe,mercatorCenter:[o.aF(this.transform.center.lng),o.aJ(this.transform.center.lat)],textLabelPlaneMatrix:we,labelToScreenMatrix:_e,clippingData:Se,scale:V,textPixelRatio:B,holdingForFade:p.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:o.bK(w.textSizeData,this.transform.zoom,He),partiallyEvaluatedIconSize:o.bK(w.iconSizeData,this.transform.zoom,gt),collisionGroup:this.collisionGroups.get(w.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(y)for(const Pe of w.sortKeyRanges){const{sortKey:Xe,symbolInstanceStart:Ue,symbolInstanceEnd:lt}=Pe;r.push({sortKey:Xe,symbolInstanceStart:Ue,symbolInstanceEnd:lt,parameters:Ve})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Ve})}attemptAnchorPlacement(r,c,p,y,b,w,S,P,k,L,V,B,U,Z,W,ne,te,le,he,ce,Ee){const{textOffset0:ye,textOffset1:we,crossTileID:_e}=W,pe=[ye,we],Se=Xs(r,w,S,pe,P),De=this.collisionIndex.placeCollisionBox(te,P,c,p,y,b,Gr(Se.x,Se.y,k,L,this.transform.angle),Z,V,B,U.predicate);if(he){const Me=te.getSymbolInstanceIconSize(Ee,this.transform.zoom,W.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(te,Me,he,p,y,b,Gr(Se.x,Se.y,k,L,this.transform.angle),Z,V,B,U.predicate).box.length===0)return}if(De.box.length>0){let Me;return this.prevPlacement&&this.prevPlacement.variableOffsets[_e]&&this.prevPlacement.placements[_e]&&this.prevPlacement.placements[_e].text&&(Me=this.prevPlacement.variableOffsets[_e].anchor),this.variableOffsets[_e]={textOffset:pe,width:w,height:S,anchor:r,textScale:P,prevAnchor:Me},this.markUsedJustification(te,r,W,le),te.allowVerticalPlacement&&(this.markUsedOrientation(te,le,W),this.placedOrientations[_e]=le),{shift:Se,placedGlyphBoxes:De}}}placeLayerBucketPart(r,c,p,y,b=1){const{bucket:w,layout:S,paint:P,posMatrix:k,textLabelPlaneMatrix:L,labelToScreenMatrix:V,clippingData:B,textPixelRatio:U,mercatorCenter:Z,invMatrix:W,holdingForFade:ne,collisionBoxArray:te,partiallyEvaluatedTextSize:le,partiallyEvaluatedIconSize:he,collisionGroup:ce,latestFeatureIndex:Ee}=r.parameters,ye=S.get("text-optional"),we=S.get("icon-optional"),_e=S.get("text-allow-overlap"),pe=S.get("icon-allow-overlap"),Se=S.get("text-rotation-alignment")==="map",De=S.get("icon-rotation-alignment")==="map",Me=S.get("text-pitch-alignment")==="map",He=P.get("symbol-z-offset"),We=S.get("symbol-elevation-reference")==="sea",tt=S.get("symbol-placement"),[gt,Ve]=S.get("text-size-scale-range"),[Pe,Xe]=S.get("icon-size-scale-range"),Ue=o.aA(b,gt,Ve),lt=o.aA(b,Pe,Xe),St=S.get("text-variable-anchor"),Dt=Se&&tt!=="point",bt=De&&tt!=="point",_t=St&&w.hasTextData(),Gt=w.hasIconTextFit()&&_t&&w.hasIconData();this.transform.setProjection(w.projection);const Bt=_t||Dt,Mt=bt||Gt;let Lt=_e&&(pe||!w.hasIconData()||we),on=pe&&(_e||!w.hasTextData()||ye);const Sn=!He.isConstant();!w.collisionArrays&&te&&w.deserializeCollisionBoxes(te),p&&y&&w.updateCollisionDebugBuffers(this.transform.zoom,te,Ue,lt);const Zn=(Ht,ui,Tn)=>{const{crossTileID:_i,numVerticalGlyphVertices:Ri}=Ht;let Ci=null;if(B&&B.dynamicFilterNeedsFeature||Sn){const Tr=this.retainedQueryData[w.bucketInstanceId];Ci=Ee.loadFeature({featureIndex:Ht.featureIndex,bucketIndex:Tr.bucketIndex,sourceLayerIndex:Tr.sourceLayerIndex,layoutVertexArrayOffset:0});const Nr=Ci.properties?Ci.properties.worldview:null;if(w.localizable&&w.worldview&&typeof Nr=="string")if(Nr==="all")Ci.properties.$localized=!0;else{if(!Nr.split(",").includes(w.worldview))return;Ci.properties.$localized=!0,Ci.properties.worldview=w.worldview}}if(B&&!(0,B.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:w.worldview},Ci,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new o.P(Ht.tileAnchorX,Ht.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[_i]=new wi(!1,!1,!1,!0),void c.add(_i);const ci=He.evaluate(Ci,{});if(c.has(_i))return;if(ne)return void(this.placements[_i]=new wi(!1,!1,!1));let Dn=!1,mi=!1,yr=!0,ir=!1,yi=!1,ni=null,Nn={box:null,offscreen:null,occluded:null},Xi={box:null},Ar=null,hr=null,Fi=null,bo=0,Vs=0,ts=0;Tn.textFeatureIndex?bo=Tn.textFeatureIndex:Ht.useRuntimeCollisionCircles&&(bo=Ht.featureIndex),Tn.verticalTextFeatureIndex&&(Vs=Tn.verticalTextFeatureIndex);const Qs=w.elevationFeatures?w.elevationFeatures[Ht.elevationFeatureIndex]:void 0,Js=Tr=>{Tr.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const Nr=this.transform.elevation;Tr.elevation=We?ci:ci+o.bV.getAtTileOffset(Tr.tileID,new o.P(Tr.tileAnchorX,Tr.tileAnchorY),Nr,Qs),Tr.elevation+=Ht.zOffset},Ds=Tn.textBox;if(Ds){Js(Ds);const Tr=zi=>{let Vr=o.bL.horizontal;if(w.allowVerticalPlacement&&!zi&&this.prevPlacement){const vr=this.prevPlacement.placedOrientations[_i];vr&&(this.placedOrientations[_i]=vr,Vr=vr,this.markUsedOrientation(w,Vr,Ht))}return Vr},Nr=(zi,Vr)=>{if(w.allowVerticalPlacement&&Ri>0&&Tn.verticalTextBox){for(const vr of w.writingModes)if(vr===o.bL.vertical?(Nn=Vr(),Xi=Nn):Nn=zi(),Nn&&Nn.box&&Nn.box.length)break}else Nn=zi()};if(St){let zi=St;if(this.prevPlacement&&this.prevPlacement.variableOffsets[_i]){const fr=this.prevPlacement.variableOffsets[_i];zi.indexOf(fr.anchor)>0&&(zi=zi.filter(Va=>Va!==fr.anchor),zi.unshift(fr.anchor))}const Vr=(fr,Va,zp)=>{const hl=w.getSymbolInstanceTextSize(le,Ht,this.transform.zoom,ui),jp=(fr.x2-fr.x1)*hl+2*fr.padding,Mh=(fr.y2-fr.y1)*hl+2*fr.padding,Ul=Ht.hasIconTextFit&&!pe?Va:null;Ul&&Js(Ul);let bc={box:[],offscreen:!1,occluded:!1};const kh=_e?2*zi.length:zi.length;for(let Au=0;Au<kh;++Au){const wc=this.attemptAnchorPlacement(zi[Au%zi.length],fr,Z,W,Bt,jp,Mh,hl,Se,Me,U,k,ce,Au>=zi.length,Ht,ui,w,zp,Ul,le,he);if(wc&&(bc=wc.placedGlyphBoxes,bc&&bc.box&&bc.box.length)){Dn=!0,ni=wc.shift;break}}return bc};Nr(()=>Vr(Ds,Tn.iconBox,o.bL.horizontal),()=>{const fr=Tn.verticalTextBox;return fr&&Js(fr),w.allowVerticalPlacement&&!(Nn&&Nn.box&&Nn.box.length)&&Ri>0&&fr?Vr(fr,Tn.verticalIconBox,o.bL.vertical):{box:null,offscreen:null,occluded:null}}),Nn&&(Dn=Nn.box,yr=Nn.offscreen,ir=Nn.occluded);const vr=Tr(!(!Nn||!Nn.box));if(!Dn&&this.prevPlacement){const fr=this.prevPlacement.variableOffsets[_i];fr&&(this.variableOffsets[_i]=fr,this.markUsedJustification(w,fr.anchor,Ht,vr))}}else{const zi=(Vr,vr)=>{const fr=w.getSymbolInstanceTextSize(le,Ht,this.transform.zoom,ui),Va=this.collisionIndex.placeCollisionBox(w,fr,Vr,Z,W,Bt,new o.P(0,0),_e,U,k,ce.predicate);return Va&&Va.box&&Va.box.length&&(this.markUsedOrientation(w,vr,Ht),this.placedOrientations[_i]=vr),Va};Nr(()=>zi(Ds,o.bL.horizontal),()=>{const Vr=Tn.verticalTextBox;return w.allowVerticalPlacement&&Ri>0&&Vr?(Js(Vr),zi(Vr,o.bL.vertical)):{box:null,offscreen:null,occluded:null}}),Tr(!!(Nn&&Nn.box&&Nn.box.length))}}if(Ar=Nn,Dn=Ar&&Ar.box&&Ar.box.length>0,yr=Ar&&Ar.offscreen,ir=Ar&&Ar.occluded,Ht.useRuntimeCollisionCircles){const Tr=Ht.centerJustifiedTextSymbolIndex>=0?Ht.centerJustifiedTextSymbolIndex:Ht.verticalPlacedTextSymbolIndex,Nr=w.text.placedSymbolArray.get(Tr),zi=o.bM(w.textSizeData,le,Nr),Vr=S.get("text-padding");hr=this.collisionIndex.placeCollisionCircles(w,_e,Nr,Tr,w.lineVertexArray,w.glyphOffsetArray,zi,k,L,V,p,Me,ce.predicate,Ht.collisionCircleDiameter*zi/o.bY,Vr,this.retainedQueryData[w.bucketInstanceId].tileID),Dn=_e||hr.circles.length>0&&!hr.collisionDetected,yr=yr&&hr.offscreen,ir=hr.occluded}if(Tn.iconFeatureIndex&&(ts=Tn.iconFeatureIndex),Tn.iconBox){const Tr=Nr=>{Js(Nr);const zi=Ht.hasIconTextFit&&ni?Gr(ni.x,ni.y,Se,Me,this.transform.angle):new o.P(0,0),Vr=w.getSymbolInstanceIconSize(he,this.transform.zoom,Ht.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,Vr,Nr,Z,W,Mt,zi,pe,U,k,ce.predicate)};Xi&&Xi.box&&Xi.box.length&&Tn.verticalIconBox?(Fi=Tr(Tn.verticalIconBox),mi=Fi.box.length>0):(Fi=Tr(Tn.iconBox),mi=Fi.box.length>0),yr=yr&&Fi.offscreen,yi=Fi.occluded}const la=ye||Ht.numHorizontalGlyphVertices===0&&Ri===0,Ba=we||Ht.numIconVertices===0;if(la||Ba?Ba?la||(mi=mi&&Dn):Dn=mi&&Dn:mi=Dn=mi&&Dn,Dn&&Ar&&Ar.box&&this.collisionIndex.insertCollisionBox(Ar.box,S.get("text-ignore-placement"),w.bucketInstanceId,Xi&&Xi.box&&Vs?Vs:bo,ce.ID),mi&&Fi&&this.collisionIndex.insertCollisionBox(Fi.box,S.get("icon-ignore-placement"),w.bucketInstanceId,ts,ce.ID),hr&&(Dn&&this.collisionIndex.insertCollisionCircles(hr.circles,S.get("text-ignore-placement"),w.bucketInstanceId,bo,ce.ID),p)){const Tr=w.bucketInstanceId;let Nr=this.collisionCircleArrays[Tr];Nr===void 0&&(Nr=this.collisionCircleArrays[Tr]=new tg);for(let zi=0;zi<hr.circles.length;zi+=4)Nr.circles.push(hr.circles[zi+0]),Nr.circles.push(hr.circles[zi+1]),Nr.circles.push(hr.circles[zi+2]),Nr.circles.push(hr.collisionDetected?1:0)}const No=w.projection.name!=="globe";Lt=Lt&&(No||!ir),on=on&&(No||!yi),this.placements[_i]=new wi(Dn||Lt,mi||on,yr||w.justReloaded),c.add(_i)},fi=this.retainedQueryData[w.bucketInstanceId].tileID;if(w.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(w,fi),w.elevationType==="road"&&w.updateRoadElevation(fi.canonical),w.updateZOffset(),w.sortFeaturesByY){const Ht=w.getSortedSymbolIndexes(this.transform.angle);for(let ui=Ht.length-1;ui>=0;--ui){const Tn=Ht[ui];Zn(w.symbolInstances.get(Tn),Tn,w.collisionArrays[Tn])}w.hasAnyZOffset&&o.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const Ht=w.getSortedIndexesByZOffset();for(let ui=0;ui<Ht.length;++ui){const Tn=Ht[ui];Zn(w.symbolInstances.get(Tn),Tn,w.collisionArrays[Tn])}}else for(let Ht=r.symbolInstanceStart;Ht<r.symbolInstanceEnd;Ht++)Zn(w.symbolInstances.get(Ht),Ht,w.collisionArrays[Ht]);if(p&&w.bucketInstanceId in this.collisionCircleArrays){const Ht=this.collisionCircleArrays[w.bucketInstanceId];o.bl(Ht.invProjMatrix,k),Ht.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(r,c,p,y){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:P,crossTileID:k}=p,L=o.c3(c),V=y===o.bL.vertical?P:L==="left"?b:L==="center"?w:L==="right"?S:-1;b>=0&&(r.text.placedSymbolArray.get(b).crossTileID=V>=0&&b!==V?0:k),w>=0&&(r.text.placedSymbolArray.get(w).crossTileID=V>=0&&w!==V?0:k),S>=0&&(r.text.placedSymbolArray.get(S).crossTileID=V>=0&&S!==V?0:k),P>=0&&(r.text.placedSymbolArray.get(P).crossTileID=V>=0&&P!==V?0:k)}markUsedOrientation(r,c,p){const y=c===o.bL.horizontal||c===o.bL.horizontalOnly?c:0,b=c===o.bL.vertical?c:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:k}=p,L=r.text.placedSymbolArray;w>=0&&(L.get(w).placedOrientation=y),S>=0&&(L.get(S).placedOrientation=y),P>=0&&(L.get(P).placedOrientation=y),k>=0&&(L.get(k).placedOrientation=b)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let p=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const y=c?c.symbolFadeChange(r):1,b=c?c.opacities:{},w=c?c.variableOffsets:{},S=c?c.placedOrientations:{};for(const P in this.placements){const k=this.placements[P],L=b[P];L?(this.opacities[P]=new Dl(L,y,k.text,k.icon,null,k.clipped),p=p||k.text!==L.text.placed||k.icon!==L.icon.placed):(this.opacities[P]=new Dl(null,y,k.text,k.icon,k.skipFade,k.clipped),p=p||k.text||k.icon)}for(const P in b){const k=b[P];if(!this.opacities[P]){const L=new Dl(k,y,!1,!1);L.isHidden()||(this.opacities[P]=L,p=p||k.text.placed||k.icon.placed)}}for(const P in w)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=w[P]);for(const P in S)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=S[P]);p?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:r)}updateLayerOpacities(r,c,p,y){y&&(this.lastReplacementSourceUpdateTime=y.updateTime);const b=new Set;for(const w of c){const S=w.getBucket(r);S&&w.latestFeatureIndex&&r.fqid===S.layerIds[0]&&(this.updateBucketOpacities(S,b,w,w.collisionBoxArray,p,y,w.tileID,r.scope),S.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,w.tileID),S.elevationType==="road"&&S.updateRoadElevation(w.tileID.canonical),S.updateZOffset())}}updateBucketOpacities(r,c,p,y,b,w,S,P){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const k=r.layers[0].layout,L=r.layers[0].paint,V=!!r.layers[0].dynamicFilter(),B=new Dl(null,0,!1,!1,!0),U=k.get("text-allow-overlap"),Z=k.get("icon-allow-overlap"),W=k.get("text-variable-anchor"),ne=k.get("text-rotation-alignment")==="map",te=k.get("text-pitch-alignment")==="map",le=L.get("symbol-z-offset"),he=k.get("symbol-elevation-reference")==="sea",ce=!le.isConstant(),Ee=new Dl(null,0,U&&(Z||!r.hasIconData()||k.get("icon-optional")),Z&&(U||!r.hasTextData()||k.get("text-optional")),!0);!r.collisionArrays&&y&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(y);const ye=(_e,pe,Se)=>{for(let De=0;De<pe/4;De++)_e.opacityVertexArray.emplaceBack(Se)};let we=0;w&&r.updateReplacement(S,w);for(let _e=0;_e<r.symbolInstances.length;_e++){const pe=r.symbolInstances.get(_e),{numHorizontalGlyphVertices:Se,numVerticalGlyphVertices:De,crossTileID:Me,numIconVertices:He,tileAnchorX:We,tileAnchorY:tt}=pe;let gt=null;const Ve=this.retainedQueryData[r.bucketInstanceId];ce&&pe&&Ve&&(gt=p.latestFeatureIndex.loadFeature({featureIndex:pe.featureIndex,bucketIndex:Ve.bucketIndex,sourceLayerIndex:Ve.sourceLayerIndex,layoutVertexArrayOffset:0}));const Pe=le.evaluate(gt,{}),Xe=c.has(Me);let Ue=this.opacities[Me];Xe?Ue=B:Ue||(Ue=Ee,this.opacities[Me]=Ue),c.add(Me);const lt=Se>0||De>0,St=He>0,Dt=this.placedOrientations[Me],bt=Dt===o.bL.vertical,_t=Dt===o.bL.horizontal||Dt===o.bL.horizontalOnly;!lt&&!St||Ue.isHidden()||we++;let Gt=!1;if((lt||St)&&w)for(const Bt of r.activeReplacements){if(o.bZ(Bt,b,o.b_.Symbol,P)||Bt.min.x>We||We>Bt.max.x||Bt.min.y>tt||tt>Bt.max.y)continue;const Mt=o.b$(We,tt,S.canonical,Bt.footprintTileId.canonical);if(Gt=o.c0(Mt,Bt.footprint),Gt)break}if(lt){const Bt=Gt?dd:_o(Ue.text);ye(r.text,Se,bt?dd:Bt),ye(r.text,De,_t?dd:Bt);const Mt=Ue.text.isHidden(),{leftJustifiedTextSymbolIndex:Lt,centerJustifiedTextSymbolIndex:on,rightJustifiedTextSymbolIndex:Sn,verticalPlacedTextSymbolIndex:Zn}=pe,fi=r.text.placedSymbolArray,Ht=Mt||bt?1:0;Lt>=0&&(fi.get(Lt).hidden=Ht),on>=0&&(fi.get(on).hidden=Ht),Sn>=0&&(fi.get(Sn).hidden=Ht),Zn>=0&&(fi.get(Zn).hidden=Mt||_t?1:0);const ui=this.variableOffsets[Me];ui&&this.markUsedJustification(r,ui.anchor,pe,Dt);const Tn=this.placedOrientations[Me];Tn&&(this.markUsedJustification(r,"left",pe,Tn),this.markUsedOrientation(r,Tn,pe))}if(St){const Bt=Gt?dd:_o(Ue.icon),{placedIconSymbolIndex:Mt,verticalPlacedIconSymbolIndex:Lt}=pe,on=r.icon.placedSymbolArray,Sn=Ue.icon.isHidden()?1:0;Mt>=0&&(ye(r.icon,He,bt?dd:Bt),on.get(Mt).hidden=Sn),Lt>=0&&(ye(r.icon,pe.numVerticalIconVertices,_t?dd:Bt),on.get(Lt).hidden=Sn)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Bt=r.collisionArrays[_e];if(Bt){let Mt=new o.P(0,0),Lt=!0;if(Bt.textBox||Bt.verticalTextBox){if(W){const Sn=this.variableOffsets[Me];Sn?(Mt=Xs(Sn.anchor,Sn.width,Sn.height,Sn.textOffset,Sn.textScale),ne&&Mt._rotate(te?this.transform.angle:-this.transform.angle)):Lt=!1}V&&(Lt=!Ue.clipped),Bt.textBox&&fu(r.textCollisionBox.collisionVertexArray,Ue.text.placed,!Lt||bt,Pe,he,Mt.x,Mt.y),Bt.verticalTextBox&&fu(r.textCollisionBox.collisionVertexArray,Ue.text.placed,!Lt||_t,Pe,he,Mt.x,Mt.y)}const on=Lt&&!!(!_t&&Bt.verticalIconBox);Bt.iconBox&&fu(r.iconCollisionBox.collisionVertexArray,Ue.icon.placed,on,Pe,he,pe.hasIconTextFit?Mt.x:0,pe.hasIconTextFit?Mt.y:0),Bt.verticalIconBox&&fu(r.iconCollisionBox.collisionVertexArray,Ue.icon.placed,!on,Pe,he,pe.hasIconTextFit?Mt.x:0,pe.hasIconTextFit?Mt.y:0)}}}if(r.fullyClipped=we===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=_e.invProjMatrix,r.placementViewportMatrix=_e.viewportMatrix,r.collisionCircleArray=_e.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,c){const p=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*p>r}isStale(){return this.stale}setStale(){this.stale=!0}}function fu(f,r,c,p,y,b,w){f.emplaceBack(r?1:0,c?1:0,b||0,w||0,p,y?1:0),f.emplaceBack(r?1:0,c?1:0,b||0,w||0,p,y?1:0),f.emplaceBack(r?1:0,c?1:0,b||0,w||0,p,y?1:0),f.emplaceBack(r?1:0,c?1:0,b||0,w||0,p,y?1:0)}const yv=Math.pow(2,25),dp=Math.pow(2,24),ng=Math.pow(2,17),vv=Math.pow(2,16),ig=Math.pow(2,9),go=Math.pow(2,8),lc=Math.pow(2,1);function _o(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const r=f.placed?1:0,c=Math.floor(127*f.opacity);return c*yv+r*dp+c*ng+r*vv+c*ig+r*go+c*lc+r}const dd=0;class lh{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,c,p,y,b,w){const S=this._bucketParts;for(;this._currentTileIndex<r.length;)if(c.getBucketParts(S,y,r[this._currentTileIndex],this._sortAcrossTiles,w),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((P,k)=>P.sortKey-k.sortKey));this._currentPartIndex<S.length;){const P=S[this._currentPartIndex];if(c.placeLayerBucketPart(P,this._seenCrossTileIDs,p,P.symbolInstanceStart===0,w),this._currentPartIndex++,b())return!0}return!1}}class _s{constructor(r,c,p,y,b,w,S,P,k){this.placement=new pI(r,b,w,S,P,k),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(r,c,p,y,b){const w=o.o.now(),S=()=>{const P=o.o.now()-w;return!this._forceFullPlacement&&P>2};for(;this._currentPlacementIndex>=0;){const P=c[r[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&P.visibility!=="none"&&(!P.minzoom||P.minzoom<=k)&&(!P.maxzoom||P.maxzoom>k)){const L=P,V=L.layout.get("symbol-z-elevate"),B=L.layout.get("symbol-sort-key").constantOr(1)!==void 0,U=L.layout.get("symbol-z-order"),Z=U==="viewport-y"||U==="auto"&&!(U!=="viewport-y"&&B),W=L.layout.get("text-allow-overlap")||L.layout.get("icon-allow-overlap")||L.layout.get("text-ignore-placement")||L.layout.get("icon-ignore-placement"),ne=Z&&W,te=this._inProgressLayer=this._inProgressLayer||new lh(L),le=o.B(P.source,P.scope);if(te.continuePlacement(V||ne?y[le]:p[le],this.placement,this._showCollisionBoxes,P,S,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Na=512/o.al/2;class cc{constructor(r,c,p){this.tileID=r,this.bucketInstanceId=p,this.index=new o.c4(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=r.canonical.x*o.al,b=r.canonical.y*o.al;for(let w=0;w<c.length;w++){const{key:S,crossTileID:P,tileAnchorX:k,tileAnchorY:L}=c.get(w),V=Math.floor((y+k)*Na),B=Math.floor((b+L)*Na);this.index.add(V,B),this.keys.push(S),this.crossTileIDs.push(P)}this.index.finish()}findMatches(r,c,p){const y=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),b=Na/Math.pow(2,c.canonical.z-this.tileID.canonical.z),w=c.canonical.x*o.al,S=c.canonical.y*o.al;for(let P=0;P<r.length;P++){const k=r.get(P);if(k.crossTileID)continue;const{key:L,tileAnchorX:V,tileAnchorY:B}=k,U=Math.floor((w+V)*b),Z=Math.floor((S+B)*b),W=this.index.range(U-y,Z-y,U+y,Z+y).sort((ne,te)=>ne-te);for(const ne of W){const te=this.crossTileIDs[ne];if(this.keys[ne]===L&&!p.has(te)){p.add(te),k.crossTileID=te;break}}}}}class cs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class xv{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const c=Math.round((r-this.lng)/360);if(c!==0)for(const p in this.indexes){const y=this.indexes[p],b={};for(const w in y){const S=y[w];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+c),b[S.tileID.key]=S}this.indexes[p]=b}this.lng=r}addBucket(r,c,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let b=0;b<c.symbolInstances.length;b++)c.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const y=this.usedCrossTileIDs[r.overscaledZ];for(const b in this.indexes){const w=this.indexes[b];if(Number(b)>r.overscaledZ)for(const S in w){const P=w[S];P.tileID.isChildOf(r)&&P.findMatches(c.symbolInstances,r,y)}else{const S=w[r.scaledTo(Number(b)).key];S&&S.findMatches(c.symbolInstances,r,y)}}for(let b=0;b<c.symbolInstances.length;b++){const w=c.symbolInstances.get(b);w.crossTileID||(w.crossTileID=p.generate(),y.add(w.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new cc(r,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(r,c){for(const p of c.crossTileIDs)this.usedCrossTileIDs[r].delete(p)}removeStaleBuckets(r){let c=!1;for(const p in this.indexes){const y=this.indexes[p];for(const b in y)r[y[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,y[b]),delete y[b],c=!0)}return c}}class al{constructor(){this.layerIndexes={},this.crossTileIDs=new cs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,c,p,y){let b=this.layerIndexes[r.fqid];b===void 0&&(b=this.layerIndexes[r.fqid]=new xv);let w=!1;const S={};y.name!=="globe"&&b.handleWrapJump(p);for(const P of c){const k=P.getBucket(r);k&&r.fqid===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(P.tileID,k,this.crossTileIDs)&&(w=!0),S[k.bucketInstanceId]=!0)}return b.removeStaleBuckets(S)&&(w=!0),w}pruneUnusedLayers(r){const c={};r.forEach(p=>{c[p]=!0});for(const p in this.layerIndexes)c[p]||delete this.layerIndexes[p]}}const Nl=771;class Rn{constructor(r,c,p,y){this.blendFunction=r,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=p,this.blendEquation=y}}Rn.Replace=[1,0,1,0],Rn.disabled=new Rn(Rn.Replace,o.ao.transparent,[!1,!1,!1,!1]),Rn.unblended=new Rn(Rn.Replace,o.ao.transparent,[!0,!0,!0,!0]),Rn.alphaBlended=new Rn([1,Nl,1,Nl],o.ao.transparent,[!0,!0,!0,!0]),Rn.alphaBlendedNonPremultiplied=new Rn([770,Nl,770,Nl],o.ao.transparent,[!0,!0,!0,!0]),Rn.multiply=new Rn([774,0,774,0],o.ao.transparent,[!0,!0,!0,!0]),Rn.additive=new Rn([1,1,1,1],o.ao.transparent,[!0,!0,!0,!0]);class Xt{constructor(r,c,p){this.func=r,this.mask=c,this.range=p}}Xt.ReadOnly=!1,Xt.ReadWrite=!0,Xt.disabled=new Xt(519,Xt.ReadOnly,[0,1]);const rg=7680;class yn{constructor(r,c,p,y,b,w){this.test=r,this.ref=c,this.mask=p,this.fail=y,this.depthFail=b,this.pass=w}}yn.disabled=new yn({func:519,mask:0},0,0,rg,rg,rg);const ch=1029,sg=2305;class mn{constructor(r,c,p){this.enable=r,this.mode=c,this.frontFace=p}}function Ll(f,r){const c=o.ca(f,3);o.cc(f,r),o.cg(f,3,c)}function bv(f,r){const c=o.c7([]);return o.c8(c,c,-r),o.c9(c,c,-f),c}function og(f,r){const c=[f[0],f[1],0],p=[r[0],r[1],0];if(o.ag(c)>=1e-15){const w=o.aw([],c);o.c5(p,w,o.bJ(p,w)),r[0]=p[0],r[1]=p[1]}const y=o.bI([],r,f);if(o.c6(y)<1e-15)return null;const b=Math.atan2(-y[1],y[0]);return bv(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),b)}mn.disabled=new mn(!1,ch,sg),mn.backCCW=new mn(!0,ch,sg),mn.backCW=new mn(!0,ch,2304),mn.frontCW=new mn(!0,1028,2304),mn.frontCCW=new mn(!0,1028,sg);class yo{constructor(r,c){this.position=r,this.orientation=c}get position(){return this._position}set position(r){if(r){const c=r instanceof o.ae?r:new o.ae(r[0],r[1],r[2]);this._renderWorldCopies&&(c.x=o.bT(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(r,c,p){if(this.orientation=null,!this.position)return;const y=this.position,b=p||(this._elevation?this._elevation.getAtPointOrZero(o.ae.fromLngLat(r)):0),w=o.ae.fromLngLat(r,b),S=[w.x-y.x,w.y-y.y,w.z-y.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=og(S,c)}setPitchBearing(r,c){this.orientation=bv(o.an(r),o.an(-c))}}class ag{constructor(r,c){this._transform=o.bA([]),this.orientation=c,this.position=r}get mercatorPosition(){const r=this.position;return new o.ae(r[0],r[1],r[2])}get position(){const r=o.ca(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var c;r&&o.cg(this._transform,3,[(c=r)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||o.c7([]),r&&Ll(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,c){this._orientation=bv(r,c),Ll(this._transform,this._orientation)}forward(){const r=o.ca(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=o.ca(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=o.ca(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,c){const p=new Float64Array(16);return o.bl(p,this.getWorldToCamera(r,c)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,c,p){const y=this.position;o.c5(y,y,-r);const b=new Float64Array(16);return o.bq(b,[p,p,p]),o.br(b,b,y),b[10]*=c,b}getWorldToCamera(r,c){const p=new Float64Array(16),y=new Float64Array(4),b=this.position;return o.cb(y,this._orientation),o.c5(b,b,-r),o.cc(p,y),o.br(p,p,b),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=c,p[9]*=c,p[10]*=c,p[11]*=c,p}getCameraToClipPerspective(r,c,p,y){const b=new Float64Array(16);return o.cd(b,r,c,p,y),b}getCameraToClipOrthographic(r,c,p,y,b,w){const S=new Float64Array(16);return o.ce(S,r,c,p,y,b,w),S}getDistanceToElevation(r,c=!1){const p=r===0?0:o.cf(r,c?o.a$(this.position[1]):this.position[1]),y=this.forward();return(p-this.position[2])/y[2]}clone(){return new ag([...this.position],[...this.orientation])}}const Ss={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class lg{constructor(r=0,c=0,p=0,y=0){if(isNaN(r)||r<0||isNaN(c)||c<0||isNaN(p)||p<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=c,this.left=p,this.right=y}interpolate(r,c,p){return c.top!=null&&r.top!=null&&(this.top=o.ak(r.top,c.top,p)),c.bottom!=null&&r.bottom!=null&&(this.bottom=o.ak(r.bottom,c.bottom,p)),c.left!=null&&r.left!=null&&(this.left=o.ak(r.left,c.left,p)),c.right!=null&&r.right!=null&&(this.right=o.ak(r.right,c.right,p)),this}getCenter(r,c){const p=o.aA((this.left+r-this.right)/2,0,r),y=o.aA((this.top+c-this.bottom)/2,0,c);return new o.P(p,y)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new lg(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ll=15;class wv{constructor(r,c,p,y,b,w,S){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=r||0,this._maxZoom=c||22,this._minPitch=p??0,this._maxPitch=y??60,this.setProjection(w),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new o.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new lg,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new ag,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const r=new wv(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r._allowWorldUnderZoom=this._allowWorldUnderZoom,r}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<ll}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(r,c=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(r||p)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return o.aH(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=o.cm(this.projectionOptions);const p=this.getProjection(),y=!o.by(c,p);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.cm({name:"mercator"});const c=r!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bT(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const c=-r*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=o.cn(),o.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const c=o.aA(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=o.an(r),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const c=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){const r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const r=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(r)}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let y=0,b=0;for(let w=0;w<c.length;w++){const S=new o.P(c[w][0]*this.width,p+c[w][1]*(this.height-p)),P=r.pointCoordinate(S);if(!P)continue;const k=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);y+=P[3]*k,b+=k}return b===0?NaN:y/b}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*c,y=this._mercatorZfromZoom(r),b=this._mercatorZfromZoom(this._maxZoom),w=Math.max(y-p,b);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}equals(r){const c=this.elevation,p=r.elevation,y=c!=null!=(p!=null)||c&&p&&c.exaggeration()!==p.exaggeration();return this.width===r.width&&this.height===r.height&&this.center.lng===r.center.lng&&this.center.lat===r.center.lat&&this.zoom===r.zoom&&this.bearing===r.bearing&&this.pitch===r.pitch&&this.fov===r.fov&&this.projection.name===r.projection.name&&this._edgeInsets.equals(r.padding)&&!y}computeZoomRelativeTo(r){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let p;p=r.z<this._camera.position[2]?[c.x,c.y,c.z]:[r.x,r.y,r.z];const y=o.ag(o.av([],this._camera.position,p));return o.aA(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let c=!1;if(r.orientation&&!o.cp(r.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(r.orientation)),r.position){const p=[r.position.x,r.position.y,r.position.z];o.cq(p,this._camera.position)||(this._setCameraPosition(p),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,c=new yo;return c.position=new o.ae(r[0],r[1],r[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(r){if(!o.cr(r))return!1;o.cs(r,r);const c=o.ct([],[0,0,-1],r),p=o.ct([],[0,-1,0],r);if(p[2]<0)return!1;const y=og(c,p);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(r){const c=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;r[2]=o.aA(r[2],y/p,y/c),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,c,p){this._unmodified=!1,this._edgeInsets.interpolate(r,c,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const c=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(r){const c=[new o.cu(0,r)];if(this.renderWorldCopies){const p=this.pointCoordinate(new o.P(0,0)),y=this.pointCoordinate(new o.P(this.width,0)),b=this.pointCoordinate(new o.P(this.width,this.height)),w=this.pointCoordinate(new o.P(0,this.height)),S=Math.floor(Math.min(p.x,y.x,b.x,w.x)),P=Math.floor(Math.max(p.x,y.x,b.x,w.x)),k=1;for(let L=S-k;L<=P+k;L++)L!==0&&c.push(new o.cu(L,r))}return c}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(r,c,p,y){let b=[];const w=p!=null,S=!w;if(S&&this.zoom<c||w&&p[0]===0&&p[1]===0)return b;const P=new Set,k=(V,B,U,Z,W)=>{const ne=o.cY(B,V,U,Z,W);P.has(ne)||(b.push(new o.aQ(V,B,U,Z,W)),P.add(ne))};for(let V=0;V<r.length;V++){const B=r[V];if(S&&B.canonical.z!==c||w&&y!==void 0&&y>B.canonical.z)continue;const U=B.canonical,Z=B.overscaledZ,W=B.wrap,ne=1<<U.z,te=U.x+1<ne,le=U.x>0,he=U.y+1<ne,ce=U.y>0,Ee=B.wrap-(le?0:1),ye=B.wrap+(te?0:1),we=le?U.x-1:ne-1,_e=te?U.x+1:0;if(w)p[0]<0?(k(Z,ye,U.z,_e,U.y),p[1]<0&&he&&(k(Z,W,U.z,U.x,U.y+1),k(Z,ye,U.z,_e,U.y+1)),p[1]>0&&ce&&(k(Z,W,U.z,U.x,U.y-1),k(Z,ye,U.z,_e,U.y-1))):p[0]>0?(k(Z,Ee,U.z,we,U.y),p[1]<0&&he&&(k(Z,W,U.z,U.x,U.y+1),k(Z,Ee,U.z,we,U.y+1)),p[1]>0&&ce&&(k(Z,W,U.z,U.x,U.y-1),k(Z,Ee,U.z,we,U.y-1))):p[1]<0&&he?k(Z,W,U.z,U.x,U.y+1):ce&&k(Z,W,U.z,U.x,U.y-1);else{const pe=B.visibleQuadrants;1&pe&&(k(Z,Ee,U.z,we,U.y),ce&&(k(Z,W,U.z,U.x,U.y-1),k(Z,Ee,U.z,we,U.y-1))),2&pe&&(k(Z,ye,U.z,_e,U.y),ce&&(k(Z,W,U.z,U.x,U.y-1),k(Z,ye,U.z,_e,U.y-1))),4&pe&&(k(Z,Ee,U.z,we,U.y),he&&(k(Z,W,U.z,U.x,U.y+1),k(Z,Ee,U.z,we,U.y+1))),8&pe&&(k(Z,ye,U.z,_e,U.y),he&&(k(Z,W,U.z,U.x,U.y+1),k(Z,ye,U.z,_e,U.y+1)))}}const L=[];for(const V of b)b.some(B=>V.isChildOf(B))||L.push(V);if(b=L.filter(V=>!r.some(B=>!!(V.overscaledZ<c&&B.isChildOf(V))||V.equals(B)||V.isChildOf(B))),S){const V=1<<c,B=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=[V*B.x,V*B.y],Z=4,W=Z*Z;b=b.filter(ne=>{const te=ne.canonical.x+.5-U[0],le=ne.canonical.y+.5-U[1];return te*te+le*le<W})}return b}extendTileCoverToNearPlane(r,c,p){const y=[],b=new Set;for(const le of r)b.add(le.key);const w=(le,he,ce,Ee,ye)=>{const we=o.cY(he,le,ce,Ee,ye);b.has(we)||(y.push(new o.aQ(le,he,ce,Ee,ye)),b.add(we))},S=r.reduce((le,he)=>Math.max(le,he.overscaledZ),p),P=1<<p,k=[new o.P(0,0),new o.P(o.al,0),new o.P(o.al,o.al),new o.P(0,o.al)],L=new o.P(0,0),V=new o.P(0,0),B=(le,he)=>{const ce=Math.floor(le[0]),Ee=Math.floor(le[1]),ye=(le[0]-ce)*o.al,we=(le[1]-Ee)*o.al,_e=Math.floor(he[0]),pe=Math.floor(he[1]),Se=(he[0]-_e)*o.al,De=(he[1]-pe)*o.al;for(let Me=-1;Me<=1;Me++){const He=ce+Me;if(!(He<0||He>=P)){L.x=ye-Me*o.al,V.x=Se-(He-_e)*o.al;for(let We=-1;We<=1;We++){const tt=Ee+We;L.y=we-We*o.al,V.y=De-(tt-pe)*o.al,o.cZ(L,V,k)&&w(S,0,p,He,tt)}}}},U=c.points,Z=U[o.cv],W=U[o.cw],ne=this._projectToGround(Z,U[o.cx]),te=this._projectToGround(W,U[o.cy]);return B(Z,ne),B(W,te),y}_projectToGround(r,c){return o.cz(o.cA(),r,c,r[2]/(r[2]-c[2]))}coveringTiles(r){let c=this.coveringZoomLevel(r);const p=c,y=this.elevation&&this.elevation.exaggeration(),b=y&&!r.isTerrainDEM,w=this.projection.name==="mercator";if(r.minzoom!==void 0&&c<r.minzoom)return[];r.maxzoom!==void 0&&c>r.maxzoom&&(c=r.maxzoom);const S=this.locationCoordinate(this.center),P=this.center.lat,k=1<<c,L=[k*S.x,k*S.y,0],V=this.projection.name==="globe",B=!V,U=o.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,B),Z=V?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=k*o.cf(1,this.center.lat),ne=this._camera.position[2]/o.cf(1,this.center.lat),te=[k*Z.x,k*Z.y,ne*(B?1:W)],le=V||y,he=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),ce=this.isLODDisabled(!0)?c:0;let Ee;if(this._elevation&&r.isTerrainDEM)Ee=1e4*this._elevation.exaggeration();else if(this._elevation){const Pe=this._elevation.getMinMaxForVisibleTiles();Ee=Pe?Pe.max:this._centerAltitude}else Ee=this._centerAltitude;const ye=r.isTerrainDEM?-Ee:this._elevation?this._elevation.getMinElevationBelowMSL():0,we=this.projection.isReprojectedInTileSpace?o.cC(this):1,_e=Pe=>{const Ue=new o.ae(Pe.x+25e-6,Pe.y,Pe.z),lt=new o.ae(Pe.x,Pe.y+25e-6,Pe.z),St=Pe.toLngLat(),Dt=Ue.toLngLat(),bt=lt.toLngLat(),_t=this.locationCoordinate(St),Gt=this.locationCoordinate(Dt),Bt=this.locationCoordinate(bt),Mt=Math.hypot(Gt.x-_t.x,Gt.y-_t.y),Lt=Math.hypot(Bt.x-_t.x,Bt.y-_t.y);return Math.sqrt(Mt*Lt)*we/25e-6},pe=Pe=>{const Xe=Ee,Ue=ye;return{aabb:o.cF(this,k,0,0,0,Pe,Ue,Xe,this.projection),zoom:0,x:0,y:0,minZ:Ue,maxZ:Xe,wrap:Pe,fullyVisible:!1}},Se=[];let De=[];const Me=c,He=r.reparseOverscaled?p:c,We=(ne-this._centerAltitude)*W,tt=Pe=>{if(!this._elevation||!Pe.tileID||!w)return;const Xe=this._elevation.getMinMaxForTile(Pe.tileID),Ue=Pe.aabb;Xe?(Ue.min[2]=Xe.min,Ue.max[2]=Xe.max,Ue.center[2]=(Ue.min[2]+Ue.max[2])/2):(Pe.shouldSplit=Ve(Pe),Pe.shouldSplit||(Ue.min[2]=Ue.max[2]=Ue.center[2]=this._centerAltitude))},gt=(Pe,Xe)=>{if(.707*Xe<Pe)return 1;const Ue=Xe/Pe;return Ue/(1.4144271570014144+(Math.pow(1.1,Ue-1.4144271570014144+1)-1)/(1.1-1)-1)},Ve=Pe=>{if(Pe.zoom<ce)return!0;if(Pe.zoom===Me)return!1;if(Pe.shouldSplit!=null)return Pe.shouldSplit;const Xe=Pe.aabb.distanceX(te),Ue=Pe.aabb.distanceY(te);let lt=We,St=1;if(V){lt=Pe.aabb.distanceZ(te);const Lt=Math.pow(2,Pe.zoom),on=o.a$((Pe.y+1)/Lt),Sn=o.a$(Pe.y/Lt),Zn=Math.min(Math.max(P,on),Sn),fi=o.d1(Zn)/o.d1(P);if(St=Zn===P?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,fi/this._mercatorScaleRatio),this.zoom<=o.c_&&Pe.zoom===Me-1&&fi>=.9)return!0}else if(b&&(lt=Pe.aabb.distanceZ(te)*W),this.projection.isReprojectedInTileSpace&&p<=5){const Lt=Math.pow(2,Pe.zoom),on=_e(new o.ae((Pe.x+.5)/Lt,(Pe.y+.5)/Lt));St=on>.85?1:on}if(!w&&!V){const Lt=Math.sqrt(Xe*Xe+Ue*Ue+lt*lt);let on=(1<<Me-Pe.zoom)*he*St;return on*=gt(Math.max(lt,We),Lt),Lt<on}let Dt=Number.MAX_VALUE,bt=0;const _t=Pe.aabb.getCorners(),Gt=[];for(const Lt of _t){o.av(Gt,Lt,te),V||(b?Gt[2]*=W:Gt[2]=We);const on=o.bJ(Gt,this._camera.forward());on<Dt&&(Dt=on,bt=Math.abs(Gt[2]))}let Bt=(1<<Me-Pe.zoom)*he*St;if(Bt*=gt(Math.max(bt,We),Dt),Dt<Bt)return!0;const Mt=Pe.aabb.closestPoint(L);return Mt[0]===L[0]&&Mt[1]===L[1]};if(this.renderWorldCopies)for(let Pe=1;Pe<=3;Pe++)Se.push(pe(-Pe)),Se.push(pe(Pe));for(Se.push(pe(0));Se.length>0;){const Pe=Se.pop(),Xe=Pe.x,Ue=Pe.y;let lt=Pe.fullyVisible;const St=()=>this.projection.name==="globe"&&(Pe.y===0||Pe.y===(1<<Pe.zoom)-1);if(!lt){let Dt=le?Pe.aabb.intersects(U):Pe.aabb.intersectsFlat(U);if(Dt===0&&St()){const bt=new o.cD(Pe.zoom,Xe,Ue);Dt=o.cE(this,k,bt,!0).intersects(U)}if(Dt===0)continue;lt=Dt===2}if(Pe.zoom!==Me&&Ve(Pe))for(let Dt=0;Dt<4;Dt++){const bt=(Xe<<1)+Dt%2,_t=(Ue<<1)+(Dt>>1),Gt={aabb:w?Pe.aabb.quadrant(Dt):o.cF(this,k,Pe.zoom+1,bt,_t,Pe.wrap,Pe.minZ,Pe.maxZ,this.projection),zoom:Pe.zoom+1,x:bt,y:_t,wrap:Pe.wrap,fullyVisible:lt,tileID:void 0,shouldSplit:void 0,minZ:Pe.minZ,maxZ:Pe.maxZ};b&&!V&&(Gt.tileID=new o.aQ(Pe.zoom+1===Me?He:Pe.zoom+1,Pe.wrap,Pe.zoom+1,bt,_t),tt(Gt)),Se.push(Gt)}else{const Dt=Pe.zoom===Me?He:Pe.zoom;if(r.minzoom&&r.minzoom>Dt)continue;let bt=0;if(!lt){let Mt=le?Pe.aabb.intersectsPrecise(U):Pe.aabb.intersectsPreciseFlat(U);if(Mt===0&&St()){const Lt=new o.cD(Pe.zoom,Xe,Ue);Mt=o.cE(this,k,Lt,!0).intersectsPrecise(U)}if(Mt===0)continue;if(r.calculateQuadrantVisibility)if(U.containsPoint(Pe.aabb.center))bt=15;else for(let Lt=0;Lt<4;Lt++)Pe.aabb.quadrant(Lt).intersects(U)!==0&&(bt|=1<<Lt)}const _t=L[0]-(.5+Xe+(Pe.wrap<<Pe.zoom))*(1<<c-Pe.zoom),Gt=L[1]-.5-Ue,Bt=Pe.tileID?Pe.tileID:new o.aQ(Dt,Pe.wrap,Pe.zoom,Xe,Ue);r.calculateQuadrantVisibility&&(Bt.visibleQuadrants=bt),De.push({tileID:Bt,distanceSq:_t*_t+Gt*Gt})}}if(this.fogCullDistSq){const Pe=this.fogCullDistSq,Xe=this.horizonLineFromTop();De=De.filter(Ue=>{const lt=[0,0,0,1],St=[o.al,o.al,0,1],Dt=this.calculateFogTileMatrix(Ue.tileID.toUnwrapped());o.aC(lt,lt,Dt),o.aC(St,St,Dt);const bt=o.cG([],lt,St),_t=o.cH([],lt,St),Gt=o.c$(bt,_t);if(Gt===0)return!0;let Bt=!1;const Mt=this._elevation;if(Mt&&Gt>Pe&&Xe!==0){const Lt=this.calculateProjMatrix(Ue.tileID.toUnwrapped());let on;r.isTerrainDEM||(on=Mt.getMinMaxForTile(Ue.tileID)),on||(on={min:ye,max:Ee});const Sn=o.cI(this.rotation),Zn=[Sn[0]*o.al,Sn[1]*o.al,on.max];o.af(Zn,Zn,Lt),Bt=(1-Zn[1])*this.height*.5<Xe}return Gt<Pe||Bt})}return De.sort((Pe,Xe)=>Pe.distanceSq-Xe.distanceSq).map(Pe=>Pe.tileID)}resize(r,c){this.width=r,this.height=c,this.pixelsToGLUnits=[2/r,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log2(r)}project(r){const c=o.aA(r.lat,-o.cJ,o.cJ),p=this.projection.project(r.lng,c);return new o.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,c){let p,y;const b=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;p=(c.x-b.x)/S,y=(c.y-b.y)/S}else{const S=this.pointCoordinate(c),P=this.pointCoordinate(b);p=S.x-P.x,y=S.y-P.y}const w=this.locationCoordinate(r);this.setLocation(new o.ae(w.x-p,w.y-y))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r,c){return this.projection.locationPoint(this,r,c)}locationPoint3D(r,c){return this.projection.locationPoint(this,r,c,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r,c){return this.coordinateLocation(this.pointCoordinate3D(r,c))}locationCoordinate(r,c){const p=c?o.cf(c,r.lat):void 0,y=this.projection.project(r.lng,r.lat);return new o.ae(y.x,y.y,p)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,c){const p=c??this._centerAltitude,y=[r.x,r.y,0,1],b=[r.x,r.y,1,1];o.aC(y,y,this.pixelMatrixInverse),o.aC(b,b,this.pixelMatrixInverse);const w=b[3];o.cK(y,y,1/y[3]),o.cK(b,b,1/w);const S=y[2],P=b[2];return{p0:y,p1:b,t:S===P?0:(p-S)/(P-S)}}screenPointToMercatorRay(r){const c=[r.x,r.y,0,1],p=[r.x,r.y,1,1];return o.aC(c,c,this.pixelMatrixInverse),o.aC(p,p,this.pixelMatrixInverse),o.cK(c,c,1/c[3]),o.cK(p,p,1/p[3]),c[2]=o.cf(c[2],this._center.lat)*this.worldSize,p[2]=o.cf(p[2],this._center.lat)*this.worldSize,o.cK(c,c,1/this.worldSize),o.cK(p,p,1/this.worldSize),new o.ax([c[0],c[1],c[2]],o.aw([],o.av([],p,c)))}rayIntersectionCoordinate(r){const{p0:c,p1:p,t:y}=r,b=o.cf(c[2],this._center.lat),w=o.cf(p[2],this._center.lat);return new o.ae(o.ak(c[0],p[0],y)/this.worldSize,o.ak(c[1],p[1],y)/this.worldSize,o.ak(b,w,y))}pointCoordinate(r,c=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,c)}pointCoordinate3D(r,c){if(!this.elevation)return this.pointCoordinate(r,c);let p=this.projection.pointCoordinate3D(this,r.x,r.y);if(p)return new o.ae(p[0],p[1],p[2]);let y=0,b=this.horizonLineFromTop();if(r.y>b)return this.pointCoordinate(r,c);const w=.02*b,S=r.clone();for(let P=0;P<10&&b-y>w;P++){S.y=o.ak(y,b,.66);const k=this.projection.pointCoordinate3D(this,S.x,S.y);k?(b=S.y,p=k):y=S.y}return p?new o.ae(p[0],p[1],p[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=o.cL)return!this.isPointAboveHorizon(r);const c=this.pointCoordinate(r);return c.y>=0&&c.y<=1}_coordinatePoint(r,c){const p=c&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,y=[r.x*this.worldSize,r.y*this.worldSize,p+r.toAltitude(),1];return o.aC(y,y,this.pixelMatrix),y[3]>0?new o.P(y[0]/y[3],y[1]/y[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:c}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,b=this.pointLocation3D(new o.P(c,r)),w=this.pointLocation3D(new o.P(y,r)),S=this.pointLocation3D(new o.P(y,p)),P=this.pointLocation3D(new o.P(c,p));let k=Math.min(b.lng,w.lng,S.lng,P.lng),L=Math.max(b.lng,w.lng,S.lng,P.lng),V=Math.min(b.lat,w.lat,S.lat,P.lat),B=Math.max(b.lat,w.lat,S.lat,P.lat);const U=Math.pow(2,-this.zoom)/16*270,Z=this.projection.name==="globe"?1:4,W=(ne,te,le,he,ce)=>{const Ee=(ne+le)/2,ye=(te+he)/2,we=new o.P(Ee,ye),{lng:_e,lat:pe}=this.pointLocation3D(we),Se=Math.max(0,k-_e,V-pe,_e-L,pe-B);k=Math.min(k,_e),L=Math.max(L,_e),V=Math.min(V,pe),B=Math.max(B,pe),(ce<Z||Se>U)&&(W(ne,te,Ee,ye,ce+1),W(Ee,ye,le,he,ce+1))};if(W(c,r,y,r,1),W(y,r,y,p,1),W(y,p,c,p,1),W(c,p,c,r,1),this.projection.name==="globe"){const[ne,te]=o.cM(this);ne?(B=90,L=180,k=-180):te&&(V=-90,L=180,k=-180)}return new o.aI(new o.aT(k,V),new o.aT(L,B))}_getBoundsRectangular(r,c){const{top:p,left:y}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,S=new o.P(y,p),P=new o.P(w,p),k=new o.P(w,b),L=new o.P(y,b);let V=this.pointCoordinate(S,r),B=this.pointCoordinate(P,r);const U=this.pointCoordinate(k,c),Z=this.pointCoordinate(L,c),W=(ne,te)=>(te.y-ne.y)/(te.x-ne.x);return V.y>1&&B.y>=0?V=new o.ae((1-Z.y)/W(Z,V)+Z.x,1):V.y<0&&B.y<=1&&(V=new o.ae(-Z.y/W(Z,V)+Z.x,0)),B.y>1&&V.y>=0?B=new o.ae((1-U.y)/W(U,B)+U.x,1):B.y<0&&V.y<=1&&(B=new o.ae(-U.y/W(U,B)+U.x,0)),new o.aI().extend(this.coordinateLocation(V)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(U))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=r.visibleDemTiles.reduce((p,y)=>{if(y.dem){const b=y.dem.tree;p.min=Math.min(p.min,b.minimums[0]),p.max=Math.max(p.max,b.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*r.exaggeration(),c.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-c*(1-this._horizonShift);return r?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-o.cJ,this.maxLat=o.cJ,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aF(this.minLng)*this.tileSize,this.worldMaxX=o.aF(this.maxLng)*this.tileSize,this.worldMinY=o.aJ(this.maxLat)*this.tileSize,this.worldMaxY=o.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,c){return this.projection.createTileMatrix(this,c,r)}calculateDistanceTileData(r){const c=r.key,p=this._distanceTileDataCache;if(p[c])return p[c];const y=r.canonical,b=1/this.height,w=this.cameraWorldSize,S=w/this.zoomScale(y.z),P=(y.x+Math.pow(2,y.z)*r.wrap)*S,k=y.y*S,L=this.point;L.x*=w/this.worldSize,L.y*=w/this.worldSize;const V=this.angle,B=Math.sin(-V),U=-Math.cos(-V);return p[c]={bearing:[B,U],center:[(L.x-P)*b,(L.y-k)*b],scale:S/o.al*b},p[c]}calculateFogTileMatrix(r){const c=r.key,p=this._fogTileMatrixCache;if(p[c])return p[c];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return o.aB(y,this.worldToFogMatrix,y),p[c]=new Float32Array(y),p[c]}calculateProjMatrix(r,c=!1,p=!1){const y=r.key;let b;if(b=p?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,b[y])return b[y];const w=this.calculatePosMatrix(r,this.worldSize);let S;return S=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,o.aB(w,S,w),b[y]=new Float32Array(w),b[y]}calculatePixelsToTileUnitsMatrix(r){const c=r.tileID.key,p=this._pixelsToTileUnitsCache;if(p[c])return p[c];const y=o.cN(r,this);return p[c]=y,p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const r=1/this.worldSize,c=o.bq([],[r,r,r]);return o.aB(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const c=o.cf(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(c),y=this._camera.forward(),b=o.cf(1,this._center.lat);p[2]/=b,y[2]/=b,o.aw(y,y);const w=r.raycast(p,y,r.exaggeration());if(w){const S=o.bH([],p,y,w),P=new o.ae(S[0],S[1],o.cf(S[2],o.a$(S[1]))),k=(P.z+o.ag([P.x-p[0],P.y-p[1],P.z-p[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const c=this._elevation,p=o.cf(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(p),b=c.getAtPointOrZero(new o.ae(...y)),w=this.pixelsPerMeter/this.worldSize*b,S=this._minimumHeightOverTerrain(),P=y[2]-w;if(P<=S)if(P<0||r){const k=this.locationCoordinate(this._center,this._centerAltitude),L=[y[0],y[1],k.z-y[2]],V=o.ag(L);L[2]-=(S-P)/this._pixelsPerMercatorPixel;const B=o.ag(L);if(B===0)return;o.c5(L,L,V/B*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],k.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const B=this.center;return B.lat=o.aA(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(B.lng=o.aA(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const c=this._unmodified,{x:p,y}=this.point;let b=0,w=p,S=y;const P=this.width/2,k=this.height/2,L=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(y-k<L&&(S=L+k),y+k>V&&(S=V-k),V-L<this.height&&(b=Math.max(b,this.height/(V-L)),S=(V+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,U=this.worldMaxX*this.scale,Z=this.worldSize/2-(B+U)/2;w=(p+Z+this.worldSize)%this.worldSize-Z,w-P<B&&(w=B+P),w+P>U&&(w=U-P),U-B<this.width&&(b=Math.max(b,this.width/(U-B)),w=(U+B)/2)}w===p&&S===y||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(w,S))),b&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,c=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.cf(1,this.center.lat)/o.cf(1,o.d2));const y=o.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?p:1,w=this._camera.getWorldToCamera(this.worldSize,b);let S;const P=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(P[8]=2*-r.x/this.width,P[9]=2*r.y/this.height,this.isOrthographic){let pe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Se=pe*this.aspect,De=-Se,Me=-pe;Se-=r.x,De-=r.x,pe+=r.y,Me+=r.y,S=this._camera.getCameraToClipOrthographic(De,Se,Me,pe,this._nearZ,this._farZ),((He,We,tt,gt)=>{for(let Ve=0;Ve<16;Ve++)He[Ve]=o.ak(We[Ve],tt[Ve],gt)})(S,S,P,o.d0(this.pitch>=ll?1:this.pitch/ll))}else S=P;const k=o.cP([],P,w);let L=o.cP([],S,w);if(this.projection.isReprojectedInTileSpace){const pe=this.locationCoordinate(this.center),Se=o.bA([]);o.br(Se,Se,[pe.x*this.worldSize,pe.y*this.worldSize,0]),o.aB(Se,Se,o.cQ(this)),o.br(Se,Se,[-pe.x*this.worldSize,-pe.y*this.worldSize,0]),o.aB(L,L,Se),o.aB(k,k,Se),this.inverseAdjustmentMatrix=o.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cS([],L,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=L,this.invProjMatrix=o.bl(new Float64Array(16),this.projMatrix),c){const pe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);pe[8]=2*-r.x/this.width,pe[9]=2*r.y/this.height,this.expandedFarZProjMatrix=o.cP([],pe,w)}else this.expandedFarZProjMatrix=this.projMatrix;const V=o.bl([],S);this.frustumCorners=o.cT.fromInvProjectionMatrix(V,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const B=new Float32Array(16);o.bA(B),o.cS(B,B,[1,-1,1]),o.cU(B,B,this._pitch),o.bB(B,B,this.angle);const U=o.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.bz(U);const Z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;U[8]=2*-r.x/this.width,U[9]=2*(r.y+Z)/this.height,this.skyboxMatrix=o.aB(B,U,B);const W=this.point,ne=W.x,te=W.y,le=this.width%2/2,he=this.height%2/2,ce=Math.cos(this.angle),Ee=Math.sin(this.angle),ye=ne-Math.round(ne)+ce*le+Ee*he,we=te-Math.round(te)+ce*he+Ee*le,_e=new Float64Array(L);if(o.br(_e,_e,[ye>.5?ye-1:ye,we>.5?we-1:we,0]),this.alignedProjMatrix=_e,L=o.bC(),o.cS(L,L,[this.width/2,-this.height/2,1]),o.br(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=o.bC(),o.cS(L,L,[1,-1,1]),o.br(L,L,[-1,-1,0]),o.cS(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=o.aB(new Float64Array(16),this.labelPlaneMatrix,k),this._calcFogMatrices(),this._distanceTileDataCache={},L=o.bl(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cV(this);const pe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.af(pe,pe,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,p=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,b=[r,r,c];o.c5(b,b,y),o.c5(p,p,-1),o.cW(p,p,b);const w=o.bC();o.br(w,w,p),o.cS(w,w,b),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,c,y)}_computeCameraPosition(r){const c=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),y=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-r/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-p[0]*b,y.y/this.worldSize-p[1]*b,r/this.worldSize*this._centerAltitude-p[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],y=r[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(b=Math.min((c-p)/y,1)),this._camera.position=o.bH([],this._camera.position,r,b),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,c=this._camera.forward(),{pitch:p,bearing:y}=this._camera.getPitchBearing(),b=o.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.an(this._maxPitch)),S=Math.max((r[2]-b)/Math.cos(p),w),P=this._zoomFromMercatorZ(S);o.bH(r,r,c,S),this._pitch=o.aA(p,o.an(this.minPitch),o.an(this.maxPitch)),this.angle=o.bT(y,-Math.PI,Math.PI),this._setZoom(o.aA(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ae(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,r)*this.tileSize))}zoomFromMercatorZAdjusted(r){let c=0,p=o.cL,y=0,b=1/0;for(;p-c>1e-6&&p>c;){const w=c+.5*(p-c),S=this.tileSize*Math.pow(2,w),P=this.getCameraToCenterDistance(this.projection,w,S),k=this.scaleZoom(P/(Math.max(0,r)*this.tileSize)),L=Math.abs(w-k);L<b&&(b=L,y=w),w<k?c=w:p=w}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,c){const p=Math.min(r.x,c.x),y=Math.max(r.x,c.x),b=Math.min(r.y,c.y),w=Math.max(r.y,c.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new o.P(p,b),new o.P(y,w),new o.P(p,w),new o.P(y,b)],P=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const L of S){const V=this.pointRayIntersection(L);if(V.t<0)return!0;const B=this.rayIntersectionCoordinate(V);if(B.x<P||B.y<0||B.x>k||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(r,c){const p=o.ag(o.av([],this._camera.position,r)),y=this._zoomFromMercatorZ(p)+c;return p-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([c,p,y],b){const w=[c,p,y,1];o.aC(w,w,b);const S=w[3]=Math.max(w[3],1e-6);return w[0]/=S,w[1]/=S,w[2]/=S,w}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,r))}}getCameraToCenterDistance(r,c=this.zoom,p=this.worldSize){const y=o.cO(r,c,this.width,this.height,1024),b=r.pixelSpaceConversion(this.center.lat,p,y);let w=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(w=o.ak(1,w,o.d0(this.pitch>=ll?1:this.pitch/ll))),w}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.aB(r,r,this.globeMatrix),r}getFrustum(r){return o.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,this.projection.zAxisUnit==="meters")}}const pu=(f,r)=>{if(r>0&&f.terrain&&o.w("Cutoff is currently disabled on terrain"),r<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=f.transform,p=Math.max(Math.abs(c._zoom-(f.minCutoffZoom-1)),1),y=c.isLODDisabled(!1)?o.ah(60,45,c.pitch):o.ah(30,15,c.pitch),b=c._farZ-c._nearZ,w=r*c.height,S=((1-(P=y))*c.cameraToCenterDistance+P*(c._farZ+w))*p;var P;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(S-c._nearZ)/b,(S-w-c._nearZ)/b]}}},La=2048;class hp{constructor(r,c){this.aabb=r,this.lastCascade=c}}class mI{add(r,c){const p=this.receivers[r.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],c.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],c.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],c.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],c.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],c.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],c.max[2])):this.receivers[r.key]=new hp(c,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,c,p){const y=o.d9.fromPoints(r.points);let b=0;for(const w in this.receivers){const S=this.receivers[w];if(!S||!y.intersectsAabb(S.aabb))continue;S.aabb.min=y.closestPoint(S.aabb.min),S.aabb.max=y.closestPoint(S.aabb.max);const P=S.aabb.getCorners();for(let k=0;k<p.length;k++){let L=!0;for(const V of P){const B=[V[0]*c,V[1]*c,V[2]];if(o.af(B,B,p[k].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){L=!1;break}}if(S.lastCascade=k,b=Math.max(b,k),L)break}}return b+1}}class uh{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new mI,this._depthMode=new Xt(r.context.gl.LEQUAL,Xt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,c){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const y=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||y<=0||(this._shadowLayerCount=p.style.order.reduce((Z,W)=>{const ne=p.style._mergedLayers[W];return Z+(ne.hasShadowPass()&&!ne.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const b=p.context,w=La,S=La;if(this._cascades.length===0||La!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Z=0;Z<2;++Z){const W=p._shadowMapDebug,ne=b.gl,te=b.createFramebuffer(w,S,W?1:0,"texture"),le=new o.T(b,{width:w,height:S,data:null},ne.DEPTH_COMPONENT16);if(te.depthAttachment.set(le.texture),W){const he=new o.T(b,{width:w,height:S,data:null},ne.RGBA8);te.colorAttachment0.set(he.texture)}this._cascades.push({framebuffer:te,texture:le,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cB,scale:0})}}this.shadowDirection=pp(c);let P=0;if(r.elevation){const Z=r.elevation,W=[1e4,-1e4];Z.visibleDemTiles.filter(ne=>ne.dem).forEach(ne=>{const te=ne.dem.tree;W[0]=Math.min(W[0],te.minimums[0]),W[1]=Math.max(W[1],te.maximums[0])}),W[0]!==1e4&&(P=(W[1]-W[0])*Z.exaggeration())}const k=1.5*r.cameraToCenterDistance,L=3*k,V=new Float64Array(16);for(let Z=0;Z<this._cascades.length;++Z){const W=this._cascades[Z];let ne=r.height/50,te=1;Z===0?te=k:(ne=k,te=L);const[le,he]=mu(r,this.shadowDirection,ne,te,La,P);W.scale=r.scale,W.matrix=le,W.boundingSphereRadius=he,o.bl(V,W.matrix),W.frustum=o.cB.fromInvProjectionMatrix(V,1,0,!0),W.far=te}const B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=La,this._uniformValues.u_shadowmap_0=Ss.ShadowMap0,this._uniformValues.u_shadowmap_1=Ss.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const U=p.transform.elevation;for(const Z of this._groundShadowTiles){let W={min:0,max:0};if(U){const ne=U.getMinMaxForTile(Z);ne&&(W=ne)}this.addShadowReceiver(Z.toUnwrapped(),W.min,W.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(r){this._enabled=r}drawShadowPass(r,c){if(!this.enabled)return;const p=this.painter,y=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),y.viewport.set([0,0,La,La]);for(let b=0;b<this._numCascadesToRender;++b){p.currentShadowCascade=b,y.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),y.clear({color:o.ao.white,depth:1});for(const w of r.order){const S=r._mergedLayers[w];if(!S.hasShadowPass()||S.isHidden(p.transform.zoom))continue;const P=r.getLayerSourceCache(S),k=P?c[P.id]:void 0;(S.type==="model"||k&&k.length)&&p.renderLayer(p,P,S,k)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const r=this.painter,c=r.style,p=r.context,y=p.gl,b=c.directionalLight,w=c.ambientLight;if(!b||!w)return;const S=[],P=pu(r,r.longestCutoffRange);P.shouldRenderCutoff&&S.push("RENDER_CUTOFF"),S.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&S.push("NORMAL_OFFSET");const k=uc(c,b,w),L=new Xt(y.LEQUAL,Xt.ReadOnly,r.depthRangeFor3D),V=new yn({func:y.EQUAL,mask:255},0,255,y.KEEP,y.KEEP,y.KEEP);for(const B of this._groundShadowTiles){const U=B.toUnwrapped(),Z=r.isTileAffectedByFog(B),W=r.getOrCreateProgram("groundShadow",{defines:S,overrideFog:Z});this.setupShadows(U,W),r.uploadCommonUniforms(p,W,U,null,P);const ne={u_matrix:r.transform.calculateProjMatrix(U),u_ground_shadow_factor:k};W.draw(r,y.TRIANGLES,L,V,Rn.multiply,mn.disabled,ne,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,null,r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Rn.unblended:Rn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){const c=this.painter.transform,p=c.calculatePosMatrix(r,c.worldSize);return o.aB(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(r){const c=o.bz(r);return o.aB(c,this._cascades[this.painter.currentShadowCascade].matrix,r),c}setupShadows(r,c,p){if(!this.enabled)return;const y=this.painter.transform,b=this.painter.context,w=b.gl,S=this._uniformValues,P=new Float64Array(16),k=y.calculatePosMatrix(r,y.worldSize);for(let L=0;L<this._cascades.length;L++)o.aB(P,this._cascades[L].matrix,k),S[L===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),b.activeTexture.set(w.TEXTURE0+Ss.ShadowMap0+L),this._cascades[L].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);if(this.useNormalOffset=!!p,this.useNormalOffset){const L=o.d7(r.canonical),V=2/y.tileSize*o.al/La,B=V*this._cascades[0].boundingSphereRadius,U=V*this._cascades[this._cascades.length-1].boundingSphereRadius,Z=(p==="vector-tile"?1:3)*function(W,ne,te,le,he){const ce=o.aA((W-22)/-22,0,1);return .125*(1-ce)+4*ce}(y.zoom);S.u_shadow_normal_offset=[L,B*Z,U*Z],S.u_shadow_bias=[1e-4,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(b,S)}setupShadowsFromMatrix(r,c,p=!1){if(!this.enabled)return;const y=this.painter.context,b=y.gl,w=this._uniformValues,S=new Float64Array(16);for(let P=0;P<2;P++)o.aB(S,this._cascades[P].matrix,r),w[P===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),y.activeTexture.set(b.TEXTURE0+Ss.ShadowMap0+P),this._cascades[P].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);this.useNormalOffset=p,p?(w.u_shadow_normal_offset=[1,3,3],w.u_shadow_bias=[6e-5,.0012,.012]):w.u_shadow_bias=[36e-5,.0012,.012],c.setShadowUniformValues(y,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,c,p,y){if(y[2]>=0)return{};const b=function(P,k,L){const V=L/(1<<P.canonical.z);return new o.d9([P.canonical.x*V+P.wrap*L,P.canonical.y*V+P.wrap*L,0],[(P.canonical.x+1)*V+P.wrap*L,(P.canonical.y+1)*V+P.wrap*L,k])}(r,c,p).getCorners(),w=c/-y[2];y[0]<0?(o.d8(b[0],b[0],[y[0]*w,0,0]),o.d8(b[3],b[3],[y[0]*w,0,0])):y[0]>0&&(o.d8(b[1],b[1],[y[0]*w,0,0]),o.d8(b[2],b[2],[y[0]*w,0,0])),y[1]<0?(o.d8(b[0],b[0],[0,y[1]*w,0]),o.d8(b[1],b[1],[0,y[1]*w,0])):y[1]>0&&(o.d8(b[2],b[2],[0,y[1]*w,0]),o.d8(b[3],b[3],[0,y[1]*w,0]));const S={};return S.vertices=b,S.planes=[fp(b[1],b[0],b[4]),fp(b[2],b[1],b[5]),fp(b[3],b[2],b[6]),fp(b[0],b[3],b[7])],S}addShadowReceiver(r,c,p){this._receivers.add(r,o.d9.fromTileIdAndHeight(r,c,p))}getMaxCascadeForTile(r){const c=this._receivers.get(r);return c&&c.lastCascade?c.lastCascade:0}}function fp(f,r,c){const p=o.av([],c,r),y=o.av([],f,r),b=o.bI([],p,y),w=o.ag(b);return w===0?[0,0,1,0]:(o.c5(b,b,1/w),[b[0],b[1],b[2],-o.bJ(b,r)])}function pp(f){const r=f.properties.get("direction"),c=o.d4(r.x,r.y,r.z);c[2]=o.aA(c[2],0,75);const p=o.d6([c[0],c[1],c[2]]);return o.d5(p.x,p.y,p.z)}function uc(f,r,c){const p=r.properties.get("color-use-theme")==="none",y=r.properties.get("color"),b=r.properties.get("intensity"),w=r.properties.get("direction"),S=[w.x,w.y,w.z],P=c.properties.get("color-use-theme")==="none",k=c.properties.get("color"),L=c.properties.get("intensity"),V=Math.max(o.bJ([0,0,1],S),0),B=[0,0,0];o.c5(B,k.toPremultipliedRenderColor(P?null:f.getLut(r.scope)).toArray01Linear().slice(0,3),L);const U=[0,0,0];return o.c5(U,y.toPremultipliedRenderColor(p?null:f.getLut(c.scope)).toArray01Linear().slice(0,3),V*b),o.db([B[0]>0?B[0]/(B[0]+U[0]):0,B[1]>0?B[1]/(B[1]+U[1]):0,B[2]>0?B[2]/(B[2]+U[2]):0])}function mu(f,r,c,p,y,b){const w=f.zoom,S=f.scale,P=f.worldSize,k=1/P,L=f.aspect,V=Math.sqrt(1+L*L)*Math.tan(.5*f.fovX),B=V*V,U=p-c,Z=p+c;let W,ne;B>U/Z?(W=p,ne=p*V):(W=.5*Z*(1+B),ne=.5*Math.sqrt(U*U+2*(p*p+c*c)*B+Z*Z*B*B));const te=f.projection.pixelsPerMeter(f.center.lat,P),le=f._camera.getCameraToWorldMercator(),he=[0,0,-W*k];o.af(he,he,le);let ce=ne*k;const Ee=f._edgeInsets;if(!(Ee.left===0&&Ee.top===0&&Ee.right===0&&Ee.bottom===0||Ee.left===Ee.right&&Ee.top===Ee.bottom)){const lt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?te:1),St=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,c,p);St[8]=2*-f.centerOffset.x/f.width,St[9]=2*f.centerOffset.y/f.height;const Dt=new Float64Array(16);o.cP(Dt,St,lt);const bt=new Float64Array(16);o.bl(bt,Dt);const _t=o.cB.fromInvProjectionMatrix(bt,P,w,!0);for(const Gt of _t.points){const Bt=((ye=Gt)[0]/=S,ye[1]/=S,ye[2]=o.cf(ye[2],f._center.lat),ye);ce=Math.max(ce,o.c6(o.da([],he,Bt)))}}var ye;ce*=y/(y-1);const we=Math.acos(r[2]),_e=Math.atan2(-r[0],-r[1]),pe=new ag;pe.position=he,pe.setPitchBearing(we,_e);const Se=pe.getWorldToCamera(P,te),De=ce*P,Me=Math.min(f._mercatorZfromZoom(17)*P*-2,-2*De),He=pe.getCameraToClipOrthographic(-De,De,-De,De,Me,(De+b*te)/r[2]),We=new Float64Array(16);o.aB(We,He,Se);const tt=o.d5(Math.floor(1e6*he[0])/1e6*P,Math.floor(1e6*he[1])/1e6*P,0),gt=.5*y,Ve=[0,0,0];o.af(Ve,tt,We),o.c5(Ve,Ve,gt);const Pe=[Math.floor(Ve[0]),Math.floor(Ve[1]),Math.floor(Ve[2])],Xe=[0,0,0];o.av(Xe,Ve,Pe),o.c5(Xe,Xe,-1/gt);const Ue=new Float64Array(16);return o.bA(Ue),o.br(Ue,Ue,Xe),o.aB(We,Ue,We),[We,De]}class gI extends o.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(r,c){return o.dc(this.requestManager.transformRequest(c,o.R.Model).url).then(p=>{if(!p)return;const y=o.dd(p),b=new o.de(r,c,void 0,void 0,y);return b.computeBoundsAndApplyParent(),b}).catch(p=>{if(p&&p.status===404)return null;this.fire(new o.y(new Error(`Could not load model ${r} from ${c}: ${p.message}`)))})}load(r,c,p={forceReload:!1}){this.models[c]||(this.models[c]={});const y=Object.keys(r),b=[],w=[];for(const S of y){const P=r[S];this.hasURLBeenRequested(P)&&!p.forceReload||(this.modelByURL[P]={modelId:S,scope:c},b.push(this.loadModel(S,P)),w.push(S)),this.models[c][S]||(this.models[c][S]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+w.length,Promise.allSettled(b).then(S=>{for(let P=0;P<S.length;P++){const{status:k}=S[P];if(k==="rejected")continue;const{value:L}=S[P];this.models[c][w[P]]||(this.models[c][w[P]]={model:null,numReferences:1}),this.models[c][w[P]].model=L}this.numModelsLoading[c]-=w.length,this.fire(new o.z("data",{dataType:"style"}))}).catch(S=>{this.fire(new o.y(new Error(`Could not load models: ${S.message}`)))})}isLoaded(){for(const r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,c,p={exactIdMatch:!1}){return!!(p.exactIdMatch?this.getModel(r,c):this.getModelByURL(this.modelUris[c][r]))}getModel(r,c){return this.models[c]||(this.models[c]={}),this.models[c][r]?this.models[c][r].model:void 0}getModelByURL(r){if(!r)return null;const c=this.modelByURL[r];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(r,c){return this.models[c]&&this.models[c][r]!==void 0}getModelURIs(r){return this.modelUris[r]||{}}addModel(r,c,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const y=this.requestManager.normalizeModelURL(c);if((this.hasModel(r,p,{exactIdMatch:!0})||this.hasModelBeenAdded(r,p))&&this.modelUris[p][r]===y)this.models[p][r].numReferences++;else if(this.hasURLBeenRequested(y)){const{scope:b,modelId:w}=this.modelByURL[y];this.models[b][w].numReferences++}else this.modelUris[p][r]=y,this.load({[r]:this.modelUris[p][r]},p)}addModelURLs(r,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p=this.modelUris[c];for(const y in r)p[y]=this.requestManager.normalizeModelURL(r[y])}reloadModels(r){this.load(this.modelUris[r],r,{forceReload:!0})}addModelsFromBucket(r,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p={};for(const y of r)this.hasModel(y,c,{exactIdMatch:!0})||this.hasURLBeenRequested(y)?this.models[c][y].numReferences++:this.modelUris[c][y]&&!this.hasURLBeenRequested(y)?p[y]=this.modelUris[c][y]:!this.hasURLBeenRequested(y)&&o.df(y,!1)&&(this.modelUris[c][y]=this.requestManager.normalizeModelURL(y),p[y]=this.modelUris[c][y]);this.load(p,c)}hasURLBeenRequested(r){return this.modelByURL[r]!==void 0}removeModel(r,c,p=!1,y=!1){if(this.models[c]&&this.models[c][r]&&(this.models[c][r].numReferences--,this.models[c][r].numReferences===0||y)){const b=this.modelUris[c][r];p||delete this.modelUris[c][r],delete this.modelByURL[b];const w=this.models[c][r].model;if(!w)return;delete this.models[c][r],w.destroy()}}destroy(){for(const r of Object.keys(this.models))for(const c of Object.keys(this.models[r])){const p=this.models[r][c].model;delete this.models[r][c],p&&p.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,c){this.models[c]||(this.models[c]={});for(const p in this.models[c])this.models[c][p].model&&this.models[c][p].model.upload(r.context)}}const Tv=o.a6.colorTheme,_I=new o.a9({data:new o.aa(Tv.data)});function Pb(f){if(!f.metadata||!f.metadata.content_area)return;const r=o.o.devicePixelRatio,{left:c,top:p,width:y,height:b}=f.metadata.content_area,w=c*r,S=p*r;return[w,S,w+y*r,S+b*r]}function Rb(f){if(f)return f.map(([r,c])=>[r*o.o.devicePixelRatio,c*o.o.devicePixelRatio])}class Ev{constructor(r,c,p){this.id=r,this.scope=c,this.sourceCache=p,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(r){this.missingRequests.has(r.name)||this.pendingRequests.has(r.name)||this.pendingRequests.add(r.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const r=new Map;if(!this.sourceCache.loaded())return r;const c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return r;const p=this.sourceCache.getSource();if(!(p instanceof ro))return r;const y=c.map(w=>this.sourceCache.getTile(w)),b=p.getImages(y,Array.from(this.pendingRequests));for(const[w,S]of b)r.set(o.I.from({name:w,iconsetId:this.id}),S),this.pendingRequests.delete(w);for(const w of this.pendingRequests)this.missingRequests.add(w);return this.pendingRequests.clear(),r}}const gu=(f,r)=>fe(f,r&&r.filter(c=>c.identifier!=="source.canvas")),Mb=o.aH(li,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),kb=o.aH(li,["setCenter","setZoom","setBearing","setPitch"]),cg=new Set(["background","sky","slot","custom"]),_u={version:8,layers:[],sources:{}},mp={duration:300,delay:0};class Oa extends o.E{constructor(r,c={}){super(),this.map=r,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=Object.assign({},mp),this._buildingIndex=new fI(this),this.crossTileSymbolIndex=new al,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=c.styleChanges||new xr,this._hasDataDrivenEmissive=!1,this.dispatcher=c.dispatcher?c.dispatcher:new o.D(o.dh(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new sc(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new o.di(r._requestManager,c.localFontFamily?o.dj.all:c.localIdeographFontFamily?o.dj.ideographs:o.dj.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new gI(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._indoorDependentLayers=c.indoorDependentLayers?c.indoorDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",o.dk());const p=this;this._rtlTextPluginCallback=Oa.registerForPluginStateChange(y=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(b,w)=>{if(o.dl(b),w&&w.every(S=>S))for(const S in p._sourceCaches){const P=p._sourceCaches[S],k=P.getSource().type;k!=="vector"&&k!=="geojson"||P.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const b=this.getOwnSource(y.sourceId);if(b&&b.vectorLayerIds)for(const w in this._layers){const S=this._layers[w];S.source===b.id&&this._validateLayer(S)}})}load(r){return r?(typeof r=="string"?this.loadURL(r):this.loadJSON(r),this):this}_getGlobalId(r){if(!r)return null;if(typeof r=="string"){if(o.h(r))return r;const c=o.dm(r);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${o.dn(JSON.stringify(r))}`}_diffStyle(r,c,p){this.globalId=this._getGlobalId(r);const y=(b,w)=>{try{w(null,this.setState(b,p))}catch(S){w(S,!1)}};if(typeof r=="string"){const b=this.map._requestManager.normalizeStyleURL(r),w=this.map._requestManager.transformRequest(b,o.R.Style);o.m(w,(S,P)=>{S?this.fire(new o.y(S)):P&&y(P,c)})}else typeof r=="object"&&y(r,c)}loadURL(r,c={}){this.fire(new o.z("dataloading",{dataType:"style"}));const p=typeof c.validate=="boolean"?c.validate:!o.h(r);this.globalId=this._getGlobalId(r),r=this.map._requestManager.normalizeStyleURL(r,c.accessToken),this.resolvedImports.add(r);const y=this.importsCache.get(r);if(y)return this._load(y,p);const b=this.map._requestManager.transformRequest(r,o.R.Style);this._request=o.m(b,(w,S)=>{if(this._request=null,w)this.fire(new o.y(w));else if(S)return this.importsCache.set(r,S),this._load(S,p)})}loadJSON(r,c={}){this.fire(new o.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(r),this._request=o.o.frame(()=>{this._request=null,this._load(r,c.validate!==!1)})}loadEmpty(){this.fire(new o.z("dataloading",{dataType:"style"})),this._load(_u,!1)}_loadImports(r,c,p){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const b of r){const w=this._createFragmentStyle(b),S=new Promise(L=>{w.once("style.import.load",L),w.once("error",L)}).then(()=>this.mergeAll());if(y.push(S),this.resolvedImports.has(b.url)){w.loadEmpty();continue}const P=b.data||this.importsCache.get(b.url);P?(w.loadJSON(P,{validate:c}),this._isInternalStyle(P)&&(w.globalId=null)):b.url?w.loadURL(b.url,{validate:c}):w.loadEmpty();const k={style:w,id:b.id,config:b.config};if(p){const L=this.fragments.findIndex(({id:V})=>V===p);this.fragments=this.fragments.slice(0,L).concat(k).concat(this.fragments.slice(L))}else this.fragments.push(k)}return Promise.allSettled(y)}getImportGlobalIds(r=this,c=new Set){for(const p of r.fragments)p.style.globalId&&c.add(p.style.globalId),this.getImportGlobalIds(p.style,c);return[...c.values()]}_createFragmentStyle(r){const c=this.scope?o.B(r.id,this.scope):r.id;let p;const y=this._initialConfig&&this._initialConfig[c];(r.config||y)&&(p=Object.assign({},r.config,y));const b=new Oa(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:r["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(r){return this.isRootStyle()&&(r.fragment||!!r.schema&&r.fragment!==!1)}_load(r,c){if(this._isInternalStyle(r)){const b=Object.assign({},_u,{imports:[{id:"basemap",data:r,url:""}]},r.center?{center:r.center}:{},r.bearing?{bearing:r.bearing}:{},r.pitch?{pitch:r.pitch}:{},r.zoom?{zoom:r.zoom}:{},r.light?{light:r.light}:{});return this._importedAsBasemap=!0,void this._load(b,c)}if(this.updateConfig(this._config,r.schema),c&&gu(this,tr(r)))return;this._loaded=!0,this.stylesheet=o.dp(r);const p=()=>{for(const P in r.sources)this.addSource(P,r.sources[P],{validate:!1,isInitialLoad:!0});if(r.iconsets)for(const P in r.iconsets)this.addIconset(P,r.iconsets[P]);r.sprite?this._loadIconset(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&r.glyphs&&this.glyphManager.setURL(r.glyphs);const b=ip(this.stylesheet.layers);if(this._order=b.map(P=>P.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const P=this.stylesheet.lights[0];this.light=new ke(P.properties,P.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ke(this.stylesheet.light)),this._layers={};for(const P of b){const k=o.du(P,this.scope,this._styleColorTheme.lut,this.options);k.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(k.fqid),k.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(k.fqid),this._hasAppearances=this._hasAppearances||k.getAppearances().length!==0,k.setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k;const L=this.getOwnLayerSourceCache(k),V=!!this.directionalLight&&this.directionalLight.shadowsEnabled();L&&k.canCastShadows()&&V&&(L.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const w=this.stylesheet.terrain;w&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(w,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.z("data",{dataType:"style"}));const S=this.isRootStyle();r.imports?this._loadImports(r.imports,c).then(()=>{this._reloadImports(),this.fire(new o.z(S?"style.load":"style.import.load"))}).catch(P=>{this.fire(new o.y(new Error("Failed to load imports",P))),this.fire(new o.z(S?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.z(S?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const y=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(y){const b=this._evaluateColorThemeData(y);this._loadColorTheme(b).then(()=>{p()}).catch(w=>{o.w(`Couldn't load color theme from the stylesheet: ${w}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(r=>r.style.hasAppearances())}mergeAll(){let r,c,p,y,b,w,S,P,k,L;const V={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(r=B.light),B.stylesheet.lights)for(const U of B.stylesheet.lights)U.type==="ambient"&&B.ambientLight!=null&&(c=B.ambientLight),U.type==="directional"&&B.directionalLight!=null&&(p=B.directionalLight);y=this._prioritizeTerrain(y,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(b=B.fog),B.stylesheet.snow&&B.snow!=null&&(w=B.snow),B.stylesheet.rain&&B.rain!=null&&(S=B.rain),B.stylesheet.camera!=null&&(L=B.stylesheet.camera),B.stylesheet.projection!=null&&(P=B.stylesheet.projection),B.stylesheet.transition!=null&&(k=B.stylesheet.transition),V[B.scope]=B._styleColorTheme}}),this.light=r,this.ambientLight=c,this.directionalLight=p,this.fog=b,this.snow=w,this.rain=S,this._styleColorThemeForScope=V,y===null?delete this.terrain:this.terrain=y,this.camera=L||{"camera-projection":"perspective"},this.projection=P||{name:"mercator"},this.transition=Object.assign({},mp,k),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(r){const c=p=>{for(const y of p.fragments)c(y.style);r(p)};c(this)}_prioritizeTerrain(r,c,p){const y=r&&r.drapeRenderMode===0;return p===null?c&&c.drapeRenderMode===0?c:y?r:null:c!=null&&(!r||y||c&&c.drapeRenderMode===1)?c:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{r=this._prioritizeTerrain(r,c.terrain,c.stylesheet.terrain)}),r===null?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(r=c.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){const r={},c={},p={};this.forEachFragmentStyle(y=>{for(const b in y._sourceCaches){const w=o.B(b,y.scope);r[w]=y._sourceCaches[b]}for(const b in y._otherSourceCaches){const w=o.B(b,y.scope);c[w]=y._otherSourceCaches[b]}for(const b in y._symbolSourceCaches){const w=o.B(b,y.scope);p[w]=y._symbolSourceCaches[b]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=p}mergeIndoor(){this.forEachFragmentStyle(r=>{if(r.stylesheet&&r.stylesheet.indoor)for(const c of Object.values(r.stylesheet.indoor)){const p=c,y=o.B(p.sourceId,r.scope);this._mergedIndoor[y]=new Set(p.sourceLayers||[])}})}mergeLayers(){const r={},c=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(w=>{for(const S of w._order){const P=w._layers[S];if(P.type==="slot"){const k=o.dq(S);if(r[k])continue;r[k]=[]}P.slot&&r[P.slot]?r[P.slot].push(P):c.push(P)}}),this._mergedOrder=[];let y=-1;const b=(w=[])=>{for(const S of w)if(S.type==="slot"){const P=o.dq(S.id);r[P]&&b(r[P]),this._mergedSlots.push(P)}else{const P=o.B(S.id,S.scope);this._mergedOrder.push(P),p[P]=S,S.is3D(!!this.terrain)&&(this._has3DLayers=!0,y=this._mergedOrder.length-1),S.type==="circle"&&(this._hasCircleLayers=!0),S.type==="symbol"&&(this._hasSymbolLayers=!0),S.type==="clip"&&(this._clipLayerPresent=!0)}};if(b(c),this._has3DLayers){const w={};for(let S=0;S<this._mergedOrder.length;++S){const P=this._mergedOrder[S];w[P]=S===y?1:S<y?p[P].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((S,P)=>w[S]-w[P])}this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(r){return r.data?function(c,p,y,b){const w=Object.assign({},p);for(const P of Object.keys(Tv))w[P]===void 0&&(w[P]=Tv[P].default);const S=new o.a8(_I,c,new Map(y));return S.setTransitionOrValue(w,y),S.untransitioned().possiblyEvaluate(new o.ac(0,{worldview:void 0}))}(this.scope,r,this.options).get("data"):null}_loadColorTheme(r){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,y)=>{const b="data:image/png;base64,";if(!r||r.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let w=r;w.startsWith(b)||(w=b+w);const S=o.I.from("mapbox-reserved-lut"),P=new Image;P.src=w,P.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},P.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void p();this._styleColorTheme.lutLoading=!1;const{width:k,height:L,data:V}=o.o.getImageData(P);if(L>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(k!==L*L)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(S)&&this.removeImage(S),this.addImage(S,{data:new o.q({width:k,height:L},V),pixelRatio:1,sdf:!1,usvg:!1,version:0});const B=this.imageManager.getImage(S,this.scope);B?(this._styleColorTheme.lut={image:B.data,data:r},p()):y(new Error("Missing LUT image."))}})}getLut(r){const c=this._styleColorThemeForScope[r];return c?c.lut:null}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=function(c,p,y){let b,w,S;const P=o.o.devicePixelRatio>1?"@2x":"";let k=o.m(p.transformRequest(p.normalizeSpriteURL(c,P,".json"),o.R.SpriteJSON),(B,U)=>{k=null,S||(S=B,b=U,V())}),L=o.n(p.transformRequest(p.normalizeSpriteURL(c,P,".png"),o.R.SpriteImage),(B,U)=>{L=null,S||(S=B,w=U,V())});function V(){if(S)y(S);else if(b&&w){const B=o.o.getImageData(w),U={};for(const Z in b){const{width:W,height:ne,x:te,y:le,sdf:he,pixelRatio:ce,stretchX:Ee,stretchY:ye,content:we}=b[Z],_e=new o.q({width:W,height:ne});o.q.copy(B,_e,{x:te,y:le},{x:0,y:0},{width:W,height:ne},null),U[Z]={data:_e,pixelRatio:ce!==void 0?ce:1,sdf:he!==void 0&&he,stretchX:Ee,stretchY:ye,content:we,usvg:!1,version:0}}y(null,U)}}return{cancel(){k&&(k.cancel(),k=null),L&&(L.cancel(),L=null)}}}(r,this.map._requestManager,(c,p)=>{if(this._spriteRequest=null,c)this.fire(new o.y(c));else if(p){const y=new Map;for(const b in p)y.set(o.I.from(b),p[b]);this.addImages(y)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))})}addIconset(r,c){if(c.type==="sprite")return void this._loadSprite(c.url);const p=this.getOwnSourceCache(c.source);if(!p)return void this.fire(new o.y(new Error(`Source "${c.source}" as specified by iconset "${r}" does not exist and cannot be used as an iconset source`)));const y=p.getSource();if(y.type!=="raster-array")return void this.fire(new o.y(new Error(`Source "${c.source}" as specified by iconset "${r}" is not a "raster-array" source and cannot be used as an iconset source`)));y.partial=!1;const b=new Ev(r,this.scope,p);this.imageManager.addImageProvider(b,this.scope)}removeIconset(r){this.imageManager.removeImageProvider(r,this.scope)}_loadIconset(r){if(!o.h(r)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(r);const c=this.map._spriteFormat==="auto";var p,y;this._spriteRequest=(y=(b,w)=>{if(this._spriteRequest=null,b)c?this._loadSprite(r):this.fire(new o.y(b));else if(w){const S=new Map;for(const P in w)S.set(o.I.from(P),w[P]);this.addImages(S)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))},o.bu((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(r),o.R.Iconset),(b,w)=>{if(b)return void y(b);const S={},P=o.dg(new o.bt(w));for(const k of P.icons){const L={version:1,pixelRatio:o.o.devicePixelRatio,content:Pb(k),stretchX:k.metadata?Rb(k.metadata.stretch_x_areas):void 0,stretchY:k.metadata?Rb(k.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:k};S[k.name]=L}y(null,S)}))}_validateLayer(r){const c=this.getOwnSource(r.source);if(!c)return;const p=r.sourceLayer;p&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(p)===-1)&&this.fire(new o.y(new Error(`Source layer "${p}" does not exist on source "${c.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,c)=>{const p=this.fragments[c];return p&&p.style&&(r.data=p.style.serialize()),r})}_serializeSources(){const r={};for(const c in this._sourceCaches){const p=this._sourceCaches[c].getSource();r[p.id]||(r[p.id]=p.serialize())}return r}_serializeLayers(r){const c=[];for(const p of r){const y=this._layers[p];y&&y.type!=="custom"&&c.push(y.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const r in this._mergedLayers){const c=this._mergedLayers[r];if(c._transitionablePaint&&c._transitionablePaint._values){const p=c._transitionablePaint._values["line-emissive-strength"];if(p&&p.value&&p.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(r){return r?this.order:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&r.isDraped(this.getLayerSourceCache(r))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){const c=this.getOwnLayer(r);if(c)return c;this.fire(new o.y(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){const c=this.getOwnSource(r);if(c)return c;this.fire(new o.y(new Error(`The source '${r}' does not exist in the map's style.`)))}precompilePrograms(r,c){const p=this.map.painter;if(p)for(let y=r.minzoom||0;y<(r.maxzoom||25.5);y++){const b=r.getProgramIds();if(b)for(const w of b){const S=r.getDefaultProgramParams(w,c.zoom,this._styleColorTheme.lut);S&&(p.style=this,this.fog&&(p._fogVisible=!0,S.overrideFog=!0,p.getOrCreateProgram(w,S)),p._fogVisible=!1,S.overrideFog=!1,p.getOrCreateProgram(w,S),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(S.overrideRtt=!0,p.getOrCreateProgram(w,S)))}}}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);const c=this.calculateLightsBrightness();r.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),r.worldview!==this._worldview&&(this._worldview=r.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const p=this._changes.isDirty();let y=!1;if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const P in S){const{updatedIds:k,removedIds:L}=S[P];(k||L)&&(this._updateWorkerLayers(P,k,L),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this.snow&&this.snow.updateTransitions(r),this.rain&&this.rain.updateTransitions(r),this._changes.reset()}const b={};for(const S in this._mergedSourceCaches){const P=this._mergedSourceCaches[S];b[S]=P.used,P.used=!1,P.tileCoverLift=0}for(const S of this._mergedOrder){const P=this._mergedLayers[S];if(P.visibility!=="none"&&P.recalculate(r,this._availableImages),!P.isHidden(r.zoom)){const k=this.getLayerSourceCache(P);k&&(k.used=!0,k.tileCoverLift=Math.max(k.tileCoverLift,P.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(P,r)}):this.precompilePrograms(P,r))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();const w=this.imageManager.getPendingImageProviders();for(const S of w)S.sourceCache.used=!0;for(const S in b){const P=this._mergedSourceCaches[S];b[S]!==P.used&&P.getSource().fire(new o.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:P.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.snow&&this.snow.recalculate(r),this.rain&&this.rain.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new o.z("data",{dataType:"style"}))}updateImageProviders(){const r=this.imageManager.getPendingImageProviders();for(const c of r){const p=c.resolvePendingRequests(),y=this.getFragmentStyle(c.scope);y&&y.addImages(p)}}_updateTilesForChangedImages(){const r={};for(const c in this._mergedSourceCaches){const p=this._mergedSourceCaches[c].getSource().scope;r[p]=r[p]||this._changes.getUpdatedImages(p),r[p].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],r[p])}for(const c in r)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(r,c,p){const y=this.getFragmentStyle(r);y&&this.dispatcher.broadcast("updateLayers",{layers:c?y._serializeLayers(c):[],scope:r,removedIds:p||[],options:y.options})}setState(r,c){if(this._checkLoaded(),gu(this,tr(r)))return!1;(r=o.dp(r)).layers=ip(r.layers);const p=function(w,S){if(!w)return[{command:li.setStyle,args:[S]}];let P=[];try{if(!o.by(w.version,S.version))return[{command:li.setStyle,args:[S]}];if(o.by(w.center,S.center)||P.push({command:li.setCenter,args:[S.center]}),o.by(w.zoom,S.zoom)||P.push({command:li.setZoom,args:[S.zoom]}),o.by(w.bearing,S.bearing)||P.push({command:li.setBearing,args:[S.bearing]}),o.by(w.pitch,S.pitch)||P.push({command:li.setPitch,args:[S.pitch]}),o.by(w.sprite,S.sprite)||P.push({command:li.setSprite,args:[S.sprite]}),o.by(w.glyphs,S.glyphs)||P.push({command:li.setGlyphs,args:[S.glyphs]}),o.by(w.imports,S.imports)||function(U=[],Z=[],W){Z=Z||[];const ne=(U=U||[]).map(rp),te=Z.map(rp),le=U.reduce(sp,{}),he=Z.reduce(sp,{}),ce=ne.slice();let Ee,ye,we,_e;for(Ee=0,ye=0;Ee<ne.length;Ee++)we=ne[Ee],he.hasOwnProperty(we)?ye++:(W.push({command:li.removeImport,args:[we]}),ce.splice(ce.indexOf(we,ye),1));for(Ee=0,ye=0;Ee<te.length;Ee++)we=te[te.length-1-Ee],ce[ce.length-1-Ee]!==we&&(le.hasOwnProperty(we)?(W.push({command:li.removeImport,args:[we]}),ce.splice(ce.lastIndexOf(we,ce.length-ye),1)):ye++,_e=ce[ce.length-Ee],W.push({command:li.addImport,args:[he[we],_e]}),ce.splice(ce.length-Ee,0,we));for(const pe of Z){const Se=le[pe.id];Se&&(delete Se.data,o.by(Se,pe)||W.push({command:li.updateImport,args:[pe.id,pe]}))}}(w.imports,S.imports,P),o.by(w.transition,S.transition)||P.push({command:li.setTransition,args:[S.transition]}),o.by(w.light,S.light)||P.push({command:li.setLight,args:[S.light]}),o.by(w.fog,S.fog)||P.push({command:li.setFog,args:[S.fog]}),o.by(w.snow,S.snow)||P.push({command:li.setSnow,args:[S.snow]}),o.by(w.rain,S.rain)||P.push({command:li.setRain,args:[S.rain]}),o.by(w.projection,S.projection)||P.push({command:li.setProjection,args:[S.projection]}),o.by(w.lights,S.lights)||P.push({command:li.setLights,args:[S.lights]}),o.by(w.camera,S.camera)||P.push({command:li.setCamera,args:[S.camera]}),o.by(w.iconsets,S.iconsets)||function(U,Z,W){let ne;for(ne in Z=Z||{},U=U||{})U.hasOwnProperty(ne)&&(Z.hasOwnProperty(ne)||W.push({command:li.removeIconset,args:[ne]}));for(ne in Z){if(!Z.hasOwnProperty(ne))continue;const te=Z[ne];U.hasOwnProperty(ne)?o.by(U[ne],te)||(W.push({command:li.removeIconset,args:[ne]}),W.push({command:li.addIconset,args:[ne,te]})):W.push({command:li.addIconset,args:[ne,te]})}}(w.iconsets,S.iconsets,P),!o.by(w["color-theme"],S["color-theme"]))return[{command:li.setStyle,args:[S]}];const k={},L=[];(function(U,Z,W,ne){let te;for(te in Z=Z||{},U=U||{})U.hasOwnProperty(te)&&(Z.hasOwnProperty(te)||pv(te,W,ne));for(te in Z){if(!Z.hasOwnProperty(te))continue;const le=Z[te];U.hasOwnProperty(te)?o.by(U[te],le)||(U[te].type==="geojson"&&le.type==="geojson"&&Sb(U,Z,te)?W.push({command:li.setGeoJSONSourceData,args:[te,le.data]}):Eb(te,Z,W,ne)):Qm(te,Z,W)}})(w.sources,S.sources,L,k);const V=[];w.layers&&w.layers.forEach(U=>{U.source&&k[U.source]?P.push({command:li.removeLayer,args:[U.id]}):V.push(U)});let B=w.terrain;B&&k[B.source]&&(P.push({command:li.setTerrain,args:[void 0]}),B=void 0),P=P.concat(L),o.by(B,S.terrain)||P.push({command:li.setTerrain,args:[S.terrain]}),function(U,Z,W){Z=Z||[];const ne=(U=U||[]).map(rp),te=Z.map(rp),le=U.reduce(sp,{}),he=Z.reduce(sp,{}),ce=ne.slice(),Ee=Object.create(null);let ye,we,_e,pe,Se,De,Me;for(ye=0,we=0;ye<ne.length;ye++)_e=ne[ye],he.hasOwnProperty(_e)?we++:(W.push({command:li.removeLayer,args:[_e]}),ce.splice(ce.indexOf(_e,we),1));for(ye=0,we=0;ye<te.length;ye++)_e=te[te.length-1-ye],ce[ce.length-1-ye]!==_e&&(le.hasOwnProperty(_e)?(W.push({command:li.removeLayer,args:[_e]}),ce.splice(ce.lastIndexOf(_e,ce.length-we),1)):we++,De=ce[ce.length-ye],W.push({command:li.addLayer,args:[he[_e],De]}),ce.splice(ce.length-ye,0,_e),Ee[_e]=!0);for(ye=0;ye<te.length;ye++)if(_e=te[ye],pe=le[_e],Se=he[_e],!Ee[_e]&&!o.by(pe,Se))if(o.by(pe.source,Se.source)&&o.by(pe["source-layer"],Se["source-layer"])&&o.by(pe.type,Se.type)){for(Me in du(pe.layout,Se.layout,W,_e,null,li.setLayoutProperty),du(pe.paint,Se.paint,W,_e,null,li.setPaintProperty),o.by(pe.slot,Se.slot)||W.push({command:li.setSlot,args:[_e,Se.slot]}),o.by(pe.filter,Se.filter)||W.push({command:li.setFilter,args:[_e,Se.filter]}),o.by(pe.minzoom,Se.minzoom)&&o.by(pe.maxzoom,Se.maxzoom)||W.push({command:li.setLayerZoomRange,args:[_e,Se.minzoom,Se.maxzoom]}),pe)pe.hasOwnProperty(Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&Me!=="slot"&&(Me.indexOf("paint.")===0?du(pe[Me],Se[Me],W,_e,Me.slice(6),li.setPaintProperty):o.by(pe[Me],Se[Me])||W.push({command:li.setLayerProperty,args:[_e,Me,Se[Me]]}));for(Me in Se)Se.hasOwnProperty(Me)&&!pe.hasOwnProperty(Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&Me!=="slot"&&(Me.indexOf("paint.")===0?du(pe[Me],Se[Me],W,_e,Me.slice(6),li.setPaintProperty):o.by(pe[Me],Se[Me])||W.push({command:li.setLayerProperty,args:[_e,Me,Se[Me]]}))}else W.push({command:li.removeLayer,args:[_e]}),De=ce[ce.lastIndexOf(_e)+1],W.push({command:li.addLayer,args:[Se,De]})}(V,S.layers,P)}catch(k){console.warn("Unable to compute style diff:",k),P=[{command:li.setStyle,args:[S]}]}return P}(this.serialize(),r).filter(w=>!(w.command in kb));if(p.length===0)return!1;const y=p.filter(w=>!(w.command in Mb));if(y.length>0)throw new Error(`Unimplemented: ${y.map(w=>w.command).join(", ")}.`);const b=[];return p.forEach(w=>{b.push(this[w.command](...w.args))}),c&&Promise.all(b).then(c).catch(c),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(r){if(r.size===0)return this;for(const[c,p]of r.entries()){if(this.getImage(c))return this.fire(new o.y(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,p),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this}addImage(r,c){return this.getImage(r)?this.fire(new o.y(new Error(`An image with the name "${r.name}" already exists.`))):(this.imageManager.addImage(r,this.scope,c),this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this)}updateImage(r,c,p=!1){this.imageManager.updateImage(r,this.scope,c),p&&(this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})))}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(r){return this.modelManager.addModelURLs(r,this.getActualScope()),this._updateWorkerModels(),this.fire(new o.z("data",{dataType:"style"})),this}addModel(r,c,p={}){return this._checkLoaded(),this._validate(Y,`models.${r}`,c,null,p)||(this.modelManager.addModel(r,c,this.getActualScope()),this.fire(new o.z("data",{dataType:"style"}))),this}hasModel(r){return this.modelManager.hasModel(r,this.getActualScope())}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.getActualScope(),!1,!0),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(r,c,p={}){if(this._checkLoaded(),this.getOwnSource(r)!==void 0)throw new Error(`There is already a source with ID "${r}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(mo,`sources.${r}`,c,null,p))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const y=gs(r,c,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id}));const b=w=>{const S=(w?"symbol:":"other:")+y.id,P=o.B(S,this.scope),k=this._sourceCaches[S]=new Go(P,y,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=k,k.onAdd(this.map)};b(!1),c.type!=="vector"&&c.type!=="geojson"||b(!0),y.onAdd&&y.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();const c=this.getOwnSource(r);if(!c)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===r)return this.fire(new o.y(new Error(`Source "${r}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new o.y(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const y=Object.entries(this.stylesheet.iconsets).find(([b,w])=>w.type==="source"&&w.source===r);if(y)return this.fire(new o.y(new Error(`Source "${r}" cannot be removed while iconset "${y[0]}" is using it.`)))}const p=this.getOwnSourceCaches(r);for(const y of p){const b=o.dq(y.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(y.id),y.fire(new o.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,c){this._checkLoaded(),this.getOwnSource(r).setData(c),this._changes.setDirty()}getOwnSource(r){const c=this.getOwnSourceCache(r);return c&&c.getSource()}getOwnSources(){const r=[];for(const c in this._otherSourceCaches){const p=this.getOwnSourceCache(c);p&&r.push(p.getSource())}return r}areTilesLoaded(){const r=this._mergedSourceCaches;for(const c in r){const p=r[c]._tiles;for(const y in p){const b=p[y];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const b of r){if(this._validate(Zs,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(b),w.updateTransitions(c)}else this.ambientLight=new ai(b,$r||($r=new o.a9({color:new o.aa(o.a6.properties_light_ambient.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(b),w.updateTransitions(c)}else this.directionalLight=new ai(b,Cr||(Cr=new o.a9({direction:new o.ap(o.a6.properties_light_directional.direction),color:new o.aa(o.a6.properties_light_directional.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_directional.intensity),"cast-shadows":new o.aa(o.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new o.aa(o.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.aa(o.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=Object.assign(c,{worldview:this.map.getWorldview()}),y=new o.ac(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const r=this.directionalLight,c=this.ambientLight;if(!r||!c)return;const p=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),y=r.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),b=r.properties.get("intensity"),w=r.properties.get("direction"),S=1-o.d4(w.x,w.y,w.z)[2]/90,P=p(y)*b*S,k=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),L=c.properties.get("intensity"),V=p(k)*L;return Number(((P+V)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(r==null||r===""&&this.isRootStyle())return this;if(o.dr(r)){const c=o.ds(r),p=this.fragments.find(({id:b})=>b===c);if(!p)return;const y=o.dq(r);return p.style.getFragmentStyle(y)}{const c=this.fragments.find(({id:p})=>p===r);return c?c.style:void 0}}setFeaturesetSelectors(r){if(!r)return;const c={},p=(y,b="")=>`${y}::${b}`;this._featuresetSelectors={};for(const y in r){const b=this._featuresetSelectors[y]=[];for(const w of r[y].selectors){if(w.featureNamespace){const P=this.getOwnLayer(w.layer);if(!P){o.w(`Layer is undefined for selector: ${w.layer}`);continue}const k=p(P.source,P.sourceLayer);if(k in c&&c[k]!==w.featureNamespace){o.w(`"featureNamespace ${w.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}c[k]=w.featureNamespace}let S;if(w.properties)for(const P in w.properties){const k=o.U(w.properties[P]);k.result==="success"&&(S=S||{},S[P]=k.value)}b.push({layerId:w.layer,namespace:w.featureNamespace,properties:S,uniqueFeatureID:w._uniqueFeatureID})}}}getFeaturesetDescriptors(r){const c=this.getFragmentStyle(r);if(!c||!c.stylesheet.featuresets)return[];const p=[];for(const y in c.stylesheet.featuresets)p.push({featuresetId:y,importId:c.scope?c.scope:void 0});return p}getFeaturesetLayers(r,c){const p=this.getFragmentStyle(c),y=p.stylesheet.featuresets;if(!y||!y[r])return this.fire(new o.y(new Error(`The featureset '${r}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const w of y[r].selectors){const S=p.getOwnLayer(w.layer);S&&b.push(S)}return b}getConfigProperty(r,c){const p=this.getFragmentStyle(r);if(!p)return null;const y=o.B(c,p.scope),b=p.options.get(y),w=b?b.value||b.default:null;return w?w.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(r,c){const p=o.B(r,c);return this._mergedIndoor[p]}setIndoorData(r,c){this.map.indoor.setIndoorData(c)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(r,c,p){const y=this.getFragmentStyle(r);if(!y)return;const b=y.stylesheet.schema;if(!b||!b[c])return;const w=o.U(p);if(w.result!=="success")return void gu(this,w.value);const S=w.value.expression,P=o.B(c,y.scope),k=y.options.get(P);if(!k)return;let L;const{minValue:V,maxValue:B,stepValue:U,type:Z,values:W}=b[c],ne=o.U(b[c].default);ne.result==="success"&&(L=ne.value.expression),L?(this.options.set(P,Object.assign({},k,{value:S,default:L,minValue:V,maxValue:B,stepValue:U,type:Z,values:W})),this.updateConfigDependencies(c)):this.fire(new o.y(new Error(`No schema defined for the config option "${c}" in the "${r}" fragment.`)))}getConfig(r){const c=this.getFragmentStyle(r);if(!c)return null;const p=c.stylesheet.schema;if(!p)return null;const y={};for(const b in p){const w=o.B(b,c.scope),S=c.options.get(w),P=S?S.value||S.default:null;y[b]=P?P.serialize():null}return y}setConfig(r,c){const p=this.getFragmentStyle(r);p&&(p.updateConfig(c,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(r){const c=this.getFragmentStyle(r);return c?c.stylesheet.schema:null}setSchema(r,c){const p=this.getFragmentStyle(r);p&&(p.stylesheet.schema=c,p.updateConfig(p._config,c),this.updateConfigDependencies())}updateConfig(r,c){if(this._config=r,r||c)if(c)for(const p in c){let y,b;const w=o.U(c[p].default);if(w.result==="success"&&(y=w.value.expression),r&&r[p]!==void 0){const B=o.U(r[p]);B.result==="success"&&(b=B.value.expression)}const{minValue:S,maxValue:P,stepValue:k,type:L,values:V}=c[p];if(y){const B=o.B(p,this.scope);this.options.set(B,{default:y,value:b,minValue:S,maxValue:P,stepValue:k,type:L,values:V})}else this.fire(new o.y(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new o.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(r,c=()=>!0){for(const p of r){const y=this.getLayer(p);y&&c(y)&&(y.possiblyEvaluateVisibility(),this._updateLayer(y),this._changes.setDirty())}}updateConfigDependencies(r){this._updateLayers(this._configDependentLayers,c=>!r||c.expressionDependencies.configDependencies.has(r)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(c=>{const p=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(p){const y=c._evaluateColorThemeData(p);(!c._styleColorTheme.lut&&y!==""||c._styleColorTheme.lut&&y!==c._styleColorTheme.lut.data)&&c.setColorTheme(p)}}),this._changes.setDirty()}addLayer(r,c,p={}){this._checkLoaded();const y=r.id;if(this._layers[y])return void this.fire(new o.y(new Error(`Layer with id "${y}" already exists on this map`)));let b;if(r.type==="custom"){if(gu(this,o.dt(r)))return;b=o.du(r,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof r.source=="object"&&(this.addSource(y,r.source),r=o.dp(r),r=Object.assign(r,{source:y})),this._validate(fv,`layers.${y}`,r,{arrayIndex:-1},p))return;b=o.du(r,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:y}})}const w=o.B(b.source,b.scope);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(w),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(w);let S=this._order.length;if(c){const V=this._order.indexOf(c);if(V===-1)return void this.fire(new o.y(new Error(`Layer with id "${c}" does not exist on this map.`)));b.slot===this._layers[c].slot?S=V:o.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,y),this._layerOrderChanged=!0,this._layers[y]=b;const P=this.getOwnLayerSourceCache(b),k=!!this.directionalLight&&this.directionalLight.shadowsEnabled();P&&b.canCastShadows()&&k&&(P.castsShadows=!0);const L=this._changes.getRemovedLayer(b);if(L&&b.source&&P&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const V=o.B(b.source,b.scope);L.type!==b.type?this._changes.updateSourceCache(V,"clear"):(this._changes.updateSourceCache(V,"reload"),P.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(r,c){this._checkLoaded();const p=this._checkLayer(r);if(!p||r===c)return;const y=this._order.indexOf(r);this._order.splice(y,1);let b=this._order.length;if(c){const w=this._order.indexOf(c);if(w===-1)return void this.fire(new o.y(new Error(`Layer with id "${c}" does not exist on this map.`)));p.slot===this._layers[c].slot?b=w:o.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();const c=this._checkLayer(r);if(!c)return;c.setEventedParent(null);const p=this._order.indexOf(r);this._order.splice(p,1),delete this._layers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._indoorDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const y=this.getOwnLayerSourceCache(c);if(y&&y.castsShadows){let b=!1;for(const w in this._layers)if(this._layers[w].source===c.source&&this._layers[w].canCastShadows()){b=!0;break}y.castsShadows=b}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(const c in this._layers)if(this._layers[c].type===r)return!0;return!1}setLayerZoomRange(r,c,p){this._checkLoaded();const y=this._checkLayer(r);y&&(y.minzoom===c&&y.maxzoom===p||(c!=null&&(y.minzoom=c),p!=null&&(y.maxzoom=p),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(r,c){this._checkLoaded();const p=this._checkLayer(r);p&&p.slot!==c&&(p.slot=c,this._updateLayer(p))}setFilter(r,c,p={}){this._checkLoaded();const y=this._checkLayer(r);if(y&&!o.by(y.filter,c))return c==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(rd,`layers.${y.id}.filter`,c,{layerType:y.type},p)||(y.filter=o.dp(c),this._updateLayer(y)))}getFilter(r){const c=this._checkLayer(r);if(c)return o.dp(c.filter)}setLayoutProperty(r,c,p,y={}){this._checkLoaded();const b=this._checkLayer(r);if(b&&!o.by(b.getLayoutProperty(c),p)){if(p!=null&&(!y||y.validate!==!1)&&gu(b,je.call(tr,{key:`layers.${r}.layout.${c}`,layerType:b.type,objectKey:c,value:p,styleSpec:o.a6,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(c,p),b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),this._updateLayer(b)}}setLayerProperty(r,c,p,y={}){this._checkLoaded();const b=this._checkLayer(r);b&&(c==="appearances"?(b.setAppearances(p),this._changes.setDirty()):b.isPaintProperty(c)?this.setPaintProperty(r,c,p,y):this.setLayoutProperty(r,c,p,y))}getLayoutProperty(r,c){const p=this._checkLayer(r);if(p)return p.getLayoutProperty(c)}setPaintProperty(r,c,p,y={}){this._checkLoaded();const b=this._checkLayer(r);if(!b||o.by(b.getPaintProperty(c),p)||p!=null&&(!y||y.validate!==!1)&&gu(b,ep.call(tr,{key:`layers.${r}.paint.${c}`,layerType:b.type,objectKey:c,value:p,styleSpec:o.a6})))return;const w=b.setPaintProperty(c,p);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),w&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(r,c){const p=this._checkLayer(r);if(p)return p.getPaintProperty(c)}setFeatureState(r,c){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:P,importId:k}=r.target,L=this.getFragmentStyle(k),V=L.getFeaturesetLayers(P);for(const{source:B,sourceLayer:U}of V)L.setFeatureState({id:r.id,source:B,sourceLayer:U},c)}else if("layerId"in r.target){const{layerId:P}=r.target,k=this.getLayer(P);this.setFeatureState({id:r.id,source:k.source,sourceLayer:k.sourceLayer},c)}return}const p=r.source,y=r.sourceLayer,b=this._checkSource(p);if(!b)return;const w=b.type;if(w==="geojson"&&y)return void this.fire(new o.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!y)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided.")));const S=this.getOwnSourceCaches(p);for(const P of S)P.setFeatureState(y,r.id,c)}removeFeatureState(r,c){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:P,importId:k}=r.target,L=this.getFragmentStyle(k),V=L.getFeaturesetLayers(P);for(const{source:B,sourceLayer:U}of V)L.removeFeatureState({id:r.id,source:B,sourceLayer:U},c)}else if("layerId"in r.target){const{layerId:P}=r.target,k=this.getLayer(P);this.removeFeatureState({id:r.id,source:k.source,sourceLayer:k.sourceLayer},c)}return}const p=r.source,y=this._checkSource(p);if(!y)return;const b=y.type,w=b==="vector"?r.sourceLayer:void 0;if(b==="vector"&&!w)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new o.y(new Error("A feature id is required to remove its specific state property.")));const S=this.getOwnSourceCaches(p);for(const P of S)P.removeFeatureState(w,r.id,c)}getFeatureState(r){if(this._checkLoaded(),"target"in r){let b;if("featuresetId"in r.target){const{featuresetId:w,importId:S}=r.target,P=this.getFragmentStyle(S),k=P.getFeaturesetLayers(w);for(const{source:L,sourceLayer:V}of k){const B=P.getFeatureState({id:r.id,source:L,sourceLayer:V});if(B&&!b)b=B;else if(!o.by(b,B))return void this.fire(new o.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in r.target){const{layerId:w}=r.target,S=this.getLayer(w);b=this.getFeatureState({id:r.id,source:S.source,sourceLayer:S.sourceLayer})}return b}const c=r.source,p=r.sourceLayer,y=this._checkSource(c);if(y){if(y.type!=="vector"||p)return r.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(p,r.id);this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const r=this.getTerrain(),c=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return o.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateFilteredLayers(r){for(const c of Object.values(this._mergedLayers))r(c)&&this._updateLayer(c)}_updateLayer(r){this._changes.updateLayer(r);const c=this.getLayerSourceCache(r),p=o.B(r.source,r.scope),y=this._changes.getUpdatedSourceCaches();r.source&&!y[p]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),c.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const c=S=>this._mergedLayers[S].is3D(!!this.terrain),p=this.order,y={},b=[];for(let S=p.length-1;S>=0;S--){const P=p[S];if(c(P)){y[P]=S;for(const k of r){const L=k[P];if(L)for(const V of L)b.push(V)}}}b.sort((S,P)=>P.intersectionZ-S.intersectionZ);const w=[];for(let S=p.length-1;S>=0;S--){const P=p[S];if(c(P))for(let k=b.length-1;k>=0;k--){const L=b[k].feature;if(L.layer&&y[L.layer.id]<S)break;w.push(L),b.pop()}else for(const k of r){const L=k[P];if(L)for(const V of L)w.push(V.feature)}}return w}queryRasterValue(r,c,p){const y=this.getOwnSource(r);return y?y.type!=="raster-array"?(this.fire(new o.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):y.queryRasterArrayValue(c,p):(this.fire(new o.y(new Error(`Source with id "${r}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(r,c,p){let y;c&&!Array.isArray(c)&&c.filter&&(this._validate(rd,"queryRenderedFeatures.filter",c.filter,null,c),y=o.b6(c.filter));const b={},w=L=>{if(cg.has(L.type))return;const V=this.getOwnLayerSourceCache(L),B=b[V.id]=b[V.id]||{sourceCache:V,layers:{},has3DLayers:!1};L.is3D(!!this.terrain)&&(B.has3DLayers=!0),B.layers[L.fqid]=B.layers[L.fqid]||{styleLayer:L,targets:[]},B.layers[L.fqid].targets.push({filter:y})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new o.y(new Error("parameters.layers must be an Array."))),[];for(const L of c.layers){const V=this._layers[L];if(!V)return this.fire(new o.y(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];w(V)}}else for(const L in this._layers)w(this._layers[L]);const S=this._queryRenderedFeatures(r,b,p),P=this._flattenAndSortRenderedFeatures(S),k=[];for(const L of P)o.dw(L.layer.id)===this.scope&&k.push(L);return k}queryRenderedFeatureset(r,c,p){let y;c&&!Array.isArray(c)&&c.filter&&(this._validate(rd,"queryRenderedFeatures.filter",c.filter,null,c),y=o.b6(c.filter));const b="mock",w=[];if(c&&c.target)w.push(Object.assign({},c,{targetId:b,filter:y}));else{const L=this.getFeaturesetDescriptors();for(const V of L)w.push({targetId:b,filter:y,target:V});for(const{style:V}of this.fragments){const B=V.getFeaturesetDescriptors();for(const U of B)w.push({targetId:b,filter:y,target:U})}}const S=this.queryRenderedTargets(r,w,p),P=[],k=new Set;for(const L of S)for(const V of L.variants[b])oh(V,L,k)||P.push(new o.dx(L,V));return P}queryRenderedTargets(r,c,p){const y={},b=(S,P,k,L)=>{const V=y[P.id]=y[P.id]||{sourceCache:P,layers:{},has3DLayers:!1};if(V.layers[S.fqid]=V.layers[S.fqid]||{styleLayer:S,targets:[]},S.is3D(!!this.terrain)&&(V.has3DLayers=!0),!L)return k.uniqueFeatureID=!1,void V.layers[S.fqid].targets.push(k);V.layers[S.fqid].targets.push(Object.assign({},k,{namespace:L.namespace,properties:L.properties,uniqueFeatureID:L.uniqueFeatureID}))};for(const S of c)if("featuresetId"in S.target){const{featuresetId:P,importId:k}=S.target,L=this.getFragmentStyle(k);if(!L||!L._featuresetSelectors)continue;const V=L._featuresetSelectors[P];if(!V){this.fire(new o.y(new Error(`The featureset '${P}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const B of V){const U=L.getOwnLayer(B.layerId);U&&!cg.has(U.type)&&b(U,L.getOwnLayerSourceCache(U),S,B)}}else if("layerId"in S.target){const{layerId:P}=S.target,k=this.getLayer(P);if(!k||cg.has(k.type))continue;b(k,this.getLayerSourceCache(k),S)}const w=this._queryRenderedFeatures(r,y,p);return this._flattenAndSortRenderedFeatures(w)}_queryRenderedFeatures(r,c,p){const y=[],b=!!this.map._showQueryGeometry,w=_r.createFromScreenPoints(r,p);for(const S in c){const P=Wm(w,c[S],this._availableImages,p,b);Object.keys(P).length&&y.push(P)}if(this.placement)for(const S in c){if(!c[S].sourceCache._onlySymbols)continue;const P=qm(w.screenGeometry,c[S],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(P).length&&y.push(P)}return y}querySourceFeatures(r,c){const p=c&&c.filter;p&&this._validate(rd,"querySourceFeatures.filter",p,null,c);let y=[];const b=this.getOwnSourceCaches(r);for(const w of b)y=y.concat(Zm(w,c));return y}addSourceType(r,c,p){return Oa.getSourceType(r)?p(new Error(`A source type called "${r}" already exists.`)):(Oa.setSourceType(r,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:c.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,c,p={}){this._checkLoaded();const y=this.light.getLight();let b=!1;for(const S in r)if(!o.by(r[S],y[S])){b=!0;break}if(!b)return;const w=this._getTransitionParameters();this.light.setLight(r,c,p),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(r,c=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,r===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=r;const y=!("source"in r)||r.source==null;if(c===1){if(this.disableElevatedTerrain)return;if("source"in p&&typeof p.source=="object"){const S="terrain-dem-src";this.addSource(S,p.source),p=o.dp(p),p=Object.assign(p,{source:S})}const b=Object.assign({},p),w={};if(this.terrain&&y){b.source=this.terrain.get().source;const S=this.terrain?this.getFragmentStyle(this.terrain.scope):null;S&&(w.style=S.serialize())}if(this._validate(il,"terrain",b,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&c!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,c),this.fire(new o.z("data",{dataType:"style"}))}else{const b=this.terrain,w=b.get();for(const S of Object.keys(o.a6.terrain))!p.hasOwnProperty(S)&&o.a6.terrain[S].default&&(p[S]=o.a6.terrain[S].default);for(const S in r)if(!o.by(r[S],w[S])){b.set(r,this.options),this.stylesheet.terrain=r;const P=this._getTransitionParameters({duration:0});b.updateTransitions(P),this.fire(new o.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const c=this.fog=new In(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createSnow(r){const c=this.snow=new Xr(r,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createRain(r){const c=this.rain=new gr(r,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!o.by(c.get(),r)){c.set(r,this.options),this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createFog(r);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(r){if(this._checkLoaded(),!r)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const c=this.snow;if(!o.by(c.get(),r)){c.set(r,this.options),this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createSnow(r);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(r){if(this._checkLoaded(),!r)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const c=this.rain;if(!o.by(c.get(),r)){c.set(r,this.options),this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createRain(r);this._markersNeedUpdate=!0}_reloadColorTheme(){const r=()=>{for(const y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void r();const p=this._evaluateColorThemeData(c);this._loadColorTheme(p).then(()=>{this.fire(new o.z("colorthemeset")),r()}).catch(y=>{o.w(`Couldn't set color theme: ${y}`)})}setColorTheme(r){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=r,this._reloadColorTheme()}setImportColorTheme(r,c){const p=this.getFragmentStyle(r);p&&(p._styleColorTheme.colorThemeOverride=c,p._reloadColorTheme())}_getTransitionParameters(r){return{now:o.o.now(),transition:Object.assign(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;const r=[],c=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?r.push(p):c.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...c)}_createTerrain(r,c){const p=this.terrain=new Le(r,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});p.updateTransitions(y)}_force3DLayerUpdate(){for(const r in this._layers){const c=this._layers[r];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const c=this._layers[r];c.type==="symbol"&&this._updateLayer(c)}}_validate(r,c,p,y,b={}){if(b&&b.validate===!1)return!1;const w=Object.assign({},this.serialize());return gu(this,r.call(tr,Object.assign({key:c,style:w,value:p,styleSpec:o.a6},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(r){const c=this.getSourceCaches(r);for(const p of c)p.clearTiles()}clearSources(){for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}clearLayers(){for(const r in this._mergedLayers){const c=this._mergedLayers[r];c._clear&&c._clear()}}reloadSource(r){const c=this.getSourceCaches(r);for(const p of c)p.resume(),p.reload()}reloadSources(){for(const r of this.getSources())r.reload&&r.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(r=>{r.modelManager.reloadModels(r.scope)})}updateSources(r){let c;this.directionalLight&&(c=pp(this.directionalLight));const p=new Set,y=new Set;for(const b in this._mergedLayers){const w=this._mergedLayers[b];w.type==="building"&&p.add(w.source),w.hasElevation()&&!y.has(w.source)&&y.add(w.source)}for(const b in this._mergedSourceCaches){const w=this._mergedSourceCaches[b],S=y.has(w._source.id);p.has(w._source.id)&&(w._source.reparseOverscaled=!1),w.update(r,void 0,void 0,c,S)}}_generateCollisionBoxes(){for(const r in this._sourceCaches){const c=this._sourceCaches[r];c.resume(),c.reload()}}_updatePlacement(r,c,p,y,b,w,S=!1){let P=!1,k=!1;const L={},V={};for(const W of this._mergedOrder){const ne=this._mergedLayers[W];if(ne.type!=="symbol")continue;const te=o.B(ne.source,ne.scope);let le=L[te];if(!le){const ce=this.getLayerSourceCache(ne);if(!ce)continue;const Ee=ce.getRenderableIds(!0).map(ye=>ce.getTileByID(ye));V[te]=Ee.slice(),le=L[te]=Ee.sort((ye,we)=>we.tileID.overscaledZ-ye.tileID.overscaledZ||(ye.tileID.isLessThan(we.tileID)?-1:1))}const he=this.crossTileSymbolIndex.addLayer(ne,le,c.center.lng,c.projection);P=P||he}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),S=S||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new o.z("neworder"));const B=!!(this.placement&&!c.equals(this.placement.transform)),U=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!w||this.placement.lastReplacementSourceUpdateTime!==w.updateTime)),Z=(B||U||P||this.placement&&this.placement.isStale())&&y===0;if((S||!this.pauseablePlacement||Z||y!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.o.now(),c.zoom))&&(this.pauseablePlacement=new _s(c,this._mergedOrder,S||y===0,p,y,b,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,L,V,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.o.now()),k=!0),P&&this.pauseablePlacement.placement.setStale()),k||P){this._buildingIndex.onNewFrame(c.zoom);for(let W=0;W<this._mergedOrder.length;W++){const ne=this._mergedLayers[this._mergedOrder[W]];if(ne.type!=="symbol"||ne.visibility==="none")continue;const te=this.isLayerClipped(ne);this.placement.updateLayerOpacities(ne,L[o.B(ne.source,ne.scope)],W,te?w:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.o.now())}}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,c){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:b})=>b===r.id)!==-1)return void this.fire(new o.y(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!c)return p.push(r),this._loadImports([r],!0);const y=p.findIndex(({id:b})=>b===c);return y===-1&&this.fire(new o.y(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,y).concat(r).concat(p.slice(y)),this._loadImports([r],!0,c)}updateImport(r,c){this._checkLoaded();const p=this.stylesheet.imports||[],y=this.getImportIndex(r);return y===-1?this:typeof c=="string"?(this.setImportUrl(r,c),this):(c.url&&c.url!==p[y].url&&this.setImportUrl(r,c.url),o.by(c.config,p[y].config)||this.setImportConfig(r,c.config,c.data.schema),o.by(c.data,p[y].data)||this.setImportData(r,c.data),this)}moveImport(r,c){this._checkLoaded();let p=this.stylesheet.imports||[];const y=this.getImportIndex(r);if(y===-1)return this;const b=this.getImportIndex(c);if(b===-1)return this;const w=p[y],S=this.fragments[y];return p=p.filter(({id:P})=>P!==r),this.fragments=this.fragments.filter(({id:P})=>P!==r),this.stylesheet.imports=p.slice(0,b).concat(w).concat(p.slice(b)),this.fragments=this.fragments.slice(0,b).concat(S).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(r,c){this._checkLoaded();const p=this.stylesheet.imports||[],y=this.getImportIndex(r);if(y===-1)return this;p[y].url=c;const b=this.fragments[y];return b.style=this._createFragmentStyle(p[y]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(c),this}setImportData(r,c){this._checkLoaded();const p=this.getImportIndex(r),y=this.stylesheet.imports||[];return p===-1?this:c?(this.fragments[p].style.setState(c),this._reloadImports(),this):(delete y[p].data,this.setImportUrl(r,y[p].url))}setImportConfig(r,c,p){this._checkLoaded();const y=this.getImportIndex(r),b=this.stylesheet.imports||[];if(y===-1)return this;c?b[y].config=c:delete b[y].config;const w=this.fragments[y];p&&w.style.stylesheet&&(w.style.stylesheet.schema=p);const S=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=c,w.style.updateConfig(c,S),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();const c=this.stylesheet.imports||[],p=this.getImportIndex(r);p!==-1&&(c.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(r){const c=(this.stylesheet.imports||[]).findIndex(p=>p.id===r);return c===-1&&this.fire(new o.y(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),c}getLayer(r){return this._mergedLayers[r]}getSources(){const r=[];for(const c in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[c];p&&r.push(p.getSource())}return r}getSource(r,c){const p=this.getSourceCache(r,c);return p&&p.getSource()}getLayerSource(r){const c=this.getLayerSourceCache(r);return c&&c.getSource()}getSourceCache(r,c){const p=o.B(r,c);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(r){const c=o.B(r.source,r.scope);return r.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(r){if(r==null)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[r]&&c.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&c.push(this._mergedSymbolSourceCaches[r]),c}updateSourceCaches(){const r=this._changes.getUpdatedSourceCaches();for(const c in r){const p=r[c];p==="reload"?this.reloadSource(c):p==="clear"&&this.clearSource(c)}}updateLayers(r){const c=this._changes.getUpdatedPaintProperties();for(const p of c){const y=this.getLayer(p);y&&y.updateTransitions(r)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(r){this.stylesheet.glyphs=r,this.glyphManager.setURL(r)}getImages(r,c,p){this.imageManager.getImages(c.images,c.scope,p),this._updateTilesForChangedImages();const y=w=>{if(w){const S=c.images.map(P=>o.I.toString(P));w.setDependencies(c.tileID.key,c.type,S)}},b=o.B(c.source,c.scope);y(this._mergedOtherSourceCaches[b]),y(this._mergedSymbolSourceCaches[b]),c.images.some(w=>w.iconsetId)&&this.fire(new o.z("data",{dataType:"style"}))}rasterizeImages(r,c,p){this.imageManager.rasterizeImages(c,p)}getGlyphs(r,c,p){this.glyphManager.getGlyphs(c.stacks,p)}getResource(r,c,p){return o.dz(c,p)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){const c=[];return this._otherSourceCaches[r]&&c.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&c.push(this._symbolSourceCaches[r]),c}_isSourceCacheLoaded(r){const c=this.getOwnSourceCaches(r);return c.length===0?(this.fire(new o.y(new Error(`There is no source with ID '${r}'`))),!1):c.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(r,c){if(!this._clipLayerPresent&&r.type!=="fill-extrusion"&&r.type!=="building")return!1;const p=r.type==="fill-extrusion"&&(r.sourceLayer==="building"||r.sourceLayer==="procedural_buildings"),y=r.type==="building";if(r.is3D(!!this.terrain)){if(p||y||c&&c.type==="batched-model"||r.type==="model")return!0}else if(r.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Oa.getSourceType=function(f){return Pl[f]},Oa.setSourceType=function(f,r){Pl[f]=r},Oa.registerForPluginStateChange=o.dA;class Db extends o.E{constructor(r){super(),this._style=r,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},o.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(r){r===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=r,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(r){this._activeFloorsVisible=r,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(r){for(const[c,p]of Object.entries(r.buildings))if(this._buildings[c])for(const y of p.floorIds)this._buildings[c].floors[y]||(this._buildings[c].floors[y]=p.floors[y]);else this._buildings[c]=p;for(const c of r.activeFloors)this._activeFloors.add(c);this._updateIndoorSelector()}getIndoorTileOptions(r,c){const p=this._style.getIndoorSourceLayers(r,c);return p&&this._indoorState?{sourceLayers:p,indoorState:this._indoorState}:null}_updateUI(r,c,p){const y=function(b,w,S,P){let k=null,L=Number.MAX_SAFE_INTEGER;if(P<16)return null;for(const[V,B]of Object.entries(b)){const U=B.center;if(U){const Z=w.distanceTo(o.aT.convert(U));Z<L&&S.contains(U)&&(L=Z,k=V)}}return k}(this._buildings,c,p,r);y!==this._closestBuildingId&&(this._closestBuildingId=y,this._updateIndoorSelector())}_updateIndoorSelector(){const r=this._buildings,c=this._closestBuildingId,p=c&&r?r[c]:void 0;if(!p)return void this.fire(new o.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let y=null;for(const w of p.floorIds)if(this._activeFloors&&this._activeFloors.has(w)){y=w;break}const b=Array.from(p.floorIds).map(w=>({id:w,name:p.floors[w].name,zIndex:p.floors[w].zIndex})).sort((w,S)=>S.zIndex-w.zIndex);this.fire(new o.z("selector-update",{selectedFloorId:y,activeFloorsVisible:this._activeFloorsVisible,floors:b}))}_updateActiveFloors(){const r=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:r,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var dh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,hh=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Sv=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,ug="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ra=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,dg=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,wt=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Cv=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,hg=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,fg=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,Iv=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const gp=/#include\s+"([^"]+)"/g,Ol=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,Av=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,hd=new Set(["ifdef","ifndef","elif","if","defined"]),fd=new Set;vu(dh,fd),vu(Sv,fd),vu(hh,fd);const yu={"_prelude_fog.vertex.glsl":dg,"_prelude_terrain.vertex.glsl":ra,"_prelude_shadow.vertex.glsl":fg,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":wt,"_prelude_shadow.fragment.glsl":Iv,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":Cv,"_prelude_raster_particle.glsl":hg},pg={};ti("",ra),ti(wt,dg),ti(Iv,fg),ti(Cv,""),ti(hg,"");const Nb=ti(hh,Sv),mg=dh,yI=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",mg,Nb.fragmentSource].join(`
`),Lb=["precision highp float;",mg,Nb.vertexSource].join(`
`);var Pv={background:ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:ti(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:ti(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ti("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ti(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ti(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ti("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ti("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ti("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:ti(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:ti(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ti(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ti(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ti(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ti(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:ti("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:ti("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ti(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:ti(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:ti("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ti(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ug),skyboxGradient:ti(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ug),skyboxCapture:ti(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ti(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ti(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ti(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:ti("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:ti("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:ti("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:ti("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function vu(f,r){const c=f.split(`
`);for(let p of c){if(p=p.trimStart(),p[0]!=="#"||!p.includes("if")||p.startsWith("#endif"))continue;const y=p.match(Av);if(y)for(const b of y)hd.has(b)||r.add(b)}}function ti(f,r){const c=new Set,p=[],y=[];f=f.replace(gp,(w,S)=>(y.push(S),"")),r=r.replace(gp,(w,S)=>(p.push(S),""));let b=new Set(fd);vu(f,b),vu(r,b);for(const w of[...p,...y])pg[w]||(pg[w]=new Set,vu(yu[w],pg[w])),b=new Set([...b,...pg[w]]);return{fragmentSource:f=f.replace(Ol,(w,S,P,k,L)=>(c.add(L),S==="define"?`
#ifndef HAS_UNIFORM_u_${L}
in ${P} ${k} ${L};
#else
uniform ${P} ${k} u_${L};
#endif
`:S==="initialize"?`
#ifdef HAS_UNIFORM_u_${L}
    ${P} ${k} ${L} = u_${L};
#endif
`:S==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${L}
    in ${P} ${k} ${L};
#endif
`:S==="initialize-attribute"?"":void 0)),vertexSource:r=r.replace(Ol,(w,S,P,k,L)=>{const V=`MATERIAL_ATTRIBUTE_OFFSET_${L}`,B=k==="float"?"vec2":k,U=`GET_ATTRIBUTE_${B}(a_${L}, materialInfo, ${V})`,Z=L.match(/color/)?"color":B;return S==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${L}
in ${P} ${k} a_${L};
#endif
`:c.has(L)?S==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
    #if !defined(${V})
        in ${P} ${B} a_${L};
    #endif
out ${P} ${k} ${L};
#else
uniform ${P} ${k} u_${L};
#endif
`:S==="initialize"?Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${P} ${k} ${L} = u_${L};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${L})
    #ifdef ${V}
        ${L} = unpack_mix_${Z}(${U}, u_${L}_t);
    #else
        ${L} = unpack_mix_${Z}(a_${L}, u_${L}_t);
    #endif
#else
    ${P} ${k} ${L} = u_${L};
#endif
`:S==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${L}
    in ${P} ${k} a_${L};
    out ${P} ${k} ${L};
#endif
`:S==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${L}
    ${L} = a_${L};
#endif
`:void 0:S==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
    #if !defined(${V})
        in ${P} ${B} a_${L};
    #endif
#else
uniform ${P} ${k} u_${L};
#endif
`:S==="define-instanced"?Z==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${L}0;
in vec4 a_${L}1;
in vec4 a_${L}2;
in vec4 a_${L}3;
#else
uniform ${P} ${k} u_${L};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${P} ${B} a_${L};
#else
uniform ${P} ${k} u_${L};
#endif
`:S==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${L}
    ${P} ${k} ${L} = a_${L};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    #ifdef ${V}
        ${P} ${k} ${L} = ${U};
    #else
        ${P} ${k} ${L} = a_${L};
    #endif
#else
    ${P} ${k} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    #ifdef ${V}
        ${P} ${k} ${L} = unpack_mix_${Z}(${U}, u_${L}_t);
    #else
        ${P} ${k} ${L} = unpack_mix_${Z}(a_${L}, u_${L}_t);
    #endif
#else
    ${P} ${k} ${L} = u_${L};
#endif
`}),usedDefines:b,vertexIncludes:p,fragmentIncludes:y}}class vI{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,c,p,y,b,w,S,P){this.context=r;let k=this.boundPaintVertexBuffers.length!==y.length;for(let V=0;!k&&V<y.length;V++)this.boundPaintVertexBuffers[V]!==y[V]&&(k=!0);let L=this.boundDynamicVertexBuffers.length!==S.length;for(let V=0;!L&&V<S.length;V++)this.boundDynamicVertexBuffers[V]!==S[V]&&(L=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==p||k||L||this.boundIndexBuffer!==b||this.boundVertexOffset!==w)this.freshBind(c,p,y,b,w,S,P);else{r.bindVertexArrayOES.set(this.vao);for(const V of S)V&&(V.bind(),P&&V.instanceCount&&V.setVertexAttribDivisor(r.gl,c,P));b&&b.dynamicDraw&&b.bind()}}freshBind(r,c,p,y,b,w,S){const P=this.context,k=P.gl;this.vao&&this.destroy(),this.vao=P.gl.createVertexArray(),P.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=y,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=w,c.enableAttributes(k,r),c.bind(),c.setVertexAttribPointers(k,r,b);for(const L of p)L.enableAttributes(k,r),L.bind(),L.setVertexAttribPointers(k,r,b);for(const L of w)L&&(L.enableAttributes(k,r),L.bind(),L.setVertexAttribPointers(k,r,b),S&&L.instanceCount&&L.setVertexAttribDivisor(k,r,S));y&&y.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function xI(f,r){const c=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new o.ae(0,p/c).toLngLat().lat,new o.ae(0,(p+1)/c).toLngLat().lat]}function bI(f,r,c,p,y,b,w){const S=f.context,P=S.gl,k=c.hillshadeFBO;if(!k)return;f.prepareDrawTile();const L=f.isTileAffectedByFog(r),V=[];f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&V.push("USE_MRT1");const B=f.getOrCreateProgram("hillshade",{overrideFog:L,defines:V});S.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,k.colorAttachment0.get());const U=((te,le,he,ce)=>{const Ee=he.paint.get("hillshade-shadow-color"),ye=he.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",we=he.paint.get("hillshade-highlight-color"),_e=he.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",pe=he.paint.get("hillshade-accent-color"),Se=he.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",De=he.paint.get("hillshade-emissive-strength");let Me=o.an(he.paint.get("hillshade-illumination-direction"));if(he.paint.get("hillshade-illumination-anchor")==="viewport")Me-=te.transform.angle;else if(te.style&&te.style.enable3dLights()&&te.style.directionalLight){const We=te.style.directionalLight.properties.get("direction"),tt=o.d4(We.x,We.y,We.z);Me=o.an(tt[1])}const He=!te.options.moving;return{u_matrix:ce||te.transform.calculateProjMatrix(le.tileID.toUnwrapped(),He),u_image:0,u_latrange:xI(0,le.tileID),u_light:[he.paint.get("hillshade-exaggeration"),Me],u_shadow:Ee.toPremultipliedRenderColor(ye?null:he.lut),u_highlight:we.toPremultipliedRenderColor(_e?null:he.lut),u_emissive_strength:De,u_accent:pe.toPremultipliedRenderColor(Se?null:he.lut)}})(f,c,p,f.terrain?r.projMatrix:null);f.uploadCommonUniforms(S,B,r.toUnwrapped());const{tileBoundsBuffer:Z,tileBoundsIndexBuffer:W,tileBoundsSegments:ne}=f.getTileBoundsBuffers(c);B.draw(f,P.TRIANGLES,y,b,w,mn.disabled,U,p.id,Z,W,ne)}function Rv(f,r,c){if(!r.needsDEMTextureUpload)return;const p=f.context,y=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||f.getTileTexture(c.stride);const b=c.getPixels();r.demTexture?r.demTexture.update(b,{premultiply:!1}):r.demTexture=new o.T(p,b,y.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function wI(f,r,c){const p=f.context,y=p.gl;if(!r.dem)return;const b=r.dem;if(p.activeTexture.set(y.TEXTURE1),Rv(f,r,b),!r.demTexture)return;r.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const w=b.dim;p.activeTexture.set(y.TEXTURE0);let S=r.hillshadeFBO;if(!S){const B=new o.T(p,{width:w,height:w,data:null},y.RGBA8);B.bind(y.LINEAR,y.CLAMP_TO_EDGE),S=r.hillshadeFBO=p.createFramebuffer(w,w,1,"renderbuffer"),S.colorAttachment0.set(B.texture)}p.bindFramebuffer.set(S.framebuffer),p.viewport.set([0,0,w,w]);const{tileBoundsBuffer:P,tileBoundsIndexBuffer:k,tileBoundsSegments:L}=f.getMercatorTileBoundsBuffers(),V=[];f.linearFloatFilteringSupported()&&V.push("TERRAIN_DEM_FLOAT_FORMAT"),f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&V.push("USE_MRT1"),f.getOrCreateProgram("hillshadePrepare",{defines:V}).draw(f,y.TRIANGLES,Xt.disabled,yn.disabled,Rn.unblended,mn.disabled,((B,U)=>{const Z=U.stride,W=o.bC();return o.ce(W,0,o.al,-o.al,0,0,1),o.br(W,W,[0,-o.al,0]),{u_matrix:W,u_image:1,u_dimension:[Z,Z],u_zoom:B.overscaledZ}})(r.tileID,b),c.id,P,k,L),r.needsHillshadePrepare=!1}class ar{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class TI extends ar{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Ob extends ar{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Mv extends ar{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class gg extends ar{getDefault(){return[!0,!0,!0,!0]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class kv extends ar{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class pd extends ar{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class fh extends ar{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const c=this.current;(r.func!==c.func||r.ref!==c.ref||r.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class _p extends ar{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class ph extends ar{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=r,this.dirty=!1}}class Fb extends ar{getDefault(){return[0,1]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Dv extends ar{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=r,this.dirty=!1}}class zb extends ar{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class mh extends ar{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.BLEND):c.disable(c.BLEND),this.current=r,this.dirty=!1}}class _g extends ar{getDefault(){const r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class yg extends ar{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Nv extends ar{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class vg extends ar{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=r,this.dirty=!1}}class yp extends ar{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class jb extends ar{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let Bb=class extends ar{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class Vb extends ar{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class gh extends ar{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Ub extends ar{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class EI extends ar{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class SI extends ar{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class CI extends ar{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Lv extends ar{getDefault(){return null}set(r){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Ov extends ar{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class Fv extends ar{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class zv extends ar{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class $b extends ar{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class xg extends ar{constructor(r,c){super(r),this.context=r,this.parent=c}getDefault(){return null}}class bg extends xg{constructor(r,c,p=0){super(r,c),this.attachmentPoint=r.gl.COLOR_ATTACHMENT0+p}setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachmentPoint,c.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class _h extends xg{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class vp extends xg{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Gb extends _h{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const sa=(f,r,c,p)=>({u_matrix:f,u_image0:0,u_image1:1,u_skirt_height:r,u_ground_shadow_factor:c,u_emissive_texture_available:p}),wg=(f,r,c,p,y,b,w,S,P,k,L,V,B,U,Z,W,ne)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:c,u_zoom_transition:y,u_merc_center:b,u_image0:0,u_image1:1,u_frustum_tl:w,u_frustum_tr:S,u_frustum_br:P,u_frustum_bl:k,u_globe_pos:L,u_globe_radius:V,u_viewport:B,u_grid_matrix:ne?Float32Array.from(ne):new Float32Array(9),u_skirt_height:U,u_far_z_cutoff:Z,u_emissive_texture_available:W});function xp(f,r){return f!=null&&r!=null&&!(!f.hasData()||!r.hasData())&&f.demTexture!=null&&r.demTexture!=null&&f.tileID.key!==r.tileID.key}const dc=new class{constructor(){this.operations={}}newMorphing(f,r,c,p,y){if(f in this.operations){const b=this.operations[f];b.to.tileID.key!==c.tileID.key&&(b.queued=c)}else this.operations[f]={startTime:p,phase:0,duration:y,from:r,to:c,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const r=this.operations[f];return{from:r.from,to:r.to,phase:r.phase}}update(f){for(const r in this.operations){const c=this.operations[r];for(c.phase=(f-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,f)){delete this.operations[r];break}}}_nextOp(f,r){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=r,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Tg={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Eg(f,r,c){if(r===0)return 0;const p=r<1&&c===514?.25/r:1;return 6*Math.pow(1.5,22-f)*Math.max(r,1)*p}function jv(f,r){const c=1<<f.z;return!r&&(f.x===0||f.x===c-1)||f.y===0||f.y===c-1}function yh(f,r){if(!f.style||!f.style.enable3dLights())return;const c=f.context,p=c.gl;c.activeTexture.set(p.TEXTURE1),r?r.bind(p.LINEAR,p.CLAMP_TO_EDGE):f.emptyTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)}const bp=f=>({u_matrix:f});function wp(f,r,c,p,y){if(y>0){const b=o.o.now(),w=(b-f.timeAdded)/y,S=r?(b-r.timeAdded)/y:-1,P=c.getSource(),k=p.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),L=!r||Math.abs(r.tileID.overscaledZ-k)>Math.abs(f.tileID.overscaledZ-k),V=L&&f.refreshedUponExpiration?1:o.aA(L?w:1-S,0,1);return r?{opacity:1,mix:1-V,isFading:w<1}:{opacity:V,mix:0,isFading:w<1}}return{opacity:1,mix:0,isFading:!1}}class Sg extends Go{constructor(r){const c=gs("mock-dem",{type:"raster-dem",maxzoom:r.transform.maxZoom},r.style.dispatcher,r.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,c){r.state="loaded",c(null)}}class Bv extends Go{constructor(r){const c=gs("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},r.style.dispatcher,r.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,c,p){if(r.freezeTileCoverage)return;this.transform=r;const y=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,w)=>{if(b[w.key]="",!this._tiles[w.key]){const S=new ld(w,this._source.tileSize*w.overscaleFactor(),r.tileZoom,void 0,void 0,this._source.worldview);S.state="loaded",this._tiles[w.key]=S}return b},{});for(const b in this._tiles)b in y||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(r){const c=this.proxyCachedFBO[r];if(c!==void 0){const p=Object.values(c);this.renderCachePool.push(...p),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Vv extends o.aQ{constructor(r,c,p){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=c,this.projMatrix=p}}class Uv extends o.bV{constructor(r,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,y,b]=function(P){const k=new o.bd,L=new o.b0,V=131;k.reserve(17161),L.reserve(33800);const B=o.al/128,U=o.al+B/2,Z=U+B;for(let ne=-B;ne<Z;ne+=B)for(let te=-B;te<Z;te+=B){const le=te<0||te>U||ne<0||ne>U?24575:0,he=o.aA(Math.round(te),0,o.al),ce=o.aA(Math.round(ne),0,o.al);k.emplaceBack(he+le,ce)}const W=(ne,te)=>{const le=te*V+ne;L.emplaceBack(le+1,le,le+V),L.emplaceBack(le+V,le+V+1,le+1)};for(let ne=1;ne<129;ne++)for(let te=1;te<129;te++)W(te,ne);return[0,129].forEach(ne=>{for(let te=0;te<130;te++)W(te,ne),W(ne,te)}),[k,L,32768]}(),w=r.context;this.gridBuffer=w.createVertexBuffer(p,o.bf.members),this.gridIndexBuffer=w.createIndexBuffer(y),this.gridSegments=o.bg.simpleSegment(0,0,p.length,y.length),this.gridNoSkirtSegments=o.bg.simpleSegment(0,0,p.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Bv(c.map),this.orthoMatrix=o.bC(),o.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.al,0,o.al,0,1);const S=w.gl;this._overlapStencilMode=new yn({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Sg(c.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,c,p){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);const y=r.terrain.properties,b=r.terrain.drapeRenderMode===0,w=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.o.now();const S=r.terrain&&r.terrain.scope,P=y.get("source"),k=b?this._mockSourceCache:r.getSourceCache(P,S);if(!k)return void o.w(`Couldn't find terrain source "${P}".`);if(this.sourceCache=k,this._attenuationRange=r.terrain.getAttenuationRange(),this._exaggeration=w?this.calculateExaggeration(c):y.get("exaggeration"),!c.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;const L=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const V=this.getScaledDemTileSize();this.sourceCache.update(c,V,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),c.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(r){if(this._attenuationRange&&r.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(r.zoom);const c=this._previousCameraAltitude,p=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=p;const y=c!=null?p-c:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const b=r.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(b);let S=b-this._previousZoom;const P=this._previousUpdateTimestamp;let k=b;this._evaluationZoom!=null&&(k=this._evaluationZoom,Math.abs(b-k)>.5&&(S=.5*(b-k+S)),S*y<0&&(k+=S)),this._evaluationZoom=k;const L=w.getExaggeration(k),V=L===w.getExaggeration(Math.max(0,k-.1));if(V&&Math.abs(L-this._exaggeration)<.01)return L;let B=Math.min(.1,.00375*(this._updateTimestamp-P));return(V||L<.1||Math.abs(S)<1e-4)&&(B=Math.min(.2,4*B)),o.ak(this._exaggeration,L,B)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.dataType==="source"&&r.coord?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(o.ae.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=c.getIds().map(P=>{const k=c.getTileByID(P).tileID;return k.projMatrix=p.calculateProjMatrix(k.toUnwrapped()),k});(function(P,k){const L=k.transform.pointCoordinate(k.transform.getCameraPoint()),V=new o.P(L.x,L.y);P.sort((B,U)=>{if(U.overscaledZ-B.overscaledZ)return U.overscaledZ-B.overscaledZ;const Z=new o.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),W=new o.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),ne=V.mult(1<<B.canonical.z);return ne.x-=.5,ne.y-=.5,ne.distSqr(Z)-ne.distSqr(W)})})(y,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},y.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const w=this._style._mergedSourceCaches;for(const P in w){const k=w[P];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,r[P],b),k.usedForTerrain))continue;const L=r[P];k.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[c.id]=y.map(P=>new Vv(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const S={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const k=this.terrainTileForTile[P.key];if(!k)continue;const L=k.tileID.key;L in S||(this._visibleDemTiles.push(k),S[L]=L)}}_assignTerrainTiles(r){this._initializing||r.forEach(c=>{if(this.terrainTileForTile[c.key])return;const p=this._findTileCoveringTileID(c,this.sourceCache);p&&(this.terrainTileForTile[c.key]=p)})}_prepareDEMTextures(){const r=this.painter.context,c=r.gl;for(const p in this.terrainTileForTile){const y=this.terrainTileForTile[p],b=y.dem;!b||y.demTexture&&!y.needsDEMTextureUpload||(r.activeTexture.set(c.TEXTURE1),Rv(this.painter,y,b))}}_prepareDemTileUniforms(r,c,p,y){if(!c||c.demTexture==null)return!1;const b=r.tileID.canonical,w=Math.pow(2,c.tileID.canonical.z-b.z),S=y||"";return p[`u_dem_tl${S}`]=[b.x*w%1,b.y*w%1],p[`u_dem_scale${S}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let r=0;const c=this._visibleDemTiles.reduce((p,y)=>{if(!y.dem)return p;const b=y.dem.tree.minimums[0];return b>0&&r++,p+b},0);return r?c/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,c=r.gl;r.activeTexture.set(c.TEXTURE2);const p=this._getLoadedAreaMinimum(),y=new o.dL({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(y,{premultiply:!1}):b=this._emptyDEMTexture=new o.T(r,y,c.R32F,{premultiply:!1}),b}setupElevationDraw(r,c,p){const y=this.painter.context,b=y.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};w.u_exaggeration=this.exaggeration();let S=null,P=null,k=1;if(p&&p.morphing&&this._useVertexMorphing){const U=p.morphing.srcDemTile,Z=p.morphing.dstDemTile;k=p.morphing.phase,U&&Z&&(this._prepareDemTileUniforms(r,U,w,"_prev")&&(P=U),this._prepareDemTileUniforms(r,Z,w)&&(S=Z))}const L=U=>U&&U.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let V=null;var B;if(this.enabled?P&&S?(V=S.demTexture,y.activeTexture.set(b.TEXTURE4),P.demTexture.bind(L(P),b.CLAMP_TO_EDGE),w.u_dem_lerp=k):(S=this.terrainTileForTile[r.tileID.key],V=this._prepareDemTileUniforms(r,S,w)?S.demTexture:this.emptyDEMTexture):V=this.emptyDEMTexture,y.activeTexture.set(b.TEXTURE2),V&&(w.u_dem_size=(B=V).size[0]===1?1:B.size[0]-2,V.bind(L(S),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,c,w),p&&p.useMeterToDem&&S){const U=(1<<S.tileID.canonical.z)*o.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=U}if(p&&p.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),c.setTerrainUniformValues(y,w),this.painter.transform.projection.name==="globe"){const U=this.globeUniformValues(this.painter.transform,r.tileID.canonical,p&&p.useDenormalizedUpVectorScale);c.setGlobeUniformValues(y,U)}}globeUniformValues(r,c,p){const y=r.projection;return{u_tile_tl_up:y.upVector(c,0,0),u_tile_tr_up:y.upVector(c,o.al,0),u_tile_br_up:y.upVector(c,o.al,o.al),u_tile_bl_up:y.upVector(c,0,o.al),u_tile_up_scale:p?o.dM(1):y.upVectorScale(c,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const c=this.painter,p=this.painter.context;r.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,b,w,S,P){if(y.transform.projection.name==="globe")(function(k,L,V,B,U){const Z=k.context,W=Z.gl;let ne,te;const le=k.transform,he=o.dE(k,Z,le),ce=(He,We)=>{if(te===We)return;const tt=[Tg[We],"PROJECTION_GLOBE_VIEW"];he&&tt.push("CUSTOM_ANTIALIASING");const gt=k.isTileAffectedByFog(He);ne=k.getOrCreateProgram("globeRaster",{defines:tt,overrideFog:gt}),te=We},Ee=k.colorModeForRenderPass(),ye=new Xt(W.LEQUAL,Xt.ReadWrite,k.depthRangeFor3D);dc.update(U);const we=o.dF(le),_e=[o.aF(le.center.lng),o.aJ(le.center.lat)],pe=k.globeSharedBuffers,Se=[le.width*o.o.devicePixelRatio,le.height*o.o.devicePixelRatio],De=Float32Array.from(le.globeMatrix),Me={useDenormalizedUpVectorScale:!0};{const He=k.transform,We=Eg(He.zoom,L.exaggeration(),L.sourceCache._source.tileSize);te=-1;const tt=W.TRIANGLES;for(const gt of B){const Ve=V.getTile(gt),Pe=yn.disabled,Xe=L.prevTerrainTileForTile[gt.key],Ue=L.terrainTileForTile[gt.key];xp(Xe,Ue)&&dc.newMorphing(gt.key,Xe,Ue,U,250),yh(k,Ve.emissiveTexture),Z.activeTexture.set(W.TEXTURE0),Ve.texture&&Ve.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const lt=dc.getMorphValuesForProxy(gt.key),St=lt?1:0;lt&&Object.assign(Me,{morphing:{srcDemTile:lt.from,dstDemTile:lt.to,phase:o.dD(lt.phase)}});const Dt=o.dG(gt.canonical),bt=o.dH(Dt.getCenter().lat),_t=o.dI(gt.canonical,Dt,bt,He.worldSize/He._pixelsPerMercatorPixel),Gt=o.bk(o.dJ(gt.canonical)),Bt=k.emissiveMode==="mrt-fallback"?1:0,Mt=wg(He.expandedFarZProjMatrix,De,we,Gt,o.aj(He.zoom),_e,He.frustumCorners.TL,He.frustumCorners.TR,He.frustumCorners.BR,He.frustumCorners.BL,He.globeCenterInViewSpace,He.globeRadius,Se,We,He._farZ,Bt,_t);if(ce(gt,St),ne&&(L.setupElevationDraw(Ve,ne,Me),k.uploadCommonUniforms(Z,ne,gt.toUnwrapped()),pe)){const[Lt,on,Sn]=pe.getGridBuffers(bt,We!==0);ne.draw(k,tt,ye,Pe,Ee,mn.backCCW,Mt,"globe_raster",Lt,on,Sn)}}}if(pe&&(k.renderDefaultNorthPole||k.renderDefaultSouthPole)){const He=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];he&&He.push("CUSTOM_ANTIALIASING"),ne=k.getOrCreateProgram("globeRaster",{defines:He});for(const We of B){const{x:tt,y:gt,z:Ve}=We.canonical,Pe=gt===0,Xe=gt===(1<<Ve)-1,[Ue,lt,St,Dt]=pe.getPoleBuffers(Ve,!1);if(Dt&&(Pe||Xe)){const bt=V.getTile(We);yh(k,bt.emissiveTexture),Z.activeTexture.set(W.TEXTURE0),bt.texture&&bt.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let _t=o.dK(Ve,tt,le);const Gt=o.bk(o.dJ(We.canonical)),Bt=k.emissiveMode==="mrt-fallback"?1:0,Mt=(Lt,on)=>Lt.draw(k,W.TRIANGLES,ye,yn.disabled,Ee,mn.disabled,wg(le.expandedFarZProjMatrix,_t,_t,Gt,0,_e,le.frustumCorners.TL,le.frustumCorners.TR,le.frustumCorners.BR,le.frustumCorners.BL,le.globeCenterInViewSpace,le.globeRadius,Se,0,le._farZ,Bt),"globe_pole_raster",on,St,Dt);L.setupElevationDraw(bt,ne,Me),k.uploadCommonUniforms(Z,ne,We.toUnwrapped()),Pe&&k.renderDefaultNorthPole&&Mt(ne,Ue),Xe&&k.renderDefaultSouthPole&&(_t=o.cS(o.bC(),_t,[1,-1,1]),Mt(ne,lt))}}}})(y,b,w,S,P);else{const k=y.context,L=k.gl;let V,B;const U=y.shadowRenderer,Z=pu(y,y.longestCutoffRange),W=Ee=>{if(B===Ee)return;const ye=[];ye.push(Tg[Ee]),Z.shouldRenderCutoff&&ye.push("RENDER_CUTOFF"),U&&(ye.push("RENDER_SHADOWS","DEPTH_TEXTURE"),U.useNormalOffset&&ye.push("NORMAL_OFFSET")),V=y.getOrCreateProgram("terrainRaster",{defines:ye}),B=Ee},ne=y.colorModeForRenderPass(),te=new Xt(L.LEQUAL,Xt.ReadWrite,y.depthRangeFor3D);dc.update(P);const le=y.transform,he=Eg(le.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let ce=[0,0,0];if(U){const Ee=y.style.directionalLight,ye=y.style.ambientLight;Ee&&ye&&(ce=uc(y.style,Ee,ye))}{B=-1;const Ee=L.TRIANGLES,[ye,we]=[b.gridIndexBuffer,b.gridSegments];for(const _e of S){const pe=w.getTile(_e),Se=yn.disabled,De=b.prevTerrainTileForTile[_e.key],Me=b.terrainTileForTile[_e.key];xp(De,Me)&&dc.newMorphing(_e.key,De,Me,P,250),yh(y,pe.emissiveTexture),k.activeTexture.set(L.TEXTURE0),pe.texture&&pe.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const He=dc.getMorphValuesForProxy(_e.key),We=He?1:0;let tt;He&&(tt={morphing:{srcDemTile:He.from,dstDemTile:He.to,phase:o.dD(He.phase)}});const gt=y.emissiveMode==="mrt-fallback"?1:0,Ve=sa(_e.projMatrix,jv(_e.canonical,le.renderWorldCopies)?he/10:he,ce,gt);if(W(We),!V)continue;b.setupElevationDraw(pe,V,tt);const Pe=_e.toUnwrapped();U&&U.setupShadows(Pe,V),y.uploadCommonUniforms(k,V,Pe,null,Z),V.draw(y,Ee,te,Se,ne,mn.backCCW,Ve,"terrain_raster",b.gridBuffer,ye,we)}}}}(c,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const c=this.painter,p=this.painter.context,y=this.proxySourceCache,b=this.proxiedCoords[y.id],w=this._drapedRenderBatches.shift(),S=c.style.order,P=[];this._updateFBOs(c.emissiveMode==="mrt-fallback");let k=0;for(const L of b){const V=y.getTileByID(L.proxyTileKey),B=y.proxyCachedFBO[L.key]?y.proxyCachedFBO[L.key][r]:void 0,U=B!==void 0?y.renderCache[B]:this.pool[k++],Z=B!==void 0;if(V.texture=U.tex,V.emissiveTexture=U.emissiveTex,Z&&!U.dirty){P.push(V.tileID);continue}p.bindFramebuffer.set(U.fb.framebuffer);const W=p.gl;let ne;W.drawBuffers(c.emissiveMode==="mrt-fallback"?[W.COLOR_ATTACHMENT0,W.COLOR_ATTACHMENT1]:[W.COLOR_ATTACHMENT0]),this.renderedToTile=!1,U.dirty&&(p.clear({color:o.ao.transparent,stencil:0}),U.dirty=!1);for(let te=w.start;te<=w.end;++te){const le=c.style._mergedLayers[S[te]];if(le.isHidden(c.transform.zoom))continue;const he=c.style.getLayerSourceCache(le),ce=he?this.proxyToSource[L.key][he.id]:[L];if(!ce)continue;const Ee=ce;p.viewport.set([0,0,U.fb.width,U.fb.height]),ne!==(he?he.id:null)&&(this._setupStencil(U,ce,le,he),ne=he?he.id:null),c.renderLayer(c,he,le,Ee)}if(W.drawBuffers([W.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const te of this._pendingGroundEffectLayers){const le=c.style._mergedLayers[S[te]];if(le.isHidden(c.transform.zoom))continue;const he=c.style.getLayerSourceCache(le),ce=he?this.proxyToSource[L.key][he.id]:[L];if(!ce)continue;const Ee=ce;p.viewport.set([0,0,U.fb.width,U.fb.height]),ne!==(he?he.id:null)&&(this._setupStencil(U,ce,le,he),ne=he?he.id:null),c.renderLayer(c,he,le,Ee)}this.renderedToTile?(U.dirty=!0,P.push(V.tileID)):Z||--k,k===5&&(k=0,this.renderToBackBuffer(P))}return this.renderToBackBuffer(P),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),w.end+1}postRender(){}isLayerOrderingCorrect(r){const c=r.order.length;let p=-1,y=c;for(let b=0;b<c;++b)this._style.isLayerDraped(r._mergedLayers[r.order[b]])?p=Math.max(p,b):y=Math.min(y,b);return y>p}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{r=Math.min(r,c.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,c,p){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const w=b.tileID,S=1<<w.overscaledZ,{x:P,y:k}=w.canonical,L=P/S,V=(P+1)/S,B=k/S,U=(k+1)/S;return{minx:L,miny:B,maxx:V,maxy:U,t:b.dem.tree.raycastRoot(L,B,V,U,r,c,p),tile:b}});y.sort((b,w)=>(b.t!==null?b.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const b of y){if(b.t==null)return null;const w=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,r,c,p);if(w!=null)return w}return null}_createFBO(){const r=this.painter.context,c=r.gl,p=this.drapeBufferSize;r.activeTexture.set(c.TEXTURE0);const y=new o.T(r,{width:p[0],height:p[1],data:null},c.RGBA8);y.bind(c.LINEAR,c.CLAMP_TO_EDGE);const b=r.createFramebuffer(p[0],p[1],1,null);let w;return b.colorAttachment0.set(y.texture),this._emissiveTexture&&(w=new o.T(r,{width:p[0],height:p[1],data:null},c.R8),w.bind(c.LINEAR,c.CLAMP_TO_EDGE),b.createColorAttachment(r,1),b.colorAttachment1.set(w.texture)),b.depthAttachment=new Gb(r,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:b,tex:y,emissiveTex:w,dirty:!1}}_updateFBOs(r){if(this._emissiveTexture!==r){for(const c of this.pool)this._updateFBO(c,r);for(const c of this.proxySourceCache.renderCache)this._updateFBO(c,r);this._emissiveTexture=r}}_updateFBO(r,c){const p=r.fb,y=this.painter.context,b=y.gl,w=this.drapeBufferSize;if(c){const S=new o.T(y,{width:w[0],height:w[1],data:null},b.R8);S.bind(b.LINEAR,b.CLAMP_TO_EDGE),r.emissiveTex=S,p.createColorAttachment(y,1),p.colorAttachment1.set(S.texture)}else r.emissiveTex=void 0,p.removeColorAttachment(y,1);r.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const c=this._style._mergedLayers[r],p=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!p&&c.shouldRedrape():!p&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const p of this._style.getSources())if(p instanceof sd){r=!0;break}if(!r)return;const c={};for(let p=0;p<this._style.order.length;++p){const y=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(y);if(!b||c[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="line")continue;const w=y.widthExpression(),S=y.emissiveStrengthExpression();if(w instanceof o.ad||S instanceof o.ad){c[b.id]=!0;for(const P of this.proxyCoords){const k=this.proxyToSource[P.key][b.id];if(k)for(const L of k)this._clearRenderCacheForTile(b.id,L)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof Es){r=!0;break}if(!r)return;const c={};for(let p=0;p<this._style.order.length;++p){const y=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(y);if(!b||c[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const w=y.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const P=this.proxyToSource[S.key][b.id];if(P)for(const k of P){const L=wp(b.getTile(k),b.findLoadedParent(k,0),b,this.painter.transform,w);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(b.id,k)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const r=this._style.order,c=r.length;if(c===0)return;const p=[];this._pendingGroundEffectLayers=[];let y,b=0,w=this._style._mergedLayers[r[b]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++b<c;)w=this._style._mergedLayers[r[b]];for(;b<c;++b){const S=this._style._mergedLayers[r[b]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?y===void 0&&(y=b):(S.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),y!==void 0&&(p.push({start:y,end:b-1}),y=void 0)))}if(y!==void 0&&p.push({start:y,end:b-1}),p.length!==0){const S=p[p.length-1];this._pendingGroundEffectLayers.every(P=>P>S.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(r){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const w=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let S=0;S<w.length;++S){const P=Object.values(w[S]);c.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,y=this._tilesDirty;for(let w=p.length-1;w>=0;w--){const S=p[w];if(c.getTileByID(S.key),c.proxyCachedFBO[S.key]!==void 0){const P=r[S.key],k=this.proxyToSource[S.key];let L=0;for(const V in k){const B=k[V],U=P[V];if(!U||U.length!==B.length||B.some((Z,W)=>Z!==U[W]||y[V]&&y[V].hasOwnProperty(Z.key))){L=-1;break}++L}for(const V in c.proxyCachedFBO[S.key])c.renderCache[c.proxyCachedFBO[S.key][V]].dirty=L<0||L!==Object.values(P).length}}const b=[...this._drapedRenderBatches];b.sort((w,S)=>S.end-S.start-(w.end-w.start));for(const w of b)for(const S of p){if(c.proxyCachedFBO[S.key])continue;let P=c.renderCachePool.pop();P===void 0&&c.renderCache.length<50&&(P=c.renderCache.length,c.renderCache.push(this._createFBO())),P!==void 0&&(c.proxyCachedFBO[S.key]={},c.proxyCachedFBO[S.key][w.start]=P,c.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(r,c,p,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,w=b.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let S;if(p.isTileClipped())S=c.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):yn.disabled}_renderTileClippingMasks(r,c){const p=this.painter,y=this.painter.context,b=y.gl;p._tileClippingMaskIDs={},y.setColorMode(Rn.disabled),y.setDepthMode(Xt.disabled);const w=p.getOrCreateProgram("clippingMask");for(const S of r){const P=p._tileClippingMaskIDs[S.key]=--c;w.draw(p,b.TRIANGLES,Xt.disabled,new yn({func:b.ALWAYS,mask:0},P,255,b.KEEP,b.KEEP,b.REPLACE),Rn.disabled,mn.disabled,bp(S.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(r){const c=this.painter.transform;if(r.x<0||r.x>c.width||r.y<0||r.y>c.height)return null;const p=[r.x,r.y,1,1];o.aC(p,p,c.pixelMatrixInverse),o.cK(p,p,1/p[3]),p[0]/=c.worldSize,p[1]/=c.worldSize;const y=c._camera.position,b=o.cf(1,c.center.lat),w=[y[0],y[1],y[2]/b,0],S=o.da([],p.slice(0,3),w);o.aw(S,S);const P=this.raycast(w,S,this._exaggeration);return P!==null&&P?(o.bH(w,w,S,P),w[3]=w[2],w[2]*=b,w):null}_setupProxiedCoordsForOrtho(r,c,p){if(r.getSource()instanceof o.aU)return this._setupProxiedCoordsForImageSource(r,c,p);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const y=this.proxiedCoords[r.id]=[],b=this.proxyCoords;for(let P=0;P<b.length;P++){const k=b[P],L=this._findTileCoveringTileID(k,r);if(L){const V=this._createProxiedId(k,L,p[k.key]&&p[k.key][r.id]);y.push(V),this.proxyToSource[k.key][r.id]=[V]}}let w=!1;const S=new Set;for(let P=0;P<c.length;P++){const k=r.getTile(c[P]);if(!k||!k.hasData())continue;const L=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==k.tileID.canonical.z){const V=this.proxyToSource[L.tileID.key][r.id],B=this._createProxiedId(L.tileID,k,p[L.tileID.key]&&p[L.tileID.key][r.id]);V?V.splice(V.length-1,0,B):this.proxyToSource[L.tileID.key][r.id]=[B];const U=this.proxyToSource[L.tileID.key][r.id];S.has(U)||S.add(U),y.push(B),w=!0}}if(this._sourceTilesOverlap[r.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(const P of S)P.sort((k,L)=>L.overscaledZ-k.overscaledZ)}_setupProxiedCoordsForImageSource(r,c,p){if(!r.getSource().loaded())return;const y=this.proxiedCoords[r.id]=[],b=this.proxyCoords,w=r.getSource(),S=w.tileID;if(!S)return;const P=new o.P(S.x,S.y)._div(1<<S.z),k=w.coordinates.map(o.ae.fromLngLat).reduce((V,B)=>(V.min.x=Math.min(V.min.x,B.x-P.x),V.min.y=Math.min(V.min.y,B.y-P.y),V.max.x=Math.max(V.max.x,B.x-P.x),V.max.y=Math.max(V.max.y,B.y-P.y),V),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(V,B)=>{const U=V.wrap+V.canonical.x/(1<<V.canonical.z),Z=V.canonical.y/(1<<V.canonical.z),W=o.al/(1<<V.canonical.z),ne=B.wrap+B.canonical.x/(1<<B.canonical.z),te=B.canonical.y/(1<<B.canonical.z);return U+W<ne+k.min.x||U>ne+k.max.x||Z+W<te+k.min.y||Z>te+k.max.y};for(let V=0;V<b.length;V++){const B=b[V];for(let U=0;U<c.length;U++){const Z=r.getTile(c[U]);if(!Z||!Z.hasData()||L(B,Z.tileID))continue;const W=this._createProxiedId(B,Z,p[B.key]&&p[B.key][r.id]),ne=this.proxyToSource[B.key][r.id];ne?ne.push(W):this.proxyToSource[B.key][r.id]=[W],y.push(W)}}}_createProxiedId(r,c,p){let y=this.orthoMatrix;if(p){const b=p.find(w=>w.key===c.tileID.key);if(b)return b}if(c.tileID.key!==r.key){const b=r.canonical.z-c.tileID.canonical.z;let w,S,P;y=o.bC();const k=c.tileID.wrap-r.wrap<<r.overscaledZ;b>0?(w=o.al>>b,S=w*((c.tileID.canonical.x<<b)-r.canonical.x+k),P=w*((c.tileID.canonical.y<<b)-r.canonical.y)):(w=o.al<<-b,S=o.al*(c.tileID.canonical.x-(r.canonical.x+k<<-b)),P=o.al*(c.tileID.canonical.y-(r.canonical.y<<-b))),o.ce(y,0,w,0,w,0,1),o.br(y,y,[S,P,0])}return new Vv(c.tileID,r.key,y)}_findTileCoveringTileID(r,c){let p=c.getTile(r);if(p&&p.hasData())return p;const y=this._findCoveringTileCache[c.id],b=y[r.key];if(p=b?c.getTileByID(b):null,p&&p.hasData()||b===null)return p;let w=p?p.tileID:r,S=w.overscaledZ;const P=c.getSource().minzoom,k=[];if(!b){const V=c.getSource().maxzoom;if(r.canonical.z>=V){const B=r.canonical.z-V;c.getSource().reparseOverscaled?(S=Math.max(r.canonical.z+2,c.transform.tileZoom),w=new o.aQ(S,r.wrap,V,r.canonical.x>>B,r.canonical.y>>B)):B!==0&&(S=V,w=new o.aQ(S,r.wrap,V,r.canonical.x>>B,r.canonical.y>>B))}w.key!==r.key&&(k.push(w.key),p=c.getTile(w))}const L=V=>{k.forEach(B=>{y[B]=V}),k.length=0};for(S-=1;S>=P&&(!p||!p.hasData());S--){p&&L(p.tileID.key);const V=w.calculateScaledKey(S);if(p=c.getTileByID(V),p&&p.hasData())break;const B=y[V];if(B===null)break;B===void 0?k.push(V):p=c.getTileByID(B)}return L(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,c){let p=this._tilesDirty[r];p||(p=this._tilesDirty[r]={}),p[c.key]=!0}}function vh(f,r,c){const p=function(S,P,k){const L=o.bJ(P,S),V=o.bJ(k,[.2126,.7152,.0722]),B=(Z,W,ne)=>(1-ne)*Z+ne*W,U=B(1-.3*Math.min(V,1),1,Math.min(L+1,1));return B(.92,1,Math.asin(o.aA(P[2],-1,1))/Math.PI+.5)*U}(f,[0,0,1],r),y=[0,0,0];o.c5(y,c.slice(0,3),p);const b=[0,0,0];o.c5(b,r.slice(0,3),f[2]);const w=[0,0,0];return o.d8(w,y,b),o.db(w)}const II=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],AI=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class Hb{static cacheKey(r,c,p,y){const b=[c];y&&b.push(y.cacheKey);for(const w of p)r.usedDefines.has(w)&&b.push(w);return b.join("/")}constructor(r,c,p,y,b,w){const S=r.gl;this.program=S.createProgram(),this.configuration=y,this.name=c,this.fixedDefines=[...w];const P=`#version 300 es
${(y?y.defines():[]).concat(w.map(W=>`#define ${W}`)).join(`
`)}`,k=[P,yI];for(const W of p.fragmentIncludes)k.push(yu[W]);k.push(p.fragmentSource);const L=k.join(`
`),V=[P,Lb];for(const W of p.vertexIncludes)V.push(yu[W]);this.forceManualRenderingForInstanceIDShaders=r.forceManualRenderingForInstanceIDShaders&&p.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&V.push("uniform int u_instanceID;"),V.push(p.vertexSource);let B=V.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(B=B.replaceAll("gl_InstanceID","u_instanceID"));const U=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(U,L),S.compileShader(U),S.attachShader(this.program,U);const Z=S.createShader(S.VERTEX_SHADER);S.isContextLost()?this.failedToCreate=!0:(S.shaderSource(Z,B),S.compileShader(Z),S.attachShader(this.program,Z),this.attributes={},S.linkProgram(this.program),S.deleteShader(Z),S.deleteShader(U),this.fixedUniforms=b(r),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=y?y.getUniforms(r):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(W=>({u_instanceID:new o.ch(W)}))(r)),(w.includes("TERRAIN")||c.includes("symbol")||c.includes("circle"))&&(this.terrainUniforms=(W=>({u_dem:new o.ch(W),u_dem_prev:new o.ch(W),u_dem_tl:new o.ck(W),u_dem_scale:new o.cj(W),u_dem_tl_prev:new o.ck(W),u_dem_scale_prev:new o.cj(W),u_dem_size:new o.cj(W),u_dem_lerp:new o.cj(W),u_exaggeration:new o.cj(W),u_depth:new o.ch(W),u_depth_size_inv:new o.ck(W),u_depth_range_unpack:new o.ck(W),u_occluder_half_size:new o.cj(W),u_occlusion_depth_offset:new o.cj(W),u_meter_to_dem:new o.cj(W),u_label_plane_matrix_inv:new o.cl(W)}))(r)),w.includes("GLOBE")&&(this.globeUniforms=(W=>({u_tile_tl_up:new o.ci(W),u_tile_tr_up:new o.ci(W),u_tile_br_up:new o.ci(W),u_tile_bl_up:new o.ci(W),u_tile_up_scale:new o.cj(W)}))(r)),w.includes("FOG")&&(this.fogUniforms=(W=>({u_fog_matrix:new o.cl(W),u_fog_range:new o.ck(W),u_fog_color:new o.d3(W),u_fog_horizon_blend:new o.cj(W),u_fog_vertical_limit:new o.ck(W),u_fog_temporal_offset:new o.cj(W),u_frustum_tl:new o.ci(W),u_frustum_tr:new o.ci(W),u_frustum_br:new o.ci(W),u_frustum_bl:new o.ci(W),u_globe_pos:new o.ci(W),u_globe_radius:new o.cj(W),u_globe_transition:new o.cj(W),u_is_globe:new o.ch(W),u_viewport:new o.ck(W)}))(r)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(W=>({u_cutoff_params:new o.d3(W)}))(r)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(W=>({u_lighting_ambient_color:new o.ci(W),u_lighting_directional_dir:new o.ci(W),u_lighting_directional_color:new o.ci(W),u_ground_radiance:new o.ci(W)}))(r)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(W=>({u_light_matrix_0:new o.cl(W),u_light_matrix_1:new o.cl(W),u_fade_range:new o.ck(W),u_shadow_normal_offset:new o.ci(W),u_shadow_intensity:new o.cj(W),u_shadow_texel_size:new o.cj(W),u_shadow_map_resolution:new o.cj(W),u_shadow_direction:new o.ci(W),u_shadow_bias:new o.ci(W),u_shadowmap_0:new o.ch(W),u_shadowmap_1:new o.ch(W)}))(r)))}getAttributeLocation(r,c){let p=this.attributes[c];return p===void 0&&(p=this.attributes[c]=r.getAttribLocation(this.program,c)),p}setTerrainUniformValues(r,c){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in c)p[y]&&p[y].set(this.program,y,c[y])}}setGlobeUniformValues(r,c){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in c)p[y]&&p[y].set(this.program,y,c[y])}}setFogUniformValues(r,c){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in c)p[y].set(this.program,y,c[y])}}setCutoffUniformValues(r,c){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in c)p[y].set(this.program,y,c[y])}}setLightsUniformValues(r,c){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in c)p[y].set(this.program,y,c[y])}}setShadowUniformValues(r,c){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;r.program.set(this.program);for(const y in c)p[y].set(this.program,y,c[y])}_drawDebugWireframe(r,c,p,y,b,w,S,P,k,L){const V=r.options.wireframe;if(V.terrain===!1&&V.layers2D===!1&&V.layers3D===!1)return;const B=r.context;if(!(!(!V.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!V.layers2D||r._terrain&&r._terrain.renderingToTexture||!II.includes(this.name))||!(!V.layers3D||!AI.includes(this.name))))return;const U=B.gl,Z=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,b,B);if(!Z)return;const W=[...this.fixedDefines,"DEBUG_WIREFRAME"],ne=r.getOrCreateProgram(this.name,{config:this.configuration,defines:W});B.program.set(ne.program);const te=(ce,Ee,ye)=>{if(Ee[ce]&&ye[ce])for(const we in Ee[ce])ye[ce][we]&&ye[ce][we].set(ye.program,we,Ee[ce][we].current)};k&&k.setUniforms(ne.program,B,ne.binderUniforms,S,{zoom:P}),te("fixedUniforms",this,ne),te("terrainUniforms",this,ne),te("globeUniforms",this,ne),te("fogUniforms",this,ne),te("lightsUniforms",this,ne),te("shadowUniforms",this,ne),Z.bind(),B.setColorMode(new Rn([U.ONE,U.ONE_MINUS_SRC_ALPHA,U.ZERO,U.ONE],o.ao.transparent,[!0,!0,!0,!1])),B.setDepthMode(new Xt(c.func===U.LESS?U.LEQUAL:c.func,Xt.ReadOnly,c.range)),B.setStencilMode(yn.disabled);const le=3*w.primitiveLength*2,he=3*w.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ce=L||1;for(let Ee=0;Ee<ce;++Ee)ne.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ee),U.drawElements(U.LINES,le,U.UNSIGNED_SHORT,he)}else L&&L>1?U.drawElementsInstanced(U.LINES,le,U.UNSIGNED_SHORT,he,L):U.drawElements(U.LINES,le,U.UNSIGNED_SHORT,he);b.bind(),B.program.set(this.program),B.setDepthMode(c),B.setStencilMode(p),B.setColorMode(y)}checkUniforms(r,c,p){if(this.fixedDefines.includes(c)){for(const y of Object.keys(p))if(!p[y].initialized)throw new Error(`Program '${this.name}', from draw '${r}': uniform ${y} not set but required by ${c} being defined`)}}draw(r,c,p,y,b,w,S,P,k,L,V,B,U,Z,W,ne){const te=r.context,le=te.gl;if(this.failedToCreate)return;te.program.set(this.program),te.setDepthMode(p),te.setStencilMode(y),te.setColorMode(b),te.setCullFace(w);for(const[_e,pe]of this.fixedUniformsEntries)pe.set(this.program,_e,S[_e]);Z&&Z.setUniforms(this.program,te,this.binderUniforms,B,{zoom:U});const he={[le.POINTS]:1,[le.LINES]:2,[le.TRIANGLES]:3,[le.LINE_STRIP]:1}[c];this.checkUniforms(P,"RENDER_SHADOWS",this.shadowUniforms);const ce=W||[],Ee=Z?Z.getPaintVertexBuffers():[],ye=c===le.TRIANGLES&&L,we=ne&&ne>0?1:void 0;for(const _e of V.get()){const pe=_e.vaos||(_e.vaos={});if((pe[P]||(pe[P]=new vI)).bind(te,this,k,Ee,L,_e.vertexOffset,ce,we),this.forceManualRenderingForInstanceIDShaders){const Se=ne||1;for(let De=0;De<Se;++De)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",De),L?le.drawElements(c,_e.primitiveLength*he,le.UNSIGNED_SHORT,_e.primitiveOffset*he*2):le.drawArrays(c,_e.vertexOffset,_e.vertexLength)}else ne&&ne>1?le.drawElementsInstanced(c,_e.primitiveLength*he,le.UNSIGNED_SHORT,_e.primitiveOffset*he*2,ne):L?le.drawElements(c,_e.primitiveLength*he,le.UNSIGNED_SHORT,_e.primitiveOffset*he*2):le.drawArrays(c,_e.vertexOffset,_e.vertexLength);ye&&this._drawDebugWireframe(r,p,y,b,L,_e,B,U,Z,ne)}}}function Wb(f,r,c=0){const p=Math.pow(2,r.tileID.overscaledZ),y=r.tileSize*Math.pow(2,f.transform.tileZoom)/p,b=y*(r.tileID.canonical.x+r.tileID.wrap*p),w=y*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.ay(r,1,f.transform.tileZoom),u_pixel_coord_upper:[b>>16,w>>16],u_pixel_coord_lower:[65535&b,65535&w],u_pattern_transition:c}}const Cg={terrain:0,flat:1},PI=o.bC(),Ig=(f,r,c,p,y,b,w,S,P,k,L,V,B,U,Z,W,ne,te)=>{const le=r.style.light,he=le.properties.get("position"),ce=[he.x,he.y,he.z],Ee=o.dO();le.properties.get("anchor")==="viewport"&&(o.dP(Ee,-r.transform.angle),o.dQ(ce,ce,Ee));const ye=le.properties.get("color").toPremultipliedRenderColor(null),we=r.transform,_e={u_matrix:f,u_lightpos:ce,u_lightintensity:le.properties.get("intensity"),u_lightcolor:[ye.r,ye.g,ye.b],u_vertical_gradient:+c,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:PI,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Cg[k],u_base_type:Cg[L],u_ao:y,u_edge_radius:b,u_width_scale:w,u_flood_light_color:Z,u_vertical_scale:W,u_flood_light_intensity:ne,u_ground_shadow_factor:te};return we.projection.name==="globe"&&(_e.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],_e.u_zoom_transition=V,_e.u_inv_rot_matrix=U,_e.u_merc_center=B,_e.u_up_dir=we.projection.upVector(new o.cD(0,0,0),B[0]*o.al,B[1]*o.al),_e.u_height_lift=P),_e},$v=(f,r,c,p,y,b)=>({u_matrix:f,u_edge_radius:r,u_width_scale:c,u_vertical_scale:p,u_height_type:Cg[y],u_base_type:Cg[b]}),qb=(f,r,c,p,y,b,w,S,P,k,L,V,B,U,Z,W,ne,te)=>{const le=Ig(f,r,c,p,y,b,w,S,k,L,V,B,U,Z,W,ne,1,[0,0,0]),he={u_height_factor:-Math.pow(2,S.overscaledZ)/P.tileSize/8};return Object.assign(le,Wb(r,P,te),he)},xh=(f,r,c,p,y,b,w,S,P,k,L)=>({u_matrix:r,u_opacity:c,u_ao_pass:p?1:0,u_meter_to_tile:y,u_ao:b,u_flood_light_intensity:w,u_flood_light_color:S,u_attenuation:P,u_edge_radius:k,u_fb:0,u_fb_size:L,u_dynamic_offset:1}),Gv=(f,r,c)=>({u_matrix:f,u_emissive_strength:r,u_ground_shadow_factor:c}),Hv=(f,r,c,p,y,b=0)=>Object.assign(Gv(f,r,y),Wb(c,p,b)),Zb=(f,r,c,p)=>({u_matrix:f,u_world:c,u_emissive_strength:r,u_ground_shadow_factor:p}),Wv=(f,r,c,p,y,b,w=0)=>Object.assign(Hv(f,r,c,p,b,w),{u_world:y}),xu=(f,r)=>({u_matrix:f,u_ground_shadow_factor:r}),md=(f,r,c,p,y)=>({u_matrix:f,u_camera_pos:[r[0],r[1],r[2]],u_depth_bias:c,u_height_scale:p,u_reset_depth:y}),Ag=(f,r,c,p,y,b,w,S,P)=>({u_matrix:f,u_normal_matrix:r,u_opacity:c,u_faux_facade_ao_intensity:p,u_camera_pos:y,u_tile_to_meter:b,u_facade_emissive_chance:w,u_flood_light_color:S,u_flood_light_intensity:P}),Kb=f=>({u_matrix:f}),bu=f=>({u_matrix:f}),qv=(f,r,c,p,y,b,w,S)=>{const P=o.al/b.tileSize;return{u_matrix:f,u_inv_rot_matrix:r,u_camera_to_center_distance:c.getCameraToCenterDistance(S),u_extrude_scale:[c.pixelsToGLUnits[0]/P,c.pixelsToGLUnits[1]/P],u_zoom_transition:p,u_tile_id:w,u_merc_center:y}},Tp=(f,r,c=1)=>({u_matrix:f,u_color:r,u_overlay:0,u_overlay_scale:c}),Xb=o.bC(),Yb=(f,r,c,p,y,b,w)=>{const S=f.transform,P=S.projection.name==="globe",k=P?o.dR(S.zoom,r.canonical)*S._pixelsPerMercatorPixel:o.ay(c,1,b),L={u_matrix:r.projMatrix,u_extrude_scale:k,u_intensity:w,u_inv_rot_matrix:Xb,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){L.u_inv_rot_matrix=p,L.u_merc_center=y,L.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],L.u_zoom_transition=o.aj(S.zoom);const V=y[0]*o.al,B=y[1]*o.al;L.u_up_dir=S.projection.upVector(new o.cD(0,0,0),V,B)}return L};function Pg(f,[r,c,p,y],[b,w]){if(b===w)return[0,0,0,0];const S=255*(f-1)/(f*(w-b));return[r*S,c*S,p*S,y*S]}function Rg(f,r,[c,p]){return c===p?0:.5/f+(r-c)*(f-1)/(f*(p-c))}const Qb=(f,r,c,p,y,b,w,S,P,k,L,V,B,U,Z,W,ne,te,le,he,ce)=>({u_matrix:f,u_normalize_matrix:r,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:k,u_fade_t:L.mix,u_opacity:L.opacity*V.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:V.paint.get("raster-brightness-min"),u_brightness_high:V.paint.get("raster-brightness-max"),u_saturation_factor:o.dT(V.paint.get("raster-saturation")),u_contrast_factor:o.dS(V.paint.get("raster-contrast")),u_spin_weights:Jb(V.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:U,u_zoom_transition:w,u_merc_center:S,u_cutoff_params:P,u_colorization_mix:Pg(o.dU,W,te),u_colorization_offset:Rg(o.dU,ne,te),u_color_ramp:Z,u_texture_offset:[he/(le+2*he),le/(le+2*he)],u_texture_res:[le+2*he,le+2*he],u_emissive_strength:ce});function Jb(f){f*=Math.PI/180;const r=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*r-c+1)/3,(Math.sqrt(3)*r-c+1)/3]}const Fl=.05,RI=(f,r,c,p,y,b,w,S,P,k,L,V)=>({u_matrix:f,u_normalize_matrix:r,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:k,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:V,u_zoom_transition:w,u_merc_center:S,u_cutoff_params:P}),MI=(f,r,c,p,y,b,w,S,P,k)=>({u_particle_texture:f,u_particle_texture_side_len:r,u_tile_offset:c,u_velocity:p,u_color_ramp:b,u_velocity_res:y,u_max_speed:w,u_uv_offset:S,u_data_scale:[255*P[0],255*P[1]],u_data_offset:k,u_particle_pos_scale:1.1,u_particle_pos_offset:[Fl,Fl]}),ew=(f,r,c,p,y,b,w,S,P,k)=>({u_particle_texture:f,u_particle_texture_side_len:r,u_velocity:c,u_velocity_res:p,u_max_speed:y,u_speed_factor:b,u_reset_rate:w,u_rand_seed:Math.random(),u_uv_offset:S,u_data_scale:[255*P[0],255*P[1]],u_data_offset:k,u_particle_pos_scale:1.1,u_particle_pos_offset:[Fl,Fl]}),tw=o.bC(),Mg=(f,r,c,p,y,b,w,S,P,k,L,V,B,U,Z,W,ne,te,le,he,ce,Ee,ye,we)=>{const _e=y.transform,pe={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:_e.getCameraToCenterDistance(le),u_rotate_symbol:+c,u_aspect_ratio:_e.width/_e.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:w,u_coord_matrix:S,u_is_text:+k,u_elevation_from_sea:P?1:0,u_pitch_with_map:+p,u_texsize:L,u_texsize_icon:V,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:tw,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:tw,u_up_vector:[0,-1,0],u_color_adj_mat:Ee,u_icon_transition:ye||0,u_gamma_scale:p?y.transform.getCameraToCenterDistance(le)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:o.o.devicePixelRatio,u_is_halo:1,u_scale_factor:we||1,u_ground_shadow_factor:he,u_inv_matrix:o.bl(o.bC(),w),u_normal_scale:ce,u_lutTexture:Ss.LUT};return le.name==="globe"&&(pe.u_tile_id=[U.canonical.x,U.canonical.y,1<<U.canonical.z],pe.u_zoom_transition=Z,pe.u_inv_rot_matrix=ne,pe.u_merc_center=W,pe.u_camera_forward=_e._camera.forward(),pe.u_ecef_origin=o.dV(_e.globeMatrix,U.toUnwrapped()),pe.u_tile_matrix=Float32Array.from(_e.globeMatrix),pe.u_up_vector=te),pe},Ep=(f,r,c,p)=>({u_matrix:f,u_emissive_strength:r,u_opacity:c,u_color:p}),wu=(f,r,c,p,y,b,w,S,P)=>Object.assign(function(k,L,V,B,U,Z){const{width:W,height:ne}=B.imageManager.getPixelSize(L),te=Math.pow(2,Z.tileID.overscaledZ),le=Z.tileSize*Math.pow(2,B.transform.tileZoom)/te,he=le*(Z.tileID.canonical.x+Z.tileID.wrap*te),ce=le*Z.tileID.canonical.y;return{u_image:0,u_pattern_tl:V.tl,u_pattern_br:V.br,u_texsize:[W,ne],u_pattern_size:V.displaySize,u_pattern_units_to_pixels:U?[B.transform.width,-1*B.transform.height]:[1/o.ay(Z,1,B.transform.tileZoom),1/o.ay(Z,1,B.transform.tileZoom)],u_pixel_coord_upper:[he>>16,ce>>16],u_pixel_coord_lower:[65535&he,65535&ce]}}(0,b,w,p,S,P),{u_matrix:f,u_emissive_strength:r,u_opacity:c}),bh=new Float32Array(o.bA([])),gd=(f,r,c,p,y,b,w,S,P,k,L,V,B,U=[0,0,0],Z,W,ne)=>{const te=y.style.light,le=te.properties.get("position"),he=[-le.x,-le.y,le.z],ce=o.dO();te.properties.get("anchor")==="viewport"&&(o.dP(ce,-y.transform.angle),o.dQ(he,he,ce));const Ee=L.alphaMode==="MASK",ye=te.properties.get("color").toNonPremultipliedRenderColor(null),we=B.paint.get("model-ambient-occlusion-intensity"),_e=B.paint.get("model-color").constantOr(o.ao.white).toNonPremultipliedRenderColor(null);return _e.a=B.paint.get("model-color-mix-intensity").constantOr(0),ne&&(_e.r=ne[0],_e.g=ne[1],_e.b=ne[2],_e.a=ne[3]),W&&(_e.r=W.color.r,_e.g=W.color.g,_e.b=W.color.b,_e.a=W.colorMix,V=W.emissionStrength,b*=W.opacity),{u_matrix:f,u_lighting_matrix:r,u_normal_matrix:c,u_node_matrix:p||bh,u_lightpos:he,u_lightintensity:te.properties.get("intensity"),u_lightcolor:[ye.r,ye.g,ye.b],u_camera_pos:U,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+Ee,u_alphaCutoff:L.alphaCutoff,u_baseColorFactor:w.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:S.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:P,u_roughnessFactor:k,u_baseColorTexture:Ss.BaseColor,u_metallicRoughnessTexture:Ss.MetallicRoughness,u_normalTexture:Ss.Normal,u_occlusionTexture:Ss.Occlusion,u_emissionTexture:Ss.Emission,u_lutTexture:Ss.LUT,u_color_mix:_e.toArray01(),u_aoIntensity:we,u_emissive_strength:V,u_occlusionTextureTransform:Z||[0,0,0,0]}},Zv=(f,r=bh,c=bh)=>({u_matrix:f,u_instance:r,u_node_matrix:c}),kg={fillExtrusion:f=>({u_matrix:new o.cl(f),u_lightpos:new o.ci(f),u_lightintensity:new o.cj(f),u_lightcolor:new o.ci(f),u_vertical_gradient:new o.cj(f),u_opacity:new o.cj(f),u_edge_radius:new o.cj(f),u_width_scale:new o.cj(f),u_ao:new o.ck(f),u_height_type:new o.ch(f),u_base_type:new o.ch(f),u_tile_id:new o.ci(f),u_zoom_transition:new o.cj(f),u_inv_rot_matrix:new o.cl(f),u_merc_center:new o.ck(f),u_up_dir:new o.ci(f),u_height_lift:new o.cj(f),u_flood_light_color:new o.ci(f),u_vertical_scale:new o.cj(f),u_flood_light_intensity:new o.cj(f),u_ground_shadow_factor:new o.ci(f)}),fillExtrusionDepth:f=>({u_matrix:new o.cl(f),u_edge_radius:new o.cj(f),u_width_scale:new o.cj(f),u_vertical_scale:new o.cj(f),u_height_type:new o.ch(f),u_base_type:new o.ch(f)}),fillExtrusionPattern:f=>({u_matrix:new o.cl(f),u_lightpos:new o.ci(f),u_lightintensity:new o.cj(f),u_lightcolor:new o.ci(f),u_vertical_gradient:new o.cj(f),u_height_factor:new o.cj(f),u_edge_radius:new o.cj(f),u_width_scale:new o.cj(f),u_ao:new o.ck(f),u_height_type:new o.ch(f),u_base_type:new o.ch(f),u_tile_id:new o.ci(f),u_zoom_transition:new o.cj(f),u_inv_rot_matrix:new o.cl(f),u_merc_center:new o.ck(f),u_up_dir:new o.ci(f),u_height_lift:new o.cj(f),u_image:new o.ch(f),u_texsize:new o.ck(f),u_pixel_coord_upper:new o.ck(f),u_pixel_coord_lower:new o.ck(f),u_tile_units_to_pixels:new o.cj(f),u_opacity:new o.cj(f),u_pattern_transition:new o.cj(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new o.cl(f),u_opacity:new o.cj(f),u_ao_pass:new o.cj(f),u_meter_to_tile:new o.cj(f),u_ao:new o.ck(f),u_flood_light_intensity:new o.cj(f),u_flood_light_color:new o.ci(f),u_attenuation:new o.cj(f),u_edge_radius:new o.cj(f),u_fb:new o.ch(f),u_fb_size:new o.cj(f),u_dynamic_offset:new o.cj(f)}),fill:f=>({u_matrix:new o.cl(f),u_emissive_strength:new o.cj(f),u_ground_shadow_factor:new o.ci(f)}),fillPattern:f=>({u_matrix:new o.cl(f),u_emissive_strength:new o.cj(f),u_image:new o.ch(f),u_texsize:new o.ck(f),u_pixel_coord_upper:new o.ck(f),u_pixel_coord_lower:new o.ck(f),u_tile_units_to_pixels:new o.cj(f),u_ground_shadow_factor:new o.ci(f),u_pattern_transition:new o.cj(f)}),fillOutline:f=>({u_matrix:new o.cl(f),u_emissive_strength:new o.cj(f),u_world:new o.ck(f),u_ground_shadow_factor:new o.ci(f)}),fillOutlinePattern:f=>({u_matrix:new o.cl(f),u_emissive_strength:new o.cj(f),u_world:new o.ck(f),u_image:new o.ch(f),u_texsize:new o.ck(f),u_pixel_coord_upper:new o.ck(f),u_pixel_coord_lower:new o.ck(f),u_tile_units_to_pixels:new o.cj(f),u_ground_shadow_factor:new o.ci(f),u_pattern_transition:new o.cj(f)}),building:f=>({u_matrix:new o.cl(f),u_normal_matrix:new o.cl(f),u_opacity:new o.cj(f),u_faux_facade_ao_intensity:new o.cj(f),u_camera_pos:new o.ci(f),u_tile_to_meter:new o.cj(f),u_facade_emissive_chance:new o.cj(f),u_flood_light_color:new o.ci(f),u_flood_light_intensity:new o.cj(f)}),buildingBloom:f=>({u_matrix:new o.cl(f)}),buildingDepth:f=>({u_matrix:new o.cl(f)}),elevatedStructuresDepth:f=>({u_matrix:new o.cl(f),u_depth_bias:new o.cj(f)}),elevatedStructures:f=>({u_matrix:new o.cl(f),u_ground_shadow_factor:new o.ci(f)}),elevatedStructuresDepthReconstruct:f=>({u_matrix:new o.cl(f),u_camera_pos:new o.ci(f),u_depth_bias:new o.cj(f),u_height_scale:new o.cj(f),u_reset_depth:new o.cj(f)}),circle:o.dY,collisionBox:f=>({u_matrix:new o.cl(f),u_inv_rot_matrix:new o.cl(f),u_camera_to_center_distance:new o.cj(f),u_extrude_scale:new o.ck(f),u_zoom_transition:new o.cj(f),u_merc_center:new o.ck(f),u_tile_id:new o.ci(f)}),collisionCircle:f=>({u_matrix:new o.cl(f),u_inv_matrix:new o.cl(f),u_camera_to_center_distance:new o.cj(f),u_viewport_size:new o.ck(f)}),debug:f=>({u_color:new o.dB(f),u_matrix:new o.cl(f),u_overlay:new o.ch(f),u_overlay_scale:new o.cj(f)}),clippingMask:f=>({u_matrix:new o.cl(f)}),heatmap:f=>({u_extrude_scale:new o.cj(f),u_intensity:new o.cj(f),u_matrix:new o.cl(f),u_inv_rot_matrix:new o.cl(f),u_merc_center:new o.ck(f),u_tile_id:new o.ci(f),u_zoom_transition:new o.cj(f),u_up_dir:new o.ci(f)}),heatmapTexture:f=>({u_image:new o.ch(f),u_color_ramp:new o.ch(f),u_opacity:new o.cj(f)}),hillshade:f=>({u_matrix:new o.cl(f),u_image:new o.ch(f),u_latrange:new o.ck(f),u_light:new o.ck(f),u_shadow:new o.dB(f),u_highlight:new o.dB(f),u_emissive_strength:new o.cj(f),u_accent:new o.dB(f)}),hillshadePrepare:f=>({u_matrix:new o.cl(f),u_image:new o.ch(f),u_dimension:new o.ck(f),u_zoom:new o.cj(f)}),line:o.dX,linePattern:o.dW,raster:f=>({u_matrix:new o.cl(f),u_normalize_matrix:new o.cl(f),u_globe_matrix:new o.cl(f),u_merc_matrix:new o.cl(f),u_grid_matrix:new o.dC(f),u_tl_parent:new o.ck(f),u_scale_parent:new o.cj(f),u_fade_t:new o.cj(f),u_opacity:new o.cj(f),u_image0:new o.ch(f),u_image1:new o.ch(f),u_brightness_low:new o.cj(f),u_brightness_high:new o.cj(f),u_saturation_factor:new o.cj(f),u_contrast_factor:new o.cj(f),u_spin_weights:new o.ci(f),u_perspective_transform:new o.ck(f),u_raster_elevation:new o.cj(f),u_zoom_transition:new o.cj(f),u_merc_center:new o.ck(f),u_cutoff_params:new o.d3(f),u_colorization_mix:new o.d3(f),u_colorization_offset:new o.cj(f),u_color_ramp:new o.ch(f),u_texture_offset:new o.ck(f),u_texture_res:new o.ck(f),u_emissive_strength:new o.cj(f)}),rasterParticle:f=>({u_matrix:new o.cl(f),u_normalize_matrix:new o.cl(f),u_globe_matrix:new o.cl(f),u_merc_matrix:new o.cl(f),u_grid_matrix:new o.dC(f),u_tl_parent:new o.ck(f),u_scale_parent:new o.cj(f),u_fade_t:new o.cj(f),u_opacity:new o.cj(f),u_image0:new o.ch(f),u_image1:new o.ch(f),u_raster_elevation:new o.cj(f),u_zoom_transition:new o.cj(f),u_merc_center:new o.ck(f),u_cutoff_params:new o.d3(f)}),rasterParticleTexture:f=>({u_texture:new o.ch(f),u_opacity:new o.cj(f)}),rasterParticleDraw:f=>({u_particle_texture:new o.ch(f),u_particle_texture_side_len:new o.cj(f),u_tile_offset:new o.ck(f),u_velocity:new o.ch(f),u_color_ramp:new o.ch(f),u_velocity_res:new o.ck(f),u_max_speed:new o.cj(f),u_uv_offset:new o.ck(f),u_data_scale:new o.ck(f),u_data_offset:new o.cj(f),u_particle_pos_scale:new o.cj(f),u_particle_pos_offset:new o.ck(f)}),rasterParticleUpdate:f=>({u_particle_texture:new o.ch(f),u_particle_texture_side_len:new o.cj(f),u_velocity:new o.ch(f),u_velocity_res:new o.ck(f),u_max_speed:new o.cj(f),u_speed_factor:new o.cj(f),u_reset_rate:new o.cj(f),u_rand_seed:new o.cj(f),u_uv_offset:new o.ck(f),u_data_scale:new o.ck(f),u_data_offset:new o.cj(f),u_particle_pos_scale:new o.cj(f),u_particle_pos_offset:new o.ck(f)}),symbol:f=>({u_is_size_zoom_constant:new o.ch(f),u_is_size_feature_constant:new o.ch(f),u_size_t:new o.cj(f),u_size:new o.cj(f),u_camera_to_center_distance:new o.cj(f),u_rotate_symbol:new o.ch(f),u_aspect_ratio:new o.cj(f),u_fade_change:new o.cj(f),u_matrix:new o.cl(f),u_label_plane_matrix:new o.cl(f),u_coord_matrix:new o.cl(f),u_is_text:new o.ch(f),u_elevation_from_sea:new o.ch(f),u_pitch_with_map:new o.ch(f),u_texsize:new o.ck(f),u_texsize_icon:new o.ck(f),u_texture:new o.ch(f),u_texture_icon:new o.ch(f),u_gamma_scale:new o.cj(f),u_device_pixel_ratio:new o.cj(f),u_tile_id:new o.ci(f),u_zoom_transition:new o.cj(f),u_inv_rot_matrix:new o.cl(f),u_merc_center:new o.ck(f),u_camera_forward:new o.ci(f),u_tile_matrix:new o.cl(f),u_up_vector:new o.ci(f),u_ecef_origin:new o.ci(f),u_is_halo:new o.ch(f),u_icon_transition:new o.cj(f),u_color_adj_mat:new o.cl(f),u_scale_factor:new o.cj(f),u_ground_shadow_factor:new o.ci(f),u_inv_matrix:new o.cl(f),u_normal_scale:new o.cj(f),u_lutTexture:new o.ch(f)}),background:f=>({u_matrix:new o.cl(f),u_emissive_strength:new o.cj(f),u_opacity:new o.cj(f),u_color:new o.dB(f)}),backgroundPattern:f=>({u_matrix:new o.cl(f),u_emissive_strength:new o.cj(f),u_opacity:new o.cj(f),u_image:new o.ch(f),u_pattern_tl:new o.ck(f),u_pattern_br:new o.ck(f),u_texsize:new o.ck(f),u_pattern_size:new o.ck(f),u_pixel_coord_upper:new o.ck(f),u_pixel_coord_lower:new o.ck(f),u_pattern_units_to_pixels:new o.ck(f)}),terrainRaster:f=>({u_matrix:new o.cl(f),u_image0:new o.ch(f),u_image1:new o.ch(f),u_skirt_height:new o.cj(f),u_ground_shadow_factor:new o.ci(f),u_emissive_texture_available:new o.cj(f)}),skybox:f=>({u_matrix:new o.cl(f),u_sun_direction:new o.ci(f),u_cubemap:new o.ch(f),u_opacity:new o.cj(f),u_temporal_offset:new o.cj(f)}),skyboxGradient:f=>({u_matrix:new o.cl(f),u_color_ramp:new o.ch(f),u_center_direction:new o.ci(f),u_radius:new o.cj(f),u_opacity:new o.cj(f),u_temporal_offset:new o.cj(f)}),skyboxCapture:f=>({u_matrix_3f:new o.dC(f),u_sun_direction:new o.ci(f),u_sun_intensity:new o.cj(f),u_color_tint_r:new o.d3(f),u_color_tint_m:new o.d3(f),u_luminance:new o.cj(f)}),globeRaster:f=>({u_proj_matrix:new o.cl(f),u_globe_matrix:new o.cl(f),u_normalize_matrix:new o.cl(f),u_merc_matrix:new o.cl(f),u_zoom_transition:new o.cj(f),u_merc_center:new o.ck(f),u_image0:new o.ch(f),u_image1:new o.ch(f),u_grid_matrix:new o.dC(f),u_skirt_height:new o.cj(f),u_far_z_cutoff:new o.cj(f),u_frustum_tl:new o.ci(f),u_frustum_tr:new o.ci(f),u_frustum_br:new o.ci(f),u_frustum_bl:new o.ci(f),u_globe_pos:new o.ci(f),u_globe_radius:new o.cj(f),u_viewport:new o.ck(f),u_emissive_texture_available:new o.cj(f)}),globeAtmosphere:f=>({u_frustum_tl:new o.ci(f),u_frustum_tr:new o.ci(f),u_frustum_br:new o.ci(f),u_frustum_bl:new o.ci(f),u_horizon:new o.cj(f),u_transition:new o.cj(f),u_fadeout_range:new o.cj(f),u_atmosphere_fog_color:new o.d3(f),u_high_color:new o.d3(f),u_space_color:new o.d3(f),u_temporal_offset:new o.cj(f),u_horizon_angle:new o.cj(f)}),model:f=>({u_matrix:new o.cl(f),u_lighting_matrix:new o.cl(f),u_normal_matrix:new o.cl(f),u_node_matrix:new o.cl(f),u_lightpos:new o.ci(f),u_lightintensity:new o.cj(f),u_lightcolor:new o.ci(f),u_camera_pos:new o.ci(f),u_opacity:new o.cj(f),u_baseColorFactor:new o.d3(f),u_emissiveFactor:new o.d3(f),u_metallicFactor:new o.cj(f),u_roughnessFactor:new o.cj(f),u_baseTextureIsAlpha:new o.ch(f),u_alphaMask:new o.ch(f),u_alphaCutoff:new o.cj(f),u_baseColorTexture:new o.ch(f),u_metallicRoughnessTexture:new o.ch(f),u_normalTexture:new o.ch(f),u_occlusionTexture:new o.ch(f),u_emissionTexture:new o.ch(f),u_lutTexture:new o.ch(f),u_color_mix:new o.d3(f),u_aoIntensity:new o.cj(f),u_emissive_strength:new o.cj(f),u_occlusionTextureTransform:new o.d3(f)}),modelDepth:f=>({u_matrix:new o.cl(f),u_instance:new o.cl(f),u_node_matrix:new o.cl(f)}),groundShadow:f=>({u_matrix:new o.cl(f),u_ground_shadow_factor:new o.ci(f)}),stars:f=>({u_matrix:new o.cl(f),u_up:new o.ci(f),u_right:new o.ci(f),u_intensity_multiplier:new o.cj(f)}),snowParticle:f=>({u_modelview:new o.cl(f),u_projection:new o.cl(f),u_time:new o.cj(f),u_cam_pos:new o.ci(f),u_velocityConeAperture:new o.cj(f),u_velocity:new o.cj(f),u_horizontalOscillationRadius:new o.cj(f),u_horizontalOscillationRate:new o.cj(f),u_boxSize:new o.cj(f),u_billboardSize:new o.cj(f),u_simpleShapeParameters:new o.ck(f),u_screenSize:new o.ck(f),u_thinningCenterPos:new o.ck(f),u_thinningShape:new o.ci(f),u_thinningAffectedRatio:new o.cj(f),u_thinningParticleOffset:new o.cj(f),u_particleColor:new o.d3(f),u_direction:new o.ci(f)}),rainParticle:f=>({u_modelview:new o.cl(f),u_projection:new o.cl(f),u_time:new o.cj(f),u_cam_pos:new o.ci(f),u_texScreen:new o.ch(f),u_velocityConeAperture:new o.cj(f),u_velocity:new o.cj(f),u_boxSize:new o.cj(f),u_rainDropletSize:new o.ck(f),u_distortionStrength:new o.cj(f),u_rainDirection:new o.ci(f),u_color:new o.d3(f),u_screenSize:new o.ck(f),u_thinningCenterPos:new o.ck(f),u_thinningShape:new o.ci(f),u_thinningAffectedRatio:new o.cj(f),u_thinningParticleOffset:new o.cj(f),u_shapeDirectionalPower:new o.cj(f),u_shapeNormalPower:new o.cj(f),u_mode:new o.cj(f)}),vignette:f=>({u_vignetteShape:new o.ci(f),u_vignetteColor:new o.d3(f)}),occlusion:f=>({u_matrix:new o.cl(f),u_anchorPos:new o.ci(f),u_screenSizePx:new o.ck(f),u_occluderSizePx:new o.ck(f),u_color:new o.d3(f)})};class cl{constructor(r,c,p,y){this.id=cl.uniqueIdxCounter,cl.uniqueIdxCounter++,this.context=r;const b=r.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||y||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){this.id=cl.uniqueIdxCounter,cl.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}cl.uniqueIdxCounter=0;const Kv={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class nw{constructor(r,c,p,y,b,w){this.length=c.length,this.attributes=p,this.itemSize=c.bytesPerElement,this.dynamicDraw=y,this.instanceCount=w,this.context=r;const S=r.gl;this.buffer=S.createBuffer(),r.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||b||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,c){for(let p=0;p<this.attributes.length;p++){const y=c.getAttributeLocation(r,this.attributes[p].name);y!==-1&&r.enableVertexAttribArray(y)}}setVertexAttribPointers(r,c,p){for(let y=0;y<this.attributes.length;y++){const b=this.attributes[y],w=c.getAttributeLocation(r,b.name);w!==-1&&r.vertexAttribPointer(w,b.components,r[Kv[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(r,c,p){for(let y=0;y<this.attributes.length;y++){const b=c.getAttributeLocation(r,this.attributes[y].name);b!==-1&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(b,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class iw{constructor(r,c,p,y,b){this.context=r,this.width=c,this.height=p;const w=this.framebuffer=r.gl.createFramebuffer();y>0&&(this.colorAttachment0=new bg(r,w,0)),y>1&&(this.colorAttachment1=new bg(r,w,1)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new _h(r,w):new vp(r,w))}createColorAttachment(r,c){c===0?this.colorAttachment0=new bg(r,this.framebuffer,0):c===1&&(this.colorAttachment1=new bg(r,this.framebuffer,1))}removeColorAttachment(r,c){const p=this.context.gl;let y;c===0?(y=this.colorAttachment0.get(),this.colorAttachment0=void 0):c===1&&(y=this.colorAttachment1.get(),this.colorAttachment1=void 0),y&&p.deleteTexture(y)}destroy(){const r=this.context.gl;if(this.colorAttachment0){const c=this.colorAttachment0.get();c&&r.deleteTexture(c)}if(this.colorAttachment1){const c=this.colorAttachment1.get();c&&r.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&r.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&r.deleteTexture(c)}r.deleteFramebuffer(this.framebuffer)}}class wh{constructor(r,c){this.gl=r,this.clearColor=new TI(this),this.clearDepth=new Ob(this),this.clearStencil=new Mv(this),this.colorMask=new gg(this),this.depthMask=new kv(this),this.stencilMask=new pd(this),this.stencilFunc=new fh(this),this.stencilOp=new _p(this),this.stencilTest=new ph(this),this.depthRange=new Fb(this),this.depthTest=new Dv(this),this.depthFunc=new zb(this),this.blend=new mh(this),this.blendFunc=new _g(this),this.blendColor=new yg(this),this.blendEquation=new Nv(this),this.cullFace=new vg(this),this.cullFaceSide=new yp(this),this.frontFace=new jb(this),this.program=new Bb(this),this.activeTexture=new Vb(this),this.viewport=new gh(this),this.bindFramebuffer=new Ub(this),this.bindRenderbuffer=new EI(this),this.bindTexture=new SI(this),this.bindVertexBuffer=new CI(this),this.bindElementBuffer=new Lv(this),this.bindVertexArrayOES=new Ov(this),this.pixelStoreUnpack=new Fv(this),this.pixelStoreUnpackPremultiplyAlpha=new zv(this),this.pixelStoreUnpackFlipY=new $b(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=r.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,c,p){return new cl(this,r,c,p)}createVertexBuffer(r,c,p,y,b){return new nw(this,r,c,p,y,b)}createRenderbuffer(r,c,p){const y=this.gl,b=y.createRenderbuffer();return this.bindRenderbuffer.set(b),y.renderbufferStorage(y.RENDERBUFFER,r,c,p),this.bindRenderbuffer.set(null),b}createFramebuffer(r,c,p,y){return new iw(this,r,c,p,y)}clear({color:r,depth:c,stencil:p,colorMask:y}){const b=this.gl;let w=0;r&&(w|=b.COLOR_BUFFER_BIT,this.clearColor.set(r.toNonPremultipliedRenderColor(null)),this.colorMask.set(y||[!0,!0,!0,!0])),c!==void 0&&(w|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p!==void 0&&(w|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),b.clear(w)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){o.by(r.blendFunction,Rn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let _d;function jt(f,r,c,p,y,b,w){const S=f.context,P=S.gl,k=f.transform,L=[o.aF(k.center.lng),o.aJ(k.center.lat)],V=c.layout.get("symbol-placement"),B=c.layout.get("text-variable-anchor"),U=c.layout.get("icon-rotation-alignment")==="map",Z=c.layout.get("text-rotation-alignment")==="map",W=V!=="point",ne=[];let te=0,le=0;for(let pe=0;pe<p.length;pe++){const Se=p[pe],De=r.getTile(Se),Me=De.getBucket(c);if(!Me)continue;const He=Me.getProjection().createInversionMatrix(k,Se.canonical),We=[],tt=Jm(Se,Me,k),gt=!w&&U&&W,Ve=w&&Z&&W,Pe=B&&Me.hasTextData(),Xe=Me.hasIconTextFit()&&Pe&&Me.hasIconData(),Ue=gt||Ve||w&&Pe||Xe,lt=Me.projection.name==="globe",St=lt?o.aj(k.zoom):0;lt&&(We.push("PROJECTION_GLOBE_VIEW"),Ue&&We.push("PROJECTED_POS_ON_VIEWPORT"));const Dt=f.getOrCreateProgram("collisionBox",{defines:We});let bt=tt;y[0]===0&&y[1]===0||(bt=f.translatePosMatrix(tt,De,y,b));const _t=w?Me.textCollisionBox:Me.iconCollisionBox,Gt=Me.collisionCircleArray;if(Gt.length>0){const Mt=o.bC(),Lt=bt;o.cP(Mt,Me.placementInvProjMatrix,k.glCoordMatrix),o.cP(Mt,Mt,Me.placementViewportMatrix),ne.push({circleArray:Gt,circleOffset:le,transform:Lt,invTransform:Mt,projection:Me.getProjection()}),te+=Gt.length/4,le=te}if(!_t)continue;f.terrain&&f.terrain.setupElevationDraw(De,Dt);const Bt=lt?[Se.canonical.x,Se.canonical.y,1<<Se.canonical.z]:[0,0,0];Dt.draw(f,P.LINES,Xt.disabled,yn.disabled,f.colorModeForRenderPass(),mn.disabled,qv(bt,He,k,St,L,De,Bt,Me.getProjection()),c.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,null,k.zoom,null,[_t.collisionVertexBuffer,_t.collisionVertexBufferExt])}if(!w||!ne.length)return;const he=f.getOrCreateProgram("collisionCircle"),ce=new o.dZ;ce.resize(4*te),ce._trim();let Ee=0;for(const pe of ne)for(let Se=0;Se<pe.circleArray.length/4;Se++){const De=4*Se,Me=pe.circleArray[De+0],He=pe.circleArray[De+1],We=pe.circleArray[De+2],tt=pe.circleArray[De+3];ce.emplace(Ee++,Me,He,We,tt,0),ce.emplace(Ee++,Me,He,We,tt,1),ce.emplace(Ee++,Me,He,We,tt,2),ce.emplace(Ee++,Me,He,We,tt,3)}(!_d||_d.length<2*te)&&(_d=function(pe){const Se=2*pe,De=new o.b0;De.resize(Se),De._trim();for(let Me=0;Me<Se;Me++){const He=6*Me;De.uint16[He+0]=4*Me+0,De.uint16[He+1]=4*Me+1,De.uint16[He+2]=4*Me+2,De.uint16[He+3]=4*Me+2,De.uint16[He+4]=4*Me+3,De.uint16[He+5]=4*Me+0}return De}(te));const ye=S.createIndexBuffer(_d,!0),we=S.createVertexBuffer(ce,o.d_.members,!0);for(const pe of ne){const Se={u_matrix:pe.transform,u_inv_matrix:pe.invTransform,u_camera_to_center_distance:(_e=k).getCameraToCenterDistance(pe.projection),u_viewport_size:[_e.width,_e.height]};he.draw(f,P.TRIANGLES,Xt.disabled,yn.disabled,f.colorModeForRenderPass(),mn.disabled,Se,c.id,we,ye,o.bg.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,k.zoom)}var _e;we.destroy(),ye.destroy()}const Sp=o.bC();function hc(f){const r=f._camera.getWorldToCamera(f.worldSize,1),c=o.aB([],r,f.globeMatrix);o.bl(c,c);const p=[0,0,0],y=[0,1,0,0];return o.aC(y,y,c),p[0]=y[0],p[1]=y[1],p[2]=y[2],o.aw(p,p),p}function Tu({width:f,height:r,anchor:c,textOffset:p,textScale:y},b){const{horizontalAlign:w,verticalAlign:S}=o.c1(c),P=-(w-.5)*f,k=-(S-.5)*r,L=o.c2(c,p);return new o.P((P/y+L[0])*b,(k/y+L[1])*b)}function ln(f,r,c,p,y,b,w,S,P,k){const L=f.text.placedSymbolArray,V=f.text.dynamicLayoutVertexArray,B=f.icon.dynamicLayoutVertexArray,U={},Z=f.getProjection(),W=kl(w,Z,y),ne=y.elevation,te=Z.upVectorScale(w.canonical,y.center.lat,y.worldSize).metersToTile;V.clear();for(let le=0;le<L.length;le++){const he=L.get(le),{tileAnchorX:ce,tileAnchorY:Ee,numGlyphs:ye}=he,we=he.hidden||!he.crossTileID||f.allowVerticalPlacement&&!he.placedOrientation?null:p[he.crossTileID];if(we){let _e=0,pe=0,Se=0;const De=f.elevationType==="road";if(ne||De){const Ue=De?f.getElevationFeatureForText(le):null,lt=o.bV.getAtTileOffset(w,new o.P(ce,Ee),ne,Ue),[St,Dt,bt]=Z.upVector(w.canonical,ce,Ee);_e=lt*St*te,pe=lt*Dt*te,Se=lt*bt*te}let[Me,He,We,tt]=ka(he.projectedAnchorX+_e,he.projectedAnchorY+pe,he.projectedAnchorZ+Se,c?W:b);const gt=Si(y.getCameraToCenterDistance(Z),tt);let Ve=o.bM(f.textSizeData,P,he)*gt/o.bY;c&&(Ve*=f.tilePixelRatio/S);const Pe=Tu(we,Ve);c?({x:Me,y:He,z:We}=Z.projectTilePoint(ce+Pe.x,Ee+Pe.y,w.canonical),[Me,He,We]=ka(Me+_e,He+pe,We+Se,b)):(r&&Pe._rotate(-y.angle),Me+=Pe.x,He+=Pe.y,We=0);const Xe=f.allowVerticalPlacement&&he.placedOrientation===o.bL.vertical?Math.PI/2:0;for(let Ue=0;Ue<ye;Ue++)o.bO(V,Me,He,We,Xe);k&&he.associatedIconIndex>=0&&(U[he.associatedIconIndex]={x:Me,y:He,z:We,angle:Xe})}else ol(ye,V)}if(k){B.clear();const le=f.icon.placedSymbolArray;for(let he=0;he<le.length;he++){const ce=le.get(he),{numGlyphs:Ee}=ce,ye=U[he];if(ce.hidden||!ye)ol(Ee,B);else{const{x:we,y:_e,z:pe,angle:Se}=ye;for(let De=0;De<Ee;De++)o.bO(B,we,_e,pe,Se)}}f.icon.dynamicLayoutVertexBuffer.updateData(B)}f.text.dynamicLayoutVertexBuffer.updateData(V)}function Cp(f,r,c,p,y,b,w={}){const S=c.paint.get("icon-translate"),P=c.paint.get("text-translate"),k=c.paint.get("icon-translate-anchor"),L=c.paint.get("text-translate-anchor"),V=c.layout.get("icon-rotation-alignment"),B=c.layout.get("text-rotation-alignment"),U=c.layout.get("icon-pitch-alignment"),Z=c.layout.get("text-pitch-alignment"),W=c.layout.get("icon-keep-upright"),ne=c.layout.get("text-keep-upright"),te=c.paint.get("icon-color-saturation"),le=c.paint.get("icon-color-contrast"),he=c.paint.get("icon-color-brightness-min"),ce=c.paint.get("icon-color-brightness-max"),Ee=c.layout.get("symbol-elevation-reference")==="sea",ye=c.layout.get("icon-image-use-theme")==="none",we=f.context,_e=we.gl,pe=f.transform,Se=V==="map",De=B==="map",Me=U==="map",He=Z==="map",We=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let tt=!1;const gt=f.depthModeForSublayer(0,Xt.ReadOnly),Ve=new Xt(f.context.gl.LEQUAL,Xt.ReadOnly,f.depthRangeFor3D),Pe=[o.aF(pe.center.lng),o.aJ(pe.center.lat)],Xe=c.layout.get("text-variable-anchor"),Ue=pe.projection.name==="globe",lt=[],St=[0,-1,0];for(const Dt of p){const bt=r.getTile(Dt),_t=bt.getBucket(c);if(!_t||_t.projection.name==="mercator"&&Ue||_t.fullyClipped)continue;const Gt=_t.projection.name==="globe",Bt=Gt?o.aj(pe.zoom):0,Mt=kl(Dt,_t.getProjection(),pe),Lt=pe.calculatePixelsToTileUnitsMatrix(bt),on=Xe&&_t.hasTextData(),Sn=_t.hasIconTextFit()&&on&&_t.hasIconData(),Zn=_t.getProjection().createInversionMatrix(pe,Dt.canonical),fi=(1<<bt.tileID.canonical.z)*o.al/f.transform.worldSize,Ht=yi=>{let ni=[0,0,0];if(yi){const Nn=f.style.directionalLight,Xi=f.style.ambientLight;Nn&&Xi&&(ni=uc(f.style,Nn,Xi))}return ni},ui=yi=>{pe.depthOcclusionForSymbolsAndCircles&&(c.hasOcclusionOpacityProperties||f.terrain)&&(yi.push("DEPTH_D24"),yi.push("DEPTH_OCCLUSION"))},Tn=yi=>{c.lut&&!ye&&(c.lut.texture||(c.lut.texture=new o.d$(f.context,c.lut.image,[c.lut.image.height,c.lut.image.height,c.lut.image.height],we.gl.RGBA8)),we.activeTexture.set(we.gl.TEXTURE0+Ss.LUT),c.lut.texture&&c.lut.texture.bind(we.gl.LINEAR,we.gl.CLAMP_TO_EDGE),yi.push("APPLY_LUT_ON_GPU"))},_i=()=>{const yi=Se&&c.layout.get("symbol-placement")!=="point",ni=[];ui(ni),Tn(ni);const Nn=yi||Sn,Xi=_t.elevationType==="road",Ar=f.shadowRenderer,hr=Xi&&Me&&!!Ar&&Ar.enabled,Fi=Ht(hr),bo=Xi&&Me&&!f.terrain?Ve:gt,Vs=c.paint.get("icon-image-cross-fade");f.terrainRenderModeElevated()&&Me&&ni.push("PITCH_WITH_MAP_TERRAIN"),Gt&&(ni.push("PROJECTION_GLOBE_VIEW"),Nn&&ni.push("PROJECTED_POS_ON_VIEWPORT")),Vs>0&&_t.hasAnySecondaryIcon&&ni.push("ICON_TRANSITION"),!_t.icon.zOffsetVertexBuffer||Xi&&f.terrain||ni.push("Z_OFFSET"),te===0&&le===0&&he===0&&ce===1||ni.push("COLOR_ADJUSTMENT"),_t.sdfIcons&&ni.push("RENDER_SDF"),hr&&ni.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Xi&&Me&&!f.terrain&&_t.icon.orientationVertexBuffer&&ni.push("ELEVATED_ROADS");const ts=_t.icon.programConfigurations.get(c.id),Qs=f.getOrCreateProgram("symbol",{config:ts,defines:ni}),Js=bt.imageAtlasTexture?bt.imageAtlasTexture.size:[0,0],Ds=_t.iconSizeData,la=o.bK(Ds,pe.zoom),Ba=Me||!pe.isOrthographic,No=so(Mt,bt.tileID.canonical,Me,Se,pe,_t.getProjection(),Lt),Tr=ap(Mt,bt.tileID.canonical,Me,Se,pe,_t.getProjection(),Lt),Nr=f.translatePosMatrix(Tr,bt,S,k,!0),zi=f.translatePosMatrix(Mt,bt,S,k),Vr=Nn?Sp:No,vr=Se&&!Me&&!yi;let fr=St;!Ue&&!pe.mercatorFromTransition||Se||(fr=hc(pe));const Va=Gt?fr:St,zp=c.getColorAdjustmentMatrix(te,le,he,ce),hl=Mg(Ds.kind,la,vr,Me,f,zi,Vr,Nr,Ee,!1,Js,[0,0],0,Dt,Bt,Pe,Zn,Va,_t.getProjection(),Fi,fi,zp,Vs,null),jp=bt.imageAtlasTexture?bt.imageAtlasTexture:null,Mh=c.layout.get("icon-size").constantOr(0)!==1||_t.iconsNeedLinear,Ul=_t.sdfIcons||f.options.rotating||f.options.zooming||Mh||Ba?_e.LINEAR:_e.NEAREST,bc=_t.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,kh=f.terrain&&Me&&yi?o.bl(o.bC(),No):Sp;if(yi&&_t.icon){const Au=o.bV.getAtTileOffsetFunc(Dt,pe.center.lat,pe.worldSize,_t.getProjection()),wc=eg(Mt,bt.tileID.canonical,Me,Se,pe,_t.getProjection(),Lt),fl=c.layout.get("icon-size-scale-range"),Tc=o.aA(f.scaleFactor,fl[0],fl[1]);Ib(_t,Mt,f,!1,wc,Tr,Me,W,Au,Dt,Tc)}return{program:Qs,buffers:_t.icon,uniformValues:hl,atlasTexture:jp,atlasTextureIcon:null,atlasInterpolation:Ul,atlasInterpolationIcon:null,isSDF:_t.sdfIcons,hasHalo:bc,depthMode:bo,tile:bt,renderWithShadows:hr,labelPlaneMatrixInv:kh}},Ri=()=>{const yi=De&&c.layout.get("symbol-placement")!=="point",ni=[],Nn=yi||Xe||Sn,Xi=_t.elevationType==="road",Ar=f.shadowRenderer,hr=Xi&&He&&!!Ar&&Ar.enabled,Fi=Ht(hr),bo=Xi&&He&&!f.terrain?Ve:gt;f.terrainRenderModeElevated()&&He&&ni.push("PITCH_WITH_MAP_TERRAIN"),Gt&&(ni.push("PROJECTION_GLOBE_VIEW"),Nn&&ni.push("PROJECTED_POS_ON_VIEWPORT")),!_t.text.zOffsetVertexBuffer||Xi&&f.terrain||ni.push("Z_OFFSET"),_t.iconsInText&&ni.push("RENDER_TEXT_AND_SYMBOL"),ni.push("RENDER_SDF"),hr&&ni.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Xi&&He&&!f.terrain&&_t.text.orientationVertexBuffer&&ni.push("ELEVATED_ROADS"),ui(ni);const Vs=_t.text.programConfigurations.get(c.id),ts=f.getOrCreateProgram("symbol",{config:Vs,defines:ni});let Qs,Js=[0,0],Ds=null;const la=_t.textSizeData;_t.iconsInText&&(Js=bt.imageAtlasTexture?bt.imageAtlasTexture.size:[0,0],Ds=bt.imageAtlasTexture?bt.imageAtlasTexture:null,Qs=He||!pe.isOrthographic||f.options.rotating||f.options.zooming||la.kind==="composite"||la.kind==="camera"?_e.LINEAR:_e.NEAREST);const Ba=bt.glyphAtlasTexture?bt.glyphAtlasTexture.size:[0,0],No=c.layout.get("text-size-scale-range"),Tr=o.aA(f.scaleFactor,No[0],No[1]),Nr=o.bK(la,pe.zoom,Tr),zi=so(Mt,bt.tileID.canonical,He,De,pe,_t.getProjection(),Lt),Vr=ap(Mt,bt.tileID.canonical,He,De,pe,_t.getProjection(),Lt),vr=f.translatePosMatrix(Vr,bt,P,L,!0),fr=f.translatePosMatrix(Mt,bt,P,L),Va=Nn?Sp:zi,zp=De&&!He&&!yi;let hl=St;!Ue&&!pe.mercatorFromTransition||De||(hl=hc(pe));const jp=Mg(la.kind,Nr,zp,He,f,fr,Va,vr,Ee,!0,Ba,Js,0,Dt,Bt,Pe,Zn,Gt?hl:St,_t.getProjection(),Fi,fi,null,null,Tr),Mh=bt.glyphAtlasTexture?bt.glyphAtlasTexture:null,Ul=_e.LINEAR,bc=c.paint.get("text-halo-width").constantOr(1)!==0,kh=f.terrain&&He&&yi?o.bl(o.bC(),zi):Sp;if(yi&&_t.text){const Au=o.bV.getAtTileOffsetFunc(Dt,pe.center.lat,pe.worldSize,_t.getProjection()),wc=eg(Mt,bt.tileID.canonical,He,De,pe,_t.getProjection(),Lt);Ib(_t,Mt,f,!0,wc,Vr,He,ne,Au,Dt,Tr)}return{program:ts,buffers:_t.text,uniformValues:jp,atlasTexture:Mh,atlasTextureIcon:Ds,atlasInterpolation:Ul,atlasInterpolationIcon:Qs,isSDF:!0,hasHalo:bc,depthMode:bo,tile:bt,renderWithShadows:hr,labelPlaneMatrixInv:kh}},Ci=_t.icon.segments.get().length,ci=_t.text.segments.get().length,Dn=Ci&&!w.onlyText?_i():null,mi=ci&&!w.onlyIcons?Ri():null,yr=c.paint.get("icon-opacity").constantOr(1),ir=c.paint.get("text-opacity").constantOr(1);if(We&&_t.canOverlap){tt=!0;const yi=yr&&!w.onlyText?_t.icon.segments.get():[],ni=ir&&!w.onlyIcons?_t.text.segments.get():[];for(const Nn of yi)lt.push({segments:new o.bg([Nn]),sortKey:Nn.sortKey,state:Dn});for(const Nn of ni)lt.push({segments:new o.bg([Nn]),sortKey:Nn.sortKey,state:mi})}else w.onlyText||lt.push({segments:yr?_t.icon.segments:new o.bg([]),sortKey:0,state:Dn}),w.onlyIcons||lt.push({segments:ir?_t.text.segments:new o.bg([]),sortKey:0,state:mi})}tt&&lt.sort((Dt,bt)=>Dt.sortKey-bt.sortKey);for(const Dt of lt){const bt=Dt.state;if(bt)if(f.terrain?f.terrain.setupElevationDraw(bt.tile,bt.program,{useDepthForOcclusion:pe.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:bt.labelPlaneMatrixInv}):f.setupDepthForOcclusion(pe.depthOcclusionForSymbolsAndCircles,bt.program),we.activeTexture.set(_e.TEXTURE0),bt.atlasTexture&&bt.atlasTexture.bind(bt.atlasInterpolation,_e.CLAMP_TO_EDGE,!0),bt.atlasTextureIcon&&(we.activeTexture.set(_e.TEXTURE1),bt.atlasTextureIcon&&bt.atlasTextureIcon.bind(bt.atlasInterpolationIcon,_e.CLAMP_TO_EDGE,!0)),bt.renderWithShadows&&f.shadowRenderer.setupShadows(bt.tile.tileID.toUnwrapped(),bt.program,"vector-tile"),f.uploadCommonLightUniforms(f.context,bt.program),bt.hasHalo){const _t=bt.uniformValues;_t.u_is_halo=1,Xv(bt.buffers,Dt.segments,c,f,bt.program,bt.depthMode,y,b,_t,2),_t.u_is_halo=0}else{if(bt.isSDF){const _t=bt.uniformValues;bt.hasHalo&&(_t.u_is_halo=1,Xv(bt.buffers,Dt.segments,c,f,bt.program,bt.depthMode,y,b,_t,1)),_t.u_is_halo=0}Xv(bt.buffers,Dt.segments,c,f,bt.program,bt.depthMode,y,b,bt.uniformValues,1)}}}function Xv(f,r,c,p,y,b,w,S,P,k){const L=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer,f.orientationVertexBuffer];y.draw(p,p.context.gl.TRIANGLES,b,w,S,mn.disabled,P,c.id,f.layoutVertexBuffer,f.indexBuffer,r,c.paint,p.transform.zoom,f.programConfigurations.get(c.id),L,k)}function rw(f,r){const c=1<<f.canonical.z,p=(r.x*c-f.canonical.x-f.wrap*c)*o.al,y=(r.y*c-f.canonical.y)*o.al,b=o.e8(r.z,r.y);return o.d5(p,y,b)}function Dg(f,r,c,p,y){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;const b=f.context.gl,w=new Xt(f.context.gl.LEQUAL,Xt.ReadWrite,f.depthRangeFor3D),S=new Xt(f.context.gl.GREATER,Xt.ReadWrite,f.depthRangeFor3D),P=function(U){let Z=.01;return U.isOrthographic&&(Z=o.ak(1e-4,Z,o.d0(U.pitch>=ll?1:U.pitch/ll))),2*Z}(f.transform),k=f.transform.getFreeCameraOptions().position,L="elevatedStructuresDepthReconstruct",V=f.getOrCreateProgram(L,{defines:["DEPTH_RECONSTRUCTION"]}),B=f.getOrCreateProgram(L);for(const U of p){const Z=r.getTile(U),W=Z.getBucket(c);if(!W)continue;const ne=W.elevatedStructures;if(!ne)continue;const te=W.elevationBufferData.heightRange,le=rw(U.toUnwrapped(),k),he=f.translatePosMatrix(U.projMatrix,Z,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));let ce,Ee,ye,we;if(y==="initialize"){if(!te||te.min>=1||ne.depthSegments.segments[0].primitiveLength===0)continue;ce=md(he,le,P,1,0),Ee=w,ye=ne.depthSegments,we=V}else if(y==="reset"){if(!te||te.min>=0||ne.maskSegments.segments[0].primitiveLength===0)continue;ce=md(he,le,0,0,1),Ee=S,ye=ne.maskSegments,we=V}else if(y==="geometry"){if(ne.depthSegments.segments[0].primitiveLength===0)continue;ce=md(he,le,P,1,0),Ee=w,ye=ne.depthSegments,we=B}we.draw(f,b.TRIANGLES,Ee,yn.disabled,Rn.disabled,mn.disabled,ce,c.id,ne.vertexBuffer,ne.indexBuffer,ye,c.paint,f.transform.zoom)}}function Ng(f,r,c,p){const{painter:y,sourceCache:b,layer:w,coords:S,colorMode:P,elevationType:k,terrainEnabled:L,pass:V}=f,B=y.context.gl,U=w.paint.get("fill-pattern"),Z=w.paint.get("fill-pattern-cross-fade"),W=U.constantOr(null);let ne=k;k!=="road"||r&&!L||(ne="none");const te=ne==="road",le=f.painter.shadowRenderer,he=te&&!!le&&le.enabled,ce=new Xt(y.context.gl.LEQUAL,Xt.ReadOnly,y.depthRangeFor3D);let Ee=[0,0,0];if(he){const pe=y.style.directionalLight,Se=y.style.ambientLight;pe&&Se&&(Ee=uc(y.style,pe,Se))}const ye=U&&U.constantOr(1),we=y.terrain&&y.terrain.renderingToTexture,_e=(pe,Se)=>{let De,Me,He,We,tt;Se?(De=ye&&!w.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",He=B.LINES):(De=ye?"fillPattern":"fill",He=B.TRIANGLES);for(const gt of S){const Ve=b.getTile(gt);if(ye&&!Ve.patternsLoaded())continue;const Pe=Ve.getBucket(w);if(!Pe)continue;const Xe=r?Pe.elevationBufferData:Pe.bufferData;if(Xe.isEmpty())continue;y.prepareDrawTile();const Ue=Xe.programConfigurations.get(w.id),lt=y.isTileAffectedByFog(gt),St=[],Dt=[];te&&(St.push("ELEVATED_ROADS"),Dt.push(Xe.elevatedLayoutVertexBuffer)),he&&St.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),we&&c&&St.push("USE_MRT1"),ye&&(y.context.activeTexture.set(B.TEXTURE0),Ve.imageAtlasTexture&&Ve.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Ue.updatePaintBuffers());let bt=!1;if(W&&Ve.imageAtlas){const Lt=Ve.imageAtlas,on=o.e3.from(W),Sn=on.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),Zn=on.getSecondary(),fi=Lt.patternPositions.get(Sn),Ht=Zn?Lt.patternPositions.get(Zn.scaleSelf(o.o.devicePixelRatio).toString()):null;bt=!!fi&&!!Ht,fi&&Ue.setConstantPatternPositions(fi,Ht)}Z>0&&(bt||Ue.getPatternTransitionVertexBuffer("fill-pattern"))&&St.push("FILL_PATTERN_TRANSITION");const _t=y.getOrCreateProgram(De,{config:Ue,overrideFog:lt,defines:St}),Gt=y.translatePosMatrix(gt.projMatrix,Ve,w.paint.get("fill-translate"),w.paint.get("fill-translate-anchor"));he&&le.setupShadows(Ve.tileID.toUnwrapped(),_t,"vector-tile");const Bt=w.paint.get("fill-emissive-strength");if(Se){We=Xe.lineIndexBuffer,tt=Xe.lineSegments;const Lt=y.terrain&&y.terrain.renderingToTexture?y.terrain.drapeBufferSize:[B.drawingBufferWidth,B.drawingBufferHeight];Me=De==="fillOutlinePattern"&&ye?Wv(Gt,Bt,y,Ve,Lt,Ee,Z):Zb(Gt,Bt,Lt,Ee)}else We=Xe.indexBuffer,tt=Xe.triangleSegments,Me=ye?Hv(Gt,Bt,y,Ve,Ee,Z):Gv(Gt,Bt,Ee);y.uploadCommonUniforms(y.context,_t,gt.toUnwrapped());let Mt=pe;(k==="road"&&!L||k==="offset")&&(Mt=ce),_t.draw(y,He,Mt,p||y.stencilModeForClipping(gt),P,mn.disabled,Me,w.id,Xe.layoutVertexBuffer,We,tt,w.paint,y.transform.zoom,Ue,Dt)}};y.renderPass===V&&_e(y.depthModeForSublayer(1,y.renderPass==="opaque"?Xt.ReadWrite:Xt.ReadOnly),!1),ne==="none"&&y.renderPass==="translucent"&&w.paint.get("fill-antialias")&&_e(y.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,Xt.ReadOnly),!0)}function Lg(f,r,c,p,y,b,w,S){c.resetLayerRenderingStats(f);const P=f.context,k=P.gl,L=f.transform,V=c.paint.get("fill-extrusion-pattern"),B=c.paint.get("fill-extrusion-pattern-cross-fade"),U=V.constantOr(null),Z=V.constantOr(1),W=c.paint.get("fill-extrusion-opacity"),ne=f.style.enable3dLights(),te=c.paint.get(ne&&!Z?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),le=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),te],he=c.layout.get("fill-extrusion-edge-radius"),ce=he>0&&!c.paint.get("fill-extrusion-rounded-roof"),Ee=ce?0:he,ye=L.projection.name==="globe"?o.eb():0,we=L.projection.name==="globe",_e=we?o.aj(L.zoom):0,pe=[o.aF(L.center.lng),o.aJ(L.center.lat)],Se=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",De=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Se?null:c.lut).toArray01().slice(0,3),Me=c.paint.get("fill-extrusion-flood-light-intensity"),He=c.paint.get("fill-extrusion-vertical-scale"),We=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,tt=c.paint.get("fill-extrusion-height-alignment"),gt=c.paint.get("fill-extrusion-base-alignment"),Ve=pu(f,c.paint.get("fill-extrusion-cutoff-fade-range")),Pe=[];let Xe;we&&Pe.push("PROJECTION_GLOBE_VIEW"),le[0]>0&&Pe.push("FAUX_AO"),ce&&Pe.push("ZERO_ROOF_RADIUS"),S&&Pe.push("HAS_CENTROID"),Me>0&&Pe.push("FLOOD_LIGHT"),Ve.shouldRenderCutoff&&Pe.push("RENDER_CUTOFF"),We&&Pe.push("RENDER_WALL_MODE");const Ue=f.renderPass==="shadow",lt=f.shadowRenderer,St=Ue&&!!lt,Dt=Ue?mn.disabled:mn.backCCW;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let bt=[0,0,0];if(lt){const Bt=f.style.directionalLight,Mt=f.style.ambientLight;Bt&&Mt&&(bt=uc(f.style,Bt,Mt)),Ue||(Pe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),lt.useNormalOffset&&Pe.push("NORMAL_OFFSET")),Xe=Pe.concat(["SHADOWS_SINGLE_CASCADE"])}const _t=St?"fillExtrusionDepth":Z?"fillExtrusionPattern":"fillExtrusion",Gt=c.getLayerRenderingStats();for(const Bt of p){const Mt=r.getTile(Bt),Lt=Mt.getBucket(c);if(!Lt||Lt.projection.name!==L.projection.name)continue;let on=!1;lt&&(on=lt.getMaxCascadeForTile(Bt.toUnwrapped())===0);const Sn=f.isTileAffectedByFog(Bt),Zn=Lt.programConfigurations.get(c.id);let fi=!1;if(U&&Mt.imageAtlas){const ci=Mt.imageAtlas,Dn=o.e3.from(U),mi=Dn.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),yr=Dn.getSecondary(),ir=ci.patternPositions.get(mi),yi=yr?ci.patternPositions.get(yr.scaleSelf(o.o.devicePixelRatio).toString()):null;fi=!!ir&&!!yi,ir&&Zn.setConstantPatternPositions(ir,yi)}B>0&&(fi||Zn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Pe.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Ht=f.getOrCreateProgram(_t,{config:Zn,defines:on?Xe:Pe,overrideFog:Sn});if(f.terrain&&f.terrain.setupElevationDraw(Mt,Ht,{useMeterToDem:!0}),!Lt.centroidVertexBuffer){const ci=Ht.getAttributeLocation(k,"a_centroid_pos");ci!==-1&&k.vertexAttrib2f(ci,0,0)}!Ue&&lt&&lt.setupShadows(Mt.tileID.toUnwrapped(),Ht,"vector-tile"),Z&&(f.context.activeTexture.set(k.TEXTURE0),Mt.imageAtlasTexture&&Mt.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Zn.updatePaintBuffers());const ui=c.paint.get("fill-extrusion-vertical-gradient"),Tn=1/Lt.tileToMeter;let _i;if(Ue&&lt){if(pc(Mt.tileID,Lt.maxHeight,f))continue;const ci=lt.calculateShadowPassMatrixFromTile(Mt.tileID.toUnwrapped());_i=$v(ci,Ee,Tn,He,tt,gt)}else{const ci=f.translatePosMatrix(Bt.expandedProjMatrix,Mt,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Dn=L.projection.createInversionMatrix(L,Bt.canonical);_i=Z?qb(ci,f,ui,W,le,Ee,Tn,Bt,Mt,ye,tt,gt,_e,pe,Dn,De,He,B):Ig(ci,f,ui,W,le,Ee,Tn,Bt,ye,tt,gt,_e,pe,Dn,De,He,Me,bt)}f.uploadCommonUniforms(P,Ht,Bt.toUnwrapped(),null,Ve);let Ri=Lt.segments;if(L.projection.name==="mercator"&&!Ue&&(Ri=Lt.getVisibleSegments(Mt.tileID,f.terrain,f.transform.getFrustum(0)),!Ri.get().length))continue;if(Gt)if(Ue)for(const ci of Ri.get())Gt.numRenderedVerticesInShadowPass+=ci.primitiveLength;else for(const ci of Ri.get())Gt.numRenderedVerticesInTransparentPass+=ci.primitiveLength;const Ci=[];(f.terrain||S)&&Ci.push(Lt.centroidVertexBuffer),we&&Ci.push(Lt.layoutVertexExtBuffer),We&&Ci.push(Lt.wallVertexBuffer),Ht.draw(f,P.gl.TRIANGLES,y,b,w,Dt,_i,c.id,Lt.layoutVertexBuffer,Lt.indexBuffer,Ri,c.paint,f.transform.zoom,Zn,Ci)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}class Yv{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function fc(f,r,c,p,y,b,w,S,P,k,L,V,B,U,Z,W,ne,te,le,he){const ce=r.context,Ee=ce.gl,ye=r.transform,we=r.transform.zoom,_e=[],pe=f.translate,Se=f.translateAnchor,De=f.edgeRadius,Me=pu(r,f.cutoffFadeRange);L==="clear"?(_e.push("CLEAR_SUBPASS"),he&&(_e.push("CLEAR_FROM_TEXTURE"),ce.activeTexture.set(Ee.TEXTURE0),he.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE))):L==="sdf"?_e.push("SDF_SUBPASS"):L==="emissive"&&(_e.push("USE_MRT1"),ce.activeTexture.set(Ee.TEXTURE0),he.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)),te&&_e.push("HAS_CENTROID"),Me.shouldRenderCutoff&&_e.push("RENDER_CUTOFF");const He=(We,tt,gt,Ve,Pe)=>{let Xe=_e;tt.groundRadiusBuffer!=null&&(Xe=_e.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const Ue=tt.programConfigurations.get(p.id),lt=r.isTileAffectedByFog(We),St=r.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ue,defines:Xe,overrideFog:lt}),Dt=xh(r,Ve,V,k,Pe,[B,U*Pe],Z,W,ne,we>=17?0:De*Pe,he?he.size[0]:0),bt=[];te&&bt.push(tt.hiddenByLandmarkVertexBuffer),tt.groundRadiusBuffer!=null&&bt.push(tt.groundRadiusBuffer),r.uploadCommonUniforms(ce,St,We.toUnwrapped(),null,Me),St.draw(r,ce.gl.TRIANGLES,b,w,S,P,Dt,p.id,tt.vertexBuffer,tt.indexBuffer,gt,p.paint,we,Ue,bt)};for(const We of y){const tt=c.getTile(We),gt=tt.getBucket(p);if(!gt||gt.projection.name!==ye.projection.name||!gt.groundEffect||gt.groundEffect&&!gt.groundEffect.hasData())continue;const Ve=gt.groundEffect,Pe=1/gt.tileToMeter;{const Xe=r.translatePosMatrix(We.projMatrix,tt,pe,Se),Ue=Ve.getDefaultSegment();He(We,Ve,Ue,Xe,Pe)}if(le)for(let Xe=0;Xe<4;Xe++){const Ue=o.e9[Xe](We),lt=c.getTile(Ue);if(!lt)continue;const St=lt.getBucket(p);if(!St||St.projection.name!==ye.projection.name||!St.groundEffect||St.groundEffect&&!St.groundEffect.hasData())continue;const Dt=St.groundEffect;let bt,_t;Xe===0?(bt=[-o.al,0,0],_t=1):Xe===1?(bt=[o.al,0,0],_t=0):Xe===2?(bt=[0,-o.al,0],_t=3):(bt=[0,o.al,0],_t=2);const Gt=Dt.regionSegments[_t];if(!Gt)continue;const Bt=new Float32Array(16);o.br(Bt,We.projMatrix,bt),He(We,Dt,Gt,r.translatePosMatrix(Bt,tt,pe,Se),Pe)}}}function kI(f,r,c,p,y,b,w){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const S=b?b.findDEMTileFor(c):null;if(!(S&&S.dem||w))return;b&&S&&S.dem&&p.selfDEMTileTimestamp!==S.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=S.dem._timestamp);const P=te=>new o.P(Math.ceil((te+o.ed)*o.ee),0),k=te=>{const le=r.getSource().minzoom,he=Ee=>{const ye=r.getTileByID(Ee);if(ye&&ye.hasData())return ye.getBucket(y)},ce=[0,-1,1];for(const Ee of ce){if(te.overscaledZ+Ee<le)continue;const ye=he(te.calculateScaledKey(te.overscaledZ+Ee));if(ye)return ye}},L=[0,0,0],V=(te,le)=>(L[0]=Math.min(te.min.y,le.min.y),L[1]=Math.max(te.max.y,le.max.y),L[2]=o.al-le.min.x>te.max.x?le.min.x-o.al:te.max.x,L),B=(te,le)=>(L[0]=Math.min(te.min.x,le.min.x),L[1]=Math.max(te.max.x,le.max.x),L[2]=o.al-le.min.y>te.max.y?le.min.y-o.al:te.max.y,L),U=[(te,le)=>V(te,le),(te,le)=>V(le,te),(te,le)=>B(te,le),(te,le)=>B(le,te)],Z=(te,le,he,ce,Ee,ye,we)=>{if(!b)return 0;const _e=[[ye?he:te,ye?te:he,0],[ye?he:le,ye?le:he,0]],pe=we<0?o.al+we:we,Se=[ye?pe:(te+le)/2,ye?(te+le)/2:pe,0];return he===0&&we<0||he!==0&&we>0?b.getForTilePoints(Ee,[Se],!0,ce):_e.push(Se),b.getForTilePoints(c,_e,!0,S),Math.max(_e[0][2],_e[1][2],Se[2])/b.exaggeration()};for(let te=0;te<4;te++){const le=p.borderFeatureIndices[te];if(le.length===0)continue;const he=o.e9[te](c),ce=k(he);if(!(ce&&ce instanceof o.ea))continue;const Ee=b?b.findDEMTileFor(he):null;if(!(Ee&&Ee.dem||w)||(b&&Ee&&Ee.dem&&p.borderDEMTileTimestamp[te]!==Ee.dem._timestamp&&(p.borderDoneWithNeighborZ[te]=-1,p.borderDEMTileTimestamp[te]=Ee.dem._timestamp),p.borderDoneWithNeighborZ[te]===ce.canonical.z))continue;ce.centroidVertexArray.length===0&&ce.createCentroidsBuffer();const ye=(te<2?1:5)-te,we=ce.borderDoneWithNeighborZ[ye]!==p.canonical.z,_e=ce.borderFeatureIndices[ye];let pe=0;if(p.canonical.z!==ce.canonical.z){for(const Se of le)p.showCentroid(p.featuresOnBorder[Se]);if(we)for(const Se of _e)ce.showCentroid(ce.featuresOnBorder[Se]);p.borderDoneWithNeighborZ[te]=ce.canonical.z,ce.borderDoneWithNeighborZ[ye]=p.canonical.z}for(const Se of le){const De=p.featuresOnBorder[Se],Me=p.centroidData[De.centroidDataIndex],He=De.borders[te];let We;for(;pe<_e.length;){We=ce.featuresOnBorder[_e[pe]];const tt=We.borders[ye];if(tt[1]>He[0]+3||tt[0]>He[0]-3)break;ce.showCentroid(We),pe++}if(We&&pe<_e.length){const tt=pe;let gt=0;for(;!(We.borders[ye][0]>He[1]-3)&&(gt++,++pe!==_e.length);)We=ce.featuresOnBorder[_e[pe]];We=ce.featuresOnBorder[_e[tt]];let Ve=!1;if(gt>=1){const Ue=We.borders[ye];Math.abs(He[0]-Ue[0])<3&&Math.abs(He[1]-Ue[1])<3&&(gt=1,Ve=!0,pe=tt+1)}else if(gt===0){p.showCentroid(De);continue}const Pe=ce.centroidData[We.centroidDataIndex];w&&Ve&&(((W=Me).flags|(ne=Pe).flags)&o.ec?(W.flags|=o.ec,ne.flags|=o.ec):(W.flags&=~o.ec,ne.flags&=~o.ec));const Xe=De.intersectsCount()>1||We.intersectsCount()>1;if(gt>1)pe=tt,Me.centroidXY=Pe.centroidXY=new o.P(0,0);else if(Ee&&Ee.dem&&!Xe){const Ue=U[te](Me,Pe),lt=te%2?o.al-1:0,St=Z(Ue[0],Math.min(o.al-1,Ue[1]),lt,Ee,he,te<2,Ue[2]);Me.centroidXY=Pe.centroidXY=P(St)}else Xe?Me.centroidXY=Pe.centroidXY=new o.P(0,0):(Me.centroidXY=p.encodeBorderCentroid(De),Pe.centroidXY=ce.encodeBorderCentroid(We));p.writeCentroidToBuffer(Me),ce.writeCentroidToBuffer(Pe)}else p.showCentroid(De)}p.borderDoneWithNeighborZ[te]=ce.canonical.z,ce.borderDoneWithNeighborZ[ye]=p.canonical.z}var W,ne;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}const Ho=[1,0,0],Qv=[0,1,0],vo=[0,0,1];function pc(f,r,c){const p=c.transform,y=c.shadowRenderer;if(!y)return!0;const b=f.toUnwrapped(),w=p.tileSize*y._cascades[c.currentShadowCascade].scale;let S=r;if(p.elevation){const W=p.elevation.getMinMaxForTile(f);W&&(S+=W.max)}const P=[...y.shadowDirection];P[2]=-P[2];const k=y.computeSimplifiedTileShadowVolume(b,S,w,P);if(!k)return!1;const L=[Ho,Qv,vo,P,[P[0],0,P[2]],[0,P[1],P[2]]],V=p.projection.name==="globe",B=p.scaleZoom(w),U=o.cB.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,B,!V),Z=y.getCurrentCascadeFrustum();return U.intersectsPrecise(k.vertices,k.planes,L)===0||Z.intersectsPrecise(k.vertices,k.planes,L)===0}function Ip(f){const{painter:r,source:c,layer:p,coords:y}=f;let b=f.defines;const w=r.context,S=r.renderPass==="shadow",P=r.renderPass==="light-beam",k=r.shadowRenderer,L=o.ef(r.transform.center.lat,r.transform.zoom),V=pu(r,p.paint.get("building-cutoff-fade-range"));V.shouldRenderCutoff&&(b=b.concat("RENDER_CUTOFF")),f.floodLightIntensity>0&&(b=b.concat("FLOOD_LIGHT"));for(const B of y){const U=c.getTile(B),Z=U.getBucket(p);if(!Z)continue;k&&k.getMaxCascadeForTile(B.toUnwrapped())===0&&(b=b.concat("SHADOWS_SINGLE_CASCADE"));const W=Z.programConfigurations.get(p.id);let ne,te,le,he=r.translatePosMatrix(B.expandedProjMatrix,U,[0,0],"map");if(he=o.cS(o.bC(),he,[1,1,f.verticalScale]),S&&k){if(pc(U.tileID,Z.maxHeight*L,r))continue;let Ee=k.calculateShadowPassMatrixFromTile(U.tileID.toUnwrapped());Ee=o.cS(o.bC(),Ee,[1,1,f.verticalScale]),le=bu(Ee),ne=te=r.getOrCreateProgram("buildingDepth",{config:W,defines:b,overrideFog:!1})}else if(P)ne=te=r.getOrCreateProgram("buildingBloom",{config:W,defines:b,overrideFog:!1}),le=Kb(he);else{const Ee=r.transform.calculatePosMatrix(B.toUnwrapped(),r.transform.worldSize);o.cS(Ee,Ee,[1,1,f.verticalScale]);const ye=o.bC();o.cS(ye,Ee,[1,-1,1/L]),o.bl(ye,ye),o.eg(ye,ye);const we=r.transform.getFreeCameraOptions().position,_e=1<<B.canonical.z;if(le=Ag(he,ye,f.opacity,f.facadeAOIntensity,[((we.x-B.wrap)*_e-B.canonical.x)*o.al,(we.y*_e-B.canonical.y)*o.al,we.z*_e*o.al],Z.tileToMeter,f.facadeEmissiveChance,f.floodLightColor,f.floodLightIntensity),te=r.getOrCreateProgram("building",{config:W,defines:b,overrideFog:!1}),f.depthOnly===!0)ne=te;else{const pe=b.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);ne=r.getOrCreateProgram("building",{config:W,defines:pe,overrideFog:!1})}k&&(k.setupShadowsFromMatrix(Ee,te,!0),ne!==te&&k.setupShadowsFromMatrix(Ee,ne,!0))}const ce=(Ee,ye)=>{if(P){const we=Ee.entranceBloom;ye.draw(r,w.gl.TRIANGLES,f.depthMode,yn.disabled,f.blendMode,mn.disabled,le,p.id,we.layoutVertexBuffer,we.indexBuffer,we.segmentsBucket,p.paint,r.transform.zoom,W,[we.layoutAttenuationBuffer,we.layoutColorBuffer])}else{const we=Ee.segmentsBucket;let _e=[Ee.layoutNormalBuffer,Ee.layoutCentroidBuffer,Ee.layoutColorBuffer,Ee.layoutFloodLightDataBuffer];Ee.layoutFacadePaintBuffer&&(_e=_e.concat([Ee.layoutFacadeDataBuffer,Ee.layoutFacadeVerticalRangeBuffer,Ee.layoutFacadePaintBuffer])),ye.draw(r,w.gl.TRIANGLES,f.depthMode,yn.disabled,f.blendMode,S?mn.disabled:mn.backCW,le,p.id,Ee.layoutVertexBuffer,Ee.indexBuffer,we,p.paint,r.transform.zoom,W,_e)}};r.uploadCommonUniforms(w,te,B.toUnwrapped(),null,V),Z.buildingWithoutFacade&&ce(Z.buildingWithoutFacade,te),Z.buildingWithFacade&&(ne!==te&&r.uploadCommonUniforms(w,ne,B.toUnwrapped(),null,V),ce(Z.buildingWithFacade,ne))}}function Og(f,r,c,p,y,b,w,S,P,k,L,V,B){const U=f.context.gl,Z=f.depthModeForSublayer(1,Xt.ReadOnly,U.LEQUAL,!0),W=.1*(1-(ne=L))+3*ne;var ne;const te=f._showOverdrawInspector,le=V,he=new Yv;te||fc(he,f,r,c,p,Z,new yn({func:U.ALWAYS,mask:255},255,255,U.KEEP,U.KEEP,U.REPLACE),new Rn([U.ONE,U.ONE,U.ONE,U.ONE],o.ao.transparent,[!1,!1,!1,!0],U.MIN),mn.disabled,y,"sdf",b,w,S,P,k,W,le,!1);{const ce=te?yn.disabled:new yn({func:U.EQUAL,mask:255},255,255,U.KEEP,U.DECR,U.DECR),Ee=te?f.colorModeForRenderPass():new Rn([U.ONE_MINUS_DST_ALPHA,U.DST_ALPHA,U.ONE,U.ONE],o.ao.transparent,[!0,!0,!0,!0]);fc(he,f,r,c,p,Z,ce,Ee,mn.disabled,y,"color",b,w,S,P,k,W,le,!1)}}function Fg(f){return[f[0]*o.eh,f[1]*o.eh,f[2]*o.eh,0]}function Ap(f,r,c,p,y,b,w,S,P){const k=p.getSource(),L=c.globeSharedBuffers;if(!L)return;let V,B,U;if(r&&(V=p.getTile(r)),k instanceof o.aU?(B=k.texture,U=o.dK(0,0,c.transform)):V&&r&&(B=V.texture,U=o.dK(r.canonical.z,r.canonical.x,c.transform)),!B||!U)return;f||(U=o.cS(o.bC(),U,[1,-1,1]));const Z=c.context,W=Z.gl,ne=y.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR,te=c.colorModeForDrapableLayerRenderPass(b),le=w.defines;le.push("GLOBE_POLES");const he=new Xt(W.LEQUAL,Xt.ReadWrite,c.depthRangeFor3D),ce=Float32Array.from(c.transform.expandedFarZProjMatrix),Ee=Float32Array.from(o.bk(o.dJ(new o.cD(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),Z.activeTexture.set(W.TEXTURE0),B.bind(ne,W.CLAMP_TO_EDGE),Z.activeTexture.set(W.TEXTURE1),B.bind(ne,W.CLAMP_TO_EDGE),"useMipmap"in B&&Z.extTextureFilterAnisotropic&&c.transform.pitch>20&&W.texParameterf(W.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax);const[ye,we,_e,pe]=r?L.getPoleBuffers(r.canonical.z,!1):L.getPoleBuffers(0,!0),Se=y.paint.get("raster-elevation");let De;f?(De=ye,c.renderDefaultNorthPole=Se!==0):(De=we,c.renderDefaultSouthPole=Se!==0);const Me=Fg(w.mix),He=((tt,gt,Ve,Pe,Xe,Ue,lt,St,Dt,bt,_t,Gt,Bt)=>Qb(tt,gt,Ve,new Float32Array(16),new Float32Array(9),[0,0],Pe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ue,[0,0],St,2,bt,_t,Gt,1,0,Bt))(ce,Ee,U,o.aj(c.transform.zoom),0,y,0,Se,0,Me,w.offset,w.range,b),We=c.getOrCreateProgram("raster",{defines:le});c.uploadCommonUniforms(Z,We,null),We.draw(c,W.TRIANGLES,he,P,te,S,He,y.id,De,_e,pe)}function sw(f){const r=f._nearZ,c=f.projection.farthestPixelDistance(f),p=c-r,y=.2*f.height,b=r+y;return[r,c,(b-y-r)/p,(b-r)/p]}function mc(f,r,c,p){if(f)return r instanceof ro&&f instanceof Xm?r.getTextureDescriptor(f,c,!0):{texture:f.texture,mix:Fg(p.mix),offset:p.offset,buffer:0,tileSize:1}}var Wi=o.ei([{name:"a_index",type:"Int16",components:1}]);class zg{constructor(r,c,p,y){const b={width:p[0],height:p[1],data:null},w=r.gl;this.targetColorTexture=new o.T(r,b,w.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(r,b,w.RGBA8,{useMipmap:!1}),this.context=r,this.updateParticleTexture(c,y),this.lastInvalidatedAt=0}updateParticleTexture(r,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,y=c.width*c.height;this.particleTexture0=new o.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1});const b=new o.ej;b.reserve(y);for(let w=0;w<y;w++)b.emplaceBack(w);this.particleIndexBuffer=this.context.createVertexBuffer(b,Wi.members,!0),this.particleSegment=o.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=o.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Jv(f,r,c){if(!f)return null;const p=r.getTextureDescriptor(f,c,!0);if(!p)return null;let{texture:y,mix:b,offset:w,tileSize:S,buffer:P,format:k}=p;if(!y||!k)return null;let L=!1;return k==="uint32"&&(L=!0,b[3]=0,b=Pg(o.ek,b,[0,c.paint.get("raster-particle-max-speed")]),w=Rg(o.ek,w,[0,c.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[P/(S+2*P),S/(S+2*P)],tileSize:S,scalarData:L,scale:b,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[k]]}}function ow(f){const r=f._nearZ,c=f.projection.farthestPixelDistance(f),p=c-r,y=.2*f.height,b=r+y;return[r,c,(b-y-r)/p,(b-r)/p]}const aw=new o.ao(1,0,0,1),lw=new o.ao(0,1,0,1),cw=new o.ao(0,0,1,1),yd=new o.ao(1,0,1,1),vd=new o.ao(0,1,1,1);function xt(f,r,c,p,y,b){for(let w=0;w<c.length;w++)if(y){const k=new o.ao(p.r*.8,p.g*.8,p.b*.8,1);It(f,r,c[w],p,-1,-1,b),It(f,r,c[w],p,-1,1,b),It(f,r,c[w],p,1,1,b),It(f,r,c[w],p,1,-1,b),It(f,r,c[w],k,0,0,b)}else It(f,r,c[w],p,0,0,b)}function It(f,r,c,p,y,b,w){const S=f.context,P=f.transform,k=S.gl,L=P.projection.name==="globe",V=L?["PROJECTION_GLOBE_VIEW"]:[];let B=o.bz(c.projMatrix);if(L&&o.aj(P.zoom)>0){const Me=o.bj(c.canonical,P),He=o.el(Me);B=o.aB(new Float32Array(16),P.globeMatrix,He),o.aB(B,P.projMatrix,B)}const U=o.bC();U[12]+=2*y/(o.o.devicePixelRatio*P.width),U[13]+=2*b/(o.o.devicePixelRatio*P.height),o.aB(B,U,B);const Z=f.getOrCreateProgram("debug",{defines:V}),W=r.getTileByID(c.key);f.terrain&&f.terrain.setupElevationDraw(W,Z);const ne=Xt.disabled,te=yn.disabled,le=f.colorModeForRenderPass(),he="$debug";S.activeTexture.set(k.TEXTURE0),f.emptyTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),L?W._makeGlobeTileDebugBuffers(f.context,P):W._makeDebugTileBoundsBuffers(f.context,P.projection);const ce=W._tileDebugBuffer||f.debugBuffer,Ee=W._tileDebugIndexBuffer||f.debugIndexBuffer,ye=W._tileDebugSegments||f.debugSegments;if(Z.draw(f,k.LINE_STRIP,ne,te,le,mn.disabled,Tp(B,p.toPremultipliedRenderColor(null)),he,ce,Ee,ye,null,null,null,[W._globeTileDebugBorderBuffer]),w){const Me=W.latestRawTileData,He=Math.floor((Me&&Me.byteLength||0)/1024);let We=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(We+=` => ${c.overscaledZ}`),We+=` ${W.state}`,We+=` ${He}kb`,function(tt,gt){tt.initDebugOverlayCanvas();const Ve=tt.debugOverlayCanvas,Pe=tt.context.gl,Xe=tt.debugOverlayCanvas.getContext("2d");Xe.clearRect(0,0,Ve.width,Ve.height),Xe.shadowColor="white",Xe.shadowBlur=2,Xe.lineWidth=1.5,Xe.strokeStyle="white",Xe.textBaseline="top",Xe.font="bold 36px Open Sans, sans-serif",Xe.fillText(gt,5,5),Xe.strokeText(gt,5,5),tt.debugOverlayTexture.update(Ve),tt.debugOverlayTexture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE)}(f,We)}const we=r.getTile(c).tileSize,_e=512/Math.min(we,512)*(c.overscaledZ/P.zoom)*.5,pe=W._tileDebugTextBuffer||f.debugBuffer,Se=W._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,De=W._tileDebugTextSegments||f.debugSegments;Z.draw(f,k.TRIANGLES,ne,te,Rn.alphaBlended,mn.disabled,Tp(B,o.ao.transparent.toPremultipliedRenderColor(null),_e),he,pe,Se,De,null,null,null,[W._globeTileDebugTextBuffer])}function xd(f,r,c,p){Fe(f,0,r+c/2,f.transform.width,c,p)}function wr(f,r,c,p){Fe(f,r-c/2,0,c,f.transform.height,p)}function Fe(f,r,c,p,y,b){const w=f.context,S=w.gl;S.enable(S.SCISSOR_TEST),S.scissor(r*o.o.devicePixelRatio,c*o.o.devicePixelRatio,p*o.o.devicePixelRatio,y*o.o.devicePixelRatio),w.clear({color:b}),S.disable(S.SCISSOR_TEST)}const uw=o.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:jg}=uw;function zl(f,r,c,p){f.emplaceBack(r,c,p)}class Bg{constructor(r){this.vertexArray=new o.em,this.indices=new o.b0,zl(this.vertexArray,-1,-1,1),zl(this.vertexArray,1,-1,1),zl(this.vertexArray,-1,1,1),zl(this.vertexArray,1,1,1),zl(this.vertexArray,-1,-1,-1),zl(this.vertexArray,1,-1,-1),zl(this.vertexArray,-1,1,-1),zl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,jg),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=o.bg.simpleSegment(0,0,36,12)}}function bd(f,r,c,p,y,b){const w=f.context.gl,S=r.paint.get("sky-atmosphere-color"),P=r.paint.get("sky-atmosphere-halo-color"),k=r.paint.get("sky-atmosphere-sun-intensity"),L=((V,B,U,Z,W)=>({u_matrix_3f:V,u_sun_direction:B,u_sun_intensity:U,u_color_tint_r:[Z.r,Z.g,Z.b,Z.a],u_color_tint_m:[W.r,W.g,W.b,W.a],u_luminance:5e-5}))(o.eo(o.dO(),p),y,k,S.toPremultipliedRenderColor(null),P.toPremultipliedRenderColor(null));w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+b,r.skyboxTexture,0),c.draw(f,w.TRIANGLES,Xt.disabled,yn.disabled,Rn.unblended,mn.frontCW,L,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const dw=o.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Th{constructor(r){const c=new o.ep;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const p=new o.b0;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(c,dw.members),this.indexBuffer=r.createIndexBuffer(p),this.segments=o.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const DI=o.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class NI{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class hw{constructor(r){this.colorModeAlphaBlendedWriteRGB=new Rn([1,Nl,1,Nl],o.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Rn([1,0,1,0],o.ao.transparent,[!1,!1,!1,!0]),this.params=new NI,this.updateNeeded=!0}update(r){const c=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Th(c);const p=this.params.sizeRange,y=this.params.intensityRange,b=function(L){const V=o.eq(30),B=[];for(let U=0;U<L;++U){const Z=2*Math.PI*V(),W=Math.acos(1-2*V())-.5*Math.PI;B.push(o.d5(Math.cos(W)*Math.cos(Z),Math.cos(W)*Math.sin(Z),Math.sin(W)))}return B}(this.params.starsCount),w=o.eq(300),S=new o.er,P=new o.b0;let k=0;for(let L=0;L<b.length;++L){const V=o.c5([],b[L],200),B=Math.max(0,1+.01*p*(1*w()-.5)),U=Math.max(0,1+.01*y*(1*w()-.5));S.emplaceBack(V[0],V[1],V[2],-1,-1,B,U),S.emplaceBack(V[0],V[1],V[2],1,-1,B,U),S.emplaceBack(V[0],V[1],V[2],1,1,B,U),S.emplaceBack(V[0],V[1],V[2],-1,1,B,U),P.emplaceBack(k+0,k+1,k+2),P.emplaceBack(k+0,k+2,k+3),k+=4}this.starsVx=c.createVertexBuffer(S,DI.members),this.starsIdx=c.createIndexBuffer(P),this.starsSegments=o.bg.simpleSegment(0,0,S.length,P.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,c){const p=r.context,y=p.gl,b=r.transform,w=new Xt(y.LEQUAL,Xt.ReadOnly,[0,1]),S=o.aj(b.zoom),P=r.style.getLut(c.scope),k=c.properties.get("color-use-theme")==="none",L=c.properties.get("color").toNonPremultipliedRenderColor(k?null:P),V=c.properties.get("high-color-use-theme")==="none",B=c.properties.get("high-color").toNonPremultipliedRenderColor(V?null:P),U=c.properties.get("space-color-use-theme")==="none",Z=c.properties.get("space-color").toNonPremultipliedRenderColor(U?null:P),W=5e-4,ne=o.es(c.properties.get("horizon-blend"),0,1,W,.25),te=o.dE(r,p,b)&&ne===W?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,le=r.frameCounter/1e3%1,he=o.ag(b.globeCenterInViewSpace),ce=Math.sqrt(Math.pow(he,2)-Math.pow(te,2)),Ee=Math.acos(ce/he),ye=we=>{const _e=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];we&&_e.push("ALPHA_PASS");const pe=r.getOrCreateProgram("globeAtmosphere",{defines:_e}),Se=((Me,He,We,tt,gt,Ve,Pe,Xe,Ue,lt,St,Dt)=>({u_frustum_tl:Me,u_frustum_tr:He,u_frustum_br:We,u_frustum_bl:tt,u_horizon:gt,u_transition:Ve,u_fadeout_range:Pe,u_atmosphere_fog_color:Xe.toArray01(),u_high_color:Ue.toArray01(),u_space_color:lt.toArray01(),u_temporal_offset:St,u_horizon_angle:Dt}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,S,ne,L,B,Z,le,Ee);r.uploadCommonUniforms(p,pe);const De=this.atmosphereBuffer;De&&pe.draw(r,y.TRIANGLES,w,yn.disabled,we?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,mn.backCW,Se,we?"atmosphere_glow_alpha":"atmosphere_glow",De.vertexBuffer,De.indexBuffer,De.segments)};ye(!1),ye(!0)}drawStars(r,c){const p=o.aA(c.properties.get("star-intensity"),0,1);if(p===0)return;const y=r.context,b=y.gl,w=r.transform,S=r.getOrCreateProgram("stars"),P=o.c7([]);o.c9(P,P,-w._pitch),o.c8(P,P,-w.angle),o.c9(P,P,o.an(w._center.lat)),o.et(P,P,-o.an(w._center.lng));const k=o.cc(new Float32Array(16),P),L=o.aB([],w.starsProjMatrix,k),V=o.eo([],k),B=o.eu([],V),U=[0,1,0];o.dQ(U,U,B),o.c5(U,U,this.params.sizeMultiplier);const Z=[1,0,0];o.dQ(Z,Z,B),o.c5(Z,Z,this.params.sizeMultiplier);const W=(ne=U,te=Z,le=p,{u_matrix:Float32Array.from(L),u_up:ne,u_right:te,u_intensity_multiplier:le});var ne,te,le;r.uploadCommonUniforms(y,S),this.starsVx&&this.starsIdx&&S.draw(r,b.TRIANGLES,Xt.disabled,yn.disabled,this.colorModeAlphaBlendedWriteRGB,mn.disabled,W,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Vg{constructor(){this.visibleTiles=[]}updateBorders(r,c){const p=[],y=[],b=r._getRenderableCoordinates(!1,!0);for(const P of b){const k=r.getTile(P);if(!k.hasData())continue;const L=k.getBucket(c);L&&(L.isEmpty()||(p.push(P.key),y.push({bucket:L,tileID:P.canonical})))}let w=p.length!==this.visibleTiles.length;if(!w){p.sort();for(let P=0;P<p.length;P++)if(p[P]!==this.visibleTiles[P]){w=!0;break}}if(!w)return;const S=new Set;this.visibleTiles=p,y.sort((P,k)=>P.tileID.z-k.tileID.z||P.tileID.x-k.tileID.x||P.tileID.y-k.tileID.y);for(const P of y){const k=new Array,L=new Array,V=P.bucket;for(const B of V.featuresOnBorder)S.has(B.featureId)?L.push(B.footprintIndex):(S.add(B.featureId),k.push(B.footprintIndex));V.updateFootprintHiddenFlags(k,o.ev,!1),V.updateFootprintHiddenFlags(L,o.ev,!0)}}}function Ug(f,r){const c=[...f],p=r.cameraWorldSizeForFog/r.worldSize,y=o.bA([]);return o.cS(y,y,[p,p,1]),o.aB(c,y,c),o.aB(c,r.worldToFogMatrix,c),c}function $g(f,r,c,p,y){const b=c.material,w=p.context,{baseColorTexture:S,metallicRoughnessTexture:P}=b.pbrMetallicRoughness,{normalTexture:k,occlusionTexture:L,emissionTexture:V}=b;function B(Z,W,ne){if(Z&&(f.push(W),w.activeTexture.set(w.gl.TEXTURE0+ne),Z.gfxTexture)){const{minFilter:te,magFilter:le,wrapS:he,wrapT:ce}=Z.sampler;Z.gfxTexture.bindExtraParam(te,le,he,ce)}}B(S,"HAS_TEXTURE_u_baseColorTexture",Ss.BaseColor),B(P,"HAS_TEXTURE_u_metallicRoughnessTexture",Ss.MetallicRoughness),B(k,"HAS_TEXTURE_u_normalTexture",Ss.Normal),B(L,"HAS_TEXTURE_u_occlusionTexture",Ss.Occlusion),B(V,"HAS_TEXTURE_u_emissionTexture",Ss.Emission),y&&(y.texture||(y.texture=new o.d$(p.context,y.image,[y.image.height,y.image.height,y.image.height],w.gl.RGBA8)),w.activeTexture.set(w.gl.TEXTURE0+Ss.LUT),y.texture&&y.texture.bind(w.gl.LINEAR,w.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(c.texcoordBuffer)),c.colorBuffer&&(f.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(c.colorBuffer)),c.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(c.normalBuffer)),c.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(c.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||f.push("DIFFUSE_SHADED");const U=p.shadowRenderer;U&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),U.useNormalOffset&&f.push("NORMAL_OFFSET"))}function Gg(f,r,c,p,y,b){const w=f.modelOpacity,S=r.context,P=new Xt(r.context.gl.LEQUAL,f.isLightMesh?Xt.ReadOnly:Xt.ReadWrite,r.depthRangeFor3D),k=r.transform,L=f.mesh,V=L.material,B=V.pbrMetallicRoughness,U=r.style.fog;let Z;Z=r.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:o.aB([],p.zScaleMatrix,f.nodeModelMatrix),o.aB(Z,p.negCameraPosMatrix,Z);const W=o.bl([],Z);o.eg(W,W);const ne=c.paint.get("model-color-use-theme").constantOr("default")==="none",te=c.paint.get("model-emissive-strength").constantOr(0),le=gd(new Float32Array(f.worldViewProjection),new Float32Array(Z),new Float32Array(W),null,r,w,B.baseColorFactor,V.emissiveFactor,B.metallicFactor,B.roughnessFactor,V,te,c,void 0,void 0,f.materialOverride,f.modelColor),he={defines:[]},ce=[],Ee=r.shadowRenderer;Ee&&(Ee.useNormalOffset=!1),$g(he.defines,ce,L,r,ne?null:c.lut);let ye=null;if(U){const pe=Ug(f.nodeModelMatrix,r.transform);if(ye=new Float32Array(pe),k.projection.name!=="globe"){const Se=L.aabb.min,De=L.aabb.max,[Me,He]=U.getOpacityForBounds(pe,Se[0],Se[1],De[0],De[1]);he.overrideFog=Me>=nt||He>=nt}}const we=pu(r,c.paint.get("model-cutoff-fade-range"));we.shouldRenderCutoff&&he.defines.push("RENDER_CUTOFF");const _e=r.getOrCreateProgram("model",he);r.uploadCommonUniforms(S,_e,null,ye,we),r.renderPass!=="shadow"&&Ee&&Ee.setupShadowsFromMatrix(f.nodeModelMatrix,_e),_e.draw(r,S.gl.TRIANGLES,P,y,b,L.material.doubleSided?mn.disabled:mn.backCCW,le,c.id,L.vertexBuffer,L.indexBuffer,L.segments,c.paint,r.transform.zoom,void 0,ce)}function Pp(f,r){return f.style._importedAsBasemap?"basemap":r.scope}function wd(f,r,c,p,y,b,w,S,P,k){const L=f.transform,V=!!r.isGeometryBloom&&r.isGeometryBloom;if(V&&f.renderPass==="shadow")return;const B=L.projection.name==="globe"?o.eD(c,L):[...c];o.aB(B,B,r.globalMatrix);const U=o.aB([],p,B);if(r.meshes)for(const Z of r.meshes){const W=S.get(Z.material.name);if(W&&W.opacity<=0)continue;if(Z.material.alphaMode!=="BLEND"){w.push({mesh:Z,depth:0,modelIndex:y,worldViewProjection:U,nodeModelMatrix:B,isLightMesh:V,materialOverride:W,modelOpacity:P,modelColor:k});continue}const ne=o.af([],Z.centroid,U);!L.isOrthographic&&ne[2]<=0||b.push({mesh:Z,depth:ne[2],modelIndex:y,worldViewProjection:U,nodeModelMatrix:B,isLightMesh:V,materialOverride:W,modelOpacity:P,modelColor:k})}if(r.children)for(const Z of r.children)wd(f,Z,c,p,y,b,w,S,P,k)}function ul(f,r,c,p){const y=c.shadowRenderer;if(!y)return;const b=y.getShadowPassDepthMode(),w=y.getShadowPassColorMode(),S=y.calculateShadowPassMatrixFromMatrix(r),P=Zv(S);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,b,yn.disabled,w,mn.disabled,P,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,c.transform.zoom,void 0,void 0)}function fw(f,r,c,p,y,b){for(const w of y){const S=Object.assign({},p);S.part=w;const P={type:"Unknown",id:r,properties:S},k={orientation:f.paint.get("model-rotation").evaluate(P,c)};b.set(w,k)}}function pw(f,r,c,p,y,b){for(const w of y){const S=Object.assign({},p);S.part=w;const P={type:"Unknown",id:r,properties:S},k={color:f.paint.get("model-color").evaluate(P,c),colorMix:f.paint.get("model-color-mix-intensity").evaluate(P,c),opacity:f.paint.get("model-opacity").evaluate(P,c),emissionStrength:f.paint.get("model-emissive-strength").evaluate(P,c)};b.set(w,k)}}function mw(f,r,c,p,y){let b=!1;for(const S of p)S.modelOpacity!==1&&(Gg(S,f,r,y[S.modelIndex],yn.disabled,Rn.disabled),b=!0);for(const S of p)Gg(S,f,r,y[S.modelIndex],S.modelOpacity!==1?f.stencilModeFor3D():yn.disabled,f.colorModeForRenderPass());b&&f.resetStencilClippingMasks();const w=Rn.additive;for(const S of c)Gg(S,f,r,y[S.modelIndex],yn.disabled,S.isLightMesh?w:f.colorModeForRenderPass())}function gw(f,r,c){const p=r.updateZoomBasedPaintProperties(),y=function(b,w,S){let P,k,L,V=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&V>0){const B=b.terrain,U=B.findDEMTileFor(S);U&&U.dem?P=o.eF.create(B,S,U):V=0}if(V===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),V===w.validForExaggeration&&(V===0||P&&P._demTile&&P._demTile.tileID===w.validForDEMTile.id&&P._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(const B in w.instancesPerModel){const U=w.instancesPerModel[B];for(let Z=0;Z<U.instancedDataArray.length;++Z){const W=(P?V*P.getElevationAt(0|U.instancedDataArray.float32[16*Z],0|U.instancedDataArray.float32[16*Z+1],!0,!0):0)+U.instancesEvaluatedElevation[Z];U.instancedDataArray.float32[16*Z+6]=W,k=k?Math.min(w.terrainElevationMin,W):W,L=L?Math.max(w.terrainElevationMax,W):W}}return w.terrainElevationMin=k||0,w.terrainElevationMax=L||0,w.validForExaggeration=V,w.validForDEMTile=P&&P._demTile?{id:P._demTile.tileID,timestamp:P._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,r,c);(p||y)&&(r.uploaded=!1,r.upload(f.context))}const jl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.d9([0,0,0],[o.al,o.al,0])};function xo(f,r){const c=1<<f.canonical.z,p=r.getFreeCameraOptions().position,y=r.elevation,b=f.canonical.x/c,w=(f.canonical.x+1)/c,S=f.canonical.y/c,P=(f.canonical.y+1)/c;let k=r._centerAltitude;if(y){const U=y.getMinMaxForTile(f);U&&U.max>k&&(k=U.max)}const L=o.aA(p.x,b,w)-p.x,V=o.aA(p.y,S,P)-p.y,B=o.cf(k,r.center.lat)-p.z;return r._zoomFromMercatorZ(Math.sqrt(L*L+V*V+B*B))}function _w(f,r,c,p,y,b,w){const S=f.context,P=f.renderPass==="shadow",k=f.shadowRenderer,L=P&&k?k.getShadowPassDepthMode():new Xt(S.gl.LEQUAL,Xt.ReadWrite,f.depthRangeFor3D),V=f.isTileAffectedByFog(b),B=f.transform.projection.name==="globe";if(c.meshes)for(const U of c.meshes){const Z=B?[]:["MODEL_POSITION_ON_GPU"],W=[];let ne,te,le;const he=!B&&p.instancedDataArray.length>20;he&&Z.push("INSTANCED_ARRAYS");const ce=pu(f,r.paint.get("model-cutoff-fade-range"));if(ce.shouldRenderCutoff&&Z.push("RENDER_CUTOFF"),P&&k)ne=f.getOrCreateProgram("modelDepth",{defines:Z}),te=Zv(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(c.globalMatrix)),le=k.getShadowPassColorMode();else{$g(Z,W,U,f,r.paint.get("model-color-use-theme").constantOr("default")==="none"?null:r.lut),ne=f.getOrCreateProgram("model",{defines:Z,overrideFog:V});const ye=U.material,we=ye.pbrMetallicRoughness,_e=r.paint.get("model-opacity").constantOr(1),pe=r.paint.get("model-emissive-strength").constantOr(0);te=gd(b.expandedProjMatrix,Float32Array.from(c.globalMatrix),new Float32Array(16),null,f,_e,we.baseColorFactor,ye.emissiveFactor,we.metallicFactor,we.roughnessFactor,ye,pe,r,y),k&&(w.shadowUniformsInitialized?ne.setShadowUniformValues(S,k.getShadowUniformValues()):(k.setupShadows(b.toUnwrapped(),ne,"model-tile"),w.shadowUniformsInitialized=!0)),le=ce.shouldRenderCutoff||_e<1||ye.alphaMode!=="OPAQUE"?Rn.alphaBlended:Rn.unblended}f.uploadCommonUniforms(S,ne,b.toUnwrapped(),null,ce);const Ee=U.material.doubleSided?mn.disabled:mn.backCCW;if(he)W.push(p.instancedDataBuffer),ne.draw(f,S.gl.TRIANGLES,L,yn.disabled,le,Ee,te,r.id,U.vertexBuffer,U.indexBuffer,U.segments,r.paint,f.transform.zoom,void 0,W,p.instancedDataArray.length);else{const ye=P?"u_instance":"u_normal_matrix";for(let we=0;we<p.instancedDataArray.length;++we)te[ye]=new Float32Array(p.instancedDataArray.arrayBuffer,64*we,16),ne.draw(f,S.gl.TRIANGLES,L,yn.disabled,le,Ee,te,r.id,U.vertexBuffer,U.indexBuffer,U.segments,r.paint,f.transform.zoom,void 0,W)}}if(c.children)for(const U of c.children)_w(f,r,U,p,y,b,w)}const Rp=[1,-1,1];function LI(f,r,c,p){if(!c.modelManager)return!0;const y=c.modelManager;if(!c.shadowRenderer)return!0;const b=c.shadowRenderer,w=r.aabb;let S=!0,P=f.maxHeight;if(P===0){let L=0;for(const V in f.instancesPerModel){const B=y.getModel(V,p);B?L=Math.max(L,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):S=!1}P=f.maxScale*L*1.41+f.maxVerticalOffset,S&&(f.maxHeight=P)}w.max[2]=P,w.min[2]+=f.terrainElevationMin,w.max[2]+=f.terrainElevationMax,o.af(w.min,w.min,r.tileMatrix),o.af(w.max,w.max,r.tileMatrix);const k=w.intersects(b.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=k===2),k===0}function nr(f,r){const c=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],y=f.uniformValues.u_cutoff_params[2],b=f.uniformValues.u_cutoff_params[3];return p===c||b===y?1:o.aA(((r-c)/(p-c)-y)/(b-y),0,1)}function Gn(f,r,c,p){if(r.pitch<20)return 1;const y=r.getWorldToCameraMatrix();o.aB(y,y,f);const b=o.bU(c.min[0],c.min[1],c.min[2],1);let w=o.aC(o.eG(),b,y),S=w,P=w;b[1]=c.max[1],w=o.aC(o.eG(),b,y),S=w[1]<S[1]?w:S,P=w[1]>P[1]?w:P,b[0]=c.max[0],w=o.aC(o.eG(),b,y),S=w[1]<S[1]?w:S,P=w[1]>P[1]?w:P,b[1]=c.min[1],w=o.aC(o.eG(),b,y),S=w[1]<S[1]?w:S,P=w[1]>P[1]?w:P;const k=o.aA(p[0],0,1),L=100*r.pixelsPerMeter*o.aA(p[1],0,1),V=o.aA(p[2],0,1),B=o.eH(o.eG(),S,P,k),U=Math.tan(.5*r.fovX),Z=-B[2]*U;if(L===0)return B[1]<-Math.abs(Z)?V:1;const W=(-Math.abs(Z)-B[1])/L,ne=(le,he,ce)=>(1-ce)*le+ce*he,te=o.aA(ne(1,V,W),V,1);return ne(1,te,o.aA((r.pitch-20)/20,0,1))}class yw{}class Eu{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,c,p){{const V=this._storage.get(c.id);if(V)return V.lastUsedFrameIdx=r,V.buf}const y=p.gl,b=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),w=new ArrayBuffer(b),S=new Int16Array(w);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));const P=new o.eJ;for(let V=0;V<b/2;V+=3){const B=S[V],U=S[V+1],Z=S[V+2];P.emplaceBack(B,U),P.emplaceBack(U,Z),P.emplaceBack(Z,B)}const k=p.bindVertexArrayOES.current,L=new yw;return L.buf=new cl(p,P),L.lastUsedFrameIdx=r,this._storage.set(c.id,L),p.bindVertexArrayOES.set(k),L.buf}update(r){for(const[c,p]of this._storage)r-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(c))}destroy(){for(const[r,c]of this._storage)c.buf.destroy(),this._storage.delete(r)}}class Eh{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const Sh=o.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class gc{constructor(r){this.revealStart=11,this.revealRange=2}}const ex=o.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class tx{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(r,c){const p=r.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const w=new o.eK,S=new o.b0;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(1,1),w.emplaceBack(-1,1),S.emplaceBack(0,1,2),S.emplaceBack(0,2,3),this.vignetteVx=r.context.createVertexBuffer(w,ex.members),this.vignetteIdx=r.context.createIndexBuffer(S)}const y=o.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){r.uploadCommonUniforms(r.context,p);const w={u_vignetteShape:(b={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};p.draw(r,r.context.gl.TRIANGLES,Xt.disabled,yn.disabled,Rn.alphaBlended,mn.disabled,w,"vignette",this.vignetteVx,this.vignetteIdx,y)}var b}}class nx{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(r,c){const p=r.getFreeCameraOptions().position,y=p.toAltitude(),b=p.toLngLat(),w=o.an(b.lng),S=o.an(b.lat),P=r.pixelsPerMeter/c,k=w*o.eM,L=o.eM*Math.log(Math.tan(Math.PI/4+S/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const V=-this._offsetYPrev+L,B=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+k)*P,this._accumulatedOffsetY+=V*P,this._accumulatedElevation+=B*P,this._offsetXPrev=k,this._offsetYPrev=L,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Hg(f,r){return[-(f[0]-Math.floor(f[0]/r)*r),-(f[1]-Math.floor(f[1]/r)*r),-(f[2]-Math.floor(f[2]/r)*r)]}function oa(f){const r=o.eq(1323123451230),c=[];for(let p=0;p<f;++p){const y=2*r()-1,b=2*r()-1,w=2*r()-1;c.push(o.d5(y,b,w))}return c}function ko(f,r,c,p,y){const b=o.aA((y-c)/(p-c),0,1);return(1-b)*f+b*r}class Td{constructor(r){this._movement=new nx,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new tx,this._ppmScaleFactor=r}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(r,c){const p=r.transform;this._movement.update(p,this._ppmScaleFactor);const y=p.starsProjMatrix,b=o.c7([]);o.c9(b,b,o.an(90)-p._pitch),o.c8(b,b,-p.angle);const w=o.cc(new Float32Array(16),b),S=o.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),P=o.eg([],S),k=o.aB([],P,w),L=Date.now()/1e3;return this._accumulatedTimeFromStart+=(L-this._prevTime)*c,this._prevTime=L,{projectionMatrix:y,modelviewMatrix:k}}}class Wg extends Td{constructor(r){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new gc("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(r){const c=r.context;if(!this.particlesVx){const p=oa(this.particlesCount),y=new o.eN,b=new o.b0;let w=0;const S=o.eq(1323123451230);for(let P=0;P<p.length;++P){const k=p[P],L=[2*S()-1,S(),S(),S()];y.emplaceBack(k[0],k[1],k[2],-1,-1,...L),y.emplaceBack(k[0],k[1],k[2],1,-1,...L),y.emplaceBack(k[0],k[1],k[2],1,1,...L),y.emplaceBack(k[0],k[1],k[2],-1,1,...L),b.emplaceBack(w+0,w+1,w+2),b.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=c.createVertexBuffer(y,Sh.members),this.particlesIdx=c.createIndexBuffer(b)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.rain)return;const c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=r.transform.zoom;if(c.revealStart>p)return;const y=ko(0,1,c.revealStart,c.revealStart+c.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let w=[-b.direction.x,b.direction.y,-100];o.aw(w,w);const S=structuredClone(this._vignetteParams);S.strength*=y,b.overrideStyleParameters||(b.intensity=r.style.rain.state.density,b.timeFactor=r.style.rain.state.intensity,b.color=structuredClone(r.style.rain.state.color),w=structuredClone(r.style.rain.state.direction),b.screenThinning.intensity=r.style.rain.state.centerThinning,b.dropletSizeX=r.style.rain.state.dropletSize[0],b.dropletSizeYScale=r.style.rain.state.dropletSize[1]/r.style.rain.state.dropletSize[0],b.distortionStrength=100*r.style.rain.state.distortionStrength,S.strength=1,S.color=structuredClone(r.style.rain.state.vignetteColor));const P=this.updateOnRender(r,b.timeFactor),k=r.context,L=k.gl,V=r.transform;this.screenTexture&&this.screenTexture.size[0]===r.width&&this.screenTexture.size[1]===r.height||(this.screenTexture=new o.T(k,{width:r.width,height:r.height,data:null},L.RGBA8)),b.distortionStrength>0&&(k.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),L.copyTexSubImage2D(L.TEXTURE_2D,0,0,0,0,0,r.width,r.height));const B=r.getOrCreateProgram("rainParticle");r.uploadCommonUniforms(k,B),k.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const U=[b.color.r,b.color.g,b.color.b,b.color.a],Z=(W,ne)=>{const te=Hg(this._movement.getPosition(),W),le=b.dropletSizeX,he=b.dropletSizeX*b.dropletSizeYScale,ce=r.width/2,Ee=r.height/2,ye=ko(0,b.screenThinning.start,0,1,b.screenThinning.intensity),we=ko(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),_e=ko(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),pe=(Se={modelview:P.modelviewMatrix,projection:P.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:te,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:W,rainDropletSize:[le,he],distortionStrength:b.distortionStrength,rainDirection:w,color:U,screenSize:[V.width,V.height],thinningCenterPos:[ce,Ee],thinningShape:[ye,we,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:_e,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:ne?0:1},{u_modelview:Float32Array.from(Se.modelview),u_projection:Float32Array.from(Se.projection),u_time:Se.time,u_cam_pos:Se.camPos,u_texScreen:0,u_velocityConeAperture:Se.velocityConeAperture,u_velocity:Se.velocity,u_boxSize:Se.boxSize,u_rainDropletSize:Se.rainDropletSize,u_distortionStrength:Se.distortionStrength,u_rainDirection:Se.rainDirection,u_color:Se.color,u_screenSize:Se.screenSize,u_thinningCenterPos:Se.thinningCenterPos,u_thinningShape:Se.thinningShape,u_thinningAffectedRatio:Se.thinningAffectedRatio,u_thinningParticleOffset:Se.thinningParticleOffset,u_shapeDirectionalPower:Se.shapeDirectionalPower,u_shapeNormalPower:Se.shapeNormalPower,u_mode:Se.mode});var Se;const De=Math.round(b.intensity*this.particlesCount),Me=o.bg.simpleSegment(0,0,4*De,2*De);B.draw(r,L.TRIANGLES,Xt.disabled,yn.disabled,Rn.alphaBlended,mn.disabled,pe,"rain_particles",this.particlesVx,this.particlesIdx,Me)};b.distortionStrength>0&&Z(b.boxSize,!0),Z(b.boxSize,!1),this._vignette.draw(r,S)}}const ix=o.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class rx extends Td{constructor(r){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new gc("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(r){const c=r.context;if(!this.particlesVx){const p=oa(this.particlesCount),y=new o.eO,b=new o.b0;let w=0;const S=o.eq(1323123451230);for(let P=0;P<p.length;++P){const k=p[P],L=S(),V=S(),B=S(),U=[P/p.length,L,V,B],Z=[S(),S()];y.emplaceBack(k[0],k[1],k[2],-1,-1,...U,...Z),y.emplaceBack(k[0],k[1],k[2],1,-1,...U,...Z),y.emplaceBack(k[0],k[1],k[2],1,1,...U,...Z),y.emplaceBack(k[0],k[1],k[2],-1,1,...U,...Z),b.emplaceBack(w+0,w+1,w+2),b.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=c.createVertexBuffer(y,ix.members),this.particlesIdx=c.createIndexBuffer(b)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.snow)return;const c=structuredClone(this._params);let p=[-c.direction.x,c.direction.y,-100];o.aw(p,p);const y=structuredClone(this._vignetteParams),b=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},w=r.transform.zoom;if(b.revealStart>w)return;const S=ko(0,1,b.revealStart,b.revealStart+b.revealRange,w);y.strength*=S,c.overrideStyleParameters||(c.intensity=r.style.snow.state.density,c.timeFactor=r.style.snow.state.intensity,c.color=structuredClone(r.style.snow.state.color),p=structuredClone(r.style.snow.state.direction),c.screenThinning.intensity=r.style.snow.state.centerThinning,c.billboardSize=2.79*r.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(r.style.snow.state.vignetteColor));const P=this.updateOnRender(r,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const k=r.context,L=k.gl,V=r.transform,B=r.getOrCreateProgram("snowParticle");r.uploadCommonUniforms(k,B),((U,Z,W)=>{const ne=Hg(this._movement.getPosition(),U),te=V.width/2,le=V.height/2,he=ko(0,W.screenThinning.start,0,1,W.screenThinning.intensity),ce=ko(.001,W.screenThinning.range,0,1,W.screenThinning.intensity),Ee=ko(0,W.screenThinning.particleOffset,0,1,W.screenThinning.intensity),ye=(we={modelview:P.modelviewMatrix,projection:P.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ne,velocityConeAperture:W.velocityConeAperture,velocity:W.velocity,horizontalOscillationRadius:W.horizontalOscillationRadius,horizontalOscillationRate:W.horizontalOscillationRate,boxSize:U,billboardSize:1*W.billboardSize,simpleShapeParameters:[W.shapeFadeStart,W.shapeFadePower],screenSize:[V.width,V.height],thinningCenterPos:[te,le],thinningShape:[he,ce,Math.pow(10,W.screenThinning.fadePower)],thinningAffectedRatio:W.screenThinning.affectedRatio,thinningParticleOffset:Ee,color:[W.color.r,W.color.g,W.color.b,W.color.a],direction:p},{u_modelview:Float32Array.from(we.modelview),u_projection:Float32Array.from(we.projection),u_time:we.time,u_cam_pos:we.camPos,u_velocityConeAperture:we.velocityConeAperture,u_velocity:we.velocity,u_horizontalOscillationRadius:we.horizontalOscillationRadius,u_horizontalOscillationRate:we.horizontalOscillationRate,u_boxSize:we.boxSize,u_billboardSize:we.billboardSize,u_simpleShapeParameters:we.simpleShapeParameters,u_screenSize:we.screenSize,u_thinningCenterPos:we.thinningCenterPos,u_thinningShape:we.thinningShape,u_thinningAffectedRatio:we.thinningAffectedRatio,u_thinningParticleOffset:we.thinningParticleOffset,u_particleColor:we.color,u_direction:we.direction});var we;const _e=Math.round(W.intensity*this.particlesCount),pe=o.bg.simpleSegment(0,0,4*_e,2*_e);this.particlesVx&&this.particlesIdx&&B.draw(r,L.TRIANGLES,Xt.disabled,yn.disabled,Rn.alphaBlended,mn.disabled,ye,"snow_particles",this.particlesVx,this.particlesIdx,pe)})(c.boxSize,0,c),this._vignette.draw(r,y)}}const Su={symbol:function(f,r,c,p,y){if(f.renderPass!=="translucent")return;const b=yn.disabled,w=f.colorModeForRenderPass(),S=c.layout.get("text-variable-anchor"),P=c.layout.get("text-size-scale-range"),k=o.aA(f.scaleFactor,P[0],P[1]);S&&function(B,U,Z,W,ne,te,le,he){const ce=U.transform,Ee=ne==="map",ye=te==="map";for(const we of B){const _e=W.getTile(we),pe=_e.getBucket(Z);if(!pe||!pe.text||!pe.text.segments.get().length)continue;const Se=o.bK(pe.textSizeData,ce.zoom,he),De=kl(we,pe.getProjection(),ce),Me=ce.calculatePixelsToTileUnitsMatrix(_e),He=so(De,_e.tileID.canonical,ye,Ee,ce,pe.getProjection(),Me),We=pe.hasIconTextFit()&&pe.hasIconData();Se&&ln(pe,Ee,ye,le,ce,He,we,Math.pow(2,ce.zoom-_e.tileID.overscaledZ),Se,We)}}(p,f,c,r,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),y,k);const L=c.paint.get("icon-opacity").constantOr(1)!==0,V=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(L||V)?Cp(f,r,c,p,b,w):(L&&Cp(f,r,c,p,b,w,{onlyIcons:!0}),V&&Cp(f,r,c,p,b,w,{onlyText:!0})),r.map.showCollisionBoxes&&(jt(f,r,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),jt(f,r,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,r,c,p){if(f.renderPass!=="translucent")return;const y=c.paint.get("circle-opacity"),b=c.paint.get("circle-stroke-width"),w=c.paint.get("circle-stroke-opacity"),S=c.layout.get("circle-sort-key").constantOr(1)!==void 0,P=c.paint.get("circle-emissive-strength");if(y.constantOr(1)===0&&(b.constantOr(1)===0||w.constantOr(1)===0))return;const k=f.context,L=k.gl,V=f.transform,B=!(!f.terrain||!f.terrain.enabled),U=c.layout.get("circle-elevation-reference"),Z=f.depthModeForSublayer(0,Xt.ReadOnly),W=new Xt(f.context.gl.LEQUAL,Xt.ReadOnly,f.depthRangeFor3D),ne=U==="none"||B?Z:W,te=yn.disabled,le=f.colorModeForDrapableLayerRenderPass(P),he=V.projection.name==="globe",ce=[o.aF(V.center.lng),o.aJ(V.center.lat)],Ee=[];for(let we=0;we<p.length;we++){const _e=p[we],pe=r.getTile(_e),Se=pe.getBucket(c);if(!Se||Se.projection.name!==V.projection.name)continue;const De=Se.programConfigurations.get(c.id),Me=Se.layoutVertexBuffer,He=Se.globeExtVertexBuffer,We=Se.indexBuffer,tt=o.e0(c),gt=[He],Ve=f.isTileAffectedByFog(_e);he&&tt.push("PROJECTION_GLOBE_VIEW"),tt.push("DEPTH_D24"),f.terrain&&V.depthOcclusionForSymbolsAndCircles&&tt.push("DEPTH_OCCLUSION"),Se.hasElevation&&!f.terrain&&(tt.push("ELEVATED_ROADS"),gt.push(Se.elevatedLayoutVertexBuffer));const Pe=f.getOrCreateProgram("circle",{config:De,defines:tt,overrideFog:Ve}),Xe=V.projection.createInversionMatrix(V,_e.canonical),Ue={programConfiguration:De,program:Pe,layoutVertexBuffer:Me,dynamicBuffers:gt,indexBuffer:We,uniformValues:o.e1(f,_e,pe,Xe,ce,c),tile:pe};if(S){const lt=Se.segments.get();for(const St of lt)Ee.push({segments:new o.bg([St]),sortKey:St.sortKey,state:Ue})}else Ee.push({segments:Se.segments,sortKey:0,state:Ue})}S&&Ee.sort((we,_e)=>we.sortKey-_e.sortKey);const ye={useDepthForOcclusion:V.depthOcclusionForSymbolsAndCircles};for(const we of Ee){const{programConfiguration:_e,program:pe,layoutVertexBuffer:Se,dynamicBuffers:De,indexBuffer:Me,uniformValues:He,tile:We}=we.state,tt=we.segments;f.terrain&&f.terrain.setupElevationDraw(We,pe,ye),f.uploadCommonUniforms(k,pe,We.tileID.toUnwrapped()),pe.draw(f,L.TRIANGLES,ne,te,le,mn.disabled,He,c.id,Se,Me,tt,c.paint,V.zoom,_e,De)}},heatmap:function(f,r,c,p){if(c.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const y=f.context,b=y.gl,w=yn.disabled,S=new Rn([b.ONE,b.ONE,b.ONE,b.ONE],o.ao.transparent,[!0,!0,!0,!0]);(function(U,Z,W,ne){const te=U.gl,le=Z.width*ne,he=Z.height*ne;U.activeTexture.set(te.TEXTURE1),U.viewport.set([0,0,le,he]);let ce=W.heatmapFbo;if(!ce||ce&&(ce.width!==le||ce.height!==he)){ce&&ce.destroy();const Ee=te.createTexture();te.bindTexture(te.TEXTURE_2D,Ee),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MAG_FILTER,te.LINEAR),ce=W.heatmapFbo=U.createFramebuffer(le,he,1,null),function(ye,we,_e,pe,Se,De){const Me=ye.gl;Me.texImage2D(Me.TEXTURE_2D,0,ye.extRenderToTextureHalfFloat?Me.RGBA16F:Me.RGBA,Se,De,0,Me.RGBA,ye.extRenderToTextureHalfFloat?Me.HALF_FLOAT:Me.UNSIGNED_BYTE,null),pe.colorAttachment0.set(_e)}(U,0,Ee,ce,le,he)}else te.bindTexture(te.TEXTURE_2D,ce.colorAttachment0.get()),U.bindFramebuffer.set(ce.framebuffer)})(y,f,c,f.transform.projection.name==="globe"?.5:.25),y.clear({color:o.ao.transparent});const P=f.transform,k=P.projection.name==="globe",L=k?["PROJECTION_GLOBE_VIEW"]:[],V=k?mn.frontCCW:mn.disabled,B=[o.aF(P.center.lng),o.aJ(P.center.lat)];for(let U=0;U<p.length;U++){const Z=p[U];if(r.hasRenderableParent(Z))continue;const W=r.getTile(Z),ne=W.getBucket(c);if(!ne||ne.projection.name!==P.projection.name)continue;const te=f.isTileAffectedByFog(Z),le=ne.programConfigurations.get(c.id),he=f.getOrCreateProgram("heatmap",{config:le,defines:L,overrideFog:te}),{zoom:ce}=f.transform;f.terrain&&f.terrain.setupElevationDraw(W,he),f.uploadCommonUniforms(y,he,Z.toUnwrapped());const Ee=P.projection.createInversionMatrix(P,Z.canonical);he.draw(f,b.TRIANGLES,Xt.disabled,w,S,V,Yb(f,Z,W,Ee,B,ce,c.paint.get("heatmap-intensity")),c.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,c.paint,f.transform.zoom,le,k?[ne.globeExtVertexBuffer]:null)}y.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(y,b){const w=y.context,S=w.gl,P=b.heatmapFbo;if(!P)return;w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,P.colorAttachment0.get()),w.activeTexture.set(S.TEXTURE1);let k=b.colorRampTexture;k||(k=b.colorRampTexture=new o.T(w,b.colorRamp,S.RGBA8)),k.bind(S.LINEAR,S.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,S.TRIANGLES,Xt.disabled,yn.disabled,y.colorModeForRenderPass(),mn.disabled,((L,V,B,U)=>({u_image:0,u_color_ramp:1,u_opacity:V.paint.get("heatmap-opacity")}))(0,b),b.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,b.paint,y.transform.zoom)}(f,c))},line:function(f,r,c,p){if(f.renderPass!=="translucent")return;const y=c.paint.get("line-opacity"),b=c.paint.get("line-width");if(y.constantOr(1)===0||b.constantOr(1)===0)return;const w=c.paint.get("line-emissive-strength").isConstant(),S=c.paint.get("line-emissive-strength").constantOr(0),P=c.paint.get("line-occlusion-opacity"),k=c.layout.get("line-elevation-reference"),L=c.layout.get("line-width-unit")==="meters",V=k==="sea",B=!(!f.terrain||!f.terrain.enabled),U=f.context,Z=U.gl;if(c.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const W=c.layout.get("line-cross-slope"),ne=W!==void 0,te=W<1,le=f.colorModeForDrapableLayerRenderPass(w?S:null),he=f.terrain&&f.terrain.renderingToTexture,ce=he?1:o.o.devicePixelRatio,Ee=c.paint.get("line-dasharray"),ye=Ee.constantOr(1),we=c.layout.get("line-cap"),_e=Ee.constantOr(null),pe=we.constantOr(null),Se=c.paint.get("line-pattern"),De=Se.constantOr(1),Me=c.paint.get("line-pattern-cross-fade"),He=Se.constantOr(null),We=c.paint.get("line-opacity").constantOr(1);let tt=!De&&We!==1||f.depthOcclusion&&P>0&&P<1;const gt=c.paint.get("line-gradient"),Ve=De?"linePattern":"line",Pe=o.e2(c);let Xe;if(he&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(tt=!1),P!==0&&f.depthOcclusion){const Dt=c.paint._values["line-opacity"];Dt&&Dt.value&&Dt.value.kind==="constant"?Xe=Dt.value:o.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&Pe.push("VARIABLE_LINE_WIDTH"),he&&(f.emissiveMode!=="dual-source-blending"||w?f.emissiveMode==="mrt-fallback"&&Pe.push("USE_MRT1"):Pe.push("DUAL_SOURCE_BLENDING"));const Ue=(Dt,bt,_t,Gt,Bt,Mt)=>{for(const Lt of Dt){const on=r.getTile(Lt);if(De&&!on.patternsLoaded())continue;const Sn=on.getBucket(c);if(!Sn||Sn.elevationType!=="none"&&!Bt||Sn.elevationType==="none"&&Bt)continue;f.prepareDrawTile();const Zn=[...bt],fi=f.shadowRenderer,Ht=Sn.elevationType==="road"&&!!fi&&fi.enabled;let ui=[0,0,0];if(Ht){const Nn=f.style.directionalLight,Xi=f.style.ambientLight;Nn&&Xi&&(ui=uc(f.style,Nn,Xi)),Zn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Tn=Sn.programConfigurations.get(c.id);let _i=!1;if(He&&on.imageAtlas){const Nn=o.e3.from(He),Xi=Nn.getPrimary().scaleSelf(ce).toString(),Ar=on.imageAtlas.patternPositions.get(Xi),hr=Nn.getSecondary(),Fi=hr?on.imageAtlas.patternPositions.get(hr.scaleSelf(ce).toString()):null;_i=!!Ar&&!!Fi,Ar&&Tn.setConstantPatternPositions(Ar,Fi)}Me>0&&(_i||Tn.getPatternTransitionVertexBuffer("line-pattern"))&&Zn.push("LINE_PATTERN_TRANSITION");const Ri=f.isTileAffectedByFog(Lt),Ci=f.getOrCreateProgram(Ve,{config:Tn,defines:Zn,overrideFog:Ri});if(!De&&_e&&pe&&on.lineAtlas){const Nn=on.lineAtlas.getDash(_e,pe);Nn&&Tn.setConstantPatternPositions(Nn)}Ht&&fi.setupShadows(on.tileID.toUnwrapped(),Ci,"vector-tile");let[ci,Dn]=c.paint.get("line-trim-offset");(pe==="round"||pe==="square")&&ci!==Dn&&(ci===0&&(ci-=1),Dn===1&&(Dn+=1));const mi=he?Lt.projMatrix:null,yr=L?1/Sn.tileToMeter/o.ay(on,1,f.transform.zoom):1,ir=L?1/Sn.tileToMeter/o.ay(on,1,Math.floor(f.transform.zoom)):1,yi=De?o.e4(f,on,c,mi,ce,yr,ir,[ci,Dn],ui,Me):o.e5(f,on,c,mi,Sn.lineClipsArray.length,ce,yr,ir,[ci,Dn],ui);if(gt){const Nn=Sn.gradients[c.id];let Xi=Nn.texture;if(c.gradientVersion!==Nn.version){let Ar=256;if(c.stepInterpolant){const hr=r.getSource().maxzoom,Fi=Lt.canonical.z===hr?Math.ceil(1<<f.transform.maxZoom-Lt.canonical.z):1;Ar=o.aA(o.e6(Sn.maxLineLength/o.al*1024*Fi),256,U.maxTextureSize)}Nn.gradient=o.e7({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Ar,image:Nn.gradient||void 0,clips:Sn.lineClipsArray}),Nn.texture?Nn.texture.update(Nn.gradient):Nn.texture=new o.T(U,Nn.gradient,Z.RGBA8),Nn.version=c.gradientVersion,Xi=Nn.texture}U.activeTexture.set(Z.TEXTURE1),Xi.bind(c.stepInterpolant?Z.NEAREST:Z.LINEAR,Z.CLAMP_TO_EDGE)}ye&&(U.activeTexture.set(Z.TEXTURE0),on.lineAtlasTexture&&on.lineAtlasTexture.bind(Z.LINEAR,Z.REPEAT),Tn.updatePaintBuffers()),De&&(U.activeTexture.set(Z.TEXTURE0),on.imageAtlasTexture&&on.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),Tn.updatePaintBuffers()),Bt&&!V&&f.terrain.setupElevationDraw(on,Ci),f.uploadCommonUniforms(U,Ci,Lt.toUnwrapped());const ni=Nn=>{Xe!=null&&(Xe.value=We*P),Ci.draw(f,Z.TRIANGLES,_t,Nn,le,mn.disabled,yi,c.id,Sn.layoutVertexBuffer,Sn.indexBuffer,Sn.segments,c.paint,f.transform.zoom,Tn,[Sn.layoutVertexBuffer2,Sn.patternVertexBuffer,Sn.zOffsetVertexBuffer]),Xe!=null&&(Xe.value=We)};if(tt&&!Bt){const Nn=f.stencilModeForClipping(Lt).ref;Nn===0&&he&&U.clear({stencil:0});const Xi={func:Z.EQUAL,mask:255};yi.u_alpha_discard_threshold=.8,ni(new yn(Xi,Nn,255,Z.KEEP,Z.KEEP,Z.INVERT)),yi.u_alpha_discard_threshold=0,ni(new yn(Xi,Nn,255,Z.KEEP,Z.KEEP,Z.KEEP))}else yi.u_alpha_discard_threshold=tt&&Bt&&Mt?.8:0,ni(Bt?Gt:f.stencilModeForClipping(Lt))}};let lt=f.depthModeForSublayer(0,Xt.ReadOnly);const St=new Xt(f.depthOcclusion?Z.GREATER:Z.LEQUAL,Xt.ReadOnly,f.depthRangeFor3D);if(c.hasNonElevatedBuckets){const Dt=!he&&f.terrain;P!==0&&Dt?o.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):Dt?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):Ue(p,Pe,lt,yn.disabled,!1,!0)}if(c.hasElevatedBuckets){k==="hd-road-markup"?B||(lt=St,Pe.push("ELEVATED_ROADS")):(Pe.push("ELEVATED"),lt=St,ne&&Pe.push(te?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),V&&Pe.push("ELEVATION_REFERENCE_SEA"));const Dt=tt?f.stencilModeFor3D():yn.disabled;f.forceTerrainMode=!0,Ue(p,Pe,lt,Dt,!0,!0),tt&&Ue(p,Pe,lt,Dt,!0,!1),f.forceTerrainMode=!1}tt&&(f.resetStencilClippingMasks(),he&&U.clear({stencil:0})),P===0||f.depthOcclusion||he||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,r,c,p){const y=c.paint.get("fill-color"),b=c.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const w=c.paint.get("fill-emissive-strength"),S=f.colorModeForDrapableLayerRenderPass(w),P=c.paint.get("fill-pattern"),k=f.opaquePassEnabledForLayer()&&!P.constantOr(1)&&y.constantOr(o.ao.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";let L="none";c.layout.get("fill-elevation-reference")!=="none"?L="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&(L="offset");const V=!(!f.terrain||!f.terrain.enabled),B={painter:f,sourceCache:r,layer:c,coords:p,colorMode:S,elevationType:L,terrainEnabled:V,pass:k};if(f.renderPass==="shadow")return void(f.shadowRenderer&&L==="road"&&!V&&function(Z){const{painter:W,sourceCache:ne,layer:te,coords:le}=Z,he=W.context.gl,ce=Z.painter.shadowRenderer;for(const Ee of le){const ye=ne.getTile(Ee),we=ye.getBucket(te);if(!we)continue;const _e=we.elevatedStructures;if(!_e||!_e.shadowCasterSegments||_e.shadowCasterSegments.segments[0].primitiveLength===0)continue;W.prepareDrawTile();const pe=we.bufferData.programConfigurations.get(te.id),Se=W.isTileAffectedByFog(Ee),De=W.getOrCreateProgram("elevatedStructuresDepth",{config:pe,overrideFog:Se}),Me=ce.calculateShadowPassMatrixFromTile(ye.tileID.toUnwrapped());W.uploadCommonUniforms(W.context,De,Ee.toUnwrapped());const He={u_matrix:Me,u_depth_bias:0};De.draw(W,he.TRIANGLES,ce.getShadowPassDepthMode(),yn.disabled,ce.getShadowPassColorMode(),mn.disabled,He,te.id,_e.vertexBuffer,_e.indexBuffer,_e.shadowCasterSegments,te.paint,W.transform.zoom,pe)}}(B));const U=f.emissiveMode==="mrt-fallback";if(L!=="offset"){if(Ng(B,!1,U),L==="road"){const Z=!V&&f.renderPass==="translucent";Z&&Dg(f,r,c,p,"geometry"),Ng(B,!0,U,yn.disabled),Z&&function(W){const{painter:ne,sourceCache:te,layer:le,coords:he,colorMode:ce}=W,Ee=ne.context.gl,ye=W.painter.shadowRenderer,we=!!ye&&ye.enabled,_e=new Xt(ne.context.gl.LEQUAL,Xt.ReadOnly,ne.depthRangeFor3D);let pe=[0,0,0];if(we){const De=ne.style.directionalLight,Me=ne.style.ambientLight;De&&Me&&(pe=uc(ne.style,De,Me))}const Se=De=>{for(const Me of he){const He=te.getTile(Me),We=He.getBucket(le);if(!We)continue;const tt=We.elevatedStructures;if(!tt)continue;let gt,Ve;if(De?(gt=tt.renderableBridgeSegments,Ve=tt.bridgeProgramConfigurations.get(le.id)):(gt=tt.renderableTunnelSegments,Ve=tt.tunnelProgramConfigurations.get(le.id)),!gt||gt.segments[0].primitiveLength===0)continue;Ve.updatePaintBuffers(),ne.prepareDrawTile();const Pe=ne.isTileAffectedByFog(Me),Xe=[];we&&Xe.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Ue=ne.getOrCreateProgram("elevatedStructures",{config:Ve,overrideFog:Pe,defines:Xe}),lt=ne.translatePosMatrix(Me.projMatrix,He,le.paint.get("fill-translate"),le.paint.get("fill-translate-anchor"));we&&ye.setupShadows(He.tileID.toUnwrapped(),Ue,"vector-tile");const St=xu(lt,pe);ne.uploadCommonUniforms(ne.context,Ue,Me.toUnwrapped()),Ue.draw(ne,Ee.TRIANGLES,_e,yn.disabled,ce,mn.backCCW,St,le.id,tt.vertexBuffer,tt.indexBuffer,gt,le.paint,ne.transform.zoom,Ve,[tt.vertexBufferNormal])}};Se(!0),Se(!1)}(B)}}else Ng(B,!1,U,f.stencilModeFor3D())},"fill-extrusion":function(f,r,c,p){const y=c.paint.get("fill-extrusion-opacity"),b=f.context,w=b.gl,S=f.terrain,P=S&&S.renderingToTexture;if(y===0)return;const k=f.emissiveMode==="mrt-fallback",L=f.conflationActive&&f.style.isLayerClipped(c,r.getSource()),V=f.style.order.indexOf(c.fqid);if(L&&function(B,U,Z,W,ne){for(const te of W){const le=U.getTile(te).getBucket(Z);le&&(le.updateReplacement(te,B.replacementSource,ne),le.uploadCentroid(B.context))}}(f,r,c,p,V),S||L)for(const B of p){const U=r.getTile(B).getBucket(c);U&&kI(f.context,r,B,U,c,S,L)}if(f.renderPass==="shadow"&&f.shadowRenderer){const B=f.shadowRenderer;if(S&&y<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ad)return;const U=B.getShadowPassDepthMode(),Z=B.getShadowPassColorMode();Lg(f,r,c,p,U,yn.disabled,Z,L)}else if(f.renderPass==="translucent"){const B=!c.paint.get("fill-extrusion-pattern").constantOr(1),U=c.paint.get("fill-extrusion-color").constantOr(o.ao.white);if(!P&&U.a!==0){const Z=new Xt(f.context.gl.LEQUAL,Xt.ReadWrite,f.depthRangeFor3D);y===1&&B?Lg(f,r,c,p,Z,yn.disabled,Rn.unblended,L):(Lg(f,r,c,p,Z,yn.disabled,Rn.disabled,L),Lg(f,r,c,p,Z,f.stencilModeFor3D(),f.colorModeForRenderPass(),L),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&B&&(!S&&f.transform.projection.name!=="globe"||P)){const Z=c.paint.get("fill-extrusion-opacity"),W=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),ne=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),te=c.paint.get("fill-extrusion-flood-light-intensity"),le=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",he=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(le?null:c.lut).toArray01().slice(0,3),ce=W>0&&ne>0,Ee=te>0,ye=(pe,Se,De)=>(1-De)*pe+De*Se,we=new Yv;we.translate=c.paint.get("fill-extrusion-translate"),we.translateAnchor=c.paint.get("fill-extrusion-translate-anchor"),we.edgeRadius=c.layout.get("fill-extrusion-edge-radius"),we.cutoffFadeRange=c.paint.get("fill-extrusion-cutoff-fade-range");const _e=pe=>{const Se=f.depthModeForSublayer(1,Xt.ReadOnly,w.LEQUAL,!0),De=c.paint.get(pe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Me=ye(.1,3,De),He=f._showOverdrawInspector;if(!He){const We=new yn({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),tt=new Rn([w.ONE,w.ONE,w.ONE,w.ONE],o.ao.transparent,[!1,!1,!1,!0],w.MIN);fc(we,f,r,c,p,Se,We,tt,mn.disabled,pe,"sdf",Z,W,ne,te,he,Me,L,!1)}{const We=He?yn.disabled:new yn({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),tt=He?f.colorModeForRenderPass():new Rn([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],o.ao.transparent,[!0,!0,!0,!0]);fc(we,f,r,c,p,Se,We,tt,mn.disabled,pe,"color",Z,W,ne,te,he,Me,L,!1)}};if(P){const pe=()=>{const De=S.drapeBufferSize[0],Me=S.drapeBufferSize[1];let He=S.framebufferCopyTexture;return He&&(!He||He.size[0]===De&&He.size[1]===Me)||(He&&He.destroy(),He=S.framebufferCopyTexture=new o.T(b,new o.q({width:De,height:Me}),w.RGBA8)),He.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexSubImage2D(w.TEXTURE_2D,0,0,0,0,0,De,Me),He},Se=(De,Me,He)=>{const We=f.depthModeForSublayer(1,Xt.ReadOnly,w.LEQUAL,!1),tt=c.paint.get(De?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),gt=ye(.1,3,tt);{const Ve=new Rn([w.ONE,w.ONE,w.ONE,w.ONE],o.ao.transparent,[!1,!1,!1,!0]);fc(we,f,r,c,p,We,yn.disabled,Ve,mn.disabled,De,"clear",Z,W,ne,te,he,gt,L,Me)}{const Ve=new yn({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),Pe=new Rn([w.ONE,w.ONE,w.ONE,w.ONE],o.ao.transparent,[!1,!1,!1,!0],w.MIN);fc(we,f,r,c,p,We,Ve,Pe,mn.disabled,De,"sdf",Z,W,ne,te,he,gt,L,Me)}k&&!De&&(He=pe());{const Ve=De?w.ZERO:w.ONE_MINUS_DST_ALPHA,Pe=new yn({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),Xe=new Rn([Ve,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],o.ao.transparent,[!0,!0,!0,!0]);fc(we,f,r,c,p,We,Pe,Xe,mn.disabled,De,"color",Z,W,ne,te,he,gt,L,Me)}if(!k||De){const Ve=new Rn([w.ONE,w.ONE,w.ONE,De?w.ZERO:w.ONE],o.ao.transparent,[!1,!1,!1,!0],De?w.FUNC_ADD:w.MAX);fc(we,f,r,c,p,We,yn.disabled,Ve,mn.disabled,De,"clear",Z,W,ne,te,he,gt,L,Me,He)}else{w.drawBuffers([w.NONE,w.COLOR_ATTACHMENT1]);const Ve=new yn({func:w.EQUAL,mask:255},254,255,w.KEEP,w.DECR,w.DECR),Pe=new Rn([w.ONE,w.ONE,w.ONE,w.ONE],o.ao.transparent,[!0,!1,!1,!1],w.MAX);fc(we,f,r,c,p,We,Ve,Pe,mn.disabled,De,"emissive",Z,W,ne,te,he,gt,L,Me,He),w.drawBuffers([w.COLOR_ATTACHMENT0])}};if(ce||Ee){let De;f.prepareDrawTile(),k&&!ce||(De=pe()),ce&&Se(!0,!1,De),Ee&&Se(!1,!0,De)}}else ce&&_e(!0),Ee&&_e(!1),(ce||Ee)&&f.resetStencilClippingMasks()}}},building:function(f,r,c,p){f.currentLayer<f.firstLightBeamLayer&&(f.firstLightBeamLayer=f.currentLayer);const y=c.paint.get("building-ambient-occlusion-ground-intensity"),b=c.paint.get("building-ambient-occlusion-ground-radius"),w=c.paint.get("building-ambient-occlusion-ground-attenuation"),S=c.paint.get("building-opacity");if(S<=0)return;let P=y>0&&b>0,k=!0;const L=c.paint.get("building-vertical-scale");if(L<=0)return;f.shadowRenderer||(k=!1);const V=f.conflationActive&&f.style.isLayerClipped(c,r.getSource()),B=f.style.order.indexOf(c.fqid);if(function(U,Z,W,ne,te,le){for(const he of le){const ce=Z.getTile(he).getBucket(W);ce&&(te&&ce.updateReplacement(he,U.replacementSource,ne),ce.uploadUpdatedIndexBuffer(U.context))}}(f,r,c,B,V,p),function(U,Z,W,ne){for(const te of ne){const le=Z.getTile(te).getBucket(W);le&&le.needsEvaluation()&&le.uploadUpdatedColorBuffer(U.context)}}(f,r,c,p),c.resetLayerRenderingStats(f),f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0),f.renderPass==="shadow"&&f.shadowRenderer){const U=f.shadowRenderer,Z=[],W=U.getShadowPassDepthMode();Ip({painter:f,source:r,layer:c,coords:p,defines:Z,blendMode:U.getShadowPassColorMode(),depthMode:W,opacity:S,verticalScale:L,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(f.renderPass==="translucent"){let U=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];k&&(U=U.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),f.shadowRenderer&&f.shadowRenderer.useNormalOffset&&(U=U.concat("NORMAL_OFFSET"));const Z=c.paint.get("building-facade-emissive-chance"),W=c.paint.get("building-ambient-occlusion-intensity"),ne=c.paint.get("building-flood-light-intensity"),te=c.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",le=c.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(te?null:c.lut).toArray01().slice(0,3),he=c.paint.get("building-flood-light-ground-attenuation"),ce=ne>0,Ee=new Xt(f.context.gl.LEQUAL,Xt.ReadWrite,f.depthRangeFor3D);S<1&&Ip({painter:f,source:r,layer:c,coords:p,defines:U,blendMode:Rn.disabled,depthMode:Ee,opacity:S,verticalScale:L,facadeEmissiveChance:Z,facadeAOIntensity:W,floodLightIntensity:ne,floodLightColor:le,depthOnly:!0});const ye=f.colorModeForRenderPass();Ip({painter:f,source:r,layer:c,coords:p,defines:U,blendMode:ye,depthMode:Ee,opacity:S,verticalScale:L,facadeEmissiveChance:Z,facadeAOIntensity:W,floodLightIntensity:ne,floodLightColor:le}),P&&Og(f,r,c,p,!0,S,y,b,ne,le,w,V),ce&&Og(f,r,c,p,!1,S,y,b,ne,le,he,V)}else if(f.renderPass==="light-beam"){const U=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],Z=new Xt(f.context.gl.LEQUAL,Xt.ReadOnly,f.depthRangeFor3D);Ip({painter:f,source:r,layer:c,coords:p,defines:U,blendMode:Rn.alphaBlended,depthMode:Z,opacity:S,verticalScale:L,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1),f.resetStencilClippingMasks()},hillshade:function(f,r,c,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const y=f.context,b=f.terrain&&f.terrain.renderingToTexture,[w,S]=f.renderPass!=="translucent"||b?[{},p]:f.stencilConfigForOverlap(p);for(const P of S){const k=r.getTile(P);if(k.needsHillshadePrepare&&f.renderPass==="offscreen")wI(f,k,c);else if(f.renderPass==="translucent"){const L=f.depthModeForSublayer(0,Xt.ReadOnly),V=c.paint.get("hillshade-emissive-strength"),B=f.colorModeForDrapableLayerRenderPass(V),U=b&&f.terrain?f.terrain.stencilModeForRTTOverlap(P):w[P.overscaledZ];bI(f,P,k,c,L,U,B)}}y.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,r,c,p,y,b){if(f.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const w=f.transform.projection.name==="globe",S=c.paint.get("raster-elevation")!==0,P=S&&w;if(f.renderElevatedRasterBackface&&!P)return;const k=f.context,L=k.gl,V=r.getSource(),B=function(ye,we,_e,pe,Se){const De=we.paint.get("raster-color"),Me=ye.type==="raster-array",He=[],We=we.paint.get("raster-resampling"),tt=we.paint.get("raster-color-mix");let gt=we.paint.get("raster-color-range");const Ve=[tt[0],tt[1],tt[2],0],Pe=tt[3];let Xe=We==="nearest"?pe.NEAREST:pe.LINEAR;if(Me&&(He.push("RASTER_ARRAY"),De||He.push("RASTER_COLOR"),We==="linear"&&He.push("RASTER_ARRAY_LINEAR"),Xe=pe.NEAREST,!gt&&ye.rasterLayers)){const Ue=ye.rasterLayers.find(({id:lt})=>lt===we.sourceLayer);Ue&&Ue.fields&&Ue.fields.range&&(gt=Ue.fields.range)}if(gt=gt||[0,1],De){He.push("RASTER_COLOR"),_e.activeTexture.set(pe.TEXTURE2),we.updateColorRamp(gt);let Ue=we.colorRampTexture;Ue||(Ue=we.colorRampTexture=new o.T(_e,we.colorRamp,pe.RGBA8)),Ue.bind(pe.LINEAR,pe.CLAMP_TO_EDGE)}return Se&&He.push("USE_MRT1"),{mix:Ve,range:gt,offset:Pe,defines:He,resampling:Xe}}(V,c,k,L,f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback");if(V instanceof o.aU&&!p.length&&!w)return;const U=c.paint.get("raster-emissive-strength"),Z=f.colorModeForDrapableLayerRenderPass(U),W=f.terrain&&f.terrain.renderingToTexture,ne=!f.options.moving,te=c.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(V instanceof o.aU&&!p.length&&(V.onNorthPole||V.onSouthPole)){const ye=S?f.stencilModeFor3D():yn.disabled;return void Ap(!!V.onNorthPole,null,f,r,c,U,B,mn.disabled,ye)}if(!p.length)return;const[le,he]=V instanceof o.aU||W?[{},p]:f.stencilConfigForOverlap(p),ce=he[he.length-1].overscaledZ;P&&B.defines.push("PROJECTION_GLOBE_VIEW"),S&&B.defines.push("RENDER_CUTOFF");const Ee=(ye,we,_e)=>{for(const pe of ye){const Se=pe.toUnwrapped(),De=r.getTile(pe);if(W&&(!De||!De.hasData()))continue;k.activeTexture.set(L.TEXTURE0);const Me=mc(De,V,c,B);if(!Me||!Me.texture)continue;const{texture:He,mix:We,offset:tt,tileSize:gt,buffer:Ve}=Me;let Pe,Xe;W?(Pe=Xt.disabled,Xe=pe.projMatrix):S?(Pe=new Xt(L.LEQUAL,Xt.ReadWrite,f.depthRangeFor3D),Xe=w?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(Se,ne)):(Pe=f.depthModeForSublayer(pe.overscaledZ-ce,c.paint.get("raster-opacity")===1?Xt.ReadWrite:Xt.ReadOnly,L.LESS),Xe=f.transform.calculateProjMatrix(Se,ne));const Ue=f.terrain&&W?f.terrain.stencilModeForRTTOverlap(pe):le[pe.overscaledZ],lt=b?0:c.paint.get("raster-fade-duration");De.registerFadeDuration(lt);const St=r.findLoadedParent(pe,0),Dt=wp(De,St,r,f.transform,lt);let bt,_t;!Dt.isFading&&De.refreshedUponExpiration&&(De.refreshedUponExpiration=!1),f.terrain&&f.terrain.prepareDrawTile(),k.activeTexture.set(L.TEXTURE0),He.bind(te,L.CLAMP_TO_EDGE),k.activeTexture.set(L.TEXTURE1),St?(St.texture&&St.texture.bind(te,L.CLAMP_TO_EDGE),bt=Math.pow(2,St.tileID.overscaledZ-De.tileID.overscaledZ),_t=[De.tileID.canonical.x*bt%1,De.tileID.canonical.y*bt%1]):He.bind(te,L.CLAMP_TO_EDGE),"useMipmap"in He&&k.extTextureFilterAnisotropic&&f.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);const Gt=f.transform;let Bt;const Mt=S?sw(Gt):[0,0,0,0];let Lt,on,Sn,Zn,fi,Ht=0;if(P&&V instanceof o.aU&&V.coordinates.length>3)Lt=Float32Array.from(o.bk(o.dJ(new o.cD(0,0,0)))),on=Float32Array.from(Gt.globeMatrix),Sn=Float32Array.from(o.dF(Gt)),Zn=[o.aF(Gt.center.lng),o.aJ(Gt.center.lat)],Bt=V.elevatedGlobePerspectiveTransform,fi=V.elevatedGlobeGridMatrix||new Float32Array(9);else if(P){const Ri=o.dG(pe.canonical);Ht=o.dH(Ri.getCenter().lat),Lt=Float32Array.from(o.bk(o.dJ(pe.canonical))),on=Float32Array.from(Gt.globeMatrix),Sn=Float32Array.from(o.dF(Gt)),Zn=[o.aF(Gt.center.lng),o.aJ(Gt.center.lat)],Bt=[0,0],fi=Float32Array.from(o.dI(pe.canonical,Ri,Ht,Gt.worldSize/Gt._pixelsPerMercatorPixel))}else Bt=V instanceof o.aU?V.perspectiveTransform:[0,0],Lt=new Float32Array(16),on=new Float32Array(9),Sn=new Float32Array(16),Zn=[0,0],fi=new Float32Array(9);const ui=Qb(Xe,Lt,on,Sn,fi,_t||[0,0],o.aj(f.transform.zoom),Zn,Mt,bt||1,Dt,c,Bt,S?c.paint.get("raster-elevation"):0,2,We,tt,B.range,gt,Ve,U),Tn=f.isTileAffectedByFog(pe),_i=f.getOrCreateProgram("raster",{defines:B.defines,overrideFog:Tn});if(f.uploadCommonUniforms(k,_i,Se),V instanceof o.aU){const Ri=V.elevatedGlobeVertexBuffer,Ci=V.elevatedGlobeIndexBuffer;if(W||!w)V.boundsBuffer&&V.boundsSegments&&_i.draw(f,L.TRIANGLES,Pe,yn.disabled,Z,mn.disabled,ui,c.id,V.boundsBuffer,f.quadTriangleIndexBuffer,V.boundsSegments);else if(Ri&&Ci){const ci=Gt.zoom<=o.c_?V.elevatedGlobeSegments:V.getSegmentsForLongitude(Gt.center.lng);ci&&_i.draw(f,L.TRIANGLES,Pe,yn.disabled,Z,we,ui,c.id,Ri,Ci,ci)}}else if(P){Pe=new Xt(L.LEQUAL,Xt.ReadOnly,f.depthRangeFor3D);const Ri=f.globeSharedBuffers;if(Ri){const[Ci,ci,Dn]=Ri.getGridBuffers(Ht,!1);_i.draw(f,L.TRIANGLES,Pe,_e||Ue,f.colorModeForRenderPass(),we,ui,c.id,Ci,ci,Dn)}}else{const{tileBoundsBuffer:Ri,tileBoundsIndexBuffer:Ci,tileBoundsSegments:ci}=f.getTileBoundsBuffers(De);_i.draw(f,L.TRIANGLES,Pe,Ue,Z,mn.disabled,ui,c.id,Ri,Ci,ci)}}if(!(V instanceof o.aU)&&P)for(const pe of ye){const Se=pe.canonical.y===(1<<pe.canonical.z)-1;pe.canonical.y===0&&Ap(!0,pe,f,r,c,U,B,we,_e||yn.disabled),Se&&Ap(!1,pe,f,r,c,U,B,we===mn.frontCW?mn.backCW:mn.frontCW,_e||yn.disabled)}};P?Ee(he,f.renderElevatedRasterBackface?mn.backCW:mn.frontCW,f.stencilModeFor3D()):Ee(he,mn.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,r,c,p,y,b){f.renderPass==="offscreen"&&function(w,S,P,k){if(!k.length)return;const L=w.context,V=L.gl,B=S.getSource();if(!(B instanceof ro))return;const U=Math.ceil(Math.sqrt(P.paint.get("raster-particle-count")));let Z=P.particlePositionRGBAImage;if(!Z||Z.width!==U){const he=function(ce){const Ee=ce*ce,ye=new Uint8Array(4*Ee),we=function(pe){return pe|=0,pe=Math.imul(2747636419^pe,2654435769),pe=Math.imul(pe^pe>>>16,2654435769),((pe=Math.imul(pe^pe>>>16,2654435769))>>>0)/4294967296},_e=1/1.1;for(let pe=0;pe<Ee;pe++){const Se=_e*(we(2*pe+0)+Fl),De=_e*(we(2*pe+1)+Fl),Me=255*Se%1,He=255*De%1,We=Me,tt=De-He/255,gt=He;ye[4*pe+0]=255*(Se-Me/255),ye[4*pe+1]=255*We,ye[4*pe+2]=255*tt,ye[4*pe+3]=255*gt}return ye}(U);Z=P.particlePositionRGBAImage=new o.q({width:U,height:U},he)}let W=P.particleFramebuffer;W?W.width!==U&&(W.destroy(),W=P.particleFramebuffer=L.createFramebuffer(U,U,1,null)):W=P.particleFramebuffer=L.createFramebuffer(U,U,1,null);const ne=[];for(const he of k){const ce=S.getTile(he);if(!(ce instanceof Xm))continue;const Ee=Jv(ce,B,P);if(!Ee)continue;const ye=[ce.tileSize,ce.tileSize];let we=P.tileFramebuffer;we||(we=P.tileFramebuffer=L.createFramebuffer(ye[0],ye[1],1,null));let _e=ce.rasterParticleState;_e||(_e=ce.rasterParticleState=new zg(L,he,ye,Z));const pe=_e.update(P.lastInvalidatedAt);_e.particleTextureDimension!==U&&_e.updateParticleTexture(he,Z);const Se=_e.targetColorTexture;_e.targetColorTexture=_e.backgroundColorTexture,_e.backgroundColorTexture=Se;const De=_e.particleTexture0;_e.particleTexture0=_e.particleTexture1,_e.particleTexture1=De,ne.push([he,Ee,_e,pe])}if(ne.length===0)return;const te=o.o.now(),le=P.previousDrawTimestamp?.001*(te-P.previousDrawTimestamp):.0167;if(P.previousDrawTimestamp=te,P.hasColorMap()){L.activeTexture.set(V.TEXTURE0+2);let he=P.colorRampTexture;he||(he=P.colorRampTexture=new o.T(L,P.colorRamp,V.RGBA8)),he.bind(V.LINEAR,V.CLAMP_TO_EDGE)}L.bindFramebuffer.set(P.tileFramebuffer.framebuffer),function(he,ce,Ee){const ye=he.context,we=ye.gl,_e=ce.tileFramebuffer;ye.activeTexture.set(we.TEXTURE0);const pe={u_texture:0,u_opacity:1.05*(De=ce.paint.get("raster-particle-fade-opacity-factor"))/(De+.05)},Se=he.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var De;for(const Me of Ee){const[,,He,We]=Me;_e.colorAttachment0.set(He.targetColorTexture.texture),ye.viewport.set([0,0,_e.width,_e.height]),ye.clear({color:o.ao.transparent}),We&&(He.backgroundColorTexture.bind(we.NEAREST,we.CLAMP_TO_EDGE),Se.draw(he,we.TRIANGLES,Xt.disabled,yn.disabled,Rn.alphaBlended,mn.disabled,pe,ce.id,he.viewportBuffer,he.quadTriangleIndexBuffer,he.viewportSegments))}}(w,P,ne),function(he,ce,Ee,ye){const we=he.context,_e=we.gl,pe=Ee.tileFramebuffer,Se=he.transform.projection.name==="globe",De=Ee.paint.get("raster-particle-max-speed");for(const Me of ye){const[He,We,tt]=Me;we.activeTexture.set(_e.TEXTURE0+0),We.texture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),pe.colorAttachment0.set(tt.targetColorTexture.texture);const gt=he.getOrCreateProgram("rasterParticleDraw",{defines:We.defines,overrideFog:!1});we.activeTexture.set(_e.TEXTURE0+1);const Ve=We.scalarData?[]:[0,1,2,3].map(Ue=>o.e9[Ue](He));Ve.push(He);const Pe=He.canonical.x,Xe=He.canonical.y;for(const Ue of Ve){const lt=ce.getTile(Se?Ue.wrapped():Ue);if(!lt)continue;const St=lt.rasterParticleState;if(!St)continue;const Dt=Ue.canonical.x+(1<<Ue.canonical.z)*(Ue.wrap-He.wrap),bt=Ue.canonical.y;St.particleTexture0.bind(_e.NEAREST,_e.CLAMP_TO_EDGE);const _t=MI(1,St.particleTexture0.size[0],[Dt-Pe,bt-Xe],0,We.texture.size,2,De,We.textureOffset,We.scale,We.offset);gt.draw(he,_e.POINTS,Xt.disabled,yn.disabled,Rn.alphaBlended,mn.disabled,_t,Ee.id,St.particleIndexBuffer,void 0,St.particleSegment)}}}(w,S,P,ne),L.bindFramebuffer.set(P.particleFramebuffer.framebuffer),function(he,ce,Ee,ye){const we=he.context,_e=we.gl,pe=ce.paint.get("raster-particle-max-speed"),Se=ye*ce.paint.get("raster-particle-speed-factor")*.15,De=function(He){return Math.pow(He,6)}(.01+1*ce.paint.get("raster-particle-reset-rate-factor")),Me=ce.particleFramebuffer;we.viewport.set([0,0,Me.width,Me.height]);for(const He of Ee){const[,We,tt]=He;we.activeTexture.set(_e.TEXTURE0+0),We.texture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),we.activeTexture.set(_e.TEXTURE0+1);const gt=tt.particleTexture0;gt.bind(_e.NEAREST,_e.CLAMP_TO_EDGE);const Ve=ew(1,gt.size[0],0,We.texture.size,pe,Se,De,We.textureOffset,We.scale,We.offset);Me.colorAttachment0.set(tt.particleTexture1.texture),we.clear({color:o.ao.transparent}),he.getOrCreateProgram("rasterParticleUpdate",{defines:We.defines}).draw(he,_e.TRIANGLES,Xt.disabled,yn.disabled,Rn.unblended,mn.disabled,Ve,ce.id,he.viewportBuffer,he.quadTriangleIndexBuffer,he.viewportSegments)}}(w,P,ne,le)}(f,r,c,p),f.renderPass==="translucent"&&(function(w,S,P,k,L){const V=w.context,B=V.gl,U=S.getSource().tileSize,Z=5*(1-o.ah(o.cL,o.cL+1,w.transform.zoom))*U+P.paint.get("raster-particle-elevation"),W=!w.options.moving,ne=w.transform.projection.name==="globe";if(!k.length)return;const[te,le]=w.stencilConfigForOverlap(k),he=[];ne&&he.push("PROJECTION_GLOBE_VIEW");const ce=w.stencilModeFor3D();for(const Ee of le){const ye=Ee.toUnwrapped(),we=S.getTile(Ee);if(!we.rasterParticleState)continue;const _e=we.rasterParticleState,pe=100;we.registerFadeDuration(pe);const Se=S.findLoadedParent(Ee,0),De=wp(we,Se,S,w.transform,pe);let Me,He;w.terrain&&w.terrain.prepareDrawTile(),V.activeTexture.set(B.TEXTURE0),_e.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),V.activeTexture.set(B.TEXTURE1),Se&&Se.rasterParticleState?(Se.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Me=Math.pow(2,Se.tileID.overscaledZ-we.tileID.overscaledZ),He=[we.tileID.canonical.x*Me%1,we.tileID.canonical.y*Me%1]):_e.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const We=ne?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(ye,W),tt=w.transform,gt=ow(tt),Ve=o.dG(Ee.canonical),Pe=o.dH(Ve.getCenter().lat);let Xe,Ue,lt,St,Dt;ne?(Xe=Float32Array.from(o.bk(o.dJ(Ee.canonical))),Ue=Float32Array.from(tt.globeMatrix),lt=Float32Array.from(o.dF(tt)),St=[o.aF(tt.center.lng),o.aJ(tt.center.lat)],Dt=Float32Array.from(o.dI(Ee.canonical,Ve,Pe,tt.worldSize/tt._pixelsPerMercatorPixel))):(Xe=new Float32Array(16),Ue=new Float32Array(9),lt=new Float32Array(16),St=[0,0],Dt=new Float32Array(9));const bt=RI(We,Xe,Ue,lt,Dt,He||[0,0],o.aj(w.transform.zoom),St,gt,Me||1,De,Z),_t=w.isTileAffectedByFog(Ee),Gt=w.getOrCreateProgram("rasterParticle",{defines:he,overrideFog:_t});if(w.uploadCommonUniforms(V,Gt,ye),ne){const Bt=new Xt(B.LEQUAL,Xt.ReadOnly,w.depthRangeFor3D),Mt=0,Lt=w.globeSharedBuffers;if(Lt){const[on,Sn,Zn]=Lt.getGridBuffers(Pe,Mt!==0);Gt.draw(w,B.TRIANGLES,Bt,ce,Rn.alphaBlended,w.renderElevatedRasterBackface?mn.frontCCW:mn.backCCW,bt,P.id,on,Sn,Zn)}}else{const Bt=w.depthModeForSublayer(0,Xt.ReadOnly),Mt=te[Ee.overscaledZ],{tileBoundsBuffer:Lt,tileBoundsIndexBuffer:on,tileBoundsSegments:Sn}=w.getTileBoundsBuffers(we);Gt.draw(w,B.TRIANGLES,Bt,Mt,Rn.alphaBlended,mn.disabled,bt,P.id,Lt,on,Sn)}}w.resetStencilClippingMasks()}(f,r,c,p),f.style.map.triggerRepaint())},background:function(f,r,c,p){const y=c.paint.get("background-color"),b=c.paint.get("background-color-use-theme").constantOr("default")==="none",w=c.paint.get("background-opacity"),S=c.paint.get("background-emissive-strength"),P=c.paint.get("background-pitch-alignment")==="viewport";if(w===0)return;const k=f.context,L=k.gl,V=f.transform,B=V.tileSize,U=c.paint.get("background-pattern");let Z;if(U!==void 0&&(U===null||(Z=f.imageManager.getPattern(o.I.from(U.toString()),c.scope,f.style.getLut(c.scope)),!Z)))return;const W=!U&&y.a===1&&w===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==W)return;const ne=yn.disabled,te=f.depthModeForSublayer(0,W==="opaque"?Xt.ReadWrite:Xt.ReadOnly),le=f.colorModeForDrapableLayerRenderPass(S),he=U?"backgroundPattern":"background";let ce,Ee=p;Ee||(ce=f.getBackgroundTiles(),Ee=Object.values(ce).map(we=>we.tileID)),U&&(k.activeTexture.set(L.TEXTURE0),f.imageManager.bind(f.context,c.scope));const ye=[];if(f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&ye.push("USE_MRT1"),P){const we=f.getOrCreateProgram(he,{overrideFog:!1,overrideRtt:!0,defines:ye}),_e=new Float32Array(o.bA([])),pe=new o.aQ(0,0,0,0,0),Se=U?wu(_e,S,w,f,0,c.scope,Z,P,{tileID:pe,tileSize:B}):Ep(_e,S,w,y.toPremultipliedRenderColor(b?null:c.lut));we.draw(f,L.TRIANGLES,te,ne,le,mn.disabled,Se,c.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const we of Ee){const _e=f.isTileAffectedByFog(we),pe=f.getOrCreateProgram(he,{overrideFog:_e,defines:ye}),Se=we.toUnwrapped(),De=p?we.projMatrix:f.transform.calculateProjMatrix(Se);f.prepareDrawTile();const Me=r?r.getTile(we):ce?ce[we.key]:new ld(we,B,V.zoom,f),He=U?wu(De,S,w,f,0,c.scope,Z,P,{tileID:we,tileSize:B}):Ep(De,S,w,y.toPremultipliedRenderColor(b?null:c.lut));f.uploadCommonUniforms(k,pe,Se);const{tileBoundsBuffer:We,tileBoundsIndexBuffer:tt,tileBoundsSegments:gt}=f.getTileBoundsBuffers(Me);pe.draw(f,L.TRIANGLES,te,ne,le,mn.disabled,He,c.id,We,tt,gt)}},sky:function(f,r,c){const p=f._atmosphere?o.aj(f.transform.zoom):1,y=c.paint.get("sky-opacity")*p;if(y===0)return;const b=f.context,w=c.paint.get("sky-type"),S=new Xt(b.gl.LEQUAL,Xt.ReadOnly,[0,1]),P=f.frameCounter/1e3%1;w==="atmosphere"?f.renderPass==="offscreen"?c.needsSkyboxCapture(f)&&(function(k,L,V,B){const U=k.context,Z=U.gl;let W=L.skyboxFbo;if(!W){W=L.skyboxFbo=U.createFramebuffer(32,32,1,null),L.skyboxGeometry=new Bg(U),L.skyboxTexture=U.gl.createTexture(),Z.bindTexture(Z.TEXTURE_CUBE_MAP,L.skyboxTexture),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR);for(let he=0;he<6;++he)Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,Z.RGBA,32,32,0,Z.RGBA,Z.UNSIGNED_BYTE,null)}U.bindFramebuffer.set(W.framebuffer),U.viewport.set([0,0,32,32]);const ne=L.getCenter(k,!0),te=k.getOrCreateProgram("skyboxCapture"),le=new Float64Array(16);o.bA(le),o.en(le,le,.5*-Math.PI),bd(k,L,te,le,ne,0),o.bA(le),o.en(le,le,.5*Math.PI),bd(k,L,te,le,ne,1),o.bA(le),o.cU(le,le,.5*-Math.PI),bd(k,L,te,le,ne,2),o.bA(le),o.cU(le,le,.5*Math.PI),bd(k,L,te,le,ne,3),o.bA(le),bd(k,L,te,le,ne,4),o.bA(le),o.en(le,le,Math.PI),bd(k,L,te,le,ne,5),U.viewport.set([0,0,k.width,k.height])}(f,c),c.markSkyboxValid(f)):f.renderPass==="sky"&&function(k,L,V,B,U){const Z=k.context,W=Z.gl,ne=k.transform,te=k.getOrCreateProgram("skybox");Z.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_CUBE_MAP,L.skyboxTexture);const le=((he,ce,Ee,ye,we)=>({u_matrix:he,u_sun_direction:ce,u_cubemap:0,u_opacity:ye,u_temporal_offset:we}))(ne.skyboxMatrix,L.getCenter(k,!1),0,B,U);k.uploadCommonUniforms(Z,te),te.draw(k,W.TRIANGLES,V,yn.disabled,k.colorModeForRenderPass(),mn.backCW,le,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(f,c,S,y,P):w==="gradient"&&f.renderPass==="sky"&&function(k,L,V,B,U){const Z=k.context,W=Z.gl,ne=k.transform,te=k.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new Bg(Z)),Z.activeTexture.set(W.TEXTURE0);let le=L.colorRampTexture;le||(le=L.colorRampTexture=new o.T(Z,L.colorRamp,W.RGBA8)),le.bind(W.LINEAR,W.CLAMP_TO_EDGE);const he=((ce,Ee,ye,we,_e)=>({u_matrix:ce,u_color_ramp:0,u_center_direction:Ee,u_radius:o.an(ye),u_opacity:we,u_temporal_offset:_e}))(ne.skyboxMatrix,L.getCenter(k,!1),L.paint.get("sky-gradient-radius"),B,U);k.uploadCommonUniforms(Z,te),te.draw(k,W.TRIANGLES,V,yn.disabled,k.colorModeForRenderPass(),mn.backCW,he,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(f,c,S,y,P)},custom:function(f,r,c,p){const y=f.context,b=c.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&c.isDraped(r)){if(f.renderPass==="offscreen"){const w=b.prerender;if(w){if(f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const S=f.transform.pointMerc;w.call(b,y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),o.aj(f.transform.zoom),[S.x,S.y],f.transform.pixelsPerMeterRatio)}else w.call(b,y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const S=b.renderToTile;if(S){const P=p[0].canonical,k={x:P.x+p[0].wrap*(b.wrapTileId?0:1<<P.z),y:P.y,z:P.z};y.setDepthMode(Xt.disabled),y.setStencilMode(yn.disabled),y.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),S.call(b,y.gl,k),y.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),y.setStencilMode(yn.disabled);const w=b.renderingMode==="3d"?new Xt(f.context.gl.LEQUAL,Xt.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Xt.ReadOnly);if(y.setDepthMode(w),f.transform.projection.name==="globe"){const S=f.transform.pointMerc;b.render(y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),o.aj(f.transform.zoom),[S.x,S.y],f.transform.pixelsPerMeterRatio)}else b.render(y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState(),y.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,r,c,p){if(f.renderPass==="opaque")return;const y=c.paint.get("model-opacity").constantOr(1),b=c.paint.get("model-elevation-reference"),w=b==="ground",S=b==="ground";if(y===0)return;const P=c.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!P||f.terrain&&y<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof o.ad))return;const k=f.shadowRenderer,L=c.paint.get("model-receive-shadows");k&&(k.useNormalOffset=!0,L||(k.enabled=!1));const V=()=>{k&&(k.useNormalOffset=!0,L||(k.enabled=!0))},B=r.getSource();if(f.renderPass==="light-beam"&&B.type!=="batched-model")return;if(B.type==="vector"||B.type==="geojson")return function(ce,Ee,ye,we,_e){const pe=ce.transform,Se=pe.projection.name==="globe",De=pe.getFreeCameraOptions().position;if(!ce.modelManager)return;const Me=ce.modelManager;ye.modelManager=Me;const He=ce.shadowRenderer;if(!ye._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const We=ye._unevaluatedLayout._values["model-id"],tt=Object.assign({},ye.layout.get("model-id").parameters),gt=ce.style.order.indexOf(ye.fqid),Ve=ye.paint.get("model-opacity").constantOr(1);for(const Pe of we){const Xe=Ee.getTile(Pe).getBucket(ye);if(!Xe||Xe.projection.name!==pe.projection.name)continue;const Ue=Xe.getModelUris();if(Ue&&!Xe.modelsRequested&&(Me.addModelsFromBucket(Ue,_e),Xe.modelsRequested=!0),Se)tt.zoom=Pe.overscaledZ;else{const Mt=xo(Pe,pe);tt.zoom=Mt}const lt=We.possiblyEvaluate(tt);if(gw(ce,Xe,Pe),jl.shadowUniformsInitialized=!1,jl.useSingleShadowCascade=!!He&&He.getMaxCascadeForTile(Pe.toUnwrapped())===0,ce.renderPass==="shadow"&&He){if(ce.currentShadowCascade===1&&Xe.isInsideFirstShadowMapFrustum)continue;const Mt=pe.calculatePosMatrix(Pe.toUnwrapped(),pe.worldSize);if(jl.tileMatrix.set(Mt),jl.shadowTileMatrix=Float32Array.from(He.calculateShadowPassMatrixFromMatrix(Mt)),jl.aabb.min=[0,0,0],jl.aabb.max[0]=jl.aabb.max[1]=o.al,jl.aabb.max[2]=0,LI(Xe,jl,ce,ye.scope))continue}const St=1<<Pe.canonical.z,Dt=[((De.x-Pe.wrap)*St-Pe.canonical.x)*o.al,(De.y*St-Pe.canonical.y)*o.al,De.z*St*o.al];ce.conflationActive&&Object.keys(Xe.instancesPerModel).length>0&&ce.style.isLayerClipped(ye,Ee.getSource())&&Xe.updateReplacement(Pe,ce.replacementSource,gt,ye.scope)&&(Xe.uploaded=!1,Xe.upload(ce.context));let bt=0;const _t=new Array,Gt=new Array,Bt=new Array;for(let Mt in Xe.instancesPerModel){const Lt=Xe.instancesPerModel[Mt];Lt.features.length>0&&!Se&&(Mt=lt.evaluate(Lt.features[0].feature,{}));const on=Me.getModel(Mt,_e);if(on||Me.hasURLBeenRequested(Mt)||Xe.modelUris.includes(Mt)||(Xe.modelUris.push(Mt),Xe.modelsRequested=!1),on&&on.uploaded)if(Se){const Sn=o.c5([],[De.x,De.y,De.z],ce.transform.worldSize);o.ew(Sn,Sn);for(let Zn=0;Zn<Lt.instancedDataArray.length;++Zn){const fi=[0,0,0],Ht=[1,1,1],ui=o.ex(),Tn=Lt.tileCoordinatesForInstance(Zn),_i=Lt.transformForInstance(Zn);o.ey(Ht,_i),o.ez(ui,_i),o.eA(fi,ui);const Ri=Lt.translationForInstance(Zn),Ci=new o.aT(0,0);o.eB(Xe.canonical,Ci,Tn.x,Tn.y);const ci=o.bC();o.eC(ci,on,ce.transform,Ci,fi,Ht,Ri,!0,!1,!1);const Dn=Lt.colorForInstance(Zn),mi=o.bA([]),yr=o.ef(Ci.lat,ce.transform.zoom),ir=o.bq([],[1,1,1/yr]);o.br(mi,mi,Sn),Bt.push({zScaleMatrix:ir,negCameraPosMatrix:mi});for(const yi of on.nodes)wd(ce,yi,ci,ce.transform.expandedFarZProjMatrix,bt,_t,Gt,on.materialOverrides,Ve,Dn);++bt}}else for(const Sn of on.nodes)_w(ce,ye,Sn,Lt,Dt,Pe,jl)}if(Se)if(ce.renderPass==="shadow"){for(const Mt of Gt)ul(Mt.mesh,Mt.nodeModelMatrix,ce,ye);for(const Mt of _t)ul(Mt.mesh,Mt.nodeModelMatrix,ce,ye)}else mw(ce,ye,_t,Gt,Bt)}}(f,r,c,p,Pp(f,c)),void V();if(!B.loaded())return;if(B.type==="batched-model")return function(ce,Ee,ye,we){ye.resetLayerRenderingStats(ce);const _e=ce.context,pe=ce.transform,Se=ce.style.fog,De=ce.shadowRenderer;if(pe.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${pe.projection.name} projection is not yet implemented`);const Me=ce.transform.getFreeCameraOptions().position,He=o.c5([],[Me.x,Me.y,Me.z],ce.transform.worldSize),We=o.ew([],He),tt=o.bA([]),gt=o.ef(pe.center.lat,pe.zoom),Ve=o.bq([],[1,1,1/gt]);o.br(tt,tt,We);const Pe=ye.paint.get("model-opacity").constantOr(1),Xe=new Xt(_e.gl.LEQUAL,Xt.ReadWrite,ce.depthRangeFor3D),Ue=new Xt(_e.gl.LEQUAL,Xt.ReadOnly,ce.depthRangeFor3D),lt=new o.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),St=ce.renderPass==="shadow",Dt=St&&De?De.getCurrentCascadeFrustum():pe.getFrustum(pe.scaleZoom(pe.worldSize)),bt=ye.paint.get("model-front-cutoff"),_t=bt[2]<1,Gt=pu(ce,ye.paint.get("model-cutoff-fade-range")),Bt=ye.getLayerRenderingStats();(function(Mt,Lt,on,Sn){const Zn=Mt.terrain?Mt.terrain.exaggeration():0,fi=Mt.transform.zoom;for(const Ht of Sn){const ui=Lt.getTile(Ht).getBucket(on);ui&&(ui.setFilter(on.filter),Mt.conflationActive&&ui.updateReplacement(Ht,Mt.replacementSource),ui.evaluateTransform(Mt,on),Mt.terrain&&Zn>0&&ui.elevationUpdate(Mt.terrain,Zn,Ht,on.source),ui.needsReEvaluation(Mt,fi,on)&&ui.evaluate(on))}})(ce,Ee,ye,we),function(){let Mt,Lt,on;_t?(Mt=we.length-1,Lt=-1,on=-1):(Mt=0,Lt=we.length,on=1);const Sn=new Float64Array(16),Zn=o.cA(),fi=new o.P(0,0);for(let Ht=Mt;Ht!==Lt;Ht+=on){const ui=we[Ht],Tn=Ee.getTile(ui).getBucket(ye);if(!Tn||!Tn.uploaded)continue;let _i=!1;De&&(_i=De.getMaxCascadeForTile(ui.toUnwrapped())===0);const Ri=pe.calculatePosMatrix(ui.toUnwrapped(),pe.worldSize),Ci=Tn.modelTraits;!St&&_t&&(o.bl(Sn,Ri),o.af(Zn,He,Sn),fi.x=Zn[0],fi.y=Zn[1]);const ci=[];Tn.setFilter(ye.filter);for(const Dn of Tn.getNodesInfo()){if(Dn.hiddenByReplacement||!Dn.node.meshes)continue;const mi=Dn.node;let yr=0;ce.terrain&&mi.elevation&&(yr=mi.elevation*ce.terrain.exaggeration());const ir=(()=>{const Qs=Dn.aabb;return lt.min=[...Qs.min],lt.max=[...Qs.max],lt.min[2]+=yr,lt.max[2]+=yr,o.af(lt.min,lt.min,Ri),o.af(lt.max,lt.max,Ri),lt})(),yi=Dn.evaluatedScale;if(yi[0]<=1&&yi[1]<=1&&yi[2]<=1&&ir.intersects(Dt)===0)continue;if(!St&&_t){const Qs=.16666666666666666;Dn.cameraCollisionOpacity=He[0]>ir.min[0]&&He[0]<ir.max[0]&&He[1]>ir.min[1]&&He[1]<ir.max[1]&&He[2]*gt<ir.max[2]&&mi.footprint&&o.c0(fi,mi.footprint)?Math.max(Dn.cameraCollisionOpacity-Qs,0):Math.min(1,Dn.cameraCollisionOpacity+Qs)}const ni=[...Ri],Nn=1/o.d7(ui.canonical),Xi=mi.anchor?mi.anchor[0]:0,Ar=mi.anchor?mi.anchor[1]:0;o.br(ni,ni,[Xi*(yi[0]-1)+Dn.evaluatedTranslation[0]*Nn,Ar*(yi[1]-1)+Dn.evaluatedTranslation[1]*Nn,yr+Dn.evaluatedTranslation[2]]),o.cq(yi,o.eE)||o.cS(ni,ni,yi);const hr=o.aB([],ni,mi.globalMatrix),Fi=o.aB([],pe.expandedFarZProjMatrix,hr),bo=o.aB([],pe.expandedFarZProjMatrix,ni),Vs=o.aC([],[Xi,Ar,yr,1],Fi)[2];mi.hidden=!1;let ts=Pe;St||(_t&&(ts*=Dn.cameraCollisionOpacity,ts*=Gn(ni,pe,Dn.aabb,bt)),ts*=nr(Gt,Vs)),ts!==0?ci.push({nodeInfo:Dn,depth:Vs,opacity:ts,wvpForNode:Fi,wvpForTile:bo,nodeModelMatrix:hr,tileModelMatrix:ni}):mi.hidden=!0}St||ci.sort((Dn,mi)=>!_t||Dn.opacity===1&&mi.opacity===1?Dn.depth<mi.depth?-1:1:Dn.opacity===1?-1:mi.opacity===1?1:Dn.depth>mi.depth?-1:1);for(const Dn of ci){const mi=Dn.nodeInfo,yr=mi.node;let ir=o.aB([],Ve,Dn.tileModelMatrix);o.aB(ir,tt,ir);const yi=o.bl([],ir);o.eg(yi,yi),o.cS(yi,yi,Rp),ir=o.aB(ir,ir,yr.globalMatrix);const ni=ce.renderPass==="light-beam",Nn=ye.paint.get("model-color-use-theme").constantOr("default")==="none",Xi=Ci&o.eI.HasMapboxMeshFeatures,Ar=Xi?0:mi.evaluatedRMEA[0][2];for(let hr=0;hr<yr.meshes.length;++hr){const Fi=yr.meshes[hr],bo=hr===yr.lightMeshIndex;let Vs=Dn.wvpForNode;if(bo){if(!ni&&!ce.terrain&&ce.shadowRenderer){ce.currentLayer<ce.firstLightBeamLayer&&(ce.firstLightBeamLayer=ce.currentLayer);continue}Vs=Dn.wvpForTile}else if(ni)continue;const ts={defines:[]},Qs=[];if(!St&&De&&(De.useNormalOffset=!!Fi.normalBuffer),$g(ts.defines,Qs,Fi,ce,Nn?null:ye.lut),Xi||ts.defines.push("DIFFUSE_SHADED"),_i&&ts.defines.push("SHADOWS_SINGLE_CASCADE"),Bt&&(St?Bt.numRenderedVerticesInShadowPass+=Fi.vertexArray.length:Bt.numRenderedVerticesInTransparentPass+=Fi.vertexArray.length),St){ul(Fi,Dn.nodeModelMatrix,ce,ye);continue}let Js=null;if(Se){const Nr=Ug(Dn.nodeModelMatrix,ce.transform);if(Js=new Float32Array(Nr),pe.projection.name!=="globe"){const zi=Fi.aabb.min,Vr=Fi.aabb.max,[vr,fr]=Se.getOpacityForBounds(Nr,zi[0],zi[1],Vr[0],Vr[1]);ts.overrideFog=vr>=nt||fr>=nt}}const Ds=Fi.material;let la;Ds.occlusionTexture&&Ds.occlusionTexture.offsetScale&&(la=Ds.occlusionTexture.offsetScale,ts.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Ba=ce.getOrCreateProgram("model",ts);!St&&De&&De.setupShadowsFromMatrix(Dn.tileModelMatrix,Ba,De.useNormalOffset),ce.uploadCommonUniforms(_e,Ba,null,Js);const No=Ds.pbrMetallicRoughness;No.metallicFactor=.9,No.roughnessFactor=.5;const Tr=gd(new Float32Array(Vs),new Float32Array(ir),new Float32Array(yi),new Float32Array(yr.globalMatrix),ce,Dn.opacity,No.baseColorFactor,Ds.emissiveFactor,No.metallicFactor,No.roughnessFactor,Ds,Ar,ye,[0,0,0],la);!bo&&(mi.hasTranslucentParts||Dn.opacity<1)&&Ba.draw(ce,_e.gl.TRIANGLES,Xe,yn.disabled,Rn.disabled,mn.backCCW,Tr,ye.id,Fi.vertexBuffer,Fi.indexBuffer,Fi.segments,ye.paint,ce.transform.zoom,void 0,Qs),Ba.draw(ce,_e.gl.TRIANGLES,bo?Ue:Xe,yn.disabled,bo||Dn.opacity<1||mi.hasTranslucentParts?Rn.alphaBlended:Rn.unblended,mn.backCCW,Tr,ye.id,Fi.vertexBuffer,Fi.indexBuffer,Fi.segments,ye.paint,ce.transform.zoom,void 0,Qs)}}}}()}(f,r,c,p),void V();if(B.type!=="model")return;const U=B.getModels(),Z=[],W=f.transform.getFreeCameraOptions().position,ne=o.c5([],[W.x,W.y,W.z],f.transform.worldSize);o.ew(ne,ne);const te=[],le=[];let he=0;for(const ce of U){const Ee=r.getFeatureState("",ce.id),ye={type:"Unknown",id:ce.id,properties:ce.featureProperties},we=c.paint.get("model-rotation").evaluate(ye,Ee),_e=c.paint.get("model-scale").evaluate(ye,Ee),pe=c.paint.get("model-translation").evaluate(ye,Ee),Se=c.paint.get("model-opacity").evaluate(ye,Ee);fw(c,ce.id,Ee,ce.featureProperties,ce.nodeOverrideNames,ce.nodeOverrides),pw(c,ce.id,Ee,ce.featureProperties,ce.materialOverrideNames,ce.materialOverrides),ce.nodeOverrides.size>0&&ce.computeBoundsAndApplyParent(),ce.computeModelMatrix(f,we,_e,pe,S,w,!1);const De=o.bA([]),Me=o.ef(ce.position.lat,f.transform.zoom),He=o.bq([],[1,1,1/Me]);o.br(De,De,ne),Z.push({zScaleMatrix:He,negCameraPosMatrix:De});for(const We of ce.nodes)wd(f,We,ce.matrix,f.transform.expandedFarZProjMatrix,he,te,le,ce.materialOverrides,Se);he++}if(te.sort((ce,Ee)=>Ee.depth-ce.depth),f.renderPass!=="shadow")mw(f,c,te,le,Z),V();else{for(const ce of le)ul(ce.mesh,ce.nodeModelMatrix,f,c);for(const ce of te)ul(ce.mesh,ce.nodeModelMatrix,f,c);V()}}},qg={line:function(f,r,c){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(r){const p=r.getVisibleCoordinates();for(const y of p){const b=r.getTile(y).getBucket(f);if(b&&(b.elevationType!=="none"?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,r,c){const p=r.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,Pp(c,f)));if(p.type==="batched-model"||p.type!=="model")return;const y=p.getModels();for(const b of y)b.upload(c.context)},raster:function(f,r,c){const p=r.getSource();if(!(p instanceof ro&&p.loaded()))return;const y=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!y)return;const b=f.paint.get("raster-array-band")||p.getInitialBand(y);if(b==null)return;const w=r.getIds().map(S=>r.getTileByID(S));for(const S of w)S.updateNeeded(f.id,b)&&p.prepareTile(S,y,f.id,b)},"raster-particle":function(f,r,c){const p=r.getSource();if(!(p instanceof ro&&p.loaded()))return;const y=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!y)return;const b=f.paint.get("raster-particle-array-band")||p.getInitialBand(y);if(b==null)return;const w=r.getIds().map(S=>r.getTileByID(S));for(const S of w)S.updateNeeded(f.id,b)&&p.prepareTile(S,y,f.id,b)}},aa={fill:Dg},Zg={fill:function(f,r,c,p){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;const y=f.context.gl,b=new Xt(y.LEQUAL,Xt.ReadOnly,f.depthRangeFor3D),w=new yn({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),S=f.transform.getFreeCameraOptions().position,P=f.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const k of p){const L=r.getTile(k),V=L.getBucket(c);if(!V)continue;const B=V.elevatedStructures;if(!B||B.depthSegments.segments[0].primitiveLength===0)continue;const U=rw(k.toUnwrapped(),S),Z=f.translatePosMatrix(k.projMatrix,L,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),W=md(Z,U,0,1,0);P.draw(f,y.TRIANGLES,b,w,Rn.disabled,mn.disabled,W,c.id,B.vertexBuffer,B.indexBuffer,B.depthSegments,c.paint,f.transform.zoom)}}};class Kg{constructor(r,c,p,y,b){this.context=new wh(r,c),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=o.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const w=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const P of w)this._debugParams.enabledLayers[P]=!0;for(const P of w);this.occlusionParams=new Eh,this.setup(),this.numSublayers=Go.maxUnderzooming+Go.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new uh(this),this._wireframeDebugCache=new Eu,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const S=new o.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,S,r.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y,this.worldview=b,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(r,c){const p=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Uv(this,r));const y=this._terrain;this.transform.elevation=p?y:null,y.update(r,this.transform,c),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(r){const c=r.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,y]=c.getFovAdjustedRange(this.transform._fov);if(p>y)return void(this.transform.fogCullDistSq=null);const b=p+.78*(y-p);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(r){r&&!this._terrain&&(this._terrain=new Uv(this,this.style)),this._forceTerrainMode=r}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,c){if(this.width=r*o.o.devicePixelRatio,this.height=c*o.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const r=this.context,c=new o.bd;c.emplaceBack(0,0),c.emplaceBack(o.al,0),c.emplaceBack(0,o.al),c.emplaceBack(o.al,o.al),this.tileExtentBuffer=r.createVertexBuffer(c,o.bf.members),this.tileExtentSegments=o.bg.simpleSegment(0,0,4,2);const p=new o.bd;p.emplaceBack(0,0),p.emplaceBack(o.al,0),p.emplaceBack(0,o.al),p.emplaceBack(o.al,o.al),this.debugBuffer=r.createVertexBuffer(p,o.bf.members),this.debugSegments=o.bg.simpleSegment(0,0,4,5);const y=new o.bd;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(y,o.bf.members),this.viewportSegments=o.bg.simpleSegment(0,0,4,2);const b=new o.b1;b.emplaceBack(0,0,0,0),b.emplaceBack(o.al,0,o.al,0),b.emplaceBack(0,o.al,0,o.al),b.emplaceBack(o.al,o.al,o.al,o.al),this.mercatorBoundsBuffer=r.createVertexBuffer(b,o.bi.members),this.mercatorBoundsSegments=o.bg.simpleSegment(0,0,4,2);const w=new o.b0;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(w);const S=new o.be;for(const k of[0,1,3,2,0])S.emplaceBack(k);this.debugIndexBuffer=r.createIndexBuffer(S),this.emptyTexture=new o.T(r,new o.q({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA8),this.identityMat=o.bC();const P=this.context.gl;this.stencilClearMode=new yn({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,Xt.disabled,this.stencilClearMode,Rn.disabled,mn.disabled,bp(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,c,p){if(!c||this.currentStencilSource===c.id||!r.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const P of p)if(this._tileClippingMaskIDs[P.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=c.id;const y=this.context,b=y.gl;this.nextStencilID+p.length>256&&this.clearStencil(),y.setColorMode(Rn.disabled),y.setDepthMode(Xt.disabled);const w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of p){const P=c.getTile(S),k=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:V,tileBoundsSegments:B}=this.getTileBoundsBuffers(P);w.draw(this,b.TRIANGLES,Xt.disabled,new yn({func:b.ALWAYS,mask:0},k,255,b.KEEP,b.KEEP,b.REPLACE),Rn.disabled,mn.disabled,bp(S.projMatrix),"$clipping",L,V,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,c=this.context.gl;return new yn({func:c.NOTEQUAL,mask:255},r,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const c=this.context.gl;return new yn({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(r){const c=this.context.gl,p=r.sort((w,S)=>S.overscaledZ-w.overscaledZ),y=p[p.length-1].overscaledZ,b=p[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const w={};for(let S=0;S<b;S++)w[S+y]=new yn({func:c.GEQUAL,mask:255},S+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=b,[w,p]}return[{[y]:yn.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new Rn([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new o.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Rn.unblended:Rn.alphaBlended}colorModeForDrapableLayerRenderPass(r){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?r!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new Rn([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new o.ao(0,0,0,r??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new Rn([c.ONE,c.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,c.ONE_MINUS_SRC_ALPHA],o.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(r,c,p,y=!1){if(this.depthOcclusion)return new Xt(this.context.gl.GREATER,Xt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return Xt.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Xt(p||this.context.gl.LEQUAL,c,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const r=this.context.gl,c=Math.ceil(this.width),p=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),b=r.getParameter(r.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&p!==0&&(this.depthFBO=new iw(this.context,c,p,0,"texture"),this.depthTexture=new o.T(this.context,{width:c,height:p,data:null},r.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),r.bindTexture(r.TEXTURE_2D,b),this.depthFBO&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),r.blitFramebuffer(0,0,c,p,0,0,c,p,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((r,c)=>r+c/this._fpsHistory.length,0))}render(r,c){const p=o.o.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=r.map.repaint,this.style=r,this.options=c;const y=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),w=()=>this.style._getOrder(b).filter(Ve=>{const Pe=y[Ve];return!(Pe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Pe.type]});let S=w(),P=!1,k=!1,L=null,V=0,B=!1;for(const Ve of S){const Pe=y[Ve];Pe.visibility!=="none"&&(Pe.type==="circle"?P=!0:Pe.type==="building"?(L=Pe,++V):Pe.type==="symbol"&&(Pe.hasOcclusionOpacityProperties?k=!0:P=!0))}this.updateEmissiveMode();let U=S.map(Ve=>y[Ve]);const Z=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.o.now()),this.imageManager.beginFrame();for(const Ve in Z){const Pe=Z[Ve];Pe.used&&(Pe.prepare(this.context),Pe.getSource().usedInConflation&&++V)}let W=!1;for(const Ve of U)Ve.isHidden(this.transform.zoom)||(Ve.type==="clip"&&(W=!0),this.prepareLayer(Ve));const ne={},te={},le={},he={},ce={};for(const Ve in Z){const Pe=Z[Ve];ne[Ve]=Pe.getVisibleCoordinates(),te[Ve]=ne[Ve].slice().reverse(),le[Ve]=Pe.getVisibleCoordinates(!0).reverse(),he[Ve]=Pe.getShadowCasterCoordinates(),ce[Ve]=Pe.sortCoordinatesByDistance(ne[Ve])}const Ee=Ve=>{const Pe=this.style.getLayerSourceCache(Ve);return Pe&&Pe.used?Pe.getSource():null};if(V||W||this._clippingActiveLastFrame){const Ve=[],Pe=[];let Xe=0;for(const Ue of U)this.isSourceForClippingOrConflation(Ue,Ee(Ue))&&(Ve.push(Ue),Pe.push(Xe)),Xe++;if(Ve&&(W||Ve.length>1)||this._clippingActiveLastFrame){W=!1;const Ue=[];for(let lt=0;lt<Ve.length;lt++){const St=Ve[lt],Dt=Pe[lt],bt=this.style.getLayerSourceCache(St);if(!bt||!bt.used||!bt.getSource().usedInConflation&&St.type!=="clip"&&St.type!=="building")continue;let _t=o.eQ,Gt=o.b_.None;const Bt=[];let Mt=!0;if(St.type==="building")_t=o.eS;else if(St.type==="clip"){_t=Dt;for(const Lt of St.layout.get("clip-layer-types"))Gt|=Lt==="model"?o.b_.Model:Lt==="symbol"?o.b_.Symbol:o.b_.FillExtrusion;for(const Lt of St.layout.get("clip-layer-scope"))Bt.push(Lt);St.isHidden(this.transform.zoom)?Mt=!1:W=!0}Mt&&Ue.push({layer:St.fqid,cache:bt,order:_t,clipMask:Gt,clipScope:Bt})}this.replacementSource.setSources(Ue),B=!0}}this._clippingActiveLastFrame=W,B||this.replacementSource.clear(),this.conflationActive=B,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ve=0;Ve<U.length;Ve++){const Pe=U[Ve];if(Pe.visibility==="none")continue;const Xe=Pe.cutoffRange();if(this.longestCutoffRange=Math.max(Xe,this.longestCutoffRange),Xe>0){const Ue=Ee(Pe);Ue&&(this.minCutoffZoom=Math.max(Ue.minzoom,this.minCutoffZoom)),Pe.minzoom&&(this.minCutoffZoom=Math.max(Pe.minzoom,this.minCutoffZoom))}Pe.is3D(b)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ve),this._lastOcclusionLayer=Ve)}const ye=this.style&&this.style.fog;ye?(this._fogVisible=ye.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ye.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(le),this.opaquePassCutoff=0,S=w(),U=S.map(Ve=>y[Ve]));const we=this._shadowRenderer;if(we){we.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ve in Z)for(const Pe of ne[Ve]){let Xe={min:0,max:0};this.terrain&&(Xe=this.terrain.getMinMaxForTile(Pe)||Xe),we.addShadowReceiver(Pe.toUnwrapped(),Xe.min,Xe.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new hw(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const _e=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),pe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(_e&&!this._snow&&(this._snow=new rx(this)),!_e&&this._snow&&(this._snow.destroy(),delete this._snow),pe&&!this._rain&&(this._rain=new Wg(this)),!pe&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),L){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Vg);const Ve=this.style.getLayerSourceCache(L);this.buildingTileBorderManager.updateBorders(Ve,L)}if(!ls.has(this.context.gl))return;this.renderPass="offscreen";for(const Ve of U){const Pe=r.getLayerSourceCache(Ve);if(!Ve.hasOffscreenPass()||Ve.isHidden(this.transform.zoom))continue;const Xe=Pe?te[Pe.id]:void 0;(Ve.type==="custom"||Ve.type==="raster"||Ve.type==="raster-particle"||Ve.isSky()||Xe&&Xe.length)&&this.renderLayer(this,Pe,Ve,Xe)}this.depthRangeFor3D=[0,1-(U.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,he)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Se=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),De=(()=>{if(c.showOverdrawInspector)return o.ao.black;const Ve=this.style.fog;if(Ve&&this.transform.projection.supportsFog){const Pe=this.style.getLut(Ve.scope);if(!Se){const Xe=Ve.properties.get("color-use-theme")==="none",Ue=Ve.properties.get("color").toNonPremultipliedRenderColor(Xe?null:Pe).toArray01();return new o.ao(...Ue)}if(Se){const Xe=Ve.properties.get("space-color-use-theme")==="none",Ue=Ve.properties.get("space-color").toNonPremultipliedRenderColor(Xe?null:Pe).toArray01();return new o.ao(...Ue)}}return o.ao.transparent})();if(this.context.clear({color:De,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const Ve=U[this.currentLayer],Pe=r.getLayerSourceCache(Ve);if(Ve.isSky())continue;const Xe=Pe?(Ve.is3D(b)?ce:te)[Pe.id]:void 0;this._renderTileClippingMasks(Ve,Pe,Xe),this.renderLayer(this,Pe,Ve,Xe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const Ve=U[this.currentLayer],Pe=r.getLayerSourceCache(Ve);Ve.isSky()&&this.renderLayer(this,Pe,Ve,Pe?te[Pe.id]:void 0)}function Me(Ve,Pe){let Xe;return Pe&&(Xe=(Ve.type==="symbol"?le:Ve.is3D(b)?ce:te)[Pe.id]),Xe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<S.length;){const Ve=U[this.currentLayer];if(Ve.type==="raster"||Ve.type==="raster-particle"){const Pe=r.getLayerSourceCache(Ve);this.renderLayer(this,Pe,Ve,Me(Ve,Pe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let He=0;we&&(He=we.getShadowCastingLayerCount());let We=!1,tt=-1;for(let Ve=0;Ve<S.length;++Ve){const Pe=U[Ve];Pe.isHidden(this.transform.zoom)||Pe.is3D(b)&&(tt=Ve)}k&&tt===-1&&(P=!0);let gt=!1;for(;this.currentLayer<S.length;){const Ve=U[this.currentLayer],Pe=r.getLayerSourceCache(Ve);if(Ve.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ve)){if(Ve.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!gt&&Ve.is3D(b)&&!b){const Xe=this.currentLayer,Ue=lt=>{for(this.currentLayer=0;this.currentLayer<U.length;this.currentLayer++){const St=U[this.currentLayer];if(aa[St.type]){const Dt=this.style.getLayerSourceCache(St);aa[St.type](this,Dt,St,Me(St,Dt),lt)}}};Ue("initialize"),Ue("reset"),this.currentLayer=Xe,gt=!0}if(P&&!We&&this.terrain&&!this.transform.isOrthographic&&(We=!0,this.blitDepth()),k&&tt!==-1&&this.currentLayer===tt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ve,Pe,Pe?ne[Pe.id]:void 0),this.renderLayer(this,Pe,Ve,Me(Ve,Pe)),!this.terrain&&we&&He>0&&Ve.hasShadowPass()&&--He==0){{this.clearStencil(),this.resetStencilClippingMasks();const Xe=this.currentLayer;for(this.currentLayer=0;this.currentLayer<U.length;this.currentLayer++){const Ue=U[this.currentLayer];if(Zg[Ue.type]){const lt=this.style.getLayerSourceCache(Ue);Zg[Ue.type](this,lt,Ue,Me(Ue,lt))}}this.currentLayer=Xe}if(we.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Xe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Xe;this.currentLayer++){const Ue=U[this.currentLayer];if(!Ue.hasLightBeamPass())continue;const lt=r.getLayerSourceCache(Ue);this.renderLayer(this,lt,Ue,lt?te[lt.id]:void 0)}this.currentLayer=Xe,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Xe=this.currentLayer;this.depthOcclusion=!0;for(const Ue of this.layersWithOcclusionOpacity){this.currentLayer=Ue;const lt=U[this.currentLayer],St=r.getLayerSourceCache(lt),Dt=St?te[St.id]:void 0;this.terrain||this._renderTileClippingMasks(lt,St,St?ne[St.id]:void 0),this.renderLayer(this,St,lt,Dt)}this.depthOcclusion=!1,this.currentLayer=Xe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ve=null;U.forEach(Pe=>{const Xe=r.getLayerSourceCache(Pe);Xe&&!Pe.isHidden(this.transform.zoom)&&Xe.getVisibleCoordinates().length&&(!Ve||Ve.getSource().maxzoom<Xe.getSource().maxzoom)&&(Ve=Xe)}),Ve&&this.options.showTileBoundaries&&xt(this,Ve,Ve.getVisibleCoordinates(),o.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&xt(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ve){const Pe=Ve.transform.padding;xd(Ve,Ve.transform.height-(Pe.top||0),3,aw),xd(Ve,Pe.bottom||0,3,lw),wr(Ve,Pe.left||0,3,cw),wr(Ve,Ve.transform.width-(Pe.right||0),3,yd);const Xe=Ve.transform.centerPoint;(function(Ue,lt,St,Dt){Fe(Ue,lt-1,St-10,2,20,Dt),Fe(Ue,lt-10,St-1,20,2,Dt)})(Ve,Xe.x,Ve.transform.height-Xe.y,vd)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),B||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);const{unsupportedLayers:c}=this.transform.projection,p=!c||!c.includes(r.type);if(qg[r.type]&&(p||this.terrain&&r.type==="custom")){const y=this.style.getLayerSourceCache(r);qg[r.type](r,y,this)}this.gpuTimingEnd()}renderLayer(r,c,p,y){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||y&&y.length)&&(this.id=p.id,this.gpuTimingStart(p),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(p.type)&&(!r.terrain||p.type!=="custom")||p.type==="clip"||Su[p.type](r,c,p,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,p=this.context.gl;let y=this.gpuTimers[r.id];y||(y=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:p.createQuery()}),y.calls++,p.beginQuery(c.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,c=this.context.gl,p=c.createQuery();this.deferredRenderGpuTimeQueries.push(p),c.beginQuery(r.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const c={};for(const p in r){const y=r[p],b=this.context.extTimerQuery,w=b.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(y.query),c[p]=w}return c}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let p=0;for(const y of r)p+=c.getQueryParameter(y,c.QUERY_RESULT)/1e6,c.deleteQuery(y);return p}translatePosMatrix(r,c,p,y,b){if(!p[0]&&!p[1])return r;const w=b?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(w){const k=Math.sin(w),L=Math.cos(w);p=[p[0]*L-p[1]*k,p[0]*k+p[1]*L]}const S=[b?p[0]:o.ay(c,p[0],this.transform.zoom),b?p[1]:o.ay(c,p[1],this.transform.zoom),0],P=new Float32Array(16);return o.br(P,r,S),P}saveTileTexture(r){if(r.context!==this.context)return;const c=r.size[0],p=this._tileTextures[c];p?p.push(r):this._tileTextures[c]=[r]}getTileTexture(r){const c=this._tileTextures[r];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(r,c,p){const y=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,b=[];return this.style&&this.style.enable3dLights()&&(r==="globeRaster"||r==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||y||c!==void 0&&!c||b.push("FOG","FOG_DITHERING"),y&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(r,c){this.cache=this.cache||{};const p=c&&c.defines||[],y=c&&c.config,b=this.currentGlobalDefines(r,c&&c.overrideFog,c&&c.overrideRtt).concat(p),w=Hb.cacheKey(Pv[r],r,b,y);return this.cache[w]||(this.cache[w]=new Hb(this.context,r,Pv[r],y,kg[r],b)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,c){if(this.style.enable3dLights()){const p=this.style.directionalLight,y=this.style.ambientLight;if(p&&y){const b=((w,S,P)=>{const k=w.properties.get("direction"),L=w.properties.get("color-use-theme")==="none",V=w.properties.get("color").toNonPremultipliedRenderColor(L?null:P.getLut(w.scope)).toArray01(),B=w.properties.get("intensity"),U=S.properties.get("color-use-theme")==="none",Z=S.properties.get("color").toNonPremultipliedRenderColor(U?null:P.getLut(S.scope)).toArray01(),W=S.properties.get("intensity"),ne=[k.x,k.y,k.z],te=o.dN(Z,W),le=o.dN(V,B);return{u_lighting_ambient_color:te,u_lighting_directional_dir:ne,u_lighting_directional_color:le,u_ground_radiance:vh(ne,le,te)}})(p,y,this.style);c.setLightsUniformValues(r,b)}}}uploadCommonUniforms(r,c,p,y,b){if(this.uploadCommonLightUniforms(r,c),this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const S=w.getOpacity(this.transform.pitch),P=((k,L,V,B,U,Z,W,ne,te,le,he,ce)=>{const Ee=k.transform,ye=L.properties.get("color-use-theme")==="none",we=L.properties.get("color").toNonPremultipliedRenderColor(ye?null:k.style.getLut(L.scope)).toArray01();we[3]=B;const _e=k.frameCounter/1e3%1,[pe,Se]=L.properties.get("vertical-range");return{u_fog_matrix:V?Ee.calculateFogTileMatrix(V):ce||k.identityMat,u_fog_range:L.getFovAdjustedRange(Ee._fov),u_fog_color:we,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(pe,Se),Se],u_fog_temporal_offset:_e,u_frustum_tl:U,u_frustum_tr:Z,u_frustum_br:W,u_frustum_bl:ne,u_globe_pos:te,u_globe_radius:le,u_viewport:he,u_globe_transition:o.aj(Ee.zoom),u_is_globe:+(Ee.projection.name==="globe")}})(this,w,p,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.o.devicePixelRatio,this.transform.height*o.o.devicePixelRatio],y);c.setFogUniformValues(r,P)}b&&c.setCutoffUniformValues(r,b.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,c=r.createTexture();return r.bindTexture(r.TEXTURE_2D,c),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,c=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const y of p)c[y.key]=r[y.key]||new ld(y,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(r,c){return!(!r.is3D(!(!this.terrain||!this.terrain.enabled))||r.type!=="clip"&&r.type!=="building"&&(r.minzoom&&r.minzoom>this.transform.zoom||(this.style._clipLayerPresent||r.sourceLayer!=="building"&&r.sourceLayer!=="procedural_buildings")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[r.key];return c||(this._cachedTileFogOpacities[r.key]=c=this.style.fog.getOpacityForTile(r)),c[0]>=nt||c[1]>=nt}setupDepthForOcclusion(r,c,p){const y=this.context,b=y.gl,w=!!p;var S;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(b.TEXTURE3),r&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((S=this.depthRangeFor3D)[1]-S[0]),-1-2*S[0]/(S[1]-S[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),y.activeTexture.set(b.TEXTURE0),w||c.setTerrainUniformValues(y,p)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const r=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=r?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function Xg(f,r){let c=!1,p=null;const y=()=>{p=null,c&&(f(),p=setTimeout(y,r),c=!1)};return()=>(c=!0,p||y(),p)}class sx{constructor(r){this._hashName=r&&encodeURIComponent(r),o.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Xg(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const c=Jr(r);if(this._hashName){const p=this._hashName;let y=!1;const b=location.hash.slice(1).split("&").map(w=>{const S=w.split("=")[0];return S===p?(y=!0,`${S}=${c}`):w}).filter(w=>w);return y||b.push(`${p}=${c}`),`#${b.join("&")}`}return`#${c}`}_getCurrentHash(){const r=location.hash.replace("#","");if(this._hashName){let c;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(c=p)}),(c&&c[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(p=>isNaN(Number(p)))){const p=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(c[3]||0):r.getBearing();return r.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:p,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Jr(f,r){const c=f.getCenter(),p=Math.round(100*f.getZoom())/100,y=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,y),w=Math.round(c.lng*b)/b,S=Math.round(c.lat*b)/b,P=f.getBearing(),k=f.getPitch();let L=r?`/${w}/${S}/${p}`:`${p}/${S}/${w}`;return(P||k)&&(L+="/"+Math.round(10*P)/10),k&&(L+=`/${Math.round(k)}`),L}const Ch={linearity:.3,easing:o.eT(0,0,.3,1)},ox=Object.assign({deceleration:2500,maxSpeed:1400},Ch),ax=Object.assign({deceleration:20,maxSpeed:1400},Ch),Ed=Object.assign({deceleration:1e3,maxSpeed:360},Ch),lx=Object.assign({deceleration:1e3,maxSpeed:90},Ch);class cx{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.o.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,c=o.o.now();for(;r.length>0&&c-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)c.zoom+=b.zoomDelta||0,c.bearing+=b.bearingDelta||0,c.pitch+=b.pitchDelta||0,b.panDelta&&c.pan._add(b.panDelta),b.around&&(c.around=b.around),b.pinchAround&&(c.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(c.pan.mag()){const b=Bl(c.pan.mag(),p,Object.assign({},ox,r||{}));y.offset=c.pan.mult(b.amount/c.pan.mag()),y.center=this._map.transform.center,Ih(y,b)}if(c.zoom){const b=Bl(c.zoom,p,ax);y.zoom=this._map.transform.zoom+b.amount,Ih(y,b)}if(c.bearing){const b=Bl(c.bearing,p,Ed);y.bearing=this._map.transform.bearing+o.aA(b.amount,-179,179),Ih(y,b)}if(c.pitch){const b=Bl(c.pitch,p,lx);y.pitch=this._map.transform.pitch+b.amount,Ih(y,b)}if(y.zoom||y.bearing){const b=c.pinchAround===void 0?c.around:c.pinchAround;y.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function Ih(f,r){(!f.duration||f.duration<r.duration)&&(f.duration=r.duration,f.easing=r.easing)}function Bl(f,r,c){const{maxSpeed:p,linearity:y,deceleration:b}=c,w=o.aA(f*y/(r/1e3),-p,p),S=Math.abs(w)/(b*y);return{easing:c.easing,duration:1e3*S,amount:w*(S/2)}}class Do extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,p,y={}){const b=Be(c.getCanvasContainer(),p),w=c.unproject(b);super(r,Object.assign({point:b,lngLat:w,originalEvent:p},y)),this._defaultPrevented=!1,this.target=c}}class Cu extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,p){const y=r==="touchend"?p.changedTouches:p.touches,b=ot(c.getCanvasContainer(),y),w=b.map(P=>c.unproject(P)),S=b.reduce((P,k,L,V)=>P.add(k.div(V.length)),new o.P(0,0));super(r,{points:b,point:S,lngLats:w,lngLat:c.unproject(S),originalEvent:p}),this._defaultPrevented=!1}}class ux extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class Yg{constructor(r,c){this._map=r,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new ux(this._map,r))}mousedown(r,c){return this._mousedownPos=c,this._firePreventable(new Do(r.type,this._map,r))}mouseup(r){this._map.fire(new Do(r.type,this._map,r))}preclick(r){const c=new MouseEvent("preclick",r);this._map.fire(new Do(c.type,this._map,c))}click(r,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Do(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Do(r.type,this._map,r))}mouseover(r){this._map.fire(new Do(r.type,this._map,r))}mouseout(r){this._map.fire(new Do(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Cu(r.type,this._map,r))}touchmove(r){this._map.fire(new Cu(r.type,this._map,r))}touchend(r){this._map.fire(new Cu(r.type,this._map,r))}touchcancel(r){this._map.fire(new Cu(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dx{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Do(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Do("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Do(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qg{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,c){this.isEnabled()&&r.shiftKey&&r.button===0&&(ue(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(r,c){if(!this._active)return;const p=c,y=this._startPos,b=this._lastPos;if(!y||!b||b.equals(p)||!this._box&&p.dist(y)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=H("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const w=Math.min(y.x,p.x),S=Math.max(y.x,p.x),P=Math.min(y.y,p.y),k=Math.max(y.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${P}px)`,this._box.style.width=S-w+"px",this._box.style.height=k-P+"px")})}mouseupWindow(r,c){if(!this._active)return;const p=this._startPos,y=c;if(p&&r.button===0){if(this.reset(),ze(),p.x!==y.x||p.y!==y.y)return this._map.fire(new o.z("boxzoomend",{originalEvent:r})),{cameraAnimation:b=>b.fitScreenCoordinates(p,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),xe(),delete this._startPos,delete this._lastPos}_fireEvent(r,c){return this._map.fire(new o.z(r,{originalEvent:c}))}}function Jg(f,r){const c={};for(let p=0;p<f.length;p++)c[f[p].identifier]=r[p];return c}class vw{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,c,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(y){const b=new o.P(0,0);for(const w of y)b._add(w);return b.div(y.length)}(c),this.touches=Jg(p,c)))}touchmove(r,c,p){if(this.aborted||!this.centroid)return;const y=Jg(p,c);for(const b in this.touches){const w=y[b];(!w||w.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(r,c,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class e_{constructor(r){this.singleTap=new vw(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,c,p){this.singleTap.touchstart(r,c,p)}touchmove(r,c,p){this.singleTap.touchmove(r,c,p)}touchend(r,c,p){const y=this.singleTap.touchend(r,c,p);if(y){const b=r.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(y)<30;if(b&&w||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class xw{constructor(){this._zoomIn=new e_({numTouches:1,numTaps:2}),this._zoomOut=new e_({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,c,p){this._zoomIn.touchstart(r,c,p),this._zoomOut.touchstart(r,c,p)}touchmove(r,c,p){this._zoomIn.touchmove(r,c,p),this._zoomOut.touchmove(r,c,p)}touchend(r,c,p){const y=this._zoomIn.touchend(r,c,p),b=this._zoomOut.touchend(r,c,p);return y?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(y)},{originalEvent:r})}):b?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(b)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const bw={0:1,2:2},hx={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class t_{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,c){return!1}_move(r,c){return{}}mousedown(r,c){if(this._lastPoint)return;const p=Et(r);this._correctButton(r,p)&&(this._lastPoint=c,this._eventButton=p)}mousemoveWindow(r,c){const p=this._lastPoint;if(p){if(r.preventDefault(),this._eventButton!=null&&function(y,b){const w=bw[b];return y.buttons===void 0||(y.buttons&w)!==w}(r,this._eventButton))this.reset();else if(this._moved||!(c.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(p,c)}}mouseupWindow(r){this._lastPoint&&Et(r)===this._eventButton&&(this._moved&&ze(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ww extends t_{mousedown(r,c){super.mousedown(r,c),this._lastPoint&&(this._active=!0)}_correctButton(r,c){return c===0&&!r.ctrlKey}_move(r,c){return{around:c,panDelta:c.sub(r)}}}class fx extends t_{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?hx[r.pitchRotateKey]:void 0}_correctButton(r,c){return this._pitchRotateKey?c===0&&r[this._pitchRotateKey]:c===0&&r.ctrlKey||c===2}_move(r,c){const p=.8*(c.x-r.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class px extends t_{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?hx[r.pitchRotateKey]:void 0}_correctButton(r,c){return this._pitchRotateKey?c===0&&r[this._pitchRotateKey]:c===0&&r.ctrlKey||c===2}_move(r,c){const p=-.5*(c.y-r.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class Tw{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),o.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(r,c,p){return this._calculateTransform(r,c,p)}touchmove(r,c,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!o.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,c,p)}}touchend(r,c,p){this._calculateTransform(r,c,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,c,p){p.length>0&&(this._active=!0);const y=Jg(p,c),b=new o.P(0,0),w=new o.P(0,0);let S=0;for(const k in y){const L=y[k],V=this._touches[k];V&&(b._add(L),w._add(L.sub(V)),S++,y[k]=L)}if(this._touches=y,S<this._minTouches||!w.mag())return;const P=w.div(S);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(S),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=H("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class n_{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,c,p){return{}}touchstart(r,c,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([c[0],c[1]]))}touchmove(r,c,p){const y=this._firstTwoTouches;if(!y)return;r.preventDefault();const[b,w]=y,S=Mp(p,c,b),P=Mp(p,c,w);if(!S||!P)return;const k=this._aroundCenter?null:S.add(P).div(2);return this._move([S,P],k,r)}touchend(r,c,p){if(!this._firstTwoTouches)return;const[y,b]=this._firstTwoTouches,w=Mp(p,c,y),S=Mp(p,c,b);w&&S||(this._active&&ze(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Mp(f,r,c){for(let p=0;p<f.length;p++)if(f[p].identifier===c)return r[p]}function Ew(f,r){return Math.log2(f/r)}class OI extends n_{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,c){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Ew(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ew(this._distance,p),pinchAround:c}}}function Sw(f,r){return 180*f.angleWith(r)/Math.PI}class dr extends n_{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,c){const p=this._vector;if(this._vector=r[0].sub(r[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Sw(this._vector,p),pinchAround:c}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const c=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const y=Sw(r,p);return Math.abs(y)<c}}function i_(f){return Math.abs(f.y)>Math.abs(f.x)}class FI extends n_{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,i_(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,c,p){const y=this._lastPoints;if(!y)return;const b=r[0].sub(y[0]),w=r[1].sub(y[1]);return this._map._cooperativeGestures&&!o.eU()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(b,w,p.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(b.y+w.y)/2*-.5})}gestureBeginsVertically(r,c,p){if(this._valid!==void 0)return this._valid;const y=r.mag()>=2,b=c.mag()>=2;if(!y&&!b)return;if(!y||!b)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const w=r.y>0==c.y>0;return i_(r)&&i_(c)&&w}}const zI={panStep:100,bearingStep:15,pitchStep:10};class jI{constructor(){const r=zI;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let c=0,p=0,y=0,b=0,w=0;switch(r.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),b=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),b=1);break;case 38:r.shiftKey?y=1:(r.preventDefault(),w=-1);break;case 40:r.shiftKey?y=-1:(r.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(p=0,y=0),{cameraAnimation:S=>{const P=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:kp,zoom:c?Math.round(P)+c*(r.shiftKey?2:1):P,bearing:S.getBearing()+p*this._bearingStep,pitch:S.getPitch()+y*this._pitchStep,offset:[-b*this._panStep,-w*this._panStep],center:S.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function kp(f){return f*(2-f)}const mx=4.000244140625,gx=1/450;class r_{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=gx,o.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||o.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=o.o.now(),y=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,c!==0&&c%mx==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(y*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),r.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=r,this._delta-=c,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Be(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>mx?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&L!==0&&(L=1/L);const V=c(),B=Math.pow(2,V),U=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(U*L))),this._type==="wheel"&&(this._startZoom=V,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:c(),y=this._startZoom,b=this._easing;let w,S=!1;if(this._type==="wheel"&&y&&b){const k=Math.min((o.o.now()-this._lastWheelEventTime)/200,1),L=b(k);w=o.ak(y,p,L),k<1?this._frameId||(this._frameId=!0):S=!0}else w=p,S=!0;this._active=!0,S&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let P=w-c();return P*this._lastDelta<0&&(P=0),{noInertia:!0,needsRenderFrame:!S,zoomDelta:P,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let c=o.eV;if(this._prevEase){const p=this._prevEase,y=(o.o.now()-p.start)/p.duration,b=p.easing(y+.01)-p.easing(y),w=.27/Math.sqrt(b*b+1e-4)*.01,S=Math.sqrt(.0729-w*w);c=o.eT(w,S,.25,1)}return this._prevEase={start:o.o.now(),duration:r,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=H("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class _c{constructor(r,c){this._clickZoom=r,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class s_{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,c){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(r.shiftKey?-1:1),around:p.unproject(c)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class es{constructor(){this._tap=new e_({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,c,p){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=c[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(r,c,p))}touchmove(r,c,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const y=c[0],b=y.y-this._swipePoint.y;return this._swipePoint=y,r.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(r,c,p)}touchend(r,c,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(r,c,p)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vl{constructor(r,c,p){this._el=r,this._mousePan=c,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Dp{constructor(r,c,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=c,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class o_{constructor(r,c,p,y){this._el=r,this._touchZoom=c,this._touchRotate=p,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Np=f=>f.zoom||f.drag||f.pitch||f.rotate;class BI extends o.z{}class Lp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,c){const p=o.av([],c,r);this.radius=o.ag(p[2]<0?o.eX([],p,this.constants):[p[0],p[1],0])}projectRay(r){o.eX(r,r,this.constants),o.aw(r,r),o.eY(r,r,this.constants);const c=o.c5([],r,this.radius);if(c[2]>0){const p=o.c5([],[0,0,1],o.bJ(c,[0,0,1])),y=o.c5([],o.aw([],[c[0],c[1],0]),this.radius),b=o.d8([],c,o.c5([],o.av([],o.d8([],y,p),c),2));c[0]=b[0],c[1]=b[1]}return c}}function a_(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class VI{constructor(r,c){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new cx(r),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Lp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),o.aY(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,b,w]of this._listeners){const S=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(b,S,w)}}destroy(){for(const[r,c,p]of this._listeners){const y=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(c,y,p)}}_addDefaultHandlers(r){const c=this._map,p=c.getCanvasContainer();this._add("mapEvent",new Yg(c,r));const y=c.boxZoom=new Qg(c,r);this._add("boxZoom",y);const b=new xw,w=new s_;c.doubleClickZoom=new _c(w,b),this._add("tapZoom",b),this._add("clickZoom",w);const S=new es;this._add("tapDragZoom",S);const P=c.touchPitch=new FI(c);this._add("touchPitch",P);const k=new fx(r),L=new px(r);c.dragRotate=new Dp(r,k,L),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const V=new ww(r),B=new Tw(c,r);c.dragPan=new Vl(p,V,B),this._add("mousePan",V),this._add("touchPan",B,["touchZoom","touchRotate"]);const U=new dr,Z=new OI;c.touchZoomRotate=new o_(p,Z,U,S),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),this._add("blockableMapEvent",new dx(c));const W=c.scrollZoom=new r_(c,this);this._add("scrollZoom",W,["mousePan"]);const ne=c.keyboard=new jI;this._add("keyboard",ne);for(const te of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[te]&&c[te].enable(r[te])}_add(r,c,p){this._handlers.push({handlerName:r,handler:c,allowed:p}),this._handlersById[r]=c}stop(r){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Np(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,c,p){for(const y in r)if(y!==p&&(!c||c.indexOf(y)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const c=[];for(const p of r)this._el.contains(p.target)&&c.push(p);return c}handleEvent(r,c){this._updatingCamera=!0;const p=r.type==="renderFrame",y=p?void 0:r,b={needsRenderFrame:!1},w={},S={},P=r.touches?this._getMapTouches(r.touches):void 0,k=P?ot(this._el,P):p?void 0:Be(this._el,r);for(const{handlerName:B,handler:U,allowed:Z}of this._handlers){if(!U.isEnabled())continue;let W;this._blockedByActive(S,Z,B)?U.reset():U[c||r.type]&&(W=U[c||r.type](r,k,P),this.mergeHandlerResult(b,w,W,B,y),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||U.isActive())&&(S[B]=U)}const L={};for(const B in this._previousActiveHandlers)S[B]||(L[B]=y);this._previousActiveHandlers=S,(Object.keys(L).length||a_(b))&&(this._changes.push([b,w,L]),this._triggerRenderFrame()),(Object.keys(S).length||a_(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=b;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))}mergeHandlerResult(r,c,p,y,b){if(!p)return;Object.assign(r,p);const w={handlerName:y,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(c.zoom=w),p.panDelta!==void 0&&(c.drag=w),p.pitchDelta!==void 0&&(c.pitch=w),p.bearingDelta!==void 0&&(c.rotate=w)}_applyChanges(){const r={},c={},p={};for(const[y,b,w]of this._changes)y.panDelta&&(r.panDelta=(r.panDelta||new o.P(0,0))._add(y.panDelta)),y.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(r.around=y.around),y.aroundCoord!==void 0&&(r.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(r.pinchAround=y.pinchAround),y.noInertia&&(r.noInertia=y.noInertia),Object.assign(c,b),Object.assign(p,w);this._updateMapTransform(r,c,p),this._changes=[]}_updateMapTransform(r,c,p){const y=this._map,b=y.transform,w=le=>[le.x,le.y,le.z];if((le=>{const he=this._eventsInProgress.drag;return he&&!this._handlersById[he.handlerName].isActive()})()&&!a_(r)){const le=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),le!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&y._stop(!0),!a_(r))return void this._fireEvents(c,p,!0);let{panDelta:S,zoomDelta:P,bearingDelta:k,pitchDelta:L,around:V,aroundCoord:B,pinchAround:U}=r;b._isCameraConstrained&&(P>0&&(P=0),b._isCameraConstrained=!1),U!==void 0&&(V=U),(P||(le=>c[le]&&!this._eventsInProgress[le])("drag"))&&V&&(this._dragOrigin=w(b.pointCoordinate3D(V)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",y._stop(!0),V=V||y.transform.centerPoint,k&&(b.bearing+=k),L&&(b.pitch+=L),b._updateCameraState();const Z=[0,0,0];if(S)if(b.projection.name==="mercator"){const le=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(V).dir),he=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(V.sub(S)).dir);Z[0]=he[0]-le[0],Z[1]=he[1]-le[1]}else{const le=b.pointCoordinate(V);if(b.projection.name==="globe"){S=S.rotate(-b.angle);const he=b._pixelsPerMercatorPixel/b.worldSize;Z[0]=-S.x*o.eW(o.a$(le.y))*he,Z[1]=-S.y*o.eW(b.center.lat)*he}else{const he=b.pointCoordinate(V.sub(S));le&&he&&(Z[0]=he.x-le.x,Z[1]=he.y-le.y)}}const W=b.zoom,ne=[0,0,0];if(P){const le=w(B||b.pointCoordinate3D(V)),he={dir:o.aw([],o.av([],le,b._camera.position))};if(he.dir[2]<0){const ce=b.zoomDeltaToMovement(le,P);o.c5(ne,he.dir,ce)}}const te=o.d8(Z,Z,ne);b._translateCameraConstrained(te),P&&Math.abs(b.zoom-W)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(c,p,!0)}_fireEvents(r,c,p){const y=Np(this._eventsInProgress),b=Np(r),w={};for(const L in r){const{originalEvent:V}=r[L];this._eventsInProgress[L]||(w[`${L}start`]=V),this._eventsInProgress[L]=r[L]}!y&&b&&this._fireEvent("movestart",b.originalEvent);for(const L in w)this._fireEvent(L,w[L]);b&&this._fireEvent("move",b.originalEvent);for(const L in r){const{originalEvent:V}=r[L];this._fireEvent(L,V)}const S={};let P;for(const L in this._eventsInProgress){const{handlerName:V,originalEvent:B}=this._eventsInProgress[L];this._handlersById[V].isActive()||(delete this._eventsInProgress[L],P=c[V]||B,S[`${L}end`]=P)}for(const L in S)this._fireEvent(L,S[L]);const k=Np(this._eventsInProgress);if(p&&(y||b)&&!k){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;L?(V(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:P})):(this._map.fire(new o.z("moveend",{originalEvent:P})),V(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,c){this._map.fire(new o.z(r,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new BI("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const l_="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class _x extends o.E{constructor(r,c){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,o.aY(["_renderFrameCallback"],this)}getCenter(){return new o.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(r,c){return this.jumpTo({center:r},c)}panBy(r,c,p){return r=o.P.convert(r).mult(-1),this.panTo(this.transform.center,Object.assign({offset:r},c),p)}panTo(r,c,p){return this.easeTo(Object.assign({center:r},c),p)}getZoom(){return this.transform.zoom}setZoom(r,c){return this.jumpTo({zoom:r},c),this}zoomTo(r,c,p){return this.easeTo(Object.assign({zoom:r},c),p)}zoomIn(r,c){return this.zoomTo(this.getZoom()+1,r,c),this}zoomOut(r,c){return this.zoomTo(this.getZoom()-1,r,c),this}getBearing(){return this.transform.bearing}setBearing(r,c){return this.jumpTo({bearing:r},c),this}getPadding(){return this.transform.padding}setPadding(r,c){return this.jumpTo({padding:r},c),this}rotateTo(r,c,p){return this.easeTo(Object.assign({bearing:r},c),p)}resetNorth(r,c){return this.rotateTo(0,Object.assign({duration:1e3},r),c),this}resetNorthPitch(r,c){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},r),c),this}snapToNorth(r,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,c):this}getPitch(){return this.transform.pitch}setPitch(r,c){return this.jumpTo({pitch:r},c),this}cameraForBounds(r,c){r=o.aI.convert(r);const p=c&&c.bearing||0,y=c&&c.pitch||0,b=r.getNorthWest(),w=r.getSouthEast();return this._cameraForBounds(this.transform,b,w,p,y,c)}_extendPadding(r){const c={top:0,right:0,bottom:0,left:0};return r==null?Object.assign({},c,this.transform.padding):typeof r=="number"?{top:r,bottom:r,right:r,left:r}:Object.assign({},c,r)}_extendCameraOptions(r){return(r=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=this._extendPadding(r.padding),r}_minimumAABBFrustumDistance(r,c){const p=c.max[0]-c.min[0],y=c.max[1]-c.min[1];return p/y>r.aspect?p/(2*Math.tan(.5*r.fovX)*r.aspect):y/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,c,p,y,b,w){const S=r.clone(),P=this._extendCameraOptions(w);S.bearing=y,S.pitch=b;const k=o.aT.convert(c),L=o.aT.convert(p),V=.5*(k.lat+L.lat),B=.5*(k.lng+L.lng),U=o.eZ(V,B),Z=o.aw([],U),W=o.aw([],o.bI([],Z,[0,1,0])),ne=o.bI([],W,Z),te=[W[0],W[1],W[2],0,ne[0],ne[1],ne[2],0,Z[0],Z[1],Z[2],0,0,0,0,1],le=[U,o.eZ(k.lat,k.lng),o.eZ(L.lat,k.lng),o.eZ(L.lat,L.lng),o.eZ(k.lat,L.lng),o.eZ(V,k.lng),o.eZ(V,L.lng),o.eZ(k.lat,B),o.eZ(L.lat,B)];let he=o.d9.fromPoints(le.map(Ue=>[o.bJ(W,Ue),o.bJ(ne,Ue),o.bJ(Z,Ue)]));const ce=o.af([],he.center,te);o.e_(ce)===0&&o.e$(ce,0,0,1),o.aw(ce,ce),o.c5(ce,ce,o.aD),S.center=o.f0(ce);const Ee=S.getWorldToCameraMatrix(),ye=o.bl(new Float64Array(16),Ee);he=o.d9.applyTransform(he,o.aB([],Ee,te));const we=this._extendAABB(he,S,P,y);if(!we)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");he=we,o.af(ce,ce,Ee);const _e=.5*(he.max[2]-he.min[2]),pe=this._minimumAABBFrustumDistance(S,he),Se=o.c5([],[0,0,1],_e),De=o.d8(Se,ce,Se),Me=pe+(S.pitch===0?0:o.bG(ce,De)),He=S.globeCenterInViewSpace,We=o.av([],ce,[He[0],He[1],He[2]]);o.aw(We,We),o.c5(We,We,Me);const tt=o.d8([],ce,We);o.af(tt,tt,ye);const gt=o.eM/o.aD,Ve=o.ag(tt),Pe=o.cf(Math.max(Ve*gt-o.eM,Number.EPSILON),0),Xe=Math.min(S.zoomFromMercatorZAdjusted(Pe),P.maxZoom);return Xe>.5*(o.c_+o.cL)?(S.setProjection({name:"mercator"}),S.zoom=Xe,this._cameraForBounds(S,c,p,y,b,w)):{center:S.center,zoom:Xe,bearing:y,pitch:b}}_extendAABB(r,c,p,y){const b=.5*((p.padding.left||0)+(p.padding.right||0)),w=.5*((p.padding.top||0)+(p.padding.bottom||0)),S=w,P=b,k=b,L=w,V=c.width-(P+k),B=c.height-(S+L),U=o.av([],r.max,r.min),Z=Math.min(V/U[0],B/U[1]),W=Math.min(c.scaleZoom(c.scale*Z),p.maxZoom);if(isNaN(W))return null;const ne=c.scale/c.zoomScale(W),te=new o.d9([r.min[0]-P*ne,r.min[1]-L*ne,r.min[2]],[r.max[0]+k*ne,r.max[1]+S*ne,r.max[2]]),le=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new o.P(p.offset.x,p.offset.y):o.P.convert(p.offset)).rotate(-o.an(y));return te.center[0]-=le.x*ne,te.center[1]+=le.y*ne,te}queryTerrainElevation(r,c){const p=this.transform.elevation;return p?(c=Object.assign({},{exaggerated:!0},c),p.getAtPoint(o.ae.fromLngLat(r),null,c.exaggerated)):null}_cameraForBounds(r,c,p,y,b,w){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,c,p,y,b,w);const S=r.clone(),P=this._extendCameraOptions(w);S.bearing=y,S.pitch=b;const k=o.aT.convert(c),L=o.aT.convert(p),V=new o.aT(k.lng,L.lat),B=new o.aT(L.lng,k.lat),U=S.project(k),Z=S.project(L),W=this.queryTerrainElevation(k),ne=this.queryTerrainElevation(L),te=this.queryTerrainElevation(V),le=this.queryTerrainElevation(B),he=[[U.x,U.y,Math.min(W||0,ne||0,te||0,le||0)],[Z.x,Z.y,Math.max(W||0,ne||0,te||0,le||0)]];let ce=o.d9.fromPoints(he);const Ee=S.getWorldToCameraMatrix(),ye=o.bl(new Float64Array(16),Ee);ce=o.d9.applyTransform(ce,Ee);const we=this._extendAABB(ce,S,P,y);if(!we)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=we;const _e=.5*o.av([],ce.max,ce.min)[2],pe=this._minimumAABBFrustumDistance(S,ce),Se=[0,0,1,0];o.aC(Se,Se,Ee),o.f1(Se,Se);const De=o.c5([],Se,pe+_e),Me=o.d8([],ce.center,De);o.af(ce.center,ce.center,ye),o.af(Me,Me,ye);const He=S.unproject(new o.P(ce.center[0],ce.center[1])),We=o.f2(S.projection,He),tt=Math.pow(2,We),gt=Math.min(S._zoomFromMercatorZ(Me[2]*S.pixelsPerMeter*tt/S.worldSize),P.maxZoom);return S.mercatorFromTransition&&gt<.5*(o.c_+o.cL)?(S.setProjection({name:"globe"}),S.zoom=gt,this._cameraForBounds(S,c,p,y,b,w)):{center:He,zoom:gt,bearing:y,pitch:b}}fitBounds(r,c,p){const y=this.cameraForBounds(r,c);return this._fitInternal(y,c,p)}fitScreenCoordinates(r,c,p,y,b){const w=o.P.convert(r),S=o.P.convert(c),P=new o.P(Math.min(w.x,S.x),Math.min(w.y,S.y)),k=new o.P(Math.max(w.x,S.x),Math.max(w.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,S))return this;const L=this.transform.pointLocation3D(P),V=this.transform.pointLocation3D(k),B=this.transform.pointLocation3D(new o.P(P.x,k.y)),U=this.transform.pointLocation3D(new o.P(k.x,P.y)),Z=[Math.min(L.lng,V.lng,B.lng,U.lng),Math.min(L.lat,V.lat,B.lat,U.lat)],W=[Math.max(L.lng,V.lng,B.lng,U.lng),Math.max(L.lat,V.lat,B.lat,U.lat)],ne=y&&y.pitch?y.pitch:this.getPitch(),te=this._cameraForBounds(this.transform,Z,W,p,ne,y);return this._fitInternal(te,y,b)}_fitInternal(r,c,p){return r?(c=Object.assign(r,c)).linear?this.easeTo(c,p):this.flyTo(c,p):this}jumpTo(r,c){this.stop();const p=r.preloadOnly?this.transform.clone():this.transform;let y=!1,b=!1,w=!1;"zoom"in r&&p.zoom!==+r.zoom&&(y=!0,p.zoom=+r.zoom),r.center!==void 0&&(p.center=o.aT.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(b=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(w=!0,p.pitch=+r.pitch);const S=typeof r.padding=="number"?this._extendPadding(r.padding):r.padding;if(r.padding!=null&&!p.isPaddingEqual(S))if(r.retainPadding===!1){const P=p.clone();P.padding=S,p.setLocationAtPoint(p.center,P.centerPoint)}else p.padding=S;return r.preloadOnly?(this._preloadTiles(p),this):(this.fire(new o.z("movestart",c)).fire(new o.z("move",c)),y&&this.fire(new o.z("zoomstart",c)).fire(new o.z("zoom",c)).fire(new o.z("zoomend",c)),b&&this.fire(new o.z("rotatestart",c)).fire(new o.z("rotate",c)).fire(new o.z("rotateend",c)),w&&this.fire(new o.z("pitchstart",c)).fire(new o.z("pitch",c)).fire(new o.z("pitchend",c)),this.fire(new o.z("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(l_),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,c){const p=this.transform;if(!p.projection.supportsFreeCamera)return o.w(l_),this;this.stop();const y=p.zoom,b=p.pitch,w=p.bearing;p.setFreeCameraOptions(r);const S=y!==p.zoom,P=b!==p.pitch,k=w!==p.bearing;return this.fire(new o.z("movestart",c)).fire(new o.z("move",c)),S&&this.fire(new o.z("zoomstart",c)).fire(new o.z("zoom",c)).fire(new o.z("zoomend",c)),k&&this.fire(new o.z("rotatestart",c)).fire(new o.z("rotate",c)).fire(new o.z("rotateend",c)),P&&this.fire(new o.z("pitchstart",c)).fire(new o.z("pitch",c)).fire(new o.z("pitchend",c)),this.fire(new o.z("moveend",c)),this}easeTo(r,c){this._stop(!1,r.easeId),((r=Object.assign({offset:[0,0],duration:500,easing:o.eV},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);const p=this.transform,y=this.getZoom(),b=this.getBearing(),w=this.getPitch(),S=this.getPadding(),P="zoom"in r?+r.zoom:y,k="bearing"in r?this._normalizeBearing(r.bearing,b):b,L="pitch"in r?+r.pitch:w,V=this._extendPadding(r.padding),B=o.P.convert(r.offset);let U,Z,W;if(p.projection.name==="globe"){const Se=o.ae.fromLngLat(p.center),De=B.rotate(-p.angle);Se.x+=De.x/p.worldSize,Se.y+=De.y/p.worldSize;const Me=Se.toLngLat(),He=o.aT.convert(r.center||Me);this._normalizeCenter(He),U=p.centerPoint.add(De),Z=new o.P(Se.x,Se.y).mult(p.worldSize),W=new o.P(o.aF(He.lng),o.aJ(He.lat)).mult(p.worldSize).sub(Z)}else{U=p.centerPoint.add(B);const Se=p.pointLocation(U),De=o.aT.convert(r.center||Se);this._normalizeCenter(De),Z=p.project(Se),W=p.project(De).sub(Z)}const ne=p.zoomScale(P-y);let te,le;r.around&&(te=o.aT.convert(r.around),le=p.locationPoint(te));const he=this._zooming||P!==y,ce=this._rotating||b!==k,Ee=this._pitching||L!==w,ye=!p.isPaddingEqual(V),we=r.retainPadding===!1?p.clone():p,_e=Se=>De=>{if(he&&(Se.zoom=o.ak(y,P,De)),ce&&(Se.bearing=o.ak(b,k,De)),Ee&&(Se.pitch=o.ak(w,L,De)),ye&&(we.interpolatePadding(S,V,De),U=we.centerPoint.add(B)),te)Se.setLocationAtPoint(te,le);else{const Me=Se.zoomScale(Se.zoom-y),He=P>y?Math.min(2,ne):Math.max(.5,ne),We=Math.pow(He,1-De),tt=Se.unproject(Z.add(W.mult(De*We)).mult(Me));Se.setLocationAtPoint(Se.renderWorldCopies?tt.wrap():tt,U)}return r.preloadOnly||this._fireMoveEvents(c),Se};if(r.preloadOnly){const Se=this._emulate(_e,r.duration,p);return this._preloadTiles(Se),this}const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=he,this._rotating=ce,this._pitching=Ee,this._padding=ye,this._easeId=r.easeId,this._prepareEase(c,r.noMoveStart,pe),this._ease(_e(p),Se=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(c,Se)},r),this}_prepareEase(r,c,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||p.moving||this.fire(new o.z("movestart",r)),this._zooming&&!p.zooming&&this.fire(new o.z("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new o.z("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new o.z("pitchstart",r))}_fireMoveEvents(r){this.fire(new o.z("move",r)),this._zooming&&this.fire(new o.z("zoom",r)),this._rotating&&this.fire(new o.z("rotate",r)),this._pitching&&this.fire(new o.z("pitch",r))}_afterEase(r,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,y=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new o.z("zoomend",r)),y&&this.fire(new o.z("rotateend",r)),b&&this.fire(new o.z("pitchend",r)),this.fire(new o.z("moveend",r))}flyTo(r,c){if(this._prefersReducedMotion(r)){const Ue=o.aH(r,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ue,c)}this.stop(),r=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:o.eV},r);const p=this.transform,y=this.getZoom(),b=this.getBearing(),w=this.getPitch(),S=this.getPadding(),P="zoom"in r?o.aA(+r.zoom,p.minZoom,p.maxZoom):y,k="bearing"in r?this._normalizeBearing(r.bearing,b):b,L="pitch"in r?+r.pitch:w,V=this._extendPadding(r.padding),B=p.zoomScale(P-y),U=o.P.convert(r.offset);let Z=p.centerPoint.add(U);const W=p.pointLocation(Z),ne=o.aT.convert(r.center||W);this._normalizeCenter(ne);const te=p.project(W),le=p.project(ne).sub(te);let he=r.curve;const ce=Math.max(p.width,p.height),Ee=ce/B,ye=le.mag();if("minZoom"in r){const Ue=o.aA(Math.min(r.minZoom,y,P),p.minZoom,p.maxZoom),lt=ce/p.zoomScale(Ue-y);he=Math.sqrt(lt/ye*2)}const we=he*he;function _e(Ue){const lt=(Ee*Ee-ce*ce+(Ue?-1:1)*we*we*ye*ye)/(2*(Ue?Ee:ce)*we*ye);return Math.log(Math.sqrt(lt*lt+1)-lt)}function pe(Ue){return(Math.exp(Ue)-Math.exp(-Ue))/2}function Se(Ue){return(Math.exp(Ue)+Math.exp(-Ue))/2}const De=_e(0);let Me=function(Ue){return Se(De)/Se(De+he*Ue)},He=function(Ue){return ce*((Se(De)*(pe(lt=De+he*Ue)/Se(lt))-pe(De))/we)/ye;var lt},We=(_e(1)-De)/he;if(Math.abs(ye)<1e-6||!isFinite(We)){if(Math.abs(ce-Ee)<1e-6)return this.easeTo(r,c);const Ue=Ee<ce?-1:1;We=Math.abs(Math.log(Ee/ce))/he,He=function(){return 0},Me=function(lt){return Math.exp(Ue*he*lt)}}r.duration="duration"in r?+r.duration:1e3*We/("screenSpeed"in r?+r.screenSpeed/he:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const tt=b!==k,gt=L!==w,Ve=!p.isPaddingEqual(V),Pe=r.retainPadding===!1?p.clone():p,Xe=Ue=>lt=>{const St=lt*We,Dt=1/Me(St);Ue.zoom=lt===1?P:y+Ue.scaleZoom(Dt),tt&&(Ue.bearing=o.ak(b,k,lt)),gt&&(Ue.pitch=o.ak(w,L,lt)),Ve&&(Pe.interpolatePadding(S,V,lt),Z=Pe.centerPoint.add(U));const bt=lt===1?ne:Ue.unproject(te.add(le.mult(He(St))).mult(Dt));return Ue.setLocationAtPoint(Ue.renderWorldCopies?bt.wrap():bt,Z),Ue._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(c),Ue};if(r.preloadOnly){const Ue=this._emulate(Xe,r.duration,p);return this._preloadTiles(Ue),this}return this._zooming=!0,this._rotating=tt,this._pitching=gt,this._padding=Ve,this._prepareEase(c,!1),this._ease(Xe(p),()=>this._afterEase(c),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(r){}_cancelRenderFrame(r){}_stop(r,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,c)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,c,p){p.animate===!1||p.duration===0?(r(1),c()):(this._easeStart=o.o.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((o.o.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,c){r=o.bT(r,-180,180);const p=Math.abs(r-c);return Math.abs(r-360-c)<p&&(r-=360),Math.abs(r+360-c)<p&&(r+=360),r}_normalizeCenter(r){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const p=r.lng-c.center.lng;r.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&o.o.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,c,p){const y=Math.ceil(15*c/1e3),b=[],w=r(p.clone());for(let S=0;S<=y;S++){const P=w(S/y);b.push(P.clone())}return b}_preloadTiles(r,c){}}class Op{constructor(r={}){this.options=r,o.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const c=this.options&&this.options.compact,p=r._getUIString("AttributionControl.ToggleAttribution");this._map=r,this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=H("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const y=H("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",p),this._innerContainer=H("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(r){const p=c.reduce((y,b,w)=>(b.value&&(y+=`${b.key}=${b.value}${w<c.length-1?"&":""}`),y),"?");r.href=`${o.e.FEEDBACK_URL}/${p}#${Jr(this._map,!0)}`,r.rel="noopener nofollow"}}_updateData(r){!r||(r.dataType!=="source"||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility")&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const c=this._map.style._mergedSourceCaches;for(const y in c){const b=c[y];if(b.used){const w=b.getSource();w.attribution&&r.indexOf(w.attribution)<0&&r.push(w.attribution)}}r.sort((y,b)=>y.length-b.length),r=r.filter((y,b)=>{for(let w=b+1;w<r.length;w++)if(r[w].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const p=r.map(y=>function(b){const w=new DOMParser().parseFromString(b,"text/html");return Array.from(w.body.querySelectorAll("*")).forEach(S=>{const P=S.textContent||"";if(S.tagName!=="A")return void S.replaceWith(w.createTextNode(P));const k=S.getAttribute("href");if(!k||!/^(https?:|mailto:)/i.test(k))return void S.replaceWith(w.createTextNode(P));const L=w.createElement("a");L.href=k,L.textContent=P,L.rel="noopener nofollow";const V=S.getAttribute("class");V&&(L.className=V),S.replaceWith(L)}),w.body.innerHTML}(y)).join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Fp{constructor(){o.aY(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=H("div","mapboxgl-ctrl");const c=H("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const c in r){const p=r[c].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const c=r[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Ah{constructor(){o.aY(["_onIndoorUpdate"],this)}onAdd(r){return this._map=r,this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",c=>this._onIndoorUpdate(c)),this._container}_createButton(r,c){const p=H("button",r,this._container);return p.type="button",p.addEventListener("click",c),p}_createSeparator(){return H("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(r,c){this._map&&(r.setAttribute("aria-label",c),r.textContent=c)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(r){if(!r||!r.floors)return this._model=r,void(this._container.style.display="none");const c=this._model;this._model=r,this._container.style.display="inline-block",this._container.style.borderRadius="8px",c&&Array.from(this._container.children).forEach(p=>p.remove()),r.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(r.floors,r.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const r=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const c=this._map;this._model&&c&&c._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});H("span","mapboxgl-ctrl-icon",r).setAttribute("aria-hidden","true"),r.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&r.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(r),this._createSeparator()}_updateBuildingsButtonState(){const r=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");r&&this._model&&(this._model.activeFloorsVisible?r.classList.remove("mapboxgl-ctrl-level-button-selected"):r.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(r,c){for(let p=0;p<r.length;p++){const y=r[p],b=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(y.id)});this._setButtonTitle(b,y.zIndex.toString()),this._model&&y.id===this._model.selectedFloorId&&c&&b.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(b),p<r.length-1&&this._createSeparator()}}}class yc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const c=++this._id;return this._queue.push({callback:r,id:c,cancelled:!1}),c}remove(r){const c=this._currentlyRunning,p=c?this._queue.concat(c):this._queue;for(const y of p)if(y.id===r)return void(y.cancelled=!0)}run(r=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const p of c)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class vc{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const c=o.dD((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,c,p){this._start=this.getValue(c),this._end=r,this._startTime=c,this._endTime=c+p}}const xc={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Iu extends o.z{constructor(r,c,p,y){const{point:b,lngLat:w,originalEvent:S,target:P}=r;super(r.type,{point:b,lngLat:w,originalEvent:S,target:P}),this.preventDefault=()=>{r.preventDefault()},this.id=c,this.interaction=p,this.feature=y}}class dl{constructor(r){this.map=r,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(r,c){if(this.typeById.has(r))throw new Error(`Interaction id "${r}" already exists.`);const p=c.filter;let y=c.type;p&&this.filters.set(r,o.b6(p)),y==="mouseover"&&(y="mouseenter"),y==="mouseout"&&(y="mouseleave");const b=this.interactionsByType.get(y)||new Map;y==="mouseenter"||y==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(r,c)):b.size===0&&this.map.on(y,this.handleType),b.size===0&&this.interactionsByType.set(y,b),b.set(r,c),this.typeById.set(r,y)}get(r){const c=this.typeById.get(r);if(!c)return;const p=this.interactionsByType.get(c);return p?p.get(r):void 0}remove(r){const c=this.typeById.get(r);if(!c)return;this.typeById.delete(r),this.filters.delete(r);const p=this.interactionsByType.get(c);p&&(p.delete(r),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(r),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(c,this.handleType))}queryTargets(r,c){const p=[];for(const[y,b]of c)b.target&&p.push({targetId:y,target:b.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(r,p,this.map.transform)}handleMove(r){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const c=this.queryTargets(r.point,Array.from(this.delegatedInteractions).reverse());c.length&&(r.type="mouseenter",this.handleType(r,c));const p=new Map;for(const[y,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(y)||p.set(b.id,b);p.size&&(r.type="mouseleave",this.handleType(r,Array.from(p.values())))}handleOut(r){const c=Array.from(this.hoveredFeatures.values()).map(({feature:p})=>p);c.length&&(r.type="mouseleave",this.handleType(r,c)),this.hoveredFeatures.clear()}handleType(r,c){const p=r.type==="mouseenter";if(p&&!this.interactionsByType.has(r.type))return void o.w("mouseenter interaction required for mouseleave to work.");const y=Array.from(this.interactionsByType.get(r.type)).reverse(),b=!!c;c=c||this.queryTargets(r.point,y);let w=!1;const S=new Set;for(const P of c){for(const[k,L]of y){if(!L.target)continue;const V=P.variants?P.variants[k]:null;if(V){for(const B of V){if(oh(B,P,S,k))continue;const U=new o.dx(P,B),Z=od(B,P,k);b&&U.id!==void 0&&(U.state=this.map.getFeatureState(U));const W=p?this.prevHoveredFeatures.get(Z):null,ne=new Iu(r,k,L,U),te=W?W.stop:L.handler(ne);if(p&&this.hoveredFeatures.set(Z,{feature:P,stop:te}),te!==!1){w=!0;break}}if(w)break}}if(w)break}if(!w)for(const[P,k]of y){const{handler:L,target:V}=k;if(!V&&L(new Iu(r,P,k,null))!==!1)break}}}function UI(f,r){if(Array.isArray(f)&&Array.isArray(r)){const c=new Set(f),p=new Set(r);return c.size===p.size&&f.every(y=>p.has(y))}return o.by(f,r)}const $I={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},GI={showCompass:!0,showZoom:!0,visualizePitch:!1};class HI{constructor(r,c,p=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new fx({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,p&&(this.mousePitch=new px({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),o.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(r,c){this.mouseRotate.mousedown(r,c),this.mousePitch&&this.mousePitch.mousedown(r,c),ue()}move(r,c){const p=this.map,y=this.mouseRotate.mousemoveWindow(r,c),b=y&&y.bearingDelta;if(b&&p.setBearing(p.getBearing()+b),this.mousePitch){const w=this.mousePitch.mousemoveWindow(r,c),S=w&&w.pitchDelta;S&&p.setPitch(p.getPitch()+S)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){xe(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(Object.assign({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Be(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,Be(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ot(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=ot(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function yx(f,r,c){if(f=new o.aT(f.lng,f.lat),r){const p=new o.aT(f.lng-360,f.lat),y=new o.aT(f.lng+360,f.lat),b=360*Math.ceil(Math.abs(f.lng-c.center.lng)/360),w=c.locationPoint3D(f).distSqr(r),S=r.x<0||r.y<0||r.x>c.width||r.y>c.height;c.locationPoint3D(p).distSqr(r)<w&&(S||Math.abs(p.lng-c.center.lng)<b)?f=p:c.locationPoint3D(y).distSqr(r)<w&&(S||Math.abs(y.lng-c.center.lng)<b)&&(f=y)}for(;Math.abs(f.lng-c.center.lng)>180;){const p=c.locationPoint3D(f);if(p.x>=0&&p.y>=0&&p.x<=c.width&&p.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}const Ys={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Fa={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class c_ extends o.E{constructor(r,c){super(),(r instanceof HTMLElement||c)&&(r=Object.assign({element:r},c)),o.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:p="center",color:y="#3FB1CE",scale:b=1,draggable:w=!1,clickTolerance:S=0,rotation:P=Fa.rotation,rotationAlignment:k=Fa.rotationAlignment,pitchAlignment:L=Fa.pitchAlignment,occludedOpacity:V=Fa.occludedOpacity,altitude:B=Fa.altitude}=r||{};this._anchor=p,this._color=y,this._scale=b,this._draggable=w,this._clickTolerance=S,this._rotation=P,this._rotationAlignment=k,this._pitchAlignment=L,this._occludedOpacity=V,this._altitude=B,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),r&&r.element?(this._element=r.element,this._offset=o.P.convert(r&&r.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(r&&r.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",W=>{W.preventDefault()}),this._element.addEventListener("mousedown",W=>{W.preventDefault()});const U=this._element.classList;for(const W in Ys)U.remove(`mapboxgl-marker-anchor-${W}`);U.add(`mapboxgl-marker-anchor-${this._anchor}`);const Z=r&&r.className?r.className.trim().split(/\s+/):[];U.add(...Z),this._popup=null}_createDefaultMarker(){const r=H("div"),c=re("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},r);if(this._altitude===0){const p=re("radialGradient",{id:"shadowGradient"},re("defs",{},c));re("stop",{offset:"10%","stop-opacity":.4},p),re("stop",{offset:"100%","stop-opacity":.05},p),re("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return re("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),re("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),re("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),r}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.aT.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(r){return r===this._altitude||(this._defaultMarker&&(this._altitude===0&&r!==0||this._altitude!==0&&r===0)&&(this._element=this._createDefaultMarker()),this._altitude=r||Fa.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,r._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const c=r.code,p=r.charCode||r.keyCode;c!=="Space"&&c!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(r){const c=r.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,c=this._pos;if(!r||!c)return!1;const p=r.unproject(c,this._altitude),y=r.getFreeCameraOptions();if(!y.position)return!1;const b=y.position.toLngLat();return b.distanceTo(p)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const c=this._pos;if(!c||c.x<0||c.x>r.transform.width||c.y<0||c.y>r.transform.height)return void this._clearFadeTimer();const p=r.unproject(c,this._altitude);let y;r._showingGlobe()&&o.f5(r.transform,this._lngLat)?y=0:(y=1-r._queryFogOpacity(p),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${Ys[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const r=this._pos,c=this._map,p=this.getPitchAlignment();if(!c||!r||p!=="map")return"";if(!c._showingGlobe()){const P=c.getPitch();return P?`rotateX(${P}deg)`:""}const y=o.cX(o.f6(c.transform,this._lngLat)),b=r.sub(o.f7(c.transform)),w=Math.abs(b.x)+Math.abs(b.y);if(w===0)return"";const S=y/w;return`rotateX(${-b.y*S}deg) rotateY(${b.x*S}deg)`}_calculateZTransform(){const r=this._pos,c=this._map;if(!c||!r)return"";let p=0;const y=this.getRotationAlignment();if(y==="map")if(c._showingGlobe()){const b=c.project(new o.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),w=c.project(new o.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(b);p=o.cX(Math.atan2(w.y,w.x))-90}else p=-c.getBearing();else if(y==="horizon"){const b=o.ah(4,6,c.getZoom()),w=o.f7(c.transform);w.y+=b*c.transform.height;const S=r.sub(w),P=o.cX(Math.atan2(S.y,S.x));p=(P>90?P-270:P+90)*(1-b)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=yx(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),r===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=o.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){const c=this._map;if(!c)return;const p=this._pointerdownPos,y=this._positionDelta;if(p&&y){if(!this._isDragging){const b=this._clickTolerance||c._clickTolerance;if(r.point.dist(p)<b)return;this._isDragging=!0}this._pos=r.point.sub(y),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.z("dragstart"))),this.fire(new o.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.z("dragend")),this._state="inactive"}_addDragHandler(r){const c=this._map,p=this._pos;c&&p&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(p),this._pointerdownPos=r.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const c=this._map;return c&&(r?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||Fa.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||Fa.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||Fa.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||Fa.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const WI={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ph={maxWidth:100,unit:"metric"},vx={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},za={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},ja=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Sd(f=new o.P(0,0),r="bottom"){if(typeof f=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(r){case"top":return new o.P(0,f);case"top-left":return new o.P(c,c);case"top-right":return new o.P(-c,c);case"bottom":return new o.P(0,-f);case"bottom-left":return new o.P(c,-c);case"bottom-right":return new o.P(-c,-c);case"left":return new o.P(f,0);case"right":return new o.P(-f,0)}return new o.P(0,0)}return f instanceof o.P||Array.isArray(f)?o.P.convert(f):o.P.convert(f[r]||[0,0])}return{version:I,supported:J.supported,setRTLTextPlugin:o.fb,getRTLTextPluginStatus:o.fa,Map:class extends _x{constructor(f){N.mark(A.create);const r=f;if((f=Object.assign({},$I,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&o.f3(window)&&(f.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new wv(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies,null,null),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new yc,this._domRenderTaskQueue=new yc,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.b2(),this._locale=Object.assign({},xc,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new vc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new Kt(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const c=document.getElementById(f.container);if(!c)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=c}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,o.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new VI(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||o.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new sx(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){r.center==null&&r.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const c=f.bounds;c&&(this.resize(),this.fitBounds(c,Object.assign({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Op({customAttribution:f.customAttribution})),this._logoControl=new Fp,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new o.z(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new o.z(`${c.dataType}dataloading`,c))}),this._interactions=new dl(this)}_getMapId(){return this._mapId}addControl(f,r){if(r===void 0&&(r=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new o.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[r];return r.indexOf("bottom")!==-1?p.insertBefore(c,p.firstChild):p.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new o.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(f);return r>-1&&this._controls.splice(r,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new o.z("movestart",f)).fire(new o.z("move",f)),this.fire(new o.z("resize",f)),r&&this.fire(new o.z("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(o.aI.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._scaleFactorChanged=!0,this.style._updateFilteredLayers(r=>r.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(r=>r==="auto"?navigator.language:r):f}setLanguage(f){const r=this._parseLanguage(f);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,r=f.projection.name;let c;r==="globe"&&f.zoom>=o.cL?(f.setMercatorFromTransition(),c=!0):r==="mercator"&&f.zoom<o.cL&&(f.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(f,r){return this._updateProjection(f||r||{name:"mercator"})}_updateProjection(f){let r;const c=this.transform.mercatorFromTransition;r=f.name==="globe"&&this.transform.zoom>=o.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate();const p=this.transform.getProjection().name==="mercator"&&c!==this.transform.mercatorFromTransition;return(r||p)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f,r){return this.transform.locationPoint3D(o.aT.convert(f),r)}unproject(f,r){return this.transform.pointLocation3D(o.P.convert(f),r)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,r,c){const p=y=>{let b=[];if(Array.isArray(r)){const w=r.filter(S=>this.getLayer(S));b=w.length?this.queryRenderedFeatures(y,{layers:w}):[]}else b=this.queryRenderedFeatures(y,{target:r});return b};if(f==="mouseenter"||f==="mouseover"){let y=!1;return{listener:c,targets:r,delegates:{mousemove:w=>{const S=p(w.point);S.length?y||(y=!0,c.call(this,new Do(f,this,w.originalEvent,{features:S}))):y=!1},mouseout:()=>{y=!1}}}}if(f==="mouseleave"||f==="mouseout"){let y=!1;return{listener:c,targets:r,delegates:{mousemove:S=>{p(S.point).length?y=!0:y&&(y=!1,c.call(this,new Do(f,this,S.originalEvent)))},mouseout:S=>{y&&(y=!1,c.call(this,new Do(f,this,S.originalEvent)))}}}}{const y=b=>{const w=p(b.point);w.length&&(b.features=w,c.call(this,b),delete b.features)};return{listener:c,targets:r,delegates:{[f]:y}}}}on(f,r,c){if(typeof r=="function"||c===void 0)return super.on(f,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const p=this._createDelegatedListener(f,r,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const y in p.delegates)this.on(y,p.delegates[y]);return this}once(f,r,c){if(typeof r=="function"||c===void 0)return super.once(f,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const p=this._createDelegatedListener(f,r,c);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(f,r,c){if(typeof r=="function"||c===void 0)return super.off(f,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const p=this._delegatedListeners?this._delegatedListeners[f]:void 0;return p&&(y=>{for(let b=0;b<y.length;b++){const w=y[b];if(w.listener===c&&UI(w.targets,r)){for(const S in w.delegates)this.off(S,w.delegates[S]);return y.splice(b,1),this}}})(p),this}queryRenderedFeatures(f,r){if(!this.style)return[];if(f===void 0||f instanceof o.P||Array.isArray(f)||r!==void 0||(r=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!r){const b=this.style.queryRenderedFeatures(f,void 0,this.transform),w=this.style.queryRenderedFeatureset(f,void 0,this.transform);return b.concat(w)}let c=!0;if(r.target&&(c=this._isTargetValid(r.target),c&&!r.layers))return this.style.queryRenderedFeatureset(f,r,this.transform);let p=!0;if(r.layers&&Array.isArray(r.layers)){for(const b of r.layers)if(!this._isValidId(b)){p=!1;break}if(p&&!r.target)return this.style.queryRenderedFeatures(f,r,this.transform)}let y=[];return p&&(y=y.concat(this.style.queryRenderedFeatures(f,r,this.transform))),c&&(y=y.concat(this.style.queryRenderedFeatureset(f,r,this.transform))),y}querySourceFeatures(f,r){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,r)}queryRasterValue(f,r,c){return this._isValidId(f)?this.style.queryRasterValue(f,r,c):Promise.resolve(null)}isPointOnSurface(f){const{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&o.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(f))}addInteraction(f,r){return this._interactions.add(f,r),this}removeInteraction(f){return this._interactions.remove(f),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this}setStyle(f,r){return r=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&f&&r.diff!==!1&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(f,(c,p)=>{if(c){const y=typeof c=="string"?c:c instanceof Error?c.message:c.error;o.w(`Unable to perform style diff: ${y}. Rebuilding the style from scratch.`),this._updateStyle(f,r)}else p&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(f,r))}_getUIString(f){const r=this._locale[f];if(r==null)throw new Error(`Missing UI string '${f}'`);return r}_updateStyle(f,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const c=Object.assign({},r);r&&r.config&&(c.initialConfig=r.config,delete c.config),this.style=new Oa(this,c).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Oa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new o.y(new Error("IDs can't be empty."))),!1):!o.dr(f)||(this.fire(new o.y(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const r of f)if(!this._isValidId(r))return!1;return!0}return this._isTargetValid(f)}addSource(f,r){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,r),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,r,c){this._lazyInitEmptyStyle(),this.style.addSourceType(f,r,c)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,r,{pixelRatio:c=1,sdf:p=!1,stretchX:y,stretchY:b,content:w}={}){this._lazyInitEmptyStyle();const S=o.I.from(f);if(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:P,height:k,data:L}=o.o.getImageData(r);this.style.addImage(S,{data:new o.q({width:P,height:k},L),pixelRatio:c,stretchX:y,stretchY:b,content:w,sdf:p,version:0,usvg:!1})}else if(r.width===void 0||r.height===void 0)this.fire(new o.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:P,height:k}=r,L=r;this.style.addImage(S,{data:new o.q({width:P,height:k},new Uint8Array(L.data)),pixelRatio:c,stretchX:y,stretchY:b,content:w,sdf:p,usvg:!1,version:0,userImage:L}),L.onAdd&&L.onAdd(this,f)}}updateImage(f,r){this._lazyInitEmptyStyle();const c=o.I.from(f),p=this.style.getImage(c);if(!p)return void this.fire(new o.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?o.o.getImageData(r):r,{width:b,height:w,data:S}=y;if(b===void 0||w===void 0)return void this.fire(new o.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||w!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new o.y(new Error(`The width and height of the updated image (${b}, ${w})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));const P=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);let k=!1;p.usvg?(p.data=new o.q({width:b,height:w},new Uint8Array(S)),p.usvg=!1,p.icon=void 0,k=!0):p.data.replace(S,P),this.style.updateImage(c,p,k)}hasImage(f){return f?!!this.style&&!!this.style.getImage(o.I.from(f)):(this.fire(new o.y(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(o.I.from(f))}loadImage(f,r){o.n(this._requestManager.transformRequest(f,o.R.Image),(c,p)=>{r(c,p instanceof HTMLImageElement?o.o.getImageData(p):p)})}listImages(){return this.style.listImages().map(f=>f.name)}addModel(f,r){this._lazyInitEmptyStyle(),this.style.addModel(f,r)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new o.y(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,r){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,r),this._update(!0)):this}getSlot(f){const r=this.getLayer(f);return r&&r.slot||null}setSlot(f,r){return this.style.setSlot(f,r),this.style.mergeLayers(),this._update(!0)}addImport(f,r){return this.style.addImport(f,r).catch(c=>this.fire(new o.y(new Error("Failed to add import",c)))),this}updateImport(f,r){return typeof r!="string"&&r.id!==f?(this.removeImport(f),this.addImport(r)):(this.style.updateImport(f,r),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,r){return this.style.moveImport(f,r),this._update(!0)}moveLayer(f,r){return this._isValidId(f)?(this.style.moveLayer(f,r),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const r=this.style.getOwnLayer(f);return r?r.type==="custom"?r.implementation:r.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,r,c){return this._isValidId(f)?(this.style.setLayerZoomRange(f,r,c),this._update(!0)):this}setFilter(f,r,c={}){return this._isValidId(f)?(this.style.setFilter(f,r,c),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,r,c,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,r,c,p),this._update(!0)):this}getPaintProperty(f,r){return this._isValidId(f)?this.style.getPaintProperty(f,r):null}setLayoutProperty(f,r,c,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,r,c,p),this._update(!0)):this}getLayoutProperty(f,r){return this._isValidId(f)?this.style.getLayoutProperty(f,r):null}setLayerProperty(f,r,c,p={}){return this._isValidId(f)?(r==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(f,r,c,p),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(f){return this.style.setGlyphsUrl(f),this._update(!0)}getSchema(f){return this.style.getSchema(f)}setSchema(f,r){return this.style.setSchema(f,r),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,r){return this.style.setConfig(f,r),this._update(!0)}getConfigProperty(f,r){return this.style.getConfigProperty(f,r)}setConfigProperty(f,r,c){return this.style.setConfigProperty(f,r,c),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const r=f[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,r){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,r),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.aT.convert(f),this.transform):0}setFeatureState(f,r){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,r),this._update())}removeFeatureState(f,r){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,r),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_selectIndoorFloor(f){this.indoor.selectFloor(f)}_setIndoorActiveFloorsVisibility(f){this.indoor.setActiveFloorsVisibility(f)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Ah),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let c,p,y,b=this._container;for(;b&&(!p||!y);){const w=window.getComputedStyle(b).transform;w&&w!=="none"&&(c=w.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(p=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(y=c[3])),b=b.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=y?Math.abs(r/y):r}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new Db(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=H("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=H("div","mapboxgl-canvas-container",f);this._canvas=H("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=H("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(y=>{p[y]=H("div",`mapboxgl-ctrl-${y}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,r){const c=o.o.devicePixelRatio||1;this._canvas.width=c*Math.ceil(f),this._canvas.height=c*Math.ceil(r),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${r}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const r=this._markers.indexOf(f);r!==-1&&this._markers.splice(r,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const r=this._popups.indexOf(f);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const f=Object.assign({},J.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",f);r?(Kr(r,!0),this.painter=new Kg(r,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.k.testSupport(r)):this.fire(new o.y(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.z("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.z("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let r;this.fire(new o.z("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,p=o.o.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=y.createQuery(),y.beginQuery(c.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,L=this.transform.pitch,V=o.o.now(),B=new o.ac(k,{now:V,fadeDuration:b,pitch:L,transition:this.style.transition,worldview:this._worldview});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(p);const S=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),S&&(this._placementDirty=S.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,N.mark(A.load),this.fire(new o.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const k=o.o.now()-p;y.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const L=y.getQueryParameter(r,y.QUERY_RESULT)/1e6;y.deleteQuery(r),this.fire(new o.z("gpu-timing-frame",{cpuTime:k,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const L=this.painter.queryGpuTimers(k);this.fire(new o.z("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){const k=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const L=this.painter.queryGpuTimeDeferredRender(k);this.fire(new o.z("gpu-timing-deferred-render",{gpuTime:L}))},50)}const P=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(P||this._repaint)this.triggerRepaint();else{const k=this.idle();if(k&&(w=this._updateAverageElevation(p,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new o.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new o.z("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||P||(this._fullyLoaded=!0,N.mark(A.fullLoad),this._performanceMetricsCollection&&Mi(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const r of this._markers)f&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!f||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(f,r=!1){const c=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(r||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const y=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=f;const w=Math.abs(y-b);if(w>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(b),c(b);this._averageElevation.easeTo(b,f,300)}else if(w>1e-4)return this._averageElevation.jumpTo(b),c(b)}return!!this._averageElevation.isEasing(f)&&c(this._averageElevation.getValue(f))}_authenticate(){fo(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===zt||f.status===401)){const r=this.painter.context.gl;Kr(r,!1),this._logoControl instanceof Fp&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Ji(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&_n(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&pn(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){si(this._requestManager._customAccessToken)}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const c=this.painter.context.gl,p=c.createFramebuffer();function y(b){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,b,0);const w=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,w),w}return c.bindFramebuffer(c.FRAMEBUFFER,p),this._canvasPixelComparison(y(f),r.canvasCopies.map(y),r.timeStamps)}_canvasPixelComparison(f,r,c){let p=c[1]-c[0];const y=f.length/4;for(let b=0;b<r.length;b++){const w=r[b];let S=0;for(let P=0;P<w.length;P+=4)w[P]===f[P]&&w[P+1]===f[P+1]&&w[P+2]===f[P+2]&&w[P+3]===f[P+3]&&(S+=1);p+=(c[b+2]-c[b+1])*(1-S/y)}return p}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),ls.delete(this.painter.context.gl),Ts.remove(),qt.remove(),this._removed=!0,this.fire(new o.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=o.o.frame(r=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(r)}))}_preloadTiles(f){const r=this.style?this.style.getSourceCaches():[];return o.bw(r,(c,p)=>c._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this.style&&f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,f&&this._update())}_setCacheLimits(f,r){o.f4(f,r)}get version(){return I}},NavigationControl:class{constructor(f={}){this.options=Object.assign({},GI,f),this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(o.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),H("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),H("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:r}):c.resetNorth({},{originalEvent:r}))}),this._compassIcon=H("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const r=f.getZoom(),c=r===f.getMaxZoom(),p=r===f.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new HI(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,r){const c=H("button",f,this._container);return c.type="button",c.addEventListener("click",r),c}_setButtonTitle(f,r){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${r}`);f.setAttribute("aria-label",c),f.firstElementChild&&f.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends o.E{constructor(f={}){super();const r=navigator.geolocation;this.options=Object.assign({geolocation:r},WI,f),o.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Xg(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const r=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,f(c)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>r(c.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(f){const r=this._map.getMaxBounds(),c=f.coords;return!!r&&(c.longitude<r.getWest()||c.longitude>r.getEast()||c.latitude<r.getSouth()||c.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new o.z("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("geolocate",Object.assign({coords:f.coords,timestamp:f.timestamp},f.toJSON?{toJSON:f.toJSON.bind(f)}:{}))),this._finish()}}_updateCamera(f){const r=new o.aT(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,p=this._map.getBearing(),y=Object.assign({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(c),y,{geolocateSource:!0})}_updateMarker(f){if(f){const r=new o.aT(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,r=o.cf(1,f._center.lat)*f.worldSize,c=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=H("button","mapboxgl-ctrl-geolocate",this._container),H("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=H("div","mapboxgl-user-location"),this._dotElement.appendChild(H("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(H("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new c_({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=H("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new c_({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.z("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Op,ScaleControl:class{constructor(f={}){this.options=Object.assign({},Ph,f),o.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,r=this._map,c=r._containerHeight/2,p=r._containerWidth/2-f/2,y=r.unproject([p,c]),b=r.unproject([p+f,c]),w=y.distanceTo(b);if(this.options.unit==="imperial"){const S=3.2808*w;S>5280?this._setScale(f,S/5280,"mile"):this._setScale(f,S,"foot")}else this.options.unit==="nautical"?this._setScale(f,w/1852,"nautical-mile"):w>=1e3?this._setScale(f,w/1e3,"kilometer"):this._setScale(f,w,"meter")}_setScale(f,r,c){this._map._requestDomTask(()=>{const p=function(b){const w=Math.pow(10,`${Math.floor(b)}`.length-1);let S=b/w;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(P){const k=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*k)/k}(S),w*S}(r),y=p/r;this._container.innerHTML=c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(p):`${p}&nbsp;${vx[c]}`,this._container.style.width=f*y+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:o.w("Full screen control 'container' must be a DOM element.")),o.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=H("button","mapboxgl-ctrl-fullscreen",this._controlContainer);H("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Ah,Popup:class extends o.E{constructor(f){super(),this.options=Object.assign(Object.create(za),f),this._altitude=this.options.altitude,o.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new o.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new o.z("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=o.aT.convert(f),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(f){return this._altitude=f,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const r=document.createDocumentFragment(),c=document.createElement("body");let p;for(c.innerHTML=f;p=c.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=H("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(f),this.options.closeButton){const c=this._closeButton=H("button","mapboxgl-popup-close-button",r);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let r;return this._classList.delete(f)?r=!1:(this._classList.add(f),r=!0),this._updateClassList(),r}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const r=this._map,c=this._container,p=this._pos;if(!r||!c||!p)return"bottom";const y=c.offsetWidth,b=c.offsetHeight,w=p.x<y/2,S=p.x>r.transform.width-y/2;if(p.y+f<b)return w?"top-left":S?"top-right":"top";if(p.y>r.transform.height-b){if(w)return"bottom-left";if(S)return"bottom-right"}return w?"left":S?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),f.className=r.join(" ")}_update(f){const r=this._map,c=this._content;if(!r||!this._lngLat&&!this._trackPointer||!c)return;let p=this._container;if(p||(p=this._container=H("div","mapboxgl-popup",r.getContainer()),this._tip=H("div","mapboxgl-popup-tip",p),p.appendChild(c)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=yx(this._lngLat,this._pos,r.transform)),!this._trackPointer||f){const y=this._pos=this._trackPointer&&f instanceof o.P?f:r.project(this._lngLat,this._altitude),b=Sd(this.options.offset),w=this._anchor=this._getAnchor(b.y),S=Sd(this.options.offset,w),P=y.add(S).round();r._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${Ys[w]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&r._showingGlobe()){const y=o.f5(r.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(ja);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:c_,Style:Oa,LngLat:o.aT,LngLatBounds:o.aI,Point:o.P,MercatorCoordinate:o.ae,FreeCameraOptions:yo,Evented:o.E,config:o.e,prewarm:o.f9,clearPrewarmedResources:o.f8,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(f){o.e.ACCESS_TOKEN=f},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(f){o.e.API_URL=f},get workerCount(){return o.fi.workerCount},set workerCount(f){o.fi.workerCount=f},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){o.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){o.fh(f)},get workerUrl(){return o.fg.workerUrl},set workerUrl(f){o.fg.workerUrl=f},get workerClass(){return o.fg.workerClass},set workerClass(f){o.fg.workerClass=f},get workerParams(){return o.fg.workerParams},set workerParams(f){o.fg.workerParams=f},get dracoUrl(){return o.ff()},set dracoUrl(f){o.fe(f)},get meshoptUrl(){return o.fd()},set meshoptUrl(f){o.fc(f)},setNow:o.o.setNow,restoreNow:o.o.restoreNow}});var v=d;return v})})(z7);var Pve=z7.exports;const Mr=H1(Pve);function Rve({onLocationSelect:e,initialLocation:t,franchiseZone:i,franchiseName:l}){const d=q.useRef(null),m=q.useRef(null),v=q.useRef(null),[o,I]=q.useState(!0),[A,N]=q.useState(!1),[F,z]=q.useState("Tap on map to select location"),[$,J]=q.useState(!1),[H,re]=q.useState(!0),Q=async(xe,Oe)=>{try{const Be=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${Oe},${xe}.json?access_token=${jf}`)).json();return Be.features&&Be.features.length>0?Be.features[0].place_name:"Unknown location"}catch(ze){return console.error("Geocoding error:",ze),"Unknown location"}},ee=(xe,Oe)=>i?$C({lat:xe,lng:Oe},i):!0,ie=async xe=>{if(!m.current)return;N(!0);const Oe=ee(xe.lat,xe.lng);re(Oe);const ze=Oe?"#f97316":"#ef4444";v.current?(v.current.setLngLat([xe.lng,xe.lat]),v.current.remove(),v.current=new Mr.Marker({color:ze,draggable:!0}).setLngLat([xe.lng,xe.lat]).addTo(m.current),v.current.on("dragend",async()=>{var Et;const ot=(Et=v.current)==null?void 0:Et.getLngLat();if(ot){N(!0);const Zt=ee(ot.lat,ot.lng);re(Zt);const at=await Q(ot.lat,ot.lng);z(at),e({lat:ot.lat,lng:ot.lng,address:at,isInZone:Zt}),N(!1)}})):(v.current=new Mr.Marker({color:ze,draggable:!0}).setLngLat([xe.lng,xe.lat]).addTo(m.current),v.current.on("dragend",async()=>{var Et;const ot=(Et=v.current)==null?void 0:Et.getLngLat();if(ot){N(!0);const Zt=ee(ot.lat,ot.lng);re(Zt);const at=await Q(ot.lat,ot.lng);z(at),e({lat:ot.lat,lng:ot.lng,address:at,isInZone:Zt}),N(!1)}}));const Be=await Q(xe.lat,xe.lng);z(Be),e({lat:xe.lat,lng:xe.lng,address:Be,isInZone:Oe}),N(!1)},ue=()=>{"geolocation"in navigator&&(N(!0),navigator.geolocation.getCurrentPosition(async xe=>{const{latitude:Oe,longitude:ze}=xe.coords;m.current&&m.current.flyTo({center:[ze,Oe],zoom:16,duration:1500}),await ie({lat:Oe,lng:ze})},xe=>{console.error("Location error:",xe),N(!1)},{enableHighAccuracy:!0}))};return q.useEffect(()=>{if(!d.current)return;Mr.accessToken=jf;const xe=t?[t.lng,t.lat]:[78.4867,17.385];return m.current=new Mr.Map({container:d.current,style:"mapbox://styles/mapbox/streets-v12",center:xe,zoom:14,attributionControl:!1}),m.current.on("load",()=>{if(I(!1),i&&m.current){m.current.addSource("franchise-zone",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:i.coordinates}}}),m.current.addLayer({id:"franchise-zone-fill",type:"fill",source:"franchise-zone",paint:{"fill-color":"#f97316","fill-opacity":.1}}),m.current.addLayer({id:"franchise-zone-border",type:"line",source:"franchise-zone",paint:{"line-color":"#f97316","line-width":2,"line-dasharray":[2,1]}});const Oe=i.coordinates[0],ze=new Mr.LngLatBounds;Oe.forEach(Be=>ze.extend([Be[0],Be[1]])),m.current.fitBounds(ze,{padding:50})}t?ie({lat:t.lat,lng:t.lng}):ue()}),m.current.on("click",async Oe=>{await ie({lat:Oe.lngLat.lat,lng:Oe.lngLat.lng})}),m.current.addControl(new Mr.NavigationControl({showCompass:!1}),"bottom-right"),()=>{var Oe;(Oe=m.current)==null||Oe.remove()}},[]),E.jsxs("div",{className:"space-y-3",children:[E.jsxs("div",{className:"relative rounded-xl overflow-hidden transition-all duration-300",style:{height:$?"450px":"250px"},children:[E.jsx("div",{ref:d,className:"absolute inset-0",style:{marginBottom:"-30px",height:"calc(100% + 30px)"}}),o&&E.jsx("div",{className:"absolute inset-0 bg-secondary flex items-center justify-center",children:E.jsx(kr,{className:"w-6 h-6 animate-spin text-primary"})}),E.jsxs("div",{className:"absolute top-3 left-3 right-3 flex items-start justify-between",children:[E.jsx("div",{className:"bg-card/90 backdrop-blur-sm rounded-lg px-3 py-1.5",children:E.jsx("p",{className:"text-xs text-muted-foreground",children:"Tap to select  Drag pin to adjust"})}),E.jsxs("div",{className:"flex gap-2",children:[E.jsx(wn,{size:"icon",variant:"secondary",className:"rounded-full shadow-md",onClick:()=>J(!$),children:$?E.jsx(ine,{className:"w-4 h-4"}):E.jsx(tne,{className:"w-4 h-4"})}),E.jsx(wn,{size:"icon",variant:"secondary",className:"rounded-full shadow-md",onClick:ue,children:E.jsx(eD,{className:"w-4 h-4"})})]})]}),i&&E.jsx("div",{className:"absolute bottom-3 left-3 bg-card/90 backdrop-blur-sm rounded-lg px-3 py-2",children:E.jsxs("div",{className:"flex items-center gap-2",children:[E.jsx("div",{className:"w-4 h-1 bg-primary rounded",style:{borderStyle:"dashed"}}),E.jsx("span",{className:"text-xs text-muted-foreground",children:l?`${l} Zone`:"Delivery Zone"})]})})]}),!H&&E.jsxs("div",{className:"bg-destructive/10 border border-destructive/30 rounded-xl p-3 flex items-center gap-3",children:[E.jsx(Zc,{className:"w-5 h-5 text-destructive flex-shrink-0"}),E.jsxs("div",{children:[E.jsx("p",{className:"text-sm font-medium text-destructive",children:"Delivery not available"}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Please select a location within the delivery zone"})]})]}),E.jsxs("div",{className:`rounded-xl p-3 flex items-start gap-3 ${H?"bg-secondary":"bg-secondary/50"}`,children:[E.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${H?"bg-primary/10":"bg-destructive/10"}`,children:A?E.jsx(kr,{className:`w-4 h-4 animate-spin ${H?"text-primary":"text-destructive"}`}):E.jsx(ya,{className:`w-4 h-4 ${H?"text-primary":"text-destructive"}`})}),E.jsxs("div",{className:"flex-1 min-w-0",children:[E.jsx("p",{className:"text-xs text-muted-foreground",children:"Delivery Location"}),E.jsx("p",{className:`text-sm font-medium line-clamp-2 ${H?"text-foreground":"text-muted-foreground"}`,children:A?"Finding address...":F})]})]})]})}function Mve(){var Ct,en,Bn,En,gn;const{cart:e,getTotal:t,clearCart:i}=fb(),{user:l}=Sa(),{currentFranchise:d,userLocation:m}=GC(),v=Qa(),[o,I]=q.useState(!1),[A,N]=q.useState({line1:((Ct=l==null?void 0:l.address)==null?void 0:Ct.line1)||"",line2:((en=l==null?void 0:l.address)==null?void 0:en.line2)||"",city:((Bn=l==null?void 0:l.address)==null?void 0:Bn.city)||"",pincode:((En=l==null?void 0:l.address)==null?void 0:En.pincode)||"",landmark:((gn=l==null?void 0:l.address)==null?void 0:gn.landmark)||""}),[F,z]=q.useState(null),[$,J]=q.useState(!0),[H,re]=q.useState(""),[Q,ee]=q.useState(""),[ie,ue]=q.useState(null),[xe,Oe]=q.useState(!1),[ze,Be]=q.useState(""),ot=30,Et=5,Zt=t(),zt=(()=>{if(!ie)return 0;if(ie.code.toUpperCase()==="PA1")return Zt+ot+Et-1;if(ie.discountType==="percentage"){const qt=Zt*ie.discountValue/100;return ie.maxDiscount?Math.min(qt,ie.maxDiscount):qt}else{if(ie.discountType==="fixed")return Math.min(ie.discountValue,Zt);if(ie.discountType==="final_price")return Zt+ot+Et-ie.discountValue}return 0})(),Kt=Math.max(1,Zt+ot+Et-zt),nn=async()=>{if(!Q.trim()){Be("Please enter a coupon code");return}Oe(!0),Be("");try{if(Q.toUpperCase()==="PA1"){const Ji={id:"pa1-default",code:"PA1",kitchenId:"system",discountType:"final_price",discountValue:1,usedCount:0,isActive:!0,createdAt:Date.now()};ue(Ji),Mn.success(" Special coupon applied! Final price: 1"),Oe(!1);return}const qt=await yve(Q);if(!qt){Be("Invalid coupon code"),Oe(!1);return}if(!qt.isActive){Be("This coupon is no longer active"),Oe(!1);return}if(qt.expiresAt&&qt.expiresAt<Date.now()){Be("This coupon has expired"),Oe(!1);return}if(qt.usageLimit&&qt.usedCount>=qt.usageLimit){Be("This coupon has reached its usage limit"),Oe(!1);return}if(qt.minOrderAmount&&Zt<qt.minOrderAmount){Be(`Minimum order amount is ${qt.minOrderAmount}`),Oe(!1);return}if(qt.kitchenId!==e.kitchenId&&qt.kitchenId!=="system"){Be("This coupon is not valid for this kitchen"),Oe(!1);return}ue(qt),Mn.success("Coupon applied successfully!")}catch{Be("Failed to apply coupon")}Oe(!1)},Wt=()=>{ue(null),ee(""),Be("")},Ke=()=>!A.line1||!A.city||!A.pincode?(Mn.error("Please fill in all required address fields"),!1):!0,et=async()=>{if(!l){Mn.error("Please login to continue"),v("/auth");return}if(Ke()){if(e.items.length===0){Mn.error("Your cart is empty");return}I(!0);try{await Ave(Kt,l.name,l.email,l.phone||"",async qt=>{try{const Ji=await fve({userId:l.id,kitchenId:e.kitchenId,kitchenName:e.kitchenName,items:e.items,status:"pending",totalAmount:Kt,deliveryAddress:A,notes:H,createdAt:Date.now(),updatedAt:Date.now(),estimatedDelivery:"30-45 mins"});Mn.success("Order placed successfully!"),i(),v("/orders")}catch(Ji){console.error("Order creation failed:",Ji),Mn.error("Failed to create order. Please contact support.")}I(!1)},()=>{I(!1)})}catch(qt){console.error("Payment initiation failed:",qt),Mn.error("Payment failed. Please try again."),I(!1)}}};return e.items.length===0?E.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[E.jsx("p",{className:"text-muted-foreground mb-4",children:"Your cart is empty"}),E.jsx(Fr,{to:"/",children:E.jsx(wn,{className:"gradient-primary text-primary-foreground",children:"Explore Kitchens"})})]}):E.jsxs("div",{className:"min-h-screen bg-background pb-32",children:[E.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:E.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[E.jsx(Fr,{to:"/cart",children:E.jsx(bn.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:E.jsx(Wf,{className:"w-5 h-5"})})}),E.jsxs("div",{children:[E.jsx("h1",{className:"font-semibold text-foreground",children:"Checkout"}),E.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.items.length," items from ",e.kitchenName]})]})]})}),E.jsx("div",{className:"px-4 py-4",children:E.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[E.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[E.jsx(ya,{className:"w-5 h-5 text-primary"}),E.jsx("h3",{className:"font-semibold text-foreground",children:"Select Delivery Location"}),d&&E.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",d.name,")"]})]}),E.jsx(Rve,{onLocationSelect:qt=>{z({lat:qt.lat,lng:qt.lng}),J(qt.isInZone),N({...A,line1:qt.address})},initialLocation:m?{lat:m.lat,lng:m.lng}:void 0,franchiseZone:d==null?void 0:d.zone,franchiseName:d==null?void 0:d.name}),E.jsxs("div",{className:"space-y-3 mt-4",children:[E.jsx(Yi,{placeholder:"Address Line 1 *",value:A.line1,onChange:qt=>N({...A,line1:qt.target.value}),className:"bg-secondary border-0"}),E.jsx(Yi,{placeholder:"Address Line 2 / Flat No. (optional)",value:A.line2,onChange:qt=>N({...A,line2:qt.target.value}),className:"bg-secondary border-0"}),E.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[E.jsx(Yi,{placeholder:"City *",value:A.city,onChange:qt=>N({...A,city:qt.target.value}),className:"bg-secondary border-0"}),E.jsx(Yi,{placeholder:"Pincode *",value:A.pincode,onChange:qt=>N({...A,pincode:qt.target.value}),className:"bg-secondary border-0"})]}),E.jsx(Yi,{placeholder:"Landmark (optional)",value:A.landmark,onChange:qt=>N({...A,landmark:qt.target.value}),className:"bg-secondary border-0"})]})]})}),E.jsx("div",{className:"px-4",children:E.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[E.jsx("h3",{className:"font-semibold text-foreground mb-3",children:"Special Instructions"}),E.jsx(yb,{placeholder:"Any special requests for the kitchen? (less spicy, no onions, etc.)",value:H,onChange:qt=>re(qt.target.value),className:"bg-secondary border-0 resize-none",rows:3})]})}),E.jsx("div",{className:"px-4 mt-4",children:E.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[E.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[E.jsx(R8,{className:"w-5 h-5 text-primary"}),E.jsx("h3",{className:"font-semibold text-foreground",children:"Apply Discount Coupon"})]}),ie?E.jsxs("div",{className:"flex items-center justify-between bg-veg/10 rounded-xl p-3",children:[E.jsxs("div",{className:"flex items-center gap-2",children:[E.jsx(Zu,{className:"w-5 h-5 text-veg"}),E.jsxs("div",{children:[E.jsx("p",{className:"font-semibold text-foreground",children:ie.code}),E.jsx("p",{className:"text-xs text-veg",children:ie.code.toUpperCase()==="PA1"?"Special offer: Final price 1!":`Saving ${zt}`})]})]}),E.jsx(wn,{variant:"ghost",size:"sm",onClick:Wt,className:"text-destructive",children:E.jsx(Kc,{className:"w-4 h-4"})})]}):E.jsxs("div",{className:"space-y-2",children:[E.jsxs("div",{className:"flex gap-2",children:[E.jsx(Yi,{placeholder:"Enter coupon code (try PA1)",value:Q,onChange:qt=>{ee(qt.target.value.toUpperCase()),Be("")},className:"bg-secondary border-0 uppercase"}),E.jsx(wn,{onClick:nn,disabled:xe,className:"gradient-primary text-primary-foreground",children:xe?E.jsx(kr,{className:"w-4 h-4 animate-spin"}):"Apply"})]}),ze&&E.jsx("p",{className:"text-xs text-destructive",children:ze})]})]})}),E.jsx("div",{className:"px-4 mt-4",children:E.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[E.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Order Summary"}),e.items.map(qt=>E.jsxs("div",{className:"flex justify-between text-sm py-2 border-b border-border",children:[E.jsxs("span",{className:"text-muted-foreground",children:[qt.dish.name," x ",qt.quantity]}),E.jsxs("span",{className:"text-foreground",children:["",qt.dish.price*qt.quantity]})]},qt.dish.id)),E.jsxs("div",{className:"space-y-2 text-sm mt-4",children:[E.jsxs("div",{className:"flex justify-between",children:[E.jsx("span",{className:"text-muted-foreground",children:"Item Total"}),E.jsxs("span",{className:"text-foreground",children:["",Zt]})]}),E.jsxs("div",{className:"flex justify-between",children:[E.jsx("span",{className:"text-muted-foreground",children:"Delivery Fee"}),E.jsxs("span",{className:"text-foreground",children:["",ot]})]}),E.jsxs("div",{className:"flex justify-between",children:[E.jsx("span",{className:"text-muted-foreground",children:"Platform Fee"}),E.jsxs("span",{className:"text-foreground",children:["",Et]})]}),ie&&zt>0&&E.jsxs("div",{className:"flex justify-between text-veg",children:[E.jsxs("span",{children:["Discount (",ie.code,")"]}),E.jsxs("span",{children:["-",zt]})]}),E.jsx("div",{className:"border-t border-border pt-2 mt-2",children:E.jsxs("div",{className:"flex justify-between font-semibold text-base",children:[E.jsx("span",{className:"text-foreground",children:"Total"}),E.jsxs("span",{className:"text-foreground",children:["",Kt]})]})})]})]})}),E.jsx(bn.div,{initial:{y:100},animate:{y:0},className:"fixed bottom-0 left-0 right-0 p-4 bg-card/95 backdrop-blur-lg border-t border-border safe-bottom",children:E.jsx(wn,{onClick:et,disabled:o||!$,className:`w-full py-6 rounded-xl shadow-elevated ${$?"gradient-primary text-primary-foreground":"bg-muted text-muted-foreground cursor-not-allowed"}`,children:o?E.jsxs("div",{className:"flex items-center gap-2",children:[E.jsx(kr,{className:"w-5 h-5 animate-spin"}),E.jsx("span",{children:"Processing..."})]}):$?E.jsxs("div",{className:"flex items-center justify-between w-full",children:[E.jsxs("div",{className:"flex items-center gap-2",children:[E.jsx(Kte,{className:"w-5 h-5"}),E.jsx("span",{className:"font-semibold",children:"Pay Now"})]}),E.jsxs("span",{className:"font-bold",children:["",Kt]})]}):E.jsx("div",{className:"flex items-center gap-2",children:E.jsx("span",{className:"font-semibold",children:"Delivery Not Available"})})})})]})}var kve="Label",B7=q.forwardRef((e,t)=>E.jsx(Ki.label,{...e,ref:t,onMouseDown:i=>{var d;i.target.closest("button, input, select, textarea")||((d=e.onMouseDown)==null||d.call(e,i),!i.defaultPrevented&&i.detail>1&&i.preventDefault())}}));B7.displayName=kve;var V7=B7;const Dve=Qk("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Br=q.forwardRef(({className:e,...t},i)=>E.jsx(V7,{ref:i,className:Xn(Dve(),e),...t}));Br.displayName=V7.displayName;function Nve(e){switch(e){case"super_admin":return"/super-admin";case"franchise_admin":return"/franchise-admin";case"amma":return"/amma/dashboard";case"admin":return"/admin";default:return"/"}}function Lve(){const[e,t]=q.useState("login"),[i,l]=q.useState("user"),[d,m]=q.useState(!1),[v,o]=q.useState(!1),[I,A]=q.useState(!0),[N,F]=q.useState({email:"",password:"",name:"",phone:""}),{signIn:z,signUp:$,updateUserLocation:J,user:H,loading:re}=Sa(),Q=Qa();if(q.useEffect(()=>{if(!re&&H){const ue=Nve(H.role);Q(ue,{replace:!0})}else re||A(!1)},[H,re,Q]),I||re)return E.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:E.jsx(kr,{className:"w-8 h-8 animate-spin text-primary"})});const ee=async()=>{if(!navigator.geolocation){console.log("Geolocation not supported");return}try{const ue=await new Promise((ze,Be)=>{navigator.geolocation.getCurrentPosition(ze,Be,{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}),{latitude:xe,longitude:Oe}=ue.coords;await J(xe,Oe),Mn.success("Location saved!",{icon:E.jsx(ya,{className:"w-4 h-4"}),duration:2e3})}catch(ue){console.log("Could not get location:",ue)}},ie=async ue=>{ue.preventDefault(),o(!0);try{if(e==="login"){let xe=N.email;N.email==="admin"&&(xe="admin@admin.com"),await z(xe,N.password),Mn.success("Welcome back!");const Oe=Bu.currentUser;if(Oe){const ze=xi(bi,`users/${Oe.uid}`),Be=await If(ze);if(Be.exists()){const ot=Be.val();if(ot.role==="super_admin"){Q("/super-admin");return}else if(ot.role==="franchise_admin"){Q("/franchise-admin");return}else if(ot.role==="amma"){Q("/amma/dashboard");return}else if(ot.role==="admin"){Q("/admin");return}}}Q("/")}else await $(N.email,N.password,N.name,N.phone,i),Mn.success("Account created successfully!"),ee(),i==="amma"?(Mn.info("Now register your kitchen to start selling!"),Q("/amma/register")):Q("/")}catch(xe){console.error("Auth error:",xe);let Oe="Authentication failed";xe.code==="auth/email-already-in-use"?Oe="Email already registered. Please login instead.":xe.code==="auth/weak-password"?Oe="Password should be at least 6 characters":xe.code==="auth/invalid-email"?Oe="Invalid email address":(xe.code==="auth/user-not-found"||xe.code==="auth/wrong-password"||xe.code==="auth/invalid-credential")&&(Oe="Invalid email or password"),Mn.error(Oe)}finally{o(!1)}};return E.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[E.jsx("div",{className:"gradient-hero px-6 pt-12 pb-8 text-primary-foreground",children:E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center",children:[E.jsx("div",{className:"w-16 h-16 rounded-2xl bg-primary-foreground/20 flex items-center justify-center mx-auto mb-4",children:E.jsx(Mf,{className:"w-8 h-8"})}),E.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Amma Cheythi Vanta"}),E.jsx("p",{className:"text-primary-foreground/80 text-sm",children:e==="login"?"Welcome back!":"Join our family of home cooks"})]})}),E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex-1 -mt-6 bg-card rounded-t-3xl px-6 pt-8",children:[E.jsx("div",{className:"flex bg-secondary rounded-xl p-1 mb-6",children:["login","signup"].map(ue=>E.jsx("button",{onClick:()=>t(ue),className:`flex-1 py-2.5 rounded-lg text-sm font-medium transition-all ${e===ue?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:ue==="login"?"Login":"Sign Up"},ue))}),e==="signup"&&E.jsxs("div",{className:"mb-6",children:[E.jsx(Br,{className:"text-sm font-medium text-foreground mb-3 block",children:"I am a..."}),E.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[E.jsxs(bn.button,{whileTap:{scale:.98},onClick:()=>l("user"),className:`p-4 rounded-xl border-2 text-left transition-all ${i==="user"?"border-primary bg-primary/5":"border-border"}`,children:[E.jsx("span",{className:"text-2xl mb-2 block",children:""}),E.jsx("span",{className:"font-medium text-foreground block",children:"Food Lover"}),E.jsx("span",{className:"text-xs text-muted-foreground",children:"I want to order"})]}),E.jsxs(bn.button,{whileTap:{scale:.98},onClick:()=>l("amma"),className:`p-4 rounded-xl border-2 text-left transition-all ${i==="amma"?"border-primary bg-primary/5":"border-border"}`,children:[E.jsx("span",{className:"text-2xl mb-2 block",children:""}),E.jsx("span",{className:"font-medium text-foreground block",children:"Home Cook"}),E.jsx("span",{className:"text-xs text-muted-foreground",children:"I want to sell"})]})]})]}),E.jsxs("form",{onSubmit:ie,className:"space-y-4",children:[e==="signup"&&E.jsxs(E.Fragment,{children:[E.jsxs("div",{children:[E.jsx(Br,{htmlFor:"name",className:"text-sm font-medium text-foreground",children:"Full Name"}),E.jsx(Yi,{id:"name",type:"text",placeholder:"Enter your name",value:N.name,onChange:ue=>F(xe=>({...xe,name:ue.target.value})),className:"mt-1.5 bg-secondary border-0 py-6",required:!0})]}),E.jsxs("div",{children:[E.jsx(Br,{htmlFor:"phone",className:"text-sm font-medium text-foreground",children:"Phone Number"}),E.jsx(Yi,{id:"phone",type:"tel",placeholder:"Enter phone number",value:N.phone,onChange:ue=>F(xe=>({...xe,phone:ue.target.value})),className:"mt-1.5 bg-secondary border-0 py-6",required:!0})]})]}),E.jsxs("div",{children:[E.jsx(Br,{htmlFor:"email",className:"text-sm font-medium text-foreground",children:"Email"}),E.jsx(Yi,{id:"email",type:"email",placeholder:"Enter your email",value:N.email,onChange:ue=>F(xe=>({...xe,email:ue.target.value})),className:"mt-1.5 bg-secondary border-0 py-6",required:!0})]}),E.jsxs("div",{children:[E.jsx(Br,{htmlFor:"password",className:"text-sm font-medium text-foreground",children:"Password"}),E.jsxs("div",{className:"relative mt-1.5",children:[E.jsx(Yi,{id:"password",type:d?"text":"password",placeholder:"Enter password",value:N.password,onChange:ue=>F(xe=>({...xe,password:ue.target.value})),className:"bg-secondary border-0 py-6 pr-12",required:!0}),E.jsx("button",{type:"button",onClick:()=>m(!d),className:"absolute right-4 top-1/2 -translate-y-1/2 text-muted-foreground",children:d?E.jsx(Yte,{className:"w-5 h-5"}):E.jsx(T8,{className:"w-5 h-5"})})]})]}),E.jsx(wn,{type:"submit",disabled:v,className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl mt-6",children:v?E.jsx(bn.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1},className:"w-5 h-5 border-2 border-primary-foreground border-t-transparent rounded-full"}):E.jsxs("span",{className:"flex items-center gap-2",children:[e==="login"?"Login":"Create Account",E.jsx(Hte,{className:"w-5 h-5"})]})})]}),E.jsx("div",{className:"text-center mt-6",children:E.jsx(Fr,{to:"/",className:"text-sm text-muted-foreground",children:"Skip for now"})})]})]})}function Ove(){const{user:e,signOut:t}=Sa(),i=Qa();q.useState(!1);const l=async()=>{await t(),i("/")},d=[{icon:nD,label:"My Orders",path:"/orders",color:"text-primary"},{icon:E8,label:"Favorite Kitchens",path:"/favorites",color:"text-destructive"},{icon:ya,label:"Saved Addresses",path:"/addresses",color:"text-accent"},{icon:I8,label:"Settings",path:"/settings",color:"text-muted-foreground"},{icon:Zte,label:"Help & Support",path:"/help",color:"text-gold"},...(e==null?void 0:e.role)==="super_admin"||(e==null?void 0:e.role)==="admin"?[{icon:cne,label:"Super Admin Panel",path:"/super-admin",color:"text-primary"}]:[]];return e?E.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[E.jsx("div",{className:"gradient-hero px-6 pt-12 pb-16 text-primary-foreground",children:E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-center gap-4",children:[E.jsx("div",{className:"w-16 h-16 rounded-full bg-primary-foreground/20 flex items-center justify-center",children:e.avatar?E.jsx("img",{src:e.avatar,alt:e.name,className:"w-full h-full rounded-full object-cover"}):E.jsx(DR,{className:"w-8 h-8"})}),E.jsxs("div",{children:[E.jsx("h1",{className:"text-xl font-bold",children:e.name}),E.jsx("p",{className:"text-primary-foreground/80 text-sm",children:e.email}),E.jsx("p",{className:"text-primary-foreground/60 text-xs mt-0.5",children:e.role==="amma"?" Home Cook":" Food Lover"})]})]})}),E.jsx("div",{className:"px-4 -mt-6",children:E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[e.role==="amma"&&E.jsx(Fr,{to:"/amma/dashboard",children:E.jsxs(bn.div,{whileTap:{scale:.98},className:"flex items-center gap-4 p-4 border-b border-border bg-gold-soft",children:[E.jsx("div",{className:"w-10 h-10 rounded-xl bg-gold/20 flex items-center justify-center text-gold",children:E.jsx(Mf,{className:"w-5 h-5"})}),E.jsxs("div",{className:"flex-1",children:[E.jsx("span",{className:"font-medium text-foreground block",children:"My Kitchen Dashboard"}),E.jsx("span",{className:"text-xs text-muted-foreground",children:"Manage orders & menu"})]}),E.jsx(ay,{className:"w-5 h-5 text-muted-foreground"})]})}),d.map(m=>E.jsx(Fr,{to:m.path,children:E.jsxs(bn.div,{whileTap:{scale:.98},className:"flex items-center gap-4 p-4 border-b border-border last:border-0",children:[E.jsx("div",{className:`w-10 h-10 rounded-xl bg-secondary flex items-center justify-center ${m.color}`,children:E.jsx(m.icon,{className:"w-5 h-5"})}),E.jsx("span",{className:"flex-1 font-medium text-foreground",children:m.label}),E.jsx(ay,{className:"w-5 h-5 text-muted-foreground"})]})},m.path)),E.jsxs(bn.button,{whileTap:{scale:.98},onClick:l,className:"w-full flex items-center gap-4 p-4 text-destructive",children:[E.jsx("div",{className:"w-10 h-10 rounded-xl bg-destructive/10 flex items-center justify-center",children:E.jsx(_1,{className:"w-5 h-5"})}),E.jsx("span",{className:"flex-1 font-medium text-left",children:"Logout"})]})]})}),E.jsx(Uf,{})]}):E.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[E.jsx("div",{className:"gradient-hero px-6 pt-12 pb-16 text-primary-foreground",children:E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center",children:[E.jsx("div",{className:"w-20 h-20 rounded-full bg-primary-foreground/20 flex items-center justify-center mx-auto mb-4",children:E.jsx(DR,{className:"w-10 h-10"})}),E.jsx("h1",{className:"text-xl font-bold mb-2",children:"Welcome, Guest!"}),E.jsx("p",{className:"text-primary-foreground/80 text-sm mb-4",children:"Login to order delicious homemade food"}),E.jsx(Fr,{to:"/auth",children:E.jsx(wn,{className:"bg-primary-foreground text-primary px-8 py-5 rounded-xl font-semibold",children:"Login / Sign Up"})})]})}),E.jsx("div",{className:"px-4 -mt-6",children:E.jsx(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:d.slice(3).map((m,v)=>E.jsx(Fr,{to:m.path,children:E.jsxs(bn.div,{whileTap:{scale:.98},className:"flex items-center gap-4 p-4 border-b border-border last:border-0",children:[E.jsx("div",{className:`w-10 h-10 rounded-xl bg-secondary flex items-center justify-center ${m.color}`,children:E.jsx(m.icon,{className:"w-5 h-5"})}),E.jsx("span",{className:"flex-1 font-medium text-foreground",children:m.label}),E.jsx(ay,{className:"w-5 h-5 text-muted-foreground"})]})},m.path))})}),E.jsx(Uf,{})]})}function U7(e){const t=q.useRef({value:e,previous:e});return q.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var XC="Switch",[Fve,Obe]=Qu(XC),[zve,jve]=Fve(XC),$7=q.forwardRef((e,t)=>{const{__scopeSwitch:i,name:l,checked:d,defaultChecked:m,required:v,disabled:o,value:I="on",onCheckedChange:A,form:N,...F}=e,[z,$]=q.useState(null),J=zr(t,ie=>$(ie)),H=q.useRef(!1),re=z?N||!!z.closest("form"):!0,[Q,ee]=Rf({prop:d,defaultProp:m??!1,onChange:A,caller:XC});return E.jsxs(zve,{scope:i,checked:Q,disabled:o,children:[E.jsx(Ki.button,{type:"button",role:"switch","aria-checked":Q,"aria-required":v,"data-state":q7(Q),"data-disabled":o?"":void 0,disabled:o,value:I,...F,ref:J,onClick:Li(e.onClick,ie=>{ee(ue=>!ue),re&&(H.current=ie.isPropagationStopped(),H.current||ie.stopPropagation())})}),re&&E.jsx(W7,{control:z,bubbles:!H.current,name:l,value:I,checked:Q,required:v,disabled:o,form:N,style:{transform:"translateX(-100%)"}})]})});$7.displayName=XC;var G7="SwitchThumb",H7=q.forwardRef((e,t)=>{const{__scopeSwitch:i,...l}=e,d=jve(G7,i);return E.jsx(Ki.span,{"data-state":q7(d.checked),"data-disabled":d.disabled?"":void 0,...l,ref:t})});H7.displayName=G7;var Bve="SwitchBubbleInput",W7=q.forwardRef(({__scopeSwitch:e,control:t,checked:i,bubbles:l=!0,...d},m)=>{const v=q.useRef(null),o=zr(v,m),I=U7(i),A=e$(t);return q.useEffect(()=>{const N=v.current;if(!N)return;const F=window.HTMLInputElement.prototype,$=Object.getOwnPropertyDescriptor(F,"checked").set;if(I!==i&&$){const J=new Event("click",{bubbles:l});$.call(N,i),N.dispatchEvent(J)}},[I,i,l]),E.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:i,...d,tabIndex:-1,ref:o,style:{...d.style,...A,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});W7.displayName=Bve;function q7(e){return e?"checked":"unchecked"}var Z7=$7,Vve=H7;const df=q.forwardRef(({className:e,...t},i)=>E.jsx(Z7,{className:Xn("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e),...t,ref:i,children:E.jsx(Vve,{className:Xn("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));df.displayName=Z7.displayName;var IP="focusScope.autoFocusOnMount",AP="focusScope.autoFocusOnUnmount",Y5={bubbles:!1,cancelable:!0},Uve="FocusScope",QN=q.forwardRef((e,t)=>{const{loop:i=!1,trapped:l=!1,onMountAutoFocus:d,onUnmountAutoFocus:m,...v}=e,[o,I]=q.useState(null),A=tu(d),N=tu(m),F=q.useRef(null),z=zr(t,H=>I(H)),$=q.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;q.useEffect(()=>{if(l){let H=function(ie){if($.paused||!o)return;const ue=ie.target;o.contains(ue)?F.current=ue:Wh(F.current,{select:!0})},re=function(ie){if($.paused||!o)return;const ue=ie.relatedTarget;ue!==null&&(o.contains(ue)||Wh(F.current,{select:!0}))},Q=function(ie){if(document.activeElement===document.body)for(const xe of ie)xe.removedNodes.length>0&&Wh(o)};document.addEventListener("focusin",H),document.addEventListener("focusout",re);const ee=new MutationObserver(Q);return o&&ee.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",H),document.removeEventListener("focusout",re),ee.disconnect()}}},[l,o,$.paused]),q.useEffect(()=>{if(o){J5.add($);const H=document.activeElement;if(!o.contains(H)){const Q=new CustomEvent(IP,Y5);o.addEventListener(IP,A),o.dispatchEvent(Q),Q.defaultPrevented||($ve(Zve(K7(o)),{select:!0}),document.activeElement===H&&Wh(o))}return()=>{o.removeEventListener(IP,A),setTimeout(()=>{const Q=new CustomEvent(AP,Y5);o.addEventListener(AP,N),o.dispatchEvent(Q),Q.defaultPrevented||Wh(H??document.body,{select:!0}),o.removeEventListener(AP,N),J5.remove($)},0)}}},[o,A,N,$]);const J=q.useCallback(H=>{if(!i&&!l||$.paused)return;const re=H.key==="Tab"&&!H.altKey&&!H.ctrlKey&&!H.metaKey,Q=document.activeElement;if(re&&Q){const ee=H.currentTarget,[ie,ue]=Gve(ee);ie&&ue?!H.shiftKey&&Q===ue?(H.preventDefault(),i&&Wh(ie,{select:!0})):H.shiftKey&&Q===ie&&(H.preventDefault(),i&&Wh(ue,{select:!0})):Q===ee&&H.preventDefault()}},[i,l,$.paused]);return E.jsx(Ki.div,{tabIndex:-1,...v,ref:z,onKeyDown:J})});QN.displayName=Uve;function $ve(e,{select:t=!1}={}){const i=document.activeElement;for(const l of e)if(Wh(l,{select:t}),document.activeElement!==i)return}function Gve(e){const t=K7(e),i=Q5(t,e),l=Q5(t.reverse(),e);return[i,l]}function K7(e){const t=[],i=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:l=>{const d=l.tagName==="INPUT"&&l.type==="hidden";return l.disabled||l.hidden||d?NodeFilter.FILTER_SKIP:l.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;i.nextNode();)t.push(i.currentNode);return t}function Q5(e,t){for(const i of e)if(!Hve(i,{upTo:t}))return i}function Hve(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function Wve(e){return e instanceof HTMLInputElement&&"select"in e}function Wh(e,{select:t=!1}={}){if(e&&e.focus){const i=document.activeElement;e.focus({preventScroll:!0}),e!==i&&Wve(e)&&t&&e.select()}}var J5=qve();function qve(){let e=[];return{add(t){const i=e[0];t!==i&&(i==null||i.pause()),e=eV(e,t),e.unshift(t)},remove(t){var i;e=eV(e,t),(i=e[0])==null||i.resume()}}}function eV(e,t){const i=[...e],l=i.indexOf(t);return l!==-1&&i.splice(l,1),i}function Zve(e){return e.filter(t=>t.tagName!=="A")}var PP=0;function X7(){q.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??tV()),document.body.insertAdjacentElement("beforeend",e[1]??tV()),PP++,()=>{PP===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),PP--}},[])}function tV(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var zu=function(){return zu=Object.assign||function(t){for(var i,l=1,d=arguments.length;l<d;l++){i=arguments[l];for(var m in i)Object.prototype.hasOwnProperty.call(i,m)&&(t[m]=i[m])}return t},zu.apply(this,arguments)};function Y7(e,t){var i={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(i[l]=e[l]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,l=Object.getOwnPropertySymbols(e);d<l.length;d++)t.indexOf(l[d])<0&&Object.prototype.propertyIsEnumerable.call(e,l[d])&&(i[l[d]]=e[l[d]]);return i}function Kve(e,t,i){if(i||arguments.length===2)for(var l=0,d=t.length,m;l<d;l++)(m||!(l in t))&&(m||(m=Array.prototype.slice.call(t,0,l)),m[l]=t[l]);return e.concat(m||Array.prototype.slice.call(t))}var AE="right-scroll-bar-position",PE="width-before-scroll-bar",Xve="with-scroll-bars-hidden",Yve="--removed-body-scroll-bar-size";function RP(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function Qve(e,t){var i=q.useState(function(){return{value:e,callback:t,facade:{get current(){return i.value},set current(l){var d=i.value;d!==l&&(i.value=l,i.callback(l,d))}}}})[0];return i.callback=t,i.facade}var Jve=typeof window<"u"?q.useLayoutEffect:q.useEffect,nV=new WeakMap;function exe(e,t){var i=Qve(null,function(l){return e.forEach(function(d){return RP(d,l)})});return Jve(function(){var l=nV.get(i);if(l){var d=new Set(l),m=new Set(e),v=i.current;d.forEach(function(o){m.has(o)||RP(o,null)}),m.forEach(function(o){d.has(o)||RP(o,v)})}nV.set(i,e)},[e]),i}function txe(e){return e}function nxe(e,t){t===void 0&&(t=txe);var i=[],l=!1,d={read:function(){if(l)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:e},useMedium:function(m){var v=t(m,l);return i.push(v),function(){i=i.filter(function(o){return o!==v})}},assignSyncMedium:function(m){for(l=!0;i.length;){var v=i;i=[],v.forEach(m)}i={push:function(o){return m(o)},filter:function(){return i}}},assignMedium:function(m){l=!0;var v=[];if(i.length){var o=i;i=[],o.forEach(m),v=i}var I=function(){var N=v;v=[],N.forEach(m)},A=function(){return Promise.resolve().then(I)};A(),i={push:function(N){v.push(N),A()},filter:function(N){return v=v.filter(N),i}}}};return d}function ixe(e){e===void 0&&(e={});var t=nxe(null);return t.options=zu({async:!0,ssr:!1},e),t}var Q7=function(e){var t=e.sideCar,i=Y7(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var l=t.read();if(!l)throw new Error("Sidecar medium not found");return q.createElement(l,zu({},i))};Q7.isSideCarExport=!0;function rxe(e,t){return e.useMedium(t),Q7}var J7=ixe(),MP=function(){},YC=q.forwardRef(function(e,t){var i=q.useRef(null),l=q.useState({onScrollCapture:MP,onWheelCapture:MP,onTouchMoveCapture:MP}),d=l[0],m=l[1],v=e.forwardProps,o=e.children,I=e.className,A=e.removeScrollBar,N=e.enabled,F=e.shards,z=e.sideCar,$=e.noRelative,J=e.noIsolation,H=e.inert,re=e.allowPinchZoom,Q=e.as,ee=Q===void 0?"div":Q,ie=e.gapMode,ue=Y7(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),xe=z,Oe=exe([i,t]),ze=zu(zu({},ue),d);return q.createElement(q.Fragment,null,N&&q.createElement(xe,{sideCar:J7,removeScrollBar:A,shards:F,noRelative:$,noIsolation:J,inert:H,setCallbacks:m,allowPinchZoom:!!re,lockRef:i,gapMode:ie}),v?q.cloneElement(q.Children.only(o),zu(zu({},ze),{ref:Oe})):q.createElement(ee,zu({},ze,{className:I,ref:Oe}),o))});YC.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};YC.classNames={fullWidth:PE,zeroRight:AE};var sxe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function oxe(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=sxe();return t&&e.setAttribute("nonce",t),e}function axe(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function lxe(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var cxe=function(){var e=0,t=null;return{add:function(i){e==0&&(t=oxe())&&(axe(t,i),lxe(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},uxe=function(){var e=cxe();return function(t,i){q.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&i])}},eq=function(){var e=uxe(),t=function(i){var l=i.styles,d=i.dynamic;return e(l,d),null};return t},dxe={left:0,top:0,right:0,gap:0},kP=function(e){return parseInt(e||"",10)||0},hxe=function(e){var t=window.getComputedStyle(document.body),i=t[e==="padding"?"paddingLeft":"marginLeft"],l=t[e==="padding"?"paddingTop":"marginTop"],d=t[e==="padding"?"paddingRight":"marginRight"];return[kP(i),kP(l),kP(d)]},fxe=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return dxe;var t=hxe(e),i=document.documentElement.clientWidth,l=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,l-i+t[2]-t[0])}},pxe=eq(),yy="data-scroll-locked",mxe=function(e,t,i,l){var d=e.left,m=e.top,v=e.right,o=e.gap;return i===void 0&&(i="margin"),`
  .`.concat(Xve,` {
   overflow: hidden `).concat(l,`;
   padding-right: `).concat(o,"px ").concat(l,`;
  }
  body[`).concat(yy,`] {
    overflow: hidden `).concat(l,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(l,";"),i==="margin"&&`
    padding-left: `.concat(d,`px;
    padding-top: `).concat(m,`px;
    padding-right: `).concat(v,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(o,"px ").concat(l,`;
    `),i==="padding"&&"padding-right: ".concat(o,"px ").concat(l,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(AE,` {
    right: `).concat(o,"px ").concat(l,`;
  }
  
  .`).concat(PE,` {
    margin-right: `).concat(o,"px ").concat(l,`;
  }
  
  .`).concat(AE," .").concat(AE,` {
    right: 0 `).concat(l,`;
  }
  
  .`).concat(PE," .").concat(PE,` {
    margin-right: 0 `).concat(l,`;
  }
  
  body[`).concat(yy,`] {
    `).concat(Yve,": ").concat(o,`px;
  }
`)},iV=function(){var e=parseInt(document.body.getAttribute(yy)||"0",10);return isFinite(e)?e:0},gxe=function(){q.useEffect(function(){return document.body.setAttribute(yy,(iV()+1).toString()),function(){var e=iV()-1;e<=0?document.body.removeAttribute(yy):document.body.setAttribute(yy,e.toString())}},[])},_xe=function(e){var t=e.noRelative,i=e.noImportant,l=e.gapMode,d=l===void 0?"margin":l;gxe();var m=q.useMemo(function(){return fxe(d)},[d]);return q.createElement(pxe,{styles:mxe(m,!t,d,i?"":"!important")})},OM=!1;if(typeof window<"u")try{var YT=Object.defineProperty({},"passive",{get:function(){return OM=!0,!0}});window.addEventListener("test",YT,YT),window.removeEventListener("test",YT,YT)}catch{OM=!1}var D_=OM?{passive:!1}:!1,yxe=function(e){return e.tagName==="TEXTAREA"},tq=function(e,t){if(!(e instanceof Element))return!1;var i=window.getComputedStyle(e);return i[t]!=="hidden"&&!(i.overflowY===i.overflowX&&!yxe(e)&&i[t]==="visible")},vxe=function(e){return tq(e,"overflowY")},xxe=function(e){return tq(e,"overflowX")},rV=function(e,t){var i=t.ownerDocument,l=t;do{typeof ShadowRoot<"u"&&l instanceof ShadowRoot&&(l=l.host);var d=nq(e,l);if(d){var m=iq(e,l),v=m[1],o=m[2];if(v>o)return!0}l=l.parentNode}while(l&&l!==i.body);return!1},bxe=function(e){var t=e.scrollTop,i=e.scrollHeight,l=e.clientHeight;return[t,i,l]},wxe=function(e){var t=e.scrollLeft,i=e.scrollWidth,l=e.clientWidth;return[t,i,l]},nq=function(e,t){return e==="v"?vxe(t):xxe(t)},iq=function(e,t){return e==="v"?bxe(t):wxe(t)},Txe=function(e,t){return e==="h"&&t==="rtl"?-1:1},Exe=function(e,t,i,l,d){var m=Txe(e,window.getComputedStyle(t).direction),v=m*l,o=i.target,I=t.contains(o),A=!1,N=v>0,F=0,z=0;do{if(!o)break;var $=iq(e,o),J=$[0],H=$[1],re=$[2],Q=H-re-m*J;(J||Q)&&nq(e,o)&&(F+=Q,z+=J);var ee=o.parentNode;o=ee&&ee.nodeType===Node.DOCUMENT_FRAGMENT_NODE?ee.host:ee}while(!I&&o!==document.body||I&&(t.contains(o)||t===o));return(N&&(Math.abs(F)<1||!d)||!N&&(Math.abs(z)<1||!d))&&(A=!0),A},QT=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},sV=function(e){return[e.deltaX,e.deltaY]},oV=function(e){return e&&"current"in e?e.current:e},Sxe=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Cxe=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},Ixe=0,N_=[];function Axe(e){var t=q.useRef([]),i=q.useRef([0,0]),l=q.useRef(),d=q.useState(Ixe++)[0],m=q.useState(eq)[0],v=q.useRef(e);q.useEffect(function(){v.current=e},[e]),q.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(d));var H=Kve([e.lockRef.current],(e.shards||[]).map(oV),!0).filter(Boolean);return H.forEach(function(re){return re.classList.add("allow-interactivity-".concat(d))}),function(){document.body.classList.remove("block-interactivity-".concat(d)),H.forEach(function(re){return re.classList.remove("allow-interactivity-".concat(d))})}}},[e.inert,e.lockRef.current,e.shards]);var o=q.useCallback(function(H,re){if("touches"in H&&H.touches.length===2||H.type==="wheel"&&H.ctrlKey)return!v.current.allowPinchZoom;var Q=QT(H),ee=i.current,ie="deltaX"in H?H.deltaX:ee[0]-Q[0],ue="deltaY"in H?H.deltaY:ee[1]-Q[1],xe,Oe=H.target,ze=Math.abs(ie)>Math.abs(ue)?"h":"v";if("touches"in H&&ze==="h"&&Oe.type==="range")return!1;var Be=rV(ze,Oe);if(!Be)return!0;if(Be?xe=ze:(xe=ze==="v"?"h":"v",Be=rV(ze,Oe)),!Be)return!1;if(!l.current&&"changedTouches"in H&&(ie||ue)&&(l.current=xe),!xe)return!0;var ot=l.current||xe;return Exe(ot,re,H,ot==="h"?ie:ue,!0)},[]),I=q.useCallback(function(H){var re=H;if(!(!N_.length||N_[N_.length-1]!==m)){var Q="deltaY"in re?sV(re):QT(re),ee=t.current.filter(function(xe){return xe.name===re.type&&(xe.target===re.target||re.target===xe.shadowParent)&&Sxe(xe.delta,Q)})[0];if(ee&&ee.should){re.cancelable&&re.preventDefault();return}if(!ee){var ie=(v.current.shards||[]).map(oV).filter(Boolean).filter(function(xe){return xe.contains(re.target)}),ue=ie.length>0?o(re,ie[0]):!v.current.noIsolation;ue&&re.cancelable&&re.preventDefault()}}},[]),A=q.useCallback(function(H,re,Q,ee){var ie={name:H,delta:re,target:Q,should:ee,shadowParent:Pxe(Q)};t.current.push(ie),setTimeout(function(){t.current=t.current.filter(function(ue){return ue!==ie})},1)},[]),N=q.useCallback(function(H){i.current=QT(H),l.current=void 0},[]),F=q.useCallback(function(H){A(H.type,sV(H),H.target,o(H,e.lockRef.current))},[]),z=q.useCallback(function(H){A(H.type,QT(H),H.target,o(H,e.lockRef.current))},[]);q.useEffect(function(){return N_.push(m),e.setCallbacks({onScrollCapture:F,onWheelCapture:F,onTouchMoveCapture:z}),document.addEventListener("wheel",I,D_),document.addEventListener("touchmove",I,D_),document.addEventListener("touchstart",N,D_),function(){N_=N_.filter(function(H){return H!==m}),document.removeEventListener("wheel",I,D_),document.removeEventListener("touchmove",I,D_),document.removeEventListener("touchstart",N,D_)}},[]);var $=e.removeScrollBar,J=e.inert;return q.createElement(q.Fragment,null,J?q.createElement(m,{styles:Cxe(d)}):null,$?q.createElement(_xe,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function Pxe(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const Rxe=rxe(J7,Axe);var JN=q.forwardRef(function(e,t){return q.createElement(YC,zu({},e,{ref:t,sideCar:Rxe}))});JN.classNames=YC.classNames;var Mxe=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},L_=new WeakMap,JT=new WeakMap,eE={},DP=0,rq=function(e){return e&&(e.host||rq(e.parentNode))},kxe=function(e,t){return t.map(function(i){if(e.contains(i))return i;var l=rq(i);return l&&e.contains(l)?l:(console.error("aria-hidden",i,"in not contained inside",e,". Doing nothing"),null)}).filter(function(i){return!!i})},Dxe=function(e,t,i,l){var d=kxe(t,Array.isArray(e)?e:[e]);eE[i]||(eE[i]=new WeakMap);var m=eE[i],v=[],o=new Set,I=new Set(d),A=function(F){!F||o.has(F)||(o.add(F),A(F.parentNode))};d.forEach(A);var N=function(F){!F||I.has(F)||Array.prototype.forEach.call(F.children,function(z){if(o.has(z))N(z);else try{var $=z.getAttribute(l),J=$!==null&&$!=="false",H=(L_.get(z)||0)+1,re=(m.get(z)||0)+1;L_.set(z,H),m.set(z,re),v.push(z),H===1&&J&&JT.set(z,!0),re===1&&z.setAttribute(i,"true"),J||z.setAttribute(l,"true")}catch(Q){console.error("aria-hidden: cannot operate on ",z,Q)}})};return N(t),o.clear(),DP++,function(){v.forEach(function(F){var z=L_.get(F)-1,$=m.get(F)-1;L_.set(F,z),m.set(F,$),z||(JT.has(F)||F.removeAttribute(l),JT.delete(F)),$||F.removeAttribute(i)}),DP--,DP||(L_=new WeakMap,L_=new WeakMap,JT=new WeakMap,eE={})}},sq=function(e,t,i){i===void 0&&(i="data-aria-hidden");var l=Array.from(Array.isArray(e)?e:[e]),d=Mxe(e);return d?(l.push.apply(l,Array.from(d.querySelectorAll("[aria-live]"))),Dxe(l,d,i,"aria-hidden")):function(){return null}},QC="Dialog",[oq,aq]=Qu(QC),[Nxe,lu]=oq(QC),lq=e=>{const{__scopeDialog:t,children:i,open:l,defaultOpen:d,onOpenChange:m,modal:v=!0}=e,o=q.useRef(null),I=q.useRef(null),[A,N]=Rf({prop:l,defaultProp:d??!1,onChange:m,caller:QC});return E.jsx(Nxe,{scope:t,triggerRef:o,contentRef:I,contentId:bf(),titleId:bf(),descriptionId:bf(),open:A,onOpenChange:N,onOpenToggle:q.useCallback(()=>N(F=>!F),[N]),modal:v,children:i})};lq.displayName=QC;var cq="DialogTrigger",uq=q.forwardRef((e,t)=>{const{__scopeDialog:i,...l}=e,d=lu(cq,i),m=zr(t,d.triggerRef);return E.jsx(Ki.button,{type:"button","aria-haspopup":"dialog","aria-expanded":d.open,"aria-controls":d.contentId,"data-state":nL(d.open),...l,ref:m,onClick:Li(e.onClick,d.onOpenToggle)})});uq.displayName=cq;var eL="DialogPortal",[Lxe,dq]=oq(eL,{forceMount:void 0}),hq=e=>{const{__scopeDialog:t,forceMount:i,children:l,container:d}=e,m=lu(eL,t);return E.jsx(Lxe,{scope:t,forceMount:i,children:q.Children.map(l,v=>E.jsx(Fm,{present:i||m.open,children:E.jsx(fC,{asChild:!0,container:d,children:v})}))})};hq.displayName=eL;var $S="DialogOverlay",fq=q.forwardRef((e,t)=>{const i=dq($S,e.__scopeDialog),{forceMount:l=i.forceMount,...d}=e,m=lu($S,e.__scopeDialog);return m.modal?E.jsx(Fm,{present:l||m.open,children:E.jsx(Fxe,{...d,ref:t})}):null});fq.displayName=$S;var Oxe=Ly("DialogOverlay.RemoveScroll"),Fxe=q.forwardRef((e,t)=>{const{__scopeDialog:i,...l}=e,d=lu($S,i);return E.jsx(JN,{as:Oxe,allowPinchZoom:!0,shards:[d.contentRef],children:E.jsx(Ki.div,{"data-state":nL(d.open),...l,ref:t,style:{pointerEvents:"auto",...l.style}})})}),Mm="DialogContent",pq=q.forwardRef((e,t)=>{const i=dq(Mm,e.__scopeDialog),{forceMount:l=i.forceMount,...d}=e,m=lu(Mm,e.__scopeDialog);return E.jsx(Fm,{present:l||m.open,children:m.modal?E.jsx(zxe,{...d,ref:t}):E.jsx(jxe,{...d,ref:t})})});pq.displayName=Mm;var zxe=q.forwardRef((e,t)=>{const i=lu(Mm,e.__scopeDialog),l=q.useRef(null),d=zr(t,i.contentRef,l);return q.useEffect(()=>{const m=l.current;if(m)return sq(m)},[]),E.jsx(mq,{...e,ref:d,trapFocus:i.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Li(e.onCloseAutoFocus,m=>{var v;m.preventDefault(),(v=i.triggerRef.current)==null||v.focus()}),onPointerDownOutside:Li(e.onPointerDownOutside,m=>{const v=m.detail.originalEvent,o=v.button===0&&v.ctrlKey===!0;(v.button===2||o)&&m.preventDefault()}),onFocusOutside:Li(e.onFocusOutside,m=>m.preventDefault())})}),jxe=q.forwardRef((e,t)=>{const i=lu(Mm,e.__scopeDialog),l=q.useRef(!1),d=q.useRef(!1);return E.jsx(mq,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:m=>{var v,o;(v=e.onCloseAutoFocus)==null||v.call(e,m),m.defaultPrevented||(l.current||(o=i.triggerRef.current)==null||o.focus(),m.preventDefault()),l.current=!1,d.current=!1},onInteractOutside:m=>{var I,A;(I=e.onInteractOutside)==null||I.call(e,m),m.defaultPrevented||(l.current=!0,m.detail.originalEvent.type==="pointerdown"&&(d.current=!0));const v=m.target;((A=i.triggerRef.current)==null?void 0:A.contains(v))&&m.preventDefault(),m.detail.originalEvent.type==="focusin"&&d.current&&m.preventDefault()}})}),mq=q.forwardRef((e,t)=>{const{__scopeDialog:i,trapFocus:l,onOpenAutoFocus:d,onCloseAutoFocus:m,...v}=e,o=lu(Mm,i),I=q.useRef(null),A=zr(t,I);return X7(),E.jsxs(E.Fragment,{children:[E.jsx(QN,{asChild:!0,loop:!0,trapped:l,onMountAutoFocus:d,onUnmountAutoFocus:m,children:E.jsx(Y1,{role:"dialog",id:o.contentId,"aria-describedby":o.descriptionId,"aria-labelledby":o.titleId,"data-state":nL(o.open),...v,ref:A,onDismiss:()=>o.onOpenChange(!1)})}),E.jsxs(E.Fragment,{children:[E.jsx(Vxe,{titleId:o.titleId}),E.jsx($xe,{contentRef:I,descriptionId:o.descriptionId})]})]})}),tL="DialogTitle",gq=q.forwardRef((e,t)=>{const{__scopeDialog:i,...l}=e,d=lu(tL,i);return E.jsx(Ki.h2,{id:d.titleId,...l,ref:t})});gq.displayName=tL;var _q="DialogDescription",yq=q.forwardRef((e,t)=>{const{__scopeDialog:i,...l}=e,d=lu(_q,i);return E.jsx(Ki.p,{id:d.descriptionId,...l,ref:t})});yq.displayName=_q;var vq="DialogClose",xq=q.forwardRef((e,t)=>{const{__scopeDialog:i,...l}=e,d=lu(vq,i);return E.jsx(Ki.button,{type:"button",...l,ref:t,onClick:Li(e.onClick,()=>d.onOpenChange(!1))})});xq.displayName=vq;function nL(e){return e?"open":"closed"}var bq="DialogTitleWarning",[Bxe,wq]=Qee(bq,{contentName:Mm,titleName:tL,docsSlug:"dialog"}),Vxe=({titleId:e})=>{const t=wq(bq),i=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return q.useEffect(()=>{e&&(document.getElementById(e)||console.error(i))},[i,e]),null},Uxe="DialogDescriptionWarning",$xe=({contentRef:e,descriptionId:t})=>{const l=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${wq(Uxe).contentName}}.`;return q.useEffect(()=>{var m;const d=(m=e.current)==null?void 0:m.getAttribute("aria-describedby");t&&d&&(document.getElementById(t)||console.warn(l))},[l,e,t]),null},Tq=lq,Eq=uq,Sq=hq,iL=fq,rL=pq,sL=gq,oL=yq,aL=xq,Cq="AlertDialog",[Gxe,Fbe]=Qu(Cq,[aq]),sh=aq(),Iq=e=>{const{__scopeAlertDialog:t,...i}=e,l=sh(t);return E.jsx(Tq,{...l,...i,modal:!0})};Iq.displayName=Cq;var Hxe="AlertDialogTrigger",Aq=q.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...l}=e,d=sh(i);return E.jsx(Eq,{...d,...l,ref:t})});Aq.displayName=Hxe;var Wxe="AlertDialogPortal",Pq=e=>{const{__scopeAlertDialog:t,...i}=e,l=sh(t);return E.jsx(Sq,{...l,...i})};Pq.displayName=Wxe;var qxe="AlertDialogOverlay",Rq=q.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...l}=e,d=sh(i);return E.jsx(iL,{...d,...l,ref:t})});Rq.displayName=qxe;var vy="AlertDialogContent",[Zxe,Kxe]=Gxe(vy),Xxe=Z6("AlertDialogContent"),Mq=q.forwardRef((e,t)=>{const{__scopeAlertDialog:i,children:l,...d}=e,m=sh(i),v=q.useRef(null),o=zr(t,v),I=q.useRef(null);return E.jsx(Bxe,{contentName:vy,titleName:kq,docsSlug:"alert-dialog",children:E.jsx(Zxe,{scope:i,cancelRef:I,children:E.jsxs(rL,{role:"alertdialog",...m,...d,ref:o,onOpenAutoFocus:Li(d.onOpenAutoFocus,A=>{var N;A.preventDefault(),(N=I.current)==null||N.focus({preventScroll:!0})}),onPointerDownOutside:A=>A.preventDefault(),onInteractOutside:A=>A.preventDefault(),children:[E.jsx(Xxe,{children:l}),E.jsx(Qxe,{contentRef:v})]})})})});Mq.displayName=vy;var kq="AlertDialogTitle",Dq=q.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...l}=e,d=sh(i);return E.jsx(sL,{...d,...l,ref:t})});Dq.displayName=kq;var Nq="AlertDialogDescription",Lq=q.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...l}=e,d=sh(i);return E.jsx(oL,{...d,...l,ref:t})});Lq.displayName=Nq;var Yxe="AlertDialogAction",Oq=q.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...l}=e,d=sh(i);return E.jsx(aL,{...d,...l,ref:t})});Oq.displayName=Yxe;var Fq="AlertDialogCancel",zq=q.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...l}=e,{cancelRef:d}=Kxe(Fq,i),m=sh(i),v=zr(t,d);return E.jsx(aL,{...m,...l,ref:v})});zq.displayName=Fq;var Qxe=({contentRef:e})=>{const t=`\`${vy}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${vy}\` by passing a \`${Nq}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${vy}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return q.useEffect(()=>{var l;document.getElementById((l=e.current)==null?void 0:l.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},Jxe=Iq,e0e=Aq,t0e=Pq,jq=Rq,Bq=Mq,Vq=Oq,Uq=zq,$q=Dq,Gq=Lq;const n0e=Jxe,i0e=e0e,r0e=t0e,Hq=q.forwardRef(({className:e,...t},i)=>E.jsx(jq,{className:Xn("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:i}));Hq.displayName=jq.displayName;const Wq=q.forwardRef(({className:e,...t},i)=>E.jsxs(r0e,{children:[E.jsx(Hq,{}),E.jsx(Bq,{ref:i,className:Xn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));Wq.displayName=Bq.displayName;const qq=({className:e,...t})=>E.jsx("div",{className:Xn("flex flex-col space-y-2 text-center sm:text-left",e),...t});qq.displayName="AlertDialogHeader";const Zq=({className:e,...t})=>E.jsx("div",{className:Xn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Zq.displayName="AlertDialogFooter";const Kq=q.forwardRef(({className:e,...t},i)=>E.jsx($q,{ref:i,className:Xn("text-lg font-semibold",e),...t}));Kq.displayName=$q.displayName;const Xq=q.forwardRef(({className:e,...t},i)=>E.jsx(Gq,{ref:i,className:Xn("text-sm text-muted-foreground",e),...t}));Xq.displayName=Gq.displayName;const Yq=q.forwardRef(({className:e,...t},i)=>E.jsx(Vq,{ref:i,className:Xn(YN(),e),...t}));Yq.displayName=Vq.displayName;const Qq=q.forwardRef(({className:e,...t},i)=>E.jsx(Uq,{ref:i,className:Xn(YN({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));Qq.displayName=Uq.displayName;function s0e(){const[e,t]=q.useState(!0),[i,l]=q.useState(!0),[d,m]=q.useState(!1),[v,o]=q.useState(!1),I=()=>{Mn.success("Account deletion request submitted")};return E.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[E.jsxs("div",{className:"bg-card border-b border-border px-4 py-4 flex items-center gap-4 sticky top-0 z-10",children:[E.jsx(Fr,{to:"/profile",children:E.jsx(bn.div,{whileTap:{scale:.9},className:"p-2 -ml-2",children:E.jsx(Wf,{className:"w-6 h-6 text-foreground"})})}),E.jsx("h1",{className:"text-lg font-bold text-foreground",children:"Settings"})]}),E.jsxs("div",{className:"p-4 space-y-4",children:[E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[E.jsx("div",{className:"p-4 border-b border-border",children:E.jsxs("div",{className:"flex items-center gap-3",children:[E.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center text-primary",children:E.jsx(w8,{className:"w-5 h-5"})}),E.jsx("h2",{className:"font-semibold text-foreground",children:"Notifications"})]})}),E.jsxs("div",{className:"divide-y divide-border",children:[E.jsxs("div",{className:"flex items-center justify-between p-4",children:[E.jsxs("div",{children:[E.jsx("p",{className:"font-medium text-foreground",children:"Push Notifications"}),E.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive push notifications"})]}),E.jsx(df,{checked:e,onCheckedChange:t})]}),E.jsxs("div",{className:"flex items-center justify-between p-4",children:[E.jsxs("div",{children:[E.jsx("p",{className:"font-medium text-foreground",children:"Order Updates"}),E.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified about order status"})]}),E.jsx(df,{checked:i,onCheckedChange:l})]}),E.jsxs("div",{className:"flex items-center justify-between p-4",children:[E.jsxs("div",{children:[E.jsx("p",{className:"font-medium text-foreground",children:"Promotions"}),E.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive offers and discounts"})]}),E.jsx(df,{checked:d,onCheckedChange:m})]})]})]}),E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[E.jsx("div",{className:"p-4 border-b border-border",children:E.jsxs("div",{className:"flex items-center gap-3",children:[E.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:E.jsx(rne,{className:"w-5 h-5"})}),E.jsx("h2",{className:"font-semibold text-foreground",children:"Appearance"})]})}),E.jsxs("div",{className:"flex items-center justify-between p-4",children:[E.jsxs("div",{children:[E.jsx("p",{className:"font-medium text-foreground",children:"Dark Mode"}),E.jsx("p",{className:"text-sm text-muted-foreground",children:"Switch to dark theme"})]}),E.jsx(df,{checked:v,onCheckedChange:o})]})]}),E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[E.jsx("div",{className:"p-4 border-b border-border",children:E.jsxs("div",{className:"flex items-center gap-3",children:[E.jsx("div",{className:"w-10 h-10 rounded-xl bg-accent/10 flex items-center justify-center text-accent",children:E.jsx(Qte,{className:"w-5 h-5"})}),E.jsx("h2",{className:"font-semibold text-foreground",children:"Language & Region"})]})}),E.jsxs("div",{className:"flex items-center justify-between p-4",children:[E.jsxs("div",{children:[E.jsx("p",{className:"font-medium text-foreground",children:"Language"}),E.jsx("p",{className:"text-sm text-muted-foreground",children:"English (India)"})]}),E.jsx(ay,{className:"w-5 h-5 text-muted-foreground"})]})]}),E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[E.jsx("div",{className:"p-4 border-b border-border",children:E.jsxs("div",{className:"flex items-center gap-3",children:[E.jsx("div",{className:"w-10 h-10 rounded-xl bg-gold/10 flex items-center justify-center text-gold",children:E.jsx(Jte,{className:"w-5 h-5"})}),E.jsx("h2",{className:"font-semibold text-foreground",children:"Security"})]})}),E.jsxs("div",{className:"divide-y divide-border",children:[E.jsxs("div",{className:"flex items-center justify-between p-4",children:[E.jsxs("div",{children:[E.jsx("p",{className:"font-medium text-foreground",children:"Change Password"}),E.jsx("p",{className:"text-sm text-muted-foreground",children:"Update your password"})]}),E.jsx(ay,{className:"w-5 h-5 text-muted-foreground"})]}),E.jsxs("div",{className:"flex items-center justify-between p-4",children:[E.jsxs("div",{children:[E.jsx("p",{className:"font-medium text-foreground",children:"Two-Factor Authentication"}),E.jsx("p",{className:"text-sm text-muted-foreground",children:"Add extra security"})]}),E.jsx(ay,{className:"w-5 h-5 text-muted-foreground"})]})]})]}),E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[E.jsx("div",{className:"p-4 border-b border-border",children:E.jsxs("div",{className:"flex items-center gap-3",children:[E.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:E.jsx(une,{className:"w-5 h-5"})}),E.jsx("h2",{className:"font-semibold text-foreground",children:"App Info"})]})}),E.jsx("div",{className:"p-4",children:E.jsxs("div",{className:"flex justify-between items-center",children:[E.jsx("p",{className:"text-muted-foreground",children:"Version"}),E.jsx("p",{className:"font-medium text-foreground",children:"1.0.0"})]})})]}),E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-card rounded-2xl shadow-elevated overflow-hidden border border-destructive/20",children:[E.jsx("div",{className:"p-4 border-b border-border",children:E.jsxs("div",{className:"flex items-center gap-3",children:[E.jsx("div",{className:"w-10 h-10 rounded-xl bg-destructive/10 flex items-center justify-center text-destructive",children:E.jsx(kf,{className:"w-5 h-5"})}),E.jsx("h2",{className:"font-semibold text-destructive",children:"Danger Zone"})]})}),E.jsx("div",{className:"p-4",children:E.jsxs(n0e,{children:[E.jsx(i0e,{asChild:!0,children:E.jsx(wn,{variant:"destructive",className:"w-full",children:"Delete Account"})}),E.jsxs(Wq,{children:[E.jsxs(qq,{children:[E.jsx(Kq,{children:"Are you absolutely sure?"}),E.jsx(Xq,{children:"This action cannot be undone. This will permanently delete your account and remove all your data from our servers."})]}),E.jsxs(Zq,{children:[E.jsx(Qq,{children:"Cancel"}),E.jsx(Yq,{onClick:I,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete Account"})]})]})]})})]})]}),E.jsx(Uf,{})]})}var JC="Collapsible",[o0e,Jq]=Qu(JC),[a0e,lL]=o0e(JC),e9=q.forwardRef((e,t)=>{const{__scopeCollapsible:i,open:l,defaultOpen:d,disabled:m,onOpenChange:v,...o}=e,[I,A]=Rf({prop:l,defaultProp:d??!1,onChange:v,caller:JC});return E.jsx(a0e,{scope:i,disabled:m,contentId:bf(),open:I,onOpenToggle:q.useCallback(()=>A(N=>!N),[A]),children:E.jsx(Ki.div,{"data-state":uL(I),"data-disabled":m?"":void 0,...o,ref:t})})});e9.displayName=JC;var t9="CollapsibleTrigger",n9=q.forwardRef((e,t)=>{const{__scopeCollapsible:i,...l}=e,d=lL(t9,i);return E.jsx(Ki.button,{type:"button","aria-controls":d.contentId,"aria-expanded":d.open||!1,"data-state":uL(d.open),"data-disabled":d.disabled?"":void 0,disabled:d.disabled,...l,ref:t,onClick:Li(e.onClick,d.onOpenToggle)})});n9.displayName=t9;var cL="CollapsibleContent",i9=q.forwardRef((e,t)=>{const{forceMount:i,...l}=e,d=lL(cL,e.__scopeCollapsible);return E.jsx(Fm,{present:i||d.open,children:({present:m})=>E.jsx(l0e,{...l,ref:t,present:m})})});i9.displayName=cL;var l0e=q.forwardRef((e,t)=>{const{__scopeCollapsible:i,present:l,children:d,...m}=e,v=lL(cL,i),[o,I]=q.useState(l),A=q.useRef(null),N=zr(t,A),F=q.useRef(0),z=F.current,$=q.useRef(0),J=$.current,H=v.open||o,re=q.useRef(H),Q=q.useRef(void 0);return q.useEffect(()=>{const ee=requestAnimationFrame(()=>re.current=!1);return()=>cancelAnimationFrame(ee)},[]),Ao(()=>{const ee=A.current;if(ee){Q.current=Q.current||{transitionDuration:ee.style.transitionDuration,animationName:ee.style.animationName},ee.style.transitionDuration="0s",ee.style.animationName="none";const ie=ee.getBoundingClientRect();F.current=ie.height,$.current=ie.width,re.current||(ee.style.transitionDuration=Q.current.transitionDuration,ee.style.animationName=Q.current.animationName),I(l)}},[v.open,l]),E.jsx(Ki.div,{"data-state":uL(v.open),"data-disabled":v.disabled?"":void 0,id:v.contentId,hidden:!H,...m,ref:N,style:{"--radix-collapsible-content-height":z?`${z}px`:void 0,"--radix-collapsible-content-width":J?`${J}px`:void 0,...e.style},children:H&&d})});function uL(e){return e?"open":"closed"}var c0e=e9,u0e=n9,d0e=i9,h0e=q.createContext(void 0);function r9(e){const t=q.useContext(h0e);return e||t||"ltr"}var cu="Accordion",f0e=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[dL,p0e,m0e]=Zk(cu),[eI,zbe]=Qu(cu,[m0e,Jq]),hL=Jq(),s9=rn.forwardRef((e,t)=>{const{type:i,...l}=e,d=l,m=l;return E.jsx(dL.Provider,{scope:e.__scopeAccordion,children:i==="multiple"?E.jsx(v0e,{...m,ref:t}):E.jsx(y0e,{...d,ref:t})})});s9.displayName=cu;var[o9,g0e]=eI(cu),[a9,_0e]=eI(cu,{collapsible:!1}),y0e=rn.forwardRef((e,t)=>{const{value:i,defaultValue:l,onValueChange:d=()=>{},collapsible:m=!1,...v}=e,[o,I]=Rf({prop:i,defaultProp:l??"",onChange:d,caller:cu});return E.jsx(o9,{scope:e.__scopeAccordion,value:rn.useMemo(()=>o?[o]:[],[o]),onItemOpen:I,onItemClose:rn.useCallback(()=>m&&I(""),[m,I]),children:E.jsx(a9,{scope:e.__scopeAccordion,collapsible:m,children:E.jsx(l9,{...v,ref:t})})})}),v0e=rn.forwardRef((e,t)=>{const{value:i,defaultValue:l,onValueChange:d=()=>{},...m}=e,[v,o]=Rf({prop:i,defaultProp:l??[],onChange:d,caller:cu}),I=rn.useCallback(N=>o((F=[])=>[...F,N]),[o]),A=rn.useCallback(N=>o((F=[])=>F.filter(z=>z!==N)),[o]);return E.jsx(o9,{scope:e.__scopeAccordion,value:v,onItemOpen:I,onItemClose:A,children:E.jsx(a9,{scope:e.__scopeAccordion,collapsible:!0,children:E.jsx(l9,{...m,ref:t})})})}),[x0e,tI]=eI(cu),l9=rn.forwardRef((e,t)=>{const{__scopeAccordion:i,disabled:l,dir:d,orientation:m="vertical",...v}=e,o=rn.useRef(null),I=zr(o,t),A=p0e(i),F=r9(d)==="ltr",z=Li(e.onKeyDown,$=>{var Be;if(!f0e.includes($.key))return;const J=$.target,H=A().filter(ot=>{var Et;return!((Et=ot.ref.current)!=null&&Et.disabled)}),re=H.findIndex(ot=>ot.ref.current===J),Q=H.length;if(re===-1)return;$.preventDefault();let ee=re;const ie=0,ue=Q-1,xe=()=>{ee=re+1,ee>ue&&(ee=ie)},Oe=()=>{ee=re-1,ee<ie&&(ee=ue)};switch($.key){case"Home":ee=ie;break;case"End":ee=ue;break;case"ArrowRight":m==="horizontal"&&(F?xe():Oe());break;case"ArrowDown":m==="vertical"&&xe();break;case"ArrowLeft":m==="horizontal"&&(F?Oe():xe());break;case"ArrowUp":m==="vertical"&&Oe();break}const ze=ee%Q;(Be=H[ze].ref.current)==null||Be.focus()});return E.jsx(x0e,{scope:i,disabled:l,direction:d,orientation:m,children:E.jsx(dL.Slot,{scope:i,children:E.jsx(Ki.div,{...v,"data-orientation":m,ref:I,onKeyDown:l?void 0:z})})})}),GS="AccordionItem",[b0e,fL]=eI(GS),c9=rn.forwardRef((e,t)=>{const{__scopeAccordion:i,value:l,...d}=e,m=tI(GS,i),v=g0e(GS,i),o=hL(i),I=bf(),A=l&&v.value.includes(l)||!1,N=m.disabled||e.disabled;return E.jsx(b0e,{scope:i,open:A,disabled:N,triggerId:I,children:E.jsx(c0e,{"data-orientation":m.orientation,"data-state":m9(A),...o,...d,ref:t,disabled:N,open:A,onOpenChange:F=>{F?v.onItemOpen(l):v.onItemClose(l)}})})});c9.displayName=GS;var u9="AccordionHeader",d9=rn.forwardRef((e,t)=>{const{__scopeAccordion:i,...l}=e,d=tI(cu,i),m=fL(u9,i);return E.jsx(Ki.h3,{"data-orientation":d.orientation,"data-state":m9(m.open),"data-disabled":m.disabled?"":void 0,...l,ref:t})});d9.displayName=u9;var FM="AccordionTrigger",h9=rn.forwardRef((e,t)=>{const{__scopeAccordion:i,...l}=e,d=tI(cu,i),m=fL(FM,i),v=_0e(FM,i),o=hL(i);return E.jsx(dL.ItemSlot,{scope:i,children:E.jsx(u0e,{"aria-disabled":m.open&&!v.collapsible||void 0,"data-orientation":d.orientation,id:m.triggerId,...o,...l,ref:t})})});h9.displayName=FM;var f9="AccordionContent",p9=rn.forwardRef((e,t)=>{const{__scopeAccordion:i,...l}=e,d=tI(cu,i),m=fL(f9,i),v=hL(i);return E.jsx(d0e,{role:"region","aria-labelledby":m.triggerId,"data-orientation":d.orientation,...v,...l,ref:t,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...e.style}})});p9.displayName=f9;function m9(e){return e?"open":"closed"}var w0e=s9,T0e=c9,E0e=d9,g9=h9,_9=p9;const S0e=w0e,y9=q.forwardRef(({className:e,...t},i)=>E.jsx(T0e,{ref:i,className:Xn("border-b",e),...t}));y9.displayName="AccordionItem";const v9=q.forwardRef(({className:e,children:t,...i},l)=>E.jsx(E0e,{className:"flex",children:E.jsxs(g9,{ref:l,className:Xn("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",e),...i,children:[t,E.jsx(gC,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));v9.displayName=g9.displayName;const x9=q.forwardRef(({className:e,children:t,...i},l)=>E.jsx(_9,{ref:l,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...i,children:E.jsx("div",{className:Xn("pb-4 pt-0",e),children:t})}));x9.displayName=_9.displayName;const C0e=[{question:"How do I place an order?",answer:"Browse kitchens near you, select dishes from the menu, add them to your cart, and proceed to checkout. You can pay using various payment methods including UPI, cards, and cash on delivery."},{question:"How can I track my order?",answer:"Once your order is placed, you can track it in real-time from the 'My Orders' section. You'll receive notifications at each stage - from acceptance to delivery."},{question:"What if I want to cancel my order?",answer:"You can cancel your order before it's accepted by the kitchen. Go to 'My Orders', select the order, and tap 'Cancel Order'. Once accepted, please contact support for cancellation."},{question:"How do refunds work?",answer:"Refunds are processed within 5-7 business days to your original payment method. For wallet credits, refunds are instant."},{question:"How do I become an Amma (Home Cook)?",answer:"Go to your Profile, tap 'Become an Amma', and follow the registration process. You'll need to provide your kitchen details, FSSAI license (if applicable), and complete verification."},{question:"What areas do you serve?",answer:"We currently serve in select cities. Enter your location on the home page to check if we deliver to your area. We're expanding rapidly!"},{question:"How do I apply a coupon?",answer:"At checkout, enter your coupon code in the 'Apply Discount Coupon' section and tap 'Apply'. Valid coupons will be applied to your order total."}],I0e=[{icon:nne,title:"Live Chat",subtitle:"Chat with our support team",action:"Start Chat",color:"text-primary",bgColor:"bg-primary/10"},{icon:one,title:"Call Us",subtitle:"+91 1800-XXX-XXXX",action:"Call Now",color:"text-green-600",bgColor:"bg-green-100"},{icon:ene,title:"Email Support",subtitle:"support@ammacheythivanta.com",action:"Send Email",color:"text-gold",bgColor:"bg-gold/10"}];function A0e(){return E.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[E.jsxs("div",{className:"bg-card border-b border-border px-4 py-4 flex items-center gap-4 sticky top-0 z-10",children:[E.jsx(Fr,{to:"/profile",children:E.jsx(bn.div,{whileTap:{scale:.9},className:"p-2 -ml-2",children:E.jsx(Wf,{className:"w-6 h-6 text-foreground"})})}),E.jsx("h1",{className:"text-lg font-bold text-foreground",children:"Help & Support"})]}),E.jsxs("div",{className:"p-4 space-y-4",children:[E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[E.jsxs("div",{className:"p-4 border-b border-border",children:[E.jsx("h2",{className:"font-semibold text-foreground",children:"Contact Us"}),E.jsx("p",{className:"text-sm text-muted-foreground",children:"We're here to help 24/7"})]}),E.jsx("div",{className:"divide-y divide-border",children:I0e.map((e,t)=>E.jsxs(bn.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:t*.1},className:"flex items-center gap-4 p-4",children:[E.jsx("div",{className:`w-12 h-12 rounded-xl ${e.bgColor} flex items-center justify-center ${e.color}`,children:E.jsx(e.icon,{className:"w-6 h-6"})}),E.jsxs("div",{className:"flex-1",children:[E.jsx("p",{className:"font-medium text-foreground",children:e.title}),E.jsx("p",{className:"text-sm text-muted-foreground",children:e.subtitle})]}),E.jsx(wn,{variant:"outline",size:"sm",className:"rounded-xl",children:e.action})]},e.title))})]}),E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[E.jsxs("div",{className:"p-4 border-b border-border",children:[E.jsx("h2",{className:"font-semibold text-foreground",children:"Frequently Asked Questions"}),E.jsx("p",{className:"text-sm text-muted-foreground",children:"Quick answers to common questions"})]}),E.jsx(S0e,{type:"single",collapsible:!0,className:"px-4",children:C0e.map((e,t)=>E.jsxs(y9,{value:`item-${t}`,children:[E.jsx(v9,{className:"text-left text-foreground hover:text-primary",children:e.question}),E.jsx(x9,{className:"text-muted-foreground",children:e.answer})]},t))})]}),E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[E.jsx("div",{className:"p-4 border-b border-border",children:E.jsx("h2",{className:"font-semibold text-foreground",children:"Quick Links"})}),E.jsxs("div",{className:"divide-y divide-border",children:[E.jsxs("div",{className:"flex items-center gap-4 p-4",children:[E.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:E.jsx($2,{className:"w-5 h-5"})}),E.jsx("span",{className:"flex-1 font-medium text-foreground",children:"Terms & Conditions"}),E.jsx(U2,{className:"w-5 h-5 text-muted-foreground"})]}),E.jsxs("div",{className:"flex items-center gap-4 p-4",children:[E.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:E.jsx($2,{className:"w-5 h-5"})}),E.jsx("span",{className:"flex-1 font-medium text-foreground",children:"Privacy Policy"}),E.jsx(U2,{className:"w-5 h-5 text-muted-foreground"})]}),E.jsxs("div",{className:"flex items-center gap-4 p-4",children:[E.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:E.jsx($2,{className:"w-5 h-5"})}),E.jsx("span",{className:"flex-1 font-medium text-foreground",children:"Refund Policy"}),E.jsx(U2,{className:"w-5 h-5 text-muted-foreground"})]})]})]}),E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-gradient-to-br from-primary/10 to-gold/10 rounded-2xl p-6 text-center",children:[E.jsx("h3",{className:"font-semibold text-foreground mb-2",children:"Love our app?"}),E.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Rate us on the Play Store and help us improve!"}),E.jsx(wn,{className:"rounded-xl px-6",children:"Rate Now "})]})]}),E.jsx(Uf,{})]})}function P0e(){const[e,t]=q.useState(""),[i,l]=q.useState(null),{kitchens:d,loading:m}=L7(),v=[{id:"veg",label:"Veg",icon:Jk},{id:"biryani",label:"Biryani",emoji:""},{id:"tiffin",label:"Tiffins",emoji:""},{id:"meals",label:"Meals",emoji:""},{id:"sweets",label:"Sweets",emoji:""}],o=d.filter(I=>{const A=!e||I.name.toLowerCase().includes(e.toLowerCase())||I.specialties.some(F=>F.toLowerCase().includes(e.toLowerCase())),N=!i||i==="veg"&&I.isVeg||I.specialties.some(F=>F.toLowerCase().includes(i.toLowerCase()));return A&&N});return E.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[E.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border px-4 py-4",children:[E.jsxs("div",{className:"relative",children:[E.jsx(tD,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),E.jsx("input",{type:"text",value:e,onChange:I=>t(I.target.value),placeholder:"Search dishes, kitchens...",className:"w-full pl-12 pr-4 py-3 rounded-xl bg-secondary border-0 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20",autoFocus:!0})]}),E.jsx("div",{className:"flex gap-2 mt-4 overflow-x-auto hide-scrollbar",children:v.map(I=>E.jsxs(bn.button,{whileTap:{scale:.95},onClick:()=>l(i===I.id?null:I.id),className:`flex items-center gap-1.5 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${i===I.id?"gradient-primary text-primary-foreground":"bg-secondary text-secondary-foreground"}`,children:[I.icon?E.jsx(I.icon,{className:"w-4 h-4"}):E.jsx("span",{children:I.emoji}),I.label]},I.id))})]}),!e&&E.jsxs("div",{className:"px-4 py-4",children:[E.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide mb-3",children:"Popular Searches"}),E.jsx("div",{className:"flex flex-wrap gap-2",children:["Biryani","Idli Dosa","Thali","Chicken Curry","Pickles"].map(I=>E.jsx(bn.button,{whileTap:{scale:.95},onClick:()=>t(I),className:"px-4 py-2 rounded-full bg-secondary text-secondary-foreground text-sm",children:I},I))})]}),E.jsx("div",{className:"px-4 py-4",children:m?E.jsx("div",{className:"flex items-center justify-center py-12",children:E.jsx(kr,{className:"w-8 h-8 animate-spin text-primary"})}):o.length===0?E.jsx("div",{className:"text-center py-12",children:E.jsx("p",{className:"text-muted-foreground",children:"No kitchens found"})}):E.jsxs(E.Fragment,{children:[E.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:[o.length," kitchens found"]}),E.jsx("div",{className:"space-y-4",children:o.map((I,A)=>E.jsx(N7,{kitchen:I,index:A},I.id))})]})}),E.jsx(Uf,{})]})}const aV={pending:{label:"Order Placed",color:"text-muted-foreground",icon:g1},accepted:{label:"Accepted",color:"text-gold",icon:Zu},cooking:{label:"Cooking",color:"text-primary",icon:Mf},packed:{label:"Ready",color:"text-accent",icon:wm},out_for_delivery:{label:"On the way",color:"text-accent",icon:dne},delivered:{label:"Delivered",color:"text-accent",icon:Zu},cancelled:{label:"Cancelled",color:"text-destructive",icon:g1}};function R0e(){const{user:e}=Sa(),{orders:t,loading:i,error:l}=cve(e==null?void 0:e.id),[d,m]=q.useState("active"),v=t.filter(I=>!["delivered","cancelled"].includes(I.status)),o=t.filter(I=>["delivered","cancelled"].includes(I.status));return e?E.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[E.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border px-4 py-4",children:[E.jsx("h1",{className:"text-xl font-bold text-foreground",children:"My Orders"}),E.jsx("div",{className:"flex bg-secondary rounded-xl p-1 mt-4",children:["active","past"].map(I=>E.jsx("button",{onClick:()=>m(I),className:`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${d===I?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:I==="active"?"Active":"Past Orders"},I))})]}),E.jsxs("div",{className:"px-4 py-4 space-y-4",children:[i?E.jsx("div",{className:"flex items-center justify-center py-12",children:E.jsx(kr,{className:"w-8 h-8 animate-spin text-primary"})}):l?E.jsx("div",{className:"text-center py-12",children:E.jsx("p",{className:"text-destructive",children:l})}):(d==="active"?v:o).map((I,A)=>{const N=aV[I.status],F=N.icon;return E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:A*.1},className:"bg-card rounded-2xl p-4 shadow-card",children:[E.jsxs("div",{className:"flex items-start justify-between mb-3",children:[E.jsxs("div",{children:[E.jsx("h3",{className:"font-semibold text-foreground",children:I.kitchenName}),E.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",I.id.slice(-8)]})]}),E.jsxs("div",{className:Xn("flex items-center gap-1 px-2 py-1 rounded-full bg-secondary",N.color),children:[E.jsx(F,{className:"w-3 h-3"}),E.jsx("span",{className:"text-xs font-medium",children:N.label})]})]}),E.jsx("div",{className:"text-sm text-muted-foreground mb-3",children:I.items.map((z,$)=>E.jsxs("span",{children:[z.dish.name," x",z.quantity,$<I.items.length-1&&", "]},$))}),E.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-border",children:[E.jsxs("span",{className:"font-semibold text-foreground",children:["",I.totalAmount]}),I.estimatedDelivery&&E.jsxs("span",{className:"text-sm text-muted-foreground",children:["ETA: ",I.estimatedDelivery]})]}),!["delivered","cancelled"].includes(I.status)&&E.jsx("div",{className:"mt-4 pt-4 border-t border-border",children:E.jsx("div",{className:"flex items-center justify-between",children:["accepted","cooking","packed","out_for_delivery"].map((z,$)=>{const J=aV[z],H=J.icon,re=["pending","accepted","cooking","packed","out_for_delivery"],Q=re.indexOf(I.status),ee=re.indexOf(z),ie=Q>=ee;return E.jsxs("div",{className:"flex flex-col items-center gap-1",children:[E.jsx("div",{className:Xn("w-8 h-8 rounded-full flex items-center justify-center transition-all",ie?"bg-primary text-primary-foreground":"bg-secondary text-muted-foreground"),children:E.jsx(H,{className:"w-4 h-4"})}),E.jsx("span",{className:Xn("text-[10px]",ie?"text-foreground":"text-muted-foreground"),children:J.label})]},z)})})})]},I.id)}),!i&&(d==="active"?v:o).length===0&&E.jsxs("div",{className:"text-center py-12",children:[E.jsx(wm,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),E.jsx("p",{className:"text-muted-foreground",children:d==="active"?"No active orders":"No past orders"})]})]}),E.jsx(Uf,{})]}):E.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4 pb-24",children:[E.jsx(wm,{className:"w-16 h-16 text-muted-foreground mb-4"}),E.jsx("p",{className:"text-muted-foreground mb-4",children:"Please login to view orders"}),E.jsx(Fr,{to:"/auth",children:E.jsx(wn,{className:"gradient-primary text-primary-foreground",children:"Login"})}),E.jsx(Uf,{})]})}function pL(e){const[t,i]=q.useState([]),[l,d]=q.useState(!0),[m,v]=q.useState(null);return q.useEffect(()=>{if(!e){d(!1);return}const o=xi(bi,"kitchens"),I=Uo(o,A=>{try{const N=A.val();if(N){const F=Object.entries(N).map(([z,$])=>({...$,id:z})).filter(z=>z.ownerId===e);i(F)}else i([]);d(!1)}catch{v("Failed to fetch kitchens"),d(!1)}});return()=>I()},[e]),{kitchens:t,loading:l,error:m}}function M0e(e){const[t,i]=q.useState([]),[l,d]=q.useState(!0),[m,v]=q.useState(null);return q.useEffect(()=>{if(!e){d(!1);return}const o=xi(bi,"orders"),I=Uo(o,A=>{try{const N=A.val();if(N){const F=Object.entries(N).map(([z,$])=>({...$,id:z})).filter(z=>z.kitchenId===e).sort((z,$)=>$.createdAt-z.createdAt);i(F)}else i([]);d(!1)}catch{v("Failed to fetch orders"),d(!1)}});return()=>I()},[e]),{orders:t,loading:l,error:m}}function mL(){const[e,t]=q.useState([]),[i,l]=q.useState(!0),[d,m]=q.useState(null);return q.useEffect(()=>{const v=xi(bi,"kitchens"),o=Uo(v,I=>{try{const A=I.val();if(A){const N=Object.entries(A).map(([F,z])=>({...z,id:F}));t(N)}else t([]);l(!1)}catch{m("Failed to fetch kitchens"),l(!1)}});return()=>o()},[]),{kitchens:e,loading:i,error:d}}function b9(){const[e,t]=q.useState([]),[i,l]=q.useState(!0),[d,m]=q.useState(null);return q.useEffect(()=>{const v=xi(bi,"orders"),o=Uo(v,I=>{try{const A=I.val();if(A){const N=Object.entries(A).map(([F,z])=>({...z,id:F})).sort((F,z)=>z.createdAt-F.createdAt);t(N)}else t([]);l(!1)}catch{m("Failed to fetch orders"),l(!1)}});return()=>o()},[]),{orders:e,loading:i,error:d}}function w9(){const[e,t]=q.useState([]),[i,l]=q.useState(!0),[d,m]=q.useState(null);return q.useEffect(()=>{const v=xi(bi,"users"),o=Uo(v,I=>{try{const A=I.val();if(A){const N=Object.entries(A).map(([F,z])=>({...z,id:F}));t(N)}else t([]);l(!1)}catch{m("Failed to fetch users"),l(!1)}});return()=>o()},[]),{users:e,loading:i,error:d}}async function gL(e){const t=xi(bi,`kitchens/${e}`);await Qc(t,{isApproved:!0})}async function _L(e){const t=xi(bi,`kitchens/${e}`);await Gm(t)}async function k0e(e){const t=xi(bi,`users/${e}`);await Gm(t)}async function D0e(e,t,i){const l=xi(bi,`users/${e}`);if(i&&i!==t){if(i==="amma"){const d=xi(bi,"kitchens"),v=(await new Promise((o,I)=>{Uo(d,o,{onlyOnce:!0})})).val();if(v){const o=[];Object.entries(v).forEach(([I,A])=>{A.ownerId===e&&(o.push(Gm(xi(bi,`kitchens/${I}`))),o.push(N0e(I)))}),await Promise.all(o)}}if(i==="franchise_admin"){const d=xi(bi,"franchises"),v=(await new Promise((o,I)=>{Uo(d,o,{onlyOnce:!0})})).val();if(v){const o=[];Object.entries(v).forEach(([I,A])=>{A.adminId===e&&o.push(Qc(xi(bi,`franchises/${I}`),{adminId:"",adminName:"",adminEmail:""}))}),await Promise.all(o)}await Qc(l,{franchiseId:null})}}await Qc(l,{role:t})}async function N0e(e){const t=xi(bi,"dishes"),l=(await new Promise((d,m)=>{Uo(t,d,{onlyOnce:!0})})).val();if(l){const d=[];Object.entries(l).forEach(([m,v])=>{v.kitchenId===e&&d.push(Gm(xi(bi,`dishes/${m}`)))}),await Promise.all(d)}}const L0e={pending:{label:"New Order",color:"bg-gold text-foreground",nextStatus:"accepted"},accepted:{label:"Accepted",color:"bg-primary text-primary-foreground",nextStatus:"cooking"},cooking:{label:"Cooking",color:"bg-accent text-accent-foreground",nextStatus:"packed"},packed:{label:"Ready",color:"bg-veg text-primary-foreground",nextStatus:"out_for_delivery"},out_for_delivery:{label:"Out for Delivery",color:"bg-accent text-accent-foreground",nextStatus:"delivered"},delivered:{label:"Delivered",color:"bg-muted text-muted-foreground"},cancelled:{label:"Cancelled",color:"bg-destructive text-destructive-foreground"}};function O0e(){const{user:e,signOut:t}=Sa(),i=Qa(),{kitchens:l,loading:d}=pL(e==null?void 0:e.id),[m,v]=q.useState(null),{orders:o,loading:I}=M0e(m||void 0),{dishes:A}=O7(m||void 0),{coupons:N}=vve(m||void 0),[F,z]=q.useState("orders"),[$,J]=q.useState(!1),[H,re]=q.useState({code:"",discountType:"percentage",discountValue:10,minOrderAmount:0,maxDiscount:0}),[Q,ee]=q.useState(!1);q.useEffect(()=>{l.length>0&&!m&&v(l[0].id)},[l,m]);const ie=l.find(at=>at.id===m),ue=o.filter(at=>!["delivered","cancelled"].includes(at.status)),xe=o.filter(at=>{const zt=new Date;return new Date(at.createdAt).toDateString()===zt.toDateString()}),Oe=xe.reduce((at,zt)=>at+zt.totalAmount,0),ze=async(at,zt)=>{try{await pve(at,zt),Mn.success(`Order ${zt==="cancelled"?"cancelled":"updated"}!`)}catch{Mn.error("Failed to update order")}},Be=async()=>{if(!(!m||!ie))try{await F7(m,{isOpen:!ie.isOpen}),Mn.success(ie.isOpen?"Kitchen closed":"Kitchen opened")}catch{Mn.error("Failed to update kitchen status")}},ot=async()=>{if(!m||!H.code.trim()){Mn.error("Please enter a coupon code");return}ee(!0);try{await mve({code:H.code.toUpperCase(),kitchenId:m,discountType:H.discountType,discountValue:H.discountValue,minOrderAmount:H.minOrderAmount||void 0,maxDiscount:H.maxDiscount||void 0,usedCount:0,isActive:!0,createdAt:Date.now()}),Mn.success("Coupon created!"),J(!1),re({code:"",discountType:"percentage",discountValue:10,minOrderAmount:0,maxDiscount:0})}catch{Mn.error("Failed to create coupon")}ee(!1)},Et=async at=>{try{await _ve(at),Mn.success("Coupon deleted")}catch{Mn.error("Failed to delete coupon")}},Zt=async at=>{try{await gve(at.id,{isActive:!at.isActive}),Mn.success(at.isActive?"Coupon deactivated":"Coupon activated")}catch{Mn.error("Failed to update coupon")}};return!e||e.role!=="amma"?E.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[E.jsx(Mf,{className:"w-16 h-16 text-muted-foreground mb-4"}),E.jsx("p",{className:"text-muted-foreground mb-4",children:"You need to be registered as an Amma to access this"}),E.jsx(Fr,{to:"/",children:E.jsx(wn,{className:"gradient-primary text-primary-foreground",children:"Go Home"})})]}):d?E.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:E.jsx(kr,{className:"w-8 h-8 animate-spin text-primary"})}):l.length===0?E.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[E.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:E.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[E.jsx("h1",{className:"font-semibold text-foreground",children:"My Kitchen"}),E.jsx(wn,{variant:"ghost",size:"icon",onClick:async()=>{await t(),i("/auth")},className:"text-destructive",children:E.jsx(_1,{className:"w-5 h-5"})})]})}),E.jsxs("div",{className:"flex flex-col items-center justify-center px-4 py-16",children:[E.jsx(Mf,{className:"w-20 h-20 text-muted-foreground mb-4"}),E.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"No Kitchen Yet"}),E.jsx("p",{className:"text-muted-foreground text-center mb-6",children:"Start your home kitchen journey and share your delicious food with the community!"}),E.jsx(Fr,{to:"/amma/register",children:E.jsxs(wn,{className:"gradient-primary text-primary-foreground",children:[E.jsx(ly,{className:"w-5 h-5 mr-2"})," Register Your Kitchen"]})})]})]}):E.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[E.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:[E.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[E.jsxs("div",{children:[E.jsx("h1",{className:"font-semibold text-foreground",children:ie==null?void 0:ie.name}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Kitchen Dashboard"})]}),E.jsxs("div",{className:"flex items-center gap-2",children:[E.jsx(wn,{onClick:Be,variant:"outline",size:"sm",className:Xn("rounded-full",ie!=null&&ie.isOpen?"border-veg text-veg":"border-destructive text-destructive"),children:ie!=null&&ie.isOpen?" Open":" Closed"}),E.jsx(wn,{variant:"ghost",size:"icon",onClick:()=>i(`/amma/edit-kitchen/${m}`),title:"Edit Kitchen",children:E.jsx(I8,{className:"w-5 h-5"})}),E.jsx(wn,{variant:"ghost",size:"icon",onClick:async()=>{await t(),i("/auth")},className:"text-destructive",children:E.jsx(_1,{className:"w-5 h-5"})})]})]}),E.jsxs("div",{className:"grid grid-cols-3 gap-2 px-4 pb-4",children:[E.jsxs("div",{className:"bg-secondary rounded-xl p-3 text-center",children:[E.jsx("p",{className:"text-lg font-bold text-foreground",children:ue.length}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Active"})]}),E.jsxs("div",{className:"bg-secondary rounded-xl p-3 text-center",children:[E.jsx("p",{className:"text-lg font-bold text-foreground",children:xe.length}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Today"})]}),E.jsxs("div",{className:"bg-secondary rounded-xl p-3 text-center",children:[E.jsxs("p",{className:"text-lg font-bold text-primary",children:["",Oe]}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Earnings"})]})]}),E.jsx("div",{className:"flex bg-secondary mx-4 rounded-xl p-1 mb-4",children:["orders","menu","coupons","stats"].map(at=>E.jsx("button",{onClick:()=>z(at),className:`flex-1 py-2 rounded-lg text-xs font-medium transition-all capitalize ${F===at?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:at},at))})]}),E.jsxs("div",{className:"px-4 py-4",children:[F==="orders"&&E.jsx("div",{className:"space-y-4",children:I?E.jsx("div",{className:"flex justify-center py-8",children:E.jsx(kr,{className:"w-8 h-8 animate-spin text-primary"})}):ue.length===0?E.jsxs("div",{className:"text-center py-12",children:[E.jsx(wm,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),E.jsx("p",{className:"text-muted-foreground",children:"No active orders"})]}):E.jsx(VN,{children:ue.map((at,zt)=>E.jsx(F0e,{order:at,index:zt,onStatusUpdate:ze},at.id))})}),F==="menu"&&E.jsxs("div",{className:"space-y-4",children:[E.jsxs("div",{className:"flex justify-between items-center",children:[E.jsxs("h2",{className:"font-semibold text-foreground",children:["Your Dishes (",A.length,")"]}),E.jsx(Fr,{to:"/amma/add-dish",children:E.jsxs(wn,{size:"sm",className:"gradient-primary text-primary-foreground",children:[E.jsx(ly,{className:"w-4 h-4 mr-1"})," Add"]})})]}),A.length===0?E.jsx("div",{className:"text-center py-12",children:E.jsx("p",{className:"text-muted-foreground",children:"No dishes yet. Add your first dish!"})}):A.map(at=>E.jsxs(bn.div,{className:"bg-card rounded-xl p-4 shadow-card flex gap-4",children:[E.jsx("img",{src:at.image,alt:at.name,className:"w-20 h-20 rounded-lg object-cover"}),E.jsxs("div",{className:"flex-1",children:[E.jsx("h3",{className:"font-medium text-foreground",children:at.name}),E.jsx("p",{className:"text-sm text-muted-foreground",children:at.category}),E.jsxs("p",{className:"text-primary font-semibold",children:["",at.price]})]}),E.jsxs("div",{className:"flex flex-col gap-2",children:[E.jsx(wn,{size:"icon",variant:"ghost",children:E.jsx(A8,{className:"w-4 h-4"})}),E.jsx(wn,{size:"icon",variant:"ghost",className:"text-destructive",onClick:()=>{hve(at.id),Mn.success("Dish deleted")},children:E.jsx(kf,{className:"w-4 h-4"})})]})]},at.id))]}),F==="coupons"&&E.jsxs("div",{className:"space-y-4",children:[E.jsxs("div",{className:"flex justify-between items-center",children:[E.jsxs("h2",{className:"font-semibold text-foreground",children:["Your Coupons (",N.length,")"]}),E.jsxs(wn,{size:"sm",className:"gradient-primary text-primary-foreground",onClick:()=>J(!$),children:[E.jsx(ly,{className:"w-4 h-4 mr-1"})," Create"]})]}),$&&E.jsxs(bn.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"bg-card rounded-xl p-4 shadow-card space-y-3",children:[E.jsx("h3",{className:"font-medium text-foreground",children:"Create New Coupon"}),E.jsx(Yi,{placeholder:"Coupon Code (e.g., SAVE20)",value:H.code,onChange:at=>re({...H,code:at.target.value.toUpperCase()}),className:"bg-secondary border-0 uppercase"}),E.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[E.jsxs("select",{value:H.discountType,onChange:at=>re({...H,discountType:at.target.value}),className:"bg-secondary rounded-md px-3 py-2 text-sm text-foreground",children:[E.jsx("option",{value:"percentage",children:"% Off"}),E.jsx("option",{value:"fixed",children:" Fixed Off"}),E.jsx("option",{value:"final_price",children:"Final Price"})]}),E.jsx(Yi,{type:"number",placeholder:H.discountType==="percentage"?"% value":" amount",value:H.discountValue,onChange:at=>re({...H,discountValue:Number(at.target.value)}),className:"bg-secondary border-0"})]}),E.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[E.jsx(Yi,{type:"number",placeholder:"Min Order  (optional)",value:H.minOrderAmount||"",onChange:at=>re({...H,minOrderAmount:Number(at.target.value)}),className:"bg-secondary border-0"}),H.discountType==="percentage"&&E.jsx(Yi,{type:"number",placeholder:"Max Discount  (optional)",value:H.maxDiscount||"",onChange:at=>re({...H,maxDiscount:Number(at.target.value)}),className:"bg-secondary border-0"})]}),E.jsxs("div",{className:"flex gap-2",children:[E.jsx(wn,{onClick:ot,disabled:Q,className:"flex-1 gradient-primary text-primary-foreground",children:Q?E.jsx(kr,{className:"w-4 h-4 animate-spin"}):"Create Coupon"}),E.jsx(wn,{variant:"outline",onClick:()=>J(!1),children:"Cancel"})]})]}),N.length===0&&!$?E.jsxs("div",{className:"text-center py-12",children:[E.jsx(R8,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),E.jsx("p",{className:"text-muted-foreground",children:"No coupons yet. Create your first coupon!"})]}):N.map(at=>E.jsx(bn.div,{className:"bg-card rounded-xl p-4 shadow-card",children:E.jsxs("div",{className:"flex items-center justify-between",children:[E.jsxs("div",{className:"flex items-center gap-3",children:[E.jsx("div",{className:Xn("w-12 h-12 rounded-lg flex items-center justify-center",at.isActive?"bg-veg/10":"bg-muted"),children:E.jsx(sne,{className:Xn("w-6 h-6",at.isActive?"text-veg":"text-muted-foreground")})}),E.jsxs("div",{children:[E.jsx("p",{className:"font-bold text-foreground",children:at.code}),E.jsxs("p",{className:"text-xs text-muted-foreground",children:[at.discountType==="percentage"&&`${at.discountValue}% off`,at.discountType==="fixed"&&`${at.discountValue} off`,at.discountType==="final_price"&&`Final price: ${at.discountValue}`,at.minOrderAmount?`  Min ${at.minOrderAmount}`:""]}),E.jsxs("p",{className:"text-xs text-muted-foreground",children:["Used: ",at.usedCount," times"]})]})]}),E.jsxs("div",{className:"flex gap-2",children:[E.jsx(wn,{size:"icon",variant:"ghost",onClick:()=>Zt(at),className:at.isActive?"text-veg":"text-muted-foreground",children:at.isActive?E.jsx(Zu,{className:"w-4 h-4"}):E.jsx(Kc,{className:"w-4 h-4"})}),E.jsx(wn,{size:"icon",variant:"ghost",className:"text-destructive",onClick:()=>Et(at.id),children:E.jsx(kf,{className:"w-4 h-4"})})]})]})},at.id))]}),F==="stats"&&E.jsxs("div",{className:"space-y-4",children:[E.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[E.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Today's Summary"}),E.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[E.jsxs("div",{className:"bg-secondary rounded-xl p-4",children:[E.jsx(Xte,{className:"w-6 h-6 text-primary mb-2"}),E.jsxs("p",{className:"text-2xl font-bold text-foreground",children:["",Oe]}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Earnings"})]}),E.jsxs("div",{className:"bg-secondary rounded-xl p-4",children:[E.jsx(nD,{className:"w-6 h-6 text-accent mb-2"}),E.jsx("p",{className:"text-2xl font-bold text-foreground",children:xe.length}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Orders Completed"})]})]})]}),E.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[E.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Kitchen Info"}),E.jsxs("div",{className:"space-y-3 text-sm",children:[E.jsxs("div",{className:"flex justify-between",children:[E.jsx("span",{className:"text-muted-foreground",children:"Rating"}),E.jsxs("span",{className:"text-foreground font-medium",children:[" ",ie==null?void 0:ie.rating]})]}),E.jsxs("div",{className:"flex justify-between",children:[E.jsx("span",{className:"text-muted-foreground",children:"Total Reviews"}),E.jsx("span",{className:"text-foreground font-medium",children:ie==null?void 0:ie.totalRatings})]}),E.jsxs("div",{className:"flex justify-between",children:[E.jsx("span",{className:"text-muted-foreground",children:"Menu Items"}),E.jsx("span",{className:"text-foreground font-medium",children:A.length})]})]})]})]})]})]})}function F0e({order:e,index:t,onStatusUpdate:i}){const l=L0e[e.status];return E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-100},transition:{delay:t*.05},className:"bg-card rounded-2xl p-4 shadow-card",children:[E.jsxs("div",{className:"flex items-start justify-between mb-3",children:[E.jsxs("div",{children:[E.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",e.id.slice(-8)]}),E.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(e.createdAt).toLocaleTimeString()})]}),E.jsx("span",{className:Xn("px-3 py-1 rounded-full text-xs font-medium",l.color),children:l.label})]}),E.jsx("div",{className:"space-y-1 mb-3",children:e.items.map((d,m)=>E.jsxs("div",{className:"flex justify-between text-sm",children:[E.jsxs("span",{className:"text-foreground",children:[d.dish.name," x",d.quantity]}),E.jsxs("span",{className:"text-muted-foreground",children:["",d.dish.price*d.quantity]})]},m))}),e.notes&&E.jsx("div",{className:"bg-secondary rounded-lg p-2 mb-3",children:E.jsxs("p",{className:"text-xs text-muted-foreground",children:["Note: ",e.notes]})}),E.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-3",children:[E.jsx(ya,{className:"w-3 h-3"}),E.jsxs("span",{children:[e.deliveryAddress.line1,", ",e.deliveryAddress.city]})]}),E.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-border",children:[E.jsxs("span",{className:"font-bold text-foreground",children:["",e.totalAmount]}),E.jsxs("div",{className:"flex gap-2",children:[e.status!=="cancelled"&&l.nextStatus&&E.jsxs(wn,{size:"sm",className:"gradient-primary text-primary-foreground",onClick:()=>i(e.id,l.nextStatus),children:[E.jsx(Zu,{className:"w-4 h-4 mr-1"}),l.nextStatus==="accepted"?"Accept":"Next"]}),e.status==="pending"&&E.jsx(wn,{size:"sm",variant:"outline",className:"text-destructive border-destructive",onClick:()=>i(e.id,"cancelled"),children:E.jsx(Kc,{className:"w-4 h-4"})})]})]})]})}const z0e="271837f4240842ef12577a95dbae3e88",j0e="https://api.imgbb.com/1/upload";async function T9(e){const t=new FormData;t.append("key",z0e),t.append("image",e);const i=await fetch(j0e,{method:"POST",body:t});if(!i.ok)throw new Error("Failed to upload image");return i.json()}async function E9(e){try{return(await T9(e)).data}catch(t){return console.error("ImgBB upload error:",t),null}}function S9(){const[e,t]=q.useState([]),[i,l]=q.useState(!0),[d,m]=q.useState(null);return q.useEffect(()=>{const v=xi(bi,"franchises"),o=Uo(v,I=>{try{const A=I.val();if(A){const N=Object.entries(A).map(([F,z])=>({...z,id:F}));t(N)}else t([]);l(!1)}catch{m("Failed to fetch franchises"),l(!1)}});return()=>o()},[]),{franchises:e,loading:i,error:d}}function B0e(e){const[t,i]=q.useState(null),[l,d]=q.useState(!0),[m,v]=q.useState(null);return q.useEffect(()=>{if(!e){d(!1);return}const o=xi(bi,`franchises/${e}`),I=Uo(o,A=>{try{const N=A.val();i(N?{...N,id:e}:null),d(!1)}catch{v("Failed to fetch franchise"),d(!1)}});return()=>I()},[e]),{franchise:t,loading:l,error:m}}function V0e(){const[e,t]=q.useState([]),[i,l]=q.useState(!0),[d,m]=q.useState(0),v=q.useCallback(()=>{m(o=>o+1)},[]);return q.useEffect(()=>{const o=xi(bi,"users"),I=Uo(o,A=>{const N=A.val();if(N){const F=Object.entries(N).map(([z,$])=>({...$,id:z}));t(F)}else t([]);l(!1)});return()=>I()},[d]),{users:e,loading:i,refetch:v}}async function U0e(e){try{const t=xi(bi,"franchises"),i=hb(t);return await Yc(i,e),e.adminId&&await Qc(xi(bi,`users/${e.adminId}`),{role:"franchise_admin",franchiseId:i.key}),i.key}catch(t){return console.error("Error creating franchise:",t),null}}async function $0e(e,t){t&&await Qc(xi(bi,`users/${t}`),{role:"user",franchiseId:null});const i=xi(bi,`franchises/${e}`);await Gm(i)}async function G0e(e,t,i,l){try{const d=await ND(Bu,e,t),m={id:d.user.uid,email:e,name:i,phone:l,role:"franchise_admin",createdAt:Date.now()};return await Yc(xi(bi,`users/${d.user.uid}`),m),d.user.uid}catch(d){throw d.code==="auth/email-already-in-use"?new Error("Email already in use"):d}}function C9({onLocationSelect:e,initialLocation:t}){var ze;const i=q.useRef(null),l=q.useRef(null),d=q.useRef(null),[m,v]=q.useState(!0),[o,I]=q.useState(!1),[A,N]=q.useState("Tap on map to select location"),[F,z]=q.useState(!1),[$,J]=q.useState(null),{franchises:H,loading:re}=S9(),Q=async(Be,ot)=>{try{const Zt=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${ot},${Be}.json?access_token=${jf}`)).json();return Zt.features&&Zt.features.length>0?Zt.features[0].place_name:"Unknown location"}catch(Et){return console.error("Geocoding error:",Et),"Unknown location"}},ee=(Be,ot)=>{for(const Et of H)if(Et.zone&&$C({lat:Be,lng:ot},Et.zone))return{isInZone:!0,franchiseId:Et.id};return{isInZone:!1,franchiseId:null}},ie=async Be=>{if(!l.current)return;I(!0);const{isInZone:ot,franchiseId:Et}=ee(Be.lat,Be.lng);z(!ot),J(Et),d.current?d.current.setLngLat([Be.lng,Be.lat]):(d.current=new Mr.Marker({color:"#f97316",draggable:!0}).setLngLat([Be.lng,Be.lat]).addTo(l.current),d.current.on("dragend",async()=>{var zt;const at=(zt=d.current)==null?void 0:zt.getLngLat();if(at){I(!0);const{isInZone:Kt,franchiseId:nn}=ee(at.lat,at.lng);z(!Kt),J(nn);const Wt=await Q(at.lat,at.lng);N(Wt),Kt&&nn&&e({lat:at.lat,lng:at.lng,address:Wt,franchiseId:nn}),I(!1)}}));const Zt=await Q(Be.lat,Be.lng);N(Zt),ot&&Et&&e({lat:Be.lat,lng:Be.lng,address:Zt,franchiseId:Et}),I(!1)},ue=()=>{"geolocation"in navigator&&(I(!0),navigator.geolocation.getCurrentPosition(async Be=>{const{latitude:ot,longitude:Et}=Be.coords;l.current&&l.current.flyTo({center:[Et,ot],zoom:14,duration:1500}),await ie({lat:ot,lng:Et})},Be=>{console.error("Location error:",Be),I(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4}))},xe=()=>{!l.current||H.length===0||H.forEach((Be,ot)=>{if(!Be.zone||!l.current)return;const Et=`franchise-zone-${Be.id}`,Zt=`franchise-zone-fill-${Be.id}`,at=`franchise-zone-line-${Be.id}`;l.current.getLayer(Zt)&&l.current.removeLayer(Zt),l.current.getLayer(at)&&l.current.removeLayer(at),l.current.getSource(Et)&&l.current.removeSource(Et),l.current.addSource(Et,{type:"geojson",data:{type:"Feature",properties:{name:Be.name},geometry:Be.zone}}),l.current.addLayer({id:Zt,type:"fill",source:Et,paint:{"fill-color":"#22c55e","fill-opacity":.15}}),l.current.addLayer({id:at,type:"line",source:Et,paint:{"line-color":"#22c55e","line-width":2,"line-dasharray":[2,2]}})})};q.useEffect(()=>{if(!i.current||re)return;Mr.accessToken=jf;let Be=[78.4867,17.385];if(t)Be=[t.lng,t.lat];else if(H.length>0&&H[0].zone){const ot=Tpe(H[0].zone);ot&&(Be=[ot.lng,ot.lat])}return l.current=new Mr.Map({container:i.current,style:"mapbox://styles/mapbox/streets-v12",center:Be,zoom:12,attributionControl:!1}),l.current.on("load",()=>{v(!1),xe(),t&&ie({lat:t.lat,lng:t.lng})}),l.current.on("click",async ot=>{await ie({lat:ot.lngLat.lat,lng:ot.lngLat.lng})}),l.current.addControl(new Mr.NavigationControl({showCompass:!1}),"bottom-right"),()=>{var ot;(ot=l.current)==null||ot.remove()}},[re,H]),q.useEffect(()=>{l.current&&!m&&H.length>0&&xe()},[H,m]);const Oe=$?(ze=H.find(Be=>Be.id===$))==null?void 0:ze.name:null;return E.jsxs("div",{className:"space-y-3",children:[E.jsxs("div",{className:"relative rounded-xl overflow-hidden",style:{height:"250px"},children:[E.jsx("div",{ref:i,className:"absolute inset-0"}),(m||re)&&E.jsx("div",{className:"absolute inset-0 bg-secondary flex items-center justify-center",children:E.jsx(kr,{className:"w-6 h-6 animate-spin text-primary"})}),E.jsx(wn,{size:"icon",variant:"secondary",className:"absolute top-3 right-3 rounded-full shadow-md",onClick:ue,children:E.jsx(eD,{className:"w-4 h-4"})}),E.jsx("div",{className:"absolute top-3 left-3 bg-card/90 backdrop-blur-sm rounded-lg px-3 py-1.5",children:E.jsx("p",{className:"text-xs text-muted-foreground",children:"Select location within green zone"})}),E.jsxs("div",{className:"absolute bottom-3 left-3 bg-card/90 backdrop-blur-sm rounded-lg px-3 py-1.5 flex items-center gap-2",children:[E.jsx("div",{className:"w-3 h-3 rounded-sm bg-green-500/30 border border-green-500"}),E.jsx("span",{className:"text-xs text-muted-foreground",children:"Service Area"})]})]}),F&&E.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-xl p-3 flex items-start gap-3",children:[E.jsx(Zc,{className:"w-5 h-5 text-destructive flex-shrink-0 mt-0.5"}),E.jsxs("div",{children:[E.jsx("p",{className:"text-sm font-medium text-destructive",children:"Outside Service Area"}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Please select a location within the green zone to register your kitchen."})]})]}),E.jsxs("div",{className:`rounded-xl p-3 flex items-start gap-3 ${F?"bg-muted":"bg-secondary"}`,children:[E.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${F?"bg-muted-foreground/10":"bg-primary/10"}`,children:o?E.jsx(kr,{className:"w-4 h-4 text-primary animate-spin"}):E.jsx(ya,{className:`w-4 h-4 ${F?"text-muted-foreground":"text-primary"}`})}),E.jsxs("div",{className:"flex-1 min-w-0",children:[E.jsx("p",{className:"text-xs text-muted-foreground",children:"Kitchen Location"}),E.jsx("p",{className:`text-sm font-medium line-clamp-2 ${F?"text-muted-foreground":"text-foreground"}`,children:o?"Finding address...":A}),Oe&&!F&&E.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[" ",Oe," zone"]})]})]})]})}function H0e(){const{user:e}=Sa(),t=Qa(),[i,l]=q.useState(!1),[d,m]=q.useState(null),[v,o]=q.useState(null),[I,A]=q.useState(null),[N,F]=q.useState({name:"",description:"",specialties:"",cookingTime:"20-30 mins",isVeg:!0,address:{line1:"",line2:"",city:"",pincode:"",lat:0,lng:0}}),z=J=>{var re;const H=(re=J.target.files)==null?void 0:re[0];if(H){m(H);const Q=new FileReader;Q.onloadend=()=>{o(Q.result)},Q.readAsDataURL(H)}},$=async J=>{if(J.preventDefault(),!e){Mn.error("Please login first");return}if(!N.name||!N.address.line1||!I){Mn.error("Please fill in all required fields and select location within service area");return}l(!0);try{let H="https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=400";if(d){const re=await E9(d);re&&(H=re.display_url)}await uve({ownerId:e.id,franchiseId:I,name:N.name,description:N.description,image:H,coverImage:H,address:N.address,rating:0,totalRatings:0,isOpen:!1,specialties:N.specialties.split(",").map(re=>re.trim()).filter(Boolean),cookingTime:N.cookingTime,isVeg:N.isVeg,isApproved:!1,createdAt:Date.now()}),Mn.success("Kitchen registered! Waiting for admin approval."),t("/amma/dashboard")}catch(H){console.error("Registration failed:",H),Mn.error("Failed to register kitchen")}finally{l(!1)}};return!e||e.role!=="amma"?E.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[E.jsx("p",{className:"text-muted-foreground mb-4",children:"You need to be registered as an Amma"}),E.jsx(Fr,{to:"/auth",children:E.jsx(wn,{className:"gradient-primary text-primary-foreground",children:"Login as Amma"})})]}):E.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[E.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:E.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[E.jsx(Fr,{to:"/amma/dashboard",children:E.jsx(bn.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:E.jsx(Wf,{className:"w-5 h-5"})})}),E.jsx("h1",{className:"font-semibold text-foreground",children:"Register Kitchen"})]})}),E.jsxs("form",{onSubmit:$,className:"px-4 py-6 space-y-6",children:[E.jsx("div",{className:"flex justify-center",children:E.jsxs("label",{className:"cursor-pointer",children:[E.jsx("div",{className:"w-32 h-32 rounded-2xl bg-secondary flex items-center justify-center overflow-hidden",children:v?E.jsx("img",{src:v,alt:"Preview",className:"w-full h-full object-cover"}):E.jsxs("div",{className:"text-center",children:[E.jsx(rS,{className:"w-8 h-8 text-muted-foreground mx-auto mb-1"}),E.jsx("span",{className:"text-xs text-muted-foreground",children:"Add Photo"})]})}),E.jsx("input",{type:"file",accept:"image/*",onChange:z,className:"hidden"})]})}),E.jsxs("div",{className:"space-y-4",children:[E.jsxs("div",{children:[E.jsx(Br,{children:"Kitchen Name *"}),E.jsx(Yi,{placeholder:"e.g., Lakshmi Amma's Kitchen",value:N.name,onChange:J=>F({...N,name:J.target.value}),className:"bg-secondary border-0 mt-1"})]}),E.jsxs("div",{children:[E.jsx(Br,{children:"Description"}),E.jsx(yb,{placeholder:"Tell customers about your kitchen and cooking style...",value:N.description,onChange:J=>F({...N,description:J.target.value}),className:"bg-secondary border-0 mt-1 resize-none",rows:3})]}),E.jsxs("div",{children:[E.jsx(Br,{children:"Specialties (comma separated)"}),E.jsx(Yi,{placeholder:"e.g., Biryani, Andhra Meals, Pickles",value:N.specialties,onChange:J=>F({...N,specialties:J.target.value}),className:"bg-secondary border-0 mt-1"})]}),E.jsxs("div",{children:[E.jsx(Br,{children:"Cooking Time"}),E.jsx(Yi,{placeholder:"e.g., 20-30 mins",value:N.cookingTime,onChange:J=>F({...N,cookingTime:J.target.value}),className:"bg-secondary border-0 mt-1"})]}),E.jsxs("div",{className:"flex items-center justify-between bg-secondary rounded-xl p-4",children:[E.jsx(Br,{htmlFor:"veg-switch",children:"Pure Vegetarian Kitchen"}),E.jsx(df,{id:"veg-switch",checked:N.isVeg,onCheckedChange:J=>F({...N,isVeg:J})})]})]}),E.jsxs("div",{className:"space-y-4",children:[E.jsxs("h3",{className:"font-semibold text-foreground flex items-center gap-2",children:[E.jsx(ya,{className:"w-4 h-4"})," Kitchen Location"]}),E.jsx(C9,{onLocationSelect:J=>{var Q;A(J.franchiseId);const H=J.address.split(","),re=H.length>1?(Q=H[H.length-2])==null?void 0:Q.trim():"";F({...N,address:{...N.address,line1:J.address,city:re||N.address.city,lat:J.lat,lng:J.lng}})}}),E.jsx(Yi,{placeholder:"Additional address details (optional)",value:N.address.line2,onChange:J=>F({...N,address:{...N.address,line2:J.target.value}}),className:"bg-secondary border-0"}),E.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[E.jsx(Yi,{placeholder:"City",value:N.address.city,onChange:J=>F({...N,address:{...N.address,city:J.target.value}}),className:"bg-secondary border-0"}),E.jsx(Yi,{placeholder:"Pincode",value:N.address.pincode,onChange:J=>F({...N,address:{...N.address,pincode:J.target.value}}),className:"bg-secondary border-0"})]})]}),E.jsx(wn,{type:"submit",disabled:i,className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl",children:i?E.jsxs("div",{className:"flex items-center gap-2",children:[E.jsx(kr,{className:"w-5 h-5 animate-spin"}),E.jsx("span",{children:"Registering..."})]}):"Register Kitchen"})]})]})}function lV(e,[t,i]){return Math.min(i,Math.max(t,e))}var W0e=[" ","Enter","ArrowUp","ArrowDown"],q0e=[" ","Enter"],km="Select",[nI,iI,Z0e]=Zk(km),[hv,jbe]=Qu(km,[Z0e,xC]),rI=xC(),[K0e,Yf]=hv(km),[X0e,Y0e]=hv(km),I9=e=>{const{__scopeSelect:t,children:i,open:l,defaultOpen:d,onOpenChange:m,value:v,defaultValue:o,onValueChange:I,dir:A,name:N,autoComplete:F,disabled:z,required:$,form:J}=e,H=rI(t),[re,Q]=q.useState(null),[ee,ie]=q.useState(null),[ue,xe]=q.useState(!1),Oe=r9(A),[ze,Be]=Rf({prop:l,defaultProp:d??!1,onChange:m,caller:km}),[ot,Et]=Rf({prop:v,defaultProp:o,onChange:I,caller:km}),Zt=q.useRef(null),at=re?J||!!re.closest("form"):!0,[zt,Kt]=q.useState(new Set),nn=Array.from(zt).map(Wt=>Wt.props.value).join(";");return E.jsx(qre,{...H,children:E.jsxs(K0e,{required:$,scope:t,trigger:re,onTriggerChange:Q,valueNode:ee,onValueNodeChange:ie,valueNodeHasChildren:ue,onValueNodeHasChildrenChange:xe,contentId:bf(),value:ot,onValueChange:Et,open:ze,onOpenChange:Be,dir:Oe,triggerPointerDownPosRef:Zt,disabled:z,children:[E.jsx(nI.Provider,{scope:t,children:E.jsx(X0e,{scope:e.__scopeSelect,onNativeOptionAdd:q.useCallback(Wt=>{Kt(Ke=>new Set(Ke).add(Wt))},[]),onNativeOptionRemove:q.useCallback(Wt=>{Kt(Ke=>{const et=new Set(Ke);return et.delete(Wt),et})},[]),children:i})}),at?E.jsxs(Y9,{"aria-hidden":!0,required:$,tabIndex:-1,name:N,autoComplete:F,value:ot,onChange:Wt=>Et(Wt.target.value),disabled:z,form:J,children:[ot===void 0?E.jsx("option",{value:""}):null,Array.from(zt)]},nn):null]})})};I9.displayName=km;var A9="SelectTrigger",P9=q.forwardRef((e,t)=>{const{__scopeSelect:i,disabled:l=!1,...d}=e,m=rI(i),v=Yf(A9,i),o=v.disabled||l,I=zr(t,v.onTriggerChange),A=iI(i),N=q.useRef("touch"),[F,z,$]=J9(H=>{const re=A().filter(ie=>!ie.disabled),Q=re.find(ie=>ie.value===v.value),ee=eZ(re,H,Q);ee!==void 0&&v.onValueChange(ee.value)}),J=H=>{o||(v.onOpenChange(!0),$()),H&&(v.triggerPointerDownPosRef.current={x:Math.round(H.pageX),y:Math.round(H.pageY)})};return E.jsx(u$,{asChild:!0,...m,children:E.jsx(Ki.button,{type:"button",role:"combobox","aria-controls":v.contentId,"aria-expanded":v.open,"aria-required":v.required,"aria-autocomplete":"none",dir:v.dir,"data-state":v.open?"open":"closed",disabled:o,"data-disabled":o?"":void 0,"data-placeholder":Q9(v.value)?"":void 0,...d,ref:I,onClick:Li(d.onClick,H=>{H.currentTarget.focus(),N.current!=="mouse"&&J(H)}),onPointerDown:Li(d.onPointerDown,H=>{N.current=H.pointerType;const re=H.target;re.hasPointerCapture(H.pointerId)&&re.releasePointerCapture(H.pointerId),H.button===0&&H.ctrlKey===!1&&H.pointerType==="mouse"&&(J(H),H.preventDefault())}),onKeyDown:Li(d.onKeyDown,H=>{const re=F.current!=="";!(H.ctrlKey||H.altKey||H.metaKey)&&H.key.length===1&&z(H.key),!(re&&H.key===" ")&&W0e.includes(H.key)&&(J(),H.preventDefault())})})})});P9.displayName=A9;var R9="SelectValue",M9=q.forwardRef((e,t)=>{const{__scopeSelect:i,className:l,style:d,children:m,placeholder:v="",...o}=e,I=Yf(R9,i),{onValueNodeHasChildrenChange:A}=I,N=m!==void 0,F=zr(t,I.onValueNodeChange);return Ao(()=>{A(N)},[A,N]),E.jsx(Ki.span,{...o,ref:F,style:{pointerEvents:"none"},children:Q9(I.value)?E.jsx(E.Fragment,{children:v}):m})});M9.displayName=R9;var Q0e="SelectIcon",k9=q.forwardRef((e,t)=>{const{__scopeSelect:i,children:l,...d}=e;return E.jsx(Ki.span,{"aria-hidden":!0,...d,ref:t,children:l||""})});k9.displayName=Q0e;var J0e="SelectPortal",D9=e=>E.jsx(fC,{asChild:!0,...e});D9.displayName=J0e;var Dm="SelectContent",N9=q.forwardRef((e,t)=>{const i=Yf(Dm,e.__scopeSelect),[l,d]=q.useState();if(Ao(()=>{d(new DocumentFragment)},[]),!i.open){const m=l;return m?Om.createPortal(E.jsx(L9,{scope:e.__scopeSelect,children:E.jsx(nI.Slot,{scope:e.__scopeSelect,children:E.jsx("div",{children:e.children})})}),m):null}return E.jsx(O9,{...e,ref:t})});N9.displayName=Dm;var Lc=10,[L9,Qf]=hv(Dm),e1e="SelectContentImpl",t1e=Ly("SelectContent.RemoveScroll"),O9=q.forwardRef((e,t)=>{const{__scopeSelect:i,position:l="item-aligned",onCloseAutoFocus:d,onEscapeKeyDown:m,onPointerDownOutside:v,side:o,sideOffset:I,align:A,alignOffset:N,arrowPadding:F,collisionBoundary:z,collisionPadding:$,sticky:J,hideWhenDetached:H,avoidCollisions:re,...Q}=e,ee=Yf(Dm,i),[ie,ue]=q.useState(null),[xe,Oe]=q.useState(null),ze=zr(t,_n=>ue(_n)),[Be,ot]=q.useState(null),[Et,Zt]=q.useState(null),at=iI(i),[zt,Kt]=q.useState(!1),nn=q.useRef(!1);q.useEffect(()=>{if(ie)return sq(ie)},[ie]),X7();const Wt=q.useCallback(_n=>{const[Rt,...pn]=at().map($i=>$i.ref.current),[Fn]=pn.slice(-1),si=document.activeElement;for(const $i of _n)if($i===si||($i==null||$i.scrollIntoView({block:"nearest"}),$i===Rt&&xe&&(xe.scrollTop=0),$i===Fn&&xe&&(xe.scrollTop=xe.scrollHeight),$i==null||$i.focus(),document.activeElement!==si))return},[at,xe]),Ke=q.useCallback(()=>Wt([Be,ie]),[Wt,Be,ie]);q.useEffect(()=>{zt&&Ke()},[zt,Ke]);const{onOpenChange:et,triggerPointerDownPosRef:Ct}=ee;q.useEffect(()=>{if(ie){let _n={x:0,y:0};const Rt=Fn=>{var si,$i;_n={x:Math.abs(Math.round(Fn.pageX)-(((si=Ct.current)==null?void 0:si.x)??0)),y:Math.abs(Math.round(Fn.pageY)-((($i=Ct.current)==null?void 0:$i.y)??0))}},pn=Fn=>{_n.x<=10&&_n.y<=10?Fn.preventDefault():ie.contains(Fn.target)||et(!1),document.removeEventListener("pointermove",Rt),Ct.current=null};return Ct.current!==null&&(document.addEventListener("pointermove",Rt),document.addEventListener("pointerup",pn,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Rt),document.removeEventListener("pointerup",pn,{capture:!0})}}},[ie,et,Ct]),q.useEffect(()=>{const _n=()=>et(!1);return window.addEventListener("blur",_n),window.addEventListener("resize",_n),()=>{window.removeEventListener("blur",_n),window.removeEventListener("resize",_n)}},[et]);const[en,Bn]=J9(_n=>{const Rt=at().filter(si=>!si.disabled),pn=Rt.find(si=>si.ref.current===document.activeElement),Fn=eZ(Rt,_n,pn);Fn&&setTimeout(()=>Fn.ref.current.focus())}),En=q.useCallback((_n,Rt,pn)=>{const Fn=!nn.current&&!pn;(ee.value!==void 0&&ee.value===Rt||Fn)&&(ot(_n),Fn&&(nn.current=!0))},[ee.value]),gn=q.useCallback(()=>ie==null?void 0:ie.focus(),[ie]),qt=q.useCallback((_n,Rt,pn)=>{const Fn=!nn.current&&!pn;(ee.value!==void 0&&ee.value===Rt||Fn)&&Zt(_n)},[ee.value]),Ji=l==="popper"?zM:F9,Sr=Ji===zM?{side:o,sideOffset:I,align:A,alignOffset:N,arrowPadding:F,collisionBoundary:z,collisionPadding:$,sticky:J,hideWhenDetached:H,avoidCollisions:re}:{};return E.jsx(L9,{scope:i,content:ie,viewport:xe,onViewportChange:Oe,itemRefCallback:En,selectedItem:Be,onItemLeave:gn,itemTextRefCallback:qt,focusSelectedItem:Ke,selectedItemText:Et,position:l,isPositioned:zt,searchRef:en,children:E.jsx(JN,{as:t1e,allowPinchZoom:!0,children:E.jsx(QN,{asChild:!0,trapped:ee.open,onMountAutoFocus:_n=>{_n.preventDefault()},onUnmountAutoFocus:Li(d,_n=>{var Rt;(Rt=ee.trigger)==null||Rt.focus({preventScroll:!0}),_n.preventDefault()}),children:E.jsx(Y1,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:m,onPointerDownOutside:v,onFocusOutside:_n=>_n.preventDefault(),onDismiss:()=>ee.onOpenChange(!1),children:E.jsx(Ji,{role:"listbox",id:ee.contentId,"data-state":ee.open?"open":"closed",dir:ee.dir,onContextMenu:_n=>_n.preventDefault(),...Q,...Sr,onPlaced:()=>Kt(!0),ref:ze,style:{display:"flex",flexDirection:"column",outline:"none",...Q.style},onKeyDown:Li(Q.onKeyDown,_n=>{const Rt=_n.ctrlKey||_n.altKey||_n.metaKey;if(_n.key==="Tab"&&_n.preventDefault(),!Rt&&_n.key.length===1&&Bn(_n.key),["ArrowUp","ArrowDown","Home","End"].includes(_n.key)){let Fn=at().filter(si=>!si.disabled).map(si=>si.ref.current);if(["ArrowUp","End"].includes(_n.key)&&(Fn=Fn.slice().reverse()),["ArrowUp","ArrowDown"].includes(_n.key)){const si=_n.target,$i=Fn.indexOf(si);Fn=Fn.slice($i+1)}setTimeout(()=>Wt(Fn)),_n.preventDefault()}})})})})})})});O9.displayName=e1e;var n1e="SelectItemAlignedPosition",F9=q.forwardRef((e,t)=>{const{__scopeSelect:i,onPlaced:l,...d}=e,m=Yf(Dm,i),v=Qf(Dm,i),[o,I]=q.useState(null),[A,N]=q.useState(null),F=zr(t,ze=>N(ze)),z=iI(i),$=q.useRef(!1),J=q.useRef(!0),{viewport:H,selectedItem:re,selectedItemText:Q,focusSelectedItem:ee}=v,ie=q.useCallback(()=>{if(m.trigger&&m.valueNode&&o&&A&&H&&re&&Q){const ze=m.trigger.getBoundingClientRect(),Be=A.getBoundingClientRect(),ot=m.valueNode.getBoundingClientRect(),Et=Q.getBoundingClientRect();if(m.dir!=="rtl"){const si=Et.left-Be.left,$i=ot.left-si,Mi=ze.left-$i,Ts=ze.width+Mi,fo=Math.max(Ts,Be.width),ls=window.innerWidth-Lc,Kr=lV($i,[Lc,Math.max(Lc,ls-fo)]);o.style.minWidth=Ts+"px",o.style.left=Kr+"px"}else{const si=Be.right-Et.right,$i=window.innerWidth-ot.right-si,Mi=window.innerWidth-ze.right-$i,Ts=ze.width+Mi,fo=Math.max(Ts,Be.width),ls=window.innerWidth-Lc,Kr=lV($i,[Lc,Math.max(Lc,ls-fo)]);o.style.minWidth=Ts+"px",o.style.right=Kr+"px"}const Zt=z(),at=window.innerHeight-Lc*2,zt=H.scrollHeight,Kt=window.getComputedStyle(A),nn=parseInt(Kt.borderTopWidth,10),Wt=parseInt(Kt.paddingTop,10),Ke=parseInt(Kt.borderBottomWidth,10),et=parseInt(Kt.paddingBottom,10),Ct=nn+Wt+zt+et+Ke,en=Math.min(re.offsetHeight*5,Ct),Bn=window.getComputedStyle(H),En=parseInt(Bn.paddingTop,10),gn=parseInt(Bn.paddingBottom,10),qt=ze.top+ze.height/2-Lc,Ji=at-qt,Sr=re.offsetHeight/2,_n=re.offsetTop+Sr,Rt=nn+Wt+_n,pn=Ct-Rt;if(Rt<=qt){const si=Zt.length>0&&re===Zt[Zt.length-1].ref.current;o.style.bottom="0px";const $i=A.clientHeight-H.offsetTop-H.offsetHeight,Mi=Math.max(Ji,Sr+(si?gn:0)+$i+Ke),Ts=Rt+Mi;o.style.height=Ts+"px"}else{const si=Zt.length>0&&re===Zt[0].ref.current;o.style.top="0px";const Mi=Math.max(qt,nn+H.offsetTop+(si?En:0)+Sr)+pn;o.style.height=Mi+"px",H.scrollTop=Rt-qt+H.offsetTop}o.style.margin=`${Lc}px 0`,o.style.minHeight=en+"px",o.style.maxHeight=at+"px",l==null||l(),requestAnimationFrame(()=>$.current=!0)}},[z,m.trigger,m.valueNode,o,A,H,re,Q,m.dir,l]);Ao(()=>ie(),[ie]);const[ue,xe]=q.useState();Ao(()=>{A&&xe(window.getComputedStyle(A).zIndex)},[A]);const Oe=q.useCallback(ze=>{ze&&J.current===!0&&(ie(),ee==null||ee(),J.current=!1)},[ie,ee]);return E.jsx(r1e,{scope:i,contentWrapper:o,shouldExpandOnScrollRef:$,onScrollButtonChange:Oe,children:E.jsx("div",{ref:I,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:ue},children:E.jsx(Ki.div,{...d,ref:F,style:{boxSizing:"border-box",maxHeight:"100%",...d.style}})})})});F9.displayName=n1e;var i1e="SelectPopperPosition",zM=q.forwardRef((e,t)=>{const{__scopeSelect:i,align:l="start",collisionPadding:d=Lc,...m}=e,v=rI(i);return E.jsx(d$,{...v,...m,ref:t,align:l,collisionPadding:d,style:{boxSizing:"border-box",...m.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});zM.displayName=i1e;var[r1e,yL]=hv(Dm,{}),jM="SelectViewport",z9=q.forwardRef((e,t)=>{const{__scopeSelect:i,nonce:l,...d}=e,m=Qf(jM,i),v=yL(jM,i),o=zr(t,m.onViewportChange),I=q.useRef(0);return E.jsxs(E.Fragment,{children:[E.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:l}),E.jsx(nI.Slot,{scope:i,children:E.jsx(Ki.div,{"data-radix-select-viewport":"",role:"presentation",...d,ref:o,style:{position:"relative",flex:1,overflow:"hidden auto",...d.style},onScroll:Li(d.onScroll,A=>{const N=A.currentTarget,{contentWrapper:F,shouldExpandOnScrollRef:z}=v;if(z!=null&&z.current&&F){const $=Math.abs(I.current-N.scrollTop);if($>0){const J=window.innerHeight-Lc*2,H=parseFloat(F.style.minHeight),re=parseFloat(F.style.height),Q=Math.max(H,re);if(Q<J){const ee=Q+$,ie=Math.min(J,ee),ue=ee-ie;F.style.height=ie+"px",F.style.bottom==="0px"&&(N.scrollTop=ue>0?ue:0,F.style.justifyContent="flex-end")}}}I.current=N.scrollTop})})})]})});z9.displayName=jM;var j9="SelectGroup",[s1e,o1e]=hv(j9),a1e=q.forwardRef((e,t)=>{const{__scopeSelect:i,...l}=e,d=bf();return E.jsx(s1e,{scope:i,id:d,children:E.jsx(Ki.div,{role:"group","aria-labelledby":d,...l,ref:t})})});a1e.displayName=j9;var B9="SelectLabel",V9=q.forwardRef((e,t)=>{const{__scopeSelect:i,...l}=e,d=o1e(B9,i);return E.jsx(Ki.div,{id:d.id,...l,ref:t})});V9.displayName=B9;var HS="SelectItem",[l1e,U9]=hv(HS),$9=q.forwardRef((e,t)=>{const{__scopeSelect:i,value:l,disabled:d=!1,textValue:m,...v}=e,o=Yf(HS,i),I=Qf(HS,i),A=o.value===l,[N,F]=q.useState(m??""),[z,$]=q.useState(!1),J=zr(t,ee=>{var ie;return(ie=I.itemRefCallback)==null?void 0:ie.call(I,ee,l,d)}),H=bf(),re=q.useRef("touch"),Q=()=>{d||(o.onValueChange(l),o.onOpenChange(!1))};if(l==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return E.jsx(l1e,{scope:i,value:l,disabled:d,textId:H,isSelected:A,onItemTextChange:q.useCallback(ee=>{F(ie=>ie||((ee==null?void 0:ee.textContent)??"").trim())},[]),children:E.jsx(nI.ItemSlot,{scope:i,value:l,disabled:d,textValue:N,children:E.jsx(Ki.div,{role:"option","aria-labelledby":H,"data-highlighted":z?"":void 0,"aria-selected":A&&z,"data-state":A?"checked":"unchecked","aria-disabled":d||void 0,"data-disabled":d?"":void 0,tabIndex:d?void 0:-1,...v,ref:J,onFocus:Li(v.onFocus,()=>$(!0)),onBlur:Li(v.onBlur,()=>$(!1)),onClick:Li(v.onClick,()=>{re.current!=="mouse"&&Q()}),onPointerUp:Li(v.onPointerUp,()=>{re.current==="mouse"&&Q()}),onPointerDown:Li(v.onPointerDown,ee=>{re.current=ee.pointerType}),onPointerMove:Li(v.onPointerMove,ee=>{var ie;re.current=ee.pointerType,d?(ie=I.onItemLeave)==null||ie.call(I):re.current==="mouse"&&ee.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Li(v.onPointerLeave,ee=>{var ie;ee.currentTarget===document.activeElement&&((ie=I.onItemLeave)==null||ie.call(I))}),onKeyDown:Li(v.onKeyDown,ee=>{var ue;((ue=I.searchRef)==null?void 0:ue.current)!==""&&ee.key===" "||(q0e.includes(ee.key)&&Q(),ee.key===" "&&ee.preventDefault())})})})})});$9.displayName=HS;var M0="SelectItemText",G9=q.forwardRef((e,t)=>{const{__scopeSelect:i,className:l,style:d,...m}=e,v=Yf(M0,i),o=Qf(M0,i),I=U9(M0,i),A=Y0e(M0,i),[N,F]=q.useState(null),z=zr(t,Q=>F(Q),I.onItemTextChange,Q=>{var ee;return(ee=o.itemTextRefCallback)==null?void 0:ee.call(o,Q,I.value,I.disabled)}),$=N==null?void 0:N.textContent,J=q.useMemo(()=>E.jsx("option",{value:I.value,disabled:I.disabled,children:$},I.value),[I.disabled,I.value,$]),{onNativeOptionAdd:H,onNativeOptionRemove:re}=A;return Ao(()=>(H(J),()=>re(J)),[H,re,J]),E.jsxs(E.Fragment,{children:[E.jsx(Ki.span,{id:I.textId,...m,ref:z}),I.isSelected&&v.valueNode&&!v.valueNodeHasChildren?Om.createPortal(m.children,v.valueNode):null]})});G9.displayName=M0;var H9="SelectItemIndicator",W9=q.forwardRef((e,t)=>{const{__scopeSelect:i,...l}=e;return U9(H9,i).isSelected?E.jsx(Ki.span,{"aria-hidden":!0,...l,ref:t}):null});W9.displayName=H9;var BM="SelectScrollUpButton",q9=q.forwardRef((e,t)=>{const i=Qf(BM,e.__scopeSelect),l=yL(BM,e.__scopeSelect),[d,m]=q.useState(!1),v=zr(t,l.onScrollButtonChange);return Ao(()=>{if(i.viewport&&i.isPositioned){let o=function(){const A=I.scrollTop>0;m(A)};const I=i.viewport;return o(),I.addEventListener("scroll",o),()=>I.removeEventListener("scroll",o)}},[i.viewport,i.isPositioned]),d?E.jsx(K9,{...e,ref:v,onAutoScroll:()=>{const{viewport:o,selectedItem:I}=i;o&&I&&(o.scrollTop=o.scrollTop-I.offsetHeight)}}):null});q9.displayName=BM;var VM="SelectScrollDownButton",Z9=q.forwardRef((e,t)=>{const i=Qf(VM,e.__scopeSelect),l=yL(VM,e.__scopeSelect),[d,m]=q.useState(!1),v=zr(t,l.onScrollButtonChange);return Ao(()=>{if(i.viewport&&i.isPositioned){let o=function(){const A=I.scrollHeight-I.clientHeight,N=Math.ceil(I.scrollTop)<A;m(N)};const I=i.viewport;return o(),I.addEventListener("scroll",o),()=>I.removeEventListener("scroll",o)}},[i.viewport,i.isPositioned]),d?E.jsx(K9,{...e,ref:v,onAutoScroll:()=>{const{viewport:o,selectedItem:I}=i;o&&I&&(o.scrollTop=o.scrollTop+I.offsetHeight)}}):null});Z9.displayName=VM;var K9=q.forwardRef((e,t)=>{const{__scopeSelect:i,onAutoScroll:l,...d}=e,m=Qf("SelectScrollButton",i),v=q.useRef(null),o=iI(i),I=q.useCallback(()=>{v.current!==null&&(window.clearInterval(v.current),v.current=null)},[]);return q.useEffect(()=>()=>I(),[I]),Ao(()=>{var N;const A=o().find(F=>F.ref.current===document.activeElement);(N=A==null?void 0:A.ref.current)==null||N.scrollIntoView({block:"nearest"})},[o]),E.jsx(Ki.div,{"aria-hidden":!0,...d,ref:t,style:{flexShrink:0,...d.style},onPointerDown:Li(d.onPointerDown,()=>{v.current===null&&(v.current=window.setInterval(l,50))}),onPointerMove:Li(d.onPointerMove,()=>{var A;(A=m.onItemLeave)==null||A.call(m),v.current===null&&(v.current=window.setInterval(l,50))}),onPointerLeave:Li(d.onPointerLeave,()=>{I()})})}),c1e="SelectSeparator",X9=q.forwardRef((e,t)=>{const{__scopeSelect:i,...l}=e;return E.jsx(Ki.div,{"aria-hidden":!0,...l,ref:t})});X9.displayName=c1e;var UM="SelectArrow",u1e=q.forwardRef((e,t)=>{const{__scopeSelect:i,...l}=e,d=rI(i),m=Yf(UM,i),v=Qf(UM,i);return m.open&&v.position==="popper"?E.jsx(h$,{...d,...l,ref:t}):null});u1e.displayName=UM;var d1e="SelectBubbleInput",Y9=q.forwardRef(({__scopeSelect:e,value:t,...i},l)=>{const d=q.useRef(null),m=zr(l,d),v=U7(t);return q.useEffect(()=>{const o=d.current;if(!o)return;const I=window.HTMLSelectElement.prototype,N=Object.getOwnPropertyDescriptor(I,"value").set;if(v!==t&&N){const F=new Event("change",{bubbles:!0});N.call(o,t),o.dispatchEvent(F)}},[v,t]),E.jsx(Ki.select,{...i,style:{...J6,...i.style},ref:m,defaultValue:t})});Y9.displayName=d1e;function Q9(e){return e===""||e===void 0}function J9(e){const t=tu(e),i=q.useRef(""),l=q.useRef(0),d=q.useCallback(v=>{const o=i.current+v;t(o),function I(A){i.current=A,window.clearTimeout(l.current),A!==""&&(l.current=window.setTimeout(()=>I(""),1e3))}(o)},[t]),m=q.useCallback(()=>{i.current="",window.clearTimeout(l.current)},[]);return q.useEffect(()=>()=>window.clearTimeout(l.current),[]),[i,d,m]}function eZ(e,t,i){const d=t.length>1&&Array.from(t).every(A=>A===t[0])?t[0]:t,m=i?e.indexOf(i):-1;let v=h1e(e,Math.max(m,0));d.length===1&&(v=v.filter(A=>A!==i));const I=v.find(A=>A.textValue.toLowerCase().startsWith(d.toLowerCase()));return I!==i?I:void 0}function h1e(e,t){return e.map((i,l)=>e[(t+l)%e.length])}var f1e=I9,tZ=P9,p1e=M9,m1e=k9,g1e=D9,nZ=N9,_1e=z9,iZ=V9,rZ=$9,y1e=G9,v1e=W9,sZ=q9,oZ=Z9,aZ=X9;const $M=f1e,GM=p1e,WS=q.forwardRef(({className:e,children:t,...i},l)=>E.jsxs(tZ,{ref:l,className:Xn("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...i,children:[t,E.jsx(m1e,{asChild:!0,children:E.jsx(gC,{className:"h-4 w-4 opacity-50"})})]}));WS.displayName=tZ.displayName;const lZ=q.forwardRef(({className:e,...t},i)=>E.jsx(sZ,{ref:i,className:Xn("flex cursor-default items-center justify-center py-1",e),...t,children:E.jsx(qte,{className:"h-4 w-4"})}));lZ.displayName=sZ.displayName;const cZ=q.forwardRef(({className:e,...t},i)=>E.jsx(oZ,{ref:i,className:Xn("flex cursor-default items-center justify-center py-1",e),...t,children:E.jsx(gC,{className:"h-4 w-4"})}));cZ.displayName=oZ.displayName;const qS=q.forwardRef(({className:e,children:t,position:i="popper",...l},d)=>E.jsx(g1e,{children:E.jsxs(nZ,{ref:d,className:Xn("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:i,...l,children:[E.jsx(lZ,{}),E.jsx(_1e,{className:Xn("p-1",i==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),E.jsx(cZ,{})]})}));qS.displayName=nZ.displayName;const x1e=q.forwardRef(({className:e,...t},i)=>E.jsx(iZ,{ref:i,className:Xn("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));x1e.displayName=iZ.displayName;const ZS=q.forwardRef(({className:e,children:t,...i},l)=>E.jsxs(rZ,{ref:l,className:Xn("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...i,children:[E.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:E.jsx(v1e,{children:E.jsx(Zu,{className:"h-4 w-4"})})}),E.jsx(y1e,{children:t})]}));ZS.displayName=rZ.displayName;const b1e=q.forwardRef(({className:e,...t},i)=>E.jsx(aZ,{ref:i,className:Xn("-mx-1 my-1 h-px bg-muted",e),...t}));b1e.displayName=aZ.displayName;const w1e=["Biryani","Meals","Curries","Tiffin","Dosa","Sweets","Snacks","Beverages"];function T1e(){const{user:e}=Sa(),t=Qa(),{kitchens:i}=pL(e==null?void 0:e.id),[l,d]=q.useState(!1),[m,v]=q.useState(null),[o,I]=q.useState(null),[A,N]=q.useState({kitchenId:"",name:"",description:"",price:"",originalPrice:"",category:"Meals",preparationTime:"15 mins",servingSize:"1 person",isVeg:!0,isAvailable:!0,tags:""}),F=$=>{var H;const J=(H=$.target.files)==null?void 0:H[0];if(J){v(J);const re=new FileReader;re.onloadend=()=>{I(re.result)},re.readAsDataURL(J)}},z=async $=>{var H;$.preventDefault();const J=A.kitchenId||((H=i[0])==null?void 0:H.id);if(!J){Mn.error("No kitchen found. Please register your kitchen first.");return}if(!A.name||!A.price){Mn.error("Please fill in all required fields");return}d(!0);try{let re="https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=400";if(m){const Q=await E9(m);Q&&(re=Q.display_url)}await dve({kitchenId:J,name:A.name,description:A.description,image:re,price:parseFloat(A.price),originalPrice:A.originalPrice?parseFloat(A.originalPrice):void 0,isVeg:A.isVeg,isAvailable:A.isAvailable,category:A.category,tags:A.tags.split(",").map(Q=>Q.trim()).filter(Boolean),preparationTime:A.preparationTime,servingSize:A.servingSize}),Mn.success("Dish added successfully!"),t("/amma/dashboard")}catch(re){console.error("Failed to add dish:",re),Mn.error("Failed to add dish")}finally{d(!1)}};return!e||e.role!=="amma"?E.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[E.jsx("p",{className:"text-muted-foreground mb-4",children:"You need to be registered as an Amma"}),E.jsx(Fr,{to:"/auth",children:E.jsx(wn,{className:"gradient-primary text-primary-foreground",children:"Login as Amma"})})]}):E.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[E.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:E.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[E.jsx(Fr,{to:"/amma/dashboard",children:E.jsx(bn.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:E.jsx(Wf,{className:"w-5 h-5"})})}),E.jsx("h1",{className:"font-semibold text-foreground",children:"Add New Dish"})]})}),E.jsxs("form",{onSubmit:z,className:"px-4 py-6 space-y-6",children:[E.jsx("div",{className:"flex justify-center",children:E.jsxs("label",{className:"cursor-pointer",children:[E.jsx("div",{className:"w-40 h-40 rounded-2xl bg-secondary flex items-center justify-center overflow-hidden",children:o?E.jsx("img",{src:o,alt:"Preview",className:"w-full h-full object-cover"}):E.jsxs("div",{className:"text-center",children:[E.jsx(rS,{className:"w-8 h-8 text-muted-foreground mx-auto mb-1"}),E.jsx("span",{className:"text-xs text-muted-foreground",children:"Add Dish Photo"})]})}),E.jsx("input",{type:"file",accept:"image/*",onChange:F,className:"hidden"})]})}),E.jsxs("div",{className:"space-y-4",children:[E.jsxs("div",{children:[E.jsx(Br,{children:"Dish Name *"}),E.jsx(Yi,{placeholder:"e.g., Chicken Biryani",value:A.name,onChange:$=>N({...A,name:$.target.value}),className:"bg-secondary border-0 mt-1"})]}),E.jsxs("div",{children:[E.jsx(Br,{children:"Description"}),E.jsx(yb,{placeholder:"Describe your dish...",value:A.description,onChange:$=>N({...A,description:$.target.value}),className:"bg-secondary border-0 mt-1 resize-none",rows:2})]}),E.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[E.jsxs("div",{children:[E.jsx(Br,{children:"Price () *"}),E.jsx(Yi,{type:"number",placeholder:"180",value:A.price,onChange:$=>N({...A,price:$.target.value}),className:"bg-secondary border-0 mt-1"})]}),E.jsxs("div",{children:[E.jsx(Br,{children:"Original Price ()"}),E.jsx(Yi,{type:"number",placeholder:"220",value:A.originalPrice,onChange:$=>N({...A,originalPrice:$.target.value}),className:"bg-secondary border-0 mt-1"})]})]}),E.jsxs("div",{children:[E.jsx(Br,{children:"Category"}),E.jsxs($M,{value:A.category,onValueChange:$=>N({...A,category:$}),children:[E.jsx(WS,{className:"bg-secondary border-0 mt-1",children:E.jsx(GM,{})}),E.jsx(qS,{children:w1e.map($=>E.jsx(ZS,{value:$,children:$},$))})]})]}),E.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[E.jsxs("div",{children:[E.jsx(Br,{children:"Prep Time"}),E.jsx(Yi,{placeholder:"15 mins",value:A.preparationTime,onChange:$=>N({...A,preparationTime:$.target.value}),className:"bg-secondary border-0 mt-1"})]}),E.jsxs("div",{children:[E.jsx(Br,{children:"Serving Size"}),E.jsx(Yi,{placeholder:"1 person",value:A.servingSize,onChange:$=>N({...A,servingSize:$.target.value}),className:"bg-secondary border-0 mt-1"})]})]}),E.jsxs("div",{children:[E.jsx(Br,{children:"Tags (comma separated)"}),E.jsx(Yi,{placeholder:"bestseller, spicy, healthy",value:A.tags,onChange:$=>N({...A,tags:$.target.value}),className:"bg-secondary border-0 mt-1"})]}),E.jsxs("div",{className:"flex items-center justify-between bg-secondary rounded-xl p-4",children:[E.jsx(Br,{htmlFor:"veg-dish",children:"Vegetarian"}),E.jsx(df,{id:"veg-dish",checked:A.isVeg,onCheckedChange:$=>N({...A,isVeg:$})})]}),E.jsxs("div",{className:"flex items-center justify-between bg-secondary rounded-xl p-4",children:[E.jsx(Br,{htmlFor:"available",children:"Available Now"}),E.jsx(df,{id:"available",checked:A.isAvailable,onCheckedChange:$=>N({...A,isAvailable:$})})]})]}),E.jsx(wn,{type:"submit",disabled:l,className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl",children:l?E.jsxs("div",{className:"flex items-center gap-2",children:[E.jsx(kr,{className:"w-5 h-5 animate-spin"}),E.jsx("span",{children:"Adding..."})]}):"Add Dish"})]})]})}function E1e(){const{kitchenId:e}=N$(),t=Qa(),{user:i}=Sa();GC();const[l,d]=q.useState(!0),[m,v]=q.useState(!1),[o,I]=q.useState(""),[A,N]=q.useState(null),[F,z]=q.useState(null),[$,J]=q.useState(null),[H,re]=q.useState({name:"",description:"",specialties:"",cookingTime:"30-45 mins",isVeg:!0,address:{line1:"",city:"",pincode:""}});q.useEffect(()=>{(async()=>{if(e){try{const xe=xi(bi,`kitchens/${e}`),Oe=await If(xe);if(Oe.exists()){const ze=Oe.val();if(ze.ownerId!==(i==null?void 0:i.id)){Mn.error("You do not have permission to edit this kitchen"),t("/amma/dashboard");return}re({name:ze.name,description:ze.description,specialties:ze.specialties.join(", "),cookingTime:ze.cookingTime,isVeg:ze.isVeg,address:{line1:ze.address.line1,city:ze.address.city,pincode:ze.address.pincode}}),I(ze.image),ze.address.lat&&ze.address.lng&&z({lat:ze.address.lat,lng:ze.address.lng,address:ze.address.line1}),J(ze.franchiseId||null)}}catch(xe){console.error("Error loading kitchen:",xe),Mn.error("Failed to load kitchen data")}d(!1)}})()},[e,i==null?void 0:i.id,t]);const Q=ue=>{var Oe;const xe=(Oe=ue.target.files)==null?void 0:Oe[0];if(xe){N(xe);const ze=new FileReader;ze.onload=()=>I(ze.result),ze.readAsDataURL(xe)}},ee=ue=>{z(ue),J(ue.franchiseId),re(xe=>({...xe,address:{...xe.address,line1:ue.address}}))},ie=async()=>{if(e){if(!H.name.trim()){Mn.error("Please enter your kitchen name");return}if(!F){Mn.error("Please select your kitchen location on the map");return}if(!$){Mn.error("Your location must be within a service area");return}v(!0);try{let ue=o;A&&(ue=(await T9(A)).data.display_url),await F7(e,{name:H.name,description:H.description,specialties:H.specialties.split(",").map(xe=>xe.trim()).filter(Boolean),cookingTime:H.cookingTime,isVeg:H.isVeg,image:ue,franchiseId:$,address:{line1:F.address,city:H.address.city,pincode:H.address.pincode,lat:F.lat,lng:F.lng}}),Mn.success("Kitchen updated successfully!"),t("/amma/dashboard")}catch(ue){console.error("Error updating kitchen:",ue),Mn.error("Failed to update kitchen")}v(!1)}};return l?E.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:E.jsx(kr,{className:"w-8 h-8 animate-spin text-primary"})}):E.jsxs("div",{className:"min-h-screen bg-background pb-8",children:[E.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:E.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[E.jsx(wn,{variant:"ghost",size:"icon",onClick:()=>t(-1),children:E.jsx(Wte,{className:"w-5 h-5"})}),E.jsxs("div",{children:[E.jsx("h1",{className:"font-semibold text-foreground",children:"Edit Kitchen"}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Update your kitchen details"})]})]})}),E.jsxs("div",{className:"px-4 py-6 space-y-6",children:[E.jsx(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:E.jsxs("label",{className:"block",children:[E.jsx("p",{className:"text-sm font-medium text-foreground mb-2",children:"Kitchen Image"}),E.jsxs("div",{className:"relative w-full h-48 rounded-2xl bg-secondary overflow-hidden cursor-pointer group",children:[o?E.jsx("img",{src:o,alt:"Kitchen",className:"w-full h-full object-cover"}):E.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[E.jsx(rS,{className:"w-10 h-10 text-muted-foreground mb-2"}),E.jsx("span",{className:"text-sm text-muted-foreground",children:"Add kitchen photo"})]}),E.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:E.jsx(rS,{className:"w-8 h-8 text-white"})}),E.jsx("input",{type:"file",accept:"image/*",onChange:Q,className:"absolute inset-0 opacity-0 cursor-pointer"})]})]})}),E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"space-y-4",children:[E.jsxs("div",{children:[E.jsx("label",{className:"text-sm font-medium text-foreground",children:"Kitchen Name *"}),E.jsx(Yi,{value:H.name,onChange:ue=>re({...H,name:ue.target.value}),placeholder:"e.g., Amma's Kitchen",className:"mt-1 bg-secondary border-0"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"text-sm font-medium text-foreground",children:"Description"}),E.jsx("textarea",{value:H.description,onChange:ue=>re({...H,description:ue.target.value}),placeholder:"Tell customers about your kitchen...",rows:3,className:"mt-1 w-full px-4 py-3 rounded-xl bg-secondary text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 resize-none"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"text-sm font-medium text-foreground",children:"Specialties"}),E.jsx(Yi,{value:H.specialties,onChange:ue=>re({...H,specialties:ue.target.value}),placeholder:"e.g., Biryani, South Indian, Sweets",className:"mt-1 bg-secondary border-0"}),E.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Separate with commas"})]}),E.jsxs("div",{className:"flex gap-4",children:[E.jsxs("div",{className:"flex-1",children:[E.jsx("label",{className:"text-sm font-medium text-foreground",children:"Cooking Time"}),E.jsxs("select",{value:H.cookingTime,onChange:ue=>re({...H,cookingTime:ue.target.value}),className:"mt-1 w-full px-4 py-3 rounded-xl bg-secondary text-foreground",children:[E.jsx("option",{value:"15-30 mins",children:"15-30 mins"}),E.jsx("option",{value:"30-45 mins",children:"30-45 mins"}),E.jsx("option",{value:"45-60 mins",children:"45-60 mins"})]})]}),E.jsxs("div",{className:"flex items-center gap-3 pt-6",children:[E.jsx("label",{className:"text-sm font-medium text-foreground",children:"Pure Veg?"}),E.jsx("button",{onClick:()=>re({...H,isVeg:!H.isVeg}),className:`w-12 h-6 rounded-full transition-colors ${H.isVeg?"bg-veg":"bg-muted"}`,children:E.jsx("div",{className:`w-5 h-5 rounded-full bg-white shadow-md transition-transform ${H.isVeg?"translate-x-6":"translate-x-1"}`})})]})]})]}),E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"space-y-4",children:[E.jsxs("div",{children:[E.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[E.jsx(ya,{className:"w-4 h-4 text-primary"}),E.jsx("label",{className:"text-sm font-medium text-foreground",children:"Kitchen Location *"})]}),E.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"Tap on the map to set your kitchen location. It must be within a service zone."}),E.jsx(C9,{onLocationSelect:ee,initialLocation:F||void 0})]}),F&&E.jsxs("div",{className:"bg-secondary rounded-xl p-4",children:[E.jsx("p",{className:"text-sm font-medium text-foreground",children:"Selected Address"}),E.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:F.address}),$&&E.jsx("p",{className:"text-xs text-veg mt-2",children:" Within service area"})]}),E.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[E.jsxs("div",{children:[E.jsx("label",{className:"text-sm font-medium text-foreground",children:"City"}),E.jsx(Yi,{value:H.address.city,onChange:ue=>re({...H,address:{...H.address,city:ue.target.value}}),placeholder:"City",className:"mt-1 bg-secondary border-0"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"text-sm font-medium text-foreground",children:"Pincode"}),E.jsx(Yi,{value:H.address.pincode,onChange:ue=>re({...H,address:{...H.address,pincode:ue.target.value}}),placeholder:"Pincode",className:"mt-1 bg-secondary border-0"})]})]})]}),E.jsx(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:E.jsx(wn,{onClick:ie,disabled:m,className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl text-lg font-semibold",children:m?E.jsxs(E.Fragment,{children:[E.jsx(kr,{className:"w-5 h-5 animate-spin mr-2"}),"Saving..."]}):"Save Changes"})})]})]})}const S1e={super_admin:"/super-admin",franchise_admin:"/franchise-admin",admin:"/admin",amma:"/amma/dashboard",user:"/"};function vL(e){const t=Sa(),i=Qa(),{user:l,loading:d}=t;return q.useEffect(()=>{if(!d){if(!l){i("/auth",{replace:!0});return}if(!e.includes(l.role)){const v=S1e[l.role]||"/";i(v,{replace:!0})}}},[l,d,e,i]),{isAuthorized:!d&&l&&e.includes(l.role),isLoading:d}}const C1e=({kitchens:e=[],userLocation:t,selectedKitchen:i,onKitchenSelect:l,height:d="300px",showUserLocation:m=!0})=>{const v=q.useRef(null),o=q.useRef(null),I=q.useRef([]),[A,N]=q.useState(!1),F=[80.648,16.5062];return q.useEffect(()=>{if(!(!v.current||o.current))return Mr.accessToken=jf,o.current=new Mr.Map({container:v.current,style:"mapbox://styles/mapbox/streets-v12",center:t?[t.lng,t.lat]:F,zoom:13}),o.current.addControl(new Mr.NavigationControl,"top-right"),o.current.on("load",()=>{N(!0)}),()=>{var z;(z=o.current)==null||z.remove(),o.current=null}},[]),q.useEffect(()=>{if(!o.current||!A||!t||!m)return;const z=new Mr.Marker({color:"#D97706"}).setLngLat([t.lng,t.lat]).setPopup(new Mr.Popup().setHTML("<strong>Your Location</strong>")).addTo(o.current);return o.current.flyTo({center:[t.lng,t.lat],zoom:14}),()=>{z.remove()}},[t,A,m]),q.useEffect(()=>{var z;if(!(!o.current||!A)&&(I.current.forEach($=>$.remove()),I.current=[],e.forEach($=>{if(!$.address.lat||!$.address.lng)return;const J=document.createElement("div");J.className="kitchen-marker",J.innerHTML=`
        <div class="w-10 h-10 rounded-full ${$.isOpen?"bg-primary":"bg-muted"} flex items-center justify-center shadow-lg cursor-pointer transform hover:scale-110 transition-transform">
          <span class="text-lg"></span>
        </div>
      `;const H=new Mr.Popup({offset:25}).setHTML(`
        <div class="p-2">
          <h3 class="font-bold text-sm">${$.name}</h3>
          <p class="text-xs text-gray-500">${$.specialties.join(", ")}</p>
          <p class="text-xs ${$.isOpen?"text-green-600":"text-red-500"}">
            ${$.isOpen?" Open":" Closed"}
          </p>
        </div>
      `),re=new Mr.Marker(J).setLngLat([$.address.lng,$.address.lat]).setPopup(H).addTo(o.current);J.addEventListener("click",()=>{l&&l($.id)}),I.current.push(re)}),e.length>0)){const $=new Mr.LngLatBounds;e.forEach(J=>{J.address.lat&&J.address.lng&&$.extend([J.address.lng,J.address.lat])}),t&&$.extend([t.lng,t.lat]),$.isEmpty()||(z=o.current)==null||z.fitBounds($,{padding:50})}},[e,A,l]),q.useEffect(()=>{if(!o.current||!i)return;const z=e.find($=>$.id===i);z!=null&&z.address.lat&&(z!=null&&z.address.lng)&&o.current.flyTo({center:[z.address.lng,z.address.lat],zoom:15})},[i,e]),E.jsxs("div",{className:"relative w-full rounded-xl overflow-hidden shadow-lg",style:{height:d},children:[E.jsx("div",{ref:v,className:"absolute inset-0"}),E.jsx("div",{className:"absolute inset-0 pointer-events-none bg-gradient-to-b from-transparent to-background/5 rounded-xl"})]})};function I1e(){Sa();const{isAuthorized:e,isLoading:t}=vL(["admin","franchise_admin"]),{kitchens:i,loading:l}=mL(),{orders:d,loading:m}=b9(),{users:v,loading:o}=w9(),[I,A]=q.useState("overview"),[N,F]=q.useState(""),z=i.filter(ue=>!ue.isApproved),$=i.filter(ue=>ue.isApproved),J=d.filter(ue=>{const xe=new Date;return new Date(ue.createdAt).toDateString()===xe.toDateString()}),H=d.reduce((ue,xe)=>ue+xe.totalAmount,0),re=async ue=>{try{await gL(ue),Mn.success("Kitchen approved!")}catch{Mn.error("Failed to approve kitchen")}},Q=async ue=>{try{await _L(ue),Mn.success("Kitchen rejected")}catch{Mn.error("Failed to reject kitchen")}},ee=async ue=>{if(confirm("Are you sure you want to delete this user?"))try{await k0e(ue),Mn.success("User deleted")}catch{Mn.error("Failed to delete user")}};return t||l||m||o||!e?E.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:E.jsx(kr,{className:"w-8 h-8 animate-spin text-primary"})}):E.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[E.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:[E.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[E.jsxs("div",{className:"flex items-center gap-4",children:[E.jsx(Fr,{to:"/profile",children:E.jsx(bn.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:E.jsx(Wf,{className:"w-5 h-5"})})}),E.jsxs("div",{children:[E.jsx("h1",{className:"font-semibold text-foreground",children:"Admin Dashboard"}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Manage everything"})]})]}),z.length>0&&E.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-gold text-foreground text-xs",children:[E.jsx(Zc,{className:"w-3 h-3"}),z.length," pending"]})]}),E.jsx("div",{className:"flex bg-secondary mx-4 rounded-xl p-1 mb-4 overflow-x-auto",children:["overview","kitchens","users","orders"].map(ue=>E.jsx("button",{onClick:()=>A(ue),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all capitalize whitespace-nowrap ${I===ue?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:ue},ue))})]}),E.jsxs("div",{className:"px-4 py-4",children:[I==="overview"&&E.jsxs("div",{className:"space-y-4",children:[E.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[E.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[E.jsx(y1,{className:"w-6 h-6 text-primary mb-2"}),E.jsx("p",{className:"text-2xl font-bold text-foreground",children:$.length}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Active Kitchens"})]}),E.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[E.jsx(cy,{className:"w-6 h-6 text-accent mb-2"}),E.jsx("p",{className:"text-2xl font-bold text-foreground",children:v.length}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Users"})]}),E.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[E.jsx(wm,{className:"w-6 h-6 text-gold mb-2"}),E.jsx("p",{className:"text-2xl font-bold text-foreground",children:J.length}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Today's Orders"})]}),E.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[E.jsx(M8,{className:"w-6 h-6 text-veg mb-2"}),E.jsxs("p",{className:"text-2xl font-bold text-foreground",children:["",H]}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Revenue"})]})]}),z.length>0&&E.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[E.jsxs("h3",{className:"font-semibold text-foreground mb-4 flex items-center gap-2",children:[E.jsx(Zc,{className:"w-4 h-4 text-gold"}),"Pending Kitchen Approvals"]}),E.jsx("div",{className:"space-y-3",children:z.map(ue=>E.jsxs("div",{className:"flex items-center justify-between p-3 bg-secondary rounded-xl",children:[E.jsxs("div",{children:[E.jsx("p",{className:"font-medium text-foreground",children:ue.name}),E.jsx("p",{className:"text-xs text-muted-foreground",children:ue.address.city})]}),E.jsxs("div",{className:"flex gap-2",children:[E.jsx(wn,{size:"sm",className:"bg-veg text-primary-foreground",onClick:()=>re(ue.id),children:E.jsx(Zu,{className:"w-4 h-4"})}),E.jsx(wn,{size:"sm",variant:"outline",className:"text-destructive border-destructive",onClick:()=>Q(ue.id),children:E.jsx(Kc,{className:"w-4 h-4"})})]})]},ue.id))})]}),E.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[E.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Kitchen Locations"}),E.jsx(C1e,{kitchens:$,height:"250px",showUserLocation:!1})]})]}),I==="kitchens"&&E.jsxs("div",{className:"space-y-4",children:[E.jsx(Yi,{placeholder:"Search kitchens...",value:N,onChange:ue=>F(ue.target.value),className:"bg-secondary border-0"}),i.filter(ue=>ue.name.toLowerCase().includes(N.toLowerCase())).map(ue=>E.jsxs(bn.div,{className:"bg-card rounded-xl p-4 shadow-card flex gap-4",children:[E.jsx("img",{src:ue.image,alt:ue.name,className:"w-16 h-16 rounded-lg object-cover"}),E.jsxs("div",{className:"flex-1",children:[E.jsxs("div",{className:"flex items-center gap-2",children:[E.jsx("h3",{className:"font-medium text-foreground",children:ue.name}),!ue.isApproved&&E.jsx("span",{className:"px-2 py-0.5 bg-gold/20 text-gold text-xs rounded-full",children:"Pending"})]}),E.jsx("p",{className:"text-sm text-muted-foreground",children:ue.specialties.join(", ")}),E.jsx("p",{className:"text-xs text-muted-foreground",children:ue.address.city})]}),E.jsxs("div",{className:"flex flex-col gap-1",children:[E.jsx("span",{className:Xn("text-xs px-2 py-1 rounded-full text-center",ue.isOpen?"bg-veg/20 text-veg":"bg-muted text-muted-foreground"),children:ue.isOpen?"Open":"Closed"}),!ue.isApproved&&E.jsx(wn,{size:"sm",className:"bg-veg text-primary-foreground text-xs",onClick:()=>re(ue.id),children:"Approve"})]})]},ue.id))]}),I==="users"&&E.jsxs("div",{className:"space-y-4",children:[E.jsx(Yi,{placeholder:"Search users...",value:N,onChange:ue=>F(ue.target.value),className:"bg-secondary border-0"}),v.filter(ue=>ue.name.toLowerCase().includes(N.toLowerCase())||ue.email.toLowerCase().includes(N.toLowerCase())).map(ue=>E.jsxs(bn.div,{className:"bg-card rounded-xl p-4 shadow-card flex items-center gap-4",children:[E.jsx("div",{className:"w-12 h-12 rounded-full bg-secondary flex items-center justify-center",children:E.jsx(cy,{className:"w-6 h-6 text-muted-foreground"})}),E.jsxs("div",{className:"flex-1",children:[E.jsx("h3",{className:"font-medium text-foreground",children:ue.name}),E.jsx("p",{className:"text-sm text-muted-foreground",children:ue.email})]}),E.jsxs("div",{className:"flex items-center gap-2",children:[E.jsx("span",{className:Xn("text-xs px-2 py-1 rounded-full capitalize",ue.role==="admin"?"bg-primary/20 text-primary":ue.role==="amma"?"bg-gold/20 text-gold":"bg-secondary text-muted-foreground"),children:ue.role}),ue.role!=="admin"&&E.jsx(wn,{size:"icon",variant:"ghost",className:"text-destructive",onClick:()=>ee(ue.id),children:E.jsx(Kc,{className:"w-4 h-4"})})]})]},ue.id))]}),I==="orders"&&E.jsx("div",{className:"space-y-4",children:d.length===0?E.jsxs("div",{className:"text-center py-12",children:[E.jsx(wm,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),E.jsx("p",{className:"text-muted-foreground",children:"No orders yet"})]}):d.slice(0,20).map(ue=>E.jsxs(bn.div,{className:"bg-card rounded-xl p-4 shadow-card",children:[E.jsxs("div",{className:"flex items-start justify-between mb-2",children:[E.jsxs("div",{children:[E.jsx("p",{className:"font-medium text-foreground",children:ue.kitchenName}),E.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",ue.id.slice(-8),"  ",new Date(ue.createdAt).toLocaleDateString()]})]}),E.jsx("span",{className:Xn("text-xs px-2 py-1 rounded-full capitalize",ue.status==="delivered"?"bg-veg/20 text-veg":ue.status==="cancelled"?"bg-destructive/20 text-destructive":"bg-primary/20 text-primary"),children:ue.status})]}),E.jsxs("div",{className:"flex justify-between text-sm",children:[E.jsxs("span",{className:"text-muted-foreground",children:[ue.items.length," items"]}),E.jsxs("span",{className:"font-semibold text-foreground",children:["",ue.totalAmount]})]})]},ue.id))})]})]})}function cV({zone:e,kitchens:t=[],users:i=[],height:l="400px",onKitchenClick:d}){const m=q.useRef(null),v=q.useRef(null),[o,I]=q.useState(!0),A=q.useRef([]);return q.useEffect(()=>{if(m.current)return Mr.accessToken=jf,v.current=new Mr.Map({container:m.current,style:"mapbox://styles/mapbox/streets-v12",center:[78.4867,17.385],zoom:10,attributionControl:!1}),v.current.addControl(new Mr.NavigationControl,"bottom-right"),v.current.on("load",()=>{if(I(!1),!v.current)return;v.current.addSource("franchise-zone",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:e.coordinates}}}),v.current.addLayer({id:"franchise-zone-fill",type:"fill",source:"franchise-zone",paint:{"fill-color":"#f97316","fill-opacity":.15}}),v.current.addLayer({id:"franchise-zone-border",type:"line",source:"franchise-zone",paint:{"line-color":"#f97316","line-width":3,"line-dasharray":[2,1]}});const N=e.coordinates[0],F=new Mr.LngLatBounds;N.forEach(z=>F.extend([z[0],z[1]])),v.current.fitBounds(F,{padding:50})}),()=>{var N;(N=v.current)==null||N.remove()}},[]),q.useEffect(()=>{!v.current||o||(A.current.forEach(N=>N.remove()),A.current=[],t.forEach(N=>{var J;if(!N.address.lat||!N.address.lng)return;const F=document.createElement("div");F.className="kitchen-marker",F.innerHTML=`
        <div class="w-10 h-10 rounded-full bg-orange-500 flex items-center justify-center shadow-lg border-2 border-white cursor-pointer transform hover:scale-110 transition-transform">
          <span class="text-lg"></span>
        </div>
      `,F.addEventListener("click",()=>{d&&d(N.id)});const z=new Mr.Popup({offset:25}).setHTML(`
        <div class="p-2">
          <h3 class="font-bold text-sm text-orange-600"> ${N.name}</h3>
          <p class="text-xs text-gray-500">${((J=N.specialties)==null?void 0:J.join(", "))||"Home Kitchen"}</p>
          <p class="text-xs ${N.isOpen?"text-green-600":"text-red-500"}">
            ${N.isOpen?" Open":" Closed"}
          </p>
          ${N.isApproved?"":'<p class="text-xs text-yellow-600"> Pending Approval</p>'}
          <p class="text-xs text-blue-500 mt-1 cursor-pointer">Click for details </p>
        </div>
      `),$=new Mr.Marker(F).setLngLat([N.address.lng,N.address.lat]).setPopup(z).addTo(v.current);A.current.push($)}),i.forEach(N=>{const F=document.createElement("div");F.className="user-marker",F.innerHTML=`
        <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center shadow-lg border-2 border-white cursor-pointer transform hover:scale-110 transition-transform">
          <span class="text-sm"></span>
        </div>
      `;const z=new Mr.Popup({offset:20}).setHTML(`
        <div class="p-2">
          <h3 class="font-bold text-sm text-blue-600"> ${N.name}</h3>
          ${N.email?`<p class="text-xs text-gray-500">${N.email}</p>`:""}
          ${N.city?`<p class="text-xs text-gray-400">${N.city}</p>`:""}
        </div>
      `),$=new Mr.Marker(F).setLngLat([N.lng,N.lat]).setPopup(z).addTo(v.current);A.current.push($)}))},[t,i,o,d]),E.jsxs("div",{className:"relative rounded-xl overflow-hidden shadow-lg",style:{height:l},children:[E.jsx("div",{ref:m,className:"absolute inset-0"}),o&&E.jsx("div",{className:"absolute inset-0 bg-secondary flex items-center justify-center",children:E.jsx(kr,{className:"w-6 h-6 animate-spin text-primary"})}),E.jsxs("div",{className:"absolute bottom-4 left-4 bg-card/95 backdrop-blur-sm rounded-lg px-3 py-2 shadow-lg",children:[E.jsx("p",{className:"text-xs font-medium text-foreground mb-2",children:"Legend"}),E.jsxs("div",{className:"space-y-1",children:[E.jsxs("div",{className:"flex items-center gap-2",children:[E.jsx("div",{className:"w-4 h-4 rounded-full bg-orange-500 flex items-center justify-center",children:E.jsx("span",{className:"text-[8px]",children:""})}),E.jsx("span",{className:"text-xs text-muted-foreground",children:"Amma (Kitchen)"})]}),E.jsxs("div",{className:"flex items-center gap-2",children:[E.jsx("div",{className:"w-4 h-4 rounded-full bg-blue-500 flex items-center justify-center",children:E.jsx("span",{className:"text-[8px]",children:""})}),E.jsx("span",{className:"text-xs text-muted-foreground",children:"Customer"})]}),E.jsxs("div",{className:"flex items-center gap-2",children:[E.jsx("div",{className:"w-4 h-1 bg-orange-500 rounded",style:{borderStyle:"dashed"}}),E.jsx("span",{className:"text-xs text-muted-foreground",children:"Service Zone"})]})]})]})]})}function A1e(){var nn,Wt;const{user:e,signOut:t}=Sa(),i=Qa(),{isAuthorized:l,isLoading:d}=vL(["franchise_admin"]),{franchise:m,loading:v}=B0e(e==null?void 0:e.franchiseId),{kitchens:o,loading:I}=mL(),{orders:A,loading:N}=b9(),{users:F,loading:z}=w9(),[$,J]=q.useState("overview"),[H,re]=q.useState(""),[Q,ee]=q.useState(null),ie=async()=>{await t(),i("/auth")},ue=Ke=>{const et=xe.find(Ct=>Ct.id===Ke);et&&ee(et)},xe=o.filter(Ke=>!(m!=null&&m.zone)||!Ke.address.lat||!Ke.address.lng?!1:WT(Ke.address.lat,Ke.address.lng,m.zone)),Oe=F.filter(Ke=>{var et,Ct;return!(m!=null&&m.zone)||!((et=Ke.address)!=null&&et.lat)||!((Ct=Ke.address)!=null&&Ct.lng)||Ke.role!=="user"?!1:WT(Ke.address.lat,Ke.address.lng,m.zone)});F.filter(Ke=>{var et,Ct;return!(m!=null&&m.zone)||!((et=Ke.address)!=null&&et.lat)||!((Ct=Ke.address)!=null&&Ct.lng)?!1:Ke.role==="amma"&&WT(Ke.address.lat,Ke.address.lng,m.zone)});const ze=xe.filter(Ke=>!Ke.isApproved),Be=xe.filter(Ke=>Ke.isApproved),ot=A.filter(Ke=>{const et=o.find(Ct=>Ct.id===Ke.kitchenId);return!(m!=null&&m.zone)||!(et!=null&&et.address.lat)||!(et!=null&&et.address.lng)?!1:WT(et.address.lat,et.address.lng,m.zone)}),Et=ot.filter(Ke=>{const et=new Date;return new Date(Ke.createdAt).toDateString()===et.toDateString()}),Zt=ot.reduce((Ke,et)=>Ke+et.totalAmount,0),at=async Ke=>{try{await gL(Ke),Mn.success("Kitchen approved!")}catch{Mn.error("Failed to approve kitchen")}},zt=async Ke=>{try{await _L(Ke),Mn.success("Kitchen rejected")}catch{Mn.error("Failed to reject kitchen")}};return d||v||I||N||z||!l?E.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:E.jsx(kr,{className:"w-8 h-8 animate-spin text-primary"})}):m?E.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[E.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:[E.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[E.jsxs("div",{children:[E.jsx("h1",{className:"font-semibold text-foreground",children:m.name}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Franchise Dashboard"})]}),E.jsxs("div",{className:"flex items-center gap-2",children:[ze.length>0&&E.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-gold text-foreground text-xs",children:[E.jsx(Zc,{className:"w-3 h-3"}),ze.length," pending"]}),E.jsxs(wn,{variant:"ghost",size:"sm",onClick:ie,className:"text-destructive",children:[E.jsx(_1,{className:"w-4 h-4 mr-1"}),"Logout"]})]})]}),E.jsx("div",{className:"flex bg-secondary mx-4 rounded-xl p-1 mb-4 overflow-x-auto",children:["overview","map","kitchens","users"].map(Ke=>E.jsx("button",{onClick:()=>J(Ke),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all capitalize whitespace-nowrap ${$===Ke?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:Ke==="map"?E.jsxs("span",{className:"flex items-center justify-center gap-1",children:[E.jsx(ya,{className:"w-3 h-3"})," Map"]}):Ke},Ke))})]}),E.jsxs("div",{className:"px-4 py-4",children:[$==="overview"&&E.jsxs("div",{className:"space-y-4",children:[E.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[E.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[E.jsx(y1,{className:"w-6 h-6 text-primary mb-2"}),E.jsx("p",{className:"text-2xl font-bold text-foreground",children:Be.length}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Active Kitchens"})]}),E.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[E.jsx(cy,{className:"w-6 h-6 text-blue-500 mb-2"}),E.jsx("p",{className:"text-2xl font-bold text-foreground",children:Oe.length}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Customers"})]}),E.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[E.jsx(wm,{className:"w-6 h-6 text-gold mb-2"}),E.jsx("p",{className:"text-2xl font-bold text-foreground",children:Et.length}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Today's Orders"})]}),E.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[E.jsx(M8,{className:"w-6 h-6 text-veg mb-2"}),E.jsxs("p",{className:"text-2xl font-bold text-foreground",children:["",Zt]}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Revenue"})]})]}),ze.length>0&&E.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[E.jsxs("h3",{className:"font-semibold text-foreground mb-4 flex items-center gap-2",children:[E.jsx(Zc,{className:"w-4 h-4 text-gold"}),"Pending Kitchen Approvals"]}),E.jsx("div",{className:"space-y-3",children:ze.map(Ke=>E.jsxs("div",{className:"flex items-center justify-between p-3 bg-secondary rounded-xl",children:[E.jsxs("div",{children:[E.jsx("p",{className:"font-medium text-foreground",children:Ke.name}),E.jsx("p",{className:"text-xs text-muted-foreground",children:Ke.address.city})]}),E.jsxs("div",{className:"flex gap-2",children:[E.jsx(wn,{size:"sm",className:"bg-veg text-primary-foreground",onClick:()=>at(Ke.id),children:E.jsx(Zu,{className:"w-4 h-4"})}),E.jsx(wn,{size:"sm",variant:"outline",className:"text-destructive border-destructive",onClick:()=>zt(Ke.id),children:E.jsx(Kc,{className:"w-4 h-4"})})]})]},Ke.id))})]}),E.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[E.jsxs("h3",{className:"font-semibold text-foreground mb-4 flex items-center gap-2",children:[E.jsx(ya,{className:"w-4 h-4 text-primary"}),"Service Zone"]}),E.jsx(cV,{zone:m.zone,kitchens:xe,users:Oe.map(Ke=>{var et;return{id:Ke.id,name:Ke.name,lat:Ke.address.lat,lng:Ke.address.lng,email:Ke.email,city:(et=Ke.address)==null?void 0:et.city}}),height:"500px",onKitchenClick:ue}),E.jsxs("p",{className:"text-xs text-muted-foreground text-center mt-2",children:[xe.length," Ammas  ",Oe.length," Customers in zone"]})]})]}),$==="map"&&E.jsxs("div",{className:"space-y-4",children:[E.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[E.jsxs("h3",{className:"font-semibold text-foreground mb-4 flex items-center gap-2",children:[E.jsx(ya,{className:"w-4 h-4 text-primary"}),m.name," - Service Zone Map"]}),E.jsx(cV,{zone:m.zone,kitchens:xe,users:Oe.map(Ke=>{var et;return{id:Ke.id,name:Ke.name,lat:Ke.address.lat,lng:Ke.address.lng,email:Ke.email,city:(et=Ke.address)==null?void 0:et.city}}),height:"750px",onKitchenClick:ue})]}),Q&&E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl p-4 shadow-card",children:[E.jsxs("div",{className:"flex items-start gap-4",children:[E.jsx("img",{src:Q.image,alt:Q.name,className:"w-20 h-20 rounded-xl object-cover"}),E.jsxs("div",{className:"flex-1",children:[E.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[E.jsx("h3",{className:"font-semibold text-foreground",children:Q.name}),!Q.isApproved&&E.jsx("span",{className:"px-2 py-0.5 bg-gold/20 text-gold text-xs rounded-full",children:"Pending"})]}),E.jsx("p",{className:"text-sm text-muted-foreground",children:(nn=Q.specialties)==null?void 0:nn.join(", ")}),E.jsxs("p",{className:"text-xs text-muted-foreground",children:[Q.address.line1,", ",Q.address.city]}),E.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[E.jsx("span",{className:Xn("text-xs px-2 py-1 rounded-full",Q.isOpen?"bg-veg/20 text-veg":"bg-muted text-muted-foreground"),children:Q.isOpen?" Open":" Closed"}),E.jsxs("span",{className:"text-xs text-muted-foreground",children:[" ",((Wt=Q.rating)==null?void 0:Wt.toFixed(1))||"N/A"]})]})]}),E.jsx(wn,{variant:"ghost",size:"sm",onClick:()=>ee(null),className:"text-muted-foreground",children:E.jsx(Kc,{className:"w-4 h-4"})})]}),!Q.isApproved&&E.jsxs("div",{className:"flex gap-2 mt-4",children:[E.jsxs(wn,{size:"sm",className:"flex-1 bg-veg text-primary-foreground",onClick:()=>{at(Q.id),ee(null)},children:[E.jsx(Zu,{className:"w-4 h-4 mr-1"})," Approve"]}),E.jsxs(wn,{size:"sm",variant:"outline",className:"flex-1 text-destructive border-destructive",onClick:()=>{zt(Q.id),ee(null)},children:[E.jsx(Kc,{className:"w-4 h-4 mr-1"})," Reject"]})]})]}),E.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[E.jsxs("div",{className:"bg-card rounded-xl p-3 shadow-card text-center",children:[E.jsx("p",{className:"text-xl font-bold text-orange-500",children:xe.length}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Ammas"})]}),E.jsxs("div",{className:"bg-card rounded-xl p-3 shadow-card text-center",children:[E.jsx("p",{className:"text-xl font-bold text-blue-500",children:Oe.length}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Customers"})]}),E.jsxs("div",{className:"bg-card rounded-xl p-3 shadow-card text-center",children:[E.jsx("p",{className:"text-xl font-bold text-veg",children:ot.length}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Orders"})]})]})]}),$==="kitchens"&&E.jsxs("div",{className:"space-y-4",children:[E.jsx(Yi,{placeholder:"Search kitchens...",value:H,onChange:Ke=>re(Ke.target.value),className:"bg-secondary border-0"}),xe.length===0?E.jsxs("div",{className:"text-center py-12",children:[E.jsx(y1,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),E.jsx("p",{className:"text-muted-foreground",children:"No kitchens in your zone yet"})]}):xe.filter(Ke=>Ke.name.toLowerCase().includes(H.toLowerCase())).map(Ke=>{var et;return E.jsxs(bn.div,{className:"bg-card rounded-xl p-4 shadow-card flex gap-4",children:[E.jsx("img",{src:Ke.image,alt:Ke.name,className:"w-16 h-16 rounded-lg object-cover"}),E.jsxs("div",{className:"flex-1",children:[E.jsxs("div",{className:"flex items-center gap-2",children:[E.jsx("h3",{className:"font-medium text-foreground",children:Ke.name}),!Ke.isApproved&&E.jsx("span",{className:"px-2 py-0.5 bg-gold/20 text-gold text-xs rounded-full",children:"Pending"})]}),E.jsx("p",{className:"text-sm text-muted-foreground",children:(et=Ke.specialties)==null?void 0:et.join(", ")}),E.jsx("p",{className:"text-xs text-muted-foreground",children:Ke.address.city})]}),E.jsxs("div",{className:"flex flex-col gap-1",children:[E.jsx("span",{className:Xn("text-xs px-2 py-1 rounded-full text-center",Ke.isOpen?"bg-veg/20 text-veg":"bg-muted text-muted-foreground"),children:Ke.isOpen?"Open":"Closed"}),!Ke.isApproved&&E.jsx(wn,{size:"sm",className:"bg-veg text-primary-foreground text-xs",onClick:()=>at(Ke.id),children:"Approve"})]})]},Ke.id)})]}),$==="users"&&E.jsxs("div",{className:"space-y-4",children:[E.jsx(Yi,{placeholder:"Search users...",value:H,onChange:Ke=>re(Ke.target.value),className:"bg-secondary border-0"}),Oe.length===0?E.jsxs("div",{className:"text-center py-12",children:[E.jsx(cy,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),E.jsx("p",{className:"text-muted-foreground",children:"No customers in your zone yet"})]}):Oe.filter(Ke=>Ke.name.toLowerCase().includes(H.toLowerCase())||Ke.email.toLowerCase().includes(H.toLowerCase())).map(Ke=>{var et;return E.jsxs(bn.div,{className:"bg-card rounded-xl p-4 shadow-card flex items-center gap-4",children:[E.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-500/20 flex items-center justify-center",children:E.jsx(cy,{className:"w-6 h-6 text-blue-500"})}),E.jsxs("div",{className:"flex-1",children:[E.jsx("h3",{className:"font-medium text-foreground",children:Ke.name}),E.jsx("p",{className:"text-sm text-muted-foreground",children:Ke.email}),((et=Ke.address)==null?void 0:et.city)&&E.jsx("p",{className:"text-xs text-muted-foreground",children:Ke.address.city})]}),E.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-blue-500/20 text-blue-500",children:"Customer"})]},Ke.id)})]})]})]}):E.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[E.jsx(Zc,{className:"w-16 h-16 text-gold mb-4"}),E.jsx("p",{className:"text-muted-foreground mb-4",children:"No franchise assigned to your account"}),E.jsx(Fr,{to:"/",children:E.jsx(wn,{className:"gradient-primary text-primary-foreground",children:"Go Home"})})]})}const NP=Tq,uV=Eq,P1e=Sq,uZ=q.forwardRef(({className:e,...t},i)=>E.jsx(iL,{ref:i,className:Xn("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));uZ.displayName=iL.displayName;const RE=q.forwardRef(({className:e,children:t,...i},l)=>E.jsxs(P1e,{children:[E.jsx(uZ,{}),E.jsxs(rL,{ref:l,className:Xn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...i,children:[t,E.jsxs(aL,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[E.jsx(Kc,{className:"h-4 w-4"}),E.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));RE.displayName=rL.displayName;const ME=({className:e,...t})=>E.jsx("div",{className:Xn("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});ME.displayName="DialogHeader";const kE=q.forwardRef(({className:e,...t},i)=>E.jsx(sL,{ref:i,className:Xn("text-lg font-semibold leading-none tracking-tight",e),...t}));kE.displayName=sL.displayName;const R1e=q.forwardRef(({className:e,...t},i)=>E.jsx(oL,{ref:i,className:Xn("text-sm text-muted-foreground",e),...t}));R1e.displayName=oL.displayName;const Ua={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},Kl={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},ws={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},Ga={POLYGON:"polygon",LINE:"line_string",POINT:"point"},ii={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},mr={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},wa={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},vb={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},Jo={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Io={ACTIVE:"true",INACTIVE:"false"},dZ=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],M1e=-90,HM=-85,k1e=90,WM=85,D1e=-270,N1e=270,hZ=Object.freeze(Object.defineProperty({__proto__:null,LAT_MAX:k1e,LAT_MIN:M1e,LAT_RENDERED_MAX:WM,LAT_RENDERED_MIN:HM,LNG_MAX:N1e,LNG_MIN:D1e,activeStates:Io,classes:Ua,cursors:ws,events:wa,geojsonTypes:ii,interactions:dZ,meta:Jo,modes:mr,sources:Kl,types:Ga,updateActions:vb},Symbol.toStringTag,{value:"Module"}));function sI(e){return function(t){const i=t.featureTarget;return!i||!i.properties?!1:i.properties.meta===e}}function fZ(e){return!e.originalEvent||!e.originalEvent.shiftKey?!1:e.originalEvent.button===0}function Hm(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===Io.ACTIVE&&e.featureTarget.properties.meta===Jo.FEATURE}function xL(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===Io.INACTIVE&&e.featureTarget.properties.meta===Jo.FEATURE}function oI(e){return e.featureTarget===void 0}function bL(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.meta===Jo.FEATURE}function xb(e){const t=e.featureTarget;return!t||!t.properties?!1:t.properties.meta===Jo.VERTEX}function KS(e){return e.originalEvent?e.originalEvent.shiftKey===!0:!1}function aI(e){return e.key==="Escape"||e.keyCode===27}function lI(e){return e.key==="Enter"||e.keyCode===13}function qM(e){return e.key==="Backspace"||e.keyCode===8}function ZM(e){return e.key==="Delete"||e.keyCode===46}function pZ(e){return e.key==="1"||e.keyCode===49}function mZ(e){return e.key==="2"||e.keyCode===50}function gZ(e){return e.key==="3"||e.keyCode===51}function _Z(e){const t=e.key||String.fromCharCode(e.keyCode);return t>="0"&&t<="9"}function L1e(){return!0}const O1e=Object.freeze(Object.defineProperty({__proto__:null,isActiveFeature:Hm,isBackspaceKey:qM,isDeleteKey:ZM,isDigit1Key:pZ,isDigit2Key:mZ,isDigit3Key:gZ,isDigitKey:_Z,isEnterKey:lI,isEscapeKey:aI,isFeature:bL,isInactiveFeature:xL,isOfMetaType:sI,isShiftDown:KS,isShiftMousedown:fZ,isTrue:L1e,isVertex:xb,noTarget:oI},Symbol.toStringTag,{value:"Module"}));var wL={},cI={};cI.RADIUS=6378137;cI.FLATTENING=1/298.257223563;cI.POLAR_RADIUS=63567523142e-4;var dV=cI;wL.geometry=yZ;wL.ring=KM;function yZ(e){var t=0,i;switch(e.type){case"Polygon":return hV(e.coordinates);case"MultiPolygon":for(i=0;i<e.coordinates.length;i++)t+=hV(e.coordinates[i]);return t;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(i=0;i<e.geometries.length;i++)t+=yZ(e.geometries[i]);return t}}function hV(e){var t=0;if(e&&e.length>0){t+=Math.abs(KM(e[0]));for(var i=1;i<e.length;i++)t-=Math.abs(KM(e[i]))}return t}function KM(e){var t,i,l,d,m,v,o,I=0,A=e.length;if(A>2){for(o=0;o<A;o++)o===A-2?(d=A-2,m=A-1,v=0):o===A-1?(d=A-1,m=0,v=1):(d=o,m=o+1,v=o+2),t=e[d],i=e[m],l=e[v],I+=(LP(l[0])-LP(t[0]))*Math.sin(LP(i[1]));I=I*dV.RADIUS*dV.RADIUS/2}return I}function LP(e){return e*Math.PI/180}const fV={Point:0,LineString:1,MultiLineString:1,Polygon:2};function F1e(e,t){const i=fV[e.geometry.type]-fV[t.geometry.type];return i===0&&e.geometry.type===ii.POLYGON?e.area-t.area:i}function vZ(e){return e.map(t=>(t.geometry.type===ii.POLYGON&&(t.area=wL.geometry({type:ii.FEATURE,property:{},geometry:t.geometry})),t)).sort(F1e).map(t=>(delete t.area,t))}function xZ(e,t=0){return[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]}function tc(e){if(this._items={},this._nums={},this._length=e?e.length:0,!!e)for(let t=0,i=e.length;t<i;t++)this.add(e[t]),e[t]!==void 0&&(typeof e[t]=="string"?this._items[e[t]]=t:this._nums[e[t]]=t)}tc.prototype.add=function(e){return this.has(e)?this:(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length,this)};tc.prototype.delete=function(e){return this.has(e)===!1?this:(this._length--,delete this._items[e],delete this._nums[e],this)};tc.prototype.has=function(e){return typeof e!="string"&&typeof e!="number"?!1:this._items[e]!==void 0||this._nums[e]!==void 0};tc.prototype.values=function(){const e=[];return Object.keys(this._items).forEach(t=>{e.push({k:t,v:this._items[t]})}),Object.keys(this._nums).forEach(t=>{e.push({k:JSON.parse(t),v:this._nums[t]})}),e.sort((t,i)=>t.v-i.v).map(t=>t.k)};tc.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const z1e=[Jo.FEATURE,Jo.MIDPOINT,Jo.VERTEX],qy={click:j1e,touch:B1e};function j1e(e,t,i){return bZ(e,t,i,i.options.clickBuffer)}function B1e(e,t,i){return bZ(e,t,i,i.options.touchBuffer)}function bZ(e,t,i,l){if(i.map===null)return[];const d=e?xZ(e,l):t,m={};i.options.styles&&(m.layers=i.options.styles.map(A=>A.id).filter(A=>i.map.getLayer(A)!=null));const v=i.map.queryRenderedFeatures(d,m).filter(A=>z1e.indexOf(A.properties.meta)!==-1),o=new tc,I=[];return v.forEach(A=>{const N=A.properties.id;o.has(N)||(o.add(N),I.push(A))}),vZ(I)}function DE(e,t){const i=qy.click(e,null,t),l={mouse:ws.NONE};return i[0]&&(l.mouse=i[0].properties.active===Io.ACTIVE?ws.MOVE:ws.POINTER,l.feature=i[0].properties.meta),t.events.currentModeName().indexOf("draw")!==-1&&(l.mouse=ws.ADD),t.ui.queueMapClasses(l),t.ui.updateMapClasses(),i[0]}function TL(e,t){const i=e.x-t.x,l=e.y-t.y;return Math.sqrt(i*i+l*l)}const V1e=4,U1e=12,$1e=500;function XM(e,t,i={}){const l=i.fineTolerance!=null?i.fineTolerance:V1e,d=i.grossTolerance!=null?i.grossTolerance:U1e,m=i.interval!=null?i.interval:$1e;e.point=e.point||t.point,e.time=e.time||t.time;const v=TL(e.point,t.point);return v<l||v<d&&t.time-e.time<m}const G1e=25,H1e=250;function YM(e,t,i={}){const l=i.tolerance!=null?i.tolerance:G1e,d=i.interval!=null?i.interval:H1e;return e.point=e.point||t.point,e.time=e.time||t.time,TL(e.point,t.point)<l&&t.time-e.time<d}const QM=function(e,t){const i={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},l={on(m,v,o){if(i[m]===void 0)throw new Error(`Invalid event type: ${m}`);i[m].push({selector:v,fn:o})},render(m){t.store.featureChanged(m)}},d=function(m,v){const o=i[m];let I=o.length;for(;I--;){const A=o[I];if(A.selector(v)){A.fn.call(l,v)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(l),{render:e.render,stop(){e.stop&&e.stop()},trash(){e.trash&&(e.trash(),t.store.render())},combineFeatures(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures(){e.uncombineFeatures&&e.uncombineFeatures()},drag(m){d("drag",m)},click(m){d("click",m)},mousemove(m){d("mousemove",m)},mousedown(m){d("mousedown",m)},mouseup(m){d("mouseup",m)},mouseout(m){d("mouseout",m)},keydown(m){d("keydown",m)},keyup(m){d("keyup",m)},touchstart(m){d("touchstart",m)},touchmove(m){d("touchmove",m)},touchend(m){d("touchend",m)},tap(m){d("tap",m)}}};let W1e=(e,t=21)=>(i=t)=>{let l="",d=i|0;for(;d--;)l+=e[Math.random()*e.length|0];return l};const q1e=W1e("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function EL(){return q1e()}const Ca=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||EL(),this.type=t.geometry.type};Ca.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};Ca.prototype.incomingCoords=function(e){this.setCoordinates(e)};Ca.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};Ca.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};Ca.prototype.setProperty=function(e,t){this.properties[e]=t};Ca.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:ii.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};Ca.prototype.internal=function(e){const t={id:this.id,meta:Jo.FEATURE,"meta:type":this.type,active:Io.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(const i in this.properties)t[`user_${i}`]=this.properties[i];return{type:ii.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const Jf=function(e,t){Ca.call(this,e,t)};Jf.prototype=Object.create(Ca.prototype);Jf.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};Jf.prototype.updateCoordinate=function(e,t,i){arguments.length===3?this.coordinates=[t,i]:this.coordinates=[e,t],this.changed()};Jf.prototype.getCoordinate=function(){return this.getCoordinates()};const nd=function(e,t){Ca.call(this,e,t)};nd.prototype=Object.create(Ca.prototype);nd.prototype.isValid=function(){return this.coordinates.length>1};nd.prototype.addCoordinate=function(e,t,i){this.changed();const l=parseInt(e,10);this.coordinates.splice(l,0,[t,i])};nd.prototype.getCoordinate=function(e){const t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))};nd.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)};nd.prototype.updateCoordinate=function(e,t,i){const l=parseInt(e,10);this.coordinates[l]=[t,i],this.changed()};const El=function(e,t){Ca.call(this,e,t),this.coordinates=this.coordinates.map(i=>i.slice(0,-1))};El.prototype=Object.create(Ca.prototype);El.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(e=>e.length>2)};El.prototype.incomingCoords=function(e){this.coordinates=e.map(t=>t.slice(0,-1)),this.changed()};El.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};El.prototype.addCoordinate=function(e,t,i){this.changed();const l=e.split(".").map(m=>parseInt(m,10));this.coordinates[l[0]].splice(l[1],0,[t,i])};El.prototype.removeCoordinate=function(e){this.changed();const t=e.split(".").map(l=>parseInt(l,10)),i=this.coordinates[t[0]];i&&(i.splice(t[1],1),i.length<3&&this.coordinates.splice(t[0],1))};El.prototype.getCoordinate=function(e){const t=e.split(".").map(l=>parseInt(l,10)),i=this.coordinates[t[0]];return JSON.parse(JSON.stringify(i[t[1]]))};El.prototype.getCoordinates=function(){return this.coordinates.map(e=>e.concat([e[0]]))};El.prototype.updateCoordinate=function(e,t,i){this.changed();const l=e.split("."),d=parseInt(l[0],10),m=parseInt(l[1],10);this.coordinates[d]===void 0&&(this.coordinates[d]=[]),this.coordinates[d][m]=[t,i]};const Z1e={MultiPoint:Jf,MultiLineString:nd,MultiPolygon:El},uI=(e,t,i,l,d)=>{const m=i.split("."),v=parseInt(m[0],10),o=m[1]?m.slice(1).join("."):null;return e[v][t](o,l,d)},xa=function(e,t){if(Ca.call(this,e,t),delete this.coordinates,this.model=Z1e[t.geometry.type],this.model===void 0)throw new TypeError(`${t.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(t.geometry.coordinates)};xa.prototype=Object.create(Ca.prototype);xa.prototype._coordinatesToFeatures=function(e){const t=this.model.bind(this);return e.map(i=>new t(this.ctx,{id:EL(),type:ii.FEATURE,properties:{},geometry:{coordinates:i,type:this.type.replace("Multi","")}}))};xa.prototype.isValid=function(){return this.features.every(e=>e.isValid())};xa.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()};xa.prototype.getCoordinate=function(e){return uI(this.features,"getCoordinate",e)};xa.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(e=>e.type===ii.POLYGON?e.getCoordinates():e.coordinates)))};xa.prototype.updateCoordinate=function(e,t,i){uI(this.features,"updateCoordinate",e,t,i),this.changed()};xa.prototype.addCoordinate=function(e,t,i){uI(this.features,"addCoordinate",e,t,i),this.changed()};xa.prototype.removeCoordinate=function(e){uI(this.features,"removeCoordinate",e),this.changed()};xa.prototype.getFeatures=function(){return this.features};function Qi(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}Qi.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)};Qi.prototype.setSelectedCoordinates=function(e){this._ctx.store.setSelectedCoordinates(e),e.reduce((t,i)=>(t[i.feature_id]===void 0&&(t[i.feature_id]=!0,this._ctx.store.get(i.feature_id).changed()),t),{})};Qi.prototype.getSelected=function(){return this._ctx.store.getSelected()};Qi.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};Qi.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)};Qi.prototype.getFeature=function(e){return this._ctx.store.get(e)};Qi.prototype.select=function(e){return this._ctx.store.select(e)};Qi.prototype.deselect=function(e){return this._ctx.store.deselect(e)};Qi.prototype.deleteFeature=function(e,t={}){return this._ctx.store.delete(e,t)};Qi.prototype.addFeature=function(e,t={}){return this._ctx.store.add(e,t)};Qi.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};Qi.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};Qi.prototype.setActionableState=function(e={}){const t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)};Qi.prototype.changeMode=function(e,t={},i={}){return this._ctx.events.changeMode(e,t,i)};Qi.prototype.fire=function(e,t){return this._ctx.events.fire(e,t)};Qi.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)};Qi.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)};Qi.prototype.featuresAt=function(e,t,i="click"){if(i!=="click"&&i!=="touch")throw new Error("invalid buffer type");return qy[i](e,t,this._ctx)};Qi.prototype.newFeature=function(e){const t=e.geometry.type;return t===ii.POINT?new Jf(this._ctx,e):t===ii.LINE_STRING?new nd(this._ctx,e):t===ii.POLYGON?new El(this._ctx,e):new xa(this._ctx,e)};Qi.prototype.isInstanceOf=function(e,t){if(e===ii.POINT)return t instanceof Jf;if(e===ii.LINE_STRING)return t instanceof nd;if(e===ii.POLYGON)return t instanceof El;if(e==="MultiFeature")return t instanceof xa;throw new Error(`Unknown feature class: ${e}`)};Qi.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)};Qi.prototype.onSetup=function(){};Qi.prototype.onDrag=function(){};Qi.prototype.onClick=function(){};Qi.prototype.onMouseMove=function(){};Qi.prototype.onMouseDown=function(){};Qi.prototype.onMouseUp=function(){};Qi.prototype.onMouseOut=function(){};Qi.prototype.onKeyUp=function(){};Qi.prototype.onKeyDown=function(){};Qi.prototype.onTouchStart=function(){};Qi.prototype.onTouchMove=function(){};Qi.prototype.onTouchEnd=function(){};Qi.prototype.onTap=function(){};Qi.prototype.onStop=function(){};Qi.prototype.onTrash=function(){};Qi.prototype.onCombineFeature=function(){};Qi.prototype.onUncombineFeature=function(){};Qi.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const wZ={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},K1e=Object.keys(wZ);function X1e(e){const t=Object.keys(e);return function(i,l={}){let d={};const m=t.reduce((o,I)=>(o[I]=e[I],o),new Qi(i));function v(o){return I=>m[o](d,I)}return{start(){d=m.onSetup(l),K1e.forEach(o=>{const I=wZ[o];let A=()=>!1;e[I]&&(A=()=>!0),this.on(o,A,v(I))})},stop(){m.onStop(d)},trash(){m.onTrash(d)},combineFeatures(){m.onCombineFeatures(d)},uncombineFeatures(){m.onUncombineFeatures(d)},render(o,I){m.toDisplayFeatures(d,o,I)}}}}function Y1e(e){const t=Object.keys(e.options.modes).reduce((z,$)=>(z[$]=X1e(e.options.modes[$]),z),{});let i={},l={};const d={};let m=null,v=null;d.drag=function(z,$){$({point:z.point,time:new Date().getTime()})?(e.ui.queueMapClasses({mouse:ws.DRAG}),v.drag(z)):z.originalEvent.stopPropagation()},d.mousedrag=function(z){d.drag(z,$=>!XM(i,$))},d.touchdrag=function(z){d.drag(z,$=>!YM(l,$))},d.mousemove=function(z){if((z.originalEvent.buttons!==void 0?z.originalEvent.buttons:z.originalEvent.which)===1)return d.mousedrag(z);const J=DE(z,e);z.featureTarget=J,v.mousemove(z)},d.mousedown=function(z){i={time:new Date().getTime(),point:z.point};const $=DE(z,e);z.featureTarget=$,v.mousedown(z)},d.mouseup=function(z){const $=DE(z,e);z.featureTarget=$,XM(i,{point:z.point,time:new Date().getTime()})?v.click(z):v.mouseup(z)},d.mouseout=function(z){v.mouseout(z)},d.touchstart=function(z){if(!e.options.touchEnabled)return;l={time:new Date().getTime(),point:z.point};const $=qy.touch(z,null,e)[0];z.featureTarget=$,v.touchstart(z)},d.touchmove=function(z){if(e.options.touchEnabled)return v.touchmove(z),d.touchdrag(z)},d.touchend=function(z){if(z.originalEvent.preventDefault(),!e.options.touchEnabled)return;const $=qy.touch(z,null,e)[0];z.featureTarget=$,YM(l,{time:new Date().getTime(),point:z.point})?v.tap(z):v.touchend(z)};const o=z=>{const $=qM(z),J=ZM(z),H=_Z(z);return!($||J||H)};d.keydown=function(z){(z.srcElement||z.target).classList.contains(Ua.CANVAS)&&((qM(z)||ZM(z))&&e.options.controls.trash?(z.preventDefault(),v.trash()):o(z)?v.keydown(z):pZ(z)&&e.options.controls.point?I(mr.DRAW_POINT):mZ(z)&&e.options.controls.line_string?I(mr.DRAW_LINE_STRING):gZ(z)&&e.options.controls.polygon&&I(mr.DRAW_POLYGON))},d.keyup=function(z){o(z)&&v.keyup(z)},d.zoomend=function(){e.store.changeZoom()},d.data=function(z){if(z.dataType==="style"){const{setup:$,map:J,options:H,store:re}=e;H.styles.some(ee=>J.getLayer(ee.id))||($.addLayers(),re.setDirty(),re.render())}};function I(z,$,J={}){v.stop();const H=t[z];if(H===void 0)throw new Error(`${z} is not valid`);m=z;const re=H(e,$);v=QM(re,e),J.silent||e.map.fire(wa.MODE_CHANGE,{mode:z}),e.store.setDirty(),e.store.render()}const A={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function N(z){let $=!1;Object.keys(z).forEach(J=>{if(A[J]===void 0)throw new Error("Invalid action type");A[J]!==z[J]&&($=!0),A[J]=z[J]}),$&&e.map.fire(wa.ACTIONABLE,{actions:A})}return{start(){m=e.options.defaultMode,v=QM(t[m](e),e)},changeMode:I,actionable:N,currentModeName(){return m},currentModeRender(z,$){return v.render(z,$)},fire(z,$){e.map&&e.map.fire(z,$)},addEventListeners(){e.map.on("mousemove",d.mousemove),e.map.on("mousedown",d.mousedown),e.map.on("mouseup",d.mouseup),e.map.on("data",d.data),e.map.on("touchmove",d.touchmove),e.map.on("touchstart",d.touchstart),e.map.on("touchend",d.touchend),e.container.addEventListener("mouseout",d.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",d.keydown),e.container.addEventListener("keyup",d.keyup))},removeEventListeners(){e.map.off("mousemove",d.mousemove),e.map.off("mousedown",d.mousedown),e.map.off("mouseup",d.mouseup),e.map.off("data",d.data),e.map.off("touchmove",d.touchmove),e.map.off("touchstart",d.touchstart),e.map.off("touchend",d.touchend),e.container.removeEventListener("mouseout",d.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",d.keydown),e.container.removeEventListener("keyup",d.keyup))},trash(z){v.trash(z)},combineFeatures(){v.combineFeatures()},uncombineFeatures(){v.uncombineFeatures()},getMode(){return m}}}function bb(e){return[].concat(e).filter(t=>t!==void 0)}function Q1e(){const e=this;if(!(e.ctx.map&&e.ctx.map.getSource(Kl.HOT)!==void 0))return I();const i=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:i});let l=[],d=[];e.isDirty?d=e.getAllIds():(l=e.getChangedIds().filter(A=>e.get(A)!==void 0),d=e.sources.hot.filter(A=>A.properties.id&&l.indexOf(A.properties.id)===-1&&e.get(A.properties.id)!==void 0).map(A=>A.properties.id)),e.sources.hot=[];const m=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(A=>{const N=A.properties.id||A.properties.parent;return l.indexOf(N)===-1});const v=m!==e.sources.cold.length||d.length>0;l.forEach(A=>o(A,"hot")),d.forEach(A=>o(A,"cold"));function o(A,N){const z=e.get(A).internal(i);e.ctx.events.currentModeRender(z,$=>{$.properties.mode=i,e.sources[N].push($)})}v&&e.ctx.map.getSource(Kl.COLD).setData({type:ii.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(Kl.HOT).setData({type:ii.FEATURE_COLLECTION,features:e.sources.hot}),I();function I(){e.isDirty=!1,e.clearChangedIds()}}function as(e){this._features={},this._featureIds=new tc,this._selectedFeatureIds=new tc,this._selectedCoordinates=[],this._changedFeatureIds=new tc,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]};let t;this.render=()=>{t||(t=requestAnimationFrame(()=>{t=null,Q1e.call(this),this._emitSelectionChange&&(this.ctx.events.fire(wa.SELECTION_CHANGE,{features:this.getSelected().map(i=>i.toGeoJSON()),points:this.getSelectedCoordinates().map(i=>({type:ii.FEATURE,properties:{},geometry:{type:ii.POINT,coordinates:i.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(wa.RENDER,{})}))},this.isDirty=!1}as.prototype.createRenderBatch=function(){const e=this.render;let t=0;return this.render=function(){t++},()=>{this.render=e,t>0&&this.render()}};as.prototype.setDirty=function(){return this.isDirty=!0,this};as.prototype.featureCreated=function(e,t={}){if(this._changedFeatureIds.add(e),(t.silent!=null?t.silent:this.ctx.options.suppressAPIEvents)!==!0){const l=this.get(e);this.ctx.events.fire(wa.CREATE,{features:[l.toGeoJSON()]})}return this};as.prototype.featureChanged=function(e,t={}){return this._changedFeatureIds.add(e),(t.silent!=null?t.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(wa.UPDATE,{action:t.action?t.action:vb.CHANGE_COORDINATES,features:[this.get(e).toGeoJSON()]}),this};as.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};as.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};as.prototype.getAllIds=function(){return this._featureIds.values()};as.prototype.add=function(e,t={}){return this._features[e.id]=e,this._featureIds.add(e.id),this.featureCreated(e.id,{silent:t.silent}),this};as.prototype.delete=function(e,t={}){const i=[];return bb(e).forEach(l=>{this._featureIds.has(l)&&(this._featureIds.delete(l),this._selectedFeatureIds.delete(l),t.silent||i.indexOf(this._features[l])===-1&&i.push(this._features[l].toGeoJSON()),delete this._features[l],this.isDirty=!0)}),i.length&&this.ctx.events.fire(wa.DELETE,{features:i}),TZ(this,t),this};as.prototype.get=function(e){return this._features[e]};as.prototype.getAll=function(){return Object.keys(this._features).map(e=>this._features[e])};as.prototype.select=function(e,t={}){return bb(e).forEach(i=>{this._selectedFeatureIds.has(i)||(this._selectedFeatureIds.add(i),this._changedFeatureIds.add(i),t.silent||(this._emitSelectionChange=!0))}),this};as.prototype.deselect=function(e,t={}){return bb(e).forEach(i=>{this._selectedFeatureIds.has(i)&&(this._selectedFeatureIds.delete(i),this._changedFeatureIds.add(i),t.silent||(this._emitSelectionChange=!0))}),TZ(this,t),this};as.prototype.clearSelected=function(e={}){return this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this};as.prototype.setSelected=function(e,t={}){return e=bb(e),this.deselect(this._selectedFeatureIds.values().filter(i=>e.indexOf(i)===-1),{silent:t.silent}),this.select(e.filter(i=>!this._selectedFeatureIds.has(i)),{silent:t.silent}),this};as.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this};as.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};as.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};as.prototype.getSelected=function(){return this.getSelectedIds().map(e=>this.get(e))};as.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(t=>({coordinates:this.get(t.feature_id).getCoordinate(t.coord_path)}))};as.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)};as.prototype.setFeatureProperty=function(e,t,i,l={}){this.get(e).setProperty(t,i),this.featureChanged(e,{silent:l.silent,action:vb.CHANGE_PROPERTIES})};function TZ(e,t={}){const i=e._selectedCoordinates.filter(l=>e._selectedFeatureIds.has(l.feature_id));e._selectedCoordinates.length!==i.length&&!t.silent&&(e._emitSelectionChange=!0),e._selectedCoordinates=i}as.prototype.storeMapConfig=function(){dZ.forEach(e=>{this.ctx.map[e]&&(this._mapInitialConfig[e]=this.ctx.map[e].isEnabled())})};as.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(e=>{this._mapInitialConfig[e]?this.ctx.map[e].enable():this.ctx.map[e].disable()})};as.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]!==void 0?this._mapInitialConfig[e]:!0};const J1e=["mode","feature","mouse"];function ebe(e){const t={};let i=null,l={mode:null,feature:null,mouse:null},d={mode:null,feature:null,mouse:null};function m(){v({mode:null,feature:null,mouse:null}),o()}function v($){d=Object.assign(d,$)}function o(){if(!e.container)return;const $=[],J=[];J1e.forEach(H=>{d[H]!==l[H]&&($.push(`${H}-${l[H]}`),d[H]!==null&&J.push(`${H}-${d[H]}`))}),$.length>0&&e.container.classList.remove(...$),J.length>0&&e.container.classList.add(...J),l=Object.assign(l,d)}function I($,J={}){const H=document.createElement("button");return H.className=`${Ua.CONTROL_BUTTON} ${J.className}`,H.setAttribute("title",J.title),J.container.appendChild(H),H.addEventListener("click",re=>{if(re.preventDefault(),re.stopPropagation(),re.target===i){A(),J.onDeactivate();return}N($),J.onActivate()},!0),H}function A(){i&&(i.classList.remove(Ua.ACTIVE_BUTTON),i=null)}function N($){A();const J=t[$];J&&J&&$!=="trash"&&(J.classList.add(Ua.ACTIVE_BUTTON),i=J)}function F(){const $=e.options.controls,J=document.createElement("div");return J.className=`${Ua.CONTROL_GROUP} ${Ua.CONTROL_BASE}`,$&&($[Ga.POINT]&&(t[Ga.POINT]=I(Ga.POINT,{container:J,className:Ua.CONTROL_BUTTON_POINT,title:`Marker tool ${e.options.keybindings?"(1)":""}`,onActivate:()=>e.events.changeMode(mr.DRAW_POINT),onDeactivate:()=>e.events.trash()})),$[Ga.LINE]&&(t[Ga.LINE]=I(Ga.LINE,{container:J,className:Ua.CONTROL_BUTTON_LINE,title:`LineString tool ${e.options.keybindings?"(2)":""}`,onActivate:()=>e.events.changeMode(mr.DRAW_LINE_STRING),onDeactivate:()=>e.events.trash()})),$[Ga.POLYGON]&&(t[Ga.POLYGON]=I(Ga.POLYGON,{container:J,className:Ua.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${e.options.keybindings?"(3)":""}`,onActivate:()=>e.events.changeMode(mr.DRAW_POLYGON),onDeactivate:()=>e.events.trash()})),$.trash&&(t.trash=I("trash",{container:J,className:Ua.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{e.events.trash()}})),$.combine_features&&(t.combine_features=I("combineFeatures",{container:J,className:Ua.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{e.events.combineFeatures()}})),$.uncombine_features&&(t.uncombine_features=I("uncombineFeatures",{container:J,className:Ua.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{e.events.uncombineFeatures()}}))),J}function z(){Object.keys(t).forEach($=>{const J=t[$];J.parentNode&&J.parentNode.removeChild(J),delete t[$]})}return{setActiveButton:N,queueMapClasses:v,updateMapClasses:o,clearMapClasses:m,addButtons:F,removeButtons:z}}function tbe(e){let t=null,i=null;const l={onRemove(){return e.map.off("load",l.connect),clearInterval(i),l.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,this},connect(){e.map.off("load",l.connect),clearInterval(i),l.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd(d){if(e.map=d,e.events=Y1e(e),e.ui=ebe(e),e.container=d.getContainer(),e.store=new as(e),t=e.ui.addButtons(),e.options.boxSelect){e.boxZoomInitial=d.boxZoom.isEnabled(),d.boxZoom.disable();const m=d.dragPan.isEnabled();d.dragPan.disable(),d.dragPan.enable(),m||d.dragPan.disable()}return d.loaded()?l.connect():(d.on("load",l.connect),i=setInterval(()=>{d.loaded()&&l.connect()},16)),e.events.start(),t},addLayers(){e.map.addSource(Kl.COLD,{data:{type:ii.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(Kl.HOT,{data:{type:ii.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(d=>{e.map.addLayer(d)}),e.store.setDirty(!0),e.store.render()},removeLayers(){e.options.styles.forEach(d=>{e.map.getLayer(d.id)&&e.map.removeLayer(d.id)}),e.map.getSource(Kl.COLD)&&e.map.removeSource(Kl.COLD),e.map.getSource(Kl.HOT)&&e.map.removeSource(Kl.HOT)}};return e.setup=l,l}const OP="#3bb2d0",T0="#fbb03b",pV="#fff",EZ=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],T0,OP],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],T0,OP],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":pV}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],T0,OP]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":pV}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":T0}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":T0}}];function hf(e,t){this.x=e,this.y=t}hf.prototype={clone(){return new hf(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[0]*this.x+e[1]*this.y,i=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=i,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),i=Math.sin(e),l=t*this.x-i*this.y,d=i*this.x+t*this.y;return this.x=l,this.y=d,this},_rotateAround(e,t){const i=Math.cos(e),l=Math.sin(e),d=t.x+i*(this.x-t.x)-l*(this.y-t.y),m=t.y+l*(this.x-t.x)+i*(this.y-t.y);return this.x=d,this.y=m,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:hf};hf.convert=function(e){if(e instanceof hf)return e;if(Array.isArray(e))return new hf(+e[0],+e[1]);if(e.x!==void 0&&e.y!==void 0)return new hf(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};function SL(e,t){const i=t.getBoundingClientRect();return new hf(e.clientX-i.left-(t.clientLeft||0),e.clientY-i.top-(t.clientTop||0))}function Zy(e,t,i,l){return{type:ii.FEATURE,properties:{meta:Jo.VERTEX,parent:e,coord_path:i,active:l?Io.ACTIVE:Io.INACTIVE},geometry:{type:ii.POINT,coordinates:t}}}function nbe(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function SZ(e,t,i){if(e!==null)for(var l,d,m,v,o,I,A,N=0,F=0,z,$=e.type,J=$==="FeatureCollection",H=$==="Feature",re=J?e.features.length:1,Q=0;Q<re;Q++){A=J?e.features[Q].geometry:H?e.geometry:e,z=A?A.type==="GeometryCollection":!1,o=z?A.geometries.length:1;for(var ee=0;ee<o;ee++){var ie=0,ue=0;if(v=z?A.geometries[ee]:A,v!==null){I=v.coordinates;var xe=v.type;switch(N=0,xe){case null:break;case"Point":if(t(I,F,Q,ie,ue)===!1)return!1;F++,ie++;break;case"LineString":case"MultiPoint":for(l=0;l<I.length;l++){if(t(I[l],F,Q,ie,ue)===!1)return!1;F++,xe==="MultiPoint"&&ie++}xe==="LineString"&&ie++;break;case"Polygon":case"MultiLineString":for(l=0;l<I.length;l++){for(d=0;d<I[l].length-N;d++){if(t(I[l][d],F,Q,ie,ue)===!1)return!1;F++}xe==="MultiLineString"&&ie++,xe==="Polygon"&&ue++}xe==="Polygon"&&ie++;break;case"MultiPolygon":for(l=0;l<I.length;l++){for(ue=0,d=0;d<I[l].length;d++){for(m=0;m<I[l][d].length-N;m++){if(t(I[l][d][m],F,Q,ie,ue)===!1)return!1;F++}ue++}ie++}break;case"GeometryCollection":for(l=0;l<v.geometries.length;l++)if(SZ(v.geometries[l],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ibe(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return CZ(e);case"FeatureCollection":return rbe(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return CL(e);default:throw new Error("unknown GeoJSON type")}}function CZ(e){const t={type:"Feature"};return Object.keys(e).forEach(i=>{switch(i){case"type":case"properties":case"geometry":return;default:t[i]=e[i]}}),t.properties=IZ(e.properties),e.geometry==null?t.geometry=null:t.geometry=CL(e.geometry),t}function IZ(e){const t={};return e&&Object.keys(e).forEach(i=>{const l=e[i];typeof l=="object"?l===null?t[i]=null:Array.isArray(l)?t[i]=l.map(d=>d):t[i]=IZ(l):t[i]=l}),t}function rbe(e){const t={type:"FeatureCollection"};return Object.keys(e).forEach(i=>{switch(i){case"type":case"features":return;default:t[i]=e[i]}}),t.features=e.features.map(i=>CZ(i)),t}function CL(e){const t={type:e.type};return e.bbox&&(t.bbox=e.bbox),e.type==="GeometryCollection"?(t.geometries=e.geometries.map(i=>CL(i)),t):(t.coordinates=AZ(e.coordinates),t)}function AZ(e){const t=e;return typeof t[0]!="object"?t.slice():t.map(i=>AZ(i))}function mV(e,t={}){return PZ(e,"mercator",t)}function sbe(e,t={}){return PZ(e,"wgs84",t)}function PZ(e,t,i={}){i=i||{};var l=i.mutate;if(!e)throw new Error("geojson is required");return Array.isArray(e)&&nbe(e[0])?e=t==="mercator"?gV(e):_V(e):(l!==!0&&(e=ibe(e)),SZ(e,function(d){var m=t==="mercator"?gV(d):_V(d);d[0]=m[0],d[1]=m[1]})),e}function gV(e){var t=Math.PI/180,i=6378137,l=20037508342789244e-9,d=Math.abs(e[0])<=180?e[0]:e[0]-obe(e[0])*360,m=[i*d*t,i*Math.log(Math.tan(Math.PI*.25+.5*e[1]*t))];return m[0]>l&&(m[0]=l),m[0]<-l&&(m[0]=-l),m[1]>l&&(m[1]=l),m[1]<-l&&(m[1]=-l),m}function _V(e){var t=180/Math.PI,i=6378137;return[e[0]*t/i,(Math.PI*.5-2*Math.atan(Math.exp(-e[1]/i)))*t]}function obe(e){return e<0?-1:e>0?1:0}function RZ(e,t,i){const l=t.geometry.coordinates,d=i.geometry.coordinates;if(l[1]>WM||l[1]<HM||d[1]>WM||d[1]<HM)return null;const m=mV(l),v=mV(d),o=F=>Number(F.toFixed(8)),I=(F,z)=>(F+z)/2,A=sbe([I(m[0],v[0]),I(m[1],v[1])]),N=[o(A[0]),o(A[1])];return{type:ii.FEATURE,properties:{meta:Jo.MIDPOINT,parent:e,lng:N[0],lat:N[1],coord_path:i.properties.coord_path},geometry:{type:ii.POINT,coordinates:N}}}function dI(e,t={},i=null){const{type:l,coordinates:d}=e.geometry,m=e.properties&&e.properties.id;let v=[];l===ii.POINT?v.push(Zy(m,d,i,I(i))):l===ii.POLYGON?d.forEach((N,F)=>{o(N,i!==null?`${i}.${F}`:String(F))}):l===ii.LINE_STRING?o(d,i):l.indexOf(ii.MULTI_PREFIX)===0&&A();function o(N,F){let z="",$=null;N.forEach((J,H)=>{const re=F!=null?`${F}.${H}`:String(H),Q=Zy(m,J,re,I(re));if(t.midpoints&&$){const ie=RZ(m,$,Q);ie&&v.push(ie)}$=Q;const ee=JSON.stringify(J);z!==ee&&v.push(Q),H===0&&(z=ee)})}function I(N){return t.selectedPaths?t.selectedPaths.indexOf(N)!==-1:!1}function A(){const N=l.replace(ii.MULTI_PREFIX,"");d.forEach((F,z)=>{const $={type:ii.FEATURE,properties:e.properties,geometry:{type:N,coordinates:F}};v=v.concat(dI($,t,z))})}return v}const su={enable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.doubleClickZoom.disable()},0)}},{LAT_MIN:tE,LAT_MAX:nE,LAT_RENDERED_MIN:yV,LAT_RENDERED_MAX:vV,LNG_MIN:xV,LNG_MAX:bV}=hZ;function abe(e){const t={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[e.geometry.type],i=[e.geometry.coordinates].flat(t),l=i.map(o=>o[0]),d=i.map(o=>o[1]),m=o=>Math.min.apply(null,o),v=o=>Math.max.apply(null,o);return[m(l),m(d),v(l),v(d)]}function IL(e,t){let i=tE,l=nE,d=tE,m=nE,v=bV,o=xV;e.forEach(A=>{const N=abe(A),F=N[1],z=N[3],$=N[0],J=N[2];F>i&&(i=F),z<l&&(l=z),z>d&&(d=z),F<m&&(m=F),$<v&&(v=$),J>o&&(o=J)});const I=t;return i+I.lat>vV&&(I.lat=vV-i),d+I.lat>nE&&(I.lat=nE-d),l+I.lat<yV&&(I.lat=yV-l),m+I.lat<tE&&(I.lat=tE-m),v+I.lng<=xV&&(I.lng+=Math.ceil(Math.abs(I.lng)/360)*360),o+I.lng>=bV&&(I.lng-=Math.ceil(Math.abs(I.lng)/360)*360),I}function AL(e,t){const i=IL(e.map(l=>l.toGeoJSON()),t);e.forEach(l=>{const d=l.getCoordinates(),m=A=>{const N={lng:A[0]+i.lng,lat:A[1]+i.lat};return[N.lng,N.lat]},v=A=>A.map(N=>m(N)),o=A=>A.map(N=>v(N));let I;l.type===ii.POINT?I=m(d):l.type===ii.LINE_STRING||l.type===ii.MULTI_POINT?I=d.map(m):l.type===ii.POLYGON||l.type===ii.MULTI_LINE_STRING?I=d.map(v):l.type===ii.MULTI_POLYGON&&(I=d.map(o)),l.incomingCoords(I)})}const Yr={};Yr.onSetup=function(e){const t={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(t.initiallySelectedFeatureIds.filter(i=>this.getFeature(i)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),t};Yr.fireUpdate=function(){this.fire(wa.UPDATE,{action:vb.MOVE,features:this.getSelected().map(e=>e.toGeoJSON())})};Yr.fireActionable=function(){const e=this.getSelected(),t=e.filter(m=>this.isInstanceOf("MultiFeature",m));let i=!1;if(e.length>1){i=!0;const m=e[0].type.replace("Multi","");e.forEach(v=>{v.type.replace("Multi","")!==m&&(i=!1)})}const l=t.length>0,d=e.length>0;this.setActionableState({combineFeatures:i,uncombineFeatures:l,trash:d})};Yr.getUniqueIds=function(e){return e.length?e.map(i=>i.properties.id).filter(i=>i!==void 0).reduce((i,l)=>(i.add(l),i),new tc).values():[]};Yr.stopExtendedInteractions=function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),(e.canDragMove||e.canBoxSelect)&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1};Yr.onStop=function(){su.enable(this)};Yr.onMouseMove=function(e,t){return bL(t)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0};Yr.onMouseOut=function(e){return e.dragMoving?this.fireUpdate():!0};Yr.onTap=Yr.onClick=function(e,t){if(oI(t))return this.clickAnywhere(e,t);if(sI(Jo.VERTEX)(t))return this.clickOnVertex(e,t);if(bL(t))return this.clickOnFeature(e,t)};Yr.clickAnywhere=function(e){const t=this.getSelectedIds();t.length&&(this.clearSelectedFeatures(),t.forEach(i=>this.doRender(i))),su.enable(this),this.stopExtendedInteractions(e)};Yr.clickOnVertex=function(e,t){this.changeMode(mr.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:ws.MOVE})};Yr.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};Yr.clickOnFeature=function(e,t){su.disable(this),this.stopExtendedInteractions(e);const i=KS(t),l=this.getSelectedIds(),d=t.featureTarget.properties.id,m=this.isSelected(d);if(!i&&m&&this.getFeature(d).type!==ii.POINT)return this.changeMode(mr.DIRECT_SELECT,{featureId:d});m&&i?(this.deselect(d),this.updateUIClasses({mouse:ws.POINTER}),l.length===1&&su.enable(this)):!m&&i?(this.select(d),this.updateUIClasses({mouse:ws.MOVE})):!m&&!i&&(l.forEach(v=>this.doRender(v)),this.setSelected(d),this.updateUIClasses({mouse:ws.MOVE})),this.doRender(d)};Yr.onMouseDown=function(e,t){if(e.initialDragPanState=this.map.dragPan.isEnabled(),Hm(t))return this.startOnActiveFeature(e,t);if(this.drawConfig.boxSelect&&fZ(t))return this.startBoxSelect(e,t)};Yr.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=SL(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0};Yr.onTouchStart=function(e,t){if(Hm(t))return this.startOnActiveFeature(e,t)};Yr.onDrag=function(e,t){if(e.canDragMove)return this.dragMove(e,t);if(this.drawConfig.boxSelect&&e.canBoxSelect)return this.whileBoxSelect(e,t)};Yr.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:ws.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(Ua.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));const i=SL(t.originalEvent,this.map.getContainer()),l=Math.min(e.boxSelectStartLocation.x,i.x),d=Math.max(e.boxSelectStartLocation.x,i.x),m=Math.min(e.boxSelectStartLocation.y,i.y),v=Math.max(e.boxSelectStartLocation.y,i.y),o=`translate(${l}px, ${m}px)`;e.boxSelectElement.style.transform=o,e.boxSelectElement.style.WebkitTransform=o,e.boxSelectElement.style.width=`${d-l}px`,e.boxSelectElement.style.height=`${v-m}px`};Yr.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();const i={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};AL(this.getSelected(),i),e.dragMoveLocation=t.lngLat};Yr.onTouchEnd=Yr.onMouseUp=function(e,t){if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){const i=[e.boxSelectStartLocation,SL(t.originalEvent,this.map.getContainer())],l=this.featuresAt(null,i,"click"),d=this.getUniqueIds(l).filter(m=>!this.isSelected(m));d.length&&(this.select(d),d.forEach(m=>this.doRender(m)),this.updateUIClasses({mouse:ws.MOVE}))}this.stopExtendedInteractions(e)};Yr.toDisplayFeatures=function(e,t,i){t.properties.active=this.isSelected(t.properties.id)?Io.ACTIVE:Io.INACTIVE,i(t),this.fireActionable(),!(t.properties.active!==Io.ACTIVE||t.geometry.type===ii.POINT)&&dI(t).forEach(i)};Yr.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()};Yr.onCombineFeatures=function(){const e=this.getSelected();if(e.length===0||e.length<2)return;const t=[],i=[],l=e[0].type.replace("Multi","");for(let d=0;d<e.length;d++){const m=e[d];if(m.type.replace("Multi","")!==l)return;m.type.includes("Multi")?m.getCoordinates().forEach(v=>{t.push(v)}):t.push(m.getCoordinates()),i.push(m.toGeoJSON())}if(i.length>1){const d=this.newFeature({type:ii.FEATURE,properties:i[0].properties,geometry:{type:`Multi${l}`,coordinates:t}});this.addFeature(d),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([d.id]),this.fire(wa.COMBINE_FEATURES,{createdFeatures:[d.toGeoJSON()],deletedFeatures:i})}this.fireActionable()};Yr.onUncombineFeatures=function(){const e=this.getSelected();if(e.length===0)return;const t=[],i=[];for(let l=0;l<e.length;l++){const d=e[l];this.isInstanceOf("MultiFeature",d)&&(d.getFeatures().forEach(m=>{this.addFeature(m),m.properties=d.properties,t.push(m.toGeoJSON()),this.select([m.id])}),this.deleteFeature(d.id,{silent:!0}),i.push(d.toGeoJSON()))}t.length>1&&this.fire(wa.UNCOMBINE_FEATURES,{createdFeatures:t,deletedFeatures:i}),this.fireActionable()};const MZ=sI(Jo.VERTEX),kZ=sI(Jo.MIDPOINT),Qr={};Qr.fireUpdate=function(){this.fire(wa.UPDATE,{action:vb.CHANGE_COORDINATES,features:this.getSelected().map(e=>e.toGeoJSON())})};Qr.fireActionable=function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})};Qr.startDragging=function(e,t){e.initialDragPanState==null&&(e.initialDragPanState=this.map.dragPan.isEnabled()),this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};Qr.stopDragging=function(e){e.canDragMove&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.initialDragPanState=null,e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null};Qr.onVertex=function(e,t){this.startDragging(e,t);const i=t.featureTarget.properties,l=e.selectedCoordPaths.indexOf(i.coord_path);!KS(t)&&l===-1?e.selectedCoordPaths=[i.coord_path]:KS(t)&&l===-1&&e.selectedCoordPaths.push(i.coord_path);const d=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(d)};Qr.onMidpoint=function(e,t){this.startDragging(e,t);const i=t.featureTarget.properties;e.feature.addCoordinate(i.coord_path,i.lng,i.lat),this.fireUpdate(),e.selectedCoordPaths=[i.coord_path]};Qr.pathsToCoordinates=function(e,t){return t.map(i=>({feature_id:e,coord_path:i}))};Qr.onFeature=function(e,t){e.selectedCoordPaths.length===0?this.startDragging(e,t):this.stopDragging(e)};Qr.dragFeature=function(e,t,i){AL(this.getSelected(),i),e.dragMoveLocation=t.lngLat};Qr.dragVertex=function(e,t,i){const l=e.selectedCoordPaths.map(v=>e.feature.getCoordinate(v)),d=l.map(v=>({type:ii.FEATURE,properties:{},geometry:{type:ii.POINT,coordinates:v}})),m=IL(d,i);for(let v=0;v<l.length;v++){const o=l[v];e.feature.updateCoordinate(e.selectedCoordPaths[v],o[0]+m.lng,o[1]+m.lat)}};Qr.clickNoTarget=function(){this.changeMode(mr.SIMPLE_SELECT)};Qr.clickInactive=function(){this.changeMode(mr.SIMPLE_SELECT)};Qr.clickActiveFeature=function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()};Qr.onSetup=function(e){const t=e.featureId,i=this.getFeature(t);if(!i)throw new Error("You must provide a featureId to enter direct_select mode");if(i.type===ii.POINT)throw new TypeError("direct_select mode doesn't handle point features");const l={featureId:t,feature:i,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,l.selectedCoordPaths)),this.setSelected(t),su.disable(this),this.setActionableState({trash:!0}),l};Qr.onStop=function(){su.enable(this),this.clearSelectedCoordinates()};Qr.toDisplayFeatures=function(e,t,i){e.featureId===t.properties.id?(t.properties.active=Io.ACTIVE,i(t),dI(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(i)):(t.properties.active=Io.INACTIVE,i(t)),this.fireActionable(e)};Qr.onTrash=function(e){e.selectedCoordPaths.sort((t,i)=>i.localeCompare(t,"en",{numeric:!0})).forEach(t=>e.feature.removeCoordinate(t)),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(mr.SIMPLE_SELECT,{}))};Qr.onMouseMove=function(e,t){const i=Hm(t),l=MZ(t),d=kZ(t),m=e.selectedCoordPaths.length===0;return i&&m?this.updateUIClasses({mouse:ws.MOVE}):l&&!m?this.updateUIClasses({mouse:ws.MOVE}):this.updateUIClasses({mouse:ws.NONE}),(l||i||d)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0};Qr.onMouseOut=function(e){return e.dragMoving&&this.fireUpdate(),!0};Qr.onTouchStart=Qr.onMouseDown=function(e,t){if(MZ(t))return this.onVertex(e,t);if(Hm(t))return this.onFeature(e,t);if(kZ(t))return this.onMidpoint(e,t)};Qr.onDrag=function(e,t){if(e.canDragMove!==!0)return;e.dragMoving=!0,t.originalEvent.stopPropagation();const i={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,i):this.dragFeature(e,t,i),e.dragMoveLocation=t.lngLat};Qr.onClick=function(e,t){if(oI(t))return this.clickNoTarget(e,t);if(Hm(t))return this.clickActiveFeature(e,t);if(xL(t))return this.clickInactive(e,t);this.stopDragging(e)};Qr.onTap=function(e,t){if(oI(t))return this.clickNoTarget(e,t);if(Hm(t))return this.clickActiveFeature(e,t);if(xL(t))return this.clickInactive(e,t)};Qr.onTouchEnd=Qr.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};const Yu={};Yu.onSetup=function(){const e=this.newFeature({type:ii.FEATURE,properties:{},geometry:{type:ii.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:ws.ADD}),this.activateUIButton(Ga.POINT),this.setActionableState({trash:!0}),{point:e}};Yu.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(mr.SIMPLE_SELECT)};Yu.onTap=Yu.onClick=function(e,t){this.updateUIClasses({mouse:ws.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.fire(wa.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(mr.SIMPLE_SELECT,{featureIds:[e.point.id]})};Yu.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})};Yu.toDisplayFeatures=function(e,t,i){const l=t.properties.id===e.point.id;if(t.properties.active=l?Io.ACTIVE:Io.INACTIVE,!l)return i(t)};Yu.onTrash=Yu.stopDrawingAndRemove;Yu.onKeyUp=function(e,t){if(aI(t)||lI(t))return this.stopDrawingAndRemove(e,t)};function XS(e,t){return e.lngLat?e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]:!1}const ou={};ou.onSetup=function(){const e=this.newFeature({type:ii.FEATURE,properties:{},geometry:{type:ii.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),su.disable(this),this.updateUIClasses({mouse:ws.ADD}),this.activateUIButton(Ga.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}};ou.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&XS(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(mr.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:ws.ADD}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat)};ou.clickOnVertex=function(e){return this.changeMode(mr.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};ou.onMouseMove=function(e,t){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),xb(t)&&this.updateUIClasses({mouse:ws.POINTER})};ou.onTap=ou.onClick=function(e,t){return xb(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)};ou.onKeyUp=function(e,t){aI(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(mr.SIMPLE_SELECT)):lI(t)&&this.changeMode(mr.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};ou.onStop=function(e){this.updateUIClasses({mouse:ws.NONE}),su.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.fire(wa.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(mr.SIMPLE_SELECT,{},{silent:!0})))};ou.toDisplayFeatures=function(e,t,i){const l=t.properties.id===e.polygon.id;if(t.properties.active=l?Io.ACTIVE:Io.INACTIVE,!l)return i(t);if(t.geometry.coordinates.length===0)return;const d=t.geometry.coordinates[0].length;if(!(d<3)){if(t.properties.meta=Jo.FEATURE,i(Zy(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),d>3){const m=t.geometry.coordinates[0].length-3;i(Zy(e.polygon.id,t.geometry.coordinates[0][m],`0.${m}`,!1))}if(d<=4){const m=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(i({type:ii.FEATURE,properties:t.properties,geometry:{coordinates:m,type:ii.LINE_STRING}}),d===3)return}return i(t)}};ou.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(mr.SIMPLE_SELECT)};const au={};au.onSetup=function(e){e=e||{};const t=e.featureId;let i,l,d="forward";if(t){if(i=this.getFeature(t),!i)throw new Error("Could not find a feature with the provided featureId");let m=e.from;if(m&&m.type==="Feature"&&m.geometry&&m.geometry.type==="Point"&&(m=m.geometry),m&&m.type==="Point"&&m.coordinates&&m.coordinates.length===2&&(m=m.coordinates),!m||!Array.isArray(m))throw new Error("Please use the `from` property to indicate which point to continue the line from");const v=i.coordinates.length-1;if(i.coordinates[v][0]===m[0]&&i.coordinates[v][1]===m[1])l=v+1,i.addCoordinate(l,...i.coordinates[v]);else if(i.coordinates[0][0]===m[0]&&i.coordinates[0][1]===m[1])d="backwards",l=0,i.addCoordinate(l,...i.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else i=this.newFeature({type:ii.FEATURE,properties:{},geometry:{type:ii.LINE_STRING,coordinates:[]}}),l=0,this.addFeature(i);return this.clearSelectedFeatures(),su.disable(this),this.updateUIClasses({mouse:ws.ADD}),this.activateUIButton(Ga.LINE),this.setActionableState({trash:!0}),{line:i,currentVertexPosition:l,direction:d}};au.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&XS(t,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&XS(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(mr.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:ws.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)};au.clickOnVertex=function(e){return this.changeMode(mr.SIMPLE_SELECT,{featureIds:[e.line.id]})};au.onMouseMove=function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),xb(t)&&this.updateUIClasses({mouse:ws.POINTER})};au.onTap=au.onClick=function(e,t){if(xb(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)};au.onKeyUp=function(e,t){lI(t)?this.changeMode(mr.SIMPLE_SELECT,{featureIds:[e.line.id]}):aI(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(mr.SIMPLE_SELECT))};au.onStop=function(e){su.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.fire(wa.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(mr.SIMPLE_SELECT,{},{silent:!0})))};au.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(mr.SIMPLE_SELECT)};au.toDisplayFeatures=function(e,t,i){const l=t.properties.id===e.line.id;if(t.properties.active=l?Io.ACTIVE:Io.INACTIVE,!l)return i(t);t.geometry.coordinates.length<2||(t.properties.meta=Jo.FEATURE,i(Zy(e.line.id,t.geometry.coordinates[e.direction==="forward"?t.geometry.coordinates.length-2:1],`${e.direction==="forward"?t.geometry.coordinates.length-2:1}`,!1)),i(t))};const DZ={simple_select:Yr,direct_select:Qr,draw_point:Yu,draw_polygon:ou,draw_line_string:au},lbe={defaultMode:mr.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:EZ,modes:DZ,controls:{},userProperties:!1,suppressAPIEvents:!0},cbe={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},ube={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function wV(e,t){return e.map(i=>i.source?i:Object.assign({},i,{id:`${i.id}.${t}`,source:t==="hot"?Kl.HOT:Kl.COLD}))}function dbe(e={}){let t=Object.assign({},e);return e.controls||(t.controls={}),e.displayControlsDefault===!1?t.controls=Object.assign({},ube,e.controls):t.controls=Object.assign({},cbe,e.controls),t=Object.assign({},lbe,t),t.styles=wV(t.styles,"cold").concat(wV(t.styles,"hot")),t}var hbe=function e(t,i){if(t===i)return!0;if(t&&i&&typeof t=="object"&&typeof i=="object"){if(t.constructor!==i.constructor)return!1;var l,d,m;if(Array.isArray(t)){if(l=t.length,l!=i.length)return!1;for(d=l;d--!==0;)if(!e(t[d],i[d]))return!1;return!0}if(t.constructor===RegExp)return t.source===i.source&&t.flags===i.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===i.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===i.toString();if(m=Object.keys(t),l=m.length,l!==Object.keys(i).length)return!1;for(d=l;d--!==0;)if(!Object.prototype.hasOwnProperty.call(i,m[d]))return!1;for(d=l;d--!==0;){var v=m[d];if(!e(t[v],i[v]))return!1}return!0}return t!==t&&i!==i};const TV=H1(hbe);var fbe=mbe,pbe={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function mbe(e){if(!e||!e.type)return null;var t=pbe[e.type];if(!t)return null;if(t==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]};if(t==="feature")return{type:"FeatureCollection",features:[e]};if(t==="featurecollection")return e}const gbe=H1(fbe);function NZ(e,t){return e.length!==t.length?!1:JSON.stringify(e.map(i=>i).sort())===JSON.stringify(t.map(i=>i).sort())}const _be={Polygon:El,LineString:nd,Point:Jf,MultiPolygon:xa,MultiLineString:xa,MultiPoint:xa};function ybe(e,t){t.modes=mr;const i=e.options.suppressAPIEvents!==void 0?!!e.options.suppressAPIEvents:!0;return t.getFeatureIdsAt=function(l){return qy.click({point:l},null,e).map(m=>m.properties.id)},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:ii.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(l=>e.store.get(l)).map(l=>l.toGeoJSON())}},t.getSelectedPoints=function(){return{type:ii.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(l=>({type:ii.FEATURE,properties:{},geometry:{type:ii.POINT,coordinates:l.coordinates}}))}},t.set=function(l){if(l.type===void 0||l.type!==ii.FEATURE_COLLECTION||!Array.isArray(l.features))throw new Error("Invalid FeatureCollection");const d=e.store.createRenderBatch();let m=e.store.getAllIds().slice();const v=t.add(l),o=new tc(v);return m=m.filter(I=>!o.has(I)),m.length&&t.delete(m),d(),v},t.add=function(l){const m=JSON.parse(JSON.stringify(gbe(l))).features.map(v=>{if(v.id=v.id||EL(),v.geometry===null)throw new Error("Invalid geometry: null");if(e.store.get(v.id)===void 0||e.store.get(v.id).type!==v.geometry.type){const o=_be[v.geometry.type];if(o===void 0)throw new Error(`Invalid geometry type: ${v.geometry.type}.`);const I=new o(e,v);e.store.add(I,{silent:i})}else{const o=e.store.get(v.id),I=o.properties;o.properties=v.properties,TV(I,v.properties)||e.store.featureChanged(o.id,{silent:i}),TV(o.getCoordinates(),v.geometry.coordinates)||o.incomingCoords(v.geometry.coordinates)}return v.id});return e.store.render(),m},t.get=function(l){const d=e.store.get(l);if(d)return d.toGeoJSON()},t.getAll=function(){return{type:ii.FEATURE_COLLECTION,features:e.store.getAll().map(l=>l.toGeoJSON())}},t.delete=function(l){return e.store.delete(l,{silent:i}),t.getMode()===mr.DIRECT_SELECT&&!e.store.getSelectedIds().length?e.events.changeMode(mr.SIMPLE_SELECT,void 0,{silent:i}):e.store.render(),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:i}),t.getMode()===mr.DIRECT_SELECT?e.events.changeMode(mr.SIMPLE_SELECT,void 0,{silent:i}):e.store.render(),t},t.changeMode=function(l,d={}){return l===mr.SIMPLE_SELECT&&t.getMode()===mr.SIMPLE_SELECT?(NZ(d.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(d.featureIds,{silent:i}),e.store.render()),t):(l===mr.DIRECT_SELECT&&t.getMode()===mr.DIRECT_SELECT&&d.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(l,d,{silent:i}),t)},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:i}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:i}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:i}),t},t.setFeatureProperty=function(l,d,m){return e.store.setFeatureProperty(l,d,m,{silent:i}),t},t}const vbe=Object.freeze(Object.defineProperty({__proto__:null,CommonSelectors:O1e,ModeHandler:QM,StringSet:tc,constrainFeatureMovement:IL,createMidPoint:RZ,createSupplementaryPoints:dI,createVertex:Zy,doubleClickZoom:su,euclideanDistance:TL,featuresAt:qy,getFeatureAtAndSetCursors:DE,isClick:XM,isEventAtCoordinates:XS,isTap:YM,mapEventToBoundingBox:xZ,moveFeatures:AL,sortFeatures:vZ,stringSetsAreEqual:NZ,theme:EZ,toDenseArray:bb},Symbol.toStringTag,{value:"Module"})),xbe=function(e,t){e=dbe(e);const i={options:e};t=ybe(i,t),i.api=t;const l=tbe(i);return t.onAdd=l.onAdd,t.onRemove=l.onRemove,t.types=Ga,t.options=e,t};function hI(e){xbe(e,this)}hI.modes=DZ;hI.constants=hZ;hI.lib=vbe;function bbe({onZoneChange:e,initialZone:t,height:i="400px",showCurrentLocation:l=!0}){const d=q.useRef(null),m=q.useRef(null),v=q.useRef(null),o=q.useRef(null),[I,A]=q.useState(!0),[N,F]=q.useState(!!t),[z,$]=q.useState(null),[J,H]=q.useState(!1),re=()=>{navigator.geolocation&&(H(!0),navigator.geolocation.getCurrentPosition(ee=>{var xe;const{latitude:ie,longitude:ue}=ee.coords;if($({lat:ie,lng:ue}),o.current)o.current.setLngLat([ue,ie]);else if(m.current){const Oe=document.createElement("div");Oe.className="current-location-marker",Oe.innerHTML=`
            <div style="
              width: 20px;
              height: 20px;
              background: hsl(24, 95%, 53%);
              border: 3px solid white;
              border-radius: 50%;
              box-shadow: 0 2px 8px rgba(0,0,0,0.3);
              position: relative;
            ">
              <div style="
                position: absolute;
                width: 40px;
                height: 40px;
                background: hsla(24, 95%, 53%, 0.2);
                border-radius: 50%;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                animation: pulse 2s infinite;
              "></div>
            </div>
          `,o.current=new Mr.Marker(Oe).setLngLat([ue,ie]).setPopup(new Mr.Popup({offset:25}).setText("Your current location")).addTo(m.current)}(xe=m.current)==null||xe.flyTo({center:[ue,ie],zoom:13,duration:1500}),H(!1)},ee=>{console.error("Location error:",ee),H(!1)},{enableHighAccuracy:!0,timeout:1e4}))};q.useEffect(()=>{if(!d.current)return;Mr.accessToken=jf,m.current=new Mr.Map({container:d.current,style:"mapbox://styles/mapbox/streets-v12",center:[78.4867,17.385],zoom:10,attributionControl:!1}),v.current=new hI({displayControlsDefault:!1,controls:{polygon:!0,trash:!0},defaultMode:"simple_select",styles:[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#f97316","fill-outline-color":"#f97316","fill-opacity":.2}},{id:"gl-draw-polygon-stroke",type:"line",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#f97316","line-width":3}},{id:"gl-draw-polygon-and-line-vertex-halo-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#f97316"}}]}),m.current.addControl(v.current,"top-left"),m.current.addControl(new Mr.NavigationControl,"bottom-right"),m.current.on("load",()=>{var ie;if(A(!1),t&&v.current){const ue={type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:t.coordinates}};v.current.add(ue),F(!0);const xe=t.coordinates[0],Oe=new Mr.LngLatBounds;xe.forEach(ze=>Oe.extend([ze[0],ze[1]])),(ie=m.current)==null||ie.fitBounds(Oe,{padding:50})}}),m.current.on("draw.create",ee),m.current.on("draw.update",ee),m.current.on("draw.delete",()=>{F(!1),e(null)});function ee(){if(!v.current)return;const ie=v.current.getAll();if(ie.features.length>0){const ue=ie.features.filter(ze=>ze.geometry.type==="Polygon");if(ue.length>1)for(let ze=0;ze<ue.length-1;ze++)v.current.delete(ue[ze].id);const xe=ue[ue.length-1],Oe=Epe(xe);F(!!Oe),e(Oe)}else F(!1),e(null)}return l&&re(),()=>{var ie,ue;(ie=o.current)==null||ie.remove(),(ue=m.current)==null||ue.remove()}},[]);const Q=()=>{v.current&&(v.current.deleteAll(),F(!1),e(null))};return E.jsxs("div",{className:"space-y-3",children:[E.jsx("style",{children:`
        @keyframes pulse {
          0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
          100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
        }
      `}),E.jsxs("div",{className:"relative rounded-xl overflow-hidden",style:{height:i},children:[E.jsx("div",{ref:d,className:"absolute inset-0"}),I&&E.jsx("div",{className:"absolute inset-0 bg-secondary flex items-center justify-center",children:E.jsx(kr,{className:"w-6 h-6 animate-spin text-primary"})}),l&&E.jsx(wn,{size:"sm",variant:"secondary",className:"absolute bottom-3 left-3 shadow-lg",onClick:re,disabled:J,children:J?E.jsx(kr,{className:"w-4 h-4 animate-spin"}):E.jsxs(E.Fragment,{children:[E.jsx(eD,{className:"w-4 h-4 mr-1"}),"My Location"]})}),E.jsx("div",{className:"absolute top-3 right-3 bg-card/90 backdrop-blur-sm rounded-lg px-3 py-2 max-w-[200px]",children:E.jsx("p",{className:"text-xs text-muted-foreground",children:N?"Zone drawn! Click on the zone to edit or delete.":"Click the polygon tool (top-left) to draw a service zone."})}),z&&E.jsx("div",{className:"absolute top-3 left-14 bg-card/90 backdrop-blur-sm rounded-lg px-3 py-2",children:E.jsxs("p",{className:"text-xs text-primary font-medium flex items-center gap-1",children:[E.jsx("span",{className:"w-2 h-2 bg-primary rounded-full animate-pulse"}),"Live Location"]})})]}),N&&E.jsxs(wn,{variant:"outline",className:"w-full text-destructive border-destructive",onClick:Q,children:[E.jsx(kf,{className:"w-4 h-4 mr-2"})," Clear Zone"]})]})}const wbe=[{value:"user",label:"User"},{value:"amma",label:"Amma"},{value:"admin",label:"Admin"},{value:"franchise_admin",label:"Franchise Admin"},{value:"super_admin",label:"Super Admin"}];function Tbe(){const{user:e,signOut:t}=Sa(),i=Qa(),{isAuthorized:l,isLoading:d}=vL(["super_admin","admin"]),{franchises:m,loading:v}=S9(),{users:o,refetch:I}=V0e(),{kitchens:A}=mL(),[N,F]=q.useState("franchises"),[z,$]=q.useState(!1),J=async()=>{if(confirm('CRITICAL WARNING: This will delete ALL users, franchises, kitchens, dishes, and orders. Only the Super Admin account will remain. This action cannot be undone. Type "DELETE" to confirm.')&&prompt('Type "DELETE" to confirm database reset:')==="DELETE"){$(!0);try{await Ape(),Mn.success("Database has been reset successfully"),I(),window.location.reload()}catch{Mn.error("Failed to reset database")}finally{$(!1)}}},[H,re]=q.useState(!1),[Q,ee]=q.useState(!1),[ie,ue]=q.useState(!1),[xe,Oe]=q.useState(null),[ze,Be]=q.useState("user"),[ot,Et]=q.useState(!1),[Zt,at]=q.useState(!1),[zt,Kt]=q.useState(!1),[nn,Wt]=q.useState({name:"",description:"",adminId:"",zone:null}),[Ke,et]=q.useState({email:"",password:"",name:"",phone:""}),Ct=o.filter(Rt=>Rt.role==="user"||Rt.role==="admin"||Rt.role==="franchise_admin"),en=A.filter(Rt=>!Rt.isApproved),Bn=async()=>{if(!Ke.email||!Ke.password||!Ke.name||!Ke.phone){Mn.error("Please fill all fields");return}if(Ke.password.length<6){Mn.error("Password must be at least 6 characters");return}at(!0);try{await G0e(Ke.email,Ke.password,Ke.name,Ke.phone),Mn.success("Franchise Admin created successfully!"),ee(!1),et({email:"",password:"",name:"",phone:""}),I()}catch(Rt){Mn.error(Rt.message||"Failed to create admin")}finally{at(!1)}},En=async Rt=>{try{await gL(Rt),Mn.success("Kitchen approved!")}catch{Mn.error("Failed to approve kitchen")}},gn=async Rt=>{if(confirm("Are you sure you want to reject this kitchen?"))try{await _L(Rt),Mn.success("Kitchen rejected")}catch{Mn.error("Failed to reject kitchen")}},qt=async()=>{if(!xe)return;if(xe.currentRole==="amma"&&ze!=="amma"||xe.currentRole==="franchise_admin"&&ze!=="franchise_admin"){const pn=xe.currentRole==="amma"?"kitchens and dishes":"franchise assignment";if(!confirm(`Warning: Changing this role will delete all ${pn} for this user. Continue?`))return}Kt(!0);try{await D0e(xe.id,ze,xe.currentRole),Mn.success(`Role updated to ${ze.replace("_"," ")}`),ue(!1),Oe(null),I()}catch{Mn.error("Failed to update role")}finally{Kt(!1)}},Ji=(Rt,pn,Fn)=>{Oe({id:Rt,name:pn,currentRole:Fn}),Be(Fn),ue(!0)},Sr=async()=>{if(!e)return;if(!nn.name||!nn.adminId||!nn.zone){Mn.error("Please fill all fields and draw a zone");return}const Rt=o.find(pn=>pn.id===nn.adminId);if(!Rt){Mn.error("Invalid admin selected");return}Et(!0);try{await U0e({name:nn.name,description:nn.description,adminId:nn.adminId,adminName:Rt.name,adminEmail:Rt.email,zone:nn.zone,isActive:!0,createdAt:Date.now(),createdBy:e.id}),Mn.success("Franchise created successfully!"),re(!1),Wt({name:"",description:"",adminId:"",zone:null})}catch{Mn.error("Failed to create franchise")}finally{Et(!1)}},_n=async(Rt,pn)=>{if(confirm("Are you sure you want to delete this franchise?"))try{await $0e(Rt,pn),Mn.success("Franchise deleted")}catch{Mn.error("Failed to delete franchise")}};return d||!l?E.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:E.jsx(kr,{className:"w-8 h-8 animate-spin text-primary"})}):E.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[E.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:[E.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[E.jsxs("div",{children:[E.jsx("h1",{className:"font-semibold text-foreground",children:"Super Admin"}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Franchise Management"})]}),E.jsxs("div",{className:"flex items-center gap-2",children:[en.length>0&&E.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-gold text-foreground text-xs",children:[E.jsx(Zc,{className:"w-3 h-3"}),en.length," pending"]}),E.jsx(wn,{variant:"ghost",size:"sm",onClick:async()=>{await t(),i("/auth")},className:"text-destructive",children:"Logout"})]})]}),E.jsx("div",{className:"flex bg-secondary mx-4 rounded-xl p-1 mb-4",children:["franchises","users","kitchens","system"].map(Rt=>E.jsx("button",{onClick:()=>F(Rt),className:`flex-1 py-2 rounded-lg text-sm font-medium transition-all capitalize ${N===Rt?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:Rt},Rt))})]}),E.jsxs("div",{className:"px-4 py-4",children:[N==="franchises"&&E.jsxs("div",{className:"space-y-4",children:[E.jsxs("div",{className:"flex justify-between items-center",children:[E.jsxs("h2",{className:"font-semibold text-foreground",children:["Franchises (",m.length,")"]}),E.jsxs(NP,{open:H,onOpenChange:re,children:[E.jsx(uV,{asChild:!0,children:E.jsxs(wn,{size:"sm",className:"gradient-primary text-primary-foreground",children:[E.jsx(ly,{className:"w-4 h-4 mr-1"})," Add Franchise"]})}),E.jsxs(RE,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[E.jsx(ME,{children:E.jsx(kE,{children:"Create New Franchise"})}),E.jsxs("div",{className:"space-y-4 mt-4",children:[E.jsxs("div",{children:[E.jsx(Br,{children:"Franchise Name"}),E.jsx(Yi,{placeholder:"e.g., Hyderabad Central",value:nn.name,onChange:Rt=>Wt({...nn,name:Rt.target.value}),className:"bg-secondary border-0 mt-1"})]}),E.jsxs("div",{children:[E.jsx(Br,{children:"Description"}),E.jsx(yb,{placeholder:"Brief description of this franchise area...",value:nn.description,onChange:Rt=>Wt({...nn,description:Rt.target.value}),className:"bg-secondary border-0 mt-1 resize-none",rows:2})]}),E.jsxs("div",{children:[E.jsx(Br,{children:"Assign Franchise Admin"}),E.jsxs($M,{value:nn.adminId,onValueChange:Rt=>Wt({...nn,adminId:Rt}),children:[E.jsx(WS,{className:"bg-secondary border-0 mt-1",children:E.jsx(GM,{placeholder:"Select a user to assign as admin"})}),E.jsx(qS,{children:Ct.map(Rt=>E.jsxs(ZS,{value:Rt.id,children:[Rt.name," (",Rt.email,")"]},Rt.id))})]})]}),E.jsxs("div",{children:[E.jsx(Br,{children:"Draw Service Zone"}),E.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Draw a polygon on the map to define the service area"}),E.jsx(bbe,{onZoneChange:Rt=>Wt({...nn,zone:Rt}),height:"300px"})]}),E.jsx(wn,{onClick:Sr,disabled:ot,className:"w-full gradient-primary text-primary-foreground",children:ot?E.jsx(kr,{className:"w-5 h-5 animate-spin"}):"Create Franchise"})]})]})]})]}),v?E.jsx("div",{className:"flex justify-center py-8",children:E.jsx(kr,{className:"w-8 h-8 animate-spin text-primary"})}):m.length===0?E.jsxs("div",{className:"text-center py-12",children:[E.jsx(y1,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),E.jsx("p",{className:"text-muted-foreground",children:"No franchises yet"}),E.jsx("p",{className:"text-sm text-muted-foreground",children:"Create your first franchise to get started"})]}):m.map(Rt=>E.jsxs(bn.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card rounded-2xl p-4 shadow-card",children:[E.jsxs("div",{className:"flex items-start justify-between mb-3",children:[E.jsxs("div",{children:[E.jsx("h3",{className:"font-semibold text-foreground",children:Rt.name}),E.jsx("p",{className:"text-sm text-muted-foreground",children:Rt.description})]}),E.jsx("span",{className:Xn("px-2 py-1 rounded-full text-xs font-medium",Rt.isActive?"bg-veg/20 text-veg":"bg-muted text-muted-foreground"),children:Rt.isActive?"Active":"Inactive"})]}),E.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[E.jsxs("div",{className:"flex items-center gap-1",children:[E.jsx(cy,{className:"w-4 h-4"}),E.jsx("span",{children:Rt.adminName})]}),E.jsxs("div",{className:"flex items-center gap-1",children:[E.jsx(y1,{className:"w-4 h-4"}),E.jsxs("span",{children:[A.filter(pn=>pn.franchiseId===Rt.id).length," kitchens"]})]})]}),E.jsxs("div",{className:"flex gap-2",children:[E.jsxs(wn,{variant:"outline",size:"sm",onClick:()=>i(`/super-admin/franchise/${Rt.id}`),children:[E.jsx(T8,{className:"w-4 h-4 mr-1"})," View"]}),E.jsx(wn,{variant:"outline",size:"sm",className:"text-destructive border-destructive",onClick:()=>_n(Rt.id,Rt.adminId),children:E.jsx(kf,{className:"w-4 h-4"})})]})]},Rt.id))]}),N==="users"&&E.jsxs("div",{className:"space-y-4",children:[E.jsxs("div",{className:"flex justify-between items-center",children:[E.jsxs("h2",{className:"font-semibold text-foreground",children:["All Users (",o.length,")"]}),E.jsxs(NP,{open:Q,onOpenChange:ee,children:[E.jsx(uV,{asChild:!0,children:E.jsxs(wn,{size:"sm",className:"gradient-primary text-primary-foreground",children:[E.jsx(hne,{className:"w-4 h-4 mr-1"})," Create Admin"]})}),E.jsxs(RE,{className:"max-w-md",children:[E.jsx(ME,{children:E.jsx(kE,{children:"Create Franchise Admin"})}),E.jsxs("div",{className:"space-y-4 mt-4",children:[E.jsxs("div",{children:[E.jsx(Br,{children:"Name"}),E.jsx(Yi,{placeholder:"Admin Name",value:Ke.name,onChange:Rt=>et({...Ke,name:Rt.target.value}),className:"bg-secondary border-0 mt-1"})]}),E.jsxs("div",{children:[E.jsx(Br,{children:"Email"}),E.jsx(Yi,{type:"email",placeholder:"admin@example.com",value:Ke.email,onChange:Rt=>et({...Ke,email:Rt.target.value}),className:"bg-secondary border-0 mt-1"})]}),E.jsxs("div",{children:[E.jsx(Br,{children:"Phone"}),E.jsx(Yi,{placeholder:"9876543210",value:Ke.phone,onChange:Rt=>et({...Ke,phone:Rt.target.value}),className:"bg-secondary border-0 mt-1"})]}),E.jsxs("div",{children:[E.jsx(Br,{children:"Password"}),E.jsx(Yi,{type:"password",placeholder:"Min 6 characters",value:Ke.password,onChange:Rt=>et({...Ke,password:Rt.target.value}),className:"bg-secondary border-0 mt-1"})]}),E.jsx(wn,{onClick:Bn,disabled:Zt,className:"w-full gradient-primary text-primary-foreground",children:Zt?E.jsx(kr,{className:"w-5 h-5 animate-spin"}):"Create Franchise Admin"})]})]})]})]}),o.map(Rt=>E.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card",children:E.jsxs("div",{className:"flex items-center justify-between",children:[E.jsxs("div",{className:"flex-1",children:[E.jsx("p",{className:"font-medium text-foreground",children:Rt.name}),E.jsx("p",{className:"text-sm text-muted-foreground",children:Rt.email})]}),E.jsxs("div",{className:"flex items-center gap-2",children:[E.jsx("span",{className:Xn("px-2 py-1 rounded-full text-xs font-medium capitalize",Rt.role==="super_admin"&&"bg-primary/20 text-primary",Rt.role==="franchise_admin"&&"bg-accent/20 text-accent-foreground",Rt.role==="amma"&&"bg-veg/20 text-veg",Rt.role==="admin"&&"bg-gold/20 text-gold",Rt.role==="user"&&"bg-secondary text-secondary-foreground"),children:Rt.role.replace("_"," ")}),Rt.id!==(e==null?void 0:e.id)&&E.jsx(wn,{variant:"outline",size:"sm",onClick:()=>Ji(Rt.id,Rt.name,Rt.role),children:E.jsx(A8,{className:"w-3 h-3"})})]})]})},Rt.id)),E.jsx(NP,{open:ie,onOpenChange:ue,children:E.jsxs(RE,{className:"max-w-sm",children:[E.jsx(ME,{children:E.jsx(kE,{children:"Change User Role"})}),E.jsxs("div",{className:"space-y-4 mt-4",children:[E.jsxs("p",{className:"text-sm text-muted-foreground",children:["Change role for ",E.jsx("span",{className:"font-medium text-foreground",children:xe==null?void 0:xe.name})]}),E.jsxs("div",{children:[E.jsx(Br,{children:"New Role"}),E.jsxs($M,{value:ze,onValueChange:Rt=>Be(Rt),children:[E.jsx(WS,{className:"bg-secondary border-0 mt-1",children:E.jsx(GM,{})}),E.jsx(qS,{children:wbe.map(Rt=>E.jsx(ZS,{value:Rt.value,children:Rt.label},Rt.value))})]})]}),E.jsx(wn,{onClick:qt,disabled:zt||ze===(xe==null?void 0:xe.currentRole),className:"w-full gradient-primary text-primary-foreground",children:zt?E.jsx(kr,{className:"w-5 h-5 animate-spin"}):"Update Role"})]})]})})]}),N==="kitchens"&&E.jsxs("div",{className:"space-y-4",children:[E.jsxs("h2",{className:"font-semibold text-foreground",children:["All Kitchens (",A.length,")"]}),en.length>0&&E.jsxs("div",{className:"bg-gold/10 rounded-2xl p-4 mb-4",children:[E.jsxs("h3",{className:"font-semibold text-foreground mb-3 flex items-center gap-2",children:[E.jsx(Zc,{className:"w-4 h-4 text-gold"}),"Pending Approvals (",en.length,")"]}),E.jsx("div",{className:"space-y-3",children:en.map(Rt=>{var pn;return E.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card",children:E.jsxs("div",{className:"flex gap-3",children:[E.jsx("img",{src:Rt.image,alt:Rt.name,className:"w-16 h-16 rounded-lg object-cover"}),E.jsxs("div",{className:"flex-1",children:[E.jsx("p",{className:"font-medium text-foreground",children:Rt.name}),E.jsx("p",{className:"text-sm text-muted-foreground",children:Rt.address.city}),E.jsx("p",{className:"text-xs text-muted-foreground",children:(pn=Rt.specialties)==null?void 0:pn.join(", ")})]}),E.jsxs("div",{className:"flex flex-col gap-1",children:[E.jsx(wn,{size:"sm",className:"bg-veg text-primary-foreground",onClick:()=>En(Rt.id),children:E.jsx(Zu,{className:"w-4 h-4"})}),E.jsx(wn,{size:"sm",variant:"outline",className:"text-destructive border-destructive",onClick:()=>gn(Rt.id),children:E.jsx(Kc,{className:"w-4 h-4"})})]})]})},Rt.id)})})]}),A.filter(Rt=>Rt.isApproved).map(Rt=>{const pn=m.find(Fn=>Fn.id===Rt.franchiseId);return E.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card",children:E.jsxs("div",{className:"flex gap-3",children:[E.jsx("img",{src:Rt.image,alt:Rt.name,className:"w-16 h-16 rounded-lg object-cover"}),E.jsxs("div",{className:"flex-1",children:[E.jsx("p",{className:"font-medium text-foreground",children:Rt.name}),E.jsx("p",{className:"text-sm text-muted-foreground",children:Rt.address.city}),E.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[E.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs bg-veg/20 text-veg",children:"Approved"}),pn&&E.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs bg-primary/20 text-primary",children:pn.name})]})]})]})},Rt.id)})]}),N==="system"&&E.jsxs("div",{className:"space-y-6",children:[E.jsx("h2",{className:"font-semibold text-foreground",children:"System Management"}),E.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-2xl p-6",children:[E.jsxs("h3",{className:"font-semibold text-destructive flex items-center gap-2 mb-4",children:[E.jsx(Zc,{className:"w-5 h-5"}),"Danger Zone"]}),E.jsxs("div",{className:"space-y-4",children:[E.jsxs("div",{children:[E.jsx("h4",{className:"font-medium text-foreground",children:"Reset Database"}),E.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"This will permanently delete all data including users, franchises, kitchens, dishes, and orders. Only the Super Admin account will be preserved."})]}),E.jsx(wn,{variant:"destructive",onClick:J,disabled:z,className:"w-full sm:w-auto",children:z?E.jsxs(E.Fragment,{children:[E.jsx(kr,{className:"w-4 h-4 mr-2 animate-spin"}),"Resetting..."]}):E.jsxs(E.Fragment,{children:[E.jsx(kf,{className:"w-4 h-4 mr-2"}),"Reset Database (Keep Super Admin)"]})})]})]})]})]})]})}function Ebe({kitchenName:e}){const{signOut:t}=Sa(),i=Qa();return E.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[E.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:E.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[E.jsx("h1",{className:"font-semibold text-foreground",children:"Kitchen Status"}),E.jsx(wn,{variant:"ghost",size:"icon",onClick:async()=>{await t(),i("/auth")},className:"text-destructive",children:E.jsx(_1,{className:"w-5 h-5"})})]})}),E.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-6 py-12",children:[E.jsx(bn.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:20},className:"w-24 h-24 rounded-full bg-gold/20 flex items-center justify-center mb-6",children:E.jsx(g1,{className:"w-12 h-12 text-gold"})}),E.jsxs(bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-center max-w-sm",children:[E.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Pending Approval"}),E.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card mb-6",children:E.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[E.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:E.jsx(Mf,{className:"w-6 h-6 text-primary"})}),E.jsxs("div",{className:"text-left",children:[E.jsx("p",{className:"font-semibold text-foreground",children:e}),E.jsx("p",{className:"text-xs text-muted-foreground",children:"Your Kitchen"})]})]})}),E.jsx("p",{className:"text-muted-foreground mb-6",children:"Your kitchen registration is under review by the franchise admin. You'll be automatically redirected once approved."}),E.jsx("div",{className:"space-y-3",children:E.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground bg-secondary rounded-lg p-3",children:[E.jsx("div",{className:"w-2 h-2 rounded-full bg-gold animate-pulse"}),E.jsx("span",{children:"Waiting for franchise admin approval..."})]})})]}),E.jsx(bn.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"mt-8",children:E.jsxs(wn,{variant:"outline",onClick:()=>i("/"),className:"gap-2",children:[E.jsx(S8,{className:"w-4 h-4"}),"Browse as Customer"]})})]})]})}function iE({children:e}){const{user:t,loading:i}=Sa(),{kitchens:l,loading:d}=pL(t==null?void 0:t.id);if(i)return E.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:E.jsx(kr,{className:"w-8 h-8 animate-spin text-primary"})});if(!t)return E.jsx(Soe,{to:"/auth",replace:!0});if(d)return E.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:E.jsx(kr,{className:"w-8 h-8 animate-spin text-primary"})});if(l.length>0){const m=l[0];if(!m.isApproved)return E.jsx(Ebe,{kitchenName:m.name})}return E.jsx(E.Fragment,{children:e})}const Sbe=()=>{const e=zm();return q.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),E.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:E.jsxs("div",{className:"text-center",children:[E.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),E.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),E.jsx(Fr,{to:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})},Cbe=new Lse;Ipe().catch(console.error);const Ibe=()=>E.jsx(Fse,{client:Cbe,children:E.jsx(xpe,{children:E.jsx(Cpe,{children:E.jsx(bpe,{children:E.jsxs(dse,{children:[E.jsx(Zne,{}),E.jsx(Cie,{}),E.jsx(Noe,{basename:"/ammacheythivantalive",children:E.jsxs(Ioe,{children:[E.jsx(oo,{path:"/",element:E.jsx(wve,{})}),E.jsx(oo,{path:"/kitchen/:id",element:E.jsx(Eve,{})}),E.jsx(oo,{path:"/cart",element:E.jsx(Sve,{})}),E.jsx(oo,{path:"/checkout",element:E.jsx(Mve,{})}),E.jsx(oo,{path:"/auth",element:E.jsx(Lve,{})}),E.jsx(oo,{path:"/profile",element:E.jsx(Ove,{})}),E.jsx(oo,{path:"/settings",element:E.jsx(s0e,{})}),E.jsx(oo,{path:"/help",element:E.jsx(A0e,{})}),E.jsx(oo,{path:"/search",element:E.jsx(P0e,{})}),E.jsx(oo,{path:"/orders",element:E.jsx(R0e,{})}),E.jsx(oo,{path:"/amma/dashboard",element:E.jsx(iE,{children:E.jsx(O0e,{})})}),E.jsx(oo,{path:"/amma/register",element:E.jsx(iE,{children:E.jsx(H0e,{})})}),E.jsx(oo,{path:"/amma/add-dish",element:E.jsx(iE,{children:E.jsx(T1e,{})})}),E.jsx(oo,{path:"/amma/edit-kitchen/:kitchenId",element:E.jsx(iE,{children:E.jsx(E1e,{})})}),E.jsx(oo,{path:"/admin",element:E.jsx(I1e,{})}),E.jsx(oo,{path:"/franchise-admin",element:E.jsx(A1e,{})}),E.jsx(oo,{path:"/super-admin",element:E.jsx(Tbe,{})}),E.jsx(oo,{path:"*",element:E.jsx(Sbe,{})})]})})]})})})})});H6(document.getElementById("root")).render(E.jsx(Ibe,{}));
