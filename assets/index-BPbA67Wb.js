var qR=e=>{throw TypeError(e)};var ZS=(e,i,s)=>i.has(e)||qR("Cannot "+s);var es=(e,i,s)=>(ZS(e,i,"read from private field"),s?s.call(e):i.get(e)),zl=(e,i,s)=>i.has(e)?qR("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(e):i.set(e,s),$o=(e,i,s,a)=>(ZS(e,i,"write to private field"),a?a.call(e,s):i.set(e,s),s),Qu=(e,i,s)=>(ZS(e,i,"access private method"),s);var ZE=(e,i,s,a)=>({set _(_){$o(e,i,_,s)},get _(){return es(e,i,a)}});function _mergeNamespaces(e,i){for(var s=0;s<i.length;s++){const a=i[s];if(typeof a!="string"&&!Array.isArray(a)){for(const _ in a)if(_!=="default"&&!(_ in e)){const et=Object.getOwnPropertyDescriptor(a,_);et&&Object.defineProperty(e,_,et.get?et:{enumerable:!0,get:()=>a[_]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))a(_);new MutationObserver(_=>{for(const et of _)if(et.type==="childList")for(const nt of et.addedNodes)nt.tagName==="LINK"&&nt.rel==="modulepreload"&&a(nt)}).observe(document,{childList:!0,subtree:!0});function s(_){const et={};return _.integrity&&(et.integrity=_.integrity),_.referrerPolicy&&(et.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?et.credentials="include":_.crossOrigin==="anonymous"?et.credentials="omit":et.credentials="same-origin",et}function a(_){if(_.ep)return;_.ep=!0;const et=s(_);fetch(_.href,et)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$2=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r$1=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$4=Symbol.for("react.forward_ref"),w$2=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(e){return e===null||typeof e!="object"?null:(e=z$1&&e[z$1]||e["@@iterator"],typeof e=="function"?e:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$2={};function E$2(e,i,s){this.props=e,this.context=i,this.refs=D$2,this.updater=s||B$1}E$2.prototype.isReactComponent={};E$2.prototype.setState=function(e,i){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,i,"setState")};E$2.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function F(){}F.prototype=E$2.prototype;function G$1(e,i,s){this.props=e,this.context=i,this.refs=D$2,this.updater=s||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$2.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$2={key:!0,ref:!0,__self:!0,__source:!0};function M$2(e,i,s){var a,_={},et=null,nt=null;if(i!=null)for(a in i.ref!==void 0&&(nt=i.ref),i.key!==void 0&&(et=""+i.key),i)J.call(i,a)&&!L$2.hasOwnProperty(a)&&(_[a]=i[a]);var c=arguments.length-2;if(c===1)_.children=s;else if(1<c){for(var ct=Array(c),dt=0;dt<c;dt++)ct[dt]=arguments[dt+2];_.children=ct}if(e&&e.defaultProps)for(a in c=e.defaultProps,c)_[a]===void 0&&(_[a]=c[a]);return{$$typeof:l$1,type:e,key:et,ref:nt,props:_,_owner:K$1.current}}function N$1(e,i){return{$$typeof:l$1,type:e.type,key:i,ref:e.ref,props:e.props,_owner:e._owner}}function O$1(e){return typeof e=="object"&&e!==null&&e.$$typeof===l$1}function escape(e){var i={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(s){return i[s]})}var P$2=/\/+/g;function Q$1(e,i){return typeof e=="object"&&e!==null&&e.key!=null?escape(""+e.key):i.toString(36)}function R$1(e,i,s,a,_){var et=typeof e;(et==="undefined"||et==="boolean")&&(e=null);var nt=!1;if(e===null)nt=!0;else switch(et){case"string":case"number":nt=!0;break;case"object":switch(e.$$typeof){case l$1:case n$1:nt=!0}}if(nt)return nt=e,_=_(nt),e=a===""?"."+Q$1(nt,0):a,I$1(_)?(s="",e!=null&&(s=e.replace(P$2,"$&/")+"/"),R$1(_,i,s,"",function(dt){return dt})):_!=null&&(O$1(_)&&(_=N$1(_,s+(!_.key||nt&&nt.key===_.key?"":(""+_.key).replace(P$2,"$&/")+"/")+e)),i.push(_)),1;if(nt=0,a=a===""?".":a+":",I$1(e))for(var c=0;c<e.length;c++){et=e[c];var ct=a+Q$1(et,c);nt+=R$1(et,i,s,ct,_)}else if(ct=A$1(e),typeof ct=="function")for(e=ct.call(e),c=0;!(et=e.next()).done;)et=et.value,ct=a+Q$1(et,c++),nt+=R$1(et,i,s,ct,_);else if(et==="object")throw i=String(e),Error("Objects are not valid as a React child (found: "+(i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return nt}function S$1(e,i,s){if(e==null)return e;var a=[],_=0;return R$1(e,a,"","",function(et){return i.call(s,et,_++)}),a}function T$1(e){if(e._status===-1){var i=e._result;i=i(),i.then(function(s){(e._status===0||e._status===-1)&&(e._status=1,e._result=s)},function(s){(e._status===0||e._status===-1)&&(e._status=2,e._result=s)}),e._status===-1&&(e._status=0,e._result=i)}if(e._status===1)return e._result.default;throw e._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};function X$2(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$1,forEach:function(e,i,s){S$1(e,function(){i.apply(this,arguments)},s)},count:function(e){var i=0;return S$1(e,function(){i++}),i},toArray:function(e){return S$1(e,function(i){return i})||[]},only:function(e){if(!O$1(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};react_production_min.Component=E$2;react_production_min.Fragment=p$2;react_production_min.Profiler=r$1;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w$2;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.act=X$2;react_production_min.cloneElement=function(e,i,s){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=C$1({},e.props),_=e.key,et=e.ref,nt=e._owner;if(i!=null){if(i.ref!==void 0&&(et=i.ref,nt=K$1.current),i.key!==void 0&&(_=""+i.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(ct in i)J.call(i,ct)&&!L$2.hasOwnProperty(ct)&&(a[ct]=i[ct]===void 0&&c!==void 0?c[ct]:i[ct])}var ct=arguments.length-2;if(ct===1)a.children=s;else if(1<ct){c=Array(ct);for(var dt=0;dt<ct;dt++)c[dt]=arguments[dt+2];a.children=c}return{$$typeof:l$1,type:e.type,key:_,ref:et,props:a,_owner:nt}};react_production_min.createContext=function(e){return e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:t,_context:e},e.Consumer=e};react_production_min.createElement=M$2;react_production_min.createFactory=function(e){var i=M$2.bind(null,e);return i.type=e,i};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(e){return{$$typeof:v$4,render:e}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(e){return{$$typeof:y,_payload:{_status:-1,_result:e},_init:T$1}};react_production_min.memo=function(e,i){return{$$typeof:x,type:e,compare:i===void 0?null:i}};react_production_min.startTransition=function(e){var i=V$1.transition;V$1.transition={};try{e()}finally{V$1.transition=i}};react_production_min.unstable_act=X$2;react_production_min.useCallback=function(e,i){return U$1.current.useCallback(e,i)};react_production_min.useContext=function(e){return U$1.current.useContext(e)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(e){return U$1.current.useDeferredValue(e)};react_production_min.useEffect=function(e,i){return U$1.current.useEffect(e,i)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(e,i,s){return U$1.current.useImperativeHandle(e,i,s)};react_production_min.useInsertionEffect=function(e,i){return U$1.current.useInsertionEffect(e,i)};react_production_min.useLayoutEffect=function(e,i){return U$1.current.useLayoutEffect(e,i)};react_production_min.useMemo=function(e,i){return U$1.current.useMemo(e,i)};react_production_min.useReducer=function(e,i,s){return U$1.current.useReducer(e,i,s)};react_production_min.useRef=function(e){return U$1.current.useRef(e)};react_production_min.useState=function(e){return U$1.current.useState(e)};react_production_min.useSyncExternalStore=function(e,i,s){return U$1.current.useSyncExternalStore(e,i,s)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;const React=getDefaultExportFromCjs(reactExports),React$1=_mergeNamespaces({__proto__:null,default:React},[reactExports]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$1={key:!0,ref:!0,__self:!0,__source:!0};function q(e,i,s){var a,_={},et=null,nt=null;s!==void 0&&(et=""+s),i.key!==void 0&&(et=""+i.key),i.ref!==void 0&&(nt=i.ref);for(a in i)m$1.call(i,a)&&!p$1.hasOwnProperty(a)&&(_[a]=i[a]);if(e&&e.defaultProps)for(a in i=e.defaultProps,i)_[a]===void 0&&(_[a]=i[a]);return{$$typeof:k,type:e,key:et,ref:nt,props:_,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function i(rr,ur){var Br=rr.length;rr.push(ur);e:for(;0<Br;){var xr=Br-1>>>1,qr=rr[xr];if(0<_(qr,ur))rr[xr]=ur,rr[Br]=qr,Br=xr;else break e}}function s(rr){return rr.length===0?null:rr[0]}function a(rr){if(rr.length===0)return null;var ur=rr[0],Br=rr.pop();if(Br!==ur){rr[0]=Br;e:for(var xr=0,qr=rr.length,tn=qr>>>1;xr<tn;){var vn=2*(xr+1)-1,hs=rr[vn],Ts=vn+1,ss=rr[Ts];if(0>_(hs,Br))Ts<qr&&0>_(ss,hs)?(rr[xr]=ss,rr[Ts]=Br,xr=Ts):(rr[xr]=hs,rr[vn]=Br,xr=vn);else if(Ts<qr&&0>_(ss,Br))rr[xr]=ss,rr[Ts]=Br,xr=Ts;else break e}}return ur}function _(rr,ur){var Br=rr.sortIndex-ur.sortIndex;return Br!==0?Br:rr.id-ur.id}if(typeof performance=="object"&&typeof performance.now=="function"){var et=performance;e.unstable_now=function(){return et.now()}}else{var nt=Date,c=nt.now();e.unstable_now=function(){return nt.now()-c}}var ct=[],dt=[],gt=1,Tt=null,Et=3,At=!1,Mt=!1,Pt=!1,$t=typeof setTimeout=="function"?setTimeout:null,Lt=typeof clearTimeout=="function"?clearTimeout:null,Bt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Nt(rr){for(var ur=s(dt);ur!==null;){if(ur.callback===null)a(dt);else if(ur.startTime<=rr)a(dt),ur.sortIndex=ur.expirationTime,i(ct,ur);else break;ur=s(dt)}}function Vt(rr){if(Pt=!1,Nt(rr),!Mt)if(s(ct)!==null)Mt=!0,yr(Xt);else{var ur=s(dt);ur!==null&&Ar(Vt,ur.startTime-rr)}}function Xt(rr,ur){Mt=!1,Pt&&(Pt=!1,Lt(mr),mr=-1),At=!0;var Br=Et;try{for(Nt(ur),Tt=s(ct);Tt!==null&&(!(Tt.expirationTime>ur)||rr&&!fn());){var xr=Tt.callback;if(typeof xr=="function"){Tt.callback=null,Et=Tt.priorityLevel;var qr=xr(Tt.expirationTime<=ur);ur=e.unstable_now(),typeof qr=="function"?Tt.callback=qr:Tt===s(ct)&&a(ct),Nt(ur)}else a(ct);Tt=s(ct)}if(Tt!==null)var tn=!0;else{var vn=s(dt);vn!==null&&Ar(Vt,vn.startTime-ur),tn=!1}return tn}finally{Tt=null,Et=Br,At=!1}}var nr=!1,ar=null,mr=-1,Fr=5,sn=-1;function fn(){return!(e.unstable_now()-sn<Fr)}function Lr(){if(ar!==null){var rr=e.unstable_now();sn=rr;var ur=!0;try{ur=ar(!0,rr)}finally{ur?Qr():(nr=!1,ar=null)}}else nr=!1}var Qr;if(typeof Bt=="function")Qr=function(){Bt(Lr)};else if(typeof MessageChannel<"u"){var dn=new MessageChannel,en=dn.port2;dn.port1.onmessage=Lr,Qr=function(){en.postMessage(null)}}else Qr=function(){$t(Lr,0)};function yr(rr){ar=rr,nr||(nr=!0,Qr())}function Ar(rr,ur){mr=$t(function(){rr(e.unstable_now())},ur)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(rr){rr.callback=null},e.unstable_continueExecution=function(){Mt||At||(Mt=!0,yr(Xt))},e.unstable_forceFrameRate=function(rr){0>rr||125<rr?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Fr=0<rr?Math.floor(1e3/rr):5},e.unstable_getCurrentPriorityLevel=function(){return Et},e.unstable_getFirstCallbackNode=function(){return s(ct)},e.unstable_next=function(rr){switch(Et){case 1:case 2:case 3:var ur=3;break;default:ur=Et}var Br=Et;Et=ur;try{return rr()}finally{Et=Br}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(rr,ur){switch(rr){case 1:case 2:case 3:case 4:case 5:break;default:rr=3}var Br=Et;Et=rr;try{return ur()}finally{Et=Br}},e.unstable_scheduleCallback=function(rr,ur,Br){var xr=e.unstable_now();switch(typeof Br=="object"&&Br!==null?(Br=Br.delay,Br=typeof Br=="number"&&0<Br?xr+Br:xr):Br=xr,rr){case 1:var qr=-1;break;case 2:qr=250;break;case 5:qr=1073741823;break;case 4:qr=1e4;break;default:qr=5e3}return qr=Br+qr,rr={id:gt++,callback:ur,priorityLevel:rr,startTime:Br,expirationTime:qr,sortIndex:-1},Br>xr?(rr.sortIndex=Br,i(dt,rr),s(ct)===null&&rr===s(dt)&&(Pt?(Lt(mr),mr=-1):Pt=!0,Ar(Vt,Br-xr))):(rr.sortIndex=qr,i(ct,rr),Mt||At||(Mt=!0,yr(Xt))),rr},e.unstable_shouldYield=fn,e.unstable_wrapCallback=function(rr){var ur=Et;return function(){var Br=Et;Et=ur;try{return rr.apply(this,arguments)}finally{Et=Br}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p(e){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+e,s=1;s<arguments.length;s++)i+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+e+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(e,i){ha(e,i),ha(e+"Capture",i)}function ha(e,i){for(ea[e]=i,e=0;e<i.length;e++)da.add(i[e])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(e){return ja.call(ma,e)?!0:ja.call(la,e)?!1:ka.test(e)?ma[e]=!0:(la[e]=!0,!1)}function pa(e,i,s,a){if(s!==null&&s.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return a?!1:s!==null?!s.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function qa(e,i,s,a){if(i===null||typeof i>"u"||pa(e,i,s,a))return!0;if(a)return!1;if(s!==null)switch(s.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function v$3(e,i,s,a,_,et,nt){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=a,this.attributeNamespace=_,this.mustUseProperty=s,this.propertyName=e,this.type=i,this.sanitizeURL=et,this.removeEmptyString=nt}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){z[e]=new v$3(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var i=e[0];z[i]=new v$3(i,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){z[e]=new v$3(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){z[e]=new v$3(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){z[e]=new v$3(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){z[e]=new v$3(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){z[e]=new v$3(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){z[e]=new v$3(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){z[e]=new v$3(e,5,!1,e.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var i=e.replace(ra,sa);z[i]=new v$3(i,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var i=e.replace(ra,sa);z[i]=new v$3(i,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var i=e.replace(ra,sa);z[i]=new v$3(i,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){z[e]=new v$3(e,1,!1,e.toLowerCase(),null,!1,!1)});z.xlinkHref=new v$3("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){z[e]=new v$3(e,1,!1,e.toLowerCase(),null,!0,!0)});function ta(e,i,s,a){var _=z.hasOwnProperty(i)?z[i]:null;(_!==null?_.type!==0:a||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(qa(i,s,_,a)&&(s=null),a||_===null?oa(i)&&(s===null?e.removeAttribute(i):e.setAttribute(i,""+s)):_.mustUseProperty?e[_.propertyName]=s===null?_.type===3?!1:"":s:(i=_.attributeName,a=_.attributeNamespace,s===null?e.removeAttribute(i):(_=_.type,s=_===3||_===4&&s===!0?"":""+s,a?e.setAttributeNS(a,i,s):e.setAttribute(i,s))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(e){return e===null||typeof e!="object"?null:(e=Ja&&e[Ja]||e["@@iterator"],typeof e=="function"?e:null)}var A=Object.assign,La;function Ma(e){if(La===void 0)try{throw Error()}catch(s){var i=s.stack.trim().match(/\n( *(at )?)/);La=i&&i[1]||""}return`
`+La+e}var Na=!1;function Oa(e,i){if(!e||Na)return"";Na=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(dt){var a=dt}Reflect.construct(e,[],i)}else{try{i.call()}catch(dt){a=dt}e.call(i.prototype)}else{try{throw Error()}catch(dt){a=dt}e()}}catch(dt){if(dt&&a&&typeof dt.stack=="string"){for(var _=dt.stack.split(`
`),et=a.stack.split(`
`),nt=_.length-1,c=et.length-1;1<=nt&&0<=c&&_[nt]!==et[c];)c--;for(;1<=nt&&0<=c;nt--,c--)if(_[nt]!==et[c]){if(nt!==1||c!==1)do if(nt--,c--,0>c||_[nt]!==et[c]){var ct=`
`+_[nt].replace(" at new "," at ");return e.displayName&&ct.includes("<anonymous>")&&(ct=ct.replace("<anonymous>",e.displayName)),ct}while(1<=nt&&0<=c);break}}}finally{Na=!1,Error.prepareStackTrace=s}return(e=e?e.displayName||e.name:"")?Ma(e):""}function Pa(e){switch(e.tag){case 5:return Ma(e.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return e=Oa(e.type,!1),e;case 11:return e=Oa(e.type.render,!1),e;case 1:return e=Oa(e.type,!0),e;default:return""}}function Qa(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Ca:return(e.displayName||"Context")+".Consumer";case Ba:return(e._context.displayName||"Context")+".Provider";case Da:var i=e.render;return e=e.displayName,e||(e=i.displayName||i.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Ga:return i=e.displayName||null,i!==null?i:Qa(e.type)||"Memo";case Ha:i=e._payload,e=e._init;try{return Qa(e(i))}catch{}}return null}function Ra(e){var i=e.type;switch(e.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=i.render,e=e.displayName||e.name||"",i.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(i);case 8:return i===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function Sa(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Ta(e){var i=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function Ua(e){var i=Ta(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,i),a=""+e[i];if(!e.hasOwnProperty(i)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var _=s.get,et=s.set;return Object.defineProperty(e,i,{configurable:!0,get:function(){return _.call(this)},set:function(nt){a=""+nt,et.call(this,nt)}}),Object.defineProperty(e,i,{enumerable:s.enumerable}),{getValue:function(){return a},setValue:function(nt){a=""+nt},stopTracking:function(){e._valueTracker=null,delete e[i]}}}}function Va(e){e._valueTracker||(e._valueTracker=Ua(e))}function Wa(e){if(!e)return!1;var i=e._valueTracker;if(!i)return!0;var s=i.getValue(),a="";return e&&(a=Ta(e)?e.checked?"true":"false":e.value),e=a,e!==s?(i.setValue(e),!0):!1}function Xa(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Ya(e,i){var s=i.checked;return A({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??e._wrapperState.initialChecked})}function Za(e,i){var s=i.defaultValue==null?"":i.defaultValue,a=i.checked!=null?i.checked:i.defaultChecked;s=Sa(i.value!=null?i.value:s),e._wrapperState={initialChecked:a,initialValue:s,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function ab(e,i){i=i.checked,i!=null&&ta(e,"checked",i,!1)}function bb(e,i){ab(e,i);var s=Sa(i.value),a=i.type;if(s!=null)a==="number"?(s===0&&e.value===""||e.value!=s)&&(e.value=""+s):e.value!==""+s&&(e.value=""+s);else if(a==="submit"||a==="reset"){e.removeAttribute("value");return}i.hasOwnProperty("value")?cb(e,i.type,s):i.hasOwnProperty("defaultValue")&&cb(e,i.type,Sa(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(e.defaultChecked=!!i.defaultChecked)}function db(e,i,s){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var a=i.type;if(!(a!=="submit"&&a!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+e._wrapperState.initialValue,s||i===e.value||(e.value=i),e.defaultValue=i}s=e.name,s!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,s!==""&&(e.name=s)}function cb(e,i,s){(i!=="number"||Xa(e.ownerDocument)!==e)&&(s==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+s&&(e.defaultValue=""+s))}var eb=Array.isArray;function fb(e,i,s,a){if(e=e.options,i){i={};for(var _=0;_<s.length;_++)i["$"+s[_]]=!0;for(s=0;s<e.length;s++)_=i.hasOwnProperty("$"+e[s].value),e[s].selected!==_&&(e[s].selected=_),_&&a&&(e[s].defaultSelected=!0)}else{for(s=""+Sa(s),i=null,_=0;_<e.length;_++){if(e[_].value===s){e[_].selected=!0,a&&(e[_].defaultSelected=!0);return}i!==null||e[_].disabled||(i=e[_])}i!==null&&(i.selected=!0)}}function gb(e,i){if(i.dangerouslySetInnerHTML!=null)throw Error(p(91));return A({},i,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function hb(e,i){var s=i.value;if(s==null){if(s=i.children,i=i.defaultValue,s!=null){if(i!=null)throw Error(p(92));if(eb(s)){if(1<s.length)throw Error(p(93));s=s[0]}i=s}i==null&&(i=""),s=i}e._wrapperState={initialValue:Sa(s)}}function ib(e,i){var s=Sa(i.value),a=Sa(i.defaultValue);s!=null&&(s=""+s,s!==e.value&&(e.value=s),i.defaultValue==null&&e.defaultValue!==s&&(e.defaultValue=s)),a!=null&&(e.defaultValue=""+a)}function jb(e){var i=e.textContent;i===e._wrapperState.initialValue&&i!==""&&i!==null&&(e.value=i)}function kb(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(e,i){return e==null||e==="http://www.w3.org/1999/xhtml"?kb(i):e==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var mb,nb=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,s,a,_){MSApp.execUnsafeLocalFunction(function(){return e(i,s,a,_)})}:e}(function(e,i){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=i;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=mb.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;i.firstChild;)e.appendChild(i.firstChild)}});function ob(e,i){if(i){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=i;return}}e.textContent=i}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(e){qb.forEach(function(i){i=i+e.charAt(0).toUpperCase()+e.substring(1),pb[i]=pb[e]})});function rb(e,i,s){return i==null||typeof i=="boolean"||i===""?"":s||typeof i!="number"||i===0||pb.hasOwnProperty(e)&&pb[e]?(""+i).trim():i+"px"}function sb(e,i){e=e.style;for(var s in i)if(i.hasOwnProperty(s)){var a=s.indexOf("--")===0,_=rb(s,i[s],a);s==="float"&&(s="cssFloat"),a?e.setProperty(s,_):e[s]=_}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(e,i){if(i){if(tb[e]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(p(137,e));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(p(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(p(61))}if(i.style!=null&&typeof i.style!="object")throw Error(p(62))}}function vb(e,i){if(e.indexOf("-")===-1)return typeof i.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var yb=null,zb=null,Ab=null;function Bb(e){if(e=Cb(e)){if(typeof yb!="function")throw Error(p(280));var i=e.stateNode;i&&(i=Db(i),yb(e.stateNode,e.type,i))}}function Eb(e){zb?Ab?Ab.push(e):Ab=[e]:zb=e}function Fb(){if(zb){var e=zb,i=Ab;if(Ab=zb=null,Bb(e),i)for(e=0;e<i.length;e++)Bb(i[e])}}function Gb(e,i){return e(i)}function Hb(){}var Ib=!1;function Jb(e,i,s){if(Ib)return e(i,s);Ib=!0;try{return Gb(e,i,s)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(e,i){var s=e.stateNode;if(s===null)return null;var a=Db(s);if(a===null)return null;s=a[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(e=e.type,a=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!a;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(p(231,i,typeof s));return s}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(e,i,s,a,_,et,nt,c,ct){var dt=Array.prototype.slice.call(arguments,3);try{i.apply(s,dt)}catch(gt){this.onError(gt)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(e){Ob=!0,Pb=e}};function Tb(e,i,s,a,_,et,nt,c,ct){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(e,i,s,a,_,et,nt,c,ct){if(Tb.apply(this,arguments),Ob){if(Ob){var dt=Pb;Ob=!1,Pb=null}else throw Error(p(198));Qb||(Qb=!0,Rb=dt)}}function Vb(e){var i=e,s=e;if(e.alternate)for(;i.return;)i=i.return;else{e=i;do i=e,i.flags&4098&&(s=i.return),e=i.return;while(e)}return i.tag===3?s:null}function Wb(e){if(e.tag===13){var i=e.memoizedState;if(i===null&&(e=e.alternate,e!==null&&(i=e.memoizedState)),i!==null)return i.dehydrated}return null}function Xb(e){if(Vb(e)!==e)throw Error(p(188))}function Yb(e){var i=e.alternate;if(!i){if(i=Vb(e),i===null)throw Error(p(188));return i!==e?null:e}for(var s=e,a=i;;){var _=s.return;if(_===null)break;var et=_.alternate;if(et===null){if(a=_.return,a!==null){s=a;continue}break}if(_.child===et.child){for(et=_.child;et;){if(et===s)return Xb(_),e;if(et===a)return Xb(_),i;et=et.sibling}throw Error(p(188))}if(s.return!==a.return)s=_,a=et;else{for(var nt=!1,c=_.child;c;){if(c===s){nt=!0,s=_,a=et;break}if(c===a){nt=!0,a=_,s=et;break}c=c.sibling}if(!nt){for(c=et.child;c;){if(c===s){nt=!0,s=et,a=_;break}if(c===a){nt=!0,a=et,s=_;break}c=c.sibling}if(!nt)throw Error(p(189))}}if(s.alternate!==a)throw Error(p(190))}if(s.tag!==3)throw Error(p(188));return s.stateNode.current===s?e:i}function Zb(e){return e=Yb(e),e!==null?$b(e):null}function $b(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var i=$b(e);if(i!==null)return i;e=e.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(e){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,e,void 0,(e.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(e){return e>>>=0,e===0?32:31-(pc(e)/qc|0)|0}var rc=64,sc=4194304;function tc(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function uc(e,i){var s=e.pendingLanes;if(s===0)return 0;var a=0,_=e.suspendedLanes,et=e.pingedLanes,nt=s&268435455;if(nt!==0){var c=nt&~_;c!==0?a=tc(c):(et&=nt,et!==0&&(a=tc(et)))}else nt=s&~_,nt!==0?a=tc(nt):et!==0&&(a=tc(et));if(a===0)return 0;if(i!==0&&i!==a&&!(i&_)&&(_=a&-a,et=i&-i,_>=et||_===16&&(et&4194240)!==0))return i;if(a&4&&(a|=s&16),i=e.entangledLanes,i!==0)for(e=e.entanglements,i&=a;0<i;)s=31-oc(i),_=1<<s,a|=e[s],i&=~_;return a}function vc(e,i){switch(e){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(e,i){for(var s=e.suspendedLanes,a=e.pingedLanes,_=e.expirationTimes,et=e.pendingLanes;0<et;){var nt=31-oc(et),c=1<<nt,ct=_[nt];ct===-1?(!(c&s)||c&a)&&(_[nt]=vc(c,i)):ct<=i&&(e.expiredLanes|=c),et&=~c}}function xc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function yc(){var e=rc;return rc<<=1,!(rc&4194240)&&(rc=64),e}function zc(e){for(var i=[],s=0;31>s;s++)i.push(e);return i}function Ac(e,i,s){e.pendingLanes|=i,i!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,i=31-oc(i),e[i]=s}function Bc(e,i){var s=e.pendingLanes&~i;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=i,e.mutableReadLanes&=i,e.entangledLanes&=i,i=e.entanglements;var a=e.eventTimes;for(e=e.expirationTimes;0<s;){var _=31-oc(s),et=1<<_;i[_]=0,a[_]=-1,e[_]=-1,s&=~et}}function Cc(e,i){var s=e.entangledLanes|=i;for(e=e.entanglements;s;){var a=31-oc(s),_=1<<a;_&i|e[a]&i&&(e[a]|=i),s&=~_}}var C=0;function Dc(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(e,i){switch(e){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(i.pointerId)}}function Tc(e,i,s,a,_,et){return e===null||e.nativeEvent!==et?(e={blockedOn:i,domEventName:s,eventSystemFlags:a,nativeEvent:et,targetContainers:[_]},i!==null&&(i=Cb(i),i!==null&&Fc(i)),e):(e.eventSystemFlags|=a,i=e.targetContainers,_!==null&&i.indexOf(_)===-1&&i.push(_),e)}function Uc(e,i,s,a,_){switch(i){case"focusin":return Lc=Tc(Lc,e,i,s,a,_),!0;case"dragenter":return Mc=Tc(Mc,e,i,s,a,_),!0;case"mouseover":return Nc=Tc(Nc,e,i,s,a,_),!0;case"pointerover":var et=_.pointerId;return Oc.set(et,Tc(Oc.get(et)||null,e,i,s,a,_)),!0;case"gotpointercapture":return et=_.pointerId,Pc.set(et,Tc(Pc.get(et)||null,e,i,s,a,_)),!0}return!1}function Vc(e){var i=Wc(e.target);if(i!==null){var s=Vb(i);if(s!==null){if(i=s.tag,i===13){if(i=Wb(s),i!==null){e.blockedOn=i,Ic(e.priority,function(){Gc(s)});return}}else if(i===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Xc(e){if(e.blockedOn!==null)return!1;for(var i=e.targetContainers;0<i.length;){var s=Yc(e.domEventName,e.eventSystemFlags,i[0],e.nativeEvent);if(s===null){s=e.nativeEvent;var a=new s.constructor(s.type,s);wb=a,s.target.dispatchEvent(a),wb=null}else return i=Cb(s),i!==null&&Fc(i),e.blockedOn=s,!1;i.shift()}return!0}function Zc(e,i,s){Xc(e)&&s.delete(i)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(e,i){e.blockedOn===i&&(e.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(e){function i(_){return ad(_,e)}if(0<Kc.length){ad(Kc[0],e);for(var s=1;s<Kc.length;s++){var a=Kc[s];a.blockedOn===e&&(a.blockedOn=null)}}for(Lc!==null&&ad(Lc,e),Mc!==null&&ad(Mc,e),Nc!==null&&ad(Nc,e),Oc.forEach(i),Pc.forEach(i),s=0;s<Qc.length;s++)a=Qc[s],a.blockedOn===e&&(a.blockedOn=null);for(;0<Qc.length&&(s=Qc[0],s.blockedOn===null);)Vc(s),s.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(e,i,s,a){var _=C,et=cd.transition;cd.transition=null;try{C=1,fd(e,i,s,a)}finally{C=_,cd.transition=et}}function gd(e,i,s,a){var _=C,et=cd.transition;cd.transition=null;try{C=4,fd(e,i,s,a)}finally{C=_,cd.transition=et}}function fd(e,i,s,a){if(dd){var _=Yc(e,i,s,a);if(_===null)hd(e,i,a,id$2,s),Sc(e,a);else if(Uc(_,e,i,s,a))a.stopPropagation();else if(Sc(e,a),i&4&&-1<Rc.indexOf(e)){for(;_!==null;){var et=Cb(_);if(et!==null&&Ec(et),et=Yc(e,i,s,a),et===null&&hd(e,i,a,id$2,s),et===_)break;_=et}_!==null&&a.stopPropagation()}else hd(e,i,a,null,s)}}var id$2=null;function Yc(e,i,s,a){if(id$2=null,e=xb(a),e=Wc(e),e!==null)if(i=Vb(e),i===null)e=null;else if(s=i.tag,s===13){if(e=Wb(i),e!==null)return e;e=null}else if(s===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;e=null}else i!==e&&(e=null);return id$2=e,null}function jd(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var e,i=ld,s=i.length,a,_="value"in kd?kd.value:kd.textContent,et=_.length;for(e=0;e<s&&i[e]===_[e];e++);var nt=s-e;for(a=1;a<=nt&&i[s-a]===_[et-a];a++);return md=_.slice(e,1<a?1-a:void 0)}function od(e){var i=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&i===13&&(e=13)):e=i,e===10&&(e=13),32<=e||e===13?e:0}function pd(){return!0}function qd(){return!1}function rd(e){function i(s,a,_,et,nt){this._reactName=s,this._targetInst=_,this.type=a,this.nativeEvent=et,this.target=nt,this.currentTarget=null;for(var c in e)e.hasOwnProperty(c)&&(s=e[c],this[c]=s?s(et):et[c]);return this.isDefaultPrevented=(et.defaultPrevented!=null?et.defaultPrevented:et.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),i}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==yd&&(yd&&e.type==="mousemove"?(wd=e.screenX-yd.screenX,xd=e.screenY-yd.screenY):xd=wd=0,yd=e),wd)},movementY:function(e){return"movementY"in e?e.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(e){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(e):(e=Od[e])?!!i[e]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(e){if(e.key){var i=Md[e.key]||e.key;if(i!=="Unidentified")return i}return e.type==="keypress"?(e=od(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Nd[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(e){return e.type==="keypress"?od(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?od(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae$1=ia&&"CompositionEvent"in window,be$1=null;ia&&"documentMode"in document&&(be$1=document.documentMode);var ce$1=ia&&"TextEvent"in window&&!be$1,de$1=ia&&(!ae$1||be$1&&8<be$1&&11>=be$1),ee$1=" ",fe=!1;function ge$1(e,i){switch(e){case"keyup":return $d.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he$1(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ie$1=!1;function je(e,i){switch(e){case"compositionend":return he$1(i);case"keypress":return i.which!==32?null:(fe=!0,ee$1);case"textInput":return e=i.data,e===ee$1&&fe?null:e;default:return null}}function ke(e,i){if(ie$1)return e==="compositionend"||!ae$1&&ge$1(e,i)?(e=nd(),md=ld=kd=null,ie$1=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return de$1&&i.locale!=="ko"?null:i.data;default:return null}}var le$1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me$1(e){var i=e&&e.nodeName&&e.nodeName.toLowerCase();return i==="input"?!!le$1[e.type]:i==="textarea"}function ne$1(e,i,s,a){Eb(a),i=oe$1(i,"onChange"),0<i.length&&(s=new td("onChange","change",null,s,a),e.push({event:s,listeners:i}))}var pe$1=null,qe=null;function re(e){se$1(e,0)}function te$1(e){var i=ue$1(e);if(Wa(i))return e}function ve$1(e,i){if(e==="change")return i}var we$1=!1;if(ia){var xe$1;if(ia){var ye$1="oninput"in document;if(!ye$1){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye$1=typeof ze.oninput=="function"}xe$1=ye$1}else xe$1=!1;we$1=xe$1&&(!document.documentMode||9<document.documentMode)}function Ae(){pe$1&&(pe$1.detachEvent("onpropertychange",Be),qe=pe$1=null)}function Be(e){if(e.propertyName==="value"&&te$1(qe)){var i=[];ne$1(i,qe,e,xb(e)),Jb(re,i)}}function Ce(e,i,s){e==="focusin"?(Ae(),pe$1=i,qe=s,pe$1.attachEvent("onpropertychange",Be)):e==="focusout"&&Ae()}function De(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return te$1(qe)}function Ee(e,i){if(e==="click")return te$1(i)}function Fe(e,i){if(e==="input"||e==="change")return te$1(i)}function Ge(e,i){return e===i&&(e!==0||1/e===1/i)||e!==e&&i!==i}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(e,i){if(He(e,i))return!0;if(typeof e!="object"||e===null||typeof i!="object"||i===null)return!1;var s=Object.keys(e),a=Object.keys(i);if(s.length!==a.length)return!1;for(a=0;a<s.length;a++){var _=s[a];if(!ja.call(i,_)||!He(e[_],i[_]))return!1}return!0}function Je(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ke(e,i){var s=Je(e);e=0;for(var a;s;){if(s.nodeType===3){if(a=e+s.textContent.length,e<=i&&a>=i)return{node:s,offset:i-e};e=a}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=Je(s)}}function Le(e,i){return e&&i?e===i?!0:e&&e.nodeType===3?!1:i&&i.nodeType===3?Le(e,i.parentNode):"contains"in e?e.contains(i):e.compareDocumentPosition?!!(e.compareDocumentPosition(i)&16):!1:!1}function Me(){for(var e=window,i=Xa();i instanceof e.HTMLIFrameElement;){try{var s=typeof i.contentWindow.location.href=="string"}catch{s=!1}if(s)e=i.contentWindow;else break;i=Xa(e.document)}return i}function Ne(e){var i=e&&e.nodeName&&e.nodeName.toLowerCase();return i&&(i==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||i==="textarea"||e.contentEditable==="true")}function Oe(e){var i=Me(),s=e.focusedElem,a=e.selectionRange;if(i!==s&&s&&s.ownerDocument&&Le(s.ownerDocument.documentElement,s)){if(a!==null&&Ne(s)){if(i=a.start,e=a.end,e===void 0&&(e=i),"selectionStart"in s)s.selectionStart=i,s.selectionEnd=Math.min(e,s.value.length);else if(e=(i=s.ownerDocument||document)&&i.defaultView||window,e.getSelection){e=e.getSelection();var _=s.textContent.length,et=Math.min(a.start,_);a=a.end===void 0?et:Math.min(a.end,_),!e.extend&&et>a&&(_=a,a=et,et=_),_=Ke(s,et);var nt=Ke(s,a);_&&nt&&(e.rangeCount!==1||e.anchorNode!==_.node||e.anchorOffset!==_.offset||e.focusNode!==nt.node||e.focusOffset!==nt.offset)&&(i=i.createRange(),i.setStart(_.node,_.offset),e.removeAllRanges(),et>a?(e.addRange(i),e.extend(nt.node,nt.offset)):(i.setEnd(nt.node,nt.offset),e.addRange(i)))}}for(i=[],e=s;e=e.parentNode;)e.nodeType===1&&i.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<i.length;s++)e=i[s],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te$1=!1;function Ue(e,i,s){var a=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;Te$1||Qe==null||Qe!==Xa(a)||(a=Qe,"selectionStart"in a&&Ne(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),Se&&Ie(Se,a)||(Se=a,a=oe$1(Re,"onSelect"),0<a.length&&(i=new td("onSelect","select",null,i,s),e.push({event:i,listeners:a}),i.target=Qe)))}function Ve(e,i){var s={};return s[e.toLowerCase()]=i.toLowerCase(),s["Webkit"+e]="webkit"+i,s["Moz"+e]="moz"+i,s}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(e){if(Xe[e])return Xe[e];if(!We[e])return e;var i=We[e],s;for(s in i)if(i.hasOwnProperty(s)&&s in Ye)return Xe[e]=i[s];return e}var $e$1=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(e,i){df.set(e,i),fa(i,[e])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e$1,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(e,i,s){var a=e.type||"unknown-event";e.currentTarget=s,Ub(a,i,void 0,e),e.currentTarget=null}function se$1(e,i){i=(i&4)!==0;for(var s=0;s<e.length;s++){var a=e[s],_=a.event;a=a.listeners;e:{var et=void 0;if(i)for(var nt=a.length-1;0<=nt;nt--){var c=a[nt],ct=c.instance,dt=c.currentTarget;if(c=c.listener,ct!==et&&_.isPropagationStopped())break e;nf(_,c,dt),et=ct}else for(nt=0;nt<a.length;nt++){if(c=a[nt],ct=c.instance,dt=c.currentTarget,c=c.listener,ct!==et&&_.isPropagationStopped())break e;nf(_,c,dt),et=ct}}}if(Qb)throw e=Rb,Qb=!1,Rb=null,e}function D$1(e,i){var s=i[of];s===void 0&&(s=i[of]=new Set);var a=e+"__bubble";s.has(a)||(pf(i,e,2,!1),s.add(a))}function qf(e,i,s){var a=0;i&&(a|=4),pf(s,e,a,i)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(e){if(!e[rf]){e[rf]=!0,da.forEach(function(s){s!=="selectionchange"&&(mf.has(s)||qf(s,!1,e),qf(s,!0,e))});var i=e.nodeType===9?e:e.ownerDocument;i===null||i[rf]||(i[rf]=!0,qf("selectionchange",!1,i))}}function pf(e,i,s,a){switch(jd(i)){case 1:var _=ed;break;case 4:_=gd;break;default:_=fd}s=_.bind(null,i,s,e),_=void 0,!Lb||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(_=!0),a?_!==void 0?e.addEventListener(i,s,{capture:!0,passive:_}):e.addEventListener(i,s,!0):_!==void 0?e.addEventListener(i,s,{passive:_}):e.addEventListener(i,s,!1)}function hd(e,i,s,a,_){var et=a;if(!(i&1)&&!(i&2)&&a!==null)e:for(;;){if(a===null)return;var nt=a.tag;if(nt===3||nt===4){var c=a.stateNode.containerInfo;if(c===_||c.nodeType===8&&c.parentNode===_)break;if(nt===4)for(nt=a.return;nt!==null;){var ct=nt.tag;if((ct===3||ct===4)&&(ct=nt.stateNode.containerInfo,ct===_||ct.nodeType===8&&ct.parentNode===_))return;nt=nt.return}for(;c!==null;){if(nt=Wc(c),nt===null)return;if(ct=nt.tag,ct===5||ct===6){a=et=nt;continue e}c=c.parentNode}}a=a.return}Jb(function(){var dt=et,gt=xb(s),Tt=[];e:{var Et=df.get(e);if(Et!==void 0){var At=td,Mt=e;switch(e){case"keypress":if(od(s)===0)break e;case"keydown":case"keyup":At=Rd;break;case"focusin":Mt="focus",At=Fd;break;case"focusout":Mt="blur",At=Fd;break;case"beforeblur":case"afterblur":At=Fd;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":At=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":At=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":At=Vd;break;case $e$1:case af:case bf:At=Hd;break;case cf:At=Xd;break;case"scroll":At=vd;break;case"wheel":At=Zd;break;case"copy":case"cut":case"paste":At=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":At=Td}var Pt=(i&4)!==0,$t=!Pt&&e==="scroll",Lt=Pt?Et!==null?Et+"Capture":null:Et;Pt=[];for(var Bt=dt,Nt;Bt!==null;){Nt=Bt;var Vt=Nt.stateNode;if(Nt.tag===5&&Vt!==null&&(Nt=Vt,Lt!==null&&(Vt=Kb(Bt,Lt),Vt!=null&&Pt.push(tf(Bt,Vt,Nt)))),$t)break;Bt=Bt.return}0<Pt.length&&(Et=new At(Et,Mt,null,s,gt),Tt.push({event:Et,listeners:Pt}))}}if(!(i&7)){e:{if(Et=e==="mouseover"||e==="pointerover",At=e==="mouseout"||e==="pointerout",Et&&s!==wb&&(Mt=s.relatedTarget||s.fromElement)&&(Wc(Mt)||Mt[uf]))break e;if((At||Et)&&(Et=gt.window===gt?gt:(Et=gt.ownerDocument)?Et.defaultView||Et.parentWindow:window,At?(Mt=s.relatedTarget||s.toElement,At=dt,Mt=Mt?Wc(Mt):null,Mt!==null&&($t=Vb(Mt),Mt!==$t||Mt.tag!==5&&Mt.tag!==6)&&(Mt=null)):(At=null,Mt=dt),At!==Mt)){if(Pt=Bd,Vt="onMouseLeave",Lt="onMouseEnter",Bt="mouse",(e==="pointerout"||e==="pointerover")&&(Pt=Td,Vt="onPointerLeave",Lt="onPointerEnter",Bt="pointer"),$t=At==null?Et:ue$1(At),Nt=Mt==null?Et:ue$1(Mt),Et=new Pt(Vt,Bt+"leave",At,s,gt),Et.target=$t,Et.relatedTarget=Nt,Vt=null,Wc(gt)===dt&&(Pt=new Pt(Lt,Bt+"enter",Mt,s,gt),Pt.target=Nt,Pt.relatedTarget=$t,Vt=Pt),$t=Vt,At&&Mt)t:{for(Pt=At,Lt=Mt,Bt=0,Nt=Pt;Nt;Nt=vf(Nt))Bt++;for(Nt=0,Vt=Lt;Vt;Vt=vf(Vt))Nt++;for(;0<Bt-Nt;)Pt=vf(Pt),Bt--;for(;0<Nt-Bt;)Lt=vf(Lt),Nt--;for(;Bt--;){if(Pt===Lt||Lt!==null&&Pt===Lt.alternate)break t;Pt=vf(Pt),Lt=vf(Lt)}Pt=null}else Pt=null;At!==null&&wf(Tt,Et,At,Pt,!1),Mt!==null&&$t!==null&&wf(Tt,$t,Mt,Pt,!0)}}e:{if(Et=dt?ue$1(dt):window,At=Et.nodeName&&Et.nodeName.toLowerCase(),At==="select"||At==="input"&&Et.type==="file")var Xt=ve$1;else if(me$1(Et))if(we$1)Xt=Fe;else{Xt=De;var nr=Ce}else(At=Et.nodeName)&&At.toLowerCase()==="input"&&(Et.type==="checkbox"||Et.type==="radio")&&(Xt=Ee);if(Xt&&(Xt=Xt(e,dt))){ne$1(Tt,Xt,s,gt);break e}nr&&nr(e,Et,dt),e==="focusout"&&(nr=Et._wrapperState)&&nr.controlled&&Et.type==="number"&&cb(Et,"number",Et.value)}switch(nr=dt?ue$1(dt):window,e){case"focusin":(me$1(nr)||nr.contentEditable==="true")&&(Qe=nr,Re=dt,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te$1=!0;break;case"contextmenu":case"mouseup":case"dragend":Te$1=!1,Ue(Tt,s,gt);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(Tt,s,gt)}var ar;if(ae$1)e:{switch(e){case"compositionstart":var mr="onCompositionStart";break e;case"compositionend":mr="onCompositionEnd";break e;case"compositionupdate":mr="onCompositionUpdate";break e}mr=void 0}else ie$1?ge$1(e,s)&&(mr="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(mr="onCompositionStart");mr&&(de$1&&s.locale!=="ko"&&(ie$1||mr!=="onCompositionStart"?mr==="onCompositionEnd"&&ie$1&&(ar=nd()):(kd=gt,ld="value"in kd?kd.value:kd.textContent,ie$1=!0)),nr=oe$1(dt,mr),0<nr.length&&(mr=new Ld(mr,e,null,s,gt),Tt.push({event:mr,listeners:nr}),ar?mr.data=ar:(ar=he$1(s),ar!==null&&(mr.data=ar)))),(ar=ce$1?je(e,s):ke(e,s))&&(dt=oe$1(dt,"onBeforeInput"),0<dt.length&&(gt=new Ld("onBeforeInput","beforeinput",null,s,gt),Tt.push({event:gt,listeners:dt}),gt.data=ar))}se$1(Tt,i)})}function tf(e,i,s){return{instance:e,listener:i,currentTarget:s}}function oe$1(e,i){for(var s=i+"Capture",a=[];e!==null;){var _=e,et=_.stateNode;_.tag===5&&et!==null&&(_=et,et=Kb(e,s),et!=null&&a.unshift(tf(e,et,_)),et=Kb(e,i),et!=null&&a.push(tf(e,et,_))),e=e.return}return a}function vf(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function wf(e,i,s,a,_){for(var et=i._reactName,nt=[];s!==null&&s!==a;){var c=s,ct=c.alternate,dt=c.stateNode;if(ct!==null&&ct===a)break;c.tag===5&&dt!==null&&(c=dt,_?(ct=Kb(s,et),ct!=null&&nt.unshift(tf(s,ct,c))):_||(ct=Kb(s,et),ct!=null&&nt.push(tf(s,ct,c)))),s=s.return}nt.length!==0&&e.push({event:i,listeners:nt})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(e){return(typeof e=="string"?e:""+e).replace(xf,`
`).replace(yf,"")}function Af(e,i,s){if(i=zf(i),zf(e)!==i&&s)throw Error(p(425))}function Bf(){}var Cf=null,Df=null;function Ef(e,i){return e==="textarea"||e==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(e){return Hf.resolve(null).then(e).catch(If)}:Ff;function If(e){setTimeout(function(){throw e})}function Kf(e,i){var s=i,a=0;do{var _=s.nextSibling;if(e.removeChild(s),_&&_.nodeType===8)if(s=_.data,s==="/$"){if(a===0){e.removeChild(_),bd(i);return}a--}else s!=="$"&&s!=="$?"&&s!=="$!"||a++;s=_}while(s);bd(i)}function Lf(e){for(;e!=null;e=e.nextSibling){var i=e.nodeType;if(i===1||i===3)break;if(i===8){if(i=e.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return e}function Mf(e){e=e.previousSibling;for(var i=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"){if(i===0)return e;i--}else s==="/$"&&i++}e=e.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(e){var i=e[Of];if(i)return i;for(var s=e.parentNode;s;){if(i=s[uf]||s[Of]){if(s=i.alternate,i.child!==null||s!==null&&s.child!==null)for(e=Mf(e);e!==null;){if(s=e[Of])return s;e=Mf(e)}return i}e=s,s=e.parentNode}return null}function Cb(e){return e=e[Of]||e[uf],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ue$1(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(p(33))}function Db(e){return e[Pf]||null}var Sf=[],Tf=-1;function Uf(e){return{current:e}}function E$1(e){0>Tf||(e.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(e,i){Tf++,Sf[Tf]=e.current,e.current=i}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(e,i){var s=e.type.contextTypes;if(!s)return Vf;var a=e.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===i)return a.__reactInternalMemoizedMaskedChildContext;var _={},et;for(et in s)_[et]=i[et];return a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=_),_}function Zf(e){return e=e.childContextTypes,e!=null}function $f(){E$1(Wf),E$1(H)}function ag(e,i,s){if(H.current!==Vf)throw Error(p(168));G(H,i),G(Wf,s)}function bg(e,i,s){var a=e.stateNode;if(i=i.childContextTypes,typeof a.getChildContext!="function")return s;a=a.getChildContext();for(var _ in a)if(!(_ in i))throw Error(p(108,Ra(e)||"Unknown",_));return A({},s,a)}function cg(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,e),G(Wf,Wf.current),!0}function dg(e,i,s){var a=e.stateNode;if(!a)throw Error(p(169));s?(e=bg(e,i,Xf),a.__reactInternalMemoizedMergedChildContext=e,E$1(Wf),E$1(H),G(H,e)):E$1(Wf),G(Wf,s)}var eg=null,fg=!1,gg=!1;function hg(e){eg===null?eg=[e]:eg.push(e)}function ig(e){fg=!0,hg(e)}function jg(){if(!gg&&eg!==null){gg=!0;var e=0,i=C;try{var s=eg;for(C=1;e<s.length;e++){var a=s[e];do a=a(!0);while(a!==null)}eg=null,fg=!1}catch(_){throw eg!==null&&(eg=eg.slice(e+1)),ac(fc,jg),_}finally{C=i,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(e,i){kg[lg++]=ng,kg[lg++]=mg,mg=e,ng=i}function ug(e,i,s){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=e;var a=rg;e=sg;var _=32-oc(a)-1;a&=~(1<<_),s+=1;var et=32-oc(i)+_;if(30<et){var nt=_-_%5;et=(a&(1<<nt)-1).toString(32),a>>=nt,_-=nt,rg=1<<32-oc(i)+_|s<<_|a,sg=et+e}else rg=1<<et|s<<_|a,sg=e}function vg(e){e.return!==null&&(tg(e,1),ug(e,1,0))}function wg(e){for(;e===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;e===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(e,i){var s=Bg(5,null,null,0);s.elementType="DELETED",s.stateNode=i,s.return=e,i=e.deletions,i===null?(e.deletions=[s],e.flags|=16):i.push(s)}function Cg(e,i){switch(e.tag){case 5:var s=e.type;return i=i.nodeType!==1||s.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(e.stateNode=i,xg=e,yg=Lf(i.firstChild),!0):!1;case 6:return i=e.pendingProps===""||i.nodeType!==3?null:i,i!==null?(e.stateNode=i,xg=e,yg=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(s=qg!==null?{id:rg,overflow:sg}:null,e.memoizedState={dehydrated:i,treeContext:s,retryLane:1073741824},s=Bg(18,null,null,0),s.stateNode=i,s.return=e,e.child=s,xg=e,yg=null,!0):!1;default:return!1}}function Dg(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Eg(e){if(I){var i=yg;if(i){var s=i;if(!Cg(e,i)){if(Dg(e))throw Error(p(418));i=Lf(s.nextSibling);var a=xg;i&&Cg(e,i)?Ag(a,s):(e.flags=e.flags&-4097|2,I=!1,xg=e)}}else{if(Dg(e))throw Error(p(418));e.flags=e.flags&-4097|2,I=!1,xg=e}}}function Fg(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;xg=e}function Gg(e){if(e!==xg)return!1;if(!I)return Fg(e),I=!0,!1;var i;if((i=e.tag!==3)&&!(i=e.tag!==5)&&(i=e.type,i=i!=="head"&&i!=="body"&&!Ef(e.type,e.memoizedProps)),i&&(i=yg)){if(Dg(e))throw Hg(),Error(p(418));for(;i;)Ag(e,i),i=Lf(i.nextSibling)}if(Fg(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(p(317));e:{for(e=e.nextSibling,i=0;e;){if(e.nodeType===8){var s=e.data;if(s==="/$"){if(i===0){yg=Lf(e.nextSibling);break e}i--}else s!=="$"&&s!=="$!"&&s!=="$?"||i++}e=e.nextSibling}yg=null}}else yg=xg?Lf(e.stateNode.nextSibling):null;return!0}function Hg(){for(var e=yg;e;)e=Lf(e.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(e){zg===null?zg=[e]:zg.push(e)}var Kg=ua.ReactCurrentBatchConfig;function Lg(e,i,s){if(e=s.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(p(309));var a=s.stateNode}if(!a)throw Error(p(147,e));var _=a,et=""+e;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===et?i.ref:(i=function(nt){var c=_.refs;nt===null?delete c[et]:c[et]=nt},i._stringRef=et,i)}if(typeof e!="string")throw Error(p(284));if(!s._owner)throw Error(p(290,e))}return e}function Mg(e,i){throw e=Object.prototype.toString.call(i),Error(p(31,e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e))}function Ng(e){var i=e._init;return i(e._payload)}function Og(e){function i(Lt,Bt){if(e){var Nt=Lt.deletions;Nt===null?(Lt.deletions=[Bt],Lt.flags|=16):Nt.push(Bt)}}function s(Lt,Bt){if(!e)return null;for(;Bt!==null;)i(Lt,Bt),Bt=Bt.sibling;return null}function a(Lt,Bt){for(Lt=new Map;Bt!==null;)Bt.key!==null?Lt.set(Bt.key,Bt):Lt.set(Bt.index,Bt),Bt=Bt.sibling;return Lt}function _(Lt,Bt){return Lt=Pg(Lt,Bt),Lt.index=0,Lt.sibling=null,Lt}function et(Lt,Bt,Nt){return Lt.index=Nt,e?(Nt=Lt.alternate,Nt!==null?(Nt=Nt.index,Nt<Bt?(Lt.flags|=2,Bt):Nt):(Lt.flags|=2,Bt)):(Lt.flags|=1048576,Bt)}function nt(Lt){return e&&Lt.alternate===null&&(Lt.flags|=2),Lt}function c(Lt,Bt,Nt,Vt){return Bt===null||Bt.tag!==6?(Bt=Qg(Nt,Lt.mode,Vt),Bt.return=Lt,Bt):(Bt=_(Bt,Nt),Bt.return=Lt,Bt)}function ct(Lt,Bt,Nt,Vt){var Xt=Nt.type;return Xt===ya?gt(Lt,Bt,Nt.props.children,Vt,Nt.key):Bt!==null&&(Bt.elementType===Xt||typeof Xt=="object"&&Xt!==null&&Xt.$$typeof===Ha&&Ng(Xt)===Bt.type)?(Vt=_(Bt,Nt.props),Vt.ref=Lg(Lt,Bt,Nt),Vt.return=Lt,Vt):(Vt=Rg(Nt.type,Nt.key,Nt.props,null,Lt.mode,Vt),Vt.ref=Lg(Lt,Bt,Nt),Vt.return=Lt,Vt)}function dt(Lt,Bt,Nt,Vt){return Bt===null||Bt.tag!==4||Bt.stateNode.containerInfo!==Nt.containerInfo||Bt.stateNode.implementation!==Nt.implementation?(Bt=Sg(Nt,Lt.mode,Vt),Bt.return=Lt,Bt):(Bt=_(Bt,Nt.children||[]),Bt.return=Lt,Bt)}function gt(Lt,Bt,Nt,Vt,Xt){return Bt===null||Bt.tag!==7?(Bt=Tg(Nt,Lt.mode,Vt,Xt),Bt.return=Lt,Bt):(Bt=_(Bt,Nt),Bt.return=Lt,Bt)}function Tt(Lt,Bt,Nt){if(typeof Bt=="string"&&Bt!==""||typeof Bt=="number")return Bt=Qg(""+Bt,Lt.mode,Nt),Bt.return=Lt,Bt;if(typeof Bt=="object"&&Bt!==null){switch(Bt.$$typeof){case va:return Nt=Rg(Bt.type,Bt.key,Bt.props,null,Lt.mode,Nt),Nt.ref=Lg(Lt,null,Bt),Nt.return=Lt,Nt;case wa:return Bt=Sg(Bt,Lt.mode,Nt),Bt.return=Lt,Bt;case Ha:var Vt=Bt._init;return Tt(Lt,Vt(Bt._payload),Nt)}if(eb(Bt)||Ka(Bt))return Bt=Tg(Bt,Lt.mode,Nt,null),Bt.return=Lt,Bt;Mg(Lt,Bt)}return null}function Et(Lt,Bt,Nt,Vt){var Xt=Bt!==null?Bt.key:null;if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number")return Xt!==null?null:c(Lt,Bt,""+Nt,Vt);if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case va:return Nt.key===Xt?ct(Lt,Bt,Nt,Vt):null;case wa:return Nt.key===Xt?dt(Lt,Bt,Nt,Vt):null;case Ha:return Xt=Nt._init,Et(Lt,Bt,Xt(Nt._payload),Vt)}if(eb(Nt)||Ka(Nt))return Xt!==null?null:gt(Lt,Bt,Nt,Vt,null);Mg(Lt,Nt)}return null}function At(Lt,Bt,Nt,Vt,Xt){if(typeof Vt=="string"&&Vt!==""||typeof Vt=="number")return Lt=Lt.get(Nt)||null,c(Bt,Lt,""+Vt,Xt);if(typeof Vt=="object"&&Vt!==null){switch(Vt.$$typeof){case va:return Lt=Lt.get(Vt.key===null?Nt:Vt.key)||null,ct(Bt,Lt,Vt,Xt);case wa:return Lt=Lt.get(Vt.key===null?Nt:Vt.key)||null,dt(Bt,Lt,Vt,Xt);case Ha:var nr=Vt._init;return At(Lt,Bt,Nt,nr(Vt._payload),Xt)}if(eb(Vt)||Ka(Vt))return Lt=Lt.get(Nt)||null,gt(Bt,Lt,Vt,Xt,null);Mg(Bt,Vt)}return null}function Mt(Lt,Bt,Nt,Vt){for(var Xt=null,nr=null,ar=Bt,mr=Bt=0,Fr=null;ar!==null&&mr<Nt.length;mr++){ar.index>mr?(Fr=ar,ar=null):Fr=ar.sibling;var sn=Et(Lt,ar,Nt[mr],Vt);if(sn===null){ar===null&&(ar=Fr);break}e&&ar&&sn.alternate===null&&i(Lt,ar),Bt=et(sn,Bt,mr),nr===null?Xt=sn:nr.sibling=sn,nr=sn,ar=Fr}if(mr===Nt.length)return s(Lt,ar),I&&tg(Lt,mr),Xt;if(ar===null){for(;mr<Nt.length;mr++)ar=Tt(Lt,Nt[mr],Vt),ar!==null&&(Bt=et(ar,Bt,mr),nr===null?Xt=ar:nr.sibling=ar,nr=ar);return I&&tg(Lt,mr),Xt}for(ar=a(Lt,ar);mr<Nt.length;mr++)Fr=At(ar,Lt,mr,Nt[mr],Vt),Fr!==null&&(e&&Fr.alternate!==null&&ar.delete(Fr.key===null?mr:Fr.key),Bt=et(Fr,Bt,mr),nr===null?Xt=Fr:nr.sibling=Fr,nr=Fr);return e&&ar.forEach(function(fn){return i(Lt,fn)}),I&&tg(Lt,mr),Xt}function Pt(Lt,Bt,Nt,Vt){var Xt=Ka(Nt);if(typeof Xt!="function")throw Error(p(150));if(Nt=Xt.call(Nt),Nt==null)throw Error(p(151));for(var nr=Xt=null,ar=Bt,mr=Bt=0,Fr=null,sn=Nt.next();ar!==null&&!sn.done;mr++,sn=Nt.next()){ar.index>mr?(Fr=ar,ar=null):Fr=ar.sibling;var fn=Et(Lt,ar,sn.value,Vt);if(fn===null){ar===null&&(ar=Fr);break}e&&ar&&fn.alternate===null&&i(Lt,ar),Bt=et(fn,Bt,mr),nr===null?Xt=fn:nr.sibling=fn,nr=fn,ar=Fr}if(sn.done)return s(Lt,ar),I&&tg(Lt,mr),Xt;if(ar===null){for(;!sn.done;mr++,sn=Nt.next())sn=Tt(Lt,sn.value,Vt),sn!==null&&(Bt=et(sn,Bt,mr),nr===null?Xt=sn:nr.sibling=sn,nr=sn);return I&&tg(Lt,mr),Xt}for(ar=a(Lt,ar);!sn.done;mr++,sn=Nt.next())sn=At(ar,Lt,mr,sn.value,Vt),sn!==null&&(e&&sn.alternate!==null&&ar.delete(sn.key===null?mr:sn.key),Bt=et(sn,Bt,mr),nr===null?Xt=sn:nr.sibling=sn,nr=sn);return e&&ar.forEach(function(Lr){return i(Lt,Lr)}),I&&tg(Lt,mr),Xt}function $t(Lt,Bt,Nt,Vt){if(typeof Nt=="object"&&Nt!==null&&Nt.type===ya&&Nt.key===null&&(Nt=Nt.props.children),typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case va:e:{for(var Xt=Nt.key,nr=Bt;nr!==null;){if(nr.key===Xt){if(Xt=Nt.type,Xt===ya){if(nr.tag===7){s(Lt,nr.sibling),Bt=_(nr,Nt.props.children),Bt.return=Lt,Lt=Bt;break e}}else if(nr.elementType===Xt||typeof Xt=="object"&&Xt!==null&&Xt.$$typeof===Ha&&Ng(Xt)===nr.type){s(Lt,nr.sibling),Bt=_(nr,Nt.props),Bt.ref=Lg(Lt,nr,Nt),Bt.return=Lt,Lt=Bt;break e}s(Lt,nr);break}else i(Lt,nr);nr=nr.sibling}Nt.type===ya?(Bt=Tg(Nt.props.children,Lt.mode,Vt,Nt.key),Bt.return=Lt,Lt=Bt):(Vt=Rg(Nt.type,Nt.key,Nt.props,null,Lt.mode,Vt),Vt.ref=Lg(Lt,Bt,Nt),Vt.return=Lt,Lt=Vt)}return nt(Lt);case wa:e:{for(nr=Nt.key;Bt!==null;){if(Bt.key===nr)if(Bt.tag===4&&Bt.stateNode.containerInfo===Nt.containerInfo&&Bt.stateNode.implementation===Nt.implementation){s(Lt,Bt.sibling),Bt=_(Bt,Nt.children||[]),Bt.return=Lt,Lt=Bt;break e}else{s(Lt,Bt);break}else i(Lt,Bt);Bt=Bt.sibling}Bt=Sg(Nt,Lt.mode,Vt),Bt.return=Lt,Lt=Bt}return nt(Lt);case Ha:return nr=Nt._init,$t(Lt,Bt,nr(Nt._payload),Vt)}if(eb(Nt))return Mt(Lt,Bt,Nt,Vt);if(Ka(Nt))return Pt(Lt,Bt,Nt,Vt);Mg(Lt,Nt)}return typeof Nt=="string"&&Nt!==""||typeof Nt=="number"?(Nt=""+Nt,Bt!==null&&Bt.tag===6?(s(Lt,Bt.sibling),Bt=_(Bt,Nt),Bt.return=Lt,Lt=Bt):(s(Lt,Bt),Bt=Qg(Nt,Lt.mode,Vt),Bt.return=Lt,Lt=Bt),nt(Lt)):s(Lt,Bt)}return $t}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(e){var i=Wg.current;E$1(Wg),e._currentValue=i}function bh(e,i,s){for(;e!==null;){var a=e.alternate;if((e.childLanes&i)!==i?(e.childLanes|=i,a!==null&&(a.childLanes|=i)):a!==null&&(a.childLanes&i)!==i&&(a.childLanes|=i),e===s)break;e=e.return}}function ch(e,i){Xg=e,Zg=Yg=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&i&&(dh=!0),e.firstContext=null)}function eh(e){var i=e._currentValue;if(Zg!==e)if(e={context:e,memoizedValue:i,next:null},Yg===null){if(Xg===null)throw Error(p(308));Yg=e,Xg.dependencies={lanes:0,firstContext:e}}else Yg=Yg.next=e;return i}var fh=null;function gh(e){fh===null?fh=[e]:fh.push(e)}function hh(e,i,s,a){var _=i.interleaved;return _===null?(s.next=s,gh(i)):(s.next=_.next,_.next=s),i.interleaved=s,ih(e,a)}function ih(e,i){e.lanes|=i;var s=e.alternate;for(s!==null&&(s.lanes|=i),s=e,e=e.return;e!==null;)e.childLanes|=i,s=e.alternate,s!==null&&(s.childLanes|=i),s=e,e=e.return;return s.tag===3?s.stateNode:null}var jh=!1;function kh(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(e,i){e=e.updateQueue,i.updateQueue===e&&(i.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function mh(e,i){return{eventTime:e,lane:i,tag:0,payload:null,callback:null,next:null}}function nh(e,i,s){var a=e.updateQueue;if(a===null)return null;if(a=a.shared,K&2){var _=a.pending;return _===null?i.next=i:(i.next=_.next,_.next=i),a.pending=i,ih(e,s)}return _=a.interleaved,_===null?(i.next=i,gh(a)):(i.next=_.next,_.next=i),a.interleaved=i,ih(e,s)}function oh(e,i,s){if(i=i.updateQueue,i!==null&&(i=i.shared,(s&4194240)!==0)){var a=i.lanes;a&=e.pendingLanes,s|=a,i.lanes=s,Cc(e,s)}}function ph(e,i){var s=e.updateQueue,a=e.alternate;if(a!==null&&(a=a.updateQueue,s===a)){var _=null,et=null;if(s=s.firstBaseUpdate,s!==null){do{var nt={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};et===null?_=et=nt:et=et.next=nt,s=s.next}while(s!==null);et===null?_=et=i:et=et.next=i}else _=et=i;s={baseState:a.baseState,firstBaseUpdate:_,lastBaseUpdate:et,shared:a.shared,effects:a.effects},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=i:e.next=i,s.lastBaseUpdate=i}function qh(e,i,s,a){var _=e.updateQueue;jh=!1;var et=_.firstBaseUpdate,nt=_.lastBaseUpdate,c=_.shared.pending;if(c!==null){_.shared.pending=null;var ct=c,dt=ct.next;ct.next=null,nt===null?et=dt:nt.next=dt,nt=ct;var gt=e.alternate;gt!==null&&(gt=gt.updateQueue,c=gt.lastBaseUpdate,c!==nt&&(c===null?gt.firstBaseUpdate=dt:c.next=dt,gt.lastBaseUpdate=ct))}if(et!==null){var Tt=_.baseState;nt=0,gt=dt=ct=null,c=et;do{var Et=c.lane,At=c.eventTime;if((a&Et)===Et){gt!==null&&(gt=gt.next={eventTime:At,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var Mt=e,Pt=c;switch(Et=i,At=s,Pt.tag){case 1:if(Mt=Pt.payload,typeof Mt=="function"){Tt=Mt.call(At,Tt,Et);break e}Tt=Mt;break e;case 3:Mt.flags=Mt.flags&-65537|128;case 0:if(Mt=Pt.payload,Et=typeof Mt=="function"?Mt.call(At,Tt,Et):Mt,Et==null)break e;Tt=A({},Tt,Et);break e;case 2:jh=!0}}c.callback!==null&&c.lane!==0&&(e.flags|=64,Et=_.effects,Et===null?_.effects=[c]:Et.push(c))}else At={eventTime:At,lane:Et,tag:c.tag,payload:c.payload,callback:c.callback,next:null},gt===null?(dt=gt=At,ct=Tt):gt=gt.next=At,nt|=Et;if(c=c.next,c===null){if(c=_.shared.pending,c===null)break;Et=c,c=Et.next,Et.next=null,_.lastBaseUpdate=Et,_.shared.pending=null}}while(!0);if(gt===null&&(ct=Tt),_.baseState=ct,_.firstBaseUpdate=dt,_.lastBaseUpdate=gt,i=_.shared.interleaved,i!==null){_=i;do nt|=_.lane,_=_.next;while(_!==i)}else et===null&&(_.shared.lanes=0);rh|=nt,e.lanes=nt,e.memoizedState=Tt}}function sh(e,i,s){if(e=i.effects,i.effects=null,e!==null)for(i=0;i<e.length;i++){var a=e[i],_=a.callback;if(_!==null){if(a.callback=null,a=s,typeof _!="function")throw Error(p(191,_));_.call(a)}}}var th={},uh=Uf(th),vh$1=Uf(th),wh=Uf(th);function xh(e){if(e===th)throw Error(p(174));return e}function yh(e,i){switch(G(wh,i),G(vh$1,e),G(uh,th),e=i.nodeType,e){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:lb(null,"");break;default:e=e===8?i.parentNode:i,i=e.namespaceURI||null,e=e.tagName,i=lb(i,e)}E$1(uh),G(uh,i)}function zh(){E$1(uh),E$1(vh$1),E$1(wh)}function Ah(e){xh(wh.current);var i=xh(uh.current),s=lb(i,e.type);i!==s&&(G(vh$1,e),G(uh,s))}function Bh(e){vh$1.current===e&&(E$1(uh),E$1(vh$1))}var L$1=Uf(0);function Ch(e){for(var i=e;i!==null;){if(i.tag===13){var s=i.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var Dh=[];function Eh(){for(var e=0;e<Dh.length;e++)Dh[e]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M$1=null,N=null,O=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P$1(){throw Error(p(321))}function Mh(e,i){if(i===null)return!1;for(var s=0;s<i.length&&s<e.length;s++)if(!He(e[s],i[s]))return!1;return!0}function Nh(e,i,s,a,_,et){if(Hh=et,M$1=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,Fh.current=e===null||e.memoizedState===null?Oh:Ph,e=s(a,_),Jh){et=0;do{if(Jh=!1,Kh=0,25<=et)throw Error(p(301));et+=1,O=N=null,i.updateQueue=null,Fh.current=Qh,e=s(a,_)}while(Jh)}if(Fh.current=Rh,i=N!==null&&N.next!==null,Hh=0,O=N=M$1=null,Ih=!1,i)throw Error(p(300));return e}function Sh(){var e=Kh!==0;return Kh=0,e}function Th(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O===null?M$1.memoizedState=O=e:O=O.next=e,O}function Uh(){if(N===null){var e=M$1.alternate;e=e!==null?e.memoizedState:null}else e=N.next;var i=O===null?M$1.memoizedState:O.next;if(i!==null)O=i,N=e;else{if(e===null)throw Error(p(310));N=e,e={memoizedState:N.memoizedState,baseState:N.baseState,baseQueue:N.baseQueue,queue:N.queue,next:null},O===null?M$1.memoizedState=O=e:O=O.next=e}return O}function Vh(e,i){return typeof i=="function"?i(e):i}function Wh(e){var i=Uh(),s=i.queue;if(s===null)throw Error(p(311));s.lastRenderedReducer=e;var a=N,_=a.baseQueue,et=s.pending;if(et!==null){if(_!==null){var nt=_.next;_.next=et.next,et.next=nt}a.baseQueue=_=et,s.pending=null}if(_!==null){et=_.next,a=a.baseState;var c=nt=null,ct=null,dt=et;do{var gt=dt.lane;if((Hh&gt)===gt)ct!==null&&(ct=ct.next={lane:0,action:dt.action,hasEagerState:dt.hasEagerState,eagerState:dt.eagerState,next:null}),a=dt.hasEagerState?dt.eagerState:e(a,dt.action);else{var Tt={lane:gt,action:dt.action,hasEagerState:dt.hasEagerState,eagerState:dt.eagerState,next:null};ct===null?(c=ct=Tt,nt=a):ct=ct.next=Tt,M$1.lanes|=gt,rh|=gt}dt=dt.next}while(dt!==null&&dt!==et);ct===null?nt=a:ct.next=c,He(a,i.memoizedState)||(dh=!0),i.memoizedState=a,i.baseState=nt,i.baseQueue=ct,s.lastRenderedState=a}if(e=s.interleaved,e!==null){_=e;do et=_.lane,M$1.lanes|=et,rh|=et,_=_.next;while(_!==e)}else _===null&&(s.lanes=0);return[i.memoizedState,s.dispatch]}function Xh(e){var i=Uh(),s=i.queue;if(s===null)throw Error(p(311));s.lastRenderedReducer=e;var a=s.dispatch,_=s.pending,et=i.memoizedState;if(_!==null){s.pending=null;var nt=_=_.next;do et=e(et,nt.action),nt=nt.next;while(nt!==_);He(et,i.memoizedState)||(dh=!0),i.memoizedState=et,i.baseQueue===null&&(i.baseState=et),s.lastRenderedState=et}return[et,a]}function Yh(){}function Zh(e,i){var s=M$1,a=Uh(),_=i(),et=!He(a.memoizedState,_);if(et&&(a.memoizedState=_,dh=!0),a=a.queue,$h(ai.bind(null,s,a,e),[e]),a.getSnapshot!==i||et||O!==null&&O.memoizedState.tag&1){if(s.flags|=2048,bi(9,ci.bind(null,s,a,_,i),void 0,null),Q===null)throw Error(p(349));Hh&30||di(s,i,_)}return _}function di(e,i,s){e.flags|=16384,e={getSnapshot:i,value:s},i=M$1.updateQueue,i===null?(i={lastEffect:null,stores:null},M$1.updateQueue=i,i.stores=[e]):(s=i.stores,s===null?i.stores=[e]:s.push(e))}function ci(e,i,s,a){i.value=s,i.getSnapshot=a,ei(i)&&fi(e)}function ai(e,i,s){return s(function(){ei(i)&&fi(e)})}function ei(e){var i=e.getSnapshot;e=e.value;try{var s=i();return!He(e,s)}catch{return!0}}function fi(e){var i=ih(e,1);i!==null&&gi(i,e,1,-1)}function hi(e){var i=Th();return typeof e=="function"&&(e=e()),i.memoizedState=i.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:e},i.queue=e,e=e.dispatch=ii.bind(null,M$1,e),[i.memoizedState,e]}function bi(e,i,s,a){return e={tag:e,create:i,destroy:s,deps:a,next:null},i=M$1.updateQueue,i===null?(i={lastEffect:null,stores:null},M$1.updateQueue=i,i.lastEffect=e.next=e):(s=i.lastEffect,s===null?i.lastEffect=e.next=e:(a=s.next,s.next=e,e.next=a,i.lastEffect=e)),e}function ji(){return Uh().memoizedState}function ki(e,i,s,a){var _=Th();M$1.flags|=e,_.memoizedState=bi(1|i,s,void 0,a===void 0?null:a)}function li(e,i,s,a){var _=Uh();a=a===void 0?null:a;var et=void 0;if(N!==null){var nt=N.memoizedState;if(et=nt.destroy,a!==null&&Mh(a,nt.deps)){_.memoizedState=bi(i,s,et,a);return}}M$1.flags|=e,_.memoizedState=bi(1|i,s,et,a)}function mi(e,i){return ki(8390656,8,e,i)}function $h(e,i){return li(2048,8,e,i)}function ni(e,i){return li(4,2,e,i)}function oi(e,i){return li(4,4,e,i)}function pi(e,i){if(typeof i=="function")return e=e(),i(e),function(){i(null)};if(i!=null)return e=e(),i.current=e,function(){i.current=null}}function qi(e,i,s){return s=s!=null?s.concat([e]):null,li(4,4,pi.bind(null,i,e),s)}function ri(){}function si(e,i){var s=Uh();i=i===void 0?null:i;var a=s.memoizedState;return a!==null&&i!==null&&Mh(i,a[1])?a[0]:(s.memoizedState=[e,i],e)}function ti(e,i){var s=Uh();i=i===void 0?null:i;var a=s.memoizedState;return a!==null&&i!==null&&Mh(i,a[1])?a[0]:(e=e(),s.memoizedState=[e,i],e)}function ui$1(e,i,s){return Hh&21?(He(s,i)||(s=yc(),M$1.lanes|=s,rh|=s,e.baseState=!0),i):(e.baseState&&(e.baseState=!1,dh=!0),e.memoizedState=s)}function vi(e,i){var s=C;C=s!==0&&4>s?s:4,e(!0);var a=Gh.transition;Gh.transition={};try{e(!1),i()}finally{C=s,Gh.transition=a}}function wi(){return Uh().memoizedState}function xi(e,i,s){var a=yi(e);if(s={lane:a,action:s,hasEagerState:!1,eagerState:null,next:null},zi(e))Ai(i,s);else if(s=hh(e,i,s,a),s!==null){var _=R();gi(s,e,a,_),Bi(s,i,a)}}function ii(e,i,s){var a=yi(e),_={lane:a,action:s,hasEagerState:!1,eagerState:null,next:null};if(zi(e))Ai(i,_);else{var et=e.alternate;if(e.lanes===0&&(et===null||et.lanes===0)&&(et=i.lastRenderedReducer,et!==null))try{var nt=i.lastRenderedState,c=et(nt,s);if(_.hasEagerState=!0,_.eagerState=c,He(c,nt)){var ct=i.interleaved;ct===null?(_.next=_,gh(i)):(_.next=ct.next,ct.next=_),i.interleaved=_;return}}catch{}finally{}s=hh(e,i,_,a),s!==null&&(_=R(),gi(s,e,a,_),Bi(s,i,a))}}function zi(e){var i=e.alternate;return e===M$1||i!==null&&i===M$1}function Ai(e,i){Jh=Ih=!0;var s=e.pending;s===null?i.next=i:(i.next=s.next,s.next=i),e.pending=i}function Bi(e,i,s){if(s&4194240){var a=i.lanes;a&=e.pendingLanes,s|=a,i.lanes=s,Cc(e,s)}}var Rh={readContext:eh,useCallback:P$1,useContext:P$1,useEffect:P$1,useImperativeHandle:P$1,useInsertionEffect:P$1,useLayoutEffect:P$1,useMemo:P$1,useReducer:P$1,useRef:P$1,useState:P$1,useDebugValue:P$1,useDeferredValue:P$1,useTransition:P$1,useMutableSource:P$1,useSyncExternalStore:P$1,useId:P$1,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(e,i){return Th().memoizedState=[e,i===void 0?null:i],e},useContext:eh,useEffect:mi,useImperativeHandle:function(e,i,s){return s=s!=null?s.concat([e]):null,ki(4194308,4,pi.bind(null,i,e),s)},useLayoutEffect:function(e,i){return ki(4194308,4,e,i)},useInsertionEffect:function(e,i){return ki(4,2,e,i)},useMemo:function(e,i){var s=Th();return i=i===void 0?null:i,e=e(),s.memoizedState=[e,i],e},useReducer:function(e,i,s){var a=Th();return i=s!==void 0?s(i):i,a.memoizedState=a.baseState=i,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},a.queue=e,e=e.dispatch=xi.bind(null,M$1,e),[a.memoizedState,e]},useRef:function(e){var i=Th();return e={current:e},i.memoizedState=e},useState:hi,useDebugValue:ri,useDeferredValue:function(e){return Th().memoizedState=e},useTransition:function(){var e=hi(!1),i=e[0];return e=vi.bind(null,e[1]),Th().memoizedState=e,[i,e]},useMutableSource:function(){},useSyncExternalStore:function(e,i,s){var a=M$1,_=Th();if(I){if(s===void 0)throw Error(p(407));s=s()}else{if(s=i(),Q===null)throw Error(p(349));Hh&30||di(a,i,s)}_.memoizedState=s;var et={value:s,getSnapshot:i};return _.queue=et,mi(ai.bind(null,a,et,e),[e]),a.flags|=2048,bi(9,ci.bind(null,a,et,s,i),void 0,null),s},useId:function(){var e=Th(),i=Q.identifierPrefix;if(I){var s=sg,a=rg;s=(a&~(1<<32-oc(a)-1)).toString(32)+s,i=":"+i+"R"+s,s=Kh++,0<s&&(i+="H"+s.toString(32)),i+=":"}else s=Lh++,i=":"+i+"r"+s.toString(32)+":";return e.memoizedState=i},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(e){var i=Uh();return ui$1(i,N.memoizedState,e)},useTransition:function(){var e=Wh(Vh)[0],i=Uh().memoizedState;return[e,i]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(e){var i=Uh();return N===null?i.memoizedState=e:ui$1(i,N.memoizedState,e)},useTransition:function(){var e=Xh(Vh)[0],i=Uh().memoizedState;return[e,i]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(e,i){if(e&&e.defaultProps){i=A({},i),e=e.defaultProps;for(var s in e)i[s]===void 0&&(i[s]=e[s]);return i}return i}function Di(e,i,s,a){i=e.memoizedState,s=s(a,i),s=s==null?i:A({},i,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var Ei={isMounted:function(e){return(e=e._reactInternals)?Vb(e)===e:!1},enqueueSetState:function(e,i,s){e=e._reactInternals;var a=R(),_=yi(e),et=mh(a,_);et.payload=i,s!=null&&(et.callback=s),i=nh(e,et,_),i!==null&&(gi(i,e,_,a),oh(i,e,_))},enqueueReplaceState:function(e,i,s){e=e._reactInternals;var a=R(),_=yi(e),et=mh(a,_);et.tag=1,et.payload=i,s!=null&&(et.callback=s),i=nh(e,et,_),i!==null&&(gi(i,e,_,a),oh(i,e,_))},enqueueForceUpdate:function(e,i){e=e._reactInternals;var s=R(),a=yi(e),_=mh(s,a);_.tag=2,i!=null&&(_.callback=i),i=nh(e,_,a),i!==null&&(gi(i,e,a,s),oh(i,e,a))}};function Fi(e,i,s,a,_,et,nt){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(a,et,nt):i.prototype&&i.prototype.isPureReactComponent?!Ie(s,a)||!Ie(_,et):!0}function Gi(e,i,s){var a=!1,_=Vf,et=i.contextType;return typeof et=="object"&&et!==null?et=eh(et):(_=Zf(i)?Xf:H.current,a=i.contextTypes,et=(a=a!=null)?Yf(e,_):Vf),i=new i(s,et),e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=Ei,e.stateNode=i,i._reactInternals=e,a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=_,e.__reactInternalMemoizedMaskedChildContext=et),i}function Hi(e,i,s,a){e=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(s,a),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(s,a),i.state!==e&&Ei.enqueueReplaceState(i,i.state,null)}function Ii(e,i,s,a){var _=e.stateNode;_.props=s,_.state=e.memoizedState,_.refs={},kh(e);var et=i.contextType;typeof et=="object"&&et!==null?_.context=eh(et):(et=Zf(i)?Xf:H.current,_.context=Yf(e,et)),_.state=e.memoizedState,et=i.getDerivedStateFromProps,typeof et=="function"&&(Di(e,i,et,s),_.state=e.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(i=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),i!==_.state&&Ei.enqueueReplaceState(_,_.state,null),qh(e,s,_,a),_.state=e.memoizedState),typeof _.componentDidMount=="function"&&(e.flags|=4194308)}function Ji(e,i){try{var s="",a=i;do s+=Pa(a),a=a.return;while(a);var _=s}catch(et){_=`
Error generating stack: `+et.message+`
`+et.stack}return{value:e,source:i,stack:_,digest:null}}function Ki(e,i,s){return{value:e,source:null,stack:s??null,digest:i??null}}function Li(e,i){try{console.error(i.value)}catch(s){setTimeout(function(){throw s})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(e,i,s){s=mh(-1,s),s.tag=3,s.payload={element:null};var a=i.value;return s.callback=function(){Oi||(Oi=!0,Pi=a),Li(e,i)},s}function Qi(e,i,s){s=mh(-1,s),s.tag=3;var a=e.type.getDerivedStateFromError;if(typeof a=="function"){var _=i.value;s.payload=function(){return a(_)},s.callback=function(){Li(e,i)}}var et=e.stateNode;return et!==null&&typeof et.componentDidCatch=="function"&&(s.callback=function(){Li(e,i),typeof a!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var nt=i.stack;this.componentDidCatch(i.value,{componentStack:nt!==null?nt:""})}),s}function Si(e,i,s){var a=e.pingCache;if(a===null){a=e.pingCache=new Mi;var _=new Set;a.set(i,_)}else _=a.get(i),_===void 0&&(_=new Set,a.set(i,_));_.has(s)||(_.add(s),e=Ti.bind(null,e,i,s),i.then(e,e))}function Ui(e){do{var i;if((i=e.tag===13)&&(i=e.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return e;e=e.return}while(e!==null);return null}function Vi(e,i,s,a,_){return e.mode&1?(e.flags|=65536,e.lanes=_,e):(e===i?e.flags|=65536:(e.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(i=mh(-1,1),i.tag=2,nh(s,i,1))),s.lanes|=1),e)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(e,i,s,a){i.child=e===null?Vg(i,null,s,a):Ug(i,e.child,s,a)}function Yi(e,i,s,a,_){s=s.render;var et=i.ref;return ch(i,_),a=Nh(e,i,s,a,et,_),s=Sh(),e!==null&&!dh?(i.updateQueue=e.updateQueue,i.flags&=-2053,e.lanes&=~_,Zi(e,i,_)):(I&&s&&vg(i),i.flags|=1,Xi(e,i,a,_),i.child)}function $i(e,i,s,a,_){if(e===null){var et=s.type;return typeof et=="function"&&!aj(et)&&et.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(i.tag=15,i.type=et,bj(e,i,et,a,_)):(e=Rg(s.type,null,a,i,i.mode,_),e.ref=i.ref,e.return=i,i.child=e)}if(et=e.child,!(e.lanes&_)){var nt=et.memoizedProps;if(s=s.compare,s=s!==null?s:Ie,s(nt,a)&&e.ref===i.ref)return Zi(e,i,_)}return i.flags|=1,e=Pg(et,a),e.ref=i.ref,e.return=i,i.child=e}function bj(e,i,s,a,_){if(e!==null){var et=e.memoizedProps;if(Ie(et,a)&&e.ref===i.ref)if(dh=!1,i.pendingProps=a=et,(e.lanes&_)!==0)e.flags&131072&&(dh=!0);else return i.lanes=e.lanes,Zi(e,i,_)}return cj(e,i,s,a,_)}function dj(e,i,s){var a=i.pendingProps,_=a.children,et=e!==null?e.memoizedState:null;if(a.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(ej,fj),fj|=s;else{if(!(s&1073741824))return e=et!==null?et.baseLanes|s:s,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:e,cachePool:null,transitions:null},i.updateQueue=null,G(ej,fj),fj|=e,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=et!==null?et.baseLanes:s,G(ej,fj),fj|=a}else et!==null?(a=et.baseLanes|s,i.memoizedState=null):a=s,G(ej,fj),fj|=a;return Xi(e,i,_,s),i.child}function gj(e,i){var s=i.ref;(e===null&&s!==null||e!==null&&e.ref!==s)&&(i.flags|=512,i.flags|=2097152)}function cj(e,i,s,a,_){var et=Zf(s)?Xf:H.current;return et=Yf(i,et),ch(i,_),s=Nh(e,i,s,a,et,_),a=Sh(),e!==null&&!dh?(i.updateQueue=e.updateQueue,i.flags&=-2053,e.lanes&=~_,Zi(e,i,_)):(I&&a&&vg(i),i.flags|=1,Xi(e,i,s,_),i.child)}function hj(e,i,s,a,_){if(Zf(s)){var et=!0;cg(i)}else et=!1;if(ch(i,_),i.stateNode===null)ij(e,i),Gi(i,s,a),Ii(i,s,a,_),a=!0;else if(e===null){var nt=i.stateNode,c=i.memoizedProps;nt.props=c;var ct=nt.context,dt=s.contextType;typeof dt=="object"&&dt!==null?dt=eh(dt):(dt=Zf(s)?Xf:H.current,dt=Yf(i,dt));var gt=s.getDerivedStateFromProps,Tt=typeof gt=="function"||typeof nt.getSnapshotBeforeUpdate=="function";Tt||typeof nt.UNSAFE_componentWillReceiveProps!="function"&&typeof nt.componentWillReceiveProps!="function"||(c!==a||ct!==dt)&&Hi(i,nt,a,dt),jh=!1;var Et=i.memoizedState;nt.state=Et,qh(i,a,nt,_),ct=i.memoizedState,c!==a||Et!==ct||Wf.current||jh?(typeof gt=="function"&&(Di(i,s,gt,a),ct=i.memoizedState),(c=jh||Fi(i,s,c,a,Et,ct,dt))?(Tt||typeof nt.UNSAFE_componentWillMount!="function"&&typeof nt.componentWillMount!="function"||(typeof nt.componentWillMount=="function"&&nt.componentWillMount(),typeof nt.UNSAFE_componentWillMount=="function"&&nt.UNSAFE_componentWillMount()),typeof nt.componentDidMount=="function"&&(i.flags|=4194308)):(typeof nt.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=a,i.memoizedState=ct),nt.props=a,nt.state=ct,nt.context=dt,a=c):(typeof nt.componentDidMount=="function"&&(i.flags|=4194308),a=!1)}else{nt=i.stateNode,lh(e,i),c=i.memoizedProps,dt=i.type===i.elementType?c:Ci(i.type,c),nt.props=dt,Tt=i.pendingProps,Et=nt.context,ct=s.contextType,typeof ct=="object"&&ct!==null?ct=eh(ct):(ct=Zf(s)?Xf:H.current,ct=Yf(i,ct));var At=s.getDerivedStateFromProps;(gt=typeof At=="function"||typeof nt.getSnapshotBeforeUpdate=="function")||typeof nt.UNSAFE_componentWillReceiveProps!="function"&&typeof nt.componentWillReceiveProps!="function"||(c!==Tt||Et!==ct)&&Hi(i,nt,a,ct),jh=!1,Et=i.memoizedState,nt.state=Et,qh(i,a,nt,_);var Mt=i.memoizedState;c!==Tt||Et!==Mt||Wf.current||jh?(typeof At=="function"&&(Di(i,s,At,a),Mt=i.memoizedState),(dt=jh||Fi(i,s,dt,a,Et,Mt,ct)||!1)?(gt||typeof nt.UNSAFE_componentWillUpdate!="function"&&typeof nt.componentWillUpdate!="function"||(typeof nt.componentWillUpdate=="function"&&nt.componentWillUpdate(a,Mt,ct),typeof nt.UNSAFE_componentWillUpdate=="function"&&nt.UNSAFE_componentWillUpdate(a,Mt,ct)),typeof nt.componentDidUpdate=="function"&&(i.flags|=4),typeof nt.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof nt.componentDidUpdate!="function"||c===e.memoizedProps&&Et===e.memoizedState||(i.flags|=4),typeof nt.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&Et===e.memoizedState||(i.flags|=1024),i.memoizedProps=a,i.memoizedState=Mt),nt.props=a,nt.state=Mt,nt.context=ct,a=dt):(typeof nt.componentDidUpdate!="function"||c===e.memoizedProps&&Et===e.memoizedState||(i.flags|=4),typeof nt.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&Et===e.memoizedState||(i.flags|=1024),a=!1)}return jj(e,i,s,a,et,_)}function jj(e,i,s,a,_,et){gj(e,i);var nt=(i.flags&128)!==0;if(!a&&!nt)return _&&dg(i,s,!1),Zi(e,i,et);a=i.stateNode,Wi.current=i;var c=nt&&typeof s.getDerivedStateFromError!="function"?null:a.render();return i.flags|=1,e!==null&&nt?(i.child=Ug(i,e.child,null,et),i.child=Ug(i,null,c,et)):Xi(e,i,c,et),i.memoizedState=a.state,_&&dg(i,s,!0),i.child}function kj(e){var i=e.stateNode;i.pendingContext?ag(e,i.pendingContext,i.pendingContext!==i.context):i.context&&ag(e,i.context,!1),yh(e,i.containerInfo)}function lj(e,i,s,a,_){return Ig(),Jg(_),i.flags|=256,Xi(e,i,s,a),i.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(e){return{baseLanes:e,cachePool:null,transitions:null}}function oj(e,i,s){var a=i.pendingProps,_=L$1.current,et=!1,nt=(i.flags&128)!==0,c;if((c=nt)||(c=e!==null&&e.memoizedState===null?!1:(_&2)!==0),c?(et=!0,i.flags&=-129):(e===null||e.memoizedState!==null)&&(_|=1),G(L$1,_&1),e===null)return Eg(i),e=i.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(i.mode&1?e.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(nt=a.children,e=a.fallback,et?(a=i.mode,et=i.child,nt={mode:"hidden",children:nt},!(a&1)&&et!==null?(et.childLanes=0,et.pendingProps=nt):et=pj(nt,a,0,null),e=Tg(e,a,s,null),et.return=i,e.return=i,et.sibling=e,i.child=et,i.child.memoizedState=nj(s),i.memoizedState=mj,e):qj(i,nt));if(_=e.memoizedState,_!==null&&(c=_.dehydrated,c!==null))return rj(e,i,nt,a,c,_,s);if(et){et=a.fallback,nt=i.mode,_=e.child,c=_.sibling;var ct={mode:"hidden",children:a.children};return!(nt&1)&&i.child!==_?(a=i.child,a.childLanes=0,a.pendingProps=ct,i.deletions=null):(a=Pg(_,ct),a.subtreeFlags=_.subtreeFlags&14680064),c!==null?et=Pg(c,et):(et=Tg(et,nt,s,null),et.flags|=2),et.return=i,a.return=i,a.sibling=et,i.child=a,a=et,et=i.child,nt=e.child.memoizedState,nt=nt===null?nj(s):{baseLanes:nt.baseLanes|s,cachePool:null,transitions:nt.transitions},et.memoizedState=nt,et.childLanes=e.childLanes&~s,i.memoizedState=mj,a}return et=e.child,e=et.sibling,a=Pg(et,{mode:"visible",children:a.children}),!(i.mode&1)&&(a.lanes=s),a.return=i,a.sibling=null,e!==null&&(s=i.deletions,s===null?(i.deletions=[e],i.flags|=16):s.push(e)),i.child=a,i.memoizedState=null,a}function qj(e,i){return i=pj({mode:"visible",children:i},e.mode,0,null),i.return=e,e.child=i}function sj(e,i,s,a){return a!==null&&Jg(a),Ug(i,e.child,null,s),e=qj(i,i.pendingProps.children),e.flags|=2,i.memoizedState=null,e}function rj(e,i,s,a,_,et,nt){if(s)return i.flags&256?(i.flags&=-257,a=Ki(Error(p(422))),sj(e,i,nt,a)):i.memoizedState!==null?(i.child=e.child,i.flags|=128,null):(et=a.fallback,_=i.mode,a=pj({mode:"visible",children:a.children},_,0,null),et=Tg(et,_,nt,null),et.flags|=2,a.return=i,et.return=i,a.sibling=et,i.child=a,i.mode&1&&Ug(i,e.child,null,nt),i.child.memoizedState=nj(nt),i.memoizedState=mj,et);if(!(i.mode&1))return sj(e,i,nt,null);if(_.data==="$!"){if(a=_.nextSibling&&_.nextSibling.dataset,a)var c=a.dgst;return a=c,et=Error(p(419)),a=Ki(et,a,void 0),sj(e,i,nt,a)}if(c=(nt&e.childLanes)!==0,dh||c){if(a=Q,a!==null){switch(nt&-nt){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(a.suspendedLanes|nt)?0:_,_!==0&&_!==et.retryLane&&(et.retryLane=_,ih(e,_),gi(a,e,_,-1))}return tj(),a=Ki(Error(p(421))),sj(e,i,nt,a)}return _.data==="$?"?(i.flags|=128,i.child=e.child,i=uj.bind(null,e),_._reactRetry=i,null):(e=et.treeContext,yg=Lf(_.nextSibling),xg=i,I=!0,zg=null,e!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=e.id,sg=e.overflow,qg=i),i=qj(i,a.children),i.flags|=4096,i)}function vj(e,i,s){e.lanes|=i;var a=e.alternate;a!==null&&(a.lanes|=i),bh(e.return,i,s)}function wj(e,i,s,a,_){var et=e.memoizedState;et===null?e.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:a,tail:s,tailMode:_}:(et.isBackwards=i,et.rendering=null,et.renderingStartTime=0,et.last=a,et.tail=s,et.tailMode=_)}function xj(e,i,s){var a=i.pendingProps,_=a.revealOrder,et=a.tail;if(Xi(e,i,a.children,s),a=L$1.current,a&2)a=a&1|2,i.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=i.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&vj(e,s,i);else if(e.tag===19)vj(e,s,i);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break e;for(;e.sibling===null;){if(e.return===null||e.return===i)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}a&=1}if(G(L$1,a),!(i.mode&1))i.memoizedState=null;else switch(_){case"forwards":for(s=i.child,_=null;s!==null;)e=s.alternate,e!==null&&Ch(e)===null&&(_=s),s=s.sibling;s=_,s===null?(_=i.child,i.child=null):(_=s.sibling,s.sibling=null),wj(i,!1,_,s,et);break;case"backwards":for(s=null,_=i.child,i.child=null;_!==null;){if(e=_.alternate,e!==null&&Ch(e)===null){i.child=_;break}e=_.sibling,_.sibling=s,s=_,_=e}wj(i,!0,s,null,et);break;case"together":wj(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function ij(e,i){!(i.mode&1)&&e!==null&&(e.alternate=null,i.alternate=null,i.flags|=2)}function Zi(e,i,s){if(e!==null&&(i.dependencies=e.dependencies),rh|=i.lanes,!(s&i.childLanes))return null;if(e!==null&&i.child!==e.child)throw Error(p(153));if(i.child!==null){for(e=i.child,s=Pg(e,e.pendingProps),i.child=s,s.return=i;e.sibling!==null;)e=e.sibling,s=s.sibling=Pg(e,e.pendingProps),s.return=i;s.sibling=null}return i.child}function yj(e,i,s){switch(i.tag){case 3:kj(i),Ig();break;case 5:Ah(i);break;case 1:Zf(i.type)&&cg(i);break;case 4:yh(i,i.stateNode.containerInfo);break;case 10:var a=i.type._context,_=i.memoizedProps.value;G(Wg,a._currentValue),a._currentValue=_;break;case 13:if(a=i.memoizedState,a!==null)return a.dehydrated!==null?(G(L$1,L$1.current&1),i.flags|=128,null):s&i.child.childLanes?oj(e,i,s):(G(L$1,L$1.current&1),e=Zi(e,i,s),e!==null?e.sibling:null);G(L$1,L$1.current&1);break;case 19:if(a=(s&i.childLanes)!==0,e.flags&128){if(a)return xj(e,i,s);i.flags|=128}if(_=i.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),G(L$1,L$1.current),a)break;return null;case 22:case 23:return i.lanes=0,dj(e,i,s)}return Zi(e,i,s)}var zj,Aj,Bj,Cj;zj=function(e,i){for(var s=i.child;s!==null;){if(s.tag===5||s.tag===6)e.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};Aj=function(){};Bj=function(e,i,s,a){var _=e.memoizedProps;if(_!==a){e=i.stateNode,xh(uh.current);var et=null;switch(s){case"input":_=Ya(e,_),a=Ya(e,a),et=[];break;case"select":_=A({},_,{value:void 0}),a=A({},a,{value:void 0}),et=[];break;case"textarea":_=gb(e,_),a=gb(e,a),et=[];break;default:typeof _.onClick!="function"&&typeof a.onClick=="function"&&(e.onclick=Bf)}ub(s,a);var nt;s=null;for(dt in _)if(!a.hasOwnProperty(dt)&&_.hasOwnProperty(dt)&&_[dt]!=null)if(dt==="style"){var c=_[dt];for(nt in c)c.hasOwnProperty(nt)&&(s||(s={}),s[nt]="")}else dt!=="dangerouslySetInnerHTML"&&dt!=="children"&&dt!=="suppressContentEditableWarning"&&dt!=="suppressHydrationWarning"&&dt!=="autoFocus"&&(ea.hasOwnProperty(dt)?et||(et=[]):(et=et||[]).push(dt,null));for(dt in a){var ct=a[dt];if(c=_!=null?_[dt]:void 0,a.hasOwnProperty(dt)&&ct!==c&&(ct!=null||c!=null))if(dt==="style")if(c){for(nt in c)!c.hasOwnProperty(nt)||ct&&ct.hasOwnProperty(nt)||(s||(s={}),s[nt]="");for(nt in ct)ct.hasOwnProperty(nt)&&c[nt]!==ct[nt]&&(s||(s={}),s[nt]=ct[nt])}else s||(et||(et=[]),et.push(dt,s)),s=ct;else dt==="dangerouslySetInnerHTML"?(ct=ct?ct.__html:void 0,c=c?c.__html:void 0,ct!=null&&c!==ct&&(et=et||[]).push(dt,ct)):dt==="children"?typeof ct!="string"&&typeof ct!="number"||(et=et||[]).push(dt,""+ct):dt!=="suppressContentEditableWarning"&&dt!=="suppressHydrationWarning"&&(ea.hasOwnProperty(dt)?(ct!=null&&dt==="onScroll"&&D$1("scroll",e),et||c===ct||(et=[])):(et=et||[]).push(dt,ct))}s&&(et=et||[]).push("style",s);var dt=et;(i.updateQueue=dt)&&(i.flags|=4)}};Cj=function(e,i,s,a){s!==a&&(i.flags|=4)};function Dj(e,i){if(!I)switch(e.tailMode){case"hidden":i=e.tail;for(var s=null;i!==null;)i.alternate!==null&&(s=i),i=i.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var a=null;s!==null;)s.alternate!==null&&(a=s),s=s.sibling;a===null?i||e.tail===null?e.tail=null:e.tail.sibling=null:a.sibling=null}}function S(e){var i=e.alternate!==null&&e.alternate.child===e.child,s=0,a=0;if(i)for(var _=e.child;_!==null;)s|=_.lanes|_.childLanes,a|=_.subtreeFlags&14680064,a|=_.flags&14680064,_.return=e,_=_.sibling;else for(_=e.child;_!==null;)s|=_.lanes|_.childLanes,a|=_.subtreeFlags,a|=_.flags,_.return=e,_=_.sibling;return e.subtreeFlags|=a,e.childLanes=s,i}function Ej(e,i,s){var a=i.pendingProps;switch(wg(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S(i),null;case 1:return Zf(i.type)&&$f(),S(i),null;case 3:return a=i.stateNode,zh(),E$1(Wf),E$1(H),Eh(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(Gg(i)?i.flags|=4:e===null||e.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(e,i),S(i),null;case 5:Bh(i);var _=xh(wh.current);if(s=i.type,e!==null&&i.stateNode!=null)Bj(e,i,s,a,_),e.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!a){if(i.stateNode===null)throw Error(p(166));return S(i),null}if(e=xh(uh.current),Gg(i)){a=i.stateNode,s=i.type;var et=i.memoizedProps;switch(a[Of]=i,a[Pf]=et,e=(i.mode&1)!==0,s){case"dialog":D$1("cancel",a),D$1("close",a);break;case"iframe":case"object":case"embed":D$1("load",a);break;case"video":case"audio":for(_=0;_<lf.length;_++)D$1(lf[_],a);break;case"source":D$1("error",a);break;case"img":case"image":case"link":D$1("error",a),D$1("load",a);break;case"details":D$1("toggle",a);break;case"input":Za(a,et),D$1("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!et.multiple},D$1("invalid",a);break;case"textarea":hb(a,et),D$1("invalid",a)}ub(s,et),_=null;for(var nt in et)if(et.hasOwnProperty(nt)){var c=et[nt];nt==="children"?typeof c=="string"?a.textContent!==c&&(et.suppressHydrationWarning!==!0&&Af(a.textContent,c,e),_=["children",c]):typeof c=="number"&&a.textContent!==""+c&&(et.suppressHydrationWarning!==!0&&Af(a.textContent,c,e),_=["children",""+c]):ea.hasOwnProperty(nt)&&c!=null&&nt==="onScroll"&&D$1("scroll",a)}switch(s){case"input":Va(a),db(a,et,!0);break;case"textarea":Va(a),jb(a);break;case"select":case"option":break;default:typeof et.onClick=="function"&&(a.onclick=Bf)}a=_,i.updateQueue=a,a!==null&&(i.flags|=4)}else{nt=_.nodeType===9?_:_.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=kb(s)),e==="http://www.w3.org/1999/xhtml"?s==="script"?(e=nt.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof a.is=="string"?e=nt.createElement(s,{is:a.is}):(e=nt.createElement(s),s==="select"&&(nt=e,a.multiple?nt.multiple=!0:a.size&&(nt.size=a.size))):e=nt.createElementNS(e,s),e[Of]=i,e[Pf]=a,zj(e,i,!1,!1),i.stateNode=e;e:{switch(nt=vb(s,a),s){case"dialog":D$1("cancel",e),D$1("close",e),_=a;break;case"iframe":case"object":case"embed":D$1("load",e),_=a;break;case"video":case"audio":for(_=0;_<lf.length;_++)D$1(lf[_],e);_=a;break;case"source":D$1("error",e),_=a;break;case"img":case"image":case"link":D$1("error",e),D$1("load",e),_=a;break;case"details":D$1("toggle",e),_=a;break;case"input":Za(e,a),_=Ya(e,a),D$1("invalid",e);break;case"option":_=a;break;case"select":e._wrapperState={wasMultiple:!!a.multiple},_=A({},a,{value:void 0}),D$1("invalid",e);break;case"textarea":hb(e,a),_=gb(e,a),D$1("invalid",e);break;default:_=a}ub(s,_),c=_;for(et in c)if(c.hasOwnProperty(et)){var ct=c[et];et==="style"?sb(e,ct):et==="dangerouslySetInnerHTML"?(ct=ct?ct.__html:void 0,ct!=null&&nb(e,ct)):et==="children"?typeof ct=="string"?(s!=="textarea"||ct!=="")&&ob(e,ct):typeof ct=="number"&&ob(e,""+ct):et!=="suppressContentEditableWarning"&&et!=="suppressHydrationWarning"&&et!=="autoFocus"&&(ea.hasOwnProperty(et)?ct!=null&&et==="onScroll"&&D$1("scroll",e):ct!=null&&ta(e,et,ct,nt))}switch(s){case"input":Va(e),db(e,a,!1);break;case"textarea":Va(e),jb(e);break;case"option":a.value!=null&&e.setAttribute("value",""+Sa(a.value));break;case"select":e.multiple=!!a.multiple,et=a.value,et!=null?fb(e,!!a.multiple,et,!1):a.defaultValue!=null&&fb(e,!!a.multiple,a.defaultValue,!0);break;default:typeof _.onClick=="function"&&(e.onclick=Bf)}switch(s){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return S(i),null;case 6:if(e&&i.stateNode!=null)Cj(e,i,e.memoizedProps,a);else{if(typeof a!="string"&&i.stateNode===null)throw Error(p(166));if(s=xh(wh.current),xh(uh.current),Gg(i)){if(a=i.stateNode,s=i.memoizedProps,a[Of]=i,(et=a.nodeValue!==s)&&(e=xg,e!==null))switch(e.tag){case 3:Af(a.nodeValue,s,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Af(a.nodeValue,s,(e.mode&1)!==0)}et&&(i.flags|=4)}else a=(s.nodeType===9?s:s.ownerDocument).createTextNode(a),a[Of]=i,i.stateNode=a}return S(i),null;case 13:if(E$1(L$1),a=i.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(I&&yg!==null&&i.mode&1&&!(i.flags&128))Hg(),Ig(),i.flags|=98560,et=!1;else if(et=Gg(i),a!==null&&a.dehydrated!==null){if(e===null){if(!et)throw Error(p(318));if(et=i.memoizedState,et=et!==null?et.dehydrated:null,!et)throw Error(p(317));et[Of]=i}else Ig(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;S(i),et=!1}else zg!==null&&(Fj(zg),zg=null),et=!0;if(!et)return i.flags&65536?i:null}return i.flags&128?(i.lanes=s,i):(a=a!==null,a!==(e!==null&&e.memoizedState!==null)&&a&&(i.child.flags|=8192,i.mode&1&&(e===null||L$1.current&1?T===0&&(T=3):tj())),i.updateQueue!==null&&(i.flags|=4),S(i),null);case 4:return zh(),Aj(e,i),e===null&&sf(i.stateNode.containerInfo),S(i),null;case 10:return ah(i.type._context),S(i),null;case 17:return Zf(i.type)&&$f(),S(i),null;case 19:if(E$1(L$1),et=i.memoizedState,et===null)return S(i),null;if(a=(i.flags&128)!==0,nt=et.rendering,nt===null)if(a)Dj(et,!1);else{if(T!==0||e!==null&&e.flags&128)for(e=i.child;e!==null;){if(nt=Ch(e),nt!==null){for(i.flags|=128,Dj(et,!1),a=nt.updateQueue,a!==null&&(i.updateQueue=a,i.flags|=4),i.subtreeFlags=0,a=s,s=i.child;s!==null;)et=s,e=a,et.flags&=14680066,nt=et.alternate,nt===null?(et.childLanes=0,et.lanes=e,et.child=null,et.subtreeFlags=0,et.memoizedProps=null,et.memoizedState=null,et.updateQueue=null,et.dependencies=null,et.stateNode=null):(et.childLanes=nt.childLanes,et.lanes=nt.lanes,et.child=nt.child,et.subtreeFlags=0,et.deletions=null,et.memoizedProps=nt.memoizedProps,et.memoizedState=nt.memoizedState,et.updateQueue=nt.updateQueue,et.type=nt.type,e=nt.dependencies,et.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),s=s.sibling;return G(L$1,L$1.current&1|2),i.child}e=e.sibling}et.tail!==null&&B()>Gj&&(i.flags|=128,a=!0,Dj(et,!1),i.lanes=4194304)}else{if(!a)if(e=Ch(nt),e!==null){if(i.flags|=128,a=!0,s=e.updateQueue,s!==null&&(i.updateQueue=s,i.flags|=4),Dj(et,!0),et.tail===null&&et.tailMode==="hidden"&&!nt.alternate&&!I)return S(i),null}else 2*B()-et.renderingStartTime>Gj&&s!==1073741824&&(i.flags|=128,a=!0,Dj(et,!1),i.lanes=4194304);et.isBackwards?(nt.sibling=i.child,i.child=nt):(s=et.last,s!==null?s.sibling=nt:i.child=nt,et.last=nt)}return et.tail!==null?(i=et.tail,et.rendering=i,et.tail=i.sibling,et.renderingStartTime=B(),i.sibling=null,s=L$1.current,G(L$1,a?s&1|2:s&1),i):(S(i),null);case 22:case 23:return Hj(),a=i.memoizedState!==null,e!==null&&e.memoizedState!==null!==a&&(i.flags|=8192),a&&i.mode&1?fj&1073741824&&(S(i),i.subtreeFlags&6&&(i.flags|=8192)):S(i),null;case 24:return null;case 25:return null}throw Error(p(156,i.tag))}function Ij(e,i){switch(wg(i),i.tag){case 1:return Zf(i.type)&&$f(),e=i.flags,e&65536?(i.flags=e&-65537|128,i):null;case 3:return zh(),E$1(Wf),E$1(H),Eh(),e=i.flags,e&65536&&!(e&128)?(i.flags=e&-65537|128,i):null;case 5:return Bh(i),null;case 13:if(E$1(L$1),e=i.memoizedState,e!==null&&e.dehydrated!==null){if(i.alternate===null)throw Error(p(340));Ig()}return e=i.flags,e&65536?(i.flags=e&-65537|128,i):null;case 19:return E$1(L$1),null;case 4:return zh(),null;case 10:return ah(i.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Lj(e,i){var s=e.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(a){W(e,i,a)}else s.current=null}function Mj(e,i,s){try{s()}catch(a){W(e,i,a)}}var Nj=!1;function Oj(e,i){if(Cf=dd,e=Me(),Ne(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var a=s.getSelection&&s.getSelection();if(a&&a.rangeCount!==0){s=a.anchorNode;var _=a.anchorOffset,et=a.focusNode;a=a.focusOffset;try{s.nodeType,et.nodeType}catch{s=null;break e}var nt=0,c=-1,ct=-1,dt=0,gt=0,Tt=e,Et=null;t:for(;;){for(var At;Tt!==s||_!==0&&Tt.nodeType!==3||(c=nt+_),Tt!==et||a!==0&&Tt.nodeType!==3||(ct=nt+a),Tt.nodeType===3&&(nt+=Tt.nodeValue.length),(At=Tt.firstChild)!==null;)Et=Tt,Tt=At;for(;;){if(Tt===e)break t;if(Et===s&&++dt===_&&(c=nt),Et===et&&++gt===a&&(ct=nt),(At=Tt.nextSibling)!==null)break;Tt=Et,Et=Tt.parentNode}Tt=At}s=c===-1||ct===-1?null:{start:c,end:ct}}else s=null}s=s||{start:0,end:0}}else s=null;for(Df={focusedElem:e,selectionRange:s},dd=!1,V=i;V!==null;)if(i=V,e=i.child,(i.subtreeFlags&1028)!==0&&e!==null)e.return=i,V=e;else for(;V!==null;){i=V;try{var Mt=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(Mt!==null){var Pt=Mt.memoizedProps,$t=Mt.memoizedState,Lt=i.stateNode,Bt=Lt.getSnapshotBeforeUpdate(i.elementType===i.type?Pt:Ci(i.type,Pt),$t);Lt.__reactInternalSnapshotBeforeUpdate=Bt}break;case 3:var Nt=i.stateNode.containerInfo;Nt.nodeType===1?Nt.textContent="":Nt.nodeType===9&&Nt.documentElement&&Nt.removeChild(Nt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}catch(Vt){W(i,i.return,Vt)}if(e=i.sibling,e!==null){e.return=i.return,V=e;break}V=i.return}return Mt=Nj,Nj=!1,Mt}function Pj(e,i,s){var a=i.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var _=a=a.next;do{if((_.tag&e)===e){var et=_.destroy;_.destroy=void 0,et!==void 0&&Mj(i,s,et)}_=_.next}while(_!==a)}}function Qj(e,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var s=i=i.next;do{if((s.tag&e)===e){var a=s.create;s.destroy=a()}s=s.next}while(s!==i)}}function Rj(e){var i=e.ref;if(i!==null){var s=e.stateNode;switch(e.tag){case 5:e=s;break;default:e=s}typeof i=="function"?i(e):i.current=e}}function Sj(e){var i=e.alternate;i!==null&&(e.alternate=null,Sj(i)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(i=e.stateNode,i!==null&&(delete i[Of],delete i[Pf],delete i[of],delete i[Qf],delete i[Rf])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Tj(e){return e.tag===5||e.tag===3||e.tag===4}function Uj(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Tj(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Vj(e,i,s){var a=e.tag;if(a===5||a===6)e=e.stateNode,i?s.nodeType===8?s.parentNode.insertBefore(e,i):s.insertBefore(e,i):(s.nodeType===8?(i=s.parentNode,i.insertBefore(e,s)):(i=s,i.appendChild(e)),s=s._reactRootContainer,s!=null||i.onclick!==null||(i.onclick=Bf));else if(a!==4&&(e=e.child,e!==null))for(Vj(e,i,s),e=e.sibling;e!==null;)Vj(e,i,s),e=e.sibling}function Wj(e,i,s){var a=e.tag;if(a===5||a===6)e=e.stateNode,i?s.insertBefore(e,i):s.appendChild(e);else if(a!==4&&(e=e.child,e!==null))for(Wj(e,i,s),e=e.sibling;e!==null;)Wj(e,i,s),e=e.sibling}var X$1=null,Xj=!1;function Yj(e,i,s){for(s=s.child;s!==null;)Zj(e,i,s),s=s.sibling}function Zj(e,i,s){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,s)}catch{}switch(s.tag){case 5:U||Lj(s,i);case 6:var a=X$1,_=Xj;X$1=null,Yj(e,i,s),X$1=a,Xj=_,X$1!==null&&(Xj?(e=X$1,s=s.stateNode,e.nodeType===8?e.parentNode.removeChild(s):e.removeChild(s)):X$1.removeChild(s.stateNode));break;case 18:X$1!==null&&(Xj?(e=X$1,s=s.stateNode,e.nodeType===8?Kf(e.parentNode,s):e.nodeType===1&&Kf(e,s),bd(e)):Kf(X$1,s.stateNode));break;case 4:a=X$1,_=Xj,X$1=s.stateNode.containerInfo,Xj=!0,Yj(e,i,s),X$1=a,Xj=_;break;case 0:case 11:case 14:case 15:if(!U&&(a=s.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){_=a=a.next;do{var et=_,nt=et.destroy;et=et.tag,nt!==void 0&&(et&2||et&4)&&Mj(s,i,nt),_=_.next}while(_!==a)}Yj(e,i,s);break;case 1:if(!U&&(Lj(s,i),a=s.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=s.memoizedProps,a.state=s.memoizedState,a.componentWillUnmount()}catch(c){W(s,i,c)}Yj(e,i,s);break;case 21:Yj(e,i,s);break;case 22:s.mode&1?(U=(a=U)||s.memoizedState!==null,Yj(e,i,s),U=a):Yj(e,i,s);break;default:Yj(e,i,s)}}function ak(e){var i=e.updateQueue;if(i!==null){e.updateQueue=null;var s=e.stateNode;s===null&&(s=e.stateNode=new Kj),i.forEach(function(a){var _=bk.bind(null,e,a);s.has(a)||(s.add(a),a.then(_,_))})}}function ck(e,i){var s=i.deletions;if(s!==null)for(var a=0;a<s.length;a++){var _=s[a];try{var et=e,nt=i,c=nt;e:for(;c!==null;){switch(c.tag){case 5:X$1=c.stateNode,Xj=!1;break e;case 3:X$1=c.stateNode.containerInfo,Xj=!0;break e;case 4:X$1=c.stateNode.containerInfo,Xj=!0;break e}c=c.return}if(X$1===null)throw Error(p(160));Zj(et,nt,_),X$1=null,Xj=!1;var ct=_.alternate;ct!==null&&(ct.return=null),_.return=null}catch(dt){W(_,i,dt)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)dk(i,e),i=i.sibling}function dk(e,i){var s=e.alternate,a=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ck(i,e),ek(e),a&4){try{Pj(3,e,e.return),Qj(3,e)}catch(Pt){W(e,e.return,Pt)}try{Pj(5,e,e.return)}catch(Pt){W(e,e.return,Pt)}}break;case 1:ck(i,e),ek(e),a&512&&s!==null&&Lj(s,s.return);break;case 5:if(ck(i,e),ek(e),a&512&&s!==null&&Lj(s,s.return),e.flags&32){var _=e.stateNode;try{ob(_,"")}catch(Pt){W(e,e.return,Pt)}}if(a&4&&(_=e.stateNode,_!=null)){var et=e.memoizedProps,nt=s!==null?s.memoizedProps:et,c=e.type,ct=e.updateQueue;if(e.updateQueue=null,ct!==null)try{c==="input"&&et.type==="radio"&&et.name!=null&&ab(_,et),vb(c,nt);var dt=vb(c,et);for(nt=0;nt<ct.length;nt+=2){var gt=ct[nt],Tt=ct[nt+1];gt==="style"?sb(_,Tt):gt==="dangerouslySetInnerHTML"?nb(_,Tt):gt==="children"?ob(_,Tt):ta(_,gt,Tt,dt)}switch(c){case"input":bb(_,et);break;case"textarea":ib(_,et);break;case"select":var Et=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!et.multiple;var At=et.value;At!=null?fb(_,!!et.multiple,At,!1):Et!==!!et.multiple&&(et.defaultValue!=null?fb(_,!!et.multiple,et.defaultValue,!0):fb(_,!!et.multiple,et.multiple?[]:"",!1))}_[Pf]=et}catch(Pt){W(e,e.return,Pt)}}break;case 6:if(ck(i,e),ek(e),a&4){if(e.stateNode===null)throw Error(p(162));_=e.stateNode,et=e.memoizedProps;try{_.nodeValue=et}catch(Pt){W(e,e.return,Pt)}}break;case 3:if(ck(i,e),ek(e),a&4&&s!==null&&s.memoizedState.isDehydrated)try{bd(i.containerInfo)}catch(Pt){W(e,e.return,Pt)}break;case 4:ck(i,e),ek(e);break;case 13:ck(i,e),ek(e),_=e.child,_.flags&8192&&(et=_.memoizedState!==null,_.stateNode.isHidden=et,!et||_.alternate!==null&&_.alternate.memoizedState!==null||(fk=B())),a&4&&ak(e);break;case 22:if(gt=s!==null&&s.memoizedState!==null,e.mode&1?(U=(dt=U)||gt,ck(i,e),U=dt):ck(i,e),ek(e),a&8192){if(dt=e.memoizedState!==null,(e.stateNode.isHidden=dt)&&!gt&&e.mode&1)for(V=e,gt=e.child;gt!==null;){for(Tt=V=gt;V!==null;){switch(Et=V,At=Et.child,Et.tag){case 0:case 11:case 14:case 15:Pj(4,Et,Et.return);break;case 1:Lj(Et,Et.return);var Mt=Et.stateNode;if(typeof Mt.componentWillUnmount=="function"){a=Et,s=Et.return;try{i=a,Mt.props=i.memoizedProps,Mt.state=i.memoizedState,Mt.componentWillUnmount()}catch(Pt){W(a,s,Pt)}}break;case 5:Lj(Et,Et.return);break;case 22:if(Et.memoizedState!==null){gk(Tt);continue}}At!==null?(At.return=Et,V=At):gk(Tt)}gt=gt.sibling}e:for(gt=null,Tt=e;;){if(Tt.tag===5){if(gt===null){gt=Tt;try{_=Tt.stateNode,dt?(et=_.style,typeof et.setProperty=="function"?et.setProperty("display","none","important"):et.display="none"):(c=Tt.stateNode,ct=Tt.memoizedProps.style,nt=ct!=null&&ct.hasOwnProperty("display")?ct.display:null,c.style.display=rb("display",nt))}catch(Pt){W(e,e.return,Pt)}}}else if(Tt.tag===6){if(gt===null)try{Tt.stateNode.nodeValue=dt?"":Tt.memoizedProps}catch(Pt){W(e,e.return,Pt)}}else if((Tt.tag!==22&&Tt.tag!==23||Tt.memoizedState===null||Tt===e)&&Tt.child!==null){Tt.child.return=Tt,Tt=Tt.child;continue}if(Tt===e)break e;for(;Tt.sibling===null;){if(Tt.return===null||Tt.return===e)break e;gt===Tt&&(gt=null),Tt=Tt.return}gt===Tt&&(gt=null),Tt.sibling.return=Tt.return,Tt=Tt.sibling}}break;case 19:ck(i,e),ek(e),a&4&&ak(e);break;case 21:break;default:ck(i,e),ek(e)}}function ek(e){var i=e.flags;if(i&2){try{e:{for(var s=e.return;s!==null;){if(Tj(s)){var a=s;break e}s=s.return}throw Error(p(160))}switch(a.tag){case 5:var _=a.stateNode;a.flags&32&&(ob(_,""),a.flags&=-33);var et=Uj(e);Wj(e,et,_);break;case 3:case 4:var nt=a.stateNode.containerInfo,c=Uj(e);Vj(e,c,nt);break;default:throw Error(p(161))}}catch(ct){W(e,e.return,ct)}e.flags&=-3}i&4096&&(e.flags&=-4097)}function hk(e,i,s){V=e,ik(e)}function ik(e,i,s){for(var a=(e.mode&1)!==0;V!==null;){var _=V,et=_.child;if(_.tag===22&&a){var nt=_.memoizedState!==null||Jj;if(!nt){var c=_.alternate,ct=c!==null&&c.memoizedState!==null||U;c=Jj;var dt=U;if(Jj=nt,(U=ct)&&!dt)for(V=_;V!==null;)nt=V,ct=nt.child,nt.tag===22&&nt.memoizedState!==null?jk(_):ct!==null?(ct.return=nt,V=ct):jk(_);for(;et!==null;)V=et,ik(et),et=et.sibling;V=_,Jj=c,U=dt}kk(e)}else _.subtreeFlags&8772&&et!==null?(et.return=_,V=et):kk(e)}}function kk(e){for(;V!==null;){var i=V;if(i.flags&8772){var s=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:U||Qj(5,i);break;case 1:var a=i.stateNode;if(i.flags&4&&!U)if(s===null)a.componentDidMount();else{var _=i.elementType===i.type?s.memoizedProps:Ci(i.type,s.memoizedProps);a.componentDidUpdate(_,s.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var et=i.updateQueue;et!==null&&sh(i,et,a);break;case 3:var nt=i.updateQueue;if(nt!==null){if(s=null,i.child!==null)switch(i.child.tag){case 5:s=i.child.stateNode;break;case 1:s=i.child.stateNode}sh(i,nt,s)}break;case 5:var c=i.stateNode;if(s===null&&i.flags&4){s=c;var ct=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":ct.autoFocus&&s.focus();break;case"img":ct.src&&(s.src=ct.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var dt=i.alternate;if(dt!==null){var gt=dt.memoizedState;if(gt!==null){var Tt=gt.dehydrated;Tt!==null&&bd(Tt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p(163))}U||i.flags&512&&Rj(i)}catch(Et){W(i,i.return,Et)}}if(i===e){V=null;break}if(s=i.sibling,s!==null){s.return=i.return,V=s;break}V=i.return}}function gk(e){for(;V!==null;){var i=V;if(i===e){V=null;break}var s=i.sibling;if(s!==null){s.return=i.return,V=s;break}V=i.return}}function jk(e){for(;V!==null;){var i=V;try{switch(i.tag){case 0:case 11:case 15:var s=i.return;try{Qj(4,i)}catch(ct){W(i,s,ct)}break;case 1:var a=i.stateNode;if(typeof a.componentDidMount=="function"){var _=i.return;try{a.componentDidMount()}catch(ct){W(i,_,ct)}}var et=i.return;try{Rj(i)}catch(ct){W(i,et,ct)}break;case 5:var nt=i.return;try{Rj(i)}catch(ct){W(i,nt,ct)}}}catch(ct){W(i,i.return,ct)}if(i===e){V=null;break}var c=i.sibling;if(c!==null){c.return=i.return,V=c;break}V=i.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K=0,Q=null,Y=null,Z=0,fj=0,ej=Uf(0),T=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R(){return K&6?B():Ak!==-1?Ak:Ak=B()}function yi(e){return e.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(e=C,e!==0||(e=window.event,e=e===void 0?16:jd(e.type)),e):1}function gi(e,i,s,a){if(50<yk)throw yk=0,zk=null,Error(p(185));Ac(e,s,a),(!(K&2)||e!==Q)&&(e===Q&&(!(K&2)&&(qk|=s),T===4&&Ck(e,Z)),Dk(e,a),s===1&&K===0&&!(i.mode&1)&&(Gj=B()+500,fg&&jg()))}function Dk(e,i){var s=e.callbackNode;wc(e,i);var a=uc(e,e===Q?Z:0);if(a===0)s!==null&&bc(s),e.callbackNode=null,e.callbackPriority=0;else if(i=a&-a,e.callbackPriority!==i){if(s!=null&&bc(s),i===1)e.tag===0?ig(Ek.bind(null,e)):hg(Ek.bind(null,e)),Jf(function(){!(K&6)&&jg()}),s=null;else{switch(Dc(a)){case 1:s=fc;break;case 4:s=gc;break;case 16:s=hc;break;case 536870912:s=jc;break;default:s=hc}s=Fk(s,Gk.bind(null,e))}e.callbackPriority=i,e.callbackNode=s}}function Gk(e,i){if(Ak=-1,Bk=0,K&6)throw Error(p(327));var s=e.callbackNode;if(Hk()&&e.callbackNode!==s)return null;var a=uc(e,e===Q?Z:0);if(a===0)return null;if(a&30||a&e.expiredLanes||i)i=Ik(e,a);else{i=a;var _=K;K|=2;var et=Jk();(Q!==e||Z!==i)&&(uk=null,Gj=B()+500,Kk(e,i));do try{Lk();break}catch(c){Mk(e,c)}while(!0);$g(),mk.current=et,K=_,Y!==null?i=0:(Q=null,Z=0,i=T)}if(i!==0){if(i===2&&(_=xc(e),_!==0&&(a=_,i=Nk(e,_))),i===1)throw s=pk,Kk(e,0),Ck(e,a),Dk(e,B()),s;if(i===6)Ck(e,a);else{if(_=e.current.alternate,!(a&30)&&!Ok(_)&&(i=Ik(e,a),i===2&&(et=xc(e),et!==0&&(a=et,i=Nk(e,et))),i===1))throw s=pk,Kk(e,0),Ck(e,a),Dk(e,B()),s;switch(e.finishedWork=_,e.finishedLanes=a,i){case 0:case 1:throw Error(p(345));case 2:Pk(e,tk,uk);break;case 3:if(Ck(e,a),(a&130023424)===a&&(i=fk+500-B(),10<i)){if(uc(e,0)!==0)break;if(_=e.suspendedLanes,(_&a)!==a){R(),e.pingedLanes|=e.suspendedLanes&_;break}e.timeoutHandle=Ff(Pk.bind(null,e,tk,uk),i);break}Pk(e,tk,uk);break;case 4:if(Ck(e,a),(a&4194240)===a)break;for(i=e.eventTimes,_=-1;0<a;){var nt=31-oc(a);et=1<<nt,nt=i[nt],nt>_&&(_=nt),a&=~et}if(a=_,a=B()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*lk(a/1960))-a,10<a){e.timeoutHandle=Ff(Pk.bind(null,e,tk,uk),a);break}Pk(e,tk,uk);break;case 5:Pk(e,tk,uk);break;default:throw Error(p(329))}}}return Dk(e,B()),e.callbackNode===s?Gk.bind(null,e):null}function Nk(e,i){var s=sk;return e.current.memoizedState.isDehydrated&&(Kk(e,i).flags|=256),e=Ik(e,i),e!==2&&(i=tk,tk=s,i!==null&&Fj(i)),e}function Fj(e){tk===null?tk=e:tk.push.apply(tk,e)}function Ok(e){for(var i=e;;){if(i.flags&16384){var s=i.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var a=0;a<s.length;a++){var _=s[a],et=_.getSnapshot;_=_.value;try{if(!He(et(),_))return!1}catch{return!1}}}if(s=i.child,i.subtreeFlags&16384&&s!==null)s.return=i,i=s;else{if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Ck(e,i){for(i&=~rk,i&=~qk,e.suspendedLanes|=i,e.pingedLanes&=~i,e=e.expirationTimes;0<i;){var s=31-oc(i),a=1<<s;e[s]=-1,i&=~a}}function Ek(e){if(K&6)throw Error(p(327));Hk();var i=uc(e,0);if(!(i&1))return Dk(e,B()),null;var s=Ik(e,i);if(e.tag!==0&&s===2){var a=xc(e);a!==0&&(i=a,s=Nk(e,a))}if(s===1)throw s=pk,Kk(e,0),Ck(e,i),Dk(e,B()),s;if(s===6)throw Error(p(345));return e.finishedWork=e.current.alternate,e.finishedLanes=i,Pk(e,tk,uk),Dk(e,B()),null}function Qk(e,i){var s=K;K|=1;try{return e(i)}finally{K=s,K===0&&(Gj=B()+500,fg&&jg())}}function Rk(e){wk!==null&&wk.tag===0&&!(K&6)&&Hk();var i=K;K|=1;var s=ok.transition,a=C;try{if(ok.transition=null,C=1,e)return e()}finally{C=a,ok.transition=s,K=i,!(K&6)&&jg()}}function Hj(){fj=ej.current,E$1(ej)}function Kk(e,i){e.finishedWork=null,e.finishedLanes=0;var s=e.timeoutHandle;if(s!==-1&&(e.timeoutHandle=-1,Gf(s)),Y!==null)for(s=Y.return;s!==null;){var a=s;switch(wg(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&$f();break;case 3:zh(),E$1(Wf),E$1(H),Eh();break;case 5:Bh(a);break;case 4:zh();break;case 13:E$1(L$1);break;case 19:E$1(L$1);break;case 10:ah(a.type._context);break;case 22:case 23:Hj()}s=s.return}if(Q=e,Y=e=Pg(e.current,null),Z=fj=i,T=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for(i=0;i<fh.length;i++)if(s=fh[i],a=s.interleaved,a!==null){s.interleaved=null;var _=a.next,et=s.pending;if(et!==null){var nt=et.next;et.next=_,a.next=nt}s.pending=a}fh=null}return e}function Mk(e,i){do{var s=Y;try{if($g(),Fh.current=Rh,Ih){for(var a=M$1.memoizedState;a!==null;){var _=a.queue;_!==null&&(_.pending=null),a=a.next}Ih=!1}if(Hh=0,O=N=M$1=null,Jh=!1,Kh=0,nk.current=null,s===null||s.return===null){T=1,pk=i,Y=null;break}e:{var et=e,nt=s.return,c=s,ct=i;if(i=Z,c.flags|=32768,ct!==null&&typeof ct=="object"&&typeof ct.then=="function"){var dt=ct,gt=c,Tt=gt.tag;if(!(gt.mode&1)&&(Tt===0||Tt===11||Tt===15)){var Et=gt.alternate;Et?(gt.updateQueue=Et.updateQueue,gt.memoizedState=Et.memoizedState,gt.lanes=Et.lanes):(gt.updateQueue=null,gt.memoizedState=null)}var At=Ui(nt);if(At!==null){At.flags&=-257,Vi(At,nt,c,et,i),At.mode&1&&Si(et,dt,i),i=At,ct=dt;var Mt=i.updateQueue;if(Mt===null){var Pt=new Set;Pt.add(ct),i.updateQueue=Pt}else Mt.add(ct);break e}else{if(!(i&1)){Si(et,dt,i),tj();break e}ct=Error(p(426))}}else if(I&&c.mode&1){var $t=Ui(nt);if($t!==null){!($t.flags&65536)&&($t.flags|=256),Vi($t,nt,c,et,i),Jg(Ji(ct,c));break e}}et=ct=Ji(ct,c),T!==4&&(T=2),sk===null?sk=[et]:sk.push(et),et=nt;do{switch(et.tag){case 3:et.flags|=65536,i&=-i,et.lanes|=i;var Lt=Ni(et,ct,i);ph(et,Lt);break e;case 1:c=ct;var Bt=et.type,Nt=et.stateNode;if(!(et.flags&128)&&(typeof Bt.getDerivedStateFromError=="function"||Nt!==null&&typeof Nt.componentDidCatch=="function"&&(Ri===null||!Ri.has(Nt)))){et.flags|=65536,i&=-i,et.lanes|=i;var Vt=Qi(et,c,i);ph(et,Vt);break e}}et=et.return}while(et!==null)}Sk(s)}catch(Xt){i=Xt,Y===s&&s!==null&&(Y=s=s.return);continue}break}while(!0)}function Jk(){var e=mk.current;return mk.current=Rh,e===null?Rh:e}function tj(){(T===0||T===3||T===2)&&(T=4),Q===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q,Z)}function Ik(e,i){var s=K;K|=2;var a=Jk();(Q!==e||Z!==i)&&(uk=null,Kk(e,i));do try{Tk();break}catch(_){Mk(e,_)}while(!0);if($g(),K=s,mk.current=a,Y!==null)throw Error(p(261));return Q=null,Z=0,T}function Tk(){for(;Y!==null;)Uk(Y)}function Lk(){for(;Y!==null&&!cc();)Uk(Y)}function Uk(e){var i=Vk(e.alternate,e,fj);e.memoizedProps=e.pendingProps,i===null?Sk(e):Y=i,nk.current=null}function Sk(e){var i=e;do{var s=i.alternate;if(e=i.return,i.flags&32768){if(s=Ij(s,i),s!==null){s.flags&=32767,Y=s;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{T=6,Y=null;return}}else if(s=Ej(s,i,fj),s!==null){Y=s;return}if(i=i.sibling,i!==null){Y=i;return}Y=i=e}while(i!==null);T===0&&(T=5)}function Pk(e,i,s){var a=C,_=ok.transition;try{ok.transition=null,C=1,Wk(e,i,s,a)}finally{ok.transition=_,C=a}return null}function Wk(e,i,s,a){do Hk();while(wk!==null);if(K&6)throw Error(p(327));s=e.finishedWork;var _=e.finishedLanes;if(s===null)return null;if(e.finishedWork=null,e.finishedLanes=0,s===e.current)throw Error(p(177));e.callbackNode=null,e.callbackPriority=0;var et=s.lanes|s.childLanes;if(Bc(e,et),e===Q&&(Y=Q=null,Z=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),et=(s.flags&15990)!==0,s.subtreeFlags&15990||et){et=ok.transition,ok.transition=null;var nt=C;C=1;var c=K;K|=4,nk.current=null,Oj(e,s),dk(s,e),Oe(Df),dd=!!Cf,Df=Cf=null,e.current=s,hk(s),dc(),K=c,C=nt,ok.transition=et}else e.current=s;if(vk&&(vk=!1,wk=e,xk=_),et=e.pendingLanes,et===0&&(Ri=null),mc(s.stateNode),Dk(e,B()),i!==null)for(a=e.onRecoverableError,s=0;s<i.length;s++)_=i[s],a(_.value,{componentStack:_.stack,digest:_.digest});if(Oi)throw Oi=!1,e=Pi,Pi=null,e;return xk&1&&e.tag!==0&&Hk(),et=e.pendingLanes,et&1?e===zk?yk++:(yk=0,zk=e):yk=0,jg(),null}function Hk(){if(wk!==null){var e=Dc(xk),i=ok.transition,s=C;try{if(ok.transition=null,C=16>e?16:e,wk===null)var a=!1;else{if(e=wk,wk=null,xk=0,K&6)throw Error(p(331));var _=K;for(K|=4,V=e.current;V!==null;){var et=V,nt=et.child;if(V.flags&16){var c=et.deletions;if(c!==null){for(var ct=0;ct<c.length;ct++){var dt=c[ct];for(V=dt;V!==null;){var gt=V;switch(gt.tag){case 0:case 11:case 15:Pj(8,gt,et)}var Tt=gt.child;if(Tt!==null)Tt.return=gt,V=Tt;else for(;V!==null;){gt=V;var Et=gt.sibling,At=gt.return;if(Sj(gt),gt===dt){V=null;break}if(Et!==null){Et.return=At,V=Et;break}V=At}}}var Mt=et.alternate;if(Mt!==null){var Pt=Mt.child;if(Pt!==null){Mt.child=null;do{var $t=Pt.sibling;Pt.sibling=null,Pt=$t}while(Pt!==null)}}V=et}}if(et.subtreeFlags&2064&&nt!==null)nt.return=et,V=nt;else e:for(;V!==null;){if(et=V,et.flags&2048)switch(et.tag){case 0:case 11:case 15:Pj(9,et,et.return)}var Lt=et.sibling;if(Lt!==null){Lt.return=et.return,V=Lt;break e}V=et.return}}var Bt=e.current;for(V=Bt;V!==null;){nt=V;var Nt=nt.child;if(nt.subtreeFlags&2064&&Nt!==null)Nt.return=nt,V=Nt;else e:for(nt=Bt;V!==null;){if(c=V,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Qj(9,c)}}catch(Xt){W(c,c.return,Xt)}if(c===nt){V=null;break e}var Vt=c.sibling;if(Vt!==null){Vt.return=c.return,V=Vt;break e}V=c.return}}if(K=_,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,e)}catch{}a=!0}return a}finally{C=s,ok.transition=i}}return!1}function Xk(e,i,s){i=Ji(s,i),i=Ni(e,i,1),e=nh(e,i,1),i=R(),e!==null&&(Ac(e,1,i),Dk(e,i))}function W(e,i,s){if(e.tag===3)Xk(e,e,s);else for(;i!==null;){if(i.tag===3){Xk(i,e,s);break}else if(i.tag===1){var a=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(Ri===null||!Ri.has(a))){e=Ji(s,e),e=Qi(i,e,1),i=nh(i,e,1),e=R(),i!==null&&(Ac(i,1,e),Dk(i,e));break}}i=i.return}}function Ti(e,i,s){var a=e.pingCache;a!==null&&a.delete(i),i=R(),e.pingedLanes|=e.suspendedLanes&s,Q===e&&(Z&s)===s&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-fk?Kk(e,0):rk|=s),Dk(e,i)}function Yk(e,i){i===0&&(e.mode&1?(i=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):i=1);var s=R();e=ih(e,i),e!==null&&(Ac(e,i,s),Dk(e,s))}function uj(e){var i=e.memoizedState,s=0;i!==null&&(s=i.retryLane),Yk(e,s)}function bk(e,i){var s=0;switch(e.tag){case 13:var a=e.stateNode,_=e.memoizedState;_!==null&&(s=_.retryLane);break;case 19:a=e.stateNode;break;default:throw Error(p(314))}a!==null&&a.delete(i),Yk(e,s)}var Vk;Vk=function(e,i,s){if(e!==null)if(e.memoizedProps!==i.pendingProps||Wf.current)dh=!0;else{if(!(e.lanes&s)&&!(i.flags&128))return dh=!1,yj(e,i,s);dh=!!(e.flags&131072)}else dh=!1,I&&i.flags&1048576&&ug(i,ng,i.index);switch(i.lanes=0,i.tag){case 2:var a=i.type;ij(e,i),e=i.pendingProps;var _=Yf(i,H.current);ch(i,s),_=Nh(null,i,a,e,_,s);var et=Sh();return i.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,Zf(a)?(et=!0,cg(i)):et=!1,i.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,kh(i),_.updater=Ei,i.stateNode=_,_._reactInternals=i,Ii(i,a,e,s),i=jj(null,i,a,!0,et,s)):(i.tag=0,I&&et&&vg(i),Xi(null,i,_,s),i=i.child),i;case 16:a=i.elementType;e:{switch(ij(e,i),e=i.pendingProps,_=a._init,a=_(a._payload),i.type=a,_=i.tag=Zk(a),e=Ci(a,e),_){case 0:i=cj(null,i,a,e,s);break e;case 1:i=hj(null,i,a,e,s);break e;case 11:i=Yi(null,i,a,e,s);break e;case 14:i=$i(null,i,a,Ci(a.type,e),s);break e}throw Error(p(306,a,""))}return i;case 0:return a=i.type,_=i.pendingProps,_=i.elementType===a?_:Ci(a,_),cj(e,i,a,_,s);case 1:return a=i.type,_=i.pendingProps,_=i.elementType===a?_:Ci(a,_),hj(e,i,a,_,s);case 3:e:{if(kj(i),e===null)throw Error(p(387));a=i.pendingProps,et=i.memoizedState,_=et.element,lh(e,i),qh(i,a,null,s);var nt=i.memoizedState;if(a=nt.element,et.isDehydrated)if(et={element:a,isDehydrated:!1,cache:nt.cache,pendingSuspenseBoundaries:nt.pendingSuspenseBoundaries,transitions:nt.transitions},i.updateQueue.baseState=et,i.memoizedState=et,i.flags&256){_=Ji(Error(p(423)),i),i=lj(e,i,a,s,_);break e}else if(a!==_){_=Ji(Error(p(424)),i),i=lj(e,i,a,s,_);break e}else for(yg=Lf(i.stateNode.containerInfo.firstChild),xg=i,I=!0,zg=null,s=Vg(i,null,a,s),i.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(Ig(),a===_){i=Zi(e,i,s);break e}Xi(e,i,a,s)}i=i.child}return i;case 5:return Ah(i),e===null&&Eg(i),a=i.type,_=i.pendingProps,et=e!==null?e.memoizedProps:null,nt=_.children,Ef(a,_)?nt=null:et!==null&&Ef(a,et)&&(i.flags|=32),gj(e,i),Xi(e,i,nt,s),i.child;case 6:return e===null&&Eg(i),null;case 13:return oj(e,i,s);case 4:return yh(i,i.stateNode.containerInfo),a=i.pendingProps,e===null?i.child=Ug(i,null,a,s):Xi(e,i,a,s),i.child;case 11:return a=i.type,_=i.pendingProps,_=i.elementType===a?_:Ci(a,_),Yi(e,i,a,_,s);case 7:return Xi(e,i,i.pendingProps,s),i.child;case 8:return Xi(e,i,i.pendingProps.children,s),i.child;case 12:return Xi(e,i,i.pendingProps.children,s),i.child;case 10:e:{if(a=i.type._context,_=i.pendingProps,et=i.memoizedProps,nt=_.value,G(Wg,a._currentValue),a._currentValue=nt,et!==null)if(He(et.value,nt)){if(et.children===_.children&&!Wf.current){i=Zi(e,i,s);break e}}else for(et=i.child,et!==null&&(et.return=i);et!==null;){var c=et.dependencies;if(c!==null){nt=et.child;for(var ct=c.firstContext;ct!==null;){if(ct.context===a){if(et.tag===1){ct=mh(-1,s&-s),ct.tag=2;var dt=et.updateQueue;if(dt!==null){dt=dt.shared;var gt=dt.pending;gt===null?ct.next=ct:(ct.next=gt.next,gt.next=ct),dt.pending=ct}}et.lanes|=s,ct=et.alternate,ct!==null&&(ct.lanes|=s),bh(et.return,s,i),c.lanes|=s;break}ct=ct.next}}else if(et.tag===10)nt=et.type===i.type?null:et.child;else if(et.tag===18){if(nt=et.return,nt===null)throw Error(p(341));nt.lanes|=s,c=nt.alternate,c!==null&&(c.lanes|=s),bh(nt,s,i),nt=et.sibling}else nt=et.child;if(nt!==null)nt.return=et;else for(nt=et;nt!==null;){if(nt===i){nt=null;break}if(et=nt.sibling,et!==null){et.return=nt.return,nt=et;break}nt=nt.return}et=nt}Xi(e,i,_.children,s),i=i.child}return i;case 9:return _=i.type,a=i.pendingProps.children,ch(i,s),_=eh(_),a=a(_),i.flags|=1,Xi(e,i,a,s),i.child;case 14:return a=i.type,_=Ci(a,i.pendingProps),_=Ci(a.type,_),$i(e,i,a,_,s);case 15:return bj(e,i,i.type,i.pendingProps,s);case 17:return a=i.type,_=i.pendingProps,_=i.elementType===a?_:Ci(a,_),ij(e,i),i.tag=1,Zf(a)?(e=!0,cg(i)):e=!1,ch(i,s),Gi(i,a,_),Ii(i,a,_,s),jj(null,i,a,!0,e,s);case 19:return xj(e,i,s);case 22:return dj(e,i,s)}throw Error(p(156,i.tag))};function Fk(e,i){return ac(e,i)}function $k(e,i,s,a){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(e,i,s,a){return new $k(e,i,s,a)}function aj(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Zk(e){if(typeof e=="function")return aj(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Da)return 11;if(e===Ga)return 14}return 2}function Pg(e,i){var s=e.alternate;return s===null?(s=Bg(e.tag,i,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=i,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&14680064,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,i=e.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s}function Rg(e,i,s,a,_,et){var nt=2;if(a=e,typeof e=="function")aj(e)&&(nt=1);else if(typeof e=="string")nt=5;else e:switch(e){case ya:return Tg(s.children,_,et,i);case za:nt=8,_|=8;break;case Aa:return e=Bg(12,s,i,_|2),e.elementType=Aa,e.lanes=et,e;case Ea:return e=Bg(13,s,i,_),e.elementType=Ea,e.lanes=et,e;case Fa:return e=Bg(19,s,i,_),e.elementType=Fa,e.lanes=et,e;case Ia:return pj(s,_,et,i);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Ba:nt=10;break e;case Ca:nt=9;break e;case Da:nt=11;break e;case Ga:nt=14;break e;case Ha:nt=16,a=null;break e}throw Error(p(130,e==null?e:typeof e,""))}return i=Bg(nt,s,i,_),i.elementType=e,i.type=a,i.lanes=et,i}function Tg(e,i,s,a){return e=Bg(7,e,a,i),e.lanes=s,e}function pj(e,i,s,a){return e=Bg(22,e,a,i),e.elementType=Ia,e.lanes=s,e.stateNode={isHidden:!1},e}function Qg(e,i,s){return e=Bg(6,e,null,i),e.lanes=s,e}function Sg(e,i,s){return i=Bg(4,e.children!==null?e.children:[],e.key,i),i.lanes=s,i.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},i}function al(e,i,s,a,_){this.tag=i,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=a,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function bl(e,i,s,a,_,et,nt,c,ct){return e=new al(e,i,s,c,ct),i===1?(i=1,et===!0&&(i|=8)):i=0,et=Bg(3,null,null,i),e.current=et,et.stateNode=e,et.memoizedState={element:a,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(et),e}function cl(e,i,s){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:a==null?null:""+a,children:e,containerInfo:i,implementation:s}}function dl(e){if(!e)return Vf;e=e._reactInternals;e:{if(Vb(e)!==e||e.tag!==1)throw Error(p(170));var i=e;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(Zf(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(p(171))}if(e.tag===1){var s=e.type;if(Zf(s))return bg(e,s,i)}return i}function el(e,i,s,a,_,et,nt,c,ct){return e=bl(s,a,!0,e,_,et,nt,c,ct),e.context=dl(null),s=e.current,a=R(),_=yi(s),et=mh(a,_),et.callback=i??null,nh(s,et,_),e.current.lanes=_,Ac(e,_,a),Dk(e,a),e}function fl(e,i,s,a){var _=i.current,et=R(),nt=yi(_);return s=dl(s),i.context===null?i.context=s:i.pendingContext=s,i=mh(et,nt),i.payload={element:e},a=a===void 0?null:a,a!==null&&(i.callback=a),e=nh(_,i,nt),e!==null&&(gi(e,_,nt,et),oh(e,_,nt)),nt}function gl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function hl(e,i){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<i?s:i}}function il(e,i){hl(e,i),(e=e.alternate)&&hl(e,i)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(e){console.error(e)};function ll(e){this._internalRoot=e}ml.prototype.render=ll.prototype.render=function(e){var i=this._internalRoot;if(i===null)throw Error(p(409));fl(e,i,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var i=e.containerInfo;Rk(function(){fl(null,e,null,null)}),i[uf]=null}};function ml(e){this._internalRoot=e}ml.prototype.unstable_scheduleHydration=function(e){if(e){var i=Hc();e={blockedOn:null,target:e,priority:i};for(var s=0;s<Qc.length&&i!==0&&i<Qc[s].priority;s++);Qc.splice(s,0,e),s===0&&Vc(e)}};function nl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function ol(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(e,i,s,a,_){if(_){if(typeof a=="function"){var et=a;a=function(){var dt=gl(nt);et.call(dt)}}var nt=el(i,a,e,0,null,!1,!1,"",pl);return e._reactRootContainer=nt,e[uf]=nt.current,sf(e.nodeType===8?e.parentNode:e),Rk(),nt}for(;_=e.lastChild;)e.removeChild(_);if(typeof a=="function"){var c=a;a=function(){var dt=gl(ct);c.call(dt)}}var ct=bl(e,0,!1,null,null,!1,!1,"",pl);return e._reactRootContainer=ct,e[uf]=ct.current,sf(e.nodeType===8?e.parentNode:e),Rk(function(){fl(i,ct,s,a)}),ct}function rl(e,i,s,a,_){var et=s._reactRootContainer;if(et){var nt=et;if(typeof _=="function"){var c=_;_=function(){var ct=gl(nt);c.call(ct)}}fl(i,nt,e,_)}else nt=ql(s,i,e,_,a);return gl(nt)}Ec=function(e){switch(e.tag){case 3:var i=e.stateNode;if(i.current.memoizedState.isDehydrated){var s=tc(i.pendingLanes);s!==0&&(Cc(i,s|1),Dk(i,B()),!(K&6)&&(Gj=B()+500,jg()))}break;case 13:Rk(function(){var a=ih(e,1);if(a!==null){var _=R();gi(a,e,1,_)}}),il(e,1)}};Fc=function(e){if(e.tag===13){var i=ih(e,134217728);if(i!==null){var s=R();gi(i,e,134217728,s)}il(e,134217728)}};Gc=function(e){if(e.tag===13){var i=yi(e),s=ih(e,i);if(s!==null){var a=R();gi(s,e,i,a)}il(e,i)}};Hc=function(){return C};Ic=function(e,i){var s=C;try{return C=e,i()}finally{C=s}};yb=function(e,i,s){switch(i){case"input":if(bb(e,s),i=s.name,s.type==="radio"&&i!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<s.length;i++){var a=s[i];if(a!==e&&a.form===e.form){var _=Db(a);if(!_)throw Error(p(90));Wa(a),bb(a,_)}}}break;case"textarea":ib(e,s);break;case"select":i=s.value,i!=null&&fb(e,!!s.multiple,i,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue$1,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Zb(e),e===null?null:e.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(e,i){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(i))throw Error(p(200));return cl(e,i,null,s)};reactDom_production_min.createRoot=function(e,i){if(!nl(e))throw Error(p(299));var s=!1,a="",_=kl;return i!=null&&(i.unstable_strictMode===!0&&(s=!0),i.identifierPrefix!==void 0&&(a=i.identifierPrefix),i.onRecoverableError!==void 0&&(_=i.onRecoverableError)),i=bl(e,1,!1,null,null,s,!1,a,_),e[uf]=i.current,sf(e.nodeType===8?e.parentNode:e),new ll(i)};reactDom_production_min.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var i=e._reactInternals;if(i===void 0)throw typeof e.render=="function"?Error(p(188)):(e=Object.keys(e).join(","),Error(p(268,e)));return e=Zb(i),e=e===null?null:e.stateNode,e};reactDom_production_min.flushSync=function(e){return Rk(e)};reactDom_production_min.hydrate=function(e,i,s){if(!ol(i))throw Error(p(200));return rl(null,e,i,!0,s)};reactDom_production_min.hydrateRoot=function(e,i,s){if(!nl(e))throw Error(p(405));var a=s!=null&&s.hydratedSources||null,_=!1,et="",nt=kl;if(s!=null&&(s.unstable_strictMode===!0&&(_=!0),s.identifierPrefix!==void 0&&(et=s.identifierPrefix),s.onRecoverableError!==void 0&&(nt=s.onRecoverableError)),i=el(i,null,e,1,s??null,_,!1,et,nt),e[uf]=i.current,sf(e),a)for(e=0;e<a.length;e++)s=a[e],_=s._getVersion,_=_(s._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[s,_]:i.mutableSourceEagerHydrationData.push(s,_);return new ml(i)};reactDom_production_min.render=function(e,i,s){if(!ol(i))throw Error(p(200));return rl(null,e,i,!1,s)};reactDom_production_min.unmountComponentAtNode=function(e){if(!ol(e))throw Error(p(40));return e._reactRootContainer?(Rk(function(){rl(null,null,e,!1,function(){e._reactRootContainer=null,e[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(e,i,s,a){if(!ol(s))throw Error(p(200));if(e==null||e._reactInternals===void 0)throw Error(p(38));return rl(e,i,s,!1,a)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(e){console.error(e)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports;const vt=getDefaultExportFromCjs(reactDomExports);var createRoot,m=reactDomExports;createRoot=m.createRoot,m.hydrateRoot;const TOAST_LIMIT=1,TOAST_REMOVE_DELAY=1e6;let count$2=0;function genId(){return count$2=(count$2+1)%Number.MAX_SAFE_INTEGER,count$2.toString()}const toastTimeouts=new Map,addToRemoveQueue=e=>{if(toastTimeouts.has(e))return;const i=setTimeout(()=>{toastTimeouts.delete(e),dispatch({type:"REMOVE_TOAST",toastId:e})},TOAST_REMOVE_DELAY);toastTimeouts.set(e,i)},reducer=(e,i)=>{switch(i.type){case"ADD_TOAST":return{...e,toasts:[i.toast,...e.toasts].slice(0,TOAST_LIMIT)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(s=>s.id===i.toast.id?{...s,...i.toast}:s)};case"DISMISS_TOAST":{const{toastId:s}=i;return s?addToRemoveQueue(s):e.toasts.forEach(a=>{addToRemoveQueue(a.id)}),{...e,toasts:e.toasts.map(a=>a.id===s||s===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return i.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(s=>s.id!==i.toastId)}}},listeners=[];let memoryState={toasts:[]};function dispatch(e){memoryState=reducer(memoryState,e),listeners.forEach(i=>{i(memoryState)})}function toast({...e}){const i=genId(),s=_=>dispatch({type:"UPDATE_TOAST",toast:{..._,id:i}}),a=()=>dispatch({type:"DISMISS_TOAST",toastId:i});return dispatch({type:"ADD_TOAST",toast:{...e,id:i,open:!0,onOpenChange:_=>{_||a()}}}),{id:i,dismiss:a,update:s}}function useToast(){const[e,i]=reactExports.useState(memoryState);return reactExports.useEffect(()=>(listeners.push(i),()=>{const s=listeners.indexOf(i);s>-1&&listeners.splice(s,1)}),[e]),{...e,toast,dismiss:s=>dispatch({type:"DISMISS_TOAST",toastId:s})}}function composeEventHandlers(e,i,{checkForDefaultPrevented:s=!0}={}){return function(_){if(e==null||e(_),s===!1||!_.defaultPrevented)return i==null?void 0:i(_)}}function setRef$2(e,i){if(typeof e=="function")return e(i);e!=null&&(e.current=i)}function composeRefs$1(...e){return i=>{let s=!1;const a=e.map(_=>{const et=setRef$2(_,i);return!s&&typeof et=="function"&&(s=!0),et});if(s)return()=>{for(let _=0;_<a.length;_++){const et=a[_];typeof et=="function"?et():setRef$2(e[_],null)}}}}function useComposedRefs$1(...e){return reactExports.useCallback(composeRefs$1(...e),e)}function createContext2(e,i){const s=reactExports.createContext(i),a=et=>{const{children:nt,...c}=et,ct=reactExports.useMemo(()=>c,Object.values(c));return jsxRuntimeExports.jsx(s.Provider,{value:ct,children:nt})};a.displayName=e+"Provider";function _(et){const nt=reactExports.useContext(s);if(nt)return nt;if(i!==void 0)return i;throw new Error(`\`${et}\` must be used within \`${e}\``)}return[a,_]}function createContextScope(e,i=[]){let s=[];function a(et,nt){const c=reactExports.createContext(nt),ct=s.length;s=[...s,nt];const dt=Tt=>{var Lt;const{scope:Et,children:At,...Mt}=Tt,Pt=((Lt=Et==null?void 0:Et[e])==null?void 0:Lt[ct])||c,$t=reactExports.useMemo(()=>Mt,Object.values(Mt));return jsxRuntimeExports.jsx(Pt.Provider,{value:$t,children:At})};dt.displayName=et+"Provider";function gt(Tt,Et){var Pt;const At=((Pt=Et==null?void 0:Et[e])==null?void 0:Pt[ct])||c,Mt=reactExports.useContext(At);if(Mt)return Mt;if(nt!==void 0)return nt;throw new Error(`\`${Tt}\` must be used within \`${et}\``)}return[dt,gt]}const _=()=>{const et=s.map(nt=>reactExports.createContext(nt));return function(c){const ct=(c==null?void 0:c[e])||et;return reactExports.useMemo(()=>({[`__scope${e}`]:{...c,[e]:ct}}),[c,ct])}};return _.scopeName=e,[a,composeContextScopes(_,...i)]}function composeContextScopes(...e){const i=e[0];if(e.length===1)return i;const s=()=>{const a=e.map(_=>({useScope:_(),scopeName:_.scopeName}));return function(et){const nt=a.reduce((c,{useScope:ct,scopeName:dt})=>{const Tt=ct(et)[`__scope${dt}`];return{...c,...Tt}},{});return reactExports.useMemo(()=>({[`__scope${i.scopeName}`]:nt}),[nt])}};return s.scopeName=i.scopeName,s}function createSlot(e){const i=createSlotClone(e),s=reactExports.forwardRef((a,_)=>{const{children:et,...nt}=a,c=reactExports.Children.toArray(et),ct=c.find(isSlottable);if(ct){const dt=ct.props.children,gt=c.map(Tt=>Tt===ct?reactExports.Children.count(dt)>1?reactExports.Children.only(null):reactExports.isValidElement(dt)?dt.props.children:null:Tt);return jsxRuntimeExports.jsx(i,{...nt,ref:_,children:reactExports.isValidElement(dt)?reactExports.cloneElement(dt,void 0,gt):null})}return jsxRuntimeExports.jsx(i,{...nt,ref:_,children:et})});return s.displayName=`${e}.Slot`,s}var Slot$2=createSlot("Slot");function createSlotClone(e){const i=reactExports.forwardRef((s,a)=>{const{children:_,...et}=s;if(reactExports.isValidElement(_)){const nt=getElementRef$1(_),c=mergeProps(et,_.props);return _.type!==reactExports.Fragment&&(c.ref=a?composeRefs$1(a,nt):nt),reactExports.cloneElement(_,c)}return reactExports.Children.count(_)>1?reactExports.Children.only(null):null});return i.displayName=`${e}.SlotClone`,i}var SLOTTABLE_IDENTIFIER=Symbol("radix.slottable");function createSlottable(e){const i=({children:s})=>jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:s});return i.displayName=`${e}.Slottable`,i.__radixId=SLOTTABLE_IDENTIFIER,i}function isSlottable(e){return reactExports.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===SLOTTABLE_IDENTIFIER}function mergeProps(e,i){const s={...i};for(const a in i){const _=e[a],et=i[a];/^on[A-Z]/.test(a)?_&&et?s[a]=(...c)=>{const ct=et(...c);return _(...c),ct}:_&&(s[a]=_):a==="style"?s[a]={..._,...et}:a==="className"&&(s[a]=[_,et].filter(Boolean).join(" "))}return{...e,...s}}function getElementRef$1(e){var a,_;let i=(a=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:a.get,s=i&&"isReactWarning"in i&&i.isReactWarning;return s?e.ref:(i=(_=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:_.get,s=i&&"isReactWarning"in i&&i.isReactWarning,s?e.props.ref:e.props.ref||e.ref)}function createCollection(e){const i=e+"CollectionProvider",[s,a]=createContextScope(i),[_,et]=s(i,{collectionRef:{current:null},itemMap:new Map}),nt=Pt=>{const{scope:$t,children:Lt}=Pt,Bt=React.useRef(null),Nt=React.useRef(new Map).current;return jsxRuntimeExports.jsx(_,{scope:$t,itemMap:Nt,collectionRef:Bt,children:Lt})};nt.displayName=i;const c=e+"CollectionSlot",ct=createSlot(c),dt=React.forwardRef((Pt,$t)=>{const{scope:Lt,children:Bt}=Pt,Nt=et(c,Lt),Vt=useComposedRefs$1($t,Nt.collectionRef);return jsxRuntimeExports.jsx(ct,{ref:Vt,children:Bt})});dt.displayName=c;const gt=e+"CollectionItemSlot",Tt="data-radix-collection-item",Et=createSlot(gt),At=React.forwardRef((Pt,$t)=>{const{scope:Lt,children:Bt,...Nt}=Pt,Vt=React.useRef(null),Xt=useComposedRefs$1($t,Vt),nr=et(gt,Lt);return React.useEffect(()=>(nr.itemMap.set(Vt,{ref:Vt,...Nt}),()=>void nr.itemMap.delete(Vt))),jsxRuntimeExports.jsx(Et,{[Tt]:"",ref:Xt,children:Bt})});At.displayName=gt;function Mt(Pt){const $t=et(e+"CollectionConsumer",Pt);return React.useCallback(()=>{const Bt=$t.collectionRef.current;if(!Bt)return[];const Nt=Array.from(Bt.querySelectorAll(`[${Tt}]`));return Array.from($t.itemMap.values()).sort((nr,ar)=>Nt.indexOf(nr.ref.current)-Nt.indexOf(ar.ref.current))},[$t.collectionRef,$t.itemMap])}return[{Provider:nt,Slot:dt,ItemSlot:At},Mt,a]}var NODES=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Primitive=NODES.reduce((e,i)=>{const s=createSlot(`Primitive.${i}`),a=reactExports.forwardRef((_,et)=>{const{asChild:nt,...c}=_,ct=nt?s:i;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),jsxRuntimeExports.jsx(ct,{...c,ref:et})});return a.displayName=`Primitive.${i}`,{...e,[i]:a}},{});function dispatchDiscreteCustomEvent(e,i){e&&reactDomExports.flushSync(()=>e.dispatchEvent(i))}function useCallbackRef$1(e){const i=reactExports.useRef(e);return reactExports.useEffect(()=>{i.current=e}),reactExports.useMemo(()=>(...s)=>{var a;return(a=i.current)==null?void 0:a.call(i,...s)},[])}function useEscapeKeydown(e,i=globalThis==null?void 0:globalThis.document){const s=useCallbackRef$1(e);reactExports.useEffect(()=>{const a=_=>{_.key==="Escape"&&s(_)};return i.addEventListener("keydown",a,{capture:!0}),()=>i.removeEventListener("keydown",a,{capture:!0})},[s,i])}var DISMISSABLE_LAYER_NAME="DismissableLayer",CONTEXT_UPDATE="dismissableLayer.update",POINTER_DOWN_OUTSIDE="dismissableLayer.pointerDownOutside",FOCUS_OUTSIDE="dismissableLayer.focusOutside",originalBodyPointerEvents,DismissableLayerContext=reactExports.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),DismissableLayer=reactExports.forwardRef((e,i)=>{const{disableOutsidePointerEvents:s=!1,onEscapeKeyDown:a,onPointerDownOutside:_,onFocusOutside:et,onInteractOutside:nt,onDismiss:c,...ct}=e,dt=reactExports.useContext(DismissableLayerContext),[gt,Tt]=reactExports.useState(null),Et=(gt==null?void 0:gt.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,At]=reactExports.useState({}),Mt=useComposedRefs$1(i,ar=>Tt(ar)),Pt=Array.from(dt.layers),[$t]=[...dt.layersWithOutsidePointerEventsDisabled].slice(-1),Lt=Pt.indexOf($t),Bt=gt?Pt.indexOf(gt):-1,Nt=dt.layersWithOutsidePointerEventsDisabled.size>0,Vt=Bt>=Lt,Xt=usePointerDownOutside(ar=>{const mr=ar.target,Fr=[...dt.branches].some(sn=>sn.contains(mr));!Vt||Fr||(_==null||_(ar),nt==null||nt(ar),ar.defaultPrevented||c==null||c())},Et),nr=useFocusOutside(ar=>{const mr=ar.target;[...dt.branches].some(sn=>sn.contains(mr))||(et==null||et(ar),nt==null||nt(ar),ar.defaultPrevented||c==null||c())},Et);return useEscapeKeydown(ar=>{Bt===dt.layers.size-1&&(a==null||a(ar),!ar.defaultPrevented&&c&&(ar.preventDefault(),c()))},Et),reactExports.useEffect(()=>{if(gt)return s&&(dt.layersWithOutsidePointerEventsDisabled.size===0&&(originalBodyPointerEvents=Et.body.style.pointerEvents,Et.body.style.pointerEvents="none"),dt.layersWithOutsidePointerEventsDisabled.add(gt)),dt.layers.add(gt),dispatchUpdate(),()=>{s&&dt.layersWithOutsidePointerEventsDisabled.size===1&&(Et.body.style.pointerEvents=originalBodyPointerEvents)}},[gt,Et,s,dt]),reactExports.useEffect(()=>()=>{gt&&(dt.layers.delete(gt),dt.layersWithOutsidePointerEventsDisabled.delete(gt),dispatchUpdate())},[gt,dt]),reactExports.useEffect(()=>{const ar=()=>At({});return document.addEventListener(CONTEXT_UPDATE,ar),()=>document.removeEventListener(CONTEXT_UPDATE,ar)},[]),jsxRuntimeExports.jsx(Primitive.div,{...ct,ref:Mt,style:{pointerEvents:Nt?Vt?"auto":"none":void 0,...e.style},onFocusCapture:composeEventHandlers(e.onFocusCapture,nr.onFocusCapture),onBlurCapture:composeEventHandlers(e.onBlurCapture,nr.onBlurCapture),onPointerDownCapture:composeEventHandlers(e.onPointerDownCapture,Xt.onPointerDownCapture)})});DismissableLayer.displayName=DISMISSABLE_LAYER_NAME;var BRANCH_NAME="DismissableLayerBranch",DismissableLayerBranch=reactExports.forwardRef((e,i)=>{const s=reactExports.useContext(DismissableLayerContext),a=reactExports.useRef(null),_=useComposedRefs$1(i,a);return reactExports.useEffect(()=>{const et=a.current;if(et)return s.branches.add(et),()=>{s.branches.delete(et)}},[s.branches]),jsxRuntimeExports.jsx(Primitive.div,{...e,ref:_})});DismissableLayerBranch.displayName=BRANCH_NAME;function usePointerDownOutside(e,i=globalThis==null?void 0:globalThis.document){const s=useCallbackRef$1(e),a=reactExports.useRef(!1),_=reactExports.useRef(()=>{});return reactExports.useEffect(()=>{const et=c=>{if(c.target&&!a.current){let ct=function(){handleAndDispatchCustomEvent$1(POINTER_DOWN_OUTSIDE,s,dt,{discrete:!0})};const dt={originalEvent:c};c.pointerType==="touch"?(i.removeEventListener("click",_.current),_.current=ct,i.addEventListener("click",_.current,{once:!0})):ct()}else i.removeEventListener("click",_.current);a.current=!1},nt=window.setTimeout(()=>{i.addEventListener("pointerdown",et)},0);return()=>{window.clearTimeout(nt),i.removeEventListener("pointerdown",et),i.removeEventListener("click",_.current)}},[i,s]),{onPointerDownCapture:()=>a.current=!0}}function useFocusOutside(e,i=globalThis==null?void 0:globalThis.document){const s=useCallbackRef$1(e),a=reactExports.useRef(!1);return reactExports.useEffect(()=>{const _=et=>{et.target&&!a.current&&handleAndDispatchCustomEvent$1(FOCUS_OUTSIDE,s,{originalEvent:et},{discrete:!1})};return i.addEventListener("focusin",_),()=>i.removeEventListener("focusin",_)},[i,s]),{onFocusCapture:()=>a.current=!0,onBlurCapture:()=>a.current=!1}}function dispatchUpdate(){const e=new CustomEvent(CONTEXT_UPDATE);document.dispatchEvent(e)}function handleAndDispatchCustomEvent$1(e,i,s,{discrete:a}){const _=s.originalEvent.target,et=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:s});i&&_.addEventListener(e,i,{once:!0}),a?dispatchDiscreteCustomEvent(_,et):_.dispatchEvent(et)}var Root$6=DismissableLayer,Branch=DismissableLayerBranch,useLayoutEffect2=globalThis!=null&&globalThis.document?reactExports.useLayoutEffect:()=>{},PORTAL_NAME$4="Portal",Portal$2=reactExports.forwardRef((e,i)=>{var c;const{container:s,...a}=e,[_,et]=reactExports.useState(!1);useLayoutEffect2(()=>et(!0),[]);const nt=s||_&&((c=globalThis==null?void 0:globalThis.document)==null?void 0:c.body);return nt?vt.createPortal(jsxRuntimeExports.jsx(Primitive.div,{...a,ref:i}),nt):null});Portal$2.displayName=PORTAL_NAME$4;function useStateMachine(e,i){return reactExports.useReducer((s,a)=>i[s][a]??s,e)}var Presence=e=>{const{present:i,children:s}=e,a=usePresence$1(i),_=typeof s=="function"?s({present:a.isPresent}):reactExports.Children.only(s),et=useComposedRefs$1(a.ref,getElementRef(_));return typeof s=="function"||a.isPresent?reactExports.cloneElement(_,{ref:et}):null};Presence.displayName="Presence";function usePresence$1(e){const[i,s]=reactExports.useState(),a=reactExports.useRef(null),_=reactExports.useRef(e),et=reactExports.useRef("none"),nt=e?"mounted":"unmounted",[c,ct]=useStateMachine(nt,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return reactExports.useEffect(()=>{const dt=getAnimationName(a.current);et.current=c==="mounted"?dt:"none"},[c]),useLayoutEffect2(()=>{const dt=a.current,gt=_.current;if(gt!==e){const Et=et.current,At=getAnimationName(dt);e?ct("MOUNT"):At==="none"||(dt==null?void 0:dt.display)==="none"?ct("UNMOUNT"):ct(gt&&Et!==At?"ANIMATION_OUT":"UNMOUNT"),_.current=e}},[e,ct]),useLayoutEffect2(()=>{if(i){let dt;const gt=i.ownerDocument.defaultView??window,Tt=At=>{const Pt=getAnimationName(a.current).includes(At.animationName);if(At.target===i&&Pt&&(ct("ANIMATION_END"),!_.current)){const $t=i.style.animationFillMode;i.style.animationFillMode="forwards",dt=gt.setTimeout(()=>{i.style.animationFillMode==="forwards"&&(i.style.animationFillMode=$t)})}},Et=At=>{At.target===i&&(et.current=getAnimationName(a.current))};return i.addEventListener("animationstart",Et),i.addEventListener("animationcancel",Tt),i.addEventListener("animationend",Tt),()=>{gt.clearTimeout(dt),i.removeEventListener("animationstart",Et),i.removeEventListener("animationcancel",Tt),i.removeEventListener("animationend",Tt)}}else ct("ANIMATION_END")},[i,ct]),{isPresent:["mounted","unmountSuspended"].includes(c),ref:reactExports.useCallback(dt=>{a.current=dt?getComputedStyle(dt):null,s(dt)},[])}}function getAnimationName(e){return(e==null?void 0:e.animationName)||"none"}function getElementRef(e){var a,_;let i=(a=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:a.get,s=i&&"isReactWarning"in i&&i.isReactWarning;return s?e.ref:(i=(_=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:_.get,s=i&&"isReactWarning"in i&&i.isReactWarning,s?e.props.ref:e.props.ref||e.ref)}var useInsertionEffect=React$1[" useInsertionEffect ".trim().toString()]||useLayoutEffect2;function useControllableState({prop:e,defaultProp:i,onChange:s=()=>{},caller:a}){const[_,et,nt]=useUncontrolledState({defaultProp:i,onChange:s}),c=e!==void 0,ct=c?e:_;{const gt=reactExports.useRef(e!==void 0);reactExports.useEffect(()=>{const Tt=gt.current;Tt!==c&&console.warn(`${a} is changing from ${Tt?"controlled":"uncontrolled"} to ${c?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),gt.current=c},[c,a])}const dt=reactExports.useCallback(gt=>{var Tt;if(c){const Et=isFunction(gt)?gt(e):gt;Et!==e&&((Tt=nt.current)==null||Tt.call(nt,Et))}else et(gt)},[c,e,et,nt]);return[ct,dt]}function useUncontrolledState({defaultProp:e,onChange:i}){const[s,a]=reactExports.useState(e),_=reactExports.useRef(s),et=reactExports.useRef(i);return useInsertionEffect(()=>{et.current=i},[i]),reactExports.useEffect(()=>{var nt;_.current!==s&&((nt=et.current)==null||nt.call(et,s),_.current=s)},[s,_]),[s,a,et]}function isFunction(e){return typeof e=="function"}var VISUALLY_HIDDEN_STYLES=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),NAME$2="VisuallyHidden",VisuallyHidden=reactExports.forwardRef((e,i)=>jsxRuntimeExports.jsx(Primitive.span,{...e,ref:i,style:{...VISUALLY_HIDDEN_STYLES,...e.style}}));VisuallyHidden.displayName=NAME$2;var Root$5=VisuallyHidden,PROVIDER_NAME$1="ToastProvider",[Collection$2,useCollection$2,createCollectionScope$2]=createCollection("Toast"),[createToastContext,createToastScope]=createContextScope("Toast",[createCollectionScope$2]),[ToastProviderProvider,useToastProviderContext]=createToastContext(PROVIDER_NAME$1),ToastProvider$1=e=>{const{__scopeToast:i,label:s="Notification",duration:a=5e3,swipeDirection:_="right",swipeThreshold:et=50,children:nt}=e,[c,ct]=reactExports.useState(null),[dt,gt]=reactExports.useState(0),Tt=reactExports.useRef(!1),Et=reactExports.useRef(!1);return s.trim()||console.error(`Invalid prop \`label\` supplied to \`${PROVIDER_NAME$1}\`. Expected non-empty \`string\`.`),jsxRuntimeExports.jsx(Collection$2.Provider,{scope:i,children:jsxRuntimeExports.jsx(ToastProviderProvider,{scope:i,label:s,duration:a,swipeDirection:_,swipeThreshold:et,toastCount:dt,viewport:c,onViewportChange:ct,onToastAdd:reactExports.useCallback(()=>gt(At=>At+1),[]),onToastRemove:reactExports.useCallback(()=>gt(At=>At-1),[]),isFocusedToastEscapeKeyDownRef:Tt,isClosePausedRef:Et,children:nt})})};ToastProvider$1.displayName=PROVIDER_NAME$1;var VIEWPORT_NAME$1="ToastViewport",VIEWPORT_DEFAULT_HOTKEY=["F8"],VIEWPORT_PAUSE="toast.viewportPause",VIEWPORT_RESUME="toast.viewportResume",ToastViewport$1=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,hotkey:a=VIEWPORT_DEFAULT_HOTKEY,label:_="Notifications ({hotkey})",...et}=e,nt=useToastProviderContext(VIEWPORT_NAME$1,s),c=useCollection$2(s),ct=reactExports.useRef(null),dt=reactExports.useRef(null),gt=reactExports.useRef(null),Tt=reactExports.useRef(null),Et=useComposedRefs$1(i,Tt,nt.onViewportChange),At=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),Mt=nt.toastCount>0;reactExports.useEffect(()=>{const $t=Lt=>{var Nt;a.length!==0&&a.every(Vt=>Lt[Vt]||Lt.code===Vt)&&((Nt=Tt.current)==null||Nt.focus())};return document.addEventListener("keydown",$t),()=>document.removeEventListener("keydown",$t)},[a]),reactExports.useEffect(()=>{const $t=ct.current,Lt=Tt.current;if(Mt&&$t&&Lt){const Bt=()=>{if(!nt.isClosePausedRef.current){const nr=new CustomEvent(VIEWPORT_PAUSE);Lt.dispatchEvent(nr),nt.isClosePausedRef.current=!0}},Nt=()=>{if(nt.isClosePausedRef.current){const nr=new CustomEvent(VIEWPORT_RESUME);Lt.dispatchEvent(nr),nt.isClosePausedRef.current=!1}},Vt=nr=>{!$t.contains(nr.relatedTarget)&&Nt()},Xt=()=>{$t.contains(document.activeElement)||Nt()};return $t.addEventListener("focusin",Bt),$t.addEventListener("focusout",Vt),$t.addEventListener("pointermove",Bt),$t.addEventListener("pointerleave",Xt),window.addEventListener("blur",Bt),window.addEventListener("focus",Nt),()=>{$t.removeEventListener("focusin",Bt),$t.removeEventListener("focusout",Vt),$t.removeEventListener("pointermove",Bt),$t.removeEventListener("pointerleave",Xt),window.removeEventListener("blur",Bt),window.removeEventListener("focus",Nt)}}},[Mt,nt.isClosePausedRef]);const Pt=reactExports.useCallback(({tabbingDirection:$t})=>{const Bt=c().map(Nt=>{const Vt=Nt.ref.current,Xt=[Vt,...getTabbableCandidates$1(Vt)];return $t==="forwards"?Xt:Xt.reverse()});return($t==="forwards"?Bt.reverse():Bt).flat()},[c]);return reactExports.useEffect(()=>{const $t=Tt.current;if($t){const Lt=Bt=>{var Xt,nr,ar;const Nt=Bt.altKey||Bt.ctrlKey||Bt.metaKey;if(Bt.key==="Tab"&&!Nt){const mr=document.activeElement,Fr=Bt.shiftKey;if(Bt.target===$t&&Fr){(Xt=dt.current)==null||Xt.focus();return}const Lr=Pt({tabbingDirection:Fr?"backwards":"forwards"}),Qr=Lr.findIndex(dn=>dn===mr);focusFirst$1(Lr.slice(Qr+1))?Bt.preventDefault():Fr?(nr=dt.current)==null||nr.focus():(ar=gt.current)==null||ar.focus()}};return $t.addEventListener("keydown",Lt),()=>$t.removeEventListener("keydown",Lt)}},[c,Pt]),jsxRuntimeExports.jsxs(Branch,{ref:ct,role:"region","aria-label":_.replace("{hotkey}",At),tabIndex:-1,style:{pointerEvents:Mt?void 0:"none"},children:[Mt&&jsxRuntimeExports.jsx(FocusProxy,{ref:dt,onFocusFromOutsideViewport:()=>{const $t=Pt({tabbingDirection:"forwards"});focusFirst$1($t)}}),jsxRuntimeExports.jsx(Collection$2.Slot,{scope:s,children:jsxRuntimeExports.jsx(Primitive.ol,{tabIndex:-1,...et,ref:Et})}),Mt&&jsxRuntimeExports.jsx(FocusProxy,{ref:gt,onFocusFromOutsideViewport:()=>{const $t=Pt({tabbingDirection:"backwards"});focusFirst$1($t)}})]})});ToastViewport$1.displayName=VIEWPORT_NAME$1;var FOCUS_PROXY_NAME="ToastFocusProxy",FocusProxy=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,onFocusFromOutsideViewport:a,..._}=e,et=useToastProviderContext(FOCUS_PROXY_NAME,s);return jsxRuntimeExports.jsx(VisuallyHidden,{"aria-hidden":!0,tabIndex:0,..._,ref:i,style:{position:"fixed"},onFocus:nt=>{var dt;const c=nt.relatedTarget;!((dt=et.viewport)!=null&&dt.contains(c))&&a()}})});FocusProxy.displayName=FOCUS_PROXY_NAME;var TOAST_NAME="Toast",TOAST_SWIPE_START="toast.swipeStart",TOAST_SWIPE_MOVE="toast.swipeMove",TOAST_SWIPE_CANCEL="toast.swipeCancel",TOAST_SWIPE_END="toast.swipeEnd",Toast$1=reactExports.forwardRef((e,i)=>{const{forceMount:s,open:a,defaultOpen:_,onOpenChange:et,...nt}=e,[c,ct]=useControllableState({prop:a,defaultProp:_??!0,onChange:et,caller:TOAST_NAME});return jsxRuntimeExports.jsx(Presence,{present:s||c,children:jsxRuntimeExports.jsx(ToastImpl,{open:c,...nt,ref:i,onClose:()=>ct(!1),onPause:useCallbackRef$1(e.onPause),onResume:useCallbackRef$1(e.onResume),onSwipeStart:composeEventHandlers(e.onSwipeStart,dt=>{dt.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:composeEventHandlers(e.onSwipeMove,dt=>{const{x:gt,y:Tt}=dt.detail.delta;dt.currentTarget.setAttribute("data-swipe","move"),dt.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${gt}px`),dt.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${Tt}px`)}),onSwipeCancel:composeEventHandlers(e.onSwipeCancel,dt=>{dt.currentTarget.setAttribute("data-swipe","cancel"),dt.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),dt.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),dt.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),dt.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:composeEventHandlers(e.onSwipeEnd,dt=>{const{x:gt,y:Tt}=dt.detail.delta;dt.currentTarget.setAttribute("data-swipe","end"),dt.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),dt.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),dt.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${gt}px`),dt.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${Tt}px`),ct(!1)})})})});Toast$1.displayName=TOAST_NAME;var[ToastInteractiveProvider,useToastInteractiveContext]=createToastContext(TOAST_NAME,{onClose(){}}),ToastImpl=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,type:a="foreground",duration:_,open:et,onClose:nt,onEscapeKeyDown:c,onPause:ct,onResume:dt,onSwipeStart:gt,onSwipeMove:Tt,onSwipeCancel:Et,onSwipeEnd:At,...Mt}=e,Pt=useToastProviderContext(TOAST_NAME,s),[$t,Lt]=reactExports.useState(null),Bt=useComposedRefs$1(i,dn=>Lt(dn)),Nt=reactExports.useRef(null),Vt=reactExports.useRef(null),Xt=_||Pt.duration,nr=reactExports.useRef(0),ar=reactExports.useRef(Xt),mr=reactExports.useRef(0),{onToastAdd:Fr,onToastRemove:sn}=Pt,fn=useCallbackRef$1(()=>{var en;($t==null?void 0:$t.contains(document.activeElement))&&((en=Pt.viewport)==null||en.focus()),nt()}),Lr=reactExports.useCallback(dn=>{!dn||dn===1/0||(window.clearTimeout(mr.current),nr.current=new Date().getTime(),mr.current=window.setTimeout(fn,dn))},[fn]);reactExports.useEffect(()=>{const dn=Pt.viewport;if(dn){const en=()=>{Lr(ar.current),dt==null||dt()},yr=()=>{const Ar=new Date().getTime()-nr.current;ar.current=ar.current-Ar,window.clearTimeout(mr.current),ct==null||ct()};return dn.addEventListener(VIEWPORT_PAUSE,yr),dn.addEventListener(VIEWPORT_RESUME,en),()=>{dn.removeEventListener(VIEWPORT_PAUSE,yr),dn.removeEventListener(VIEWPORT_RESUME,en)}}},[Pt.viewport,Xt,ct,dt,Lr]),reactExports.useEffect(()=>{et&&!Pt.isClosePausedRef.current&&Lr(Xt)},[et,Xt,Pt.isClosePausedRef,Lr]),reactExports.useEffect(()=>(Fr(),()=>sn()),[Fr,sn]);const Qr=reactExports.useMemo(()=>$t?getAnnounceTextContent($t):null,[$t]);return Pt.viewport?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[Qr&&jsxRuntimeExports.jsx(ToastAnnounce,{__scopeToast:s,role:"status","aria-live":a==="foreground"?"assertive":"polite","aria-atomic":!0,children:Qr}),jsxRuntimeExports.jsx(ToastInteractiveProvider,{scope:s,onClose:fn,children:reactDomExports.createPortal(jsxRuntimeExports.jsx(Collection$2.ItemSlot,{scope:s,children:jsxRuntimeExports.jsx(Root$6,{asChild:!0,onEscapeKeyDown:composeEventHandlers(c,()=>{Pt.isFocusedToastEscapeKeyDownRef.current||fn(),Pt.isFocusedToastEscapeKeyDownRef.current=!1}),children:jsxRuntimeExports.jsx(Primitive.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":et?"open":"closed","data-swipe-direction":Pt.swipeDirection,...Mt,ref:Bt,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:composeEventHandlers(e.onKeyDown,dn=>{dn.key==="Escape"&&(c==null||c(dn.nativeEvent),dn.nativeEvent.defaultPrevented||(Pt.isFocusedToastEscapeKeyDownRef.current=!0,fn()))}),onPointerDown:composeEventHandlers(e.onPointerDown,dn=>{dn.button===0&&(Nt.current={x:dn.clientX,y:dn.clientY})}),onPointerMove:composeEventHandlers(e.onPointerMove,dn=>{if(!Nt.current)return;const en=dn.clientX-Nt.current.x,yr=dn.clientY-Nt.current.y,Ar=!!Vt.current,rr=["left","right"].includes(Pt.swipeDirection),ur=["left","up"].includes(Pt.swipeDirection)?Math.min:Math.max,Br=rr?ur(0,en):0,xr=rr?0:ur(0,yr),qr=dn.pointerType==="touch"?10:2,tn={x:Br,y:xr},vn={originalEvent:dn,delta:tn};Ar?(Vt.current=tn,handleAndDispatchCustomEvent(TOAST_SWIPE_MOVE,Tt,vn,{discrete:!1})):isDeltaInDirection(tn,Pt.swipeDirection,qr)?(Vt.current=tn,handleAndDispatchCustomEvent(TOAST_SWIPE_START,gt,vn,{discrete:!1}),dn.target.setPointerCapture(dn.pointerId)):(Math.abs(en)>qr||Math.abs(yr)>qr)&&(Nt.current=null)}),onPointerUp:composeEventHandlers(e.onPointerUp,dn=>{const en=Vt.current,yr=dn.target;if(yr.hasPointerCapture(dn.pointerId)&&yr.releasePointerCapture(dn.pointerId),Vt.current=null,Nt.current=null,en){const Ar=dn.currentTarget,rr={originalEvent:dn,delta:en};isDeltaInDirection(en,Pt.swipeDirection,Pt.swipeThreshold)?handleAndDispatchCustomEvent(TOAST_SWIPE_END,At,rr,{discrete:!0}):handleAndDispatchCustomEvent(TOAST_SWIPE_CANCEL,Et,rr,{discrete:!0}),Ar.addEventListener("click",ur=>ur.preventDefault(),{once:!0})}})})})}),Pt.viewport)})]}):null}),ToastAnnounce=e=>{const{__scopeToast:i,children:s,...a}=e,_=useToastProviderContext(TOAST_NAME,i),[et,nt]=reactExports.useState(!1),[c,ct]=reactExports.useState(!1);return useNextFrame(()=>nt(!0)),reactExports.useEffect(()=>{const dt=window.setTimeout(()=>ct(!0),1e3);return()=>window.clearTimeout(dt)},[]),c?null:jsxRuntimeExports.jsx(Portal$2,{asChild:!0,children:jsxRuntimeExports.jsx(VisuallyHidden,{...a,children:et&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[_.label," ",s]})})})},TITLE_NAME$2="ToastTitle",ToastTitle$1=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,...a}=e;return jsxRuntimeExports.jsx(Primitive.div,{...a,ref:i})});ToastTitle$1.displayName=TITLE_NAME$2;var DESCRIPTION_NAME$2="ToastDescription",ToastDescription$1=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,...a}=e;return jsxRuntimeExports.jsx(Primitive.div,{...a,ref:i})});ToastDescription$1.displayName=DESCRIPTION_NAME$2;var ACTION_NAME$1="ToastAction",ToastAction$1=reactExports.forwardRef((e,i)=>{const{altText:s,...a}=e;return s.trim()?jsxRuntimeExports.jsx(ToastAnnounceExclude,{altText:s,asChild:!0,children:jsxRuntimeExports.jsx(ToastClose$1,{...a,ref:i})}):(console.error(`Invalid prop \`altText\` supplied to \`${ACTION_NAME$1}\`. Expected non-empty \`string\`.`),null)});ToastAction$1.displayName=ACTION_NAME$1;var CLOSE_NAME$1="ToastClose",ToastClose$1=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,...a}=e,_=useToastInteractiveContext(CLOSE_NAME$1,s);return jsxRuntimeExports.jsx(ToastAnnounceExclude,{asChild:!0,children:jsxRuntimeExports.jsx(Primitive.button,{type:"button",...a,ref:i,onClick:composeEventHandlers(e.onClick,_.onClose)})})});ToastClose$1.displayName=CLOSE_NAME$1;var ToastAnnounceExclude=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,altText:a,..._}=e;return jsxRuntimeExports.jsx(Primitive.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":a||void 0,..._,ref:i})});function getAnnounceTextContent(e){const i=[];return Array.from(e.childNodes).forEach(a=>{if(a.nodeType===a.TEXT_NODE&&a.textContent&&i.push(a.textContent),isHTMLElement$2(a)){const _=a.ariaHidden||a.hidden||a.style.display==="none",et=a.dataset.radixToastAnnounceExclude==="";if(!_)if(et){const nt=a.dataset.radixToastAnnounceAlt;nt&&i.push(nt)}else i.push(...getAnnounceTextContent(a))}}),i}function handleAndDispatchCustomEvent(e,i,s,{discrete:a}){const _=s.originalEvent.currentTarget,et=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:s});i&&_.addEventListener(e,i,{once:!0}),a?dispatchDiscreteCustomEvent(_,et):_.dispatchEvent(et)}var isDeltaInDirection=(e,i,s=0)=>{const a=Math.abs(e.x),_=Math.abs(e.y),et=a>_;return i==="left"||i==="right"?et&&a>s:!et&&_>s};function useNextFrame(e=()=>{}){const i=useCallbackRef$1(e);useLayoutEffect2(()=>{let s=0,a=0;return s=window.requestAnimationFrame(()=>a=window.requestAnimationFrame(i)),()=>{window.cancelAnimationFrame(s),window.cancelAnimationFrame(a)}},[i])}function isHTMLElement$2(e){return e.nodeType===e.ELEMENT_NODE}function getTabbableCandidates$1(e){const i=[],s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const _=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||_?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)i.push(s.currentNode);return i}function focusFirst$1(e){const i=document.activeElement;return e.some(s=>s===i?!0:(s.focus(),document.activeElement!==i))}var Provider$2=ToastProvider$1,Viewport$1=ToastViewport$1,Root2$4=Toast$1,Title$1=ToastTitle$1,Description$1=ToastDescription$1,Action$2=ToastAction$1,Close$1=ToastClose$1;function r(e){var i,s,a="";if(typeof e=="string"||typeof e=="number")a+=e;else if(typeof e=="object")if(Array.isArray(e)){var _=e.length;for(i=0;i<_;i++)e[i]&&(s=r(e[i]))&&(a&&(a+=" "),a+=s)}else for(s in e)e[s]&&(a&&(a+=" "),a+=s);return a}function clsx(){for(var e,i,s=0,a="",_=arguments.length;s<_;s++)(e=arguments[s])&&(i=r(e))&&(a&&(a+=" "),a+=i);return a}const falsyToString=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,cx=clsx,cva=(e,i)=>s=>{var a;if((i==null?void 0:i.variants)==null)return cx(e,s==null?void 0:s.class,s==null?void 0:s.className);const{variants:_,defaultVariants:et}=i,nt=Object.keys(_).map(dt=>{const gt=s==null?void 0:s[dt],Tt=et==null?void 0:et[dt];if(gt===null)return null;const Et=falsyToString(gt)||falsyToString(Tt);return _[dt][Et]}),c=s&&Object.entries(s).reduce((dt,gt)=>{let[Tt,Et]=gt;return Et===void 0||(dt[Tt]=Et),dt},{}),ct=i==null||(a=i.compoundVariants)===null||a===void 0?void 0:a.reduce((dt,gt)=>{let{class:Tt,className:Et,...At}=gt;return Object.entries(At).every(Mt=>{let[Pt,$t]=Mt;return Array.isArray($t)?$t.includes({...et,...c}[Pt]):{...et,...c}[Pt]===$t})?[...dt,Tt,Et]:dt},[]);return cx(e,nt,ct,s==null?void 0:s.class,s==null?void 0:s.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const toKebabCase=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),mergeClasses=(...e)=>e.filter((i,s,a)=>!!i&&i.trim()!==""&&a.indexOf(i)===s).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Icon$1=reactExports.forwardRef(({color:e="currentColor",size:i=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:_="",children:et,iconNode:nt,...c},ct)=>reactExports.createElement("svg",{ref:ct,...defaultAttributes,width:i,height:i,stroke:e,strokeWidth:a?Number(s)*24/Number(i):s,className:mergeClasses("lucide",_),...c},[...nt.map(([dt,gt])=>reactExports.createElement(dt,gt)),...Array.isArray(et)?et:[et]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const createLucideIcon=(e,i)=>{const s=reactExports.forwardRef(({className:a,..._},et)=>reactExports.createElement(Icon$1,{ref:et,iconNode:i,className:mergeClasses(`lucide-${toKebabCase(e)}`,a),..._}));return s.displayName=`${e}`,s};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ArrowLeft=createLucideIcon("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ArrowRight=createLucideIcon("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bell=createLucideIcon("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Briefcase=createLucideIcon("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Camera=createLucideIcon("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Check=createLucideIcon("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChefHat=createLucideIcon("ChefHat",[["path",{d:"M17 21a1 1 0 0 0 1-1v-5.35c0-.457.316-.844.727-1.041a4 4 0 0 0-2.134-7.589 5 5 0 0 0-9.186 0 4 4 0 0 0-2.134 7.588c.411.198.727.585.727 1.041V20a1 1 0 0 0 1 1Z",key:"1qvrer"}],["path",{d:"M6 17h12",key:"1jwigz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronDown=createLucideIcon("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronLeft=createLucideIcon("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronRight=createLucideIcon("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronUp=createLucideIcon("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CircleHelp=createLucideIcon("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Clock=createLucideIcon("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CreditCard=createLucideIcon("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DollarSign=createLucideIcon("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ExternalLink=createLucideIcon("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EyeOff=createLucideIcon("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eye=createLucideIcon("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FileText=createLucideIcon("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Globe=createLucideIcon("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Heart=createLucideIcon("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const House=createLucideIcon("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Info=createLucideIcon("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Leaf=createLucideIcon("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LoaderCircle=createLucideIcon("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lock=createLucideIcon("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LogOut=createLucideIcon("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mail=createLucideIcon("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MapPin=createLucideIcon("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MessageCircle=createLucideIcon("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Minus=createLucideIcon("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Moon=createLucideIcon("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Navigation=createLucideIcon("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Package=createLucideIcon("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Percent=createLucideIcon("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Phone=createLucideIcon("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Plus=createLucideIcon("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RefreshCw=createLucideIcon("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Search=createLucideIcon("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Settings=createLucideIcon("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Share2=createLucideIcon("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ShieldCheck=createLucideIcon("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ShoppingBag=createLucideIcon("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Smartphone=createLucideIcon("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sparkles=createLucideIcon("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SquarePen=createLucideIcon("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Star=createLucideIcon("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Store$1=createLucideIcon("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tag=createLucideIcon("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Trash2=createLucideIcon("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TrendingUp=createLucideIcon("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TriangleAlert=createLucideIcon("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Truck=createLucideIcon("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UserPlus=createLucideIcon("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const User=createLucideIcon("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Users=createLucideIcon("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=createLucideIcon("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),CLASS_PART_SEPARATOR="-",createClassGroupUtils=e=>{const i=createClassMap(e),{conflictingClassGroups:s,conflictingClassGroupModifiers:a}=e;return{getClassGroupId:nt=>{const c=nt.split(CLASS_PART_SEPARATOR);return c[0]===""&&c.length!==1&&c.shift(),getGroupRecursive(c,i)||getGroupIdForArbitraryProperty(nt)},getConflictingClassGroupIds:(nt,c)=>{const ct=s[nt]||[];return c&&a[nt]?[...ct,...a[nt]]:ct}}},getGroupRecursive=(e,i)=>{var nt;if(e.length===0)return i.classGroupId;const s=e[0],a=i.nextPart.get(s),_=a?getGroupRecursive(e.slice(1),a):void 0;if(_)return _;if(i.validators.length===0)return;const et=e.join(CLASS_PART_SEPARATOR);return(nt=i.validators.find(({validator:c})=>c(et)))==null?void 0:nt.classGroupId},arbitraryPropertyRegex=/^\[(.+)\]$/,getGroupIdForArbitraryProperty=e=>{if(arbitraryPropertyRegex.test(e)){const i=arbitraryPropertyRegex.exec(e)[1],s=i==null?void 0:i.substring(0,i.indexOf(":"));if(s)return"arbitrary.."+s}},createClassMap=e=>{const{theme:i,prefix:s}=e,a={nextPart:new Map,validators:[]};return getPrefixedClassGroupEntries(Object.entries(e.classGroups),s).forEach(([et,nt])=>{processClassesRecursively(nt,a,et,i)}),a},processClassesRecursively=(e,i,s,a)=>{e.forEach(_=>{if(typeof _=="string"){const et=_===""?i:getPart(i,_);et.classGroupId=s;return}if(typeof _=="function"){if(isThemeGetter(_)){processClassesRecursively(_(a),i,s,a);return}i.validators.push({validator:_,classGroupId:s});return}Object.entries(_).forEach(([et,nt])=>{processClassesRecursively(nt,getPart(i,et),s,a)})})},getPart=(e,i)=>{let s=e;return i.split(CLASS_PART_SEPARATOR).forEach(a=>{s.nextPart.has(a)||s.nextPart.set(a,{nextPart:new Map,validators:[]}),s=s.nextPart.get(a)}),s},isThemeGetter=e=>e.isThemeGetter,getPrefixedClassGroupEntries=(e,i)=>i?e.map(([s,a])=>{const _=a.map(et=>typeof et=="string"?i+et:typeof et=="object"?Object.fromEntries(Object.entries(et).map(([nt,c])=>[i+nt,c])):et);return[s,_]}):e,createLruCache=e=>{if(e<1)return{get:()=>{},set:()=>{}};let i=0,s=new Map,a=new Map;const _=(et,nt)=>{s.set(et,nt),i++,i>e&&(i=0,a=s,s=new Map)};return{get(et){let nt=s.get(et);if(nt!==void 0)return nt;if((nt=a.get(et))!==void 0)return _(et,nt),nt},set(et,nt){s.has(et)?s.set(et,nt):_(et,nt)}}},IMPORTANT_MODIFIER="!",createParseClassName=e=>{const{separator:i,experimentalParseClassName:s}=e,a=i.length===1,_=i[0],et=i.length,nt=c=>{const ct=[];let dt=0,gt=0,Tt;for(let $t=0;$t<c.length;$t++){let Lt=c[$t];if(dt===0){if(Lt===_&&(a||c.slice($t,$t+et)===i)){ct.push(c.slice(gt,$t)),gt=$t+et;continue}if(Lt==="/"){Tt=$t;continue}}Lt==="["?dt++:Lt==="]"&&dt--}const Et=ct.length===0?c:c.substring(gt),At=Et.startsWith(IMPORTANT_MODIFIER),Mt=At?Et.substring(1):Et,Pt=Tt&&Tt>gt?Tt-gt:void 0;return{modifiers:ct,hasImportantModifier:At,baseClassName:Mt,maybePostfixModifierPosition:Pt}};return s?c=>s({className:c,parseClassName:nt}):nt},sortModifiers=e=>{if(e.length<=1)return e;const i=[];let s=[];return e.forEach(a=>{a[0]==="["?(i.push(...s.sort(),a),s=[]):s.push(a)}),i.push(...s.sort()),i},createConfigUtils=e=>({cache:createLruCache(e.cacheSize),parseClassName:createParseClassName(e),...createClassGroupUtils(e)}),SPLIT_CLASSES_REGEX=/\s+/,mergeClassList=(e,i)=>{const{parseClassName:s,getClassGroupId:a,getConflictingClassGroupIds:_}=i,et=[],nt=e.trim().split(SPLIT_CLASSES_REGEX);let c="";for(let ct=nt.length-1;ct>=0;ct-=1){const dt=nt[ct],{modifiers:gt,hasImportantModifier:Tt,baseClassName:Et,maybePostfixModifierPosition:At}=s(dt);let Mt=!!At,Pt=a(Mt?Et.substring(0,At):Et);if(!Pt){if(!Mt){c=dt+(c.length>0?" "+c:c);continue}if(Pt=a(Et),!Pt){c=dt+(c.length>0?" "+c:c);continue}Mt=!1}const $t=sortModifiers(gt).join(":"),Lt=Tt?$t+IMPORTANT_MODIFIER:$t,Bt=Lt+Pt;if(et.includes(Bt))continue;et.push(Bt);const Nt=_(Pt,Mt);for(let Vt=0;Vt<Nt.length;++Vt){const Xt=Nt[Vt];et.push(Lt+Xt)}c=dt+(c.length>0?" "+c:c)}return c};function twJoin(){let e=0,i,s,a="";for(;e<arguments.length;)(i=arguments[e++])&&(s=toValue(i))&&(a&&(a+=" "),a+=s);return a}const toValue=e=>{if(typeof e=="string")return e;let i,s="";for(let a=0;a<e.length;a++)e[a]&&(i=toValue(e[a]))&&(s&&(s+=" "),s+=i);return s};function createTailwindMerge(e,...i){let s,a,_,et=nt;function nt(ct){const dt=i.reduce((gt,Tt)=>Tt(gt),e());return s=createConfigUtils(dt),a=s.cache.get,_=s.cache.set,et=c,c(ct)}function c(ct){const dt=a(ct);if(dt)return dt;const gt=mergeClassList(ct,s);return _(ct,gt),gt}return function(){return et(twJoin.apply(null,arguments))}}const fromTheme=e=>{const i=s=>s[e]||[];return i.isThemeGetter=!0,i},arbitraryValueRegex=/^\[(?:([a-z-]+):)?(.+)\]$/i,fractionRegex=/^\d+\/\d+$/,stringLengths=new Set(["px","full","screen"]),tshirtUnitRegex=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,lengthUnitRegex=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,colorFunctionRegex=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,shadowRegex=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,imageRegex=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,isLength=e=>isNumber$1(e)||stringLengths.has(e)||fractionRegex.test(e),isArbitraryLength=e=>getIsArbitraryValue(e,"length",isLengthOnly),isNumber$1=e=>!!e&&!Number.isNaN(Number(e)),isArbitraryNumber=e=>getIsArbitraryValue(e,"number",isNumber$1),isInteger=e=>!!e&&Number.isInteger(Number(e)),isPercent=e=>e.endsWith("%")&&isNumber$1(e.slice(0,-1)),isArbitraryValue=e=>arbitraryValueRegex.test(e),isTshirtSize=e=>tshirtUnitRegex.test(e),sizeLabels=new Set(["length","size","percentage"]),isArbitrarySize=e=>getIsArbitraryValue(e,sizeLabels,isNever),isArbitraryPosition=e=>getIsArbitraryValue(e,"position",isNever),imageLabels=new Set(["image","url"]),isArbitraryImage=e=>getIsArbitraryValue(e,imageLabels,isImage),isArbitraryShadow=e=>getIsArbitraryValue(e,"",isShadow),isAny=()=>!0,getIsArbitraryValue=(e,i,s)=>{const a=arbitraryValueRegex.exec(e);return a?a[1]?typeof i=="string"?a[1]===i:i.has(a[1]):s(a[2]):!1},isLengthOnly=e=>lengthUnitRegex.test(e)&&!colorFunctionRegex.test(e),isNever=()=>!1,isShadow=e=>shadowRegex.test(e),isImage=e=>imageRegex.test(e),getDefaultConfig=()=>{const e=fromTheme("colors"),i=fromTheme("spacing"),s=fromTheme("blur"),a=fromTheme("brightness"),_=fromTheme("borderColor"),et=fromTheme("borderRadius"),nt=fromTheme("borderSpacing"),c=fromTheme("borderWidth"),ct=fromTheme("contrast"),dt=fromTheme("grayscale"),gt=fromTheme("hueRotate"),Tt=fromTheme("invert"),Et=fromTheme("gap"),At=fromTheme("gradientColorStops"),Mt=fromTheme("gradientColorStopPositions"),Pt=fromTheme("inset"),$t=fromTheme("margin"),Lt=fromTheme("opacity"),Bt=fromTheme("padding"),Nt=fromTheme("saturate"),Vt=fromTheme("scale"),Xt=fromTheme("sepia"),nr=fromTheme("skew"),ar=fromTheme("space"),mr=fromTheme("translate"),Fr=()=>["auto","contain","none"],sn=()=>["auto","hidden","clip","visible","scroll"],fn=()=>["auto",isArbitraryValue,i],Lr=()=>[isArbitraryValue,i],Qr=()=>["",isLength,isArbitraryLength],dn=()=>["auto",isNumber$1,isArbitraryValue],en=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],yr=()=>["solid","dashed","dotted","double","none"],Ar=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],rr=()=>["start","end","center","between","around","evenly","stretch"],ur=()=>["","0",isArbitraryValue],Br=()=>["auto","avoid","all","avoid-page","page","left","right","column"],xr=()=>[isNumber$1,isArbitraryValue];return{cacheSize:500,separator:":",theme:{colors:[isAny],spacing:[isLength,isArbitraryLength],blur:["none","",isTshirtSize,isArbitraryValue],brightness:xr(),borderColor:[e],borderRadius:["none","","full",isTshirtSize,isArbitraryValue],borderSpacing:Lr(),borderWidth:Qr(),contrast:xr(),grayscale:ur(),hueRotate:xr(),invert:ur(),gap:Lr(),gradientColorStops:[e],gradientColorStopPositions:[isPercent,isArbitraryLength],inset:fn(),margin:fn(),opacity:xr(),padding:Lr(),saturate:xr(),scale:xr(),sepia:ur(),skew:xr(),space:Lr(),translate:Lr()},classGroups:{aspect:[{aspect:["auto","square","video",isArbitraryValue]}],container:["container"],columns:[{columns:[isTshirtSize]}],"break-after":[{"break-after":Br()}],"break-before":[{"break-before":Br()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...en(),isArbitraryValue]}],overflow:[{overflow:sn()}],"overflow-x":[{"overflow-x":sn()}],"overflow-y":[{"overflow-y":sn()}],overscroll:[{overscroll:Fr()}],"overscroll-x":[{"overscroll-x":Fr()}],"overscroll-y":[{"overscroll-y":Fr()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[Pt]}],"inset-x":[{"inset-x":[Pt]}],"inset-y":[{"inset-y":[Pt]}],start:[{start:[Pt]}],end:[{end:[Pt]}],top:[{top:[Pt]}],right:[{right:[Pt]}],bottom:[{bottom:[Pt]}],left:[{left:[Pt]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",isInteger,isArbitraryValue]}],basis:[{basis:fn()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",isArbitraryValue]}],grow:[{grow:ur()}],shrink:[{shrink:ur()}],order:[{order:["first","last","none",isInteger,isArbitraryValue]}],"grid-cols":[{"grid-cols":[isAny]}],"col-start-end":[{col:["auto",{span:["full",isInteger,isArbitraryValue]},isArbitraryValue]}],"col-start":[{"col-start":dn()}],"col-end":[{"col-end":dn()}],"grid-rows":[{"grid-rows":[isAny]}],"row-start-end":[{row:["auto",{span:[isInteger,isArbitraryValue]},isArbitraryValue]}],"row-start":[{"row-start":dn()}],"row-end":[{"row-end":dn()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",isArbitraryValue]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",isArbitraryValue]}],gap:[{gap:[Et]}],"gap-x":[{"gap-x":[Et]}],"gap-y":[{"gap-y":[Et]}],"justify-content":[{justify:["normal",...rr()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...rr(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...rr(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[Bt]}],px:[{px:[Bt]}],py:[{py:[Bt]}],ps:[{ps:[Bt]}],pe:[{pe:[Bt]}],pt:[{pt:[Bt]}],pr:[{pr:[Bt]}],pb:[{pb:[Bt]}],pl:[{pl:[Bt]}],m:[{m:[$t]}],mx:[{mx:[$t]}],my:[{my:[$t]}],ms:[{ms:[$t]}],me:[{me:[$t]}],mt:[{mt:[$t]}],mr:[{mr:[$t]}],mb:[{mb:[$t]}],ml:[{ml:[$t]}],"space-x":[{"space-x":[ar]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[ar]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",isArbitraryValue,i]}],"min-w":[{"min-w":[isArbitraryValue,i,"min","max","fit"]}],"max-w":[{"max-w":[isArbitraryValue,i,"none","full","min","max","fit","prose",{screen:[isTshirtSize]},isTshirtSize]}],h:[{h:[isArbitraryValue,i,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[isArbitraryValue,i,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[isArbitraryValue,i,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[isArbitraryValue,i,"auto","min","max","fit"]}],"font-size":[{text:["base",isTshirtSize,isArbitraryLength]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",isArbitraryNumber]}],"font-family":[{font:[isAny]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",isArbitraryValue]}],"line-clamp":[{"line-clamp":["none",isNumber$1,isArbitraryNumber]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",isLength,isArbitraryValue]}],"list-image":[{"list-image":["none",isArbitraryValue]}],"list-style-type":[{list:["none","disc","decimal",isArbitraryValue]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[Lt]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[Lt]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...yr(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",isLength,isArbitraryLength]}],"underline-offset":[{"underline-offset":["auto",isLength,isArbitraryValue]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Lr()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",isArbitraryValue]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",isArbitraryValue]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[Lt]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...en(),isArbitraryPosition]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",isArbitrarySize]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},isArbitraryImage]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[Mt]}],"gradient-via-pos":[{via:[Mt]}],"gradient-to-pos":[{to:[Mt]}],"gradient-from":[{from:[At]}],"gradient-via":[{via:[At]}],"gradient-to":[{to:[At]}],rounded:[{rounded:[et]}],"rounded-s":[{"rounded-s":[et]}],"rounded-e":[{"rounded-e":[et]}],"rounded-t":[{"rounded-t":[et]}],"rounded-r":[{"rounded-r":[et]}],"rounded-b":[{"rounded-b":[et]}],"rounded-l":[{"rounded-l":[et]}],"rounded-ss":[{"rounded-ss":[et]}],"rounded-se":[{"rounded-se":[et]}],"rounded-ee":[{"rounded-ee":[et]}],"rounded-es":[{"rounded-es":[et]}],"rounded-tl":[{"rounded-tl":[et]}],"rounded-tr":[{"rounded-tr":[et]}],"rounded-br":[{"rounded-br":[et]}],"rounded-bl":[{"rounded-bl":[et]}],"border-w":[{border:[c]}],"border-w-x":[{"border-x":[c]}],"border-w-y":[{"border-y":[c]}],"border-w-s":[{"border-s":[c]}],"border-w-e":[{"border-e":[c]}],"border-w-t":[{"border-t":[c]}],"border-w-r":[{"border-r":[c]}],"border-w-b":[{"border-b":[c]}],"border-w-l":[{"border-l":[c]}],"border-opacity":[{"border-opacity":[Lt]}],"border-style":[{border:[...yr(),"hidden"]}],"divide-x":[{"divide-x":[c]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[c]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[Lt]}],"divide-style":[{divide:yr()}],"border-color":[{border:[_]}],"border-color-x":[{"border-x":[_]}],"border-color-y":[{"border-y":[_]}],"border-color-s":[{"border-s":[_]}],"border-color-e":[{"border-e":[_]}],"border-color-t":[{"border-t":[_]}],"border-color-r":[{"border-r":[_]}],"border-color-b":[{"border-b":[_]}],"border-color-l":[{"border-l":[_]}],"divide-color":[{divide:[_]}],"outline-style":[{outline:["",...yr()]}],"outline-offset":[{"outline-offset":[isLength,isArbitraryValue]}],"outline-w":[{outline:[isLength,isArbitraryLength]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:Qr()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[Lt]}],"ring-offset-w":[{"ring-offset":[isLength,isArbitraryLength]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",isTshirtSize,isArbitraryShadow]}],"shadow-color":[{shadow:[isAny]}],opacity:[{opacity:[Lt]}],"mix-blend":[{"mix-blend":[...Ar(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Ar()}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[a]}],contrast:[{contrast:[ct]}],"drop-shadow":[{"drop-shadow":["","none",isTshirtSize,isArbitraryValue]}],grayscale:[{grayscale:[dt]}],"hue-rotate":[{"hue-rotate":[gt]}],invert:[{invert:[Tt]}],saturate:[{saturate:[Nt]}],sepia:[{sepia:[Xt]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[a]}],"backdrop-contrast":[{"backdrop-contrast":[ct]}],"backdrop-grayscale":[{"backdrop-grayscale":[dt]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[gt]}],"backdrop-invert":[{"backdrop-invert":[Tt]}],"backdrop-opacity":[{"backdrop-opacity":[Lt]}],"backdrop-saturate":[{"backdrop-saturate":[Nt]}],"backdrop-sepia":[{"backdrop-sepia":[Xt]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[nt]}],"border-spacing-x":[{"border-spacing-x":[nt]}],"border-spacing-y":[{"border-spacing-y":[nt]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",isArbitraryValue]}],duration:[{duration:xr()}],ease:[{ease:["linear","in","out","in-out",isArbitraryValue]}],delay:[{delay:xr()}],animate:[{animate:["none","spin","ping","pulse","bounce",isArbitraryValue]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Vt]}],"scale-x":[{"scale-x":[Vt]}],"scale-y":[{"scale-y":[Vt]}],rotate:[{rotate:[isInteger,isArbitraryValue]}],"translate-x":[{"translate-x":[mr]}],"translate-y":[{"translate-y":[mr]}],"skew-x":[{"skew-x":[nr]}],"skew-y":[{"skew-y":[nr]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",isArbitraryValue]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",isArbitraryValue]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Lr()}],"scroll-mx":[{"scroll-mx":Lr()}],"scroll-my":[{"scroll-my":Lr()}],"scroll-ms":[{"scroll-ms":Lr()}],"scroll-me":[{"scroll-me":Lr()}],"scroll-mt":[{"scroll-mt":Lr()}],"scroll-mr":[{"scroll-mr":Lr()}],"scroll-mb":[{"scroll-mb":Lr()}],"scroll-ml":[{"scroll-ml":Lr()}],"scroll-p":[{"scroll-p":Lr()}],"scroll-px":[{"scroll-px":Lr()}],"scroll-py":[{"scroll-py":Lr()}],"scroll-ps":[{"scroll-ps":Lr()}],"scroll-pe":[{"scroll-pe":Lr()}],"scroll-pt":[{"scroll-pt":Lr()}],"scroll-pr":[{"scroll-pr":Lr()}],"scroll-pb":[{"scroll-pb":Lr()}],"scroll-pl":[{"scroll-pl":Lr()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",isArbitraryValue]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[isLength,isArbitraryLength,isArbitraryNumber]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},twMerge=createTailwindMerge(getDefaultConfig);function cn(...e){return twMerge(clsx(e))}function calculateDistance(e,i,s,a){const et=deg2rad(s-e),nt=deg2rad(a-i),c=Math.sin(et/2)*Math.sin(et/2)+Math.cos(deg2rad(e))*Math.cos(deg2rad(s))*Math.sin(nt/2)*Math.sin(nt/2),dt=6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)));return dt<1?`${Math.round(dt*1e3)}m`:`${dt.toFixed(1)} km`}function deg2rad(e){return e*(Math.PI/180)}const ToastProvider=Provider$2,ToastViewport=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Viewport$1,{ref:s,className:cn("fixed top-0 z-[100] flex max-h-screen w-full flex-col p-4 sm:right-0 sm:flex-col md:max-w-[420px]",e),...i}));ToastViewport.displayName=Viewport$1.displayName;const toastVariants=cva("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-top-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Toast=reactExports.forwardRef(({className:e,variant:i,...s},a)=>jsxRuntimeExports.jsx(Root2$4,{ref:a,className:cn(toastVariants({variant:i}),e),...s}));Toast.displayName=Root2$4.displayName;const ToastAction=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Action$2,{ref:s,className:cn("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...i}));ToastAction.displayName=Action$2.displayName;const ToastClose=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Close$1,{ref:s,className:cn("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...i,children:jsxRuntimeExports.jsx(X,{className:"h-4 w-4"})}));ToastClose.displayName=Close$1.displayName;const ToastTitle=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Title$1,{ref:s,className:cn("text-sm font-semibold",e),...i}));ToastTitle.displayName=Title$1.displayName;const ToastDescription=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Description$1,{ref:s,className:cn("text-sm opacity-90",e),...i}));ToastDescription.displayName=Description$1.displayName;function Toaster$1(){const{toasts:e}=useToast();return jsxRuntimeExports.jsxs(ToastProvider,{children:[e.map(function({id:i,title:s,description:a,action:_,...et}){return jsxRuntimeExports.jsxs(Toast,{...et,children:[jsxRuntimeExports.jsxs("div",{className:"grid gap-1",children:[s&&jsxRuntimeExports.jsx(ToastTitle,{children:s}),a&&jsxRuntimeExports.jsx(ToastDescription,{children:a})]}),_,jsxRuntimeExports.jsx(ToastClose,{})]},i)}),jsxRuntimeExports.jsx(ToastViewport,{})]})}var P=["light","dark"],E="(prefers-color-scheme: dark)",L=reactExports.createContext(void 0),D={setTheme:e=>{},themes:[]},j=()=>{var e;return(e=reactExports.useContext(L))!=null?e:D};reactExports.memo(({forcedTheme:e,storageKey:i,attribute:s,enableSystem:a,enableColorScheme:_,defaultTheme:et,value:nt,attrs:c,nonce:ct})=>{let dt=et==="system",gt=s==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${c.map(Mt=>`'${Mt}'`).join(",")})`};`:`var d=document.documentElement,n='${s}',s='setAttribute';`,Tt=_?P.includes(et)&&et?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${et}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",Et=(Mt,Pt=!1,$t=!0)=>{let Lt=nt?nt[Mt]:Mt,Bt=Pt?Mt+"|| ''":`'${Lt}'`,Nt="";return _&&$t&&!Pt&&P.includes(Mt)&&(Nt+=`d.style.colorScheme = '${Mt}';`),s==="class"?Pt||Lt?Nt+=`c.add(${Bt})`:Nt+="null":Lt&&(Nt+=`d[s](n,${Bt})`),Nt},At=e?`!function(){${gt}${Et(e)}}()`:a?`!function(){try{${gt}var e=localStorage.getItem('${i}');if('system'===e||(!e&&${dt})){var t='${E}',m=window.matchMedia(t);if(m.media!==t||m.matches){${Et("dark")}}else{${Et("light")}}}else if(e){${nt?`var x=${JSON.stringify(nt)};`:""}${Et(nt?"x[e]":"e",!0)}}${dt?"":"else{"+Et(et,!1,!1)+"}"}${Tt}}catch(e){}}()`:`!function(){try{${gt}var e=localStorage.getItem('${i}');if(e){${nt?`var x=${JSON.stringify(nt)};`:""}${Et(nt?"x[e]":"e",!0)}}else{${Et(et,!1,!1)};}${Tt}}catch(t){}}();`;return reactExports.createElement("script",{nonce:ct,dangerouslySetInnerHTML:{__html:At}})});var jt=e=>{switch(e){case"success":return ee;case"info":return ae;case"warning":return oe;case"error":return se;default:return null}},te=Array(12).fill(0),Yt=({visible:e,className:i})=>React.createElement("div",{className:["sonner-loading-wrapper",i].filter(Boolean).join(" "),"data-visible":e},React.createElement("div",{className:"sonner-spinner"},te.map((s,a)=>React.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${a}`})))),ee=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),oe=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),ae=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),se=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Ot=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},React.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),React.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Ft=()=>{let[e,i]=React.useState(document.hidden);return React.useEffect(()=>{let s=()=>{i(document.hidden)};return document.addEventListener("visibilitychange",s),()=>window.removeEventListener("visibilitychange",s)},[]),e},bt=1,yt=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let i=this.subscribers.indexOf(e);this.subscribers.splice(i,1)}),this.publish=e=>{this.subscribers.forEach(i=>i(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var i;let{message:s,...a}=e,_=typeof(e==null?void 0:e.id)=="number"||((i=e.id)==null?void 0:i.length)>0?e.id:bt++,et=this.toasts.find(c=>c.id===_),nt=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(_)&&this.dismissedToasts.delete(_),et?this.toasts=this.toasts.map(c=>c.id===_?(this.publish({...c,...e,id:_,title:s}),{...c,...e,id:_,dismissible:nt,title:s}):c):this.addToast({title:s,...a,dismissible:nt,id:_}),_},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(i=>{this.subscribers.forEach(s=>s({id:i.id,dismiss:!0}))}),this.subscribers.forEach(i=>i({id:e,dismiss:!0})),e),this.message=(e,i)=>this.create({...i,message:e}),this.error=(e,i)=>this.create({...i,message:e,type:"error"}),this.success=(e,i)=>this.create({...i,type:"success",message:e}),this.info=(e,i)=>this.create({...i,type:"info",message:e}),this.warning=(e,i)=>this.create({...i,type:"warning",message:e}),this.loading=(e,i)=>this.create({...i,type:"loading",message:e}),this.promise=(e,i)=>{if(!i)return;let s;i.loading!==void 0&&(s=this.create({...i,promise:e,type:"loading",message:i.loading,description:typeof i.description!="function"?i.description:void 0}));let a=e instanceof Promise?e:e(),_=s!==void 0,et,nt=a.then(async ct=>{if(et=["resolve",ct],React.isValidElement(ct))_=!1,this.create({id:s,type:"default",message:ct});else if(ie(ct)&&!ct.ok){_=!1;let dt=typeof i.error=="function"?await i.error(`HTTP error! status: ${ct.status}`):i.error,gt=typeof i.description=="function"?await i.description(`HTTP error! status: ${ct.status}`):i.description;this.create({id:s,type:"error",message:dt,description:gt})}else if(i.success!==void 0){_=!1;let dt=typeof i.success=="function"?await i.success(ct):i.success,gt=typeof i.description=="function"?await i.description(ct):i.description;this.create({id:s,type:"success",message:dt,description:gt})}}).catch(async ct=>{if(et=["reject",ct],i.error!==void 0){_=!1;let dt=typeof i.error=="function"?await i.error(ct):i.error,gt=typeof i.description=="function"?await i.description(ct):i.description;this.create({id:s,type:"error",message:dt,description:gt})}}).finally(()=>{var ct;_&&(this.dismiss(s),s=void 0),(ct=i.finally)==null||ct.call(i)}),c=()=>new Promise((ct,dt)=>nt.then(()=>et[0]==="reject"?dt(et[1]):ct(et[1])).catch(dt));return typeof s!="string"&&typeof s!="number"?{unwrap:c}:Object.assign(s,{unwrap:c})},this.custom=(e,i)=>{let s=(i==null?void 0:i.id)||bt++;return this.create({jsx:e(s),id:s,...i}),s},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},v$2=new yt,ne=(e,i)=>{let s=(i==null?void 0:i.id)||bt++;return v$2.addToast({title:e,...i,id:s}),s},ie=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",le=ne,ce=()=>v$2.toasts,de=()=>v$2.getActiveToasts(),ue=Object.assign(le,{success:v$2.success,info:v$2.info,warning:v$2.warning,error:v$2.error,custom:v$2.custom,message:v$2.message,promise:v$2.promise,dismiss:v$2.dismiss,loading:v$2.loading},{getHistory:ce,getToasts:de});function wt(e,{insertAt:i}={}){if(typeof document>"u")return;let s=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",i==="top"&&s.firstChild?s.insertBefore(a,s.firstChild):s.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}wt(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function tt(e){return e.label!==void 0}var pe=3,me="32px",ge="16px",Wt=4e3,he=356,be=14,ye=20,we=200;function M(...e){return e.filter(Boolean).join(" ")}function xe(e){let[i,s]=e.split("-"),a=[];return i&&a.push(i),s&&a.push(s),a}var ve=e=>{var i,s,a,_,et,nt,c,ct,dt,gt,Tt;let{invert:Et,toast:At,unstyled:Mt,interacting:Pt,setHeights:$t,visibleToasts:Lt,heights:Bt,index:Nt,toasts:Vt,expanded:Xt,removeToast:nr,defaultRichColors:ar,closeButton:mr,style:Fr,cancelButtonStyle:sn,actionButtonStyle:fn,className:Lr="",descriptionClassName:Qr="",duration:dn,position:en,gap:yr,loadingIcon:Ar,expandByDefault:rr,classNames:ur,icons:Br,closeButtonAriaLabel:xr="Close toast",pauseWhenPageIsHidden:qr}=e,[tn,vn]=React.useState(null),[hs,Ts]=React.useState(null),[ss,Mn]=React.useState(!1),[ds,gs]=React.useState(!1),[ys,Hs]=React.useState(!1),[_s,Ss]=React.useState(!1),[Vl,ba]=React.useState(!1),[Qo,wo]=React.useState(0),[cu,uu]=React.useState(0),Pl=React.useRef(At.duration||dn||Wt),Jl=React.useRef(null),Ul=React.useRef(null),xl=Nt===0,Yn=Nt+1<=Lt,xn=At.type,Qn=At.dismissible!==!1,os=At.className||"",Ks=At.descriptionClassName||"",oo=React.useMemo(()=>Bt.findIndex(io=>io.toastId===At.id)||0,[Bt,At.id]),qo=React.useMemo(()=>{var io;return(io=At.closeButton)!=null?io:mr},[At.closeButton,mr]),zn=React.useMemo(()=>At.duration||dn||Wt,[At.duration,dn]),Xn=React.useRef(0),xs=React.useRef(0),As=React.useRef(0),ks=React.useRef(null),[Eo,Jo]=en.split("-"),na=React.useMemo(()=>Bt.reduce((io,zo,Ko)=>Ko>=oo?io:io+zo.height,0),[Bt,oo]),Go=Ft(),_c=At.invert||Et,Il=xn==="loading";xs.current=React.useMemo(()=>oo*yr+na,[oo,na]),React.useEffect(()=>{Pl.current=zn},[zn]),React.useEffect(()=>{Mn(!0)},[]),React.useEffect(()=>{let io=Ul.current;if(io){let zo=io.getBoundingClientRect().height;return uu(zo),$t(Ko=>[{toastId:At.id,height:zo,position:At.position},...Ko]),()=>$t(Ko=>Ko.filter(vu=>vu.toastId!==At.id))}},[$t,At.id]),React.useLayoutEffect(()=>{if(!ss)return;let io=Ul.current,zo=io.style.height;io.style.height="auto";let Ko=io.getBoundingClientRect().height;io.style.height=zo,uu(Ko),$t(vu=>vu.find(_n=>_n.toastId===At.id)?vu.map(_n=>_n.toastId===At.id?{..._n,height:Ko}:_n):[{toastId:At.id,height:Ko,position:At.position},...vu])},[ss,At.title,At.description,$t,At.id]);let Zs=React.useCallback(()=>{gs(!0),wo(xs.current),$t(io=>io.filter(zo=>zo.toastId!==At.id)),setTimeout(()=>{nr(At)},we)},[At,nr,$t,xs]);React.useEffect(()=>{if(At.promise&&xn==="loading"||At.duration===1/0||At.type==="loading")return;let io;return Xt||Pt||qr&&Go?(()=>{if(As.current<Xn.current){let zo=new Date().getTime()-Xn.current;Pl.current=Pl.current-zo}As.current=new Date().getTime()})():Pl.current!==1/0&&(Xn.current=new Date().getTime(),io=setTimeout(()=>{var zo;(zo=At.onAutoClose)==null||zo.call(At,At),Zs()},Pl.current)),()=>clearTimeout(io)},[Xt,Pt,At,xn,qr,Go,Zs]),React.useEffect(()=>{At.delete&&Zs()},[Zs,At.delete]);function $l(){var io,zo,Ko;return Br!=null&&Br.loading?React.createElement("div",{className:M(ur==null?void 0:ur.loader,(io=At==null?void 0:At.classNames)==null?void 0:io.loader,"sonner-loader"),"data-visible":xn==="loading"},Br.loading):Ar?React.createElement("div",{className:M(ur==null?void 0:ur.loader,(zo=At==null?void 0:At.classNames)==null?void 0:zo.loader,"sonner-loader"),"data-visible":xn==="loading"},Ar):React.createElement(Yt,{className:M(ur==null?void 0:ur.loader,(Ko=At==null?void 0:At.classNames)==null?void 0:Ko.loader),visible:xn==="loading"})}return React.createElement("li",{tabIndex:0,ref:Ul,className:M(Lr,os,ur==null?void 0:ur.toast,(i=At==null?void 0:At.classNames)==null?void 0:i.toast,ur==null?void 0:ur.default,ur==null?void 0:ur[xn],(s=At==null?void 0:At.classNames)==null?void 0:s[xn]),"data-sonner-toast":"","data-rich-colors":(a=At.richColors)!=null?a:ar,"data-styled":!(At.jsx||At.unstyled||Mt),"data-mounted":ss,"data-promise":!!At.promise,"data-swiped":Vl,"data-removed":ds,"data-visible":Yn,"data-y-position":Eo,"data-x-position":Jo,"data-index":Nt,"data-front":xl,"data-swiping":ys,"data-dismissible":Qn,"data-type":xn,"data-invert":_c,"data-swipe-out":_s,"data-swipe-direction":hs,"data-expanded":!!(Xt||rr&&ss),style:{"--index":Nt,"--toasts-before":Nt,"--z-index":Vt.length-Nt,"--offset":`${ds?Qo:xs.current}px`,"--initial-height":rr?"auto":`${cu}px`,...Fr,...At.style},onDragEnd:()=>{Hs(!1),vn(null),ks.current=null},onPointerDown:io=>{Il||!Qn||(Jl.current=new Date,wo(xs.current),io.target.setPointerCapture(io.pointerId),io.target.tagName!=="BUTTON"&&(Hs(!0),ks.current={x:io.clientX,y:io.clientY}))},onPointerUp:()=>{var io,zo,Ko,vu;if(_s||!Qn)return;ks.current=null;let _n=Number(((io=Ul.current)==null?void 0:io.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Su=Number(((zo=Ul.current)==null?void 0:zo.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),bp=new Date().getTime()-((Ko=Jl.current)==null?void 0:Ko.getTime()),bu=tn==="x"?_n:Su,Xs=Math.abs(bu)/bp;if(Math.abs(bu)>=ye||Xs>.11){wo(xs.current),(vu=At.onDismiss)==null||vu.call(At,At),Ts(tn==="x"?_n>0?"right":"left":Su>0?"down":"up"),Zs(),Ss(!0),ba(!1);return}Hs(!1),vn(null)},onPointerMove:io=>{var zo,Ko,vu,_n;if(!ks.current||!Qn||((zo=window.getSelection())==null?void 0:zo.toString().length)>0)return;let Su=io.clientY-ks.current.y,bp=io.clientX-ks.current.x,bu=(Ko=e.swipeDirections)!=null?Ko:xe(en);!tn&&(Math.abs(bp)>1||Math.abs(Su)>1)&&vn(Math.abs(bp)>Math.abs(Su)?"x":"y");let Xs={x:0,y:0};tn==="y"?(bu.includes("top")||bu.includes("bottom"))&&(bu.includes("top")&&Su<0||bu.includes("bottom")&&Su>0)&&(Xs.y=Su):tn==="x"&&(bu.includes("left")||bu.includes("right"))&&(bu.includes("left")&&bp<0||bu.includes("right")&&bp>0)&&(Xs.x=bp),(Math.abs(Xs.x)>0||Math.abs(Xs.y)>0)&&ba(!0),(vu=Ul.current)==null||vu.style.setProperty("--swipe-amount-x",`${Xs.x}px`),(_n=Ul.current)==null||_n.style.setProperty("--swipe-amount-y",`${Xs.y}px`)}},qo&&!At.jsx?React.createElement("button",{"aria-label":xr,"data-disabled":Il,"data-close-button":!0,onClick:Il||!Qn?()=>{}:()=>{var io;Zs(),(io=At.onDismiss)==null||io.call(At,At)},className:M(ur==null?void 0:ur.closeButton,(_=At==null?void 0:At.classNames)==null?void 0:_.closeButton)},(et=Br==null?void 0:Br.close)!=null?et:Ot):null,At.jsx||reactExports.isValidElement(At.title)?At.jsx?At.jsx:typeof At.title=="function"?At.title():At.title:React.createElement(React.Fragment,null,xn||At.icon||At.promise?React.createElement("div",{"data-icon":"",className:M(ur==null?void 0:ur.icon,(nt=At==null?void 0:At.classNames)==null?void 0:nt.icon)},At.promise||At.type==="loading"&&!At.icon?At.icon||$l():null,At.type!=="loading"?At.icon||(Br==null?void 0:Br[xn])||jt(xn):null):null,React.createElement("div",{"data-content":"",className:M(ur==null?void 0:ur.content,(c=At==null?void 0:At.classNames)==null?void 0:c.content)},React.createElement("div",{"data-title":"",className:M(ur==null?void 0:ur.title,(ct=At==null?void 0:At.classNames)==null?void 0:ct.title)},typeof At.title=="function"?At.title():At.title),At.description?React.createElement("div",{"data-description":"",className:M(Qr,Ks,ur==null?void 0:ur.description,(dt=At==null?void 0:At.classNames)==null?void 0:dt.description)},typeof At.description=="function"?At.description():At.description):null),reactExports.isValidElement(At.cancel)?At.cancel:At.cancel&&tt(At.cancel)?React.createElement("button",{"data-button":!0,"data-cancel":!0,style:At.cancelButtonStyle||sn,onClick:io=>{var zo,Ko;tt(At.cancel)&&Qn&&((Ko=(zo=At.cancel).onClick)==null||Ko.call(zo,io),Zs())},className:M(ur==null?void 0:ur.cancelButton,(gt=At==null?void 0:At.classNames)==null?void 0:gt.cancelButton)},At.cancel.label):null,reactExports.isValidElement(At.action)?At.action:At.action&&tt(At.action)?React.createElement("button",{"data-button":!0,"data-action":!0,style:At.actionButtonStyle||fn,onClick:io=>{var zo,Ko;tt(At.action)&&((Ko=(zo=At.action).onClick)==null||Ko.call(zo,io),!io.defaultPrevented&&Zs())},className:M(ur==null?void 0:ur.actionButton,(Tt=At==null?void 0:At.classNames)==null?void 0:Tt.actionButton)},At.action.label):null))};function _t(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function Te(e,i){let s={};return[e,i].forEach((a,_)=>{let et=_===1,nt=et?"--mobile-offset":"--offset",c=et?ge:me;function ct(dt){["top","right","bottom","left"].forEach(gt=>{s[`${nt}-${gt}`]=typeof dt=="number"?`${dt}px`:dt})}typeof a=="number"||typeof a=="string"?ct(a):typeof a=="object"?["top","right","bottom","left"].forEach(dt=>{a[dt]===void 0?s[`${nt}-${dt}`]=c:s[`${nt}-${dt}`]=typeof a[dt]=="number"?`${a[dt]}px`:a[dt]}):ct(c)}),s}var $e=reactExports.forwardRef(function(e,i){let{invert:s,position:a="bottom-right",hotkey:_=["altKey","KeyT"],expand:et,closeButton:nt,className:c,offset:ct,mobileOffset:dt,theme:gt="light",richColors:Tt,duration:Et,style:At,visibleToasts:Mt=pe,toastOptions:Pt,dir:$t=_t(),gap:Lt=be,loadingIcon:Bt,icons:Nt,containerAriaLabel:Vt="Notifications",pauseWhenPageIsHidden:Xt}=e,[nr,ar]=React.useState([]),mr=React.useMemo(()=>Array.from(new Set([a].concat(nr.filter(qr=>qr.position).map(qr=>qr.position)))),[nr,a]),[Fr,sn]=React.useState([]),[fn,Lr]=React.useState(!1),[Qr,dn]=React.useState(!1),[en,yr]=React.useState(gt!=="system"?gt:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Ar=React.useRef(null),rr=_.join("+").replace(/Key/g,"").replace(/Digit/g,""),ur=React.useRef(null),Br=React.useRef(!1),xr=React.useCallback(qr=>{ar(tn=>{var vn;return(vn=tn.find(hs=>hs.id===qr.id))!=null&&vn.delete||v$2.dismiss(qr.id),tn.filter(({id:hs})=>hs!==qr.id)})},[]);return React.useEffect(()=>v$2.subscribe(qr=>{if(qr.dismiss){ar(tn=>tn.map(vn=>vn.id===qr.id?{...vn,delete:!0}:vn));return}setTimeout(()=>{vt.flushSync(()=>{ar(tn=>{let vn=tn.findIndex(hs=>hs.id===qr.id);return vn!==-1?[...tn.slice(0,vn),{...tn[vn],...qr},...tn.slice(vn+1)]:[qr,...tn]})})})}),[]),React.useEffect(()=>{if(gt!=="system"){yr(gt);return}if(gt==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?yr("dark"):yr("light")),typeof window>"u")return;let qr=window.matchMedia("(prefers-color-scheme: dark)");try{qr.addEventListener("change",({matches:tn})=>{yr(tn?"dark":"light")})}catch{qr.addListener(({matches:vn})=>{try{yr(vn?"dark":"light")}catch(hs){console.error(hs)}})}},[gt]),React.useEffect(()=>{nr.length<=1&&Lr(!1)},[nr]),React.useEffect(()=>{let qr=tn=>{var vn,hs;_.every(Ts=>tn[Ts]||tn.code===Ts)&&(Lr(!0),(vn=Ar.current)==null||vn.focus()),tn.code==="Escape"&&(document.activeElement===Ar.current||(hs=Ar.current)!=null&&hs.contains(document.activeElement))&&Lr(!1)};return document.addEventListener("keydown",qr),()=>document.removeEventListener("keydown",qr)},[_]),React.useEffect(()=>{if(Ar.current)return()=>{ur.current&&(ur.current.focus({preventScroll:!0}),ur.current=null,Br.current=!1)}},[Ar.current]),React.createElement("section",{ref:i,"aria-label":`${Vt} ${rr}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},mr.map((qr,tn)=>{var vn;let[hs,Ts]=qr.split("-");return nr.length?React.createElement("ol",{key:qr,dir:$t==="auto"?_t():$t,tabIndex:-1,ref:Ar,className:c,"data-sonner-toaster":!0,"data-theme":en,"data-y-position":hs,"data-lifted":fn&&nr.length>1&&!et,"data-x-position":Ts,style:{"--front-toast-height":`${((vn=Fr[0])==null?void 0:vn.height)||0}px`,"--width":`${he}px`,"--gap":`${Lt}px`,...At,...Te(ct,dt)},onBlur:ss=>{Br.current&&!ss.currentTarget.contains(ss.relatedTarget)&&(Br.current=!1,ur.current&&(ur.current.focus({preventScroll:!0}),ur.current=null))},onFocus:ss=>{ss.target instanceof HTMLElement&&ss.target.dataset.dismissible==="false"||Br.current||(Br.current=!0,ur.current=ss.relatedTarget)},onMouseEnter:()=>Lr(!0),onMouseMove:()=>Lr(!0),onMouseLeave:()=>{Qr||Lr(!1)},onDragEnd:()=>Lr(!1),onPointerDown:ss=>{ss.target instanceof HTMLElement&&ss.target.dataset.dismissible==="false"||dn(!0)},onPointerUp:()=>dn(!1)},nr.filter(ss=>!ss.position&&tn===0||ss.position===qr).map((ss,Mn)=>{var ds,gs;return React.createElement(ve,{key:ss.id,icons:Nt,index:Mn,toast:ss,defaultRichColors:Tt,duration:(ds=Pt==null?void 0:Pt.duration)!=null?ds:Et,className:Pt==null?void 0:Pt.className,descriptionClassName:Pt==null?void 0:Pt.descriptionClassName,invert:s,visibleToasts:Mt,closeButton:(gs=Pt==null?void 0:Pt.closeButton)!=null?gs:nt,interacting:Qr,position:qr,style:Pt==null?void 0:Pt.style,unstyled:Pt==null?void 0:Pt.unstyled,classNames:Pt==null?void 0:Pt.classNames,cancelButtonStyle:Pt==null?void 0:Pt.cancelButtonStyle,actionButtonStyle:Pt==null?void 0:Pt.actionButtonStyle,removeToast:xr,toasts:nr.filter(ys=>ys.position==ss.position),heights:Fr.filter(ys=>ys.position==ss.position),setHeights:sn,expandByDefault:et,gap:Lt,loadingIcon:Bt,expanded:fn,pauseWhenPageIsHidden:Xt,swipeDirections:e.swipeDirections})})):null}))});const Toaster=({...e})=>{const{theme:i="system"}=j();return jsxRuntimeExports.jsx($e,{theme:i,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},position:"top-center",...e})};var useReactId=React$1[" useId ".trim().toString()]||(()=>{}),count$1=0;function useId(e){const[i,s]=reactExports.useState(useReactId());return useLayoutEffect2(()=>{s(a=>a??String(count$1++))},[e]),i?`radix-${i}`:""}const sides=["top","right","bottom","left"],min=Math.min,max=Math.max,round=Math.round,floor=Math.floor,createCoords=e=>({x:e,y:e}),oppositeSideMap={left:"right",right:"left",bottom:"top",top:"bottom"},oppositeAlignmentMap={start:"end",end:"start"};function clamp$2(e,i,s){return max(e,min(i,s))}function evaluate(e,i){return typeof e=="function"?e(i):e}function getSide(e){return e.split("-")[0]}function getAlignment(e){return e.split("-")[1]}function getOppositeAxis(e){return e==="x"?"y":"x"}function getAxisLength(e){return e==="y"?"height":"width"}const yAxisSides=new Set(["top","bottom"]);function getSideAxis(e){return yAxisSides.has(getSide(e))?"y":"x"}function getAlignmentAxis(e){return getOppositeAxis(getSideAxis(e))}function getAlignmentSides(e,i,s){s===void 0&&(s=!1);const a=getAlignment(e),_=getAlignmentAxis(e),et=getAxisLength(_);let nt=_==="x"?a===(s?"end":"start")?"right":"left":a==="start"?"bottom":"top";return i.reference[et]>i.floating[et]&&(nt=getOppositePlacement(nt)),[nt,getOppositePlacement(nt)]}function getExpandedPlacements(e){const i=getOppositePlacement(e);return[getOppositeAlignmentPlacement(e),i,getOppositeAlignmentPlacement(i)]}function getOppositeAlignmentPlacement(e){return e.replace(/start|end/g,i=>oppositeAlignmentMap[i])}const lrPlacement=["left","right"],rlPlacement=["right","left"],tbPlacement=["top","bottom"],btPlacement=["bottom","top"];function getSideList(e,i,s){switch(e){case"top":case"bottom":return s?i?rlPlacement:lrPlacement:i?lrPlacement:rlPlacement;case"left":case"right":return i?tbPlacement:btPlacement;default:return[]}}function getOppositeAxisPlacements(e,i,s,a){const _=getAlignment(e);let et=getSideList(getSide(e),s==="start",a);return _&&(et=et.map(nt=>nt+"-"+_),i&&(et=et.concat(et.map(getOppositeAlignmentPlacement)))),et}function getOppositePlacement(e){return e.replace(/left|right|bottom|top/g,i=>oppositeSideMap[i])}function expandPaddingObject(e){return{top:0,right:0,bottom:0,left:0,...e}}function getPaddingObject(e){return typeof e!="number"?expandPaddingObject(e):{top:e,right:e,bottom:e,left:e}}function rectToClientRect(e){const{x:i,y:s,width:a,height:_}=e;return{width:a,height:_,top:s,left:i,right:i+a,bottom:s+_,x:i,y:s}}function computeCoordsFromPlacement(e,i,s){let{reference:a,floating:_}=e;const et=getSideAxis(i),nt=getAlignmentAxis(i),c=getAxisLength(nt),ct=getSide(i),dt=et==="y",gt=a.x+a.width/2-_.width/2,Tt=a.y+a.height/2-_.height/2,Et=a[c]/2-_[c]/2;let At;switch(ct){case"top":At={x:gt,y:a.y-_.height};break;case"bottom":At={x:gt,y:a.y+a.height};break;case"right":At={x:a.x+a.width,y:Tt};break;case"left":At={x:a.x-_.width,y:Tt};break;default:At={x:a.x,y:a.y}}switch(getAlignment(i)){case"start":At[nt]-=Et*(s&&dt?-1:1);break;case"end":At[nt]+=Et*(s&&dt?-1:1);break}return At}const computePosition$1=async(e,i,s)=>{const{placement:a="bottom",strategy:_="absolute",middleware:et=[],platform:nt}=s,c=et.filter(Boolean),ct=await(nt.isRTL==null?void 0:nt.isRTL(i));let dt=await nt.getElementRects({reference:e,floating:i,strategy:_}),{x:gt,y:Tt}=computeCoordsFromPlacement(dt,a,ct),Et=a,At={},Mt=0;for(let Pt=0;Pt<c.length;Pt++){const{name:$t,fn:Lt}=c[Pt],{x:Bt,y:Nt,data:Vt,reset:Xt}=await Lt({x:gt,y:Tt,initialPlacement:a,placement:Et,strategy:_,middlewareData:At,rects:dt,platform:nt,elements:{reference:e,floating:i}});gt=Bt??gt,Tt=Nt??Tt,At={...At,[$t]:{...At[$t],...Vt}},Xt&&Mt<=50&&(Mt++,typeof Xt=="object"&&(Xt.placement&&(Et=Xt.placement),Xt.rects&&(dt=Xt.rects===!0?await nt.getElementRects({reference:e,floating:i,strategy:_}):Xt.rects),{x:gt,y:Tt}=computeCoordsFromPlacement(dt,Et,ct)),Pt=-1)}return{x:gt,y:Tt,placement:Et,strategy:_,middlewareData:At}};async function detectOverflow(e,i){var s;i===void 0&&(i={});const{x:a,y:_,platform:et,rects:nt,elements:c,strategy:ct}=e,{boundary:dt="clippingAncestors",rootBoundary:gt="viewport",elementContext:Tt="floating",altBoundary:Et=!1,padding:At=0}=evaluate(i,e),Mt=getPaddingObject(At),$t=c[Et?Tt==="floating"?"reference":"floating":Tt],Lt=rectToClientRect(await et.getClippingRect({element:(s=await(et.isElement==null?void 0:et.isElement($t)))==null||s?$t:$t.contextElement||await(et.getDocumentElement==null?void 0:et.getDocumentElement(c.floating)),boundary:dt,rootBoundary:gt,strategy:ct})),Bt=Tt==="floating"?{x:a,y:_,width:nt.floating.width,height:nt.floating.height}:nt.reference,Nt=await(et.getOffsetParent==null?void 0:et.getOffsetParent(c.floating)),Vt=await(et.isElement==null?void 0:et.isElement(Nt))?await(et.getScale==null?void 0:et.getScale(Nt))||{x:1,y:1}:{x:1,y:1},Xt=rectToClientRect(et.convertOffsetParentRelativeRectToViewportRelativeRect?await et.convertOffsetParentRelativeRectToViewportRelativeRect({elements:c,rect:Bt,offsetParent:Nt,strategy:ct}):Bt);return{top:(Lt.top-Xt.top+Mt.top)/Vt.y,bottom:(Xt.bottom-Lt.bottom+Mt.bottom)/Vt.y,left:(Lt.left-Xt.left+Mt.left)/Vt.x,right:(Xt.right-Lt.right+Mt.right)/Vt.x}}const arrow$3=e=>({name:"arrow",options:e,async fn(i){const{x:s,y:a,placement:_,rects:et,platform:nt,elements:c,middlewareData:ct}=i,{element:dt,padding:gt=0}=evaluate(e,i)||{};if(dt==null)return{};const Tt=getPaddingObject(gt),Et={x:s,y:a},At=getAlignmentAxis(_),Mt=getAxisLength(At),Pt=await nt.getDimensions(dt),$t=At==="y",Lt=$t?"top":"left",Bt=$t?"bottom":"right",Nt=$t?"clientHeight":"clientWidth",Vt=et.reference[Mt]+et.reference[At]-Et[At]-et.floating[Mt],Xt=Et[At]-et.reference[At],nr=await(nt.getOffsetParent==null?void 0:nt.getOffsetParent(dt));let ar=nr?nr[Nt]:0;(!ar||!await(nt.isElement==null?void 0:nt.isElement(nr)))&&(ar=c.floating[Nt]||et.floating[Mt]);const mr=Vt/2-Xt/2,Fr=ar/2-Pt[Mt]/2-1,sn=min(Tt[Lt],Fr),fn=min(Tt[Bt],Fr),Lr=sn,Qr=ar-Pt[Mt]-fn,dn=ar/2-Pt[Mt]/2+mr,en=clamp$2(Lr,dn,Qr),yr=!ct.arrow&&getAlignment(_)!=null&&dn!==en&&et.reference[Mt]/2-(dn<Lr?sn:fn)-Pt[Mt]/2<0,Ar=yr?dn<Lr?dn-Lr:dn-Qr:0;return{[At]:Et[At]+Ar,data:{[At]:en,centerOffset:dn-en-Ar,...yr&&{alignmentOffset:Ar}},reset:yr}}}),flip$2=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(i){var s,a;const{placement:_,middlewareData:et,rects:nt,initialPlacement:c,platform:ct,elements:dt}=i,{mainAxis:gt=!0,crossAxis:Tt=!0,fallbackPlacements:Et,fallbackStrategy:At="bestFit",fallbackAxisSideDirection:Mt="none",flipAlignment:Pt=!0,...$t}=evaluate(e,i);if((s=et.arrow)!=null&&s.alignmentOffset)return{};const Lt=getSide(_),Bt=getSideAxis(c),Nt=getSide(c)===c,Vt=await(ct.isRTL==null?void 0:ct.isRTL(dt.floating)),Xt=Et||(Nt||!Pt?[getOppositePlacement(c)]:getExpandedPlacements(c)),nr=Mt!=="none";!Et&&nr&&Xt.push(...getOppositeAxisPlacements(c,Pt,Mt,Vt));const ar=[c,...Xt],mr=await detectOverflow(i,$t),Fr=[];let sn=((a=et.flip)==null?void 0:a.overflows)||[];if(gt&&Fr.push(mr[Lt]),Tt){const dn=getAlignmentSides(_,nt,Vt);Fr.push(mr[dn[0]],mr[dn[1]])}if(sn=[...sn,{placement:_,overflows:Fr}],!Fr.every(dn=>dn<=0)){var fn,Lr;const dn=(((fn=et.flip)==null?void 0:fn.index)||0)+1,en=ar[dn];if(en&&(!(Tt==="alignment"?Bt!==getSideAxis(en):!1)||sn.every(rr=>rr.overflows[0]>0&&getSideAxis(rr.placement)===Bt)))return{data:{index:dn,overflows:sn},reset:{placement:en}};let yr=(Lr=sn.filter(Ar=>Ar.overflows[0]<=0).sort((Ar,rr)=>Ar.overflows[1]-rr.overflows[1])[0])==null?void 0:Lr.placement;if(!yr)switch(At){case"bestFit":{var Qr;const Ar=(Qr=sn.filter(rr=>{if(nr){const ur=getSideAxis(rr.placement);return ur===Bt||ur==="y"}return!0}).map(rr=>[rr.placement,rr.overflows.filter(ur=>ur>0).reduce((ur,Br)=>ur+Br,0)]).sort((rr,ur)=>rr[1]-ur[1])[0])==null?void 0:Qr[0];Ar&&(yr=Ar);break}case"initialPlacement":yr=c;break}if(_!==yr)return{reset:{placement:yr}}}return{}}}};function getSideOffsets(e,i){return{top:e.top-i.height,right:e.right-i.width,bottom:e.bottom-i.height,left:e.left-i.width}}function isAnySideFullyClipped(e){return sides.some(i=>e[i]>=0)}const hide$2=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(i){const{rects:s}=i,{strategy:a="referenceHidden",..._}=evaluate(e,i);switch(a){case"referenceHidden":{const et=await detectOverflow(i,{..._,elementContext:"reference"}),nt=getSideOffsets(et,s.reference);return{data:{referenceHiddenOffsets:nt,referenceHidden:isAnySideFullyClipped(nt)}}}case"escaped":{const et=await detectOverflow(i,{..._,altBoundary:!0}),nt=getSideOffsets(et,s.floating);return{data:{escapedOffsets:nt,escaped:isAnySideFullyClipped(nt)}}}default:return{}}}}},originSides=new Set(["left","top"]);async function convertValueToCoords(e,i){const{placement:s,platform:a,elements:_}=e,et=await(a.isRTL==null?void 0:a.isRTL(_.floating)),nt=getSide(s),c=getAlignment(s),ct=getSideAxis(s)==="y",dt=originSides.has(nt)?-1:1,gt=et&&ct?-1:1,Tt=evaluate(i,e);let{mainAxis:Et,crossAxis:At,alignmentAxis:Mt}=typeof Tt=="number"?{mainAxis:Tt,crossAxis:0,alignmentAxis:null}:{mainAxis:Tt.mainAxis||0,crossAxis:Tt.crossAxis||0,alignmentAxis:Tt.alignmentAxis};return c&&typeof Mt=="number"&&(At=c==="end"?Mt*-1:Mt),ct?{x:At*gt,y:Et*dt}:{x:Et*dt,y:At*gt}}const offset$2=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(i){var s,a;const{x:_,y:et,placement:nt,middlewareData:c}=i,ct=await convertValueToCoords(i,e);return nt===((s=c.offset)==null?void 0:s.placement)&&(a=c.arrow)!=null&&a.alignmentOffset?{}:{x:_+ct.x,y:et+ct.y,data:{...ct,placement:nt}}}}},shift$2=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(i){const{x:s,y:a,placement:_}=i,{mainAxis:et=!0,crossAxis:nt=!1,limiter:c={fn:$t=>{let{x:Lt,y:Bt}=$t;return{x:Lt,y:Bt}}},...ct}=evaluate(e,i),dt={x:s,y:a},gt=await detectOverflow(i,ct),Tt=getSideAxis(getSide(_)),Et=getOppositeAxis(Tt);let At=dt[Et],Mt=dt[Tt];if(et){const $t=Et==="y"?"top":"left",Lt=Et==="y"?"bottom":"right",Bt=At+gt[$t],Nt=At-gt[Lt];At=clamp$2(Bt,At,Nt)}if(nt){const $t=Tt==="y"?"top":"left",Lt=Tt==="y"?"bottom":"right",Bt=Mt+gt[$t],Nt=Mt-gt[Lt];Mt=clamp$2(Bt,Mt,Nt)}const Pt=c.fn({...i,[Et]:At,[Tt]:Mt});return{...Pt,data:{x:Pt.x-s,y:Pt.y-a,enabled:{[Et]:et,[Tt]:nt}}}}}},limitShift$2=function(e){return e===void 0&&(e={}),{options:e,fn(i){const{x:s,y:a,placement:_,rects:et,middlewareData:nt}=i,{offset:c=0,mainAxis:ct=!0,crossAxis:dt=!0}=evaluate(e,i),gt={x:s,y:a},Tt=getSideAxis(_),Et=getOppositeAxis(Tt);let At=gt[Et],Mt=gt[Tt];const Pt=evaluate(c,i),$t=typeof Pt=="number"?{mainAxis:Pt,crossAxis:0}:{mainAxis:0,crossAxis:0,...Pt};if(ct){const Nt=Et==="y"?"height":"width",Vt=et.reference[Et]-et.floating[Nt]+$t.mainAxis,Xt=et.reference[Et]+et.reference[Nt]-$t.mainAxis;At<Vt?At=Vt:At>Xt&&(At=Xt)}if(dt){var Lt,Bt;const Nt=Et==="y"?"width":"height",Vt=originSides.has(getSide(_)),Xt=et.reference[Tt]-et.floating[Nt]+(Vt&&((Lt=nt.offset)==null?void 0:Lt[Tt])||0)+(Vt?0:$t.crossAxis),nr=et.reference[Tt]+et.reference[Nt]+(Vt?0:((Bt=nt.offset)==null?void 0:Bt[Tt])||0)-(Vt?$t.crossAxis:0);Mt<Xt?Mt=Xt:Mt>nr&&(Mt=nr)}return{[Et]:At,[Tt]:Mt}}}},size$2=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(i){var s,a;const{placement:_,rects:et,platform:nt,elements:c}=i,{apply:ct=()=>{},...dt}=evaluate(e,i),gt=await detectOverflow(i,dt),Tt=getSide(_),Et=getAlignment(_),At=getSideAxis(_)==="y",{width:Mt,height:Pt}=et.floating;let $t,Lt;Tt==="top"||Tt==="bottom"?($t=Tt,Lt=Et===(await(nt.isRTL==null?void 0:nt.isRTL(c.floating))?"start":"end")?"left":"right"):(Lt=Tt,$t=Et==="end"?"top":"bottom");const Bt=Pt-gt.top-gt.bottom,Nt=Mt-gt.left-gt.right,Vt=min(Pt-gt[$t],Bt),Xt=min(Mt-gt[Lt],Nt),nr=!i.middlewareData.shift;let ar=Vt,mr=Xt;if((s=i.middlewareData.shift)!=null&&s.enabled.x&&(mr=Nt),(a=i.middlewareData.shift)!=null&&a.enabled.y&&(ar=Bt),nr&&!Et){const sn=max(gt.left,0),fn=max(gt.right,0),Lr=max(gt.top,0),Qr=max(gt.bottom,0);At?mr=Mt-2*(sn!==0||fn!==0?sn+fn:max(gt.left,gt.right)):ar=Pt-2*(Lr!==0||Qr!==0?Lr+Qr:max(gt.top,gt.bottom))}await ct({...i,availableWidth:mr,availableHeight:ar});const Fr=await nt.getDimensions(c.floating);return Mt!==Fr.width||Pt!==Fr.height?{reset:{rects:!0}}:{}}}};function hasWindow(){return typeof window<"u"}function getNodeName(e){return isNode(e)?(e.nodeName||"").toLowerCase():"#document"}function getWindow(e){var i;return(e==null||(i=e.ownerDocument)==null?void 0:i.defaultView)||window}function getDocumentElement(e){var i;return(i=(isNode(e)?e.ownerDocument:e.document)||window.document)==null?void 0:i.documentElement}function isNode(e){return hasWindow()?e instanceof Node||e instanceof getWindow(e).Node:!1}function isElement(e){return hasWindow()?e instanceof Element||e instanceof getWindow(e).Element:!1}function isHTMLElement$1(e){return hasWindow()?e instanceof HTMLElement||e instanceof getWindow(e).HTMLElement:!1}function isShadowRoot(e){return!hasWindow()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof getWindow(e).ShadowRoot}const invalidOverflowDisplayValues=new Set(["inline","contents"]);function isOverflowElement(e){const{overflow:i,overflowX:s,overflowY:a,display:_}=getComputedStyle$2(e);return/auto|scroll|overlay|hidden|clip/.test(i+a+s)&&!invalidOverflowDisplayValues.has(_)}const tableElements=new Set(["table","td","th"]);function isTableElement(e){return tableElements.has(getNodeName(e))}const topLayerSelectors=[":popover-open",":modal"];function isTopLayer(e){return topLayerSelectors.some(i=>{try{return e.matches(i)}catch{return!1}})}const transformProperties=["transform","translate","scale","rotate","perspective"],willChangeValues=["transform","translate","scale","rotate","perspective","filter"],containValues=["paint","layout","strict","content"];function isContainingBlock(e){const i=isWebKit(),s=isElement(e)?getComputedStyle$2(e):e;return transformProperties.some(a=>s[a]?s[a]!=="none":!1)||(s.containerType?s.containerType!=="normal":!1)||!i&&(s.backdropFilter?s.backdropFilter!=="none":!1)||!i&&(s.filter?s.filter!=="none":!1)||willChangeValues.some(a=>(s.willChange||"").includes(a))||containValues.some(a=>(s.contain||"").includes(a))}function getContainingBlock(e){let i=getParentNode(e);for(;isHTMLElement$1(i)&&!isLastTraversableNode(i);){if(isContainingBlock(i))return i;if(isTopLayer(i))return null;i=getParentNode(i)}return null}function isWebKit(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const lastTraversableNodeNames=new Set(["html","body","#document"]);function isLastTraversableNode(e){return lastTraversableNodeNames.has(getNodeName(e))}function getComputedStyle$2(e){return getWindow(e).getComputedStyle(e)}function getNodeScroll(e){return isElement(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function getParentNode(e){if(getNodeName(e)==="html")return e;const i=e.assignedSlot||e.parentNode||isShadowRoot(e)&&e.host||getDocumentElement(e);return isShadowRoot(i)?i.host:i}function getNearestOverflowAncestor(e){const i=getParentNode(e);return isLastTraversableNode(i)?e.ownerDocument?e.ownerDocument.body:e.body:isHTMLElement$1(i)&&isOverflowElement(i)?i:getNearestOverflowAncestor(i)}function getOverflowAncestors(e,i,s){var a;i===void 0&&(i=[]),s===void 0&&(s=!0);const _=getNearestOverflowAncestor(e),et=_===((a=e.ownerDocument)==null?void 0:a.body),nt=getWindow(_);if(et){const c=getFrameElement(nt);return i.concat(nt,nt.visualViewport||[],isOverflowElement(_)?_:[],c&&s?getOverflowAncestors(c):[])}return i.concat(_,getOverflowAncestors(_,[],s))}function getFrameElement(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function getCssDimensions(e){const i=getComputedStyle$2(e);let s=parseFloat(i.width)||0,a=parseFloat(i.height)||0;const _=isHTMLElement$1(e),et=_?e.offsetWidth:s,nt=_?e.offsetHeight:a,c=round(s)!==et||round(a)!==nt;return c&&(s=et,a=nt),{width:s,height:a,$:c}}function unwrapElement(e){return isElement(e)?e:e.contextElement}function getScale(e){const i=unwrapElement(e);if(!isHTMLElement$1(i))return createCoords(1);const s=i.getBoundingClientRect(),{width:a,height:_,$:et}=getCssDimensions(i);let nt=(et?round(s.width):s.width)/a,c=(et?round(s.height):s.height)/_;return(!nt||!Number.isFinite(nt))&&(nt=1),(!c||!Number.isFinite(c))&&(c=1),{x:nt,y:c}}const noOffsets=createCoords(0);function getVisualOffsets(e){const i=getWindow(e);return!isWebKit()||!i.visualViewport?noOffsets:{x:i.visualViewport.offsetLeft,y:i.visualViewport.offsetTop}}function shouldAddVisualOffsets(e,i,s){return i===void 0&&(i=!1),!s||i&&s!==getWindow(e)?!1:i}function getBoundingClientRect(e,i,s,a){i===void 0&&(i=!1),s===void 0&&(s=!1);const _=e.getBoundingClientRect(),et=unwrapElement(e);let nt=createCoords(1);i&&(a?isElement(a)&&(nt=getScale(a)):nt=getScale(e));const c=shouldAddVisualOffsets(et,s,a)?getVisualOffsets(et):createCoords(0);let ct=(_.left+c.x)/nt.x,dt=(_.top+c.y)/nt.y,gt=_.width/nt.x,Tt=_.height/nt.y;if(et){const Et=getWindow(et),At=a&&isElement(a)?getWindow(a):a;let Mt=Et,Pt=getFrameElement(Mt);for(;Pt&&a&&At!==Mt;){const $t=getScale(Pt),Lt=Pt.getBoundingClientRect(),Bt=getComputedStyle$2(Pt),Nt=Lt.left+(Pt.clientLeft+parseFloat(Bt.paddingLeft))*$t.x,Vt=Lt.top+(Pt.clientTop+parseFloat(Bt.paddingTop))*$t.y;ct*=$t.x,dt*=$t.y,gt*=$t.x,Tt*=$t.y,ct+=Nt,dt+=Vt,Mt=getWindow(Pt),Pt=getFrameElement(Mt)}}return rectToClientRect({width:gt,height:Tt,x:ct,y:dt})}function getWindowScrollBarX(e,i){const s=getNodeScroll(e).scrollLeft;return i?i.left+s:getBoundingClientRect(getDocumentElement(e)).left+s}function getHTMLOffset(e,i,s){s===void 0&&(s=!1);const a=e.getBoundingClientRect(),_=a.left+i.scrollLeft-(s?0:getWindowScrollBarX(e,a)),et=a.top+i.scrollTop;return{x:_,y:et}}function convertOffsetParentRelativeRectToViewportRelativeRect(e){let{elements:i,rect:s,offsetParent:a,strategy:_}=e;const et=_==="fixed",nt=getDocumentElement(a),c=i?isTopLayer(i.floating):!1;if(a===nt||c&&et)return s;let ct={scrollLeft:0,scrollTop:0},dt=createCoords(1);const gt=createCoords(0),Tt=isHTMLElement$1(a);if((Tt||!Tt&&!et)&&((getNodeName(a)!=="body"||isOverflowElement(nt))&&(ct=getNodeScroll(a)),isHTMLElement$1(a))){const At=getBoundingClientRect(a);dt=getScale(a),gt.x=At.x+a.clientLeft,gt.y=At.y+a.clientTop}const Et=nt&&!Tt&&!et?getHTMLOffset(nt,ct,!0):createCoords(0);return{width:s.width*dt.x,height:s.height*dt.y,x:s.x*dt.x-ct.scrollLeft*dt.x+gt.x+Et.x,y:s.y*dt.y-ct.scrollTop*dt.y+gt.y+Et.y}}function getClientRects(e){return Array.from(e.getClientRects())}function getDocumentRect(e){const i=getDocumentElement(e),s=getNodeScroll(e),a=e.ownerDocument.body,_=max(i.scrollWidth,i.clientWidth,a.scrollWidth,a.clientWidth),et=max(i.scrollHeight,i.clientHeight,a.scrollHeight,a.clientHeight);let nt=-s.scrollLeft+getWindowScrollBarX(e);const c=-s.scrollTop;return getComputedStyle$2(a).direction==="rtl"&&(nt+=max(i.clientWidth,a.clientWidth)-_),{width:_,height:et,x:nt,y:c}}function getViewportRect(e,i){const s=getWindow(e),a=getDocumentElement(e),_=s.visualViewport;let et=a.clientWidth,nt=a.clientHeight,c=0,ct=0;if(_){et=_.width,nt=_.height;const dt=isWebKit();(!dt||dt&&i==="fixed")&&(c=_.offsetLeft,ct=_.offsetTop)}return{width:et,height:nt,x:c,y:ct}}const absoluteOrFixed=new Set(["absolute","fixed"]);function getInnerBoundingClientRect(e,i){const s=getBoundingClientRect(e,!0,i==="fixed"),a=s.top+e.clientTop,_=s.left+e.clientLeft,et=isHTMLElement$1(e)?getScale(e):createCoords(1),nt=e.clientWidth*et.x,c=e.clientHeight*et.y,ct=_*et.x,dt=a*et.y;return{width:nt,height:c,x:ct,y:dt}}function getClientRectFromClippingAncestor(e,i,s){let a;if(i==="viewport")a=getViewportRect(e,s);else if(i==="document")a=getDocumentRect(getDocumentElement(e));else if(isElement(i))a=getInnerBoundingClientRect(i,s);else{const _=getVisualOffsets(e);a={x:i.x-_.x,y:i.y-_.y,width:i.width,height:i.height}}return rectToClientRect(a)}function hasFixedPositionAncestor(e,i){const s=getParentNode(e);return s===i||!isElement(s)||isLastTraversableNode(s)?!1:getComputedStyle$2(s).position==="fixed"||hasFixedPositionAncestor(s,i)}function getClippingElementAncestors(e,i){const s=i.get(e);if(s)return s;let a=getOverflowAncestors(e,[],!1).filter(c=>isElement(c)&&getNodeName(c)!=="body"),_=null;const et=getComputedStyle$2(e).position==="fixed";let nt=et?getParentNode(e):e;for(;isElement(nt)&&!isLastTraversableNode(nt);){const c=getComputedStyle$2(nt),ct=isContainingBlock(nt);!ct&&c.position==="fixed"&&(_=null),(et?!ct&&!_:!ct&&c.position==="static"&&!!_&&absoluteOrFixed.has(_.position)||isOverflowElement(nt)&&!ct&&hasFixedPositionAncestor(e,nt))?a=a.filter(gt=>gt!==nt):_=c,nt=getParentNode(nt)}return i.set(e,a),a}function getClippingRect(e){let{element:i,boundary:s,rootBoundary:a,strategy:_}=e;const nt=[...s==="clippingAncestors"?isTopLayer(i)?[]:getClippingElementAncestors(i,this._c):[].concat(s),a],c=nt[0],ct=nt.reduce((dt,gt)=>{const Tt=getClientRectFromClippingAncestor(i,gt,_);return dt.top=max(Tt.top,dt.top),dt.right=min(Tt.right,dt.right),dt.bottom=min(Tt.bottom,dt.bottom),dt.left=max(Tt.left,dt.left),dt},getClientRectFromClippingAncestor(i,c,_));return{width:ct.right-ct.left,height:ct.bottom-ct.top,x:ct.left,y:ct.top}}function getDimensions(e){const{width:i,height:s}=getCssDimensions(e);return{width:i,height:s}}function getRectRelativeToOffsetParent(e,i,s){const a=isHTMLElement$1(i),_=getDocumentElement(i),et=s==="fixed",nt=getBoundingClientRect(e,!0,et,i);let c={scrollLeft:0,scrollTop:0};const ct=createCoords(0);function dt(){ct.x=getWindowScrollBarX(_)}if(a||!a&&!et)if((getNodeName(i)!=="body"||isOverflowElement(_))&&(c=getNodeScroll(i)),a){const At=getBoundingClientRect(i,!0,et,i);ct.x=At.x+i.clientLeft,ct.y=At.y+i.clientTop}else _&&dt();et&&!a&&_&&dt();const gt=_&&!a&&!et?getHTMLOffset(_,c):createCoords(0),Tt=nt.left+c.scrollLeft-ct.x-gt.x,Et=nt.top+c.scrollTop-ct.y-gt.y;return{x:Tt,y:Et,width:nt.width,height:nt.height}}function isStaticPositioned(e){return getComputedStyle$2(e).position==="static"}function getTrueOffsetParent(e,i){if(!isHTMLElement$1(e)||getComputedStyle$2(e).position==="fixed")return null;if(i)return i(e);let s=e.offsetParent;return getDocumentElement(e)===s&&(s=s.ownerDocument.body),s}function getOffsetParent(e,i){const s=getWindow(e);if(isTopLayer(e))return s;if(!isHTMLElement$1(e)){let _=getParentNode(e);for(;_&&!isLastTraversableNode(_);){if(isElement(_)&&!isStaticPositioned(_))return _;_=getParentNode(_)}return s}let a=getTrueOffsetParent(e,i);for(;a&&isTableElement(a)&&isStaticPositioned(a);)a=getTrueOffsetParent(a,i);return a&&isLastTraversableNode(a)&&isStaticPositioned(a)&&!isContainingBlock(a)?s:a||getContainingBlock(e)||s}const getElementRects=async function(e){const i=this.getOffsetParent||getOffsetParent,s=this.getDimensions,a=await s(e.floating);return{reference:getRectRelativeToOffsetParent(e.reference,await i(e.floating),e.strategy),floating:{x:0,y:0,width:a.width,height:a.height}}};function isRTL(e){return getComputedStyle$2(e).direction==="rtl"}const platform={convertOffsetParentRelativeRectToViewportRelativeRect,getDocumentElement,getClippingRect,getOffsetParent,getElementRects,getClientRects,getDimensions,getScale,isElement,isRTL};function rectsAreEqual(e,i){return e.x===i.x&&e.y===i.y&&e.width===i.width&&e.height===i.height}function observeMove(e,i){let s=null,a;const _=getDocumentElement(e);function et(){var c;clearTimeout(a),(c=s)==null||c.disconnect(),s=null}function nt(c,ct){c===void 0&&(c=!1),ct===void 0&&(ct=1),et();const dt=e.getBoundingClientRect(),{left:gt,top:Tt,width:Et,height:At}=dt;if(c||i(),!Et||!At)return;const Mt=floor(Tt),Pt=floor(_.clientWidth-(gt+Et)),$t=floor(_.clientHeight-(Tt+At)),Lt=floor(gt),Nt={rootMargin:-Mt+"px "+-Pt+"px "+-$t+"px "+-Lt+"px",threshold:max(0,min(1,ct))||1};let Vt=!0;function Xt(nr){const ar=nr[0].intersectionRatio;if(ar!==ct){if(!Vt)return nt();ar?nt(!1,ar):a=setTimeout(()=>{nt(!1,1e-7)},1e3)}ar===1&&!rectsAreEqual(dt,e.getBoundingClientRect())&&nt(),Vt=!1}try{s=new IntersectionObserver(Xt,{...Nt,root:_.ownerDocument})}catch{s=new IntersectionObserver(Xt,Nt)}s.observe(e)}return nt(!0),et}function autoUpdate(e,i,s,a){a===void 0&&(a={});const{ancestorScroll:_=!0,ancestorResize:et=!0,elementResize:nt=typeof ResizeObserver=="function",layoutShift:c=typeof IntersectionObserver=="function",animationFrame:ct=!1}=a,dt=unwrapElement(e),gt=_||et?[...dt?getOverflowAncestors(dt):[],...getOverflowAncestors(i)]:[];gt.forEach(Lt=>{_&&Lt.addEventListener("scroll",s,{passive:!0}),et&&Lt.addEventListener("resize",s)});const Tt=dt&&c?observeMove(dt,s):null;let Et=-1,At=null;nt&&(At=new ResizeObserver(Lt=>{let[Bt]=Lt;Bt&&Bt.target===dt&&At&&(At.unobserve(i),cancelAnimationFrame(Et),Et=requestAnimationFrame(()=>{var Nt;(Nt=At)==null||Nt.observe(i)})),s()}),dt&&!ct&&At.observe(dt),At.observe(i));let Mt,Pt=ct?getBoundingClientRect(e):null;ct&&$t();function $t(){const Lt=getBoundingClientRect(e);Pt&&!rectsAreEqual(Pt,Lt)&&s(),Pt=Lt,Mt=requestAnimationFrame($t)}return s(),()=>{var Lt;gt.forEach(Bt=>{_&&Bt.removeEventListener("scroll",s),et&&Bt.removeEventListener("resize",s)}),Tt==null||Tt(),(Lt=At)==null||Lt.disconnect(),At=null,ct&&cancelAnimationFrame(Mt)}}const offset$1=offset$2,shift$1=shift$2,flip$1=flip$2,size$1=size$2,hide$1=hide$2,arrow$2=arrow$3,limitShift$1=limitShift$2,computePosition=(e,i,s)=>{const a=new Map,_={platform,...s},et={..._.platform,_c:a};return computePosition$1(e,i,{..._,platform:et})};var isClient=typeof document<"u",noop$3=function(){},index=isClient?reactExports.useLayoutEffect:noop$3;function deepEqual$1(e,i){if(e===i)return!0;if(typeof e!=typeof i)return!1;if(typeof e=="function"&&e.toString()===i.toString())return!0;let s,a,_;if(e&&i&&typeof e=="object"){if(Array.isArray(e)){if(s=e.length,s!==i.length)return!1;for(a=s;a--!==0;)if(!deepEqual$1(e[a],i[a]))return!1;return!0}if(_=Object.keys(e),s=_.length,s!==Object.keys(i).length)return!1;for(a=s;a--!==0;)if(!{}.hasOwnProperty.call(i,_[a]))return!1;for(a=s;a--!==0;){const et=_[a];if(!(et==="_owner"&&e.$$typeof)&&!deepEqual$1(e[et],i[et]))return!1}return!0}return e!==e&&i!==i}function getDPR(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function roundByDPR(e,i){const s=getDPR(e);return Math.round(i*s)/s}function useLatestRef(e){const i=reactExports.useRef(e);return index(()=>{i.current=e}),i}function useFloating(e){e===void 0&&(e={});const{placement:i="bottom",strategy:s="absolute",middleware:a=[],platform:_,elements:{reference:et,floating:nt}={},transform:c=!0,whileElementsMounted:ct,open:dt}=e,[gt,Tt]=reactExports.useState({x:0,y:0,strategy:s,placement:i,middlewareData:{},isPositioned:!1}),[Et,At]=reactExports.useState(a);deepEqual$1(Et,a)||At(a);const[Mt,Pt]=reactExports.useState(null),[$t,Lt]=reactExports.useState(null),Bt=reactExports.useCallback(rr=>{rr!==nr.current&&(nr.current=rr,Pt(rr))},[]),Nt=reactExports.useCallback(rr=>{rr!==ar.current&&(ar.current=rr,Lt(rr))},[]),Vt=et||Mt,Xt=nt||$t,nr=reactExports.useRef(null),ar=reactExports.useRef(null),mr=reactExports.useRef(gt),Fr=ct!=null,sn=useLatestRef(ct),fn=useLatestRef(_),Lr=useLatestRef(dt),Qr=reactExports.useCallback(()=>{if(!nr.current||!ar.current)return;const rr={placement:i,strategy:s,middleware:Et};fn.current&&(rr.platform=fn.current),computePosition(nr.current,ar.current,rr).then(ur=>{const Br={...ur,isPositioned:Lr.current!==!1};dn.current&&!deepEqual$1(mr.current,Br)&&(mr.current=Br,reactDomExports.flushSync(()=>{Tt(Br)}))})},[Et,i,s,fn,Lr]);index(()=>{dt===!1&&mr.current.isPositioned&&(mr.current.isPositioned=!1,Tt(rr=>({...rr,isPositioned:!1})))},[dt]);const dn=reactExports.useRef(!1);index(()=>(dn.current=!0,()=>{dn.current=!1}),[]),index(()=>{if(Vt&&(nr.current=Vt),Xt&&(ar.current=Xt),Vt&&Xt){if(sn.current)return sn.current(Vt,Xt,Qr);Qr()}},[Vt,Xt,Qr,sn,Fr]);const en=reactExports.useMemo(()=>({reference:nr,floating:ar,setReference:Bt,setFloating:Nt}),[Bt,Nt]),yr=reactExports.useMemo(()=>({reference:Vt,floating:Xt}),[Vt,Xt]),Ar=reactExports.useMemo(()=>{const rr={position:s,left:0,top:0};if(!yr.floating)return rr;const ur=roundByDPR(yr.floating,gt.x),Br=roundByDPR(yr.floating,gt.y);return c?{...rr,transform:"translate("+ur+"px, "+Br+"px)",...getDPR(yr.floating)>=1.5&&{willChange:"transform"}}:{position:s,left:ur,top:Br}},[s,c,yr.floating,gt.x,gt.y]);return reactExports.useMemo(()=>({...gt,update:Qr,refs:en,elements:yr,floatingStyles:Ar}),[gt,Qr,en,yr,Ar])}const arrow$1=e=>{function i(s){return{}.hasOwnProperty.call(s,"current")}return{name:"arrow",options:e,fn(s){const{element:a,padding:_}=typeof e=="function"?e(s):e;return a&&i(a)?a.current!=null?arrow$2({element:a.current,padding:_}).fn(s):{}:a?arrow$2({element:a,padding:_}).fn(s):{}}}},offset=(e,i)=>({...offset$1(e),options:[e,i]}),shift=(e,i)=>({...shift$1(e),options:[e,i]}),limitShift=(e,i)=>({...limitShift$1(e),options:[e,i]}),flip=(e,i)=>({...flip$1(e),options:[e,i]}),size=(e,i)=>({...size$1(e),options:[e,i]}),hide=(e,i)=>({...hide$1(e),options:[e,i]}),arrow=(e,i)=>({...arrow$1(e),options:[e,i]});var NAME$1="Arrow",Arrow$1=reactExports.forwardRef((e,i)=>{const{children:s,width:a=10,height:_=5,...et}=e;return jsxRuntimeExports.jsx(Primitive.svg,{...et,ref:i,width:a,height:_,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?s:jsxRuntimeExports.jsx("polygon",{points:"0,0 30,0 15,10"})})});Arrow$1.displayName=NAME$1;var Root$4=Arrow$1;function useSize(e){const[i,s]=reactExports.useState(void 0);return useLayoutEffect2(()=>{if(e){s({width:e.offsetWidth,height:e.offsetHeight});const a=new ResizeObserver(_=>{if(!Array.isArray(_)||!_.length)return;const et=_[0];let nt,c;if("borderBoxSize"in et){const ct=et.borderBoxSize,dt=Array.isArray(ct)?ct[0]:ct;nt=dt.inlineSize,c=dt.blockSize}else nt=e.offsetWidth,c=e.offsetHeight;s({width:nt,height:c})});return a.observe(e,{box:"border-box"}),()=>a.unobserve(e)}else s(void 0)},[e]),i}var POPPER_NAME="Popper",[createPopperContext,createPopperScope]=createContextScope(POPPER_NAME),[PopperProvider,usePopperContext]=createPopperContext(POPPER_NAME),Popper=e=>{const{__scopePopper:i,children:s}=e,[a,_]=reactExports.useState(null);return jsxRuntimeExports.jsx(PopperProvider,{scope:i,anchor:a,onAnchorChange:_,children:s})};Popper.displayName=POPPER_NAME;var ANCHOR_NAME="PopperAnchor",PopperAnchor=reactExports.forwardRef((e,i)=>{const{__scopePopper:s,virtualRef:a,..._}=e,et=usePopperContext(ANCHOR_NAME,s),nt=reactExports.useRef(null),c=useComposedRefs$1(i,nt);return reactExports.useEffect(()=>{et.onAnchorChange((a==null?void 0:a.current)||nt.current)}),a?null:jsxRuntimeExports.jsx(Primitive.div,{..._,ref:c})});PopperAnchor.displayName=ANCHOR_NAME;var CONTENT_NAME$6="PopperContent",[PopperContentProvider,useContentContext]=createPopperContext(CONTENT_NAME$6),PopperContent=reactExports.forwardRef((e,i)=>{var ss,Mn,ds,gs,ys,Hs;const{__scopePopper:s,side:a="bottom",sideOffset:_=0,align:et="center",alignOffset:nt=0,arrowPadding:c=0,avoidCollisions:ct=!0,collisionBoundary:dt=[],collisionPadding:gt=0,sticky:Tt="partial",hideWhenDetached:Et=!1,updatePositionStrategy:At="optimized",onPlaced:Mt,...Pt}=e,$t=usePopperContext(CONTENT_NAME$6,s),[Lt,Bt]=reactExports.useState(null),Nt=useComposedRefs$1(i,_s=>Bt(_s)),[Vt,Xt]=reactExports.useState(null),nr=useSize(Vt),ar=(nr==null?void 0:nr.width)??0,mr=(nr==null?void 0:nr.height)??0,Fr=a+(et!=="center"?"-"+et:""),sn=typeof gt=="number"?gt:{top:0,right:0,bottom:0,left:0,...gt},fn=Array.isArray(dt)?dt:[dt],Lr=fn.length>0,Qr={padding:sn,boundary:fn.filter(isNotNull$2),altBoundary:Lr},{refs:dn,floatingStyles:en,placement:yr,isPositioned:Ar,middlewareData:rr}=useFloating({strategy:"fixed",placement:Fr,whileElementsMounted:(..._s)=>autoUpdate(..._s,{animationFrame:At==="always"}),elements:{reference:$t.anchor},middleware:[offset({mainAxis:_+mr,alignmentAxis:nt}),ct&&shift({mainAxis:!0,crossAxis:!1,limiter:Tt==="partial"?limitShift():void 0,...Qr}),ct&&flip({...Qr}),size({...Qr,apply:({elements:_s,rects:Ss,availableWidth:Vl,availableHeight:ba})=>{const{width:Qo,height:wo}=Ss.reference,cu=_s.floating.style;cu.setProperty("--radix-popper-available-width",`${Vl}px`),cu.setProperty("--radix-popper-available-height",`${ba}px`),cu.setProperty("--radix-popper-anchor-width",`${Qo}px`),cu.setProperty("--radix-popper-anchor-height",`${wo}px`)}}),Vt&&arrow({element:Vt,padding:c}),transformOrigin({arrowWidth:ar,arrowHeight:mr}),Et&&hide({strategy:"referenceHidden",...Qr})]}),[ur,Br]=getSideAndAlignFromPlacement(yr),xr=useCallbackRef$1(Mt);useLayoutEffect2(()=>{Ar&&(xr==null||xr())},[Ar,xr]);const qr=(ss=rr.arrow)==null?void 0:ss.x,tn=(Mn=rr.arrow)==null?void 0:Mn.y,vn=((ds=rr.arrow)==null?void 0:ds.centerOffset)!==0,[hs,Ts]=reactExports.useState();return useLayoutEffect2(()=>{Lt&&Ts(window.getComputedStyle(Lt).zIndex)},[Lt]),jsxRuntimeExports.jsx("div",{ref:dn.setFloating,"data-radix-popper-content-wrapper":"",style:{...en,transform:Ar?en.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:hs,"--radix-popper-transform-origin":[(gs=rr.transformOrigin)==null?void 0:gs.x,(ys=rr.transformOrigin)==null?void 0:ys.y].join(" "),...((Hs=rr.hide)==null?void 0:Hs.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:jsxRuntimeExports.jsx(PopperContentProvider,{scope:s,placedSide:ur,onArrowChange:Xt,arrowX:qr,arrowY:tn,shouldHideArrow:vn,children:jsxRuntimeExports.jsx(Primitive.div,{"data-side":ur,"data-align":Br,...Pt,ref:Nt,style:{...Pt.style,animation:Ar?void 0:"none"}})})})});PopperContent.displayName=CONTENT_NAME$6;var ARROW_NAME$2="PopperArrow",OPPOSITE_SIDE={top:"bottom",right:"left",bottom:"top",left:"right"},PopperArrow=reactExports.forwardRef(function(i,s){const{__scopePopper:a,..._}=i,et=useContentContext(ARROW_NAME$2,a),nt=OPPOSITE_SIDE[et.placedSide];return jsxRuntimeExports.jsx("span",{ref:et.onArrowChange,style:{position:"absolute",left:et.arrowX,top:et.arrowY,[nt]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[et.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[et.placedSide],visibility:et.shouldHideArrow?"hidden":void 0},children:jsxRuntimeExports.jsx(Root$4,{..._,ref:s,style:{..._.style,display:"block"}})})});PopperArrow.displayName=ARROW_NAME$2;function isNotNull$2(e){return e!==null}var transformOrigin=e=>({name:"transformOrigin",options:e,fn(i){var $t,Lt,Bt;const{placement:s,rects:a,middlewareData:_}=i,nt=(($t=_.arrow)==null?void 0:$t.centerOffset)!==0,c=nt?0:e.arrowWidth,ct=nt?0:e.arrowHeight,[dt,gt]=getSideAndAlignFromPlacement(s),Tt={start:"0%",center:"50%",end:"100%"}[gt],Et=(((Lt=_.arrow)==null?void 0:Lt.x)??0)+c/2,At=(((Bt=_.arrow)==null?void 0:Bt.y)??0)+ct/2;let Mt="",Pt="";return dt==="bottom"?(Mt=nt?Tt:`${Et}px`,Pt=`${-ct}px`):dt==="top"?(Mt=nt?Tt:`${Et}px`,Pt=`${a.floating.height+ct}px`):dt==="right"?(Mt=`${-ct}px`,Pt=nt?Tt:`${At}px`):dt==="left"&&(Mt=`${a.floating.width+ct}px`,Pt=nt?Tt:`${At}px`),{data:{x:Mt,y:Pt}}}});function getSideAndAlignFromPlacement(e){const[i,s="center"]=e.split("-");return[i,s]}var Root2$3=Popper,Anchor=PopperAnchor,Content$2=PopperContent,Arrow=PopperArrow,[createTooltipContext,createTooltipScope]=createContextScope("Tooltip",[createPopperScope]),usePopperScope$1=createPopperScope(),PROVIDER_NAME="TooltipProvider",DEFAULT_DELAY_DURATION=700,TOOLTIP_OPEN="tooltip.open",[TooltipProviderContextProvider,useTooltipProviderContext]=createTooltipContext(PROVIDER_NAME),TooltipProvider$1=e=>{const{__scopeTooltip:i,delayDuration:s=DEFAULT_DELAY_DURATION,skipDelayDuration:a=300,disableHoverableContent:_=!1,children:et}=e,nt=reactExports.useRef(!0),c=reactExports.useRef(!1),ct=reactExports.useRef(0);return reactExports.useEffect(()=>{const dt=ct.current;return()=>window.clearTimeout(dt)},[]),jsxRuntimeExports.jsx(TooltipProviderContextProvider,{scope:i,isOpenDelayedRef:nt,delayDuration:s,onOpen:reactExports.useCallback(()=>{window.clearTimeout(ct.current),nt.current=!1},[]),onClose:reactExports.useCallback(()=>{window.clearTimeout(ct.current),ct.current=window.setTimeout(()=>nt.current=!0,a)},[a]),isPointerInTransitRef:c,onPointerInTransitChange:reactExports.useCallback(dt=>{c.current=dt},[]),disableHoverableContent:_,children:et})};TooltipProvider$1.displayName=PROVIDER_NAME;var TOOLTIP_NAME="Tooltip",[TooltipContextProvider,useTooltipContext]=createTooltipContext(TOOLTIP_NAME),TRIGGER_NAME$5="TooltipTrigger",TooltipTrigger=reactExports.forwardRef((e,i)=>{const{__scopeTooltip:s,...a}=e,_=useTooltipContext(TRIGGER_NAME$5,s),et=useTooltipProviderContext(TRIGGER_NAME$5,s),nt=usePopperScope$1(s),c=reactExports.useRef(null),ct=useComposedRefs$1(i,c,_.onTriggerChange),dt=reactExports.useRef(!1),gt=reactExports.useRef(!1),Tt=reactExports.useCallback(()=>dt.current=!1,[]);return reactExports.useEffect(()=>()=>document.removeEventListener("pointerup",Tt),[Tt]),jsxRuntimeExports.jsx(Anchor,{asChild:!0,...nt,children:jsxRuntimeExports.jsx(Primitive.button,{"aria-describedby":_.open?_.contentId:void 0,"data-state":_.stateAttribute,...a,ref:ct,onPointerMove:composeEventHandlers(e.onPointerMove,Et=>{Et.pointerType!=="touch"&&!gt.current&&!et.isPointerInTransitRef.current&&(_.onTriggerEnter(),gt.current=!0)}),onPointerLeave:composeEventHandlers(e.onPointerLeave,()=>{_.onTriggerLeave(),gt.current=!1}),onPointerDown:composeEventHandlers(e.onPointerDown,()=>{_.open&&_.onClose(),dt.current=!0,document.addEventListener("pointerup",Tt,{once:!0})}),onFocus:composeEventHandlers(e.onFocus,()=>{dt.current||_.onOpen()}),onBlur:composeEventHandlers(e.onBlur,_.onClose),onClick:composeEventHandlers(e.onClick,_.onClose)})})});TooltipTrigger.displayName=TRIGGER_NAME$5;var PORTAL_NAME$3="TooltipPortal",[PortalProvider$1,usePortalContext$1]=createTooltipContext(PORTAL_NAME$3,{forceMount:void 0}),CONTENT_NAME$5="TooltipContent",TooltipContent$1=reactExports.forwardRef((e,i)=>{const s=usePortalContext$1(CONTENT_NAME$5,e.__scopeTooltip),{forceMount:a=s.forceMount,side:_="top",...et}=e,nt=useTooltipContext(CONTENT_NAME$5,e.__scopeTooltip);return jsxRuntimeExports.jsx(Presence,{present:a||nt.open,children:nt.disableHoverableContent?jsxRuntimeExports.jsx(TooltipContentImpl,{side:_,...et,ref:i}):jsxRuntimeExports.jsx(TooltipContentHoverable,{side:_,...et,ref:i})})}),TooltipContentHoverable=reactExports.forwardRef((e,i)=>{const s=useTooltipContext(CONTENT_NAME$5,e.__scopeTooltip),a=useTooltipProviderContext(CONTENT_NAME$5,e.__scopeTooltip),_=reactExports.useRef(null),et=useComposedRefs$1(i,_),[nt,c]=reactExports.useState(null),{trigger:ct,onClose:dt}=s,gt=_.current,{onPointerInTransitChange:Tt}=a,Et=reactExports.useCallback(()=>{c(null),Tt(!1)},[Tt]),At=reactExports.useCallback((Mt,Pt)=>{const $t=Mt.currentTarget,Lt={x:Mt.clientX,y:Mt.clientY},Bt=getExitSideFromRect(Lt,$t.getBoundingClientRect()),Nt=getPaddedExitPoints(Lt,Bt),Vt=getPointsFromRect(Pt.getBoundingClientRect()),Xt=getHull([...Nt,...Vt]);c(Xt),Tt(!0)},[Tt]);return reactExports.useEffect(()=>()=>Et(),[Et]),reactExports.useEffect(()=>{if(ct&&gt){const Mt=$t=>At($t,gt),Pt=$t=>At($t,ct);return ct.addEventListener("pointerleave",Mt),gt.addEventListener("pointerleave",Pt),()=>{ct.removeEventListener("pointerleave",Mt),gt.removeEventListener("pointerleave",Pt)}}},[ct,gt,At,Et]),reactExports.useEffect(()=>{if(nt){const Mt=Pt=>{const $t=Pt.target,Lt={x:Pt.clientX,y:Pt.clientY},Bt=(ct==null?void 0:ct.contains($t))||(gt==null?void 0:gt.contains($t)),Nt=!isPointInPolygon$1(Lt,nt);Bt?Et():Nt&&(Et(),dt())};return document.addEventListener("pointermove",Mt),()=>document.removeEventListener("pointermove",Mt)}},[ct,gt,nt,dt,Et]),jsxRuntimeExports.jsx(TooltipContentImpl,{...e,ref:et})}),[VisuallyHiddenContentContextProvider,useVisuallyHiddenContentContext]=createTooltipContext(TOOLTIP_NAME,{isInside:!1}),Slottable$1=createSlottable("TooltipContent"),TooltipContentImpl=reactExports.forwardRef((e,i)=>{const{__scopeTooltip:s,children:a,"aria-label":_,onEscapeKeyDown:et,onPointerDownOutside:nt,...c}=e,ct=useTooltipContext(CONTENT_NAME$5,s),dt=usePopperScope$1(s),{onClose:gt}=ct;return reactExports.useEffect(()=>(document.addEventListener(TOOLTIP_OPEN,gt),()=>document.removeEventListener(TOOLTIP_OPEN,gt)),[gt]),reactExports.useEffect(()=>{if(ct.trigger){const Tt=Et=>{const At=Et.target;At!=null&&At.contains(ct.trigger)&&gt()};return window.addEventListener("scroll",Tt,{capture:!0}),()=>window.removeEventListener("scroll",Tt,{capture:!0})}},[ct.trigger,gt]),jsxRuntimeExports.jsx(DismissableLayer,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:et,onPointerDownOutside:nt,onFocusOutside:Tt=>Tt.preventDefault(),onDismiss:gt,children:jsxRuntimeExports.jsxs(Content$2,{"data-state":ct.stateAttribute,...dt,...c,ref:i,style:{...c.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[jsxRuntimeExports.jsx(Slottable$1,{children:a}),jsxRuntimeExports.jsx(VisuallyHiddenContentContextProvider,{scope:s,isInside:!0,children:jsxRuntimeExports.jsx(Root$5,{id:ct.contentId,role:"tooltip",children:_||a})})]})})});TooltipContent$1.displayName=CONTENT_NAME$5;var ARROW_NAME$1="TooltipArrow",TooltipArrow=reactExports.forwardRef((e,i)=>{const{__scopeTooltip:s,...a}=e,_=usePopperScope$1(s);return useVisuallyHiddenContentContext(ARROW_NAME$1,s).isInside?null:jsxRuntimeExports.jsx(Arrow,{..._,...a,ref:i})});TooltipArrow.displayName=ARROW_NAME$1;function getExitSideFromRect(e,i){const s=Math.abs(i.top-e.y),a=Math.abs(i.bottom-e.y),_=Math.abs(i.right-e.x),et=Math.abs(i.left-e.x);switch(Math.min(s,a,_,et)){case et:return"left";case _:return"right";case s:return"top";case a:return"bottom";default:throw new Error("unreachable")}}function getPaddedExitPoints(e,i,s=5){const a=[];switch(i){case"top":a.push({x:e.x-s,y:e.y+s},{x:e.x+s,y:e.y+s});break;case"bottom":a.push({x:e.x-s,y:e.y-s},{x:e.x+s,y:e.y-s});break;case"left":a.push({x:e.x+s,y:e.y-s},{x:e.x+s,y:e.y+s});break;case"right":a.push({x:e.x-s,y:e.y-s},{x:e.x-s,y:e.y+s});break}return a}function getPointsFromRect(e){const{top:i,right:s,bottom:a,left:_}=e;return[{x:_,y:i},{x:s,y:i},{x:s,y:a},{x:_,y:a}]}function isPointInPolygon$1(e,i){const{x:s,y:a}=e;let _=!1;for(let et=0,nt=i.length-1;et<i.length;nt=et++){const c=i[et],ct=i[nt],dt=c.x,gt=c.y,Tt=ct.x,Et=ct.y;gt>a!=Et>a&&s<(Tt-dt)*(a-gt)/(Et-gt)+dt&&(_=!_)}return _}function getHull(e){const i=e.slice();return i.sort((s,a)=>s.x<a.x?-1:s.x>a.x?1:s.y<a.y?-1:s.y>a.y?1:0),getHullPresorted(i)}function getHullPresorted(e){if(e.length<=1)return e.slice();const i=[];for(let a=0;a<e.length;a++){const _=e[a];for(;i.length>=2;){const et=i[i.length-1],nt=i[i.length-2];if((et.x-nt.x)*(_.y-nt.y)>=(et.y-nt.y)*(_.x-nt.x))i.pop();else break}i.push(_)}i.pop();const s=[];for(let a=e.length-1;a>=0;a--){const _=e[a];for(;s.length>=2;){const et=s[s.length-1],nt=s[s.length-2];if((et.x-nt.x)*(_.y-nt.y)>=(et.y-nt.y)*(_.x-nt.x))s.pop();else break}s.push(_)}return s.pop(),i.length===1&&s.length===1&&i[0].x===s[0].x&&i[0].y===s[0].y?i:i.concat(s)}var Provider$1=TooltipProvider$1,Content2$3=TooltipContent$1;const TooltipProvider=Provider$1,TooltipContent=reactExports.forwardRef(({className:e,sideOffset:i=4,...s},a)=>jsxRuntimeExports.jsx(Content2$3,{ref:a,sideOffset:i,className:cn("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s}));TooltipContent.displayName=Content2$3.displayName;var Subscribable=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},isServer=typeof window>"u"||"Deno"in globalThis;function noop$2(){}function functionalUpdate(e,i){return typeof e=="function"?e(i):e}function isValidTimeout(e){return typeof e=="number"&&e>=0&&e!==1/0}function timeUntilStale(e,i){return Math.max(e+(i||0)-Date.now(),0)}function resolveStaleTime(e,i){return typeof e=="function"?e(i):e}function resolveEnabled(e,i){return typeof e=="function"?e(i):e}function matchQuery(e,i){const{type:s="all",exact:a,fetchStatus:_,predicate:et,queryKey:nt,stale:c}=e;if(nt){if(a){if(i.queryHash!==hashQueryKeyByOptions(nt,i.options))return!1}else if(!partialMatchKey(i.queryKey,nt))return!1}if(s!=="all"){const ct=i.isActive();if(s==="active"&&!ct||s==="inactive"&&ct)return!1}return!(typeof c=="boolean"&&i.isStale()!==c||_&&_!==i.state.fetchStatus||et&&!et(i))}function matchMutation(e,i){const{exact:s,status:a,predicate:_,mutationKey:et}=e;if(et){if(!i.options.mutationKey)return!1;if(s){if(hashKey(i.options.mutationKey)!==hashKey(et))return!1}else if(!partialMatchKey(i.options.mutationKey,et))return!1}return!(a&&i.state.status!==a||_&&!_(i))}function hashQueryKeyByOptions(e,i){return((i==null?void 0:i.queryKeyHashFn)||hashKey)(e)}function hashKey(e){return JSON.stringify(e,(i,s)=>isPlainObject(s)?Object.keys(s).sort().reduce((a,_)=>(a[_]=s[_],a),{}):s)}function partialMatchKey(e,i){return e===i?!0:typeof e!=typeof i?!1:e&&i&&typeof e=="object"&&typeof i=="object"?Object.keys(i).every(s=>partialMatchKey(e[s],i[s])):!1}function replaceEqualDeep(e,i){if(e===i)return e;const s=isPlainArray(e)&&isPlainArray(i);if(s||isPlainObject(e)&&isPlainObject(i)){const a=s?e:Object.keys(e),_=a.length,et=s?i:Object.keys(i),nt=et.length,c=s?[]:{},ct=new Set(a);let dt=0;for(let gt=0;gt<nt;gt++){const Tt=s?gt:et[gt];(!s&&ct.has(Tt)||s)&&e[Tt]===void 0&&i[Tt]===void 0?(c[Tt]=void 0,dt++):(c[Tt]=replaceEqualDeep(e[Tt],i[Tt]),c[Tt]===e[Tt]&&e[Tt]!==void 0&&dt++)}return _===nt&&dt===_?e:c}return i}function isPlainArray(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function isPlainObject(e){if(!hasObjectPrototype(e))return!1;const i=e.constructor;if(i===void 0)return!0;const s=i.prototype;return!(!hasObjectPrototype(s)||!s.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function hasObjectPrototype(e){return Object.prototype.toString.call(e)==="[object Object]"}function sleep(e){return new Promise(i=>{setTimeout(i,e)})}function replaceData(e,i,s){return typeof s.structuralSharing=="function"?s.structuralSharing(e,i):s.structuralSharing!==!1?replaceEqualDeep(e,i):i}function addToEnd(e,i,s=0){const a=[...e,i];return s&&a.length>s?a.slice(1):a}function addToStart(e,i,s=0){const a=[i,...e];return s&&a.length>s?a.slice(0,-1):a}var skipToken=Symbol();function ensureQueryFn(e,i){return!e.queryFn&&(i!=null&&i.initialPromise)?()=>i.initialPromise:!e.queryFn||e.queryFn===skipToken?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}var tx,ty,K_,KR,FocusManager=(KR=class extends Subscribable{constructor(){super();zl(this,tx);zl(this,ty);zl(this,K_);$o(this,K_,i=>{if(!isServer&&window.addEventListener){const s=()=>i();return window.addEventListener("visibilitychange",s,!1),()=>{window.removeEventListener("visibilitychange",s)}}})}onSubscribe(){es(this,ty)||this.setEventListener(es(this,K_))}onUnsubscribe(){var i;this.hasListeners()||((i=es(this,ty))==null||i.call(this),$o(this,ty,void 0))}setEventListener(i){var s;$o(this,K_,i),(s=es(this,ty))==null||s.call(this),$o(this,ty,i(a=>{typeof a=="boolean"?this.setFocused(a):this.onFocus()}))}setFocused(i){es(this,tx)!==i&&($o(this,tx,i),this.onFocus())}onFocus(){const i=this.isFocused();this.listeners.forEach(s=>{s(i)})}isFocused(){var i;return typeof es(this,tx)=="boolean"?es(this,tx):((i=globalThis.document)==null?void 0:i.visibilityState)!=="hidden"}},tx=new WeakMap,ty=new WeakMap,K_=new WeakMap,KR),focusManager=new FocusManager,X_,ry,Z_,XR,OnlineManager=(XR=class extends Subscribable{constructor(){super();zl(this,X_,!0);zl(this,ry);zl(this,Z_);$o(this,Z_,i=>{if(!isServer&&window.addEventListener){const s=()=>i(!0),a=()=>i(!1);return window.addEventListener("online",s,!1),window.addEventListener("offline",a,!1),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",a)}}})}onSubscribe(){es(this,ry)||this.setEventListener(es(this,Z_))}onUnsubscribe(){var i;this.hasListeners()||((i=es(this,ry))==null||i.call(this),$o(this,ry,void 0))}setEventListener(i){var s;$o(this,Z_,i),(s=es(this,ry))==null||s.call(this),$o(this,ry,i(this.setOnline.bind(this)))}setOnline(i){es(this,X_)!==i&&($o(this,X_,i),this.listeners.forEach(a=>{a(i)}))}isOnline(){return es(this,X_)}},X_=new WeakMap,ry=new WeakMap,Z_=new WeakMap,XR),onlineManager=new OnlineManager;function pendingThenable(){let e,i;const s=new Promise((_,et)=>{e=_,i=et});s.status="pending",s.catch(()=>{});function a(_){Object.assign(s,_),delete s.resolve,delete s.reject}return s.resolve=_=>{a({status:"fulfilled",value:_}),e(_)},s.reject=_=>{a({status:"rejected",reason:_}),i(_)},s}function defaultRetryDelay(e){return Math.min(1e3*2**e,3e4)}function canFetch(e){return(e??"online")==="online"?onlineManager.isOnline():!0}var CancelledError=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function isCancelledError(e){return e instanceof CancelledError}function createRetryer(e){let i=!1,s=0,a=!1,_;const et=pendingThenable(),nt=Pt=>{var $t;a||(Et(new CancelledError(Pt)),($t=e.abort)==null||$t.call(e))},c=()=>{i=!0},ct=()=>{i=!1},dt=()=>focusManager.isFocused()&&(e.networkMode==="always"||onlineManager.isOnline())&&e.canRun(),gt=()=>canFetch(e.networkMode)&&e.canRun(),Tt=Pt=>{var $t;a||(a=!0,($t=e.onSuccess)==null||$t.call(e,Pt),_==null||_(),et.resolve(Pt))},Et=Pt=>{var $t;a||(a=!0,($t=e.onError)==null||$t.call(e,Pt),_==null||_(),et.reject(Pt))},At=()=>new Promise(Pt=>{var $t;_=Lt=>{(a||dt())&&Pt(Lt)},($t=e.onPause)==null||$t.call(e)}).then(()=>{var Pt;_=void 0,a||(Pt=e.onContinue)==null||Pt.call(e)}),Mt=()=>{if(a)return;let Pt;const $t=s===0?e.initialPromise:void 0;try{Pt=$t??e.fn()}catch(Lt){Pt=Promise.reject(Lt)}Promise.resolve(Pt).then(Tt).catch(Lt=>{var nr;if(a)return;const Bt=e.retry??(isServer?0:3),Nt=e.retryDelay??defaultRetryDelay,Vt=typeof Nt=="function"?Nt(s,Lt):Nt,Xt=Bt===!0||typeof Bt=="number"&&s<Bt||typeof Bt=="function"&&Bt(s,Lt);if(i||!Xt){Et(Lt);return}s++,(nr=e.onFail)==null||nr.call(e,s,Lt),sleep(Vt).then(()=>dt()?void 0:At()).then(()=>{i?Et(Lt):Mt()})})};return{promise:et,cancel:nt,continue:()=>(_==null||_(),et),cancelRetry:c,continueRetry:ct,canStart:gt,start:()=>(gt()?Mt():At().then(Mt),et)}}var defaultScheduler=e=>setTimeout(e,0);function createNotifyManager(){let e=[],i=0,s=c=>{c()},a=c=>{c()},_=defaultScheduler;const et=c=>{i?e.push(c):_(()=>{s(c)})},nt=()=>{const c=e;e=[],c.length&&_(()=>{a(()=>{c.forEach(ct=>{s(ct)})})})};return{batch:c=>{let ct;i++;try{ct=c()}finally{i--,i||nt()}return ct},batchCalls:c=>(...ct)=>{et(()=>{c(...ct)})},schedule:et,setNotifyFunction:c=>{s=c},setBatchNotifyFunction:c=>{a=c},setScheduler:c=>{_=c}}}var notifyManager=createNotifyManager(),rx,ZR,Removable=(ZR=class{constructor(){zl(this,rx)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),isValidTimeout(this.gcTime)&&$o(this,rx,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(isServer?1/0:5*60*1e3))}clearGcTimeout(){es(this,rx)&&(clearTimeout(es(this,rx)),$o(this,rx,void 0))}},rx=new WeakMap,ZR),Y_,nx,Xp,ix,Ju,Y1,sx,vm,x0,YR,Query=(YR=class extends Removable{constructor(i){super();zl(this,vm);zl(this,Y_);zl(this,nx);zl(this,Xp);zl(this,ix);zl(this,Ju);zl(this,Y1);zl(this,sx);$o(this,sx,!1),$o(this,Y1,i.defaultOptions),this.setOptions(i.options),this.observers=[],$o(this,ix,i.client),$o(this,Xp,es(this,ix).getQueryCache()),this.queryKey=i.queryKey,this.queryHash=i.queryHash,$o(this,Y_,getDefaultState$1(this.options)),this.state=i.state??es(this,Y_),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var i;return(i=es(this,Ju))==null?void 0:i.promise}setOptions(i){this.options={...es(this,Y1),...i},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&es(this,Xp).remove(this)}setData(i,s){const a=replaceData(this.state.data,i,this.options);return Qu(this,vm,x0).call(this,{data:a,type:"success",dataUpdatedAt:s==null?void 0:s.updatedAt,manual:s==null?void 0:s.manual}),a}setState(i,s){Qu(this,vm,x0).call(this,{type:"setState",state:i,setStateOptions:s})}cancel(i){var a,_;const s=(a=es(this,Ju))==null?void 0:a.promise;return(_=es(this,Ju))==null||_.cancel(i),s?s.then(noop$2).catch(noop$2):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(es(this,Y_))}isActive(){return this.observers.some(i=>resolveEnabled(i.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===skipToken||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(i=>resolveStaleTime(i.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(i=>i.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(i=0){return this.state.data===void 0?!0:i==="static"?!1:this.state.isInvalidated?!0:!timeUntilStale(this.state.dataUpdatedAt,i)}onFocus(){var s;const i=this.observers.find(a=>a.shouldFetchOnWindowFocus());i==null||i.refetch({cancelRefetch:!1}),(s=es(this,Ju))==null||s.continue()}onOnline(){var s;const i=this.observers.find(a=>a.shouldFetchOnReconnect());i==null||i.refetch({cancelRefetch:!1}),(s=es(this,Ju))==null||s.continue()}addObserver(i){this.observers.includes(i)||(this.observers.push(i),this.clearGcTimeout(),es(this,Xp).notify({type:"observerAdded",query:this,observer:i}))}removeObserver(i){this.observers.includes(i)&&(this.observers=this.observers.filter(s=>s!==i),this.observers.length||(es(this,Ju)&&(es(this,sx)?es(this,Ju).cancel({revert:!0}):es(this,Ju).cancelRetry()),this.scheduleGc()),es(this,Xp).notify({type:"observerRemoved",query:this,observer:i}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Qu(this,vm,x0).call(this,{type:"invalidate"})}fetch(i,s){var dt,gt,Tt;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(s!=null&&s.cancelRefetch))this.cancel({silent:!0});else if(es(this,Ju))return es(this,Ju).continueRetry(),es(this,Ju).promise}if(i&&this.setOptions(i),!this.options.queryFn){const Et=this.observers.find(At=>At.options.queryFn);Et&&this.setOptions(Et.options)}const a=new AbortController,_=Et=>{Object.defineProperty(Et,"signal",{enumerable:!0,get:()=>($o(this,sx,!0),a.signal)})},et=()=>{const Et=ensureQueryFn(this.options,s),Mt=(()=>{const Pt={client:es(this,ix),queryKey:this.queryKey,meta:this.meta};return _(Pt),Pt})();return $o(this,sx,!1),this.options.persister?this.options.persister(Et,Mt,this):Et(Mt)},c=(()=>{const Et={fetchOptions:s,options:this.options,queryKey:this.queryKey,client:es(this,ix),state:this.state,fetchFn:et};return _(Et),Et})();(dt=this.options.behavior)==null||dt.onFetch(c,this),$o(this,nx,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((gt=c.fetchOptions)==null?void 0:gt.meta))&&Qu(this,vm,x0).call(this,{type:"fetch",meta:(Tt=c.fetchOptions)==null?void 0:Tt.meta});const ct=Et=>{var At,Mt,Pt,$t;isCancelledError(Et)&&Et.silent||Qu(this,vm,x0).call(this,{type:"error",error:Et}),isCancelledError(Et)||((Mt=(At=es(this,Xp).config).onError)==null||Mt.call(At,Et,this),($t=(Pt=es(this,Xp).config).onSettled)==null||$t.call(Pt,this.state.data,Et,this)),this.scheduleGc()};return $o(this,Ju,createRetryer({initialPromise:s==null?void 0:s.initialPromise,fn:c.fetchFn,abort:a.abort.bind(a),onSuccess:Et=>{var At,Mt,Pt,$t;if(Et===void 0){ct(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(Et)}catch(Lt){ct(Lt);return}(Mt=(At=es(this,Xp).config).onSuccess)==null||Mt.call(At,Et,this),($t=(Pt=es(this,Xp).config).onSettled)==null||$t.call(Pt,Et,this.state.error,this),this.scheduleGc()},onError:ct,onFail:(Et,At)=>{Qu(this,vm,x0).call(this,{type:"failed",failureCount:Et,error:At})},onPause:()=>{Qu(this,vm,x0).call(this,{type:"pause"})},onContinue:()=>{Qu(this,vm,x0).call(this,{type:"continue"})},retry:c.options.retry,retryDelay:c.options.retryDelay,networkMode:c.options.networkMode,canRun:()=>!0})),es(this,Ju).start()}},Y_=new WeakMap,nx=new WeakMap,Xp=new WeakMap,ix=new WeakMap,Ju=new WeakMap,Y1=new WeakMap,sx=new WeakMap,vm=new WeakSet,x0=function(i){const s=a=>{switch(i.type){case"failed":return{...a,fetchFailureCount:i.failureCount,fetchFailureReason:i.error};case"pause":return{...a,fetchStatus:"paused"};case"continue":return{...a,fetchStatus:"fetching"};case"fetch":return{...a,...fetchState(a.data,this.options),fetchMeta:i.meta??null};case"success":return $o(this,nx,void 0),{...a,data:i.data,dataUpdateCount:a.dataUpdateCount+1,dataUpdatedAt:i.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!i.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const _=i.error;return isCancelledError(_)&&_.revert&&es(this,nx)?{...es(this,nx),fetchStatus:"idle"}:{...a,error:_,errorUpdateCount:a.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:a.fetchFailureCount+1,fetchFailureReason:_,fetchStatus:"idle",status:"error"};case"invalidate":return{...a,isInvalidated:!0};case"setState":return{...a,...i.state}}};this.state=s(this.state),notifyManager.batch(()=>{this.observers.forEach(a=>{a.onQueryUpdate()}),es(this,Xp).notify({query:this,type:"updated",action:i})})},YR);function fetchState(e,i){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:canFetch(i.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function getDefaultState$1(e){const i=typeof e.initialData=="function"?e.initialData():e.initialData,s=i!==void 0,a=s?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:i,dataUpdateCount:0,dataUpdatedAt:s?a??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:s?"success":"pending",fetchStatus:"idle"}}var Gm,QR,QueryCache=(QR=class extends Subscribable{constructor(i={}){super();zl(this,Gm);this.config=i,$o(this,Gm,new Map)}build(i,s,a){const _=s.queryKey,et=s.queryHash??hashQueryKeyByOptions(_,s);let nt=this.get(et);return nt||(nt=new Query({client:i,queryKey:_,queryHash:et,options:i.defaultQueryOptions(s),state:a,defaultOptions:i.getQueryDefaults(_)}),this.add(nt)),nt}add(i){es(this,Gm).has(i.queryHash)||(es(this,Gm).set(i.queryHash,i),this.notify({type:"added",query:i}))}remove(i){const s=es(this,Gm).get(i.queryHash);s&&(i.destroy(),s===i&&es(this,Gm).delete(i.queryHash),this.notify({type:"removed",query:i}))}clear(){notifyManager.batch(()=>{this.getAll().forEach(i=>{this.remove(i)})})}get(i){return es(this,Gm).get(i)}getAll(){return[...es(this,Gm).values()]}find(i){const s={exact:!0,...i};return this.getAll().find(a=>matchQuery(s,a))}findAll(i={}){const s=this.getAll();return Object.keys(i).length>0?s.filter(a=>matchQuery(i,a)):s}notify(i){notifyManager.batch(()=>{this.listeners.forEach(s=>{s(i)})})}onFocus(){notifyManager.batch(()=>{this.getAll().forEach(i=>{i.onFocus()})})}onOnline(){notifyManager.batch(()=>{this.getAll().forEach(i=>{i.onOnline()})})}},Gm=new WeakMap,QR),Hm,cp,ox,Wm,ey,JR,Mutation=(JR=class extends Removable{constructor(i){super();zl(this,Wm);zl(this,Hm);zl(this,cp);zl(this,ox);this.mutationId=i.mutationId,$o(this,cp,i.mutationCache),$o(this,Hm,[]),this.state=i.state||getDefaultState(),this.setOptions(i.options),this.scheduleGc()}setOptions(i){this.options=i,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(i){es(this,Hm).includes(i)||(es(this,Hm).push(i),this.clearGcTimeout(),es(this,cp).notify({type:"observerAdded",mutation:this,observer:i}))}removeObserver(i){$o(this,Hm,es(this,Hm).filter(s=>s!==i)),this.scheduleGc(),es(this,cp).notify({type:"observerRemoved",mutation:this,observer:i})}optionalRemove(){es(this,Hm).length||(this.state.status==="pending"?this.scheduleGc():es(this,cp).remove(this))}continue(){var i;return((i=es(this,ox))==null?void 0:i.continue())??this.execute(this.state.variables)}async execute(i){var et,nt,c,ct,dt,gt,Tt,Et,At,Mt,Pt,$t,Lt,Bt,Nt,Vt,Xt,nr,ar,mr;const s=()=>{Qu(this,Wm,ey).call(this,{type:"continue"})};$o(this,ox,createRetryer({fn:()=>this.options.mutationFn?this.options.mutationFn(i):Promise.reject(new Error("No mutationFn found")),onFail:(Fr,sn)=>{Qu(this,Wm,ey).call(this,{type:"failed",failureCount:Fr,error:sn})},onPause:()=>{Qu(this,Wm,ey).call(this,{type:"pause"})},onContinue:s,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>es(this,cp).canRun(this)}));const a=this.state.status==="pending",_=!es(this,ox).canStart();try{if(a)s();else{Qu(this,Wm,ey).call(this,{type:"pending",variables:i,isPaused:_}),await((nt=(et=es(this,cp).config).onMutate)==null?void 0:nt.call(et,i,this));const sn=await((ct=(c=this.options).onMutate)==null?void 0:ct.call(c,i));sn!==this.state.context&&Qu(this,Wm,ey).call(this,{type:"pending",context:sn,variables:i,isPaused:_})}const Fr=await es(this,ox).start();return await((gt=(dt=es(this,cp).config).onSuccess)==null?void 0:gt.call(dt,Fr,i,this.state.context,this)),await((Et=(Tt=this.options).onSuccess)==null?void 0:Et.call(Tt,Fr,i,this.state.context)),await((Mt=(At=es(this,cp).config).onSettled)==null?void 0:Mt.call(At,Fr,null,this.state.variables,this.state.context,this)),await(($t=(Pt=this.options).onSettled)==null?void 0:$t.call(Pt,Fr,null,i,this.state.context)),Qu(this,Wm,ey).call(this,{type:"success",data:Fr}),Fr}catch(Fr){try{throw await((Bt=(Lt=es(this,cp).config).onError)==null?void 0:Bt.call(Lt,Fr,i,this.state.context,this)),await((Vt=(Nt=this.options).onError)==null?void 0:Vt.call(Nt,Fr,i,this.state.context)),await((nr=(Xt=es(this,cp).config).onSettled)==null?void 0:nr.call(Xt,void 0,Fr,this.state.variables,this.state.context,this)),await((mr=(ar=this.options).onSettled)==null?void 0:mr.call(ar,void 0,Fr,i,this.state.context)),Fr}finally{Qu(this,Wm,ey).call(this,{type:"error",error:Fr})}}finally{es(this,cp).runNext(this)}}},Hm=new WeakMap,cp=new WeakMap,ox=new WeakMap,Wm=new WeakSet,ey=function(i){const s=a=>{switch(i.type){case"failed":return{...a,failureCount:i.failureCount,failureReason:i.error};case"pause":return{...a,isPaused:!0};case"continue":return{...a,isPaused:!1};case"pending":return{...a,context:i.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:i.isPaused,status:"pending",variables:i.variables,submittedAt:Date.now()};case"success":return{...a,data:i.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...a,data:void 0,error:i.error,failureCount:a.failureCount+1,failureReason:i.error,isPaused:!1,status:"error"}}};this.state=s(this.state),notifyManager.batch(()=>{es(this,Hm).forEach(a=>{a.onMutationUpdate(i)}),es(this,cp).notify({mutation:this,type:"updated",action:i})})},JR);function getDefaultState(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var _0,bm,Q1,eP,MutationCache=(eP=class extends Subscribable{constructor(i={}){super();zl(this,_0);zl(this,bm);zl(this,Q1);this.config=i,$o(this,_0,new Set),$o(this,bm,new Map),$o(this,Q1,0)}build(i,s,a){const _=new Mutation({mutationCache:this,mutationId:++ZE(this,Q1)._,options:i.defaultMutationOptions(s),state:a});return this.add(_),_}add(i){es(this,_0).add(i);const s=scopeFor(i);if(typeof s=="string"){const a=es(this,bm).get(s);a?a.push(i):es(this,bm).set(s,[i])}this.notify({type:"added",mutation:i})}remove(i){if(es(this,_0).delete(i)){const s=scopeFor(i);if(typeof s=="string"){const a=es(this,bm).get(s);if(a)if(a.length>1){const _=a.indexOf(i);_!==-1&&a.splice(_,1)}else a[0]===i&&es(this,bm).delete(s)}}this.notify({type:"removed",mutation:i})}canRun(i){const s=scopeFor(i);if(typeof s=="string"){const a=es(this,bm).get(s),_=a==null?void 0:a.find(et=>et.state.status==="pending");return!_||_===i}else return!0}runNext(i){var a;const s=scopeFor(i);if(typeof s=="string"){const _=(a=es(this,bm).get(s))==null?void 0:a.find(et=>et!==i&&et.state.isPaused);return(_==null?void 0:_.continue())??Promise.resolve()}else return Promise.resolve()}clear(){notifyManager.batch(()=>{es(this,_0).forEach(i=>{this.notify({type:"removed",mutation:i})}),es(this,_0).clear(),es(this,bm).clear()})}getAll(){return Array.from(es(this,_0))}find(i){const s={exact:!0,...i};return this.getAll().find(a=>matchMutation(s,a))}findAll(i={}){return this.getAll().filter(s=>matchMutation(i,s))}notify(i){notifyManager.batch(()=>{this.listeners.forEach(s=>{s(i)})})}resumePausedMutations(){const i=this.getAll().filter(s=>s.state.isPaused);return notifyManager.batch(()=>Promise.all(i.map(s=>s.continue().catch(noop$2))))}},_0=new WeakMap,bm=new WeakMap,Q1=new WeakMap,eP);function scopeFor(e){var i;return(i=e.options.scope)==null?void 0:i.id}function infiniteQueryBehavior(e){return{onFetch:(i,s)=>{var gt,Tt,Et,At,Mt;const a=i.options,_=(Et=(Tt=(gt=i.fetchOptions)==null?void 0:gt.meta)==null?void 0:Tt.fetchMore)==null?void 0:Et.direction,et=((At=i.state.data)==null?void 0:At.pages)||[],nt=((Mt=i.state.data)==null?void 0:Mt.pageParams)||[];let c={pages:[],pageParams:[]},ct=0;const dt=async()=>{let Pt=!1;const $t=Nt=>{Object.defineProperty(Nt,"signal",{enumerable:!0,get:()=>(i.signal.aborted?Pt=!0:i.signal.addEventListener("abort",()=>{Pt=!0}),i.signal)})},Lt=ensureQueryFn(i.options,i.fetchOptions),Bt=async(Nt,Vt,Xt)=>{if(Pt)return Promise.reject();if(Vt==null&&Nt.pages.length)return Promise.resolve(Nt);const ar=(()=>{const fn={client:i.client,queryKey:i.queryKey,pageParam:Vt,direction:Xt?"backward":"forward",meta:i.options.meta};return $t(fn),fn})(),mr=await Lt(ar),{maxPages:Fr}=i.options,sn=Xt?addToStart:addToEnd;return{pages:sn(Nt.pages,mr,Fr),pageParams:sn(Nt.pageParams,Vt,Fr)}};if(_&&et.length){const Nt=_==="backward",Vt=Nt?getPreviousPageParam:getNextPageParam,Xt={pages:et,pageParams:nt},nr=Vt(a,Xt);c=await Bt(Xt,nr,Nt)}else{const Nt=e??et.length;do{const Vt=ct===0?nt[0]??a.initialPageParam:getNextPageParam(a,c);if(ct>0&&Vt==null)break;c=await Bt(c,Vt),ct++}while(ct<Nt)}return c};i.options.persister?i.fetchFn=()=>{var Pt,$t;return($t=(Pt=i.options).persister)==null?void 0:$t.call(Pt,dt,{client:i.client,queryKey:i.queryKey,meta:i.options.meta,signal:i.signal},s)}:i.fetchFn=dt}}}function getNextPageParam(e,{pages:i,pageParams:s}){const a=i.length-1;return i.length>0?e.getNextPageParam(i[a],i,s[a],s):void 0}function getPreviousPageParam(e,{pages:i,pageParams:s}){var a;return i.length>0?(a=e.getPreviousPageParam)==null?void 0:a.call(e,i[0],i,s[0],s):void 0}var _u,ny,iy,Q_,J_,sy,ev,tv,tP,QueryClient=(tP=class{constructor(e={}){zl(this,_u);zl(this,ny);zl(this,iy);zl(this,Q_);zl(this,J_);zl(this,sy);zl(this,ev);zl(this,tv);$o(this,_u,e.queryCache||new QueryCache),$o(this,ny,e.mutationCache||new MutationCache),$o(this,iy,e.defaultOptions||{}),$o(this,Q_,new Map),$o(this,J_,new Map),$o(this,sy,0)}mount(){ZE(this,sy)._++,es(this,sy)===1&&($o(this,ev,focusManager.subscribe(async e=>{e&&(await this.resumePausedMutations(),es(this,_u).onFocus())})),$o(this,tv,onlineManager.subscribe(async e=>{e&&(await this.resumePausedMutations(),es(this,_u).onOnline())})))}unmount(){var e,i;ZE(this,sy)._--,es(this,sy)===0&&((e=es(this,ev))==null||e.call(this),$o(this,ev,void 0),(i=es(this,tv))==null||i.call(this),$o(this,tv,void 0))}isFetching(e){return es(this,_u).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return es(this,ny).findAll({...e,status:"pending"}).length}getQueryData(e){var s;const i=this.defaultQueryOptions({queryKey:e});return(s=es(this,_u).get(i.queryHash))==null?void 0:s.state.data}ensureQueryData(e){const i=this.defaultQueryOptions(e),s=es(this,_u).build(this,i),a=s.state.data;return a===void 0?this.fetchQuery(e):(e.revalidateIfStale&&s.isStaleByTime(resolveStaleTime(i.staleTime,s))&&this.prefetchQuery(i),Promise.resolve(a))}getQueriesData(e){return es(this,_u).findAll(e).map(({queryKey:i,state:s})=>{const a=s.data;return[i,a]})}setQueryData(e,i,s){const a=this.defaultQueryOptions({queryKey:e}),_=es(this,_u).get(a.queryHash),et=_==null?void 0:_.state.data,nt=functionalUpdate(i,et);if(nt!==void 0)return es(this,_u).build(this,a).setData(nt,{...s,manual:!0})}setQueriesData(e,i,s){return notifyManager.batch(()=>es(this,_u).findAll(e).map(({queryKey:a})=>[a,this.setQueryData(a,i,s)]))}getQueryState(e){var s;const i=this.defaultQueryOptions({queryKey:e});return(s=es(this,_u).get(i.queryHash))==null?void 0:s.state}removeQueries(e){const i=es(this,_u);notifyManager.batch(()=>{i.findAll(e).forEach(s=>{i.remove(s)})})}resetQueries(e,i){const s=es(this,_u);return notifyManager.batch(()=>(s.findAll(e).forEach(a=>{a.reset()}),this.refetchQueries({type:"active",...e},i)))}cancelQueries(e,i={}){const s={revert:!0,...i},a=notifyManager.batch(()=>es(this,_u).findAll(e).map(_=>_.cancel(s)));return Promise.all(a).then(noop$2).catch(noop$2)}invalidateQueries(e,i={}){return notifyManager.batch(()=>(es(this,_u).findAll(e).forEach(s=>{s.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},i)))}refetchQueries(e,i={}){const s={...i,cancelRefetch:i.cancelRefetch??!0},a=notifyManager.batch(()=>es(this,_u).findAll(e).filter(_=>!_.isDisabled()&&!_.isStatic()).map(_=>{let et=_.fetch(void 0,s);return s.throwOnError||(et=et.catch(noop$2)),_.state.fetchStatus==="paused"?Promise.resolve():et}));return Promise.all(a).then(noop$2)}fetchQuery(e){const i=this.defaultQueryOptions(e);i.retry===void 0&&(i.retry=!1);const s=es(this,_u).build(this,i);return s.isStaleByTime(resolveStaleTime(i.staleTime,s))?s.fetch(i):Promise.resolve(s.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(noop$2).catch(noop$2)}fetchInfiniteQuery(e){return e.behavior=infiniteQueryBehavior(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(noop$2).catch(noop$2)}ensureInfiniteQueryData(e){return e.behavior=infiniteQueryBehavior(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return onlineManager.isOnline()?es(this,ny).resumePausedMutations():Promise.resolve()}getQueryCache(){return es(this,_u)}getMutationCache(){return es(this,ny)}getDefaultOptions(){return es(this,iy)}setDefaultOptions(e){$o(this,iy,e)}setQueryDefaults(e,i){es(this,Q_).set(hashKey(e),{queryKey:e,defaultOptions:i})}getQueryDefaults(e){const i=[...es(this,Q_).values()],s={};return i.forEach(a=>{partialMatchKey(e,a.queryKey)&&Object.assign(s,a.defaultOptions)}),s}setMutationDefaults(e,i){es(this,J_).set(hashKey(e),{mutationKey:e,defaultOptions:i})}getMutationDefaults(e){const i=[...es(this,J_).values()],s={};return i.forEach(a=>{partialMatchKey(e,a.mutationKey)&&Object.assign(s,a.defaultOptions)}),s}defaultQueryOptions(e){if(e._defaulted)return e;const i={...es(this,iy).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return i.queryHash||(i.queryHash=hashQueryKeyByOptions(i.queryKey,i)),i.refetchOnReconnect===void 0&&(i.refetchOnReconnect=i.networkMode!=="always"),i.throwOnError===void 0&&(i.throwOnError=!!i.suspense),!i.networkMode&&i.persister&&(i.networkMode="offlineFirst"),i.queryFn===skipToken&&(i.enabled=!1),i}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...es(this,iy).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){es(this,_u).clear(),es(this,ny).clear()}},_u=new WeakMap,ny=new WeakMap,iy=new WeakMap,Q_=new WeakMap,J_=new WeakMap,sy=new WeakMap,ev=new WeakMap,tv=new WeakMap,tP),QueryClientContext=reactExports.createContext(void 0),QueryClientProvider=({client:e,children:i})=>(reactExports.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),jsxRuntimeExports.jsx(QueryClientContext.Provider,{value:e,children:i}));/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends$2(){return _extends$2=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},_extends$2.apply(this,arguments)}var Action$1;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Action$1||(Action$1={}));const PopStateEventType="popstate";function createBrowserHistory(e){e===void 0&&(e={});function i(a,_){let{pathname:et,search:nt,hash:c}=a.location;return createLocation("",{pathname:et,search:nt,hash:c},_.state&&_.state.usr||null,_.state&&_.state.key||"default")}function s(a,_){return typeof _=="string"?_:createPath(_)}return getUrlBasedHistory(i,s,null,e)}function invariant$1(e,i){if(e===!1||e===null||typeof e>"u")throw new Error(i)}function warning$1(e,i){if(!e){typeof console<"u"&&console.warn(i);try{throw new Error(i)}catch{}}}function createKey(){return Math.random().toString(36).substr(2,8)}function getHistoryState(e,i){return{usr:e.state,key:e.key,idx:i}}function createLocation(e,i,s,a){return s===void 0&&(s=null),_extends$2({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof i=="string"?parsePath(i):i,{state:s,key:i&&i.key||a||createKey()})}function createPath(e){let{pathname:i="/",search:s="",hash:a=""}=e;return s&&s!=="?"&&(i+=s.charAt(0)==="?"?s:"?"+s),a&&a!=="#"&&(i+=a.charAt(0)==="#"?a:"#"+a),i}function parsePath(e){let i={};if(e){let s=e.indexOf("#");s>=0&&(i.hash=e.substr(s),e=e.substr(0,s));let a=e.indexOf("?");a>=0&&(i.search=e.substr(a),e=e.substr(0,a)),e&&(i.pathname=e)}return i}function getUrlBasedHistory(e,i,s,a){a===void 0&&(a={});let{window:_=document.defaultView,v5Compat:et=!1}=a,nt=_.history,c=Action$1.Pop,ct=null,dt=gt();dt==null&&(dt=0,nt.replaceState(_extends$2({},nt.state,{idx:dt}),""));function gt(){return(nt.state||{idx:null}).idx}function Tt(){c=Action$1.Pop;let $t=gt(),Lt=$t==null?null:$t-dt;dt=$t,ct&&ct({action:c,location:Pt.location,delta:Lt})}function Et($t,Lt){c=Action$1.Push;let Bt=createLocation(Pt.location,$t,Lt);dt=gt()+1;let Nt=getHistoryState(Bt,dt),Vt=Pt.createHref(Bt);try{nt.pushState(Nt,"",Vt)}catch(Xt){if(Xt instanceof DOMException&&Xt.name==="DataCloneError")throw Xt;_.location.assign(Vt)}et&&ct&&ct({action:c,location:Pt.location,delta:1})}function At($t,Lt){c=Action$1.Replace;let Bt=createLocation(Pt.location,$t,Lt);dt=gt();let Nt=getHistoryState(Bt,dt),Vt=Pt.createHref(Bt);nt.replaceState(Nt,"",Vt),et&&ct&&ct({action:c,location:Pt.location,delta:0})}function Mt($t){let Lt=_.location.origin!=="null"?_.location.origin:_.location.href,Bt=typeof $t=="string"?$t:createPath($t);return Bt=Bt.replace(/ $/,"%20"),invariant$1(Lt,"No window.location.(origin|href) available to create URL for href: "+Bt),new URL(Bt,Lt)}let Pt={get action(){return c},get location(){return e(_,nt)},listen($t){if(ct)throw new Error("A history only accepts one active listener");return _.addEventListener(PopStateEventType,Tt),ct=$t,()=>{_.removeEventListener(PopStateEventType,Tt),ct=null}},createHref($t){return i(_,$t)},createURL:Mt,encodeLocation($t){let Lt=Mt($t);return{pathname:Lt.pathname,search:Lt.search,hash:Lt.hash}},push:Et,replace:At,go($t){return nt.go($t)}};return Pt}var ResultType;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(ResultType||(ResultType={}));function matchRoutes(e,i,s){return s===void 0&&(s="/"),matchRoutesImpl(e,i,s,!1)}function matchRoutesImpl(e,i,s,a){let _=typeof i=="string"?parsePath(i):i,et=stripBasename(_.pathname||"/",s);if(et==null)return null;let nt=flattenRoutes(e);rankRouteBranches(nt);let c=null;for(let ct=0;c==null&&ct<nt.length;++ct){let dt=decodePath$1(et);c=matchRouteBranch(nt[ct],dt,a)}return c}function flattenRoutes(e,i,s,a){i===void 0&&(i=[]),s===void 0&&(s=[]),a===void 0&&(a="");let _=(et,nt,c)=>{let ct={relativePath:c===void 0?et.path||"":c,caseSensitive:et.caseSensitive===!0,childrenIndex:nt,route:et};ct.relativePath.startsWith("/")&&(invariant$1(ct.relativePath.startsWith(a),'Absolute route path "'+ct.relativePath+'" nested under path '+('"'+a+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),ct.relativePath=ct.relativePath.slice(a.length));let dt=joinPaths([a,ct.relativePath]),gt=s.concat(ct);et.children&&et.children.length>0&&(invariant$1(et.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+dt+'".')),flattenRoutes(et.children,i,gt,dt)),!(et.path==null&&!et.index)&&i.push({path:dt,score:computeScore(dt,et.index),routesMeta:gt})};return e.forEach((et,nt)=>{var c;if(et.path===""||!((c=et.path)!=null&&c.includes("?")))_(et,nt);else for(let ct of explodeOptionalSegments(et.path))_(et,nt,ct)}),i}function explodeOptionalSegments(e){let i=e.split("/");if(i.length===0)return[];let[s,...a]=i,_=s.endsWith("?"),et=s.replace(/\?$/,"");if(a.length===0)return _?[et,""]:[et];let nt=explodeOptionalSegments(a.join("/")),c=[];return c.push(...nt.map(ct=>ct===""?et:[et,ct].join("/"))),_&&c.push(...nt),c.map(ct=>e.startsWith("/")&&ct===""?"/":ct)}function rankRouteBranches(e){e.sort((i,s)=>i.score!==s.score?s.score-i.score:compareIndexes(i.routesMeta.map(a=>a.childrenIndex),s.routesMeta.map(a=>a.childrenIndex)))}const paramRe=/^:[\w-]+$/,dynamicSegmentValue=3,indexRouteValue=2,emptySegmentValue=1,staticSegmentValue=10,splatPenalty=-2,isSplat=e=>e==="*";function computeScore(e,i){let s=e.split("/"),a=s.length;return s.some(isSplat)&&(a+=splatPenalty),i&&(a+=indexRouteValue),s.filter(_=>!isSplat(_)).reduce((_,et)=>_+(paramRe.test(et)?dynamicSegmentValue:et===""?emptySegmentValue:staticSegmentValue),a)}function compareIndexes(e,i){return e.length===i.length&&e.slice(0,-1).every((a,_)=>a===i[_])?e[e.length-1]-i[i.length-1]:0}function matchRouteBranch(e,i,s){let{routesMeta:a}=e,_={},et="/",nt=[];for(let c=0;c<a.length;++c){let ct=a[c],dt=c===a.length-1,gt=et==="/"?i:i.slice(et.length)||"/",Tt=matchPath({path:ct.relativePath,caseSensitive:ct.caseSensitive,end:dt},gt),Et=ct.route;if(!Tt&&dt&&s&&!a[a.length-1].route.index&&(Tt=matchPath({path:ct.relativePath,caseSensitive:ct.caseSensitive,end:!1},gt)),!Tt)return null;Object.assign(_,Tt.params),nt.push({params:_,pathname:joinPaths([et,Tt.pathname]),pathnameBase:normalizePathname(joinPaths([et,Tt.pathnameBase])),route:Et}),Tt.pathnameBase!=="/"&&(et=joinPaths([et,Tt.pathnameBase]))}return nt}function matchPath(e,i){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[s,a]=compilePath(e.path,e.caseSensitive,e.end),_=i.match(s);if(!_)return null;let et=_[0],nt=et.replace(/(.)\/+$/,"$1"),c=_.slice(1);return{params:a.reduce((dt,gt,Tt)=>{let{paramName:Et,isOptional:At}=gt;if(Et==="*"){let Pt=c[Tt]||"";nt=et.slice(0,et.length-Pt.length).replace(/(.)\/+$/,"$1")}const Mt=c[Tt];return At&&!Mt?dt[Et]=void 0:dt[Et]=(Mt||"").replace(/%2F/g,"/"),dt},{}),pathname:et,pathnameBase:nt,pattern:e}}function compilePath(e,i,s){i===void 0&&(i=!1),s===void 0&&(s=!0),warning$1(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let a=[],_="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(nt,c,ct)=>(a.push({paramName:c,isOptional:ct!=null}),ct?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(a.push({paramName:"*"}),_+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?_+="\\/*$":e!==""&&e!=="/"&&(_+="(?:(?=\\/|$))"),[new RegExp(_,i?void 0:"i"),a]}function decodePath$1(e){try{return e.split("/").map(i=>decodeURIComponent(i).replace(/\//g,"%2F")).join("/")}catch(i){return warning$1(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+i+").")),e}}function stripBasename(e,i){if(i==="/")return e;if(!e.toLowerCase().startsWith(i.toLowerCase()))return null;let s=i.endsWith("/")?i.length-1:i.length,a=e.charAt(s);return a&&a!=="/"?null:e.slice(s)||"/"}function resolvePath(e,i){i===void 0&&(i="/");let{pathname:s,search:a="",hash:_=""}=typeof e=="string"?parsePath(e):e;return{pathname:s?s.startsWith("/")?s:resolvePathname(s,i):i,search:normalizeSearch(a),hash:normalizeHash(_)}}function resolvePathname(e,i){let s=i.replace(/\/+$/,"").split("/");return e.split("/").forEach(_=>{_===".."?s.length>1&&s.pop():_!=="."&&s.push(_)}),s.length>1?s.join("/"):"/"}function getInvalidPathError(e,i,s,a){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+i+"` field ["+JSON.stringify(a)+"].  Please separate it out to the ")+("`to."+s+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function getPathContributingMatches(e){return e.filter((i,s)=>s===0||i.route.path&&i.route.path.length>0)}function getResolveToMatches(e,i){let s=getPathContributingMatches(e);return i?s.map((a,_)=>_===s.length-1?a.pathname:a.pathnameBase):s.map(a=>a.pathnameBase)}function resolveTo(e,i,s,a){a===void 0&&(a=!1);let _;typeof e=="string"?_=parsePath(e):(_=_extends$2({},e),invariant$1(!_.pathname||!_.pathname.includes("?"),getInvalidPathError("?","pathname","search",_)),invariant$1(!_.pathname||!_.pathname.includes("#"),getInvalidPathError("#","pathname","hash",_)),invariant$1(!_.search||!_.search.includes("#"),getInvalidPathError("#","search","hash",_)));let et=e===""||_.pathname==="",nt=et?"/":_.pathname,c;if(nt==null)c=s;else{let Tt=i.length-1;if(!a&&nt.startsWith("..")){let Et=nt.split("/");for(;Et[0]==="..";)Et.shift(),Tt-=1;_.pathname=Et.join("/")}c=Tt>=0?i[Tt]:"/"}let ct=resolvePath(_,c),dt=nt&&nt!=="/"&&nt.endsWith("/"),gt=(et||nt===".")&&s.endsWith("/");return!ct.pathname.endsWith("/")&&(dt||gt)&&(ct.pathname+="/"),ct}const joinPaths=e=>e.join("/").replace(/\/\/+/g,"/"),normalizePathname=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),normalizeSearch=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,normalizeHash=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function isRouteErrorResponse(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const validMutationMethodsArr=["post","put","patch","delete"];new Set(validMutationMethodsArr);const validRequestMethodsArr=["get",...validMutationMethodsArr];new Set(validRequestMethodsArr);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},_extends$1.apply(this,arguments)}const DataRouterContext=reactExports.createContext(null),DataRouterStateContext=reactExports.createContext(null),NavigationContext=reactExports.createContext(null),LocationContext$1=reactExports.createContext(null),RouteContext=reactExports.createContext({outlet:null,matches:[],isDataRoute:!1}),RouteErrorContext=reactExports.createContext(null);function useHref(e,i){let{relative:s}=i===void 0?{}:i;useInRouterContext()||invariant$1(!1);let{basename:a,navigator:_}=reactExports.useContext(NavigationContext),{hash:et,pathname:nt,search:c}=useResolvedPath(e,{relative:s}),ct=nt;return a!=="/"&&(ct=nt==="/"?a:joinPaths([a,nt])),_.createHref({pathname:ct,search:c,hash:et})}function useInRouterContext(){return reactExports.useContext(LocationContext$1)!=null}function useLocation(){return useInRouterContext()||invariant$1(!1),reactExports.useContext(LocationContext$1).location}function useIsomorphicLayoutEffect$2(e){reactExports.useContext(NavigationContext).static||reactExports.useLayoutEffect(e)}function useNavigate(){let{isDataRoute:e}=reactExports.useContext(RouteContext);return e?useNavigateStable():useNavigateUnstable()}function useNavigateUnstable(){useInRouterContext()||invariant$1(!1);let e=reactExports.useContext(DataRouterContext),{basename:i,future:s,navigator:a}=reactExports.useContext(NavigationContext),{matches:_}=reactExports.useContext(RouteContext),{pathname:et}=useLocation(),nt=JSON.stringify(getResolveToMatches(_,s.v7_relativeSplatPath)),c=reactExports.useRef(!1);return useIsomorphicLayoutEffect$2(()=>{c.current=!0}),reactExports.useCallback(function(dt,gt){if(gt===void 0&&(gt={}),!c.current)return;if(typeof dt=="number"){a.go(dt);return}let Tt=resolveTo(dt,JSON.parse(nt),et,gt.relative==="path");e==null&&i!=="/"&&(Tt.pathname=Tt.pathname==="/"?i:joinPaths([i,Tt.pathname])),(gt.replace?a.replace:a.push)(Tt,gt.state,gt)},[i,a,nt,et,e])}function useParams(){let{matches:e}=reactExports.useContext(RouteContext),i=e[e.length-1];return i?i.params:{}}function useResolvedPath(e,i){let{relative:s}=i===void 0?{}:i,{future:a}=reactExports.useContext(NavigationContext),{matches:_}=reactExports.useContext(RouteContext),{pathname:et}=useLocation(),nt=JSON.stringify(getResolveToMatches(_,a.v7_relativeSplatPath));return reactExports.useMemo(()=>resolveTo(e,JSON.parse(nt),et,s==="path"),[e,nt,et,s])}function useRoutes(e,i){return useRoutesImpl(e,i)}function useRoutesImpl(e,i,s,a){useInRouterContext()||invariant$1(!1);let{navigator:_}=reactExports.useContext(NavigationContext),{matches:et}=reactExports.useContext(RouteContext),nt=et[et.length-1],c=nt?nt.params:{};nt&&nt.pathname;let ct=nt?nt.pathnameBase:"/";nt&&nt.route;let dt=useLocation(),gt;if(i){var Tt;let $t=typeof i=="string"?parsePath(i):i;ct==="/"||(Tt=$t.pathname)!=null&&Tt.startsWith(ct)||invariant$1(!1),gt=$t}else gt=dt;let Et=gt.pathname||"/",At=Et;if(ct!=="/"){let $t=ct.replace(/^\//,"").split("/");At="/"+Et.replace(/^\//,"").split("/").slice($t.length).join("/")}let Mt=matchRoutes(e,{pathname:At}),Pt=_renderMatches(Mt&&Mt.map($t=>Object.assign({},$t,{params:Object.assign({},c,$t.params),pathname:joinPaths([ct,_.encodeLocation?_.encodeLocation($t.pathname).pathname:$t.pathname]),pathnameBase:$t.pathnameBase==="/"?ct:joinPaths([ct,_.encodeLocation?_.encodeLocation($t.pathnameBase).pathname:$t.pathnameBase])})),et,s,a);return i&&Pt?reactExports.createElement(LocationContext$1.Provider,{value:{location:_extends$1({pathname:"/",search:"",hash:"",state:null,key:"default"},gt),navigationType:Action$1.Pop}},Pt):Pt}function DefaultErrorComponent(){let e=useRouteError(),i=isRouteErrorResponse(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),s=e instanceof Error?e.stack:null,_={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("h2",null,"Unexpected Application Error!"),reactExports.createElement("h3",{style:{fontStyle:"italic"}},i),s?reactExports.createElement("pre",{style:_},s):null,null)}const defaultErrorElement=reactExports.createElement(DefaultErrorComponent,null);class RenderErrorBoundary extends reactExports.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,s){return s.location!==i.location||s.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:s.error,location:s.location,revalidation:i.revalidation||s.revalidation}}componentDidCatch(i,s){console.error("React Router caught the following error during render",i,s)}render(){return this.state.error!==void 0?reactExports.createElement(RouteContext.Provider,{value:this.props.routeContext},reactExports.createElement(RouteErrorContext.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function RenderedRoute(e){let{routeContext:i,match:s,children:a}=e,_=reactExports.useContext(DataRouterContext);return _&&_.static&&_.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(_.staticContext._deepestRenderedBoundaryId=s.route.id),reactExports.createElement(RouteContext.Provider,{value:i},a)}function _renderMatches(e,i,s,a){var _;if(i===void 0&&(i=[]),s===void 0&&(s=null),a===void 0&&(a=null),e==null){var et;if(!s)return null;if(s.errors)e=s.matches;else if((et=a)!=null&&et.v7_partialHydration&&i.length===0&&!s.initialized&&s.matches.length>0)e=s.matches;else return null}let nt=e,c=(_=s)==null?void 0:_.errors;if(c!=null){let gt=nt.findIndex(Tt=>Tt.route.id&&(c==null?void 0:c[Tt.route.id])!==void 0);gt>=0||invariant$1(!1),nt=nt.slice(0,Math.min(nt.length,gt+1))}let ct=!1,dt=-1;if(s&&a&&a.v7_partialHydration)for(let gt=0;gt<nt.length;gt++){let Tt=nt[gt];if((Tt.route.HydrateFallback||Tt.route.hydrateFallbackElement)&&(dt=gt),Tt.route.id){let{loaderData:Et,errors:At}=s,Mt=Tt.route.loader&&Et[Tt.route.id]===void 0&&(!At||At[Tt.route.id]===void 0);if(Tt.route.lazy||Mt){ct=!0,dt>=0?nt=nt.slice(0,dt+1):nt=[nt[0]];break}}}return nt.reduceRight((gt,Tt,Et)=>{let At,Mt=!1,Pt=null,$t=null;s&&(At=c&&Tt.route.id?c[Tt.route.id]:void 0,Pt=Tt.route.errorElement||defaultErrorElement,ct&&(dt<0&&Et===0?(Mt=!0,$t=null):dt===Et&&(Mt=!0,$t=Tt.route.hydrateFallbackElement||null)));let Lt=i.concat(nt.slice(0,Et+1)),Bt=()=>{let Nt;return At?Nt=Pt:Mt?Nt=$t:Tt.route.Component?Nt=reactExports.createElement(Tt.route.Component,null):Tt.route.element?Nt=Tt.route.element:Nt=gt,reactExports.createElement(RenderedRoute,{match:Tt,routeContext:{outlet:gt,matches:Lt,isDataRoute:s!=null},children:Nt})};return s&&(Tt.route.ErrorBoundary||Tt.route.errorElement||Et===0)?reactExports.createElement(RenderErrorBoundary,{location:s.location,revalidation:s.revalidation,component:Pt,error:At,children:Bt(),routeContext:{outlet:null,matches:Lt,isDataRoute:!0}}):Bt()},null)}var DataRouterHook$1=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(DataRouterHook$1||{}),DataRouterStateHook$1=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(DataRouterStateHook$1||{});function useDataRouterContext(e){let i=reactExports.useContext(DataRouterContext);return i||invariant$1(!1),i}function useDataRouterState(e){let i=reactExports.useContext(DataRouterStateContext);return i||invariant$1(!1),i}function useRouteContext(e){let i=reactExports.useContext(RouteContext);return i||invariant$1(!1),i}function useCurrentRouteId(e){let i=useRouteContext(),s=i.matches[i.matches.length-1];return s.route.id||invariant$1(!1),s.route.id}function useRouteError(){var e;let i=reactExports.useContext(RouteErrorContext),s=useDataRouterState(DataRouterStateHook$1.UseRouteError),a=useCurrentRouteId(DataRouterStateHook$1.UseRouteError);return i!==void 0?i:(e=s.errors)==null?void 0:e[a]}function useNavigateStable(){let{router:e}=useDataRouterContext(DataRouterHook$1.UseNavigateStable),i=useCurrentRouteId(DataRouterStateHook$1.UseNavigateStable),s=reactExports.useRef(!1);return useIsomorphicLayoutEffect$2(()=>{s.current=!0}),reactExports.useCallback(function(_,et){et===void 0&&(et={}),s.current&&(typeof _=="number"?e.navigate(_):e.navigate(_,_extends$1({fromRouteId:i},et)))},[e,i])}function logV6DeprecationWarnings(e,i){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function Navigate(e){let{to:i,replace:s,state:a,relative:_}=e;useInRouterContext()||invariant$1(!1);let{future:et,static:nt}=reactExports.useContext(NavigationContext),{matches:c}=reactExports.useContext(RouteContext),{pathname:ct}=useLocation(),dt=useNavigate(),gt=resolveTo(i,getResolveToMatches(c,et.v7_relativeSplatPath),ct,_==="path"),Tt=JSON.stringify(gt);return reactExports.useEffect(()=>dt(JSON.parse(Tt),{replace:s,state:a,relative:_}),[dt,Tt,_,s,a]),null}function Route(e){invariant$1(!1)}function Router(e){let{basename:i="/",children:s=null,location:a,navigationType:_=Action$1.Pop,navigator:et,static:nt=!1,future:c}=e;useInRouterContext()&&invariant$1(!1);let ct=i.replace(/^\/*/,"/"),dt=reactExports.useMemo(()=>({basename:ct,navigator:et,static:nt,future:_extends$1({v7_relativeSplatPath:!1},c)}),[ct,c,et,nt]);typeof a=="string"&&(a=parsePath(a));let{pathname:gt="/",search:Tt="",hash:Et="",state:At=null,key:Mt="default"}=a,Pt=reactExports.useMemo(()=>{let $t=stripBasename(gt,ct);return $t==null?null:{location:{pathname:$t,search:Tt,hash:Et,state:At,key:Mt},navigationType:_}},[ct,gt,Tt,Et,At,Mt,_]);return Pt==null?null:reactExports.createElement(NavigationContext.Provider,{value:dt},reactExports.createElement(LocationContext$1.Provider,{children:s,value:Pt}))}function Routes(e){let{children:i,location:s}=e;return useRoutes(createRoutesFromChildren(i),s)}new Promise(()=>{});function createRoutesFromChildren(e,i){i===void 0&&(i=[]);let s=[];return reactExports.Children.forEach(e,(a,_)=>{if(!reactExports.isValidElement(a))return;let et=[...i,_];if(a.type===reactExports.Fragment){s.push.apply(s,createRoutesFromChildren(a.props.children,et));return}a.type!==Route&&invariant$1(!1),!a.props.index||!a.props.children||invariant$1(!1);let nt={id:a.props.id||et.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(nt.children=createRoutesFromChildren(a.props.children,et)),s.push(nt)}),s}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},_extends.apply(this,arguments)}function _objectWithoutPropertiesLoose$1(e,i){if(e==null)return{};var s={},a=Object.keys(e),_,et;for(et=0;et<a.length;et++)_=a[et],!(i.indexOf(_)>=0)&&(s[_]=e[_]);return s}function isModifiedEvent(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function shouldProcessLinkClick(e,i){return e.button===0&&(!i||i==="_self")&&!isModifiedEvent(e)}const _excluded$2=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],REACT_ROUTER_VERSION="6";try{window.__reactRouterVersion=REACT_ROUTER_VERSION}catch{}const START_TRANSITION="startTransition",startTransitionImpl=React$1[START_TRANSITION];function BrowserRouter(e){let{basename:i,children:s,future:a,window:_}=e,et=reactExports.useRef();et.current==null&&(et.current=createBrowserHistory({window:_,v5Compat:!0}));let nt=et.current,[c,ct]=reactExports.useState({action:nt.action,location:nt.location}),{v7_startTransition:dt}=a||{},gt=reactExports.useCallback(Tt=>{dt&&startTransitionImpl?startTransitionImpl(()=>ct(Tt)):ct(Tt)},[ct,dt]);return reactExports.useLayoutEffect(()=>nt.listen(gt),[nt,gt]),reactExports.useEffect(()=>logV6DeprecationWarnings(a),[a]),reactExports.createElement(Router,{basename:i,children:s,location:c.location,navigationType:c.action,navigator:nt,future:a})}const isBrowser$1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ABSOLUTE_URL_REGEX=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Link=reactExports.forwardRef(function(i,s){let{onClick:a,relative:_,reloadDocument:et,replace:nt,state:c,target:ct,to:dt,preventScrollReset:gt,viewTransition:Tt}=i,Et=_objectWithoutPropertiesLoose$1(i,_excluded$2),{basename:At}=reactExports.useContext(NavigationContext),Mt,Pt=!1;if(typeof dt=="string"&&ABSOLUTE_URL_REGEX.test(dt)&&(Mt=dt,isBrowser$1))try{let Nt=new URL(window.location.href),Vt=dt.startsWith("//")?new URL(Nt.protocol+dt):new URL(dt),Xt=stripBasename(Vt.pathname,At);Vt.origin===Nt.origin&&Xt!=null?dt=Xt+Vt.search+Vt.hash:Pt=!0}catch{}let $t=useHref(dt,{relative:_}),Lt=useLinkClickHandler(dt,{replace:nt,state:c,target:ct,preventScrollReset:gt,relative:_,viewTransition:Tt});function Bt(Nt){a&&a(Nt),Nt.defaultPrevented||Lt(Nt)}return reactExports.createElement("a",_extends({},Et,{href:Mt||$t,onClick:Pt||et?a:Bt,ref:s,target:ct}))});var DataRouterHook;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(DataRouterHook||(DataRouterHook={}));var DataRouterStateHook;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(DataRouterStateHook||(DataRouterStateHook={}));function useLinkClickHandler(e,i){let{target:s,replace:a,state:_,preventScrollReset:et,relative:nt,viewTransition:c}=i===void 0?{}:i,ct=useNavigate(),dt=useLocation(),gt=useResolvedPath(e,{relative:nt});return reactExports.useCallback(Tt=>{if(shouldProcessLinkClick(Tt,s)){Tt.preventDefault();let Et=a!==void 0?a:createPath(dt)===createPath(gt);ct(e,{replace:Et,state:_,preventScrollReset:et,relative:nt,viewTransition:c})}},[dt,ct,gt,a,_,s,e,et,nt,c])}const getDefaultsFromPostinstall=()=>{};var define_process_env_default$1={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CONSTANTS={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const assert=function(e,i){if(!e)throw assertionError(i)},assertionError=function(e){return new Error("Firebase Database ("+CONSTANTS.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const stringToByteArray$1=function(e){const i=[];let s=0;for(let a=0;a<e.length;a++){let _=e.charCodeAt(a);_<128?i[s++]=_:_<2048?(i[s++]=_>>6|192,i[s++]=_&63|128):(_&64512)===55296&&a+1<e.length&&(e.charCodeAt(a+1)&64512)===56320?(_=65536+((_&1023)<<10)+(e.charCodeAt(++a)&1023),i[s++]=_>>18|240,i[s++]=_>>12&63|128,i[s++]=_>>6&63|128,i[s++]=_&63|128):(i[s++]=_>>12|224,i[s++]=_>>6&63|128,i[s++]=_&63|128)}return i},byteArrayToString=function(e){const i=[];let s=0,a=0;for(;s<e.length;){const _=e[s++];if(_<128)i[a++]=String.fromCharCode(_);else if(_>191&&_<224){const et=e[s++];i[a++]=String.fromCharCode((_&31)<<6|et&63)}else if(_>239&&_<365){const et=e[s++],nt=e[s++],c=e[s++],ct=((_&7)<<18|(et&63)<<12|(nt&63)<<6|c&63)-65536;i[a++]=String.fromCharCode(55296+(ct>>10)),i[a++]=String.fromCharCode(56320+(ct&1023))}else{const et=e[s++],nt=e[s++];i[a++]=String.fromCharCode((_&15)<<12|(et&63)<<6|nt&63)}}return i.join("")},base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,i){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=i?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let _=0;_<e.length;_+=3){const et=e[_],nt=_+1<e.length,c=nt?e[_+1]:0,ct=_+2<e.length,dt=ct?e[_+2]:0,gt=et>>2,Tt=(et&3)<<4|c>>4;let Et=(c&15)<<2|dt>>6,At=dt&63;ct||(At=64,nt||(Et=64)),a.push(s[gt],s[Tt],s[Et],s[At])}return a.join("")},encodeString(e,i){return this.HAS_NATIVE_SUPPORT&&!i?btoa(e):this.encodeByteArray(stringToByteArray$1(e),i)},decodeString(e,i){return this.HAS_NATIVE_SUPPORT&&!i?atob(e):byteArrayToString(this.decodeStringToByteArray(e,i))},decodeStringToByteArray(e,i){this.init_();const s=i?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let _=0;_<e.length;){const et=s[e.charAt(_++)],c=_<e.length?s[e.charAt(_)]:0;++_;const dt=_<e.length?s[e.charAt(_)]:64;++_;const Tt=_<e.length?s[e.charAt(_)]:64;if(++_,et==null||c==null||dt==null||Tt==null)throw new DecodeBase64StringError;const Et=et<<2|c>>4;if(a.push(Et),dt!==64){const At=c<<4&240|dt>>2;if(a.push(At),Tt!==64){const Mt=dt<<6&192|Tt;a.push(Mt)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class DecodeBase64StringError extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const base64Encode=function(e){const i=stringToByteArray$1(e);return base64.encodeByteArray(i,!0)},base64urlEncodeWithoutPadding=function(e){return base64Encode(e).replace(/\./g,"")},base64Decode=function(e){try{return base64.decodeString(e,!0)}catch(i){console.error("base64Decode failed: ",i)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function deepCopy(e){return deepExtend(void 0,e)}function deepExtend(e,i){if(!(i instanceof Object))return i;switch(i.constructor){case Date:const s=i;return new Date(s.getTime());case Object:e===void 0&&(e={});break;case Array:e=[];break;default:return i}for(const s in i)!i.hasOwnProperty(s)||!isValidKey$1(s)||(e[s]=deepExtend(e[s],i[s]));return e}function isValidKey$1(e){return e!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getGlobal(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const getDefaultsFromGlobal=()=>getGlobal().__FIREBASE_DEFAULTS__,getDefaultsFromEnvVariable=()=>{if(typeof process>"u"||typeof define_process_env_default$1>"u")return;const e=define_process_env_default$1.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},getDefaultsFromCookie=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const i=e&&base64Decode(e[1]);return i&&JSON.parse(i)},getDefaults=()=>{try{return getDefaultsFromPostinstall()||getDefaultsFromGlobal()||getDefaultsFromEnvVariable()||getDefaultsFromCookie()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},getDefaultEmulatorHost=e=>{var i,s;return(s=(i=getDefaults())==null?void 0:i.emulatorHosts)==null?void 0:s[e]},getDefaultEmulatorHostnameAndPort=e=>{const i=getDefaultEmulatorHost(e);if(!i)return;const s=i.lastIndexOf(":");if(s<=0||s+1===i.length)throw new Error(`Invalid host ${i} with no separate hostname and port!`);const a=parseInt(i.substring(s+1),10);return i[0]==="["?[i.substring(1,s-1),a]:[i.substring(0,s),a]},getDefaultAppConfig=()=>{var e;return(e=getDefaults())==null?void 0:e.config},getExperimentalSetting=e=>{var i;return(i=getDefaults())==null?void 0:i[`_${e}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Deferred{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((i,s)=>{this.resolve=i,this.reject=s})}wrapCallback(i){return(s,a)=>{s?this.reject(s):this.resolve(a),typeof i=="function"&&(this.promise.catch(()=>{}),i.length===1?i(s):i(s,a))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isCloudWorkstation(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function pingServer(e){return(await fetch(e,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function createMockUserToken(e,i){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},a=i||"demo-project",_=e.iat||0,et=e.sub||e.user_id;if(!et)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const nt={iss:`https://securetoken.google.com/${a}`,aud:a,iat:_,exp:_+3600,auth_time:_,sub:et,user_id:et,firebase:{sign_in_provider:"custom",identities:{}},...e};return[base64urlEncodeWithoutPadding(JSON.stringify(s)),base64urlEncodeWithoutPadding(JSON.stringify(nt)),""].join(".")}const emulatorStatus={};function getEmulatorSummary(){const e={prod:[],emulator:[]};for(const i of Object.keys(emulatorStatus))emulatorStatus[i]?e.emulator.push(i):e.prod.push(i);return e}function getOrCreateEl(e){let i=document.getElementById(e),s=!1;return i||(i=document.createElement("div"),i.setAttribute("id",e),s=!0),{created:s,element:i}}let previouslyDismissed=!1;function updateEmulatorBanner(e,i){if(typeof window>"u"||typeof document>"u"||!isCloudWorkstation(window.location.host)||emulatorStatus[e]===i||emulatorStatus[e]||previouslyDismissed)return;emulatorStatus[e]=i;function s(Et){return`__firebase__banner__${Et}`}const a="__firebase__banner",et=getEmulatorSummary().prod.length>0;function nt(){const Et=document.getElementById(a);Et&&Et.remove()}function c(Et){Et.style.display="flex",Et.style.background="#7faaf0",Et.style.position="fixed",Et.style.bottom="5px",Et.style.left="5px",Et.style.padding=".5em",Et.style.borderRadius="5px",Et.style.alignItems="center"}function ct(Et,At){Et.setAttribute("width","24"),Et.setAttribute("id",At),Et.setAttribute("height","24"),Et.setAttribute("viewBox","0 0 24 24"),Et.setAttribute("fill","none"),Et.style.marginLeft="-6px"}function dt(){const Et=document.createElement("span");return Et.style.cursor="pointer",Et.style.marginLeft="16px",Et.style.fontSize="24px",Et.innerHTML=" &times;",Et.onclick=()=>{previouslyDismissed=!0,nt()},Et}function gt(Et,At){Et.setAttribute("id",At),Et.innerText="Learn more",Et.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",Et.setAttribute("target","__blank"),Et.style.paddingLeft="5px",Et.style.textDecoration="underline"}function Tt(){const Et=getOrCreateEl(a),At=s("text"),Mt=document.getElementById(At)||document.createElement("span"),Pt=s("learnmore"),$t=document.getElementById(Pt)||document.createElement("a"),Lt=s("preprendIcon"),Bt=document.getElementById(Lt)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(Et.created){const Nt=Et.element;c(Nt),gt($t,Pt);const Vt=dt();ct(Bt,Lt),Nt.append(Bt,Mt,$t,Vt),document.body.appendChild(Nt)}et?(Mt.innerText="Preview backend disconnected.",Bt.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(Bt.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,Mt.innerText="Preview backend running in this workspace."),Mt.setAttribute("id",At)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",Tt):Tt()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getUA(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function isMobileCordova(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA())}function isCloudflareWorker(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function isBrowserExtension(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function isReactNative(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function isIE(){const e=getUA();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function isNodeSdk(){return CONSTANTS.NODE_ADMIN===!0}function isIndexedDBAvailable(){try{return typeof indexedDB=="object"}catch{return!1}}function validateIndexedDBOpenable(){return new Promise((e,i)=>{try{let s=!0;const a="validate-browser-context-for-indexeddb-analytics-module",_=self.indexedDB.open(a);_.onsuccess=()=>{_.result.close(),s||self.indexedDB.deleteDatabase(a),e(!0)},_.onupgradeneeded=()=>{s=!1},_.onerror=()=>{var et;i(((et=_.error)==null?void 0:et.message)||"")}}catch(s){i(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERROR_NAME="FirebaseError";class FirebaseError extends Error{constructor(i,s,a){super(s),this.code=i,this.customData=a,this.name=ERROR_NAME,Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}}class ErrorFactory{constructor(i,s,a){this.service=i,this.serviceName=s,this.errors=a}create(i,...s){const a=s[0]||{},_=`${this.service}/${i}`,et=this.errors[i],nt=et?replaceTemplate(et,a):"Error",c=`${this.serviceName}: ${nt} (${_}).`;return new FirebaseError(_,c,a)}}function replaceTemplate(e,i){return e.replace(PATTERN,(s,a)=>{const _=i[a];return _!=null?String(_):`<${a}?>`})}const PATTERN=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jsonEval(e){return JSON.parse(e)}function stringify(e){return JSON.stringify(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const decode=function(e){let i={},s={},a={},_="";try{const et=e.split(".");i=jsonEval(base64Decode(et[0])||""),s=jsonEval(base64Decode(et[1])||""),_=et[2],a=s.d||{},delete s.d}catch{}return{header:i,claims:s,data:a,signature:_}},isValidFormat=function(e){const i=decode(e),s=i.claims;return!!s&&typeof s=="object"&&s.hasOwnProperty("iat")},isAdmin=function(e){const i=decode(e).claims;return typeof i=="object"&&i.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function contains(e,i){return Object.prototype.hasOwnProperty.call(e,i)}function safeGet(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]}function isEmpty(e){for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i))return!1;return!0}function map(e,i,s){const a={};for(const _ in e)Object.prototype.hasOwnProperty.call(e,_)&&(a[_]=i.call(s,e[_],_,e));return a}function deepEqual(e,i){if(e===i)return!0;const s=Object.keys(e),a=Object.keys(i);for(const _ of s){if(!a.includes(_))return!1;const et=e[_],nt=i[_];if(isObject$1(et)&&isObject$1(nt)){if(!deepEqual(et,nt))return!1}else if(et!==nt)return!1}for(const _ of a)if(!s.includes(_))return!1;return!0}function isObject$1(e){return e!==null&&typeof e=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function querystring(e){const i=[];for(const[s,a]of Object.entries(e))Array.isArray(a)?a.forEach(_=>{i.push(encodeURIComponent(s)+"="+encodeURIComponent(_))}):i.push(encodeURIComponent(s)+"="+encodeURIComponent(a));return i.length?"&"+i.join("&"):""}function querystringDecode(e){const i={};return e.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[_,et]=a.split("=");i[decodeURIComponent(_)]=decodeURIComponent(et)}}),i}function extractQuerystring(e){const i=e.indexOf("?");if(!i)return"";const s=e.indexOf("#",i);return e.substring(i,s>0?s:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sha1{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let i=1;i<this.blockSize;++i)this.pad_[i]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(i,s){s||(s=0);const a=this.W_;if(typeof i=="string")for(let Tt=0;Tt<16;Tt++)a[Tt]=i.charCodeAt(s)<<24|i.charCodeAt(s+1)<<16|i.charCodeAt(s+2)<<8|i.charCodeAt(s+3),s+=4;else for(let Tt=0;Tt<16;Tt++)a[Tt]=i[s]<<24|i[s+1]<<16|i[s+2]<<8|i[s+3],s+=4;for(let Tt=16;Tt<80;Tt++){const Et=a[Tt-3]^a[Tt-8]^a[Tt-14]^a[Tt-16];a[Tt]=(Et<<1|Et>>>31)&4294967295}let _=this.chain_[0],et=this.chain_[1],nt=this.chain_[2],c=this.chain_[3],ct=this.chain_[4],dt,gt;for(let Tt=0;Tt<80;Tt++){Tt<40?Tt<20?(dt=c^et&(nt^c),gt=1518500249):(dt=et^nt^c,gt=1859775393):Tt<60?(dt=et&nt|c&(et|nt),gt=2400959708):(dt=et^nt^c,gt=3395469782);const Et=(_<<5|_>>>27)+dt+ct+gt+a[Tt]&4294967295;ct=c,c=nt,nt=(et<<30|et>>>2)&4294967295,et=_,_=Et}this.chain_[0]=this.chain_[0]+_&4294967295,this.chain_[1]=this.chain_[1]+et&4294967295,this.chain_[2]=this.chain_[2]+nt&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+ct&4294967295}update(i,s){if(i==null)return;s===void 0&&(s=i.length);const a=s-this.blockSize;let _=0;const et=this.buf_;let nt=this.inbuf_;for(;_<s;){if(nt===0)for(;_<=a;)this.compress_(i,_),_+=this.blockSize;if(typeof i=="string"){for(;_<s;)if(et[nt]=i.charCodeAt(_),++nt,++_,nt===this.blockSize){this.compress_(et),nt=0;break}}else for(;_<s;)if(et[nt]=i[_],++nt,++_,nt===this.blockSize){this.compress_(et),nt=0;break}}this.inbuf_=nt,this.total_+=s}digest(){const i=[];let s=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let _=this.blockSize-1;_>=56;_--)this.buf_[_]=s&255,s/=256;this.compress_(this.buf_);let a=0;for(let _=0;_<5;_++)for(let et=24;et>=0;et-=8)i[a]=this.chain_[_]>>et&255,++a;return i}}function createSubscribe(e,i){const s=new ObserverProxy(e,i);return s.subscribe.bind(s)}class ObserverProxy{constructor(i,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{i(this)}).catch(a=>{this.error(a)})}next(i){this.forEachObserver(s=>{s.next(i)})}error(i){this.forEachObserver(s=>{s.error(i)}),this.close(i)}complete(){this.forEachObserver(i=>{i.complete()}),this.close()}subscribe(i,s,a){let _;if(i===void 0&&s===void 0&&a===void 0)throw new Error("Missing Observer.");implementsAnyMethods(i,["next","error","complete"])?_=i:_={next:i,error:s,complete:a},_.next===void 0&&(_.next=noop$1),_.error===void 0&&(_.error=noop$1),_.complete===void 0&&(_.complete=noop$1);const et=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?_.error(this.finalError):_.complete()}catch{}}),this.observers.push(_),et}unsubscribeOne(i){this.observers===void 0||this.observers[i]===void 0||(delete this.observers[i],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(i){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,i)}sendOne(i,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[i]!==void 0)try{s(this.observers[i])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(i){this.finalized||(this.finalized=!0,i!==void 0&&(this.finalError=i),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function implementsAnyMethods(e,i){if(typeof e!="object"||e===null)return!1;for(const s of i)if(s in e&&typeof e[s]=="function")return!0;return!1}function noop$1(){}function errorPrefix(e,i){return`${e} failed: ${i} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const stringToByteArray=function(e){const i=[];let s=0;for(let a=0;a<e.length;a++){let _=e.charCodeAt(a);if(_>=55296&&_<=56319){const et=_-55296;a++,assert(a<e.length,"Surrogate pair missing trail surrogate.");const nt=e.charCodeAt(a)-56320;_=65536+(et<<10)+nt}_<128?i[s++]=_:_<2048?(i[s++]=_>>6|192,i[s++]=_&63|128):_<65536?(i[s++]=_>>12|224,i[s++]=_>>6&63|128,i[s++]=_&63|128):(i[s++]=_>>18|240,i[s++]=_>>12&63|128,i[s++]=_>>6&63|128,i[s++]=_&63|128)}return i},stringLength=function(e){let i=0;for(let s=0;s<e.length;s++){const a=e.charCodeAt(s);a<128?i++:a<2048?i+=2:a>=55296&&a<=56319?(i+=4,s++):i+=3}return i};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getModularInstance(e){return e&&e._delegate?e._delegate:e}class Component{constructor(i,s,a){this.name=i,this.instanceFactory=s,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(i){return this.instantiationMode=i,this}setMultipleInstances(i){return this.multipleInstances=i,this}setServiceProps(i){return this.serviceProps=i,this}setInstanceCreatedCallback(i){return this.onInstanceCreated=i,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME$1="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Provider{constructor(i,s){this.name=i,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(i){const s=this.normalizeInstanceIdentifier(i);if(!this.instancesDeferred.has(s)){const a=new Deferred;if(this.instancesDeferred.set(s,a),this.isInitialized(s)||this.shouldAutoInitialize())try{const _=this.getOrInitializeService({instanceIdentifier:s});_&&a.resolve(_)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(i){const s=this.normalizeInstanceIdentifier(i==null?void 0:i.identifier),a=(i==null?void 0:i.optional)??!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(_){if(a)return null;throw _}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(i){if(i.name!==this.name)throw Error(`Mismatching Component ${i.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=i,!!this.shouldAutoInitialize()){if(isComponentEager(i))try{this.getOrInitializeService({instanceIdentifier:DEFAULT_ENTRY_NAME$1})}catch{}for(const[s,a]of this.instancesDeferred.entries()){const _=this.normalizeInstanceIdentifier(s);try{const et=this.getOrInitializeService({instanceIdentifier:_});a.resolve(et)}catch{}}}}clearInstance(i=DEFAULT_ENTRY_NAME$1){this.instancesDeferred.delete(i),this.instancesOptions.delete(i),this.instances.delete(i)}async delete(){const i=Array.from(this.instances.values());await Promise.all([...i.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...i.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(i=DEFAULT_ENTRY_NAME$1){return this.instances.has(i)}getOptions(i=DEFAULT_ENTRY_NAME$1){return this.instancesOptions.get(i)||{}}initialize(i={}){const{options:s={}}=i,a=this.normalizeInstanceIdentifier(i.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const _=this.getOrInitializeService({instanceIdentifier:a,options:s});for(const[et,nt]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(et);a===c&&nt.resolve(_)}return _}onInit(i,s){const a=this.normalizeInstanceIdentifier(s),_=this.onInitCallbacks.get(a)??new Set;_.add(i),this.onInitCallbacks.set(a,_);const et=this.instances.get(a);return et&&i(et,a),()=>{_.delete(i)}}invokeOnInitCallbacks(i,s){const a=this.onInitCallbacks.get(s);if(a)for(const _ of a)try{_(i,s)}catch{}}getOrInitializeService({instanceIdentifier:i,options:s={}}){let a=this.instances.get(i);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:normalizeIdentifierForFactory(i),options:s}),this.instances.set(i,a),this.instancesOptions.set(i,s),this.invokeOnInitCallbacks(a,i),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,i,a)}catch{}return a||null}normalizeInstanceIdentifier(i=DEFAULT_ENTRY_NAME$1){return this.component?this.component.multipleInstances?i:DEFAULT_ENTRY_NAME$1:i}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function normalizeIdentifierForFactory(e){return e===DEFAULT_ENTRY_NAME$1?void 0:e}function isComponentEager(e){return e.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ComponentContainer{constructor(i){this.name=i,this.providers=new Map}addComponent(i){const s=this.getProvider(i.name);if(s.isComponentSet())throw new Error(`Component ${i.name} has already been registered with ${this.name}`);s.setComponent(i)}addOrOverwriteComponent(i){this.getProvider(i.name).isComponentSet()&&this.providers.delete(i.name),this.addComponent(i)}getProvider(i){if(this.providers.has(i))return this.providers.get(i);const s=new Provider(i,this);return this.providers.set(i,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var LogLevel;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(LogLevel||(LogLevel={}));const levelStringToEnum={debug:LogLevel.DEBUG,verbose:LogLevel.VERBOSE,info:LogLevel.INFO,warn:LogLevel.WARN,error:LogLevel.ERROR,silent:LogLevel.SILENT},defaultLogLevel=LogLevel.INFO,ConsoleMethod={[LogLevel.DEBUG]:"log",[LogLevel.VERBOSE]:"log",[LogLevel.INFO]:"info",[LogLevel.WARN]:"warn",[LogLevel.ERROR]:"error"},defaultLogHandler=(e,i,...s)=>{if(i<e.logLevel)return;const a=new Date().toISOString(),_=ConsoleMethod[i];if(_)console[_](`[${a}]  ${e.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${i})`)};class Logger{constructor(i){this.name=i,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(i){if(!(i in LogLevel))throw new TypeError(`Invalid value "${i}" assigned to \`logLevel\``);this._logLevel=i}setLogLevel(i){this._logLevel=typeof i=="string"?levelStringToEnum[i]:i}get logHandler(){return this._logHandler}set logHandler(i){if(typeof i!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=i}get userLogHandler(){return this._userLogHandler}set userLogHandler(i){this._userLogHandler=i}debug(...i){this._userLogHandler&&this._userLogHandler(this,LogLevel.DEBUG,...i),this._logHandler(this,LogLevel.DEBUG,...i)}log(...i){this._userLogHandler&&this._userLogHandler(this,LogLevel.VERBOSE,...i),this._logHandler(this,LogLevel.VERBOSE,...i)}info(...i){this._userLogHandler&&this._userLogHandler(this,LogLevel.INFO,...i),this._logHandler(this,LogLevel.INFO,...i)}warn(...i){this._userLogHandler&&this._userLogHandler(this,LogLevel.WARN,...i),this._logHandler(this,LogLevel.WARN,...i)}error(...i){this._userLogHandler&&this._userLogHandler(this,LogLevel.ERROR,...i),this._logHandler(this,LogLevel.ERROR,...i)}}const instanceOfAny=(e,i)=>i.some(s=>e instanceof s);let idbProxyableTypes,cursorAdvanceMethods;function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const cursorRequestMap=new WeakMap,transactionDoneMap=new WeakMap,transactionStoreNamesMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;function promisifyRequest(e){const i=new Promise((s,a)=>{const _=()=>{e.removeEventListener("success",et),e.removeEventListener("error",nt)},et=()=>{s(wrap(e.result)),_()},nt=()=>{a(e.error),_()};e.addEventListener("success",et),e.addEventListener("error",nt)});return i.then(s=>{s instanceof IDBCursor&&cursorRequestMap.set(s,e)}).catch(()=>{}),reverseTransformCache.set(i,e),i}function cacheDonePromiseForTransaction(e){if(transactionDoneMap.has(e))return;const i=new Promise((s,a)=>{const _=()=>{e.removeEventListener("complete",et),e.removeEventListener("error",nt),e.removeEventListener("abort",nt)},et=()=>{s(),_()},nt=()=>{a(e.error||new DOMException("AbortError","AbortError")),_()};e.addEventListener("complete",et),e.addEventListener("error",nt),e.addEventListener("abort",nt)});transactionDoneMap.set(e,i)}let idbProxyTraps={get(e,i,s){if(e instanceof IDBTransaction){if(i==="done")return transactionDoneMap.get(e);if(i==="objectStoreNames")return e.objectStoreNames||transactionStoreNamesMap.get(e);if(i==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return wrap(e[i])},set(e,i,s){return e[i]=s,!0},has(e,i){return e instanceof IDBTransaction&&(i==="done"||i==="store")?!0:i in e}};function replaceTraps(e){idbProxyTraps=e(idbProxyTraps)}function wrapFunction(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(i,...s){const a=e.call(unwrap(this),i,...s);return transactionStoreNamesMap.set(a,i.sort?i.sort():[i]),wrap(a)}:getCursorAdvanceMethods().includes(e)?function(...i){return e.apply(unwrap(this),i),wrap(cursorRequestMap.get(this))}:function(...i){return wrap(e.apply(unwrap(this),i))}}function transformCachableValue(e){return typeof e=="function"?wrapFunction(e):(e instanceof IDBTransaction&&cacheDonePromiseForTransaction(e),instanceOfAny(e,getIdbProxyableTypes())?new Proxy(e,idbProxyTraps):e)}function wrap(e){if(e instanceof IDBRequest)return promisifyRequest(e);if(transformCache.has(e))return transformCache.get(e);const i=transformCachableValue(e);return i!==e&&(transformCache.set(e,i),reverseTransformCache.set(i,e)),i}const unwrap=e=>reverseTransformCache.get(e);function openDB(e,i,{blocked:s,upgrade:a,blocking:_,terminated:et}={}){const nt=indexedDB.open(e,i),c=wrap(nt);return a&&nt.addEventListener("upgradeneeded",ct=>{a(wrap(nt.result),ct.oldVersion,ct.newVersion,wrap(nt.transaction),ct)}),s&&nt.addEventListener("blocked",ct=>s(ct.oldVersion,ct.newVersion,ct)),c.then(ct=>{et&&ct.addEventListener("close",()=>et()),_&&ct.addEventListener("versionchange",dt=>_(dt.oldVersion,dt.newVersion,dt))}).catch(()=>{}),c}const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(e,i){if(!(e instanceof IDBDatabase&&!(i in e)&&typeof i=="string"))return;if(cachedMethods.get(i))return cachedMethods.get(i);const s=i.replace(/FromIndex$/,""),a=i!==s,_=writeMethods.includes(s);if(!(s in(a?IDBIndex:IDBObjectStore).prototype)||!(_||readMethods.includes(s)))return;const et=async function(nt,...c){const ct=this.transaction(nt,_?"readwrite":"readonly");let dt=ct.store;return a&&(dt=dt.index(c.shift())),(await Promise.all([dt[s](...c),_&&ct.done]))[0]};return cachedMethods.set(i,et),et}replaceTraps(e=>({...e,get:(i,s,a)=>getMethod(i,s)||e.get(i,s,a),has:(i,s)=>!!getMethod(i,s)||e.has(i,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PlatformLoggerServiceImpl{constructor(i){this.container=i}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(isVersionServiceProvider(s)){const a=s.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(s=>s).join(" ")}}function isVersionServiceProvider(e){const i=e.getComponent();return(i==null?void 0:i.type)==="VERSION"}const name$q="@firebase/app",version$1$1="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logger$1=new Logger("@firebase/app"),name$p="@firebase/app-compat",name$o="@firebase/analytics-compat",name$n="@firebase/analytics",name$m="@firebase/app-check-compat",name$l="@firebase/app-check",name$k="@firebase/auth",name$j="@firebase/auth-compat",name$i="@firebase/database",name$h="@firebase/data-connect",name$g="@firebase/database-compat",name$f="@firebase/functions",name$e="@firebase/functions-compat",name$d="@firebase/installations",name$c="@firebase/installations-compat",name$b="@firebase/messaging",name$a="@firebase/messaging-compat",name$9="@firebase/performance",name$8="@firebase/performance-compat",name$7="@firebase/remote-config",name$6="@firebase/remote-config-compat",name$5="@firebase/storage",name$4="@firebase/storage-compat",name$3$1="@firebase/firestore",name$2$1="@firebase/ai",name$1$1="@firebase/firestore-compat",name$r="firebase",version$4="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME="[DEFAULT]",PLATFORM_LOG_STRING={[name$q]:"fire-core",[name$p]:"fire-core-compat",[name$n]:"fire-analytics",[name$o]:"fire-analytics-compat",[name$l]:"fire-app-check",[name$m]:"fire-app-check-compat",[name$k]:"fire-auth",[name$j]:"fire-auth-compat",[name$i]:"fire-rtdb",[name$h]:"fire-data-connect",[name$g]:"fire-rtdb-compat",[name$f]:"fire-fn",[name$e]:"fire-fn-compat",[name$d]:"fire-iid",[name$c]:"fire-iid-compat",[name$b]:"fire-fcm",[name$a]:"fire-fcm-compat",[name$9]:"fire-perf",[name$8]:"fire-perf-compat",[name$7]:"fire-rc",[name$6]:"fire-rc-compat",[name$5]:"fire-gcs",[name$4]:"fire-gcs-compat",[name$3$1]:"fire-fst",[name$1$1]:"fire-fst-compat",[name$2$1]:"fire-vertex","fire-js":"fire-js",[name$r]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _apps=new Map,_serverApps=new Map,_components=new Map;function _addComponent(e,i){try{e.container.addComponent(i)}catch(s){logger$1.debug(`Component ${i.name} failed to register with FirebaseApp ${e.name}`,s)}}function _registerComponent(e){const i=e.name;if(_components.has(i))return logger$1.debug(`There were multiple attempts to register component ${i}.`),!1;_components.set(i,e);for(const s of _apps.values())_addComponent(s,e);for(const s of _serverApps.values())_addComponent(s,e);return!0}function _getProvider(e,i){const s=e.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),e.container.getProvider(i)}function _isFirebaseServerApp(e){return e==null?!1:e.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERRORS={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ERROR_FACTORY=new ErrorFactory("app","Firebase",ERRORS);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FirebaseAppImpl{constructor(i,s,a){this._isDeleted=!1,this._options={...i},this._config={...s},this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Component("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(i){this.checkDestroyed(),this._automaticDataCollectionEnabled=i}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(i){this._isDeleted=i}checkDestroyed(){if(this.isDeleted)throw ERROR_FACTORY.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SDK_VERSION$1=version$4;function initializeApp(e,i={}){let s=e;typeof i!="object"&&(i={name:i});const a={name:DEFAULT_ENTRY_NAME,automaticDataCollectionEnabled:!0,...i},_=a.name;if(typeof _!="string"||!_)throw ERROR_FACTORY.create("bad-app-name",{appName:String(_)});if(s||(s=getDefaultAppConfig()),!s)throw ERROR_FACTORY.create("no-options");const et=_apps.get(_);if(et){if(deepEqual(s,et.options)&&deepEqual(a,et.config))return et;throw ERROR_FACTORY.create("duplicate-app",{appName:_})}const nt=new ComponentContainer(_);for(const ct of _components.values())nt.addComponent(ct);const c=new FirebaseAppImpl(s,a,nt);return _apps.set(_,c),c}function getApp(e=DEFAULT_ENTRY_NAME){const i=_apps.get(e);if(!i&&e===DEFAULT_ENTRY_NAME&&getDefaultAppConfig())return initializeApp();if(!i)throw ERROR_FACTORY.create("no-app",{appName:e});return i}function registerVersion(e,i,s){let a=PLATFORM_LOG_STRING[e]??e;s&&(a+=`-${s}`);const _=a.match(/\s|\//),et=i.match(/\s|\//);if(_||et){const nt=[`Unable to register library "${a}" with version "${i}":`];_&&nt.push(`library name "${a}" contains illegal characters (whitespace or "/")`),_&&et&&nt.push("and"),et&&nt.push(`version name "${i}" contains illegal characters (whitespace or "/")`),logger$1.warn(nt.join(" "));return}_registerComponent(new Component(`${a}-version`,()=>({library:a,version:i}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DB_NAME$1="firebase-heartbeat-database",DB_VERSION$1=1,STORE_NAME="firebase-heartbeat-store";let dbPromise=null;function getDbPromise(){return dbPromise||(dbPromise=openDB(DB_NAME$1,DB_VERSION$1,{upgrade:(e,i)=>{switch(i){case 0:try{e.createObjectStore(STORE_NAME)}catch(s){console.warn(s)}}}}).catch(e=>{throw ERROR_FACTORY.create("idb-open",{originalErrorMessage:e.message})})),dbPromise}async function readHeartbeatsFromIndexedDB(e){try{const s=(await getDbPromise()).transaction(STORE_NAME),a=await s.objectStore(STORE_NAME).get(computeKey(e));return await s.done,a}catch(i){if(i instanceof FirebaseError)logger$1.warn(i.message);else{const s=ERROR_FACTORY.create("idb-get",{originalErrorMessage:i==null?void 0:i.message});logger$1.warn(s.message)}}}async function writeHeartbeatsToIndexedDB(e,i){try{const a=(await getDbPromise()).transaction(STORE_NAME,"readwrite");await a.objectStore(STORE_NAME).put(i,computeKey(e)),await a.done}catch(s){if(s instanceof FirebaseError)logger$1.warn(s.message);else{const a=ERROR_FACTORY.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});logger$1.warn(a.message)}}}function computeKey(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MAX_HEADER_BYTES=1024,MAX_NUM_STORED_HEARTBEATS=30;class HeartbeatServiceImpl{constructor(i){this.container=i,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new HeartbeatStorageImpl(s),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var i,s;try{const _=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),et=getUTCDateString();if(((i=this._heartbeatsCache)==null?void 0:i.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)==null?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===et||this._heartbeatsCache.heartbeats.some(nt=>nt.date===et))return;if(this._heartbeatsCache.heartbeats.push({date:et,agent:_}),this._heartbeatsCache.heartbeats.length>MAX_NUM_STORED_HEARTBEATS){const nt=getEarliestHeartbeatIdx(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(nt,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){logger$1.warn(a)}}async getHeartbeatsHeader(){var i;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((i=this._heartbeatsCache)==null?void 0:i.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=getUTCDateString(),{heartbeatsToSend:a,unsentEntries:_}=extractHeartbeatsForHeader(this._heartbeatsCache.heartbeats),et=base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=s,_.length>0?(this._heartbeatsCache.heartbeats=_,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),et}catch(s){return logger$1.warn(s),""}}}function getUTCDateString(){return new Date().toISOString().substring(0,10)}function extractHeartbeatsForHeader(e,i=MAX_HEADER_BYTES){const s=[];let a=e.slice();for(const _ of e){const et=s.find(nt=>nt.agent===_.agent);if(et){if(et.dates.push(_.date),countBytes(s)>i){et.dates.pop();break}}else if(s.push({agent:_.agent,dates:[_.date]}),countBytes(s)>i){s.pop();break}a=a.slice(1)}return{heartbeatsToSend:s,unsentEntries:a}}class HeartbeatStorageImpl{constructor(i){this.app=i,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return isIndexedDBAvailable()?validateIndexedDBOpenable().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await readHeartbeatsFromIndexedDB(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(i){if(await this._canUseIndexedDBPromise){const a=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:i.lastSentHeartbeatDate??a.lastSentHeartbeatDate,heartbeats:i.heartbeats})}else return}async add(i){if(await this._canUseIndexedDBPromise){const a=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:i.lastSentHeartbeatDate??a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...i.heartbeats]})}else return}}function countBytes(e){return base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:e})).length}function getEarliestHeartbeatIdx(e){if(e.length===0)return-1;let i=0,s=e[0].date;for(let a=1;a<e.length;a++)e[a].date<s&&(s=e[a].date,i=a);return i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function registerCoreComponents(e){_registerComponent(new Component("platform-logger",i=>new PlatformLoggerServiceImpl(i),"PRIVATE")),_registerComponent(new Component("heartbeat",i=>new HeartbeatServiceImpl(i),"PRIVATE")),registerVersion(name$q,version$1$1,e),registerVersion(name$q,version$1$1,"esm2020"),registerVersion("fire-js","")}registerCoreComponents("");function _prodErrorMap(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const prodErrorMap=_prodErrorMap,_DEFAULT_AUTH_ERROR_FACTORY=new ErrorFactory("auth","Firebase",_prodErrorMap());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logClient$1=new Logger("@firebase/auth");function _logWarn(e,...i){logClient$1.logLevel<=LogLevel.WARN&&logClient$1.warn(`Auth (${SDK_VERSION$1}): ${e}`,...i)}function _logError(e,...i){logClient$1.logLevel<=LogLevel.ERROR&&logClient$1.error(`Auth (${SDK_VERSION$1}): ${e}`,...i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _fail(e,...i){throw createErrorInternal(e,...i)}function _createError(e,...i){return createErrorInternal(e,...i)}function _errorWithCustomMessage(e,i,s){const a={...prodErrorMap(),[i]:s};return new ErrorFactory("auth","Firebase",a).create(i,{appName:e.name})}function _serverAppCurrentUserOperationNotSupportedError(e){return _errorWithCustomMessage(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function createErrorInternal(e,...i){if(typeof e!="string"){const s=i[0],a=[...i.slice(1)];return a[0]&&(a[0].appName=e.name),e._errorFactory.create(s,...a)}return _DEFAULT_AUTH_ERROR_FACTORY.create(e,...i)}function _assert(e,i,...s){if(!e)throw createErrorInternal(i,...s)}function debugFail(e){const i="INTERNAL ASSERTION FAILED: "+e;throw _logError(i),new Error(i)}function debugAssert(e,i){e||debugFail(i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _getCurrentUrl(){var e;return typeof self<"u"&&((e=self.location)==null?void 0:e.href)||""}function _isHttpOrHttps(){return _getCurrentScheme()==="http:"||_getCurrentScheme()==="https:"}function _getCurrentScheme(){var e;return typeof self<"u"&&((e=self.location)==null?void 0:e.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _isOnline(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(_isHttpOrHttps()||isBrowserExtension()||"connection"in navigator)?navigator.onLine:!0}function _getUserLanguage(){if(typeof navigator>"u")return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Delay{constructor(i,s){this.shortDelay=i,this.longDelay=s,debugAssert(s>i,"Short delay should be less than long delay!"),this.isMobile=isMobileCordova()||isReactNative()}get(){return _isOnline()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _emulatorUrl(e,i){debugAssert(e.emulator,"Emulator should always be set here");const{url:s}=e.emulator;return i?`${s}${i.startsWith("/")?i.slice(1):i}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FetchProvider{static initialize(i,s,a){this.fetchImpl=i,s&&(this.headersImpl=s),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;debugFail("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;debugFail("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;debugFail("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SERVER_ERROR_MAP={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CookieAuthProxiedEndpoints=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],DEFAULT_API_TIMEOUT_MS=new Delay(3e4,6e4);function _addTidIfNecessary(e,i){return e.tenantId&&!i.tenantId?{...i,tenantId:e.tenantId}:i}async function _performApiRequest(e,i,s,a,_={}){return _performFetchWithErrorHandling(e,_,async()=>{let et={},nt={};a&&(i==="GET"?nt=a:et={body:JSON.stringify(a)});const c=querystring({key:e.config.apiKey,...nt}).slice(1),ct=await e._getAdditionalHeaders();ct["Content-Type"]="application/json",e.languageCode&&(ct["X-Firebase-Locale"]=e.languageCode);const dt={method:i,headers:ct,...et};return isCloudflareWorker()||(dt.referrerPolicy="no-referrer"),e.emulatorConfig&&isCloudWorkstation(e.emulatorConfig.host)&&(dt.credentials="include"),FetchProvider.fetch()(await _getFinalTarget(e,e.config.apiHost,s,c),dt)})}async function _performFetchWithErrorHandling(e,i,s){e._canInitEmulator=!1;const a={...SERVER_ERROR_MAP,...i};try{const _=new NetworkTimeout(e),et=await Promise.race([s(),_.promise]);_.clearNetworkTimeout();const nt=await et.json();if("needConfirmation"in nt)throw _makeTaggedError(e,"account-exists-with-different-credential",nt);if(et.ok&&!("errorMessage"in nt))return nt;{const c=et.ok?nt.errorMessage:nt.error.message,[ct,dt]=c.split(" : ");if(ct==="FEDERATED_USER_ID_ALREADY_LINKED")throw _makeTaggedError(e,"credential-already-in-use",nt);if(ct==="EMAIL_EXISTS")throw _makeTaggedError(e,"email-already-in-use",nt);if(ct==="USER_DISABLED")throw _makeTaggedError(e,"user-disabled",nt);const gt=a[ct]||ct.toLowerCase().replace(/[_\s]+/g,"-");if(dt)throw _errorWithCustomMessage(e,gt,dt);_fail(e,gt)}}catch(_){if(_ instanceof FirebaseError)throw _;_fail(e,"network-request-failed",{message:String(_)})}}async function _performSignInRequest(e,i,s,a,_={}){const et=await _performApiRequest(e,i,s,a,_);return"mfaPendingCredential"in et&&_fail(e,"multi-factor-auth-required",{_serverResponse:et}),et}async function _getFinalTarget(e,i,s,a){const _=`${i}${s}?${a}`,et=e,nt=et.config.emulator?_emulatorUrl(e.config,_):`${e.config.apiScheme}://${_}`;return CookieAuthProxiedEndpoints.includes(s)&&(await et._persistenceManagerAvailable,et._getPersistenceType()==="COOKIE")?et._getPersistence()._getFinalTarget(nt).toString():nt}function _parseEnforcementState(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class NetworkTimeout{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(i){this.auth=i,this.timer=null,this.promise=new Promise((s,a)=>{this.timer=setTimeout(()=>a(_createError(this.auth,"network-request-failed")),DEFAULT_API_TIMEOUT_MS.get())})}}function _makeTaggedError(e,i,s){const a={appName:e.name};s.email&&(a.email=s.email),s.phoneNumber&&(a.phoneNumber=s.phoneNumber);const _=_createError(e,i,a);return _.customData._tokenResponse=s,_}function isEnterprise(e){return e!==void 0&&e.enterprise!==void 0}class RecaptchaConfig{constructor(i){if(this.siteKey="",this.recaptchaEnforcementState=[],i.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=i.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=i.recaptchaEnforcementState}getProviderEnforcementState(i){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===i)return _parseEnforcementState(s.enforcementState);return null}isProviderEnabled(i){return this.getProviderEnforcementState(i)==="ENFORCE"||this.getProviderEnforcementState(i)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function getRecaptchaConfig(e,i){return _performApiRequest(e,"GET","/v2/recaptchaConfig",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function deleteAccount(e,i){return _performApiRequest(e,"POST","/v1/accounts:delete",i)}async function getAccountInfo(e,i){return _performApiRequest(e,"POST","/v1/accounts:lookup",i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function utcTimestampToDateString(e){if(e)try{const i=new Date(Number(e));if(!isNaN(i.getTime()))return i.toUTCString()}catch{}}async function getIdTokenResult(e,i=!1){const s=getModularInstance(e),a=await s.getIdToken(i),_=_parseToken(a);_assert(_&&_.exp&&_.auth_time&&_.iat,s.auth,"internal-error");const et=typeof _.firebase=="object"?_.firebase:void 0,nt=et==null?void 0:et.sign_in_provider;return{claims:_,token:a,authTime:utcTimestampToDateString(secondsStringToMilliseconds(_.auth_time)),issuedAtTime:utcTimestampToDateString(secondsStringToMilliseconds(_.iat)),expirationTime:utcTimestampToDateString(secondsStringToMilliseconds(_.exp)),signInProvider:nt||null,signInSecondFactor:(et==null?void 0:et.sign_in_second_factor)||null}}function secondsStringToMilliseconds(e){return Number(e)*1e3}function _parseToken(e){const[i,s,a]=e.split(".");if(i===void 0||s===void 0||a===void 0)return _logError("JWT malformed, contained fewer than 3 sections"),null;try{const _=base64Decode(s);return _?JSON.parse(_):(_logError("Failed to decode base64 JWT payload"),null)}catch(_){return _logError("Caught error parsing JWT payload as JSON",_==null?void 0:_.toString()),null}}function _tokenExpiresIn(e){const i=_parseToken(e);return _assert(i,"internal-error"),_assert(typeof i.exp<"u","internal-error"),_assert(typeof i.iat<"u","internal-error"),Number(i.exp)-Number(i.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _logoutIfInvalidated(e,i,s=!1){if(s)return i;try{return await i}catch(a){throw a instanceof FirebaseError&&isUserInvalidated(a)&&e.auth.currentUser===e&&await e.auth.signOut(),a}}function isUserInvalidated({code:e}){return e==="auth/user-disabled"||e==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ProactiveRefresh{constructor(i){this.user=i,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(i){if(i){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const a=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,a)}}schedule(i=!1){if(!this.isRunning)return;const s=this.getInterval(i);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(i){(i==null?void 0:i.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UserMetadata{constructor(i,s){this.createdAt=i,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=utcTimestampToDateString(this.lastLoginAt),this.creationTime=utcTimestampToDateString(this.createdAt)}_copy(i){this.createdAt=i.createdAt,this.lastLoginAt=i.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _reloadWithoutSaving(e){var Tt;const i=e.auth,s=await e.getIdToken(),a=await _logoutIfInvalidated(e,getAccountInfo(i,{idToken:s}));_assert(a==null?void 0:a.users.length,i,"internal-error");const _=a.users[0];e._notifyReloadListener(_);const et=(Tt=_.providerUserInfo)!=null&&Tt.length?extractProviderData(_.providerUserInfo):[],nt=mergeProviderData(e.providerData,et),c=e.isAnonymous,ct=!(e.email&&_.passwordHash)&&!(nt!=null&&nt.length),dt=c?ct:!1,gt={uid:_.localId,displayName:_.displayName||null,photoURL:_.photoUrl||null,email:_.email||null,emailVerified:_.emailVerified||!1,phoneNumber:_.phoneNumber||null,tenantId:_.tenantId||null,providerData:nt,metadata:new UserMetadata(_.createdAt,_.lastLoginAt),isAnonymous:dt};Object.assign(e,gt)}async function reload(e){const i=getModularInstance(e);await _reloadWithoutSaving(i),await i.auth._persistUserIfCurrent(i),i.auth._notifyListenersIfCurrent(i)}function mergeProviderData(e,i){return[...e.filter(a=>!i.some(_=>_.providerId===a.providerId)),...i]}function extractProviderData(e){return e.map(({providerId:i,...s})=>({providerId:i,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function requestStsToken(e,i){const s=await _performFetchWithErrorHandling(e,{},async()=>{const a=querystring({grant_type:"refresh_token",refresh_token:i}).slice(1),{tokenApiHost:_,apiKey:et}=e.config,nt=await _getFinalTarget(e,_,"/v1/token",`key=${et}`),c=await e._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";const ct={method:"POST",headers:c,body:a};return e.emulatorConfig&&isCloudWorkstation(e.emulatorConfig.host)&&(ct.credentials="include"),FetchProvider.fetch()(nt,ct)});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function revokeToken(e,i){return _performApiRequest(e,"POST","/v2/accounts:revokeToken",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StsTokenManager{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(i){_assert(i.idToken,"internal-error"),_assert(typeof i.idToken<"u","internal-error"),_assert(typeof i.refreshToken<"u","internal-error");const s="expiresIn"in i&&typeof i.expiresIn<"u"?Number(i.expiresIn):_tokenExpiresIn(i.idToken);this.updateTokensAndExpiration(i.idToken,i.refreshToken,s)}updateFromIdToken(i){_assert(i.length!==0,"internal-error");const s=_tokenExpiresIn(i);this.updateTokensAndExpiration(i,null,s)}async getToken(i,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(_assert(this.refreshToken,i,"user-token-expired"),this.refreshToken?(await this.refresh(i,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(i,s){const{accessToken:a,refreshToken:_,expiresIn:et}=await requestStsToken(i,s);this.updateTokensAndExpiration(a,_,Number(et))}updateTokensAndExpiration(i,s,a){this.refreshToken=s||null,this.accessToken=i||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(i,s){const{refreshToken:a,accessToken:_,expirationTime:et}=s,nt=new StsTokenManager;return a&&(_assert(typeof a=="string","internal-error",{appName:i}),nt.refreshToken=a),_&&(_assert(typeof _=="string","internal-error",{appName:i}),nt.accessToken=_),et&&(_assert(typeof et=="number","internal-error",{appName:i}),nt.expirationTime=et),nt}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(i){this.accessToken=i.accessToken,this.refreshToken=i.refreshToken,this.expirationTime=i.expirationTime}_clone(){return Object.assign(new StsTokenManager,this.toJSON())}_performRefresh(){return debugFail("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function assertStringOrUndefined(e,i){_assert(typeof e=="string"||typeof e>"u","internal-error",{appName:i})}class UserImpl{constructor({uid:i,auth:s,stsTokenManager:a,..._}){this.providerId="firebase",this.proactiveRefresh=new ProactiveRefresh(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=s,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=_.displayName||null,this.email=_.email||null,this.emailVerified=_.emailVerified||!1,this.phoneNumber=_.phoneNumber||null,this.photoURL=_.photoURL||null,this.isAnonymous=_.isAnonymous||!1,this.tenantId=_.tenantId||null,this.providerData=_.providerData?[..._.providerData]:[],this.metadata=new UserMetadata(_.createdAt||void 0,_.lastLoginAt||void 0)}async getIdToken(i){const s=await _logoutIfInvalidated(this,this.stsTokenManager.getToken(this.auth,i));return _assert(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(i){return getIdTokenResult(this,i)}reload(){return reload(this)}_assign(i){this!==i&&(_assert(this.uid===i.uid,this.auth,"internal-error"),this.displayName=i.displayName,this.photoURL=i.photoURL,this.email=i.email,this.emailVerified=i.emailVerified,this.phoneNumber=i.phoneNumber,this.isAnonymous=i.isAnonymous,this.tenantId=i.tenantId,this.providerData=i.providerData.map(s=>({...s})),this.metadata._copy(i.metadata),this.stsTokenManager._assign(i.stsTokenManager))}_clone(i){const s=new UserImpl({...this,auth:i,stsTokenManager:this.stsTokenManager._clone()});return s.metadata._copy(this.metadata),s}_onReload(i){_assert(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=i,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(i){this.reloadListener?this.reloadListener(i):this.reloadUserInfo=i}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(i,s=!1){let a=!1;i.idToken&&i.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(i),a=!0),s&&await _reloadWithoutSaving(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(_isFirebaseServerApp(this.auth.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this.auth));const i=await this.getIdToken();return await _logoutIfInvalidated(this,deleteAccount(this.auth,{idToken:i})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(i=>({...i})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(i,s){const a=s.displayName??void 0,_=s.email??void 0,et=s.phoneNumber??void 0,nt=s.photoURL??void 0,c=s.tenantId??void 0,ct=s._redirectEventId??void 0,dt=s.createdAt??void 0,gt=s.lastLoginAt??void 0,{uid:Tt,emailVerified:Et,isAnonymous:At,providerData:Mt,stsTokenManager:Pt}=s;_assert(Tt&&Pt,i,"internal-error");const $t=StsTokenManager.fromJSON(this.name,Pt);_assert(typeof Tt=="string",i,"internal-error"),assertStringOrUndefined(a,i.name),assertStringOrUndefined(_,i.name),_assert(typeof Et=="boolean",i,"internal-error"),_assert(typeof At=="boolean",i,"internal-error"),assertStringOrUndefined(et,i.name),assertStringOrUndefined(nt,i.name),assertStringOrUndefined(c,i.name),assertStringOrUndefined(ct,i.name),assertStringOrUndefined(dt,i.name),assertStringOrUndefined(gt,i.name);const Lt=new UserImpl({uid:Tt,auth:i,email:_,emailVerified:Et,displayName:a,isAnonymous:At,photoURL:nt,phoneNumber:et,tenantId:c,stsTokenManager:$t,createdAt:dt,lastLoginAt:gt});return Mt&&Array.isArray(Mt)&&(Lt.providerData=Mt.map(Bt=>({...Bt}))),ct&&(Lt._redirectEventId=ct),Lt}static async _fromIdTokenResponse(i,s,a=!1){const _=new StsTokenManager;_.updateFromServerResponse(s);const et=new UserImpl({uid:s.localId,auth:i,stsTokenManager:_,isAnonymous:a});return await _reloadWithoutSaving(et),et}static async _fromGetAccountInfoResponse(i,s,a){const _=s.users[0];_assert(_.localId!==void 0,"internal-error");const et=_.providerUserInfo!==void 0?extractProviderData(_.providerUserInfo):[],nt=!(_.email&&_.passwordHash)&&!(et!=null&&et.length),c=new StsTokenManager;c.updateFromIdToken(a);const ct=new UserImpl({uid:_.localId,auth:i,stsTokenManager:c,isAnonymous:nt}),dt={uid:_.localId,displayName:_.displayName||null,photoURL:_.photoUrl||null,email:_.email||null,emailVerified:_.emailVerified||!1,phoneNumber:_.phoneNumber||null,tenantId:_.tenantId||null,providerData:et,metadata:new UserMetadata(_.createdAt,_.lastLoginAt),isAnonymous:!(_.email&&_.passwordHash)&&!(et!=null&&et.length)};return Object.assign(ct,dt),ct}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const instanceCache=new Map;function _getInstance(e){debugAssert(e instanceof Function,"Expected a class definition");let i=instanceCache.get(e);return i?(debugAssert(i instanceof e,"Instance stored in cache mismatched with class"),i):(i=new e,instanceCache.set(e,i),i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class InMemoryPersistence{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(i,s){this.storage[i]=s}async _get(i){const s=this.storage[i];return s===void 0?null:s}async _remove(i){delete this.storage[i]}_addListener(i,s){}_removeListener(i,s){}}InMemoryPersistence.type="NONE";const inMemoryPersistence=InMemoryPersistence;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _persistenceKeyName(e,i,s){return`firebase:${e}:${i}:${s}`}class PersistenceUserManager{constructor(i,s,a){this.persistence=i,this.auth=s,this.userKey=a;const{config:_,name:et}=this.auth;this.fullUserKey=_persistenceKeyName(this.userKey,_.apiKey,et),this.fullPersistenceKey=_persistenceKeyName("persistence",_.apiKey,et),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(i){return this.persistence._set(this.fullUserKey,i.toJSON())}async getCurrentUser(){const i=await this.persistence._get(this.fullUserKey);if(!i)return null;if(typeof i=="string"){const s=await getAccountInfo(this.auth,{idToken:i}).catch(()=>{});return s?UserImpl._fromGetAccountInfoResponse(this.auth,s,i):null}return UserImpl._fromJSON(this.auth,i)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(i){if(this.persistence===i)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=i,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(i,s,a="authUser"){if(!s.length)return new PersistenceUserManager(_getInstance(inMemoryPersistence),i,a);const _=(await Promise.all(s.map(async dt=>{if(await dt._isAvailable())return dt}))).filter(dt=>dt);let et=_[0]||_getInstance(inMemoryPersistence);const nt=_persistenceKeyName(a,i.config.apiKey,i.name);let c=null;for(const dt of s)try{const gt=await dt._get(nt);if(gt){let Tt;if(typeof gt=="string"){const Et=await getAccountInfo(i,{idToken:gt}).catch(()=>{});if(!Et)break;Tt=await UserImpl._fromGetAccountInfoResponse(i,Et,gt)}else Tt=UserImpl._fromJSON(i,gt);dt!==et&&(c=Tt),et=dt;break}}catch{}const ct=_.filter(dt=>dt._shouldAllowMigration);return!et._shouldAllowMigration||!ct.length?new PersistenceUserManager(et,i,a):(et=ct[0],c&&await et._set(nt,c.toJSON()),await Promise.all(s.map(async dt=>{if(dt!==et)try{await dt._remove(nt)}catch{}})),new PersistenceUserManager(et,i,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _getBrowserName(e){const i=e.toLowerCase();if(i.includes("opera/")||i.includes("opr/")||i.includes("opios/"))return"Opera";if(_isIEMobile(i))return"IEMobile";if(i.includes("msie")||i.includes("trident/"))return"IE";if(i.includes("edge/"))return"Edge";if(_isFirefox(i))return"Firefox";if(i.includes("silk/"))return"Silk";if(_isBlackBerry(i))return"Blackberry";if(_isWebOS(i))return"Webos";if(_isSafari(i))return"Safari";if((i.includes("chrome/")||_isChromeIOS(i))&&!i.includes("edge/"))return"Chrome";if(_isAndroid(i))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=e.match(s);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function _isFirefox(e=getUA()){return/firefox\//i.test(e)}function _isSafari(e=getUA()){const i=e.toLowerCase();return i.includes("safari/")&&!i.includes("chrome/")&&!i.includes("crios/")&&!i.includes("android")}function _isChromeIOS(e=getUA()){return/crios\//i.test(e)}function _isIEMobile(e=getUA()){return/iemobile/i.test(e)}function _isAndroid(e=getUA()){return/android/i.test(e)}function _isBlackBerry(e=getUA()){return/blackberry/i.test(e)}function _isWebOS(e=getUA()){return/webos/i.test(e)}function _isIOS(e=getUA()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function _isIOSStandalone(e=getUA()){var i;return _isIOS(e)&&!!((i=window.navigator)!=null&&i.standalone)}function _isIE10(){return isIE()&&document.documentMode===10}function _isMobileBrowser(e=getUA()){return _isIOS(e)||_isAndroid(e)||_isWebOS(e)||_isBlackBerry(e)||/windows phone/i.test(e)||_isIEMobile(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _getClientVersion(e,i=[]){let s;switch(e){case"Browser":s=_getBrowserName(getUA());break;case"Worker":s=`${_getBrowserName(getUA())}-${e}`;break;default:s=e}const a=i.length?i.join(","):"FirebaseCore-web";return`${s}/JsCore/${SDK_VERSION$1}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AuthMiddlewareQueue{constructor(i){this.auth=i,this.queue=[]}pushCallback(i,s){const a=et=>new Promise((nt,c)=>{try{const ct=i(et);nt(ct)}catch(ct){c(ct)}});a.onAbort=s,this.queue.push(a);const _=this.queue.length-1;return()=>{this.queue[_]=()=>Promise.resolve()}}async runMiddleware(i){if(this.auth.currentUser===i)return;const s=[];try{for(const a of this.queue)await a(i),a.onAbort&&s.push(a.onAbort)}catch(a){s.reverse();for(const _ of s)try{_()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _getPasswordPolicy(e,i={}){return _performApiRequest(e,"GET","/v2/passwordPolicy",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MINIMUM_MIN_PASSWORD_LENGTH=6;class PasswordPolicyImpl{constructor(i){var a;const s=i.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=s.minPasswordLength??MINIMUM_MIN_PASSWORD_LENGTH,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),s.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),s.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),s.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),s.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=i.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((a=i.allowedNonAlphanumericCharacters)==null?void 0:a.join(""))??"",this.forceUpgradeOnSignin=i.forceUpgradeOnSignin??!1,this.schemaVersion=i.schemaVersion}validatePassword(i){const s={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(i,s),this.validatePasswordCharacterOptions(i,s),s.isValid&&(s.isValid=s.meetsMinPasswordLength??!0),s.isValid&&(s.isValid=s.meetsMaxPasswordLength??!0),s.isValid&&(s.isValid=s.containsLowercaseLetter??!0),s.isValid&&(s.isValid=s.containsUppercaseLetter??!0),s.isValid&&(s.isValid=s.containsNumericCharacter??!0),s.isValid&&(s.isValid=s.containsNonAlphanumericCharacter??!0),s}validatePasswordLengthOptions(i,s){const a=this.customStrengthOptions.minPasswordLength,_=this.customStrengthOptions.maxPasswordLength;a&&(s.meetsMinPasswordLength=i.length>=a),_&&(s.meetsMaxPasswordLength=i.length<=_)}validatePasswordCharacterOptions(i,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let a;for(let _=0;_<i.length;_++)a=i.charAt(_),this.updatePasswordCharacterOptionsStatuses(s,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(i,s,a,_,et){this.customStrengthOptions.containsLowercaseLetter&&(i.containsLowercaseLetter||(i.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(i.containsUppercaseLetter||(i.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(i.containsNumericCharacter||(i.containsNumericCharacter=_)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(i.containsNonAlphanumericCharacter||(i.containsNonAlphanumericCharacter=et))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AuthImpl{constructor(i,s,a,_){this.app=i,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=a,this.config=_,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Subscription(this),this.idTokenSubscription=new Subscription(this),this.beforeStateQueue=new AuthMiddlewareQueue(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=_DEFAULT_AUTH_ERROR_FACTORY,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=i.name,this.clientVersion=_.sdkClientVersion,this._persistenceManagerAvailable=new Promise(et=>this._resolvePersistenceManagerAvailable=et)}_initializeWithPersistence(i,s){return s&&(this._popupRedirectResolver=_getInstance(s)),this._initializationPromise=this.queue(async()=>{var a,_,et;if(!this._deleted&&(this.persistenceManager=await PersistenceUserManager.create(this,i),(a=this._resolvePersistenceManagerAvailable)==null||a.call(this),!this._deleted)){if((_=this._popupRedirectResolver)!=null&&_._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((et=this.currentUser)==null?void 0:et.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const i=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!i)){if(this.currentUser&&i&&this.currentUser.uid===i.uid){this._currentUser._assign(i),await this.currentUser.getIdToken();return}await this._updateCurrentUser(i,!0)}}async initializeCurrentUserFromIdToken(i){try{const s=await getAccountInfo(this,{idToken:i}),a=await UserImpl._fromGetAccountInfoResponse(this,s,i);await this.directlySetCurrentUser(a)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(i){var et;if(_isFirebaseServerApp(this.app)){const nt=this.app.settings.authIdToken;return nt?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(nt).then(c,c))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let a=s,_=!1;if(i&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const nt=(et=this.redirectUser)==null?void 0:et._redirectEventId,c=a==null?void 0:a._redirectEventId,ct=await this.tryRedirectSignIn(i);(!nt||nt===c)&&(ct!=null&&ct.user)&&(a=ct.user,_=!0)}if(!a)return this.directlySetCurrentUser(null);if(!a._redirectEventId){if(_)try{await this.beforeStateQueue.runMiddleware(a)}catch(nt){a=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(nt))}return a?this.reloadAndSetCurrentUserOrClear(a):this.directlySetCurrentUser(null)}return _assert(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===a._redirectEventId?this.directlySetCurrentUser(a):this.reloadAndSetCurrentUserOrClear(a)}async tryRedirectSignIn(i){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,i,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(i){try{await _reloadWithoutSaving(i)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(i)}useDeviceLanguage(){this.languageCode=_getUserLanguage()}async _delete(){this._deleted=!0}async updateCurrentUser(i){if(_isFirebaseServerApp(this.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this));const s=i?getModularInstance(i):null;return s&&_assert(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(i,s=!1){if(!this._deleted)return i&&_assert(this.tenantId===i.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(i),this.queue(async()=>{await this.directlySetCurrentUser(i),this.notifyAuthListeners()})}async signOut(){return _isFirebaseServerApp(this.app)?Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(i){return _isFirebaseServerApp(this.app)?Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(_getInstance(i))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(i){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(i)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const i=await _getPasswordPolicy(this),s=new PasswordPolicyImpl(i);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(i){this._errorFactory=new ErrorFactory("auth","Firebase",i())}onAuthStateChanged(i,s,a){return this.registerStateListener(this.authStateSubscription,i,s,a)}beforeAuthStateChanged(i,s){return this.beforeStateQueue.pushCallback(i,s)}onIdTokenChanged(i,s,a){return this.registerStateListener(this.idTokenSubscription,i,s,a)}authStateReady(){return new Promise((i,s)=>{if(this.currentUser)i();else{const a=this.onAuthStateChanged(()=>{a(),i()},s)}})}async revokeAccessToken(i){if(this.currentUser){const s=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:i,idToken:s};this.tenantId!=null&&(a.tenantId=this.tenantId),await revokeToken(this,a)}}toJSON(){var i;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(i=this._currentUser)==null?void 0:i.toJSON()}}async _setRedirectUser(i,s){const a=await this.getOrInitRedirectPersistenceManager(s);return i===null?a.removeCurrentUser():a.setCurrentUser(i)}async getOrInitRedirectPersistenceManager(i){if(!this.redirectPersistenceManager){const s=i&&_getInstance(i)||this._popupRedirectResolver;_assert(s,this,"argument-error"),this.redirectPersistenceManager=await PersistenceUserManager.create(this,[_getInstance(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(i){var s,a;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)==null?void 0:s._redirectEventId)===i?this._currentUser:((a=this.redirectUser)==null?void 0:a._redirectEventId)===i?this.redirectUser:null}async _persistUserIfCurrent(i){if(i===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(i))}_notifyListenersIfCurrent(i){i===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=((s=this.currentUser)==null?void 0:s.uid)??null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(i,s,a,_){if(this._deleted)return()=>{};const et=typeof s=="function"?s:s.next.bind(s);let nt=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(_assert(c,this,"internal-error"),c.then(()=>{nt||et(this.currentUser)}),typeof s=="function"){const ct=i.addObserver(s,a,_);return()=>{nt=!0,ct()}}else{const ct=i.addObserver(s);return()=>{nt=!0,ct()}}}async directlySetCurrentUser(i){this.currentUser&&this.currentUser!==i&&this._currentUser._stopProactiveRefresh(),i&&this.isProactiveRefreshEnabled&&i._startProactiveRefresh(),this.currentUser=i,i?await this.assertedPersistence.setCurrentUser(i):await this.assertedPersistence.removeCurrentUser()}queue(i){return this.operations=this.operations.then(i,i),this.operations}get assertedPersistence(){return _assert(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(i){!i||this.frameworks.includes(i)||(this.frameworks.push(i),this.frameworks.sort(),this.clientVersion=_getClientVersion(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var _;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const s=await((_=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:_.getHeartbeatsHeader());s&&(i["X-Firebase-Client"]=s);const a=await this._getAppCheckToken();return a&&(i["X-Firebase-AppCheck"]=a),i}async _getAppCheckToken(){var s;if(_isFirebaseServerApp(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((s=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getToken());return i!=null&&i.error&&_logWarn(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function _castAuth(e){return getModularInstance(e)}class Subscription{constructor(i){this.auth=i,this.observer=null,this.addObserver=createSubscribe(s=>this.observer=s)}get next(){return _assert(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let externalJSProvider={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _setExternalJSProvider(e){externalJSProvider=e}function _loadJS(e){return externalJSProvider.loadJS(e)}function _recaptchaEnterpriseScriptUrl(){return externalJSProvider.recaptchaEnterpriseScript}function _gapiScriptUrl(){return externalJSProvider.gapiScript}function _generateCallbackName(e){return`__${e}${Math.floor(Math.random()*1e6)}`}class MockGreCAPTCHATopLevel{constructor(){this.enterprise=new MockGreCAPTCHA}ready(i){i()}execute(i,s){return Promise.resolve("token")}render(i,s){return""}}class MockGreCAPTCHA{ready(i){i()}execute(i,s){return Promise.resolve("token")}render(i,s){return""}}const RECAPTCHA_ENTERPRISE_VERIFIER_TYPE="recaptcha-enterprise",FAKE_TOKEN="NO_RECAPTCHA";class RecaptchaEnterpriseVerifier{constructor(i){this.type=RECAPTCHA_ENTERPRISE_VERIFIER_TYPE,this.auth=_castAuth(i)}async verify(i="verify",s=!1){async function a(et){if(!s){if(et.tenantId==null&&et._agentRecaptchaConfig!=null)return et._agentRecaptchaConfig.siteKey;if(et.tenantId!=null&&et._tenantRecaptchaConfigs[et.tenantId]!==void 0)return et._tenantRecaptchaConfigs[et.tenantId].siteKey}return new Promise(async(nt,c)=>{getRecaptchaConfig(et,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(ct=>{if(ct.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{const dt=new RecaptchaConfig(ct);return et.tenantId==null?et._agentRecaptchaConfig=dt:et._tenantRecaptchaConfigs[et.tenantId]=dt,nt(dt.siteKey)}}).catch(ct=>{c(ct)})})}function _(et,nt,c){const ct=window.grecaptcha;isEnterprise(ct)?ct.enterprise.ready(()=>{ct.enterprise.execute(et,{action:i}).then(dt=>{nt(dt)}).catch(()=>{nt(FAKE_TOKEN)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new MockGreCAPTCHATopLevel().execute("siteKey",{action:"verify"}):new Promise((et,nt)=>{a(this.auth).then(c=>{if(!s&&isEnterprise(window.grecaptcha))_(c,et,nt);else{if(typeof window>"u"){nt(new Error("RecaptchaVerifier is only supported in browser"));return}let ct=_recaptchaEnterpriseScriptUrl();ct.length!==0&&(ct+=c),_loadJS(ct).then(()=>{_(c,et,nt)}).catch(dt=>{nt(dt)})}}).catch(c=>{nt(c)})})}}async function injectRecaptchaFields(e,i,s,a=!1,_=!1){const et=new RecaptchaEnterpriseVerifier(e);let nt;if(_)nt=FAKE_TOKEN;else try{nt=await et.verify(s)}catch{nt=await et.verify(s,!0)}const c={...i};if(s==="mfaSmsEnrollment"||s==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in c){const ct=c.phoneEnrollmentInfo.phoneNumber,dt=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:ct,recaptchaToken:dt,captchaResponse:nt,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){const ct=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:ct,captchaResponse:nt,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return a?Object.assign(c,{captchaResp:nt}):Object.assign(c,{captchaResponse:nt}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c}async function handleRecaptchaFlow(e,i,s,a,_){var et;if((et=e._getRecaptchaConfig())!=null&&et.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const nt=await injectRecaptchaFields(e,i,s,s==="getOobCode");return a(e,nt)}else return a(e,i).catch(async nt=>{if(nt.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const c=await injectRecaptchaFields(e,i,s,s==="getOobCode");return a(e,c)}else return Promise.reject(nt)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function initializeAuth(e,i){const s=_getProvider(e,"auth");if(s.isInitialized()){const _=s.getImmediate(),et=s.getOptions();if(deepEqual(et,i??{}))return _;_fail(_,"already-initialized")}return s.initialize({options:i})}function _initializeAuthInstance(e,i){const s=(i==null?void 0:i.persistence)||[],a=(Array.isArray(s)?s:[s]).map(_getInstance);i!=null&&i.errorMap&&e._updateErrorMap(i.errorMap),e._initializeWithPersistence(a,i==null?void 0:i.popupRedirectResolver)}function connectAuthEmulator(e,i,s){const a=_castAuth(e);_assert(/^https?:\/\//.test(i),a,"invalid-emulator-scheme");const _=!!(s!=null&&s.disableWarnings),et=extractProtocol(i),{host:nt,port:c}=extractHostAndPort(i),ct=c===null?"":`:${c}`,dt={url:`${et}//${nt}${ct}/`},gt=Object.freeze({host:nt,port:c,protocol:et.replace(":",""),options:Object.freeze({disableWarnings:_})});if(!a._canInitEmulator){_assert(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),_assert(deepEqual(dt,a.config.emulator)&&deepEqual(gt,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=dt,a.emulatorConfig=gt,a.settings.appVerificationDisabledForTesting=!0,isCloudWorkstation(nt)?(pingServer(`${et}//${nt}${ct}`),updateEmulatorBanner("Auth",!0)):emitEmulatorWarning()}function extractProtocol(e){const i=e.indexOf(":");return i<0?"":e.substr(0,i+1)}function extractHostAndPort(e){const i=extractProtocol(e),s=/(\/\/)?([^?#/]+)/.exec(e.substr(i.length));if(!s)return{host:"",port:null};const a=s[2].split("@").pop()||"",_=/^(\[[^\]]+\])(:|$)/.exec(a);if(_){const et=_[1];return{host:et,port:parsePort(a.substr(et.length+1))}}else{const[et,nt]=a.split(":");return{host:et,port:parsePort(nt)}}}function parsePort(e){if(!e)return null;const i=Number(e);return isNaN(i)?null:i}function emitEmulatorWarning(){function e(){const i=document.createElement("p"),s=i.style;i.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",i.classList.add("firebase-emulator-warning"),document.body.appendChild(i)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",e):e())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AuthCredential{constructor(i,s){this.providerId=i,this.signInMethod=s}toJSON(){return debugFail("not implemented")}_getIdTokenResponse(i){return debugFail("not implemented")}_linkToIdToken(i,s){return debugFail("not implemented")}_getReauthenticationResolver(i){return debugFail("not implemented")}}async function linkEmailPassword(e,i){return _performApiRequest(e,"POST","/v1/accounts:signUp",i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signInWithPassword(e,i){return _performSignInRequest(e,"POST","/v1/accounts:signInWithPassword",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signInWithEmailLink$1(e,i){return _performSignInRequest(e,"POST","/v1/accounts:signInWithEmailLink",_addTidIfNecessary(e,i))}async function signInWithEmailLinkForLinking(e,i){return _performSignInRequest(e,"POST","/v1/accounts:signInWithEmailLink",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EmailAuthCredential extends AuthCredential{constructor(i,s,a,_=null){super("password",a),this._email=i,this._password=s,this._tenantId=_}static _fromEmailAndPassword(i,s){return new EmailAuthCredential(i,s,"password")}static _fromEmailAndCode(i,s,a=null){return new EmailAuthCredential(i,s,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(i){const s=typeof i=="string"?JSON.parse(i):i;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(i){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return handleRecaptchaFlow(i,s,"signInWithPassword",signInWithPassword);case"emailLink":return signInWithEmailLink$1(i,{email:this._email,oobCode:this._password});default:_fail(i,"internal-error")}}async _linkToIdToken(i,s){switch(this.signInMethod){case"password":const a={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return handleRecaptchaFlow(i,a,"signUpPassword",linkEmailPassword);case"emailLink":return signInWithEmailLinkForLinking(i,{idToken:s,email:this._email,oobCode:this._password});default:_fail(i,"internal-error")}}_getReauthenticationResolver(i){return this._getIdTokenResponse(i)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signInWithIdp(e,i){return _performSignInRequest(e,"POST","/v1/accounts:signInWithIdp",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IDP_REQUEST_URI$1="http://localhost";class OAuthCredential extends AuthCredential{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(i){const s=new OAuthCredential(i.providerId,i.signInMethod);return i.idToken||i.accessToken?(i.idToken&&(s.idToken=i.idToken),i.accessToken&&(s.accessToken=i.accessToken),i.nonce&&!i.pendingToken&&(s.nonce=i.nonce),i.pendingToken&&(s.pendingToken=i.pendingToken)):i.oauthToken&&i.oauthTokenSecret?(s.accessToken=i.oauthToken,s.secret=i.oauthTokenSecret):_fail("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(i){const s=typeof i=="string"?JSON.parse(i):i,{providerId:a,signInMethod:_,...et}=s;if(!a||!_)return null;const nt=new OAuthCredential(a,_);return nt.idToken=et.idToken||void 0,nt.accessToken=et.accessToken||void 0,nt.secret=et.secret,nt.nonce=et.nonce,nt.pendingToken=et.pendingToken||null,nt}_getIdTokenResponse(i){const s=this.buildRequest();return signInWithIdp(i,s)}_linkToIdToken(i,s){const a=this.buildRequest();return a.idToken=s,signInWithIdp(i,a)}_getReauthenticationResolver(i){const s=this.buildRequest();return s.autoCreate=!1,signInWithIdp(i,s)}buildRequest(){const i={requestUri:IDP_REQUEST_URI$1,returnSecureToken:!0};if(this.pendingToken)i.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),i.postBody=querystring(s)}return i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function parseMode(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function parseDeepLink(e){const i=querystringDecode(extractQuerystring(e)).link,s=i?querystringDecode(extractQuerystring(i)).deep_link_id:null,a=querystringDecode(extractQuerystring(e)).deep_link_id;return(a?querystringDecode(extractQuerystring(a)).link:null)||a||s||i||e}class ActionCodeURL{constructor(i){const s=querystringDecode(extractQuerystring(i)),a=s.apiKey??null,_=s.oobCode??null,et=parseMode(s.mode??null);_assert(a&&_&&et,"argument-error"),this.apiKey=a,this.operation=et,this.code=_,this.continueUrl=s.continueUrl??null,this.languageCode=s.lang??null,this.tenantId=s.tenantId??null}static parseLink(i){const s=parseDeepLink(i);try{return new ActionCodeURL(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EmailAuthProvider{constructor(){this.providerId=EmailAuthProvider.PROVIDER_ID}static credential(i,s){return EmailAuthCredential._fromEmailAndPassword(i,s)}static credentialWithLink(i,s){const a=ActionCodeURL.parseLink(s);return _assert(a,"argument-error"),EmailAuthCredential._fromEmailAndCode(i,a.code,a.tenantId)}}EmailAuthProvider.PROVIDER_ID="password";EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD="password";EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FederatedAuthProvider{constructor(i){this.providerId=i,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(i){this.defaultLanguageCode=i}setCustomParameters(i){return this.customParameters=i,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BaseOAuthProvider extends FederatedAuthProvider{constructor(){super(...arguments),this.scopes=[]}addScope(i){return this.scopes.includes(i)||this.scopes.push(i),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FacebookAuthProvider extends BaseOAuthProvider{constructor(){super("facebook.com")}static credential(i){return OAuthCredential._fromParams({providerId:FacebookAuthProvider.PROVIDER_ID,signInMethod:FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD,accessToken:i})}static credentialFromResult(i){return FacebookAuthProvider.credentialFromTaggedObject(i)}static credentialFromError(i){return FacebookAuthProvider.credentialFromTaggedObject(i.customData||{})}static credentialFromTaggedObject({_tokenResponse:i}){if(!i||!("oauthAccessToken"in i)||!i.oauthAccessToken)return null;try{return FacebookAuthProvider.credential(i.oauthAccessToken)}catch{return null}}}FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD="facebook.com";FacebookAuthProvider.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GoogleAuthProvider extends BaseOAuthProvider{constructor(){super("google.com"),this.addScope("profile")}static credential(i,s){return OAuthCredential._fromParams({providerId:GoogleAuthProvider.PROVIDER_ID,signInMethod:GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD,idToken:i,accessToken:s})}static credentialFromResult(i){return GoogleAuthProvider.credentialFromTaggedObject(i)}static credentialFromError(i){return GoogleAuthProvider.credentialFromTaggedObject(i.customData||{})}static credentialFromTaggedObject({_tokenResponse:i}){if(!i)return null;const{oauthIdToken:s,oauthAccessToken:a}=i;if(!s&&!a)return null;try{return GoogleAuthProvider.credential(s,a)}catch{return null}}}GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD="google.com";GoogleAuthProvider.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GithubAuthProvider extends BaseOAuthProvider{constructor(){super("github.com")}static credential(i){return OAuthCredential._fromParams({providerId:GithubAuthProvider.PROVIDER_ID,signInMethod:GithubAuthProvider.GITHUB_SIGN_IN_METHOD,accessToken:i})}static credentialFromResult(i){return GithubAuthProvider.credentialFromTaggedObject(i)}static credentialFromError(i){return GithubAuthProvider.credentialFromTaggedObject(i.customData||{})}static credentialFromTaggedObject({_tokenResponse:i}){if(!i||!("oauthAccessToken"in i)||!i.oauthAccessToken)return null;try{return GithubAuthProvider.credential(i.oauthAccessToken)}catch{return null}}}GithubAuthProvider.GITHUB_SIGN_IN_METHOD="github.com";GithubAuthProvider.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TwitterAuthProvider extends BaseOAuthProvider{constructor(){super("twitter.com")}static credential(i,s){return OAuthCredential._fromParams({providerId:TwitterAuthProvider.PROVIDER_ID,signInMethod:TwitterAuthProvider.TWITTER_SIGN_IN_METHOD,oauthToken:i,oauthTokenSecret:s})}static credentialFromResult(i){return TwitterAuthProvider.credentialFromTaggedObject(i)}static credentialFromError(i){return TwitterAuthProvider.credentialFromTaggedObject(i.customData||{})}static credentialFromTaggedObject({_tokenResponse:i}){if(!i)return null;const{oauthAccessToken:s,oauthTokenSecret:a}=i;if(!s||!a)return null;try{return TwitterAuthProvider.credential(s,a)}catch{return null}}}TwitterAuthProvider.TWITTER_SIGN_IN_METHOD="twitter.com";TwitterAuthProvider.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signUp(e,i){return _performSignInRequest(e,"POST","/v1/accounts:signUp",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UserCredentialImpl{constructor(i){this.user=i.user,this.providerId=i.providerId,this._tokenResponse=i._tokenResponse,this.operationType=i.operationType}static async _fromIdTokenResponse(i,s,a,_=!1){const et=await UserImpl._fromIdTokenResponse(i,a,_),nt=providerIdForResponse(a);return new UserCredentialImpl({user:et,providerId:nt,_tokenResponse:a,operationType:s})}static async _forOperation(i,s,a){await i._updateTokensIfNecessary(a,!0);const _=providerIdForResponse(a);return new UserCredentialImpl({user:i,providerId:_,_tokenResponse:a,operationType:s})}}function providerIdForResponse(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MultiFactorError extends FirebaseError{constructor(i,s,a,_){super(s.code,s.message),this.operationType=a,this.user=_,Object.setPrototypeOf(this,MultiFactorError.prototype),this.customData={appName:i.name,tenantId:i.tenantId??void 0,_serverResponse:s.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(i,s,a,_){return new MultiFactorError(i,s,a,_)}}function _processCredentialSavingMfaContextIfNecessary(e,i,s,a){return(i==="reauthenticate"?s._getReauthenticationResolver(e):s._getIdTokenResponse(e)).catch(et=>{throw et.code==="auth/multi-factor-auth-required"?MultiFactorError._fromErrorAndOperation(e,et,i,a):et})}async function _link$1(e,i,s=!1){const a=await _logoutIfInvalidated(e,i._linkToIdToken(e.auth,await e.getIdToken()),s);return UserCredentialImpl._forOperation(e,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _reauthenticate(e,i,s=!1){const{auth:a}=e;if(_isFirebaseServerApp(a.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(a));const _="reauthenticate";try{const et=await _logoutIfInvalidated(e,_processCredentialSavingMfaContextIfNecessary(a,_,i,e),s);_assert(et.idToken,a,"internal-error");const nt=_parseToken(et.idToken);_assert(nt,a,"internal-error");const{sub:c}=nt;return _assert(e.uid===c,a,"user-mismatch"),UserCredentialImpl._forOperation(e,_,et)}catch(et){throw(et==null?void 0:et.code)==="auth/user-not-found"&&_fail(a,"user-mismatch"),et}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _signInWithCredential(e,i,s=!1){if(_isFirebaseServerApp(e.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(e));const a="signIn",_=await _processCredentialSavingMfaContextIfNecessary(e,a,i),et=await UserCredentialImpl._fromIdTokenResponse(e,a,_);return s||await e._updateCurrentUser(et.user),et}async function signInWithCredential(e,i){return _signInWithCredential(_castAuth(e),i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function recachePasswordPolicy(e){const i=_castAuth(e);i._getPasswordPolicyInternal()&&await i._updatePasswordPolicy()}async function createUserWithEmailAndPassword(e,i,s){if(_isFirebaseServerApp(e.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(e));const a=_castAuth(e),nt=await handleRecaptchaFlow(a,{returnSecureToken:!0,email:i,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",signUp).catch(ct=>{throw ct.code==="auth/password-does-not-meet-requirements"&&recachePasswordPolicy(e),ct}),c=await UserCredentialImpl._fromIdTokenResponse(a,"signIn",nt);return await a._updateCurrentUser(c.user),c}function signInWithEmailAndPassword(e,i,s){return _isFirebaseServerApp(e.app)?Promise.reject(_serverAppCurrentUserOperationNotSupportedError(e)):signInWithCredential(getModularInstance(e),EmailAuthProvider.credential(i,s)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&recachePasswordPolicy(e),a})}function onIdTokenChanged(e,i,s,a){return getModularInstance(e).onIdTokenChanged(i,s,a)}function beforeAuthStateChanged(e,i,s){return getModularInstance(e).beforeAuthStateChanged(i,s)}function signOut(e){return getModularInstance(e).signOut()}const STORAGE_AVAILABLE_KEY="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BrowserPersistenceClass{constructor(i,s){this.storageRetriever=i,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(STORAGE_AVAILABLE_KEY,"1"),this.storage.removeItem(STORAGE_AVAILABLE_KEY),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(i,s){return this.storage.setItem(i,JSON.stringify(s)),Promise.resolve()}_get(i){const s=this.storage.getItem(i);return Promise.resolve(s?JSON.parse(s):null)}_remove(i){return this.storage.removeItem(i),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _POLLING_INTERVAL_MS$1=1e3,IE10_LOCAL_STORAGE_SYNC_DELAY=10;class BrowserLocalPersistence extends BrowserPersistenceClass{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(i,s)=>this.onStorageEvent(i,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=_isMobileBrowser(),this._shouldAllowMigration=!0}forAllChangedKeys(i){for(const s of Object.keys(this.listeners)){const a=this.storage.getItem(s),_=this.localCache[s];a!==_&&i(s,_,a)}}onStorageEvent(i,s=!1){if(!i.key){this.forAllChangedKeys((nt,c,ct)=>{this.notifyListeners(nt,ct)});return}const a=i.key;s?this.detachListener():this.stopPolling();const _=()=>{const nt=this.storage.getItem(a);!s&&this.localCache[a]===nt||this.notifyListeners(a,nt)},et=this.storage.getItem(a);_isIE10()&&et!==i.newValue&&i.newValue!==i.oldValue?setTimeout(_,IE10_LOCAL_STORAGE_SYNC_DELAY):_()}notifyListeners(i,s){this.localCache[i]=s;const a=this.listeners[i];if(a)for(const _ of Array.from(a))_(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((i,s,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:i,oldValue:s,newValue:a}),!0)})},_POLLING_INTERVAL_MS$1)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(i,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[i]||(this.listeners[i]=new Set,this.localCache[i]=this.storage.getItem(i)),this.listeners[i].add(s)}_removeListener(i,s){this.listeners[i]&&(this.listeners[i].delete(s),this.listeners[i].size===0&&delete this.listeners[i]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(i,s){await super._set(i,s),this.localCache[i]=JSON.stringify(s)}async _get(i){const s=await super._get(i);return this.localCache[i]=JSON.stringify(s),s}async _remove(i){await super._remove(i),delete this.localCache[i]}}BrowserLocalPersistence.type="LOCAL";const browserLocalPersistence=BrowserLocalPersistence;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BrowserSessionPersistence extends BrowserPersistenceClass{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(i,s){}_removeListener(i,s){}}BrowserSessionPersistence.type="SESSION";const browserSessionPersistence=BrowserSessionPersistence;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _allSettled(e){return Promise.all(e.map(async i=>{try{return{fulfilled:!0,value:await i}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Receiver{constructor(i){this.eventTarget=i,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(i){const s=this.receivers.find(_=>_.isListeningto(i));if(s)return s;const a=new Receiver(i);return this.receivers.push(a),a}isListeningto(i){return this.eventTarget===i}async handleEvent(i){const s=i,{eventId:a,eventType:_,data:et}=s.data,nt=this.handlersMap[_];if(!(nt!=null&&nt.size))return;s.ports[0].postMessage({status:"ack",eventId:a,eventType:_});const c=Array.from(nt).map(async dt=>dt(s.origin,et)),ct=await _allSettled(c);s.ports[0].postMessage({status:"done",eventId:a,eventType:_,response:ct})}_subscribe(i,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[i]||(this.handlersMap[i]=new Set),this.handlersMap[i].add(s)}_unsubscribe(i,s){this.handlersMap[i]&&s&&this.handlersMap[i].delete(s),(!s||this.handlersMap[i].size===0)&&delete this.handlersMap[i],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Receiver.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _generateEventId(e="",i=10){let s="";for(let a=0;a<i;a++)s+=Math.floor(Math.random()*10);return e+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sender{constructor(i){this.target=i,this.handlers=new Set}removeMessageHandler(i){i.messageChannel&&(i.messageChannel.port1.removeEventListener("message",i.onMessage),i.messageChannel.port1.close()),this.handlers.delete(i)}async _send(i,s,a=50){const _=typeof MessageChannel<"u"?new MessageChannel:null;if(!_)throw new Error("connection_unavailable");let et,nt;return new Promise((c,ct)=>{const dt=_generateEventId("",20);_.port1.start();const gt=setTimeout(()=>{ct(new Error("unsupported_event"))},a);nt={messageChannel:_,onMessage(Tt){const Et=Tt;if(Et.data.eventId===dt)switch(Et.data.status){case"ack":clearTimeout(gt),et=setTimeout(()=>{ct(new Error("timeout"))},3e3);break;case"done":clearTimeout(et),c(Et.data.response);break;default:clearTimeout(gt),clearTimeout(et),ct(new Error("invalid_response"));break}}},this.handlers.add(nt),_.port1.addEventListener("message",nt.onMessage),this.target.postMessage({eventType:i,eventId:dt,data:s},[_.port2])}).finally(()=>{nt&&this.removeMessageHandler(nt)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _window(){return window}function _setWindowLocation(e){_window().location.href=e}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _isWorker(){return typeof _window().WorkerGlobalScope<"u"&&typeof _window().importScripts=="function"}async function _getActiveServiceWorker(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function _getServiceWorkerController(){var e;return((e=navigator==null?void 0:navigator.serviceWorker)==null?void 0:e.controller)||null}function _getWorkerGlobalScope(){return _isWorker()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DB_NAME="firebaseLocalStorageDb",DB_VERSION=1,DB_OBJECTSTORE_NAME="firebaseLocalStorage",DB_DATA_KEYPATH="fbase_key";class DBPromise{constructor(i){this.request=i}toPromise(){return new Promise((i,s)=>{this.request.addEventListener("success",()=>{i(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function getObjectStore(e,i){return e.transaction([DB_OBJECTSTORE_NAME],i?"readwrite":"readonly").objectStore(DB_OBJECTSTORE_NAME)}function _deleteDatabase(){const e=indexedDB.deleteDatabase(DB_NAME);return new DBPromise(e).toPromise()}function _openDatabase(){const e=indexedDB.open(DB_NAME,DB_VERSION);return new Promise((i,s)=>{e.addEventListener("error",()=>{s(e.error)}),e.addEventListener("upgradeneeded",()=>{const a=e.result;try{a.createObjectStore(DB_OBJECTSTORE_NAME,{keyPath:DB_DATA_KEYPATH})}catch(_){s(_)}}),e.addEventListener("success",async()=>{const a=e.result;a.objectStoreNames.contains(DB_OBJECTSTORE_NAME)?i(a):(a.close(),await _deleteDatabase(),i(await _openDatabase()))})})}async function _putObject(e,i,s){const a=getObjectStore(e,!0).put({[DB_DATA_KEYPATH]:i,value:s});return new DBPromise(a).toPromise()}async function getObject(e,i){const s=getObjectStore(e,!1).get(i),a=await new DBPromise(s).toPromise();return a===void 0?null:a.value}function _deleteObject(e,i){const s=getObjectStore(e,!0).delete(i);return new DBPromise(s).toPromise()}const _POLLING_INTERVAL_MS=800,_TRANSACTION_RETRY_COUNT=3;class IndexedDBLocalPersistence{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await _openDatabase(),this.db)}async _withRetries(i){let s=0;for(;;)try{const a=await this._openDb();return await i(a)}catch(a){if(s++>_TRANSACTION_RETRY_COUNT)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return _isWorker()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Receiver._getInstance(_getWorkerGlobalScope()),this.receiver._subscribe("keyChanged",async(i,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(i,s)=>["keyChanged"])}async initializeSender(){var s,a;if(this.activeServiceWorker=await _getActiveServiceWorker(),!this.activeServiceWorker)return;this.sender=new Sender(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);i&&(s=i[0])!=null&&s.fulfilled&&(a=i[0])!=null&&a.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(i){if(!(!this.sender||!this.activeServiceWorker||_getServiceWorkerController()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:i},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const i=await _openDatabase();return await _putObject(i,STORAGE_AVAILABLE_KEY,"1"),await _deleteObject(i,STORAGE_AVAILABLE_KEY),!0}catch{}return!1}async _withPendingWrite(i){this.pendingWrites++;try{await i()}finally{this.pendingWrites--}}async _set(i,s){return this._withPendingWrite(async()=>(await this._withRetries(a=>_putObject(a,i,s)),this.localCache[i]=s,this.notifyServiceWorker(i)))}async _get(i){const s=await this._withRetries(a=>getObject(a,i));return this.localCache[i]=s,s}async _remove(i){return this._withPendingWrite(async()=>(await this._withRetries(s=>_deleteObject(s,i)),delete this.localCache[i],this.notifyServiceWorker(i)))}async _poll(){const i=await this._withRetries(_=>{const et=getObjectStore(_,!1).getAll();return new DBPromise(et).toPromise()});if(!i)return[];if(this.pendingWrites!==0)return[];const s=[],a=new Set;if(i.length!==0)for(const{fbase_key:_,value:et}of i)a.add(_),JSON.stringify(this.localCache[_])!==JSON.stringify(et)&&(this.notifyListeners(_,et),s.push(_));for(const _ of Object.keys(this.localCache))this.localCache[_]&&!a.has(_)&&(this.notifyListeners(_,null),s.push(_));return s}notifyListeners(i,s){this.localCache[i]=s;const a=this.listeners[i];if(a)for(const _ of Array.from(a))_(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),_POLLING_INTERVAL_MS)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(i,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[i]||(this.listeners[i]=new Set,this._get(i)),this.listeners[i].add(s)}_removeListener(i,s){this.listeners[i]&&(this.listeners[i].delete(s),this.listeners[i].size===0&&delete this.listeners[i]),Object.keys(this.listeners).length===0&&this.stopPolling()}}IndexedDBLocalPersistence.type="LOCAL";const indexedDBLocalPersistence=IndexedDBLocalPersistence;new Delay(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _withDefaultResolver(e,i){return i?_getInstance(i):(_assert(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IdpCredential extends AuthCredential{constructor(i){super("custom","custom"),this.params=i}_getIdTokenResponse(i){return signInWithIdp(i,this._buildIdpRequest())}_linkToIdToken(i,s){return signInWithIdp(i,this._buildIdpRequest(s))}_getReauthenticationResolver(i){return signInWithIdp(i,this._buildIdpRequest())}_buildIdpRequest(i){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return i&&(s.idToken=i),s}}function _signIn(e){return _signInWithCredential(e.auth,new IdpCredential(e),e.bypassAuthState)}function _reauth(e){const{auth:i,user:s}=e;return _assert(s,i,"internal-error"),_reauthenticate(s,new IdpCredential(e),e.bypassAuthState)}async function _link(e){const{auth:i,user:s}=e;return _assert(s,i,"internal-error"),_link$1(s,new IdpCredential(e),e.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AbstractPopupRedirectOperation{constructor(i,s,a,_,et=!1){this.auth=i,this.resolver=a,this.user=_,this.bypassAuthState=et,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(i,s)=>{this.pendingPromise={resolve:i,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(i){const{urlResponse:s,sessionId:a,postBody:_,tenantId:et,error:nt,type:c}=i;if(nt){this.reject(nt);return}const ct={auth:this.auth,requestUri:s,sessionId:a,tenantId:et||void 0,postBody:_||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(ct))}catch(dt){this.reject(dt)}}onError(i){this.reject(i)}getIdpTask(i){switch(i){case"signInViaPopup":case"signInViaRedirect":return _signIn;case"linkViaPopup":case"linkViaRedirect":return _link;case"reauthViaPopup":case"reauthViaRedirect":return _reauth;default:_fail(this.auth,"internal-error")}}resolve(i){debugAssert(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(i),this.unregisterAndCleanUp()}reject(i){debugAssert(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(i),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _POLL_WINDOW_CLOSE_TIMEOUT=new Delay(2e3,1e4);class PopupOperation extends AbstractPopupRedirectOperation{constructor(i,s,a,_,et){super(i,s,_,et),this.provider=a,this.authWindow=null,this.pollId=null,PopupOperation.currentPopupAction&&PopupOperation.currentPopupAction.cancel(),PopupOperation.currentPopupAction=this}async executeNotNull(){const i=await this.execute();return _assert(i,this.auth,"internal-error"),i}async onExecution(){debugAssert(this.filter.length===1,"Popup operations only handle one event");const i=_generateEventId();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],i),this.authWindow.associatedEvent=i,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(_createError(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var i;return((i=this.authWindow)==null?void 0:i.associatedEvent)||null}cancel(){this.reject(_createError(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,PopupOperation.currentPopupAction=null}pollUserCancellation(){const i=()=>{var s,a;if((a=(s=this.authWindow)==null?void 0:s.window)!=null&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(_createError(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(i,_POLL_WINDOW_CLOSE_TIMEOUT.get())};i()}}PopupOperation.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PENDING_REDIRECT_KEY="pendingRedirect",redirectOutcomeMap=new Map;class RedirectAction extends AbstractPopupRedirectOperation{constructor(i,s,a=!1){super(i,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,a),this.eventId=null}async execute(){let i=redirectOutcomeMap.get(this.auth._key());if(!i){try{const a=await _getAndClearPendingRedirectStatus(this.resolver,this.auth)?await super.execute():null;i=()=>Promise.resolve(a)}catch(s){i=()=>Promise.reject(s)}redirectOutcomeMap.set(this.auth._key(),i)}return this.bypassAuthState||redirectOutcomeMap.set(this.auth._key(),()=>Promise.resolve(null)),i()}async onAuthEvent(i){if(i.type==="signInViaRedirect")return super.onAuthEvent(i);if(i.type==="unknown"){this.resolve(null);return}if(i.eventId){const s=await this.auth._redirectUserForId(i.eventId);if(s)return this.user=s,super.onAuthEvent(i);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function _getAndClearPendingRedirectStatus(e,i){const s=pendingRedirectKey(i),a=resolverPersistence(e);if(!await a._isAvailable())return!1;const _=await a._get(s)==="true";return await a._remove(s),_}function _overrideRedirectResult(e,i){redirectOutcomeMap.set(e._key(),i)}function resolverPersistence(e){return _getInstance(e._redirectPersistence)}function pendingRedirectKey(e){return _persistenceKeyName(PENDING_REDIRECT_KEY,e.config.apiKey,e.name)}async function _getRedirectResult(e,i,s=!1){if(_isFirebaseServerApp(e.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(e));const a=_castAuth(e),_=_withDefaultResolver(a,i),nt=await new RedirectAction(a,_,s).execute();return nt&&!s&&(delete nt.user._redirectEventId,await a._persistUserIfCurrent(nt.user),await a._setRedirectUser(null,i)),nt}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EVENT_DUPLICATION_CACHE_DURATION_MS=10*60*1e3;class AuthEventManager{constructor(i){this.auth=i,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(i){this.consumers.add(i),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,i)&&(this.sendToConsumer(this.queuedRedirectEvent,i),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(i){this.consumers.delete(i)}onEvent(i){if(this.hasEventBeenHandled(i))return!1;let s=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(i,a)&&(s=!0,this.sendToConsumer(i,a),this.saveEventToCache(i))}),this.hasHandledPotentialRedirect||!isRedirectEvent(i)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=i,s=!0)),s}sendToConsumer(i,s){var a;if(i.error&&!isNullRedirectEvent(i)){const _=((a=i.error.code)==null?void 0:a.split("auth/")[1])||"internal-error";s.onError(_createError(this.auth,_))}else s.onAuthEvent(i)}isEventForConsumer(i,s){const a=s.eventId===null||!!i.eventId&&i.eventId===s.eventId;return s.filter.includes(i.type)&&a}hasEventBeenHandled(i){return Date.now()-this.lastProcessedEventTime>=EVENT_DUPLICATION_CACHE_DURATION_MS&&this.cachedEventUids.clear(),this.cachedEventUids.has(eventUid(i))}saveEventToCache(i){this.cachedEventUids.add(eventUid(i)),this.lastProcessedEventTime=Date.now()}}function eventUid(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(i=>i).join("-")}function isNullRedirectEvent({type:e,error:i}){return e==="unknown"&&(i==null?void 0:i.code)==="auth/no-auth-event"}function isRedirectEvent(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return isNullRedirectEvent(e);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _getProjectConfig(e,i={}){return _performApiRequest(e,"GET","/v1/projects",i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IP_ADDRESS_REGEX=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,HTTP_REGEX=/^https?/;async function _validateOrigin(e){if(e.config.emulator)return;const{authorizedDomains:i}=await _getProjectConfig(e);for(const s of i)try{if(matchDomain(s))return}catch{}_fail(e,"unauthorized-domain")}function matchDomain(e){const i=_getCurrentUrl(),{protocol:s,hostname:a}=new URL(i);if(e.startsWith("chrome-extension://")){const nt=new URL(e);return nt.hostname===""&&a===""?s==="chrome-extension:"&&e.replace("chrome-extension://","")===i.replace("chrome-extension://",""):s==="chrome-extension:"&&nt.hostname===a}if(!HTTP_REGEX.test(s))return!1;if(IP_ADDRESS_REGEX.test(e))return a===e;const _=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+_+"|"+_+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NETWORK_TIMEOUT=new Delay(3e4,6e4);function resetUnloadedGapiModules(){const e=_window().___jsl;if(e!=null&&e.H){for(const i of Object.keys(e.H))if(e.H[i].r=e.H[i].r||[],e.H[i].L=e.H[i].L||[],e.H[i].r=[...e.H[i].L],e.CP)for(let s=0;s<e.CP.length;s++)e.CP[s]=null}}function loadGapi(e){return new Promise((i,s)=>{var _,et,nt;function a(){resetUnloadedGapiModules(),gapi.load("gapi.iframes",{callback:()=>{i(gapi.iframes.getContext())},ontimeout:()=>{resetUnloadedGapiModules(),s(_createError(e,"network-request-failed"))},timeout:NETWORK_TIMEOUT.get()})}if((et=(_=_window().gapi)==null?void 0:_.iframes)!=null&&et.Iframe)i(gapi.iframes.getContext());else if((nt=_window().gapi)!=null&&nt.load)a();else{const c=_generateCallbackName("iframefcb");return _window()[c]=()=>{gapi.load?a():s(_createError(e,"network-request-failed"))},_loadJS(`${_gapiScriptUrl()}?onload=${c}`).catch(ct=>s(ct))}}).catch(i=>{throw cachedGApiLoader=null,i})}let cachedGApiLoader=null;function _loadGapi(e){return cachedGApiLoader=cachedGApiLoader||loadGapi(e),cachedGApiLoader}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PING_TIMEOUT=new Delay(5e3,15e3),IFRAME_PATH="__/auth/iframe",EMULATED_IFRAME_PATH="emulator/auth/iframe",IFRAME_ATTRIBUTES={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},EID_FROM_APIHOST=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function getIframeUrl(e){const i=e.config;_assert(i.authDomain,e,"auth-domain-config-required");const s=i.emulator?_emulatorUrl(i,EMULATED_IFRAME_PATH):`https://${e.config.authDomain}/${IFRAME_PATH}`,a={apiKey:i.apiKey,appName:e.name,v:SDK_VERSION$1},_=EID_FROM_APIHOST.get(e.config.apiHost);_&&(a.eid=_);const et=e._getFrameworks();return et.length&&(a.fw=et.join(",")),`${s}?${querystring(a).slice(1)}`}async function _openIframe(e){const i=await _loadGapi(e),s=_window().gapi;return _assert(s,e,"internal-error"),i.open({where:document.body,url:getIframeUrl(e),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:IFRAME_ATTRIBUTES,dontclear:!0},a=>new Promise(async(_,et)=>{await a.restyle({setHideOnLeave:!1});const nt=_createError(e,"network-request-failed"),c=_window().setTimeout(()=>{et(nt)},PING_TIMEOUT.get());function ct(){_window().clearTimeout(c),_(a)}a.ping(ct).then(ct,()=>{et(nt)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BASE_POPUP_OPTIONS={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},DEFAULT_WIDTH=500,DEFAULT_HEIGHT=600,TARGET_BLANK="_blank",FIREFOX_EMPTY_URL="http://localhost";class AuthPopup{constructor(i){this.window=i,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function _open(e,i,s,a=DEFAULT_WIDTH,_=DEFAULT_HEIGHT){const et=Math.max((window.screen.availHeight-_)/2,0).toString(),nt=Math.max((window.screen.availWidth-a)/2,0).toString();let c="";const ct={...BASE_POPUP_OPTIONS,width:a.toString(),height:_.toString(),top:et,left:nt},dt=getUA().toLowerCase();s&&(c=_isChromeIOS(dt)?TARGET_BLANK:s),_isFirefox(dt)&&(i=i||FIREFOX_EMPTY_URL,ct.scrollbars="yes");const gt=Object.entries(ct).reduce((Et,[At,Mt])=>`${Et}${At}=${Mt},`,"");if(_isIOSStandalone(dt)&&c!=="_self")return openAsNewWindowIOS(i||"",c),new AuthPopup(null);const Tt=window.open(i||"",c,gt);_assert(Tt,e,"popup-blocked");try{Tt.focus()}catch{}return new AuthPopup(Tt)}function openAsNewWindowIOS(e,i){const s=document.createElement("a");s.href=e,s.target=i;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WIDGET_PATH="__/auth/handler",EMULATOR_WIDGET_PATH="emulator/auth/handler",FIREBASE_APP_CHECK_FRAGMENT_ID=encodeURIComponent("fac");async function _getRedirectUrl(e,i,s,a,_,et){_assert(e.config.authDomain,e,"auth-domain-config-required"),_assert(e.config.apiKey,e,"invalid-api-key");const nt={apiKey:e.config.apiKey,appName:e.name,authType:s,redirectUrl:a,v:SDK_VERSION$1,eventId:_};if(i instanceof FederatedAuthProvider){i.setDefaultLanguage(e.languageCode),nt.providerId=i.providerId||"",isEmpty(i.getCustomParameters())||(nt.customParameters=JSON.stringify(i.getCustomParameters()));for(const[gt,Tt]of Object.entries({}))nt[gt]=Tt}if(i instanceof BaseOAuthProvider){const gt=i.getScopes().filter(Tt=>Tt!=="");gt.length>0&&(nt.scopes=gt.join(","))}e.tenantId&&(nt.tid=e.tenantId);const c=nt;for(const gt of Object.keys(c))c[gt]===void 0&&delete c[gt];const ct=await e._getAppCheckToken(),dt=ct?`#${FIREBASE_APP_CHECK_FRAGMENT_ID}=${encodeURIComponent(ct)}`:"";return`${getHandlerBase(e)}?${querystring(c).slice(1)}${dt}`}function getHandlerBase({config:e}){return e.emulator?_emulatorUrl(e,EMULATOR_WIDGET_PATH):`https://${e.authDomain}/${WIDGET_PATH}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WEB_STORAGE_SUPPORT_KEY="webStorageSupport";class BrowserPopupRedirectResolver{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=browserSessionPersistence,this._completeRedirectFn=_getRedirectResult,this._overrideRedirectResult=_overrideRedirectResult}async _openPopup(i,s,a,_){var nt;debugAssert((nt=this.eventManagers[i._key()])==null?void 0:nt.manager,"_initialize() not called before _openPopup()");const et=await _getRedirectUrl(i,s,a,_getCurrentUrl(),_);return _open(i,et,_generateEventId())}async _openRedirect(i,s,a,_){await this._originValidation(i);const et=await _getRedirectUrl(i,s,a,_getCurrentUrl(),_);return _setWindowLocation(et),new Promise(()=>{})}_initialize(i){const s=i._key();if(this.eventManagers[s]){const{manager:_,promise:et}=this.eventManagers[s];return _?Promise.resolve(_):(debugAssert(et,"If manager is not set, promise should be"),et)}const a=this.initAndGetManager(i);return this.eventManagers[s]={promise:a},a.catch(()=>{delete this.eventManagers[s]}),a}async initAndGetManager(i){const s=await _openIframe(i),a=new AuthEventManager(i);return s.register("authEvent",_=>(_assert(_==null?void 0:_.authEvent,i,"invalid-auth-event"),{status:a.onEvent(_.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[i._key()]={manager:a},this.iframes[i._key()]=s,a}_isIframeWebStorageSupported(i,s){this.iframes[i._key()].send(WEB_STORAGE_SUPPORT_KEY,{type:WEB_STORAGE_SUPPORT_KEY},_=>{var nt;const et=(nt=_==null?void 0:_[0])==null?void 0:nt[WEB_STORAGE_SUPPORT_KEY];et!==void 0&&s(!!et),_fail(i,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(i){const s=i._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=_validateOrigin(i)),this.originValidationPromises[s]}get _shouldInitProactively(){return _isMobileBrowser()||_isSafari()||_isIOS()}}const browserPopupRedirectResolver=BrowserPopupRedirectResolver;var name$3="@firebase/auth",version$3="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AuthInterop{constructor(i){this.auth=i,this.internalListeners=new Map}getUid(){var i;return this.assertAuthConfigured(),((i=this.auth.currentUser)==null?void 0:i.uid)||null}async getToken(i){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(i)}:null}addAuthTokenListener(i){if(this.assertAuthConfigured(),this.internalListeners.has(i))return;const s=this.auth.onIdTokenChanged(a=>{i((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(i,s),this.updateProactiveRefresh()}removeAuthTokenListener(i){this.assertAuthConfigured();const s=this.internalListeners.get(i);s&&(this.internalListeners.delete(i),s(),this.updateProactiveRefresh())}assertAuthConfigured(){_assert(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getVersionForPlatform(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function registerAuth(e){_registerComponent(new Component("auth",(i,{options:s})=>{const a=i.getProvider("app").getImmediate(),_=i.getProvider("heartbeat"),et=i.getProvider("app-check-internal"),{apiKey:nt,authDomain:c}=a.options;_assert(nt&&!nt.includes(":"),"invalid-api-key",{appName:a.name});const ct={apiKey:nt,authDomain:c,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_getClientVersion(e)},dt=new AuthImpl(a,_,et,ct);return _initializeAuthInstance(dt,s),dt},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((i,s,a)=>{i.getProvider("auth-internal").initialize()})),_registerComponent(new Component("auth-internal",i=>{const s=_castAuth(i.getProvider("auth").getImmediate());return(a=>new AuthInterop(a))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),registerVersion(name$3,version$3,getVersionForPlatform(e)),registerVersion(name$3,version$3,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ID_TOKEN_MAX_AGE=5*60,authIdTokenMaxAge=getExperimentalSetting("authIdTokenMaxAge")||DEFAULT_ID_TOKEN_MAX_AGE;let lastPostedIdToken=null;const mintCookieFactory=e=>async i=>{const s=i&&await i.getIdTokenResult(),a=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(a&&a>authIdTokenMaxAge)return;const _=s==null?void 0:s.token;lastPostedIdToken!==_&&(lastPostedIdToken=_,await fetch(e,{method:_?"POST":"DELETE",headers:_?{Authorization:`Bearer ${_}`}:{}}))};function getAuth(e=getApp()){const i=_getProvider(e,"auth");if(i.isInitialized())return i.getImmediate();const s=initializeAuth(e,{popupRedirectResolver:browserPopupRedirectResolver,persistence:[indexedDBLocalPersistence,browserLocalPersistence,browserSessionPersistence]}),a=getExperimentalSetting("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const et=new URL(a,location.origin);if(location.origin===et.origin){const nt=mintCookieFactory(et.toString());beforeAuthStateChanged(s,nt,()=>nt(s.currentUser)),onIdTokenChanged(s,c=>nt(c))}}const _=getDefaultEmulatorHost("auth");return _&&connectAuthEmulator(s,`http://${_}`),s}function getScriptParentElement(){var e;return((e=document.getElementsByTagName("head"))==null?void 0:e[0])??document}_setExternalJSProvider({loadJS(e){return new Promise((i,s)=>{const a=document.createElement("script");a.setAttribute("src",e),a.onload=i,a.onerror=_=>{const et=_createError("internal-error");et.customData=_,s(et)},a.type="text/javascript",a.charset="UTF-8",getScriptParentElement().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});registerAuth("Browser");var define_process_env_default={};const name$2="@firebase/database",version$2="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let SDK_VERSION="";function setSDKVersion(e){SDK_VERSION=e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DOMStorageWrapper{constructor(i){this.domStorage_=i,this.prefix_="firebase:"}set(i,s){s==null?this.domStorage_.removeItem(this.prefixedName_(i)):this.domStorage_.setItem(this.prefixedName_(i),stringify(s))}get(i){const s=this.domStorage_.getItem(this.prefixedName_(i));return s==null?null:jsonEval(s)}remove(i){this.domStorage_.removeItem(this.prefixedName_(i))}prefixedName_(i){return this.prefix_+i}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MemoryStorage{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(i,s){s==null?delete this.cache_[i]:this.cache_[i]=s}get(i){return contains(this.cache_,i)?this.cache_[i]:null}remove(i){delete this.cache_[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const createStoragefor=function(e){try{if(typeof window<"u"&&typeof window[e]<"u"){const i=window[e];return i.setItem("firebase:sentinel","cache"),i.removeItem("firebase:sentinel"),new DOMStorageWrapper(i)}}catch{}return new MemoryStorage},PersistentStorage=createStoragefor("localStorage"),SessionStorage=createStoragefor("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logClient=new Logger("@firebase/database"),LUIDGenerator=function(){let e=1;return function(){return e++}}(),sha1=function(e){const i=stringToByteArray(e),s=new Sha1;s.update(i);const a=s.digest();return base64.encodeByteArray(a)},buildLogMessage_=function(...e){let i="";for(let s=0;s<e.length;s++){const a=e[s];Array.isArray(a)||a&&typeof a=="object"&&typeof a.length=="number"?i+=buildLogMessage_.apply(null,a):typeof a=="object"?i+=stringify(a):i+=a,i+=" "}return i};let logger=null,firstLog_=!0;const enableLogging$1=function(e,i){assert(!i,"Can't turn on custom loggers persistently."),logClient.logLevel=LogLevel.VERBOSE,logger=logClient.log.bind(logClient)},log=function(...e){if(firstLog_===!0&&(firstLog_=!1,logger===null&&SessionStorage.get("logging_enabled")===!0&&enableLogging$1()),logger){const i=buildLogMessage_.apply(null,e);logger(i)}},logWrapper=function(e){return function(...i){log(e,...i)}},error=function(...e){const i="FIREBASE INTERNAL ERROR: "+buildLogMessage_(...e);logClient.error(i)},fatal=function(...e){const i=`FIREBASE FATAL ERROR: ${buildLogMessage_(...e)}`;throw logClient.error(i),new Error(i)},warn=function(...e){const i="FIREBASE WARNING: "+buildLogMessage_(...e);logClient.warn(i)},warnIfPageIsSecure=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&warn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},isInvalidJSONNumber=function(e){return typeof e=="number"&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},executeWhenDOMReady=function(e){if(document.readyState==="complete")e();else{let i=!1;const s=function(){if(!document.body){setTimeout(s,Math.floor(10));return}i||(i=!0,e())};document.addEventListener?(document.addEventListener("DOMContentLoaded",s,!1),window.addEventListener("load",s,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&s()}),window.attachEvent("onload",s))}},MIN_NAME="[MIN_NAME]",MAX_NAME="[MAX_NAME]",nameCompare=function(e,i){if(e===i)return 0;if(e===MIN_NAME||i===MAX_NAME)return-1;if(i===MIN_NAME||e===MAX_NAME)return 1;{const s=tryParseInt(e),a=tryParseInt(i);return s!==null?a!==null?s-a===0?e.length-i.length:s-a:-1:a!==null?1:e<i?-1:1}},stringCompare=function(e,i){return e===i?0:e<i?-1:1},requireKey=function(e,i){if(i&&e in i)return i[e];throw new Error("Missing required key ("+e+") in object: "+stringify(i))},ObjectToUniqueKey=function(e){if(typeof e!="object"||e===null)return stringify(e);const i=[];for(const a in e)i.push(a);i.sort();let s="{";for(let a=0;a<i.length;a++)a!==0&&(s+=","),s+=stringify(i[a]),s+=":",s+=ObjectToUniqueKey(e[i[a]]);return s+="}",s},splitStringBySize=function(e,i){const s=e.length;if(s<=i)return[e];const a=[];for(let _=0;_<s;_+=i)_+i>s?a.push(e.substring(_,s)):a.push(e.substring(_,_+i));return a};function each(e,i){for(const s in e)e.hasOwnProperty(s)&&i(s,e[s])}const doubleToIEEE754String=function(e){assert(!isInvalidJSONNumber(e),"Invalid JSON number");const i=11,s=52,a=(1<<i-1)-1;let _,et,nt,c,ct;e===0?(et=0,nt=0,_=1/e===-1/0?1:0):(_=e<0,e=Math.abs(e),e>=Math.pow(2,1-a)?(c=Math.min(Math.floor(Math.log(e)/Math.LN2),a),et=c+a,nt=Math.round(e*Math.pow(2,s-c)-Math.pow(2,s))):(et=0,nt=Math.round(e/Math.pow(2,1-a-s))));const dt=[];for(ct=s;ct;ct-=1)dt.push(nt%2?1:0),nt=Math.floor(nt/2);for(ct=i;ct;ct-=1)dt.push(et%2?1:0),et=Math.floor(et/2);dt.push(_?1:0),dt.reverse();const gt=dt.join("");let Tt="";for(ct=0;ct<64;ct+=8){let Et=parseInt(gt.substr(ct,8),2).toString(16);Et.length===1&&(Et="0"+Et),Tt=Tt+Et}return Tt.toLowerCase()},isChromeExtensionContentScript=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},isWindowsStoreApp=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function errorForServerCode(e,i){let s="Unknown Error";e==="too_big"?s="The data requested exceeds the maximum size that can be accessed with a single request.":e==="permission_denied"?s="Client doesn't have permission to access the desired data.":e==="unavailable"&&(s="The service is unavailable");const a=new Error(e+" at "+i._path.toString()+": "+s);return a.code=e.toUpperCase(),a}const INTEGER_REGEXP_=new RegExp("^-?(0*)\\d{1,10}$"),INTEGER_32_MIN=-2147483648,INTEGER_32_MAX=2147483647,tryParseInt=function(e){if(INTEGER_REGEXP_.test(e)){const i=Number(e);if(i>=INTEGER_32_MIN&&i<=INTEGER_32_MAX)return i}return null},exceptionGuard=function(e){try{e()}catch(i){setTimeout(()=>{const s=i.stack||"";throw warn("Exception was thrown by user callback.",s),i},Math.floor(0))}},beingCrawled=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},setTimeoutNonBlocking=function(e,i){const s=setTimeout(e,i);return typeof s=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(s):typeof s=="object"&&s.unref&&s.unref(),s};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AppCheckTokenProvider{constructor(i,s){this.appCheckProvider=s,this.appName=i.name,_isFirebaseServerApp(i)&&i.settings.appCheckToken&&(this.serverAppAppCheckToken=i.settings.appCheckToken),this.appCheck=s==null?void 0:s.getImmediate({optional:!0}),this.appCheck||s==null||s.get().then(a=>this.appCheck=a)}getToken(i){if(this.serverAppAppCheckToken){if(i)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(i):new Promise((s,a)=>{setTimeout(()=>{this.appCheck?this.getToken(i).then(s,a):s(null)},0)})}addTokenChangeListener(i){var s;(s=this.appCheckProvider)==null||s.get().then(a=>a.addTokenListener(i))}notifyForInvalidToken(){warn(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FirebaseAuthTokenProvider{constructor(i,s,a){this.appName_=i,this.firebaseOptions_=s,this.authProvider_=a,this.auth_=null,this.auth_=a.getImmediate({optional:!0}),this.auth_||a.onInit(_=>this.auth_=_)}getToken(i){return this.auth_?this.auth_.getToken(i).catch(s=>s&&s.code==="auth/token-not-initialized"?(log("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(s)):new Promise((s,a)=>{setTimeout(()=>{this.auth_?this.getToken(i).then(s,a):s(null)},0)})}addTokenChangeListener(i){this.auth_?this.auth_.addAuthTokenListener(i):this.authProvider_.get().then(s=>s.addAuthTokenListener(i))}removeTokenChangeListener(i){this.authProvider_.get().then(s=>s.removeAuthTokenListener(i))}notifyForInvalidToken(){let i='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?i+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?i+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':i+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',warn(i)}}class EmulatorTokenProvider{constructor(i){this.accessToken=i}getToken(i){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(i){i(this.accessToken)}removeTokenChangeListener(i){}notifyForInvalidToken(){}}EmulatorTokenProvider.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PROTOCOL_VERSION="5",VERSION_PARAM="v",TRANSPORT_SESSION_PARAM="s",REFERER_PARAM="r",FORGE_REF="f",FORGE_DOMAIN_RE=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,LAST_SESSION_PARAM="ls",APPLICATION_ID_PARAM="p",APP_CHECK_TOKEN_PARAM="ac",WEBSOCKET="websocket",LONG_POLLING="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RepoInfo{constructor(i,s,a,_,et=!1,nt="",c=!1,ct=!1,dt=null){this.secure=s,this.namespace=a,this.webSocketOnly=_,this.nodeAdmin=et,this.persistenceKey=nt,this.includeNamespaceInQueryParams=c,this.isUsingEmulator=ct,this.emulatorOptions=dt,this._host=i.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=PersistentStorage.get("host:"+i)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(i){i!==this.internalHost&&(this.internalHost=i,this.isCacheableHost()&&PersistentStorage.set("host:"+this._host,this.internalHost))}toString(){let i=this.toURLString();return this.persistenceKey&&(i+="<"+this.persistenceKey+">"),i}toURLString(){const i=this.secure?"https://":"http://",s=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${i}${this.host}/${s}`}}function repoInfoNeedsQueryParam(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams}function repoInfoConnectionURL(e,i,s){assert(typeof i=="string","typeof type must == string"),assert(typeof s=="object","typeof params must == object");let a;if(i===WEBSOCKET)a=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(i===LONG_POLLING)a=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+i);repoInfoNeedsQueryParam(e)&&(s.ns=e.namespace);const _=[];return each(s,(et,nt)=>{_.push(et+"="+nt)}),a+_.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StatsCollection{constructor(){this.counters_={}}incrementCounter(i,s=1){contains(this.counters_,i)||(this.counters_[i]=0),this.counters_[i]+=s}get(){return deepCopy(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const collections={},reporters={};function statsManagerGetCollection(e){const i=e.toString();return collections[i]||(collections[i]=new StatsCollection),collections[i]}function statsManagerGetOrCreateReporter(e,i){const s=e.toString();return reporters[s]||(reporters[s]=i()),reporters[s]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PacketReceiver{constructor(i){this.onMessage_=i,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(i,s){this.closeAfterResponse=i,this.onClose=s,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(i,s){for(this.pendingResponses[i]=s;this.pendingResponses[this.currentResponseNum];){const a=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let _=0;_<a.length;++_)a[_]&&exceptionGuard(()=>{this.onMessage_(a[_])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FIREBASE_LONGPOLL_START_PARAM="start",FIREBASE_LONGPOLL_CLOSE_COMMAND="close",FIREBASE_LONGPOLL_COMMAND_CB_NAME="pLPCommand",FIREBASE_LONGPOLL_DATA_CB_NAME="pRTLPCB",FIREBASE_LONGPOLL_ID_PARAM="id",FIREBASE_LONGPOLL_PW_PARAM="pw",FIREBASE_LONGPOLL_SERIAL_PARAM="ser",FIREBASE_LONGPOLL_CALLBACK_ID_PARAM="cb",FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM="seg",FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET="ts",FIREBASE_LONGPOLL_DATA_PARAM="d",FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM="dframe",MAX_URL_DATA_SIZE=1870,SEG_HEADER_SIZE=30,MAX_PAYLOAD_SIZE=MAX_URL_DATA_SIZE-SEG_HEADER_SIZE,KEEPALIVE_REQUEST_INTERVAL=25e3,LP_CONNECT_TIMEOUT=3e4;class BrowserPollConnection{constructor(i,s,a,_,et,nt,c){this.connId=i,this.repoInfo=s,this.applicationId=a,this.appCheckToken=_,this.authToken=et,this.transportSessionId=nt,this.lastSessionId=c,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=logWrapper(i),this.stats_=statsManagerGetCollection(s),this.urlFn=ct=>(this.appCheckToken&&(ct[APP_CHECK_TOKEN_PARAM]=this.appCheckToken),repoInfoConnectionURL(s,LONG_POLLING,ct))}open(i,s){this.curSegmentNum=0,this.onDisconnect_=s,this.myPacketOrderer=new PacketReceiver(i),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(LP_CONNECT_TIMEOUT)),executeWhenDOMReady(()=>{if(this.isClosed_)return;this.scriptTagHolder=new FirebaseIFrameScriptHolder((...et)=>{const[nt,c,ct,dt,gt]=et;if(this.incrementIncomingBytes_(et),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,nt===FIREBASE_LONGPOLL_START_PARAM)this.id=c,this.password=ct;else if(nt===FIREBASE_LONGPOLL_CLOSE_COMMAND)c?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(c,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+nt)},(...et)=>{const[nt,c]=et;this.incrementIncomingBytes_(et),this.myPacketOrderer.handleResponse(nt,c)},()=>{this.onClosed_()},this.urlFn);const a={};a[FIREBASE_LONGPOLL_START_PARAM]="t",a[FIREBASE_LONGPOLL_SERIAL_PARAM]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(a[FIREBASE_LONGPOLL_CALLBACK_ID_PARAM]=this.scriptTagHolder.uniqueCallbackIdentifier),a[VERSION_PARAM]=PROTOCOL_VERSION,this.transportSessionId&&(a[TRANSPORT_SESSION_PARAM]=this.transportSessionId),this.lastSessionId&&(a[LAST_SESSION_PARAM]=this.lastSessionId),this.applicationId&&(a[APPLICATION_ID_PARAM]=this.applicationId),this.appCheckToken&&(a[APP_CHECK_TOKEN_PARAM]=this.appCheckToken),typeof location<"u"&&location.hostname&&FORGE_DOMAIN_RE.test(location.hostname)&&(a[REFERER_PARAM]=FORGE_REF);const _=this.urlFn(a);this.log_("Connecting via long-poll to "+_),this.scriptTagHolder.addTag(_,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){BrowserPollConnection.forceAllow_=!0}static forceDisallow(){BrowserPollConnection.forceDisallow_=!0}static isAvailable(){return BrowserPollConnection.forceAllow_?!0:!BrowserPollConnection.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!isChromeExtensionContentScript()&&!isWindowsStoreApp()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(i){const s=stringify(i);this.bytesSent+=s.length,this.stats_.incrementCounter("bytes_sent",s.length);const a=base64Encode(s),_=splitStringBySize(a,MAX_PAYLOAD_SIZE);for(let et=0;et<_.length;et++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,_.length,_[et]),this.curSegmentNum++}addDisconnectPingFrame(i,s){this.myDisconnFrame=document.createElement("iframe");const a={};a[FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM]="t",a[FIREBASE_LONGPOLL_ID_PARAM]=i,a[FIREBASE_LONGPOLL_PW_PARAM]=s,this.myDisconnFrame.src=this.urlFn(a),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(i){const s=stringify(i).length;this.bytesReceived+=s,this.stats_.incrementCounter("bytes_received",s)}}class FirebaseIFrameScriptHolder{constructor(i,s,a,_){this.onDisconnect=a,this.urlFn=_,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=LUIDGenerator(),window[FIREBASE_LONGPOLL_COMMAND_CB_NAME+this.uniqueCallbackIdentifier]=i,window[FIREBASE_LONGPOLL_DATA_CB_NAME+this.uniqueCallbackIdentifier]=s,this.myIFrame=FirebaseIFrameScriptHolder.createIFrame_();let et="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(et='<script>document.domain="'+document.domain+'";<\/script>');const nt="<html><body>"+et+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(nt),this.myIFrame.doc.close()}catch(c){log("frame writing exception"),c.stack&&log(c.stack),log(c)}}}static createIFrame_(){const i=document.createElement("iframe");if(i.style.display="none",document.body){document.body.appendChild(i);try{i.contentWindow.document||log("No IE domain setting required")}catch{const a=document.domain;i.src="javascript:void((function(){document.open();document.domain='"+a+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return i.contentDocument?i.doc=i.contentDocument:i.contentWindow?i.doc=i.contentWindow.document:i.document&&(i.doc=i.document),i}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const i=this.onDisconnect;i&&(this.onDisconnect=null,i())}startLongPoll(i,s){for(this.myID=i,this.myPW=s,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const i={};i[FIREBASE_LONGPOLL_ID_PARAM]=this.myID,i[FIREBASE_LONGPOLL_PW_PARAM]=this.myPW,i[FIREBASE_LONGPOLL_SERIAL_PARAM]=this.currentSerial;let s=this.urlFn(i),a="",_=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+SEG_HEADER_SIZE+a.length<=MAX_URL_DATA_SIZE;){const nt=this.pendingSegs.shift();a=a+"&"+FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM+_+"="+nt.seg+"&"+FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET+_+"="+nt.ts+"&"+FIREBASE_LONGPOLL_DATA_PARAM+_+"="+nt.d,_++}return s=s+a,this.addLongPollTag_(s,this.currentSerial),!0}else return!1}enqueueSegment(i,s,a){this.pendingSegs.push({seg:i,ts:s,d:a}),this.alive&&this.newRequest_()}addLongPollTag_(i,s){this.outstandingRequests.add(s);const a=()=>{this.outstandingRequests.delete(s),this.newRequest_()},_=setTimeout(a,Math.floor(KEEPALIVE_REQUEST_INTERVAL)),et=()=>{clearTimeout(_),a()};this.addTag(i,et)}addTag(i,s){setTimeout(()=>{try{if(!this.sendNewPolls)return;const a=this.myIFrame.doc.createElement("script");a.type="text/javascript",a.async=!0,a.src=i,a.onload=a.onreadystatechange=function(){const _=a.readyState;(!_||_==="loaded"||_==="complete")&&(a.onload=a.onreadystatechange=null,a.parentNode&&a.parentNode.removeChild(a),s())},a.onerror=()=>{log("Long-poll script failed to load: "+i),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(a)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WEBSOCKET_MAX_FRAME_SIZE=16384,WEBSOCKET_KEEPALIVE_INTERVAL=45e3;let WebSocketImpl=null;typeof MozWebSocket<"u"?WebSocketImpl=MozWebSocket:typeof WebSocket<"u"&&(WebSocketImpl=WebSocket);class WebSocketConnection{constructor(i,s,a,_,et,nt,c){this.connId=i,this.applicationId=a,this.appCheckToken=_,this.authToken=et,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=logWrapper(this.connId),this.stats_=statsManagerGetCollection(s),this.connURL=WebSocketConnection.connectionURL_(s,nt,c,_,a),this.nodeAdmin=s.nodeAdmin}static connectionURL_(i,s,a,_,et){const nt={};return nt[VERSION_PARAM]=PROTOCOL_VERSION,typeof location<"u"&&location.hostname&&FORGE_DOMAIN_RE.test(location.hostname)&&(nt[REFERER_PARAM]=FORGE_REF),s&&(nt[TRANSPORT_SESSION_PARAM]=s),a&&(nt[LAST_SESSION_PARAM]=a),_&&(nt[APP_CHECK_TOKEN_PARAM]=_),et&&(nt[APPLICATION_ID_PARAM]=et),repoInfoConnectionURL(i,WEBSOCKET,nt)}open(i,s){this.onDisconnect=s,this.onMessage=i,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,PersistentStorage.set("previous_websocket_failure",!0);try{let a;isNodeSdk(),this.mySock=new WebSocketImpl(this.connURL,[],a)}catch(a){this.log_("Error instantiating WebSocket.");const _=a.message||a.data;_&&this.log_(_),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=a=>{this.handleIncomingFrame(a)},this.mySock.onerror=a=>{this.log_("WebSocket error.  Closing connection.");const _=a.message||a.data;_&&this.log_(_),this.onClosed_()}}start(){}static forceDisallow(){WebSocketConnection.forceDisallow_=!0}static isAvailable(){let i=!1;if(typeof navigator<"u"&&navigator.userAgent){const s=/Android ([0-9]{0,}\.[0-9]{0,})/,a=navigator.userAgent.match(s);a&&a.length>1&&parseFloat(a[1])<4.4&&(i=!0)}return!i&&WebSocketImpl!==null&&!WebSocketConnection.forceDisallow_}static previouslyFailed(){return PersistentStorage.isInMemoryStorage||PersistentStorage.get("previous_websocket_failure")===!0}markConnectionHealthy(){PersistentStorage.remove("previous_websocket_failure")}appendFrame_(i){if(this.frames.push(i),this.frames.length===this.totalFrames){const s=this.frames.join("");this.frames=null;const a=jsonEval(s);this.onMessage(a)}}handleNewFrameCount_(i){this.totalFrames=i,this.frames=[]}extractFrameCount_(i){if(assert(this.frames===null,"We already have a frame buffer"),i.length<=6){const s=Number(i);if(!isNaN(s))return this.handleNewFrameCount_(s),null}return this.handleNewFrameCount_(1),i}handleIncomingFrame(i){if(this.mySock===null)return;const s=i.data;if(this.bytesReceived+=s.length,this.stats_.incrementCounter("bytes_received",s.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(s);else{const a=this.extractFrameCount_(s);a!==null&&this.appendFrame_(a)}}send(i){this.resetKeepAlive();const s=stringify(i);this.bytesSent+=s.length,this.stats_.incrementCounter("bytes_sent",s.length);const a=splitStringBySize(s,WEBSOCKET_MAX_FRAME_SIZE);a.length>1&&this.sendString_(String(a.length));for(let _=0;_<a.length;_++)this.sendString_(a[_])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(WEBSOCKET_KEEPALIVE_INTERVAL))}sendString_(i){try{this.mySock.send(i)}catch(s){this.log_("Exception thrown from WebSocket.send():",s.message||s.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}WebSocketConnection.responsesRequiredToBeHealthy=2;WebSocketConnection.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TransportManager{static get ALL_TRANSPORTS(){return[BrowserPollConnection,WebSocketConnection]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(i){this.initTransports_(i)}initTransports_(i){const s=WebSocketConnection&&WebSocketConnection.isAvailable();let a=s&&!WebSocketConnection.previouslyFailed();if(i.webSocketOnly&&(s||warn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),a=!0),a)this.transports_=[WebSocketConnection];else{const _=this.transports_=[];for(const et of TransportManager.ALL_TRANSPORTS)et&&et.isAvailable()&&_.push(et);TransportManager.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}TransportManager.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UPGRADE_TIMEOUT=6e4,DELAY_BEFORE_SENDING_EXTRA_REQUESTS=5e3,BYTES_SENT_HEALTHY_OVERRIDE=10*1024,BYTES_RECEIVED_HEALTHY_OVERRIDE=100*1024,MESSAGE_TYPE="t",MESSAGE_DATA="d",CONTROL_SHUTDOWN="s",CONTROL_RESET="r",CONTROL_ERROR="e",CONTROL_PONG="o",SWITCH_ACK="a",END_TRANSMISSION="n",PING="p",SERVER_HELLO="h";class Connection{constructor(i,s,a,_,et,nt,c,ct,dt,gt){this.id=i,this.repoInfo_=s,this.applicationId_=a,this.appCheckToken_=_,this.authToken_=et,this.onMessage_=nt,this.onReady_=c,this.onDisconnect_=ct,this.onKill_=dt,this.lastSessionId=gt,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=logWrapper("c:"+this.id+":"),this.transportManager_=new TransportManager(s),this.log_("Connection created"),this.start_()}start_(){const i=this.transportManager_.initialTransport();this.conn_=new i(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=i.responsesRequiredToBeHealthy||0;const s=this.connReceiver_(this.conn_),a=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(s,a)},Math.floor(0));const _=i.healthyTimeout||0;_>0&&(this.healthyTimeout_=setTimeoutNonBlocking(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>BYTES_RECEIVED_HEALTHY_OVERRIDE?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>BYTES_SENT_HEALTHY_OVERRIDE?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(_)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(i){return s=>{i===this.conn_?this.onConnectionLost_(s):i===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(i){return s=>{this.state_!==2&&(i===this.rx_?this.onPrimaryMessageReceived_(s):i===this.secondaryConn_?this.onSecondaryMessageReceived_(s):this.log_("message on old connection"))}}sendRequest(i){const s={t:"d",d:i};this.sendData_(s)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(i){if(MESSAGE_TYPE in i){const s=i[MESSAGE_TYPE];s===SWITCH_ACK?this.upgradeIfSecondaryHealthy_():s===CONTROL_RESET?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):s===CONTROL_PONG&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(i){const s=requireKey("t",i),a=requireKey("d",i);if(s==="c")this.onSecondaryControl_(a);else if(s==="d")this.pendingDataMessages.push(a);else throw new Error("Unknown protocol layer: "+s)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:PING,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:SWITCH_ACK,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:END_TRANSMISSION,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(i){const s=requireKey("t",i),a=requireKey("d",i);s==="c"?this.onControl_(a):s==="d"&&this.onDataMessage_(a)}onDataMessage_(i){this.onPrimaryResponse_(),this.onMessage_(i)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(i){const s=requireKey(MESSAGE_TYPE,i);if(MESSAGE_DATA in i){const a=i[MESSAGE_DATA];if(s===SERVER_HELLO){const _={...a};this.repoInfo_.isUsingEmulator&&(_.h=this.repoInfo_.host),this.onHandshake_(_)}else if(s===END_TRANSMISSION){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let _=0;_<this.pendingDataMessages.length;++_)this.onDataMessage_(this.pendingDataMessages[_]);this.pendingDataMessages=[],this.tryCleanupConnection()}else s===CONTROL_SHUTDOWN?this.onConnectionShutdown_(a):s===CONTROL_RESET?this.onReset_(a):s===CONTROL_ERROR?error("Server Error: "+a):s===CONTROL_PONG?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):error("Unknown control packet command: "+s)}}onHandshake_(i){const s=i.ts,a=i.v,_=i.h;this.sessionId=i.s,this.repoInfo_.host=_,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,s),PROTOCOL_VERSION!==a&&warn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const i=this.transportManager_.upgradeTransport();i&&this.startUpgrade_(i)}startUpgrade_(i){this.secondaryConn_=new i(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=i.responsesRequiredToBeHealthy||0;const s=this.connReceiver_(this.secondaryConn_),a=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(s,a),setTimeoutNonBlocking(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(UPGRADE_TIMEOUT))}onReset_(i){this.log_("Reset packet received.  New host: "+i),this.repoInfo_.host=i,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(i,s){this.log_("Realtime connection established."),this.conn_=i,this.state_=1,this.onReady_&&(this.onReady_(s,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):setTimeoutNonBlocking(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(DELAY_BEFORE_SENDING_EXTRA_REQUESTS))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:PING,d:{}}}))}onSecondaryConnectionLost_(){const i=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===i||this.rx_===i)&&this.close()}onConnectionLost_(i){this.conn_=null,!i&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(PersistentStorage.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(i){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(i),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(i){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(i)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ServerActions{put(i,s,a,_){}merge(i,s,a,_){}refreshAuthToken(i){}refreshAppCheckToken(i){}onDisconnectPut(i,s,a){}onDisconnectMerge(i,s,a){}onDisconnectCancel(i,s){}reportStats(i){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EventEmitter{constructor(i){this.allowedEvents_=i,this.listeners_={},assert(Array.isArray(i)&&i.length>0,"Requires a non-empty array")}trigger(i,...s){if(Array.isArray(this.listeners_[i])){const a=[...this.listeners_[i]];for(let _=0;_<a.length;_++)a[_].callback.apply(a[_].context,s)}}on(i,s,a){this.validateEventType_(i),this.listeners_[i]=this.listeners_[i]||[],this.listeners_[i].push({callback:s,context:a});const _=this.getInitialEvent(i);_&&s.apply(a,_)}off(i,s,a){this.validateEventType_(i);const _=this.listeners_[i]||[];for(let et=0;et<_.length;et++)if(_[et].callback===s&&(!a||a===_[et].context)){_.splice(et,1);return}}validateEventType_(i){assert(this.allowedEvents_.find(s=>s===i),"Unknown event: "+i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OnlineMonitor extends EventEmitter{static getInstance(){return new OnlineMonitor}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!isMobileCordova()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(i){return assert(i==="online","Unknown event type: "+i),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MAX_PATH_DEPTH=32,MAX_PATH_LENGTH_BYTES=768;class Path{constructor(i,s){if(s===void 0){this.pieces_=i.split("/");let a=0;for(let _=0;_<this.pieces_.length;_++)this.pieces_[_].length>0&&(this.pieces_[a]=this.pieces_[_],a++);this.pieces_.length=a,this.pieceNum_=0}else this.pieces_=i,this.pieceNum_=s}toString(){let i="";for(let s=this.pieceNum_;s<this.pieces_.length;s++)this.pieces_[s]!==""&&(i+="/"+this.pieces_[s]);return i||"/"}}function newEmptyPath(){return new Path("")}function pathGetFront(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function pathGetLength(e){return e.pieces_.length-e.pieceNum_}function pathPopFront(e){let i=e.pieceNum_;return i<e.pieces_.length&&i++,new Path(e.pieces_,i)}function pathGetBack(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function pathToUrlEncodedString(e){let i="";for(let s=e.pieceNum_;s<e.pieces_.length;s++)e.pieces_[s]!==""&&(i+="/"+encodeURIComponent(String(e.pieces_[s])));return i||"/"}function pathSlice(e,i=0){return e.pieces_.slice(e.pieceNum_+i)}function pathParent(e){if(e.pieceNum_>=e.pieces_.length)return null;const i=[];for(let s=e.pieceNum_;s<e.pieces_.length-1;s++)i.push(e.pieces_[s]);return new Path(i,0)}function pathChild(e,i){const s=[];for(let a=e.pieceNum_;a<e.pieces_.length;a++)s.push(e.pieces_[a]);if(i instanceof Path)for(let a=i.pieceNum_;a<i.pieces_.length;a++)s.push(i.pieces_[a]);else{const a=i.split("/");for(let _=0;_<a.length;_++)a[_].length>0&&s.push(a[_])}return new Path(s,0)}function pathIsEmpty(e){return e.pieceNum_>=e.pieces_.length}function newRelativePath(e,i){const s=pathGetFront(e),a=pathGetFront(i);if(s===null)return i;if(s===a)return newRelativePath(pathPopFront(e),pathPopFront(i));throw new Error("INTERNAL ERROR: innerPath ("+i+") is not within outerPath ("+e+")")}function pathCompare(e,i){const s=pathSlice(e,0),a=pathSlice(i,0);for(let _=0;_<s.length&&_<a.length;_++){const et=nameCompare(s[_],a[_]);if(et!==0)return et}return s.length===a.length?0:s.length<a.length?-1:1}function pathEquals(e,i){if(pathGetLength(e)!==pathGetLength(i))return!1;for(let s=e.pieceNum_,a=i.pieceNum_;s<=e.pieces_.length;s++,a++)if(e.pieces_[s]!==i.pieces_[a])return!1;return!0}function pathContains(e,i){let s=e.pieceNum_,a=i.pieceNum_;if(pathGetLength(e)>pathGetLength(i))return!1;for(;s<e.pieces_.length;){if(e.pieces_[s]!==i.pieces_[a])return!1;++s,++a}return!0}class ValidationPath{constructor(i,s){this.errorPrefix_=s,this.parts_=pathSlice(i,0),this.byteLength_=Math.max(1,this.parts_.length);for(let a=0;a<this.parts_.length;a++)this.byteLength_+=stringLength(this.parts_[a]);validationPathCheckValid(this)}}function validationPathPush(e,i){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(i),e.byteLength_+=stringLength(i),validationPathCheckValid(e)}function validationPathPop(e){const i=e.parts_.pop();e.byteLength_-=stringLength(i),e.parts_.length>0&&(e.byteLength_-=1)}function validationPathCheckValid(e){if(e.byteLength_>MAX_PATH_LENGTH_BYTES)throw new Error(e.errorPrefix_+"has a key path longer than "+MAX_PATH_LENGTH_BYTES+" bytes ("+e.byteLength_+").");if(e.parts_.length>MAX_PATH_DEPTH)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+MAX_PATH_DEPTH+") or object contains a cycle "+validationPathToErrorString(e))}function validationPathToErrorString(e){return e.parts_.length===0?"":"in property '"+e.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VisibilityMonitor extends EventEmitter{static getInstance(){return new VisibilityMonitor}constructor(){super(["visible"]);let i,s;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(s="visibilitychange",i="hidden"):typeof document.mozHidden<"u"?(s="mozvisibilitychange",i="mozHidden"):typeof document.msHidden<"u"?(s="msvisibilitychange",i="msHidden"):typeof document.webkitHidden<"u"&&(s="webkitvisibilitychange",i="webkitHidden")),this.visible_=!0,s&&document.addEventListener(s,()=>{const a=!document[i];a!==this.visible_&&(this.visible_=a,this.trigger("visible",a))},!1)}getInitialEvent(i){return assert(i==="visible","Unknown event type: "+i),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RECONNECT_MIN_DELAY=1e3,RECONNECT_MAX_DELAY_DEFAULT=60*5*1e3,RECONNECT_MAX_DELAY_FOR_ADMINS=30*1e3,RECONNECT_DELAY_MULTIPLIER=1.3,RECONNECT_DELAY_RESET_TIMEOUT=3e4,SERVER_KILL_INTERRUPT_REASON="server_kill",INVALID_TOKEN_THRESHOLD=3;class PersistentConnection extends ServerActions{constructor(i,s,a,_,et,nt,c,ct){if(super(),this.repoInfo_=i,this.applicationId_=s,this.onDataUpdate_=a,this.onConnectStatus_=_,this.onServerInfoUpdate_=et,this.authTokenProvider_=nt,this.appCheckTokenProvider_=c,this.authOverride_=ct,this.id=PersistentConnection.nextPersistentConnectionId_++,this.log_=logWrapper("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=RECONNECT_MIN_DELAY,this.maxReconnectDelay_=RECONNECT_MAX_DELAY_DEFAULT,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,ct&&!isNodeSdk())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");VisibilityMonitor.getInstance().on("visible",this.onVisible_,this),i.host.indexOf("fblocal")===-1&&OnlineMonitor.getInstance().on("online",this.onOnline_,this)}sendRequest(i,s,a){const _=++this.requestNumber_,et={r:_,a:i,b:s};this.log_(stringify(et)),assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(et),a&&(this.requestCBHash_[_]=a)}get(i){this.initConnection_();const s=new Deferred,_={action:"g",request:{p:i._path.toString(),q:i._queryObject},onComplete:nt=>{const c=nt.d;nt.s==="ok"?s.resolve(c):s.reject(c)}};this.outstandingGets_.push(_),this.outstandingGetCount_++;const et=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(et),s.promise}listen(i,s,a,_){this.initConnection_();const et=i._queryIdentifier,nt=i._path.toString();this.log_("Listen called for "+nt+" "+et),this.listens.has(nt)||this.listens.set(nt,new Map),assert(i._queryParams.isDefault()||!i._queryParams.loadsAllData(),"listen() called for non-default but complete query"),assert(!this.listens.get(nt).has(et),"listen() called twice for same path/queryId.");const c={onComplete:_,hashFn:s,query:i,tag:a};this.listens.get(nt).set(et,c),this.connected_&&this.sendListen_(c)}sendGet_(i){const s=this.outstandingGets_[i];this.sendRequest("g",s.request,a=>{delete this.outstandingGets_[i],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),s.onComplete&&s.onComplete(a)})}sendListen_(i){const s=i.query,a=s._path.toString(),_=s._queryIdentifier;this.log_("Listen on "+a+" for "+_);const et={p:a},nt="q";i.tag&&(et.q=s._queryObject,et.t=i.tag),et.h=i.hashFn(),this.sendRequest(nt,et,c=>{const ct=c.d,dt=c.s;PersistentConnection.warnOnListenWarnings_(ct,s),(this.listens.get(a)&&this.listens.get(a).get(_))===i&&(this.log_("listen response",c),dt!=="ok"&&this.removeListen_(a,_),i.onComplete&&i.onComplete(dt,ct))})}static warnOnListenWarnings_(i,s){if(i&&typeof i=="object"&&contains(i,"w")){const a=safeGet(i,"w");if(Array.isArray(a)&&~a.indexOf("no_index")){const _='".indexOn": "'+s._queryParams.getIndex().toString()+'"',et=s._path.toString();warn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${_} at ${et} to your security rules for better performance.`)}}}refreshAuthToken(i){this.authToken_=i,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(i)}reduceReconnectDelayIfAdminCredential_(i){(i&&i.length===40||isAdmin(i))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS)}refreshAppCheckToken(i){this.appCheckToken_=i,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const i=this.authToken_,s=isValidFormat(i)?"auth":"gauth",a={cred:i};this.authOverride_===null?a.noauth=!0:typeof this.authOverride_=="object"&&(a.authvar=this.authOverride_),this.sendRequest(s,a,_=>{const et=_.s,nt=_.d||"error";this.authToken_===i&&(et==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(et,nt))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},i=>{const s=i.s,a=i.d||"error";s==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(s,a)})}unlisten(i,s){const a=i._path.toString(),_=i._queryIdentifier;this.log_("Unlisten called for "+a+" "+_),assert(i._queryParams.isDefault()||!i._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(a,_)&&this.connected_&&this.sendUnlisten_(a,_,i._queryObject,s)}sendUnlisten_(i,s,a,_){this.log_("Unlisten on "+i+" for "+s);const et={p:i},nt="n";_&&(et.q=a,et.t=_),this.sendRequest(nt,et)}onDisconnectPut(i,s,a){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",i,s,a):this.onDisconnectRequestQueue_.push({pathString:i,action:"o",data:s,onComplete:a})}onDisconnectMerge(i,s,a){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",i,s,a):this.onDisconnectRequestQueue_.push({pathString:i,action:"om",data:s,onComplete:a})}onDisconnectCancel(i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",i,null,s):this.onDisconnectRequestQueue_.push({pathString:i,action:"oc",data:null,onComplete:s})}sendOnDisconnect_(i,s,a,_){const et={p:s,d:a};this.log_("onDisconnect "+i,et),this.sendRequest(i,et,nt=>{_&&setTimeout(()=>{_(nt.s,nt.d)},Math.floor(0))})}put(i,s,a,_){this.putInternal("p",i,s,a,_)}merge(i,s,a,_){this.putInternal("m",i,s,a,_)}putInternal(i,s,a,_,et){this.initConnection_();const nt={p:s,d:a};et!==void 0&&(nt.h=et),this.outstandingPuts_.push({action:i,request:nt,onComplete:_}),this.outstandingPutCount_++;const c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+s)}sendPut_(i){const s=this.outstandingPuts_[i].action,a=this.outstandingPuts_[i].request,_=this.outstandingPuts_[i].onComplete;this.outstandingPuts_[i].queued=this.connected_,this.sendRequest(s,a,et=>{this.log_(s+" response",et),delete this.outstandingPuts_[i],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),_&&_(et.s,et.d)})}reportStats(i){if(this.connected_){const s={c:i};this.log_("reportStats",s),this.sendRequest("s",s,a=>{if(a.s!=="ok"){const et=a.d;this.log_("reportStats","Error sending stats: "+et)}})}}onDataMessage_(i){if("r"in i){this.log_("from server: "+stringify(i));const s=i.r,a=this.requestCBHash_[s];a&&(delete this.requestCBHash_[s],a(i.b))}else{if("error"in i)throw"A server-side error has occurred: "+i.error;"a"in i&&this.onDataPush_(i.a,i.b)}}onDataPush_(i,s){this.log_("handleServerMessage",i,s),i==="d"?this.onDataUpdate_(s.p,s.d,!1,s.t):i==="m"?this.onDataUpdate_(s.p,s.d,!0,s.t):i==="c"?this.onListenRevoked_(s.p,s.q):i==="ac"?this.onAuthRevoked_(s.s,s.d):i==="apc"?this.onAppCheckRevoked_(s.s,s.d):i==="sd"?this.onSecurityDebugPacket_(s):error("Unrecognized action received from server: "+stringify(i)+`
Are you using the latest client?`)}onReady_(i,s){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(i),this.lastSessionId=s,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(i){assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(i))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(i){i&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)),this.visible_=i}onOnline_(i){i?(this.log_("Browser went online."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>RECONNECT_DELAY_RESET_TIMEOUT&&(this.reconnectDelay_=RECONNECT_MIN_DELAY),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const i=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let s=Math.max(0,this.reconnectDelay_-i);s=Math.random()*s,this.log_("Trying to reconnect in "+s+"ms"),this.scheduleConnect_(s),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*RECONNECT_DELAY_MULTIPLIER)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const i=this.onDataMessage_.bind(this),s=this.onReady_.bind(this),a=this.onRealtimeDisconnect_.bind(this),_=this.id+":"+PersistentConnection.nextConnectionId_++,et=this.lastSessionId;let nt=!1,c=null;const ct=function(){c?c.close():(nt=!0,a())},dt=function(Tt){assert(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(Tt)};this.realtime_={close:ct,sendRequest:dt};const gt=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[Tt,Et]=await Promise.all([this.authTokenProvider_.getToken(gt),this.appCheckTokenProvider_.getToken(gt)]);nt?log("getToken() completed but was canceled"):(log("getToken() completed. Creating connection."),this.authToken_=Tt&&Tt.accessToken,this.appCheckToken_=Et&&Et.token,c=new Connection(_,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,i,s,a,At=>{warn(At+" ("+this.repoInfo_.toString()+")"),this.interrupt(SERVER_KILL_INTERRUPT_REASON)},et))}catch(Tt){this.log_("Failed to get token: "+Tt),nt||(this.repoInfo_.nodeAdmin&&warn(Tt),ct())}}}interrupt(i){log("Interrupting connection for reason: "+i),this.interruptReasons_[i]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(i){log("Resuming connection for reason: "+i),delete this.interruptReasons_[i],isEmpty(this.interruptReasons_)&&(this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(i){const s=i-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:s})}cancelSentTransactions_(){for(let i=0;i<this.outstandingPuts_.length;i++){const s=this.outstandingPuts_[i];s&&"h"in s.request&&s.queued&&(s.onComplete&&s.onComplete("disconnect"),delete this.outstandingPuts_[i],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(i,s){let a;s?a=s.map(et=>ObjectToUniqueKey(et)).join("$"):a="default";const _=this.removeListen_(i,a);_&&_.onComplete&&_.onComplete("permission_denied")}removeListen_(i,s){const a=new Path(i).toString();let _;if(this.listens.has(a)){const et=this.listens.get(a);_=et.get(s),et.delete(s),et.size===0&&this.listens.delete(a)}else _=void 0;return _}onAuthRevoked_(i,s){log("Auth token revoked: "+i+"/"+s),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(i==="invalid_token"||i==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=INVALID_TOKEN_THRESHOLD&&(this.reconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(i,s){log("App check token revoked: "+i+"/"+s),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(i==="invalid_token"||i==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=INVALID_TOKEN_THRESHOLD&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(i){this.securityDebugCallback_?this.securityDebugCallback_(i):"msg"in i&&console.log("FIREBASE: "+i.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const i of this.listens.values())for(const s of i.values())this.sendListen_(s);for(let i=0;i<this.outstandingPuts_.length;i++)this.outstandingPuts_[i]&&this.sendPut_(i);for(;this.onDisconnectRequestQueue_.length;){const i=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(i.action,i.pathString,i.data,i.onComplete)}for(let i=0;i<this.outstandingGets_.length;i++)this.outstandingGets_[i]&&this.sendGet_(i)}sendConnectStats_(){const i={};let s="js";i["sdk."+s+"."+SDK_VERSION.replace(/\./g,"-")]=1,isMobileCordova()?i["framework.cordova"]=1:isReactNative()&&(i["framework.reactnative"]=1),this.reportStats(i)}shouldReconnect_(){const i=OnlineMonitor.getInstance().currentlyOnline();return isEmpty(this.interruptReasons_)&&i}}PersistentConnection.nextPersistentConnectionId_=0;PersistentConnection.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NamedNode{constructor(i,s){this.name=i,this.node=s}static Wrap(i,s){return new NamedNode(i,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Index{getCompare(){return this.compare.bind(this)}indexedValueChanged(i,s){const a=new NamedNode(MIN_NAME,i),_=new NamedNode(MIN_NAME,s);return this.compare(a,_)!==0}minPost(){return NamedNode.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let __EMPTY_NODE;class KeyIndex extends Index{static get __EMPTY_NODE(){return __EMPTY_NODE}static set __EMPTY_NODE(i){__EMPTY_NODE=i}compare(i,s){return nameCompare(i.name,s.name)}isDefinedOn(i){throw assertionError("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(i,s){return!1}minPost(){return NamedNode.MIN}maxPost(){return new NamedNode(MAX_NAME,__EMPTY_NODE)}makePost(i,s){return assert(typeof i=="string","KeyIndex indexValue must always be a string."),new NamedNode(i,__EMPTY_NODE)}toString(){return".key"}}const KEY_INDEX=new KeyIndex;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SortedMapIterator{constructor(i,s,a,_,et=null){this.isReverse_=_,this.resultGenerator_=et,this.nodeStack_=[];let nt=1;for(;!i.isEmpty();)if(i=i,nt=s?a(i.key,s):1,_&&(nt*=-1),nt<0)this.isReverse_?i=i.left:i=i.right;else if(nt===0){this.nodeStack_.push(i);break}else this.nodeStack_.push(i),this.isReverse_?i=i.right:i=i.left}getNext(){if(this.nodeStack_.length===0)return null;let i=this.nodeStack_.pop(),s;if(this.resultGenerator_?s=this.resultGenerator_(i.key,i.value):s={key:i.key,value:i.value},this.isReverse_)for(i=i.left;!i.isEmpty();)this.nodeStack_.push(i),i=i.right;else for(i=i.right;!i.isEmpty();)this.nodeStack_.push(i),i=i.left;return s}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const i=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(i.key,i.value):{key:i.key,value:i.value}}}class LLRBNode{constructor(i,s,a,_,et){this.key=i,this.value=s,this.color=a??LLRBNode.RED,this.left=_??SortedMap.EMPTY_NODE,this.right=et??SortedMap.EMPTY_NODE}copy(i,s,a,_,et){return new LLRBNode(i??this.key,s??this.value,a??this.color,_??this.left,et??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(i){return this.left.inorderTraversal(i)||!!i(this.key,this.value)||this.right.inorderTraversal(i)}reverseTraversal(i){return this.right.reverseTraversal(i)||i(this.key,this.value)||this.left.reverseTraversal(i)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(i,s,a){let _=this;const et=a(i,_.key);return et<0?_=_.copy(null,null,null,_.left.insert(i,s,a),null):et===0?_=_.copy(null,s,null,null,null):_=_.copy(null,null,null,null,_.right.insert(i,s,a)),_.fixUp_()}removeMin_(){if(this.left.isEmpty())return SortedMap.EMPTY_NODE;let i=this;return!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.removeMin_(),null),i.fixUp_()}remove(i,s){let a,_;if(a=this,s(i,a.key)<0)!a.left.isEmpty()&&!a.left.isRed_()&&!a.left.left.isRed_()&&(a=a.moveRedLeft_()),a=a.copy(null,null,null,a.left.remove(i,s),null);else{if(a.left.isRed_()&&(a=a.rotateRight_()),!a.right.isEmpty()&&!a.right.isRed_()&&!a.right.left.isRed_()&&(a=a.moveRedRight_()),s(i,a.key)===0){if(a.right.isEmpty())return SortedMap.EMPTY_NODE;_=a.right.min_(),a=a.copy(_.key,_.value,null,null,a.right.removeMin_())}a=a.copy(null,null,null,null,a.right.remove(i,s))}return a.fixUp_()}isRed_(){return this.color}fixUp_(){let i=this;return i.right.isRed_()&&!i.left.isRed_()&&(i=i.rotateLeft_()),i.left.isRed_()&&i.left.left.isRed_()&&(i=i.rotateRight_()),i.left.isRed_()&&i.right.isRed_()&&(i=i.colorFlip_()),i}moveRedLeft_(){let i=this.colorFlip_();return i.right.left.isRed_()&&(i=i.copy(null,null,null,null,i.right.rotateRight_()),i=i.rotateLeft_(),i=i.colorFlip_()),i}moveRedRight_(){let i=this.colorFlip_();return i.left.left.isRed_()&&(i=i.rotateRight_(),i=i.colorFlip_()),i}rotateLeft_(){const i=this.copy(null,null,LLRBNode.RED,null,this.right.left);return this.right.copy(null,null,this.color,i,null)}rotateRight_(){const i=this.copy(null,null,LLRBNode.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,i)}colorFlip_(){const i=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,i,s)}checkMaxDepth_(){const i=this.check_();return Math.pow(2,i)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const i=this.left.check_();if(i!==this.right.check_())throw new Error("Black depths differ");return i+(this.isRed_()?0:1)}}LLRBNode.RED=!0;LLRBNode.BLACK=!1;class LLRBEmptyNode{copy(i,s,a,_,et){return this}insert(i,s,a){return new LLRBNode(i,s,null)}remove(i,s){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(i){return!1}reverseTraversal(i){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class SortedMap{constructor(i,s=SortedMap.EMPTY_NODE){this.comparator_=i,this.root_=s}insert(i,s){return new SortedMap(this.comparator_,this.root_.insert(i,s,this.comparator_).copy(null,null,LLRBNode.BLACK,null,null))}remove(i){return new SortedMap(this.comparator_,this.root_.remove(i,this.comparator_).copy(null,null,LLRBNode.BLACK,null,null))}get(i){let s,a=this.root_;for(;!a.isEmpty();){if(s=this.comparator_(i,a.key),s===0)return a.value;s<0?a=a.left:s>0&&(a=a.right)}return null}getPredecessorKey(i){let s,a=this.root_,_=null;for(;!a.isEmpty();)if(s=this.comparator_(i,a.key),s===0){if(a.left.isEmpty())return _?_.key:null;for(a=a.left;!a.right.isEmpty();)a=a.right;return a.key}else s<0?a=a.left:s>0&&(_=a,a=a.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(i){return this.root_.inorderTraversal(i)}reverseTraversal(i){return this.root_.reverseTraversal(i)}getIterator(i){return new SortedMapIterator(this.root_,null,this.comparator_,!1,i)}getIteratorFrom(i,s){return new SortedMapIterator(this.root_,i,this.comparator_,!1,s)}getReverseIteratorFrom(i,s){return new SortedMapIterator(this.root_,i,this.comparator_,!0,s)}getReverseIterator(i){return new SortedMapIterator(this.root_,null,this.comparator_,!0,i)}}SortedMap.EMPTY_NODE=new LLRBEmptyNode;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NAME_ONLY_COMPARATOR(e,i){return nameCompare(e.name,i.name)}function NAME_COMPARATOR(e,i){return nameCompare(e,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let MAX_NODE$2;function setMaxNode$1(e){MAX_NODE$2=e}const priorityHashText=function(e){return typeof e=="number"?"number:"+doubleToIEEE754String(e):"string:"+e},validatePriorityNode=function(e){if(e.isLeafNode()){const i=e.val();assert(typeof i=="string"||typeof i=="number"||typeof i=="object"&&contains(i,".sv"),"Priority must be a string or number.")}else assert(e===MAX_NODE$2||e.isEmpty(),"priority of unexpected type.");assert(e===MAX_NODE$2||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let __childrenNodeConstructor;class LeafNode{static set __childrenNodeConstructor(i){__childrenNodeConstructor=i}static get __childrenNodeConstructor(){return __childrenNodeConstructor}constructor(i,s=LeafNode.__childrenNodeConstructor.EMPTY_NODE){this.value_=i,this.priorityNode_=s,this.lazyHash_=null,assert(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),validatePriorityNode(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(i){return new LeafNode(this.value_,i)}getImmediateChild(i){return i===".priority"?this.priorityNode_:LeafNode.__childrenNodeConstructor.EMPTY_NODE}getChild(i){return pathIsEmpty(i)?this:pathGetFront(i)===".priority"?this.priorityNode_:LeafNode.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(i,s){return null}updateImmediateChild(i,s){return i===".priority"?this.updatePriority(s):s.isEmpty()&&i!==".priority"?this:LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(i,s).updatePriority(this.priorityNode_)}updateChild(i,s){const a=pathGetFront(i);return a===null?s:s.isEmpty()&&a!==".priority"?this:(assert(a!==".priority"||pathGetLength(i)===1,".priority must be the last token in a path"),this.updateImmediateChild(a,LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateChild(pathPopFront(i),s)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(i,s){return!1}val(i){return i&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let i="";this.priorityNode_.isEmpty()||(i+="priority:"+priorityHashText(this.priorityNode_.val())+":");const s=typeof this.value_;i+=s+":",s==="number"?i+=doubleToIEEE754String(this.value_):i+=this.value_,this.lazyHash_=sha1(i)}return this.lazyHash_}getValue(){return this.value_}compareTo(i){return i===LeafNode.__childrenNodeConstructor.EMPTY_NODE?1:i instanceof LeafNode.__childrenNodeConstructor?-1:(assert(i.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(i))}compareToLeafNode_(i){const s=typeof i.value_,a=typeof this.value_,_=LeafNode.VALUE_TYPE_ORDER.indexOf(s),et=LeafNode.VALUE_TYPE_ORDER.indexOf(a);return assert(_>=0,"Unknown leaf type: "+s),assert(et>=0,"Unknown leaf type: "+a),_===et?a==="object"?0:this.value_<i.value_?-1:this.value_===i.value_?0:1:et-_}withIndex(){return this}isIndexed(){return!0}equals(i){if(i===this)return!0;if(i.isLeafNode()){const s=i;return this.value_===s.value_&&this.priorityNode_.equals(s.priorityNode_)}else return!1}}LeafNode.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nodeFromJSON$1,MAX_NODE$1;function setNodeFromJSON(e){nodeFromJSON$1=e}function setMaxNode(e){MAX_NODE$1=e}class PriorityIndex extends Index{compare(i,s){const a=i.node.getPriority(),_=s.node.getPriority(),et=a.compareTo(_);return et===0?nameCompare(i.name,s.name):et}isDefinedOn(i){return!i.getPriority().isEmpty()}indexedValueChanged(i,s){return!i.getPriority().equals(s.getPriority())}minPost(){return NamedNode.MIN}maxPost(){return new NamedNode(MAX_NAME,new LeafNode("[PRIORITY-POST]",MAX_NODE$1))}makePost(i,s){const a=nodeFromJSON$1(i);return new NamedNode(s,new LeafNode("[PRIORITY-POST]",a))}toString(){return".priority"}}const PRIORITY_INDEX=new PriorityIndex;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LOG_2=Math.log(2);class Base12Num{constructor(i){const s=et=>parseInt(Math.log(et)/LOG_2,10),a=et=>parseInt(Array(et+1).join("1"),2);this.count=s(i+1),this.current_=this.count-1;const _=a(this.count);this.bits_=i+1&_}nextBitIsOne(){const i=!(this.bits_&1<<this.current_);return this.current_--,i}}const buildChildSet=function(e,i,s,a){e.sort(i);const _=function(ct,dt){const gt=dt-ct;let Tt,Et;if(gt===0)return null;if(gt===1)return Tt=e[ct],Et=s?s(Tt):Tt,new LLRBNode(Et,Tt.node,LLRBNode.BLACK,null,null);{const At=parseInt(gt/2,10)+ct,Mt=_(ct,At),Pt=_(At+1,dt);return Tt=e[At],Et=s?s(Tt):Tt,new LLRBNode(Et,Tt.node,LLRBNode.BLACK,Mt,Pt)}},et=function(ct){let dt=null,gt=null,Tt=e.length;const Et=function(Mt,Pt){const $t=Tt-Mt,Lt=Tt;Tt-=Mt;const Bt=_($t+1,Lt),Nt=e[$t],Vt=s?s(Nt):Nt;At(new LLRBNode(Vt,Nt.node,Pt,null,Bt))},At=function(Mt){dt?(dt.left=Mt,dt=Mt):(gt=Mt,dt=Mt)};for(let Mt=0;Mt<ct.count;++Mt){const Pt=ct.nextBitIsOne(),$t=Math.pow(2,ct.count-(Mt+1));Pt?Et($t,LLRBNode.BLACK):(Et($t,LLRBNode.BLACK),Et($t,LLRBNode.RED))}return gt},nt=new Base12Num(e.length),c=et(nt);return new SortedMap(a||i,c)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _defaultIndexMap;const fallbackObject={};class IndexMap{static get Default(){return assert(fallbackObject&&PRIORITY_INDEX,"ChildrenNode.ts has not been loaded"),_defaultIndexMap=_defaultIndexMap||new IndexMap({".priority":fallbackObject},{".priority":PRIORITY_INDEX}),_defaultIndexMap}constructor(i,s){this.indexes_=i,this.indexSet_=s}get(i){const s=safeGet(this.indexes_,i);if(!s)throw new Error("No index defined for "+i);return s instanceof SortedMap?s:null}hasIndex(i){return contains(this.indexSet_,i.toString())}addIndex(i,s){assert(i!==KEY_INDEX,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const a=[];let _=!1;const et=s.getIterator(NamedNode.Wrap);let nt=et.getNext();for(;nt;)_=_||i.isDefinedOn(nt.node),a.push(nt),nt=et.getNext();let c;_?c=buildChildSet(a,i.getCompare()):c=fallbackObject;const ct=i.toString(),dt={...this.indexSet_};dt[ct]=i;const gt={...this.indexes_};return gt[ct]=c,new IndexMap(gt,dt)}addToIndexes(i,s){const a=map(this.indexes_,(_,et)=>{const nt=safeGet(this.indexSet_,et);if(assert(nt,"Missing index implementation for "+et),_===fallbackObject)if(nt.isDefinedOn(i.node)){const c=[],ct=s.getIterator(NamedNode.Wrap);let dt=ct.getNext();for(;dt;)dt.name!==i.name&&c.push(dt),dt=ct.getNext();return c.push(i),buildChildSet(c,nt.getCompare())}else return fallbackObject;else{const c=s.get(i.name);let ct=_;return c&&(ct=ct.remove(new NamedNode(i.name,c))),ct.insert(i,i.node)}});return new IndexMap(a,this.indexSet_)}removeFromIndexes(i,s){const a=map(this.indexes_,_=>{if(_===fallbackObject)return _;{const et=s.get(i.name);return et?_.remove(new NamedNode(i.name,et)):_}});return new IndexMap(a,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let EMPTY_NODE;class ChildrenNode{static get EMPTY_NODE(){return EMPTY_NODE||(EMPTY_NODE=new ChildrenNode(new SortedMap(NAME_COMPARATOR),null,IndexMap.Default))}constructor(i,s,a){this.children_=i,this.priorityNode_=s,this.indexMap_=a,this.lazyHash_=null,this.priorityNode_&&validatePriorityNode(this.priorityNode_),this.children_.isEmpty()&&assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||EMPTY_NODE}updatePriority(i){return this.children_.isEmpty()?this:new ChildrenNode(this.children_,i,this.indexMap_)}getImmediateChild(i){if(i===".priority")return this.getPriority();{const s=this.children_.get(i);return s===null?EMPTY_NODE:s}}getChild(i){const s=pathGetFront(i);return s===null?this:this.getImmediateChild(s).getChild(pathPopFront(i))}hasChild(i){return this.children_.get(i)!==null}updateImmediateChild(i,s){if(assert(s,"We should always be passing snapshot nodes"),i===".priority")return this.updatePriority(s);{const a=new NamedNode(i,s);let _,et;s.isEmpty()?(_=this.children_.remove(i),et=this.indexMap_.removeFromIndexes(a,this.children_)):(_=this.children_.insert(i,s),et=this.indexMap_.addToIndexes(a,this.children_));const nt=_.isEmpty()?EMPTY_NODE:this.priorityNode_;return new ChildrenNode(_,nt,et)}}updateChild(i,s){const a=pathGetFront(i);if(a===null)return s;{assert(pathGetFront(i)!==".priority"||pathGetLength(i)===1,".priority must be the last token in a path");const _=this.getImmediateChild(a).updateChild(pathPopFront(i),s);return this.updateImmediateChild(a,_)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(i){if(this.isEmpty())return null;const s={};let a=0,_=0,et=!0;if(this.forEachChild(PRIORITY_INDEX,(nt,c)=>{s[nt]=c.val(i),a++,et&&ChildrenNode.INTEGER_REGEXP_.test(nt)?_=Math.max(_,Number(nt)):et=!1}),!i&&et&&_<2*a){const nt=[];for(const c in s)nt[c]=s[c];return nt}else return i&&!this.getPriority().isEmpty()&&(s[".priority"]=this.getPriority().val()),s}hash(){if(this.lazyHash_===null){let i="";this.getPriority().isEmpty()||(i+="priority:"+priorityHashText(this.getPriority().val())+":"),this.forEachChild(PRIORITY_INDEX,(s,a)=>{const _=a.hash();_!==""&&(i+=":"+s+":"+_)}),this.lazyHash_=i===""?"":sha1(i)}return this.lazyHash_}getPredecessorChildName(i,s,a){const _=this.resolveIndex_(a);if(_){const et=_.getPredecessorKey(new NamedNode(i,s));return et?et.name:null}else return this.children_.getPredecessorKey(i)}getFirstChildName(i){const s=this.resolveIndex_(i);if(s){const a=s.minKey();return a&&a.name}else return this.children_.minKey()}getFirstChild(i){const s=this.getFirstChildName(i);return s?new NamedNode(s,this.children_.get(s)):null}getLastChildName(i){const s=this.resolveIndex_(i);if(s){const a=s.maxKey();return a&&a.name}else return this.children_.maxKey()}getLastChild(i){const s=this.getLastChildName(i);return s?new NamedNode(s,this.children_.get(s)):null}forEachChild(i,s){const a=this.resolveIndex_(i);return a?a.inorderTraversal(_=>s(_.name,_.node)):this.children_.inorderTraversal(s)}getIterator(i){return this.getIteratorFrom(i.minPost(),i)}getIteratorFrom(i,s){const a=this.resolveIndex_(s);if(a)return a.getIteratorFrom(i,_=>_);{const _=this.children_.getIteratorFrom(i.name,NamedNode.Wrap);let et=_.peek();for(;et!=null&&s.compare(et,i)<0;)_.getNext(),et=_.peek();return _}}getReverseIterator(i){return this.getReverseIteratorFrom(i.maxPost(),i)}getReverseIteratorFrom(i,s){const a=this.resolveIndex_(s);if(a)return a.getReverseIteratorFrom(i,_=>_);{const _=this.children_.getReverseIteratorFrom(i.name,NamedNode.Wrap);let et=_.peek();for(;et!=null&&s.compare(et,i)>0;)_.getNext(),et=_.peek();return _}}compareTo(i){return this.isEmpty()?i.isEmpty()?0:-1:i.isLeafNode()||i.isEmpty()?1:i===MAX_NODE?-1:0}withIndex(i){if(i===KEY_INDEX||this.indexMap_.hasIndex(i))return this;{const s=this.indexMap_.addIndex(i,this.children_);return new ChildrenNode(this.children_,this.priorityNode_,s)}}isIndexed(i){return i===KEY_INDEX||this.indexMap_.hasIndex(i)}equals(i){if(i===this)return!0;if(i.isLeafNode())return!1;{const s=i;if(this.getPriority().equals(s.getPriority()))if(this.children_.count()===s.children_.count()){const a=this.getIterator(PRIORITY_INDEX),_=s.getIterator(PRIORITY_INDEX);let et=a.getNext(),nt=_.getNext();for(;et&&nt;){if(et.name!==nt.name||!et.node.equals(nt.node))return!1;et=a.getNext(),nt=_.getNext()}return et===null&&nt===null}else return!1;else return!1}}resolveIndex_(i){return i===KEY_INDEX?null:this.indexMap_.get(i.toString())}}ChildrenNode.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class MaxNode extends ChildrenNode{constructor(){super(new SortedMap(NAME_COMPARATOR),ChildrenNode.EMPTY_NODE,IndexMap.Default)}compareTo(i){return i===this?0:1}equals(i){return i===this}getPriority(){return this}getImmediateChild(i){return ChildrenNode.EMPTY_NODE}isEmpty(){return!1}}const MAX_NODE=new MaxNode;Object.defineProperties(NamedNode,{MIN:{value:new NamedNode(MIN_NAME,ChildrenNode.EMPTY_NODE)},MAX:{value:new NamedNode(MAX_NAME,MAX_NODE)}});KeyIndex.__EMPTY_NODE=ChildrenNode.EMPTY_NODE;LeafNode.__childrenNodeConstructor=ChildrenNode;setMaxNode$1(MAX_NODE);setMaxNode(MAX_NODE);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const USE_HINZE=!0;function nodeFromJSON(e,i=null){if(e===null)return ChildrenNode.EMPTY_NODE;if(typeof e=="object"&&".priority"in e&&(i=e[".priority"]),assert(i===null||typeof i=="string"||typeof i=="number"||typeof i=="object"&&".sv"in i,"Invalid priority type found: "+typeof i),typeof e=="object"&&".value"in e&&e[".value"]!==null&&(e=e[".value"]),typeof e!="object"||".sv"in e){const s=e;return new LeafNode(s,nodeFromJSON(i))}if(!(e instanceof Array)&&USE_HINZE){const s=[];let a=!1;if(each(e,(nt,c)=>{if(nt.substring(0,1)!=="."){const ct=nodeFromJSON(c);ct.isEmpty()||(a=a||!ct.getPriority().isEmpty(),s.push(new NamedNode(nt,ct)))}}),s.length===0)return ChildrenNode.EMPTY_NODE;const et=buildChildSet(s,NAME_ONLY_COMPARATOR,nt=>nt.name,NAME_COMPARATOR);if(a){const nt=buildChildSet(s,PRIORITY_INDEX.getCompare());return new ChildrenNode(et,nodeFromJSON(i),new IndexMap({".priority":nt},{".priority":PRIORITY_INDEX}))}else return new ChildrenNode(et,nodeFromJSON(i),IndexMap.Default)}else{let s=ChildrenNode.EMPTY_NODE;return each(e,(a,_)=>{if(contains(e,a)&&a.substring(0,1)!=="."){const et=nodeFromJSON(_);(et.isLeafNode()||!et.isEmpty())&&(s=s.updateImmediateChild(a,et))}}),s.updatePriority(nodeFromJSON(i))}}setNodeFromJSON(nodeFromJSON);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PathIndex extends Index{constructor(i){super(),this.indexPath_=i,assert(!pathIsEmpty(i)&&pathGetFront(i)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(i){return i.getChild(this.indexPath_)}isDefinedOn(i){return!i.getChild(this.indexPath_).isEmpty()}compare(i,s){const a=this.extractChild(i.node),_=this.extractChild(s.node),et=a.compareTo(_);return et===0?nameCompare(i.name,s.name):et}makePost(i,s){const a=nodeFromJSON(i),_=ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,a);return new NamedNode(s,_)}maxPost(){const i=ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,MAX_NODE);return new NamedNode(MAX_NAME,i)}toString(){return pathSlice(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ValueIndex extends Index{compare(i,s){const a=i.node.compareTo(s.node);return a===0?nameCompare(i.name,s.name):a}isDefinedOn(i){return!0}indexedValueChanged(i,s){return!i.equals(s)}minPost(){return NamedNode.MIN}maxPost(){return NamedNode.MAX}makePost(i,s){const a=nodeFromJSON(i);return new NamedNode(s,a)}toString(){return".value"}}const VALUE_INDEX=new ValueIndex;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function changeValue(e){return{type:"value",snapshotNode:e}}function changeChildAdded(e,i){return{type:"child_added",snapshotNode:i,childName:e}}function changeChildRemoved(e,i){return{type:"child_removed",snapshotNode:i,childName:e}}function changeChildChanged(e,i,s){return{type:"child_changed",snapshotNode:i,childName:e,oldSnap:s}}function changeChildMoved(e,i){return{type:"child_moved",snapshotNode:i,childName:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IndexedFilter{constructor(i){this.index_=i}updateChild(i,s,a,_,et,nt){assert(i.isIndexed(this.index_),"A node must be indexed if only a child is updated");const c=i.getImmediateChild(s);return c.getChild(_).equals(a.getChild(_))&&c.isEmpty()===a.isEmpty()||(nt!=null&&(a.isEmpty()?i.hasChild(s)?nt.trackChildChange(changeChildRemoved(s,c)):assert(i.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):c.isEmpty()?nt.trackChildChange(changeChildAdded(s,a)):nt.trackChildChange(changeChildChanged(s,a,c))),i.isLeafNode()&&a.isEmpty())?i:i.updateImmediateChild(s,a).withIndex(this.index_)}updateFullNode(i,s,a){return a!=null&&(i.isLeafNode()||i.forEachChild(PRIORITY_INDEX,(_,et)=>{s.hasChild(_)||a.trackChildChange(changeChildRemoved(_,et))}),s.isLeafNode()||s.forEachChild(PRIORITY_INDEX,(_,et)=>{if(i.hasChild(_)){const nt=i.getImmediateChild(_);nt.equals(et)||a.trackChildChange(changeChildChanged(_,et,nt))}else a.trackChildChange(changeChildAdded(_,et))})),s.withIndex(this.index_)}updatePriority(i,s){return i.isEmpty()?ChildrenNode.EMPTY_NODE:i.updatePriority(s)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RangedFilter{constructor(i){this.indexedFilter_=new IndexedFilter(i.getIndex()),this.index_=i.getIndex(),this.startPost_=RangedFilter.getStartPost_(i),this.endPost_=RangedFilter.getEndPost_(i),this.startIsInclusive_=!i.startAfterSet_,this.endIsInclusive_=!i.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(i){const s=this.startIsInclusive_?this.index_.compare(this.getStartPost(),i)<=0:this.index_.compare(this.getStartPost(),i)<0,a=this.endIsInclusive_?this.index_.compare(i,this.getEndPost())<=0:this.index_.compare(i,this.getEndPost())<0;return s&&a}updateChild(i,s,a,_,et,nt){return this.matches(new NamedNode(s,a))||(a=ChildrenNode.EMPTY_NODE),this.indexedFilter_.updateChild(i,s,a,_,et,nt)}updateFullNode(i,s,a){s.isLeafNode()&&(s=ChildrenNode.EMPTY_NODE);let _=s.withIndex(this.index_);_=_.updatePriority(ChildrenNode.EMPTY_NODE);const et=this;return s.forEachChild(PRIORITY_INDEX,(nt,c)=>{et.matches(new NamedNode(nt,c))||(_=_.updateImmediateChild(nt,ChildrenNode.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(i,_,a)}updatePriority(i,s){return i}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(i){if(i.hasStart()){const s=i.getIndexStartName();return i.getIndex().makePost(i.getIndexStartValue(),s)}else return i.getIndex().minPost()}static getEndPost_(i){if(i.hasEnd()){const s=i.getIndexEndName();return i.getIndex().makePost(i.getIndexEndValue(),s)}else return i.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LimitedFilter{constructor(i){this.withinDirectionalStart=s=>this.reverse_?this.withinEndPost(s):this.withinStartPost(s),this.withinDirectionalEnd=s=>this.reverse_?this.withinStartPost(s):this.withinEndPost(s),this.withinStartPost=s=>{const a=this.index_.compare(this.rangedFilter_.getStartPost(),s);return this.startIsInclusive_?a<=0:a<0},this.withinEndPost=s=>{const a=this.index_.compare(s,this.rangedFilter_.getEndPost());return this.endIsInclusive_?a<=0:a<0},this.rangedFilter_=new RangedFilter(i),this.index_=i.getIndex(),this.limit_=i.getLimit(),this.reverse_=!i.isViewFromLeft(),this.startIsInclusive_=!i.startAfterSet_,this.endIsInclusive_=!i.endBeforeSet_}updateChild(i,s,a,_,et,nt){return this.rangedFilter_.matches(new NamedNode(s,a))||(a=ChildrenNode.EMPTY_NODE),i.getImmediateChild(s).equals(a)?i:i.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(i,s,a,_,et,nt):this.fullLimitUpdateChild_(i,s,a,et,nt)}updateFullNode(i,s,a){let _;if(s.isLeafNode()||s.isEmpty())_=ChildrenNode.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<s.numChildren()&&s.isIndexed(this.index_)){_=ChildrenNode.EMPTY_NODE.withIndex(this.index_);let et;this.reverse_?et=s.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):et=s.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let nt=0;for(;et.hasNext()&&nt<this.limit_;){const c=et.getNext();if(this.withinDirectionalStart(c))if(this.withinDirectionalEnd(c))_=_.updateImmediateChild(c.name,c.node),nt++;else break;else continue}}else{_=s.withIndex(this.index_),_=_.updatePriority(ChildrenNode.EMPTY_NODE);let et;this.reverse_?et=_.getReverseIterator(this.index_):et=_.getIterator(this.index_);let nt=0;for(;et.hasNext();){const c=et.getNext();nt<this.limit_&&this.withinDirectionalStart(c)&&this.withinDirectionalEnd(c)?nt++:_=_.updateImmediateChild(c.name,ChildrenNode.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(i,_,a)}updatePriority(i,s){return i}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(i,s,a,_,et){let nt;if(this.reverse_){const Tt=this.index_.getCompare();nt=(Et,At)=>Tt(At,Et)}else nt=this.index_.getCompare();const c=i;assert(c.numChildren()===this.limit_,"");const ct=new NamedNode(s,a),dt=this.reverse_?c.getFirstChild(this.index_):c.getLastChild(this.index_),gt=this.rangedFilter_.matches(ct);if(c.hasChild(s)){const Tt=c.getImmediateChild(s);let Et=_.getChildAfterChild(this.index_,dt,this.reverse_);for(;Et!=null&&(Et.name===s||c.hasChild(Et.name));)Et=_.getChildAfterChild(this.index_,Et,this.reverse_);const At=Et==null?1:nt(Et,ct);if(gt&&!a.isEmpty()&&At>=0)return et!=null&&et.trackChildChange(changeChildChanged(s,a,Tt)),c.updateImmediateChild(s,a);{et!=null&&et.trackChildChange(changeChildRemoved(s,Tt));const Pt=c.updateImmediateChild(s,ChildrenNode.EMPTY_NODE);return Et!=null&&this.rangedFilter_.matches(Et)?(et!=null&&et.trackChildChange(changeChildAdded(Et.name,Et.node)),Pt.updateImmediateChild(Et.name,Et.node)):Pt}}else return a.isEmpty()?i:gt&&nt(dt,ct)>=0?(et!=null&&(et.trackChildChange(changeChildRemoved(dt.name,dt.node)),et.trackChildChange(changeChildAdded(s,a))),c.updateImmediateChild(s,a).updateImmediateChild(dt.name,ChildrenNode.EMPTY_NODE)):i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QueryParams{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=PRIORITY_INDEX}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:MIN_NAME}hasEnd(){return this.endSet_}getIndexEndValue(){return assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:MAX_NAME}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return assert(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===PRIORITY_INDEX}copy(){const i=new QueryParams;return i.limitSet_=this.limitSet_,i.limit_=this.limit_,i.startSet_=this.startSet_,i.startAfterSet_=this.startAfterSet_,i.indexStartValue_=this.indexStartValue_,i.startNameSet_=this.startNameSet_,i.indexStartName_=this.indexStartName_,i.endSet_=this.endSet_,i.endBeforeSet_=this.endBeforeSet_,i.indexEndValue_=this.indexEndValue_,i.endNameSet_=this.endNameSet_,i.indexEndName_=this.indexEndName_,i.index_=this.index_,i.viewFrom_=this.viewFrom_,i}}function queryParamsGetNodeFilter(e){return e.loadsAllData()?new IndexedFilter(e.getIndex()):e.hasLimit()?new LimitedFilter(e):new RangedFilter(e)}function queryParamsToRestQueryStringParameters(e){const i={};if(e.isDefault())return i;let s;if(e.index_===PRIORITY_INDEX?s="$priority":e.index_===VALUE_INDEX?s="$value":e.index_===KEY_INDEX?s="$key":(assert(e.index_ instanceof PathIndex,"Unrecognized index type!"),s=e.index_.toString()),i.orderBy=stringify(s),e.startSet_){const a=e.startAfterSet_?"startAfter":"startAt";i[a]=stringify(e.indexStartValue_),e.startNameSet_&&(i[a]+=","+stringify(e.indexStartName_))}if(e.endSet_){const a=e.endBeforeSet_?"endBefore":"endAt";i[a]=stringify(e.indexEndValue_),e.endNameSet_&&(i[a]+=","+stringify(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?i.limitToFirst=e.limit_:i.limitToLast=e.limit_),i}function queryParamsGetQueryObject(e){const i={};if(e.startSet_&&(i.sp=e.indexStartValue_,e.startNameSet_&&(i.sn=e.indexStartName_),i.sin=!e.startAfterSet_),e.endSet_&&(i.ep=e.indexEndValue_,e.endNameSet_&&(i.en=e.indexEndName_),i.ein=!e.endBeforeSet_),e.limitSet_){i.l=e.limit_;let s=e.viewFrom_;s===""&&(e.isViewFromLeft()?s="l":s="r"),i.vf=s}return e.index_!==PRIORITY_INDEX&&(i.i=e.index_.toString()),i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ReadonlyRestClient extends ServerActions{reportStats(i){throw new Error("Method not implemented.")}static getListenId_(i,s){return s!==void 0?"tag$"+s:(assert(i._queryParams.isDefault(),"should have a tag if it's not a default query."),i._path.toString())}constructor(i,s,a,_){super(),this.repoInfo_=i,this.onDataUpdate_=s,this.authTokenProvider_=a,this.appCheckTokenProvider_=_,this.log_=logWrapper("p:rest:"),this.listens_={}}listen(i,s,a,_){const et=i._path.toString();this.log_("Listen called for "+et+" "+i._queryIdentifier);const nt=ReadonlyRestClient.getListenId_(i,a),c={};this.listens_[nt]=c;const ct=queryParamsToRestQueryStringParameters(i._queryParams);this.restRequest_(et+".json",ct,(dt,gt)=>{let Tt=gt;if(dt===404&&(Tt=null,dt=null),dt===null&&this.onDataUpdate_(et,Tt,!1,a),safeGet(this.listens_,nt)===c){let Et;dt?dt===401?Et="permission_denied":Et="rest_error:"+dt:Et="ok",_(Et,null)}})}unlisten(i,s){const a=ReadonlyRestClient.getListenId_(i,s);delete this.listens_[a]}get(i){const s=queryParamsToRestQueryStringParameters(i._queryParams),a=i._path.toString(),_=new Deferred;return this.restRequest_(a+".json",s,(et,nt)=>{let c=nt;et===404&&(c=null,et=null),et===null?(this.onDataUpdate_(a,c,!1,null),_.resolve(c)):_.reject(new Error(c))}),_.promise}refreshAuthToken(i){}restRequest_(i,s={},a){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([_,et])=>{_&&_.accessToken&&(s.auth=_.accessToken),et&&et.token&&(s.ac=et.token);const nt=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+i+"?ns="+this.repoInfo_.namespace+querystring(s);this.log_("Sending REST request for "+nt);const c=new XMLHttpRequest;c.onreadystatechange=()=>{if(a&&c.readyState===4){this.log_("REST Response for "+nt+" received. status:",c.status,"response:",c.responseText);let ct=null;if(c.status>=200&&c.status<300){try{ct=jsonEval(c.responseText)}catch{warn("Failed to parse JSON response for "+nt+": "+c.responseText)}a(null,ct)}else c.status!==401&&c.status!==404&&warn("Got unsuccessful REST response for "+nt+" Status: "+c.status),a(c.status);a=null}},c.open("GET",nt,!0),c.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SnapshotHolder{constructor(){this.rootNode_=ChildrenNode.EMPTY_NODE}getNode(i){return this.rootNode_.getChild(i)}updateSnapshot(i,s){this.rootNode_=this.rootNode_.updateChild(i,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function newSparseSnapshotTree(){return{value:null,children:new Map}}function sparseSnapshotTreeRemember(e,i,s){if(pathIsEmpty(i))e.value=s,e.children.clear();else if(e.value!==null)e.value=e.value.updateChild(i,s);else{const a=pathGetFront(i);e.children.has(a)||e.children.set(a,newSparseSnapshotTree());const _=e.children.get(a);i=pathPopFront(i),sparseSnapshotTreeRemember(_,i,s)}}function sparseSnapshotTreeForEachTree(e,i,s){e.value!==null?s(i,e.value):sparseSnapshotTreeForEachChild(e,(a,_)=>{const et=new Path(i.toString()+"/"+a);sparseSnapshotTreeForEachTree(_,et,s)})}function sparseSnapshotTreeForEachChild(e,i){e.children.forEach((s,a)=>{i(a,s)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StatsListener{constructor(i){this.collection_=i,this.last_=null}get(){const i=this.collection_.get(),s={...i};return this.last_&&each(this.last_,(a,_)=>{s[a]=s[a]-_}),this.last_=i,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FIRST_STATS_MIN_TIME=10*1e3,FIRST_STATS_MAX_TIME=30*1e3,REPORT_STATS_INTERVAL=5*60*1e3;class StatsReporter{constructor(i,s){this.server_=s,this.statsToReport_={},this.statsListener_=new StatsListener(i);const a=FIRST_STATS_MIN_TIME+(FIRST_STATS_MAX_TIME-FIRST_STATS_MIN_TIME)*Math.random();setTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(a))}reportStats_(){const i=this.statsListener_.get(),s={};let a=!1;each(i,(_,et)=>{et>0&&contains(this.statsToReport_,_)&&(s[_]=et,a=!0)}),a&&this.server_.reportStats(s),setTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(Math.random()*2*REPORT_STATS_INTERVAL))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var OperationType;(function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(OperationType||(OperationType={}));function newOperationSourceUser(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function newOperationSourceServer(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function newOperationSourceServerTaggedQuery(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AckUserWrite{constructor(i,s,a){this.path=i,this.affectedTree=s,this.revert=a,this.type=OperationType.ACK_USER_WRITE,this.source=newOperationSourceUser()}operationForChild(i){if(pathIsEmpty(this.path)){if(this.affectedTree.value!=null)return assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const s=this.affectedTree.subtree(new Path(i));return new AckUserWrite(newEmptyPath(),s,this.revert)}}else return assert(pathGetFront(this.path)===i,"operationForChild called for unrelated child."),new AckUserWrite(pathPopFront(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ListenComplete{constructor(i,s){this.source=i,this.path=s,this.type=OperationType.LISTEN_COMPLETE}operationForChild(i){return pathIsEmpty(this.path)?new ListenComplete(this.source,newEmptyPath()):new ListenComplete(this.source,pathPopFront(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Overwrite{constructor(i,s,a){this.source=i,this.path=s,this.snap=a,this.type=OperationType.OVERWRITE}operationForChild(i){return pathIsEmpty(this.path)?new Overwrite(this.source,newEmptyPath(),this.snap.getImmediateChild(i)):new Overwrite(this.source,pathPopFront(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Merge{constructor(i,s,a){this.source=i,this.path=s,this.children=a,this.type=OperationType.MERGE}operationForChild(i){if(pathIsEmpty(this.path)){const s=this.children.subtree(new Path(i));return s.isEmpty()?null:s.value?new Overwrite(this.source,newEmptyPath(),s.value):new Merge(this.source,newEmptyPath(),s)}else return assert(pathGetFront(this.path)===i,"Can't get a merge for a child not on the path of the operation"),new Merge(this.source,pathPopFront(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CacheNode{constructor(i,s,a){this.node_=i,this.fullyInitialized_=s,this.filtered_=a}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(i){if(pathIsEmpty(i))return this.isFullyInitialized()&&!this.filtered_;const s=pathGetFront(i);return this.isCompleteForChild(s)}isCompleteForChild(i){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(i)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EventGenerator{constructor(i){this.query_=i,this.index_=this.query_._queryParams.getIndex()}}function eventGeneratorGenerateEventsForChanges(e,i,s,a){const _=[],et=[];return i.forEach(nt=>{nt.type==="child_changed"&&e.index_.indexedValueChanged(nt.oldSnap,nt.snapshotNode)&&et.push(changeChildMoved(nt.childName,nt.snapshotNode))}),eventGeneratorGenerateEventsForType(e,_,"child_removed",i,a,s),eventGeneratorGenerateEventsForType(e,_,"child_added",i,a,s),eventGeneratorGenerateEventsForType(e,_,"child_moved",et,a,s),eventGeneratorGenerateEventsForType(e,_,"child_changed",i,a,s),eventGeneratorGenerateEventsForType(e,_,"value",i,a,s),_}function eventGeneratorGenerateEventsForType(e,i,s,a,_,et){const nt=a.filter(c=>c.type===s);nt.sort((c,ct)=>eventGeneratorCompareChanges(e,c,ct)),nt.forEach(c=>{const ct=eventGeneratorMaterializeSingleChange(e,c,et);_.forEach(dt=>{dt.respondsTo(c.type)&&i.push(dt.createEvent(ct,e.query_))})})}function eventGeneratorMaterializeSingleChange(e,i,s){return i.type==="value"||i.type==="child_removed"||(i.prevName=s.getPredecessorChildName(i.childName,i.snapshotNode,e.index_)),i}function eventGeneratorCompareChanges(e,i,s){if(i.childName==null||s.childName==null)throw assertionError("Should only compare child_ events.");const a=new NamedNode(i.childName,i.snapshotNode),_=new NamedNode(s.childName,s.snapshotNode);return e.index_.compare(a,_)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function newViewCache(e,i){return{eventCache:e,serverCache:i}}function viewCacheUpdateEventSnap(e,i,s,a){return newViewCache(new CacheNode(i,s,a),e.serverCache)}function viewCacheUpdateServerSnap(e,i,s,a){return newViewCache(e.eventCache,new CacheNode(i,s,a))}function viewCacheGetCompleteEventSnap(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function viewCacheGetCompleteServerSnap(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let emptyChildrenSingleton;const EmptyChildren=()=>(emptyChildrenSingleton||(emptyChildrenSingleton=new SortedMap(stringCompare)),emptyChildrenSingleton);class ImmutableTree{static fromObject(i){let s=new ImmutableTree(null);return each(i,(a,_)=>{s=s.set(new Path(a),_)}),s}constructor(i,s=EmptyChildren()){this.value=i,this.children=s}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(i,s){if(this.value!=null&&s(this.value))return{path:newEmptyPath(),value:this.value};if(pathIsEmpty(i))return null;{const a=pathGetFront(i),_=this.children.get(a);if(_!==null){const et=_.findRootMostMatchingPathAndValue(pathPopFront(i),s);return et!=null?{path:pathChild(new Path(a),et.path),value:et.value}:null}else return null}}findRootMostValueAndPath(i){return this.findRootMostMatchingPathAndValue(i,()=>!0)}subtree(i){if(pathIsEmpty(i))return this;{const s=pathGetFront(i),a=this.children.get(s);return a!==null?a.subtree(pathPopFront(i)):new ImmutableTree(null)}}set(i,s){if(pathIsEmpty(i))return new ImmutableTree(s,this.children);{const a=pathGetFront(i),et=(this.children.get(a)||new ImmutableTree(null)).set(pathPopFront(i),s),nt=this.children.insert(a,et);return new ImmutableTree(this.value,nt)}}remove(i){if(pathIsEmpty(i))return this.children.isEmpty()?new ImmutableTree(null):new ImmutableTree(null,this.children);{const s=pathGetFront(i),a=this.children.get(s);if(a){const _=a.remove(pathPopFront(i));let et;return _.isEmpty()?et=this.children.remove(s):et=this.children.insert(s,_),this.value===null&&et.isEmpty()?new ImmutableTree(null):new ImmutableTree(this.value,et)}else return this}}get(i){if(pathIsEmpty(i))return this.value;{const s=pathGetFront(i),a=this.children.get(s);return a?a.get(pathPopFront(i)):null}}setTree(i,s){if(pathIsEmpty(i))return s;{const a=pathGetFront(i),et=(this.children.get(a)||new ImmutableTree(null)).setTree(pathPopFront(i),s);let nt;return et.isEmpty()?nt=this.children.remove(a):nt=this.children.insert(a,et),new ImmutableTree(this.value,nt)}}fold(i){return this.fold_(newEmptyPath(),i)}fold_(i,s){const a={};return this.children.inorderTraversal((_,et)=>{a[_]=et.fold_(pathChild(i,_),s)}),s(i,this.value,a)}findOnPath(i,s){return this.findOnPath_(i,newEmptyPath(),s)}findOnPath_(i,s,a){const _=this.value?a(s,this.value):!1;if(_)return _;if(pathIsEmpty(i))return null;{const et=pathGetFront(i),nt=this.children.get(et);return nt?nt.findOnPath_(pathPopFront(i),pathChild(s,et),a):null}}foreachOnPath(i,s){return this.foreachOnPath_(i,newEmptyPath(),s)}foreachOnPath_(i,s,a){if(pathIsEmpty(i))return this;{this.value&&a(s,this.value);const _=pathGetFront(i),et=this.children.get(_);return et?et.foreachOnPath_(pathPopFront(i),pathChild(s,_),a):new ImmutableTree(null)}}foreach(i){this.foreach_(newEmptyPath(),i)}foreach_(i,s){this.children.inorderTraversal((a,_)=>{_.foreach_(pathChild(i,a),s)}),this.value&&s(i,this.value)}foreachChild(i){this.children.inorderTraversal((s,a)=>{a.value&&i(s,a.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CompoundWrite{constructor(i){this.writeTree_=i}static empty(){return new CompoundWrite(new ImmutableTree(null))}}function compoundWriteAddWrite(e,i,s){if(pathIsEmpty(i))return new CompoundWrite(new ImmutableTree(s));{const a=e.writeTree_.findRootMostValueAndPath(i);if(a!=null){const _=a.path;let et=a.value;const nt=newRelativePath(_,i);return et=et.updateChild(nt,s),new CompoundWrite(e.writeTree_.set(_,et))}else{const _=new ImmutableTree(s),et=e.writeTree_.setTree(i,_);return new CompoundWrite(et)}}}function compoundWriteAddWrites(e,i,s){let a=e;return each(s,(_,et)=>{a=compoundWriteAddWrite(a,pathChild(i,_),et)}),a}function compoundWriteRemoveWrite(e,i){if(pathIsEmpty(i))return CompoundWrite.empty();{const s=e.writeTree_.setTree(i,new ImmutableTree(null));return new CompoundWrite(s)}}function compoundWriteHasCompleteWrite(e,i){return compoundWriteGetCompleteNode(e,i)!=null}function compoundWriteGetCompleteNode(e,i){const s=e.writeTree_.findRootMostValueAndPath(i);return s!=null?e.writeTree_.get(s.path).getChild(newRelativePath(s.path,i)):null}function compoundWriteGetCompleteChildren(e){const i=[],s=e.writeTree_.value;return s!=null?s.isLeafNode()||s.forEachChild(PRIORITY_INDEX,(a,_)=>{i.push(new NamedNode(a,_))}):e.writeTree_.children.inorderTraversal((a,_)=>{_.value!=null&&i.push(new NamedNode(a,_.value))}),i}function compoundWriteChildCompoundWrite(e,i){if(pathIsEmpty(i))return e;{const s=compoundWriteGetCompleteNode(e,i);return s!=null?new CompoundWrite(new ImmutableTree(s)):new CompoundWrite(e.writeTree_.subtree(i))}}function compoundWriteIsEmpty(e){return e.writeTree_.isEmpty()}function compoundWriteApply(e,i){return applySubtreeWrite(newEmptyPath(),e.writeTree_,i)}function applySubtreeWrite(e,i,s){if(i.value!=null)return s.updateChild(e,i.value);{let a=null;return i.children.inorderTraversal((_,et)=>{_===".priority"?(assert(et.value!==null,"Priority writes must always be leaf nodes"),a=et.value):s=applySubtreeWrite(pathChild(e,_),et,s)}),!s.getChild(e).isEmpty()&&a!==null&&(s=s.updateChild(pathChild(e,".priority"),a)),s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function writeTreeChildWrites(e,i){return newWriteTreeRef(i,e)}function writeTreeAddOverwrite(e,i,s,a,_){assert(a>e.lastWriteId,"Stacking an older write on top of newer ones"),_===void 0&&(_=!0),e.allWrites.push({path:i,snap:s,writeId:a,visible:_}),_&&(e.visibleWrites=compoundWriteAddWrite(e.visibleWrites,i,s)),e.lastWriteId=a}function writeTreeAddMerge(e,i,s,a){assert(a>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:i,children:s,writeId:a,visible:!0}),e.visibleWrites=compoundWriteAddWrites(e.visibleWrites,i,s),e.lastWriteId=a}function writeTreeGetWrite(e,i){for(let s=0;s<e.allWrites.length;s++){const a=e.allWrites[s];if(a.writeId===i)return a}return null}function writeTreeRemoveWrite(e,i){const s=e.allWrites.findIndex(c=>c.writeId===i);assert(s>=0,"removeWrite called with nonexistent writeId.");const a=e.allWrites[s];e.allWrites.splice(s,1);let _=a.visible,et=!1,nt=e.allWrites.length-1;for(;_&&nt>=0;){const c=e.allWrites[nt];c.visible&&(nt>=s&&writeTreeRecordContainsPath_(c,a.path)?_=!1:pathContains(a.path,c.path)&&(et=!0)),nt--}if(_){if(et)return writeTreeResetTree_(e),!0;if(a.snap)e.visibleWrites=compoundWriteRemoveWrite(e.visibleWrites,a.path);else{const c=a.children;each(c,ct=>{e.visibleWrites=compoundWriteRemoveWrite(e.visibleWrites,pathChild(a.path,ct))})}return!0}else return!1}function writeTreeRecordContainsPath_(e,i){if(e.snap)return pathContains(e.path,i);for(const s in e.children)if(e.children.hasOwnProperty(s)&&pathContains(pathChild(e.path,s),i))return!0;return!1}function writeTreeResetTree_(e){e.visibleWrites=writeTreeLayerTree_(e.allWrites,writeTreeDefaultFilter_,newEmptyPath()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}function writeTreeDefaultFilter_(e){return e.visible}function writeTreeLayerTree_(e,i,s){let a=CompoundWrite.empty();for(let _=0;_<e.length;++_){const et=e[_];if(i(et)){const nt=et.path;let c;if(et.snap)pathContains(s,nt)?(c=newRelativePath(s,nt),a=compoundWriteAddWrite(a,c,et.snap)):pathContains(nt,s)&&(c=newRelativePath(nt,s),a=compoundWriteAddWrite(a,newEmptyPath(),et.snap.getChild(c)));else if(et.children){if(pathContains(s,nt))c=newRelativePath(s,nt),a=compoundWriteAddWrites(a,c,et.children);else if(pathContains(nt,s))if(c=newRelativePath(nt,s),pathIsEmpty(c))a=compoundWriteAddWrites(a,newEmptyPath(),et.children);else{const ct=safeGet(et.children,pathGetFront(c));if(ct){const dt=ct.getChild(pathPopFront(c));a=compoundWriteAddWrite(a,newEmptyPath(),dt)}}}else throw assertionError("WriteRecord should have .snap or .children")}}return a}function writeTreeCalcCompleteEventCache(e,i,s,a,_){if(!a&&!_){const et=compoundWriteGetCompleteNode(e.visibleWrites,i);if(et!=null)return et;{const nt=compoundWriteChildCompoundWrite(e.visibleWrites,i);if(compoundWriteIsEmpty(nt))return s;if(s==null&&!compoundWriteHasCompleteWrite(nt,newEmptyPath()))return null;{const c=s||ChildrenNode.EMPTY_NODE;return compoundWriteApply(nt,c)}}}else{const et=compoundWriteChildCompoundWrite(e.visibleWrites,i);if(!_&&compoundWriteIsEmpty(et))return s;if(!_&&s==null&&!compoundWriteHasCompleteWrite(et,newEmptyPath()))return null;{const nt=function(dt){return(dt.visible||_)&&(!a||!~a.indexOf(dt.writeId))&&(pathContains(dt.path,i)||pathContains(i,dt.path))},c=writeTreeLayerTree_(e.allWrites,nt,i),ct=s||ChildrenNode.EMPTY_NODE;return compoundWriteApply(c,ct)}}}function writeTreeCalcCompleteEventChildren(e,i,s){let a=ChildrenNode.EMPTY_NODE;const _=compoundWriteGetCompleteNode(e.visibleWrites,i);if(_)return _.isLeafNode()||_.forEachChild(PRIORITY_INDEX,(et,nt)=>{a=a.updateImmediateChild(et,nt)}),a;if(s){const et=compoundWriteChildCompoundWrite(e.visibleWrites,i);return s.forEachChild(PRIORITY_INDEX,(nt,c)=>{const ct=compoundWriteApply(compoundWriteChildCompoundWrite(et,new Path(nt)),c);a=a.updateImmediateChild(nt,ct)}),compoundWriteGetCompleteChildren(et).forEach(nt=>{a=a.updateImmediateChild(nt.name,nt.node)}),a}else{const et=compoundWriteChildCompoundWrite(e.visibleWrites,i);return compoundWriteGetCompleteChildren(et).forEach(nt=>{a=a.updateImmediateChild(nt.name,nt.node)}),a}}function writeTreeCalcEventCacheAfterServerOverwrite(e,i,s,a,_){assert(a||_,"Either existingEventSnap or existingServerSnap must exist");const et=pathChild(i,s);if(compoundWriteHasCompleteWrite(e.visibleWrites,et))return null;{const nt=compoundWriteChildCompoundWrite(e.visibleWrites,et);return compoundWriteIsEmpty(nt)?_.getChild(s):compoundWriteApply(nt,_.getChild(s))}}function writeTreeCalcCompleteChild(e,i,s,a){const _=pathChild(i,s),et=compoundWriteGetCompleteNode(e.visibleWrites,_);if(et!=null)return et;if(a.isCompleteForChild(s)){const nt=compoundWriteChildCompoundWrite(e.visibleWrites,_);return compoundWriteApply(nt,a.getNode().getImmediateChild(s))}else return null}function writeTreeShadowingWrite(e,i){return compoundWriteGetCompleteNode(e.visibleWrites,i)}function writeTreeCalcIndexedSlice(e,i,s,a,_,et,nt){let c;const ct=compoundWriteChildCompoundWrite(e.visibleWrites,i),dt=compoundWriteGetCompleteNode(ct,newEmptyPath());if(dt!=null)c=dt;else if(s!=null)c=compoundWriteApply(ct,s);else return[];if(c=c.withIndex(nt),!c.isEmpty()&&!c.isLeafNode()){const gt=[],Tt=nt.getCompare(),Et=et?c.getReverseIteratorFrom(a,nt):c.getIteratorFrom(a,nt);let At=Et.getNext();for(;At&&gt.length<_;)Tt(At,a)!==0&&gt.push(At),At=Et.getNext();return gt}else return[]}function newWriteTree(){return{visibleWrites:CompoundWrite.empty(),allWrites:[],lastWriteId:-1}}function writeTreeRefCalcCompleteEventCache(e,i,s,a){return writeTreeCalcCompleteEventCache(e.writeTree,e.treePath,i,s,a)}function writeTreeRefCalcCompleteEventChildren(e,i){return writeTreeCalcCompleteEventChildren(e.writeTree,e.treePath,i)}function writeTreeRefCalcEventCacheAfterServerOverwrite(e,i,s,a){return writeTreeCalcEventCacheAfterServerOverwrite(e.writeTree,e.treePath,i,s,a)}function writeTreeRefShadowingWrite(e,i){return writeTreeShadowingWrite(e.writeTree,pathChild(e.treePath,i))}function writeTreeRefCalcIndexedSlice(e,i,s,a,_,et){return writeTreeCalcIndexedSlice(e.writeTree,e.treePath,i,s,a,_,et)}function writeTreeRefCalcCompleteChild(e,i,s){return writeTreeCalcCompleteChild(e.writeTree,e.treePath,i,s)}function writeTreeRefChild(e,i){return newWriteTreeRef(pathChild(e.treePath,i),e.writeTree)}function newWriteTreeRef(e,i){return{treePath:e,writeTree:i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ChildChangeAccumulator{constructor(){this.changeMap=new Map}trackChildChange(i){const s=i.type,a=i.childName;assert(s==="child_added"||s==="child_changed"||s==="child_removed","Only child changes supported for tracking"),assert(a!==".priority","Only non-priority child changes can be tracked.");const _=this.changeMap.get(a);if(_){const et=_.type;if(s==="child_added"&&et==="child_removed")this.changeMap.set(a,changeChildChanged(a,i.snapshotNode,_.snapshotNode));else if(s==="child_removed"&&et==="child_added")this.changeMap.delete(a);else if(s==="child_removed"&&et==="child_changed")this.changeMap.set(a,changeChildRemoved(a,_.oldSnap));else if(s==="child_changed"&&et==="child_added")this.changeMap.set(a,changeChildAdded(a,i.snapshotNode));else if(s==="child_changed"&&et==="child_changed")this.changeMap.set(a,changeChildChanged(a,i.snapshotNode,_.oldSnap));else throw assertionError("Illegal combination of changes: "+i+" occurred after "+_)}else this.changeMap.set(a,i)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NoCompleteChildSource_{getCompleteChild(i){return null}getChildAfterChild(i,s,a){return null}}const NO_COMPLETE_CHILD_SOURCE=new NoCompleteChildSource_;class WriteTreeCompleteChildSource{constructor(i,s,a=null){this.writes_=i,this.viewCache_=s,this.optCompleteServerCache_=a}getCompleteChild(i){const s=this.viewCache_.eventCache;if(s.isCompleteForChild(i))return s.getNode().getImmediateChild(i);{const a=this.optCompleteServerCache_!=null?new CacheNode(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return writeTreeRefCalcCompleteChild(this.writes_,i,a)}}getChildAfterChild(i,s,a){const _=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:viewCacheGetCompleteServerSnap(this.viewCache_),et=writeTreeRefCalcIndexedSlice(this.writes_,_,s,1,a,i);return et.length===0?null:et[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function newViewProcessor(e){return{filter:e}}function viewProcessorAssertIndexed(e,i){assert(i.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),assert(i.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed")}function viewProcessorApplyOperation(e,i,s,a,_){const et=new ChildChangeAccumulator;let nt,c;if(s.type===OperationType.OVERWRITE){const dt=s;dt.source.fromUser?nt=viewProcessorApplyUserOverwrite(e,i,dt.path,dt.snap,a,_,et):(assert(dt.source.fromServer,"Unknown source."),c=dt.source.tagged||i.serverCache.isFiltered()&&!pathIsEmpty(dt.path),nt=viewProcessorApplyServerOverwrite(e,i,dt.path,dt.snap,a,_,c,et))}else if(s.type===OperationType.MERGE){const dt=s;dt.source.fromUser?nt=viewProcessorApplyUserMerge(e,i,dt.path,dt.children,a,_,et):(assert(dt.source.fromServer,"Unknown source."),c=dt.source.tagged||i.serverCache.isFiltered(),nt=viewProcessorApplyServerMerge(e,i,dt.path,dt.children,a,_,c,et))}else if(s.type===OperationType.ACK_USER_WRITE){const dt=s;dt.revert?nt=viewProcessorRevertUserWrite(e,i,dt.path,a,_,et):nt=viewProcessorAckUserWrite(e,i,dt.path,dt.affectedTree,a,_,et)}else if(s.type===OperationType.LISTEN_COMPLETE)nt=viewProcessorListenComplete(e,i,s.path,a,et);else throw assertionError("Unknown operation type: "+s.type);const ct=et.getChanges();return viewProcessorMaybeAddValueEvent(i,nt,ct),{viewCache:nt,changes:ct}}function viewProcessorMaybeAddValueEvent(e,i,s){const a=i.eventCache;if(a.isFullyInitialized()){const _=a.getNode().isLeafNode()||a.getNode().isEmpty(),et=viewCacheGetCompleteEventSnap(e);(s.length>0||!e.eventCache.isFullyInitialized()||_&&!a.getNode().equals(et)||!a.getNode().getPriority().equals(et.getPriority()))&&s.push(changeValue(viewCacheGetCompleteEventSnap(i)))}}function viewProcessorGenerateEventCacheAfterServerEvent(e,i,s,a,_,et){const nt=i.eventCache;if(writeTreeRefShadowingWrite(a,s)!=null)return i;{let c,ct;if(pathIsEmpty(s))if(assert(i.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),i.serverCache.isFiltered()){const dt=viewCacheGetCompleteServerSnap(i),gt=dt instanceof ChildrenNode?dt:ChildrenNode.EMPTY_NODE,Tt=writeTreeRefCalcCompleteEventChildren(a,gt);c=e.filter.updateFullNode(i.eventCache.getNode(),Tt,et)}else{const dt=writeTreeRefCalcCompleteEventCache(a,viewCacheGetCompleteServerSnap(i));c=e.filter.updateFullNode(i.eventCache.getNode(),dt,et)}else{const dt=pathGetFront(s);if(dt===".priority"){assert(pathGetLength(s)===1,"Can't have a priority with additional path components");const gt=nt.getNode();ct=i.serverCache.getNode();const Tt=writeTreeRefCalcEventCacheAfterServerOverwrite(a,s,gt,ct);Tt!=null?c=e.filter.updatePriority(gt,Tt):c=nt.getNode()}else{const gt=pathPopFront(s);let Tt;if(nt.isCompleteForChild(dt)){ct=i.serverCache.getNode();const Et=writeTreeRefCalcEventCacheAfterServerOverwrite(a,s,nt.getNode(),ct);Et!=null?Tt=nt.getNode().getImmediateChild(dt).updateChild(gt,Et):Tt=nt.getNode().getImmediateChild(dt)}else Tt=writeTreeRefCalcCompleteChild(a,dt,i.serverCache);Tt!=null?c=e.filter.updateChild(nt.getNode(),dt,Tt,gt,_,et):c=nt.getNode()}}return viewCacheUpdateEventSnap(i,c,nt.isFullyInitialized()||pathIsEmpty(s),e.filter.filtersNodes())}}function viewProcessorApplyServerOverwrite(e,i,s,a,_,et,nt,c){const ct=i.serverCache;let dt;const gt=nt?e.filter:e.filter.getIndexedFilter();if(pathIsEmpty(s))dt=gt.updateFullNode(ct.getNode(),a,null);else if(gt.filtersNodes()&&!ct.isFiltered()){const At=ct.getNode().updateChild(s,a);dt=gt.updateFullNode(ct.getNode(),At,null)}else{const At=pathGetFront(s);if(!ct.isCompleteForPath(s)&&pathGetLength(s)>1)return i;const Mt=pathPopFront(s),$t=ct.getNode().getImmediateChild(At).updateChild(Mt,a);At===".priority"?dt=gt.updatePriority(ct.getNode(),$t):dt=gt.updateChild(ct.getNode(),At,$t,Mt,NO_COMPLETE_CHILD_SOURCE,null)}const Tt=viewCacheUpdateServerSnap(i,dt,ct.isFullyInitialized()||pathIsEmpty(s),gt.filtersNodes()),Et=new WriteTreeCompleteChildSource(_,Tt,et);return viewProcessorGenerateEventCacheAfterServerEvent(e,Tt,s,_,Et,c)}function viewProcessorApplyUserOverwrite(e,i,s,a,_,et,nt){const c=i.eventCache;let ct,dt;const gt=new WriteTreeCompleteChildSource(_,i,et);if(pathIsEmpty(s))dt=e.filter.updateFullNode(i.eventCache.getNode(),a,nt),ct=viewCacheUpdateEventSnap(i,dt,!0,e.filter.filtersNodes());else{const Tt=pathGetFront(s);if(Tt===".priority")dt=e.filter.updatePriority(i.eventCache.getNode(),a),ct=viewCacheUpdateEventSnap(i,dt,c.isFullyInitialized(),c.isFiltered());else{const Et=pathPopFront(s),At=c.getNode().getImmediateChild(Tt);let Mt;if(pathIsEmpty(Et))Mt=a;else{const Pt=gt.getCompleteChild(Tt);Pt!=null?pathGetBack(Et)===".priority"&&Pt.getChild(pathParent(Et)).isEmpty()?Mt=Pt:Mt=Pt.updateChild(Et,a):Mt=ChildrenNode.EMPTY_NODE}if(At.equals(Mt))ct=i;else{const Pt=e.filter.updateChild(c.getNode(),Tt,Mt,Et,gt,nt);ct=viewCacheUpdateEventSnap(i,Pt,c.isFullyInitialized(),e.filter.filtersNodes())}}}return ct}function viewProcessorCacheHasChild(e,i){return e.eventCache.isCompleteForChild(i)}function viewProcessorApplyUserMerge(e,i,s,a,_,et,nt){let c=i;return a.foreach((ct,dt)=>{const gt=pathChild(s,ct);viewProcessorCacheHasChild(i,pathGetFront(gt))&&(c=viewProcessorApplyUserOverwrite(e,c,gt,dt,_,et,nt))}),a.foreach((ct,dt)=>{const gt=pathChild(s,ct);viewProcessorCacheHasChild(i,pathGetFront(gt))||(c=viewProcessorApplyUserOverwrite(e,c,gt,dt,_,et,nt))}),c}function viewProcessorApplyMerge(e,i,s){return s.foreach((a,_)=>{i=i.updateChild(a,_)}),i}function viewProcessorApplyServerMerge(e,i,s,a,_,et,nt,c){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized())return i;let ct=i,dt;pathIsEmpty(s)?dt=a:dt=new ImmutableTree(null).setTree(s,a);const gt=i.serverCache.getNode();return dt.children.inorderTraversal((Tt,Et)=>{if(gt.hasChild(Tt)){const At=i.serverCache.getNode().getImmediateChild(Tt),Mt=viewProcessorApplyMerge(e,At,Et);ct=viewProcessorApplyServerOverwrite(e,ct,new Path(Tt),Mt,_,et,nt,c)}}),dt.children.inorderTraversal((Tt,Et)=>{const At=!i.serverCache.isCompleteForChild(Tt)&&Et.value===null;if(!gt.hasChild(Tt)&&!At){const Mt=i.serverCache.getNode().getImmediateChild(Tt),Pt=viewProcessorApplyMerge(e,Mt,Et);ct=viewProcessorApplyServerOverwrite(e,ct,new Path(Tt),Pt,_,et,nt,c)}}),ct}function viewProcessorAckUserWrite(e,i,s,a,_,et,nt){if(writeTreeRefShadowingWrite(_,s)!=null)return i;const c=i.serverCache.isFiltered(),ct=i.serverCache;if(a.value!=null){if(pathIsEmpty(s)&&ct.isFullyInitialized()||ct.isCompleteForPath(s))return viewProcessorApplyServerOverwrite(e,i,s,ct.getNode().getChild(s),_,et,c,nt);if(pathIsEmpty(s)){let dt=new ImmutableTree(null);return ct.getNode().forEachChild(KEY_INDEX,(gt,Tt)=>{dt=dt.set(new Path(gt),Tt)}),viewProcessorApplyServerMerge(e,i,s,dt,_,et,c,nt)}else return i}else{let dt=new ImmutableTree(null);return a.foreach((gt,Tt)=>{const Et=pathChild(s,gt);ct.isCompleteForPath(Et)&&(dt=dt.set(gt,ct.getNode().getChild(Et)))}),viewProcessorApplyServerMerge(e,i,s,dt,_,et,c,nt)}}function viewProcessorListenComplete(e,i,s,a,_){const et=i.serverCache,nt=viewCacheUpdateServerSnap(i,et.getNode(),et.isFullyInitialized()||pathIsEmpty(s),et.isFiltered());return viewProcessorGenerateEventCacheAfterServerEvent(e,nt,s,a,NO_COMPLETE_CHILD_SOURCE,_)}function viewProcessorRevertUserWrite(e,i,s,a,_,et){let nt;if(writeTreeRefShadowingWrite(a,s)!=null)return i;{const c=new WriteTreeCompleteChildSource(a,i,_),ct=i.eventCache.getNode();let dt;if(pathIsEmpty(s)||pathGetFront(s)===".priority"){let gt;if(i.serverCache.isFullyInitialized())gt=writeTreeRefCalcCompleteEventCache(a,viewCacheGetCompleteServerSnap(i));else{const Tt=i.serverCache.getNode();assert(Tt instanceof ChildrenNode,"serverChildren would be complete if leaf node"),gt=writeTreeRefCalcCompleteEventChildren(a,Tt)}gt=gt,dt=e.filter.updateFullNode(ct,gt,et)}else{const gt=pathGetFront(s);let Tt=writeTreeRefCalcCompleteChild(a,gt,i.serverCache);Tt==null&&i.serverCache.isCompleteForChild(gt)&&(Tt=ct.getImmediateChild(gt)),Tt!=null?dt=e.filter.updateChild(ct,gt,Tt,pathPopFront(s),c,et):i.eventCache.getNode().hasChild(gt)?dt=e.filter.updateChild(ct,gt,ChildrenNode.EMPTY_NODE,pathPopFront(s),c,et):dt=ct,dt.isEmpty()&&i.serverCache.isFullyInitialized()&&(nt=writeTreeRefCalcCompleteEventCache(a,viewCacheGetCompleteServerSnap(i)),nt.isLeafNode()&&(dt=e.filter.updateFullNode(dt,nt,et)))}return nt=i.serverCache.isFullyInitialized()||writeTreeRefShadowingWrite(a,newEmptyPath())!=null,viewCacheUpdateEventSnap(i,dt,nt,e.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class View{constructor(i,s){this.query_=i,this.eventRegistrations_=[];const a=this.query_._queryParams,_=new IndexedFilter(a.getIndex()),et=queryParamsGetNodeFilter(a);this.processor_=newViewProcessor(et);const nt=s.serverCache,c=s.eventCache,ct=_.updateFullNode(ChildrenNode.EMPTY_NODE,nt.getNode(),null),dt=et.updateFullNode(ChildrenNode.EMPTY_NODE,c.getNode(),null),gt=new CacheNode(ct,nt.isFullyInitialized(),_.filtersNodes()),Tt=new CacheNode(dt,c.isFullyInitialized(),et.filtersNodes());this.viewCache_=newViewCache(Tt,gt),this.eventGenerator_=new EventGenerator(this.query_)}get query(){return this.query_}}function viewGetServerCache(e){return e.viewCache_.serverCache.getNode()}function viewGetCompleteNode(e){return viewCacheGetCompleteEventSnap(e.viewCache_)}function viewGetCompleteServerCache(e,i){const s=viewCacheGetCompleteServerSnap(e.viewCache_);return s&&(e.query._queryParams.loadsAllData()||!pathIsEmpty(i)&&!s.getImmediateChild(pathGetFront(i)).isEmpty())?s.getChild(i):null}function viewIsEmpty(e){return e.eventRegistrations_.length===0}function viewAddEventRegistration(e,i){e.eventRegistrations_.push(i)}function viewRemoveEventRegistration(e,i,s){const a=[];if(s){assert(i==null,"A cancel should cancel all event registrations.");const _=e.query._path;e.eventRegistrations_.forEach(et=>{const nt=et.createCancelEvent(s,_);nt&&a.push(nt)})}if(i){let _=[];for(let et=0;et<e.eventRegistrations_.length;++et){const nt=e.eventRegistrations_[et];if(!nt.matches(i))_.push(nt);else if(i.hasAnyCallback()){_=_.concat(e.eventRegistrations_.slice(et+1));break}}e.eventRegistrations_=_}else e.eventRegistrations_=[];return a}function viewApplyOperation(e,i,s,a){i.type===OperationType.MERGE&&i.source.queryId!==null&&(assert(viewCacheGetCompleteServerSnap(e.viewCache_),"We should always have a full cache before handling merges"),assert(viewCacheGetCompleteEventSnap(e.viewCache_),"Missing event cache, even though we have a server cache"));const _=e.viewCache_,et=viewProcessorApplyOperation(e.processor_,_,i,s,a);return viewProcessorAssertIndexed(e.processor_,et.viewCache),assert(et.viewCache.serverCache.isFullyInitialized()||!_.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=et.viewCache,viewGenerateEventsForChanges_(e,et.changes,et.viewCache.eventCache.getNode(),null)}function viewGetInitialEvents(e,i){const s=e.viewCache_.eventCache,a=[];return s.getNode().isLeafNode()||s.getNode().forEachChild(PRIORITY_INDEX,(et,nt)=>{a.push(changeChildAdded(et,nt))}),s.isFullyInitialized()&&a.push(changeValue(s.getNode())),viewGenerateEventsForChanges_(e,a,s.getNode(),i)}function viewGenerateEventsForChanges_(e,i,s,a){const _=a?[a]:e.eventRegistrations_;return eventGeneratorGenerateEventsForChanges(e.eventGenerator_,i,s,_)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let referenceConstructor$1;class SyncPoint{constructor(){this.views=new Map}}function syncPointSetReferenceConstructor(e){assert(!referenceConstructor$1,"__referenceConstructor has already been defined"),referenceConstructor$1=e}function syncPointGetReferenceConstructor(){return assert(referenceConstructor$1,"Reference.ts has not been loaded"),referenceConstructor$1}function syncPointIsEmpty(e){return e.views.size===0}function syncPointApplyOperation(e,i,s,a){const _=i.source.queryId;if(_!==null){const et=e.views.get(_);return assert(et!=null,"SyncTree gave us an op for an invalid query."),viewApplyOperation(et,i,s,a)}else{let et=[];for(const nt of e.views.values())et=et.concat(viewApplyOperation(nt,i,s,a));return et}}function syncPointGetView(e,i,s,a,_){const et=i._queryIdentifier,nt=e.views.get(et);if(!nt){let c=writeTreeRefCalcCompleteEventCache(s,_?a:null),ct=!1;c?ct=!0:a instanceof ChildrenNode?(c=writeTreeRefCalcCompleteEventChildren(s,a),ct=!1):(c=ChildrenNode.EMPTY_NODE,ct=!1);const dt=newViewCache(new CacheNode(c,ct,!1),new CacheNode(a,_,!1));return new View(i,dt)}return nt}function syncPointAddEventRegistration(e,i,s,a,_,et){const nt=syncPointGetView(e,i,a,_,et);return e.views.has(i._queryIdentifier)||e.views.set(i._queryIdentifier,nt),viewAddEventRegistration(nt,s),viewGetInitialEvents(nt,s)}function syncPointRemoveEventRegistration(e,i,s,a){const _=i._queryIdentifier,et=[];let nt=[];const c=syncPointHasCompleteView(e);if(_==="default")for(const[ct,dt]of e.views.entries())nt=nt.concat(viewRemoveEventRegistration(dt,s,a)),viewIsEmpty(dt)&&(e.views.delete(ct),dt.query._queryParams.loadsAllData()||et.push(dt.query));else{const ct=e.views.get(_);ct&&(nt=nt.concat(viewRemoveEventRegistration(ct,s,a)),viewIsEmpty(ct)&&(e.views.delete(_),ct.query._queryParams.loadsAllData()||et.push(ct.query)))}return c&&!syncPointHasCompleteView(e)&&et.push(new(syncPointGetReferenceConstructor())(i._repo,i._path)),{removed:et,events:nt}}function syncPointGetQueryViews(e){const i=[];for(const s of e.views.values())s.query._queryParams.loadsAllData()||i.push(s);return i}function syncPointGetCompleteServerCache(e,i){let s=null;for(const a of e.views.values())s=s||viewGetCompleteServerCache(a,i);return s}function syncPointViewForQuery(e,i){if(i._queryParams.loadsAllData())return syncPointGetCompleteView(e);{const a=i._queryIdentifier;return e.views.get(a)}}function syncPointViewExistsForQuery(e,i){return syncPointViewForQuery(e,i)!=null}function syncPointHasCompleteView(e){return syncPointGetCompleteView(e)!=null}function syncPointGetCompleteView(e){for(const i of e.views.values())if(i.query._queryParams.loadsAllData())return i;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let referenceConstructor;function syncTreeSetReferenceConstructor(e){assert(!referenceConstructor,"__referenceConstructor has already been defined"),referenceConstructor=e}function syncTreeGetReferenceConstructor(){return assert(referenceConstructor,"Reference.ts has not been loaded"),referenceConstructor}let syncTreeNextQueryTag_=1;class SyncTree{constructor(i){this.listenProvider_=i,this.syncPointTree_=new ImmutableTree(null),this.pendingWriteTree_=newWriteTree(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function syncTreeApplyUserOverwrite(e,i,s,a,_){return writeTreeAddOverwrite(e.pendingWriteTree_,i,s,a,_),_?syncTreeApplyOperationToSyncPoints_(e,new Overwrite(newOperationSourceUser(),i,s)):[]}function syncTreeApplyUserMerge(e,i,s,a){writeTreeAddMerge(e.pendingWriteTree_,i,s,a);const _=ImmutableTree.fromObject(s);return syncTreeApplyOperationToSyncPoints_(e,new Merge(newOperationSourceUser(),i,_))}function syncTreeAckUserWrite(e,i,s=!1){const a=writeTreeGetWrite(e.pendingWriteTree_,i);if(writeTreeRemoveWrite(e.pendingWriteTree_,i)){let et=new ImmutableTree(null);return a.snap!=null?et=et.set(newEmptyPath(),!0):each(a.children,nt=>{et=et.set(new Path(nt),!0)}),syncTreeApplyOperationToSyncPoints_(e,new AckUserWrite(a.path,et,s))}else return[]}function syncTreeApplyServerOverwrite(e,i,s){return syncTreeApplyOperationToSyncPoints_(e,new Overwrite(newOperationSourceServer(),i,s))}function syncTreeApplyServerMerge(e,i,s){const a=ImmutableTree.fromObject(s);return syncTreeApplyOperationToSyncPoints_(e,new Merge(newOperationSourceServer(),i,a))}function syncTreeApplyListenComplete(e,i){return syncTreeApplyOperationToSyncPoints_(e,new ListenComplete(newOperationSourceServer(),i))}function syncTreeApplyTaggedListenComplete(e,i,s){const a=syncTreeQueryKeyForTag_(e,s);if(a){const _=syncTreeParseQueryKey_(a),et=_.path,nt=_.queryId,c=newRelativePath(et,i),ct=new ListenComplete(newOperationSourceServerTaggedQuery(nt),c);return syncTreeApplyTaggedOperation_(e,et,ct)}else return[]}function syncTreeRemoveEventRegistration(e,i,s,a,_=!1){const et=i._path,nt=e.syncPointTree_.get(et);let c=[];if(nt&&(i._queryIdentifier==="default"||syncPointViewExistsForQuery(nt,i))){const ct=syncPointRemoveEventRegistration(nt,i,s,a);syncPointIsEmpty(nt)&&(e.syncPointTree_=e.syncPointTree_.remove(et));const dt=ct.removed;if(c=ct.events,!_){const gt=dt.findIndex(Et=>Et._queryParams.loadsAllData())!==-1,Tt=e.syncPointTree_.findOnPath(et,(Et,At)=>syncPointHasCompleteView(At));if(gt&&!Tt){const Et=e.syncPointTree_.subtree(et);if(!Et.isEmpty()){const At=syncTreeCollectDistinctViewsForSubTree_(Et);for(let Mt=0;Mt<At.length;++Mt){const Pt=At[Mt],$t=Pt.query,Lt=syncTreeCreateListenerForView_(e,Pt);e.listenProvider_.startListening(syncTreeQueryForListening_($t),syncTreeTagForQuery(e,$t),Lt.hashFn,Lt.onComplete)}}}!Tt&&dt.length>0&&!a&&(gt?e.listenProvider_.stopListening(syncTreeQueryForListening_(i),null):dt.forEach(Et=>{const At=e.queryToTagMap.get(syncTreeMakeQueryKey_(Et));e.listenProvider_.stopListening(syncTreeQueryForListening_(Et),At)}))}syncTreeRemoveTags_(e,dt)}return c}function syncTreeApplyTaggedQueryOverwrite(e,i,s,a){const _=syncTreeQueryKeyForTag_(e,a);if(_!=null){const et=syncTreeParseQueryKey_(_),nt=et.path,c=et.queryId,ct=newRelativePath(nt,i),dt=new Overwrite(newOperationSourceServerTaggedQuery(c),ct,s);return syncTreeApplyTaggedOperation_(e,nt,dt)}else return[]}function syncTreeApplyTaggedQueryMerge(e,i,s,a){const _=syncTreeQueryKeyForTag_(e,a);if(_){const et=syncTreeParseQueryKey_(_),nt=et.path,c=et.queryId,ct=newRelativePath(nt,i),dt=ImmutableTree.fromObject(s),gt=new Merge(newOperationSourceServerTaggedQuery(c),ct,dt);return syncTreeApplyTaggedOperation_(e,nt,gt)}else return[]}function syncTreeAddEventRegistration(e,i,s,a=!1){const _=i._path;let et=null,nt=!1;e.syncPointTree_.foreachOnPath(_,(Et,At)=>{const Mt=newRelativePath(Et,_);et=et||syncPointGetCompleteServerCache(At,Mt),nt=nt||syncPointHasCompleteView(At)});let c=e.syncPointTree_.get(_);c?(nt=nt||syncPointHasCompleteView(c),et=et||syncPointGetCompleteServerCache(c,newEmptyPath())):(c=new SyncPoint,e.syncPointTree_=e.syncPointTree_.set(_,c));let ct;et!=null?ct=!0:(ct=!1,et=ChildrenNode.EMPTY_NODE,e.syncPointTree_.subtree(_).foreachChild((At,Mt)=>{const Pt=syncPointGetCompleteServerCache(Mt,newEmptyPath());Pt&&(et=et.updateImmediateChild(At,Pt))}));const dt=syncPointViewExistsForQuery(c,i);if(!dt&&!i._queryParams.loadsAllData()){const Et=syncTreeMakeQueryKey_(i);assert(!e.queryToTagMap.has(Et),"View does not exist, but we have a tag");const At=syncTreeGetNextQueryTag_();e.queryToTagMap.set(Et,At),e.tagToQueryMap.set(At,Et)}const gt=writeTreeChildWrites(e.pendingWriteTree_,_);let Tt=syncPointAddEventRegistration(c,i,s,gt,et,ct);if(!dt&&!nt&&!a){const Et=syncPointViewForQuery(c,i);Tt=Tt.concat(syncTreeSetupListener_(e,i,Et))}return Tt}function syncTreeCalcCompleteEventCache(e,i,s){const _=e.pendingWriteTree_,et=e.syncPointTree_.findOnPath(i,(nt,c)=>{const ct=newRelativePath(nt,i),dt=syncPointGetCompleteServerCache(c,ct);if(dt)return dt});return writeTreeCalcCompleteEventCache(_,i,et,s,!0)}function syncTreeGetServerValue(e,i){const s=i._path;let a=null;e.syncPointTree_.foreachOnPath(s,(dt,gt)=>{const Tt=newRelativePath(dt,s);a=a||syncPointGetCompleteServerCache(gt,Tt)});let _=e.syncPointTree_.get(s);_?a=a||syncPointGetCompleteServerCache(_,newEmptyPath()):(_=new SyncPoint,e.syncPointTree_=e.syncPointTree_.set(s,_));const et=a!=null,nt=et?new CacheNode(a,!0,!1):null,c=writeTreeChildWrites(e.pendingWriteTree_,i._path),ct=syncPointGetView(_,i,c,et?nt.getNode():ChildrenNode.EMPTY_NODE,et);return viewGetCompleteNode(ct)}function syncTreeApplyOperationToSyncPoints_(e,i){return syncTreeApplyOperationHelper_(i,e.syncPointTree_,null,writeTreeChildWrites(e.pendingWriteTree_,newEmptyPath()))}function syncTreeApplyOperationHelper_(e,i,s,a){if(pathIsEmpty(e.path))return syncTreeApplyOperationDescendantsHelper_(e,i,s,a);{const _=i.get(newEmptyPath());s==null&&_!=null&&(s=syncPointGetCompleteServerCache(_,newEmptyPath()));let et=[];const nt=pathGetFront(e.path),c=e.operationForChild(nt),ct=i.children.get(nt);if(ct&&c){const dt=s?s.getImmediateChild(nt):null,gt=writeTreeRefChild(a,nt);et=et.concat(syncTreeApplyOperationHelper_(c,ct,dt,gt))}return _&&(et=et.concat(syncPointApplyOperation(_,e,a,s))),et}}function syncTreeApplyOperationDescendantsHelper_(e,i,s,a){const _=i.get(newEmptyPath());s==null&&_!=null&&(s=syncPointGetCompleteServerCache(_,newEmptyPath()));let et=[];return i.children.inorderTraversal((nt,c)=>{const ct=s?s.getImmediateChild(nt):null,dt=writeTreeRefChild(a,nt),gt=e.operationForChild(nt);gt&&(et=et.concat(syncTreeApplyOperationDescendantsHelper_(gt,c,ct,dt)))}),_&&(et=et.concat(syncPointApplyOperation(_,e,a,s))),et}function syncTreeCreateListenerForView_(e,i){const s=i.query,a=syncTreeTagForQuery(e,s);return{hashFn:()=>(viewGetServerCache(i)||ChildrenNode.EMPTY_NODE).hash(),onComplete:_=>{if(_==="ok")return a?syncTreeApplyTaggedListenComplete(e,s._path,a):syncTreeApplyListenComplete(e,s._path);{const et=errorForServerCode(_,s);return syncTreeRemoveEventRegistration(e,s,null,et)}}}}function syncTreeTagForQuery(e,i){const s=syncTreeMakeQueryKey_(i);return e.queryToTagMap.get(s)}function syncTreeMakeQueryKey_(e){return e._path.toString()+"$"+e._queryIdentifier}function syncTreeQueryKeyForTag_(e,i){return e.tagToQueryMap.get(i)}function syncTreeParseQueryKey_(e){const i=e.indexOf("$");return assert(i!==-1&&i<e.length-1,"Bad queryKey."),{queryId:e.substr(i+1),path:new Path(e.substr(0,i))}}function syncTreeApplyTaggedOperation_(e,i,s){const a=e.syncPointTree_.get(i);assert(a,"Missing sync point for query tag that we're tracking");const _=writeTreeChildWrites(e.pendingWriteTree_,i);return syncPointApplyOperation(a,s,_,null)}function syncTreeCollectDistinctViewsForSubTree_(e){return e.fold((i,s,a)=>{if(s&&syncPointHasCompleteView(s))return[syncPointGetCompleteView(s)];{let _=[];return s&&(_=syncPointGetQueryViews(s)),each(a,(et,nt)=>{_=_.concat(nt)}),_}})}function syncTreeQueryForListening_(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(syncTreeGetReferenceConstructor())(e._repo,e._path):e}function syncTreeRemoveTags_(e,i){for(let s=0;s<i.length;++s){const a=i[s];if(!a._queryParams.loadsAllData()){const _=syncTreeMakeQueryKey_(a),et=e.queryToTagMap.get(_);e.queryToTagMap.delete(_),e.tagToQueryMap.delete(et)}}}function syncTreeGetNextQueryTag_(){return syncTreeNextQueryTag_++}function syncTreeSetupListener_(e,i,s){const a=i._path,_=syncTreeTagForQuery(e,i),et=syncTreeCreateListenerForView_(e,s),nt=e.listenProvider_.startListening(syncTreeQueryForListening_(i),_,et.hashFn,et.onComplete),c=e.syncPointTree_.subtree(a);if(_)assert(!syncPointHasCompleteView(c.value),"If we're adding a query, it shouldn't be shadowed");else{const ct=c.fold((dt,gt,Tt)=>{if(!pathIsEmpty(dt)&&gt&&syncPointHasCompleteView(gt))return[syncPointGetCompleteView(gt).query];{let Et=[];return gt&&(Et=Et.concat(syncPointGetQueryViews(gt).map(At=>At.query))),each(Tt,(At,Mt)=>{Et=Et.concat(Mt)}),Et}});for(let dt=0;dt<ct.length;++dt){const gt=ct[dt];e.listenProvider_.stopListening(syncTreeQueryForListening_(gt),syncTreeTagForQuery(e,gt))}}return nt}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ExistingValueProvider{constructor(i){this.node_=i}getImmediateChild(i){const s=this.node_.getImmediateChild(i);return new ExistingValueProvider(s)}node(){return this.node_}}class DeferredValueProvider{constructor(i,s){this.syncTree_=i,this.path_=s}getImmediateChild(i){const s=pathChild(this.path_,i);return new DeferredValueProvider(this.syncTree_,s)}node(){return syncTreeCalcCompleteEventCache(this.syncTree_,this.path_)}}const generateWithValues=function(e){return e=e||{},e.timestamp=e.timestamp||new Date().getTime(),e},resolveDeferredLeafValue=function(e,i,s){if(!e||typeof e!="object")return e;if(assert(".sv"in e,"Unexpected leaf node or priority contents"),typeof e[".sv"]=="string")return resolveScalarDeferredValue(e[".sv"],i,s);if(typeof e[".sv"]=="object")return resolveComplexDeferredValue(e[".sv"],i);assert(!1,"Unexpected server value: "+JSON.stringify(e,null,2))},resolveScalarDeferredValue=function(e,i,s){switch(e){case"timestamp":return s.timestamp;default:assert(!1,"Unexpected server value: "+e)}},resolveComplexDeferredValue=function(e,i,s){e.hasOwnProperty("increment")||assert(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const a=e.increment;typeof a!="number"&&assert(!1,"Unexpected increment value: "+a);const _=i.node();if(assert(_!==null&&typeof _<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!_.isLeafNode())return a;const nt=_.getValue();return typeof nt!="number"?a:nt+a},resolveDeferredValueTree=function(e,i,s,a){return resolveDeferredValue(i,new DeferredValueProvider(s,e),a)},resolveDeferredValueSnapshot=function(e,i,s){return resolveDeferredValue(e,new ExistingValueProvider(i),s)};function resolveDeferredValue(e,i,s){const a=e.getPriority().val(),_=resolveDeferredLeafValue(a,i.getImmediateChild(".priority"),s);let et;if(e.isLeafNode()){const nt=e,c=resolveDeferredLeafValue(nt.getValue(),i,s);return c!==nt.getValue()||_!==nt.getPriority().val()?new LeafNode(c,nodeFromJSON(_)):e}else{const nt=e;return et=nt,_!==nt.getPriority().val()&&(et=et.updatePriority(new LeafNode(_))),nt.forEachChild(PRIORITY_INDEX,(c,ct)=>{const dt=resolveDeferredValue(ct,i.getImmediateChild(c),s);dt!==ct&&(et=et.updateImmediateChild(c,dt))}),et}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tree{constructor(i="",s=null,a={children:{},childCount:0}){this.name=i,this.parent=s,this.node=a}}function treeSubTree(e,i){let s=i instanceof Path?i:new Path(i),a=e,_=pathGetFront(s);for(;_!==null;){const et=safeGet(a.node.children,_)||{children:{},childCount:0};a=new Tree(_,a,et),s=pathPopFront(s),_=pathGetFront(s)}return a}function treeGetValue(e){return e.node.value}function treeSetValue(e,i){e.node.value=i,treeUpdateParents(e)}function treeHasChildren(e){return e.node.childCount>0}function treeIsEmpty(e){return treeGetValue(e)===void 0&&!treeHasChildren(e)}function treeForEachChild(e,i){each(e.node.children,(s,a)=>{i(new Tree(s,e,a))})}function treeForEachDescendant(e,i,s,a){s&&!a&&i(e),treeForEachChild(e,_=>{treeForEachDescendant(_,i,!0,a)}),s&&a&&i(e)}function treeForEachAncestor(e,i,s){let a=e.parent;for(;a!==null;){if(i(a))return!0;a=a.parent}return!1}function treeGetPath(e){return new Path(e.parent===null?e.name:treeGetPath(e.parent)+"/"+e.name)}function treeUpdateParents(e){e.parent!==null&&treeUpdateChild(e.parent,e.name,e)}function treeUpdateChild(e,i,s){const a=treeIsEmpty(s),_=contains(e.node.children,i);a&&_?(delete e.node.children[i],e.node.childCount--,treeUpdateParents(e)):!a&&!_&&(e.node.children[i]=s.node,e.node.childCount++,treeUpdateParents(e))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const INVALID_KEY_REGEX_=/[\[\].#$\/\u0000-\u001F\u007F]/,INVALID_PATH_REGEX_=/[\[\].#$\u0000-\u001F\u007F]/,MAX_LEAF_SIZE_=10*1024*1024,isValidKey=function(e){return typeof e=="string"&&e.length!==0&&!INVALID_KEY_REGEX_.test(e)},isValidPathString=function(e){return typeof e=="string"&&e.length!==0&&!INVALID_PATH_REGEX_.test(e)},isValidRootPathString=function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),isValidPathString(e)},isValidPriority=function(e){return e===null||typeof e=="string"||typeof e=="number"&&!isInvalidJSONNumber(e)||e&&typeof e=="object"&&contains(e,".sv")},validateFirebaseDataArg=function(e,i,s,a){a&&i===void 0||validateFirebaseData(errorPrefix(e,"value"),i,s)},validateFirebaseData=function(e,i,s){const a=s instanceof Path?new ValidationPath(s,e):s;if(i===void 0)throw new Error(e+"contains undefined "+validationPathToErrorString(a));if(typeof i=="function")throw new Error(e+"contains a function "+validationPathToErrorString(a)+" with contents = "+i.toString());if(isInvalidJSONNumber(i))throw new Error(e+"contains "+i.toString()+" "+validationPathToErrorString(a));if(typeof i=="string"&&i.length>MAX_LEAF_SIZE_/3&&stringLength(i)>MAX_LEAF_SIZE_)throw new Error(e+"contains a string greater than "+MAX_LEAF_SIZE_+" utf8 bytes "+validationPathToErrorString(a)+" ('"+i.substring(0,50)+"...')");if(i&&typeof i=="object"){let _=!1,et=!1;if(each(i,(nt,c)=>{if(nt===".value")_=!0;else if(nt!==".priority"&&nt!==".sv"&&(et=!0,!isValidKey(nt)))throw new Error(e+" contains an invalid key ("+nt+") "+validationPathToErrorString(a)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);validationPathPush(a,nt),validateFirebaseData(e,c,a),validationPathPop(a)}),_&&et)throw new Error(e+' contains ".value" child '+validationPathToErrorString(a)+" in addition to actual children.")}},validateFirebaseMergePaths=function(e,i){let s,a;for(s=0;s<i.length;s++){a=i[s];const et=pathSlice(a);for(let nt=0;nt<et.length;nt++)if(!(et[nt]===".priority"&&nt===et.length-1)){if(!isValidKey(et[nt]))throw new Error(e+"contains an invalid key ("+et[nt]+") in path "+a.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}i.sort(pathCompare);let _=null;for(s=0;s<i.length;s++){if(a=i[s],_!==null&&pathContains(_,a))throw new Error(e+"contains a path "+_.toString()+" that is ancestor of another path "+a.toString());_=a}},validateFirebaseMergeDataArg=function(e,i,s,a){const _=errorPrefix(e,"values");if(!(i&&typeof i=="object")||Array.isArray(i))throw new Error(_+" must be an object containing the children to replace.");const et=[];each(i,(nt,c)=>{const ct=new Path(nt);if(validateFirebaseData(_,c,pathChild(s,ct)),pathGetBack(ct)===".priority"&&!isValidPriority(c))throw new Error(_+"contains an invalid value for '"+ct.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");et.push(ct)}),validateFirebaseMergePaths(_,et)},validatePathString=function(e,i,s,a){if(!isValidPathString(s))throw new Error(errorPrefix(e,i)+'was an invalid path = "'+s+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},validateRootPathString=function(e,i,s,a){s&&(s=s.replace(/^\/*\.info(\/|$)/,"/")),validatePathString(e,i,s)},validateWritablePath=function(e,i){if(pathGetFront(i)===".info")throw new Error(e+" failed = Can't modify data under /.info/")},validateUrl=function(e,i){const s=i.path.toString();if(typeof i.repoInfo.host!="string"||i.repoInfo.host.length===0||!isValidKey(i.repoInfo.namespace)&&i.repoInfo.host.split(":")[0]!=="localhost"||s.length!==0&&!isValidRootPathString(s))throw new Error(errorPrefix(e,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EventQueue{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function eventQueueQueueEvents(e,i){let s=null;for(let a=0;a<i.length;a++){const _=i[a],et=_.getPath();s!==null&&!pathEquals(et,s.path)&&(e.eventLists_.push(s),s=null),s===null&&(s={events:[],path:et}),s.events.push(_)}s&&e.eventLists_.push(s)}function eventQueueRaiseEventsAtPath(e,i,s){eventQueueQueueEvents(e,s),eventQueueRaiseQueuedEventsMatchingPredicate(e,a=>pathEquals(a,i))}function eventQueueRaiseEventsForChangedPath(e,i,s){eventQueueQueueEvents(e,s),eventQueueRaiseQueuedEventsMatchingPredicate(e,a=>pathContains(a,i)||pathContains(i,a))}function eventQueueRaiseQueuedEventsMatchingPredicate(e,i){e.recursionDepth_++;let s=!0;for(let a=0;a<e.eventLists_.length;a++){const _=e.eventLists_[a];if(_){const et=_.path;i(et)?(eventListRaise(e.eventLists_[a]),e.eventLists_[a]=null):s=!1}}s&&(e.eventLists_=[]),e.recursionDepth_--}function eventListRaise(e){for(let i=0;i<e.events.length;i++){const s=e.events[i];if(s!==null){e.events[i]=null;const a=s.getEventRunner();logger&&log("event: "+s.toString()),exceptionGuard(a)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const INTERRUPT_REASON="repo_interrupt",MAX_TRANSACTION_RETRIES=25;class Repo{constructor(i,s,a,_){this.repoInfo_=i,this.forceRestClient_=s,this.authTokenProvider_=a,this.appCheckProvider_=_,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new EventQueue,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=newSparseSnapshotTree(),this.transactionQueueTree_=new Tree,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function repoStart(e,i,s){if(e.stats_=statsManagerGetCollection(e.repoInfo_),e.forceRestClient_||beingCrawled())e.server_=new ReadonlyRestClient(e.repoInfo_,(a,_,et,nt)=>{repoOnDataUpdate(e,a,_,et,nt)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>repoOnConnectStatus(e,!0),0);else{if(typeof s<"u"&&s!==null){if(typeof s!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{stringify(s)}catch(a){throw new Error("Invalid authOverride provided: "+a)}}e.persistentConnection_=new PersistentConnection(e.repoInfo_,i,(a,_,et,nt)=>{repoOnDataUpdate(e,a,_,et,nt)},a=>{repoOnConnectStatus(e,a)},a=>{repoOnServerInfoUpdate(e,a)},e.authTokenProvider_,e.appCheckProvider_,s),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(a=>{e.server_.refreshAuthToken(a)}),e.appCheckProvider_.addTokenChangeListener(a=>{e.server_.refreshAppCheckToken(a.token)}),e.statsReporter_=statsManagerGetOrCreateReporter(e.repoInfo_,()=>new StatsReporter(e.stats_,e.server_)),e.infoData_=new SnapshotHolder,e.infoSyncTree_=new SyncTree({startListening:(a,_,et,nt)=>{let c=[];const ct=e.infoData_.getNode(a._path);return ct.isEmpty()||(c=syncTreeApplyServerOverwrite(e.infoSyncTree_,a._path,ct),setTimeout(()=>{nt("ok")},0)),c},stopListening:()=>{}}),repoUpdateInfo(e,"connected",!1),e.serverSyncTree_=new SyncTree({startListening:(a,_,et,nt)=>(e.server_.listen(a,et,_,(c,ct)=>{const dt=nt(c,ct);eventQueueRaiseEventsForChangedPath(e.eventQueue_,a._path,dt)}),[]),stopListening:(a,_)=>{e.server_.unlisten(a,_)}})}function repoServerTime(e){const s=e.infoData_.getNode(new Path(".info/serverTimeOffset")).val()||0;return new Date().getTime()+s}function repoGenerateServerValues(e){return generateWithValues({timestamp:repoServerTime(e)})}function repoOnDataUpdate(e,i,s,a,_){e.dataUpdateCount++;const et=new Path(i);s=e.interceptServerDataCallback_?e.interceptServerDataCallback_(i,s):s;let nt=[];if(_)if(a){const ct=map(s,dt=>nodeFromJSON(dt));nt=syncTreeApplyTaggedQueryMerge(e.serverSyncTree_,et,ct,_)}else{const ct=nodeFromJSON(s);nt=syncTreeApplyTaggedQueryOverwrite(e.serverSyncTree_,et,ct,_)}else if(a){const ct=map(s,dt=>nodeFromJSON(dt));nt=syncTreeApplyServerMerge(e.serverSyncTree_,et,ct)}else{const ct=nodeFromJSON(s);nt=syncTreeApplyServerOverwrite(e.serverSyncTree_,et,ct)}let c=et;nt.length>0&&(c=repoRerunTransactions(e,et)),eventQueueRaiseEventsForChangedPath(e.eventQueue_,c,nt)}function repoOnConnectStatus(e,i){repoUpdateInfo(e,"connected",i),i===!1&&repoRunOnDisconnectEvents(e)}function repoOnServerInfoUpdate(e,i){each(i,(s,a)=>{repoUpdateInfo(e,s,a)})}function repoUpdateInfo(e,i,s){const a=new Path("/.info/"+i),_=nodeFromJSON(s);e.infoData_.updateSnapshot(a,_);const et=syncTreeApplyServerOverwrite(e.infoSyncTree_,a,_);eventQueueRaiseEventsForChangedPath(e.eventQueue_,a,et)}function repoGetNextWriteId(e){return e.nextWriteId_++}function repoGetValue(e,i,s){const a=syncTreeGetServerValue(e.serverSyncTree_,i);return a!=null?Promise.resolve(a):e.server_.get(i).then(_=>{const et=nodeFromJSON(_).withIndex(i._queryParams.getIndex());syncTreeAddEventRegistration(e.serverSyncTree_,i,s,!0);let nt;if(i._queryParams.loadsAllData())nt=syncTreeApplyServerOverwrite(e.serverSyncTree_,i._path,et);else{const c=syncTreeTagForQuery(e.serverSyncTree_,i);nt=syncTreeApplyTaggedQueryOverwrite(e.serverSyncTree_,i._path,et,c)}return eventQueueRaiseEventsForChangedPath(e.eventQueue_,i._path,nt),syncTreeRemoveEventRegistration(e.serverSyncTree_,i,s,null,!0),et},_=>(repoLog(e,"get for query "+stringify(i)+" failed: "+_),Promise.reject(new Error(_))))}function repoSetWithPriority(e,i,s,a,_){repoLog(e,"set",{path:i.toString(),value:s,priority:a});const et=repoGenerateServerValues(e),nt=nodeFromJSON(s,a),c=syncTreeCalcCompleteEventCache(e.serverSyncTree_,i),ct=resolveDeferredValueSnapshot(nt,c,et),dt=repoGetNextWriteId(e),gt=syncTreeApplyUserOverwrite(e.serverSyncTree_,i,ct,dt,!0);eventQueueQueueEvents(e.eventQueue_,gt),e.server_.put(i.toString(),nt.val(!0),(Et,At)=>{const Mt=Et==="ok";Mt||warn("set at "+i+" failed: "+Et);const Pt=syncTreeAckUserWrite(e.serverSyncTree_,dt,!Mt);eventQueueRaiseEventsForChangedPath(e.eventQueue_,i,Pt),repoCallOnCompleteCallback(e,_,Et,At)});const Tt=repoAbortTransactions(e,i);repoRerunTransactions(e,Tt),eventQueueRaiseEventsForChangedPath(e.eventQueue_,Tt,[])}function repoUpdate(e,i,s,a){repoLog(e,"update",{path:i.toString(),value:s});let _=!0;const et=repoGenerateServerValues(e),nt={};if(each(s,(c,ct)=>{_=!1,nt[c]=resolveDeferredValueTree(pathChild(i,c),nodeFromJSON(ct),e.serverSyncTree_,et)}),_)log("update() called with empty data.  Don't do anything."),repoCallOnCompleteCallback(e,a,"ok",void 0);else{const c=repoGetNextWriteId(e),ct=syncTreeApplyUserMerge(e.serverSyncTree_,i,nt,c);eventQueueQueueEvents(e.eventQueue_,ct),e.server_.merge(i.toString(),s,(dt,gt)=>{const Tt=dt==="ok";Tt||warn("update at "+i+" failed: "+dt);const Et=syncTreeAckUserWrite(e.serverSyncTree_,c,!Tt),At=Et.length>0?repoRerunTransactions(e,i):i;eventQueueRaiseEventsForChangedPath(e.eventQueue_,At,Et),repoCallOnCompleteCallback(e,a,dt,gt)}),each(s,dt=>{const gt=repoAbortTransactions(e,pathChild(i,dt));repoRerunTransactions(e,gt)}),eventQueueRaiseEventsForChangedPath(e.eventQueue_,i,[])}}function repoRunOnDisconnectEvents(e){repoLog(e,"onDisconnectEvents");const i=repoGenerateServerValues(e),s=newSparseSnapshotTree();sparseSnapshotTreeForEachTree(e.onDisconnect_,newEmptyPath(),(_,et)=>{const nt=resolveDeferredValueTree(_,et,e.serverSyncTree_,i);sparseSnapshotTreeRemember(s,_,nt)});let a=[];sparseSnapshotTreeForEachTree(s,newEmptyPath(),(_,et)=>{a=a.concat(syncTreeApplyServerOverwrite(e.serverSyncTree_,_,et));const nt=repoAbortTransactions(e,_);repoRerunTransactions(e,nt)}),e.onDisconnect_=newSparseSnapshotTree(),eventQueueRaiseEventsForChangedPath(e.eventQueue_,newEmptyPath(),a)}function repoAddEventCallbackForQuery(e,i,s){let a;pathGetFront(i._path)===".info"?a=syncTreeAddEventRegistration(e.infoSyncTree_,i,s):a=syncTreeAddEventRegistration(e.serverSyncTree_,i,s),eventQueueRaiseEventsAtPath(e.eventQueue_,i._path,a)}function repoRemoveEventCallbackForQuery(e,i,s){let a;pathGetFront(i._path)===".info"?a=syncTreeRemoveEventRegistration(e.infoSyncTree_,i,s):a=syncTreeRemoveEventRegistration(e.serverSyncTree_,i,s),eventQueueRaiseEventsAtPath(e.eventQueue_,i._path,a)}function repoInterrupt(e){e.persistentConnection_&&e.persistentConnection_.interrupt(INTERRUPT_REASON)}function repoLog(e,...i){let s="";e.persistentConnection_&&(s=e.persistentConnection_.id+":"),log(s,...i)}function repoCallOnCompleteCallback(e,i,s,a){i&&exceptionGuard(()=>{if(s==="ok")i(null);else{const _=(s||"error").toUpperCase();let et=_;a&&(et+=": "+a);const nt=new Error(et);nt.code=_,i(nt)}})}function repoGetLatestState(e,i,s){return syncTreeCalcCompleteEventCache(e.serverSyncTree_,i,s)||ChildrenNode.EMPTY_NODE}function repoSendReadyTransactions(e,i=e.transactionQueueTree_){if(i||repoPruneCompletedTransactionsBelowNode(e,i),treeGetValue(i)){const s=repoBuildTransactionQueue(e,i);assert(s.length>0,"Sending zero length transaction queue"),s.every(_=>_.status===0)&&repoSendTransactionQueue(e,treeGetPath(i),s)}else treeHasChildren(i)&&treeForEachChild(i,s=>{repoSendReadyTransactions(e,s)})}function repoSendTransactionQueue(e,i,s){const a=s.map(dt=>dt.currentWriteId),_=repoGetLatestState(e,i,a);let et=_;const nt=_.hash();for(let dt=0;dt<s.length;dt++){const gt=s[dt];assert(gt.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),gt.status=1,gt.retryCount++;const Tt=newRelativePath(i,gt.path);et=et.updateChild(Tt,gt.currentOutputSnapshotRaw)}const c=et.val(!0),ct=i;e.server_.put(ct.toString(),c,dt=>{repoLog(e,"transaction put response",{path:ct.toString(),status:dt});let gt=[];if(dt==="ok"){const Tt=[];for(let Et=0;Et<s.length;Et++)s[Et].status=2,gt=gt.concat(syncTreeAckUserWrite(e.serverSyncTree_,s[Et].currentWriteId)),s[Et].onComplete&&Tt.push(()=>s[Et].onComplete(null,!0,s[Et].currentOutputSnapshotResolved)),s[Et].unwatcher();repoPruneCompletedTransactionsBelowNode(e,treeSubTree(e.transactionQueueTree_,i)),repoSendReadyTransactions(e,e.transactionQueueTree_),eventQueueRaiseEventsForChangedPath(e.eventQueue_,i,gt);for(let Et=0;Et<Tt.length;Et++)exceptionGuard(Tt[Et])}else{if(dt==="datastale")for(let Tt=0;Tt<s.length;Tt++)s[Tt].status===3?s[Tt].status=4:s[Tt].status=0;else{warn("transaction at "+ct.toString()+" failed: "+dt);for(let Tt=0;Tt<s.length;Tt++)s[Tt].status=4,s[Tt].abortReason=dt}repoRerunTransactions(e,i)}},nt)}function repoRerunTransactions(e,i){const s=repoGetAncestorTransactionNode(e,i),a=treeGetPath(s),_=repoBuildTransactionQueue(e,s);return repoRerunTransactionQueue(e,_,a),a}function repoRerunTransactionQueue(e,i,s){if(i.length===0)return;const a=[];let _=[];const nt=i.filter(c=>c.status===0).map(c=>c.currentWriteId);for(let c=0;c<i.length;c++){const ct=i[c],dt=newRelativePath(s,ct.path);let gt=!1,Tt;if(assert(dt!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),ct.status===4)gt=!0,Tt=ct.abortReason,_=_.concat(syncTreeAckUserWrite(e.serverSyncTree_,ct.currentWriteId,!0));else if(ct.status===0)if(ct.retryCount>=MAX_TRANSACTION_RETRIES)gt=!0,Tt="maxretry",_=_.concat(syncTreeAckUserWrite(e.serverSyncTree_,ct.currentWriteId,!0));else{const Et=repoGetLatestState(e,ct.path,nt);ct.currentInputSnapshot=Et;const At=i[c].update(Et.val());if(At!==void 0){validateFirebaseData("transaction failed: Data returned ",At,ct.path);let Mt=nodeFromJSON(At);typeof At=="object"&&At!=null&&contains(At,".priority")||(Mt=Mt.updatePriority(Et.getPriority()));const $t=ct.currentWriteId,Lt=repoGenerateServerValues(e),Bt=resolveDeferredValueSnapshot(Mt,Et,Lt);ct.currentOutputSnapshotRaw=Mt,ct.currentOutputSnapshotResolved=Bt,ct.currentWriteId=repoGetNextWriteId(e),nt.splice(nt.indexOf($t),1),_=_.concat(syncTreeApplyUserOverwrite(e.serverSyncTree_,ct.path,Bt,ct.currentWriteId,ct.applyLocally)),_=_.concat(syncTreeAckUserWrite(e.serverSyncTree_,$t,!0))}else gt=!0,Tt="nodata",_=_.concat(syncTreeAckUserWrite(e.serverSyncTree_,ct.currentWriteId,!0))}eventQueueRaiseEventsForChangedPath(e.eventQueue_,s,_),_=[],gt&&(i[c].status=2,function(Et){setTimeout(Et,Math.floor(0))}(i[c].unwatcher),i[c].onComplete&&(Tt==="nodata"?a.push(()=>i[c].onComplete(null,!1,i[c].currentInputSnapshot)):a.push(()=>i[c].onComplete(new Error(Tt),!1,null))))}repoPruneCompletedTransactionsBelowNode(e,e.transactionQueueTree_);for(let c=0;c<a.length;c++)exceptionGuard(a[c]);repoSendReadyTransactions(e,e.transactionQueueTree_)}function repoGetAncestorTransactionNode(e,i){let s,a=e.transactionQueueTree_;for(s=pathGetFront(i);s!==null&&treeGetValue(a)===void 0;)a=treeSubTree(a,s),i=pathPopFront(i),s=pathGetFront(i);return a}function repoBuildTransactionQueue(e,i){const s=[];return repoAggregateTransactionQueuesForNode(e,i,s),s.sort((a,_)=>a.order-_.order),s}function repoAggregateTransactionQueuesForNode(e,i,s){const a=treeGetValue(i);if(a)for(let _=0;_<a.length;_++)s.push(a[_]);treeForEachChild(i,_=>{repoAggregateTransactionQueuesForNode(e,_,s)})}function repoPruneCompletedTransactionsBelowNode(e,i){const s=treeGetValue(i);if(s){let a=0;for(let _=0;_<s.length;_++)s[_].status!==2&&(s[a]=s[_],a++);s.length=a,treeSetValue(i,s.length>0?s:void 0)}treeForEachChild(i,a=>{repoPruneCompletedTransactionsBelowNode(e,a)})}function repoAbortTransactions(e,i){const s=treeGetPath(repoGetAncestorTransactionNode(e,i)),a=treeSubTree(e.transactionQueueTree_,i);return treeForEachAncestor(a,_=>{repoAbortTransactionsOnNode(e,_)}),repoAbortTransactionsOnNode(e,a),treeForEachDescendant(a,_=>{repoAbortTransactionsOnNode(e,_)}),s}function repoAbortTransactionsOnNode(e,i){const s=treeGetValue(i);if(s){const a=[];let _=[],et=-1;for(let nt=0;nt<s.length;nt++)s[nt].status===3||(s[nt].status===1?(assert(et===nt-1,"All SENT items should be at beginning of queue."),et=nt,s[nt].status=3,s[nt].abortReason="set"):(assert(s[nt].status===0,"Unexpected transaction status in abort"),s[nt].unwatcher(),_=_.concat(syncTreeAckUserWrite(e.serverSyncTree_,s[nt].currentWriteId,!0)),s[nt].onComplete&&a.push(s[nt].onComplete.bind(null,new Error("set"),!1,null))));et===-1?treeSetValue(i,void 0):s.length=et+1,eventQueueRaiseEventsForChangedPath(e.eventQueue_,treeGetPath(i),_);for(let nt=0;nt<a.length;nt++)exceptionGuard(a[nt])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function decodePath(e){let i="";const s=e.split("/");for(let a=0;a<s.length;a++)if(s[a].length>0){let _=s[a];try{_=decodeURIComponent(_.replace(/\+/g," "))}catch{}i+="/"+_}return i}function decodeQuery(e){const i={};e.charAt(0)==="?"&&(e=e.substring(1));for(const s of e.split("&")){if(s.length===0)continue;const a=s.split("=");a.length===2?i[decodeURIComponent(a[0])]=decodeURIComponent(a[1]):warn(`Invalid query segment '${s}' in query '${e}'`)}return i}const parseRepoInfo=function(e,i){const s=parseDatabaseURL(e),a=s.namespace;s.domain==="firebase.com"&&fatal(s.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!a||a==="undefined")&&s.domain!=="localhost"&&fatal("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),s.secure||warnIfPageIsSecure();const _=s.scheme==="ws"||s.scheme==="wss";return{repoInfo:new RepoInfo(s.host,s.secure,a,_,i,"",a!==s.subdomain),path:new Path(s.pathString)}},parseDatabaseURL=function(e){let i="",s="",a="",_="",et="",nt=!0,c="https",ct=443;if(typeof e=="string"){let dt=e.indexOf("//");dt>=0&&(c=e.substring(0,dt-1),e=e.substring(dt+2));let gt=e.indexOf("/");gt===-1&&(gt=e.length);let Tt=e.indexOf("?");Tt===-1&&(Tt=e.length),i=e.substring(0,Math.min(gt,Tt)),gt<Tt&&(_=decodePath(e.substring(gt,Tt)));const Et=decodeQuery(e.substring(Math.min(e.length,Tt)));dt=i.indexOf(":"),dt>=0?(nt=c==="https"||c==="wss",ct=parseInt(i.substring(dt+1),10)):dt=i.length;const At=i.slice(0,dt);if(At.toLowerCase()==="localhost")s="localhost";else if(At.split(".").length<=2)s=At;else{const Mt=i.indexOf(".");a=i.substring(0,Mt).toLowerCase(),s=i.substring(Mt+1),et=a}"ns"in Et&&(et=Et.ns)}return{host:i,port:ct,domain:s,subdomain:a,secure:nt,scheme:c,pathString:_,namespace:et}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PUSH_CHARS="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",nextPushId=function(){let e=0;const i=[];return function(s){const a=s===e;e=s;let _;const et=new Array(8);for(_=7;_>=0;_--)et[_]=PUSH_CHARS.charAt(s%64),s=Math.floor(s/64);assert(s===0,"Cannot push at time == 0");let nt=et.join("");if(a){for(_=11;_>=0&&i[_]===63;_--)i[_]=0;i[_]++}else for(_=0;_<12;_++)i[_]=Math.floor(Math.random()*64);for(_=0;_<12;_++)nt+=PUSH_CHARS.charAt(i[_]);return assert(nt.length===20,"nextPushId: Length should be 20."),nt}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DataEvent{constructor(i,s,a,_){this.eventType=i,this.eventRegistration=s,this.snapshot=a,this.prevName=_}getPath(){const i=this.snapshot.ref;return this.eventType==="value"?i._path:i.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+stringify(this.snapshot.exportVal())}}class CancelEvent{constructor(i,s,a){this.eventRegistration=i,this.error=s,this.path=a}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CallbackContext{constructor(i,s){this.snapshotCallback=i,this.cancelCallback=s}onValue(i,s){this.snapshotCallback.call(null,i,s)}onCancel(i){return assert(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,i)}get hasCancelCallback(){return!!this.cancelCallback}matches(i){return this.snapshotCallback===i.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===i.snapshotCallback.userCallback&&this.snapshotCallback.context===i.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QueryImpl{constructor(i,s,a,_){this._repo=i,this._path=s,this._queryParams=a,this._orderByCalled=_}get key(){return pathIsEmpty(this._path)?null:pathGetBack(this._path)}get ref(){return new ReferenceImpl(this._repo,this._path)}get _queryIdentifier(){const i=queryParamsGetQueryObject(this._queryParams),s=ObjectToUniqueKey(i);return s==="{}"?"default":s}get _queryObject(){return queryParamsGetQueryObject(this._queryParams)}isEqual(i){if(i=getModularInstance(i),!(i instanceof QueryImpl))return!1;const s=this._repo===i._repo,a=pathEquals(this._path,i._path),_=this._queryIdentifier===i._queryIdentifier;return s&&a&&_}toJSON(){return this.toString()}toString(){return this._repo.toString()+pathToUrlEncodedString(this._path)}}class ReferenceImpl extends QueryImpl{constructor(i,s){super(i,s,new QueryParams,!1)}get parent(){const i=pathParent(this._path);return i===null?null:new ReferenceImpl(this._repo,i)}get root(){let i=this;for(;i.parent!==null;)i=i.parent;return i}}class DataSnapshot{constructor(i,s,a){this._node=i,this.ref=s,this._index=a}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(i){const s=new Path(i),a=child(this.ref,i);return new DataSnapshot(this._node.getChild(s),a,PRIORITY_INDEX)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(i){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(a,_)=>i(new DataSnapshot(_,child(this.ref,a),PRIORITY_INDEX)))}hasChild(i){const s=new Path(i);return!this._node.getChild(s).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ref(e,i){return e=getModularInstance(e),e._checkNotDeleted("ref"),i!==void 0?child(e._root,i):e._root}function child(e,i){return e=getModularInstance(e),pathGetFront(e._path)===null?validateRootPathString("child","path",i):validatePathString("child","path",i),new ReferenceImpl(e._repo,pathChild(e._path,i))}function push(e,i){e=getModularInstance(e),validateWritablePath("push",e._path),validateFirebaseDataArg("push",i,e._path,!0);const s=repoServerTime(e._repo),a=nextPushId(s),_=child(e,a),et=child(e,a);let nt;return nt=Promise.resolve(et),_.then=nt.then.bind(nt),_.catch=nt.then.bind(nt,void 0),_}function remove(e){return validateWritablePath("remove",e._path),set(e,null)}function set(e,i){e=getModularInstance(e),validateWritablePath("set",e._path),validateFirebaseDataArg("set",i,e._path,!1);const s=new Deferred;return repoSetWithPriority(e._repo,e._path,i,null,s.wrapCallback(()=>{})),s.promise}function update(e,i){validateFirebaseMergeDataArg("update",i,e._path);const s=new Deferred;return repoUpdate(e._repo,e._path,i,s.wrapCallback(()=>{})),s.promise}function get(e){e=getModularInstance(e);const i=new CallbackContext(()=>{}),s=new ValueEventRegistration(i);return repoGetValue(e._repo,e,s).then(a=>new DataSnapshot(a,new ReferenceImpl(e._repo,e._path),e._queryParams.getIndex()))}class ValueEventRegistration{constructor(i){this.callbackContext=i}respondsTo(i){return i==="value"}createEvent(i,s){const a=s._queryParams.getIndex();return new DataEvent("value",this,new DataSnapshot(i.snapshotNode,new ReferenceImpl(s._repo,s._path),a))}getEventRunner(i){return i.getEventType()==="cancel"?()=>this.callbackContext.onCancel(i.error):()=>this.callbackContext.onValue(i.snapshot,null)}createCancelEvent(i,s){return this.callbackContext.hasCancelCallback?new CancelEvent(this,i,s):null}matches(i){return i instanceof ValueEventRegistration?!i.callbackContext||!this.callbackContext?!0:i.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function addEventListener(e,i,s,a,_){let et;if(typeof a=="object"&&(et=void 0,_=a),typeof a=="function"&&(et=a),_&&_.onlyOnce){const ct=s,dt=(gt,Tt)=>{repoRemoveEventCallbackForQuery(e._repo,e,c),ct(gt,Tt)};dt.userCallback=s.userCallback,dt.context=s.context,s=dt}const nt=new CallbackContext(s,et||void 0),c=new ValueEventRegistration(nt);return repoAddEventCallbackForQuery(e._repo,e,c),()=>repoRemoveEventCallbackForQuery(e._repo,e,c)}function onValue(e,i,s,a){return addEventListener(e,"value",i,s,a)}syncPointSetReferenceConstructor(ReferenceImpl);syncTreeSetReferenceConstructor(ReferenceImpl);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FIREBASE_DATABASE_EMULATOR_HOST_VAR="FIREBASE_DATABASE_EMULATOR_HOST",repos={};let useRestClient=!1;function repoManagerApplyEmulatorSettings(e,i,s,a){const _=i.lastIndexOf(":"),et=i.substring(0,_),nt=isCloudWorkstation(et);e.repoInfo_=new RepoInfo(i,nt,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,s),a&&(e.authTokenProvider_=a)}function repoManagerDatabaseFromApp(e,i,s,a,_){let et=a||e.options.databaseURL;et===void 0&&(e.options.projectId||fatal("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),log("Using default host for project ",e.options.projectId),et=`${e.options.projectId}-default-rtdb.firebaseio.com`);let nt=parseRepoInfo(et,_),c=nt.repoInfo,ct;typeof process<"u"&&define_process_env_default&&(ct=define_process_env_default[FIREBASE_DATABASE_EMULATOR_HOST_VAR]),ct?(et=`http://${ct}?ns=${c.namespace}`,nt=parseRepoInfo(et,_),c=nt.repoInfo):nt.repoInfo.secure;const dt=new FirebaseAuthTokenProvider(e.name,e.options,i);validateUrl("Invalid Firebase Database URL",nt),pathIsEmpty(nt.path)||fatal("Database URL must point to the root of a Firebase Database (not including a child path).");const gt=repoManagerCreateRepo(c,e,dt,new AppCheckTokenProvider(e,s));return new Database(gt,e)}function repoManagerDeleteRepo(e,i){const s=repos[i];(!s||s[e.key]!==e)&&fatal(`Database ${i}(${e.repoInfo_}) has already been deleted.`),repoInterrupt(e),delete s[e.key]}function repoManagerCreateRepo(e,i,s,a){let _=repos[i.name];_||(_={},repos[i.name]=_);let et=_[e.toURLString()];return et&&fatal("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),et=new Repo(e,useRestClient,s,a),_[e.toURLString()]=et,et}class Database{constructor(i,s){this._repoInternal=i,this.app=s,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(repoStart(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ReferenceImpl(this._repo,newEmptyPath())),this._rootInternal}_delete(){return this._rootInternal!==null&&(repoManagerDeleteRepo(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(i){this._rootInternal===null&&fatal("Cannot call "+i+" on a deleted database.")}}function getDatabase(e=getApp(),i){const s=_getProvider(e,"database").getImmediate({identifier:i});if(!s._instanceStarted){const a=getDefaultEmulatorHostnameAndPort("database");a&&connectDatabaseEmulator(s,...a)}return s}function connectDatabaseEmulator(e,i,s,a={}){e=getModularInstance(e),e._checkNotDeleted("useEmulator");const _=`${i}:${s}`,et=e._repoInternal;if(e._instanceStarted){if(_===e._repoInternal.repoInfo_.host&&deepEqual(a,et.repoInfo_.emulatorOptions))return;fatal("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let nt;if(et.repoInfo_.nodeAdmin)a.mockUserToken&&fatal('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),nt=new EmulatorTokenProvider(EmulatorTokenProvider.OWNER);else if(a.mockUserToken){const c=typeof a.mockUserToken=="string"?a.mockUserToken:createMockUserToken(a.mockUserToken,e.app.options.projectId);nt=new EmulatorTokenProvider(c)}isCloudWorkstation(i)&&(pingServer(i),updateEmulatorBanner("Database",!0)),repoManagerApplyEmulatorSettings(et,_,a,nt)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function registerDatabase(e){setSDKVersion(SDK_VERSION$1),_registerComponent(new Component("database",(i,{instanceIdentifier:s})=>{const a=i.getProvider("app").getImmediate(),_=i.getProvider("auth-internal"),et=i.getProvider("app-check-internal");return repoManagerDatabaseFromApp(a,_,et,s)},"PUBLIC").setMultipleInstances(!0)),registerVersion(name$2,version$2,e),registerVersion(name$2,version$2,"esm2020")}PersistentConnection.prototype.simpleListen=function(e,i){this.sendRequest("q",{p:e},i)};PersistentConnection.prototype.echo=function(e,i){this.sendRequest("echo",{d:e},i)};registerDatabase();var name$1="firebase",version$1="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */registerVersion(name$1,version$1,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_HOST="firebasestorage.googleapis.com",CONFIG_STORAGE_BUCKET_KEY="storageBucket",DEFAULT_MAX_OPERATION_RETRY_TIME=2*60*1e3,DEFAULT_MAX_UPLOAD_RETRY_TIME=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StorageError extends FirebaseError{constructor(i,s,a=0){super(prependCode(i),`Firebase Storage: ${s} (${prependCode(i)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,StorageError.prototype)}get status(){return this.status_}set status(i){this.status_=i}_codeEquals(i){return prependCode(i)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(i){this.customData.serverResponse=i,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var StorageErrorCode;(function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(StorageErrorCode||(StorageErrorCode={}));function prependCode(e){return"storage/"+e}function unknown(){const e="An unknown error occurred, please check the error payload for server response.";return new StorageError(StorageErrorCode.UNKNOWN,e)}function retryLimitExceeded(){return new StorageError(StorageErrorCode.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function canceled(){return new StorageError(StorageErrorCode.CANCELED,"User canceled the upload/download.")}function invalidUrl(e){return new StorageError(StorageErrorCode.INVALID_URL,"Invalid URL '"+e+"'.")}function invalidDefaultBucket(e){return new StorageError(StorageErrorCode.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}function invalidArgument(e){return new StorageError(StorageErrorCode.INVALID_ARGUMENT,e)}function appDeleted(){return new StorageError(StorageErrorCode.APP_DELETED,"The Firebase app was deleted.")}function invalidRootOperation(e){return new StorageError(StorageErrorCode.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Location{constructor(i,s){this.bucket=i,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const i=encodeURIComponent;return"/b/"+i(this.bucket)+"/o/"+i(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(i,s){let a;try{a=Location.makeFromUrl(i,s)}catch{return new Location(i,"")}if(a.path==="")return a;throw invalidDefaultBucket(i)}static makeFromUrl(i,s){let a=null;const _="([A-Za-z0-9.\\-_]+)";function et(Vt){Vt.path.charAt(Vt.path.length-1)==="/"&&(Vt.path_=Vt.path_.slice(0,-1))}const nt="(/(.*))?$",c=new RegExp("^gs://"+_+nt,"i"),ct={bucket:1,path:3};function dt(Vt){Vt.path_=decodeURIComponent(Vt.path)}const gt="v[A-Za-z0-9_]+",Tt=s.replace(/[.]/g,"\\."),Et="(/([^?#]*).*)?$",At=new RegExp(`^https?://${Tt}/${gt}/b/${_}/o${Et}`,"i"),Mt={bucket:1,path:3},Pt=s===DEFAULT_HOST?"(?:storage.googleapis.com|storage.cloud.google.com)":s,$t="([^?#]*)",Lt=new RegExp(`^https?://${Pt}/${_}/${$t}`,"i"),Nt=[{regex:c,indices:ct,postModify:et},{regex:At,indices:Mt,postModify:dt},{regex:Lt,indices:{bucket:1,path:2},postModify:dt}];for(let Vt=0;Vt<Nt.length;Vt++){const Xt=Nt[Vt],nr=Xt.regex.exec(i);if(nr){const ar=nr[Xt.indices.bucket];let mr=nr[Xt.indices.path];mr||(mr=""),a=new Location(ar,mr),Xt.postModify(a);break}}if(a==null)throw invalidUrl(i);return a}}class FailRequest{constructor(i){this.promise_=Promise.reject(i)}getPromise(){return this.promise_}cancel(i=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function start(e,i,s){let a=1,_=null,et=null,nt=!1,c=0;function ct(){return c===2}let dt=!1;function gt(...$t){dt||(dt=!0,i.apply(null,$t))}function Tt($t){_=setTimeout(()=>{_=null,e(At,ct())},$t)}function Et(){et&&clearTimeout(et)}function At($t,...Lt){if(dt){Et();return}if($t){Et(),gt.call(null,$t,...Lt);return}if(ct()||nt){Et(),gt.call(null,$t,...Lt);return}a<64&&(a*=2);let Nt;c===1?(c=2,Nt=0):Nt=(a+Math.random())*1e3,Tt(Nt)}let Mt=!1;function Pt($t){Mt||(Mt=!0,Et(),!dt&&(_!==null?($t||(c=2),clearTimeout(_),Tt(0)):$t||(c=1)))}return Tt(0),et=setTimeout(()=>{nt=!0,Pt(!0)},s),Pt}function stop(e){e(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isJustDef(e){return e!==void 0}function validateNumber(e,i,s,a){if(a<i)throw invalidArgument(`Invalid value for '${e}'. Expected ${i} or greater.`);if(a>s)throw invalidArgument(`Invalid value for '${e}'. Expected ${s} or less.`)}function makeQueryString(e){const i=encodeURIComponent;let s="?";for(const a in e)if(e.hasOwnProperty(a)){const _=i(a)+"="+i(e[a]);s=s+_+"&"}return s=s.slice(0,-1),s}var ErrorCode;(function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"})(ErrorCode||(ErrorCode={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isRetryStatusCode(e,i){const s=e>=500&&e<600,_=[408,429].indexOf(e)!==-1,et=i.indexOf(e)!==-1;return s||_||et}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NetworkRequest{constructor(i,s,a,_,et,nt,c,ct,dt,gt,Tt,Et=!0,At=!1){this.url_=i,this.method_=s,this.headers_=a,this.body_=_,this.successCodes_=et,this.additionalRetryCodes_=nt,this.callback_=c,this.errorCallback_=ct,this.timeout_=dt,this.progressCallback_=gt,this.connectionFactory_=Tt,this.retry=Et,this.isUsingEmulator=At,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((Mt,Pt)=>{this.resolve_=Mt,this.reject_=Pt,this.start_()})}start_(){const i=(a,_)=>{if(_){a(!1,new RequestEndStatus(!1,null,!0));return}const et=this.connectionFactory_();this.pendingConnection_=et;const nt=c=>{const ct=c.loaded,dt=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(ct,dt)};this.progressCallback_!==null&&et.addUploadProgressListener(nt),et.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&et.removeUploadProgressListener(nt),this.pendingConnection_=null;const c=et.getErrorCode()===ErrorCode.NO_ERROR,ct=et.getStatus();if(!c||isRetryStatusCode(ct,this.additionalRetryCodes_)&&this.retry){const gt=et.getErrorCode()===ErrorCode.ABORT;a(!1,new RequestEndStatus(!1,null,gt));return}const dt=this.successCodes_.indexOf(ct)!==-1;a(!0,new RequestEndStatus(dt,et))})},s=(a,_)=>{const et=this.resolve_,nt=this.reject_,c=_.connection;if(_.wasSuccessCode)try{const ct=this.callback_(c,c.getResponse());isJustDef(ct)?et(ct):et()}catch(ct){nt(ct)}else if(c!==null){const ct=unknown();ct.serverResponse=c.getErrorText(),this.errorCallback_?nt(this.errorCallback_(c,ct)):nt(ct)}else if(_.canceled){const ct=this.appDelete_?appDeleted():canceled();nt(ct)}else{const ct=retryLimitExceeded();nt(ct)}};this.canceled_?s(!1,new RequestEndStatus(!1,null,!0)):this.backoffId_=start(i,s,this.timeout_)}getPromise(){return this.promise_}cancel(i){this.canceled_=!0,this.appDelete_=i||!1,this.backoffId_!==null&&stop(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class RequestEndStatus{constructor(i,s,a){this.wasSuccessCode=i,this.connection=s,this.canceled=!!a}}function addAuthHeader_(e,i){i!==null&&i.length>0&&(e.Authorization="Firebase "+i)}function addVersionHeader_(e,i){e["X-Firebase-Storage-Version"]="webjs/"+(i??"AppManager")}function addGmpidHeader_(e,i){i&&(e["X-Firebase-GMPID"]=i)}function addAppCheckHeader_(e,i){i!==null&&(e["X-Firebase-AppCheck"]=i)}function makeRequest(e,i,s,a,_,et,nt=!0,c=!1){const ct=makeQueryString(e.urlParams),dt=e.url+ct,gt=Object.assign({},e.headers);return addGmpidHeader_(gt,i),addAuthHeader_(gt,s),addVersionHeader_(gt,et),addAppCheckHeader_(gt,a),new NetworkRequest(dt,e.method,gt,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,_,nt,c)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function parent$1(e){if(e.length===0)return null;const i=e.lastIndexOf("/");return i===-1?"":e.slice(0,i)}function lastComponent(e){const i=e.lastIndexOf("/",e.length-2);return i===-1?e:e.slice(i+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Reference{constructor(i,s){this._service=i,s instanceof Location?this._location=s:this._location=Location.makeFromUrl(s,i.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(i,s){return new Reference(i,s)}get root(){const i=new Location(this._location.bucket,"");return this._newRef(this._service,i)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return lastComponent(this._location.path)}get storage(){return this._service}get parent(){const i=parent$1(this._location.path);if(i===null)return null;const s=new Location(this._location.bucket,i);return new Reference(this._service,s)}_throwIfRoot(i){if(this._location.path==="")throw invalidRootOperation(i)}}function extractBucket(e,i){const s=i==null?void 0:i[CONFIG_STORAGE_BUCKET_KEY];return s==null?null:Location.makeFromBucketSpec(s,e)}function connectStorageEmulator$1(e,i,s,a={}){e.host=`${i}:${s}`;const _=isCloudWorkstation(i);_&&(pingServer(`https://${e.host}/b`),updateEmulatorBanner("Storage",!0)),e._isUsingEmulator=!0,e._protocol=_?"https":"http";const{mockUserToken:et}=a;et&&(e._overrideAuthToken=typeof et=="string"?et:createMockUserToken(et,e.app.options.projectId))}class FirebaseStorageImpl{constructor(i,s,a,_,et,nt=!1){this.app=i,this._authProvider=s,this._appCheckProvider=a,this._url=_,this._firebaseVersion=et,this._isUsingEmulator=nt,this._bucket=null,this._host=DEFAULT_HOST,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=DEFAULT_MAX_OPERATION_RETRY_TIME,this._maxUploadRetryTime=DEFAULT_MAX_UPLOAD_RETRY_TIME,this._requests=new Set,_!=null?this._bucket=Location.makeFromBucketSpec(_,this._host):this._bucket=extractBucket(this._host,this.app.options)}get host(){return this._host}set host(i){this._host=i,this._url!=null?this._bucket=Location.makeFromBucketSpec(this._url,i):this._bucket=extractBucket(i,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(i){validateNumber("time",0,Number.POSITIVE_INFINITY,i),this._maxUploadRetryTime=i}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(i){validateNumber("time",0,Number.POSITIVE_INFINITY,i),this._maxOperationRetryTime=i}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const i=this._authProvider.getImmediate({optional:!0});if(i){const s=await i.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){if(_isFirebaseServerApp(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=this._appCheckProvider.getImmediate({optional:!0});return i?(await i.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(i=>i.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(i){return new Reference(this,i)}_makeRequest(i,s,a,_,et=!0){if(this._deleted)return new FailRequest(appDeleted());{const nt=makeRequest(i,this._appId,a,_,s,this._firebaseVersion,et,this._isUsingEmulator);return this._requests.add(nt),nt.getPromise().then(()=>this._requests.delete(nt),()=>this._requests.delete(nt)),nt}}async makeRequestWithTokens(i,s){const[a,_]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(i,s,a,_).getPromise()}}const name="@firebase/storage",version="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const STORAGE_TYPE="storage";function getStorage(e=getApp(),i){e=getModularInstance(e);const a=_getProvider(e,STORAGE_TYPE).getImmediate({identifier:i}),_=getDefaultEmulatorHostnameAndPort("storage");return _&&connectStorageEmulator(a,..._),a}function connectStorageEmulator(e,i,s,a={}){connectStorageEmulator$1(e,i,s,a)}function factory(e,{instanceIdentifier:i}){const s=e.getProvider("app").getImmediate(),a=e.getProvider("auth-internal"),_=e.getProvider("app-check-internal");return new FirebaseStorageImpl(s,a,_,i,SDK_VERSION$1)}function registerStorage(){_registerComponent(new Component(STORAGE_TYPE,factory,"PUBLIC").setMultipleInstances(!0)),registerVersion(name,version,""),registerVersion(name,version,"esm2020")}registerStorage();const firebaseConfig={apiKey:"AIzaSyC_2a50875vxMTHa8jZhcfMP--nO_Jvmko",authDomain:"nulltobuild.firebaseapp.com",databaseURL:"https://nulltobuild-default-rtdb.firebaseio.com",projectId:"nulltobuild",storageBucket:"nulltobuild.firebasestorage.app",messagingSenderId:"937347030160",appId:"1:937347030160:web:d60bb96785fbc5a7e9cc15"},app=initializeApp(firebaseConfig),auth=getAuth(app),database=getDatabase(app);getStorage(app);const MAPBOX_ACCESS_TOKEN="pk.eyJ1IjoicGF2YW5rdW1hcnN3YW15IiwiYSI6ImNtNnc1c3ZpdTBkdGgyanM5b25rN2ZqcncifQ.Ls1e2W6rx3apoBsStWa5Ow",AuthContext=reactExports.createContext(void 0);async function getLocationDetails(e,i){try{const a=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${i},${e}.json?access_token=${MAPBOX_ACCESS_TOKEN}&types=address,place,postcode`)).json();let _="",et="",nt="";if(a.features&&a.features.length>0){nt=a.features[0].place_name;for(const c of a.features)c.place_type.includes("place")?_=c.text:c.place_type.includes("postcode")&&(et=c.text)}return{city:_||"Unknown",pincode:et,address:nt||""}}catch(s){return console.error("Error getting location details:",s),{city:"Unknown",pincode:"",address:""}}}function AuthProvider({children:e}){const[i,s]=reactExports.useState(null),[a,_]=reactExports.useState(null),[et,nt]=reactExports.useState(!0),c=async()=>{if(i)try{const Mt=ref(database,`users/${i.uid}`),Pt=await get(Mt);Pt.exists()&&_(Pt.val())}catch(Mt){console.error("Error refreshing user data:",Mt)}};reactExports.useEffect(()=>{const Mt=auth.onAuthStateChanged(Pt=>{s(Pt),Pt?setTimeout(async()=>{try{const $t=ref(database,`users/${Pt.uid}`),Lt=await get($t);Lt.exists()&&_(Lt.val())}catch($t){console.error("Error fetching user data:",$t)}nt(!1)},0):(_(null),nt(!1))});return()=>Mt()},[]);const ct=async(Mt,Pt)=>{const $t=await signInWithEmailAndPassword(auth,Mt,Pt),Lt=ref(database,`users/${$t.user.uid}`),Bt=await get(Lt);Bt.exists()&&_(Bt.val())},dt=async(Mt,Pt,$t,Lt,Bt)=>{const Nt=await createUserWithEmailAndPassword(auth,Mt,Pt),Vt={id:Nt.user.uid,email:Mt,name:$t,phone:Lt,role:Bt,createdAt:Date.now()};await set(ref(database,`users/${Nt.user.uid}`),Vt),_(Vt)},gt=async(Mt,Pt,$t,Lt="home")=>{var fn,Lr;if(!a)return;const{city:Bt,pincode:Nt,address:Vt}=await getLocationDetails(Mt,Pt);let Xt=Nt;if(!Xt&&$t){const Qr=$t.match(/\b\d{6}\b/);Qr&&(Xt=Qr[0])}const nr=$t||Vt||"",ar={...a.address,line2:((fn=a.address)==null?void 0:fn.line2)||"",landmark:((Lr=a.address)==null?void 0:Lr.landmark)||"",line1:nr,city:Bt,pincode:Xt||"",lat:Mt,lng:Pt,label:Lt},mr=a.savedAddresses||[],Fr=mr.findIndex(Qr=>Qr.lat===Mt&&Qr.lng===Pt);let sn;Fr>=0?(sn=[...mr],sn[Fr]={...sn[Fr],...ar,label:Lt}):sn=[...mr,ar],await update(ref(database,`users/${a.id}`),{address:ar,savedAddresses:sn}),_(Qr=>Qr?{...Qr,address:ar,savedAddresses:sn}:null)},Tt=async()=>{await signOut(auth),_(null)},Et=async Mt=>{if(!a)return;const Pt=a.favorites||[];let $t;Pt.includes(Mt)?$t=Pt.filter(Lt=>Lt!==Mt):$t=[...Pt,Mt];try{await update(ref(database,`users/${a.id}`),{favorites:$t}),_({...a,favorites:$t})}catch(Lt){console.error("Error updating favorites:",Lt)}},At=async(Mt,Pt)=>{if(!a||!a.savedAddresses)return;const $t=a.savedAddresses.filter(Lt=>!(Lt.lat===Mt&&Lt.lng===Pt));try{await update(ref(database,`users/${a.id}`),{savedAddresses:$t}),_(Lt=>Lt?{...Lt,savedAddresses:$t}:null)}catch(Lt){console.error("Error deleting address:",Lt)}};return jsxRuntimeExports.jsx(AuthContext.Provider,{value:{firebaseUser:i,user:a,loading:et,signIn:ct,signUp:dt,signOut:Tt,updateUserLocation:gt,toggleFavorite:Et,refreshUser:c,deleteAddress:At},children:e})}function useAuth(){const e=reactExports.useContext(AuthContext);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e}const CartContext=reactExports.createContext(void 0),CART_STORAGE_KEY="amma-cheythi-cart";function CartProvider({children:e}){const[i,s]=reactExports.useState(()=>{const gt=localStorage.getItem(CART_STORAGE_KEY);return gt?JSON.parse(gt):{items:[],kitchenId:null,kitchenName:null,cookingInstructions:{tags:[],note:""}}});reactExports.useEffect(()=>{localStorage.setItem(CART_STORAGE_KEY,JSON.stringify(i))},[i]);const a=(gt,Tt)=>{s(Et=>({...Et,cookingInstructions:{tags:gt,note:Tt}}))},_=(gt,Tt,Et)=>{s(At=>At.kitchenId&&At.kitchenId!==Tt?(ue.error("You can only order from one kitchen at a time. Clear cart first."),At):At.items.find(Pt=>Pt.dish.id===gt.id)?{...At,items:At.items.map(Pt=>Pt.dish.id===gt.id?{...Pt,quantity:Pt.quantity+1}:Pt)}:(ue.success(`Added ${gt.name} to cart!`),{items:[...At.items,{dish:gt,quantity:1,kitchenId:Tt,kitchenName:Et}],kitchenId:Tt,kitchenName:Et}))},et=gt=>{s(Tt=>{const Et=Tt.items.filter(At=>At.dish.id!==gt);return{items:Et,kitchenId:Et.length>0?Tt.kitchenId:null,kitchenName:Et.length>0?Tt.kitchenName:null}})},nt=(gt,Tt)=>{if(Tt<=0){et(gt);return}s(Et=>({...Et,items:Et.items.map(At=>At.dish.id===gt?{...At,quantity:Tt}:At)}))},c=()=>{s({items:[],kitchenId:null,kitchenName:null,cookingInstructions:{tags:[],note:""}})},ct=()=>i.items.reduce((gt,Tt)=>gt+Tt.quantity,0),dt=()=>i.items.reduce((gt,Tt)=>gt+Tt.dish.price*Tt.quantity,0);return jsxRuntimeExports.jsx(CartContext.Provider,{value:{cart:i,addToCart:_,removeFromCart:et,updateQuantity:nt,clearCart:c,getItemCount:ct,getTotal:dt,updateCookingInstructions:a},children:e})}function useCart(){const e=reactExports.useContext(CartContext);if(e===void 0)throw new Error("useCart must be used within a CartProvider");return e}function isPointInPolygon(e,i){if(!i||!i.coordinates||i.coordinates.length===0)return!1;const s=i.coordinates[0],a=e.lng,_=e.lat;let et=!1;for(let nt=0,c=s.length-1;nt<s.length;c=nt++){const ct=s[nt][0],dt=s[nt][1],gt=s[c][0],Tt=s[c][1];dt>_!=Tt>_&&a<(gt-ct)*(_-dt)/(Tt-dt)+ct&&(et=!et)}return et}function isPointInZone(e,i,s){return isPointInPolygon({lat:e,lng:i},s)}function isLocationInAnyZone(e,i){for(const s of i){if(!s.zone||!s.zone.coordinates||!s.zone.coordinates[0]){console.log(`Skipping franchise ${s.id} - invalid zone data`);continue}const a=isPointInPolygon(e,s.zone);if(console.log(`Zone check for ${s.id}:`,{point:e,zoneCoords:s.zone.coordinates[0].slice(0,3),result:a}),a)return{isInZone:!0,franchiseId:s.id}}return{isInZone:!1,franchiseId:null}}function getPolygonCenter(e){if(!e||!e.coordinates||e.coordinates.length===0)return null;const i=e.coordinates[0];let s=0,a=0;for(const _ of i)a+=_[0],s+=_[1];return{lat:s/i.length,lng:a/i.length}}function geoJSONToZonePolygon(e){return!e||!e.geometry||e.geometry.type!=="Polygon"?null:{type:"Polygon",coordinates:e.geometry.coordinates}}function useUserLocation(){const[e,i]=reactExports.useState(null),[s,a]=reactExports.useState(!0),[_,et]=reactExports.useState(null),nt=async(ct,dt)=>{try{const Tt=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${dt},${ct}.json?access_token=${MAPBOX_ACCESS_TOKEN}`)).json();if(Tt.features&&Tt.features.length>0){const Et=Tt.features[0].context||[],At=Et.find(Pt=>Pt.id.startsWith("locality")||Pt.id.startsWith("neighborhood")),Mt=Et.find(Pt=>Pt.id.startsWith("place"));return At?At.text:Mt?Mt.text:Tt.features[0].text||"Unknown"}return"Unknown location"}catch(gt){return console.error("Geocoding error:",gt),"Unknown location"}},c=()=>{if(a(!0),et(null),!("geolocation"in navigator)){et("Geolocation not supported"),a(!1);return}navigator.geolocation.getCurrentPosition(async ct=>{const{latitude:dt,longitude:gt}=ct.coords,Tt=await nt(dt,gt);i({lat:dt,lng:gt,address:Tt}),a(!1)},ct=>{console.error("Location error:",ct),et("Location access denied"),a(!1)},{enableHighAccuracy:!0,timeout:1e4})};return reactExports.useEffect(()=>{c()},[]),{location:e,loading:s,error:_,refetch:c,setLocation:i}}const LocationContext=reactExports.createContext(void 0);function LocationProvider({children:e}){const{location:i,loading:s,error:a,refetch:_,setLocation:et}=useUserLocation(),[nt,c]=reactExports.useState([]),[ct,dt]=reactExports.useState(!0),[gt,Tt]=reactExports.useState(!0),[Et,At]=reactExports.useState(null),[Mt,Pt]=reactExports.useState(!1);reactExports.useEffect(()=>{const Bt=ref(database,"franchises"),Nt=onValue(Bt,Vt=>{const Xt=Vt.val();if(Xt){const nr=Object.entries(Xt).map(([ar,mr])=>({...mr,id:ar})).filter(ar=>ar.isActive);c(nr)}else c([]);dt(!1)});return()=>Nt()},[]),reactExports.useEffect(()=>{if(s||ct)return;if(!i){console.log("No location available, allowing access by default"),Tt(!0),At(null),Pt(!0);return}if(nt.length===0){console.log("No franchises exist, allowing access"),Tt(!0),At(null),Pt(!0);return}const Bt=nt.filter(Xt=>Xt.zone&&Xt.zone.coordinates&&Xt.zone.coordinates[0]&&Xt.zone.coordinates[0].length>0);if(console.log("Location check:",{userLat:i.lat,userLng:i.lng,totalFranchises:nt.length,validFranchises:Bt.length,franchiseZones:nt.map(Xt=>{var nr,ar,mr,Fr;return{id:Xt.id,name:Xt.name,hasZone:!!Xt.zone,zoneType:(nr=Xt.zone)==null?void 0:nr.type,coordsLength:(Fr=(mr=(ar=Xt.zone)==null?void 0:ar.coordinates)==null?void 0:mr[0])==null?void 0:Fr.length}})}),Bt.length===0){console.log("No valid franchise zones, allowing access"),Tt(!0),At(null),Pt(!0);return}const Nt=Bt.map(Xt=>({id:Xt.id,zone:Xt.zone})),Vt=isLocationInAnyZone({lat:i.lat,lng:i.lng},Nt);console.log("Zone check result:",Vt),Tt(Vt.isInZone),At(Vt.franchiseId),Pt(!0)},[i,nt,s,ct]);const $t=nt.find(Bt=>Bt.id===Et)||null,Lt=s||ct||!Mt;return jsxRuntimeExports.jsx(LocationContext.Provider,{value:{userLocation:i,locationLoading:s,locationError:a,isInServiceArea:gt,currentFranchiseId:Et,currentFranchise:$t,franchises:nt,checkingZone:Lt,refetchLocation:_,setUserLocation:et},children:e})}function useLocationContext(){const e=reactExports.useContext(LocationContext);if(e===void 0)throw new Error("useLocationContext must be used within a LocationProvider");return e}const DataContext=reactExports.createContext(void 0);function DataProvider({children:e}){const[i,s]=reactExports.useState([]),[a,_]=reactExports.useState(!0),[et,nt]=reactExports.useState(null);reactExports.useEffect(()=>{const ct=ref(database,"kitchens"),dt=onValue(ct,gt=>{try{const Tt=gt.val();if(Tt){const Et=Object.entries(Tt).map(([Mt,Pt])=>({...Pt,id:Mt})),At=Et.filter(Mt=>Mt.isApproved===!0);s(At.length>0?At:Et)}else s([]);_(!1)}catch{nt("Failed to fetch kitchens"),_(!1)}},gt=>{nt(gt.message),_(!1)});return()=>dt()},[]);const c=()=>{_(!0)};return jsxRuntimeExports.jsx(DataContext.Provider,{value:{kitchens:i,loading:a,error:et,refreshKitchens:c},children:e})}function useDataContext(){const e=reactExports.useContext(DataContext);if(e===void 0)throw new Error("useDataContext must be used within a DataProvider");return e}const LayoutGroupContext=reactExports.createContext({});function useConstant(e){const i=reactExports.useRef(null);return i.current===null&&(i.current=e()),i.current}const isBrowser=typeof window<"u",useIsomorphicLayoutEffect$1=isBrowser?reactExports.useLayoutEffect:reactExports.useEffect,PresenceContext=reactExports.createContext(null);function addUniqueItem(e,i){e.indexOf(i)===-1&&e.push(i)}function removeItem(e,i){const s=e.indexOf(i);s>-1&&e.splice(s,1)}const clamp$1=(e,i,s)=>s>i?i:s<e?e:s;function formatErrorMessage(e,i){return i?`${e}. For more information and steps for solving, visit https://motion.dev/troubleshooting/${i}`:e}let warning=()=>{},invariant=()=>{};typeof process<"u";const MotionGlobalConfig={},isNumericalString=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function isObject(e){return typeof e=="object"&&e!==null}const isZeroValueString=e=>/^0[^.\s]+$/u.test(e);function memo(e){let i;return()=>(i===void 0&&(i=e()),i)}const noop=e=>e,combineFunctions=(e,i)=>s=>i(e(s)),pipe=(...e)=>e.reduce(combineFunctions),progress=(e,i,s)=>{const a=i-e;return a===0?1:(s-e)/a};class SubscriptionManager{constructor(){this.subscriptions=[]}add(i){return addUniqueItem(this.subscriptions,i),()=>removeItem(this.subscriptions,i)}notify(i,s,a){const _=this.subscriptions.length;if(_)if(_===1)this.subscriptions[0](i,s,a);else for(let et=0;et<_;et++){const nt=this.subscriptions[et];nt&&nt(i,s,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const secondsToMilliseconds=e=>e*1e3,millisecondsToSeconds=e=>e/1e3;function velocityPerSecond(e,i){return i?e*(1e3/i):0}const calcBezier=(e,i,s)=>(((1-3*s+3*i)*e+(3*s-6*i))*e+3*i)*e,subdivisionPrecision=1e-7,subdivisionMaxIterations=12;function binarySubdivide(e,i,s,a,_){let et,nt,c=0;do nt=i+(s-i)/2,et=calcBezier(nt,a,_)-e,et>0?s=nt:i=nt;while(Math.abs(et)>subdivisionPrecision&&++c<subdivisionMaxIterations);return nt}function cubicBezier(e,i,s,a){if(e===i&&s===a)return noop;const _=et=>binarySubdivide(et,0,1,e,s);return et=>et===0||et===1?et:calcBezier(_(et),i,a)}const mirrorEasing=e=>i=>i<=.5?e(2*i)/2:(2-e(2*(1-i)))/2,reverseEasing=e=>i=>1-e(1-i),backOut=cubicBezier(.33,1.53,.69,.99),backIn=reverseEasing(backOut),backInOut=mirrorEasing(backIn),anticipate=e=>(e*=2)<1?.5*backIn(e):.5*(2-Math.pow(2,-10*(e-1))),circIn=e=>1-Math.sin(Math.acos(e)),circOut=reverseEasing(circIn),circInOut=mirrorEasing(circIn),easeIn=cubicBezier(.42,0,1,1),easeOut=cubicBezier(0,0,.58,1),easeInOut=cubicBezier(.42,0,.58,1),isEasingArray=e=>Array.isArray(e)&&typeof e[0]!="number",isBezierDefinition=e=>Array.isArray(e)&&typeof e[0]=="number",easingLookup={linear:noop,easeIn,easeInOut,easeOut,circIn,circInOut,circOut,backIn,backInOut,backOut,anticipate},isValidEasing=e=>typeof e=="string",easingDefinitionToFunction=e=>{if(isBezierDefinition(e)){invariant(e.length===4,"Cubic bezier arrays must contain four numerical values.","cubic-bezier-length");const[i,s,a,_]=e;return cubicBezier(i,s,a,_)}else if(isValidEasing(e))return invariant(easingLookup[e]!==void 0,`Invalid easing type '${e}'`,"invalid-easing-type"),easingLookup[e];return e},stepsOrder=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],statsBuffer={value:null,addProjectionMetrics:null};function createRenderStep(e,i){let s=new Set,a=new Set,_=!1,et=!1;const nt=new WeakSet;let c={delta:0,timestamp:0,isProcessing:!1},ct=0;function dt(Tt){nt.has(Tt)&&(gt.schedule(Tt),e()),ct++,Tt(c)}const gt={schedule:(Tt,Et=!1,At=!1)=>{const Pt=At&&_?s:a;return Et&&nt.add(Tt),Pt.has(Tt)||Pt.add(Tt),Tt},cancel:Tt=>{a.delete(Tt),nt.delete(Tt)},process:Tt=>{if(c=Tt,_){et=!0;return}_=!0,[s,a]=[a,s],s.forEach(dt),i&&statsBuffer.value&&statsBuffer.value.frameloop[i].push(ct),ct=0,s.clear(),_=!1,et&&(et=!1,gt.process(Tt))}};return gt}const maxElapsed=40;function createRenderBatcher(e,i){let s=!1,a=!0;const _={delta:0,timestamp:0,isProcessing:!1},et=()=>s=!0,nt=stepsOrder.reduce((Nt,Vt)=>(Nt[Vt]=createRenderStep(et,i?Vt:void 0),Nt),{}),{setup:c,read:ct,resolveKeyframes:dt,preUpdate:gt,update:Tt,preRender:Et,render:At,postRender:Mt}=nt,Pt=()=>{const Nt=MotionGlobalConfig.useManualTiming?_.timestamp:performance.now();s=!1,MotionGlobalConfig.useManualTiming||(_.delta=a?1e3/60:Math.max(Math.min(Nt-_.timestamp,maxElapsed),1)),_.timestamp=Nt,_.isProcessing=!0,c.process(_),ct.process(_),dt.process(_),gt.process(_),Tt.process(_),Et.process(_),At.process(_),Mt.process(_),_.isProcessing=!1,s&&i&&(a=!1,e(Pt))},$t=()=>{s=!0,a=!0,_.isProcessing||e(Pt)};return{schedule:stepsOrder.reduce((Nt,Vt)=>{const Xt=nt[Vt];return Nt[Vt]=(nr,ar=!1,mr=!1)=>(s||$t(),Xt.schedule(nr,ar,mr)),Nt},{}),cancel:Nt=>{for(let Vt=0;Vt<stepsOrder.length;Vt++)nt[stepsOrder[Vt]].cancel(Nt)},state:_,steps:nt}}const{schedule:frame,cancel:cancelFrame,state:frameData,steps:frameSteps}=createRenderBatcher(typeof requestAnimationFrame<"u"?requestAnimationFrame:noop,!0);let now;function clearTime(){now=void 0}const time={now:()=>(now===void 0&&time.set(frameData.isProcessing||MotionGlobalConfig.useManualTiming?frameData.timestamp:performance.now()),now),set:e=>{now=e,queueMicrotask(clearTime)}},checkStringStartsWith=e=>i=>typeof i=="string"&&i.startsWith(e),isCSSVariableName=checkStringStartsWith("--"),startsAsVariableToken=checkStringStartsWith("var(--"),isCSSVariableToken=e=>startsAsVariableToken(e)?singleCssVariableRegex.test(e.split("/*")[0].trim()):!1,singleCssVariableRegex=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,number={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},alpha={...number,transform:e=>clamp$1(0,1,e)},scale={...number,default:1},sanitize=e=>Math.round(e*1e5)/1e5,floatRegex=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function isNullish(e){return e==null}const singleColorRegex=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,isColorString=(e,i)=>s=>!!(typeof s=="string"&&singleColorRegex.test(s)&&s.startsWith(e)||i&&!isNullish(s)&&Object.prototype.hasOwnProperty.call(s,i)),splitColor=(e,i,s)=>a=>{if(typeof a!="string")return a;const[_,et,nt,c]=a.match(floatRegex);return{[e]:parseFloat(_),[i]:parseFloat(et),[s]:parseFloat(nt),alpha:c!==void 0?parseFloat(c):1}},clampRgbUnit=e=>clamp$1(0,255,e),rgbUnit={...number,transform:e=>Math.round(clampRgbUnit(e))},rgba={test:isColorString("rgb","red"),parse:splitColor("red","green","blue"),transform:({red:e,green:i,blue:s,alpha:a=1})=>"rgba("+rgbUnit.transform(e)+", "+rgbUnit.transform(i)+", "+rgbUnit.transform(s)+", "+sanitize(alpha.transform(a))+")"};function parseHex(e){let i="",s="",a="",_="";return e.length>5?(i=e.substring(1,3),s=e.substring(3,5),a=e.substring(5,7),_=e.substring(7,9)):(i=e.substring(1,2),s=e.substring(2,3),a=e.substring(3,4),_=e.substring(4,5),i+=i,s+=s,a+=a,_+=_),{red:parseInt(i,16),green:parseInt(s,16),blue:parseInt(a,16),alpha:_?parseInt(_,16)/255:1}}const hex={test:isColorString("#"),parse:parseHex,transform:rgba.transform},createUnitType=e=>({test:i=>typeof i=="string"&&i.endsWith(e)&&i.split(" ").length===1,parse:parseFloat,transform:i=>`${i}${e}`}),degrees=createUnitType("deg"),percent=createUnitType("%"),px=createUnitType("px"),vh=createUnitType("vh"),vw=createUnitType("vw"),progressPercentage={...percent,parse:e=>percent.parse(e)/100,transform:e=>percent.transform(e*100)},hsla={test:isColorString("hsl","hue"),parse:splitColor("hue","saturation","lightness"),transform:({hue:e,saturation:i,lightness:s,alpha:a=1})=>"hsla("+Math.round(e)+", "+percent.transform(sanitize(i))+", "+percent.transform(sanitize(s))+", "+sanitize(alpha.transform(a))+")"},color={test:e=>rgba.test(e)||hex.test(e)||hsla.test(e),parse:e=>rgba.test(e)?rgba.parse(e):hsla.test(e)?hsla.parse(e):hex.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?rgba.transform(e):hsla.transform(e),getAnimatableNone:e=>{const i=color.parse(e);return i.alpha=0,color.transform(i)}},colorRegex=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function test(e){var i,s;return isNaN(e)&&typeof e=="string"&&(((i=e.match(floatRegex))==null?void 0:i.length)||0)+(((s=e.match(colorRegex))==null?void 0:s.length)||0)>0}const NUMBER_TOKEN="number",COLOR_TOKEN="color",VAR_TOKEN="var",VAR_FUNCTION_TOKEN="var(",SPLIT_TOKEN="${}",complexRegex=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function analyseComplexValue(e){const i=e.toString(),s=[],a={color:[],number:[],var:[]},_=[];let et=0;const c=i.replace(complexRegex,ct=>(color.test(ct)?(a.color.push(et),_.push(COLOR_TOKEN),s.push(color.parse(ct))):ct.startsWith(VAR_FUNCTION_TOKEN)?(a.var.push(et),_.push(VAR_TOKEN),s.push(ct)):(a.number.push(et),_.push(NUMBER_TOKEN),s.push(parseFloat(ct))),++et,SPLIT_TOKEN)).split(SPLIT_TOKEN);return{values:s,split:c,indexes:a,types:_}}function parseComplexValue(e){return analyseComplexValue(e).values}function createTransformer(e){const{split:i,types:s}=analyseComplexValue(e),a=i.length;return _=>{let et="";for(let nt=0;nt<a;nt++)if(et+=i[nt],_[nt]!==void 0){const c=s[nt];c===NUMBER_TOKEN?et+=sanitize(_[nt]):c===COLOR_TOKEN?et+=color.transform(_[nt]):et+=_[nt]}return et}}const convertNumbersToZero=e=>typeof e=="number"?0:color.test(e)?color.getAnimatableNone(e):e;function getAnimatableNone$1(e){const i=parseComplexValue(e);return createTransformer(e)(i.map(convertNumbersToZero))}const complex={test,parse:parseComplexValue,createTransformer,getAnimatableNone:getAnimatableNone$1};function hueToRgb(e,i,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+(i-e)*6*s:s<1/2?i:s<2/3?e+(i-e)*(2/3-s)*6:e}function hslaToRgba({hue:e,saturation:i,lightness:s,alpha:a}){e/=360,i/=100,s/=100;let _=0,et=0,nt=0;if(!i)_=et=nt=s;else{const c=s<.5?s*(1+i):s+i-s*i,ct=2*s-c;_=hueToRgb(ct,c,e+1/3),et=hueToRgb(ct,c,e),nt=hueToRgb(ct,c,e-1/3)}return{red:Math.round(_*255),green:Math.round(et*255),blue:Math.round(nt*255),alpha:a}}function mixImmediate(e,i){return s=>s>0?i:e}const mixNumber$1=(e,i,s)=>e+(i-e)*s,mixLinearColor=(e,i,s)=>{const a=e*e,_=s*(i*i-a)+a;return _<0?0:Math.sqrt(_)},colorTypes=[hex,rgba,hsla],getColorType=e=>colorTypes.find(i=>i.test(e));function asRGBA(e){const i=getColorType(e);if(warning(!!i,`'${e}' is not an animatable color. Use the equivalent color code instead.`,"color-not-animatable"),!i)return!1;let s=i.parse(e);return i===hsla&&(s=hslaToRgba(s)),s}const mixColor=(e,i)=>{const s=asRGBA(e),a=asRGBA(i);if(!s||!a)return mixImmediate(e,i);const _={...s};return et=>(_.red=mixLinearColor(s.red,a.red,et),_.green=mixLinearColor(s.green,a.green,et),_.blue=mixLinearColor(s.blue,a.blue,et),_.alpha=mixNumber$1(s.alpha,a.alpha,et),rgba.transform(_))},invisibleValues=new Set(["none","hidden"]);function mixVisibility(e,i){return invisibleValues.has(e)?s=>s<=0?e:i:s=>s>=1?i:e}function mixNumber(e,i){return s=>mixNumber$1(e,i,s)}function getMixer(e){return typeof e=="number"?mixNumber:typeof e=="string"?isCSSVariableToken(e)?mixImmediate:color.test(e)?mixColor:mixComplex:Array.isArray(e)?mixArray:typeof e=="object"?color.test(e)?mixColor:mixObject:mixImmediate}function mixArray(e,i){const s=[...e],a=s.length,_=e.map((et,nt)=>getMixer(et)(et,i[nt]));return et=>{for(let nt=0;nt<a;nt++)s[nt]=_[nt](et);return s}}function mixObject(e,i){const s={...e,...i},a={};for(const _ in s)e[_]!==void 0&&i[_]!==void 0&&(a[_]=getMixer(e[_])(e[_],i[_]));return _=>{for(const et in a)s[et]=a[et](_);return s}}function matchOrder(e,i){const s=[],a={color:0,var:0,number:0};for(let _=0;_<i.values.length;_++){const et=i.types[_],nt=e.indexes[et][a[et]],c=e.values[nt]??0;s[_]=c,a[et]++}return s}const mixComplex=(e,i)=>{const s=complex.createTransformer(i),a=analyseComplexValue(e),_=analyseComplexValue(i);return a.indexes.var.length===_.indexes.var.length&&a.indexes.color.length===_.indexes.color.length&&a.indexes.number.length>=_.indexes.number.length?invisibleValues.has(e)&&!_.values.length||invisibleValues.has(i)&&!a.values.length?mixVisibility(e,i):pipe(mixArray(matchOrder(a,_),_.values),s):(warning(!0,`Complex values '${e}' and '${i}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`,"complex-values-different"),mixImmediate(e,i))};function mix(e,i,s){return typeof e=="number"&&typeof i=="number"&&typeof s=="number"?mixNumber$1(e,i,s):getMixer(e)(e,i)}const frameloopDriver=e=>{const i=({timestamp:s})=>e(s);return{start:(s=!0)=>frame.update(i,s),stop:()=>cancelFrame(i),now:()=>frameData.isProcessing?frameData.timestamp:time.now()}},generateLinearEasing=(e,i,s=10)=>{let a="";const _=Math.max(Math.round(i/s),2);for(let et=0;et<_;et++)a+=Math.round(e(et/(_-1))*1e4)/1e4+", ";return`linear(${a.substring(0,a.length-2)})`},maxGeneratorDuration=2e4;function calcGeneratorDuration(e){let i=0;const s=50;let a=e.next(i);for(;!a.done&&i<maxGeneratorDuration;)i+=s,a=e.next(i);return i>=maxGeneratorDuration?1/0:i}function createGeneratorEasing(e,i=100,s){const a=s({...e,keyframes:[0,i]}),_=Math.min(calcGeneratorDuration(a),maxGeneratorDuration);return{type:"keyframes",ease:et=>a.next(_*et).value/i,duration:millisecondsToSeconds(_)}}const velocitySampleDuration=5;function calcGeneratorVelocity(e,i,s){const a=Math.max(i-velocitySampleDuration,0);return velocityPerSecond(s-e(a),i-a)}const springDefaults={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},safeMin=.001;function findSpring({duration:e=springDefaults.duration,bounce:i=springDefaults.bounce,velocity:s=springDefaults.velocity,mass:a=springDefaults.mass}){let _,et;warning(e<=secondsToMilliseconds(springDefaults.maxDuration),"Spring duration must be 10 seconds or less","spring-duration-limit");let nt=1-i;nt=clamp$1(springDefaults.minDamping,springDefaults.maxDamping,nt),e=clamp$1(springDefaults.minDuration,springDefaults.maxDuration,millisecondsToSeconds(e)),nt<1?(_=dt=>{const gt=dt*nt,Tt=gt*e,Et=gt-s,At=calcAngularFreq(dt,nt),Mt=Math.exp(-Tt);return safeMin-Et/At*Mt},et=dt=>{const Tt=dt*nt*e,Et=Tt*s+s,At=Math.pow(nt,2)*Math.pow(dt,2)*e,Mt=Math.exp(-Tt),Pt=calcAngularFreq(Math.pow(dt,2),nt);return(-_(dt)+safeMin>0?-1:1)*((Et-At)*Mt)/Pt}):(_=dt=>{const gt=Math.exp(-dt*e),Tt=(dt-s)*e+1;return-safeMin+gt*Tt},et=dt=>{const gt=Math.exp(-dt*e),Tt=(s-dt)*(e*e);return gt*Tt});const c=5/e,ct=approximateRoot(_,et,c);if(e=secondsToMilliseconds(e),isNaN(ct))return{stiffness:springDefaults.stiffness,damping:springDefaults.damping,duration:e};{const dt=Math.pow(ct,2)*a;return{stiffness:dt,damping:nt*2*Math.sqrt(a*dt),duration:e}}}const rootIterations=12;function approximateRoot(e,i,s){let a=s;for(let _=1;_<rootIterations;_++)a=a-e(a)/i(a);return a}function calcAngularFreq(e,i){return e*Math.sqrt(1-i*i)}const durationKeys=["duration","bounce"],physicsKeys=["stiffness","damping","mass"];function isSpringType(e,i){return i.some(s=>e[s]!==void 0)}function getSpringOptions(e){let i={velocity:springDefaults.velocity,stiffness:springDefaults.stiffness,damping:springDefaults.damping,mass:springDefaults.mass,isResolvedFromDuration:!1,...e};if(!isSpringType(e,physicsKeys)&&isSpringType(e,durationKeys))if(e.visualDuration){const s=e.visualDuration,a=2*Math.PI/(s*1.2),_=a*a,et=2*clamp$1(.05,1,1-(e.bounce||0))*Math.sqrt(_);i={...i,mass:springDefaults.mass,stiffness:_,damping:et}}else{const s=findSpring(e);i={...i,...s,mass:springDefaults.mass},i.isResolvedFromDuration=!0}return i}function spring(e=springDefaults.visualDuration,i=springDefaults.bounce){const s=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:i}:e;let{restSpeed:a,restDelta:_}=s;const et=s.keyframes[0],nt=s.keyframes[s.keyframes.length-1],c={done:!1,value:et},{stiffness:ct,damping:dt,mass:gt,duration:Tt,velocity:Et,isResolvedFromDuration:At}=getSpringOptions({...s,velocity:-millisecondsToSeconds(s.velocity||0)}),Mt=Et||0,Pt=dt/(2*Math.sqrt(ct*gt)),$t=nt-et,Lt=millisecondsToSeconds(Math.sqrt(ct/gt)),Bt=Math.abs($t)<5;a||(a=Bt?springDefaults.restSpeed.granular:springDefaults.restSpeed.default),_||(_=Bt?springDefaults.restDelta.granular:springDefaults.restDelta.default);let Nt;if(Pt<1){const Xt=calcAngularFreq(Lt,Pt);Nt=nr=>{const ar=Math.exp(-Pt*Lt*nr);return nt-ar*((Mt+Pt*Lt*$t)/Xt*Math.sin(Xt*nr)+$t*Math.cos(Xt*nr))}}else if(Pt===1)Nt=Xt=>nt-Math.exp(-Lt*Xt)*($t+(Mt+Lt*$t)*Xt);else{const Xt=Lt*Math.sqrt(Pt*Pt-1);Nt=nr=>{const ar=Math.exp(-Pt*Lt*nr),mr=Math.min(Xt*nr,300);return nt-ar*((Mt+Pt*Lt*$t)*Math.sinh(mr)+Xt*$t*Math.cosh(mr))/Xt}}const Vt={calculatedDuration:At&&Tt||null,next:Xt=>{const nr=Nt(Xt);if(At)c.done=Xt>=Tt;else{let ar=Xt===0?Mt:0;Pt<1&&(ar=Xt===0?secondsToMilliseconds(Mt):calcGeneratorVelocity(Nt,Xt,nr));const mr=Math.abs(ar)<=a,Fr=Math.abs(nt-nr)<=_;c.done=mr&&Fr}return c.value=c.done?nt:nr,c},toString:()=>{const Xt=Math.min(calcGeneratorDuration(Vt),maxGeneratorDuration),nr=generateLinearEasing(ar=>Vt.next(Xt*ar).value,Xt,30);return Xt+"ms "+nr},toTransition:()=>{}};return Vt}spring.applyToOptions=e=>{const i=createGeneratorEasing(e,100,spring);return e.ease=i.ease,e.duration=secondsToMilliseconds(i.duration),e.type="keyframes",e};function inertia({keyframes:e,velocity:i=0,power:s=.8,timeConstant:a=325,bounceDamping:_=10,bounceStiffness:et=500,modifyTarget:nt,min:c,max:ct,restDelta:dt=.5,restSpeed:gt}){const Tt=e[0],Et={done:!1,value:Tt},At=mr=>c!==void 0&&mr<c||ct!==void 0&&mr>ct,Mt=mr=>c===void 0?ct:ct===void 0||Math.abs(c-mr)<Math.abs(ct-mr)?c:ct;let Pt=s*i;const $t=Tt+Pt,Lt=nt===void 0?$t:nt($t);Lt!==$t&&(Pt=Lt-Tt);const Bt=mr=>-Pt*Math.exp(-mr/a),Nt=mr=>Lt+Bt(mr),Vt=mr=>{const Fr=Bt(mr),sn=Nt(mr);Et.done=Math.abs(Fr)<=dt,Et.value=Et.done?Lt:sn};let Xt,nr;const ar=mr=>{At(Et.value)&&(Xt=mr,nr=spring({keyframes:[Et.value,Mt(Et.value)],velocity:calcGeneratorVelocity(Nt,mr,Et.value),damping:_,stiffness:et,restDelta:dt,restSpeed:gt}))};return ar(0),{calculatedDuration:null,next:mr=>{let Fr=!1;return!nr&&Xt===void 0&&(Fr=!0,Vt(mr),ar(mr)),Xt!==void 0&&mr>=Xt?nr.next(mr-Xt):(!Fr&&Vt(mr),Et)}}}function createMixers(e,i,s){const a=[],_=s||MotionGlobalConfig.mix||mix,et=e.length-1;for(let nt=0;nt<et;nt++){let c=_(e[nt],e[nt+1]);if(i){const ct=Array.isArray(i)?i[nt]||noop:i;c=pipe(ct,c)}a.push(c)}return a}function interpolate(e,i,{clamp:s=!0,ease:a,mixer:_}={}){const et=e.length;if(invariant(et===i.length,"Both input and output ranges must be the same length","range-length"),et===1)return()=>i[0];if(et===2&&i[0]===i[1])return()=>i[1];const nt=e[0]===e[1];e[0]>e[et-1]&&(e=[...e].reverse(),i=[...i].reverse());const c=createMixers(i,a,_),ct=c.length,dt=gt=>{if(nt&&gt<e[0])return i[0];let Tt=0;if(ct>1)for(;Tt<e.length-2&&!(gt<e[Tt+1]);Tt++);const Et=progress(e[Tt],e[Tt+1],gt);return c[Tt](Et)};return s?gt=>dt(clamp$1(e[0],e[et-1],gt)):dt}function fillOffset(e,i){const s=e[e.length-1];for(let a=1;a<=i;a++){const _=progress(0,i,a);e.push(mixNumber$1(s,1,_))}}function defaultOffset(e){const i=[0];return fillOffset(i,e.length-1),i}function convertOffsetToTimes(e,i){return e.map(s=>s*i)}function defaultEasing(e,i){return e.map(()=>i||easeInOut).splice(0,e.length-1)}function keyframes({duration:e=300,keyframes:i,times:s,ease:a="easeInOut"}){const _=isEasingArray(a)?a.map(easingDefinitionToFunction):easingDefinitionToFunction(a),et={done:!1,value:i[0]},nt=convertOffsetToTimes(s&&s.length===i.length?s:defaultOffset(i),e),c=interpolate(nt,i,{ease:Array.isArray(_)?_:defaultEasing(i,_)});return{calculatedDuration:e,next:ct=>(et.value=c(ct),et.done=ct>=e,et)}}const isNotNull$1=e=>e!==null;function getFinalKeyframe$1(e,{repeat:i,repeatType:s="loop"},a,_=1){const et=e.filter(isNotNull$1),c=_<0||i&&s!=="loop"&&i%2===1?0:et.length-1;return!c||a===void 0?et[c]:a}const transitionTypeMap={decay:inertia,inertia,tween:keyframes,keyframes,spring};function replaceTransitionType(e){typeof e.type=="string"&&(e.type=transitionTypeMap[e.type])}class WithPromise{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(i=>{this.resolve=i})}notifyFinished(){this.resolve()}then(i,s){return this.finished.then(i,s)}}const percentToProgress=e=>e/100;class JSAnimation extends WithPromise{constructor(i){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var a,_;const{motionValue:s}=this.options;s&&s.updatedAt!==time.now()&&this.tick(time.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(_=(a=this.options).onStop)==null||_.call(a))},this.options=i,this.initAnimation(),this.play(),i.autoplay===!1&&this.pause()}initAnimation(){const{options:i}=this;replaceTransitionType(i);const{type:s=keyframes,repeat:a=0,repeatDelay:_=0,repeatType:et,velocity:nt=0}=i;let{keyframes:c}=i;const ct=s||keyframes;ct!==keyframes&&typeof c[0]!="number"&&(this.mixKeyframes=pipe(percentToProgress,mix(c[0],c[1])),c=[0,100]);const dt=ct({...i,keyframes:c});et==="mirror"&&(this.mirroredGenerator=ct({...i,keyframes:[...c].reverse(),velocity:-nt})),dt.calculatedDuration===null&&(dt.calculatedDuration=calcGeneratorDuration(dt));const{calculatedDuration:gt}=dt;this.calculatedDuration=gt,this.resolvedDuration=gt+_,this.totalDuration=this.resolvedDuration*(a+1)-_,this.generator=dt}updateTime(i){const s=Math.round(i-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=s}tick(i,s=!1){const{generator:a,totalDuration:_,mixKeyframes:et,mirroredGenerator:nt,resolvedDuration:c,calculatedDuration:ct}=this;if(this.startTime===null)return a.next(0);const{delay:dt=0,keyframes:gt,repeat:Tt,repeatType:Et,repeatDelay:At,type:Mt,onUpdate:Pt,finalKeyframe:$t}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,i):this.speed<0&&(this.startTime=Math.min(i-_/this.speed,this.startTime)),s?this.currentTime=i:this.updateTime(i);const Lt=this.currentTime-dt*(this.playbackSpeed>=0?1:-1),Bt=this.playbackSpeed>=0?Lt<0:Lt>_;this.currentTime=Math.max(Lt,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=_);let Nt=this.currentTime,Vt=a;if(Tt){const mr=Math.min(this.currentTime,_)/c;let Fr=Math.floor(mr),sn=mr%1;!sn&&mr>=1&&(sn=1),sn===1&&Fr--,Fr=Math.min(Fr,Tt+1),!!(Fr%2)&&(Et==="reverse"?(sn=1-sn,At&&(sn-=At/c)):Et==="mirror"&&(Vt=nt)),Nt=clamp$1(0,1,sn)*c}const Xt=Bt?{done:!1,value:gt[0]}:Vt.next(Nt);et&&(Xt.value=et(Xt.value));let{done:nr}=Xt;!Bt&&ct!==null&&(nr=this.playbackSpeed>=0?this.currentTime>=_:this.currentTime<=0);const ar=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&nr);return ar&&Mt!==inertia&&(Xt.value=getFinalKeyframe$1(gt,this.options,$t,this.speed)),Pt&&Pt(Xt.value),ar&&this.finish(),Xt}then(i,s){return this.finished.then(i,s)}get duration(){return millisecondsToSeconds(this.calculatedDuration)}get iterationDuration(){const{delay:i=0}=this.options||{};return this.duration+millisecondsToSeconds(i)}get time(){return millisecondsToSeconds(this.currentTime)}set time(i){var s;i=secondsToMilliseconds(i),this.currentTime=i,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=i:this.driver&&(this.startTime=this.driver.now()-i/this.playbackSpeed),(s=this.driver)==null||s.start(!1)}get speed(){return this.playbackSpeed}set speed(i){this.updateTime(time.now());const s=this.playbackSpeed!==i;this.playbackSpeed=i,s&&(this.time=millisecondsToSeconds(this.currentTime))}play(){var _,et;if(this.isStopped)return;const{driver:i=frameloopDriver,startTime:s}=this.options;this.driver||(this.driver=i(nt=>this.tick(nt))),(et=(_=this.options).onPlay)==null||et.call(_);const a=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=a):this.holdTime!==null?this.startTime=a-this.holdTime:this.startTime||(this.startTime=s??a),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(time.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var i,s;this.notifyFinished(),this.teardown(),this.state="finished",(s=(i=this.options).onComplete)==null||s.call(i)}cancel(){var i,s;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(s=(i=this.options).onCancel)==null||s.call(i)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(i){return this.startTime=0,this.tick(i,!0)}attachTimeline(i){var s;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(s=this.driver)==null||s.stop(),i.observe(this)}}function fillWildcards(e){for(let i=1;i<e.length;i++)e[i]??(e[i]=e[i-1])}const radToDeg=e=>e*180/Math.PI,rotate=e=>{const i=radToDeg(Math.atan2(e[1],e[0]));return rebaseAngle(i)},matrix2dParsers={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate,rotateZ:rotate,skewX:e=>radToDeg(Math.atan(e[1])),skewY:e=>radToDeg(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},rebaseAngle=e=>(e=e%360,e<0&&(e+=360),e),rotateZ=rotate,scaleX=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),scaleY=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),matrix3dParsers={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX,scaleY,scale:e=>(scaleX(e)+scaleY(e))/2,rotateX:e=>rebaseAngle(radToDeg(Math.atan2(e[6],e[5]))),rotateY:e=>rebaseAngle(radToDeg(Math.atan2(-e[2],e[0]))),rotateZ,rotate:rotateZ,skewX:e=>radToDeg(Math.atan(e[4])),skewY:e=>radToDeg(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function defaultTransformValue(e){return e.includes("scale")?1:0}function parseValueFromTransform(e,i){if(!e||e==="none")return defaultTransformValue(i);const s=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let a,_;if(s)a=matrix3dParsers,_=s;else{const c=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);a=matrix2dParsers,_=c}if(!_)return defaultTransformValue(i);const et=a[i],nt=_[1].split(",").map(convertTransformToNumber);return typeof et=="function"?et(nt):nt[et]}const readTransformValue=(e,i)=>{const{transform:s="none"}=getComputedStyle(e);return parseValueFromTransform(s,i)};function convertTransformToNumber(e){return parseFloat(e.trim())}const transformPropOrder=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],transformProps=new Set(transformPropOrder),isNumOrPxType=e=>e===number||e===px,transformKeys=new Set(["x","y","z"]),nonTranslationalTransformKeys=transformPropOrder.filter(e=>!transformKeys.has(e));function removeNonTranslationalTransform(e){const i=[];return nonTranslationalTransformKeys.forEach(s=>{const a=e.getValue(s);a!==void 0&&(i.push([s,a.get()]),a.set(s.startsWith("scale")?1:0))}),i}const positionalValues={width:({x:e},{paddingLeft:i="0",paddingRight:s="0"})=>e.max-e.min-parseFloat(i)-parseFloat(s),height:({y:e},{paddingTop:i="0",paddingBottom:s="0"})=>e.max-e.min-parseFloat(i)-parseFloat(s),top:(e,{top:i})=>parseFloat(i),left:(e,{left:i})=>parseFloat(i),bottom:({y:e},{top:i})=>parseFloat(i)+(e.max-e.min),right:({x:e},{left:i})=>parseFloat(i)+(e.max-e.min),x:(e,{transform:i})=>parseValueFromTransform(i,"x"),y:(e,{transform:i})=>parseValueFromTransform(i,"y")};positionalValues.translateX=positionalValues.x;positionalValues.translateY=positionalValues.y;const toResolve=new Set;let isScheduled=!1,anyNeedsMeasurement=!1,isForced=!1;function measureAllKeyframes(){if(anyNeedsMeasurement){const e=Array.from(toResolve).filter(a=>a.needsMeasurement),i=new Set(e.map(a=>a.element)),s=new Map;i.forEach(a=>{const _=removeNonTranslationalTransform(a);_.length&&(s.set(a,_),a.render())}),e.forEach(a=>a.measureInitialState()),i.forEach(a=>{a.render();const _=s.get(a);_&&_.forEach(([et,nt])=>{var c;(c=a.getValue(et))==null||c.set(nt)})}),e.forEach(a=>a.measureEndState()),e.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}anyNeedsMeasurement=!1,isScheduled=!1,toResolve.forEach(e=>e.complete(isForced)),toResolve.clear()}function readAllKeyframes(){toResolve.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(anyNeedsMeasurement=!0)})}function flushKeyframeResolvers(){isForced=!0,readAllKeyframes(),measureAllKeyframes(),isForced=!1}class KeyframeResolver{constructor(i,s,a,_,et,nt=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...i],this.onComplete=s,this.name=a,this.motionValue=_,this.element=et,this.isAsync=nt}scheduleResolve(){this.state="scheduled",this.isAsync?(toResolve.add(this),isScheduled||(isScheduled=!0,frame.read(readAllKeyframes),frame.resolveKeyframes(measureAllKeyframes))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:i,name:s,element:a,motionValue:_}=this;if(i[0]===null){const et=_==null?void 0:_.get(),nt=i[i.length-1];if(et!==void 0)i[0]=et;else if(a&&s){const c=a.readValue(s,nt);c!=null&&(i[0]=c)}i[0]===void 0&&(i[0]=nt),_&&et===void 0&&_.set(i[0])}fillWildcards(i)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(i=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,i),toResolve.delete(this)}cancel(){this.state==="scheduled"&&(toResolve.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const isCSSVar=e=>e.startsWith("--");function setStyle(e,i,s){isCSSVar(i)?e.style.setProperty(i,s):e.style[i]=s}const supportsScrollTimeline=memo(()=>window.ScrollTimeline!==void 0),supportsFlags={};function memoSupports(e,i){const s=memo(e);return()=>supportsFlags[i]??s()}const supportsLinearEasing=memoSupports(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),cubicBezierAsString=([e,i,s,a])=>`cubic-bezier(${e}, ${i}, ${s}, ${a})`,supportedWaapiEasing={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:cubicBezierAsString([0,.65,.55,1]),circOut:cubicBezierAsString([.55,0,1,.45]),backIn:cubicBezierAsString([.31,.01,.66,-.59]),backOut:cubicBezierAsString([.33,1.53,.69,.99])};function mapEasingToNativeEasing(e,i){if(e)return typeof e=="function"?supportsLinearEasing()?generateLinearEasing(e,i):"ease-out":isBezierDefinition(e)?cubicBezierAsString(e):Array.isArray(e)?e.map(s=>mapEasingToNativeEasing(s,i)||supportedWaapiEasing.easeOut):supportedWaapiEasing[e]}function startWaapiAnimation(e,i,s,{delay:a=0,duration:_=300,repeat:et=0,repeatType:nt="loop",ease:c="easeOut",times:ct}={},dt=void 0){const gt={[i]:s};ct&&(gt.offset=ct);const Tt=mapEasingToNativeEasing(c,_);Array.isArray(Tt)&&(gt.easing=Tt);const Et={delay:a,duration:_,easing:Array.isArray(Tt)?"linear":Tt,fill:"both",iterations:et+1,direction:nt==="reverse"?"alternate":"normal"};return dt&&(Et.pseudoElement=dt),e.animate(gt,Et)}function isGenerator(e){return typeof e=="function"&&"applyToOptions"in e}function applyGeneratorOptions({type:e,...i}){return isGenerator(e)&&supportsLinearEasing()?e.applyToOptions(i):(i.duration??(i.duration=300),i.ease??(i.ease="easeOut"),i)}class NativeAnimation extends WithPromise{constructor(i){if(super(),this.finishedTime=null,this.isStopped=!1,!i)return;const{element:s,name:a,keyframes:_,pseudoElement:et,allowFlatten:nt=!1,finalKeyframe:c,onComplete:ct}=i;this.isPseudoElement=!!et,this.allowFlatten=nt,this.options=i,invariant(typeof i.type!="string",`Mini animate() doesn't support "type" as a string.`,"mini-spring");const dt=applyGeneratorOptions(i);this.animation=startWaapiAnimation(s,a,_,dt,et),dt.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!et){const gt=getFinalKeyframe$1(_,this.options,c,this.speed);this.updateMotionValue?this.updateMotionValue(gt):setStyle(s,a,gt),this.animation.cancel()}ct==null||ct(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var i,s;(s=(i=this.animation).finish)==null||s.call(i)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:i}=this;i==="idle"||i==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var i,s;this.isPseudoElement||(s=(i=this.animation).commitStyles)==null||s.call(i)}get duration(){var s,a;const i=((a=(s=this.animation.effect)==null?void 0:s.getComputedTiming)==null?void 0:a.call(s).duration)||0;return millisecondsToSeconds(Number(i))}get iterationDuration(){const{delay:i=0}=this.options||{};return this.duration+millisecondsToSeconds(i)}get time(){return millisecondsToSeconds(Number(this.animation.currentTime)||0)}set time(i){this.finishedTime=null,this.animation.currentTime=secondsToMilliseconds(i)}get speed(){return this.animation.playbackRate}set speed(i){i<0&&(this.finishedTime=null),this.animation.playbackRate=i}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(i){this.animation.startTime=i}attachTimeline({timeline:i,observe:s}){var a;return this.allowFlatten&&((a=this.animation.effect)==null||a.updateTiming({easing:"linear"})),this.animation.onfinish=null,i&&supportsScrollTimeline()?(this.animation.timeline=i,noop):s(this)}}const unsupportedEasingFunctions={anticipate,backInOut,circInOut};function isUnsupportedEase(e){return e in unsupportedEasingFunctions}function replaceStringEasing(e){typeof e.ease=="string"&&isUnsupportedEase(e.ease)&&(e.ease=unsupportedEasingFunctions[e.ease])}const sampleDelta=10;class NativeAnimationExtended extends NativeAnimation{constructor(i){replaceStringEasing(i),replaceTransitionType(i),super(i),i.startTime&&(this.startTime=i.startTime),this.options=i}updateMotionValue(i){const{motionValue:s,onUpdate:a,onComplete:_,element:et,...nt}=this.options;if(!s)return;if(i!==void 0){s.set(i);return}const c=new JSAnimation({...nt,autoplay:!1}),ct=secondsToMilliseconds(this.finishedTime??this.time);s.setWithVelocity(c.sample(ct-sampleDelta).value,c.sample(ct).value,sampleDelta),c.stop()}}const isAnimatable=(e,i)=>i==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(complex.test(e)||e==="0")&&!e.startsWith("url("));function hasKeyframesChanged(e){const i=e[0];if(e.length===1)return!0;for(let s=0;s<e.length;s++)if(e[s]!==i)return!0}function canAnimate(e,i,s,a){const _=e[0];if(_===null)return!1;if(i==="display"||i==="visibility")return!0;const et=e[e.length-1],nt=isAnimatable(_,i),c=isAnimatable(et,i);return warning(nt===c,`You are trying to animate ${i} from "${_}" to "${et}". "${nt?et:_}" is not an animatable value.`,"value-not-animatable"),!nt||!c?!1:hasKeyframesChanged(e)||(s==="spring"||isGenerator(s))&&a}function makeAnimationInstant(e){e.duration=0,e.type="keyframes"}const acceleratedValues=new Set(["opacity","clipPath","filter","transform"]),supportsWaapi=memo(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function supportsBrowserAnimation(e){var gt;const{motionValue:i,name:s,repeatDelay:a,repeatType:_,damping:et,type:nt}=e;if(!(((gt=i==null?void 0:i.owner)==null?void 0:gt.current)instanceof HTMLElement))return!1;const{onUpdate:ct,transformTemplate:dt}=i.owner.getProps();return supportsWaapi()&&s&&acceleratedValues.has(s)&&(s!=="transform"||!dt)&&!ct&&!a&&_!=="mirror"&&et!==0&&nt!=="inertia"}const MAX_RESOLVE_DELAY=40;class AsyncMotionValueAnimation extends WithPromise{constructor({autoplay:i=!0,delay:s=0,type:a="keyframes",repeat:_=0,repeatDelay:et=0,repeatType:nt="loop",keyframes:c,name:ct,motionValue:dt,element:gt,...Tt}){var Mt;super(),this.stop=()=>{var Pt,$t;this._animation&&(this._animation.stop(),(Pt=this.stopTimeline)==null||Pt.call(this)),($t=this.keyframeResolver)==null||$t.cancel()},this.createdAt=time.now();const Et={autoplay:i,delay:s,type:a,repeat:_,repeatDelay:et,repeatType:nt,name:ct,motionValue:dt,element:gt,...Tt},At=(gt==null?void 0:gt.KeyframeResolver)||KeyframeResolver;this.keyframeResolver=new At(c,(Pt,$t,Lt)=>this.onKeyframesResolved(Pt,$t,Et,!Lt),ct,dt,gt),(Mt=this.keyframeResolver)==null||Mt.scheduleResolve()}onKeyframesResolved(i,s,a,_){this.keyframeResolver=void 0;const{name:et,type:nt,velocity:c,delay:ct,isHandoff:dt,onUpdate:gt}=a;this.resolvedAt=time.now(),canAnimate(i,et,nt,c)||((MotionGlobalConfig.instantAnimations||!ct)&&(gt==null||gt(getFinalKeyframe$1(i,a,s))),i[0]=i[i.length-1],makeAnimationInstant(a),a.repeat=0);const Et={startTime:_?this.resolvedAt?this.resolvedAt-this.createdAt>MAX_RESOLVE_DELAY?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:s,...a,keyframes:i},At=!dt&&supportsBrowserAnimation(Et)?new NativeAnimationExtended({...Et,element:Et.motionValue.owner.current}):new JSAnimation(Et);At.finished.then(()=>this.notifyFinished()).catch(noop),this.pendingTimeline&&(this.stopTimeline=At.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=At}get finished(){return this._animation?this.animation.finished:this._finished}then(i,s){return this.finished.finally(i).then(()=>{})}get animation(){var i;return this._animation||((i=this.keyframeResolver)==null||i.resume(),flushKeyframeResolvers()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(i){this.animation.time=i}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(i){this.animation.speed=i}get startTime(){return this.animation.startTime}attachTimeline(i){return this._animation?this.stopTimeline=this.animation.attachTimeline(i):this.pendingTimeline=i,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var i;this._animation&&this.animation.cancel(),(i=this.keyframeResolver)==null||i.cancel()}}const splitCSSVariableRegex=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function parseCSSVariable(e){const i=splitCSSVariableRegex.exec(e);if(!i)return[,];const[,s,a,_]=i;return[`--${s??a}`,_]}const maxDepth=4;function getVariableValue(e,i,s=1){invariant(s<=maxDepth,`Max CSS variable fallback depth detected in property "${e}". This may indicate a circular fallback dependency.`,"max-css-var-depth");const[a,_]=parseCSSVariable(e);if(!a)return;const et=window.getComputedStyle(i).getPropertyValue(a);if(et){const nt=et.trim();return isNumericalString(nt)?parseFloat(nt):nt}return isCSSVariableToken(_)?getVariableValue(_,i,s+1):_}function getValueTransition(e,i){return(e==null?void 0:e[i])??(e==null?void 0:e.default)??e}const positionalKeys=new Set(["width","height","top","left","right","bottom",...transformPropOrder]),auto={test:e=>e==="auto",parse:e=>e},testValueType=e=>i=>i.test(e),dimensionValueTypes=[number,px,percent,degrees,vw,vh,auto],findDimensionValueType=e=>dimensionValueTypes.find(testValueType(e));function isNone(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||isZeroValueString(e):!0}const maxDefaults=new Set(["brightness","contrast","saturate","opacity"]);function applyDefaultFilter(e){const[i,s]=e.slice(0,-1).split("(");if(i==="drop-shadow")return e;const[a]=s.match(floatRegex)||[];if(!a)return e;const _=s.replace(a,"");let et=maxDefaults.has(i)?1:0;return a!==s&&(et*=100),i+"("+et+_+")"}const functionRegex=/\b([a-z-]*)\(.*?\)/gu,filter={...complex,getAnimatableNone:e=>{const i=e.match(functionRegex);return i?i.map(applyDefaultFilter).join(" "):e}},int={...number,transform:Math.round},transformValueTypes={rotate:degrees,rotateX:degrees,rotateY:degrees,rotateZ:degrees,scale,scaleX:scale,scaleY:scale,scaleZ:scale,skew:degrees,skewX:degrees,skewY:degrees,distance:px,translateX:px,translateY:px,translateZ:px,x:px,y:px,z:px,perspective:px,transformPerspective:px,opacity:alpha,originX:progressPercentage,originY:progressPercentage,originZ:px},numberValueTypes={borderWidth:px,borderTopWidth:px,borderRightWidth:px,borderBottomWidth:px,borderLeftWidth:px,borderRadius:px,radius:px,borderTopLeftRadius:px,borderTopRightRadius:px,borderBottomRightRadius:px,borderBottomLeftRadius:px,width:px,maxWidth:px,height:px,maxHeight:px,top:px,right:px,bottom:px,left:px,inset:px,insetBlock:px,insetBlockStart:px,insetBlockEnd:px,insetInline:px,insetInlineStart:px,insetInlineEnd:px,padding:px,paddingTop:px,paddingRight:px,paddingBottom:px,paddingLeft:px,paddingBlock:px,paddingBlockStart:px,paddingBlockEnd:px,paddingInline:px,paddingInlineStart:px,paddingInlineEnd:px,margin:px,marginTop:px,marginRight:px,marginBottom:px,marginLeft:px,marginBlock:px,marginBlockStart:px,marginBlockEnd:px,marginInline:px,marginInlineStart:px,marginInlineEnd:px,backgroundPositionX:px,backgroundPositionY:px,...transformValueTypes,zIndex:int,fillOpacity:alpha,strokeOpacity:alpha,numOctaves:int},defaultValueTypes={...numberValueTypes,color,backgroundColor:color,outlineColor:color,fill:color,stroke:color,borderColor:color,borderTopColor:color,borderRightColor:color,borderBottomColor:color,borderLeftColor:color,filter,WebkitFilter:filter},getDefaultValueType=e=>defaultValueTypes[e];function getAnimatableNone(e,i){let s=getDefaultValueType(e);return s!==filter&&(s=complex),s.getAnimatableNone?s.getAnimatableNone(i):void 0}const invalidTemplates=new Set(["auto","none","0"]);function makeNoneKeyframesAnimatable(e,i,s){let a=0,_;for(;a<e.length&&!_;){const et=e[a];typeof et=="string"&&!invalidTemplates.has(et)&&analyseComplexValue(et).values.length&&(_=e[a]),a++}if(_&&s)for(const et of i)e[et]=getAnimatableNone(s,_)}class DOMKeyframesResolver extends KeyframeResolver{constructor(i,s,a,_,et){super(i,s,a,_,et,!0)}readKeyframes(){const{unresolvedKeyframes:i,element:s,name:a}=this;if(!s||!s.current)return;super.readKeyframes();for(let ct=0;ct<i.length;ct++){let dt=i[ct];if(typeof dt=="string"&&(dt=dt.trim(),isCSSVariableToken(dt))){const gt=getVariableValue(dt,s.current);gt!==void 0&&(i[ct]=gt),ct===i.length-1&&(this.finalKeyframe=dt)}}if(this.resolveNoneKeyframes(),!positionalKeys.has(a)||i.length!==2)return;const[_,et]=i,nt=findDimensionValueType(_),c=findDimensionValueType(et);if(nt!==c)if(isNumOrPxType(nt)&&isNumOrPxType(c))for(let ct=0;ct<i.length;ct++){const dt=i[ct];typeof dt=="string"&&(i[ct]=parseFloat(dt))}else positionalValues[a]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:i,name:s}=this,a=[];for(let _=0;_<i.length;_++)(i[_]===null||isNone(i[_]))&&a.push(_);a.length&&makeNoneKeyframesAnimatable(i,a,s)}measureInitialState(){const{element:i,unresolvedKeyframes:s,name:a}=this;if(!i||!i.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=positionalValues[a](i.measureViewportBox(),window.getComputedStyle(i.current)),s[0]=this.measuredOrigin;const _=s[s.length-1];_!==void 0&&i.getValue(a,_).jump(_,!1)}measureEndState(){var c;const{element:i,name:s,unresolvedKeyframes:a}=this;if(!i||!i.current)return;const _=i.getValue(s);_&&_.jump(this.measuredOrigin,!1);const et=a.length-1,nt=a[et];a[et]=positionalValues[s](i.measureViewportBox(),window.getComputedStyle(i.current)),nt!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=nt),(c=this.removedTransforms)!=null&&c.length&&this.removedTransforms.forEach(([ct,dt])=>{i.getValue(ct).set(dt)}),this.resolveNoneKeyframes()}}function resolveElements(e,i,s){if(e instanceof EventTarget)return[e];if(typeof e=="string"){const _=document.querySelectorAll(e);return _?Array.from(_):[]}return Array.from(e)}const getValueAsType=(e,i)=>i&&typeof e=="number"?i.transform(e):e;function isHTMLElement(e){return isObject(e)&&"offsetHeight"in e}const MAX_VELOCITY_DELTA=30,isFloat=e=>!isNaN(parseFloat(e));class MotionValue{constructor(i,s={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=a=>{var et;const _=time.now();if(this.updatedAt!==_&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&((et=this.events.change)==null||et.notify(this.current),this.dependents))for(const nt of this.dependents)nt.dirty()},this.hasAnimated=!1,this.setCurrent(i),this.owner=s.owner}setCurrent(i){this.current=i,this.updatedAt=time.now(),this.canTrackVelocity===null&&i!==void 0&&(this.canTrackVelocity=isFloat(this.current))}setPrevFrameValue(i=this.current){this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt}onChange(i){return this.on("change",i)}on(i,s){this.events[i]||(this.events[i]=new SubscriptionManager);const a=this.events[i].add(s);return i==="change"?()=>{a(),frame.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const i in this.events)this.events[i].clear()}attach(i,s){this.passiveEffect=i,this.stopPassiveEffect=s}set(i){this.passiveEffect?this.passiveEffect(i,this.updateAndNotify):this.updateAndNotify(i)}setWithVelocity(i,s,a){this.set(s),this.prev=void 0,this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt-a}jump(i,s=!0){this.updateAndNotify(i),this.prev=i,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var i;(i=this.events.change)==null||i.notify(this.current)}addDependent(i){this.dependents||(this.dependents=new Set),this.dependents.add(i)}removeDependent(i){this.dependents&&this.dependents.delete(i)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const i=time.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||i-this.updatedAt>MAX_VELOCITY_DELTA)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,MAX_VELOCITY_DELTA);return velocityPerSecond(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(i){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=i(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var i,s;(i=this.dependents)==null||i.clear(),(s=this.events.destroy)==null||s.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function motionValue(e,i){return new MotionValue(e,i)}const{schedule:microtask,cancel:cancelMicrotask}=createRenderBatcher(queueMicrotask,!1),isDragging={x:!1,y:!1};function isDragActive(){return isDragging.x||isDragging.y}function setDragLock(e){return e==="x"||e==="y"?isDragging[e]?null:(isDragging[e]=!0,()=>{isDragging[e]=!1}):isDragging.x||isDragging.y?null:(isDragging.x=isDragging.y=!0,()=>{isDragging.x=isDragging.y=!1})}function setupGesture(e,i){const s=resolveElements(e),a=new AbortController,_={passive:!0,...i,signal:a.signal};return[s,_,()=>a.abort()]}function isValidHover(e){return!(e.pointerType==="touch"||isDragActive())}function hover(e,i,s={}){const[a,_,et]=setupGesture(e,s),nt=c=>{if(!isValidHover(c))return;const{target:ct}=c,dt=i(ct,c);if(typeof dt!="function"||!ct)return;const gt=Tt=>{isValidHover(Tt)&&(dt(Tt),ct.removeEventListener("pointerleave",gt))};ct.addEventListener("pointerleave",gt,_)};return a.forEach(c=>{c.addEventListener("pointerenter",nt,_)}),et}const isNodeOrChild=(e,i)=>i?e===i?!0:isNodeOrChild(e,i.parentElement):!1,isPrimaryPointer=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,focusableElements=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function isElementKeyboardAccessible(e){return focusableElements.has(e.tagName)||e.tabIndex!==-1}const isPressing=new WeakSet;function filterEvents(e){return i=>{i.key==="Enter"&&e(i)}}function firePointerEvent(e,i){e.dispatchEvent(new PointerEvent("pointer"+i,{isPrimary:!0,bubbles:!0}))}const enableKeyboardPress=(e,i)=>{const s=e.currentTarget;if(!s)return;const a=filterEvents(()=>{if(isPressing.has(s))return;firePointerEvent(s,"down");const _=filterEvents(()=>{firePointerEvent(s,"up")}),et=()=>firePointerEvent(s,"cancel");s.addEventListener("keyup",_,i),s.addEventListener("blur",et,i)});s.addEventListener("keydown",a,i),s.addEventListener("blur",()=>s.removeEventListener("keydown",a),i)};function isValidPressEvent(e){return isPrimaryPointer(e)&&!isDragActive()}function press(e,i,s={}){const[a,_,et]=setupGesture(e,s),nt=c=>{const ct=c.currentTarget;if(!isValidPressEvent(c))return;isPressing.add(ct);const dt=i(ct,c),gt=(At,Mt)=>{window.removeEventListener("pointerup",Tt),window.removeEventListener("pointercancel",Et),isPressing.has(ct)&&isPressing.delete(ct),isValidPressEvent(At)&&typeof dt=="function"&&dt(At,{success:Mt})},Tt=At=>{gt(At,ct===window||ct===document||s.useGlobalTarget||isNodeOrChild(ct,At.target))},Et=At=>{gt(At,!1)};window.addEventListener("pointerup",Tt,_),window.addEventListener("pointercancel",Et,_)};return a.forEach(c=>{(s.useGlobalTarget?window:c).addEventListener("pointerdown",nt,_),isHTMLElement(c)&&(c.addEventListener("focus",dt=>enableKeyboardPress(dt,_)),!isElementKeyboardAccessible(c)&&!c.hasAttribute("tabindex")&&(c.tabIndex=0))}),et}function isSVGElement(e){return isObject(e)&&"ownerSVGElement"in e}function isSVGSVGElement(e){return isSVGElement(e)&&e.tagName==="svg"}const isMotionValue=e=>!!(e&&e.getVelocity),valueTypes=[...dimensionValueTypes,color,complex],findValueType=e=>valueTypes.find(testValueType(e)),MotionConfigContext=reactExports.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function setRef$1(e,i){if(typeof e=="function")return e(i);e!=null&&(e.current=i)}function composeRefs(...e){return i=>{let s=!1;const a=e.map(_=>{const et=setRef$1(_,i);return!s&&typeof et=="function"&&(s=!0),et});if(s)return()=>{for(let _=0;_<a.length;_++){const et=a[_];typeof et=="function"?et():setRef$1(e[_],null)}}}}function useComposedRefs(...e){return reactExports.useCallback(composeRefs(...e),e)}class PopChildMeasure extends reactExports.Component{getSnapshotBeforeUpdate(i){const s=this.props.childRef.current;if(s&&i.isPresent&&!this.props.isPresent){const a=s.offsetParent,_=isHTMLElement(a)&&a.offsetWidth||0,et=this.props.sizeRef.current;et.height=s.offsetHeight||0,et.width=s.offsetWidth||0,et.top=s.offsetTop,et.left=s.offsetLeft,et.right=_-et.width-et.left}return null}componentDidUpdate(){}render(){return this.props.children}}function PopChild({children:e,isPresent:i,anchorX:s,root:a}){var gt;const _=reactExports.useId(),et=reactExports.useRef(null),nt=reactExports.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=reactExports.useContext(MotionConfigContext),ct=((gt=e.props)==null?void 0:gt.ref)??(e==null?void 0:e.ref),dt=useComposedRefs(et,ct);return reactExports.useInsertionEffect(()=>{const{width:Tt,height:Et,top:At,left:Mt,right:Pt}=nt.current;if(i||!et.current||!Tt||!Et)return;const $t=s==="left"?`left: ${Mt}`:`right: ${Pt}`;et.current.dataset.motionPopId=_;const Lt=document.createElement("style");c&&(Lt.nonce=c);const Bt=a??document.head;return Bt.appendChild(Lt),Lt.sheet&&Lt.sheet.insertRule(`
          [data-motion-pop-id="${_}"] {
            position: absolute !important;
            width: ${Tt}px !important;
            height: ${Et}px !important;
            ${$t}px !important;
            top: ${At}px !important;
          }
        `),()=>{Bt.contains(Lt)&&Bt.removeChild(Lt)}},[i]),jsxRuntimeExports.jsx(PopChildMeasure,{isPresent:i,childRef:et,sizeRef:nt,children:reactExports.cloneElement(e,{ref:dt})})}const PresenceChild=({children:e,initial:i,isPresent:s,onExitComplete:a,custom:_,presenceAffectsLayout:et,mode:nt,anchorX:c,root:ct})=>{const dt=useConstant(newChildrenMap),gt=reactExports.useId();let Tt=!0,Et=reactExports.useMemo(()=>(Tt=!1,{id:gt,initial:i,isPresent:s,custom:_,onExitComplete:At=>{dt.set(At,!0);for(const Mt of dt.values())if(!Mt)return;a&&a()},register:At=>(dt.set(At,!1),()=>dt.delete(At))}),[s,dt,a]);return et&&Tt&&(Et={...Et}),reactExports.useMemo(()=>{dt.forEach((At,Mt)=>dt.set(Mt,!1))},[s]),reactExports.useEffect(()=>{!s&&!dt.size&&a&&a()},[s]),nt==="popLayout"&&(e=jsxRuntimeExports.jsx(PopChild,{isPresent:s,anchorX:c,root:ct,children:e})),jsxRuntimeExports.jsx(PresenceContext.Provider,{value:Et,children:e})};function newChildrenMap(){return new Map}function usePresence(e=!0){const i=reactExports.useContext(PresenceContext);if(i===null)return[!0,null];const{isPresent:s,onExitComplete:a,register:_}=i,et=reactExports.useId();reactExports.useEffect(()=>{if(e)return _(et)},[e]);const nt=reactExports.useCallback(()=>e&&a&&a(et),[et,a,e]);return!s&&a?[!1,nt]:[!0]}const getChildKey=e=>e.key||"";function onlyElements(e){const i=[];return reactExports.Children.forEach(e,s=>{reactExports.isValidElement(s)&&i.push(s)}),i}const AnimatePresence=({children:e,custom:i,initial:s=!0,onExitComplete:a,presenceAffectsLayout:_=!0,mode:et="sync",propagate:nt=!1,anchorX:c="left",root:ct})=>{const[dt,gt]=usePresence(nt),Tt=reactExports.useMemo(()=>onlyElements(e),[e]),Et=nt&&!dt?[]:Tt.map(getChildKey),At=reactExports.useRef(!0),Mt=reactExports.useRef(Tt),Pt=useConstant(()=>new Map),$t=reactExports.useRef(new Set),[Lt,Bt]=reactExports.useState(Tt),[Nt,Vt]=reactExports.useState(Tt);useIsomorphicLayoutEffect$1(()=>{At.current=!1,Mt.current=Tt;for(let ar=0;ar<Nt.length;ar++){const mr=getChildKey(Nt[ar]);Et.includes(mr)?(Pt.delete(mr),$t.current.delete(mr)):Pt.get(mr)!==!0&&Pt.set(mr,!1)}},[Nt,Et.length,Et.join("-")]);const Xt=[];if(Tt!==Lt){let ar=[...Tt];for(let mr=0;mr<Nt.length;mr++){const Fr=Nt[mr],sn=getChildKey(Fr);Et.includes(sn)||(ar.splice(mr,0,Fr),Xt.push(Fr))}return et==="wait"&&Xt.length&&(ar=Xt),Vt(onlyElements(ar)),Bt(Tt),null}const{forceRender:nr}=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:Nt.map(ar=>{const mr=getChildKey(ar),Fr=nt&&!dt?!1:Tt===Nt||Et.includes(mr),sn=()=>{if($t.current.has(mr))return;if($t.current.add(mr),Pt.has(mr))Pt.set(mr,!0);else return;let fn=!0;Pt.forEach(Lr=>{Lr||(fn=!1)}),fn&&(nr==null||nr(),Vt(Mt.current),nt&&(gt==null||gt()),a&&a())};return jsxRuntimeExports.jsx(PresenceChild,{isPresent:Fr,initial:!At.current||s?void 0:!1,custom:i,presenceAffectsLayout:_,mode:et,root:ct,onExitComplete:Fr?void 0:sn,anchorX:c,children:ar},mr)})})},LazyContext=reactExports.createContext({strict:!1}),featureProps={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},featureDefinitions={};for(const e in featureProps)featureDefinitions[e]={isEnabled:i=>featureProps[e].some(s=>!!i[s])};function loadFeatures(e){for(const i in e)featureDefinitions[i]={...featureDefinitions[i],...e[i]}}const validMotionProps=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function isValidMotionProp(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||validMotionProps.has(e)}let shouldForward=e=>!isValidMotionProp(e);function loadExternalIsValidProp(e){typeof e=="function"&&(shouldForward=i=>i.startsWith("on")?!isValidMotionProp(i):e(i))}try{loadExternalIsValidProp(require("@emotion/is-prop-valid").default)}catch{}function filterProps(e,i,s){const a={};for(const _ in e)_==="values"&&typeof e.values=="object"||(shouldForward(_)||s===!0&&isValidMotionProp(_)||!i&&!isValidMotionProp(_)||e.draggable&&_.startsWith("onDrag"))&&(a[_]=e[_]);return a}const MotionContext=reactExports.createContext({});function isAnimationControls(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function isVariantLabel(e){return typeof e=="string"||Array.isArray(e)}const variantPriorityOrder=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],variantProps=["initial",...variantPriorityOrder];function isControllingVariants(e){return isAnimationControls(e.animate)||variantProps.some(i=>isVariantLabel(e[i]))}function isVariantNode(e){return!!(isControllingVariants(e)||e.variants)}function getCurrentTreeVariants(e,i){if(isControllingVariants(e)){const{initial:s,animate:a}=e;return{initial:s===!1||isVariantLabel(s)?s:void 0,animate:isVariantLabel(a)?a:void 0}}return e.inherit!==!1?i:{}}function useCreateMotionContext(e){const{initial:i,animate:s}=getCurrentTreeVariants(e,reactExports.useContext(MotionContext));return reactExports.useMemo(()=>({initial:i,animate:s}),[variantLabelsAsDependency(i),variantLabelsAsDependency(s)])}function variantLabelsAsDependency(e){return Array.isArray(e)?e.join(" "):e}function pixelsToPercent(e,i){return i.max===i.min?0:e/(i.max-i.min)*100}const correctBorderRadius={correct:(e,i)=>{if(!i.target)return e;if(typeof e=="string")if(px.test(e))e=parseFloat(e);else return e;const s=pixelsToPercent(e,i.target.x),a=pixelsToPercent(e,i.target.y);return`${s}% ${a}%`}},correctBoxShadow={correct:(e,{treeScale:i,projectionDelta:s})=>{const a=e,_=complex.parse(e);if(_.length>5)return a;const et=complex.createTransformer(e),nt=typeof _[0]!="number"?1:0,c=s.x.scale*i.x,ct=s.y.scale*i.y;_[0+nt]/=c,_[1+nt]/=ct;const dt=mixNumber$1(c,ct,.5);return typeof _[2+nt]=="number"&&(_[2+nt]/=dt),typeof _[3+nt]=="number"&&(_[3+nt]/=dt),et(_)}},scaleCorrectors={borderRadius:{...correctBorderRadius,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:correctBorderRadius,borderTopRightRadius:correctBorderRadius,borderBottomLeftRadius:correctBorderRadius,borderBottomRightRadius:correctBorderRadius,boxShadow:correctBoxShadow};function isForcedMotionValue(e,{layout:i,layoutId:s}){return transformProps.has(e)||e.startsWith("origin")||(i||s!==void 0)&&(!!scaleCorrectors[e]||e==="opacity")}const translateAlias={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},numTransforms=transformPropOrder.length;function buildTransform(e,i,s){let a="",_=!0;for(let et=0;et<numTransforms;et++){const nt=transformPropOrder[et],c=e[nt];if(c===void 0)continue;let ct=!0;if(typeof c=="number"?ct=c===(nt.startsWith("scale")?1:0):ct=parseFloat(c)===0,!ct||s){const dt=getValueAsType(c,numberValueTypes[nt]);if(!ct){_=!1;const gt=translateAlias[nt]||nt;a+=`${gt}(${dt}) `}s&&(i[nt]=dt)}}return a=a.trim(),s?a=s(i,_?"":a):_&&(a="none"),a}function buildHTMLStyles(e,i,s){const{style:a,vars:_,transformOrigin:et}=e;let nt=!1,c=!1;for(const ct in i){const dt=i[ct];if(transformProps.has(ct)){nt=!0;continue}else if(isCSSVariableName(ct)){_[ct]=dt;continue}else{const gt=getValueAsType(dt,numberValueTypes[ct]);ct.startsWith("origin")?(c=!0,et[ct]=gt):a[ct]=gt}}if(i.transform||(nt||s?a.transform=buildTransform(i,e.transform,s):a.transform&&(a.transform="none")),c){const{originX:ct="50%",originY:dt="50%",originZ:gt=0}=et;a.transformOrigin=`${ct} ${dt} ${gt}`}}const createHtmlRenderState=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function copyRawValuesOnly(e,i,s){for(const a in i)!isMotionValue(i[a])&&!isForcedMotionValue(a,s)&&(e[a]=i[a])}function useInitialMotionValues({transformTemplate:e},i){return reactExports.useMemo(()=>{const s=createHtmlRenderState();return buildHTMLStyles(s,i,e),Object.assign({},s.vars,s.style)},[i])}function useStyle(e,i){const s=e.style||{},a={};return copyRawValuesOnly(a,s,e),Object.assign(a,useInitialMotionValues(e,i)),a}function useHTMLProps(e,i){const s={},a=useStyle(e,i);return e.drag&&e.dragListener!==!1&&(s.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(s.tabIndex=0),s.style=a,s}const dashKeys={offset:"stroke-dashoffset",array:"stroke-dasharray"},camelKeys={offset:"strokeDashoffset",array:"strokeDasharray"};function buildSVGPath(e,i,s=1,a=0,_=!0){e.pathLength=1;const et=_?dashKeys:camelKeys;e[et.offset]=px.transform(-a);const nt=px.transform(i),c=px.transform(s);e[et.array]=`${nt} ${c}`}const cssMotionPathProperties=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function buildSVGAttrs(e,{attrX:i,attrY:s,attrScale:a,pathLength:_,pathSpacing:et=1,pathOffset:nt=0,...c},ct,dt,gt){if(buildHTMLStyles(e,c,dt),ct){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:Tt,style:Et}=e;Tt.transform&&(Et.transform=Tt.transform,delete Tt.transform),(Et.transform||Tt.transformOrigin)&&(Et.transformOrigin=Tt.transformOrigin??"50% 50%",delete Tt.transformOrigin),Et.transform&&(Et.transformBox=(gt==null?void 0:gt.transformBox)??"fill-box",delete Tt.transformBox);for(const At of cssMotionPathProperties)Tt[At]!==void 0&&(Et[At]=Tt[At],delete Tt[At]);i!==void 0&&(Tt.x=i),s!==void 0&&(Tt.y=s),a!==void 0&&(Tt.scale=a),_!==void 0&&buildSVGPath(Tt,_,et,nt,!1)}const createSvgRenderState=()=>({...createHtmlRenderState(),attrs:{}}),isSVGTag=e=>typeof e=="string"&&e.toLowerCase()==="svg";function useSVGProps(e,i,s,a){const _=reactExports.useMemo(()=>{const et=createSvgRenderState();return buildSVGAttrs(et,i,isSVGTag(a),e.transformTemplate,e.style),{...et.attrs,style:{...et.style}}},[i]);if(e.style){const et={};copyRawValuesOnly(et,e.style,e),_.style={...et,..._.style}}return _}const lowercaseSVGElements=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function isSVGComponent(e){return typeof e!="string"||e.includes("-")?!1:!!(lowercaseSVGElements.indexOf(e)>-1||/[A-Z]/u.test(e))}function useRender(e,i,s,{latestValues:a},_,et=!1,nt){const ct=(nt??isSVGComponent(e)?useSVGProps:useHTMLProps)(i,a,_,e),dt=filterProps(i,typeof e=="string",et),gt=e!==reactExports.Fragment?{...dt,...ct,ref:s}:{},{children:Tt}=i,Et=reactExports.useMemo(()=>isMotionValue(Tt)?Tt.get():Tt,[Tt]);return reactExports.createElement(e,{...gt,children:Et})}function getValueState(e){const i=[{},{}];return e==null||e.values.forEach((s,a)=>{i[0][a]=s.get(),i[1][a]=s.getVelocity()}),i}function resolveVariantFromProps(e,i,s,a){if(typeof i=="function"){const[_,et]=getValueState(a);i=i(s!==void 0?s:e.custom,_,et)}if(typeof i=="string"&&(i=e.variants&&e.variants[i]),typeof i=="function"){const[_,et]=getValueState(a);i=i(s!==void 0?s:e.custom,_,et)}return i}function resolveMotionValue(e){return isMotionValue(e)?e.get():e}function makeState({scrapeMotionValuesFromProps:e,createRenderState:i},s,a,_){return{latestValues:makeLatestValues(s,a,_,e),renderState:i()}}function makeLatestValues(e,i,s,a){const _={},et=a(e,{});for(const Et in et)_[Et]=resolveMotionValue(et[Et]);let{initial:nt,animate:c}=e;const ct=isControllingVariants(e),dt=isVariantNode(e);i&&dt&&!ct&&e.inherit!==!1&&(nt===void 0&&(nt=i.initial),c===void 0&&(c=i.animate));let gt=s?s.initial===!1:!1;gt=gt||nt===!1;const Tt=gt?c:nt;if(Tt&&typeof Tt!="boolean"&&!isAnimationControls(Tt)){const Et=Array.isArray(Tt)?Tt:[Tt];for(let At=0;At<Et.length;At++){const Mt=resolveVariantFromProps(e,Et[At]);if(Mt){const{transitionEnd:Pt,transition:$t,...Lt}=Mt;for(const Bt in Lt){let Nt=Lt[Bt];if(Array.isArray(Nt)){const Vt=gt?Nt.length-1:0;Nt=Nt[Vt]}Nt!==null&&(_[Bt]=Nt)}for(const Bt in Pt)_[Bt]=Pt[Bt]}}}return _}const makeUseVisualState=e=>(i,s)=>{const a=reactExports.useContext(MotionContext),_=reactExports.useContext(PresenceContext),et=()=>makeState(e,i,a,_);return s?et():useConstant(et)};function scrapeMotionValuesFromProps$1(e,i,s){var et;const{style:a}=e,_={};for(const nt in a)(isMotionValue(a[nt])||i.style&&isMotionValue(i.style[nt])||isForcedMotionValue(nt,e)||((et=s==null?void 0:s.getValue(nt))==null?void 0:et.liveStyle)!==void 0)&&(_[nt]=a[nt]);return _}const useHTMLVisualState=makeUseVisualState({scrapeMotionValuesFromProps:scrapeMotionValuesFromProps$1,createRenderState:createHtmlRenderState});function scrapeMotionValuesFromProps(e,i,s){const a=scrapeMotionValuesFromProps$1(e,i,s);for(const _ in e)if(isMotionValue(e[_])||isMotionValue(i[_])){const et=transformPropOrder.indexOf(_)!==-1?"attr"+_.charAt(0).toUpperCase()+_.substring(1):_;a[et]=e[_]}return a}const useSVGVisualState=makeUseVisualState({scrapeMotionValuesFromProps,createRenderState:createSvgRenderState}),motionComponentSymbol=Symbol.for("motionComponentSymbol");function isRefObject(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function setRef(e,i){if(typeof e=="function")return e(i);isRefObject(e)&&(e.current=i)}function useMotionRef(e,i,s){const a=reactExports.useRef(null);return reactExports.useCallback(_=>{if(_&&e.onMount&&e.onMount(_),i&&(_?i.mount(_):i.unmount()),s)if(_){const et=setRef(s,_);typeof et=="function"&&(a.current=et)}else a.current?(a.current(),a.current=null):setRef(s,_)},[i,e,s])}const camelToDash=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),optimizedAppearDataId="framerAppearId",optimizedAppearDataAttribute="data-"+camelToDash(optimizedAppearDataId),SwitchLayoutGroupContext=reactExports.createContext({});function useVisualElement(e,i,s,a,_,et){var $t,Lt;const{visualElement:nt}=reactExports.useContext(MotionContext),c=reactExports.useContext(LazyContext),ct=reactExports.useContext(PresenceContext),dt=reactExports.useContext(MotionConfigContext).reducedMotion,gt=reactExports.useRef(null);a=a||c.renderer,!gt.current&&a&&(gt.current=a(e,{visualState:i,parent:nt,props:s,presenceContext:ct,blockInitialAnimation:ct?ct.initial===!1:!1,reducedMotionConfig:dt,isSVG:et}));const Tt=gt.current,Et=reactExports.useContext(SwitchLayoutGroupContext);Tt&&!Tt.projection&&_&&(Tt.type==="html"||Tt.type==="svg")&&createProjectionNode$1(gt.current,s,_,Et);const At=reactExports.useRef(!1);reactExports.useInsertionEffect(()=>{Tt&&At.current&&Tt.update(s,ct)});const Mt=s[optimizedAppearDataAttribute],Pt=reactExports.useRef(!!Mt&&!(($t=window.MotionHandoffIsComplete)!=null&&$t.call(window,Mt))&&((Lt=window.MotionHasOptimisedAnimation)==null?void 0:Lt.call(window,Mt)));return useIsomorphicLayoutEffect$1(()=>{Tt&&(At.current=!0,window.MotionIsMounted=!0,Tt.updateFeatures(),Tt.scheduleRenderMicrotask(),Pt.current&&Tt.animationState&&Tt.animationState.animateChanges())}),reactExports.useEffect(()=>{Tt&&(!Pt.current&&Tt.animationState&&Tt.animationState.animateChanges(),Pt.current&&(queueMicrotask(()=>{var Bt;(Bt=window.MotionHandoffMarkAsComplete)==null||Bt.call(window,Mt)}),Pt.current=!1),Tt.enteringChildren=void 0)}),Tt}function createProjectionNode$1(e,i,s,a){const{layoutId:_,layout:et,drag:nt,dragConstraints:c,layoutScroll:ct,layoutRoot:dt,layoutCrossfade:gt}=i;e.projection=new s(e.latestValues,i["data-framer-portal-id"]?void 0:getClosestProjectingNode(e.parent)),e.projection.setOptions({layoutId:_,layout:et,alwaysMeasureLayout:!!nt||c&&isRefObject(c),visualElement:e,animationType:typeof et=="string"?et:"both",initialPromotionConfig:a,crossfade:gt,layoutScroll:ct,layoutRoot:dt})}function getClosestProjectingNode(e){if(e)return e.options.allowProjection!==!1?e.projection:getClosestProjectingNode(e.parent)}function createMotionComponent(e,{forwardMotionProps:i=!1,type:s}={},a,_){a&&loadFeatures(a);const et=s?s==="svg":isSVGComponent(e),nt=et?useSVGVisualState:useHTMLVisualState;function c(dt,gt){let Tt;const Et={...reactExports.useContext(MotionConfigContext),...dt,layoutId:useLayoutId(dt)},{isStatic:At}=Et,Mt=useCreateMotionContext(dt),Pt=nt(dt,At);if(!At&&isBrowser){useStrictMode();const $t=getProjectionFunctionality(Et);Tt=$t.MeasureLayout,Mt.visualElement=useVisualElement(e,Pt,Et,_,$t.ProjectionNode,et)}return jsxRuntimeExports.jsxs(MotionContext.Provider,{value:Mt,children:[Tt&&Mt.visualElement?jsxRuntimeExports.jsx(Tt,{visualElement:Mt.visualElement,...Et}):null,useRender(e,dt,useMotionRef(Pt,Mt.visualElement,gt),Pt,At,i,et)]})}c.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const ct=reactExports.forwardRef(c);return ct[motionComponentSymbol]=e,ct}function useLayoutId({layoutId:e}){const i=reactExports.useContext(LayoutGroupContext).id;return i&&e!==void 0?i+"-"+e:e}function useStrictMode(e,i){reactExports.useContext(LazyContext).strict}function getProjectionFunctionality(e){const{drag:i,layout:s}=featureDefinitions;if(!i&&!s)return{};const a={...i,...s};return{MeasureLayout:i!=null&&i.isEnabled(e)||s!=null&&s.isEnabled(e)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}function createMotionProxy(e,i){if(typeof Proxy>"u")return createMotionComponent;const s=new Map,a=(et,nt)=>createMotionComponent(et,nt,e,i),_=(et,nt)=>a(et,nt);return new Proxy(_,{get:(et,nt)=>nt==="create"?a:(s.has(nt)||s.set(nt,createMotionComponent(nt,void 0,e,i)),s.get(nt))})}function convertBoundingBoxToBox({top:e,left:i,right:s,bottom:a}){return{x:{min:i,max:s},y:{min:e,max:a}}}function convertBoxToBoundingBox({x:e,y:i}){return{top:i.min,right:e.max,bottom:i.max,left:e.min}}function transformBoxPoints(e,i){if(!i)return e;const s=i({x:e.left,y:e.top}),a=i({x:e.right,y:e.bottom});return{top:s.y,left:s.x,bottom:a.y,right:a.x}}function isIdentityScale(e){return e===void 0||e===1}function hasScale({scale:e,scaleX:i,scaleY:s}){return!isIdentityScale(e)||!isIdentityScale(i)||!isIdentityScale(s)}function hasTransform(e){return hasScale(e)||has2DTranslate(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function has2DTranslate(e){return is2DTranslate(e.x)||is2DTranslate(e.y)}function is2DTranslate(e){return e&&e!=="0%"}function scalePoint(e,i,s){const a=e-s,_=i*a;return s+_}function applyPointDelta(e,i,s,a,_){return _!==void 0&&(e=scalePoint(e,_,a)),scalePoint(e,s,a)+i}function applyAxisDelta(e,i=0,s=1,a,_){e.min=applyPointDelta(e.min,i,s,a,_),e.max=applyPointDelta(e.max,i,s,a,_)}function applyBoxDelta(e,{x:i,y:s}){applyAxisDelta(e.x,i.translate,i.scale,i.originPoint),applyAxisDelta(e.y,s.translate,s.scale,s.originPoint)}const TREE_SCALE_SNAP_MIN=.999999999999,TREE_SCALE_SNAP_MAX=1.0000000000001;function applyTreeDeltas(e,i,s,a=!1){const _=s.length;if(!_)return;i.x=i.y=1;let et,nt;for(let c=0;c<_;c++){et=s[c],nt=et.projectionDelta;const{visualElement:ct}=et.options;ct&&ct.props.style&&ct.props.style.display==="contents"||(a&&et.options.layoutScroll&&et.scroll&&et!==et.root&&transformBox(e,{x:-et.scroll.offset.x,y:-et.scroll.offset.y}),nt&&(i.x*=nt.x.scale,i.y*=nt.y.scale,applyBoxDelta(e,nt)),a&&hasTransform(et.latestValues)&&transformBox(e,et.latestValues))}i.x<TREE_SCALE_SNAP_MAX&&i.x>TREE_SCALE_SNAP_MIN&&(i.x=1),i.y<TREE_SCALE_SNAP_MAX&&i.y>TREE_SCALE_SNAP_MIN&&(i.y=1)}function translateAxis(e,i){e.min=e.min+i,e.max=e.max+i}function transformAxis(e,i,s,a,_=.5){const et=mixNumber$1(e.min,e.max,_);applyAxisDelta(e,i,s,et,a)}function transformBox(e,i){transformAxis(e.x,i.x,i.scaleX,i.scale,i.originX),transformAxis(e.y,i.y,i.scaleY,i.scale,i.originY)}function measureViewportBox(e,i){return convertBoundingBoxToBox(transformBoxPoints(e.getBoundingClientRect(),i))}function measurePageBox(e,i,s){const a=measureViewportBox(e,s),{scroll:_}=i;return _&&(translateAxis(a.x,_.offset.x),translateAxis(a.y,_.offset.y)),a}const createAxisDelta=()=>({translate:0,scale:1,origin:0,originPoint:0}),createDelta=()=>({x:createAxisDelta(),y:createAxisDelta()}),createAxis=()=>({min:0,max:0}),createBox=()=>({x:createAxis(),y:createAxis()}),prefersReducedMotion={current:null},hasReducedMotionListener={current:!1};function initPrefersReducedMotion(){if(hasReducedMotionListener.current=!0,!!isBrowser)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),i=()=>prefersReducedMotion.current=e.matches;e.addEventListener("change",i),i()}else prefersReducedMotion.current=!1}const visualElementStore=new WeakMap;function updateMotionValuesFromProps(e,i,s){for(const a in i){const _=i[a],et=s[a];if(isMotionValue(_))e.addValue(a,_);else if(isMotionValue(et))e.addValue(a,motionValue(_,{owner:e}));else if(et!==_)if(e.hasValue(a)){const nt=e.getValue(a);nt.liveStyle===!0?nt.jump(_):nt.hasAnimated||nt.set(_)}else{const nt=e.getStaticValue(a);e.addValue(a,motionValue(nt!==void 0?nt:_,{owner:e}))}}for(const a in s)i[a]===void 0&&e.removeValue(a);return i}const propEventHandlers=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class VisualElement{scrapeMotionValuesFromProps(i,s,a){return{}}constructor({parent:i,props:s,presenceContext:a,reducedMotionConfig:_,blockInitialAnimation:et,visualState:nt},c={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=KeyframeResolver,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const Et=time.now();this.renderScheduledAt<Et&&(this.renderScheduledAt=Et,frame.render(this.render,!1,!0))};const{latestValues:ct,renderState:dt}=nt;this.latestValues=ct,this.baseTarget={...ct},this.initialValues=s.initial?{...ct}:{},this.renderState=dt,this.parent=i,this.props=s,this.presenceContext=a,this.depth=i?i.depth+1:0,this.reducedMotionConfig=_,this.options=c,this.blockInitialAnimation=!!et,this.isControllingVariants=isControllingVariants(s),this.isVariantNode=isVariantNode(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(i&&i.current);const{willChange:gt,...Tt}=this.scrapeMotionValuesFromProps(s,{},this);for(const Et in Tt){const At=Tt[Et];ct[Et]!==void 0&&isMotionValue(At)&&At.set(ct[Et])}}mount(i){var s;this.current=i,visualElementStore.set(i,this),this.projection&&!this.projection.instance&&this.projection.mount(i),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((a,_)=>this.bindToMotionValue(_,a)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(hasReducedMotionListener.current||initPrefersReducedMotion(),this.shouldReduceMotion=prefersReducedMotion.current),(s=this.parent)==null||s.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var i;this.projection&&this.projection.unmount(),cancelFrame(this.notifyUpdate),cancelFrame(this.render),this.valueSubscriptions.forEach(s=>s()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(i=this.parent)==null||i.removeChild(this);for(const s in this.events)this.events[s].clear();for(const s in this.features){const a=this.features[s];a&&(a.unmount(),a.isMounted=!1)}this.current=null}addChild(i){this.children.add(i),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(i)}removeChild(i){this.children.delete(i),this.enteringChildren&&this.enteringChildren.delete(i)}bindToMotionValue(i,s){this.valueSubscriptions.has(i)&&this.valueSubscriptions.get(i)();const a=transformProps.has(i);a&&this.onBindTransform&&this.onBindTransform();const _=s.on("change",nt=>{this.latestValues[i]=nt,this.props.onUpdate&&frame.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let et;window.MotionCheckAppearSync&&(et=window.MotionCheckAppearSync(this,i,s)),this.valueSubscriptions.set(i,()=>{_(),et&&et(),s.owner&&s.stop()})}sortNodePosition(i){return!this.current||!this.sortInstanceNodePosition||this.type!==i.type?0:this.sortInstanceNodePosition(this.current,i.current)}updateFeatures(){let i="animation";for(i in featureDefinitions){const s=featureDefinitions[i];if(!s)continue;const{isEnabled:a,Feature:_}=s;if(!this.features[i]&&_&&a(this.props)&&(this.features[i]=new _(this)),this.features[i]){const et=this.features[i];et.isMounted?et.update():(et.mount(),et.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):createBox()}getStaticValue(i){return this.latestValues[i]}setStaticValue(i,s){this.latestValues[i]=s}update(i,s){(i.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=i,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let a=0;a<propEventHandlers.length;a++){const _=propEventHandlers[a];this.propEventSubscriptions[_]&&(this.propEventSubscriptions[_](),delete this.propEventSubscriptions[_]);const et="on"+_,nt=i[et];nt&&(this.propEventSubscriptions[_]=this.on(_,nt))}this.prevMotionValues=updateMotionValuesFromProps(this,this.scrapeMotionValuesFromProps(i,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(i){return this.props.variants?this.props.variants[i]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(i){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(i),()=>s.variantChildren.delete(i)}addValue(i,s){const a=this.values.get(i);s!==a&&(a&&this.removeValue(i),this.bindToMotionValue(i,s),this.values.set(i,s),this.latestValues[i]=s.get())}removeValue(i){this.values.delete(i);const s=this.valueSubscriptions.get(i);s&&(s(),this.valueSubscriptions.delete(i)),delete this.latestValues[i],this.removeValueFromRenderState(i,this.renderState)}hasValue(i){return this.values.has(i)}getValue(i,s){if(this.props.values&&this.props.values[i])return this.props.values[i];let a=this.values.get(i);return a===void 0&&s!==void 0&&(a=motionValue(s===null?void 0:s,{owner:this}),this.addValue(i,a)),a}readValue(i,s){let a=this.latestValues[i]!==void 0||!this.current?this.latestValues[i]:this.getBaseTargetFromProps(this.props,i)??this.readValueFromInstance(this.current,i,this.options);return a!=null&&(typeof a=="string"&&(isNumericalString(a)||isZeroValueString(a))?a=parseFloat(a):!findValueType(a)&&complex.test(s)&&(a=getAnimatableNone(i,s)),this.setBaseTarget(i,isMotionValue(a)?a.get():a)),isMotionValue(a)?a.get():a}setBaseTarget(i,s){this.baseTarget[i]=s}getBaseTarget(i){var et;const{initial:s}=this.props;let a;if(typeof s=="string"||typeof s=="object"){const nt=resolveVariantFromProps(this.props,s,(et=this.presenceContext)==null?void 0:et.custom);nt&&(a=nt[i])}if(s&&a!==void 0)return a;const _=this.getBaseTargetFromProps(this.props,i);return _!==void 0&&!isMotionValue(_)?_:this.initialValues[i]!==void 0&&a===void 0?void 0:this.baseTarget[i]}on(i,s){return this.events[i]||(this.events[i]=new SubscriptionManager),this.events[i].add(s)}notify(i,...s){this.events[i]&&this.events[i].notify(...s)}scheduleRenderMicrotask(){microtask.render(this.render)}}class DOMVisualElement extends VisualElement{constructor(){super(...arguments),this.KeyframeResolver=DOMKeyframesResolver}sortInstanceNodePosition(i,s){return i.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(i,s){return i.style?i.style[s]:void 0}removeValueFromRenderState(i,{vars:s,style:a}){delete s[i],delete a[i]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:i}=this.props;isMotionValue(i)&&(this.childSubscription=i.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function renderHTML(e,{style:i,vars:s},a,_){const et=e.style;let nt;for(nt in i)et[nt]=i[nt];_==null||_.applyProjectionStyles(et,a);for(nt in s)et.setProperty(nt,s[nt])}function getComputedStyle$1(e){return window.getComputedStyle(e)}class HTMLVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="html",this.renderInstance=renderHTML}readValueFromInstance(i,s){var a;if(transformProps.has(s))return(a=this.projection)!=null&&a.isProjecting?defaultTransformValue(s):readTransformValue(i,s);{const _=getComputedStyle$1(i),et=(isCSSVariableName(s)?_.getPropertyValue(s):_[s])||0;return typeof et=="string"?et.trim():et}}measureInstanceViewportBox(i,{transformPagePoint:s}){return measureViewportBox(i,s)}build(i,s,a){buildHTMLStyles(i,s,a.transformTemplate)}scrapeMotionValuesFromProps(i,s,a){return scrapeMotionValuesFromProps$1(i,s,a)}}const camelCaseAttributes=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function renderSVG(e,i,s,a){renderHTML(e,i,void 0,a);for(const _ in i.attrs)e.setAttribute(camelCaseAttributes.has(_)?_:camelToDash(_),i.attrs[_])}class SVGVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=createBox}getBaseTargetFromProps(i,s){return i[s]}readValueFromInstance(i,s){if(transformProps.has(s)){const a=getDefaultValueType(s);return a&&a.default||0}return s=camelCaseAttributes.has(s)?s:camelToDash(s),i.getAttribute(s)}scrapeMotionValuesFromProps(i,s,a){return scrapeMotionValuesFromProps(i,s,a)}build(i,s,a){buildSVGAttrs(i,s,this.isSVGTag,a.transformTemplate,a.style)}renderInstance(i,s,a,_){renderSVG(i,s,a,_)}mount(i){this.isSVGTag=isSVGTag(i.tagName),super.mount(i)}}const createDomVisualElement=(e,i)=>i.isSVG??isSVGComponent(e)?new SVGVisualElement(i):new HTMLVisualElement(i,{allowProjection:e!==reactExports.Fragment});function resolveVariant(e,i,s){const a=e.getProps();return resolveVariantFromProps(a,i,s!==void 0?s:a.custom,e)}const isKeyframesTarget=e=>Array.isArray(e);function setMotionValue(e,i,s){e.hasValue(i)?e.getValue(i).set(s):e.addValue(i,motionValue(s))}function resolveFinalValueInKeyframes(e){return isKeyframesTarget(e)?e[e.length-1]||0:e}function setTarget(e,i){const s=resolveVariant(e,i);let{transitionEnd:a={},transition:_={},...et}=s||{};et={...et,...a};for(const nt in et){const c=resolveFinalValueInKeyframes(et[nt]);setMotionValue(e,nt,c)}}function isWillChangeMotionValue(e){return!!(isMotionValue(e)&&e.add)}function addValueToWillChange(e,i){const s=e.getValue("willChange");if(isWillChangeMotionValue(s))return s.add(i);if(!s&&MotionGlobalConfig.WillChange){const a=new MotionGlobalConfig.WillChange("auto");e.addValue("willChange",a),a.add(i)}}function getOptimisedAppearId(e){return e.props[optimizedAppearDataAttribute]}const isNotNull=e=>e!==null;function getFinalKeyframe(e,{repeat:i,repeatType:s="loop"},a){const _=e.filter(isNotNull),et=i&&s!=="loop"&&i%2===1?0:_.length-1;return!et||a===void 0?_[et]:a}const underDampedSpring={type:"spring",stiffness:500,damping:25,restSpeed:10},criticallyDampedSpring=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),keyframesTransition={type:"keyframes",duration:.8},ease={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},getDefaultTransition=(e,{keyframes:i})=>i.length>2?keyframesTransition:transformProps.has(e)?e.startsWith("scale")?criticallyDampedSpring(i[1]):underDampedSpring:ease;function isTransitionDefined({when:e,delay:i,delayChildren:s,staggerChildren:a,staggerDirection:_,repeat:et,repeatType:nt,repeatDelay:c,from:ct,elapsed:dt,...gt}){return!!Object.keys(gt).length}const animateMotionValue=(e,i,s,a={},_,et)=>nt=>{const c=getValueTransition(a,e)||{},ct=c.delay||a.delay||0;let{elapsed:dt=0}=a;dt=dt-secondsToMilliseconds(ct);const gt={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:i.getVelocity(),...c,delay:-dt,onUpdate:Et=>{i.set(Et),c.onUpdate&&c.onUpdate(Et)},onComplete:()=>{nt(),c.onComplete&&c.onComplete()},name:e,motionValue:i,element:et?void 0:_};isTransitionDefined(c)||Object.assign(gt,getDefaultTransition(e,gt)),gt.duration&&(gt.duration=secondsToMilliseconds(gt.duration)),gt.repeatDelay&&(gt.repeatDelay=secondsToMilliseconds(gt.repeatDelay)),gt.from!==void 0&&(gt.keyframes[0]=gt.from);let Tt=!1;if((gt.type===!1||gt.duration===0&&!gt.repeatDelay)&&(makeAnimationInstant(gt),gt.delay===0&&(Tt=!0)),(MotionGlobalConfig.instantAnimations||MotionGlobalConfig.skipAnimations)&&(Tt=!0,makeAnimationInstant(gt),gt.delay=0),gt.allowFlatten=!c.type&&!c.ease,Tt&&!et&&i.get()!==void 0){const Et=getFinalKeyframe(gt.keyframes,c);if(Et!==void 0){frame.update(()=>{gt.onUpdate(Et),gt.onComplete()});return}}return c.isSync?new JSAnimation(gt):new AsyncMotionValueAnimation(gt)};function shouldBlockAnimation({protectedKeys:e,needsAnimating:i},s){const a=e.hasOwnProperty(s)&&i[s]!==!0;return i[s]=!1,a}function animateTarget(e,i,{delay:s=0,transitionOverride:a,type:_}={}){let{transition:et=e.getDefaultTransition(),transitionEnd:nt,...c}=i;a&&(et=a);const ct=[],dt=_&&e.animationState&&e.animationState.getState()[_];for(const gt in c){const Tt=e.getValue(gt,e.latestValues[gt]??null),Et=c[gt];if(Et===void 0||dt&&shouldBlockAnimation(dt,gt))continue;const At={delay:s,...getValueTransition(et||{},gt)},Mt=Tt.get();if(Mt!==void 0&&!Tt.isAnimating&&!Array.isArray(Et)&&Et===Mt&&!At.velocity)continue;let Pt=!1;if(window.MotionHandoffAnimation){const Lt=getOptimisedAppearId(e);if(Lt){const Bt=window.MotionHandoffAnimation(Lt,gt,frame);Bt!==null&&(At.startTime=Bt,Pt=!0)}}addValueToWillChange(e,gt),Tt.start(animateMotionValue(gt,Tt,Et,e.shouldReduceMotion&&positionalKeys.has(gt)?{type:!1}:At,e,Pt));const $t=Tt.animation;$t&&ct.push($t)}return nt&&Promise.all(ct).then(()=>{frame.update(()=>{nt&&setTarget(e,nt)})}),ct}function calcChildStagger(e,i,s,a=0,_=1){const et=Array.from(e).sort((dt,gt)=>dt.sortNodePosition(gt)).indexOf(i),nt=e.size,c=(nt-1)*a;return typeof s=="function"?s(et,nt):_===1?et*a:c-et*a}function animateVariant(e,i,s={}){var ct;const a=resolveVariant(e,i,s.type==="exit"?(ct=e.presenceContext)==null?void 0:ct.custom:void 0);let{transition:_=e.getDefaultTransition()||{}}=a||{};s.transitionOverride&&(_=s.transitionOverride);const et=a?()=>Promise.all(animateTarget(e,a,s)):()=>Promise.resolve(),nt=e.variantChildren&&e.variantChildren.size?(dt=0)=>{const{delayChildren:gt=0,staggerChildren:Tt,staggerDirection:Et}=_;return animateChildren(e,i,dt,gt,Tt,Et,s)}:()=>Promise.resolve(),{when:c}=_;if(c){const[dt,gt]=c==="beforeChildren"?[et,nt]:[nt,et];return dt().then(()=>gt())}else return Promise.all([et(),nt(s.delay)])}function animateChildren(e,i,s=0,a=0,_=0,et=1,nt){const c=[];for(const ct of e.variantChildren)ct.notify("AnimationStart",i),c.push(animateVariant(ct,i,{...nt,delay:s+(typeof a=="function"?0:a)+calcChildStagger(e.variantChildren,ct,a,_,et)}).then(()=>ct.notify("AnimationComplete",i)));return Promise.all(c)}function animateVisualElement(e,i,s={}){e.notify("AnimationStart",i);let a;if(Array.isArray(i)){const _=i.map(et=>animateVariant(e,et,s));a=Promise.all(_)}else if(typeof i=="string")a=animateVariant(e,i,s);else{const _=typeof i=="function"?resolveVariant(e,i,s.custom):i;a=Promise.all(animateTarget(e,_,s))}return a.then(()=>{e.notify("AnimationComplete",i)})}function shallowCompare(e,i){if(!Array.isArray(i))return!1;const s=i.length;if(s!==e.length)return!1;for(let a=0;a<s;a++)if(i[a]!==e[a])return!1;return!0}const numVariantProps=variantProps.length;function getVariantContext(e){if(!e)return;if(!e.isControllingVariants){const s=e.parent?getVariantContext(e.parent)||{}:{};return e.props.initial!==void 0&&(s.initial=e.props.initial),s}const i={};for(let s=0;s<numVariantProps;s++){const a=variantProps[s],_=e.props[a];(isVariantLabel(_)||_===!1)&&(i[a]=_)}return i}const reversePriorityOrder=[...variantPriorityOrder].reverse(),numAnimationTypes=variantPriorityOrder.length;function animateList(e){return i=>Promise.all(i.map(({animation:s,options:a})=>animateVisualElement(e,s,a)))}function createAnimationState(e){let i=animateList(e),s=createState(),a=!0;const _=ct=>(dt,gt)=>{var Et;const Tt=resolveVariant(e,gt,ct==="exit"?(Et=e.presenceContext)==null?void 0:Et.custom:void 0);if(Tt){const{transition:At,transitionEnd:Mt,...Pt}=Tt;dt={...dt,...Pt,...Mt}}return dt};function et(ct){i=ct(e)}function nt(ct){const{props:dt}=e,gt=getVariantContext(e.parent)||{},Tt=[],Et=new Set;let At={},Mt=1/0;for(let $t=0;$t<numAnimationTypes;$t++){const Lt=reversePriorityOrder[$t],Bt=s[Lt],Nt=dt[Lt]!==void 0?dt[Lt]:gt[Lt],Vt=isVariantLabel(Nt),Xt=Lt===ct?Bt.isActive:null;Xt===!1&&(Mt=$t);let nr=Nt===gt[Lt]&&Nt!==dt[Lt]&&Vt;if(nr&&a&&e.manuallyAnimateOnMount&&(nr=!1),Bt.protectedKeys={...At},!Bt.isActive&&Xt===null||!Nt&&!Bt.prevProp||isAnimationControls(Nt)||typeof Nt=="boolean")continue;const ar=checkVariantsDidChange(Bt.prevProp,Nt);let mr=ar||Lt===ct&&Bt.isActive&&!nr&&Vt||$t>Mt&&Vt,Fr=!1;const sn=Array.isArray(Nt)?Nt:[Nt];let fn=sn.reduce(_(Lt),{});Xt===!1&&(fn={});const{prevResolvedValues:Lr={}}=Bt,Qr={...Lr,...fn},dn=Ar=>{mr=!0,Et.has(Ar)&&(Fr=!0,Et.delete(Ar)),Bt.needsAnimating[Ar]=!0;const rr=e.getValue(Ar);rr&&(rr.liveStyle=!1)};for(const Ar in Qr){const rr=fn[Ar],ur=Lr[Ar];if(At.hasOwnProperty(Ar))continue;let Br=!1;isKeyframesTarget(rr)&&isKeyframesTarget(ur)?Br=!shallowCompare(rr,ur):Br=rr!==ur,Br?rr!=null?dn(Ar):Et.add(Ar):rr!==void 0&&Et.has(Ar)?dn(Ar):Bt.protectedKeys[Ar]=!0}Bt.prevProp=Nt,Bt.prevResolvedValues=fn,Bt.isActive&&(At={...At,...fn}),a&&e.blockInitialAnimation&&(mr=!1);const en=nr&&ar;mr&&(!en||Fr)&&Tt.push(...sn.map(Ar=>{const rr={type:Lt};if(typeof Ar=="string"&&a&&!en&&e.manuallyAnimateOnMount&&e.parent){const{parent:ur}=e,Br=resolveVariant(ur,Ar);if(ur.enteringChildren&&Br){const{delayChildren:xr}=Br.transition||{};rr.delay=calcChildStagger(ur.enteringChildren,e,xr)}}return{animation:Ar,options:rr}}))}if(Et.size){const $t={};if(typeof dt.initial!="boolean"){const Lt=resolveVariant(e,Array.isArray(dt.initial)?dt.initial[0]:dt.initial);Lt&&Lt.transition&&($t.transition=Lt.transition)}Et.forEach(Lt=>{const Bt=e.getBaseTarget(Lt),Nt=e.getValue(Lt);Nt&&(Nt.liveStyle=!0),$t[Lt]=Bt??null}),Tt.push({animation:$t})}let Pt=!!Tt.length;return a&&(dt.initial===!1||dt.initial===dt.animate)&&!e.manuallyAnimateOnMount&&(Pt=!1),a=!1,Pt?i(Tt):Promise.resolve()}function c(ct,dt){var Tt;if(s[ct].isActive===dt)return Promise.resolve();(Tt=e.variantChildren)==null||Tt.forEach(Et=>{var At;return(At=Et.animationState)==null?void 0:At.setActive(ct,dt)}),s[ct].isActive=dt;const gt=nt(ct);for(const Et in s)s[Et].protectedKeys={};return gt}return{animateChanges:nt,setActive:c,setAnimateFunction:et,getState:()=>s,reset:()=>{s=createState()}}}function checkVariantsDidChange(e,i){return typeof i=="string"?i!==e:Array.isArray(i)?!shallowCompare(i,e):!1}function createTypeState(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function createState(){return{animate:createTypeState(!0),whileInView:createTypeState(),whileHover:createTypeState(),whileTap:createTypeState(),whileDrag:createTypeState(),whileFocus:createTypeState(),exit:createTypeState()}}let Feature$1=class{constructor(i){this.isMounted=!1,this.node=i}update(){}};class AnimationFeature extends Feature$1{constructor(i){super(i),i.animationState||(i.animationState=createAnimationState(i))}updateAnimationControlsSubscription(){const{animate:i}=this.node.getProps();isAnimationControls(i)&&(this.unmountControls=i.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:i}=this.node.getProps(),{animate:s}=this.node.prevProps||{};i!==s&&this.updateAnimationControlsSubscription()}unmount(){var i;this.node.animationState.reset(),(i=this.unmountControls)==null||i.call(this)}}let id$1=0;class ExitAnimationFeature extends Feature$1{constructor(){super(...arguments),this.id=id$1++}update(){if(!this.node.presenceContext)return;const{isPresent:i,onExitComplete:s}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||i===a)return;const _=this.node.animationState.setActive("exit",!i);s&&!i&&_.then(()=>{s(this.id)})}mount(){const{register:i,onExitComplete:s}=this.node.presenceContext||{};s&&s(this.id),i&&(this.unmount=i(this.id))}unmount(){}}const animations={animation:{Feature:AnimationFeature},exit:{Feature:ExitAnimationFeature}};function addDomEvent(e,i,s,a={passive:!0}){return e.addEventListener(i,s,a),()=>e.removeEventListener(i,s)}function extractEventInfo(e){return{point:{x:e.pageX,y:e.pageY}}}const addPointerInfo=e=>i=>isPrimaryPointer(i)&&e(i,extractEventInfo(i));function addPointerEvent(e,i,s,a){return addDomEvent(e,i,addPointerInfo(s),a)}const SCALE_PRECISION=1e-4,SCALE_MIN=1-SCALE_PRECISION,SCALE_MAX=1+SCALE_PRECISION,TRANSLATE_PRECISION=.01,TRANSLATE_MIN=0-TRANSLATE_PRECISION,TRANSLATE_MAX=0+TRANSLATE_PRECISION;function calcLength(e){return e.max-e.min}function isNear(e,i,s){return Math.abs(e-i)<=s}function calcAxisDelta(e,i,s,a=.5){e.origin=a,e.originPoint=mixNumber$1(i.min,i.max,e.origin),e.scale=calcLength(s)/calcLength(i),e.translate=mixNumber$1(s.min,s.max,e.origin)-e.originPoint,(e.scale>=SCALE_MIN&&e.scale<=SCALE_MAX||isNaN(e.scale))&&(e.scale=1),(e.translate>=TRANSLATE_MIN&&e.translate<=TRANSLATE_MAX||isNaN(e.translate))&&(e.translate=0)}function calcBoxDelta(e,i,s,a){calcAxisDelta(e.x,i.x,s.x,a?a.originX:void 0),calcAxisDelta(e.y,i.y,s.y,a?a.originY:void 0)}function calcRelativeAxis(e,i,s){e.min=s.min+i.min,e.max=e.min+calcLength(i)}function calcRelativeBox(e,i,s){calcRelativeAxis(e.x,i.x,s.x),calcRelativeAxis(e.y,i.y,s.y)}function calcRelativeAxisPosition(e,i,s){e.min=i.min-s.min,e.max=e.min+calcLength(i)}function calcRelativePosition(e,i,s){calcRelativeAxisPosition(e.x,i.x,s.x),calcRelativeAxisPosition(e.y,i.y,s.y)}function eachAxis(e){return[e("x"),e("y")]}const getContextWindow=({current:e})=>e?e.ownerDocument.defaultView:null,distance=(e,i)=>Math.abs(e-i);function distance2D(e,i){const s=distance(e.x,i.x),a=distance(e.y,i.y);return Math.sqrt(s**2+a**2)}class PanSession{constructor(i,s,{transformPagePoint:a,contextWindow:_=window,dragSnapToOrigin:et=!1,distanceThreshold:nt=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Et=getPanInfo(this.lastMoveEventInfo,this.history),At=this.startEvent!==null,Mt=distance2D(Et.offset,{x:0,y:0})>=this.distanceThreshold;if(!At&&!Mt)return;const{point:Pt}=Et,{timestamp:$t}=frameData;this.history.push({...Pt,timestamp:$t});const{onStart:Lt,onMove:Bt}=this.handlers;At||(Lt&&Lt(this.lastMoveEvent,Et),this.startEvent=this.lastMoveEvent),Bt&&Bt(this.lastMoveEvent,Et)},this.handlePointerMove=(Et,At)=>{this.lastMoveEvent=Et,this.lastMoveEventInfo=transformPoint(At,this.transformPagePoint),frame.update(this.updatePoint,!0)},this.handlePointerUp=(Et,At)=>{this.end();const{onEnd:Mt,onSessionEnd:Pt,resumeAnimation:$t}=this.handlers;if(this.dragSnapToOrigin&&$t&&$t(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Lt=getPanInfo(Et.type==="pointercancel"?this.lastMoveEventInfo:transformPoint(At,this.transformPagePoint),this.history);this.startEvent&&Mt&&Mt(Et,Lt),Pt&&Pt(Et,Lt)},!isPrimaryPointer(i))return;this.dragSnapToOrigin=et,this.handlers=s,this.transformPagePoint=a,this.distanceThreshold=nt,this.contextWindow=_||window;const c=extractEventInfo(i),ct=transformPoint(c,this.transformPagePoint),{point:dt}=ct,{timestamp:gt}=frameData;this.history=[{...dt,timestamp:gt}];const{onSessionStart:Tt}=s;Tt&&Tt(i,getPanInfo(ct,this.history)),this.removeListeners=pipe(addPointerEvent(this.contextWindow,"pointermove",this.handlePointerMove),addPointerEvent(this.contextWindow,"pointerup",this.handlePointerUp),addPointerEvent(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(i){this.handlers=i}end(){this.removeListeners&&this.removeListeners(),cancelFrame(this.updatePoint)}}function transformPoint(e,i){return i?{point:i(e.point)}:e}function subtractPoint(e,i){return{x:e.x-i.x,y:e.y-i.y}}function getPanInfo({point:e},i){return{point:e,delta:subtractPoint(e,lastDevicePoint(i)),offset:subtractPoint(e,startDevicePoint(i)),velocity:getVelocity(i,.1)}}function startDevicePoint(e){return e[0]}function lastDevicePoint(e){return e[e.length-1]}function getVelocity(e,i){if(e.length<2)return{x:0,y:0};let s=e.length-1,a=null;const _=lastDevicePoint(e);for(;s>=0&&(a=e[s],!(_.timestamp-a.timestamp>secondsToMilliseconds(i)));)s--;if(!a)return{x:0,y:0};const et=millisecondsToSeconds(_.timestamp-a.timestamp);if(et===0)return{x:0,y:0};const nt={x:(_.x-a.x)/et,y:(_.y-a.y)/et};return nt.x===1/0&&(nt.x=0),nt.y===1/0&&(nt.y=0),nt}function applyConstraints(e,{min:i,max:s},a){return i!==void 0&&e<i?e=a?mixNumber$1(i,e,a.min):Math.max(e,i):s!==void 0&&e>s&&(e=a?mixNumber$1(s,e,a.max):Math.min(e,s)),e}function calcRelativeAxisConstraints(e,i,s){return{min:i!==void 0?e.min+i:void 0,max:s!==void 0?e.max+s-(e.max-e.min):void 0}}function calcRelativeConstraints(e,{top:i,left:s,bottom:a,right:_}){return{x:calcRelativeAxisConstraints(e.x,s,_),y:calcRelativeAxisConstraints(e.y,i,a)}}function calcViewportAxisConstraints(e,i){let s=i.min-e.min,a=i.max-e.max;return i.max-i.min<e.max-e.min&&([s,a]=[a,s]),{min:s,max:a}}function calcViewportConstraints(e,i){return{x:calcViewportAxisConstraints(e.x,i.x),y:calcViewportAxisConstraints(e.y,i.y)}}function calcOrigin(e,i){let s=.5;const a=calcLength(e),_=calcLength(i);return _>a?s=progress(i.min,i.max-a,e.min):a>_&&(s=progress(e.min,e.max-_,i.min)),clamp$1(0,1,s)}function rebaseAxisConstraints(e,i){const s={};return i.min!==void 0&&(s.min=i.min-e.min),i.max!==void 0&&(s.max=i.max-e.min),s}const defaultElastic=.35;function resolveDragElastic(e=defaultElastic){return e===!1?e=0:e===!0&&(e=defaultElastic),{x:resolveAxisElastic(e,"left","right"),y:resolveAxisElastic(e,"top","bottom")}}function resolveAxisElastic(e,i,s){return{min:resolvePointElastic(e,i),max:resolvePointElastic(e,s)}}function resolvePointElastic(e,i){return typeof e=="number"?e:e[i]||0}const elementDragControls=new WeakMap;class VisualElementDragControls{constructor(i){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=createBox(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=i}start(i,{snapToCursor:s=!1,distanceThreshold:a}={}){const{presenceContext:_}=this.visualElement;if(_&&_.isPresent===!1)return;const et=Tt=>{const{dragSnapToOrigin:Et}=this.getProps();Et?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(extractEventInfo(Tt).point)},nt=(Tt,Et)=>{const{drag:At,dragPropagation:Mt,onDragStart:Pt}=this.getProps();if(At&&!Mt&&(this.openDragLock&&this.openDragLock(),this.openDragLock=setDragLock(At),!this.openDragLock))return;this.latestPointerEvent=Tt,this.latestPanInfo=Et,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),eachAxis(Lt=>{let Bt=this.getAxisMotionValue(Lt).get()||0;if(percent.test(Bt)){const{projection:Nt}=this.visualElement;if(Nt&&Nt.layout){const Vt=Nt.layout.layoutBox[Lt];Vt&&(Bt=calcLength(Vt)*(parseFloat(Bt)/100))}}this.originPoint[Lt]=Bt}),Pt&&frame.postRender(()=>Pt(Tt,Et)),addValueToWillChange(this.visualElement,"transform");const{animationState:$t}=this.visualElement;$t&&$t.setActive("whileDrag",!0)},c=(Tt,Et)=>{this.latestPointerEvent=Tt,this.latestPanInfo=Et;const{dragPropagation:At,dragDirectionLock:Mt,onDirectionLock:Pt,onDrag:$t}=this.getProps();if(!At&&!this.openDragLock)return;const{offset:Lt}=Et;if(Mt&&this.currentDirection===null){this.currentDirection=getCurrentDirection(Lt),this.currentDirection!==null&&Pt&&Pt(this.currentDirection);return}this.updateAxis("x",Et.point,Lt),this.updateAxis("y",Et.point,Lt),this.visualElement.render(),$t&&$t(Tt,Et)},ct=(Tt,Et)=>{this.latestPointerEvent=Tt,this.latestPanInfo=Et,this.stop(Tt,Et),this.latestPointerEvent=null,this.latestPanInfo=null},dt=()=>eachAxis(Tt=>{var Et;return this.getAnimationState(Tt)==="paused"&&((Et=this.getAxisMotionValue(Tt).animation)==null?void 0:Et.play())}),{dragSnapToOrigin:gt}=this.getProps();this.panSession=new PanSession(i,{onSessionStart:et,onStart:nt,onMove:c,onSessionEnd:ct,resumeAnimation:dt},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:gt,distanceThreshold:a,contextWindow:getContextWindow(this.visualElement)})}stop(i,s){const a=i||this.latestPointerEvent,_=s||this.latestPanInfo,et=this.isDragging;if(this.cancel(),!et||!_||!a)return;const{velocity:nt}=_;this.startAnimation(nt);const{onDragEnd:c}=this.getProps();c&&frame.postRender(()=>c(a,_))}cancel(){this.isDragging=!1;const{projection:i,animationState:s}=this.visualElement;i&&(i.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(i,s,a){const{drag:_}=this.getProps();if(!a||!shouldDrag(i,_,this.currentDirection))return;const et=this.getAxisMotionValue(i);let nt=this.originPoint[i]+a[i];this.constraints&&this.constraints[i]&&(nt=applyConstraints(nt,this.constraints[i],this.elastic[i])),et.set(nt)}resolveConstraints(){var et;const{dragConstraints:i,dragElastic:s}=this.getProps(),a=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(et=this.visualElement.projection)==null?void 0:et.layout,_=this.constraints;i&&isRefObject(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&a?this.constraints=calcRelativeConstraints(a.layoutBox,i):this.constraints=!1,this.elastic=resolveDragElastic(s),_!==this.constraints&&a&&this.constraints&&!this.hasMutatedConstraints&&eachAxis(nt=>{this.constraints!==!1&&this.getAxisMotionValue(nt)&&(this.constraints[nt]=rebaseAxisConstraints(a.layoutBox[nt],this.constraints[nt]))})}resolveRefConstraints(){const{dragConstraints:i,onMeasureDragConstraints:s}=this.getProps();if(!i||!isRefObject(i))return!1;const a=i.current;invariant(a!==null,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.","drag-constraints-ref");const{projection:_}=this.visualElement;if(!_||!_.layout)return!1;const et=measurePageBox(a,_.root,this.visualElement.getTransformPagePoint());let nt=calcViewportConstraints(_.layout.layoutBox,et);if(s){const c=s(convertBoxToBoundingBox(nt));this.hasMutatedConstraints=!!c,c&&(nt=convertBoundingBoxToBox(c))}return nt}startAnimation(i){const{drag:s,dragMomentum:a,dragElastic:_,dragTransition:et,dragSnapToOrigin:nt,onDragTransitionEnd:c}=this.getProps(),ct=this.constraints||{},dt=eachAxis(gt=>{if(!shouldDrag(gt,s,this.currentDirection))return;let Tt=ct&&ct[gt]||{};nt&&(Tt={min:0,max:0});const Et=_?200:1e6,At=_?40:1e7,Mt={type:"inertia",velocity:a?i[gt]:0,bounceStiffness:Et,bounceDamping:At,timeConstant:750,restDelta:1,restSpeed:10,...et,...Tt};return this.startAxisValueAnimation(gt,Mt)});return Promise.all(dt).then(c)}startAxisValueAnimation(i,s){const a=this.getAxisMotionValue(i);return addValueToWillChange(this.visualElement,i),a.start(animateMotionValue(i,a,0,s,this.visualElement,!1))}stopAnimation(){eachAxis(i=>this.getAxisMotionValue(i).stop())}pauseAnimation(){eachAxis(i=>{var s;return(s=this.getAxisMotionValue(i).animation)==null?void 0:s.pause()})}getAnimationState(i){var s;return(s=this.getAxisMotionValue(i).animation)==null?void 0:s.state}getAxisMotionValue(i){const s=`_drag${i.toUpperCase()}`,a=this.visualElement.getProps(),_=a[s];return _||this.visualElement.getValue(i,(a.initial?a.initial[i]:void 0)||0)}snapToCursor(i){eachAxis(s=>{const{drag:a}=this.getProps();if(!shouldDrag(s,a,this.currentDirection))return;const{projection:_}=this.visualElement,et=this.getAxisMotionValue(s);if(_&&_.layout){const{min:nt,max:c}=_.layout.layoutBox[s],ct=et.get()||0;et.set(i[s]-mixNumber$1(nt,c,.5)+ct)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:i,dragConstraints:s}=this.getProps(),{projection:a}=this.visualElement;if(!isRefObject(s)||!a||!this.constraints)return;this.stopAnimation();const _={x:0,y:0};eachAxis(nt=>{const c=this.getAxisMotionValue(nt);if(c&&this.constraints!==!1){const ct=c.get();_[nt]=calcOrigin({min:ct,max:ct},this.constraints[nt])}});const{transformTemplate:et}=this.visualElement.getProps();this.visualElement.current.style.transform=et?et({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),eachAxis(nt=>{if(!shouldDrag(nt,i,null))return;const c=this.getAxisMotionValue(nt),{min:ct,max:dt}=this.constraints[nt];c.set(mixNumber$1(ct,dt,_[nt]))})}addListeners(){if(!this.visualElement.current)return;elementDragControls.set(this.visualElement,this);const i=this.visualElement.current,s=addPointerEvent(i,"pointerdown",ct=>{const{drag:dt,dragListener:gt=!0}=this.getProps();dt&&gt&&this.start(ct)}),a=()=>{const{dragConstraints:ct}=this.getProps();isRefObject(ct)&&ct.current&&(this.constraints=this.resolveRefConstraints())},{projection:_}=this.visualElement,et=_.addEventListener("measure",a);_&&!_.layout&&(_.root&&_.root.updateScroll(),_.updateLayout()),frame.read(a);const nt=addDomEvent(window,"resize",()=>this.scalePositionWithinConstraints()),c=_.addEventListener("didUpdate",({delta:ct,hasLayoutChanged:dt})=>{this.isDragging&&dt&&(eachAxis(gt=>{const Tt=this.getAxisMotionValue(gt);Tt&&(this.originPoint[gt]+=ct[gt].translate,Tt.set(Tt.get()+ct[gt].translate))}),this.visualElement.render())});return()=>{nt(),s(),et(),c&&c()}}getProps(){const i=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:a=!1,dragPropagation:_=!1,dragConstraints:et=!1,dragElastic:nt=defaultElastic,dragMomentum:c=!0}=i;return{...i,drag:s,dragDirectionLock:a,dragPropagation:_,dragConstraints:et,dragElastic:nt,dragMomentum:c}}}function shouldDrag(e,i,s){return(i===!0||i===e)&&(s===null||s===e)}function getCurrentDirection(e,i=10){let s=null;return Math.abs(e.y)>i?s="y":Math.abs(e.x)>i&&(s="x"),s}class DragGesture extends Feature$1{constructor(i){super(i),this.removeGroupControls=noop,this.removeListeners=noop,this.controls=new VisualElementDragControls(i)}mount(){const{dragControls:i}=this.node.getProps();i&&(this.removeGroupControls=i.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||noop}update(){const{dragControls:i}=this.node.getProps(),{dragControls:s}=this.node.prevProps||{};i!==s&&(this.removeGroupControls(),i&&(this.removeGroupControls=i.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners()}}const asyncHandler=e=>(i,s)=>{e&&frame.postRender(()=>e(i,s))};class PanGesture extends Feature$1{constructor(){super(...arguments),this.removePointerDownListener=noop}onPointerDown(i){this.session=new PanSession(i,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:getContextWindow(this.node)})}createPanHandlers(){const{onPanSessionStart:i,onPanStart:s,onPan:a,onPanEnd:_}=this.node.getProps();return{onSessionStart:asyncHandler(i),onStart:asyncHandler(s),onMove:a,onEnd:(et,nt)=>{delete this.session,_&&frame.postRender(()=>_(et,nt))}}}mount(){this.removePointerDownListener=addPointerEvent(this.node.current,"pointerdown",i=>this.onPointerDown(i))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const globalProjectionState={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let hasTakenAnySnapshot=!1;class MeasureLayoutWithContext extends reactExports.Component{componentDidMount(){const{visualElement:i,layoutGroup:s,switchLayoutGroup:a,layoutId:_}=this.props,{projection:et}=i;et&&(s.group&&s.group.add(et),a&&a.register&&_&&a.register(et),hasTakenAnySnapshot&&et.root.didUpdate(),et.addEventListener("animationComplete",()=>{this.safeToRemove()}),et.setOptions({...et.options,onExitComplete:()=>this.safeToRemove()})),globalProjectionState.hasEverUpdated=!0}getSnapshotBeforeUpdate(i){const{layoutDependency:s,visualElement:a,drag:_,isPresent:et}=this.props,{projection:nt}=a;return nt&&(nt.isPresent=et,hasTakenAnySnapshot=!0,_||i.layoutDependency!==s||s===void 0||i.isPresent!==et?nt.willUpdate():this.safeToRemove(),i.isPresent!==et&&(et?nt.promote():nt.relegate()||frame.postRender(()=>{const c=nt.getStack();(!c||!c.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:i}=this.props.visualElement;i&&(i.root.didUpdate(),microtask.postRender(()=>{!i.currentAnimation&&i.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:i,layoutGroup:s,switchLayoutGroup:a}=this.props,{projection:_}=i;hasTakenAnySnapshot=!0,_&&(_.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(_),a&&a.deregister&&a.deregister(_))}safeToRemove(){const{safeToRemove:i}=this.props;i&&i()}render(){return null}}function MeasureLayout(e){const[i,s]=usePresence(),a=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(MeasureLayoutWithContext,{...e,layoutGroup:a,switchLayoutGroup:reactExports.useContext(SwitchLayoutGroupContext),isPresent:i,safeToRemove:s})}function animateSingleValue(e,i,s){const a=isMotionValue(e)?e:motionValue(e);return a.start(animateMotionValue("",a,i,s)),a.animation}const compareByDepth=(e,i)=>e.depth-i.depth;class FlatTree{constructor(){this.children=[],this.isDirty=!1}add(i){addUniqueItem(this.children,i),this.isDirty=!0}remove(i){removeItem(this.children,i),this.isDirty=!0}forEach(i){this.isDirty&&this.children.sort(compareByDepth),this.isDirty=!1,this.children.forEach(i)}}function delay(e,i){const s=time.now(),a=({timestamp:_})=>{const et=_-s;et>=i&&(cancelFrame(a),e(et-i))};return frame.setup(a,!0),()=>cancelFrame(a)}const borders=["TopLeft","TopRight","BottomLeft","BottomRight"],numBorders=borders.length,asNumber=e=>typeof e=="string"?parseFloat(e):e,isPx=e=>typeof e=="number"||px.test(e);function mixValues(e,i,s,a,_,et){_?(e.opacity=mixNumber$1(0,s.opacity??1,easeCrossfadeIn(a)),e.opacityExit=mixNumber$1(i.opacity??1,0,easeCrossfadeOut(a))):et&&(e.opacity=mixNumber$1(i.opacity??1,s.opacity??1,a));for(let nt=0;nt<numBorders;nt++){const c=`border${borders[nt]}Radius`;let ct=getRadius(i,c),dt=getRadius(s,c);if(ct===void 0&&dt===void 0)continue;ct||(ct=0),dt||(dt=0),ct===0||dt===0||isPx(ct)===isPx(dt)?(e[c]=Math.max(mixNumber$1(asNumber(ct),asNumber(dt),a),0),(percent.test(dt)||percent.test(ct))&&(e[c]+="%")):e[c]=dt}(i.rotate||s.rotate)&&(e.rotate=mixNumber$1(i.rotate||0,s.rotate||0,a))}function getRadius(e,i){return e[i]!==void 0?e[i]:e.borderRadius}const easeCrossfadeIn=compress(0,.5,circOut),easeCrossfadeOut=compress(.5,.95,noop);function compress(e,i,s){return a=>a<e?0:a>i?1:s(progress(e,i,a))}function copyAxisInto(e,i){e.min=i.min,e.max=i.max}function copyBoxInto(e,i){copyAxisInto(e.x,i.x),copyAxisInto(e.y,i.y)}function copyAxisDeltaInto(e,i){e.translate=i.translate,e.scale=i.scale,e.originPoint=i.originPoint,e.origin=i.origin}function removePointDelta(e,i,s,a,_){return e-=i,e=scalePoint(e,1/s,a),_!==void 0&&(e=scalePoint(e,1/_,a)),e}function removeAxisDelta(e,i=0,s=1,a=.5,_,et=e,nt=e){if(percent.test(i)&&(i=parseFloat(i),i=mixNumber$1(nt.min,nt.max,i/100)-nt.min),typeof i!="number")return;let c=mixNumber$1(et.min,et.max,a);e===et&&(c-=i),e.min=removePointDelta(e.min,i,s,c,_),e.max=removePointDelta(e.max,i,s,c,_)}function removeAxisTransforms(e,i,[s,a,_],et,nt){removeAxisDelta(e,i[s],i[a],i[_],i.scale,et,nt)}const xKeys=["x","scaleX","originX"],yKeys=["y","scaleY","originY"];function removeBoxTransforms(e,i,s,a){removeAxisTransforms(e.x,i,xKeys,s?s.x:void 0,a?a.x:void 0),removeAxisTransforms(e.y,i,yKeys,s?s.y:void 0,a?a.y:void 0)}function isAxisDeltaZero(e){return e.translate===0&&e.scale===1}function isDeltaZero(e){return isAxisDeltaZero(e.x)&&isAxisDeltaZero(e.y)}function axisEquals(e,i){return e.min===i.min&&e.max===i.max}function boxEquals(e,i){return axisEquals(e.x,i.x)&&axisEquals(e.y,i.y)}function axisEqualsRounded(e,i){return Math.round(e.min)===Math.round(i.min)&&Math.round(e.max)===Math.round(i.max)}function boxEqualsRounded(e,i){return axisEqualsRounded(e.x,i.x)&&axisEqualsRounded(e.y,i.y)}function aspectRatio(e){return calcLength(e.x)/calcLength(e.y)}function axisDeltaEquals(e,i){return e.translate===i.translate&&e.scale===i.scale&&e.originPoint===i.originPoint}class NodeStack{constructor(){this.members=[]}add(i){addUniqueItem(this.members,i),i.scheduleRender()}remove(i){if(removeItem(this.members,i),i===this.prevLead&&(this.prevLead=void 0),i===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(i){const s=this.members.findIndex(_=>i===_);if(s===0)return!1;let a;for(let _=s;_>=0;_--){const et=this.members[_];if(et.isPresent!==!1){a=et;break}}return a?(this.promote(a),!0):!1}promote(i,s){const a=this.lead;if(i!==a&&(this.prevLead=a,this.lead=i,i.show(),a)){a.instance&&a.scheduleRender(),i.scheduleRender(),i.resumeFrom=a,s&&(i.resumeFrom.preserveOpacity=!0),a.snapshot&&(i.snapshot=a.snapshot,i.snapshot.latestValues=a.animationValues||a.latestValues),i.root&&i.root.isUpdating&&(i.isLayoutDirty=!0);const{crossfade:_}=i.options;_===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(i=>{const{options:s,resumingFrom:a}=i;s.onExitComplete&&s.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(i=>{i.instance&&i.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function buildProjectionTransform(e,i,s){let a="";const _=e.x.translate/i.x,et=e.y.translate/i.y,nt=(s==null?void 0:s.z)||0;if((_||et||nt)&&(a=`translate3d(${_}px, ${et}px, ${nt}px) `),(i.x!==1||i.y!==1)&&(a+=`scale(${1/i.x}, ${1/i.y}) `),s){const{transformPerspective:dt,rotate:gt,rotateX:Tt,rotateY:Et,skewX:At,skewY:Mt}=s;dt&&(a=`perspective(${dt}px) ${a}`),gt&&(a+=`rotate(${gt}deg) `),Tt&&(a+=`rotateX(${Tt}deg) `),Et&&(a+=`rotateY(${Et}deg) `),At&&(a+=`skewX(${At}deg) `),Mt&&(a+=`skewY(${Mt}deg) `)}const c=e.x.scale*i.x,ct=e.y.scale*i.y;return(c!==1||ct!==1)&&(a+=`scale(${c}, ${ct})`),a||"none"}const transformAxes=["","X","Y","Z"],animationTarget=1e3;let id=0;function resetDistortingTransform(e,i,s,a){const{latestValues:_}=i;_[e]&&(s[e]=_[e],i.setStaticValue(e,0),a&&(a[e]=0))}function cancelTreeOptimisedTransformAnimations(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:i}=e.options;if(!i)return;const s=getOptimisedAppearId(i);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:_,layoutId:et}=e.options;window.MotionCancelOptimisedAnimation(s,"transform",frame,!(_||et))}const{parent:a}=e;a&&!a.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(a)}function createProjectionNode({attachResizeListener:e,defaultParent:i,measureScroll:s,checkIsScrollRoot:a,resetTransform:_}){return class{constructor(nt={},c=i==null?void 0:i()){this.id=id++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(propagateDirtyNodes),this.nodes.forEach(resolveTargetDelta),this.nodes.forEach(calcProjection),this.nodes.forEach(cleanDirtyNodes)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=nt,this.root=c?c.root||c:this,this.path=c?[...c.path,c]:[],this.parent=c,this.depth=c?c.depth+1:0;for(let ct=0;ct<this.path.length;ct++)this.path[ct].shouldResetTransform=!0;this.root===this&&(this.nodes=new FlatTree)}addEventListener(nt,c){return this.eventHandlers.has(nt)||this.eventHandlers.set(nt,new SubscriptionManager),this.eventHandlers.get(nt).add(c)}notifyListeners(nt,...c){const ct=this.eventHandlers.get(nt);ct&&ct.notify(...c)}hasListeners(nt){return this.eventHandlers.has(nt)}mount(nt){if(this.instance)return;this.isSVG=isSVGElement(nt)&&!isSVGSVGElement(nt),this.instance=nt;const{layoutId:c,layout:ct,visualElement:dt}=this.options;if(dt&&!dt.current&&dt.mount(nt),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(ct||c)&&(this.isLayoutDirty=!0),e){let gt,Tt=0;const Et=()=>this.root.updateBlockedByResize=!1;frame.read(()=>{Tt=window.innerWidth}),e(nt,()=>{const At=window.innerWidth;At!==Tt&&(Tt=At,this.root.updateBlockedByResize=!0,gt&&gt(),gt=delay(Et,250),globalProjectionState.hasAnimatedSinceResize&&(globalProjectionState.hasAnimatedSinceResize=!1,this.nodes.forEach(finishAnimation)))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&dt&&(c||ct)&&this.addEventListener("didUpdate",({delta:gt,hasLayoutChanged:Tt,hasRelativeLayoutChanged:Et,layout:At})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const Mt=this.options.transition||dt.getDefaultTransition()||defaultLayoutTransition,{onLayoutAnimationStart:Pt,onLayoutAnimationComplete:$t}=dt.getProps(),Lt=!this.targetLayout||!boxEqualsRounded(this.targetLayout,At),Bt=!Tt&&Et;if(this.options.layoutRoot||this.resumeFrom||Bt||Tt&&(Lt||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const Nt={...getValueTransition(Mt,"layout"),onPlay:Pt,onComplete:$t};(dt.shouldReduceMotion||this.options.layoutRoot)&&(Nt.delay=0,Nt.type=!1),this.startAnimation(Nt),this.setAnimationOrigin(gt,Bt)}else Tt||finishAnimation(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=At})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const nt=this.getStack();nt&&nt.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),cancelFrame(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(resetSkewAndRotation),this.animationId++)}getTransformTemplate(){const{visualElement:nt}=this.options;return nt&&nt.getProps().transformTemplate}willUpdate(nt=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let gt=0;gt<this.path.length;gt++){const Tt=this.path[gt];Tt.shouldResetTransform=!0,Tt.updateScroll("snapshot"),Tt.options.layoutRoot&&Tt.willUpdate(!1)}const{layoutId:c,layout:ct}=this.options;if(c===void 0&&!ct)return;const dt=this.getTransformTemplate();this.prevTransformTemplateValue=dt?dt(this.latestValues,""):void 0,this.updateSnapshot(),nt&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(clearMeasurements);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(clearIsLayoutDirty);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(resetTransformStyle),this.nodes.forEach(updateLayout),this.nodes.forEach(notifyLayoutUpdate)):this.nodes.forEach(clearIsLayoutDirty),this.clearAllSnapshots();const c=time.now();frameData.delta=clamp$1(0,1e3/60,c-frameData.timestamp),frameData.timestamp=c,frameData.isProcessing=!0,frameSteps.update.process(frameData),frameSteps.preRender.process(frameData),frameSteps.render.process(frameData),frameData.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,microtask.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(clearSnapshot),this.sharedNodes.forEach(removeLeadSnapshots)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,frame.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){frame.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!calcLength(this.snapshot.measuredBox.x)&&!calcLength(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let ct=0;ct<this.path.length;ct++)this.path[ct].updateScroll();const nt=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=createBox(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:c}=this.options;c&&c.notify("LayoutMeasure",this.layout.layoutBox,nt?nt.layoutBox:void 0)}updateScroll(nt="measure"){let c=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===nt&&(c=!1),c&&this.instance){const ct=a(this.instance);this.scroll={animationId:this.root.animationId,phase:nt,isRoot:ct,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:ct}}}resetTransform(){if(!_)return;const nt=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,c=this.projectionDelta&&!isDeltaZero(this.projectionDelta),ct=this.getTransformTemplate(),dt=ct?ct(this.latestValues,""):void 0,gt=dt!==this.prevTransformTemplateValue;nt&&this.instance&&(c||hasTransform(this.latestValues)||gt)&&(_(this.instance,dt),this.shouldResetTransform=!1,this.scheduleRender())}measure(nt=!0){const c=this.measurePageBox();let ct=this.removeElementScroll(c);return nt&&(ct=this.removeTransform(ct)),roundBox(ct),{animationId:this.root.animationId,measuredBox:c,layoutBox:ct,latestValues:{},source:this.id}}measurePageBox(){var dt;const{visualElement:nt}=this.options;if(!nt)return createBox();const c=nt.measureViewportBox();if(!(((dt=this.scroll)==null?void 0:dt.wasRoot)||this.path.some(checkNodeWasScrollRoot))){const{scroll:gt}=this.root;gt&&(translateAxis(c.x,gt.offset.x),translateAxis(c.y,gt.offset.y))}return c}removeElementScroll(nt){var ct;const c=createBox();if(copyBoxInto(c,nt),(ct=this.scroll)!=null&&ct.wasRoot)return c;for(let dt=0;dt<this.path.length;dt++){const gt=this.path[dt],{scroll:Tt,options:Et}=gt;gt!==this.root&&Tt&&Et.layoutScroll&&(Tt.wasRoot&&copyBoxInto(c,nt),translateAxis(c.x,Tt.offset.x),translateAxis(c.y,Tt.offset.y))}return c}applyTransform(nt,c=!1){const ct=createBox();copyBoxInto(ct,nt);for(let dt=0;dt<this.path.length;dt++){const gt=this.path[dt];!c&&gt.options.layoutScroll&&gt.scroll&&gt!==gt.root&&transformBox(ct,{x:-gt.scroll.offset.x,y:-gt.scroll.offset.y}),hasTransform(gt.latestValues)&&transformBox(ct,gt.latestValues)}return hasTransform(this.latestValues)&&transformBox(ct,this.latestValues),ct}removeTransform(nt){const c=createBox();copyBoxInto(c,nt);for(let ct=0;ct<this.path.length;ct++){const dt=this.path[ct];if(!dt.instance||!hasTransform(dt.latestValues))continue;hasScale(dt.latestValues)&&dt.updateSnapshot();const gt=createBox(),Tt=dt.measurePageBox();copyBoxInto(gt,Tt),removeBoxTransforms(c,dt.latestValues,dt.snapshot?dt.snapshot.layoutBox:void 0,gt)}return hasTransform(this.latestValues)&&removeBoxTransforms(c,this.latestValues),c}setTargetDelta(nt){this.targetDelta=nt,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(nt){this.options={...this.options,...nt,crossfade:nt.crossfade!==void 0?nt.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==frameData.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(nt=!1){var At;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const ct=!!this.resumingFrom||this!==c;if(!(nt||ct&&this.isSharedProjectionDirty||this.isProjectionDirty||(At=this.parent)!=null&&At.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:gt,layoutId:Tt}=this.options;if(!this.layout||!(gt||Tt))return;this.resolvedRelativeTargetAt=frameData.timestamp;const Et=this.getClosestProjectingParent();Et&&this.linkedParentVersion!==Et.layoutVersion&&!Et.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(Et&&Et.layout?this.createRelativeTarget(Et,this.layout.layoutBox,Et.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=createBox(),this.targetWithTransforms=createBox()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),calcRelativeBox(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):copyBoxInto(this.target,this.layout.layoutBox),applyBoxDelta(this.target,this.targetDelta)):copyBoxInto(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,Et&&!!Et.resumingFrom==!!this.resumingFrom&&!Et.options.layoutScroll&&Et.target&&this.animationProgress!==1?this.createRelativeTarget(Et,this.target,Et.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||hasScale(this.parent.latestValues)||has2DTranslate(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(nt,c,ct){this.relativeParent=nt,this.linkedParentVersion=nt.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,c,ct),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var Mt;const nt=this.getLead(),c=!!this.resumingFrom||this!==nt;let ct=!0;if((this.isProjectionDirty||(Mt=this.parent)!=null&&Mt.isProjectionDirty)&&(ct=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(ct=!1),this.resolvedRelativeTargetAt===frameData.timestamp&&(ct=!1),ct)return;const{layout:dt,layoutId:gt}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(dt||gt))return;copyBoxInto(this.layoutCorrected,this.layout.layoutBox);const Tt=this.treeScale.x,Et=this.treeScale.y;applyTreeDeltas(this.layoutCorrected,this.treeScale,this.path,c),nt.layout&&!nt.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(nt.target=nt.layout.layoutBox,nt.targetWithTransforms=createBox());const{target:At}=nt;if(!At){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(copyAxisDeltaInto(this.prevProjectionDelta.x,this.projectionDelta.x),copyAxisDeltaInto(this.prevProjectionDelta.y,this.projectionDelta.y)),calcBoxDelta(this.projectionDelta,this.layoutCorrected,At,this.latestValues),(this.treeScale.x!==Tt||this.treeScale.y!==Et||!axisDeltaEquals(this.projectionDelta.x,this.prevProjectionDelta.x)||!axisDeltaEquals(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",At))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(nt=!0){var c;if((c=this.options.visualElement)==null||c.scheduleRender(),nt){const ct=this.getStack();ct&&ct.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=createDelta(),this.projectionDelta=createDelta(),this.projectionDeltaWithTransform=createDelta()}setAnimationOrigin(nt,c=!1){const ct=this.snapshot,dt=ct?ct.latestValues:{},gt={...this.latestValues},Tt=createDelta();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!c;const Et=createBox(),At=ct?ct.source:void 0,Mt=this.layout?this.layout.source:void 0,Pt=At!==Mt,$t=this.getStack(),Lt=!$t||$t.members.length<=1,Bt=!!(Pt&&!Lt&&this.options.crossfade===!0&&!this.path.some(hasOpacityCrossfade));this.animationProgress=0;let Nt;this.mixTargetDelta=Vt=>{const Xt=Vt/1e3;mixAxisDelta(Tt.x,nt.x,Xt),mixAxisDelta(Tt.y,nt.y,Xt),this.setTargetDelta(Tt),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(calcRelativePosition(Et,this.layout.layoutBox,this.relativeParent.layout.layoutBox),mixBox(this.relativeTarget,this.relativeTargetOrigin,Et,Xt),Nt&&boxEquals(this.relativeTarget,Nt)&&(this.isProjectionDirty=!1),Nt||(Nt=createBox()),copyBoxInto(Nt,this.relativeTarget)),Pt&&(this.animationValues=gt,mixValues(gt,dt,this.latestValues,Xt,Bt,Lt)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Xt},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(nt){var c,ct,dt;this.notifyListeners("animationStart"),(c=this.currentAnimation)==null||c.stop(),(dt=(ct=this.resumingFrom)==null?void 0:ct.currentAnimation)==null||dt.stop(),this.pendingAnimation&&(cancelFrame(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=frame.update(()=>{globalProjectionState.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=motionValue(0)),this.currentAnimation=animateSingleValue(this.motionValue,[0,1e3],{...nt,velocity:0,isSync:!0,onUpdate:gt=>{this.mixTargetDelta(gt),nt.onUpdate&&nt.onUpdate(gt)},onStop:()=>{},onComplete:()=>{nt.onComplete&&nt.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const nt=this.getStack();nt&&nt.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(animationTarget),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const nt=this.getLead();let{targetWithTransforms:c,target:ct,layout:dt,latestValues:gt}=nt;if(!(!c||!ct||!dt)){if(this!==nt&&this.layout&&dt&&shouldAnimatePositionOnly(this.options.animationType,this.layout.layoutBox,dt.layoutBox)){ct=this.target||createBox();const Tt=calcLength(this.layout.layoutBox.x);ct.x.min=nt.target.x.min,ct.x.max=ct.x.min+Tt;const Et=calcLength(this.layout.layoutBox.y);ct.y.min=nt.target.y.min,ct.y.max=ct.y.min+Et}copyBoxInto(c,ct),transformBox(c,gt),calcBoxDelta(this.projectionDeltaWithTransform,this.layoutCorrected,c,gt)}}registerSharedNode(nt,c){this.sharedNodes.has(nt)||this.sharedNodes.set(nt,new NodeStack),this.sharedNodes.get(nt).add(c);const dt=c.options.initialPromotionConfig;c.promote({transition:dt?dt.transition:void 0,preserveFollowOpacity:dt&&dt.shouldPreserveFollowOpacity?dt.shouldPreserveFollowOpacity(c):void 0})}isLead(){const nt=this.getStack();return nt?nt.lead===this:!0}getLead(){var c;const{layoutId:nt}=this.options;return nt?((c=this.getStack())==null?void 0:c.lead)||this:this}getPrevLead(){var c;const{layoutId:nt}=this.options;return nt?(c=this.getStack())==null?void 0:c.prevLead:void 0}getStack(){const{layoutId:nt}=this.options;if(nt)return this.root.sharedNodes.get(nt)}promote({needsReset:nt,transition:c,preserveFollowOpacity:ct}={}){const dt=this.getStack();dt&&dt.promote(this,ct),nt&&(this.projectionDelta=void 0,this.needsReset=!0),c&&this.setOptions({transition:c})}relegate(){const nt=this.getStack();return nt?nt.relegate(this):!1}resetSkewAndRotation(){const{visualElement:nt}=this.options;if(!nt)return;let c=!1;const{latestValues:ct}=nt;if((ct.z||ct.rotate||ct.rotateX||ct.rotateY||ct.rotateZ||ct.skewX||ct.skewY)&&(c=!0),!c)return;const dt={};ct.z&&resetDistortingTransform("z",nt,dt,this.animationValues);for(let gt=0;gt<transformAxes.length;gt++)resetDistortingTransform(`rotate${transformAxes[gt]}`,nt,dt,this.animationValues),resetDistortingTransform(`skew${transformAxes[gt]}`,nt,dt,this.animationValues);nt.render();for(const gt in dt)nt.setStaticValue(gt,dt[gt]),this.animationValues&&(this.animationValues[gt]=dt[gt]);nt.scheduleRender()}applyProjectionStyles(nt,c){if(!this.instance||this.isSVG)return;if(!this.isVisible){nt.visibility="hidden";return}const ct=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,nt.visibility="",nt.opacity="",nt.pointerEvents=resolveMotionValue(c==null?void 0:c.pointerEvents)||"",nt.transform=ct?ct(this.latestValues,""):"none";return}const dt=this.getLead();if(!this.projectionDelta||!this.layout||!dt.target){this.options.layoutId&&(nt.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,nt.pointerEvents=resolveMotionValue(c==null?void 0:c.pointerEvents)||""),this.hasProjected&&!hasTransform(this.latestValues)&&(nt.transform=ct?ct({},""):"none",this.hasProjected=!1);return}nt.visibility="";const gt=dt.animationValues||dt.latestValues;this.applyTransformsToTarget();let Tt=buildProjectionTransform(this.projectionDeltaWithTransform,this.treeScale,gt);ct&&(Tt=ct(gt,Tt)),nt.transform=Tt;const{x:Et,y:At}=this.projectionDelta;nt.transformOrigin=`${Et.origin*100}% ${At.origin*100}% 0`,dt.animationValues?nt.opacity=dt===this?gt.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:gt.opacityExit:nt.opacity=dt===this?gt.opacity!==void 0?gt.opacity:"":gt.opacityExit!==void 0?gt.opacityExit:0;for(const Mt in scaleCorrectors){if(gt[Mt]===void 0)continue;const{correct:Pt,applyTo:$t,isCSSVariable:Lt}=scaleCorrectors[Mt],Bt=Tt==="none"?gt[Mt]:Pt(gt[Mt],dt);if($t){const Nt=$t.length;for(let Vt=0;Vt<Nt;Vt++)nt[$t[Vt]]=Bt}else Lt?this.options.visualElement.renderState.vars[Mt]=Bt:nt[Mt]=Bt}this.options.layoutId&&(nt.pointerEvents=dt===this?resolveMotionValue(c==null?void 0:c.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(nt=>{var c;return(c=nt.currentAnimation)==null?void 0:c.stop()}),this.root.nodes.forEach(clearMeasurements),this.root.sharedNodes.clear()}}}function updateLayout(e){e.updateLayout()}function notifyLayoutUpdate(e){var s;const i=((s=e.resumeFrom)==null?void 0:s.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&i&&e.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:_}=e.layout,{animationType:et}=e.options,nt=i.source!==e.layout.source;et==="size"?eachAxis(Tt=>{const Et=nt?i.measuredBox[Tt]:i.layoutBox[Tt],At=calcLength(Et);Et.min=a[Tt].min,Et.max=Et.min+At}):shouldAnimatePositionOnly(et,i.layoutBox,a)&&eachAxis(Tt=>{const Et=nt?i.measuredBox[Tt]:i.layoutBox[Tt],At=calcLength(a[Tt]);Et.max=Et.min+At,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[Tt].max=e.relativeTarget[Tt].min+At)});const c=createDelta();calcBoxDelta(c,a,i.layoutBox);const ct=createDelta();nt?calcBoxDelta(ct,e.applyTransform(_,!0),i.measuredBox):calcBoxDelta(ct,a,i.layoutBox);const dt=!isDeltaZero(c);let gt=!1;if(!e.resumeFrom){const Tt=e.getClosestProjectingParent();if(Tt&&!Tt.resumeFrom){const{snapshot:Et,layout:At}=Tt;if(Et&&At){const Mt=createBox();calcRelativePosition(Mt,i.layoutBox,Et.layoutBox);const Pt=createBox();calcRelativePosition(Pt,a,At.layoutBox),boxEqualsRounded(Mt,Pt)||(gt=!0),Tt.options.layoutRoot&&(e.relativeTarget=Pt,e.relativeTargetOrigin=Mt,e.relativeParent=Tt)}}}e.notifyListeners("didUpdate",{layout:a,snapshot:i,delta:ct,layoutDelta:c,hasLayoutChanged:dt,hasRelativeLayoutChanged:gt})}else if(e.isLead()){const{onExitComplete:a}=e.options;a&&a()}e.options.transition=void 0}function propagateDirtyNodes(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function cleanDirtyNodes(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function clearSnapshot(e){e.clearSnapshot()}function clearMeasurements(e){e.clearMeasurements()}function clearIsLayoutDirty(e){e.isLayoutDirty=!1}function resetTransformStyle(e){const{visualElement:i}=e.options;i&&i.getProps().onBeforeLayoutMeasure&&i.notify("BeforeLayoutMeasure"),e.resetTransform()}function finishAnimation(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function resolveTargetDelta(e){e.resolveTargetDelta()}function calcProjection(e){e.calcProjection()}function resetSkewAndRotation(e){e.resetSkewAndRotation()}function removeLeadSnapshots(e){e.removeLeadSnapshot()}function mixAxisDelta(e,i,s){e.translate=mixNumber$1(i.translate,0,s),e.scale=mixNumber$1(i.scale,1,s),e.origin=i.origin,e.originPoint=i.originPoint}function mixAxis(e,i,s,a){e.min=mixNumber$1(i.min,s.min,a),e.max=mixNumber$1(i.max,s.max,a)}function mixBox(e,i,s,a){mixAxis(e.x,i.x,s.x,a),mixAxis(e.y,i.y,s.y,a)}function hasOpacityCrossfade(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const defaultLayoutTransition={duration:.45,ease:[.4,0,.1,1]},userAgentContains=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),roundPoint=userAgentContains("applewebkit/")&&!userAgentContains("chrome/")?Math.round:noop;function roundAxis(e){e.min=roundPoint(e.min),e.max=roundPoint(e.max)}function roundBox(e){roundAxis(e.x),roundAxis(e.y)}function shouldAnimatePositionOnly(e,i,s){return e==="position"||e==="preserve-aspect"&&!isNear(aspectRatio(i),aspectRatio(s),.2)}function checkNodeWasScrollRoot(e){var i;return e!==e.root&&((i=e.scroll)==null?void 0:i.wasRoot)}const DocumentProjectionNode=createProjectionNode({attachResizeListener:(e,i)=>addDomEvent(e,"resize",i),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),rootProjectionNode={current:void 0},HTMLProjectionNode=createProjectionNode({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!rootProjectionNode.current){const e=new DocumentProjectionNode({});e.mount(window),e.setOptions({layoutScroll:!0}),rootProjectionNode.current=e}return rootProjectionNode.current},resetTransform:(e,i)=>{e.style.transform=i!==void 0?i:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),drag={pan:{Feature:PanGesture},drag:{Feature:DragGesture,ProjectionNode:HTMLProjectionNode,MeasureLayout}};function handleHoverEvent(e,i,s){const{props:a}=e;e.animationState&&a.whileHover&&e.animationState.setActive("whileHover",s==="Start");const _="onHover"+s,et=a[_];et&&frame.postRender(()=>et(i,extractEventInfo(i)))}class HoverGesture extends Feature$1{mount(){const{current:i}=this.node;i&&(this.unmount=hover(i,(s,a)=>(handleHoverEvent(this.node,a,"Start"),_=>handleHoverEvent(this.node,_,"End"))))}unmount(){}}class FocusGesture extends Feature$1{constructor(){super(...arguments),this.isActive=!1}onFocus(){let i=!1;try{i=this.node.current.matches(":focus-visible")}catch{i=!0}!i||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=pipe(addDomEvent(this.node.current,"focus",()=>this.onFocus()),addDomEvent(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function handlePressEvent(e,i,s){const{props:a}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&a.whileTap&&e.animationState.setActive("whileTap",s==="Start");const _="onTap"+(s==="End"?"":s),et=a[_];et&&frame.postRender(()=>et(i,extractEventInfo(i)))}class PressGesture extends Feature$1{mount(){const{current:i}=this.node;i&&(this.unmount=press(i,(s,a)=>(handlePressEvent(this.node,a,"Start"),(_,{success:et})=>handlePressEvent(this.node,_,et?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const observerCallbacks=new WeakMap,observers=new WeakMap,fireObserverCallback=e=>{const i=observerCallbacks.get(e.target);i&&i(e)},fireAllObserverCallbacks=e=>{e.forEach(fireObserverCallback)};function initIntersectionObserver({root:e,...i}){const s=e||document;observers.has(s)||observers.set(s,{});const a=observers.get(s),_=JSON.stringify(i);return a[_]||(a[_]=new IntersectionObserver(fireAllObserverCallbacks,{root:e,...i})),a[_]}function observeIntersection(e,i,s){const a=initIntersectionObserver(i);return observerCallbacks.set(e,s),a.observe(e),()=>{observerCallbacks.delete(e),a.unobserve(e)}}const thresholdNames={some:0,all:1};class InViewFeature extends Feature$1{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:i={}}=this.node.getProps(),{root:s,margin:a,amount:_="some",once:et}=i,nt={root:s?s.current:void 0,rootMargin:a,threshold:typeof _=="number"?_:thresholdNames[_]},c=ct=>{const{isIntersecting:dt}=ct;if(this.isInView===dt||(this.isInView=dt,et&&!dt&&this.hasEnteredView))return;dt&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",dt);const{onViewportEnter:gt,onViewportLeave:Tt}=this.node.getProps(),Et=dt?gt:Tt;Et&&Et(ct)};return observeIntersection(this.node.current,nt,c)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:i,prevProps:s}=this.node;["amount","margin","root"].some(hasViewportOptionChanged(i,s))&&this.startObserver()}unmount(){}}function hasViewportOptionChanged({viewport:e={}},{viewport:i={}}={}){return s=>e[s]!==i[s]}const gestureAnimations={inView:{Feature:InViewFeature},tap:{Feature:PressGesture},focus:{Feature:FocusGesture},hover:{Feature:HoverGesture}},layout={layout:{ProjectionNode:HTMLProjectionNode,MeasureLayout}},featureBundle={...animations,...gestureAnimations,...drag,...layout},motion=createMotionProxy(featureBundle,createDomVisualElement);function stopAnimation(e){e.values.forEach(i=>i.stop())}function setVariants(e,i){[...i].reverse().forEach(a=>{const _=e.getVariant(a);_&&setTarget(e,_),e.variantChildren&&e.variantChildren.forEach(et=>{setVariants(et,i)})})}function setValues(e,i){if(Array.isArray(i))return setVariants(e,i);if(typeof i=="string")return setVariants(e,[i]);setTarget(e,i)}function animationControls(){let e=!1;const i=new Set,s={subscribe(a){return i.add(a),()=>void i.delete(a)},start(a,_){invariant(e,"controls.start() should only be called after a component has mounted. Consider calling within a useEffect hook.");const et=[];return i.forEach(nt=>{et.push(animateVisualElement(nt,a,{transitionOverride:_}))}),Promise.all(et)},set(a){return invariant(e,"controls.set() should only be called after a component has mounted. Consider calling within a useEffect hook."),i.forEach(_=>{setValues(_,a)})},stop(){i.forEach(a=>{stopAnimation(a)})},mount(){return e=!0,()=>{e=!1,s.stop()}}};return s}function useAnimationControls(){const e=useConstant(animationControls);return useIsomorphicLayoutEffect$1(e.mount,[]),e}const useAnimation=useAnimationControls;var build={exports:{}};(()=>{var e={296:(_,et,nt)=>{var c=/^\s+|\s+$/g,ct=/^[-+]0x[0-9a-f]+$/i,dt=/^0b[01]+$/i,gt=/^0o[0-7]+$/i,Tt=parseInt,Et=typeof nt.g=="object"&&nt.g&&nt.g.Object===Object&&nt.g,At=typeof self=="object"&&self&&self.Object===Object&&self,Mt=Et||At||Function("return this")(),Pt=Object.prototype.toString,$t=Math.max,Lt=Math.min,Bt=function(){return Mt.Date.now()};function Nt(Xt){var nr=typeof Xt;return!!Xt&&(nr=="object"||nr=="function")}function Vt(Xt){if(typeof Xt=="number")return Xt;if(function(mr){return typeof mr=="symbol"||function(Fr){return!!Fr&&typeof Fr=="object"}(mr)&&Pt.call(mr)=="[object Symbol]"}(Xt))return NaN;if(Nt(Xt)){var nr=typeof Xt.valueOf=="function"?Xt.valueOf():Xt;Xt=Nt(nr)?nr+"":nr}if(typeof Xt!="string")return Xt===0?Xt:+Xt;Xt=Xt.replace(c,"");var ar=dt.test(Xt);return ar||gt.test(Xt)?Tt(Xt.slice(2),ar?2:8):ct.test(Xt)?NaN:+Xt}_.exports=function(Xt,nr,ar){var mr,Fr,sn,fn,Lr,Qr,dn=0,en=!1,yr=!1,Ar=!0;if(typeof Xt!="function")throw new TypeError("Expected a function");function rr(tn){var vn=mr,hs=Fr;return mr=Fr=void 0,dn=tn,fn=Xt.apply(hs,vn)}function ur(tn){var vn=tn-Qr;return Qr===void 0||vn>=nr||vn<0||yr&&tn-dn>=sn}function Br(){var tn=Bt();if(ur(tn))return xr(tn);Lr=setTimeout(Br,function(vn){var hs=nr-(vn-Qr);return yr?Lt(hs,sn-(vn-dn)):hs}(tn))}function xr(tn){return Lr=void 0,Ar&&mr?rr(tn):(mr=Fr=void 0,fn)}function qr(){var tn=Bt(),vn=ur(tn);if(mr=arguments,Fr=this,Qr=tn,vn){if(Lr===void 0)return function(hs){return dn=hs,Lr=setTimeout(Br,nr),en?rr(hs):fn}(Qr);if(yr)return Lr=setTimeout(Br,nr),rr(Qr)}return Lr===void 0&&(Lr=setTimeout(Br,nr)),fn}return nr=Vt(nr)||0,Nt(ar)&&(en=!!ar.leading,sn=(yr="maxWait"in ar)?$t(Vt(ar.maxWait)||0,nr):sn,Ar="trailing"in ar?!!ar.trailing:Ar),qr.cancel=function(){Lr!==void 0&&clearTimeout(Lr),dn=0,mr=Qr=Fr=Lr=void 0},qr.flush=function(){return Lr===void 0?fn:xr(Bt())},qr}},96:(_,et,nt)=>{var c="Expected a function",ct=NaN,dt="[object Symbol]",gt=/^\s+|\s+$/g,Tt=/^[-+]0x[0-9a-f]+$/i,Et=/^0b[01]+$/i,At=/^0o[0-7]+$/i,Mt=parseInt,Pt=typeof nt.g=="object"&&nt.g&&nt.g.Object===Object&&nt.g,$t=typeof self=="object"&&self&&self.Object===Object&&self,Lt=Pt||$t||Function("return this")(),Bt=Object.prototype.toString,Nt=Math.max,Vt=Math.min,Xt=function(){return Lt.Date.now()};function nr(mr){var Fr=typeof mr;return!!mr&&(Fr=="object"||Fr=="function")}function ar(mr){if(typeof mr=="number")return mr;if(function(fn){return typeof fn=="symbol"||function(Lr){return!!Lr&&typeof Lr=="object"}(fn)&&Bt.call(fn)==dt}(mr))return ct;if(nr(mr)){var Fr=typeof mr.valueOf=="function"?mr.valueOf():mr;mr=nr(Fr)?Fr+"":Fr}if(typeof mr!="string")return mr===0?mr:+mr;mr=mr.replace(gt,"");var sn=Et.test(mr);return sn||At.test(mr)?Mt(mr.slice(2),sn?2:8):Tt.test(mr)?ct:+mr}_.exports=function(mr,Fr,sn){var fn=!0,Lr=!0;if(typeof mr!="function")throw new TypeError(c);return nr(sn)&&(fn="leading"in sn?!!sn.leading:fn,Lr="trailing"in sn?!!sn.trailing:Lr),function(Qr,dn,en){var yr,Ar,rr,ur,Br,xr,qr=0,tn=!1,vn=!1,hs=!0;if(typeof Qr!="function")throw new TypeError(c);function Ts(ys){var Hs=yr,_s=Ar;return yr=Ar=void 0,qr=ys,ur=Qr.apply(_s,Hs)}function ss(ys){var Hs=ys-xr;return xr===void 0||Hs>=dn||Hs<0||vn&&ys-qr>=rr}function Mn(){var ys=Xt();if(ss(ys))return ds(ys);Br=setTimeout(Mn,function(Hs){var _s=dn-(Hs-xr);return vn?Vt(_s,rr-(Hs-qr)):_s}(ys))}function ds(ys){return Br=void 0,hs&&yr?Ts(ys):(yr=Ar=void 0,ur)}function gs(){var ys=Xt(),Hs=ss(ys);if(yr=arguments,Ar=this,xr=ys,Hs){if(Br===void 0)return function(_s){return qr=_s,Br=setTimeout(Mn,dn),tn?Ts(_s):ur}(xr);if(vn)return Br=setTimeout(Mn,dn),Ts(xr)}return Br===void 0&&(Br=setTimeout(Mn,dn)),ur}return dn=ar(dn)||0,nr(en)&&(tn=!!en.leading,rr=(vn="maxWait"in en)?Nt(ar(en.maxWait)||0,dn):rr,hs="trailing"in en?!!en.trailing:hs),gs.cancel=function(){Br!==void 0&&clearTimeout(Br),qr=0,yr=xr=Ar=Br=void 0},gs.flush=function(){return Br===void 0?ur:ds(Xt())},gs}(mr,Fr,{leading:fn,maxWait:Fr,trailing:Lr})}},703:(_,et,nt)=>{var c=nt(414);function ct(){}function dt(){}dt.resetWarningCache=ct,_.exports=function(){function gt(At,Mt,Pt,$t,Lt,Bt){if(Bt!==c){var Nt=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw Nt.name="Invariant Violation",Nt}}function Tt(){return gt}gt.isRequired=gt;var Et={array:gt,bigint:gt,bool:gt,func:gt,number:gt,object:gt,string:gt,symbol:gt,any:gt,arrayOf:Tt,element:gt,elementType:gt,instanceOf:Tt,node:gt,objectOf:Tt,oneOf:Tt,oneOfType:Tt,shape:Tt,exact:Tt,checkPropTypes:dt,resetWarningCache:ct};return Et.PropTypes=Et,Et}},697:(_,et,nt)=>{_.exports=nt(703)()},414:_=>{_.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}},i={};function s(_){var et=i[_];if(et!==void 0)return et.exports;var nt=i[_]={exports:{}};return e[_](nt,nt.exports,s),nt.exports}s.n=_=>{var et=_&&_.__esModule?()=>_.default:()=>_;return s.d(et,{a:et}),et},s.d=(_,et)=>{for(var nt in et)s.o(et,nt)&&!s.o(_,nt)&&Object.defineProperty(_,nt,{enumerable:!0,get:et[nt]})},s.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),s.o=(_,et)=>Object.prototype.hasOwnProperty.call(_,et),s.r=_=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(_,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(_,"__esModule",{value:!0})};var a={};(()=>{s.r(a),s.d(a,{LazyLoadComponent:()=>Hs,LazyLoadImage:()=>xl,trackWindowScroll:()=>ur});const _=reactExports;var et=s.n(_),nt=s(697);function c(){return typeof window<"u"&&"IntersectionObserver"in window&&"isIntersecting"in window.IntersectionObserverEntry.prototype}function ct(Yn){return ct=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(xn){return typeof xn}:function(xn){return xn&&typeof Symbol=="function"&&xn.constructor===Symbol&&xn!==Symbol.prototype?"symbol":typeof xn},ct(Yn)}function dt(Yn,xn){var Qn=Object.keys(Yn);if(Object.getOwnPropertySymbols){var os=Object.getOwnPropertySymbols(Yn);xn&&(os=os.filter(function(Ks){return Object.getOwnPropertyDescriptor(Yn,Ks).enumerable})),Qn.push.apply(Qn,os)}return Qn}function gt(Yn,xn,Qn){return(xn=Et(xn))in Yn?Object.defineProperty(Yn,xn,{value:Qn,enumerable:!0,configurable:!0,writable:!0}):Yn[xn]=Qn,Yn}function Tt(Yn,xn){for(var Qn=0;Qn<xn.length;Qn++){var os=xn[Qn];os.enumerable=os.enumerable||!1,os.configurable=!0,"value"in os&&(os.writable=!0),Object.defineProperty(Yn,Et(os.key),os)}}function Et(Yn){var xn=function(Qn,os){if(ct(Qn)!=="object"||Qn===null)return Qn;var Ks=Qn[Symbol.toPrimitive];if(Ks!==void 0){var oo=Ks.call(Qn,"string");if(ct(oo)!=="object")return oo;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(Qn)}(Yn);return ct(xn)==="symbol"?xn:String(xn)}function At(Yn,xn){return At=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Qn,os){return Qn.__proto__=os,Qn},At(Yn,xn)}function Mt(Yn){return Mt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(xn){return xn.__proto__||Object.getPrototypeOf(xn)},Mt(Yn)}var Pt=function(Yn){Yn.forEach(function(xn){xn.isIntersecting&&xn.target.onVisible()})},$t={},Lt=function(Yn){(function(zn,Xn){if(typeof Xn!="function"&&Xn!==null)throw new TypeError("Super expression must either be null or a function");zn.prototype=Object.create(Xn&&Xn.prototype,{constructor:{value:zn,writable:!0,configurable:!0}}),Object.defineProperty(zn,"prototype",{writable:!1}),Xn&&At(zn,Xn)})(qo,Yn);var xn,Qn,os,Ks,oo=(os=qo,Ks=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}(),function(){var zn,Xn=Mt(os);if(Ks){var xs=Mt(this).constructor;zn=Reflect.construct(Xn,arguments,xs)}else zn=Xn.apply(this,arguments);return function(As,ks){if(ks&&(ct(ks)==="object"||typeof ks=="function"))return ks;if(ks!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(Eo){if(Eo===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Eo}(As)}(this,zn)});function qo(zn){var Xn;if(function(As,ks){if(!(As instanceof ks))throw new TypeError("Cannot call a class as a function")}(this,qo),(Xn=oo.call(this,zn)).supportsObserver=!zn.scrollPosition&&zn.useIntersectionObserver&&c(),Xn.supportsObserver){var xs=zn.threshold;Xn.observer=function(As){return $t[As]=$t[As]||new IntersectionObserver(Pt,{rootMargin:As+"px"}),$t[As]}(xs)}return Xn}return xn=qo,Qn=[{key:"componentDidMount",value:function(){this.placeholder&&this.observer&&(this.placeholder.onVisible=this.props.onVisible,this.observer.observe(this.placeholder)),this.supportsObserver||this.updateVisibility()}},{key:"componentWillUnmount",value:function(){this.observer&&this.placeholder&&this.observer.unobserve(this.placeholder)}},{key:"componentDidUpdate",value:function(){this.supportsObserver||this.updateVisibility()}},{key:"getPlaceholderBoundingBox",value:function(){var zn=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.props.scrollPosition,Xn=this.placeholder.getBoundingClientRect(),xs=this.placeholder.style,As=parseInt(xs.getPropertyValue("margin-left"),10)||0,ks=parseInt(xs.getPropertyValue("margin-top"),10)||0;return{bottom:zn.y+Xn.bottom+ks,left:zn.x+Xn.left+As,right:zn.x+Xn.right+As,top:zn.y+Xn.top+ks}}},{key:"isPlaceholderInViewport",value:function(){if(typeof window>"u"||!this.placeholder)return!1;var zn=this.props,Xn=zn.scrollPosition,xs=zn.threshold,As=this.getPlaceholderBoundingBox(Xn),ks=Xn.y+window.innerHeight,Eo=Xn.x,Jo=Xn.x+window.innerWidth,na=Xn.y;return na-xs<=As.bottom&&ks+xs>=As.top&&Eo-xs<=As.right&&Jo+xs>=As.left}},{key:"updateVisibility",value:function(){this.isPlaceholderInViewport()&&this.props.onVisible()}},{key:"render",value:function(){var zn=this,Xn=this.props,xs=Xn.className,As=Xn.height,ks=Xn.placeholder,Eo=Xn.style,Jo=Xn.width;if(ks&&typeof ks.type!="function")return et().cloneElement(ks,{ref:function(Go){return zn.placeholder=Go}});var na=function(Go){for(var _c=1;_c<arguments.length;_c++){var Il=arguments[_c]!=null?arguments[_c]:{};_c%2?dt(Object(Il),!0).forEach(function(Zs){gt(Go,Zs,Il[Zs])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Go,Object.getOwnPropertyDescriptors(Il)):dt(Object(Il)).forEach(function(Zs){Object.defineProperty(Go,Zs,Object.getOwnPropertyDescriptor(Il,Zs))})}return Go}({display:"inline-block"},Eo);return Jo!==void 0&&(na.width=Jo),As!==void 0&&(na.height=As),et().createElement("span",{className:xs,ref:function(Go){return zn.placeholder=Go},style:na},ks)}}],Qn&&Tt(xn.prototype,Qn),Object.defineProperty(xn,"prototype",{writable:!1}),qo}(et().Component);Lt.propTypes={onVisible:nt.PropTypes.func.isRequired,className:nt.PropTypes.string,height:nt.PropTypes.oneOfType([nt.PropTypes.number,nt.PropTypes.string]),placeholder:nt.PropTypes.element,threshold:nt.PropTypes.number,useIntersectionObserver:nt.PropTypes.bool,scrollPosition:nt.PropTypes.shape({x:nt.PropTypes.number.isRequired,y:nt.PropTypes.number.isRequired}),width:nt.PropTypes.oneOfType([nt.PropTypes.number,nt.PropTypes.string])},Lt.defaultProps={className:"",placeholder:null,threshold:100,useIntersectionObserver:!0};const Bt=Lt;var Nt=s(296),Vt=s.n(Nt),Xt=s(96),nr=s.n(Xt),ar=function(Yn){var xn=getComputedStyle(Yn,null);return xn.getPropertyValue("overflow")+xn.getPropertyValue("overflow-y")+xn.getPropertyValue("overflow-x")};const mr=function(Yn){if(!(Yn instanceof HTMLElement))return window;for(var xn=Yn;xn&&xn instanceof HTMLElement;){if(/(scroll|auto)/.test(ar(xn)))return xn;xn=xn.parentNode}return window};function Fr(Yn){return Fr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(xn){return typeof xn}:function(xn){return xn&&typeof Symbol=="function"&&xn.constructor===Symbol&&xn!==Symbol.prototype?"symbol":typeof xn},Fr(Yn)}var sn=["delayMethod","delayTime"];function fn(){return fn=Object.assign?Object.assign.bind():function(Yn){for(var xn=1;xn<arguments.length;xn++){var Qn=arguments[xn];for(var os in Qn)Object.prototype.hasOwnProperty.call(Qn,os)&&(Yn[os]=Qn[os])}return Yn},fn.apply(this,arguments)}function Lr(Yn,xn){for(var Qn=0;Qn<xn.length;Qn++){var os=xn[Qn];os.enumerable=os.enumerable||!1,os.configurable=!0,"value"in os&&(os.writable=!0),Object.defineProperty(Yn,(Ks=function(oo,qo){if(Fr(oo)!=="object"||oo===null)return oo;var zn=oo[Symbol.toPrimitive];if(zn!==void 0){var Xn=zn.call(oo,"string");if(Fr(Xn)!=="object")return Xn;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(oo)}(os.key),Fr(Ks)==="symbol"?Ks:String(Ks)),os)}var Ks}function Qr(Yn,xn){return Qr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Qn,os){return Qn.__proto__=os,Qn},Qr(Yn,xn)}function dn(Yn,xn){if(xn&&(Fr(xn)==="object"||typeof xn=="function"))return xn;if(xn!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return en(Yn)}function en(Yn){if(Yn===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Yn}function yr(Yn){return yr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(xn){return xn.__proto__||Object.getPrototypeOf(xn)},yr(Yn)}var Ar=function(){return typeof window>"u"?0:window.scrollX||window.pageXOffset},rr=function(){return typeof window>"u"?0:window.scrollY||window.pageYOffset};const ur=function(Yn){var xn=function(Qn){(function(xs,As){if(typeof As!="function"&&As!==null)throw new TypeError("Super expression must either be null or a function");xs.prototype=Object.create(As&&As.prototype,{constructor:{value:xs,writable:!0,configurable:!0}}),Object.defineProperty(xs,"prototype",{writable:!1}),As&&Qr(xs,As)})(Xn,Qn);var os,Ks,oo,qo,zn=(oo=Xn,qo=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}(),function(){var xs,As=yr(oo);if(qo){var ks=yr(this).constructor;xs=Reflect.construct(As,arguments,ks)}else xs=As.apply(this,arguments);return dn(this,xs)});function Xn(xs){var As;if(function(Eo,Jo){if(!(Eo instanceof Jo))throw new TypeError("Cannot call a class as a function")}(this,Xn),(As=zn.call(this,xs)).useIntersectionObserver=xs.useIntersectionObserver&&c(),As.useIntersectionObserver)return dn(As);var ks=As.onChangeScroll.bind(en(As));return xs.delayMethod==="debounce"?As.delayedScroll=Vt()(ks,xs.delayTime):xs.delayMethod==="throttle"&&(As.delayedScroll=nr()(ks,xs.delayTime)),As.state={scrollPosition:{x:Ar(),y:rr()}},As.baseComponentRef=et().createRef(),As}return os=Xn,(Ks=[{key:"componentDidMount",value:function(){this.addListeners()}},{key:"componentWillUnmount",value:function(){this.removeListeners()}},{key:"componentDidUpdate",value:function(){typeof window>"u"||this.useIntersectionObserver||mr(this.baseComponentRef.current)!==this.scrollElement&&(this.removeListeners(),this.addListeners())}},{key:"addListeners",value:function(){typeof window>"u"||this.useIntersectionObserver||(this.scrollElement=mr(this.baseComponentRef.current),this.scrollElement.addEventListener("scroll",this.delayedScroll,{passive:!0}),window.addEventListener("resize",this.delayedScroll,{passive:!0}),this.scrollElement!==window&&window.addEventListener("scroll",this.delayedScroll,{passive:!0}))}},{key:"removeListeners",value:function(){typeof window>"u"||this.useIntersectionObserver||(this.scrollElement.removeEventListener("scroll",this.delayedScroll),window.removeEventListener("resize",this.delayedScroll),this.scrollElement!==window&&window.removeEventListener("scroll",this.delayedScroll))}},{key:"onChangeScroll",value:function(){this.useIntersectionObserver||this.setState({scrollPosition:{x:Ar(),y:rr()}})}},{key:"render",value:function(){var xs=this.props,As=(xs.delayMethod,xs.delayTime,function(Eo,Jo){if(Eo==null)return{};var na,Go,_c=function(Zs,$l){if(Zs==null)return{};var io,zo,Ko={},vu=Object.keys(Zs);for(zo=0;zo<vu.length;zo++)io=vu[zo],$l.indexOf(io)>=0||(Ko[io]=Zs[io]);return Ko}(Eo,Jo);if(Object.getOwnPropertySymbols){var Il=Object.getOwnPropertySymbols(Eo);for(Go=0;Go<Il.length;Go++)na=Il[Go],Jo.indexOf(na)>=0||Object.prototype.propertyIsEnumerable.call(Eo,na)&&(_c[na]=Eo[na])}return _c}(xs,sn)),ks=this.useIntersectionObserver?null:this.state.scrollPosition;return et().createElement(Yn,fn({forwardRef:this.baseComponentRef,scrollPosition:ks},As))}}])&&Lr(os.prototype,Ks),Object.defineProperty(os,"prototype",{writable:!1}),Xn}(et().Component);return xn.propTypes={delayMethod:nt.PropTypes.oneOf(["debounce","throttle"]),delayTime:nt.PropTypes.number,useIntersectionObserver:nt.PropTypes.bool},xn.defaultProps={delayMethod:"throttle",delayTime:300,useIntersectionObserver:!0},xn};function Br(Yn){return Br=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(xn){return typeof xn}:function(xn){return xn&&typeof Symbol=="function"&&xn.constructor===Symbol&&xn!==Symbol.prototype?"symbol":typeof xn},Br(Yn)}function xr(Yn,xn){for(var Qn=0;Qn<xn.length;Qn++){var os=xn[Qn];os.enumerable=os.enumerable||!1,os.configurable=!0,"value"in os&&(os.writable=!0),Object.defineProperty(Yn,(Ks=function(oo,qo){if(Br(oo)!=="object"||oo===null)return oo;var zn=oo[Symbol.toPrimitive];if(zn!==void 0){var Xn=zn.call(oo,"string");if(Br(Xn)!=="object")return Xn;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(oo)}(os.key),Br(Ks)==="symbol"?Ks:String(Ks)),os)}var Ks}function qr(Yn,xn){return qr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Qn,os){return Qn.__proto__=os,Qn},qr(Yn,xn)}function tn(Yn){return tn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(xn){return xn.__proto__||Object.getPrototypeOf(xn)},tn(Yn)}var vn=function(Yn){(function(zn,Xn){if(typeof Xn!="function"&&Xn!==null)throw new TypeError("Super expression must either be null or a function");zn.prototype=Object.create(Xn&&Xn.prototype,{constructor:{value:zn,writable:!0,configurable:!0}}),Object.defineProperty(zn,"prototype",{writable:!1}),Xn&&qr(zn,Xn)})(qo,Yn);var xn,Qn,os,Ks,oo=(os=qo,Ks=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}(),function(){var zn,Xn=tn(os);if(Ks){var xs=tn(this).constructor;zn=Reflect.construct(Xn,arguments,xs)}else zn=Xn.apply(this,arguments);return function(As,ks){if(ks&&(Br(ks)==="object"||typeof ks=="function"))return ks;if(ks!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(Eo){if(Eo===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Eo}(As)}(this,zn)});function qo(zn){return function(Xn,xs){if(!(Xn instanceof xs))throw new TypeError("Cannot call a class as a function")}(this,qo),oo.call(this,zn)}return xn=qo,(Qn=[{key:"render",value:function(){return et().createElement(Bt,this.props)}}])&&xr(xn.prototype,Qn),Object.defineProperty(xn,"prototype",{writable:!1}),qo}(et().Component);const hs=ur(vn);function Ts(Yn){return Ts=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(xn){return typeof xn}:function(xn){return xn&&typeof Symbol=="function"&&xn.constructor===Symbol&&xn!==Symbol.prototype?"symbol":typeof xn},Ts(Yn)}function ss(Yn,xn){for(var Qn=0;Qn<xn.length;Qn++){var os=xn[Qn];os.enumerable=os.enumerable||!1,os.configurable=!0,"value"in os&&(os.writable=!0),Object.defineProperty(Yn,(Ks=function(oo,qo){if(Ts(oo)!=="object"||oo===null)return oo;var zn=oo[Symbol.toPrimitive];if(zn!==void 0){var Xn=zn.call(oo,"string");if(Ts(Xn)!=="object")return Xn;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(oo)}(os.key),Ts(Ks)==="symbol"?Ks:String(Ks)),os)}var Ks}function Mn(Yn,xn){return Mn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Qn,os){return Qn.__proto__=os,Qn},Mn(Yn,xn)}function ds(Yn){if(Yn===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Yn}function gs(Yn){return gs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(xn){return xn.__proto__||Object.getPrototypeOf(xn)},gs(Yn)}var ys=function(Yn){(function(zn,Xn){if(typeof Xn!="function"&&Xn!==null)throw new TypeError("Super expression must either be null or a function");zn.prototype=Object.create(Xn&&Xn.prototype,{constructor:{value:zn,writable:!0,configurable:!0}}),Object.defineProperty(zn,"prototype",{writable:!1}),Xn&&Mn(zn,Xn)})(qo,Yn);var xn,Qn,os,Ks,oo=(os=qo,Ks=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}(),function(){var zn,Xn=gs(os);if(Ks){var xs=gs(this).constructor;zn=Reflect.construct(Xn,arguments,xs)}else zn=Xn.apply(this,arguments);return function(As,ks){if(ks&&(Ts(ks)==="object"||typeof ks=="function"))return ks;if(ks!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ds(As)}(this,zn)});function qo(zn){var Xn;(function(Jo,na){if(!(Jo instanceof na))throw new TypeError("Cannot call a class as a function")})(this,qo),Xn=oo.call(this,zn);var xs=zn.afterLoad,As=zn.beforeLoad,ks=zn.scrollPosition,Eo=zn.visibleByDefault;return Xn.state={visible:Eo},Eo&&(As(),xs()),Xn.onVisible=Xn.onVisible.bind(ds(Xn)),Xn.isScrollTracked=!!(ks&&Number.isFinite(ks.x)&&ks.x>=0&&Number.isFinite(ks.y)&&ks.y>=0),Xn}return xn=qo,(Qn=[{key:"componentDidUpdate",value:function(zn,Xn){Xn.visible!==this.state.visible&&this.props.afterLoad()}},{key:"onVisible",value:function(){this.props.beforeLoad(),this.setState({visible:!0})}},{key:"render",value:function(){if(this.state.visible)return this.props.children;var zn=this.props,Xn=zn.className,xs=zn.delayMethod,As=zn.delayTime,ks=zn.height,Eo=zn.placeholder,Jo=zn.scrollPosition,na=zn.style,Go=zn.threshold,_c=zn.useIntersectionObserver,Il=zn.width;return this.isScrollTracked||_c&&c()?et().createElement(Bt,{className:Xn,height:ks,onVisible:this.onVisible,placeholder:Eo,scrollPosition:Jo,style:na,threshold:Go,useIntersectionObserver:_c,width:Il}):et().createElement(hs,{className:Xn,delayMethod:xs,delayTime:As,height:ks,onVisible:this.onVisible,placeholder:Eo,style:na,threshold:Go,width:Il})}}])&&ss(xn.prototype,Qn),Object.defineProperty(xn,"prototype",{writable:!1}),qo}(et().Component);ys.propTypes={afterLoad:nt.PropTypes.func,beforeLoad:nt.PropTypes.func,useIntersectionObserver:nt.PropTypes.bool,visibleByDefault:nt.PropTypes.bool},ys.defaultProps={afterLoad:function(){return{}},beforeLoad:function(){return{}},useIntersectionObserver:!0,visibleByDefault:!1};const Hs=ys;function _s(Yn){return _s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(xn){return typeof xn}:function(xn){return xn&&typeof Symbol=="function"&&xn.constructor===Symbol&&xn!==Symbol.prototype?"symbol":typeof xn},_s(Yn)}var Ss=["afterLoad","beforeLoad","delayMethod","delayTime","effect","placeholder","placeholderSrc","scrollPosition","threshold","useIntersectionObserver","visibleByDefault","wrapperClassName","wrapperProps"];function Vl(Yn,xn){var Qn=Object.keys(Yn);if(Object.getOwnPropertySymbols){var os=Object.getOwnPropertySymbols(Yn);xn&&(os=os.filter(function(Ks){return Object.getOwnPropertyDescriptor(Yn,Ks).enumerable})),Qn.push.apply(Qn,os)}return Qn}function ba(Yn){for(var xn=1;xn<arguments.length;xn++){var Qn=arguments[xn]!=null?arguments[xn]:{};xn%2?Vl(Object(Qn),!0).forEach(function(os){Qo(Yn,os,Qn[os])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Yn,Object.getOwnPropertyDescriptors(Qn)):Vl(Object(Qn)).forEach(function(os){Object.defineProperty(Yn,os,Object.getOwnPropertyDescriptor(Qn,os))})}return Yn}function Qo(Yn,xn,Qn){return(xn=uu(xn))in Yn?Object.defineProperty(Yn,xn,{value:Qn,enumerable:!0,configurable:!0,writable:!0}):Yn[xn]=Qn,Yn}function wo(){return wo=Object.assign?Object.assign.bind():function(Yn){for(var xn=1;xn<arguments.length;xn++){var Qn=arguments[xn];for(var os in Qn)Object.prototype.hasOwnProperty.call(Qn,os)&&(Yn[os]=Qn[os])}return Yn},wo.apply(this,arguments)}function cu(Yn,xn){for(var Qn=0;Qn<xn.length;Qn++){var os=xn[Qn];os.enumerable=os.enumerable||!1,os.configurable=!0,"value"in os&&(os.writable=!0),Object.defineProperty(Yn,uu(os.key),os)}}function uu(Yn){var xn=function(Qn,os){if(_s(Qn)!=="object"||Qn===null)return Qn;var Ks=Qn[Symbol.toPrimitive];if(Ks!==void 0){var oo=Ks.call(Qn,"string");if(_s(oo)!=="object")return oo;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(Qn)}(Yn);return _s(xn)==="symbol"?xn:String(xn)}function Pl(Yn,xn){return Pl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Qn,os){return Qn.__proto__=os,Qn},Pl(Yn,xn)}function Jl(Yn){return Jl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(xn){return xn.__proto__||Object.getPrototypeOf(xn)},Jl(Yn)}var Ul=function(Yn){(function(zn,Xn){if(typeof Xn!="function"&&Xn!==null)throw new TypeError("Super expression must either be null or a function");zn.prototype=Object.create(Xn&&Xn.prototype,{constructor:{value:zn,writable:!0,configurable:!0}}),Object.defineProperty(zn,"prototype",{writable:!1}),Xn&&Pl(zn,Xn)})(qo,Yn);var xn,Qn,os,Ks,oo=(os=qo,Ks=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}(),function(){var zn,Xn=Jl(os);if(Ks){var xs=Jl(this).constructor;zn=Reflect.construct(Xn,arguments,xs)}else zn=Xn.apply(this,arguments);return function(As,ks){if(ks&&(_s(ks)==="object"||typeof ks=="function"))return ks;if(ks!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(Eo){if(Eo===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Eo}(As)}(this,zn)});function qo(zn){var Xn;return function(xs,As){if(!(xs instanceof As))throw new TypeError("Cannot call a class as a function")}(this,qo),(Xn=oo.call(this,zn)).state={loaded:!1},Xn}return xn=qo,(Qn=[{key:"onImageLoad",value:function(){var zn=this;return this.state.loaded?null:function(Xn){zn.props.onLoad(Xn),zn.props.afterLoad(),zn.setState({loaded:!0})}}},{key:"getImg",value:function(){var zn=this.props,Xn=(zn.afterLoad,zn.beforeLoad,zn.delayMethod,zn.delayTime,zn.effect,zn.placeholder,zn.placeholderSrc,zn.scrollPosition,zn.threshold,zn.useIntersectionObserver,zn.visibleByDefault,zn.wrapperClassName,zn.wrapperProps,function(xs,As){if(xs==null)return{};var ks,Eo,Jo=function(Go,_c){if(Go==null)return{};var Il,Zs,$l={},io=Object.keys(Go);for(Zs=0;Zs<io.length;Zs++)Il=io[Zs],_c.indexOf(Il)>=0||($l[Il]=Go[Il]);return $l}(xs,As);if(Object.getOwnPropertySymbols){var na=Object.getOwnPropertySymbols(xs);for(Eo=0;Eo<na.length;Eo++)ks=na[Eo],As.indexOf(ks)>=0||Object.prototype.propertyIsEnumerable.call(xs,ks)&&(Jo[ks]=xs[ks])}return Jo}(zn,Ss));return et().createElement("img",wo({},Xn,{onLoad:this.onImageLoad()}))}},{key:"getLazyLoadImage",value:function(){var zn=this.props,Xn=zn.beforeLoad,xs=zn.className,As=zn.delayMethod,ks=zn.delayTime,Eo=zn.height,Jo=zn.placeholder,na=zn.scrollPosition,Go=zn.style,_c=zn.threshold,Il=zn.useIntersectionObserver,Zs=zn.visibleByDefault,$l=zn.width;return et().createElement(Hs,{beforeLoad:Xn,className:xs,delayMethod:As,delayTime:ks,height:Eo,placeholder:Jo,scrollPosition:na,style:Go,threshold:_c,useIntersectionObserver:Il,visibleByDefault:Zs,width:$l},this.getImg())}},{key:"getWrappedLazyLoadImage",value:function(zn){var Xn=this.props,xs=Xn.effect,As=Xn.height,ks=Xn.placeholderSrc,Eo=Xn.width,Jo=Xn.wrapperClassName,na=Xn.wrapperProps,Go=this.state.loaded,_c=Go?" lazy-load-image-loaded":"",Il=Go||!ks?{}:{backgroundImage:"url(".concat(ks,")"),backgroundSize:"100% 100%"};return et().createElement("span",wo({className:Jo+" lazy-load-image-background "+xs+_c,style:ba(ba({},Il),{},{color:"transparent",display:"inline-block",height:As,width:Eo})},na),zn)}},{key:"render",value:function(){var zn=this.props,Xn=zn.effect,xs=zn.placeholderSrc,As=zn.visibleByDefault,ks=zn.wrapperClassName,Eo=zn.wrapperProps,Jo=this.getLazyLoadImage();return(Xn||xs)&&!As||ks||Eo?this.getWrappedLazyLoadImage(Jo):Jo}}])&&cu(xn.prototype,Qn),Object.defineProperty(xn,"prototype",{writable:!1}),qo}(et().Component);Ul.propTypes={onLoad:nt.PropTypes.func,afterLoad:nt.PropTypes.func,beforeLoad:nt.PropTypes.func,delayMethod:nt.PropTypes.string,delayTime:nt.PropTypes.number,effect:nt.PropTypes.string,placeholderSrc:nt.PropTypes.string,threshold:nt.PropTypes.number,useIntersectionObserver:nt.PropTypes.bool,visibleByDefault:nt.PropTypes.bool,wrapperClassName:nt.PropTypes.string,wrapperProps:nt.PropTypes.object},Ul.defaultProps={onLoad:function(){},afterLoad:function(){return{}},beforeLoad:function(){return{}},delayMethod:"throttle",delayTime:300,effect:"",placeholderSrc:null,threshold:100,useIntersectionObserver:!0,visibleByDefault:!1,wrapperClassName:""};const xl=Ul})(),build.exports=a})();var buildExports=build.exports;function Skeleton$1({className:e,...i}){return jsxRuntimeExports.jsx("div",{className:cn("animate-pulse rounded-md bg-muted",e),...i})}function CachedImage({className:e,alt:i,...s}){return jsxRuntimeExports.jsx(buildExports.LazyLoadImage,{alt:i,effect:"blur",wrapperClassName:cn("w-full h-full",e),className:cn("w-full h-full object-cover",e),placeholder:jsxRuntimeExports.jsx(Skeleton$1,{className:"w-full h-full"}),...s})}function KitchenCard({kitchen:e,index:i=0}){const{userLocation:s}=useLocationContext(),a=s&&e.address.lat&&e.address.lng?calculateDistance(s.lat,s.lng,e.address.lat,e.address.lng):e.address.city;return jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:i*.1,duration:.3},children:jsxRuntimeExports.jsx(Link,{to:`/kitchen/${e.id}`,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl overflow-hidden shadow-card hover:shadow-elevated transition-shadow duration-300",children:[jsxRuntimeExports.jsxs("div",{className:"relative h-36 overflow-hidden",children:[jsxRuntimeExports.jsx(CachedImage,{src:e.image,alt:e.name,className:cn("object-cover transition-all duration-300",!e.isOpen&&"opacity-60 grayscale")}),jsxRuntimeExports.jsx("div",{className:cn("absolute top-3 right-3 px-2.5 py-1 rounded-full text-xs font-semibold",e.isOpen?"bg-accent text-accent-foreground":"bg-muted text-muted-foreground"),children:e.isOpen?"Cooking Today":" Kitchen is closed"}),e.isVeg&&jsxRuntimeExports.jsx("div",{className:"absolute top-3 left-3 p-1.5 rounded-full bg-veg",children:jsxRuntimeExports.jsx(Leaf,{className:"w-3 h-3 text-white"})})]}),jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground text-base mb-1 truncate",children:e.name}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground text-sm mb-3 line-clamp-1",children:e.specialties.slice(0,3).join("  ")}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center gap-1",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 rounded-md bg-gold-soft",children:[jsxRuntimeExports.jsx(Star,{className:"w-3.5 h-3.5 text-gold fill-gold"}),jsxRuntimeExports.jsx("span",{className:"font-semibold text-foreground",children:e.rating.toFixed(1)})]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[jsxRuntimeExports.jsx(Clock,{className:"w-3.5 h-3.5"}),jsxRuntimeExports.jsx("span",{children:e.cookingTime})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-3.5 h-3.5"}),jsxRuntimeExports.jsx("span",{className:"truncate max-w-[80px]",children:a})]})]})]})]})})})}function useNotifications(e){const[i,s]=reactExports.useState([]),[a,_]=reactExports.useState(!0);return reactExports.useEffect(()=>{if(!e){_(!1);return}const et=ref(database,"notifications"),nt=onValue(et,c=>{const ct=c.val();if(ct){const dt=Object.entries(ct).map(([gt,Tt])=>({...Tt,id:gt})).filter(gt=>gt.userId===e).sort((gt,Tt)=>Tt.createdAt-gt.createdAt);s(dt)}else s([]);_(!1)});return()=>nt()},[e]),{notifications:i,loading:a}}function useKitchens(){return useDataContext()}function useKitchen(e){const[i,s]=reactExports.useState(null),[a,_]=reactExports.useState(!0),[et,nt]=reactExports.useState(null);return reactExports.useEffect(()=>{if(!e){_(!1);return}const c=ref(database,`kitchens/${e}`),ct=onValue(c,dt=>{try{const gt=dt.val();s(gt?{...gt,id:e}:null),_(!1)}catch{nt("Failed to fetch kitchen"),_(!1)}});return()=>ct()},[e]),{kitchen:i,loading:a,error:et}}function useDishes(e){const[i,s]=reactExports.useState([]),[a,_]=reactExports.useState(!0),[et,nt]=reactExports.useState(null);return reactExports.useEffect(()=>{if(!e){_(!1);return}const c=ref(database,"dishes"),ct=onValue(c,dt=>{try{const gt=dt.val();if(gt){const Tt=Object.entries(gt).map(([Et,At])=>({...At,id:Et})).filter(Et=>Et.kitchenId===e);s(Tt)}else s([]);_(!1)}catch{nt("Failed to fetch dishes"),_(!1)}});return()=>ct()},[e]),{dishes:i,loading:a,error:et}}function useUserOrders(e){const[i,s]=reactExports.useState([]),[a,_]=reactExports.useState(!0),[et,nt]=reactExports.useState(null);return reactExports.useEffect(()=>{if(!e){_(!1);return}const c=ref(database,"orders"),ct=onValue(c,dt=>{try{const gt=dt.val();if(gt){const Tt=Object.entries(gt).map(([Et,At])=>({...At,id:Et})).filter(Et=>Et.userId===e).sort((Et,At)=>At.createdAt-Et.createdAt);s(Tt)}else s([]);_(!1)}catch{nt("Failed to fetch orders"),_(!1)}});return()=>ct()},[e]),{orders:i,loading:a,error:et}}async function createKitchen(e){const i=ref(database,"kitchens"),s=push(i);return await set(s,e),s.key}async function updateKitchen(e,i){const s=ref(database,`kitchens/${e}`);await update(s,i)}async function createDish(e){const i=ref(database,"dishes"),s=push(i);return await set(s,e),s.key}async function deleteDish(e){const i=ref(database,`dishes/${e}`);await remove(i)}async function createOrder(e){const i=ref(database,"orders"),s=push(i);return await set(s,e),s.key}async function createNotification(e){const i=ref(database,"notifications"),s=push(i);return await set(s,e),s.key}async function markNotificationAsRead(e){const i=ref(database,`notifications/${e}`);await update(i,{read:!0})}async function updateOrderStatus(e,i){const s=ref(database,`orders/${e}`);await update(s,{status:i,updatedAt:Date.now()});try{const a=await get(s);if(a.exists()){const _=a.val();let et=`Your order status has been updated to ${i}`,nt="Order Update";switch(i){case"accepted":et=`Yay! ${_.kitchenName} has accepted your order.`;break;case"cooking":et=`${_.kitchenName} is now preparing your delicious food.`;break;case"packed":et="Your order is packed and ready!";break;case"out_for_delivery":et="Your order is on the way!";break;case"delivered":et="Order delivered via Amma Cheythi Vanta. Enjoy your meal!";break;case"cancelled":et="Your order has been cancelled.",nt="Order Cancelled";break}i!=="pending"&&await createNotification({userId:_.userId,title:nt,message:et,type:"order",link:"/orders",read:!1,createdAt:Date.now()})}}catch(a){console.error("Failed to send notification",a)}}async function createCoupon(e){const i=ref(database,"coupons"),s=push(i);return await set(s,e),s.key}async function updateCoupon(e,i){const s=ref(database,`coupons/${e}`);await update(s,i)}async function deleteCoupon(e){const i=ref(database,`coupons/${e}`);await remove(i)}async function getCouponByCode(e){const i=ref(database,"coupons"),s=await get(i);if(s.exists()){const a=s.val();for(const[_,et]of Object.entries(a)){const nt=et;if(nt.code.toUpperCase()===e.toUpperCase())return{...nt,id:_}}}return null}function useKitchenCoupons(e){const[i,s]=reactExports.useState([]),[a,_]=reactExports.useState(!0);return reactExports.useEffect(()=>{if(!e){_(!1);return}const et=ref(database,"coupons"),nt=onValue(et,c=>{const ct=c.val();if(ct){const dt=Object.entries(ct).map(([gt,Tt])=>({...Tt,id:gt})).filter(gt=>gt.kitchenId===e);s(dt)}else s([]);_(!1)});return()=>nt()},[e]),{coupons:i,loading:a}}async function submitReview(e){const i=ref(database,"reviews"),s=push(i);await set(s,e);const a=ref(database,`orders/${e.orderId}`);await update(a,{isReviewed:!0});const _=ref(database,`kitchens/${e.kitchenId}`),et=await get(_);if(et.exists()){const nt=et.val(),c=nt.rating||0,ct=nt.totalRatings||0,dt=ct+1,gt=(c*ct+e.kitchenRating)/dt;await update(_,{rating:gt,totalRatings:dt})}if(e.itemRatings){const nt=[];for(const[c,ct]of Object.entries(e.itemRatings)){const dt=ref(database,`dishes/${c}`);nt.push(get(dt).then(gt=>{if(gt.exists()){const Tt=gt.val(),Et=Tt.rating||0,At=Tt.totalRatings||0,Mt=At+1,Pt=(Et*At+ct)/Mt;return update(dt,{rating:Pt,totalRatings:Mt})}}))}await Promise.all(nt)}return s.key}const buttonVariants=cva("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Button=reactExports.forwardRef(({className:e,variant:i,size:s,asChild:a=!1,..._},et)=>{const nt=a?Slot$2:"button";return jsxRuntimeExports.jsx(nt,{className:cn(buttonVariants({variant:i,size:s,className:e})),ref:et,..._})});Button.displayName="Button";function BottomNav(){const e=useLocation(),{getItemCount:i}=useCart(),s=i(),a=[{icon:House,label:"Home",path:"/"},{icon:Search,label:"Search",path:"/search"},{icon:ChefHat,label:"Cart",path:"/cart",count:s},{icon:ShoppingBag,label:"Orders",path:"/orders"},{icon:User,label:"Profile",path:"/profile"}];return jsxRuntimeExports.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 pointer-events-none safe-bottom",children:jsxRuntimeExports.jsx("nav",{className:"pointer-events-auto mx-4 mb-4 bg-background/80 backdrop-blur-lg border border-white/20 shadow-elevated rounded-2xl overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between px-2 py-2 max-w-lg mx-auto relative",children:a.map(_=>{const et=e.pathname===_.path,nt=_.icon;return jsxRuntimeExports.jsx(Link,{to:_.path,className:"relative flex-1 group",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-2",children:[et&&jsxRuntimeExports.jsx(motion.div,{layoutId:"navBubble",className:"absolute inset-x-2 inset-y-1 bg-primary/15 rounded-xl -z-10",transition:{type:"spring",bounce:.2,duration:.6}}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(motion.div,{animate:{scale:et?1.2:1,y:et?-2:0},transition:{type:"spring",stiffness:400,damping:10},children:jsxRuntimeExports.jsx(nt,{className:cn("w-5 h-5 transition-all duration-300",et?"text-primary fill-primary/20":"text-muted-foreground group-hover:text-foreground"),strokeWidth:et?2.5:2})}),_.count!==void 0&&_.count>0&&jsxRuntimeExports.jsx(motion.span,{initial:{scale:0},animate:{scale:1},className:"absolute -top-2 -right-2 w-4 h-4 rounded-full bg-destructive text-destructive-foreground text-[10px] font-bold flex items-center justify-center ring-2 ring-background shadow-sm",children:_.count>9?"9+":_.count})]}),jsxRuntimeExports.jsx(motion.span,{initial:!1,animate:{opacity:et?1:.6,scale:et?1:.9,y:et?0:2},className:cn("text-[10px] font-medium mt-1 transition-colors duration-300",et?"text-primary font-bold":"text-muted-foreground"),children:_.label}),et&&jsxRuntimeExports.jsx(motion.div,{layoutId:"navDot",className:"absolute bottom-1 w-1 h-1 rounded-full bg-primary",transition:{type:"spring",bounce:.2,duration:.6}})]})},_.path)})})})})}function OutOfZoneScreen(){const{userLocation:e,refetchLocation:i,locationLoading:s}=useLocationContext();return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-6 text-center",children:[jsxRuntimeExports.jsx(motion.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"w-24 h-24 rounded-full bg-destructive/10 flex items-center justify-center mb-6",children:jsxRuntimeExports.jsx(TriangleAlert,{className:"w-12 h-12 text-destructive"})}),jsxRuntimeExports.jsx(motion.h1,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1},className:"text-2xl font-bold text-foreground mb-3",children:"Service Not Available"}),jsxRuntimeExports.jsx(motion.p,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},className:"text-muted-foreground mb-6 max-w-sm",children:"Sorry, Amma Cheythi Vanta is not yet available in your area. We're expanding soon!"}),e&&jsxRuntimeExports.jsx(motion.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"bg-secondary rounded-xl p-4 mb-6 w-full max-w-sm",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Your location"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-foreground",children:e.address})]})]})}),jsxRuntimeExports.jsx(motion.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},children:jsxRuntimeExports.jsxs(Button,{variant:"outline",onClick:i,disabled:s,className:"gap-2",children:[jsxRuntimeExports.jsx(RefreshCw,{className:`w-4 h-4 ${s?"animate-spin":""}`}),"Refresh Location"]})}),jsxRuntimeExports.jsx(motion.p,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},className:"text-xs text-muted-foreground mt-8",children:"If you think this is an error, please allow location access and try again."})]})}const categories$1=[{id:"biryani",name:"Biryani",image:"https://images.unsplash.com/photo-1563379091339-03b21ab4a4f8?w=400&q=80"},{id:"tiffins",name:"Tiffins",image:"https://images.unsplash.com/photo-1589301760014-d929f3979dbc?w=400&q=80"},{id:"thali",name:"Thali",image:"https://images.unsplash.com/photo-1574484284002-952d92456975?w=400&q=80"},{id:"curries",name:"Curries",image:"https://images.unsplash.com/photo-1545247181-516773cae754?w=400&q=80"},{id:"sweets",name:"Sweets",image:"https://img.freepik.com/premium-photo/indian-festival-assorted-sweet-food-mithai-white-background_466689-64857.jpg"},{id:"snacks",name:"Snacks",image:"https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?w=400&q=80"},{id:"rice",name:"Rice",image:"https://images.unsplash.com/photo-1512058564366-18510be2db19?w=400&q=80"},{id:"pickles",name:"Pickles",image:"https://media.istockphoto.com/id/528476560/photo/mango-pickle.jpg?s=612x612&w=0&k=20&c=1Hi9BzNeMEfKkBOMniMyxWF4mVs8LXrE-qHEu3F_R5M="}];function Categories({onSelectCategory:e,selectedCategory:i}){const s={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}}},a={hidden:{opacity:0,scale:.8},show:{opacity:1,scale:1}};return jsxRuntimeExports.jsxs("div",{className:"w-full",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between mb-3 px-1",children:jsxRuntimeExports.jsx("h3",{className:"font-semibold text-lg",children:"What's on your mind?"})}),jsxRuntimeExports.jsx(motion.div,{variants:s,initial:"hidden",animate:"show",className:"grid grid-cols-4 gap-x-4 gap-y-6",children:categories$1.map(_=>{const et=(i==null?void 0:i.toLowerCase())===_.name.toLowerCase();return jsxRuntimeExports.jsxs(motion.button,{variants:a,whileTap:{scale:.9},onClick:()=>e==null?void 0:e(_.name),className:"flex flex-col items-center gap-2 group w-full",children:[jsxRuntimeExports.jsxs("div",{className:`relative w-full aspect-square rounded-2xl overflow-hidden shadow-sm transition-all duration-300 ${et?"ring-4 ring-[#FFD700] ring-offset-2 ring-offset-background shadow-xl scale-105":"ring-1 ring-border/50 group-hover:ring-primary/50 group-hover:shadow-md"}`,children:[jsxRuntimeExports.jsx("img",{src:_.image,alt:_.name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110",loading:"lazy"}),jsxRuntimeExports.jsx("div",{className:`absolute inset-0 bg-gradient-to-t from-black/40 to-transparent transition-opacity ${et?"opacity-100":"opacity-0 group-hover:opacity-100"}`})]}),jsxRuntimeExports.jsx("span",{className:`text-[11px] sm:text-xs font-medium text-center truncate w-full transition-colors ${et?"text-primary font-bold":"text-foreground/90 group-hover:text-primary"}`,children:_.name})]},_.id)})})]})}function useAmmaKitchens(e){const[i,s]=reactExports.useState([]),[a,_]=reactExports.useState(!0),[et,nt]=reactExports.useState(null);return reactExports.useEffect(()=>{if(!e){_(!1);return}const c=ref(database,"kitchens"),ct=onValue(c,dt=>{try{const gt=dt.val();if(gt){const Tt=Object.entries(gt).map(([Et,At])=>({...At,id:Et})).filter(Et=>Et.ownerId===e);s(Tt)}else s([]);_(!1)}catch{nt("Failed to fetch kitchens"),_(!1)}});return()=>ct()},[e]),{kitchens:i,loading:a,error:et}}function useKitchenOrders(e){const[i,s]=reactExports.useState([]),[a,_]=reactExports.useState(!0),[et,nt]=reactExports.useState(null);return reactExports.useEffect(()=>{if(!e){_(!1);return}const c=ref(database,"orders"),ct=onValue(c,dt=>{try{const gt=dt.val();if(gt){const Tt=Object.entries(gt).map(([Et,At])=>({...At,id:Et})).filter(Et=>Et.kitchenId===e).sort((Et,At)=>At.createdAt-Et.createdAt);s(Tt)}else s([]);_(!1)}catch{nt("Failed to fetch orders"),_(!1)}});return()=>ct()},[e]),{orders:i,loading:a,error:et}}function useAllKitchens(){const[e,i]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[_,et]=reactExports.useState(null);return reactExports.useEffect(()=>{const nt=ref(database,"kitchens"),c=onValue(nt,ct=>{try{const dt=ct.val();if(dt){const gt=Object.entries(dt).map(([Tt,Et])=>({...Et,id:Tt}));i(gt)}else i([]);a(!1)}catch{et("Failed to fetch kitchens"),a(!1)}});return()=>c()},[]),{kitchens:e,loading:s,error:_}}function useAllOrders(){const[e,i]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[_,et]=reactExports.useState(null);return reactExports.useEffect(()=>{const nt=ref(database,"orders"),c=onValue(nt,ct=>{try{const dt=ct.val();if(dt){const gt=Object.entries(dt).map(([Tt,Et])=>({...Et,id:Tt})).sort((Tt,Et)=>Et.createdAt-Tt.createdAt);i(gt)}else i([]);a(!1)}catch{et("Failed to fetch orders"),a(!1)}});return()=>c()},[]),{orders:e,loading:s,error:_}}function useAllUsers(){const[e,i]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[_,et]=reactExports.useState(null);return reactExports.useEffect(()=>{const nt=ref(database,"users"),c=onValue(nt,ct=>{try{const dt=ct.val();if(dt){const gt=Object.entries(dt).map(([Tt,Et])=>({...Et,id:Tt}));i(gt)}else i([]);a(!1)}catch{et("Failed to fetch users"),a(!1)}});return()=>c()},[]),{users:e,loading:s,error:_}}function useAllDishes(){const[e,i]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[_,et]=reactExports.useState(null);return reactExports.useEffect(()=>{const nt=ref(database,"dishes"),c=onValue(nt,ct=>{try{const dt=ct.val();if(dt){const gt=Object.entries(dt).map(([Tt,Et])=>({...Et,id:Tt}));i(gt)}else i([]);a(!1)}catch{et("Failed to fetch dishes"),a(!1)}});return()=>c()},[]),{dishes:e,loading:s,error:_}}async function approveKitchen(e){const i=ref(database,`kitchens/${e}`);await update(i,{isApproved:!0})}async function rejectKitchen(e){const i=ref(database,`kitchens/${e}`);await remove(i)}async function deleteUser(e){const i=ref(database,`users/${e}`);await remove(i)}async function updateUserRole(e,i,s){const a=ref(database,`users/${e}`);if(s&&s!==i){if(s==="amma"){const _=ref(database,"kitchens"),nt=(await new Promise((c,ct)=>{onValue(_,c,{onlyOnce:!0})})).val();if(nt){const c=[];Object.entries(nt).forEach(([ct,dt])=>{dt.ownerId===e&&(c.push(remove(ref(database,`kitchens/${ct}`))),c.push(deleteKitchenDishes(ct)))}),await Promise.all(c)}}if(s==="franchise_admin"){const _=ref(database,"franchises"),nt=(await new Promise((c,ct)=>{onValue(_,c,{onlyOnce:!0})})).val();if(nt){const c=[];Object.entries(nt).forEach(([ct,dt])=>{dt.adminId===e&&c.push(update(ref(database,`franchises/${ct}`),{adminId:"",adminName:"",adminEmail:""}))}),await Promise.all(c)}await update(a,{franchiseId:null})}}await update(a,{role:i})}async function updateDish(e,i){const s=ref(database,`dishes/${e}`);await update(s,i)}async function deleteKitchenDishes(e){const i=ref(database,"dishes"),a=(await new Promise((_,et)=>{onValue(i,_,{onlyOnce:!0})})).val();if(a){const _=[];Object.entries(a).forEach(([et,nt])=>{nt.kitchenId===e&&_.push(remove(ref(database,`dishes/${et}`)))}),await Promise.all(_)}}function DishCard({dish:e,kitchenId:i,kitchenName:s,className:a,variant:_="default"}){const{cart:et,addToCart:nt,updateQuantity:c,removeFromCart:ct}=useCart(),dt=et.items.find(Pt=>Pt.dish.id===e.id),gt=(dt==null?void 0:dt.quantity)||0,Tt=()=>{nt(e,i,s)},Et=()=>{c(e.id,gt+1)},At=()=>{gt<=1?ct(e.id):c(e.id,gt-1)},Mt=jsxRuntimeExports.jsx(AnimatePresence,{mode:"wait",children:gt===0?jsxRuntimeExports.jsx(motion.div,{initial:{scale:.8},animate:{scale:1},exit:{scale:.8},className:_==="compact"?"w-full":"",children:jsxRuntimeExports.jsx(Button,{onClick:Tt,size:"sm",className:cn("gradient-primary text-primary-foreground font-semibold rounded-lg shadow-soft",_==="compact"?"w-full":"px-6"),children:"ADD"})},"add"):jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.8},animate:{scale:1},exit:{scale:.8},className:cn("flex items-center gap-1 bg-primary rounded-lg shadow-soft",_==="compact"?"w-full justify-between":""),children:[jsxRuntimeExports.jsx(Button,{onClick:At,size:"icon",variant:"ghost",className:"h-8 w-8 text-primary-foreground hover:bg-primary/80",children:jsxRuntimeExports.jsx(Minus,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("span",{className:"font-bold text-primary-foreground px-2 min-w-[24px] text-center",children:gt}),jsxRuntimeExports.jsx(Button,{onClick:Et,size:"icon",variant:"ghost",className:"h-8 w-8 text-primary-foreground hover:bg-primary/80",children:jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4"})})]},"quantity")});return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:cn("bg-card rounded-xl shadow-card overflow-hidden",_==="compact"?"flex flex-col-reverse p-0":"flex gap-4 p-4",a),children:[jsxRuntimeExports.jsxs("div",{className:cn("flex-1 min-w-0",_==="compact"?"p-3 pt-0 flex flex-col justify-between":""),children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[jsxRuntimeExports.jsx("div",{className:cn("w-4 h-4 border-2 rounded-sm flex items-center justify-center",e.isVeg?"border-veg":"border-non-veg"),children:jsxRuntimeExports.jsx("div",{className:cn("w-2 h-2 rounded-full",e.isVeg?"bg-veg":"bg-non-veg")})}),jsxRuntimeExports.jsx("span",{className:cn("text-xs font-medium",e.isVeg?"text-veg":"text-non-veg"),children:e.isVeg?"Pure Veg":"Non Veg"})]}),jsxRuntimeExports.jsx("h3",{className:cn("font-semibold text-foreground mb-1 truncate capitalize",_==="compact"?"text-sm":"text-base"),children:e.name}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground text-sm mb-2 line-clamp-2 text-xs",children:e.description}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[jsxRuntimeExports.jsxs("span",{className:"font-bold text-foreground",children:["",e.price]}),e.originalPrice&&e.originalPrice>e.price&&jsxRuntimeExports.jsxs("span",{className:"text-sm text-muted-foreground line-through",children:["",e.originalPrice]})]})]}),_==="compact"&&e.isAvailable&&jsxRuntimeExports.jsx("div",{className:"mt-auto",children:Mt})]}),jsxRuntimeExports.jsxs("div",{className:cn("relative flex-shrink-0",_==="compact"?"w-full h-32 mb-2":""),children:[jsxRuntimeExports.jsx(CachedImage,{src:e.image,alt:e.name,className:cn("object-cover",_==="compact"?"w-full h-full":"w-24 h-24 rounded-xl")}),e.rating&&e.rating>0&&jsxRuntimeExports.jsxs("div",{className:"absolute top-2 right-2 bg-black/60 backdrop-blur-md px-1.5 py-0.5 rounded-md flex items-center gap-1 shadow-sm border border-white/10",children:[jsxRuntimeExports.jsx(Star,{className:"w-3 h-3 fill-gold text-gold"}),jsxRuntimeExports.jsx("span",{className:"text-[10px] font-bold text-white",children:e.rating.toFixed(1)})]}),e.isAvailable?_!=="compact"&&jsxRuntimeExports.jsx("div",{className:"absolute -bottom-3 left-1/2 -translate-x-1/2",children:Mt}):jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-muted/90 text-muted-foreground text-xs text-center py-1",children:"Sold Out"})]})]})}function Skeleton({className:e}){return jsxRuntimeExports.jsx("div",{className:cn("animate-pulse-soft rounded-lg bg-muted",e)})}function CompactDishCardSkeleton(){return jsxRuntimeExports.jsxs("div",{className:"flex flex-col h-full bg-card rounded-xl shadow-card overflow-hidden min-w-[160px] max-w-[160px]",children:[jsxRuntimeExports.jsx(Skeleton,{className:"h-32 w-full rounded-none flex-shrink-0"}),jsxRuntimeExports.jsxs("div",{className:"p-3 flex-1 flex flex-col justify-between gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Skeleton,{className:"h-4 w-3/4"}),jsxRuntimeExports.jsx(Skeleton,{className:"h-3 w-full"})]}),jsxRuntimeExports.jsx(Skeleton,{className:"h-8 w-full rounded-lg"})]})]})}function BestSellingSection(){const{dishes:e,loading:i}=useAllDishes(),{kitchens:s}=useKitchens(),{currentFranchiseId:a}=useLocationContext();if(i)return jsxRuntimeExports.jsxs("div",{className:"py-2",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 mb-3 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Sparkles,{className:"w-5 h-5 text-gold"}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Best Sellers"})]}),jsxRuntimeExports.jsx("div",{className:"flex gap-4 overflow-x-auto px-4 pb-4 hide-scrollbar snap-x snap-mandatory",children:[1,2,3,4].map(nt=>jsxRuntimeExports.jsx("div",{className:"min-w-[160px] max-w-[160px] snap-center",children:jsxRuntimeExports.jsx(CompactDishCardSkeleton,{})},nt))})]});const _=new Map;s.forEach(nt=>{nt.isApproved&&nt.franchiseId===a&&_.set(nt.id,nt)});const et=e.filter(nt=>nt.isBestSeller&&_.has(nt.kitchenId));return et.length===0?null:jsxRuntimeExports.jsxs("div",{className:"py-2",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 mb-3 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Sparkles,{className:"w-5 h-5 text-gold"}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Best Sellers"})]}),jsxRuntimeExports.jsx("div",{className:"flex gap-4 overflow-x-auto px-4 pb-4 hide-scrollbar snap-x snap-mandatory",children:et.map(nt=>{const c=_.get(nt.kitchenId);return jsxRuntimeExports.jsx("div",{className:"min-w-[160px] max-w-[160px] snap-center flex flex-col",children:jsxRuntimeExports.jsx(DishCard,{dish:nt,kitchenId:nt.kitchenId,kitchenName:(c==null?void 0:c.name)||"Unknown Kitchen",className:"h-full",variant:"compact"})},nt.id)})})]})}var lottie$1={exports:{}};(function(module,exports){typeof document<"u"&&typeof navigator<"u"&&function(e,i){module.exports=i()}(commonjsGlobal,function(){var svgNS="http://www.w3.org/2000/svg",locationHref="",_useWebWorker=!1,initialDefaultFrame=-999999,setWebWorker=function(i){_useWebWorker=!!i},getWebWorker=function(){return _useWebWorker},setLocationHref=function(i){locationHref=i},getLocationHref=function(){return locationHref};function createTag(e){return document.createElement(e)}function extendPrototype(e,i){var s,a=e.length,_;for(s=0;s<a;s+=1){_=e[s].prototype;for(var et in _)Object.prototype.hasOwnProperty.call(_,et)&&(i.prototype[et]=_[et])}}function getDescriptor(e,i){return Object.getOwnPropertyDescriptor(e,i)}function createProxyFunction(e){function i(){}return i.prototype=e,i}var audioControllerFactory=function(){function e(i){this.audios=[],this.audioFactory=i,this._volume=1,this._isMuted=!1}return e.prototype={addAudio:function(s){this.audios.push(s)},pause:function(){var s,a=this.audios.length;for(s=0;s<a;s+=1)this.audios[s].pause()},resume:function(){var s,a=this.audios.length;for(s=0;s<a;s+=1)this.audios[s].resume()},setRate:function(s){var a,_=this.audios.length;for(a=0;a<_;a+=1)this.audios[a].setRate(s)},createAudio:function(s){return this.audioFactory?this.audioFactory(s):window.Howl?new window.Howl({src:[s]}):{isPlaying:!1,play:function(){this.isPlaying=!0},seek:function(){this.isPlaying=!1},playing:function(){},rate:function(){},setVolume:function(){}}},setAudioFactory:function(s){this.audioFactory=s},setVolume:function(s){this._volume=s,this._updateVolume()},mute:function(){this._isMuted=!0,this._updateVolume()},unmute:function(){this._isMuted=!1,this._updateVolume()},getVolume:function(){return this._volume},_updateVolume:function(){var s,a=this.audios.length;for(s=0;s<a;s+=1)this.audios[s].volume(this._volume*(this._isMuted?0:1))}},function(){return new e}}(),createTypedArray=function(){function e(s,a){var _=0,et=[],nt;switch(s){case"int16":case"uint8c":nt=1;break;default:nt=1.1;break}for(_=0;_<a;_+=1)et.push(nt);return et}function i(s,a){return s==="float32"?new Float32Array(a):s==="int16"?new Int16Array(a):s==="uint8c"?new Uint8ClampedArray(a):e(s,a)}return typeof Uint8ClampedArray=="function"&&typeof Float32Array=="function"?i:e}();function createSizedArray(e){return Array.apply(null,{length:e})}function _typeof$6(e){"@babel/helpers - typeof";return _typeof$6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$6(e)}var subframeEnabled=!0,expressionsPlugin=null,expressionsInterfaces=null,idPrefix$1="",isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),bmPow=Math.pow,bmSqrt=Math.sqrt,bmFloor=Math.floor,bmMax=Math.max,bmMin=Math.min,BMMath={};(function(){var e=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],i,s=e.length;for(i=0;i<s;i+=1)BMMath[e[i]]=Math[e[i]]})(),BMMath.random=Math.random,BMMath.abs=function(e){var i=_typeof$6(e);if(i==="object"&&e.length){var s=createSizedArray(e.length),a,_=e.length;for(a=0;a<_;a+=1)s[a]=Math.abs(e[a]);return s}return Math.abs(e)};var defaultCurveSegments=150,degToRads=Math.PI/180,roundCorner=.5519;function styleDiv(e){e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.display="block",e.style.transformOrigin="0 0",e.style.webkitTransformOrigin="0 0",e.style.backfaceVisibility="visible",e.style.webkitBackfaceVisibility="visible",e.style.transformStyle="preserve-3d",e.style.webkitTransformStyle="preserve-3d",e.style.mozTransformStyle="preserve-3d"}function BMEnterFrameEvent(e,i,s,a){this.type=e,this.currentTime=i,this.totalTime=s,this.direction=a<0?-1:1}function BMCompleteEvent(e,i){this.type=e,this.direction=i<0?-1:1}function BMCompleteLoopEvent(e,i,s,a){this.type=e,this.currentLoop=s,this.totalLoops=i,this.direction=a<0?-1:1}function BMSegmentStartEvent(e,i,s){this.type=e,this.firstFrame=i,this.totalFrames=s}function BMDestroyEvent(e,i){this.type=e,this.target=i}function BMRenderFrameErrorEvent(e,i){this.type="renderFrameError",this.nativeError=e,this.currentTime=i}function BMConfigErrorEvent(e){this.type="configError",this.nativeError=e}var createElementID=function(){var e=0;return function(){return e+=1,idPrefix$1+"__lottie_element_"+e}}();function HSVtoRGB(e,i,s){var a,_,et,nt,c,ct,dt,gt;switch(nt=Math.floor(e*6),c=e*6-nt,ct=s*(1-i),dt=s*(1-c*i),gt=s*(1-(1-c)*i),nt%6){case 0:a=s,_=gt,et=ct;break;case 1:a=dt,_=s,et=ct;break;case 2:a=ct,_=s,et=gt;break;case 3:a=ct,_=dt,et=s;break;case 4:a=gt,_=ct,et=s;break;case 5:a=s,_=ct,et=dt;break}return[a,_,et]}function RGBtoHSV(e,i,s){var a=Math.max(e,i,s),_=Math.min(e,i,s),et=a-_,nt,c=a===0?0:et/a,ct=a/255;switch(a){case _:nt=0;break;case e:nt=i-s+et*(i<s?6:0),nt/=6*et;break;case i:nt=s-e+et*2,nt/=6*et;break;case s:nt=e-i+et*4,nt/=6*et;break}return[nt,c,ct]}function addSaturationToRGB(e,i){var s=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return s[1]+=i,s[1]>1?s[1]=1:s[1]<=0&&(s[1]=0),HSVtoRGB(s[0],s[1],s[2])}function addBrightnessToRGB(e,i){var s=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return s[2]+=i,s[2]>1?s[2]=1:s[2]<0&&(s[2]=0),HSVtoRGB(s[0],s[1],s[2])}function addHueToRGB(e,i){var s=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return s[0]+=i/360,s[0]>1?s[0]-=1:s[0]<0&&(s[0]+=1),HSVtoRGB(s[0],s[1],s[2])}var rgbToHex=function(){var e=[],i,s;for(i=0;i<256;i+=1)s=i.toString(16),e[i]=s.length===1?"0"+s:s;return function(a,_,et){return a<0&&(a=0),_<0&&(_=0),et<0&&(et=0),"#"+e[a]+e[_]+e[et]}}(),setSubframeEnabled=function(i){subframeEnabled=!!i},getSubframeEnabled=function(){return subframeEnabled},setExpressionsPlugin=function(i){expressionsPlugin=i},getExpressionsPlugin=function(){return expressionsPlugin},setExpressionInterfaces=function(i){expressionsInterfaces=i},getExpressionInterfaces=function(){return expressionsInterfaces},setDefaultCurveSegments=function(i){defaultCurveSegments=i},getDefaultCurveSegments=function(){return defaultCurveSegments},setIdPrefix=function(i){idPrefix$1=i};function createNS(e){return document.createElementNS(svgNS,e)}function _typeof$5(e){"@babel/helpers - typeof";return _typeof$5=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$5(e)}var dataManager=function(){var e=1,i=[],s,a,_={onmessage:function(){},postMessage:function(At){s({data:At})}},et={postMessage:function(At){_.onmessage({data:At})}};function nt(Et){if(window.Worker&&window.Blob&&getWebWorker()){var At=new Blob(["var _workerSelf = self; self.onmessage = ",Et.toString()],{type:"text/javascript"}),Mt=URL.createObjectURL(At);return new Worker(Mt)}return s=Et,_}function c(){a||(a=nt(function(At){function Mt(){function $t(en,yr){var Ar,rr,ur=en.length,Br,xr,qr,tn;for(rr=0;rr<ur;rr+=1)if(Ar=en[rr],"ks"in Ar&&!Ar.completed){if(Ar.completed=!0,Ar.hasMask){var vn=Ar.masksProperties;for(xr=vn.length,Br=0;Br<xr;Br+=1)if(vn[Br].pt.k.i)Xt(vn[Br].pt.k);else for(tn=vn[Br].pt.k.length,qr=0;qr<tn;qr+=1)vn[Br].pt.k[qr].s&&Xt(vn[Br].pt.k[qr].s[0]),vn[Br].pt.k[qr].e&&Xt(vn[Br].pt.k[qr].e[0])}Ar.ty===0?(Ar.layers=Nt(Ar.refId,yr),$t(Ar.layers,yr)):Ar.ty===4?Vt(Ar.shapes):Ar.ty===5&&Qr(Ar)}}function Lt(en,yr){if(en){var Ar=0,rr=en.length;for(Ar=0;Ar<rr;Ar+=1)en[Ar].t===1&&(en[Ar].data.layers=Nt(en[Ar].data.refId,yr),$t(en[Ar].data.layers,yr))}}function Bt(en,yr){for(var Ar=0,rr=yr.length;Ar<rr;){if(yr[Ar].id===en)return yr[Ar];Ar+=1}return null}function Nt(en,yr){var Ar=Bt(en,yr);return Ar?Ar.layers.__used?JSON.parse(JSON.stringify(Ar.layers)):(Ar.layers.__used=!0,Ar.layers):null}function Vt(en){var yr,Ar=en.length,rr,ur;for(yr=Ar-1;yr>=0;yr-=1)if(en[yr].ty==="sh")if(en[yr].ks.k.i)Xt(en[yr].ks.k);else for(ur=en[yr].ks.k.length,rr=0;rr<ur;rr+=1)en[yr].ks.k[rr].s&&Xt(en[yr].ks.k[rr].s[0]),en[yr].ks.k[rr].e&&Xt(en[yr].ks.k[rr].e[0]);else en[yr].ty==="gr"&&Vt(en[yr].it)}function Xt(en){var yr,Ar=en.i.length;for(yr=0;yr<Ar;yr+=1)en.i[yr][0]+=en.v[yr][0],en.i[yr][1]+=en.v[yr][1],en.o[yr][0]+=en.v[yr][0],en.o[yr][1]+=en.v[yr][1]}function nr(en,yr){var Ar=yr?yr.split("."):[100,100,100];return en[0]>Ar[0]?!0:Ar[0]>en[0]?!1:en[1]>Ar[1]?!0:Ar[1]>en[1]?!1:en[2]>Ar[2]?!0:Ar[2]>en[2]?!1:null}var ar=function(){var en=[4,4,14];function yr(rr){var ur=rr.t.d;rr.t.d={k:[{s:ur,t:0}]}}function Ar(rr){var ur,Br=rr.length;for(ur=0;ur<Br;ur+=1)rr[ur].ty===5&&yr(rr[ur])}return function(rr){if(nr(en,rr.v)&&(Ar(rr.layers),rr.assets)){var ur,Br=rr.assets.length;for(ur=0;ur<Br;ur+=1)rr.assets[ur].layers&&Ar(rr.assets[ur].layers)}}}(),mr=function(){var en=[4,7,99];return function(yr){if(yr.chars&&!nr(en,yr.v)){var Ar,rr=yr.chars.length;for(Ar=0;Ar<rr;Ar+=1){var ur=yr.chars[Ar];ur.data&&ur.data.shapes&&(Vt(ur.data.shapes),ur.data.ip=0,ur.data.op=99999,ur.data.st=0,ur.data.sr=1,ur.data.ks={p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0}},yr.chars[Ar].t||(ur.data.shapes.push({ty:"no"}),ur.data.shapes[0].it.push({p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0},sk:{k:0,a:0},sa:{k:0,a:0},ty:"tr"})))}}}}(),Fr=function(){var en=[5,7,15];function yr(rr){var ur=rr.t.p;typeof ur.a=="number"&&(ur.a={a:0,k:ur.a}),typeof ur.p=="number"&&(ur.p={a:0,k:ur.p}),typeof ur.r=="number"&&(ur.r={a:0,k:ur.r})}function Ar(rr){var ur,Br=rr.length;for(ur=0;ur<Br;ur+=1)rr[ur].ty===5&&yr(rr[ur])}return function(rr){if(nr(en,rr.v)&&(Ar(rr.layers),rr.assets)){var ur,Br=rr.assets.length;for(ur=0;ur<Br;ur+=1)rr.assets[ur].layers&&Ar(rr.assets[ur].layers)}}}(),sn=function(){var en=[4,1,9];function yr(rr){var ur,Br=rr.length,xr,qr;for(ur=0;ur<Br;ur+=1)if(rr[ur].ty==="gr")yr(rr[ur].it);else if(rr[ur].ty==="fl"||rr[ur].ty==="st")if(rr[ur].c.k&&rr[ur].c.k[0].i)for(qr=rr[ur].c.k.length,xr=0;xr<qr;xr+=1)rr[ur].c.k[xr].s&&(rr[ur].c.k[xr].s[0]/=255,rr[ur].c.k[xr].s[1]/=255,rr[ur].c.k[xr].s[2]/=255,rr[ur].c.k[xr].s[3]/=255),rr[ur].c.k[xr].e&&(rr[ur].c.k[xr].e[0]/=255,rr[ur].c.k[xr].e[1]/=255,rr[ur].c.k[xr].e[2]/=255,rr[ur].c.k[xr].e[3]/=255);else rr[ur].c.k[0]/=255,rr[ur].c.k[1]/=255,rr[ur].c.k[2]/=255,rr[ur].c.k[3]/=255}function Ar(rr){var ur,Br=rr.length;for(ur=0;ur<Br;ur+=1)rr[ur].ty===4&&yr(rr[ur].shapes)}return function(rr){if(nr(en,rr.v)&&(Ar(rr.layers),rr.assets)){var ur,Br=rr.assets.length;for(ur=0;ur<Br;ur+=1)rr.assets[ur].layers&&Ar(rr.assets[ur].layers)}}}(),fn=function(){var en=[4,4,18];function yr(rr){var ur,Br=rr.length,xr,qr;for(ur=Br-1;ur>=0;ur-=1)if(rr[ur].ty==="sh")if(rr[ur].ks.k.i)rr[ur].ks.k.c=rr[ur].closed;else for(qr=rr[ur].ks.k.length,xr=0;xr<qr;xr+=1)rr[ur].ks.k[xr].s&&(rr[ur].ks.k[xr].s[0].c=rr[ur].closed),rr[ur].ks.k[xr].e&&(rr[ur].ks.k[xr].e[0].c=rr[ur].closed);else rr[ur].ty==="gr"&&yr(rr[ur].it)}function Ar(rr){var ur,Br,xr=rr.length,qr,tn,vn,hs;for(Br=0;Br<xr;Br+=1){if(ur=rr[Br],ur.hasMask){var Ts=ur.masksProperties;for(tn=Ts.length,qr=0;qr<tn;qr+=1)if(Ts[qr].pt.k.i)Ts[qr].pt.k.c=Ts[qr].cl;else for(hs=Ts[qr].pt.k.length,vn=0;vn<hs;vn+=1)Ts[qr].pt.k[vn].s&&(Ts[qr].pt.k[vn].s[0].c=Ts[qr].cl),Ts[qr].pt.k[vn].e&&(Ts[qr].pt.k[vn].e[0].c=Ts[qr].cl)}ur.ty===4&&yr(ur.shapes)}}return function(rr){if(nr(en,rr.v)&&(Ar(rr.layers),rr.assets)){var ur,Br=rr.assets.length;for(ur=0;ur<Br;ur+=1)rr.assets[ur].layers&&Ar(rr.assets[ur].layers)}}}();function Lr(en){en.__complete||(sn(en),ar(en),mr(en),Fr(en),fn(en),$t(en.layers,en.assets),Lt(en.chars,en.assets),en.__complete=!0)}function Qr(en){en.t.a.length===0&&"m"in en.t.p}var dn={};return dn.completeData=Lr,dn.checkColors=sn,dn.checkChars=mr,dn.checkPathProperties=Fr,dn.checkShapes=fn,dn.completeLayers=$t,dn}if(et.dataManager||(et.dataManager=Mt()),et.assetLoader||(et.assetLoader=function(){function $t(Bt){var Nt=Bt.getResponseHeader("content-type");return Nt&&Bt.responseType==="json"&&Nt.indexOf("json")!==-1||Bt.response&&_typeof$5(Bt.response)==="object"?Bt.response:Bt.response&&typeof Bt.response=="string"?JSON.parse(Bt.response):Bt.responseText?JSON.parse(Bt.responseText):null}function Lt(Bt,Nt,Vt,Xt){var nr,ar=new XMLHttpRequest;try{ar.responseType="json"}catch{}ar.onreadystatechange=function(){if(ar.readyState===4)if(ar.status===200)nr=$t(ar),Vt(nr);else try{nr=$t(ar),Vt(nr)}catch(mr){Xt&&Xt(mr)}};try{ar.open(["G","E","T"].join(""),Bt,!0)}catch{ar.open(["G","E","T"].join(""),Nt+"/"+Bt,!0)}ar.send()}return{load:Lt}}()),At.data.type==="loadAnimation")et.assetLoader.load(At.data.path,At.data.fullPath,function($t){et.dataManager.completeData($t),et.postMessage({id:At.data.id,payload:$t,status:"success"})},function(){et.postMessage({id:At.data.id,status:"error"})});else if(At.data.type==="complete"){var Pt=At.data.animation;et.dataManager.completeData(Pt),et.postMessage({id:At.data.id,payload:Pt,status:"success"})}else At.data.type==="loadData"&&et.assetLoader.load(At.data.path,At.data.fullPath,function($t){et.postMessage({id:At.data.id,payload:$t,status:"success"})},function(){et.postMessage({id:At.data.id,status:"error"})})}),a.onmessage=function(Et){var At=Et.data,Mt=At.id,Pt=i[Mt];i[Mt]=null,At.status==="success"?Pt.onComplete(At.payload):Pt.onError&&Pt.onError()})}function ct(Et,At){e+=1;var Mt="processId_"+e;return i[Mt]={onComplete:Et,onError:At},Mt}function dt(Et,At,Mt){c();var Pt=ct(At,Mt);a.postMessage({type:"loadAnimation",path:Et,fullPath:window.location.origin+window.location.pathname,id:Pt})}function gt(Et,At,Mt){c();var Pt=ct(At,Mt);a.postMessage({type:"loadData",path:Et,fullPath:window.location.origin+window.location.pathname,id:Pt})}function Tt(Et,At,Mt){c();var Pt=ct(At,Mt);a.postMessage({type:"complete",animation:Et,id:Pt})}return{loadAnimation:dt,loadData:gt,completeAnimation:Tt}}(),ImagePreloader=function(){var e=function(){var Lt=createTag("canvas");Lt.width=1,Lt.height=1;var Bt=Lt.getContext("2d");return Bt.fillStyle="rgba(0,0,0,0)",Bt.fillRect(0,0,1,1),Lt}();function i(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function s(){this.loadedFootagesCount+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function a(Lt,Bt,Nt){var Vt="";if(Lt.e)Vt=Lt.p;else if(Bt){var Xt=Lt.p;Xt.indexOf("images/")!==-1&&(Xt=Xt.split("/")[1]),Vt=Bt+Xt}else Vt=Nt,Vt+=Lt.u?Lt.u:"",Vt+=Lt.p;return Vt}function _(Lt){var Bt=0,Nt=setInterval((function(){var Vt=Lt.getBBox();(Vt.width||Bt>500)&&(this._imageLoaded(),clearInterval(Nt)),Bt+=1}).bind(this),50)}function et(Lt){var Bt=a(Lt,this.assetsPath,this.path),Nt=createNS("image");isSafari?this.testImageLoaded(Nt):Nt.addEventListener("load",this._imageLoaded,!1),Nt.addEventListener("error",(function(){Vt.img=e,this._imageLoaded()}).bind(this),!1),Nt.setAttributeNS("http://www.w3.org/1999/xlink","href",Bt),this._elementHelper.append?this._elementHelper.append(Nt):this._elementHelper.appendChild(Nt);var Vt={img:Nt,assetData:Lt};return Vt}function nt(Lt){var Bt=a(Lt,this.assetsPath,this.path),Nt=createTag("img");Nt.crossOrigin="anonymous",Nt.addEventListener("load",this._imageLoaded,!1),Nt.addEventListener("error",(function(){Vt.img=e,this._imageLoaded()}).bind(this),!1),Nt.src=Bt;var Vt={img:Nt,assetData:Lt};return Vt}function c(Lt){var Bt={assetData:Lt},Nt=a(Lt,this.assetsPath,this.path);return dataManager.loadData(Nt,(function(Vt){Bt.img=Vt,this._footageLoaded()}).bind(this),(function(){Bt.img={},this._footageLoaded()}).bind(this)),Bt}function ct(Lt,Bt){this.imagesLoadedCb=Bt;var Nt,Vt=Lt.length;for(Nt=0;Nt<Vt;Nt+=1)Lt[Nt].layers||(!Lt[Nt].t||Lt[Nt].t==="seq"?(this.totalImages+=1,this.images.push(this._createImageData(Lt[Nt]))):Lt[Nt].t===3&&(this.totalFootages+=1,this.images.push(this.createFootageData(Lt[Nt]))))}function dt(Lt){this.path=Lt||""}function gt(Lt){this.assetsPath=Lt||""}function Tt(Lt){for(var Bt=0,Nt=this.images.length;Bt<Nt;){if(this.images[Bt].assetData===Lt)return this.images[Bt].img;Bt+=1}return null}function Et(){this.imagesLoadedCb=null,this.images.length=0}function At(){return this.totalImages===this.loadedAssets}function Mt(){return this.totalFootages===this.loadedFootagesCount}function Pt(Lt,Bt){Lt==="svg"?(this._elementHelper=Bt,this._createImageData=this.createImageData.bind(this)):this._createImageData=this.createImgData.bind(this)}function $t(){this._imageLoaded=i.bind(this),this._footageLoaded=s.bind(this),this.testImageLoaded=_.bind(this),this.createFootageData=c.bind(this),this.assetsPath="",this.path="",this.totalImages=0,this.totalFootages=0,this.loadedAssets=0,this.loadedFootagesCount=0,this.imagesLoadedCb=null,this.images=[]}return $t.prototype={loadAssets:ct,setAssetsPath:gt,setPath:dt,loadedImages:At,loadedFootages:Mt,destroy:Et,getAsset:Tt,createImgData:nt,createImageData:et,imageLoaded:i,footageLoaded:s,setCacheType:Pt},$t}();function BaseEvent(){}BaseEvent.prototype={triggerEvent:function(i,s){if(this._cbs[i])for(var a=this._cbs[i],_=0;_<a.length;_+=1)a[_](s)},addEventListener:function(i,s){return this._cbs[i]||(this._cbs[i]=[]),this._cbs[i].push(s),(function(){this.removeEventListener(i,s)}).bind(this)},removeEventListener:function(i,s){if(!s)this._cbs[i]=null;else if(this._cbs[i]){for(var a=0,_=this._cbs[i].length;a<_;)this._cbs[i][a]===s&&(this._cbs[i].splice(a,1),a-=1,_-=1),a+=1;this._cbs[i].length||(this._cbs[i]=null)}}};var markerParser=function(){function e(i){for(var s=i.split(`\r
`),a={},_,et=0,nt=0;nt<s.length;nt+=1)_=s[nt].split(":"),_.length===2&&(a[_[0]]=_[1].trim(),et+=1);if(et===0)throw new Error;return a}return function(i){for(var s=[],a=0;a<i.length;a+=1){var _=i[a],et={time:_.tm,duration:_.dr};try{et.payload=JSON.parse(i[a].cm)}catch{try{et.payload=e(i[a].cm)}catch{et.payload={name:i[a].cm}}}s.push(et)}return s}}(),ProjectInterface=function(){function e(i){this.compositions.push(i)}return function(){function i(s){for(var a=0,_=this.compositions.length;a<_;){if(this.compositions[a].data&&this.compositions[a].data.nm===s)return this.compositions[a].prepareFrame&&this.compositions[a].data.xt&&this.compositions[a].prepareFrame(this.currentFrame),this.compositions[a].compInterface;a+=1}return null}return i.compositions=[],i.currentFrame=0,i.registerComposition=e,i}}(),renderers={},registerRenderer=function(i,s){renderers[i]=s};function getRenderer(e){return renderers[e]}function getRegisteredRenderer(){if(renderers.canvas)return"canvas";for(var e in renderers)if(renderers[e])return e;return""}function _typeof$4(e){"@babel/helpers - typeof";return _typeof$4=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$4(e)}var AnimationItem=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.firstFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=createElementID(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.isSubframeEnabled=getSubframeEnabled(),this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=ProjectInterface(),this.imagePreloader=new ImagePreloader,this.audioController=audioControllerFactory(),this.markers=[],this.configAnimation=this.configAnimation.bind(this),this.onSetupError=this.onSetupError.bind(this),this.onSegmentComplete=this.onSegmentComplete.bind(this),this.drawnFrameEvent=new BMEnterFrameEvent("drawnFrame",0,0,0),this.expressionsPlugin=getExpressionsPlugin()};extendPrototype([BaseEvent],AnimationItem),AnimationItem.prototype.setParams=function(e){(e.wrapper||e.container)&&(this.wrapper=e.wrapper||e.container);var i="svg";e.animType?i=e.animType:e.renderer&&(i=e.renderer);var s=getRenderer(i);this.renderer=new s(this,e.rendererSettings),this.imagePreloader.setCacheType(i,this.renderer.globalData.defs),this.renderer.setProjectInterface(this.projectInterface),this.animType=i,e.loop===""||e.loop===null||e.loop===void 0||e.loop===!0?this.loop=!0:e.loop===!1?this.loop=!1:this.loop=parseInt(e.loop,10),this.autoplay="autoplay"in e?e.autoplay:!0,this.name=e.name?e.name:"",this.autoloadSegments=Object.prototype.hasOwnProperty.call(e,"autoloadSegments")?e.autoloadSegments:!0,this.assetsPath=e.assetsPath,this.initialSegment=e.initialSegment,e.audioFactory&&this.audioController.setAudioFactory(e.audioFactory),e.animationData?this.setupAnimation(e.animationData):e.path&&(e.path.lastIndexOf("\\")!==-1?this.path=e.path.substr(0,e.path.lastIndexOf("\\")+1):this.path=e.path.substr(0,e.path.lastIndexOf("/")+1),this.fileName=e.path.substr(e.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),dataManager.loadAnimation(e.path,this.configAnimation,this.onSetupError))},AnimationItem.prototype.onSetupError=function(){this.trigger("data_failed")},AnimationItem.prototype.setupAnimation=function(e){dataManager.completeAnimation(e,this.configAnimation)},AnimationItem.prototype.setData=function(e,i){i&&_typeof$4(i)!=="object"&&(i=JSON.parse(i));var s={wrapper:e,animationData:i},a=e.attributes;s.path=a.getNamedItem("data-animation-path")?a.getNamedItem("data-animation-path").value:a.getNamedItem("data-bm-path")?a.getNamedItem("data-bm-path").value:a.getNamedItem("bm-path")?a.getNamedItem("bm-path").value:"",s.animType=a.getNamedItem("data-anim-type")?a.getNamedItem("data-anim-type").value:a.getNamedItem("data-bm-type")?a.getNamedItem("data-bm-type").value:a.getNamedItem("bm-type")?a.getNamedItem("bm-type").value:a.getNamedItem("data-bm-renderer")?a.getNamedItem("data-bm-renderer").value:a.getNamedItem("bm-renderer")?a.getNamedItem("bm-renderer").value:getRegisteredRenderer()||"canvas";var _=a.getNamedItem("data-anim-loop")?a.getNamedItem("data-anim-loop").value:a.getNamedItem("data-bm-loop")?a.getNamedItem("data-bm-loop").value:a.getNamedItem("bm-loop")?a.getNamedItem("bm-loop").value:"";_==="false"?s.loop=!1:_==="true"?s.loop=!0:_!==""&&(s.loop=parseInt(_,10));var et=a.getNamedItem("data-anim-autoplay")?a.getNamedItem("data-anim-autoplay").value:a.getNamedItem("data-bm-autoplay")?a.getNamedItem("data-bm-autoplay").value:a.getNamedItem("bm-autoplay")?a.getNamedItem("bm-autoplay").value:!0;s.autoplay=et!=="false",s.name=a.getNamedItem("data-name")?a.getNamedItem("data-name").value:a.getNamedItem("data-bm-name")?a.getNamedItem("data-bm-name").value:a.getNamedItem("bm-name")?a.getNamedItem("bm-name").value:"";var nt=a.getNamedItem("data-anim-prerender")?a.getNamedItem("data-anim-prerender").value:a.getNamedItem("data-bm-prerender")?a.getNamedItem("data-bm-prerender").value:a.getNamedItem("bm-prerender")?a.getNamedItem("bm-prerender").value:"";nt==="false"&&(s.prerender=!1),s.path?this.setParams(s):this.trigger("destroy")},AnimationItem.prototype.includeLayers=function(e){e.op>this.animationData.op&&(this.animationData.op=e.op,this.totalFrames=Math.floor(e.op-this.animationData.ip));var i=this.animationData.layers,s,a=i.length,_=e.layers,et,nt=_.length;for(et=0;et<nt;et+=1)for(s=0;s<a;){if(i[s].id===_[et].id){i[s]=_[et];break}s+=1}if((e.chars||e.fonts)&&(this.renderer.globalData.fontManager.addChars(e.chars),this.renderer.globalData.fontManager.addFonts(e.fonts,this.renderer.globalData.defs)),e.assets)for(a=e.assets.length,s=0;s<a;s+=1)this.animationData.assets.push(e.assets[s]);this.animationData.__complete=!1,dataManager.completeAnimation(this.animationData,this.onSegmentComplete)},AnimationItem.prototype.onSegmentComplete=function(e){this.animationData=e;var i=getExpressionsPlugin();i&&i.initExpressions(this),this.loadNextSegment()},AnimationItem.prototype.loadNextSegment=function(){var e=this.animationData.segments;if(!e||e.length===0||!this.autoloadSegments){this.trigger("data_ready"),this.timeCompleted=this.totalFrames;return}var i=e.shift();this.timeCompleted=i.time*this.frameRate;var s=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,dataManager.loadData(s,this.includeLayers.bind(this),(function(){this.trigger("data_failed")}).bind(this))},AnimationItem.prototype.loadSegments=function(){var e=this.animationData.segments;e||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},AnimationItem.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},AnimationItem.prototype.configAnimation=function(e){if(this.renderer)try{this.animationData=e,this.initialSegment?(this.totalFrames=Math.floor(this.initialSegment[1]-this.initialSegment[0]),this.firstFrame=Math.round(this.initialSegment[0])):(this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.firstFrame=Math.round(this.animationData.ip)),this.renderer.configAnimation(e),e.assets||(e.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(e.assets),this.markers=markerParser(e.markers||[]),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded(),this.isPaused&&this.audioController.pause()}catch(i){this.triggerConfigError(i)}},AnimationItem.prototype.waitForFontsLoaded=function(){this.renderer&&(this.renderer.globalData.fontManager.isLoaded?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},AnimationItem.prototype.checkLoaded=function(){if(!this.isLoaded&&this.renderer.globalData.fontManager.isLoaded&&(this.imagePreloader.loadedImages()||this.renderer.rendererType!=="canvas")&&this.imagePreloader.loadedFootages()){this.isLoaded=!0;var e=getExpressionsPlugin();e&&e.initExpressions(this),this.renderer.initItems(),setTimeout((function(){this.trigger("DOMLoaded")}).bind(this),0),this.gotoFrame(),this.autoplay&&this.play()}},AnimationItem.prototype.resize=function(e,i){var s=typeof e=="number"?e:void 0,a=typeof i=="number"?i:void 0;this.renderer.updateContainerSize(s,a)},AnimationItem.prototype.setSubframe=function(e){this.isSubframeEnabled=!!e},AnimationItem.prototype.gotoFrame=function(){this.currentFrame=this.isSubframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame(),this.trigger("drawnFrame")},AnimationItem.prototype.renderFrame=function(){if(!(this.isLoaded===!1||!this.renderer))try{this.expressionsPlugin&&this.expressionsPlugin.resetFrame(),this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(e){this.triggerRenderFrameError(e)}},AnimationItem.prototype.play=function(e){e&&this.name!==e||this.isPaused===!0&&(this.isPaused=!1,this.trigger("_play"),this.audioController.resume(),this._idle&&(this._idle=!1,this.trigger("_active")))},AnimationItem.prototype.pause=function(e){e&&this.name!==e||this.isPaused===!1&&(this.isPaused=!0,this.trigger("_pause"),this._idle=!0,this.trigger("_idle"),this.audioController.pause())},AnimationItem.prototype.togglePause=function(e){e&&this.name!==e||(this.isPaused===!0?this.play():this.pause())},AnimationItem.prototype.stop=function(e){e&&this.name!==e||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},AnimationItem.prototype.getMarkerData=function(e){for(var i,s=0;s<this.markers.length;s+=1)if(i=this.markers[s],i.payload&&i.payload.name===e)return i;return null},AnimationItem.prototype.goToAndStop=function(e,i,s){if(!(s&&this.name!==s)){var a=Number(e);if(isNaN(a)){var _=this.getMarkerData(e);_&&this.goToAndStop(_.time,!0)}else i?this.setCurrentRawFrameValue(e):this.setCurrentRawFrameValue(e*this.frameModifier);this.pause()}},AnimationItem.prototype.goToAndPlay=function(e,i,s){if(!(s&&this.name!==s)){var a=Number(e);if(isNaN(a)){var _=this.getMarkerData(e);_&&(_.duration?this.playSegments([_.time,_.time+_.duration],!0):this.goToAndStop(_.time,!0))}else this.goToAndStop(a,i,s);this.play()}},AnimationItem.prototype.advanceTime=function(e){if(!(this.isPaused===!0||this.isLoaded===!1)){var i=this.currentRawFrame+e*this.frameModifier,s=!1;i>=this.totalFrames-1&&this.frameModifier>0?!this.loop||this.playCount===this.loop?this.checkSegments(i>this.totalFrames?i%this.totalFrames:0)||(s=!0,i=this.totalFrames-1):i>=this.totalFrames?(this.playCount+=1,this.checkSegments(i%this.totalFrames)||(this.setCurrentRawFrameValue(i%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(i):i<0?this.checkSegments(i%this.totalFrames)||(this.loop&&!(this.playCount--<=0&&this.loop!==!0)?(this.setCurrentRawFrameValue(this.totalFrames+i%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0):(s=!0,i=0)):this.setCurrentRawFrameValue(i),s&&(this.setCurrentRawFrameValue(i),this.pause(),this.trigger("complete"))}},AnimationItem.prototype.adjustSegment=function(e,i){this.playCount=0,e[1]<e[0]?(this.frameModifier>0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.totalFrames=e[0]-e[1],this.timeCompleted=this.totalFrames,this.firstFrame=e[1],this.setCurrentRawFrameValue(this.totalFrames-.001-i)):e[1]>e[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.totalFrames=e[1]-e[0],this.timeCompleted=this.totalFrames,this.firstFrame=e[0],this.setCurrentRawFrameValue(.001+i)),this.trigger("segmentStart")},AnimationItem.prototype.setSegment=function(e,i){var s=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<e?s=e:this.currentRawFrame+this.firstFrame>i&&(s=i-e)),this.firstFrame=e,this.totalFrames=i-e,this.timeCompleted=this.totalFrames,s!==-1&&this.goToAndStop(s,!0)},AnimationItem.prototype.playSegments=function(e,i){if(i&&(this.segments.length=0),_typeof$4(e[0])==="object"){var s,a=e.length;for(s=0;s<a;s+=1)this.segments.push(e[s])}else this.segments.push(e);this.segments.length&&i&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},AnimationItem.prototype.resetSegments=function(e){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),e&&this.checkSegments(0)},AnimationItem.prototype.checkSegments=function(e){return this.segments.length?(this.adjustSegment(this.segments.shift(),e),!0):!1},AnimationItem.prototype.destroy=function(e){e&&this.name!==e||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=null,this.onLoopComplete=null,this.onComplete=null,this.onSegmentStart=null,this.onDestroy=null,this.renderer=null,this.expressionsPlugin=null,this.imagePreloader=null,this.projectInterface=null)},AnimationItem.prototype.setCurrentRawFrameValue=function(e){this.currentRawFrame=e,this.gotoFrame()},AnimationItem.prototype.setSpeed=function(e){this.playSpeed=e,this.updaFrameModifier()},AnimationItem.prototype.setDirection=function(e){this.playDirection=e<0?-1:1,this.updaFrameModifier()},AnimationItem.prototype.setLoop=function(e){this.loop=e},AnimationItem.prototype.setVolume=function(e,i){i&&this.name!==i||this.audioController.setVolume(e)},AnimationItem.prototype.getVolume=function(){return this.audioController.getVolume()},AnimationItem.prototype.mute=function(e){e&&this.name!==e||this.audioController.mute()},AnimationItem.prototype.unmute=function(e){e&&this.name!==e||this.audioController.unmute()},AnimationItem.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection,this.audioController.setRate(this.playSpeed*this.playDirection)},AnimationItem.prototype.getPath=function(){return this.path},AnimationItem.prototype.getAssetsPath=function(e){var i="";if(e.e)i=e.p;else if(this.assetsPath){var s=e.p;s.indexOf("images/")!==-1&&(s=s.split("/")[1]),i=this.assetsPath+s}else i=this.path,i+=e.u?e.u:"",i+=e.p;return i},AnimationItem.prototype.getAssetData=function(e){for(var i=0,s=this.assets.length;i<s;){if(e===this.assets[i].id)return this.assets[i];i+=1}return null},AnimationItem.prototype.hide=function(){this.renderer.hide()},AnimationItem.prototype.show=function(){this.renderer.show()},AnimationItem.prototype.getDuration=function(e){return e?this.totalFrames:this.totalFrames/this.frameRate},AnimationItem.prototype.updateDocumentData=function(e,i,s){try{var a=this.renderer.getElementByPath(e);a.updateDocumentData(i,s)}catch{}},AnimationItem.prototype.trigger=function(e){if(this._cbs&&this._cbs[e])switch(e){case"enterFrame":this.triggerEvent(e,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameModifier));break;case"drawnFrame":this.drawnFrameEvent.currentTime=this.currentFrame,this.drawnFrameEvent.totalTime=this.totalFrames,this.drawnFrameEvent.direction=this.frameModifier,this.triggerEvent(e,this.drawnFrameEvent);break;case"loopComplete":this.triggerEvent(e,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(e,new BMCompleteEvent(e,this.frameMult));break;case"segmentStart":this.triggerEvent(e,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(e,new BMDestroyEvent(e,this));break;default:this.triggerEvent(e)}e==="enterFrame"&&this.onEnterFrame&&this.onEnterFrame.call(this,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameMult)),e==="loopComplete"&&this.onLoopComplete&&this.onLoopComplete.call(this,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult)),e==="complete"&&this.onComplete&&this.onComplete.call(this,new BMCompleteEvent(e,this.frameMult)),e==="segmentStart"&&this.onSegmentStart&&this.onSegmentStart.call(this,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames)),e==="destroy"&&this.onDestroy&&this.onDestroy.call(this,new BMDestroyEvent(e,this))},AnimationItem.prototype.triggerRenderFrameError=function(e){var i=new BMRenderFrameErrorEvent(e,this.currentFrame);this.triggerEvent("error",i),this.onError&&this.onError.call(this,i)},AnimationItem.prototype.triggerConfigError=function(e){var i=new BMConfigErrorEvent(e,this.currentFrame);this.triggerEvent("error",i),this.onError&&this.onError.call(this,i)};var animationManager=function(){var e={},i=[],s=0,a=0,_=0,et=!0,nt=!1;function c(yr){for(var Ar=0,rr=yr.target;Ar<a;)i[Ar].animation===rr&&(i.splice(Ar,1),Ar-=1,a-=1,rr.isPaused||Tt()),Ar+=1}function ct(yr,Ar){if(!yr)return null;for(var rr=0;rr<a;){if(i[rr].elem===yr&&i[rr].elem!==null)return i[rr].animation;rr+=1}var ur=new AnimationItem;return Et(ur,yr),ur.setData(yr,Ar),ur}function dt(){var yr,Ar=i.length,rr=[];for(yr=0;yr<Ar;yr+=1)rr.push(i[yr].animation);return rr}function gt(){_+=1,sn()}function Tt(){_-=1}function Et(yr,Ar){yr.addEventListener("destroy",c),yr.addEventListener("_active",gt),yr.addEventListener("_idle",Tt),i.push({elem:Ar,animation:yr}),a+=1}function At(yr){var Ar=new AnimationItem;return Et(Ar,null),Ar.setParams(yr),Ar}function Mt(yr,Ar){var rr;for(rr=0;rr<a;rr+=1)i[rr].animation.setSpeed(yr,Ar)}function Pt(yr,Ar){var rr;for(rr=0;rr<a;rr+=1)i[rr].animation.setDirection(yr,Ar)}function $t(yr){var Ar;for(Ar=0;Ar<a;Ar+=1)i[Ar].animation.play(yr)}function Lt(yr){var Ar=yr-s,rr;for(rr=0;rr<a;rr+=1)i[rr].animation.advanceTime(Ar);s=yr,_&&!nt?window.requestAnimationFrame(Lt):et=!0}function Bt(yr){s=yr,window.requestAnimationFrame(Lt)}function Nt(yr){var Ar;for(Ar=0;Ar<a;Ar+=1)i[Ar].animation.pause(yr)}function Vt(yr,Ar,rr){var ur;for(ur=0;ur<a;ur+=1)i[ur].animation.goToAndStop(yr,Ar,rr)}function Xt(yr){var Ar;for(Ar=0;Ar<a;Ar+=1)i[Ar].animation.stop(yr)}function nr(yr){var Ar;for(Ar=0;Ar<a;Ar+=1)i[Ar].animation.togglePause(yr)}function ar(yr){var Ar;for(Ar=a-1;Ar>=0;Ar-=1)i[Ar].animation.destroy(yr)}function mr(yr,Ar,rr){var ur=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),Br,xr=ur.length;for(Br=0;Br<xr;Br+=1)rr&&ur[Br].setAttribute("data-bm-type",rr),ct(ur[Br],yr);if(Ar&&xr===0){rr||(rr="svg");var qr=document.getElementsByTagName("body")[0];qr.innerText="";var tn=createTag("div");tn.style.width="100%",tn.style.height="100%",tn.setAttribute("data-bm-type",rr),qr.appendChild(tn),ct(tn,yr)}}function Fr(){var yr;for(yr=0;yr<a;yr+=1)i[yr].animation.resize()}function sn(){!nt&&_&&et&&(window.requestAnimationFrame(Bt),et=!1)}function fn(){nt=!0}function Lr(){nt=!1,sn()}function Qr(yr,Ar){var rr;for(rr=0;rr<a;rr+=1)i[rr].animation.setVolume(yr,Ar)}function dn(yr){var Ar;for(Ar=0;Ar<a;Ar+=1)i[Ar].animation.mute(yr)}function en(yr){var Ar;for(Ar=0;Ar<a;Ar+=1)i[Ar].animation.unmute(yr)}return e.registerAnimation=ct,e.loadAnimation=At,e.setSpeed=Mt,e.setDirection=Pt,e.play=$t,e.pause=Nt,e.stop=Xt,e.togglePause=nr,e.searchAnimations=mr,e.resize=Fr,e.goToAndStop=Vt,e.destroy=ar,e.freeze=fn,e.unfreeze=Lr,e.setVolume=Qr,e.mute=dn,e.unmute=en,e.getRegisteredAnimations=dt,e}(),BezierFactory=function(){var e={};e.getBezierEasing=s;var i={};function s(Bt,Nt,Vt,Xt,nr){var ar=nr||("bez_"+Bt+"_"+Nt+"_"+Vt+"_"+Xt).replace(/\./g,"p");if(i[ar])return i[ar];var mr=new Lt([Bt,Nt,Vt,Xt]);return i[ar]=mr,mr}var a=4,_=.001,et=1e-7,nt=10,c=11,ct=1/(c-1),dt=typeof Float32Array=="function";function gt(Bt,Nt){return 1-3*Nt+3*Bt}function Tt(Bt,Nt){return 3*Nt-6*Bt}function Et(Bt){return 3*Bt}function At(Bt,Nt,Vt){return((gt(Nt,Vt)*Bt+Tt(Nt,Vt))*Bt+Et(Nt))*Bt}function Mt(Bt,Nt,Vt){return 3*gt(Nt,Vt)*Bt*Bt+2*Tt(Nt,Vt)*Bt+Et(Nt)}function Pt(Bt,Nt,Vt,Xt,nr){var ar,mr,Fr=0;do mr=Nt+(Vt-Nt)/2,ar=At(mr,Xt,nr)-Bt,ar>0?Vt=mr:Nt=mr;while(Math.abs(ar)>et&&++Fr<nt);return mr}function $t(Bt,Nt,Vt,Xt){for(var nr=0;nr<a;++nr){var ar=Mt(Nt,Vt,Xt);if(ar===0)return Nt;var mr=At(Nt,Vt,Xt)-Bt;Nt-=mr/ar}return Nt}function Lt(Bt){this._p=Bt,this._mSampleValues=dt?new Float32Array(c):new Array(c),this._precomputed=!1,this.get=this.get.bind(this)}return Lt.prototype={get:function(Nt){var Vt=this._p[0],Xt=this._p[1],nr=this._p[2],ar=this._p[3];return this._precomputed||this._precompute(),Vt===Xt&&nr===ar?Nt:Nt===0?0:Nt===1?1:At(this._getTForX(Nt),Xt,ar)},_precompute:function(){var Nt=this._p[0],Vt=this._p[1],Xt=this._p[2],nr=this._p[3];this._precomputed=!0,(Nt!==Vt||Xt!==nr)&&this._calcSampleValues()},_calcSampleValues:function(){for(var Nt=this._p[0],Vt=this._p[2],Xt=0;Xt<c;++Xt)this._mSampleValues[Xt]=At(Xt*ct,Nt,Vt)},_getTForX:function(Nt){for(var Vt=this._p[0],Xt=this._p[2],nr=this._mSampleValues,ar=0,mr=1,Fr=c-1;mr!==Fr&&nr[mr]<=Nt;++mr)ar+=ct;--mr;var sn=(Nt-nr[mr])/(nr[mr+1]-nr[mr]),fn=ar+sn*ct,Lr=Mt(fn,Vt,Xt);return Lr>=_?$t(Nt,fn,Vt,Xt):Lr===0?fn:Pt(Nt,ar,ar+ct,Vt,Xt)}},e}(),pooling=function(){function e(i){return i.concat(createSizedArray(i.length))}return{double:e}}(),poolFactory=function(){return function(e,i,s){var a=0,_=e,et=createSizedArray(_),nt={newElement:c,release:ct};function c(){var dt;return a?(a-=1,dt=et[a]):dt=i(),dt}function ct(dt){a===_&&(et=pooling.double(et),_*=2),s&&s(dt),et[a]=dt,a+=1}return nt}}(),bezierLengthPool=function(){function e(){return{addedLength:0,percents:createTypedArray("float32",getDefaultCurveSegments()),lengths:createTypedArray("float32",getDefaultCurveSegments())}}return poolFactory(8,e)}(),segmentsLengthPool=function(){function e(){return{lengths:[],totalLength:0}}function i(s){var a,_=s.lengths.length;for(a=0;a<_;a+=1)bezierLengthPool.release(s.lengths[a]);s.lengths.length=0}return poolFactory(8,e,i)}();function bezFunction(){var e=Math;function i(Et,At,Mt,Pt,$t,Lt){var Bt=Et*Pt+At*$t+Mt*Lt-$t*Pt-Lt*Et-Mt*At;return Bt>-.001&&Bt<.001}function s(Et,At,Mt,Pt,$t,Lt,Bt,Nt,Vt){if(Mt===0&&Lt===0&&Vt===0)return i(Et,At,Pt,$t,Bt,Nt);var Xt=e.sqrt(e.pow(Pt-Et,2)+e.pow($t-At,2)+e.pow(Lt-Mt,2)),nr=e.sqrt(e.pow(Bt-Et,2)+e.pow(Nt-At,2)+e.pow(Vt-Mt,2)),ar=e.sqrt(e.pow(Bt-Pt,2)+e.pow(Nt-$t,2)+e.pow(Vt-Lt,2)),mr;return Xt>nr?Xt>ar?mr=Xt-nr-ar:mr=ar-nr-Xt:ar>nr?mr=ar-nr-Xt:mr=nr-Xt-ar,mr>-1e-4&&mr<1e-4}var a=function(){return function(Et,At,Mt,Pt){var $t=getDefaultCurveSegments(),Lt,Bt,Nt,Vt,Xt,nr=0,ar,mr=[],Fr=[],sn=bezierLengthPool.newElement();for(Nt=Mt.length,Lt=0;Lt<$t;Lt+=1){for(Xt=Lt/($t-1),ar=0,Bt=0;Bt<Nt;Bt+=1)Vt=bmPow(1-Xt,3)*Et[Bt]+3*bmPow(1-Xt,2)*Xt*Mt[Bt]+3*(1-Xt)*bmPow(Xt,2)*Pt[Bt]+bmPow(Xt,3)*At[Bt],mr[Bt]=Vt,Fr[Bt]!==null&&(ar+=bmPow(mr[Bt]-Fr[Bt],2)),Fr[Bt]=mr[Bt];ar&&(ar=bmSqrt(ar),nr+=ar),sn.percents[Lt]=Xt,sn.lengths[Lt]=nr}return sn.addedLength=nr,sn}}();function _(Et){var At=segmentsLengthPool.newElement(),Mt=Et.c,Pt=Et.v,$t=Et.o,Lt=Et.i,Bt,Nt=Et._length,Vt=At.lengths,Xt=0;for(Bt=0;Bt<Nt-1;Bt+=1)Vt[Bt]=a(Pt[Bt],Pt[Bt+1],$t[Bt],Lt[Bt+1]),Xt+=Vt[Bt].addedLength;return Mt&&Nt&&(Vt[Bt]=a(Pt[Bt],Pt[0],$t[Bt],Lt[0]),Xt+=Vt[Bt].addedLength),At.totalLength=Xt,At}function et(Et){this.segmentLength=0,this.points=new Array(Et)}function nt(Et,At){this.partialLength=Et,this.point=At}var c=function(){var Et={};return function(At,Mt,Pt,$t){var Lt=(At[0]+"_"+At[1]+"_"+Mt[0]+"_"+Mt[1]+"_"+Pt[0]+"_"+Pt[1]+"_"+$t[0]+"_"+$t[1]).replace(/\./g,"p");if(!Et[Lt]){var Bt=getDefaultCurveSegments(),Nt,Vt,Xt,nr,ar,mr=0,Fr,sn,fn=null;At.length===2&&(At[0]!==Mt[0]||At[1]!==Mt[1])&&i(At[0],At[1],Mt[0],Mt[1],At[0]+Pt[0],At[1]+Pt[1])&&i(At[0],At[1],Mt[0],Mt[1],Mt[0]+$t[0],Mt[1]+$t[1])&&(Bt=2);var Lr=new et(Bt);for(Xt=Pt.length,Nt=0;Nt<Bt;Nt+=1){for(sn=createSizedArray(Xt),ar=Nt/(Bt-1),Fr=0,Vt=0;Vt<Xt;Vt+=1)nr=bmPow(1-ar,3)*At[Vt]+3*bmPow(1-ar,2)*ar*(At[Vt]+Pt[Vt])+3*(1-ar)*bmPow(ar,2)*(Mt[Vt]+$t[Vt])+bmPow(ar,3)*Mt[Vt],sn[Vt]=nr,fn!==null&&(Fr+=bmPow(sn[Vt]-fn[Vt],2));Fr=bmSqrt(Fr),mr+=Fr,Lr.points[Nt]=new nt(Fr,sn),fn=sn}Lr.segmentLength=mr,Et[Lt]=Lr}return Et[Lt]}}();function ct(Et,At){var Mt=At.percents,Pt=At.lengths,$t=Mt.length,Lt=bmFloor(($t-1)*Et),Bt=Et*At.addedLength,Nt=0;if(Lt===$t-1||Lt===0||Bt===Pt[Lt])return Mt[Lt];for(var Vt=Pt[Lt]>Bt?-1:1,Xt=!0;Xt;)if(Pt[Lt]<=Bt&&Pt[Lt+1]>Bt?(Nt=(Bt-Pt[Lt])/(Pt[Lt+1]-Pt[Lt]),Xt=!1):Lt+=Vt,Lt<0||Lt>=$t-1){if(Lt===$t-1)return Mt[Lt];Xt=!1}return Mt[Lt]+(Mt[Lt+1]-Mt[Lt])*Nt}function dt(Et,At,Mt,Pt,$t,Lt){var Bt=ct($t,Lt),Nt=1-Bt,Vt=e.round((Nt*Nt*Nt*Et[0]+(Bt*Nt*Nt+Nt*Bt*Nt+Nt*Nt*Bt)*Mt[0]+(Bt*Bt*Nt+Nt*Bt*Bt+Bt*Nt*Bt)*Pt[0]+Bt*Bt*Bt*At[0])*1e3)/1e3,Xt=e.round((Nt*Nt*Nt*Et[1]+(Bt*Nt*Nt+Nt*Bt*Nt+Nt*Nt*Bt)*Mt[1]+(Bt*Bt*Nt+Nt*Bt*Bt+Bt*Nt*Bt)*Pt[1]+Bt*Bt*Bt*At[1])*1e3)/1e3;return[Vt,Xt]}var gt=createTypedArray("float32",8);function Tt(Et,At,Mt,Pt,$t,Lt,Bt){$t<0?$t=0:$t>1&&($t=1);var Nt=ct($t,Bt);Lt=Lt>1?1:Lt;var Vt=ct(Lt,Bt),Xt,nr=Et.length,ar=1-Nt,mr=1-Vt,Fr=ar*ar*ar,sn=Nt*ar*ar*3,fn=Nt*Nt*ar*3,Lr=Nt*Nt*Nt,Qr=ar*ar*mr,dn=Nt*ar*mr+ar*Nt*mr+ar*ar*Vt,en=Nt*Nt*mr+ar*Nt*Vt+Nt*ar*Vt,yr=Nt*Nt*Vt,Ar=ar*mr*mr,rr=Nt*mr*mr+ar*Vt*mr+ar*mr*Vt,ur=Nt*Vt*mr+ar*Vt*Vt+Nt*mr*Vt,Br=Nt*Vt*Vt,xr=mr*mr*mr,qr=Vt*mr*mr+mr*Vt*mr+mr*mr*Vt,tn=Vt*Vt*mr+mr*Vt*Vt+Vt*mr*Vt,vn=Vt*Vt*Vt;for(Xt=0;Xt<nr;Xt+=1)gt[Xt*4]=e.round((Fr*Et[Xt]+sn*Mt[Xt]+fn*Pt[Xt]+Lr*At[Xt])*1e3)/1e3,gt[Xt*4+1]=e.round((Qr*Et[Xt]+dn*Mt[Xt]+en*Pt[Xt]+yr*At[Xt])*1e3)/1e3,gt[Xt*4+2]=e.round((Ar*Et[Xt]+rr*Mt[Xt]+ur*Pt[Xt]+Br*At[Xt])*1e3)/1e3,gt[Xt*4+3]=e.round((xr*Et[Xt]+qr*Mt[Xt]+tn*Pt[Xt]+vn*At[Xt])*1e3)/1e3;return gt}return{getSegmentsLength:_,getNewSegment:Tt,getPointInSegment:dt,buildBezierData:c,pointOnLine2D:i,pointOnLine3D:s}}var bez=bezFunction(),initFrame=initialDefaultFrame,mathAbs=Math.abs;function interpolateValue(e,i){var s=this.offsetTime,a;this.propType==="multidimensional"&&(a=createTypedArray("float32",this.pv.length));for(var _=i.lastIndex,et=_,nt=this.keyframes.length-1,c=!0,ct,dt,gt;c;){if(ct=this.keyframes[et],dt=this.keyframes[et+1],et===nt-1&&e>=dt.t-s){ct.h&&(ct=dt),_=0;break}if(dt.t-s>e){_=et;break}et<nt-1?et+=1:(_=0,c=!1)}gt=this.keyframesMetadata[et]||{};var Tt,Et,At,Mt,Pt,$t,Lt=dt.t-s,Bt=ct.t-s,Nt;if(ct.to){gt.bezierData||(gt.bezierData=bez.buildBezierData(ct.s,dt.s||ct.e,ct.to,ct.ti));var Vt=gt.bezierData;if(e>=Lt||e<Bt){var Xt=e>=Lt?Vt.points.length-1:0;for(Et=Vt.points[Xt].point.length,Tt=0;Tt<Et;Tt+=1)a[Tt]=Vt.points[Xt].point[Tt]}else{gt.__fnct?$t=gt.__fnct:($t=BezierFactory.getBezierEasing(ct.o.x,ct.o.y,ct.i.x,ct.i.y,ct.n).get,gt.__fnct=$t),At=$t((e-Bt)/(Lt-Bt));var nr=Vt.segmentLength*At,ar,mr=i.lastFrame<e&&i._lastKeyframeIndex===et?i._lastAddedLength:0;for(Pt=i.lastFrame<e&&i._lastKeyframeIndex===et?i._lastPoint:0,c=!0,Mt=Vt.points.length;c;){if(mr+=Vt.points[Pt].partialLength,nr===0||At===0||Pt===Vt.points.length-1){for(Et=Vt.points[Pt].point.length,Tt=0;Tt<Et;Tt+=1)a[Tt]=Vt.points[Pt].point[Tt];break}else if(nr>=mr&&nr<mr+Vt.points[Pt+1].partialLength){for(ar=(nr-mr)/Vt.points[Pt+1].partialLength,Et=Vt.points[Pt].point.length,Tt=0;Tt<Et;Tt+=1)a[Tt]=Vt.points[Pt].point[Tt]+(Vt.points[Pt+1].point[Tt]-Vt.points[Pt].point[Tt])*ar;break}Pt<Mt-1?Pt+=1:c=!1}i._lastPoint=Pt,i._lastAddedLength=mr-Vt.points[Pt].partialLength,i._lastKeyframeIndex=et}}else{var Fr,sn,fn,Lr,Qr;if(nt=ct.s.length,Nt=dt.s||ct.e,this.sh&&ct.h!==1)if(e>=Lt)a[0]=Nt[0],a[1]=Nt[1],a[2]=Nt[2];else if(e<=Bt)a[0]=ct.s[0],a[1]=ct.s[1],a[2]=ct.s[2];else{var dn=createQuaternion(ct.s),en=createQuaternion(Nt),yr=(e-Bt)/(Lt-Bt);quaternionToEuler(a,slerp(dn,en,yr))}else for(et=0;et<nt;et+=1)ct.h!==1&&(e>=Lt?At=1:e<Bt?At=0:(ct.o.x.constructor===Array?(gt.__fnct||(gt.__fnct=[]),gt.__fnct[et]?$t=gt.__fnct[et]:(Fr=ct.o.x[et]===void 0?ct.o.x[0]:ct.o.x[et],sn=ct.o.y[et]===void 0?ct.o.y[0]:ct.o.y[et],fn=ct.i.x[et]===void 0?ct.i.x[0]:ct.i.x[et],Lr=ct.i.y[et]===void 0?ct.i.y[0]:ct.i.y[et],$t=BezierFactory.getBezierEasing(Fr,sn,fn,Lr).get,gt.__fnct[et]=$t)):gt.__fnct?$t=gt.__fnct:(Fr=ct.o.x,sn=ct.o.y,fn=ct.i.x,Lr=ct.i.y,$t=BezierFactory.getBezierEasing(Fr,sn,fn,Lr).get,ct.keyframeMetadata=$t),At=$t((e-Bt)/(Lt-Bt)))),Nt=dt.s||ct.e,Qr=ct.h===1?ct.s[et]:ct.s[et]+(Nt[et]-ct.s[et])*At,this.propType==="multidimensional"?a[et]=Qr:a=Qr}return i.lastIndex=_,a}function slerp(e,i,s){var a=[],_=e[0],et=e[1],nt=e[2],c=e[3],ct=i[0],dt=i[1],gt=i[2],Tt=i[3],Et,At,Mt,Pt,$t;return At=_*ct+et*dt+nt*gt+c*Tt,At<0&&(At=-At,ct=-ct,dt=-dt,gt=-gt,Tt=-Tt),1-At>1e-6?(Et=Math.acos(At),Mt=Math.sin(Et),Pt=Math.sin((1-s)*Et)/Mt,$t=Math.sin(s*Et)/Mt):(Pt=1-s,$t=s),a[0]=Pt*_+$t*ct,a[1]=Pt*et+$t*dt,a[2]=Pt*nt+$t*gt,a[3]=Pt*c+$t*Tt,a}function quaternionToEuler(e,i){var s=i[0],a=i[1],_=i[2],et=i[3],nt=Math.atan2(2*a*et-2*s*_,1-2*a*a-2*_*_),c=Math.asin(2*s*a+2*_*et),ct=Math.atan2(2*s*et-2*a*_,1-2*s*s-2*_*_);e[0]=nt/degToRads,e[1]=c/degToRads,e[2]=ct/degToRads}function createQuaternion(e){var i=e[0]*degToRads,s=e[1]*degToRads,a=e[2]*degToRads,_=Math.cos(i/2),et=Math.cos(s/2),nt=Math.cos(a/2),c=Math.sin(i/2),ct=Math.sin(s/2),dt=Math.sin(a/2),gt=_*et*nt-c*ct*dt,Tt=c*ct*nt+_*et*dt,Et=c*et*nt+_*ct*dt,At=_*ct*nt-c*et*dt;return[Tt,Et,At,gt]}function getValueAtCurrentTime(){var e=this.comp.renderedFrame-this.offsetTime,i=this.keyframes[0].t-this.offsetTime,s=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(e===this._caching.lastFrame||this._caching.lastFrame!==initFrame&&(this._caching.lastFrame>=s&&e>=s||this._caching.lastFrame<i&&e<i))){this._caching.lastFrame>=e&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var a=this.interpolateValue(e,this._caching);this.pv=a}return this._caching.lastFrame=e,this.pv}function setVValue(e){var i;if(this.propType==="unidimensional")i=e*this.mult,mathAbs(this.v-i)>1e-5&&(this.v=i,this._mdf=!0);else for(var s=0,a=this.v.length;s<a;)i=e[s]*this.mult,mathAbs(this.v[s]-i)>1e-5&&(this.v[s]=i,this._mdf=!0),s+=1}function processEffectsSequence(){if(!(this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)){if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=this._isFirstFrame;var e,i=this.effectsSequence.length,s=this.kf?this.pv:this.data.k;for(e=0;e<i;e+=1)s=this.effectsSequence[e](s);this.setVValue(s),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function addEffect(e){this.effectsSequence.push(e),this.container.addDynamicProperty(this)}function ValueProperty(e,i,s,a){this.propType="unidimensional",this.mult=s||1,this.data=i,this.v=s?i.k*s:i.k,this.pv=i.k,this._mdf=!1,this.elem=e,this.container=a,this.comp=e.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function MultiDimensionalProperty(e,i,s,a){this.propType="multidimensional",this.mult=s||1,this.data=i,this._mdf=!1,this.elem=e,this.container=a,this.comp=e.comp,this.k=!1,this.kf=!1,this.frameId=-1;var _,et=i.k.length;for(this.v=createTypedArray("float32",et),this.pv=createTypedArray("float32",et),this.vel=createTypedArray("float32",et),_=0;_<et;_+=1)this.v[_]=i.k[_]*this.mult,this.pv[_]=i.k[_];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function KeyframedValueProperty(e,i,s,a){this.propType="unidimensional",this.keyframes=i.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.frameId=-1,this._caching={lastFrame:initFrame,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=i,this.mult=s||1,this.elem=e,this.container=a,this.comp=e.comp,this.v=initFrame,this.pv=initFrame,this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.addEffect=addEffect}function KeyframedMultidimensionalProperty(e,i,s,a){this.propType="multidimensional";var _,et=i.k.length,nt,c,ct,dt;for(_=0;_<et-1;_+=1)i.k[_].to&&i.k[_].s&&i.k[_+1]&&i.k[_+1].s&&(nt=i.k[_].s,c=i.k[_+1].s,ct=i.k[_].to,dt=i.k[_].ti,(nt.length===2&&!(nt[0]===c[0]&&nt[1]===c[1])&&bez.pointOnLine2D(nt[0],nt[1],c[0],c[1],nt[0]+ct[0],nt[1]+ct[1])&&bez.pointOnLine2D(nt[0],nt[1],c[0],c[1],c[0]+dt[0],c[1]+dt[1])||nt.length===3&&!(nt[0]===c[0]&&nt[1]===c[1]&&nt[2]===c[2])&&bez.pointOnLine3D(nt[0],nt[1],nt[2],c[0],c[1],c[2],nt[0]+ct[0],nt[1]+ct[1],nt[2]+ct[2])&&bez.pointOnLine3D(nt[0],nt[1],nt[2],c[0],c[1],c[2],c[0]+dt[0],c[1]+dt[1],c[2]+dt[2]))&&(i.k[_].to=null,i.k[_].ti=null),nt[0]===c[0]&&nt[1]===c[1]&&ct[0]===0&&ct[1]===0&&dt[0]===0&&dt[1]===0&&(nt.length===2||nt[2]===c[2]&&ct[2]===0&&dt[2]===0)&&(i.k[_].to=null,i.k[_].ti=null));this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.data=i,this.keyframes=i.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=s||1,this.elem=e,this.container=a,this.comp=e.comp,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.frameId=-1;var gt=i.k[0].s.length;for(this.v=createTypedArray("float32",gt),this.pv=createTypedArray("float32",gt),_=0;_<gt;_+=1)this.v[_]=initFrame,this.pv[_]=initFrame;this._caching={lastFrame:initFrame,lastIndex:0,value:createTypedArray("float32",gt)},this.addEffect=addEffect}var PropertyFactory=function(){function e(s,a,_,et,nt){a.sid&&(a=s.globalData.slotManager.getProp(a));var c;if(!a.k.length)c=new ValueProperty(s,a,et,nt);else if(typeof a.k[0]=="number")c=new MultiDimensionalProperty(s,a,et,nt);else switch(_){case 0:c=new KeyframedValueProperty(s,a,et,nt);break;case 1:c=new KeyframedMultidimensionalProperty(s,a,et,nt);break}return c.effectsSequence.length&&nt.addDynamicProperty(c),c}var i={getProp:e};return i}();function DynamicPropertyContainer(){}DynamicPropertyContainer.prototype={addDynamicProperty:function(i){this.dynamicProperties.indexOf(i)===-1&&(this.dynamicProperties.push(i),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){this._mdf=!1;var i,s=this.dynamicProperties.length;for(i=0;i<s;i+=1)this.dynamicProperties[i].getValue(),this.dynamicProperties[i]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(i){this.container=i,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};var pointPool=function(){function e(){return createTypedArray("float32",2)}return poolFactory(8,e)}();function ShapePath(){this.c=!1,this._length=0,this._maxLength=8,this.v=createSizedArray(this._maxLength),this.o=createSizedArray(this._maxLength),this.i=createSizedArray(this._maxLength)}ShapePath.prototype.setPathData=function(e,i){this.c=e,this.setLength(i);for(var s=0;s<i;)this.v[s]=pointPool.newElement(),this.o[s]=pointPool.newElement(),this.i[s]=pointPool.newElement(),s+=1},ShapePath.prototype.setLength=function(e){for(;this._maxLength<e;)this.doubleArrayLength();this._length=e},ShapePath.prototype.doubleArrayLength=function(){this.v=this.v.concat(createSizedArray(this._maxLength)),this.i=this.i.concat(createSizedArray(this._maxLength)),this.o=this.o.concat(createSizedArray(this._maxLength)),this._maxLength*=2},ShapePath.prototype.setXYAt=function(e,i,s,a,_){var et;switch(this._length=Math.max(this._length,a+1),this._length>=this._maxLength&&this.doubleArrayLength(),s){case"v":et=this.v;break;case"i":et=this.i;break;case"o":et=this.o;break;default:et=[];break}(!et[a]||et[a]&&!_)&&(et[a]=pointPool.newElement()),et[a][0]=e,et[a][1]=i},ShapePath.prototype.setTripleAt=function(e,i,s,a,_,et,nt,c){this.setXYAt(e,i,"v",nt,c),this.setXYAt(s,a,"o",nt,c),this.setXYAt(_,et,"i",nt,c)},ShapePath.prototype.reverse=function(){var e=new ShapePath;e.setPathData(this.c,this._length);var i=this.v,s=this.o,a=this.i,_=0;this.c&&(e.setTripleAt(i[0][0],i[0][1],a[0][0],a[0][1],s[0][0],s[0][1],0,!1),_=1);var et=this._length-1,nt=this._length,c;for(c=_;c<nt;c+=1)e.setTripleAt(i[et][0],i[et][1],a[et][0],a[et][1],s[et][0],s[et][1],c,!1),et-=1;return e},ShapePath.prototype.length=function(){return this._length};var shapePool=function(){function e(){return new ShapePath}function i(_){var et=_._length,nt;for(nt=0;nt<et;nt+=1)pointPool.release(_.v[nt]),pointPool.release(_.i[nt]),pointPool.release(_.o[nt]),_.v[nt]=null,_.i[nt]=null,_.o[nt]=null;_._length=0,_.c=!1}function s(_){var et=a.newElement(),nt,c=_._length===void 0?_.v.length:_._length;for(et.setLength(c),et.c=_.c,nt=0;nt<c;nt+=1)et.setTripleAt(_.v[nt][0],_.v[nt][1],_.o[nt][0],_.o[nt][1],_.i[nt][0],_.i[nt][1],nt);return et}var a=poolFactory(4,e,i);return a.clone=s,a}();function ShapeCollection(){this._length=0,this._maxLength=4,this.shapes=createSizedArray(this._maxLength)}ShapeCollection.prototype.addShape=function(e){this._length===this._maxLength&&(this.shapes=this.shapes.concat(createSizedArray(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=e,this._length+=1},ShapeCollection.prototype.releaseShapes=function(){var e;for(e=0;e<this._length;e+=1)shapePool.release(this.shapes[e]);this._length=0};var shapeCollectionPool=function(){var e={newShapeCollection:_,release:et},i=0,s=4,a=createSizedArray(s);function _(){var nt;return i?(i-=1,nt=a[i]):nt=new ShapeCollection,nt}function et(nt){var c,ct=nt._length;for(c=0;c<ct;c+=1)shapePool.release(nt.shapes[c]);nt._length=0,i===s&&(a=pooling.double(a),s*=2),a[i]=nt,i+=1}return e}(),ShapePropertyFactory=function(){var e=-999999;function i(Lt,Bt,Nt){var Vt=Nt.lastIndex,Xt,nr,ar,mr,Fr,sn,fn,Lr,Qr,dn=this.keyframes;if(Lt<dn[0].t-this.offsetTime)Xt=dn[0].s[0],ar=!0,Vt=0;else if(Lt>=dn[dn.length-1].t-this.offsetTime)Xt=dn[dn.length-1].s?dn[dn.length-1].s[0]:dn[dn.length-2].e[0],ar=!0;else{for(var en=Vt,yr=dn.length-1,Ar=!0,rr,ur,Br;Ar&&(rr=dn[en],ur=dn[en+1],!(ur.t-this.offsetTime>Lt));)en<yr-1?en+=1:Ar=!1;if(Br=this.keyframesMetadata[en]||{},ar=rr.h===1,Vt=en,!ar){if(Lt>=ur.t-this.offsetTime)Lr=1;else if(Lt<rr.t-this.offsetTime)Lr=0;else{var xr;Br.__fnct?xr=Br.__fnct:(xr=BezierFactory.getBezierEasing(rr.o.x,rr.o.y,rr.i.x,rr.i.y).get,Br.__fnct=xr),Lr=xr((Lt-(rr.t-this.offsetTime))/(ur.t-this.offsetTime-(rr.t-this.offsetTime)))}nr=ur.s?ur.s[0]:rr.e[0]}Xt=rr.s[0]}for(sn=Bt._length,fn=Xt.i[0].length,Nt.lastIndex=Vt,mr=0;mr<sn;mr+=1)for(Fr=0;Fr<fn;Fr+=1)Qr=ar?Xt.i[mr][Fr]:Xt.i[mr][Fr]+(nr.i[mr][Fr]-Xt.i[mr][Fr])*Lr,Bt.i[mr][Fr]=Qr,Qr=ar?Xt.o[mr][Fr]:Xt.o[mr][Fr]+(nr.o[mr][Fr]-Xt.o[mr][Fr])*Lr,Bt.o[mr][Fr]=Qr,Qr=ar?Xt.v[mr][Fr]:Xt.v[mr][Fr]+(nr.v[mr][Fr]-Xt.v[mr][Fr])*Lr,Bt.v[mr][Fr]=Qr}function s(){var Lt=this.comp.renderedFrame-this.offsetTime,Bt=this.keyframes[0].t-this.offsetTime,Nt=this.keyframes[this.keyframes.length-1].t-this.offsetTime,Vt=this._caching.lastFrame;return Vt!==e&&(Vt<Bt&&Lt<Bt||Vt>Nt&&Lt>Nt)||(this._caching.lastIndex=Vt<Lt?this._caching.lastIndex:0,this.interpolateShape(Lt,this.pv,this._caching)),this._caching.lastFrame=Lt,this.pv}function a(){this.paths=this.localShapeCollection}function _(Lt,Bt){if(Lt._length!==Bt._length||Lt.c!==Bt.c)return!1;var Nt,Vt=Lt._length;for(Nt=0;Nt<Vt;Nt+=1)if(Lt.v[Nt][0]!==Bt.v[Nt][0]||Lt.v[Nt][1]!==Bt.v[Nt][1]||Lt.o[Nt][0]!==Bt.o[Nt][0]||Lt.o[Nt][1]!==Bt.o[Nt][1]||Lt.i[Nt][0]!==Bt.i[Nt][0]||Lt.i[Nt][1]!==Bt.i[Nt][1])return!1;return!0}function et(Lt){_(this.v,Lt)||(this.v=shapePool.clone(Lt),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function nt(){if(this.elem.globalData.frameId!==this.frameId){if(!this.effectsSequence.length){this._mdf=!1;return}if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=!1;var Lt;this.kf?Lt=this.pv:this.data.ks?Lt=this.data.ks.k:Lt=this.data.pt.k;var Bt,Nt=this.effectsSequence.length;for(Bt=0;Bt<Nt;Bt+=1)Lt=this.effectsSequence[Bt](Lt);this.setVValue(Lt),this.lock=!1,this.frameId=this.elem.globalData.frameId}}function c(Lt,Bt,Nt){this.propType="shape",this.comp=Lt.comp,this.container=Lt,this.elem=Lt,this.data=Bt,this.k=!1,this.kf=!1,this._mdf=!1;var Vt=Nt===3?Bt.pt.k:Bt.ks.k;this.v=shapePool.clone(Vt),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=a,this.effectsSequence=[]}function ct(Lt){this.effectsSequence.push(Lt),this.container.addDynamicProperty(this)}c.prototype.interpolateShape=i,c.prototype.getValue=nt,c.prototype.setVValue=et,c.prototype.addEffect=ct;function dt(Lt,Bt,Nt){this.propType="shape",this.comp=Lt.comp,this.elem=Lt,this.container=Lt,this.offsetTime=Lt.data.st,this.keyframes=Nt===3?Bt.pt.k:Bt.ks.k,this.keyframesMetadata=[],this.k=!0,this.kf=!0;var Vt=this.keyframes[0].s[0].i.length;this.v=shapePool.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,Vt),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=e,this.reset=a,this._caching={lastFrame:e,lastIndex:0},this.effectsSequence=[s.bind(this)]}dt.prototype.getValue=nt,dt.prototype.interpolateShape=i,dt.prototype.setVValue=et,dt.prototype.addEffect=ct;var gt=function(){var Lt=roundCorner;function Bt(Nt,Vt){this.v=shapePool.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=Vt.d,this.elem=Nt,this.comp=Nt.comp,this.frameId=-1,this.initDynamicPropertyContainer(Nt),this.p=PropertyFactory.getProp(Nt,Vt.p,1,0,this),this.s=PropertyFactory.getProp(Nt,Vt.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return Bt.prototype={reset:a,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var Vt=this.p.v[0],Xt=this.p.v[1],nr=this.s.v[0]/2,ar=this.s.v[1]/2,mr=this.d!==3,Fr=this.v;Fr.v[0][0]=Vt,Fr.v[0][1]=Xt-ar,Fr.v[1][0]=mr?Vt+nr:Vt-nr,Fr.v[1][1]=Xt,Fr.v[2][0]=Vt,Fr.v[2][1]=Xt+ar,Fr.v[3][0]=mr?Vt-nr:Vt+nr,Fr.v[3][1]=Xt,Fr.i[0][0]=mr?Vt-nr*Lt:Vt+nr*Lt,Fr.i[0][1]=Xt-ar,Fr.i[1][0]=mr?Vt+nr:Vt-nr,Fr.i[1][1]=Xt-ar*Lt,Fr.i[2][0]=mr?Vt+nr*Lt:Vt-nr*Lt,Fr.i[2][1]=Xt+ar,Fr.i[3][0]=mr?Vt-nr:Vt+nr,Fr.i[3][1]=Xt+ar*Lt,Fr.o[0][0]=mr?Vt+nr*Lt:Vt-nr*Lt,Fr.o[0][1]=Xt-ar,Fr.o[1][0]=mr?Vt+nr:Vt-nr,Fr.o[1][1]=Xt+ar*Lt,Fr.o[2][0]=mr?Vt-nr*Lt:Vt+nr*Lt,Fr.o[2][1]=Xt+ar,Fr.o[3][0]=mr?Vt-nr:Vt+nr,Fr.o[3][1]=Xt-ar*Lt}},extendPrototype([DynamicPropertyContainer],Bt),Bt}(),Tt=function(){function Lt(Bt,Nt){this.v=shapePool.newElement(),this.v.setPathData(!0,0),this.elem=Bt,this.comp=Bt.comp,this.data=Nt,this.frameId=-1,this.d=Nt.d,this.initDynamicPropertyContainer(Bt),Nt.sy===1?(this.ir=PropertyFactory.getProp(Bt,Nt.ir,0,0,this),this.is=PropertyFactory.getProp(Bt,Nt.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=PropertyFactory.getProp(Bt,Nt.pt,0,0,this),this.p=PropertyFactory.getProp(Bt,Nt.p,1,0,this),this.r=PropertyFactory.getProp(Bt,Nt.r,0,degToRads,this),this.or=PropertyFactory.getProp(Bt,Nt.or,0,0,this),this.os=PropertyFactory.getProp(Bt,Nt.os,0,.01,this),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return Lt.prototype={reset:a,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var Nt=Math.floor(this.pt.v)*2,Vt=Math.PI*2/Nt,Xt=!0,nr=this.or.v,ar=this.ir.v,mr=this.os.v,Fr=this.is.v,sn=2*Math.PI*nr/(Nt*2),fn=2*Math.PI*ar/(Nt*2),Lr,Qr,dn,en,yr=-Math.PI/2;yr+=this.r.v;var Ar=this.data.d===3?-1:1;for(this.v._length=0,Lr=0;Lr<Nt;Lr+=1){Qr=Xt?nr:ar,dn=Xt?mr:Fr,en=Xt?sn:fn;var rr=Qr*Math.cos(yr),ur=Qr*Math.sin(yr),Br=rr===0&&ur===0?0:ur/Math.sqrt(rr*rr+ur*ur),xr=rr===0&&ur===0?0:-rr/Math.sqrt(rr*rr+ur*ur);rr+=+this.p.v[0],ur+=+this.p.v[1],this.v.setTripleAt(rr,ur,rr-Br*en*dn*Ar,ur-xr*en*dn*Ar,rr+Br*en*dn*Ar,ur+xr*en*dn*Ar,Lr,!0),Xt=!Xt,yr+=Vt*Ar}},convertPolygonToPath:function(){var Nt=Math.floor(this.pt.v),Vt=Math.PI*2/Nt,Xt=this.or.v,nr=this.os.v,ar=2*Math.PI*Xt/(Nt*4),mr,Fr=-Math.PI*.5,sn=this.data.d===3?-1:1;for(Fr+=this.r.v,this.v._length=0,mr=0;mr<Nt;mr+=1){var fn=Xt*Math.cos(Fr),Lr=Xt*Math.sin(Fr),Qr=fn===0&&Lr===0?0:Lr/Math.sqrt(fn*fn+Lr*Lr),dn=fn===0&&Lr===0?0:-fn/Math.sqrt(fn*fn+Lr*Lr);fn+=+this.p.v[0],Lr+=+this.p.v[1],this.v.setTripleAt(fn,Lr,fn-Qr*ar*nr*sn,Lr-dn*ar*nr*sn,fn+Qr*ar*nr*sn,Lr+dn*ar*nr*sn,mr,!0),Fr+=Vt*sn}this.paths.length=0,this.paths[0]=this.v}},extendPrototype([DynamicPropertyContainer],Lt),Lt}(),Et=function(){function Lt(Bt,Nt){this.v=shapePool.newElement(),this.v.c=!0,this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=Bt,this.comp=Bt.comp,this.frameId=-1,this.d=Nt.d,this.initDynamicPropertyContainer(Bt),this.p=PropertyFactory.getProp(Bt,Nt.p,1,0,this),this.s=PropertyFactory.getProp(Bt,Nt.s,1,0,this),this.r=PropertyFactory.getProp(Bt,Nt.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return Lt.prototype={convertRectToPath:function(){var Nt=this.p.v[0],Vt=this.p.v[1],Xt=this.s.v[0]/2,nr=this.s.v[1]/2,ar=bmMin(Xt,nr,this.r.v),mr=ar*(1-roundCorner);this.v._length=0,this.d===2||this.d===1?(this.v.setTripleAt(Nt+Xt,Vt-nr+ar,Nt+Xt,Vt-nr+ar,Nt+Xt,Vt-nr+mr,0,!0),this.v.setTripleAt(Nt+Xt,Vt+nr-ar,Nt+Xt,Vt+nr-mr,Nt+Xt,Vt+nr-ar,1,!0),ar!==0?(this.v.setTripleAt(Nt+Xt-ar,Vt+nr,Nt+Xt-ar,Vt+nr,Nt+Xt-mr,Vt+nr,2,!0),this.v.setTripleAt(Nt-Xt+ar,Vt+nr,Nt-Xt+mr,Vt+nr,Nt-Xt+ar,Vt+nr,3,!0),this.v.setTripleAt(Nt-Xt,Vt+nr-ar,Nt-Xt,Vt+nr-ar,Nt-Xt,Vt+nr-mr,4,!0),this.v.setTripleAt(Nt-Xt,Vt-nr+ar,Nt-Xt,Vt-nr+mr,Nt-Xt,Vt-nr+ar,5,!0),this.v.setTripleAt(Nt-Xt+ar,Vt-nr,Nt-Xt+ar,Vt-nr,Nt-Xt+mr,Vt-nr,6,!0),this.v.setTripleAt(Nt+Xt-ar,Vt-nr,Nt+Xt-mr,Vt-nr,Nt+Xt-ar,Vt-nr,7,!0)):(this.v.setTripleAt(Nt-Xt,Vt+nr,Nt-Xt+mr,Vt+nr,Nt-Xt,Vt+nr,2),this.v.setTripleAt(Nt-Xt,Vt-nr,Nt-Xt,Vt-nr+mr,Nt-Xt,Vt-nr,3))):(this.v.setTripleAt(Nt+Xt,Vt-nr+ar,Nt+Xt,Vt-nr+mr,Nt+Xt,Vt-nr+ar,0,!0),ar!==0?(this.v.setTripleAt(Nt+Xt-ar,Vt-nr,Nt+Xt-ar,Vt-nr,Nt+Xt-mr,Vt-nr,1,!0),this.v.setTripleAt(Nt-Xt+ar,Vt-nr,Nt-Xt+mr,Vt-nr,Nt-Xt+ar,Vt-nr,2,!0),this.v.setTripleAt(Nt-Xt,Vt-nr+ar,Nt-Xt,Vt-nr+ar,Nt-Xt,Vt-nr+mr,3,!0),this.v.setTripleAt(Nt-Xt,Vt+nr-ar,Nt-Xt,Vt+nr-mr,Nt-Xt,Vt+nr-ar,4,!0),this.v.setTripleAt(Nt-Xt+ar,Vt+nr,Nt-Xt+ar,Vt+nr,Nt-Xt+mr,Vt+nr,5,!0),this.v.setTripleAt(Nt+Xt-ar,Vt+nr,Nt+Xt-mr,Vt+nr,Nt+Xt-ar,Vt+nr,6,!0),this.v.setTripleAt(Nt+Xt,Vt+nr-ar,Nt+Xt,Vt+nr-ar,Nt+Xt,Vt+nr-mr,7,!0)):(this.v.setTripleAt(Nt-Xt,Vt-nr,Nt-Xt+mr,Vt-nr,Nt-Xt,Vt-nr,1,!0),this.v.setTripleAt(Nt-Xt,Vt+nr,Nt-Xt,Vt+nr-mr,Nt-Xt,Vt+nr,2,!0),this.v.setTripleAt(Nt+Xt,Vt+nr,Nt+Xt-mr,Vt+nr,Nt+Xt,Vt+nr,3,!0)))},getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:a},extendPrototype([DynamicPropertyContainer],Lt),Lt}();function At(Lt,Bt,Nt){var Vt;if(Nt===3||Nt===4){var Xt=Nt===3?Bt.pt:Bt.ks,nr=Xt.k;nr.length?Vt=new dt(Lt,Bt,Nt):Vt=new c(Lt,Bt,Nt)}else Nt===5?Vt=new Et(Lt,Bt):Nt===6?Vt=new gt(Lt,Bt):Nt===7&&(Vt=new Tt(Lt,Bt));return Vt.k&&Lt.addDynamicProperty(Vt),Vt}function Mt(){return c}function Pt(){return dt}var $t={};return $t.getShapeProp=At,$t.getConstructorFunction=Mt,$t.getKeyframedConstructorFunction=Pt,$t}();/*!
 Transformation Matrix v2.0
 (c) Epistemex 2014-2015
 www.epistemex.com
 By Ken Fyrstenberg
 Contributions by leeoniya.
 License: MIT, header required.
 */var Matrix=function(){var e=Math.cos,i=Math.sin,s=Math.tan,a=Math.round;function _(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function et(rr){if(rr===0)return this;var ur=e(rr),Br=i(rr);return this._t(ur,-Br,0,0,Br,ur,0,0,0,0,1,0,0,0,0,1)}function nt(rr){if(rr===0)return this;var ur=e(rr),Br=i(rr);return this._t(1,0,0,0,0,ur,-Br,0,0,Br,ur,0,0,0,0,1)}function c(rr){if(rr===0)return this;var ur=e(rr),Br=i(rr);return this._t(ur,0,Br,0,0,1,0,0,-Br,0,ur,0,0,0,0,1)}function ct(rr){if(rr===0)return this;var ur=e(rr),Br=i(rr);return this._t(ur,-Br,0,0,Br,ur,0,0,0,0,1,0,0,0,0,1)}function dt(rr,ur){return this._t(1,ur,rr,1,0,0)}function gt(rr,ur){return this.shear(s(rr),s(ur))}function Tt(rr,ur){var Br=e(ur),xr=i(ur);return this._t(Br,xr,0,0,-xr,Br,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,s(rr),1,0,0,0,0,1,0,0,0,0,1)._t(Br,-xr,0,0,xr,Br,0,0,0,0,1,0,0,0,0,1)}function Et(rr,ur,Br){return!Br&&Br!==0&&(Br=1),rr===1&&ur===1&&Br===1?this:this._t(rr,0,0,0,0,ur,0,0,0,0,Br,0,0,0,0,1)}function At(rr,ur,Br,xr,qr,tn,vn,hs,Ts,ss,Mn,ds,gs,ys,Hs,_s){return this.props[0]=rr,this.props[1]=ur,this.props[2]=Br,this.props[3]=xr,this.props[4]=qr,this.props[5]=tn,this.props[6]=vn,this.props[7]=hs,this.props[8]=Ts,this.props[9]=ss,this.props[10]=Mn,this.props[11]=ds,this.props[12]=gs,this.props[13]=ys,this.props[14]=Hs,this.props[15]=_s,this}function Mt(rr,ur,Br){return Br=Br||0,rr!==0||ur!==0||Br!==0?this._t(1,0,0,0,0,1,0,0,0,0,1,0,rr,ur,Br,1):this}function Pt(rr,ur,Br,xr,qr,tn,vn,hs,Ts,ss,Mn,ds,gs,ys,Hs,_s){var Ss=this.props;if(rr===1&&ur===0&&Br===0&&xr===0&&qr===0&&tn===1&&vn===0&&hs===0&&Ts===0&&ss===0&&Mn===1&&ds===0)return Ss[12]=Ss[12]*rr+Ss[15]*gs,Ss[13]=Ss[13]*tn+Ss[15]*ys,Ss[14]=Ss[14]*Mn+Ss[15]*Hs,Ss[15]*=_s,this._identityCalculated=!1,this;var Vl=Ss[0],ba=Ss[1],Qo=Ss[2],wo=Ss[3],cu=Ss[4],uu=Ss[5],Pl=Ss[6],Jl=Ss[7],Ul=Ss[8],xl=Ss[9],Yn=Ss[10],xn=Ss[11],Qn=Ss[12],os=Ss[13],Ks=Ss[14],oo=Ss[15];return Ss[0]=Vl*rr+ba*qr+Qo*Ts+wo*gs,Ss[1]=Vl*ur+ba*tn+Qo*ss+wo*ys,Ss[2]=Vl*Br+ba*vn+Qo*Mn+wo*Hs,Ss[3]=Vl*xr+ba*hs+Qo*ds+wo*_s,Ss[4]=cu*rr+uu*qr+Pl*Ts+Jl*gs,Ss[5]=cu*ur+uu*tn+Pl*ss+Jl*ys,Ss[6]=cu*Br+uu*vn+Pl*Mn+Jl*Hs,Ss[7]=cu*xr+uu*hs+Pl*ds+Jl*_s,Ss[8]=Ul*rr+xl*qr+Yn*Ts+xn*gs,Ss[9]=Ul*ur+xl*tn+Yn*ss+xn*ys,Ss[10]=Ul*Br+xl*vn+Yn*Mn+xn*Hs,Ss[11]=Ul*xr+xl*hs+Yn*ds+xn*_s,Ss[12]=Qn*rr+os*qr+Ks*Ts+oo*gs,Ss[13]=Qn*ur+os*tn+Ks*ss+oo*ys,Ss[14]=Qn*Br+os*vn+Ks*Mn+oo*Hs,Ss[15]=Qn*xr+os*hs+Ks*ds+oo*_s,this._identityCalculated=!1,this}function $t(rr){var ur=rr.props;return this.transform(ur[0],ur[1],ur[2],ur[3],ur[4],ur[5],ur[6],ur[7],ur[8],ur[9],ur[10],ur[11],ur[12],ur[13],ur[14],ur[15])}function Lt(){return this._identityCalculated||(this._identity=!(this.props[0]!==1||this.props[1]!==0||this.props[2]!==0||this.props[3]!==0||this.props[4]!==0||this.props[5]!==1||this.props[6]!==0||this.props[7]!==0||this.props[8]!==0||this.props[9]!==0||this.props[10]!==1||this.props[11]!==0||this.props[12]!==0||this.props[13]!==0||this.props[14]!==0||this.props[15]!==1),this._identityCalculated=!0),this._identity}function Bt(rr){for(var ur=0;ur<16;){if(rr.props[ur]!==this.props[ur])return!1;ur+=1}return!0}function Nt(rr){var ur;for(ur=0;ur<16;ur+=1)rr.props[ur]=this.props[ur];return rr}function Vt(rr){var ur;for(ur=0;ur<16;ur+=1)this.props[ur]=rr[ur]}function Xt(rr,ur,Br){return{x:rr*this.props[0]+ur*this.props[4]+Br*this.props[8]+this.props[12],y:rr*this.props[1]+ur*this.props[5]+Br*this.props[9]+this.props[13],z:rr*this.props[2]+ur*this.props[6]+Br*this.props[10]+this.props[14]}}function nr(rr,ur,Br){return rr*this.props[0]+ur*this.props[4]+Br*this.props[8]+this.props[12]}function ar(rr,ur,Br){return rr*this.props[1]+ur*this.props[5]+Br*this.props[9]+this.props[13]}function mr(rr,ur,Br){return rr*this.props[2]+ur*this.props[6]+Br*this.props[10]+this.props[14]}function Fr(){var rr=this.props[0]*this.props[5]-this.props[1]*this.props[4],ur=this.props[5]/rr,Br=-this.props[1]/rr,xr=-this.props[4]/rr,qr=this.props[0]/rr,tn=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/rr,vn=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/rr,hs=new Matrix;return hs.props[0]=ur,hs.props[1]=Br,hs.props[4]=xr,hs.props[5]=qr,hs.props[12]=tn,hs.props[13]=vn,hs}function sn(rr){var ur=this.getInverseMatrix();return ur.applyToPointArray(rr[0],rr[1],rr[2]||0)}function fn(rr){var ur,Br=rr.length,xr=[];for(ur=0;ur<Br;ur+=1)xr[ur]=sn(rr[ur]);return xr}function Lr(rr,ur,Br){var xr=createTypedArray("float32",6);if(this.isIdentity())xr[0]=rr[0],xr[1]=rr[1],xr[2]=ur[0],xr[3]=ur[1],xr[4]=Br[0],xr[5]=Br[1];else{var qr=this.props[0],tn=this.props[1],vn=this.props[4],hs=this.props[5],Ts=this.props[12],ss=this.props[13];xr[0]=rr[0]*qr+rr[1]*vn+Ts,xr[1]=rr[0]*tn+rr[1]*hs+ss,xr[2]=ur[0]*qr+ur[1]*vn+Ts,xr[3]=ur[0]*tn+ur[1]*hs+ss,xr[4]=Br[0]*qr+Br[1]*vn+Ts,xr[5]=Br[0]*tn+Br[1]*hs+ss}return xr}function Qr(rr,ur,Br){var xr;return this.isIdentity()?xr=[rr,ur,Br]:xr=[rr*this.props[0]+ur*this.props[4]+Br*this.props[8]+this.props[12],rr*this.props[1]+ur*this.props[5]+Br*this.props[9]+this.props[13],rr*this.props[2]+ur*this.props[6]+Br*this.props[10]+this.props[14]],xr}function dn(rr,ur){if(this.isIdentity())return rr+","+ur;var Br=this.props;return Math.round((rr*Br[0]+ur*Br[4]+Br[12])*100)/100+","+Math.round((rr*Br[1]+ur*Br[5]+Br[13])*100)/100}function en(){for(var rr=0,ur=this.props,Br="matrix3d(",xr=1e4;rr<16;)Br+=a(ur[rr]*xr)/xr,Br+=rr===15?")":",",rr+=1;return Br}function yr(rr){var ur=1e4;return rr<1e-6&&rr>0||rr>-1e-6&&rr<0?a(rr*ur)/ur:rr}function Ar(){var rr=this.props,ur=yr(rr[0]),Br=yr(rr[1]),xr=yr(rr[4]),qr=yr(rr[5]),tn=yr(rr[12]),vn=yr(rr[13]);return"matrix("+ur+","+Br+","+xr+","+qr+","+tn+","+vn+")"}return function(){this.reset=_,this.rotate=et,this.rotateX=nt,this.rotateY=c,this.rotateZ=ct,this.skew=gt,this.skewFromAxis=Tt,this.shear=dt,this.scale=Et,this.setTransform=At,this.translate=Mt,this.transform=Pt,this.multiply=$t,this.applyToPoint=Xt,this.applyToX=nr,this.applyToY=ar,this.applyToZ=mr,this.applyToPointArray=Qr,this.applyToTriplePoints=Lr,this.applyToPointStringified=dn,this.toCSS=en,this.to2dCSS=Ar,this.clone=Nt,this.cloneFromProps=Vt,this.equals=Bt,this.inversePoints=fn,this.inversePoint=sn,this.getInverseMatrix=Fr,this._t=this.transform,this.isIdentity=Lt,this._identity=!0,this._identityCalculated=!1,this.props=createTypedArray("float32",16),this.reset()}}();function _typeof$3(e){"@babel/helpers - typeof";return _typeof$3=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$3(e)}var lottie={};function setLocation(e){setLocationHref(e)}function searchAnimations(){animationManager.searchAnimations()}function setSubframeRendering(e){setSubframeEnabled(e)}function setPrefix(e){setIdPrefix(e)}function loadAnimation(e){return animationManager.loadAnimation(e)}function setQuality(e){if(typeof e=="string")switch(e){case"high":setDefaultCurveSegments(200);break;default:case"medium":setDefaultCurveSegments(50);break;case"low":setDefaultCurveSegments(10);break}else!isNaN(e)&&e>1&&setDefaultCurveSegments(e)}function inBrowser(){return typeof navigator<"u"}function installPlugin(e,i){e==="expressions"&&setExpressionsPlugin(i)}function getFactory(e){switch(e){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix;default:return null}}lottie.play=animationManager.play,lottie.pause=animationManager.pause,lottie.setLocationHref=setLocation,lottie.togglePause=animationManager.togglePause,lottie.setSpeed=animationManager.setSpeed,lottie.setDirection=animationManager.setDirection,lottie.stop=animationManager.stop,lottie.searchAnimations=searchAnimations,lottie.registerAnimation=animationManager.registerAnimation,lottie.loadAnimation=loadAnimation,lottie.setSubframeRendering=setSubframeRendering,lottie.resize=animationManager.resize,lottie.goToAndStop=animationManager.goToAndStop,lottie.destroy=animationManager.destroy,lottie.setQuality=setQuality,lottie.inBrowser=inBrowser,lottie.installPlugin=installPlugin,lottie.freeze=animationManager.freeze,lottie.unfreeze=animationManager.unfreeze,lottie.setVolume=animationManager.setVolume,lottie.mute=animationManager.mute,lottie.unmute=animationManager.unmute,lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations,lottie.useWebWorker=setWebWorker,lottie.setIDPrefix=setPrefix,lottie.__getFactory=getFactory,lottie.version="5.13.0";function checkReady(){document.readyState==="complete"&&(clearInterval(readyStateCheckInterval),searchAnimations())}function getQueryVariable(e){for(var i=queryString.split("&"),s=0;s<i.length;s+=1){var a=i[s].split("=");if(decodeURIComponent(a[0])==e)return decodeURIComponent(a[1])}return null}var queryString="";{var scripts=document.getElementsByTagName("script"),index=scripts.length-1,myScript=scripts[index]||{src:""};queryString=myScript.src?myScript.src.replace(/^[^\?]+\??/,""):"",getQueryVariable("renderer")}var readyStateCheckInterval=setInterval(checkReady,100);try{_typeof$3(exports)!=="object"&&(window.bodymovin=lottie)}catch(e){}var ShapeModifiers=function(){var e={},i={};e.registerModifier=s,e.getModifier=a;function s(_,et){i[_]||(i[_]=et)}function a(_,et,nt){return new i[_](et,nt)}return e}();function ShapeModifier(){}ShapeModifier.prototype.initModifierProperties=function(){},ShapeModifier.prototype.addShapeToModifier=function(){},ShapeModifier.prototype.addShape=function(e){if(!this.closed){e.sh.container.addDynamicProperty(e.sh);var i={shape:e.sh,data:e,localShapeCollection:shapeCollectionPool.newShapeCollection()};this.shapes.push(i),this.addShapeToModifier(i),this._isAnimated&&e.setAsAnimated()}},ShapeModifier.prototype.init=function(e,i){this.shapes=[],this.elem=e,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,i),this.frameId=initialDefaultFrame,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},ShapeModifier.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},extendPrototype([DynamicPropertyContainer],ShapeModifier);function TrimModifier(){}extendPrototype([ShapeModifier],TrimModifier),TrimModifier.prototype.initModifierProperties=function(e,i){this.s=PropertyFactory.getProp(e,i.s,0,.01,this),this.e=PropertyFactory.getProp(e,i.e,0,.01,this),this.o=PropertyFactory.getProp(e,i.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=i.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},TrimModifier.prototype.addShapeToModifier=function(e){e.pathsData=[]},TrimModifier.prototype.calculateShapeEdges=function(e,i,s,a,_){var et=[];i<=1?et.push({s:e,e:i}):e>=1?et.push({s:e-1,e:i-1}):(et.push({s:e,e:1}),et.push({s:0,e:i-1}));var nt=[],c,ct=et.length,dt;for(c=0;c<ct;c+=1)if(dt=et[c],!(dt.e*_<a||dt.s*_>a+s)){var gt,Tt;dt.s*_<=a?gt=0:gt=(dt.s*_-a)/s,dt.e*_>=a+s?Tt=1:Tt=(dt.e*_-a)/s,nt.push([gt,Tt])}return nt.length||nt.push([0,0]),nt},TrimModifier.prototype.releasePathsData=function(e){var i,s=e.length;for(i=0;i<s;i+=1)segmentsLengthPool.release(e[i]);return e.length=0,e},TrimModifier.prototype.processShapes=function(e){var i,s;if(this._mdf||e){var a=this.o.v%360/360;if(a<0&&(a+=1),this.s.v>1?i=1+a:this.s.v<0?i=0+a:i=this.s.v+a,this.e.v>1?s=1+a:this.e.v<0?s=0+a:s=this.e.v+a,i>s){var _=i;i=s,s=_}i=Math.round(i*1e4)*1e-4,s=Math.round(s*1e4)*1e-4,this.sValue=i,this.eValue=s}else i=this.sValue,s=this.eValue;var et,nt,c=this.shapes.length,ct,dt,gt,Tt,Et,At=0;if(s===i)for(nt=0;nt<c;nt+=1)this.shapes[nt].localShapeCollection.releaseShapes(),this.shapes[nt].shape._mdf=!0,this.shapes[nt].shape.paths=this.shapes[nt].localShapeCollection,this._mdf&&(this.shapes[nt].pathsData.length=0);else if(s===1&&i===0||s===0&&i===1){if(this._mdf)for(nt=0;nt<c;nt+=1)this.shapes[nt].pathsData.length=0,this.shapes[nt].shape._mdf=!0}else{var Mt=[],Pt,$t;for(nt=0;nt<c;nt+=1)if(Pt=this.shapes[nt],!Pt.shape._mdf&&!this._mdf&&!e&&this.m!==2)Pt.shape.paths=Pt.localShapeCollection;else{if(et=Pt.shape.paths,dt=et._length,Et=0,!Pt.shape._mdf&&Pt.pathsData.length)Et=Pt.totalShapeLength;else{for(gt=this.releasePathsData(Pt.pathsData),ct=0;ct<dt;ct+=1)Tt=bez.getSegmentsLength(et.shapes[ct]),gt.push(Tt),Et+=Tt.totalLength;Pt.totalShapeLength=Et,Pt.pathsData=gt}At+=Et,Pt.shape._mdf=!0}var Lt=i,Bt=s,Nt=0,Vt;for(nt=c-1;nt>=0;nt-=1)if(Pt=this.shapes[nt],Pt.shape._mdf){for($t=Pt.localShapeCollection,$t.releaseShapes(),this.m===2&&c>1?(Vt=this.calculateShapeEdges(i,s,Pt.totalShapeLength,Nt,At),Nt+=Pt.totalShapeLength):Vt=[[Lt,Bt]],dt=Vt.length,ct=0;ct<dt;ct+=1){Lt=Vt[ct][0],Bt=Vt[ct][1],Mt.length=0,Bt<=1?Mt.push({s:Pt.totalShapeLength*Lt,e:Pt.totalShapeLength*Bt}):Lt>=1?Mt.push({s:Pt.totalShapeLength*(Lt-1),e:Pt.totalShapeLength*(Bt-1)}):(Mt.push({s:Pt.totalShapeLength*Lt,e:Pt.totalShapeLength}),Mt.push({s:0,e:Pt.totalShapeLength*(Bt-1)}));var Xt=this.addShapes(Pt,Mt[0]);if(Mt[0].s!==Mt[0].e){if(Mt.length>1){var nr=Pt.shape.paths.shapes[Pt.shape.paths._length-1];if(nr.c){var ar=Xt.pop();this.addPaths(Xt,$t),Xt=this.addShapes(Pt,Mt[1],ar)}else this.addPaths(Xt,$t),Xt=this.addShapes(Pt,Mt[1])}this.addPaths(Xt,$t)}}Pt.shape.paths=$t}}},TrimModifier.prototype.addPaths=function(e,i){var s,a=e.length;for(s=0;s<a;s+=1)i.addShape(e[s])},TrimModifier.prototype.addSegment=function(e,i,s,a,_,et,nt){_.setXYAt(i[0],i[1],"o",et),_.setXYAt(s[0],s[1],"i",et+1),nt&&_.setXYAt(e[0],e[1],"v",et),_.setXYAt(a[0],a[1],"v",et+1)},TrimModifier.prototype.addSegmentFromArray=function(e,i,s,a){i.setXYAt(e[1],e[5],"o",s),i.setXYAt(e[2],e[6],"i",s+1),a&&i.setXYAt(e[0],e[4],"v",s),i.setXYAt(e[3],e[7],"v",s+1)},TrimModifier.prototype.addShapes=function(e,i,s){var a=e.pathsData,_=e.shape.paths.shapes,et,nt=e.shape.paths._length,c,ct,dt=0,gt,Tt,Et,At,Mt=[],Pt,$t=!0;for(s?(Tt=s._length,Pt=s._length):(s=shapePool.newElement(),Tt=0,Pt=0),Mt.push(s),et=0;et<nt;et+=1){for(Et=a[et].lengths,s.c=_[et].c,ct=_[et].c?Et.length:Et.length+1,c=1;c<ct;c+=1)if(gt=Et[c-1],dt+gt.addedLength<i.s)dt+=gt.addedLength,s.c=!1;else if(dt>i.e){s.c=!1;break}else i.s<=dt&&i.e>=dt+gt.addedLength?(this.addSegment(_[et].v[c-1],_[et].o[c-1],_[et].i[c],_[et].v[c],s,Tt,$t),$t=!1):(At=bez.getNewSegment(_[et].v[c-1],_[et].v[c],_[et].o[c-1],_[et].i[c],(i.s-dt)/gt.addedLength,(i.e-dt)/gt.addedLength,Et[c-1]),this.addSegmentFromArray(At,s,Tt,$t),$t=!1,s.c=!1),dt+=gt.addedLength,Tt+=1;if(_[et].c&&Et.length){if(gt=Et[c-1],dt<=i.e){var Lt=Et[c-1].addedLength;i.s<=dt&&i.e>=dt+Lt?(this.addSegment(_[et].v[c-1],_[et].o[c-1],_[et].i[0],_[et].v[0],s,Tt,$t),$t=!1):(At=bez.getNewSegment(_[et].v[c-1],_[et].v[0],_[et].o[c-1],_[et].i[0],(i.s-dt)/Lt,(i.e-dt)/Lt,Et[c-1]),this.addSegmentFromArray(At,s,Tt,$t),$t=!1,s.c=!1)}else s.c=!1;dt+=gt.addedLength,Tt+=1}if(s._length&&(s.setXYAt(s.v[Pt][0],s.v[Pt][1],"i",Pt),s.setXYAt(s.v[s._length-1][0],s.v[s._length-1][1],"o",s._length-1)),dt>i.e)break;et<nt-1&&(s=shapePool.newElement(),$t=!0,Mt.push(s),Tt=0)}return Mt};function PuckerAndBloatModifier(){}extendPrototype([ShapeModifier],PuckerAndBloatModifier),PuckerAndBloatModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,i.a,0,null,this),this._isAnimated=!!this.amount.effectsSequence.length},PuckerAndBloatModifier.prototype.processPath=function(e,i){var s=i/100,a=[0,0],_=e._length,et=0;for(et=0;et<_;et+=1)a[0]+=e.v[et][0],a[1]+=e.v[et][1];a[0]/=_,a[1]/=_;var nt=shapePool.newElement();nt.c=e.c;var c,ct,dt,gt,Tt,Et;for(et=0;et<_;et+=1)c=e.v[et][0]+(a[0]-e.v[et][0])*s,ct=e.v[et][1]+(a[1]-e.v[et][1])*s,dt=e.o[et][0]+(a[0]-e.o[et][0])*-s,gt=e.o[et][1]+(a[1]-e.o[et][1])*-s,Tt=e.i[et][0]+(a[0]-e.i[et][0])*-s,Et=e.i[et][1]+(a[1]-e.i[et][1])*-s,nt.setTripleAt(c,ct,dt,gt,Tt,Et,et);return nt},PuckerAndBloatModifier.prototype.processShapes=function(e){var i,s,a=this.shapes.length,_,et,nt=this.amount.v;if(nt!==0){var c,ct;for(s=0;s<a;s+=1){if(c=this.shapes[s],ct=c.localShapeCollection,!(!c.shape._mdf&&!this._mdf&&!e))for(ct.releaseShapes(),c.shape._mdf=!0,i=c.shape.paths.shapes,et=c.shape.paths._length,_=0;_<et;_+=1)ct.addShape(this.processPath(i[_],nt));c.shape.paths=c.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};var TransformPropertyFactory=function(){var e=[0,0];function i(ct){var dt=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||dt,this.a&&ct.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&ct.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&ct.skewFromAxis(-this.sk.v,this.sa.v),this.r?ct.rotate(-this.r.v):ct.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?ct.translate(this.px.v,this.py.v,-this.pz.v):ct.translate(this.px.v,this.py.v,0):ct.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}function s(ct){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||ct){var dt;if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var gt,Tt;if(dt=this.elem.globalData.frameRate,this.p&&this.p.keyframes&&this.p.getValueAtTime)this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(gt=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/dt,0),Tt=this.p.getValueAtTime(this.p.keyframes[0].t/dt,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(gt=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/dt,0),Tt=this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/dt,0)):(gt=this.p.pv,Tt=this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/dt,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){gt=[],Tt=[];var Et=this.px,At=this.py;Et._caching.lastFrame+Et.offsetTime<=Et.keyframes[0].t?(gt[0]=Et.getValueAtTime((Et.keyframes[0].t+.01)/dt,0),gt[1]=At.getValueAtTime((At.keyframes[0].t+.01)/dt,0),Tt[0]=Et.getValueAtTime(Et.keyframes[0].t/dt,0),Tt[1]=At.getValueAtTime(At.keyframes[0].t/dt,0)):Et._caching.lastFrame+Et.offsetTime>=Et.keyframes[Et.keyframes.length-1].t?(gt[0]=Et.getValueAtTime(Et.keyframes[Et.keyframes.length-1].t/dt,0),gt[1]=At.getValueAtTime(At.keyframes[At.keyframes.length-1].t/dt,0),Tt[0]=Et.getValueAtTime((Et.keyframes[Et.keyframes.length-1].t-.01)/dt,0),Tt[1]=At.getValueAtTime((At.keyframes[At.keyframes.length-1].t-.01)/dt,0)):(gt=[Et.pv,At.pv],Tt[0]=Et.getValueAtTime((Et._caching.lastFrame+Et.offsetTime-.01)/dt,Et.offsetTime),Tt[1]=At.getValueAtTime((At._caching.lastFrame+At.offsetTime-.01)/dt,At.offsetTime))}else Tt=e,gt=Tt;this.v.rotate(-Math.atan2(gt[1]-Tt[1],gt[0]-Tt[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}}function a(){if(this.appliedTransformations=0,this.pre.reset(),!this.a.effectsSequence.length)this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1;else return;if(!this.s.effectsSequence.length)this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2;else return;if(this.sk)if(!this.sk.effectsSequence.length&&!this.sa.effectsSequence.length)this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3;else return;this.r?this.r.effectsSequence.length||(this.pre.rotate(-this.r.v),this.appliedTransformations=4):!this.rz.effectsSequence.length&&!this.ry.effectsSequence.length&&!this.rx.effectsSequence.length&&!this.or.effectsSequence.length&&(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}function _(){}function et(ct){this._addDynamicProperty(ct),this.elem.addDynamicProperty(ct),this._isDirty=!0}function nt(ct,dt,gt){if(this.elem=ct,this.frameId=-1,this.propType="transform",this.data=dt,this.v=new Matrix,this.pre=new Matrix,this.appliedTransformations=0,this.initDynamicPropertyContainer(gt||ct),dt.p&&dt.p.s?(this.px=PropertyFactory.getProp(ct,dt.p.x,0,0,this),this.py=PropertyFactory.getProp(ct,dt.p.y,0,0,this),dt.p.z&&(this.pz=PropertyFactory.getProp(ct,dt.p.z,0,0,this))):this.p=PropertyFactory.getProp(ct,dt.p||{k:[0,0,0]},1,0,this),dt.rx){if(this.rx=PropertyFactory.getProp(ct,dt.rx,0,degToRads,this),this.ry=PropertyFactory.getProp(ct,dt.ry,0,degToRads,this),this.rz=PropertyFactory.getProp(ct,dt.rz,0,degToRads,this),dt.or.k[0].ti){var Tt,Et=dt.or.k.length;for(Tt=0;Tt<Et;Tt+=1)dt.or.k[Tt].to=null,dt.or.k[Tt].ti=null}this.or=PropertyFactory.getProp(ct,dt.or,1,degToRads,this),this.or.sh=!0}else this.r=PropertyFactory.getProp(ct,dt.r||{k:0},0,degToRads,this);dt.sk&&(this.sk=PropertyFactory.getProp(ct,dt.sk,0,degToRads,this),this.sa=PropertyFactory.getProp(ct,dt.sa,0,degToRads,this)),this.a=PropertyFactory.getProp(ct,dt.a||{k:[0,0,0]},1,0,this),this.s=PropertyFactory.getProp(ct,dt.s||{k:[100,100,100]},1,.01,this),dt.o?this.o=PropertyFactory.getProp(ct,dt.o,0,.01,ct):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}nt.prototype={applyToMatrix:i,getValue:s,precalculateMatrix:a,autoOrient:_},extendPrototype([DynamicPropertyContainer],nt),nt.prototype.addDynamicProperty=et,nt.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty;function c(ct,dt,gt){return new nt(ct,dt,gt)}return{getTransformProperty:c}}();function RepeaterModifier(){}extendPrototype([ShapeModifier],RepeaterModifier),RepeaterModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.c=PropertyFactory.getProp(e,i.c,0,null,this),this.o=PropertyFactory.getProp(e,i.o,0,null,this),this.tr=TransformPropertyFactory.getTransformProperty(e,i.tr,this),this.so=PropertyFactory.getProp(e,i.tr.so,0,.01,this),this.eo=PropertyFactory.getProp(e,i.tr.eo,0,.01,this),this.data=i,this.dynamicProperties.length||this.getValue(!0),this._isAnimated=!!this.dynamicProperties.length,this.pMatrix=new Matrix,this.rMatrix=new Matrix,this.sMatrix=new Matrix,this.tMatrix=new Matrix,this.matrix=new Matrix},RepeaterModifier.prototype.applyTransforms=function(e,i,s,a,_,et){var nt=et?-1:1,c=a.s.v[0]+(1-a.s.v[0])*(1-_),ct=a.s.v[1]+(1-a.s.v[1])*(1-_);e.translate(a.p.v[0]*nt*_,a.p.v[1]*nt*_,a.p.v[2]),i.translate(-a.a.v[0],-a.a.v[1],a.a.v[2]),i.rotate(-a.r.v*nt*_),i.translate(a.a.v[0],a.a.v[1],a.a.v[2]),s.translate(-a.a.v[0],-a.a.v[1],a.a.v[2]),s.scale(et?1/c:c,et?1/ct:ct),s.translate(a.a.v[0],a.a.v[1],a.a.v[2])},RepeaterModifier.prototype.init=function(e,i,s,a){for(this.elem=e,this.arr=i,this.pos=s,this.elemsData=a,this._currentCopies=0,this._elements=[],this._groups=[],this.frameId=-1,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,i[s]);s>0;)s-=1,this._elements.unshift(i[s]);this.dynamicProperties.length?this.k=!0:this.getValue(!0)},RepeaterModifier.prototype.resetElements=function(e){var i,s=e.length;for(i=0;i<s;i+=1)e[i]._processed=!1,e[i].ty==="gr"&&this.resetElements(e[i].it)},RepeaterModifier.prototype.cloneElements=function(e){var i=JSON.parse(JSON.stringify(e));return this.resetElements(i),i},RepeaterModifier.prototype.changeGroupRender=function(e,i){var s,a=e.length;for(s=0;s<a;s+=1)e[s]._render=i,e[s].ty==="gr"&&this.changeGroupRender(e[s].it,i)},RepeaterModifier.prototype.processShapes=function(e){var i,s,a,_,et,nt=!1;if(this._mdf||e){var c=Math.ceil(this.c.v);if(this._groups.length<c){for(;this._groups.length<c;){var ct={it:this.cloneElements(this._elements),ty:"gr"};ct.it.push({a:{a:0,ix:1,k:[0,0]},nm:"Transform",o:{a:0,ix:7,k:100},p:{a:0,ix:2,k:[0,0]},r:{a:1,ix:6,k:[{s:0,e:0,t:0},{s:0,e:0,t:1}]},s:{a:0,ix:3,k:[100,100]},sa:{a:0,ix:5,k:0},sk:{a:0,ix:4,k:0},ty:"tr"}),this.arr.splice(0,0,ct),this._groups.splice(0,0,ct),this._currentCopies+=1}this.elem.reloadShapes(),nt=!0}et=0;var dt;for(a=0;a<=this._groups.length-1;a+=1){if(dt=et<c,this._groups[a]._render=dt,this.changeGroupRender(this._groups[a].it,dt),!dt){var gt=this.elemsData[a].it,Tt=gt[gt.length-1];Tt.transform.op.v!==0?(Tt.transform.op._mdf=!0,Tt.transform.op.v=0):Tt.transform.op._mdf=!1}et+=1}this._currentCopies=c;var Et=this.o.v,At=Et%1,Mt=Et>0?Math.floor(Et):Math.ceil(Et),Pt=this.pMatrix.props,$t=this.rMatrix.props,Lt=this.sMatrix.props;this.pMatrix.reset(),this.rMatrix.reset(),this.sMatrix.reset(),this.tMatrix.reset(),this.matrix.reset();var Bt=0;if(Et>0){for(;Bt<Mt;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),Bt+=1;At&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,At,!1),Bt+=At)}else if(Et<0){for(;Bt>Mt;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!0),Bt-=1;At&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,-At,!0),Bt-=At)}a=this.data.m===1?0:this._currentCopies-1,_=this.data.m===1?1:-1,et=this._currentCopies;for(var Nt,Vt;et;){if(i=this.elemsData[a].it,s=i[i.length-1].transform.mProps.v.props,Vt=s.length,i[i.length-1].transform.mProps._mdf=!0,i[i.length-1].transform.op._mdf=!0,i[i.length-1].transform.op.v=this._currentCopies===1?this.so.v:this.so.v+(this.eo.v-this.so.v)*(a/(this._currentCopies-1)),Bt!==0){for((a!==0&&_===1||a!==this._currentCopies-1&&_===-1)&&this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),this.matrix.transform($t[0],$t[1],$t[2],$t[3],$t[4],$t[5],$t[6],$t[7],$t[8],$t[9],$t[10],$t[11],$t[12],$t[13],$t[14],$t[15]),this.matrix.transform(Lt[0],Lt[1],Lt[2],Lt[3],Lt[4],Lt[5],Lt[6],Lt[7],Lt[8],Lt[9],Lt[10],Lt[11],Lt[12],Lt[13],Lt[14],Lt[15]),this.matrix.transform(Pt[0],Pt[1],Pt[2],Pt[3],Pt[4],Pt[5],Pt[6],Pt[7],Pt[8],Pt[9],Pt[10],Pt[11],Pt[12],Pt[13],Pt[14],Pt[15]),Nt=0;Nt<Vt;Nt+=1)s[Nt]=this.matrix.props[Nt];this.matrix.reset()}else for(this.matrix.reset(),Nt=0;Nt<Vt;Nt+=1)s[Nt]=this.matrix.props[Nt];Bt+=1,et-=1,a+=_}}else for(et=this._currentCopies,a=0,_=1;et;)i=this.elemsData[a].it,s=i[i.length-1].transform.mProps.v.props,i[i.length-1].transform.mProps._mdf=!1,i[i.length-1].transform.op._mdf=!1,et-=1,a+=_;return nt},RepeaterModifier.prototype.addShape=function(){};function RoundCornersModifier(){}extendPrototype([ShapeModifier],RoundCornersModifier),RoundCornersModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.rd=PropertyFactory.getProp(e,i.r,0,null,this),this._isAnimated=!!this.rd.effectsSequence.length},RoundCornersModifier.prototype.processPath=function(e,i){var s=shapePool.newElement();s.c=e.c;var a,_=e._length,et,nt,c,ct,dt,gt,Tt=0,Et,At,Mt,Pt,$t,Lt;for(a=0;a<_;a+=1)et=e.v[a],c=e.o[a],nt=e.i[a],et[0]===c[0]&&et[1]===c[1]&&et[0]===nt[0]&&et[1]===nt[1]?(a===0||a===_-1)&&!e.c?(s.setTripleAt(et[0],et[1],c[0],c[1],nt[0],nt[1],Tt),Tt+=1):(a===0?ct=e.v[_-1]:ct=e.v[a-1],dt=Math.sqrt(Math.pow(et[0]-ct[0],2)+Math.pow(et[1]-ct[1],2)),gt=dt?Math.min(dt/2,i)/dt:0,$t=et[0]+(ct[0]-et[0])*gt,Et=$t,Lt=et[1]-(et[1]-ct[1])*gt,At=Lt,Mt=Et-(Et-et[0])*roundCorner,Pt=At-(At-et[1])*roundCorner,s.setTripleAt(Et,At,Mt,Pt,$t,Lt,Tt),Tt+=1,a===_-1?ct=e.v[0]:ct=e.v[a+1],dt=Math.sqrt(Math.pow(et[0]-ct[0],2)+Math.pow(et[1]-ct[1],2)),gt=dt?Math.min(dt/2,i)/dt:0,Mt=et[0]+(ct[0]-et[0])*gt,Et=Mt,Pt=et[1]+(ct[1]-et[1])*gt,At=Pt,$t=Et-(Et-et[0])*roundCorner,Lt=At-(At-et[1])*roundCorner,s.setTripleAt(Et,At,Mt,Pt,$t,Lt,Tt),Tt+=1):(s.setTripleAt(e.v[a][0],e.v[a][1],e.o[a][0],e.o[a][1],e.i[a][0],e.i[a][1],Tt),Tt+=1);return s},RoundCornersModifier.prototype.processShapes=function(e){var i,s,a=this.shapes.length,_,et,nt=this.rd.v;if(nt!==0){var c,ct;for(s=0;s<a;s+=1){if(c=this.shapes[s],ct=c.localShapeCollection,!(!c.shape._mdf&&!this._mdf&&!e))for(ct.releaseShapes(),c.shape._mdf=!0,i=c.shape.paths.shapes,et=c.shape.paths._length,_=0;_<et;_+=1)ct.addShape(this.processPath(i[_],nt));c.shape.paths=c.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function floatEqual(e,i){return Math.abs(e-i)*1e5<=Math.min(Math.abs(e),Math.abs(i))}function floatZero(e){return Math.abs(e)<=1e-5}function lerp(e,i,s){return e*(1-s)+i*s}function lerpPoint(e,i,s){return[lerp(e[0],i[0],s),lerp(e[1],i[1],s)]}function quadRoots(e,i,s){if(e===0)return[];var a=i*i-4*e*s;if(a<0)return[];var _=-i/(2*e);if(a===0)return[_];var et=Math.sqrt(a)/(2*e);return[_-et,_+et]}function polynomialCoefficients(e,i,s,a){return[-e+3*i-3*s+a,3*e-6*i+3*s,-3*e+3*i,e]}function singlePoint(e){return new PolynomialBezier(e,e,e,e,!1)}function PolynomialBezier(e,i,s,a,_){_&&pointEqual(e,i)&&(i=lerpPoint(e,a,1/3)),_&&pointEqual(s,a)&&(s=lerpPoint(e,a,2/3));var et=polynomialCoefficients(e[0],i[0],s[0],a[0]),nt=polynomialCoefficients(e[1],i[1],s[1],a[1]);this.a=[et[0],nt[0]],this.b=[et[1],nt[1]],this.c=[et[2],nt[2]],this.d=[et[3],nt[3]],this.points=[e,i,s,a]}PolynomialBezier.prototype.point=function(e){return[((this.a[0]*e+this.b[0])*e+this.c[0])*e+this.d[0],((this.a[1]*e+this.b[1])*e+this.c[1])*e+this.d[1]]},PolynomialBezier.prototype.derivative=function(e){return[(3*e*this.a[0]+2*this.b[0])*e+this.c[0],(3*e*this.a[1]+2*this.b[1])*e+this.c[1]]},PolynomialBezier.prototype.tangentAngle=function(e){var i=this.derivative(e);return Math.atan2(i[1],i[0])},PolynomialBezier.prototype.normalAngle=function(e){var i=this.derivative(e);return Math.atan2(i[0],i[1])},PolynomialBezier.prototype.inflectionPoints=function(){var e=this.a[1]*this.b[0]-this.a[0]*this.b[1];if(floatZero(e))return[];var i=-.5*(this.a[1]*this.c[0]-this.a[0]*this.c[1])/e,s=i*i-1/3*(this.b[1]*this.c[0]-this.b[0]*this.c[1])/e;if(s<0)return[];var a=Math.sqrt(s);return floatZero(a)?a>0&&a<1?[i]:[]:[i-a,i+a].filter(function(_){return _>0&&_<1})},PolynomialBezier.prototype.split=function(e){if(e<=0)return[singlePoint(this.points[0]),this];if(e>=1)return[this,singlePoint(this.points[this.points.length-1])];var i=lerpPoint(this.points[0],this.points[1],e),s=lerpPoint(this.points[1],this.points[2],e),a=lerpPoint(this.points[2],this.points[3],e),_=lerpPoint(i,s,e),et=lerpPoint(s,a,e),nt=lerpPoint(_,et,e);return[new PolynomialBezier(this.points[0],i,_,nt,!0),new PolynomialBezier(nt,et,a,this.points[3],!0)]};function extrema(e,i){var s=e.points[0][i],a=e.points[e.points.length-1][i];if(s>a){var _=a;a=s,s=_}for(var et=quadRoots(3*e.a[i],2*e.b[i],e.c[i]),nt=0;nt<et.length;nt+=1)if(et[nt]>0&&et[nt]<1){var c=e.point(et[nt])[i];c<s?s=c:c>a&&(a=c)}return{min:s,max:a}}PolynomialBezier.prototype.bounds=function(){return{x:extrema(this,0),y:extrema(this,1)}},PolynomialBezier.prototype.boundingBox=function(){var e=this.bounds();return{left:e.x.min,right:e.x.max,top:e.y.min,bottom:e.y.max,width:e.x.max-e.x.min,height:e.y.max-e.y.min,cx:(e.x.max+e.x.min)/2,cy:(e.y.max+e.y.min)/2}};function intersectData(e,i,s){var a=e.boundingBox();return{cx:a.cx,cy:a.cy,width:a.width,height:a.height,bez:e,t:(i+s)/2,t1:i,t2:s}}function splitData(e){var i=e.bez.split(.5);return[intersectData(i[0],e.t1,e.t),intersectData(i[1],e.t,e.t2)]}function boxIntersect(e,i){return Math.abs(e.cx-i.cx)*2<e.width+i.width&&Math.abs(e.cy-i.cy)*2<e.height+i.height}function intersectsImpl(e,i,s,a,_,et){if(boxIntersect(e,i)){if(s>=et||e.width<=a&&e.height<=a&&i.width<=a&&i.height<=a){_.push([e.t,i.t]);return}var nt=splitData(e),c=splitData(i);intersectsImpl(nt[0],c[0],s+1,a,_,et),intersectsImpl(nt[0],c[1],s+1,a,_,et),intersectsImpl(nt[1],c[0],s+1,a,_,et),intersectsImpl(nt[1],c[1],s+1,a,_,et)}}PolynomialBezier.prototype.intersections=function(e,i,s){i===void 0&&(i=2),s===void 0&&(s=7);var a=[];return intersectsImpl(intersectData(this,0,1),intersectData(e,0,1),0,i,a,s),a},PolynomialBezier.shapeSegment=function(e,i){var s=(i+1)%e.length();return new PolynomialBezier(e.v[i],e.o[i],e.i[s],e.v[s],!0)},PolynomialBezier.shapeSegmentInverted=function(e,i){var s=(i+1)%e.length();return new PolynomialBezier(e.v[s],e.i[s],e.o[i],e.v[i],!0)};function crossProduct(e,i){return[e[1]*i[2]-e[2]*i[1],e[2]*i[0]-e[0]*i[2],e[0]*i[1]-e[1]*i[0]]}function lineIntersection(e,i,s,a){var _=[e[0],e[1],1],et=[i[0],i[1],1],nt=[s[0],s[1],1],c=[a[0],a[1],1],ct=crossProduct(crossProduct(_,et),crossProduct(nt,c));return floatZero(ct[2])?null:[ct[0]/ct[2],ct[1]/ct[2]]}function polarOffset(e,i,s){return[e[0]+Math.cos(i)*s,e[1]-Math.sin(i)*s]}function pointDistance(e,i){return Math.hypot(e[0]-i[0],e[1]-i[1])}function pointEqual(e,i){return floatEqual(e[0],i[0])&&floatEqual(e[1],i[1])}function ZigZagModifier(){}extendPrototype([ShapeModifier],ZigZagModifier),ZigZagModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.amplitude=PropertyFactory.getProp(e,i.s,0,null,this),this.frequency=PropertyFactory.getProp(e,i.r,0,null,this),this.pointsType=PropertyFactory.getProp(e,i.pt,0,null,this),this._isAnimated=this.amplitude.effectsSequence.length!==0||this.frequency.effectsSequence.length!==0||this.pointsType.effectsSequence.length!==0};function setPoint(e,i,s,a,_,et,nt){var c=s-Math.PI/2,ct=s+Math.PI/2,dt=i[0]+Math.cos(s)*a*_,gt=i[1]-Math.sin(s)*a*_;e.setTripleAt(dt,gt,dt+Math.cos(c)*et,gt-Math.sin(c)*et,dt+Math.cos(ct)*nt,gt-Math.sin(ct)*nt,e.length())}function getPerpendicularVector(e,i){var s=[i[0]-e[0],i[1]-e[1]],a=-Math.PI*.5,_=[Math.cos(a)*s[0]-Math.sin(a)*s[1],Math.sin(a)*s[0]+Math.cos(a)*s[1]];return _}function getProjectingAngle(e,i){var s=i===0?e.length()-1:i-1,a=(i+1)%e.length(),_=e.v[s],et=e.v[a],nt=getPerpendicularVector(_,et);return Math.atan2(0,1)-Math.atan2(nt[1],nt[0])}function zigZagCorner(e,i,s,a,_,et,nt){var c=getProjectingAngle(i,s),ct=i.v[s%i._length],dt=i.v[s===0?i._length-1:s-1],gt=i.v[(s+1)%i._length],Tt=et===2?Math.sqrt(Math.pow(ct[0]-dt[0],2)+Math.pow(ct[1]-dt[1],2)):0,Et=et===2?Math.sqrt(Math.pow(ct[0]-gt[0],2)+Math.pow(ct[1]-gt[1],2)):0;setPoint(e,i.v[s%i._length],c,nt,a,Et/((_+1)*2),Tt/((_+1)*2))}function zigZagSegment(e,i,s,a,_,et){for(var nt=0;nt<a;nt+=1){var c=(nt+1)/(a+1),ct=_===2?Math.sqrt(Math.pow(i.points[3][0]-i.points[0][0],2)+Math.pow(i.points[3][1]-i.points[0][1],2)):0,dt=i.normalAngle(c),gt=i.point(c);setPoint(e,gt,dt,et,s,ct/((a+1)*2),ct/((a+1)*2)),et=-et}return et}ZigZagModifier.prototype.processPath=function(e,i,s,a){var _=e._length,et=shapePool.newElement();if(et.c=e.c,e.c||(_-=1),_===0)return et;var nt=-1,c=PolynomialBezier.shapeSegment(e,0);zigZagCorner(et,e,0,i,s,a,nt);for(var ct=0;ct<_;ct+=1)nt=zigZagSegment(et,c,i,s,a,-nt),ct===_-1&&!e.c?c=null:c=PolynomialBezier.shapeSegment(e,(ct+1)%_),zigZagCorner(et,e,ct+1,i,s,a,nt);return et},ZigZagModifier.prototype.processShapes=function(e){var i,s,a=this.shapes.length,_,et,nt=this.amplitude.v,c=Math.max(0,Math.round(this.frequency.v)),ct=this.pointsType.v;if(nt!==0){var dt,gt;for(s=0;s<a;s+=1){if(dt=this.shapes[s],gt=dt.localShapeCollection,!(!dt.shape._mdf&&!this._mdf&&!e))for(gt.releaseShapes(),dt.shape._mdf=!0,i=dt.shape.paths.shapes,et=dt.shape.paths._length,_=0;_<et;_+=1)gt.addShape(this.processPath(i[_],nt,c,ct));dt.shape.paths=dt.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function linearOffset(e,i,s){var a=Math.atan2(i[0]-e[0],i[1]-e[1]);return[polarOffset(e,a,s),polarOffset(i,a,s)]}function offsetSegment(e,i){var s,a,_,et,nt,c,ct;ct=linearOffset(e.points[0],e.points[1],i),s=ct[0],a=ct[1],ct=linearOffset(e.points[1],e.points[2],i),_=ct[0],et=ct[1],ct=linearOffset(e.points[2],e.points[3],i),nt=ct[0],c=ct[1];var dt=lineIntersection(s,a,_,et);dt===null&&(dt=a);var gt=lineIntersection(nt,c,_,et);return gt===null&&(gt=nt),new PolynomialBezier(s,dt,gt,c)}function joinLines(e,i,s,a,_){var et=i.points[3],nt=s.points[0];if(a===3||pointEqual(et,nt))return et;if(a===2){var c=-i.tangentAngle(1),ct=-s.tangentAngle(0)+Math.PI,dt=lineIntersection(et,polarOffset(et,c+Math.PI/2,100),nt,polarOffset(nt,c+Math.PI/2,100)),gt=dt?pointDistance(dt,et):pointDistance(et,nt)/2,Tt=polarOffset(et,c,2*gt*roundCorner);return e.setXYAt(Tt[0],Tt[1],"o",e.length()-1),Tt=polarOffset(nt,ct,2*gt*roundCorner),e.setTripleAt(nt[0],nt[1],nt[0],nt[1],Tt[0],Tt[1],e.length()),nt}var Et=pointEqual(et,i.points[2])?i.points[0]:i.points[2],At=pointEqual(nt,s.points[1])?s.points[3]:s.points[1],Mt=lineIntersection(Et,et,nt,At);return Mt&&pointDistance(Mt,et)<_?(e.setTripleAt(Mt[0],Mt[1],Mt[0],Mt[1],Mt[0],Mt[1],e.length()),Mt):et}function getIntersection(e,i){var s=e.intersections(i);return s.length&&floatEqual(s[0][0],1)&&s.shift(),s.length?s[0]:null}function pruneSegmentIntersection(e,i){var s=e.slice(),a=i.slice(),_=getIntersection(e[e.length-1],i[0]);return _&&(s[e.length-1]=e[e.length-1].split(_[0])[0],a[0]=i[0].split(_[1])[1]),e.length>1&&i.length>1&&(_=getIntersection(e[0],i[i.length-1]),_)?[[e[0].split(_[0])[0]],[i[i.length-1].split(_[1])[1]]]:[s,a]}function pruneIntersections(e){for(var i,s=1;s<e.length;s+=1)i=pruneSegmentIntersection(e[s-1],e[s]),e[s-1]=i[0],e[s]=i[1];return e.length>1&&(i=pruneSegmentIntersection(e[e.length-1],e[0]),e[e.length-1]=i[0],e[0]=i[1]),e}function offsetSegmentSplit(e,i){var s=e.inflectionPoints(),a,_,et,nt;if(s.length===0)return[offsetSegment(e,i)];if(s.length===1||floatEqual(s[1],1))return et=e.split(s[0]),a=et[0],_=et[1],[offsetSegment(a,i),offsetSegment(_,i)];et=e.split(s[0]),a=et[0];var c=(s[1]-s[0])/(1-s[0]);return et=et[1].split(c),nt=et[0],_=et[1],[offsetSegment(a,i),offsetSegment(nt,i),offsetSegment(_,i)]}function OffsetPathModifier(){}extendPrototype([ShapeModifier],OffsetPathModifier),OffsetPathModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,i.a,0,null,this),this.miterLimit=PropertyFactory.getProp(e,i.ml,0,null,this),this.lineJoin=i.lj,this._isAnimated=this.amount.effectsSequence.length!==0},OffsetPathModifier.prototype.processPath=function(e,i,s,a){var _=shapePool.newElement();_.c=e.c;var et=e.length();e.c||(et-=1);var nt,c,ct,dt=[];for(nt=0;nt<et;nt+=1)ct=PolynomialBezier.shapeSegment(e,nt),dt.push(offsetSegmentSplit(ct,i));if(!e.c)for(nt=et-1;nt>=0;nt-=1)ct=PolynomialBezier.shapeSegmentInverted(e,nt),dt.push(offsetSegmentSplit(ct,i));dt=pruneIntersections(dt);var gt=null,Tt=null;for(nt=0;nt<dt.length;nt+=1){var Et=dt[nt];for(Tt&&(gt=joinLines(_,Tt,Et[0],s,a)),Tt=Et[Et.length-1],c=0;c<Et.length;c+=1)ct=Et[c],gt&&pointEqual(ct.points[0],gt)?_.setXYAt(ct.points[1][0],ct.points[1][1],"o",_.length()-1):_.setTripleAt(ct.points[0][0],ct.points[0][1],ct.points[1][0],ct.points[1][1],ct.points[0][0],ct.points[0][1],_.length()),_.setTripleAt(ct.points[3][0],ct.points[3][1],ct.points[3][0],ct.points[3][1],ct.points[2][0],ct.points[2][1],_.length()),gt=ct.points[3]}return dt.length&&joinLines(_,Tt,dt[0][0],s,a),_},OffsetPathModifier.prototype.processShapes=function(e){var i,s,a=this.shapes.length,_,et,nt=this.amount.v,c=this.miterLimit.v,ct=this.lineJoin;if(nt!==0){var dt,gt;for(s=0;s<a;s+=1){if(dt=this.shapes[s],gt=dt.localShapeCollection,!(!dt.shape._mdf&&!this._mdf&&!e))for(gt.releaseShapes(),dt.shape._mdf=!0,i=dt.shape.paths.shapes,et=dt.shape.paths._length,_=0;_<et;_+=1)gt.addShape(this.processPath(i[_],nt,ct,c));dt.shape.paths=dt.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function getFontProperties(e){for(var i=e.fStyle?e.fStyle.split(" "):[],s="normal",a="normal",_=i.length,et,nt=0;nt<_;nt+=1)switch(et=i[nt].toLowerCase(),et){case"italic":a="italic";break;case"bold":s="700";break;case"black":s="900";break;case"medium":s="500";break;case"regular":case"normal":s="400";break;case"light":case"thin":s="200";break}return{style:a,weight:e.fWeight||s}}var FontManager=function(){var e=5e3,i={w:0,size:0,shapes:[],data:{shapes:[]}},s=[];s=s.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var a=127988,_=917631,et=917601,nt=917626,c=65039,ct=8205,dt=127462,gt=127487,Tt=["d83cdffb","d83cdffc","d83cdffd","d83cdffe","d83cdfff"];function Et(yr){var Ar=yr.split(","),rr,ur=Ar.length,Br=[];for(rr=0;rr<ur;rr+=1)Ar[rr]!=="sans-serif"&&Ar[rr]!=="monospace"&&Br.push(Ar[rr]);return Br.join(",")}function At(yr,Ar){var rr=createTag("span");rr.setAttribute("aria-hidden",!0),rr.style.fontFamily=Ar;var ur=createTag("span");ur.innerText="giItT1WQy@!-/#",rr.style.position="absolute",rr.style.left="-10000px",rr.style.top="-10000px",rr.style.fontSize="300px",rr.style.fontVariant="normal",rr.style.fontStyle="normal",rr.style.fontWeight="normal",rr.style.letterSpacing="0",rr.appendChild(ur),document.body.appendChild(rr);var Br=ur.offsetWidth;return ur.style.fontFamily=Et(yr)+", "+Ar,{node:ur,w:Br,parent:rr}}function Mt(){var yr,Ar=this.fonts.length,rr,ur,Br=Ar;for(yr=0;yr<Ar;yr+=1)this.fonts[yr].loaded?Br-=1:this.fonts[yr].fOrigin==="n"||this.fonts[yr].origin===0?this.fonts[yr].loaded=!0:(rr=this.fonts[yr].monoCase.node,ur=this.fonts[yr].monoCase.w,rr.offsetWidth!==ur?(Br-=1,this.fonts[yr].loaded=!0):(rr=this.fonts[yr].sansCase.node,ur=this.fonts[yr].sansCase.w,rr.offsetWidth!==ur&&(Br-=1,this.fonts[yr].loaded=!0)),this.fonts[yr].loaded&&(this.fonts[yr].sansCase.parent.parentNode.removeChild(this.fonts[yr].sansCase.parent),this.fonts[yr].monoCase.parent.parentNode.removeChild(this.fonts[yr].monoCase.parent)));Br!==0&&Date.now()-this.initTime<e?setTimeout(this.checkLoadedFontsBinded,20):setTimeout(this.setIsLoadedBinded,10)}function Pt(yr,Ar){var rr=document.body&&Ar?"svg":"canvas",ur,Br=getFontProperties(yr);if(rr==="svg"){var xr=createNS("text");xr.style.fontSize="100px",xr.setAttribute("font-family",yr.fFamily),xr.setAttribute("font-style",Br.style),xr.setAttribute("font-weight",Br.weight),xr.textContent="1",yr.fClass?(xr.style.fontFamily="inherit",xr.setAttribute("class",yr.fClass)):xr.style.fontFamily=yr.fFamily,Ar.appendChild(xr),ur=xr}else{var qr=new OffscreenCanvas(500,500).getContext("2d");qr.font=Br.style+" "+Br.weight+" 100px "+yr.fFamily,ur=qr}function tn(vn){return rr==="svg"?(ur.textContent=vn,ur.getComputedTextLength()):ur.measureText(vn).width}return{measureText:tn}}function $t(yr,Ar){if(!yr){this.isLoaded=!0;return}if(this.chars){this.isLoaded=!0,this.fonts=yr.list;return}if(!document.body){this.isLoaded=!0,yr.list.forEach(function(Mn){Mn.helper=Pt(Mn),Mn.cache={}}),this.fonts=yr.list;return}var rr=yr.list,ur,Br=rr.length,xr=Br;for(ur=0;ur<Br;ur+=1){var qr=!0,tn,vn;if(rr[ur].loaded=!1,rr[ur].monoCase=At(rr[ur].fFamily,"monospace"),rr[ur].sansCase=At(rr[ur].fFamily,"sans-serif"),!rr[ur].fPath)rr[ur].loaded=!0,xr-=1;else if(rr[ur].fOrigin==="p"||rr[ur].origin===3){if(tn=document.querySelectorAll('style[f-forigin="p"][f-family="'+rr[ur].fFamily+'"], style[f-origin="3"][f-family="'+rr[ur].fFamily+'"]'),tn.length>0&&(qr=!1),qr){var hs=createTag("style");hs.setAttribute("f-forigin",rr[ur].fOrigin),hs.setAttribute("f-origin",rr[ur].origin),hs.setAttribute("f-family",rr[ur].fFamily),hs.type="text/css",hs.innerText="@font-face {font-family: "+rr[ur].fFamily+"; font-style: normal; src: url('"+rr[ur].fPath+"');}",Ar.appendChild(hs)}}else if(rr[ur].fOrigin==="g"||rr[ur].origin===1){for(tn=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),vn=0;vn<tn.length;vn+=1)tn[vn].href.indexOf(rr[ur].fPath)!==-1&&(qr=!1);if(qr){var Ts=createTag("link");Ts.setAttribute("f-forigin",rr[ur].fOrigin),Ts.setAttribute("f-origin",rr[ur].origin),Ts.type="text/css",Ts.rel="stylesheet",Ts.href=rr[ur].fPath,document.body.appendChild(Ts)}}else if(rr[ur].fOrigin==="t"||rr[ur].origin===2){for(tn=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),vn=0;vn<tn.length;vn+=1)rr[ur].fPath===tn[vn].src&&(qr=!1);if(qr){var ss=createTag("link");ss.setAttribute("f-forigin",rr[ur].fOrigin),ss.setAttribute("f-origin",rr[ur].origin),ss.setAttribute("rel","stylesheet"),ss.setAttribute("href",rr[ur].fPath),Ar.appendChild(ss)}}rr[ur].helper=Pt(rr[ur],Ar),rr[ur].cache={},this.fonts.push(rr[ur])}xr===0?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}function Lt(yr){if(yr){this.chars||(this.chars=[]);var Ar,rr=yr.length,ur,Br=this.chars.length,xr;for(Ar=0;Ar<rr;Ar+=1){for(ur=0,xr=!1;ur<Br;)this.chars[ur].style===yr[Ar].style&&this.chars[ur].fFamily===yr[Ar].fFamily&&this.chars[ur].ch===yr[Ar].ch&&(xr=!0),ur+=1;xr||(this.chars.push(yr[Ar]),Br+=1)}}}function Bt(yr,Ar,rr){for(var ur=0,Br=this.chars.length;ur<Br;){if(this.chars[ur].ch===yr&&this.chars[ur].style===Ar&&this.chars[ur].fFamily===rr)return this.chars[ur];ur+=1}return(typeof yr=="string"&&yr.charCodeAt(0)!==13||!yr)&&console&&console.warn&&!this._warned&&(this._warned=!0,console.warn("Missing character from exported characters list: ",yr,Ar,rr)),i}function Nt(yr,Ar,rr){var ur=this.getFontByName(Ar),Br=yr;if(!ur.cache[Br]){var xr=ur.helper;if(yr===" "){var qr=xr.measureText("|"+yr+"|"),tn=xr.measureText("||");ur.cache[Br]=(qr-tn)/100}else ur.cache[Br]=xr.measureText(yr)/100}return ur.cache[Br]*rr}function Vt(yr){for(var Ar=0,rr=this.fonts.length;Ar<rr;){if(this.fonts[Ar].fName===yr)return this.fonts[Ar];Ar+=1}return this.fonts[0]}function Xt(yr){var Ar=0,rr=yr.charCodeAt(0);if(rr>=55296&&rr<=56319){var ur=yr.charCodeAt(1);ur>=56320&&ur<=57343&&(Ar=(rr-55296)*1024+ur-56320+65536)}return Ar}function nr(yr,Ar){var rr=yr.toString(16)+Ar.toString(16);return Tt.indexOf(rr)!==-1}function ar(yr){return yr===ct}function mr(yr){return yr===c}function Fr(yr){var Ar=Xt(yr);return Ar>=dt&&Ar<=gt}function sn(yr){return Fr(yr.substr(0,2))&&Fr(yr.substr(2,2))}function fn(yr){return s.indexOf(yr)!==-1}function Lr(yr,Ar){var rr=Xt(yr.substr(Ar,2));if(rr!==a)return!1;var ur=0;for(Ar+=2;ur<5;){if(rr=Xt(yr.substr(Ar,2)),rr<et||rr>nt)return!1;ur+=1,Ar+=2}return Xt(yr.substr(Ar,2))===_}function Qr(){this.isLoaded=!0}var dn=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this._warned=!1,this.initTime=Date.now(),this.setIsLoadedBinded=this.setIsLoaded.bind(this),this.checkLoadedFontsBinded=this.checkLoadedFonts.bind(this)};dn.isModifier=nr,dn.isZeroWidthJoiner=ar,dn.isFlagEmoji=sn,dn.isRegionalCode=Fr,dn.isCombinedCharacter=fn,dn.isRegionalFlag=Lr,dn.isVariationSelector=mr,dn.BLACK_FLAG_CODE_POINT=a;var en={addChars:Lt,addFonts:$t,getCharData:Bt,getFontByName:Vt,measureText:Nt,checkLoadedFonts:Mt,setIsLoaded:Qr};return dn.prototype=en,dn}();function SlotManager(e){this.animationData=e}SlotManager.prototype.getProp=function(e){return this.animationData.slots&&this.animationData.slots[e.sid]?Object.assign(e,this.animationData.slots[e.sid].p):e};function slotFactory(e){return new SlotManager(e)}function RenderableElement(){}RenderableElement.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(i){this.renderableComponents.indexOf(i)===-1&&this.renderableComponents.push(i)},removeRenderableComponent:function(i){this.renderableComponents.indexOf(i)!==-1&&this.renderableComponents.splice(this.renderableComponents.indexOf(i),1)},prepareRenderableFrame:function(i){this.checkLayerLimits(i)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(i){this.data.ip-this.data.st<=i&&this.data.op-this.data.st>i?this.isInRange!==!0&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):this.isInRange!==!1&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var i,s=this.renderableComponents.length;for(i=0;i<s;i+=1)this.renderableComponents[i].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return this.data.ty===5?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}};var getBlendMode=function(){var e={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"};return function(i){return e[i]||""}}();function SliderEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,0,0,s)}function AngleEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,0,0,s)}function ColorEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,1,0,s)}function PointEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,1,0,s)}function LayerIndexEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,0,0,s)}function MaskIndexEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,0,0,s)}function CheckboxEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,0,0,s)}function NoValueEffect(){this.p={}}function EffectsManager(e,i){var s=e.ef||[];this.effectElements=[];var a,_=s.length,et;for(a=0;a<_;a+=1)et=new GroupEffect(s[a],i),this.effectElements.push(et)}function GroupEffect(e,i){this.init(e,i)}extendPrototype([DynamicPropertyContainer],GroupEffect),GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties,GroupEffect.prototype.init=function(e,i){this.data=e,this.effectElements=[],this.initDynamicPropertyContainer(i);var s,a=this.data.ef.length,_,et=this.data.ef;for(s=0;s<a;s+=1){switch(_=null,et[s].ty){case 0:_=new SliderEffect(et[s],i,this);break;case 1:_=new AngleEffect(et[s],i,this);break;case 2:_=new ColorEffect(et[s],i,this);break;case 3:_=new PointEffect(et[s],i,this);break;case 4:case 7:_=new CheckboxEffect(et[s],i,this);break;case 10:_=new LayerIndexEffect(et[s],i,this);break;case 11:_=new MaskIndexEffect(et[s],i,this);break;case 5:_=new EffectsManager(et[s],i);break;default:_=new NoValueEffect(et[s]);break}_&&this.effectElements.push(_)}};function BaseElement(){}BaseElement.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var i=0,s=this.data.masksProperties.length;i<s;){if(this.data.masksProperties[i].mode!=="n"&&this.data.masksProperties[i].cl!==!1)return!0;i+=1}return!1},initExpressions:function(){var i=getExpressionInterfaces();if(i){var s=i("layer"),a=i("effects"),_=i("shape"),et=i("text"),nt=i("comp");this.layerInterface=s(this),this.data.hasMask&&this.maskManager&&this.layerInterface.registerMaskInterface(this.maskManager);var c=a.createEffectsInterface(this,this.layerInterface);this.layerInterface.registerEffectsInterface(c),this.data.ty===0||this.data.xt?this.compInterface=nt(this):this.data.ty===4?(this.layerInterface.shapeInterface=_(this.shapesData,this.itemsData,this.layerInterface),this.layerInterface.content=this.layerInterface.shapeInterface):this.data.ty===5&&(this.layerInterface.textInterface=et(this),this.layerInterface.text=this.layerInterface.textInterface)}},setBlendMode:function(){var i=getBlendMode(this.data.bm),s=this.baseElement||this.layerElement;s.style["mix-blend-mode"]=i},initBaseData:function(i,s,a){this.globalData=s,this.comp=a,this.data=i,this.layerId=createElementID(),this.data.sr||(this.data.sr=1),this.effectsManager=new EffectsManager(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}};function FrameElement(){}FrameElement.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(i,s){var a,_=this.dynamicProperties.length;for(a=0;a<_;a+=1)(s||this._isParent&&this.dynamicProperties[a].propType==="transform")&&(this.dynamicProperties[a].getValue(),this.dynamicProperties[a]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(i){this.dynamicProperties.indexOf(i)===-1&&this.dynamicProperties.push(i)}};function FootageElement(e,i,s){this.initFrame(),this.initRenderable(),this.assetData=i.getAssetData(e.refId),this.footageData=i.imageLoader.getAsset(this.assetData),this.initBaseData(e,i,s)}FootageElement.prototype.prepareFrame=function(){},extendPrototype([RenderableElement,BaseElement,FrameElement],FootageElement),FootageElement.prototype.getBaseElement=function(){return null},FootageElement.prototype.renderFrame=function(){},FootageElement.prototype.destroy=function(){},FootageElement.prototype.initExpressions=function(){var e=getExpressionInterfaces();if(e){var i=e("footage");this.layerInterface=i(this)}},FootageElement.prototype.getFootageData=function(){return this.footageData};function AudioElement(e,i,s){this.initFrame(),this.initRenderable(),this.assetData=i.getAssetData(e.refId),this.initBaseData(e,i,s),this._isPlaying=!1,this._canPlay=!1;var a=this.globalData.getAssetsPath(this.assetData);this.audio=this.globalData.audioController.createAudio(a),this._currentTime=0,this.globalData.audioController.addAudio(this),this._volumeMultiplier=1,this._volume=1,this._previousVolume=null,this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0},this.lv=PropertyFactory.getProp(this,e.au&&e.au.lv?e.au.lv:{k:[100]},1,.01,this)}AudioElement.prototype.prepareFrame=function(e){if(this.prepareRenderableFrame(e,!0),this.prepareProperties(e,!0),this.tm._placeholder)this._currentTime=e/this.data.sr;else{var i=this.tm.v;this._currentTime=i}this._volume=this.lv.v[0];var s=this._volume*this._volumeMultiplier;this._previousVolume!==s&&(this._previousVolume=s,this.audio.volume(s))},extendPrototype([RenderableElement,BaseElement,FrameElement],AudioElement),AudioElement.prototype.renderFrame=function(){this.isInRange&&this._canPlay&&(this._isPlaying?(!this.audio.playing()||Math.abs(this._currentTime/this.globalData.frameRate-this.audio.seek())>.1)&&this.audio.seek(this._currentTime/this.globalData.frameRate):(this.audio.play(),this.audio.seek(this._currentTime/this.globalData.frameRate),this._isPlaying=!0))},AudioElement.prototype.show=function(){},AudioElement.prototype.hide=function(){this.audio.pause(),this._isPlaying=!1},AudioElement.prototype.pause=function(){this.audio.pause(),this._isPlaying=!1,this._canPlay=!1},AudioElement.prototype.resume=function(){this._canPlay=!0},AudioElement.prototype.setRate=function(e){this.audio.rate(e)},AudioElement.prototype.volume=function(e){this._volumeMultiplier=e,this._previousVolume=e*this._volume,this.audio.volume(this._previousVolume)},AudioElement.prototype.getBaseElement=function(){return null},AudioElement.prototype.destroy=function(){},AudioElement.prototype.sourceRectAtTime=function(){},AudioElement.prototype.initExpressions=function(){};function BaseRenderer(){}BaseRenderer.prototype.checkLayers=function(e){var i,s=this.layers.length,a;for(this.completeLayers=!0,i=s-1;i>=0;i-=1)this.elements[i]||(a=this.layers[i],a.ip-a.st<=e-this.layers[i].st&&a.op-a.st>e-this.layers[i].st&&this.buildItem(i)),this.completeLayers=this.elements[i]?this.completeLayers:!1;this.checkPendingElements()},BaseRenderer.prototype.createItem=function(e){switch(e.ty){case 2:return this.createImage(e);case 0:return this.createComp(e);case 1:return this.createSolid(e);case 3:return this.createNull(e);case 4:return this.createShape(e);case 5:return this.createText(e);case 6:return this.createAudio(e);case 13:return this.createCamera(e);case 15:return this.createFootage(e);default:return this.createNull(e)}},BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},BaseRenderer.prototype.createAudio=function(e){return new AudioElement(e,this.globalData,this)},BaseRenderer.prototype.createFootage=function(e){return new FootageElement(e,this.globalData,this)},BaseRenderer.prototype.buildAllItems=function(){var e,i=this.layers.length;for(e=0;e<i;e+=1)this.buildItem(e);this.checkPendingElements()},BaseRenderer.prototype.includeLayers=function(e){this.completeLayers=!1;var i,s=e.length,a,_=this.layers.length;for(i=0;i<s;i+=1)for(a=0;a<_;){if(this.layers[a].id===e[i].id){this.layers[a]=e[i];break}a+=1}},BaseRenderer.prototype.setProjectInterface=function(e){this.globalData.projectInterface=e},BaseRenderer.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},BaseRenderer.prototype.buildElementParenting=function(e,i,s){for(var a=this.elements,_=this.layers,et=0,nt=_.length;et<nt;)_[et].ind==i&&(!a[et]||a[et]===!0?(this.buildItem(et),this.addPendingElement(e)):(s.push(a[et]),a[et].setAsParent(),_[et].parent!==void 0?this.buildElementParenting(e,_[et].parent,s):e.setHierarchy(s))),et+=1},BaseRenderer.prototype.addPendingElement=function(e){this.pendingElements.push(e)},BaseRenderer.prototype.searchExtraCompositions=function(e){var i,s=e.length;for(i=0;i<s;i+=1)if(e[i].xt){var a=this.createComp(e[i]);a.initExpressions(),this.globalData.projectInterface.registerComposition(a)}},BaseRenderer.prototype.getElementById=function(e){var i,s=this.elements.length;for(i=0;i<s;i+=1)if(this.elements[i].data.ind===e)return this.elements[i];return null},BaseRenderer.prototype.getElementByPath=function(e){var i=e.shift(),s;if(typeof i=="number")s=this.elements[i];else{var a,_=this.elements.length;for(a=0;a<_;a+=1)if(this.elements[a].data.nm===i){s=this.elements[a];break}}return e.length===0?s:s.getElementByPath(e)},BaseRenderer.prototype.setupGlobalData=function(e,i){this.globalData.fontManager=new FontManager,this.globalData.slotManager=slotFactory(e),this.globalData.fontManager.addChars(e.chars),this.globalData.fontManager.addFonts(e.fonts,i),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.audioController=this.animationItem.audioController,this.globalData.frameId=0,this.globalData.frameRate=e.fr,this.globalData.nm=e.nm,this.globalData.compSize={w:e.w,h:e.h}};var effectTypes={TRANSFORM_EFFECT:"transformEFfect"};function TransformElement(){}TransformElement.prototype={initTransform:function(){var i=new Matrix;this.finalTransform={mProp:this.data.ks?TransformPropertyFactory.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_localMatMdf:!1,_opMdf:!1,mat:i,localMat:i,localOpacity:1},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var i,s=this.finalTransform.mat,a=0,_=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;a<_;){if(this.hierarchy[a].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}a+=1}if(this.finalTransform._matMdf)for(i=this.finalTransform.mProp.v.props,s.cloneFromProps(i),a=0;a<_;a+=1)s.multiply(this.hierarchy[a].finalTransform.mProp.v)}(!this.localTransforms||this.finalTransform._matMdf)&&(this.finalTransform._localMatMdf=this.finalTransform._matMdf),this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v)},renderLocalTransform:function(){if(this.localTransforms){var i=0,s=this.localTransforms.length;if(this.finalTransform._localMatMdf=this.finalTransform._matMdf,!this.finalTransform._localMatMdf||!this.finalTransform._opMdf)for(;i<s;)this.localTransforms[i]._mdf&&(this.finalTransform._localMatMdf=!0),this.localTransforms[i]._opMdf&&!this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v,this.finalTransform._opMdf=!0),i+=1;if(this.finalTransform._localMatMdf){var a=this.finalTransform.localMat;for(this.localTransforms[0].matrix.clone(a),i=1;i<s;i+=1){var _=this.localTransforms[i].matrix;a.multiply(_)}a.multiply(this.finalTransform.mat)}if(this.finalTransform._opMdf){var et=this.finalTransform.localOpacity;for(i=0;i<s;i+=1)et*=this.localTransforms[i].opacity*.01;this.finalTransform.localOpacity=et}}},searchEffectTransforms:function(){if(this.renderableEffectsManager){var i=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT);if(i.length){this.localTransforms=[],this.finalTransform.localMat=new Matrix;var s=0,a=i.length;for(s=0;s<a;s+=1)this.localTransforms.push(i[s])}}},globalToLocal:function(i){var s=[];s.push(this.finalTransform);for(var a=!0,_=this.comp;a;)_.finalTransform?(_.data.hasMask&&s.splice(0,0,_.finalTransform),_=_.comp):a=!1;var et,nt=s.length,c;for(et=0;et<nt;et+=1)c=s[et].mat.applyToPointArray(0,0,0),i=[i[0]-c[0],i[1]-c[1],0];return i},mHelper:new Matrix};function MaskElement(e,i,s){this.data=e,this.element=i,this.globalData=s,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var a=this.globalData.defs,_,et=this.masksProperties?this.masksProperties.length:0;this.viewData=createSizedArray(et),this.solidPath="";var nt,c=this.masksProperties,ct=0,dt=[],gt,Tt,Et=createElementID(),At,Mt,Pt,$t,Lt="clipPath",Bt="clip-path";for(_=0;_<et;_+=1)if((c[_].mode!=="a"&&c[_].mode!=="n"||c[_].inv||c[_].o.k!==100||c[_].o.x)&&(Lt="mask",Bt="mask"),(c[_].mode==="s"||c[_].mode==="i")&&ct===0?(At=createNS("rect"),At.setAttribute("fill","#ffffff"),At.setAttribute("width",this.element.comp.data.w||0),At.setAttribute("height",this.element.comp.data.h||0),dt.push(At)):At=null,nt=createNS("path"),c[_].mode==="n")this.viewData[_]={op:PropertyFactory.getProp(this.element,c[_].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,c[_],3),elem:nt,lastPath:""},a.appendChild(nt);else{ct+=1,nt.setAttribute("fill",c[_].mode==="s"?"#000000":"#ffffff"),nt.setAttribute("clip-rule","nonzero");var Nt;if(c[_].x.k!==0?(Lt="mask",Bt="mask",$t=PropertyFactory.getProp(this.element,c[_].x,0,null,this.element),Nt=createElementID(),Mt=createNS("filter"),Mt.setAttribute("id",Nt),Pt=createNS("feMorphology"),Pt.setAttribute("operator","erode"),Pt.setAttribute("in","SourceGraphic"),Pt.setAttribute("radius","0"),Mt.appendChild(Pt),a.appendChild(Mt),nt.setAttribute("stroke",c[_].mode==="s"?"#000000":"#ffffff")):(Pt=null,$t=null),this.storedData[_]={elem:nt,x:$t,expan:Pt,lastPath:"",lastOperator:"",filterId:Nt,lastRadius:0},c[_].mode==="i"){Tt=dt.length;var Vt=createNS("g");for(gt=0;gt<Tt;gt+=1)Vt.appendChild(dt[gt]);var Xt=createNS("mask");Xt.setAttribute("mask-type","alpha"),Xt.setAttribute("id",Et+"_"+ct),Xt.appendChild(nt),a.appendChild(Xt),Vt.setAttribute("mask","url("+getLocationHref()+"#"+Et+"_"+ct+")"),dt.length=0,dt.push(Vt)}else dt.push(nt);c[_].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[_]={elem:nt,lastPath:"",op:PropertyFactory.getProp(this.element,c[_].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,c[_],3),invRect:At},this.viewData[_].prop.k||this.drawPath(c[_],this.viewData[_].prop.v,this.viewData[_])}for(this.maskElement=createNS(Lt),et=dt.length,_=0;_<et;_+=1)this.maskElement.appendChild(dt[_]);ct>0&&(this.maskElement.setAttribute("id",Et),this.element.maskedElement.setAttribute(Bt,"url("+getLocationHref()+"#"+Et+")"),a.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}MaskElement.prototype.getMaskProperty=function(e){return this.viewData[e].prop},MaskElement.prototype.renderFrame=function(e){var i=this.element.finalTransform.mat,s,a=this.masksProperties.length;for(s=0;s<a;s+=1)if((this.viewData[s].prop._mdf||e)&&this.drawPath(this.masksProperties[s],this.viewData[s].prop.v,this.viewData[s]),(this.viewData[s].op._mdf||e)&&this.viewData[s].elem.setAttribute("fill-opacity",this.viewData[s].op.v),this.masksProperties[s].mode!=="n"&&(this.viewData[s].invRect&&(this.element.finalTransform.mProp._mdf||e)&&this.viewData[s].invRect.setAttribute("transform",i.getInverseMatrix().to2dCSS()),this.storedData[s].x&&(this.storedData[s].x._mdf||e))){var _=this.storedData[s].expan;this.storedData[s].x.v<0?(this.storedData[s].lastOperator!=="erode"&&(this.storedData[s].lastOperator="erode",this.storedData[s].elem.setAttribute("filter","url("+getLocationHref()+"#"+this.storedData[s].filterId+")")),_.setAttribute("radius",-this.storedData[s].x.v)):(this.storedData[s].lastOperator!=="dilate"&&(this.storedData[s].lastOperator="dilate",this.storedData[s].elem.setAttribute("filter",null)),this.storedData[s].elem.setAttribute("stroke-width",this.storedData[s].x.v*2))}},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var e="M0,0 ";return e+=" h"+this.globalData.compSize.w,e+=" v"+this.globalData.compSize.h,e+=" h-"+this.globalData.compSize.w,e+=" v-"+this.globalData.compSize.h+" ",e},MaskElement.prototype.drawPath=function(e,i,s){var a=" M"+i.v[0][0]+","+i.v[0][1],_,et;for(et=i._length,_=1;_<et;_+=1)a+=" C"+i.o[_-1][0]+","+i.o[_-1][1]+" "+i.i[_][0]+","+i.i[_][1]+" "+i.v[_][0]+","+i.v[_][1];if(i.c&&et>1&&(a+=" C"+i.o[_-1][0]+","+i.o[_-1][1]+" "+i.i[0][0]+","+i.i[0][1]+" "+i.v[0][0]+","+i.v[0][1]),s.lastPath!==a){var nt="";s.elem&&(i.c&&(nt=e.inv?this.solidPath+a:a),s.elem.setAttribute("d",nt)),s.lastPath=a}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null};var filtersFactory=function(){var e={};e.createFilter=i,e.createAlphaToLuminanceFilter=s;function i(a,_){var et=createNS("filter");return et.setAttribute("id",a),_!==!0&&(et.setAttribute("filterUnits","objectBoundingBox"),et.setAttribute("x","0%"),et.setAttribute("y","0%"),et.setAttribute("width","100%"),et.setAttribute("height","100%")),et}function s(){var a=createNS("feColorMatrix");return a.setAttribute("type","matrix"),a.setAttribute("color-interpolation-filters","sRGB"),a.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),a}return e}(),featureSupport=function(){var e={maskType:!0,svgLumaHidden:!0,offscreenCanvas:typeof OffscreenCanvas<"u"};return(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(e.maskType=!1),/firefox/i.test(navigator.userAgent)&&(e.svgLumaHidden=!1),e}(),registeredEffects$1={},idPrefix="filter_result_";function SVGEffects(e){var i,s="SourceGraphic",a=e.data.ef?e.data.ef.length:0,_=createElementID(),et=filtersFactory.createFilter(_,!0),nt=0;this.filters=[];var c;for(i=0;i<a;i+=1){c=null;var ct=e.data.ef[i].ty;if(registeredEffects$1[ct]){var dt=registeredEffects$1[ct].effect;c=new dt(et,e.effectsManager.effectElements[i],e,idPrefix+nt,s),s=idPrefix+nt,registeredEffects$1[ct].countsAsEffect&&(nt+=1)}c&&this.filters.push(c)}nt&&(e.globalData.defs.appendChild(et),e.layerElement.setAttribute("filter","url("+getLocationHref()+"#"+_+")")),this.filters.length&&e.addRenderableComponent(this)}SVGEffects.prototype.renderFrame=function(e){var i,s=this.filters.length;for(i=0;i<s;i+=1)this.filters[i].renderFrame(e)},SVGEffects.prototype.getEffects=function(e){var i,s=this.filters.length,a=[];for(i=0;i<s;i+=1)this.filters[i].type===e&&a.push(this.filters[i]);return a};function registerEffect$1(e,i,s){registeredEffects$1[e]={effect:i,countsAsEffect:s}}function SVGBaseElement(){}SVGBaseElement.prototype={initRendererElement:function(){this.layerElement=createNS("g")},createContainerElements:function(){this.matteElement=createNS("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var i=null;if(this.data.td){this.matteMasks={};var s=createNS("g");s.setAttribute("id",this.layerId),s.appendChild(this.layerElement),i=s,this.globalData.defs.appendChild(s)}else this.data.tt?(this.matteElement.appendChild(this.layerElement),i=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.ty===0&&!this.data.hd){var a=createNS("clipPath"),_=createNS("path");_.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var et=createElementID();if(a.setAttribute("id",et),a.appendChild(_),this.globalData.defs.appendChild(a),this.checkMasks()){var nt=createNS("g");nt.setAttribute("clip-path","url("+getLocationHref()+"#"+et+")"),nt.appendChild(this.layerElement),this.transformedElement=nt,i?i.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+et+")")}this.data.bm!==0&&this.setBlendMode()},renderElement:function(){this.finalTransform._localMatMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.localMat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.localOpacity)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData),this.renderableEffectsManager=new SVGEffects(this),this.searchEffectTransforms()},getMatte:function(i){if(this.matteMasks||(this.matteMasks={}),!this.matteMasks[i]){var s=this.layerId+"_"+i,a,_,et,nt;if(i===1||i===3){var c=createNS("mask");c.setAttribute("id",s),c.setAttribute("mask-type",i===3?"luminance":"alpha"),et=createNS("use"),et.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),c.appendChild(et),this.globalData.defs.appendChild(c),!featureSupport.maskType&&i===1&&(c.setAttribute("mask-type","luminance"),a=createElementID(),_=filtersFactory.createFilter(a),this.globalData.defs.appendChild(_),_.appendChild(filtersFactory.createAlphaToLuminanceFilter()),nt=createNS("g"),nt.appendChild(et),c.appendChild(nt),nt.setAttribute("filter","url("+getLocationHref()+"#"+a+")"))}else if(i===2){var ct=createNS("mask");ct.setAttribute("id",s),ct.setAttribute("mask-type","alpha");var dt=createNS("g");ct.appendChild(dt),a=createElementID(),_=filtersFactory.createFilter(a);var gt=createNS("feComponentTransfer");gt.setAttribute("in","SourceGraphic"),_.appendChild(gt);var Tt=createNS("feFuncA");Tt.setAttribute("type","table"),Tt.setAttribute("tableValues","1.0 0.0"),gt.appendChild(Tt),this.globalData.defs.appendChild(_);var Et=createNS("rect");Et.setAttribute("width",this.comp.data.w),Et.setAttribute("height",this.comp.data.h),Et.setAttribute("x","0"),Et.setAttribute("y","0"),Et.setAttribute("fill","#ffffff"),Et.setAttribute("opacity","0"),dt.setAttribute("filter","url("+getLocationHref()+"#"+a+")"),dt.appendChild(Et),et=createNS("use"),et.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),dt.appendChild(et),featureSupport.maskType||(ct.setAttribute("mask-type","luminance"),_.appendChild(filtersFactory.createAlphaToLuminanceFilter()),nt=createNS("g"),dt.appendChild(Et),nt.appendChild(this.layerElement),dt.appendChild(nt)),this.globalData.defs.appendChild(ct)}this.matteMasks[i]=s}return this.matteMasks[i]},setMatte:function(i){this.matteElement&&this.matteElement.setAttribute("mask","url("+getLocationHref()+"#"+i+")")}};function HierarchyElement(){}HierarchyElement.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(i){this.hierarchy=i},setAsParent:function(){this._isParent=!0},checkParenting:function(){this.data.parent!==void 0&&this.comp.buildElementParenting(this,this.data.parent,[])}};function RenderableDOMElement(){}(function(){var e={initElement:function(s,a,_){this.initFrame(),this.initBaseData(s,a,_),this.initTransform(s,a,_),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){if(!this.hidden&&(!this.isInRange||this.isTransparent)){var s=this.baseElement||this.layerElement;s.style.display="none",this.hidden=!0}},show:function(){if(this.isInRange&&!this.isTransparent){if(!this.data.hd){var s=this.baseElement||this.layerElement;s.style.display="block"}this.hidden=!1,this._isFirstFrame=!0}},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(s){this._mdf=!1,this.prepareRenderableFrame(s),this.prepareProperties(s,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}};extendPrototype([RenderableElement,createProxyFunction(e)],RenderableDOMElement)})();function IImageElement(e,i,s){this.assetData=i.getAssetData(e.refId),this.assetData&&this.assetData.sid&&(this.assetData=i.slotManager.getProp(this.assetData)),this.initElement(e,i,s),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement),IImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData);this.innerElem=createNS("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.innerElem)},IImageElement.prototype.sourceRectAtTime=function(){return this.sourceRect};function ProcessedElement(e,i){this.elem=e,this.pos=i}function IShapeElement(){}IShapeElement.prototype={addShapeToModifiers:function(i){var s,a=this.shapeModifiers.length;for(s=0;s<a;s+=1)this.shapeModifiers[s].addShape(i)},isShapeInAnimatedModifiers:function(i){for(var s=0,a=this.shapeModifiers.length;s<a;)if(this.shapeModifiers[s].isAnimatedWithShape(i))return!0;return!1},renderModifiers:function(){if(this.shapeModifiers.length){var i,s=this.shapes.length;for(i=0;i<s;i+=1)this.shapes[i].sh.reset();s=this.shapeModifiers.length;var a;for(i=s-1;i>=0&&(a=this.shapeModifiers[i].processShapes(this._isFirstFrame),!a);i-=1);}},searchProcessedElement:function(i){for(var s=this.processedElements,a=0,_=s.length;a<_;){if(s[a].elem===i)return s[a].pos;a+=1}return 0},addProcessedElement:function(i,s){for(var a=this.processedElements,_=a.length;_;)if(_-=1,a[_].elem===i){a[_].pos=s;return}a.push(new ProcessedElement(i,s))},prepareFrame:function(i){this.prepareRenderableFrame(i),this.prepareProperties(i,this.isInRange)}};var lineCapEnum={1:"butt",2:"round",3:"square"},lineJoinEnum={1:"miter",2:"round",3:"bevel"};function SVGShapeData(e,i,s){this.caches=[],this.styles=[],this.transformers=e,this.lStr="",this.sh=s,this.lvl=i,this._isAnimated=!!s.k;for(var a=0,_=e.length;a<_;){if(e[a].mProps.dynamicProperties.length){this._isAnimated=!0;break}a+=1}}SVGShapeData.prototype.setAsAnimated=function(){this._isAnimated=!0};function SVGStyleData(e,i){this.data=e,this.type=e.ty,this.d="",this.lvl=i,this._mdf=!1,this.closed=e.hd===!0,this.pElem=createNS("path"),this.msElem=null}SVGStyleData.prototype.reset=function(){this.d="",this._mdf=!1};function DashProperty(e,i,s,a){this.elem=e,this.frameId=-1,this.dataProps=createSizedArray(i.length),this.renderer=s,this.k=!1,this.dashStr="",this.dashArray=createTypedArray("float32",i.length?i.length-1:0),this.dashoffset=createTypedArray("float32",1),this.initDynamicPropertyContainer(a);var _,et=i.length||0,nt;for(_=0;_<et;_+=1)nt=PropertyFactory.getProp(e,i[_].v,0,0,this),this.k=nt.k||this.k,this.dataProps[_]={n:i[_].n,p:nt};this.k||this.getValue(!0),this._isAnimated=this.k}DashProperty.prototype.getValue=function(e){if(!(this.elem.globalData.frameId===this.frameId&&!e)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||e,this._mdf)){var i=0,s=this.dataProps.length;for(this.renderer==="svg"&&(this.dashStr=""),i=0;i<s;i+=1)this.dataProps[i].n!=="o"?this.renderer==="svg"?this.dashStr+=" "+this.dataProps[i].p.v:this.dashArray[i]=this.dataProps[i].p.v:this.dashoffset[0]=this.dataProps[i].p.v}},extendPrototype([DynamicPropertyContainer],DashProperty);function SVGStrokeStyleData(e,i,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,i.o,0,.01,this),this.w=PropertyFactory.getProp(e,i.w,0,null,this),this.d=new DashProperty(e,i.d||{},"svg",this),this.c=PropertyFactory.getProp(e,i.c,1,255,this),this.style=s,this._isAnimated=!!this._isAnimated}extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData);function SVGFillStyleData(e,i,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,i.o,0,.01,this),this.c=PropertyFactory.getProp(e,i.c,1,255,this),this.style=s}extendPrototype([DynamicPropertyContainer],SVGFillStyleData);function SVGNoStyleData(e,i,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.style=s}extendPrototype([DynamicPropertyContainer],SVGNoStyleData);function GradientProperty(e,i,s){this.data=i,this.c=createTypedArray("uint8c",i.p*4);var a=i.k.k[0].s?i.k.k[0].s.length-i.p*4:i.k.k.length-i.p*4;this.o=createTypedArray("float32",a),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=a,this.initDynamicPropertyContainer(s),this.prop=PropertyFactory.getProp(e,i.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}GradientProperty.prototype.comparePoints=function(e,i){for(var s=0,a=this.o.length/2,_;s<a;){if(_=Math.abs(e[s*4]-e[i*4+s*2]),_>.01)return!1;s+=1}return!0},GradientProperty.prototype.checkCollapsable=function(){if(this.o.length/2!==this.c.length/4)return!1;if(this.data.k.k[0].s)for(var e=0,i=this.data.k.k.length;e<i;){if(!this.comparePoints(this.data.k.k[e].s,this.data.p))return!1;e+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},GradientProperty.prototype.getValue=function(e){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||e){var i,s=this.data.p*4,a,_;for(i=0;i<s;i+=1)a=i%4===0?100:255,_=Math.round(this.prop.v[i]*a),this.c[i]!==_&&(this.c[i]=_,this._cmdf=!e);if(this.o.length)for(s=this.prop.v.length,i=this.data.p*4;i<s;i+=1)a=i%2===0?100:1,_=i%2===0?Math.round(this.prop.v[i]*100):this.prop.v[i],this.o[i-this.data.p*4]!==_&&(this.o[i-this.data.p*4]=_,this._omdf=!e);this._mdf=!e}},extendPrototype([DynamicPropertyContainer],GradientProperty);function SVGGradientFillStyleData(e,i,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.initGradientData(e,i,s)}SVGGradientFillStyleData.prototype.initGradientData=function(e,i,s){this.o=PropertyFactory.getProp(e,i.o,0,.01,this),this.s=PropertyFactory.getProp(e,i.s,1,null,this),this.e=PropertyFactory.getProp(e,i.e,1,null,this),this.h=PropertyFactory.getProp(e,i.h||{k:0},0,.01,this),this.a=PropertyFactory.getProp(e,i.a||{k:0},0,degToRads,this),this.g=new GradientProperty(e,i.g,this),this.style=s,this.stops=[],this.setGradientData(s.pElem,i),this.setGradientOpacity(i,s),this._isAnimated=!!this._isAnimated},SVGGradientFillStyleData.prototype.setGradientData=function(e,i){var s=createElementID(),a=createNS(i.t===1?"linearGradient":"radialGradient");a.setAttribute("id",s),a.setAttribute("spreadMethod","pad"),a.setAttribute("gradientUnits","userSpaceOnUse");var _=[],et,nt,c;for(c=i.g.p*4,nt=0;nt<c;nt+=4)et=createNS("stop"),a.appendChild(et),_.push(et);e.setAttribute(i.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+s+")"),this.gf=a,this.cst=_},SVGGradientFillStyleData.prototype.setGradientOpacity=function(e,i){if(this.g._hasOpacity&&!this.g._collapsable){var s,a,_,et=createNS("mask"),nt=createNS("path");et.appendChild(nt);var c=createElementID(),ct=createElementID();et.setAttribute("id",ct);var dt=createNS(e.t===1?"linearGradient":"radialGradient");dt.setAttribute("id",c),dt.setAttribute("spreadMethod","pad"),dt.setAttribute("gradientUnits","userSpaceOnUse"),_=e.g.k.k[0].s?e.g.k.k[0].s.length:e.g.k.k.length;var gt=this.stops;for(a=e.g.p*4;a<_;a+=2)s=createNS("stop"),s.setAttribute("stop-color","rgb(255,255,255)"),dt.appendChild(s),gt.push(s);nt.setAttribute(e.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+c+")"),e.ty==="gs"&&(nt.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),nt.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),e.lj===1&&nt.setAttribute("stroke-miterlimit",e.ml)),this.of=dt,this.ms=et,this.ost=gt,this.maskId=ct,i.msElem=nt}},extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData);function SVGGradientStrokeStyleData(e,i,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.w=PropertyFactory.getProp(e,i.w,0,null,this),this.d=new DashProperty(e,i.d||{},"svg",this),this.initGradientData(e,i,s),this._isAnimated=!!this._isAnimated}extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);function ShapeGroupData(){this.it=[],this.prevViewData=[],this.gr=createNS("g")}function SVGTransformData(e,i,s){this.transform={mProps:e,op:i,container:s},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}var buildShapeString=function(i,s,a,_){if(s===0)return"";var et=i.o,nt=i.i,c=i.v,ct,dt=" M"+_.applyToPointStringified(c[0][0],c[0][1]);for(ct=1;ct<s;ct+=1)dt+=" C"+_.applyToPointStringified(et[ct-1][0],et[ct-1][1])+" "+_.applyToPointStringified(nt[ct][0],nt[ct][1])+" "+_.applyToPointStringified(c[ct][0],c[ct][1]);return a&&s&&(dt+=" C"+_.applyToPointStringified(et[ct-1][0],et[ct-1][1])+" "+_.applyToPointStringified(nt[0][0],nt[0][1])+" "+_.applyToPointStringified(c[0][0],c[0][1]),dt+="z"),dt},SVGElementsRenderer=function(){var e=new Matrix,i=new Matrix,s={createRenderFunction:a};function a(Tt){switch(Tt.ty){case"fl":return c;case"gf":return dt;case"gs":return ct;case"st":return gt;case"sh":case"el":case"rc":case"sr":return nt;case"tr":return _;case"no":return et;default:return null}}function _(Tt,Et,At){(At||Et.transform.op._mdf)&&Et.transform.container.setAttribute("opacity",Et.transform.op.v),(At||Et.transform.mProps._mdf)&&Et.transform.container.setAttribute("transform",Et.transform.mProps.v.to2dCSS())}function et(){}function nt(Tt,Et,At){var Mt,Pt,$t,Lt,Bt,Nt,Vt=Et.styles.length,Xt=Et.lvl,nr,ar,mr,Fr;for(Nt=0;Nt<Vt;Nt+=1){if(Lt=Et.sh._mdf||At,Et.styles[Nt].lvl<Xt){for(ar=i.reset(),mr=Xt-Et.styles[Nt].lvl,Fr=Et.transformers.length-1;!Lt&&mr>0;)Lt=Et.transformers[Fr].mProps._mdf||Lt,mr-=1,Fr-=1;if(Lt)for(mr=Xt-Et.styles[Nt].lvl,Fr=Et.transformers.length-1;mr>0;)ar.multiply(Et.transformers[Fr].mProps.v),mr-=1,Fr-=1}else ar=e;if(nr=Et.sh.paths,Pt=nr._length,Lt){for($t="",Mt=0;Mt<Pt;Mt+=1)Bt=nr.shapes[Mt],Bt&&Bt._length&&($t+=buildShapeString(Bt,Bt._length,Bt.c,ar));Et.caches[Nt]=$t}else $t=Et.caches[Nt];Et.styles[Nt].d+=Tt.hd===!0?"":$t,Et.styles[Nt]._mdf=Lt||Et.styles[Nt]._mdf}}function c(Tt,Et,At){var Mt=Et.style;(Et.c._mdf||At)&&Mt.pElem.setAttribute("fill","rgb("+bmFloor(Et.c.v[0])+","+bmFloor(Et.c.v[1])+","+bmFloor(Et.c.v[2])+")"),(Et.o._mdf||At)&&Mt.pElem.setAttribute("fill-opacity",Et.o.v)}function ct(Tt,Et,At){dt(Tt,Et,At),gt(Tt,Et,At)}function dt(Tt,Et,At){var Mt=Et.gf,Pt=Et.g._hasOpacity,$t=Et.s.v,Lt=Et.e.v;if(Et.o._mdf||At){var Bt=Tt.ty==="gf"?"fill-opacity":"stroke-opacity";Et.style.pElem.setAttribute(Bt,Et.o.v)}if(Et.s._mdf||At){var Nt=Tt.t===1?"x1":"cx",Vt=Nt==="x1"?"y1":"cy";Mt.setAttribute(Nt,$t[0]),Mt.setAttribute(Vt,$t[1]),Pt&&!Et.g._collapsable&&(Et.of.setAttribute(Nt,$t[0]),Et.of.setAttribute(Vt,$t[1]))}var Xt,nr,ar,mr;if(Et.g._cmdf||At){Xt=Et.cst;var Fr=Et.g.c;for(ar=Xt.length,nr=0;nr<ar;nr+=1)mr=Xt[nr],mr.setAttribute("offset",Fr[nr*4]+"%"),mr.setAttribute("stop-color","rgb("+Fr[nr*4+1]+","+Fr[nr*4+2]+","+Fr[nr*4+3]+")")}if(Pt&&(Et.g._omdf||At)){var sn=Et.g.o;for(Et.g._collapsable?Xt=Et.cst:Xt=Et.ost,ar=Xt.length,nr=0;nr<ar;nr+=1)mr=Xt[nr],Et.g._collapsable||mr.setAttribute("offset",sn[nr*2]+"%"),mr.setAttribute("stop-opacity",sn[nr*2+1])}if(Tt.t===1)(Et.e._mdf||At)&&(Mt.setAttribute("x2",Lt[0]),Mt.setAttribute("y2",Lt[1]),Pt&&!Et.g._collapsable&&(Et.of.setAttribute("x2",Lt[0]),Et.of.setAttribute("y2",Lt[1])));else{var fn;if((Et.s._mdf||Et.e._mdf||At)&&(fn=Math.sqrt(Math.pow($t[0]-Lt[0],2)+Math.pow($t[1]-Lt[1],2)),Mt.setAttribute("r",fn),Pt&&!Et.g._collapsable&&Et.of.setAttribute("r",fn)),Et.s._mdf||Et.e._mdf||Et.h._mdf||Et.a._mdf||At){fn||(fn=Math.sqrt(Math.pow($t[0]-Lt[0],2)+Math.pow($t[1]-Lt[1],2)));var Lr=Math.atan2(Lt[1]-$t[1],Lt[0]-$t[0]),Qr=Et.h.v;Qr>=1?Qr=.99:Qr<=-1&&(Qr=-.99);var dn=fn*Qr,en=Math.cos(Lr+Et.a.v)*dn+$t[0],yr=Math.sin(Lr+Et.a.v)*dn+$t[1];Mt.setAttribute("fx",en),Mt.setAttribute("fy",yr),Pt&&!Et.g._collapsable&&(Et.of.setAttribute("fx",en),Et.of.setAttribute("fy",yr))}}}function gt(Tt,Et,At){var Mt=Et.style,Pt=Et.d;Pt&&(Pt._mdf||At)&&Pt.dashStr&&(Mt.pElem.setAttribute("stroke-dasharray",Pt.dashStr),Mt.pElem.setAttribute("stroke-dashoffset",Pt.dashoffset[0])),Et.c&&(Et.c._mdf||At)&&Mt.pElem.setAttribute("stroke","rgb("+bmFloor(Et.c.v[0])+","+bmFloor(Et.c.v[1])+","+bmFloor(Et.c.v[2])+")"),(Et.o._mdf||At)&&Mt.pElem.setAttribute("stroke-opacity",Et.o.v),(Et.w._mdf||At)&&(Mt.pElem.setAttribute("stroke-width",Et.w.v),Mt.msElem&&Mt.msElem.setAttribute("stroke-width",Et.w.v))}return s}();function SVGShapeElement(e,i,s){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(e,i,s),this.prevViewData=[]}extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement),SVGShapeElement.prototype.initSecondaryElement=function(){},SVGShapeElement.prototype.identityMatrix=new Matrix,SVGShapeElement.prototype.buildExpressionInterface=function(){},SVGShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},SVGShapeElement.prototype.filterUniqueShapes=function(){var e,i=this.shapes.length,s,a,_=this.stylesList.length,et,nt=[],c=!1;for(a=0;a<_;a+=1){for(et=this.stylesList[a],c=!1,nt.length=0,e=0;e<i;e+=1)s=this.shapes[e],s.styles.indexOf(et)!==-1&&(nt.push(s),c=s._isAnimated||c);nt.length>1&&c&&this.setShapesAsAnimated(nt)}},SVGShapeElement.prototype.setShapesAsAnimated=function(e){var i,s=e.length;for(i=0;i<s;i+=1)e[i].setAsAnimated()},SVGShapeElement.prototype.createStyleElement=function(e,i){var s,a=new SVGStyleData(e,i),_=a.pElem;if(e.ty==="st")s=new SVGStrokeStyleData(this,e,a);else if(e.ty==="fl")s=new SVGFillStyleData(this,e,a);else if(e.ty==="gf"||e.ty==="gs"){var et=e.ty==="gf"?SVGGradientFillStyleData:SVGGradientStrokeStyleData;s=new et(this,e,a),this.globalData.defs.appendChild(s.gf),s.maskId&&(this.globalData.defs.appendChild(s.ms),this.globalData.defs.appendChild(s.of),_.setAttribute("mask","url("+getLocationHref()+"#"+s.maskId+")"))}else e.ty==="no"&&(s=new SVGNoStyleData(this,e,a));return(e.ty==="st"||e.ty==="gs")&&(_.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),_.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),_.setAttribute("fill-opacity","0"),e.lj===1&&_.setAttribute("stroke-miterlimit",e.ml)),e.r===2&&_.setAttribute("fill-rule","evenodd"),e.ln&&_.setAttribute("id",e.ln),e.cl&&_.setAttribute("class",e.cl),e.bm&&(_.style["mix-blend-mode"]=getBlendMode(e.bm)),this.stylesList.push(a),this.addToAnimatedContents(e,s),s},SVGShapeElement.prototype.createGroupElement=function(e){var i=new ShapeGroupData;return e.ln&&i.gr.setAttribute("id",e.ln),e.cl&&i.gr.setAttribute("class",e.cl),e.bm&&(i.gr.style["mix-blend-mode"]=getBlendMode(e.bm)),i},SVGShapeElement.prototype.createTransformElement=function(e,i){var s=TransformPropertyFactory.getTransformProperty(this,e,this),a=new SVGTransformData(s,s.o,i);return this.addToAnimatedContents(e,a),a},SVGShapeElement.prototype.createShapeElement=function(e,i,s){var a=4;e.ty==="rc"?a=5:e.ty==="el"?a=6:e.ty==="sr"&&(a=7);var _=ShapePropertyFactory.getShapeProp(this,e,a,this),et=new SVGShapeData(i,s,_);return this.shapes.push(et),this.addShapeToModifiers(et),this.addToAnimatedContents(e,et),et},SVGShapeElement.prototype.addToAnimatedContents=function(e,i){for(var s=0,a=this.animatedContents.length;s<a;){if(this.animatedContents[s].element===i)return;s+=1}this.animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(e),element:i,data:e})},SVGShapeElement.prototype.setElementStyles=function(e){var i=e.styles,s,a=this.stylesList.length;for(s=0;s<a;s+=1)i.indexOf(this.stylesList[s])===-1&&!this.stylesList[s].closed&&i.push(this.stylesList[s])},SVGShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var e,i=this.itemsData.length;for(e=0;e<i;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),i=this.dynamicProperties.length,e=0;e<i;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers()},SVGShapeElement.prototype.searchShapes=function(e,i,s,a,_,et,nt){var c=[].concat(et),ct,dt=e.length-1,gt,Tt,Et=[],At=[],Mt,Pt,$t;for(ct=dt;ct>=0;ct-=1){if($t=this.searchProcessedElement(e[ct]),$t?i[ct]=s[$t-1]:e[ct]._render=nt,e[ct].ty==="fl"||e[ct].ty==="st"||e[ct].ty==="gf"||e[ct].ty==="gs"||e[ct].ty==="no")$t?i[ct].style.closed=e[ct].hd:i[ct]=this.createStyleElement(e[ct],_),e[ct]._render&&i[ct].style.pElem.parentNode!==a&&a.appendChild(i[ct].style.pElem),Et.push(i[ct].style);else if(e[ct].ty==="gr"){if(!$t)i[ct]=this.createGroupElement(e[ct]);else for(Tt=i[ct].it.length,gt=0;gt<Tt;gt+=1)i[ct].prevViewData[gt]=i[ct].it[gt];this.searchShapes(e[ct].it,i[ct].it,i[ct].prevViewData,i[ct].gr,_+1,c,nt),e[ct]._render&&i[ct].gr.parentNode!==a&&a.appendChild(i[ct].gr)}else e[ct].ty==="tr"?($t||(i[ct]=this.createTransformElement(e[ct],a)),Mt=i[ct].transform,c.push(Mt)):e[ct].ty==="sh"||e[ct].ty==="rc"||e[ct].ty==="el"||e[ct].ty==="sr"?($t||(i[ct]=this.createShapeElement(e[ct],c,_)),this.setElementStyles(i[ct])):e[ct].ty==="tm"||e[ct].ty==="rd"||e[ct].ty==="ms"||e[ct].ty==="pb"||e[ct].ty==="zz"||e[ct].ty==="op"?($t?(Pt=i[ct],Pt.closed=!1):(Pt=ShapeModifiers.getModifier(e[ct].ty),Pt.init(this,e[ct]),i[ct]=Pt,this.shapeModifiers.push(Pt)),At.push(Pt)):e[ct].ty==="rp"&&($t?(Pt=i[ct],Pt.closed=!0):(Pt=ShapeModifiers.getModifier(e[ct].ty),i[ct]=Pt,Pt.init(this,e,ct,i),this.shapeModifiers.push(Pt),nt=!1),At.push(Pt));this.addProcessedElement(e[ct],ct+1)}for(dt=Et.length,ct=0;ct<dt;ct+=1)Et[ct].closed=!0;for(dt=At.length,ct=0;ct<dt;ct+=1)At[ct].closed=!0},SVGShapeElement.prototype.renderInnerContent=function(){this.renderModifiers();var e,i=this.stylesList.length;for(e=0;e<i;e+=1)this.stylesList[e].reset();for(this.renderShape(),e=0;e<i;e+=1)(this.stylesList[e]._mdf||this._isFirstFrame)&&(this.stylesList[e].msElem&&(this.stylesList[e].msElem.setAttribute("d",this.stylesList[e].d),this.stylesList[e].d="M0 0"+this.stylesList[e].d),this.stylesList[e].pElem.setAttribute("d",this.stylesList[e].d||"M0 0"))},SVGShapeElement.prototype.renderShape=function(){var e,i=this.animatedContents.length,s;for(e=0;e<i;e+=1)s=this.animatedContents[e],(this._isFirstFrame||s.element._isAnimated)&&s.data!==!0&&s.fn(s.data,s.element,this._isFirstFrame)},SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null};function LetterProps(e,i,s,a,_,et){this.o=e,this.sw=i,this.sc=s,this.fc=a,this.m=_,this.p=et,this._mdf={o:!0,sw:!!i,sc:!!s,fc:!!a,m:!0,p:!0}}LetterProps.prototype.update=function(e,i,s,a,_,et){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1,this._mdf.p=!1;var nt=!1;return this.o!==e&&(this.o=e,this._mdf.o=!0,nt=!0),this.sw!==i&&(this.sw=i,this._mdf.sw=!0,nt=!0),this.sc!==s&&(this.sc=s,this._mdf.sc=!0,nt=!0),this.fc!==a&&(this.fc=a,this._mdf.fc=!0,nt=!0),this.m!==_&&(this.m=_,this._mdf.m=!0,nt=!0),et.length&&(this.p[0]!==et[0]||this.p[1]!==et[1]||this.p[4]!==et[4]||this.p[5]!==et[5]||this.p[12]!==et[12]||this.p[13]!==et[13])&&(this.p=et,this._mdf.p=!0,nt=!0),nt};function TextProperty(e,i){this._frameId=initialDefaultFrame,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,i.d&&i.d.sid&&(i.d=e.globalData.slotManager.getProp(i.d)),this.data=i,this.elem=e,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}TextProperty.prototype.defaultBoxWidth=[0,0],TextProperty.prototype.copyData=function(e,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s]);return e},TextProperty.prototype.setCurrentData=function(e){e.__complete||this.completeTextData(e),this.currentData=e,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},TextProperty.prototype.searchProperty=function(){return this.searchKeyframes()},TextProperty.prototype.searchKeyframes=function(){return this.kf=this.data.d.k.length>1,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},TextProperty.prototype.addEffect=function(e){this.effectsSequence.push(e),this.elem.addDynamicProperty(this)},TextProperty.prototype.getValue=function(e){if(!((this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)&&!e)){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var i=this.currentData,s=this.keysIndex;if(this.lock){this.setCurrentData(this.currentData);return}this.lock=!0,this._mdf=!1;var a,_=this.effectsSequence.length,et=e||this.data.d.k[this.keysIndex].s;for(a=0;a<_;a+=1)s!==this.keysIndex?et=this.effectsSequence[a](et,et.t):et=this.effectsSequence[a](this.currentData,et.t);i!==et&&this.setCurrentData(et),this.v=this.currentData,this.pv=this.v,this.lock=!1,this.frameId=this.elem.globalData.frameId}},TextProperty.prototype.getKeyframeValue=function(){for(var e=this.data.d.k,i=this.elem.comp.renderedFrame,s=0,a=e.length;s<=a-1&&!(s===a-1||e[s+1].t>i);)s+=1;return this.keysIndex!==s&&(this.keysIndex=s),this.data.d.k[this.keysIndex].s},TextProperty.prototype.buildFinalText=function(e){for(var i=[],s=0,a=e.length,_,et,nt=!1,c=!1,ct="";s<a;)nt=c,c=!1,_=e.charCodeAt(s),ct=e.charAt(s),FontManager.isCombinedCharacter(_)?nt=!0:_>=55296&&_<=56319?FontManager.isRegionalFlag(e,s)?ct=e.substr(s,14):(et=e.charCodeAt(s+1),et>=56320&&et<=57343&&(FontManager.isModifier(_,et)?(ct=e.substr(s,2),nt=!0):FontManager.isFlagEmoji(e.substr(s,4))?ct=e.substr(s,4):ct=e.substr(s,2))):_>56319?(et=e.charCodeAt(s+1),FontManager.isVariationSelector(_)&&(nt=!0)):FontManager.isZeroWidthJoiner(_)&&(nt=!0,c=!0),nt?(i[i.length-1]+=ct,nt=!1):i.push(ct),s+=ct.length;return i},TextProperty.prototype.completeTextData=function(e){e.__complete=!0;var i=this.elem.globalData.fontManager,s=this.data,a=[],_,et,nt,c=0,ct,dt=s.m.g,gt=0,Tt=0,Et=0,At=[],Mt=0,Pt=0,$t,Lt,Bt=i.getFontByName(e.f),Nt,Vt=0,Xt=getFontProperties(Bt);e.fWeight=Xt.weight,e.fStyle=Xt.style,e.finalSize=e.s,e.finalText=this.buildFinalText(e.t),et=e.finalText.length,e.finalLineHeight=e.lh;var nr=e.tr/1e3*e.finalSize,ar;if(e.sz)for(var mr=!0,Fr=e.sz[0],sn=e.sz[1],fn,Lr;mr;){Lr=this.buildFinalText(e.t),fn=0,Mt=0,et=Lr.length,nr=e.tr/1e3*e.finalSize;var Qr=-1;for(_=0;_<et;_+=1)ar=Lr[_].charCodeAt(0),nt=!1,Lr[_]===" "?Qr=_:(ar===13||ar===3)&&(Mt=0,nt=!0,fn+=e.finalLineHeight||e.finalSize*1.2),i.chars?(Nt=i.getCharData(Lr[_],Bt.fStyle,Bt.fFamily),Vt=nt?0:Nt.w*e.finalSize/100):Vt=i.measureText(Lr[_],e.f,e.finalSize),Mt+Vt>Fr&&Lr[_]!==" "?(Qr===-1?et+=1:_=Qr,fn+=e.finalLineHeight||e.finalSize*1.2,Lr.splice(_,Qr===_?1:0,"\r"),Qr=-1,Mt=0):(Mt+=Vt,Mt+=nr);fn+=Bt.ascent*e.finalSize/100,this.canResize&&e.finalSize>this.minimumFontSize&&sn<fn?(e.finalSize-=1,e.finalLineHeight=e.finalSize*e.lh/e.s):(e.finalText=Lr,et=e.finalText.length,mr=!1)}Mt=-nr,Vt=0;var dn=0,en;for(_=0;_<et;_+=1)if(nt=!1,en=e.finalText[_],ar=en.charCodeAt(0),ar===13||ar===3?(dn=0,At.push(Mt),Pt=Mt>Pt?Mt:Pt,Mt=-2*nr,ct="",nt=!0,Et+=1):ct=en,i.chars?(Nt=i.getCharData(en,Bt.fStyle,i.getFontByName(e.f).fFamily),Vt=nt?0:Nt.w*e.finalSize/100):Vt=i.measureText(ct,e.f,e.finalSize),en===" "?dn+=Vt+nr:(Mt+=Vt+nr+dn,dn=0),a.push({l:Vt,an:Vt,add:gt,n:nt,anIndexes:[],val:ct,line:Et,animatorJustifyOffset:0}),dt==2){if(gt+=Vt,ct===""||ct===" "||_===et-1){for((ct===""||ct===" ")&&(gt-=Vt);Tt<=_;)a[Tt].an=gt,a[Tt].ind=c,a[Tt].extra=Vt,Tt+=1;c+=1,gt=0}}else if(dt==3){if(gt+=Vt,ct===""||_===et-1){for(ct===""&&(gt-=Vt);Tt<=_;)a[Tt].an=gt,a[Tt].ind=c,a[Tt].extra=Vt,Tt+=1;gt=0,c+=1}}else a[c].ind=c,a[c].extra=0,c+=1;if(e.l=a,Pt=Mt>Pt?Mt:Pt,At.push(Mt),e.sz)e.boxWidth=e.sz[0],e.justifyOffset=0;else switch(e.boxWidth=Pt,e.j){case 1:e.justifyOffset=-e.boxWidth;break;case 2:e.justifyOffset=-e.boxWidth/2;break;default:e.justifyOffset=0}e.lineWidths=At;var yr=s.a,Ar,rr;Lt=yr.length;var ur,Br,xr=[];for($t=0;$t<Lt;$t+=1){for(Ar=yr[$t],Ar.a.sc&&(e.strokeColorAnim=!0),Ar.a.sw&&(e.strokeWidthAnim=!0),(Ar.a.fc||Ar.a.fh||Ar.a.fs||Ar.a.fb)&&(e.fillColorAnim=!0),Br=0,ur=Ar.s.b,_=0;_<et;_+=1)rr=a[_],rr.anIndexes[$t]=Br,(ur==1&&rr.val!==""||ur==2&&rr.val!==""&&rr.val!==" "||ur==3&&(rr.n||rr.val==" "||_==et-1)||ur==4&&(rr.n||_==et-1))&&(Ar.s.rn===1&&xr.push(Br),Br+=1);s.a[$t].s.totalChars=Br;var qr=-1,tn;if(Ar.s.rn===1)for(_=0;_<et;_+=1)rr=a[_],qr!=rr.anIndexes[$t]&&(qr=rr.anIndexes[$t],tn=xr.splice(Math.floor(Math.random()*xr.length),1)[0]),rr.anIndexes[$t]=tn}e.yOffset=e.finalLineHeight||e.finalSize*1.2,e.ls=e.ls||0,e.ascent=Bt.ascent*e.finalSize/100},TextProperty.prototype.updateDocumentData=function(e,i){i=i===void 0?this.keysIndex:i;var s=this.copyData({},this.data.d.k[i].s);s=this.copyData(s,e),this.data.d.k[i].s=s,this.recalculate(i),this.setCurrentData(s),this.elem.addDynamicProperty(this)},TextProperty.prototype.recalculate=function(e){var i=this.data.d.k[e].s;i.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(i)},TextProperty.prototype.canResizeFont=function(e){this.canResize=e,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},TextProperty.prototype.setMinimumFontSize=function(e){this.minimumFontSize=Math.floor(e)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};var TextSelectorProp=function(){var e=Math.max,i=Math.min,s=Math.floor;function a(et,nt){this._currentTextLength=-1,this.k=!1,this.data=nt,this.elem=et,this.comp=et.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer(et),this.s=PropertyFactory.getProp(et,nt.s||{k:0},0,0,this),"e"in nt?this.e=PropertyFactory.getProp(et,nt.e,0,0,this):this.e={v:100},this.o=PropertyFactory.getProp(et,nt.o||{k:0},0,0,this),this.xe=PropertyFactory.getProp(et,nt.xe||{k:0},0,0,this),this.ne=PropertyFactory.getProp(et,nt.ne||{k:0},0,0,this),this.sm=PropertyFactory.getProp(et,nt.sm||{k:100},0,0,this),this.a=PropertyFactory.getProp(et,nt.a,0,.01,this),this.dynamicProperties.length||this.getValue()}a.prototype={getMult:function(nt){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var c=0,ct=0,dt=1,gt=1;this.ne.v>0?c=this.ne.v/100:ct=-this.ne.v/100,this.xe.v>0?dt=1-this.xe.v/100:gt=1+this.xe.v/100;var Tt=BezierFactory.getBezierEasing(c,ct,dt,gt).get,Et=0,At=this.finalS,Mt=this.finalE,Pt=this.data.sh;if(Pt===2)Mt===At?Et=nt>=Mt?1:0:Et=e(0,i(.5/(Mt-At)+(nt-At)/(Mt-At),1)),Et=Tt(Et);else if(Pt===3)Mt===At?Et=nt>=Mt?0:1:Et=1-e(0,i(.5/(Mt-At)+(nt-At)/(Mt-At),1)),Et=Tt(Et);else if(Pt===4)Mt===At?Et=0:(Et=e(0,i(.5/(Mt-At)+(nt-At)/(Mt-At),1)),Et<.5?Et*=2:Et=1-2*(Et-.5)),Et=Tt(Et);else if(Pt===5){if(Mt===At)Et=0;else{var $t=Mt-At;nt=i(e(0,nt+.5-At),Mt-At);var Lt=-$t/2+nt,Bt=$t/2;Et=Math.sqrt(1-Lt*Lt/(Bt*Bt))}Et=Tt(Et)}else Pt===6?(Mt===At?Et=0:(nt=i(e(0,nt+.5-At),Mt-At),Et=(1+Math.cos(Math.PI+Math.PI*2*nt/(Mt-At)))/2),Et=Tt(Et)):(nt>=s(At)&&(nt-At<0?Et=e(0,i(i(Mt,1)-(At-nt),1)):Et=e(0,i(Mt-nt,1))),Et=Tt(Et));if(this.sm.v!==100){var Nt=this.sm.v*.01;Nt===0&&(Nt=1e-8);var Vt=.5-Nt*.5;Et<Vt?Et=0:(Et=(Et-Vt)/Nt,Et>1&&(Et=1))}return Et*this.a.v},getValue:function(nt){this.iterateDynamicProperties(),this._mdf=nt||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,nt&&this.data.r===2&&(this.e.v=this._currentTextLength);var c=this.data.r===2?1:100/this.data.totalChars,ct=this.o.v/c,dt=this.s.v/c+ct,gt=this.e.v/c+ct;if(dt>gt){var Tt=dt;dt=gt,gt=Tt}this.finalS=dt,this.finalE=gt}},extendPrototype([DynamicPropertyContainer],a);function _(et,nt,c){return new a(et,nt)}return{getTextSelectorProp:_}}();function TextAnimatorDataProperty(e,i,s){var a={propType:!1},_=PropertyFactory.getProp,et=i.a;this.a={r:et.r?_(e,et.r,0,degToRads,s):a,rx:et.rx?_(e,et.rx,0,degToRads,s):a,ry:et.ry?_(e,et.ry,0,degToRads,s):a,sk:et.sk?_(e,et.sk,0,degToRads,s):a,sa:et.sa?_(e,et.sa,0,degToRads,s):a,s:et.s?_(e,et.s,1,.01,s):a,a:et.a?_(e,et.a,1,0,s):a,o:et.o?_(e,et.o,0,.01,s):a,p:et.p?_(e,et.p,1,0,s):a,sw:et.sw?_(e,et.sw,0,0,s):a,sc:et.sc?_(e,et.sc,1,0,s):a,fc:et.fc?_(e,et.fc,1,0,s):a,fh:et.fh?_(e,et.fh,0,0,s):a,fs:et.fs?_(e,et.fs,0,.01,s):a,fb:et.fb?_(e,et.fb,0,.01,s):a,t:et.t?_(e,et.t,0,0,s):a},this.s=TextSelectorProp.getTextSelectorProp(e,i.s,s),this.s.t=i.s.t}function TextAnimatorProperty(e,i,s){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=e,this._renderType=i,this._elem=s,this._animatorsData=createSizedArray(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(s)}TextAnimatorProperty.prototype.searchProperties=function(){var e,i=this._textData.a.length,s,a=PropertyFactory.getProp;for(e=0;e<i;e+=1)s=this._textData.a[e],this._animatorsData[e]=new TextAnimatorDataProperty(this._elem,s,this);this._textData.p&&"m"in this._textData.p?(this._pathData={a:a(this._elem,this._textData.p.a,0,0,this),f:a(this._elem,this._textData.p.f,0,0,this),l:a(this._elem,this._textData.p.l,0,0,this),r:a(this._elem,this._textData.p.r,0,0,this),p:a(this._elem,this._textData.p.p,0,0,this),m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=a(this._elem,this._textData.m.a,1,0,this)},TextAnimatorProperty.prototype.getMeasures=function(e,i){if(this.lettersChangedFlag=i,!(!this._mdf&&!this._isFirstFrame&&!i&&(!this._hasMaskedPath||!this._pathData.m._mdf))){this._isFirstFrame=!1;var s=this._moreOptions.alignment.v,a=this._animatorsData,_=this._textData,et=this.mHelper,nt=this._renderType,c=this.renderedLetters.length,ct,dt,gt,Tt,Et=e.l,At,Mt,Pt,$t,Lt,Bt,Nt,Vt,Xt,nr,ar,mr,Fr,sn,fn;if(this._hasMaskedPath){if(fn=this._pathData.m,!this._pathData.n||this._pathData._mdf){var Lr=fn.v;this._pathData.r.v&&(Lr=Lr.reverse()),At={tLength:0,segments:[]},Tt=Lr._length-1;var Qr;for(mr=0,gt=0;gt<Tt;gt+=1)Qr=bez.buildBezierData(Lr.v[gt],Lr.v[gt+1],[Lr.o[gt][0]-Lr.v[gt][0],Lr.o[gt][1]-Lr.v[gt][1]],[Lr.i[gt+1][0]-Lr.v[gt+1][0],Lr.i[gt+1][1]-Lr.v[gt+1][1]]),At.tLength+=Qr.segmentLength,At.segments.push(Qr),mr+=Qr.segmentLength;gt=Tt,fn.v.c&&(Qr=bez.buildBezierData(Lr.v[gt],Lr.v[0],[Lr.o[gt][0]-Lr.v[gt][0],Lr.o[gt][1]-Lr.v[gt][1]],[Lr.i[0][0]-Lr.v[0][0],Lr.i[0][1]-Lr.v[0][1]]),At.tLength+=Qr.segmentLength,At.segments.push(Qr),mr+=Qr.segmentLength),this._pathData.pi=At}if(At=this._pathData.pi,Mt=this._pathData.f.v,Nt=0,Bt=1,$t=0,Lt=!0,nr=At.segments,Mt<0&&fn.v.c)for(At.tLength<Math.abs(Mt)&&(Mt=-Math.abs(Mt)%At.tLength),Nt=nr.length-1,Xt=nr[Nt].points,Bt=Xt.length-1;Mt<0;)Mt+=Xt[Bt].partialLength,Bt-=1,Bt<0&&(Nt-=1,Xt=nr[Nt].points,Bt=Xt.length-1);Xt=nr[Nt].points,Vt=Xt[Bt-1],Pt=Xt[Bt],ar=Pt.partialLength}Tt=Et.length,ct=0,dt=0;var dn=e.finalSize*1.2*.714,en=!0,yr,Ar,rr,ur,Br;ur=a.length;var xr,qr=-1,tn,vn,hs,Ts=Mt,ss=Nt,Mn=Bt,ds=-1,gs,ys,Hs,_s,Ss,Vl,ba,Qo,wo="",cu=this.defaultPropsArray,uu;if(e.j===2||e.j===1){var Pl=0,Jl=0,Ul=e.j===2?-.5:-1,xl=0,Yn=!0;for(gt=0;gt<Tt;gt+=1)if(Et[gt].n){for(Pl&&(Pl+=Jl);xl<gt;)Et[xl].animatorJustifyOffset=Pl,xl+=1;Pl=0,Yn=!0}else{for(rr=0;rr<ur;rr+=1)yr=a[rr].a,yr.t.propType&&(Yn&&e.j===2&&(Jl+=yr.t.v*Ul),Ar=a[rr].s,xr=Ar.getMult(Et[gt].anIndexes[rr],_.a[rr].s.totalChars),xr.length?Pl+=yr.t.v*xr[0]*Ul:Pl+=yr.t.v*xr*Ul);Yn=!1}for(Pl&&(Pl+=Jl);xl<gt;)Et[xl].animatorJustifyOffset=Pl,xl+=1}for(gt=0;gt<Tt;gt+=1){if(et.reset(),gs=1,Et[gt].n)ct=0,dt+=e.yOffset,dt+=en?1:0,Mt=Ts,en=!1,this._hasMaskedPath&&(Nt=ss,Bt=Mn,Xt=nr[Nt].points,Vt=Xt[Bt-1],Pt=Xt[Bt],ar=Pt.partialLength,$t=0),wo="",Qo="",Vl="",uu="",cu=this.defaultPropsArray;else{if(this._hasMaskedPath){if(ds!==Et[gt].line){switch(e.j){case 1:Mt+=mr-e.lineWidths[Et[gt].line];break;case 2:Mt+=(mr-e.lineWidths[Et[gt].line])/2;break}ds=Et[gt].line}qr!==Et[gt].ind&&(Et[qr]&&(Mt+=Et[qr].extra),Mt+=Et[gt].an/2,qr=Et[gt].ind),Mt+=s[0]*Et[gt].an*.005;var xn=0;for(rr=0;rr<ur;rr+=1)yr=a[rr].a,yr.p.propType&&(Ar=a[rr].s,xr=Ar.getMult(Et[gt].anIndexes[rr],_.a[rr].s.totalChars),xr.length?xn+=yr.p.v[0]*xr[0]:xn+=yr.p.v[0]*xr),yr.a.propType&&(Ar=a[rr].s,xr=Ar.getMult(Et[gt].anIndexes[rr],_.a[rr].s.totalChars),xr.length?xn+=yr.a.v[0]*xr[0]:xn+=yr.a.v[0]*xr);for(Lt=!0,this._pathData.a.v&&(Mt=Et[0].an*.5+(mr-this._pathData.f.v-Et[0].an*.5-Et[Et.length-1].an*.5)*qr/(Tt-1),Mt+=this._pathData.f.v);Lt;)$t+ar>=Mt+xn||!Xt?(Fr=(Mt+xn-$t)/Pt.partialLength,vn=Vt.point[0]+(Pt.point[0]-Vt.point[0])*Fr,hs=Vt.point[1]+(Pt.point[1]-Vt.point[1])*Fr,et.translate(-s[0]*Et[gt].an*.005,-(s[1]*dn)*.01),Lt=!1):Xt&&($t+=Pt.partialLength,Bt+=1,Bt>=Xt.length&&(Bt=0,Nt+=1,nr[Nt]?Xt=nr[Nt].points:fn.v.c?(Bt=0,Nt=0,Xt=nr[Nt].points):($t-=Pt.partialLength,Xt=null)),Xt&&(Vt=Pt,Pt=Xt[Bt],ar=Pt.partialLength));tn=Et[gt].an/2-Et[gt].add,et.translate(-tn,0,0)}else tn=Et[gt].an/2-Et[gt].add,et.translate(-tn,0,0),et.translate(-s[0]*Et[gt].an*.005,-s[1]*dn*.01,0);for(rr=0;rr<ur;rr+=1)yr=a[rr].a,yr.t.propType&&(Ar=a[rr].s,xr=Ar.getMult(Et[gt].anIndexes[rr],_.a[rr].s.totalChars),(ct!==0||e.j!==0)&&(this._hasMaskedPath?xr.length?Mt+=yr.t.v*xr[0]:Mt+=yr.t.v*xr:xr.length?ct+=yr.t.v*xr[0]:ct+=yr.t.v*xr));for(e.strokeWidthAnim&&(Hs=e.sw||0),e.strokeColorAnim&&(e.sc?ys=[e.sc[0],e.sc[1],e.sc[2]]:ys=[0,0,0]),e.fillColorAnim&&e.fc&&(_s=[e.fc[0],e.fc[1],e.fc[2]]),rr=0;rr<ur;rr+=1)yr=a[rr].a,yr.a.propType&&(Ar=a[rr].s,xr=Ar.getMult(Et[gt].anIndexes[rr],_.a[rr].s.totalChars),xr.length?et.translate(-yr.a.v[0]*xr[0],-yr.a.v[1]*xr[1],yr.a.v[2]*xr[2]):et.translate(-yr.a.v[0]*xr,-yr.a.v[1]*xr,yr.a.v[2]*xr));for(rr=0;rr<ur;rr+=1)yr=a[rr].a,yr.s.propType&&(Ar=a[rr].s,xr=Ar.getMult(Et[gt].anIndexes[rr],_.a[rr].s.totalChars),xr.length?et.scale(1+(yr.s.v[0]-1)*xr[0],1+(yr.s.v[1]-1)*xr[1],1):et.scale(1+(yr.s.v[0]-1)*xr,1+(yr.s.v[1]-1)*xr,1));for(rr=0;rr<ur;rr+=1){if(yr=a[rr].a,Ar=a[rr].s,xr=Ar.getMult(Et[gt].anIndexes[rr],_.a[rr].s.totalChars),yr.sk.propType&&(xr.length?et.skewFromAxis(-yr.sk.v*xr[0],yr.sa.v*xr[1]):et.skewFromAxis(-yr.sk.v*xr,yr.sa.v*xr)),yr.r.propType&&(xr.length?et.rotateZ(-yr.r.v*xr[2]):et.rotateZ(-yr.r.v*xr)),yr.ry.propType&&(xr.length?et.rotateY(yr.ry.v*xr[1]):et.rotateY(yr.ry.v*xr)),yr.rx.propType&&(xr.length?et.rotateX(yr.rx.v*xr[0]):et.rotateX(yr.rx.v*xr)),yr.o.propType&&(xr.length?gs+=(yr.o.v*xr[0]-gs)*xr[0]:gs+=(yr.o.v*xr-gs)*xr),e.strokeWidthAnim&&yr.sw.propType&&(xr.length?Hs+=yr.sw.v*xr[0]:Hs+=yr.sw.v*xr),e.strokeColorAnim&&yr.sc.propType)for(Ss=0;Ss<3;Ss+=1)xr.length?ys[Ss]+=(yr.sc.v[Ss]-ys[Ss])*xr[0]:ys[Ss]+=(yr.sc.v[Ss]-ys[Ss])*xr;if(e.fillColorAnim&&e.fc){if(yr.fc.propType)for(Ss=0;Ss<3;Ss+=1)xr.length?_s[Ss]+=(yr.fc.v[Ss]-_s[Ss])*xr[0]:_s[Ss]+=(yr.fc.v[Ss]-_s[Ss])*xr;yr.fh.propType&&(xr.length?_s=addHueToRGB(_s,yr.fh.v*xr[0]):_s=addHueToRGB(_s,yr.fh.v*xr)),yr.fs.propType&&(xr.length?_s=addSaturationToRGB(_s,yr.fs.v*xr[0]):_s=addSaturationToRGB(_s,yr.fs.v*xr)),yr.fb.propType&&(xr.length?_s=addBrightnessToRGB(_s,yr.fb.v*xr[0]):_s=addBrightnessToRGB(_s,yr.fb.v*xr))}}for(rr=0;rr<ur;rr+=1)yr=a[rr].a,yr.p.propType&&(Ar=a[rr].s,xr=Ar.getMult(Et[gt].anIndexes[rr],_.a[rr].s.totalChars),this._hasMaskedPath?xr.length?et.translate(0,yr.p.v[1]*xr[0],-yr.p.v[2]*xr[1]):et.translate(0,yr.p.v[1]*xr,-yr.p.v[2]*xr):xr.length?et.translate(yr.p.v[0]*xr[0],yr.p.v[1]*xr[1],-yr.p.v[2]*xr[2]):et.translate(yr.p.v[0]*xr,yr.p.v[1]*xr,-yr.p.v[2]*xr));if(e.strokeWidthAnim&&(Vl=Hs<0?0:Hs),e.strokeColorAnim&&(ba="rgb("+Math.round(ys[0]*255)+","+Math.round(ys[1]*255)+","+Math.round(ys[2]*255)+")"),e.fillColorAnim&&e.fc&&(Qo="rgb("+Math.round(_s[0]*255)+","+Math.round(_s[1]*255)+","+Math.round(_s[2]*255)+")"),this._hasMaskedPath){if(et.translate(0,-e.ls),et.translate(0,s[1]*dn*.01+dt,0),this._pathData.p.v){sn=(Pt.point[1]-Vt.point[1])/(Pt.point[0]-Vt.point[0]);var Qn=Math.atan(sn)*180/Math.PI;Pt.point[0]<Vt.point[0]&&(Qn+=180),et.rotate(-Qn*Math.PI/180)}et.translate(vn,hs,0),Mt-=s[0]*Et[gt].an*.005,Et[gt+1]&&qr!==Et[gt+1].ind&&(Mt+=Et[gt].an/2,Mt+=e.tr*.001*e.finalSize)}else{switch(et.translate(ct,dt,0),e.ps&&et.translate(e.ps[0],e.ps[1]+e.ascent,0),e.j){case 1:et.translate(Et[gt].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[Et[gt].line]),0,0);break;case 2:et.translate(Et[gt].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[Et[gt].line])/2,0,0);break}et.translate(0,-e.ls),et.translate(tn,0,0),et.translate(s[0]*Et[gt].an*.005,s[1]*dn*.01,0),ct+=Et[gt].l+e.tr*.001*e.finalSize}nt==="html"?wo=et.toCSS():nt==="svg"?wo=et.to2dCSS():cu=[et.props[0],et.props[1],et.props[2],et.props[3],et.props[4],et.props[5],et.props[6],et.props[7],et.props[8],et.props[9],et.props[10],et.props[11],et.props[12],et.props[13],et.props[14],et.props[15]],uu=gs}c<=gt?(Br=new LetterProps(uu,Vl,ba,Qo,wo,cu),this.renderedLetters.push(Br),c+=1,this.lettersChangedFlag=!0):(Br=this.renderedLetters[gt],this.lettersChangedFlag=Br.update(uu,Vl,ba,Qo,wo,cu)||this.lettersChangedFlag)}}},TextAnimatorProperty.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},TextAnimatorProperty.prototype.mHelper=new Matrix,TextAnimatorProperty.prototype.defaultPropsArray=[],extendPrototype([DynamicPropertyContainer],TextAnimatorProperty);function ITextElement(){}ITextElement.prototype.initElement=function(e,i,s){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(e,i,s),this.textProperty=new TextProperty(this,e.t,this.dynamicProperties),this.textAnimator=new TextAnimatorProperty(e.t,this.renderType,this),this.initTransform(e,i,s),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},ITextElement.prototype.prepareFrame=function(e){this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange)},ITextElement.prototype.createPathShape=function(e,i){var s,a=i.length,_,et="";for(s=0;s<a;s+=1)i[s].ty==="sh"&&(_=i[s].ks.k,et+=buildShapeString(_,_.i.length,!0,e));return et},ITextElement.prototype.updateDocumentData=function(e,i){this.textProperty.updateDocumentData(e,i)},ITextElement.prototype.canResizeFont=function(e){this.textProperty.canResizeFont(e)},ITextElement.prototype.setMinimumFontSize=function(e){this.textProperty.setMinimumFontSize(e)},ITextElement.prototype.applyTextPropertiesToMatrix=function(e,i,s,a,_){switch(e.ps&&i.translate(e.ps[0],e.ps[1]+e.ascent,0),i.translate(0,-e.ls,0),e.j){case 1:i.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[s]),0,0);break;case 2:i.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[s])/2,0,0);break}i.translate(a,_,0)},ITextElement.prototype.buildColor=function(e){return"rgb("+Math.round(e[0]*255)+","+Math.round(e[1]*255)+","+Math.round(e[2]*255)+")"},ITextElement.prototype.emptyProp=new LetterProps,ITextElement.prototype.destroy=function(){},ITextElement.prototype.validateText=function(){(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)};var emptyShapeData={shapes:[]};function SVGTextLottieElement(e,i,s){this.textSpans=[],this.renderType="svg",this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextLottieElement),SVGTextLottieElement.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=createNS("text"))},SVGTextLottieElement.prototype.buildTextContents=function(e){for(var i=0,s=e.length,a=[],_="";i<s;)e[i]==="\r"||e[i]===""?(a.push(_),_=""):_+=e[i],i+=1;return a.push(_),a},SVGTextLottieElement.prototype.buildShapeData=function(e,i){if(e.shapes&&e.shapes.length){var s=e.shapes[0];if(s.it){var a=s.it[s.it.length-1];a.s&&(a.s.k[0]=i,a.s.k[1]=i)}}return e},SVGTextLottieElement.prototype.buildNewText=function(){this.addDynamicProperty(this);var e,i,s=this.textProperty.currentData;this.renderedLetters=createSizedArray(s?s.l.length:0),s.fc?this.layerElement.setAttribute("fill",this.buildColor(s.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),s.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(s.sc)),this.layerElement.setAttribute("stroke-width",s.sw)),this.layerElement.setAttribute("font-size",s.finalSize);var a=this.globalData.fontManager.getFontByName(s.f);if(a.fClass)this.layerElement.setAttribute("class",a.fClass);else{this.layerElement.setAttribute("font-family",a.fFamily);var _=s.fWeight,et=s.fStyle;this.layerElement.setAttribute("font-style",et),this.layerElement.setAttribute("font-weight",_)}this.layerElement.setAttribute("aria-label",s.t);var nt=s.l||[],c=!!this.globalData.fontManager.chars;i=nt.length;var ct,dt=this.mHelper,gt="",Tt=this.data.singleShape,Et=0,At=0,Mt=!0,Pt=s.tr*.001*s.finalSize;if(Tt&&!c&&!s.sz){var $t=this.textContainer,Lt="start";switch(s.j){case 1:Lt="end";break;case 2:Lt="middle";break;default:Lt="start";break}$t.setAttribute("text-anchor",Lt),$t.setAttribute("letter-spacing",Pt);var Bt=this.buildTextContents(s.finalText);for(i=Bt.length,At=s.ps?s.ps[1]+s.ascent:0,e=0;e<i;e+=1)ct=this.textSpans[e].span||createNS("tspan"),ct.textContent=Bt[e],ct.setAttribute("x",0),ct.setAttribute("y",At),ct.style.display="inherit",$t.appendChild(ct),this.textSpans[e]||(this.textSpans[e]={span:null,glyph:null}),this.textSpans[e].span=ct,At+=s.finalLineHeight;this.layerElement.appendChild($t)}else{var Nt=this.textSpans.length,Vt;for(e=0;e<i;e+=1){if(this.textSpans[e]||(this.textSpans[e]={span:null,childSpan:null,glyph:null}),!c||!Tt||e===0){if(ct=Nt>e?this.textSpans[e].span:createNS(c?"g":"text"),Nt<=e){if(ct.setAttribute("stroke-linecap","butt"),ct.setAttribute("stroke-linejoin","round"),ct.setAttribute("stroke-miterlimit","4"),this.textSpans[e].span=ct,c){var Xt=createNS("g");ct.appendChild(Xt),this.textSpans[e].childSpan=Xt}this.textSpans[e].span=ct,this.layerElement.appendChild(ct)}ct.style.display="inherit"}if(dt.reset(),Tt&&(nt[e].n&&(Et=-Pt,At+=s.yOffset,At+=Mt?1:0,Mt=!1),this.applyTextPropertiesToMatrix(s,dt,nt[e].line,Et,At),Et+=nt[e].l||0,Et+=Pt),c){Vt=this.globalData.fontManager.getCharData(s.finalText[e],a.fStyle,this.globalData.fontManager.getFontByName(s.f).fFamily);var nr;if(Vt.t===1)nr=new SVGCompElement(Vt.data,this.globalData,this);else{var ar=emptyShapeData;Vt.data&&Vt.data.shapes&&(ar=this.buildShapeData(Vt.data,s.finalSize)),nr=new SVGShapeElement(ar,this.globalData,this)}if(this.textSpans[e].glyph){var mr=this.textSpans[e].glyph;this.textSpans[e].childSpan.removeChild(mr.layerElement),mr.destroy()}this.textSpans[e].glyph=nr,nr._debug=!0,nr.prepareFrame(0),nr.renderFrame(),this.textSpans[e].childSpan.appendChild(nr.layerElement),Vt.t===1&&this.textSpans[e].childSpan.setAttribute("transform","scale("+s.finalSize/100+","+s.finalSize/100+")")}else Tt&&ct.setAttribute("transform","translate("+dt.props[12]+","+dt.props[13]+")"),ct.textContent=nt[e].val,ct.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}Tt&&ct&&ct.setAttribute("d",gt)}for(;e<this.textSpans.length;)this.textSpans[e].span.style.display="none",e+=1;this._sizeChanged=!0},SVGTextLottieElement.prototype.sourceRectAtTime=function(){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var e=this.layerElement.getBBox();this.bbox={top:e.y,left:e.x,width:e.width,height:e.height}}return this.bbox},SVGTextLottieElement.prototype.getValue=function(){var e,i=this.textSpans.length,s;for(this.renderedFrame=this.comp.renderedFrame,e=0;e<i;e+=1)s=this.textSpans[e].glyph,s&&(s.prepareFrame(this.comp.renderedFrame-this.data.st),s._mdf&&(this._mdf=!0))},SVGTextLottieElement.prototype.renderInnerContent=function(){if(this.validateText(),(!this.data.singleShape||this._mdf)&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){this._sizeChanged=!0;var e,i,s=this.textAnimator.renderedLetters,a=this.textProperty.currentData.l;i=a.length;var _,et,nt;for(e=0;e<i;e+=1)a[e].n||(_=s[e],et=this.textSpans[e].span,nt=this.textSpans[e].glyph,nt&&nt.renderFrame(),_._mdf.m&&et.setAttribute("transform",_.m),_._mdf.o&&et.setAttribute("opacity",_.o),_._mdf.sw&&et.setAttribute("stroke-width",_.sw),_._mdf.sc&&et.setAttribute("stroke",_.sc),_._mdf.fc&&et.setAttribute("fill",_.fc))}};function ISolidElement(e,i,s){this.initElement(e,i,s)}extendPrototype([IImageElement],ISolidElement),ISolidElement.prototype.createContent=function(){var e=createNS("rect");e.setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.layerElement.appendChild(e)};function NullElement(e,i,s){this.initFrame(),this.initBaseData(e,i,s),this.initFrame(),this.initTransform(e,i,s),this.initHierarchy()}NullElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},NullElement.prototype.renderFrame=function(){},NullElement.prototype.getBaseElement=function(){return null},NullElement.prototype.destroy=function(){},NullElement.prototype.sourceRectAtTime=function(){},NullElement.prototype.hide=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement);function SVGRendererBase(){}extendPrototype([BaseRenderer],SVGRendererBase),SVGRendererBase.prototype.createNull=function(e){return new NullElement(e,this.globalData,this)},SVGRendererBase.prototype.createShape=function(e){return new SVGShapeElement(e,this.globalData,this)},SVGRendererBase.prototype.createText=function(e){return new SVGTextLottieElement(e,this.globalData,this)},SVGRendererBase.prototype.createImage=function(e){return new IImageElement(e,this.globalData,this)},SVGRendererBase.prototype.createSolid=function(e){return new ISolidElement(e,this.globalData,this)},SVGRendererBase.prototype.configAnimation=function(e){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svgElement.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+e.w+" "+e.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",e.w),this.svgElement.setAttribute("height",e.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)",this.svgElement.style.contentVisibility=this.renderConfig.contentVisibility),this.renderConfig.width&&this.svgElement.setAttribute("width",this.renderConfig.width),this.renderConfig.height&&this.svgElement.setAttribute("height",this.renderConfig.height),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),this.renderConfig.focusable!==void 0&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var i=this.globalData.defs;this.setupGlobalData(e,i),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=e;var s=createNS("clipPath"),a=createNS("rect");a.setAttribute("width",e.w),a.setAttribute("height",e.h),a.setAttribute("x",0),a.setAttribute("y",0);var _=createElementID();s.setAttribute("id",_),s.appendChild(a),this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+_+")"),i.appendChild(s),this.layers=e.layers,this.elements=createSizedArray(e.layers.length)},SVGRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.layerElement=null,this.globalData.defs=null;var e,i=this.layers?this.layers.length:0;for(e=0;e<i;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},SVGRendererBase.prototype.updateContainerSize=function(){},SVGRendererBase.prototype.findIndexByInd=function(e){var i=0,s=this.layers.length;for(i=0;i<s;i+=1)if(this.layers[i].ind===e)return i;return-1},SVGRendererBase.prototype.buildItem=function(e){var i=this.elements;if(!(i[e]||this.layers[e].ty===99)){i[e]=!0;var s=this.createItem(this.layers[e]);if(i[e]=s,getExpressionsPlugin()&&(this.layers[e].ty===0&&this.globalData.projectInterface.registerComposition(s),s.initExpressions()),this.appendElementInPos(s,e),this.layers[e].tt){var a="tp"in this.layers[e]?this.findIndexByInd(this.layers[e].tp):e-1;if(a===-1)return;if(!this.elements[a]||this.elements[a]===!0)this.buildItem(a),this.addPendingElement(s);else{var _=i[a],et=_.getMatte(this.layers[e].tt);s.setMatte(et)}}}},SVGRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();if(e.checkParenting(),e.data.tt)for(var i=0,s=this.elements.length;i<s;){if(this.elements[i]===e){var a="tp"in e.data?this.findIndexByInd(e.data.tp):i-1,_=this.elements[a],et=_.getMatte(this.layers[i].tt);e.setMatte(et);break}i+=1}}},SVGRendererBase.prototype.renderFrame=function(e){if(!(this.renderedFrame===e||this.destroyed)){e===null?e=this.renderedFrame:this.renderedFrame=e,this.globalData.frameNum=e,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=e,this.globalData._mdf=!1;var i,s=this.layers.length;for(this.completeLayers||this.checkLayers(e),i=s-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&this.elements[i].prepareFrame(e-this.layers[i].st);if(this.globalData._mdf)for(i=0;i<s;i+=1)(this.completeLayers||this.elements[i])&&this.elements[i].renderFrame()}},SVGRendererBase.prototype.appendElementInPos=function(e,i){var s=e.getBaseElement();if(s){for(var a=0,_;a<i;)this.elements[a]&&this.elements[a]!==!0&&this.elements[a].getBaseElement()&&(_=this.elements[a].getBaseElement()),a+=1;_?this.layerElement.insertBefore(s,_):this.layerElement.appendChild(s)}},SVGRendererBase.prototype.hide=function(){this.layerElement.style.display="none"},SVGRendererBase.prototype.show=function(){this.layerElement.style.display="block"};function ICompElement(){}extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement),ICompElement.prototype.initElement=function(e,i,s){this.initFrame(),this.initBaseData(e,i,s),this.initTransform(e,i,s),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),(this.data.xt||!i.progressiveLoad)&&this.buildAllItems(),this.hide()},ICompElement.prototype.prepareFrame=function(e){if(this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange),!(!this.isInRange&&!this.data.xt)){if(this.tm._placeholder)this.renderedFrame=e/this.data.sr;else{var i=this.tm.v;i===this.data.op&&(i=this.data.op-1),this.renderedFrame=i}var s,a=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),s=a-1;s>=0;s-=1)(this.completeLayers||this.elements[s])&&(this.elements[s].prepareFrame(this.renderedFrame-this.layers[s].st),this.elements[s]._mdf&&(this._mdf=!0))}},ICompElement.prototype.renderInnerContent=function(){var e,i=this.layers.length;for(e=0;e<i;e+=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()},ICompElement.prototype.setElements=function(e){this.elements=e},ICompElement.prototype.getElements=function(){return this.elements},ICompElement.prototype.destroyElements=function(){var e,i=this.layers.length;for(e=0;e<i;e+=1)this.elements[e]&&this.elements[e].destroy()},ICompElement.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()};function SVGCompElement(e,i,s){this.layers=e.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,i,s),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0}}extendPrototype([SVGRendererBase,ICompElement,SVGBaseElement],SVGCompElement),SVGCompElement.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)};function SVGRenderer(e,i){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.svgElement=createNS("svg");var s="";if(i&&i.title){var a=createNS("title"),_=createElementID();a.setAttribute("id",_),a.textContent=i.title,this.svgElement.appendChild(a),s+=_}if(i&&i.description){var et=createNS("desc"),nt=createElementID();et.setAttribute("id",nt),et.textContent=i.description,this.svgElement.appendChild(et),s+=" "+nt}s&&this.svgElement.setAttribute("aria-labelledby",s);var c=createNS("defs");this.svgElement.appendChild(c);var ct=createNS("g");this.svgElement.appendChild(ct),this.layerElement=ct,this.renderConfig={preserveAspectRatio:i&&i.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:i&&i.contentVisibility||"visible",progressiveLoad:i&&i.progressiveLoad||!1,hideOnTransparent:!(i&&i.hideOnTransparent===!1),viewBoxOnly:i&&i.viewBoxOnly||!1,viewBoxSize:i&&i.viewBoxSize||!1,className:i&&i.className||"",id:i&&i.id||"",focusable:i&&i.focusable,filterSize:{width:i&&i.filterSize&&i.filterSize.width||"100%",height:i&&i.filterSize&&i.filterSize.height||"100%",x:i&&i.filterSize&&i.filterSize.x||"0%",y:i&&i.filterSize&&i.filterSize.y||"0%"},width:i&&i.width,height:i&&i.height,runExpressions:!i||i.runExpressions===void 0||i.runExpressions},this.globalData={_mdf:!1,frameNum:-1,defs:c,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}extendPrototype([SVGRendererBase],SVGRenderer),SVGRenderer.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)};function ShapeTransformManager(){this.sequences={},this.sequenceList=[],this.transform_key_count=0}ShapeTransformManager.prototype={addTransformSequence:function(i){var s,a=i.length,_="_";for(s=0;s<a;s+=1)_+=i[s].transform.key+"_";var et=this.sequences[_];return et||(et={transforms:[].concat(i),finalTransform:new Matrix,_mdf:!1},this.sequences[_]=et,this.sequenceList.push(et)),et},processSequence:function(i,s){for(var a=0,_=i.transforms.length,et=s;a<_&&!s;){if(i.transforms[a].transform.mProps._mdf){et=!0;break}a+=1}if(et)for(i.finalTransform.reset(),a=_-1;a>=0;a-=1)i.finalTransform.multiply(i.transforms[a].transform.mProps.v);i._mdf=et},processSequences:function(i){var s,a=this.sequenceList.length;for(s=0;s<a;s+=1)this.processSequence(this.sequenceList[s],i)},getNewKey:function(){return this.transform_key_count+=1,"_"+this.transform_key_count}};var lumaLoader=function(){var i="__lottie_element_luma_buffer",s=null,a=null,_=null;function et(){var ct=createNS("svg"),dt=createNS("filter"),gt=createNS("feColorMatrix");return dt.setAttribute("id",i),gt.setAttribute("type","matrix"),gt.setAttribute("color-interpolation-filters","sRGB"),gt.setAttribute("values","0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0"),dt.appendChild(gt),ct.appendChild(dt),ct.setAttribute("id",i+"_svg"),featureSupport.svgLumaHidden&&(ct.style.display="none"),ct}function nt(){s||(_=et(),document.body.appendChild(_),s=createTag("canvas"),a=s.getContext("2d"),a.filter="url(#"+i+")",a.fillStyle="rgba(0,0,0,0)",a.fillRect(0,0,1,1))}function c(ct){return s||nt(),s.width=ct.width,s.height=ct.height,a.filter="url(#"+i+")",s}return{load:nt,get:c}};function createCanvas(e,i){if(featureSupport.offscreenCanvas)return new OffscreenCanvas(e,i);var s=createTag("canvas");return s.width=e,s.height=i,s}var assetLoader=function(){return{loadLumaCanvas:lumaLoader.load,getLumaCanvas:lumaLoader.get,createCanvas}}(),registeredEffects={};function CVEffects(e){var i,s=e.data.ef?e.data.ef.length:0;this.filters=[];var a;for(i=0;i<s;i+=1){a=null;var _=e.data.ef[i].ty;if(registeredEffects[_]){var et=registeredEffects[_].effect;a=new et(e.effectsManager.effectElements[i],e)}a&&this.filters.push(a)}this.filters.length&&e.addRenderableComponent(this)}CVEffects.prototype.renderFrame=function(e){var i,s=this.filters.length;for(i=0;i<s;i+=1)this.filters[i].renderFrame(e)},CVEffects.prototype.getEffects=function(e){var i,s=this.filters.length,a=[];for(i=0;i<s;i+=1)this.filters[i].type===e&&a.push(this.filters[i]);return a};function registerEffect(e,i){registeredEffects[e]={effect:i}}function CVMaskElement(e,i){this.data=e,this.element=i,this.masksProperties=this.data.masksProperties||[],this.viewData=createSizedArray(this.masksProperties.length);var s,a=this.masksProperties.length,_=!1;for(s=0;s<a;s+=1)this.masksProperties[s].mode!=="n"&&(_=!0),this.viewData[s]=ShapePropertyFactory.getShapeProp(this.element,this.masksProperties[s],3);this.hasMasks=_,_&&this.element.addRenderableComponent(this)}CVMaskElement.prototype.renderFrame=function(){if(this.hasMasks){var e=this.element.finalTransform.mat,i=this.element.canvasContext,s,a=this.masksProperties.length,_,et,nt;for(i.beginPath(),s=0;s<a;s+=1)if(this.masksProperties[s].mode!=="n"){this.masksProperties[s].inv&&(i.moveTo(0,0),i.lineTo(this.element.globalData.compSize.w,0),i.lineTo(this.element.globalData.compSize.w,this.element.globalData.compSize.h),i.lineTo(0,this.element.globalData.compSize.h),i.lineTo(0,0)),nt=this.viewData[s].v,_=e.applyToPointArray(nt.v[0][0],nt.v[0][1],0),i.moveTo(_[0],_[1]);var c,ct=nt._length;for(c=1;c<ct;c+=1)et=e.applyToTriplePoints(nt.o[c-1],nt.i[c],nt.v[c]),i.bezierCurveTo(et[0],et[1],et[2],et[3],et[4],et[5]);et=e.applyToTriplePoints(nt.o[c-1],nt.i[0],nt.v[0]),i.bezierCurveTo(et[0],et[1],et[2],et[3],et[4],et[5])}this.element.globalData.renderer.save(!0),i.clip()}},CVMaskElement.prototype.getMaskProperty=MaskElement.prototype.getMaskProperty,CVMaskElement.prototype.destroy=function(){this.element=null};function CVBaseElement(){}var operationsMap={1:"source-in",2:"source-out",3:"source-in",4:"source-out"};CVBaseElement.prototype={createElements:function(){},initRendererElement:function(){},createContainerElements:function(){if(this.data.tt>=1){this.buffers=[];var i=this.globalData.canvasContext,s=assetLoader.createCanvas(i.canvas.width,i.canvas.height);this.buffers.push(s);var a=assetLoader.createCanvas(i.canvas.width,i.canvas.height);this.buffers.push(a),this.data.tt>=3&&!document._isProxy&&assetLoader.loadLumaCanvas()}this.canvasContext=this.globalData.canvasContext,this.transformCanvas=this.globalData.transformCanvas,this.renderableEffectsManager=new CVEffects(this),this.searchEffectTransforms()},createContent:function(){},setBlendMode:function(){var i=this.globalData;if(i.blendMode!==this.data.bm){i.blendMode=this.data.bm;var s=getBlendMode(this.data.bm);i.canvasContext.globalCompositeOperation=s}},createRenderableComponents:function(){this.maskManager=new CVMaskElement(this.data,this),this.transformEffects=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT)},hideElement:function(){!this.hidden&&(!this.isInRange||this.isTransparent)&&(this.hidden=!0)},showElement:function(){this.isInRange&&!this.isTransparent&&(this.hidden=!1,this._isFirstFrame=!0,this.maskManager._isFirstFrame=!0)},clearCanvas:function(i){i.clearRect(this.transformCanvas.tx,this.transformCanvas.ty,this.transformCanvas.w*this.transformCanvas.sx,this.transformCanvas.h*this.transformCanvas.sy)},prepareLayer:function(){if(this.data.tt>=1){var i=this.buffers[0],s=i.getContext("2d");this.clearCanvas(s),s.drawImage(this.canvasContext.canvas,0,0),this.currentTransform=this.canvasContext.getTransform(),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform)}},exitLayer:function(){if(this.data.tt>=1){var i=this.buffers[1],s=i.getContext("2d");this.clearCanvas(s),s.drawImage(this.canvasContext.canvas,0,0),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform);var a=this.comp.getElementById("tp"in this.data?this.data.tp:this.data.ind-1);if(a.renderFrame(!0),this.canvasContext.setTransform(1,0,0,1,0,0),this.data.tt>=3&&!document._isProxy){var _=assetLoader.getLumaCanvas(this.canvasContext.canvas),et=_.getContext("2d");et.drawImage(this.canvasContext.canvas,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.drawImage(_,0,0)}this.canvasContext.globalCompositeOperation=operationsMap[this.data.tt],this.canvasContext.drawImage(i,0,0),this.canvasContext.globalCompositeOperation="destination-over",this.canvasContext.drawImage(this.buffers[0],0,0),this.canvasContext.setTransform(this.currentTransform),this.canvasContext.globalCompositeOperation="source-over"}},renderFrame:function(i){if(!(this.hidden||this.data.hd)&&!(this.data.td===1&&!i)){this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.setBlendMode();var s=this.data.ty===0;this.prepareLayer(),this.globalData.renderer.save(s),this.globalData.renderer.ctxTransform(this.finalTransform.localMat.props),this.globalData.renderer.ctxOpacity(this.finalTransform.localOpacity),this.renderInnerContent(),this.globalData.renderer.restore(s),this.exitLayer(),this.maskManager.hasMasks&&this.globalData.renderer.restore(!0),this._isFirstFrame&&(this._isFirstFrame=!1)}},destroy:function(){this.canvasContext=null,this.data=null,this.globalData=null,this.maskManager.destroy()},mHelper:new Matrix},CVBaseElement.prototype.hide=CVBaseElement.prototype.hideElement,CVBaseElement.prototype.show=CVBaseElement.prototype.showElement;function CVShapeData(e,i,s,a){this.styledShapes=[],this.tr=[0,0,0,0,0,0];var _=4;i.ty==="rc"?_=5:i.ty==="el"?_=6:i.ty==="sr"&&(_=7),this.sh=ShapePropertyFactory.getShapeProp(e,i,_,e);var et,nt=s.length,c;for(et=0;et<nt;et+=1)s[et].closed||(c={transforms:a.addTransformSequence(s[et].transforms),trNodes:[]},this.styledShapes.push(c),s[et].elements.push(c))}CVShapeData.prototype.setAsAnimated=SVGShapeData.prototype.setAsAnimated;function CVShapeElement(e,i,s){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.itemsData=[],this.prevViewData=[],this.shapeModifiers=[],this.processedElements=[],this.transformsManager=new ShapeTransformManager,this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,CVBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableElement],CVShapeElement),CVShapeElement.prototype.initElement=RenderableDOMElement.prototype.initElement,CVShapeElement.prototype.transformHelper={opacity:1,_opMdf:!1},CVShapeElement.prototype.dashResetter=[],CVShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[])},CVShapeElement.prototype.createStyleElement=function(e,i){var s={data:e,type:e.ty,preTransforms:this.transformsManager.addTransformSequence(i),transforms:[],elements:[],closed:e.hd===!0},a={};if(e.ty==="fl"||e.ty==="st"?(a.c=PropertyFactory.getProp(this,e.c,1,255,this),a.c.k||(s.co="rgb("+bmFloor(a.c.v[0])+","+bmFloor(a.c.v[1])+","+bmFloor(a.c.v[2])+")")):(e.ty==="gf"||e.ty==="gs")&&(a.s=PropertyFactory.getProp(this,e.s,1,null,this),a.e=PropertyFactory.getProp(this,e.e,1,null,this),a.h=PropertyFactory.getProp(this,e.h||{k:0},0,.01,this),a.a=PropertyFactory.getProp(this,e.a||{k:0},0,degToRads,this),a.g=new GradientProperty(this,e.g,this)),a.o=PropertyFactory.getProp(this,e.o,0,.01,this),e.ty==="st"||e.ty==="gs"){if(s.lc=lineCapEnum[e.lc||2],s.lj=lineJoinEnum[e.lj||2],e.lj==1&&(s.ml=e.ml),a.w=PropertyFactory.getProp(this,e.w,0,null,this),a.w.k||(s.wi=a.w.v),e.d){var _=new DashProperty(this,e.d,"canvas",this);a.d=_,a.d.k||(s.da=a.d.dashArray,s.do=a.d.dashoffset[0])}}else s.r=e.r===2?"evenodd":"nonzero";return this.stylesList.push(s),a.style=s,a},CVShapeElement.prototype.createGroupElement=function(){var e={it:[],prevViewData:[]};return e},CVShapeElement.prototype.createTransformElement=function(e){var i={transform:{opacity:1,_opMdf:!1,key:this.transformsManager.getNewKey(),op:PropertyFactory.getProp(this,e.o,0,.01,this),mProps:TransformPropertyFactory.getTransformProperty(this,e,this)}};return i},CVShapeElement.prototype.createShapeElement=function(e){var i=new CVShapeData(this,e,this.stylesList,this.transformsManager);return this.shapes.push(i),this.addShapeToModifiers(i),i},CVShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var e,i=this.itemsData.length;for(e=0;e<i;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[]),i=this.dynamicProperties.length,e=0;e<i;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame)},CVShapeElement.prototype.addTransformToStyleList=function(e){var i,s=this.stylesList.length;for(i=0;i<s;i+=1)this.stylesList[i].closed||this.stylesList[i].transforms.push(e)},CVShapeElement.prototype.removeTransformFromStyleList=function(){var e,i=this.stylesList.length;for(e=0;e<i;e+=1)this.stylesList[e].closed||this.stylesList[e].transforms.pop()},CVShapeElement.prototype.closeStyles=function(e){var i,s=e.length;for(i=0;i<s;i+=1)e[i].closed=!0},CVShapeElement.prototype.searchShapes=function(e,i,s,a,_){var et,nt=e.length-1,c,ct,dt=[],gt=[],Tt,Et,At,Mt=[].concat(_);for(et=nt;et>=0;et-=1){if(Tt=this.searchProcessedElement(e[et]),Tt?i[et]=s[Tt-1]:e[et]._shouldRender=a,e[et].ty==="fl"||e[et].ty==="st"||e[et].ty==="gf"||e[et].ty==="gs")Tt?i[et].style.closed=!1:i[et]=this.createStyleElement(e[et],Mt),dt.push(i[et].style);else if(e[et].ty==="gr"){if(!Tt)i[et]=this.createGroupElement(e[et]);else for(ct=i[et].it.length,c=0;c<ct;c+=1)i[et].prevViewData[c]=i[et].it[c];this.searchShapes(e[et].it,i[et].it,i[et].prevViewData,a,Mt)}else e[et].ty==="tr"?(Tt||(At=this.createTransformElement(e[et]),i[et]=At),Mt.push(i[et]),this.addTransformToStyleList(i[et])):e[et].ty==="sh"||e[et].ty==="rc"||e[et].ty==="el"||e[et].ty==="sr"?Tt||(i[et]=this.createShapeElement(e[et])):e[et].ty==="tm"||e[et].ty==="rd"||e[et].ty==="pb"||e[et].ty==="zz"||e[et].ty==="op"?(Tt?(Et=i[et],Et.closed=!1):(Et=ShapeModifiers.getModifier(e[et].ty),Et.init(this,e[et]),i[et]=Et,this.shapeModifiers.push(Et)),gt.push(Et)):e[et].ty==="rp"&&(Tt?(Et=i[et],Et.closed=!0):(Et=ShapeModifiers.getModifier(e[et].ty),i[et]=Et,Et.init(this,e,et,i),this.shapeModifiers.push(Et),a=!1),gt.push(Et));this.addProcessedElement(e[et],et+1)}for(this.removeTransformFromStyleList(),this.closeStyles(dt),nt=gt.length,et=0;et<nt;et+=1)gt[et].closed=!0},CVShapeElement.prototype.renderInnerContent=function(){this.transformHelper.opacity=1,this.transformHelper._opMdf=!1,this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame),this.renderShape(this.transformHelper,this.shapesData,this.itemsData,!0)},CVShapeElement.prototype.renderShapeTransform=function(e,i){(e._opMdf||i.op._mdf||this._isFirstFrame)&&(i.opacity=e.opacity,i.opacity*=i.op.v,i._opMdf=!0)},CVShapeElement.prototype.drawLayer=function(){var e,i=this.stylesList.length,s,a,_,et,nt,c,ct=this.globalData.renderer,dt=this.globalData.canvasContext,gt,Tt;for(e=0;e<i;e+=1)if(Tt=this.stylesList[e],gt=Tt.type,!((gt==="st"||gt==="gs")&&Tt.wi===0||!Tt.data._shouldRender||Tt.coOp===0||this.globalData.currentGlobalAlpha===0)){for(ct.save(),nt=Tt.elements,gt==="st"||gt==="gs"?(ct.ctxStrokeStyle(gt==="st"?Tt.co:Tt.grd),ct.ctxLineWidth(Tt.wi),ct.ctxLineCap(Tt.lc),ct.ctxLineJoin(Tt.lj),ct.ctxMiterLimit(Tt.ml||0)):ct.ctxFillStyle(gt==="fl"?Tt.co:Tt.grd),ct.ctxOpacity(Tt.coOp),gt!=="st"&&gt!=="gs"&&dt.beginPath(),ct.ctxTransform(Tt.preTransforms.finalTransform.props),a=nt.length,s=0;s<a;s+=1){for((gt==="st"||gt==="gs")&&(dt.beginPath(),Tt.da&&(dt.setLineDash(Tt.da),dt.lineDashOffset=Tt.do)),c=nt[s].trNodes,et=c.length,_=0;_<et;_+=1)c[_].t==="m"?dt.moveTo(c[_].p[0],c[_].p[1]):c[_].t==="c"?dt.bezierCurveTo(c[_].pts[0],c[_].pts[1],c[_].pts[2],c[_].pts[3],c[_].pts[4],c[_].pts[5]):dt.closePath();(gt==="st"||gt==="gs")&&(ct.ctxStroke(),Tt.da&&dt.setLineDash(this.dashResetter))}gt!=="st"&&gt!=="gs"&&this.globalData.renderer.ctxFill(Tt.r),ct.restore()}},CVShapeElement.prototype.renderShape=function(e,i,s,a){var _,et=i.length-1,nt;for(nt=e,_=et;_>=0;_-=1)i[_].ty==="tr"?(nt=s[_].transform,this.renderShapeTransform(e,nt)):i[_].ty==="sh"||i[_].ty==="el"||i[_].ty==="rc"||i[_].ty==="sr"?this.renderPath(i[_],s[_]):i[_].ty==="fl"?this.renderFill(i[_],s[_],nt):i[_].ty==="st"?this.renderStroke(i[_],s[_],nt):i[_].ty==="gf"||i[_].ty==="gs"?this.renderGradientFill(i[_],s[_],nt):i[_].ty==="gr"?this.renderShape(nt,i[_].it,s[_].it):i[_].ty;a&&this.drawLayer()},CVShapeElement.prototype.renderStyledShape=function(e,i){if(this._isFirstFrame||i._mdf||e.transforms._mdf){var s=e.trNodes,a=i.paths,_,et,nt,c=a._length;s.length=0;var ct=e.transforms.finalTransform;for(nt=0;nt<c;nt+=1){var dt=a.shapes[nt];if(dt&&dt.v){for(et=dt._length,_=1;_<et;_+=1)_===1&&s.push({t:"m",p:ct.applyToPointArray(dt.v[0][0],dt.v[0][1],0)}),s.push({t:"c",pts:ct.applyToTriplePoints(dt.o[_-1],dt.i[_],dt.v[_])});et===1&&s.push({t:"m",p:ct.applyToPointArray(dt.v[0][0],dt.v[0][1],0)}),dt.c&&et&&(s.push({t:"c",pts:ct.applyToTriplePoints(dt.o[_-1],dt.i[0],dt.v[0])}),s.push({t:"z"}))}}e.trNodes=s}},CVShapeElement.prototype.renderPath=function(e,i){if(e.hd!==!0&&e._shouldRender){var s,a=i.styledShapes.length;for(s=0;s<a;s+=1)this.renderStyledShape(i.styledShapes[s],i.sh)}},CVShapeElement.prototype.renderFill=function(e,i,s){var a=i.style;(i.c._mdf||this._isFirstFrame)&&(a.co="rgb("+bmFloor(i.c.v[0])+","+bmFloor(i.c.v[1])+","+bmFloor(i.c.v[2])+")"),(i.o._mdf||s._opMdf||this._isFirstFrame)&&(a.coOp=i.o.v*s.opacity)},CVShapeElement.prototype.renderGradientFill=function(e,i,s){var a=i.style,_;if(!a.grd||i.g._mdf||i.s._mdf||i.e._mdf||e.t!==1&&(i.h._mdf||i.a._mdf)){var et=this.globalData.canvasContext,nt=i.s.v,c=i.e.v;if(e.t===1)_=et.createLinearGradient(nt[0],nt[1],c[0],c[1]);else{var ct=Math.sqrt(Math.pow(nt[0]-c[0],2)+Math.pow(nt[1]-c[1],2)),dt=Math.atan2(c[1]-nt[1],c[0]-nt[0]),gt=i.h.v;gt>=1?gt=.99:gt<=-1&&(gt=-.99);var Tt=ct*gt,Et=Math.cos(dt+i.a.v)*Tt+nt[0],At=Math.sin(dt+i.a.v)*Tt+nt[1];_=et.createRadialGradient(Et,At,0,nt[0],nt[1],ct)}var Mt,Pt=e.g.p,$t=i.g.c,Lt=1;for(Mt=0;Mt<Pt;Mt+=1)i.g._hasOpacity&&i.g._collapsable&&(Lt=i.g.o[Mt*2+1]),_.addColorStop($t[Mt*4]/100,"rgba("+$t[Mt*4+1]+","+$t[Mt*4+2]+","+$t[Mt*4+3]+","+Lt+")");a.grd=_}a.coOp=i.o.v*s.opacity},CVShapeElement.prototype.renderStroke=function(e,i,s){var a=i.style,_=i.d;_&&(_._mdf||this._isFirstFrame)&&(a.da=_.dashArray,a.do=_.dashoffset[0]),(i.c._mdf||this._isFirstFrame)&&(a.co="rgb("+bmFloor(i.c.v[0])+","+bmFloor(i.c.v[1])+","+bmFloor(i.c.v[2])+")"),(i.o._mdf||s._opMdf||this._isFirstFrame)&&(a.coOp=i.o.v*s.opacity),(i.w._mdf||this._isFirstFrame)&&(a.wi=i.w.v)},CVShapeElement.prototype.destroy=function(){this.shapesData=null,this.globalData=null,this.canvasContext=null,this.stylesList.length=0,this.itemsData.length=0};function CVTextElement(e,i,s){this.textSpans=[],this.yOffset=0,this.fillColorAnim=!1,this.strokeColorAnim=!1,this.strokeWidthAnim=!1,this.stroke=!1,this.fill=!1,this.justifyOffset=0,this.currentRender=null,this.renderType="canvas",this.values={fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",sWidth:0,fValue:""},this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement,ITextElement],CVTextElement),CVTextElement.prototype.tHelper=createTag("canvas").getContext("2d"),CVTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var i=!1;e.fc?(i=!0,this.values.fill=this.buildColor(e.fc)):this.values.fill="rgba(0,0,0,0)",this.fill=i;var s=!1;e.sc&&(s=!0,this.values.stroke=this.buildColor(e.sc),this.values.sWidth=e.sw);var a=this.globalData.fontManager.getFontByName(e.f),_,et,nt=e.l,c=this.mHelper;this.stroke=s,this.values.fValue=e.finalSize+"px "+this.globalData.fontManager.getFontByName(e.f).fFamily,et=e.finalText.length;var ct,dt,gt,Tt,Et,At,Mt,Pt,$t,Lt,Bt=this.data.singleShape,Nt=e.tr*.001*e.finalSize,Vt=0,Xt=0,nr=!0,ar=0;for(_=0;_<et;_+=1){ct=this.globalData.fontManager.getCharData(e.finalText[_],a.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily),dt=ct&&ct.data||{},c.reset(),Bt&&nt[_].n&&(Vt=-Nt,Xt+=e.yOffset,Xt+=nr?1:0,nr=!1),Et=dt.shapes?dt.shapes[0].it:[],Mt=Et.length,c.scale(e.finalSize/100,e.finalSize/100),Bt&&this.applyTextPropertiesToMatrix(e,c,nt[_].line,Vt,Xt),$t=createSizedArray(Mt-1);var mr=0;for(At=0;At<Mt;At+=1)if(Et[At].ty==="sh"){for(Tt=Et[At].ks.k.i.length,Pt=Et[At].ks.k,Lt=[],gt=1;gt<Tt;gt+=1)gt===1&&Lt.push(c.applyToX(Pt.v[0][0],Pt.v[0][1],0),c.applyToY(Pt.v[0][0],Pt.v[0][1],0)),Lt.push(c.applyToX(Pt.o[gt-1][0],Pt.o[gt-1][1],0),c.applyToY(Pt.o[gt-1][0],Pt.o[gt-1][1],0),c.applyToX(Pt.i[gt][0],Pt.i[gt][1],0),c.applyToY(Pt.i[gt][0],Pt.i[gt][1],0),c.applyToX(Pt.v[gt][0],Pt.v[gt][1],0),c.applyToY(Pt.v[gt][0],Pt.v[gt][1],0));Lt.push(c.applyToX(Pt.o[gt-1][0],Pt.o[gt-1][1],0),c.applyToY(Pt.o[gt-1][0],Pt.o[gt-1][1],0),c.applyToX(Pt.i[0][0],Pt.i[0][1],0),c.applyToY(Pt.i[0][0],Pt.i[0][1],0),c.applyToX(Pt.v[0][0],Pt.v[0][1],0),c.applyToY(Pt.v[0][0],Pt.v[0][1],0)),$t[mr]=Lt,mr+=1}Bt&&(Vt+=nt[_].l,Vt+=Nt),this.textSpans[ar]?this.textSpans[ar].elem=$t:this.textSpans[ar]={elem:$t},ar+=1}},CVTextElement.prototype.renderInnerContent=function(){this.validateText();var e=this.canvasContext;e.font=this.values.fValue,this.globalData.renderer.ctxLineCap("butt"),this.globalData.renderer.ctxLineJoin("miter"),this.globalData.renderer.ctxMiterLimit(4),this.data.singleShape||this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag);var i,s,a,_,et,nt,c=this.textAnimator.renderedLetters,ct=this.textProperty.currentData.l;s=ct.length;var dt,gt=null,Tt=null,Et=null,At,Mt,Pt=this.globalData.renderer;for(i=0;i<s;i+=1)if(!ct[i].n){if(dt=c[i],dt&&(Pt.save(),Pt.ctxTransform(dt.p),Pt.ctxOpacity(dt.o)),this.fill){for(dt&&dt.fc?gt!==dt.fc&&(Pt.ctxFillStyle(dt.fc),gt=dt.fc):gt!==this.values.fill&&(gt=this.values.fill,Pt.ctxFillStyle(this.values.fill)),At=this.textSpans[i].elem,_=At.length,this.globalData.canvasContext.beginPath(),a=0;a<_;a+=1)for(Mt=At[a],nt=Mt.length,this.globalData.canvasContext.moveTo(Mt[0],Mt[1]),et=2;et<nt;et+=6)this.globalData.canvasContext.bezierCurveTo(Mt[et],Mt[et+1],Mt[et+2],Mt[et+3],Mt[et+4],Mt[et+5]);this.globalData.canvasContext.closePath(),Pt.ctxFill()}if(this.stroke){for(dt&&dt.sw?Et!==dt.sw&&(Et=dt.sw,Pt.ctxLineWidth(dt.sw)):Et!==this.values.sWidth&&(Et=this.values.sWidth,Pt.ctxLineWidth(this.values.sWidth)),dt&&dt.sc?Tt!==dt.sc&&(Tt=dt.sc,Pt.ctxStrokeStyle(dt.sc)):Tt!==this.values.stroke&&(Tt=this.values.stroke,Pt.ctxStrokeStyle(this.values.stroke)),At=this.textSpans[i].elem,_=At.length,this.globalData.canvasContext.beginPath(),a=0;a<_;a+=1)for(Mt=At[a],nt=Mt.length,this.globalData.canvasContext.moveTo(Mt[0],Mt[1]),et=2;et<nt;et+=6)this.globalData.canvasContext.bezierCurveTo(Mt[et],Mt[et+1],Mt[et+2],Mt[et+3],Mt[et+4],Mt[et+5]);this.globalData.canvasContext.closePath(),Pt.ctxStroke()}dt&&this.globalData.renderer.restore()}};function CVImageElement(e,i,s){this.assetData=i.getAssetData(e.refId),this.img=i.imageLoader.getAsset(this.assetData),this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVImageElement),CVImageElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVImageElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVImageElement.prototype.createContent=function(){if(this.img.width&&(this.assetData.w!==this.img.width||this.assetData.h!==this.img.height)){var e=createTag("canvas");e.width=this.assetData.w,e.height=this.assetData.h;var i=e.getContext("2d"),s=this.img.width,a=this.img.height,_=s/a,et=this.assetData.w/this.assetData.h,nt,c,ct=this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio;_>et&&ct==="xMidYMid slice"||_<et&&ct!=="xMidYMid slice"?(c=a,nt=c*et):(nt=s,c=nt/et),i.drawImage(this.img,(s-nt)/2,(a-c)/2,nt,c,0,0,this.assetData.w,this.assetData.h),this.img=e}},CVImageElement.prototype.renderInnerContent=function(){this.canvasContext.drawImage(this.img,0,0)},CVImageElement.prototype.destroy=function(){this.img=null};function CVSolidElement(e,i,s){this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVSolidElement),CVSolidElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVSolidElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVSolidElement.prototype.renderInnerContent=function(){this.globalData.renderer.ctxFillStyle(this.data.sc),this.globalData.renderer.ctxFillRect(0,0,this.data.sw,this.data.sh)};function CanvasRendererBase(){}extendPrototype([BaseRenderer],CanvasRendererBase),CanvasRendererBase.prototype.createShape=function(e){return new CVShapeElement(e,this.globalData,this)},CanvasRendererBase.prototype.createText=function(e){return new CVTextElement(e,this.globalData,this)},CanvasRendererBase.prototype.createImage=function(e){return new CVImageElement(e,this.globalData,this)},CanvasRendererBase.prototype.createSolid=function(e){return new CVSolidElement(e,this.globalData,this)},CanvasRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,CanvasRendererBase.prototype.ctxTransform=function(e){e[0]===1&&e[1]===0&&e[4]===0&&e[5]===1&&e[12]===0&&e[13]===0||this.canvasContext.transform(e[0],e[1],e[4],e[5],e[12],e[13])},CanvasRendererBase.prototype.ctxOpacity=function(e){this.canvasContext.globalAlpha*=e<0?0:e},CanvasRendererBase.prototype.ctxFillStyle=function(e){this.canvasContext.fillStyle=e},CanvasRendererBase.prototype.ctxStrokeStyle=function(e){this.canvasContext.strokeStyle=e},CanvasRendererBase.prototype.ctxLineWidth=function(e){this.canvasContext.lineWidth=e},CanvasRendererBase.prototype.ctxLineCap=function(e){this.canvasContext.lineCap=e},CanvasRendererBase.prototype.ctxLineJoin=function(e){this.canvasContext.lineJoin=e},CanvasRendererBase.prototype.ctxMiterLimit=function(e){this.canvasContext.miterLimit=e},CanvasRendererBase.prototype.ctxFill=function(e){this.canvasContext.fill(e)},CanvasRendererBase.prototype.ctxFillRect=function(e,i,s,a){this.canvasContext.fillRect(e,i,s,a)},CanvasRendererBase.prototype.ctxStroke=function(){this.canvasContext.stroke()},CanvasRendererBase.prototype.reset=function(){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}this.contextData.reset()},CanvasRendererBase.prototype.save=function(){this.canvasContext.save()},CanvasRendererBase.prototype.restore=function(e){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}e&&(this.globalData.blendMode="source-over"),this.contextData.restore(e)},CanvasRendererBase.prototype.configAnimation=function(e){if(this.animationItem.wrapper){this.animationItem.container=createTag("canvas");var i=this.animationItem.container.style;i.width="100%",i.height="100%";var s="0px 0px 0px";i.transformOrigin=s,i.mozTransformOrigin=s,i.webkitTransformOrigin=s,i["-webkit-transform"]=s,i.contentVisibility=this.renderConfig.contentVisibility,this.animationItem.wrapper.appendChild(this.animationItem.container),this.canvasContext=this.animationItem.container.getContext("2d"),this.renderConfig.className&&this.animationItem.container.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.animationItem.container.setAttribute("id",this.renderConfig.id)}else this.canvasContext=this.renderConfig.context;this.contextData.setContext(this.canvasContext),this.data=e,this.layers=e.layers,this.transformCanvas={w:e.w,h:e.h,sx:0,sy:0,tx:0,ty:0},this.setupGlobalData(e,document.body),this.globalData.canvasContext=this.canvasContext,this.globalData.renderer=this,this.globalData.isDashed=!1,this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.globalData.transformCanvas=this.transformCanvas,this.elements=createSizedArray(e.layers.length),this.updateContainerSize()},CanvasRendererBase.prototype.updateContainerSize=function(e,i){this.reset();var s,a;e?(s=e,a=i,this.canvasContext.canvas.width=s,this.canvasContext.canvas.height=a):(this.animationItem.wrapper&&this.animationItem.container?(s=this.animationItem.wrapper.offsetWidth,a=this.animationItem.wrapper.offsetHeight):(s=this.canvasContext.canvas.width,a=this.canvasContext.canvas.height),this.canvasContext.canvas.width=s*this.renderConfig.dpr,this.canvasContext.canvas.height=a*this.renderConfig.dpr);var _,et;if(this.renderConfig.preserveAspectRatio.indexOf("meet")!==-1||this.renderConfig.preserveAspectRatio.indexOf("slice")!==-1){var nt=this.renderConfig.preserveAspectRatio.split(" "),c=nt[1]||"meet",ct=nt[0]||"xMidYMid",dt=ct.substr(0,4),gt=ct.substr(4);_=s/a,et=this.transformCanvas.w/this.transformCanvas.h,et>_&&c==="meet"||et<_&&c==="slice"?(this.transformCanvas.sx=s/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=s/(this.transformCanvas.w/this.renderConfig.dpr)):(this.transformCanvas.sx=a/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.sy=a/(this.transformCanvas.h/this.renderConfig.dpr)),dt==="xMid"&&(et<_&&c==="meet"||et>_&&c==="slice")?this.transformCanvas.tx=(s-this.transformCanvas.w*(a/this.transformCanvas.h))/2*this.renderConfig.dpr:dt==="xMax"&&(et<_&&c==="meet"||et>_&&c==="slice")?this.transformCanvas.tx=(s-this.transformCanvas.w*(a/this.transformCanvas.h))*this.renderConfig.dpr:this.transformCanvas.tx=0,gt==="YMid"&&(et>_&&c==="meet"||et<_&&c==="slice")?this.transformCanvas.ty=(a-this.transformCanvas.h*(s/this.transformCanvas.w))/2*this.renderConfig.dpr:gt==="YMax"&&(et>_&&c==="meet"||et<_&&c==="slice")?this.transformCanvas.ty=(a-this.transformCanvas.h*(s/this.transformCanvas.w))*this.renderConfig.dpr:this.transformCanvas.ty=0}else this.renderConfig.preserveAspectRatio==="none"?(this.transformCanvas.sx=s/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=a/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.tx=0,this.transformCanvas.ty=0):(this.transformCanvas.sx=this.renderConfig.dpr,this.transformCanvas.sy=this.renderConfig.dpr,this.transformCanvas.tx=0,this.transformCanvas.ty=0);this.transformCanvas.props=[this.transformCanvas.sx,0,0,0,0,this.transformCanvas.sy,0,0,0,0,1,0,this.transformCanvas.tx,this.transformCanvas.ty,0,1],this.ctxTransform(this.transformCanvas.props),this.canvasContext.beginPath(),this.canvasContext.rect(0,0,this.transformCanvas.w,this.transformCanvas.h),this.canvasContext.closePath(),this.canvasContext.clip(),this.renderFrame(this.renderedFrame,!0)},CanvasRendererBase.prototype.destroy=function(){this.renderConfig.clearCanvas&&this.animationItem.wrapper&&(this.animationItem.wrapper.innerText="");var e,i=this.layers?this.layers.length:0;for(e=i-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.globalData.canvasContext=null,this.animationItem.container=null,this.destroyed=!0},CanvasRendererBase.prototype.renderFrame=function(e,i){if(!(this.renderedFrame===e&&this.renderConfig.clearCanvas===!0&&!i||this.destroyed||e===-1)){this.renderedFrame=e,this.globalData.frameNum=e-this.animationItem._isFirstFrame,this.globalData.frameId+=1,this.globalData._mdf=!this.renderConfig.clearCanvas||i,this.globalData.projectInterface.currentFrame=e;var s,a=this.layers.length;for(this.completeLayers||this.checkLayers(e),s=a-1;s>=0;s-=1)(this.completeLayers||this.elements[s])&&this.elements[s].prepareFrame(e-this.layers[s].st);if(this.globalData._mdf){for(this.renderConfig.clearCanvas===!0?this.canvasContext.clearRect(0,0,this.transformCanvas.w,this.transformCanvas.h):this.save(),s=a-1;s>=0;s-=1)(this.completeLayers||this.elements[s])&&this.elements[s].renderFrame();this.renderConfig.clearCanvas!==!0&&this.restore()}}},CanvasRendererBase.prototype.buildItem=function(e){var i=this.elements;if(!(i[e]||this.layers[e].ty===99)){var s=this.createItem(this.layers[e],this,this.globalData);i[e]=s,s.initExpressions()}},CanvasRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();e.checkParenting()}},CanvasRendererBase.prototype.hide=function(){this.animationItem.container.style.display="none"},CanvasRendererBase.prototype.show=function(){this.animationItem.container.style.display="block"};function CanvasContext(){this.opacity=-1,this.transform=createTypedArray("float32",16),this.fillStyle="",this.strokeStyle="",this.lineWidth="",this.lineCap="",this.lineJoin="",this.miterLimit="",this.id=Math.random()}function CVContextData(){this.stack=[],this.cArrPos=0,this.cTr=new Matrix;var e,i=15;for(e=0;e<i;e+=1){var s=new CanvasContext;this.stack[e]=s}this._length=i,this.nativeContext=null,this.transformMat=new Matrix,this.currentOpacity=1,this.currentFillStyle="",this.appliedFillStyle="",this.currentStrokeStyle="",this.appliedStrokeStyle="",this.currentLineWidth="",this.appliedLineWidth="",this.currentLineCap="",this.appliedLineCap="",this.currentLineJoin="",this.appliedLineJoin="",this.appliedMiterLimit="",this.currentMiterLimit=""}CVContextData.prototype.duplicate=function(){var e=this._length*2,i=0;for(i=this._length;i<e;i+=1)this.stack[i]=new CanvasContext;this._length=e},CVContextData.prototype.reset=function(){this.cArrPos=0,this.cTr.reset(),this.stack[this.cArrPos].opacity=1},CVContextData.prototype.restore=function(e){this.cArrPos-=1;var i=this.stack[this.cArrPos],s=i.transform,a,_=this.cTr.props;for(a=0;a<16;a+=1)_[a]=s[a];if(e){this.nativeContext.restore();var et=this.stack[this.cArrPos+1];this.appliedFillStyle=et.fillStyle,this.appliedStrokeStyle=et.strokeStyle,this.appliedLineWidth=et.lineWidth,this.appliedLineCap=et.lineCap,this.appliedLineJoin=et.lineJoin,this.appliedMiterLimit=et.miterLimit}this.nativeContext.setTransform(s[0],s[1],s[4],s[5],s[12],s[13]),(e||i.opacity!==-1&&this.currentOpacity!==i.opacity)&&(this.nativeContext.globalAlpha=i.opacity,this.currentOpacity=i.opacity),this.currentFillStyle=i.fillStyle,this.currentStrokeStyle=i.strokeStyle,this.currentLineWidth=i.lineWidth,this.currentLineCap=i.lineCap,this.currentLineJoin=i.lineJoin,this.currentMiterLimit=i.miterLimit},CVContextData.prototype.save=function(e){e&&this.nativeContext.save();var i=this.cTr.props;this._length<=this.cArrPos&&this.duplicate();var s=this.stack[this.cArrPos],a;for(a=0;a<16;a+=1)s.transform[a]=i[a];this.cArrPos+=1;var _=this.stack[this.cArrPos];_.opacity=s.opacity,_.fillStyle=s.fillStyle,_.strokeStyle=s.strokeStyle,_.lineWidth=s.lineWidth,_.lineCap=s.lineCap,_.lineJoin=s.lineJoin,_.miterLimit=s.miterLimit},CVContextData.prototype.setOpacity=function(e){this.stack[this.cArrPos].opacity=e},CVContextData.prototype.setContext=function(e){this.nativeContext=e},CVContextData.prototype.fillStyle=function(e){this.stack[this.cArrPos].fillStyle!==e&&(this.currentFillStyle=e,this.stack[this.cArrPos].fillStyle=e)},CVContextData.prototype.strokeStyle=function(e){this.stack[this.cArrPos].strokeStyle!==e&&(this.currentStrokeStyle=e,this.stack[this.cArrPos].strokeStyle=e)},CVContextData.prototype.lineWidth=function(e){this.stack[this.cArrPos].lineWidth!==e&&(this.currentLineWidth=e,this.stack[this.cArrPos].lineWidth=e)},CVContextData.prototype.lineCap=function(e){this.stack[this.cArrPos].lineCap!==e&&(this.currentLineCap=e,this.stack[this.cArrPos].lineCap=e)},CVContextData.prototype.lineJoin=function(e){this.stack[this.cArrPos].lineJoin!==e&&(this.currentLineJoin=e,this.stack[this.cArrPos].lineJoin=e)},CVContextData.prototype.miterLimit=function(e){this.stack[this.cArrPos].miterLimit!==e&&(this.currentMiterLimit=e,this.stack[this.cArrPos].miterLimit=e)},CVContextData.prototype.transform=function(e){this.transformMat.cloneFromProps(e);var i=this.cTr;this.transformMat.multiply(i),i.cloneFromProps(this.transformMat.props);var s=i.props;this.nativeContext.setTransform(s[0],s[1],s[4],s[5],s[12],s[13])},CVContextData.prototype.opacity=function(e){var i=this.stack[this.cArrPos].opacity;i*=e<0?0:e,this.stack[this.cArrPos].opacity!==i&&(this.currentOpacity!==e&&(this.nativeContext.globalAlpha=e,this.currentOpacity=e),this.stack[this.cArrPos].opacity=i)},CVContextData.prototype.fill=function(e){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fill(e)},CVContextData.prototype.fillRect=function(e,i,s,a){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fillRect(e,i,s,a)},CVContextData.prototype.stroke=function(){this.appliedStrokeStyle!==this.currentStrokeStyle&&(this.appliedStrokeStyle=this.currentStrokeStyle,this.nativeContext.strokeStyle=this.appliedStrokeStyle),this.appliedLineWidth!==this.currentLineWidth&&(this.appliedLineWidth=this.currentLineWidth,this.nativeContext.lineWidth=this.appliedLineWidth),this.appliedLineCap!==this.currentLineCap&&(this.appliedLineCap=this.currentLineCap,this.nativeContext.lineCap=this.appliedLineCap),this.appliedLineJoin!==this.currentLineJoin&&(this.appliedLineJoin=this.currentLineJoin,this.nativeContext.lineJoin=this.appliedLineJoin),this.appliedMiterLimit!==this.currentMiterLimit&&(this.appliedMiterLimit=this.currentMiterLimit,this.nativeContext.miterLimit=this.appliedMiterLimit),this.nativeContext.stroke()};function CVCompElement(e,i,s){this.completeLayers=!1,this.layers=e.layers,this.pendingElements=[],this.elements=createSizedArray(this.layers.length),this.initElement(e,i,s),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0}}extendPrototype([CanvasRendererBase,ICompElement,CVBaseElement],CVCompElement),CVCompElement.prototype.renderInnerContent=function(){var e=this.canvasContext;e.beginPath(),e.moveTo(0,0),e.lineTo(this.data.w,0),e.lineTo(this.data.w,this.data.h),e.lineTo(0,this.data.h),e.lineTo(0,0),e.clip();var i,s=this.layers.length;for(i=s-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&this.elements[i].renderFrame()},CVCompElement.prototype.destroy=function(){var e,i=this.layers.length;for(e=i-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy();this.layers=null,this.elements=null},CVCompElement.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)};function CanvasRenderer(e,i){this.animationItem=e,this.renderConfig={clearCanvas:i&&i.clearCanvas!==void 0?i.clearCanvas:!0,context:i&&i.context||null,progressiveLoad:i&&i.progressiveLoad||!1,preserveAspectRatio:i&&i.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:i&&i.contentVisibility||"visible",className:i&&i.className||"",id:i&&i.id||"",runExpressions:!i||i.runExpressions===void 0||i.runExpressions},this.renderConfig.dpr=i&&i.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=i&&i.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas",this.renderConfig.clearCanvas&&(this.ctxTransform=this.contextData.transform.bind(this.contextData),this.ctxOpacity=this.contextData.opacity.bind(this.contextData),this.ctxFillStyle=this.contextData.fillStyle.bind(this.contextData),this.ctxStrokeStyle=this.contextData.strokeStyle.bind(this.contextData),this.ctxLineWidth=this.contextData.lineWidth.bind(this.contextData),this.ctxLineCap=this.contextData.lineCap.bind(this.contextData),this.ctxLineJoin=this.contextData.lineJoin.bind(this.contextData),this.ctxMiterLimit=this.contextData.miterLimit.bind(this.contextData),this.ctxFill=this.contextData.fill.bind(this.contextData),this.ctxFillRect=this.contextData.fillRect.bind(this.contextData),this.ctxStroke=this.contextData.stroke.bind(this.contextData),this.save=this.contextData.save.bind(this.contextData))}extendPrototype([CanvasRendererBase],CanvasRenderer),CanvasRenderer.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)};function HBaseElement(){}HBaseElement.prototype={checkBlendMode:function(){},initRendererElement:function(){this.baseElement=createTag(this.data.tg||"div"),this.data.hasMask?(this.svgElement=createNS("svg"),this.layerElement=createNS("g"),this.maskedElement=this.layerElement,this.svgElement.appendChild(this.layerElement),this.baseElement.appendChild(this.svgElement)):this.layerElement=this.baseElement,styleDiv(this.baseElement)},createContainerElements:function(){this.renderableEffectsManager=new CVEffects(this),this.transformedElement=this.baseElement,this.maskedElement=this.layerElement,this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.bm!==0&&this.setBlendMode()},renderElement:function(){var i=this.transformedElement?this.transformedElement.style:{};if(this.finalTransform._matMdf){var s=this.finalTransform.mat.toCSS();i.transform=s,i.webkitTransform=s}this.finalTransform._opMdf&&(i.opacity=this.finalTransform.mProp.o.v)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},destroy:function(){this.layerElement=null,this.transformedElement=null,this.matteElement&&(this.matteElement=null),this.maskManager&&(this.maskManager.destroy(),this.maskManager=null)},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData)},addEffects:function(){},setMatte:function(){}},HBaseElement.prototype.getBaseElement=SVGBaseElement.prototype.getBaseElement,HBaseElement.prototype.destroyBaseElement=HBaseElement.prototype.destroy,HBaseElement.prototype.buildElementParenting=BaseRenderer.prototype.buildElementParenting;function HSolidElement(e,i,s){this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],HSolidElement),HSolidElement.prototype.createContent=function(){var e;this.data.hasMask?(e=createNS("rect"),e.setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.svgElement.setAttribute("width",this.data.sw),this.svgElement.setAttribute("height",this.data.sh)):(e=createTag("div"),e.style.width=this.data.sw+"px",e.style.height=this.data.sh+"px",e.style.backgroundColor=this.data.sc),this.layerElement.appendChild(e)};function HShapeElement(e,i,s){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.shapesContainer=createNS("g"),this.initElement(e,i,s),this.prevViewData=[],this.currentBBox={x:999999,y:-999999,h:0,w:0}}extendPrototype([BaseElement,TransformElement,HSolidElement,SVGShapeElement,HBaseElement,HierarchyElement,FrameElement,RenderableElement],HShapeElement),HShapeElement.prototype._renderShapeFrame=HShapeElement.prototype.renderInnerContent,HShapeElement.prototype.createContent=function(){var e;if(this.baseElement.style.fontSize=0,this.data.hasMask)this.layerElement.appendChild(this.shapesContainer),e=this.svgElement;else{e=createNS("svg");var i=this.comp.data?this.comp.data:this.globalData.compSize;e.setAttribute("width",i.w),e.setAttribute("height",i.h),e.appendChild(this.shapesContainer),this.layerElement.appendChild(e)}this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.shapesContainer,0,[],!0),this.filterUniqueShapes(),this.shapeCont=e},HShapeElement.prototype.getTransformedPoint=function(e,i){var s,a=e.length;for(s=0;s<a;s+=1)i=e[s].mProps.v.applyToPointArray(i[0],i[1],0);return i},HShapeElement.prototype.calculateShapeBoundingBox=function(e,i){var s=e.sh.v,a=e.transformers,_,et=s._length,nt,c,ct,dt;if(!(et<=1)){for(_=0;_<et-1;_+=1)nt=this.getTransformedPoint(a,s.v[_]),c=this.getTransformedPoint(a,s.o[_]),ct=this.getTransformedPoint(a,s.i[_+1]),dt=this.getTransformedPoint(a,s.v[_+1]),this.checkBounds(nt,c,ct,dt,i);s.c&&(nt=this.getTransformedPoint(a,s.v[_]),c=this.getTransformedPoint(a,s.o[_]),ct=this.getTransformedPoint(a,s.i[0]),dt=this.getTransformedPoint(a,s.v[0]),this.checkBounds(nt,c,ct,dt,i))}},HShapeElement.prototype.checkBounds=function(e,i,s,a,_){this.getBoundsOfCurve(e,i,s,a);var et=this.shapeBoundingBox;_.x=bmMin(et.left,_.x),_.xMax=bmMax(et.right,_.xMax),_.y=bmMin(et.top,_.y),_.yMax=bmMax(et.bottom,_.yMax)},HShapeElement.prototype.shapeBoundingBox={left:0,right:0,top:0,bottom:0},HShapeElement.prototype.tempBoundingBox={x:0,xMax:0,y:0,yMax:0,width:0,height:0},HShapeElement.prototype.getBoundsOfCurve=function(e,i,s,a){for(var _=[[e[0],a[0]],[e[1],a[1]]],et,nt,c,ct,dt,gt,Tt,Et=0;Et<2;++Et)nt=6*e[Et]-12*i[Et]+6*s[Et],et=-3*e[Et]+9*i[Et]-9*s[Et]+3*a[Et],c=3*i[Et]-3*e[Et],nt|=0,et|=0,c|=0,et===0&&nt===0||(et===0?(ct=-c/nt,ct>0&&ct<1&&_[Et].push(this.calculateF(ct,e,i,s,a,Et))):(dt=nt*nt-4*c*et,dt>=0&&(gt=(-nt+bmSqrt(dt))/(2*et),gt>0&&gt<1&&_[Et].push(this.calculateF(gt,e,i,s,a,Et)),Tt=(-nt-bmSqrt(dt))/(2*et),Tt>0&&Tt<1&&_[Et].push(this.calculateF(Tt,e,i,s,a,Et)))));this.shapeBoundingBox.left=bmMin.apply(null,_[0]),this.shapeBoundingBox.top=bmMin.apply(null,_[1]),this.shapeBoundingBox.right=bmMax.apply(null,_[0]),this.shapeBoundingBox.bottom=bmMax.apply(null,_[1])},HShapeElement.prototype.calculateF=function(e,i,s,a,_,et){return bmPow(1-e,3)*i[et]+3*bmPow(1-e,2)*e*s[et]+3*(1-e)*bmPow(e,2)*a[et]+bmPow(e,3)*_[et]},HShapeElement.prototype.calculateBoundingBox=function(e,i){var s,a=e.length;for(s=0;s<a;s+=1)e[s]&&e[s].sh?this.calculateShapeBoundingBox(e[s],i):e[s]&&e[s].it?this.calculateBoundingBox(e[s].it,i):e[s]&&e[s].style&&e[s].w&&this.expandStrokeBoundingBox(e[s].w,i)},HShapeElement.prototype.expandStrokeBoundingBox=function(e,i){var s=0;if(e.keyframes){for(var a=0;a<e.keyframes.length;a+=1){var _=e.keyframes[a].s;_>s&&(s=_)}s*=e.mult}else s=e.v*e.mult;i.x-=s,i.xMax+=s,i.y-=s,i.yMax+=s},HShapeElement.prototype.currentBoxContains=function(e){return this.currentBBox.x<=e.x&&this.currentBBox.y<=e.y&&this.currentBBox.width+this.currentBBox.x>=e.x+e.width&&this.currentBBox.height+this.currentBBox.y>=e.y+e.height},HShapeElement.prototype.renderInnerContent=function(){if(this._renderShapeFrame(),!this.hidden&&(this._isFirstFrame||this._mdf)){var e=this.tempBoundingBox,i=999999;if(e.x=i,e.xMax=-i,e.y=i,e.yMax=-i,this.calculateBoundingBox(this.itemsData,e),e.width=e.xMax<e.x?0:e.xMax-e.x,e.height=e.yMax<e.y?0:e.yMax-e.y,this.currentBoxContains(e))return;var s=!1;if(this.currentBBox.w!==e.width&&(this.currentBBox.w=e.width,this.shapeCont.setAttribute("width",e.width),s=!0),this.currentBBox.h!==e.height&&(this.currentBBox.h=e.height,this.shapeCont.setAttribute("height",e.height),s=!0),s||this.currentBBox.x!==e.x||this.currentBBox.y!==e.y){this.currentBBox.w=e.width,this.currentBBox.h=e.height,this.currentBBox.x=e.x,this.currentBBox.y=e.y,this.shapeCont.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h);var a=this.shapeCont.style,_="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";a.transform=_,a.webkitTransform=_}}};function HTextElement(e,i,s){this.textSpans=[],this.textPaths=[],this.currentBBox={x:999999,y:-999999,h:0,w:0},this.renderType="svg",this.isMasked=!1,this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],HTextElement),HTextElement.prototype.createContent=function(){if(this.isMasked=this.checkMasks(),this.isMasked){this.renderType="svg",this.compW=this.comp.data.w,this.compH=this.comp.data.h,this.svgElement.setAttribute("width",this.compW),this.svgElement.setAttribute("height",this.compH);var e=createNS("g");this.maskedElement.appendChild(e),this.innerElem=e}else this.renderType="html",this.innerElem=this.layerElement;this.checkParenting()},HTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var i=this.innerElem.style,s=e.fc?this.buildColor(e.fc):"rgba(0,0,0,0)";i.fill=s,i.color=s,e.sc&&(i.stroke=this.buildColor(e.sc),i.strokeWidth=e.sw+"px");var a=this.globalData.fontManager.getFontByName(e.f);if(!this.globalData.fontManager.chars)if(i.fontSize=e.finalSize+"px",i.lineHeight=e.finalSize+"px",a.fClass)this.innerElem.className=a.fClass;else{i.fontFamily=a.fFamily;var _=e.fWeight,et=e.fStyle;i.fontStyle=et,i.fontWeight=_}var nt,c,ct=e.l;c=ct.length;var dt,gt,Tt,Et=this.mHelper,At,Mt="",Pt=0;for(nt=0;nt<c;nt+=1){if(this.globalData.fontManager.chars?(this.textPaths[Pt]?dt=this.textPaths[Pt]:(dt=createNS("path"),dt.setAttribute("stroke-linecap",lineCapEnum[1]),dt.setAttribute("stroke-linejoin",lineJoinEnum[2]),dt.setAttribute("stroke-miterlimit","4")),this.isMasked||(this.textSpans[Pt]?(gt=this.textSpans[Pt],Tt=gt.children[0]):(gt=createTag("div"),gt.style.lineHeight=0,Tt=createNS("svg"),Tt.appendChild(dt),styleDiv(gt)))):this.isMasked?dt=this.textPaths[Pt]?this.textPaths[Pt]:createNS("text"):this.textSpans[Pt]?(gt=this.textSpans[Pt],dt=this.textPaths[Pt]):(gt=createTag("span"),styleDiv(gt),dt=createTag("span"),styleDiv(dt),gt.appendChild(dt)),this.globalData.fontManager.chars){var $t=this.globalData.fontManager.getCharData(e.finalText[nt],a.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily),Lt;if($t?Lt=$t.data:Lt=null,Et.reset(),Lt&&Lt.shapes&&Lt.shapes.length&&(At=Lt.shapes[0].it,Et.scale(e.finalSize/100,e.finalSize/100),Mt=this.createPathShape(Et,At),dt.setAttribute("d",Mt)),this.isMasked)this.innerElem.appendChild(dt);else{if(this.innerElem.appendChild(gt),Lt&&Lt.shapes){document.body.appendChild(Tt);var Bt=Tt.getBBox();Tt.setAttribute("width",Bt.width+2),Tt.setAttribute("height",Bt.height+2),Tt.setAttribute("viewBox",Bt.x-1+" "+(Bt.y-1)+" "+(Bt.width+2)+" "+(Bt.height+2));var Nt=Tt.style,Vt="translate("+(Bt.x-1)+"px,"+(Bt.y-1)+"px)";Nt.transform=Vt,Nt.webkitTransform=Vt,ct[nt].yOffset=Bt.y-1}else Tt.setAttribute("width",1),Tt.setAttribute("height",1);gt.appendChild(Tt)}}else if(dt.textContent=ct[nt].val,dt.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),this.isMasked)this.innerElem.appendChild(dt);else{this.innerElem.appendChild(gt);var Xt=dt.style,nr="translate3d(0,"+-e.finalSize/1.2+"px,0)";Xt.transform=nr,Xt.webkitTransform=nr}this.isMasked?this.textSpans[Pt]=dt:this.textSpans[Pt]=gt,this.textSpans[Pt].style.display="block",this.textPaths[Pt]=dt,Pt+=1}for(;Pt<this.textSpans.length;)this.textSpans[Pt].style.display="none",Pt+=1},HTextElement.prototype.renderInnerContent=function(){this.validateText();var e;if(this.data.singleShape){if(!this._isFirstFrame&&!this.lettersChangedFlag)return;if(this.isMasked&&this.finalTransform._matMdf){this.svgElement.setAttribute("viewBox",-this.finalTransform.mProp.p.v[0]+" "+-this.finalTransform.mProp.p.v[1]+" "+this.compW+" "+this.compH),e=this.svgElement.style;var i="translate("+-this.finalTransform.mProp.p.v[0]+"px,"+-this.finalTransform.mProp.p.v[1]+"px)";e.transform=i,e.webkitTransform=i}}if(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),!(!this.lettersChangedFlag&&!this.textAnimator.lettersChangedFlag)){var s,a,_=0,et=this.textAnimator.renderedLetters,nt=this.textProperty.currentData.l;a=nt.length;var c,ct,dt;for(s=0;s<a;s+=1)nt[s].n?_+=1:(ct=this.textSpans[s],dt=this.textPaths[s],c=et[_],_+=1,c._mdf.m&&(this.isMasked?ct.setAttribute("transform",c.m):(ct.style.webkitTransform=c.m,ct.style.transform=c.m)),ct.style.opacity=c.o,c.sw&&c._mdf.sw&&dt.setAttribute("stroke-width",c.sw),c.sc&&c._mdf.sc&&dt.setAttribute("stroke",c.sc),c.fc&&c._mdf.fc&&(dt.setAttribute("fill",c.fc),dt.style.color=c.fc));if(this.innerElem.getBBox&&!this.hidden&&(this._isFirstFrame||this._mdf)){var gt=this.innerElem.getBBox();this.currentBBox.w!==gt.width&&(this.currentBBox.w=gt.width,this.svgElement.setAttribute("width",gt.width)),this.currentBBox.h!==gt.height&&(this.currentBBox.h=gt.height,this.svgElement.setAttribute("height",gt.height));var Tt=1;if(this.currentBBox.w!==gt.width+Tt*2||this.currentBBox.h!==gt.height+Tt*2||this.currentBBox.x!==gt.x-Tt||this.currentBBox.y!==gt.y-Tt){this.currentBBox.w=gt.width+Tt*2,this.currentBBox.h=gt.height+Tt*2,this.currentBBox.x=gt.x-Tt,this.currentBBox.y=gt.y-Tt,this.svgElement.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h),e=this.svgElement.style;var Et="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";e.transform=Et,e.webkitTransform=Et}}}};function HCameraElement(e,i,s){this.initFrame(),this.initBaseData(e,i,s),this.initHierarchy();var a=PropertyFactory.getProp;if(this.pe=a(this,e.pe,0,0,this),e.ks.p.s?(this.px=a(this,e.ks.p.x,1,0,this),this.py=a(this,e.ks.p.y,1,0,this),this.pz=a(this,e.ks.p.z,1,0,this)):this.p=a(this,e.ks.p,1,0,this),e.ks.a&&(this.a=a(this,e.ks.a,1,0,this)),e.ks.or.k.length&&e.ks.or.k[0].to){var _,et=e.ks.or.k.length;for(_=0;_<et;_+=1)e.ks.or.k[_].to=null,e.ks.or.k[_].ti=null}this.or=a(this,e.ks.or,1,degToRads,this),this.or.sh=!0,this.rx=a(this,e.ks.rx,0,degToRads,this),this.ry=a(this,e.ks.ry,0,degToRads,this),this.rz=a(this,e.ks.rz,0,degToRads,this),this.mat=new Matrix,this._prevMat=new Matrix,this._isFirstFrame=!0,this.finalTransform={mProp:this}}extendPrototype([BaseElement,FrameElement,HierarchyElement],HCameraElement),HCameraElement.prototype.setup=function(){var e,i=this.comp.threeDElements.length,s,a,_;for(e=0;e<i;e+=1)if(s=this.comp.threeDElements[e],s.type==="3d"){a=s.perspectiveElem.style,_=s.container.style;var et=this.pe.v+"px",nt="0px 0px 0px",c="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";a.perspective=et,a.webkitPerspective=et,_.transformOrigin=nt,_.mozTransformOrigin=nt,_.webkitTransformOrigin=nt,a.transform=c,a.webkitTransform=c}},HCameraElement.prototype.createElements=function(){},HCameraElement.prototype.hide=function(){},HCameraElement.prototype.renderFrame=function(){var e=this._isFirstFrame,i,s;if(this.hierarchy)for(s=this.hierarchy.length,i=0;i<s;i+=1)e=this.hierarchy[i].finalTransform.mProp._mdf||e;if(e||this.pe._mdf||this.p&&this.p._mdf||this.px&&(this.px._mdf||this.py._mdf||this.pz._mdf)||this.rx._mdf||this.ry._mdf||this.rz._mdf||this.or._mdf||this.a&&this.a._mdf){if(this.mat.reset(),this.hierarchy)for(s=this.hierarchy.length-1,i=s;i>=0;i-=1){var a=this.hierarchy[i].finalTransform.mProp;this.mat.translate(-a.p.v[0],-a.p.v[1],a.p.v[2]),this.mat.rotateX(-a.or.v[0]).rotateY(-a.or.v[1]).rotateZ(a.or.v[2]),this.mat.rotateX(-a.rx.v).rotateY(-a.ry.v).rotateZ(a.rz.v),this.mat.scale(1/a.s.v[0],1/a.s.v[1],1/a.s.v[2]),this.mat.translate(a.a.v[0],a.a.v[1],a.a.v[2])}if(this.p?this.mat.translate(-this.p.v[0],-this.p.v[1],this.p.v[2]):this.mat.translate(-this.px.v,-this.py.v,this.pz.v),this.a){var _;this.p?_=[this.p.v[0]-this.a.v[0],this.p.v[1]-this.a.v[1],this.p.v[2]-this.a.v[2]]:_=[this.px.v-this.a.v[0],this.py.v-this.a.v[1],this.pz.v-this.a.v[2]];var et=Math.sqrt(Math.pow(_[0],2)+Math.pow(_[1],2)+Math.pow(_[2],2)),nt=[_[0]/et,_[1]/et,_[2]/et],c=Math.sqrt(nt[2]*nt[2]+nt[0]*nt[0]),ct=Math.atan2(nt[1],c),dt=Math.atan2(nt[0],-nt[2]);this.mat.rotateY(dt).rotateX(-ct)}this.mat.rotateX(-this.rx.v).rotateY(-this.ry.v).rotateZ(this.rz.v),this.mat.rotateX(-this.or.v[0]).rotateY(-this.or.v[1]).rotateZ(this.or.v[2]),this.mat.translate(this.globalData.compSize.w/2,this.globalData.compSize.h/2,0),this.mat.translate(0,0,this.pe.v);var gt=!this._prevMat.equals(this.mat);if((gt||this.pe._mdf)&&this.comp.threeDElements){s=this.comp.threeDElements.length;var Tt,Et,At;for(i=0;i<s;i+=1)if(Tt=this.comp.threeDElements[i],Tt.type==="3d"){if(gt){var Mt=this.mat.toCSS();At=Tt.container.style,At.transform=Mt,At.webkitTransform=Mt}this.pe._mdf&&(Et=Tt.perspectiveElem.style,Et.perspective=this.pe.v+"px",Et.webkitPerspective=this.pe.v+"px")}this.mat.clone(this._prevMat)}}this._isFirstFrame=!1},HCameraElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},HCameraElement.prototype.destroy=function(){},HCameraElement.prototype.getBaseElement=function(){return null};function HImageElement(e,i,s){this.assetData=i.getAssetData(e.refId),this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,HBaseElement,HSolidElement,HierarchyElement,FrameElement,RenderableElement],HImageElement),HImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData),i=new Image;this.data.hasMask?(this.imageElem=createNS("image"),this.imageElem.setAttribute("width",this.assetData.w+"px"),this.imageElem.setAttribute("height",this.assetData.h+"px"),this.imageElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.imageElem),this.baseElement.setAttribute("width",this.assetData.w),this.baseElement.setAttribute("height",this.assetData.h)):this.layerElement.appendChild(i),i.crossOrigin="anonymous",i.src=e,this.data.ln&&this.baseElement.setAttribute("id",this.data.ln)};function HybridRendererBase(e,i){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:i&&i.className||"",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(i&&i.hideOnTransparent===!1),filterSize:{width:i&&i.filterSize&&i.filterSize.width||"400%",height:i&&i.filterSize&&i.filterSize.height||"400%",x:i&&i.filterSize&&i.filterSize.x||"-100%",y:i&&i.filterSize&&i.filterSize.y||"-100%"}},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([BaseRenderer],HybridRendererBase),HybridRendererBase.prototype.buildItem=SVGRenderer.prototype.buildItem,HybridRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();e.checkParenting()}},HybridRendererBase.prototype.appendElementInPos=function(e,i){var s=e.getBaseElement();if(s){var a=this.layers[i];if(!a.ddd||!this.supports3d)if(this.threeDElements)this.addTo3dContainer(s,i);else{for(var _=0,et,nt,c;_<i;)this.elements[_]&&this.elements[_]!==!0&&this.elements[_].getBaseElement&&(nt=this.elements[_],c=this.layers[_].ddd?this.getThreeDContainerByPos(_):nt.getBaseElement(),et=c||et),_+=1;et?(!a.ddd||!this.supports3d)&&this.layerElement.insertBefore(s,et):(!a.ddd||!this.supports3d)&&this.layerElement.appendChild(s)}else this.addTo3dContainer(s,i)}},HybridRendererBase.prototype.createShape=function(e){return this.supports3d?new HShapeElement(e,this.globalData,this):new SVGShapeElement(e,this.globalData,this)},HybridRendererBase.prototype.createText=function(e){return this.supports3d?new HTextElement(e,this.globalData,this):new SVGTextLottieElement(e,this.globalData,this)},HybridRendererBase.prototype.createCamera=function(e){return this.camera=new HCameraElement(e,this.globalData,this),this.camera},HybridRendererBase.prototype.createImage=function(e){return this.supports3d?new HImageElement(e,this.globalData,this):new IImageElement(e,this.globalData,this)},HybridRendererBase.prototype.createSolid=function(e){return this.supports3d?new HSolidElement(e,this.globalData,this):new ISolidElement(e,this.globalData,this)},HybridRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,HybridRendererBase.prototype.getThreeDContainerByPos=function(e){for(var i=0,s=this.threeDElements.length;i<s;){if(this.threeDElements[i].startPos<=e&&this.threeDElements[i].endPos>=e)return this.threeDElements[i].perspectiveElem;i+=1}return null},HybridRendererBase.prototype.createThreeDContainer=function(e,i){var s=createTag("div"),a,_;styleDiv(s);var et=createTag("div");if(styleDiv(et),i==="3d"){a=s.style,a.width=this.globalData.compSize.w+"px",a.height=this.globalData.compSize.h+"px";var nt="50% 50%";a.webkitTransformOrigin=nt,a.mozTransformOrigin=nt,a.transformOrigin=nt,_=et.style;var c="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";_.transform=c,_.webkitTransform=c}s.appendChild(et);var ct={container:et,perspectiveElem:s,startPos:e,endPos:e,type:i};return this.threeDElements.push(ct),ct},HybridRendererBase.prototype.build3dContainers=function(){var e,i=this.layers.length,s,a="";for(e=0;e<i;e+=1)this.layers[e].ddd&&this.layers[e].ty!==3?(a!=="3d"&&(a="3d",s=this.createThreeDContainer(e,"3d")),s.endPos=Math.max(s.endPos,e)):(a!=="2d"&&(a="2d",s=this.createThreeDContainer(e,"2d")),s.endPos=Math.max(s.endPos,e));for(i=this.threeDElements.length,e=i-1;e>=0;e-=1)this.resizerElem.appendChild(this.threeDElements[e].perspectiveElem)},HybridRendererBase.prototype.addTo3dContainer=function(e,i){for(var s=0,a=this.threeDElements.length;s<a;){if(i<=this.threeDElements[s].endPos){for(var _=this.threeDElements[s].startPos,et;_<i;)this.elements[_]&&this.elements[_].getBaseElement&&(et=this.elements[_].getBaseElement()),_+=1;et?this.threeDElements[s].container.insertBefore(e,et):this.threeDElements[s].container.appendChild(e);break}s+=1}},HybridRendererBase.prototype.configAnimation=function(e){var i=createTag("div"),s=this.animationItem.wrapper,a=i.style;a.width=e.w+"px",a.height=e.h+"px",this.resizerElem=i,styleDiv(i),a.transformStyle="flat",a.mozTransformStyle="flat",a.webkitTransformStyle="flat",this.renderConfig.className&&i.setAttribute("class",this.renderConfig.className),s.appendChild(i),a.overflow="hidden";var _=createNS("svg");_.setAttribute("width","1"),_.setAttribute("height","1"),styleDiv(_),this.resizerElem.appendChild(_);var et=createNS("defs");_.appendChild(et),this.data=e,this.setupGlobalData(e,_),this.globalData.defs=et,this.layers=e.layers,this.layerElement=this.resizerElem,this.build3dContainers(),this.updateContainerSize()},HybridRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.animationItem.container=null,this.globalData.defs=null;var e,i=this.layers?this.layers.length:0;for(e=0;e<i;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},HybridRendererBase.prototype.updateContainerSize=function(){var e=this.animationItem.wrapper.offsetWidth,i=this.animationItem.wrapper.offsetHeight,s=e/i,a=this.globalData.compSize.w/this.globalData.compSize.h,_,et,nt,c;a>s?(_=e/this.globalData.compSize.w,et=e/this.globalData.compSize.w,nt=0,c=(i-this.globalData.compSize.h*(e/this.globalData.compSize.w))/2):(_=i/this.globalData.compSize.h,et=i/this.globalData.compSize.h,nt=(e-this.globalData.compSize.w*(i/this.globalData.compSize.h))/2,c=0);var ct=this.resizerElem.style;ct.webkitTransform="matrix3d("+_+",0,0,0,0,"+et+",0,0,0,0,1,0,"+nt+","+c+",0,1)",ct.transform=ct.webkitTransform},HybridRendererBase.prototype.renderFrame=SVGRenderer.prototype.renderFrame,HybridRendererBase.prototype.hide=function(){this.resizerElem.style.display="none"},HybridRendererBase.prototype.show=function(){this.resizerElem.style.display="block"},HybridRendererBase.prototype.initItems=function(){if(this.buildAllItems(),this.camera)this.camera.setup();else{var e=this.globalData.compSize.w,i=this.globalData.compSize.h,s,a=this.threeDElements.length;for(s=0;s<a;s+=1){var _=this.threeDElements[s].perspectiveElem.style;_.webkitPerspective=Math.sqrt(Math.pow(e,2)+Math.pow(i,2))+"px",_.perspective=_.webkitPerspective}}},HybridRendererBase.prototype.searchExtraCompositions=function(e){var i,s=e.length,a=createTag("div");for(i=0;i<s;i+=1)if(e[i].xt){var _=this.createComp(e[i],a,this.globalData.comp,null);_.initExpressions(),this.globalData.projectInterface.registerComposition(_)}};function HCompElement(e,i,s){this.layers=e.layers,this.supports3d=!e.hasMask,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,i,s),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0}}extendPrototype([HybridRendererBase,ICompElement,HBaseElement],HCompElement),HCompElement.prototype._createBaseContainerElements=HCompElement.prototype.createContainerElements,HCompElement.prototype.createContainerElements=function(){this._createBaseContainerElements(),this.data.hasMask?(this.svgElement.setAttribute("width",this.data.w),this.svgElement.setAttribute("height",this.data.h),this.transformedElement=this.baseElement):this.transformedElement=this.layerElement},HCompElement.prototype.addTo3dContainer=function(e,i){for(var s=0,a;s<i;)this.elements[s]&&this.elements[s].getBaseElement&&(a=this.elements[s].getBaseElement()),s+=1;a?this.layerElement.insertBefore(e,a):this.layerElement.appendChild(e)},HCompElement.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)};function HybridRenderer(e,i){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:i&&i.className||"",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(i&&i.hideOnTransparent===!1),filterSize:{width:i&&i.filterSize&&i.filterSize.width||"400%",height:i&&i.filterSize&&i.filterSize.height||"400%",x:i&&i.filterSize&&i.filterSize.x||"-100%",y:i&&i.filterSize&&i.filterSize.y||"-100%"},runExpressions:!i||i.runExpressions===void 0||i.runExpressions},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([HybridRendererBase],HybridRenderer),HybridRenderer.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)};var CompExpressionInterface=function(){return function(e){function i(s){for(var a=0,_=e.layers.length;a<_;){if(e.layers[a].nm===s||e.layers[a].ind===s)return e.elements[a].layerInterface;a+=1}return null}return Object.defineProperty(i,"_name",{value:e.data.nm}),i.layer=i,i.pixelAspect=1,i.height=e.data.h||e.globalData.compSize.h,i.width=e.data.w||e.globalData.compSize.w,i.pixelAspect=1,i.frameDuration=1/e.globalData.frameRate,i.displayStartTime=0,i.numLayers=e.layers.length,i}}();function _typeof$2(e){"@babel/helpers - typeof";return _typeof$2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$2(e)}function seedRandom(e,i){var s=this,a=256,_=6,et=52,nt="random",c=i.pow(a,_),ct=i.pow(2,et),dt=ct*2,gt=a-1,Tt;function Et(Nt,Vt,Xt){var nr=[];Vt=Vt===!0?{entropy:!0}:Vt||{};var ar=$t(Pt(Vt.entropy?[Nt,Bt(e)]:Nt===null?Lt():Nt,3),nr),mr=new At(nr),Fr=function(){for(var fn=mr.g(_),Lr=c,Qr=0;fn<ct;)fn=(fn+Qr)*a,Lr*=a,Qr=mr.g(1);for(;fn>=dt;)fn/=2,Lr/=2,Qr>>>=1;return(fn+Qr)/Lr};return Fr.int32=function(){return mr.g(4)|0},Fr.quick=function(){return mr.g(4)/4294967296},Fr.double=Fr,$t(Bt(mr.S),e),(Vt.pass||Xt||function(sn,fn,Lr,Qr){return Qr&&(Qr.S&&Mt(Qr,mr),sn.state=function(){return Mt(mr,{})}),Lr?(i[nt]=sn,fn):sn})(Fr,ar,"global"in Vt?Vt.global:this==i,Vt.state)}i["seed"+nt]=Et;function At(Nt){var Vt,Xt=Nt.length,nr=this,ar=0,mr=nr.i=nr.j=0,Fr=nr.S=[];for(Xt||(Nt=[Xt++]);ar<a;)Fr[ar]=ar++;for(ar=0;ar<a;ar++)Fr[ar]=Fr[mr=gt&mr+Nt[ar%Xt]+(Vt=Fr[ar])],Fr[mr]=Vt;nr.g=function(sn){for(var fn,Lr=0,Qr=nr.i,dn=nr.j,en=nr.S;sn--;)fn=en[Qr=gt&Qr+1],Lr=Lr*a+en[gt&(en[Qr]=en[dn=gt&dn+fn])+(en[dn]=fn)];return nr.i=Qr,nr.j=dn,Lr}}function Mt(Nt,Vt){return Vt.i=Nt.i,Vt.j=Nt.j,Vt.S=Nt.S.slice(),Vt}function Pt(Nt,Vt){var Xt=[],nr=_typeof$2(Nt),ar;if(Vt&&nr=="object")for(ar in Nt)try{Xt.push(Pt(Nt[ar],Vt-1))}catch{}return Xt.length?Xt:nr=="string"?Nt:Nt+"\0"}function $t(Nt,Vt){for(var Xt=Nt+"",nr,ar=0;ar<Xt.length;)Vt[gt&ar]=gt&(nr^=Vt[gt&ar]*19)+Xt.charCodeAt(ar++);return Bt(Vt)}function Lt(){try{var Nt=new Uint8Array(a);return(s.crypto||s.msCrypto).getRandomValues(Nt),Bt(Nt)}catch{var Vt=s.navigator,Xt=Vt&&Vt.plugins;return[+new Date,s,Xt,s.screen,Bt(e)]}}function Bt(Nt){return String.fromCharCode.apply(0,Nt)}$t(i.random(),e)}function initialize$2(e){seedRandom([],e)}var propTypes={SHAPE:"shape"};function _typeof$1(e){"@babel/helpers - typeof";return _typeof$1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$1(e)}var ExpressionManager=function(){var ob={},Math=BMMath,window=null,document=null,XMLHttpRequest=null,fetch=null,frames=null,_lottieGlobal={};initialize$2(BMMath);function resetFrame(){_lottieGlobal={}}function $bm_isInstanceOfArray(e){return e.constructor===Array||e.constructor===Float32Array}function isNumerable(e,i){return e==="number"||i instanceof Number||e==="boolean"||e==="string"}function $bm_neg(e){var i=_typeof$1(e);if(i==="number"||e instanceof Number||i==="boolean")return-e;if($bm_isInstanceOfArray(e)){var s,a=e.length,_=[];for(s=0;s<a;s+=1)_[s]=-e[s];return _}return e.propType?e.v:-e}var easeInBez=BezierFactory.getBezierEasing(.333,0,.833,.833,"easeIn").get,easeOutBez=BezierFactory.getBezierEasing(.167,.167,.667,1,"easeOut").get,easeInOutBez=BezierFactory.getBezierEasing(.33,0,.667,1,"easeInOut").get;function sum(e,i){var s=_typeof$1(e),a=_typeof$1(i);if(isNumerable(s,e)&&isNumerable(a,i)||s==="string"||a==="string")return e+i;if($bm_isInstanceOfArray(e)&&isNumerable(a,i))return e=e.slice(0),e[0]+=i,e;if(isNumerable(s,e)&&$bm_isInstanceOfArray(i))return i=i.slice(0),i[0]=e+i[0],i;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(i)){for(var _=0,et=e.length,nt=i.length,c=[];_<et||_<nt;)(typeof e[_]=="number"||e[_]instanceof Number)&&(typeof i[_]=="number"||i[_]instanceof Number)?c[_]=e[_]+i[_]:c[_]=i[_]===void 0?e[_]:e[_]||i[_],_+=1;return c}return 0}var add=sum;function sub(e,i){var s=_typeof$1(e),a=_typeof$1(i);if(isNumerable(s,e)&&isNumerable(a,i))return s==="string"&&(e=parseInt(e,10)),a==="string"&&(i=parseInt(i,10)),e-i;if($bm_isInstanceOfArray(e)&&isNumerable(a,i))return e=e.slice(0),e[0]-=i,e;if(isNumerable(s,e)&&$bm_isInstanceOfArray(i))return i=i.slice(0),i[0]=e-i[0],i;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(i)){for(var _=0,et=e.length,nt=i.length,c=[];_<et||_<nt;)(typeof e[_]=="number"||e[_]instanceof Number)&&(typeof i[_]=="number"||i[_]instanceof Number)?c[_]=e[_]-i[_]:c[_]=i[_]===void 0?e[_]:e[_]||i[_],_+=1;return c}return 0}function mul(e,i){var s=_typeof$1(e),a=_typeof$1(i),_;if(isNumerable(s,e)&&isNumerable(a,i))return e*i;var et,nt;if($bm_isInstanceOfArray(e)&&isNumerable(a,i)){for(nt=e.length,_=createTypedArray("float32",nt),et=0;et<nt;et+=1)_[et]=e[et]*i;return _}if(isNumerable(s,e)&&$bm_isInstanceOfArray(i)){for(nt=i.length,_=createTypedArray("float32",nt),et=0;et<nt;et+=1)_[et]=e*i[et];return _}return 0}function div(e,i){var s=_typeof$1(e),a=_typeof$1(i),_;if(isNumerable(s,e)&&isNumerable(a,i))return e/i;var et,nt;if($bm_isInstanceOfArray(e)&&isNumerable(a,i)){for(nt=e.length,_=createTypedArray("float32",nt),et=0;et<nt;et+=1)_[et]=e[et]/i;return _}if(isNumerable(s,e)&&$bm_isInstanceOfArray(i)){for(nt=i.length,_=createTypedArray("float32",nt),et=0;et<nt;et+=1)_[et]=e/i[et];return _}return 0}function mod(e,i){return typeof e=="string"&&(e=parseInt(e,10)),typeof i=="string"&&(i=parseInt(i,10)),e%i}var $bm_sum=sum,$bm_sub=sub,$bm_mul=mul,$bm_div=div,$bm_mod=mod;function clamp(e,i,s){if(i>s){var a=s;s=i,i=a}return Math.min(Math.max(e,i),s)}function radiansToDegrees(e){return e/degToRads}var radians_to_degrees=radiansToDegrees;function degreesToRadians(e){return e*degToRads}var degrees_to_radians=radiansToDegrees,helperLengthArray=[0,0,0,0,0,0];function length(e,i){if(typeof e=="number"||e instanceof Number)return i=i||0,Math.abs(e-i);i||(i=helperLengthArray);var s,a=Math.min(e.length,i.length),_=0;for(s=0;s<a;s+=1)_+=Math.pow(i[s]-e[s],2);return Math.sqrt(_)}function normalize(e){return div(e,length(e))}function rgbToHsl(e){var i=e[0],s=e[1],a=e[2],_=Math.max(i,s,a),et=Math.min(i,s,a),nt,c,ct=(_+et)/2;if(_===et)nt=0,c=0;else{var dt=_-et;switch(c=ct>.5?dt/(2-_-et):dt/(_+et),_){case i:nt=(s-a)/dt+(s<a?6:0);break;case s:nt=(a-i)/dt+2;break;case a:nt=(i-s)/dt+4;break}nt/=6}return[nt,c,ct,e[3]]}function hue2rgb(e,i,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+(i-e)*6*s:s<1/2?i:s<2/3?e+(i-e)*(2/3-s)*6:e}function hslToRgb(e){var i=e[0],s=e[1],a=e[2],_,et,nt;if(s===0)_=a,nt=a,et=a;else{var c=a<.5?a*(1+s):a+s-a*s,ct=2*a-c;_=hue2rgb(ct,c,i+1/3),et=hue2rgb(ct,c,i),nt=hue2rgb(ct,c,i-1/3)}return[_,et,nt,e[3]]}function linear(e,i,s,a,_){if((a===void 0||_===void 0)&&(a=i,_=s,i=0,s=1),s<i){var et=s;s=i,i=et}if(e<=i)return a;if(e>=s)return _;var nt=s===i?0:(e-i)/(s-i);if(!a.length)return a+(_-a)*nt;var c,ct=a.length,dt=createTypedArray("float32",ct);for(c=0;c<ct;c+=1)dt[c]=a[c]+(_[c]-a[c])*nt;return dt}function random(e,i){if(i===void 0&&(e===void 0?(e=0,i=1):(i=e,e=void 0)),i.length){var s,a=i.length;e||(e=createTypedArray("float32",a));var _=createTypedArray("float32",a),et=BMMath.random();for(s=0;s<a;s+=1)_[s]=e[s]+et*(i[s]-e[s]);return _}e===void 0&&(e=0);var nt=BMMath.random();return e+nt*(i-e)}function createPath(e,i,s,a){var _,et=e.length,nt=shapePool.newElement();nt.setPathData(!!a,et);var c=[0,0],ct,dt;for(_=0;_<et;_+=1)ct=i&&i[_]?i[_]:c,dt=s&&s[_]?s[_]:c,nt.setTripleAt(e[_][0],e[_][1],dt[0]+e[_][0],dt[1]+e[_][1],ct[0]+e[_][0],ct[1]+e[_][1],_,!0);return nt}function initiateExpression(elem,data,property){function noOp(e){return e}if(!elem.globalData.renderConfig.runExpressions)return noOp;var val=data.x,needsVelocity=/velocity(?![\w\d])/.test(val),_needsRandom=val.indexOf("random")!==-1,elemType=elem.data.ty,transform,$bm_transform,content,effect,thisProperty=property;thisProperty._name=elem.data.nm,thisProperty.valueAtTime=thisProperty.getValueAtTime,Object.defineProperty(thisProperty,"value",{get:function(){return thisProperty.v}}),elem.comp.frameDuration=1/elem.comp.globalData.frameRate,elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate,outPoint=elem.data.op/elem.comp.globalData.frameRate,width=elem.data.sw?elem.data.sw:0,height=elem.data.sh?elem.data.sh:0,name=elem.data.nm,loopIn,loop_in,loopOut,loop_out,smooth,toWorld,fromWorld,fromComp,toComp,fromCompToSurface,position,rotation,anchorPoint,scale,thisLayer,thisComp,mask,valueAtTime,velocityAtTime,scoped_bm_rt,expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}]")[0],numKeys=property.kf?data.k.length:0,active=!this.data||this.data.hd!==!0,wiggle=(function e(i,s){var a,_,et=this.pv.length?this.pv.length:1,nt=createTypedArray("float32",et);i=5;var c=Math.floor(time*i);for(a=0,_=0;a<c;){for(_=0;_<et;_+=1)nt[_]+=-s+s*2*BMMath.random();a+=1}var ct=time*i,dt=ct-Math.floor(ct),gt=createTypedArray("float32",et);if(et>1){for(_=0;_<et;_+=1)gt[_]=this.pv[_]+nt[_]+(-s+s*2*BMMath.random())*dt;return gt}return this.pv+nt[0]+(-s+s*2*BMMath.random())*dt}).bind(this);thisProperty.loopIn&&(loopIn=thisProperty.loopIn.bind(thisProperty),loop_in=loopIn),thisProperty.loopOut&&(loopOut=thisProperty.loopOut.bind(thisProperty),loop_out=loopOut),thisProperty.smooth&&(smooth=thisProperty.smooth.bind(thisProperty));function loopInDuration(e,i){return loopIn(e,i,!0)}function loopOutDuration(e,i){return loopOut(e,i,!0)}this.getValueAtTime&&(valueAtTime=this.getValueAtTime.bind(this)),this.getVelocityAtTime&&(velocityAtTime=this.getVelocityAtTime.bind(this));var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface);function lookAt(e,i){var s=[i[0]-e[0],i[1]-e[1],i[2]-e[2]],a=Math.atan2(s[0],Math.sqrt(s[1]*s[1]+s[2]*s[2]))/degToRads,_=-Math.atan2(s[1],s[2])/degToRads;return[_,a,0]}function easeOut(e,i,s,a,_){return applyEase(easeOutBez,e,i,s,a,_)}function easeIn(e,i,s,a,_){return applyEase(easeInBez,e,i,s,a,_)}function ease(e,i,s,a,_){return applyEase(easeInOutBez,e,i,s,a,_)}function applyEase(e,i,s,a,_,et){_===void 0?(_=s,et=a):i=(i-s)/(a-s),i>1?i=1:i<0&&(i=0);var nt=e(i);if($bm_isInstanceOfArray(_)){var c,ct=_.length,dt=createTypedArray("float32",ct);for(c=0;c<ct;c+=1)dt[c]=(et[c]-_[c])*nt+_[c];return dt}return(et-_)*nt+_}function nearestKey(e){var i,s=data.k.length,a,_;if(!data.k.length||typeof data.k[0]=="number")a=0,_=0;else if(a=-1,e*=elem.comp.globalData.frameRate,e<data.k[0].t)a=1,_=data.k[0].t;else{for(i=0;i<s-1;i+=1)if(e===data.k[i].t){a=i+1,_=data.k[i].t;break}else if(e>data.k[i].t&&e<data.k[i+1].t){e-data.k[i].t>data.k[i+1].t-e?(a=i+2,_=data.k[i+1].t):(a=i+1,_=data.k[i].t);break}a===-1&&(a=i+1,_=data.k[i].t)}var et={};return et.index=a,et.time=_/elem.comp.globalData.frameRate,et}function key(e){var i,s,a;if(!data.k.length||typeof data.k[0]=="number")throw new Error("The property has no keyframe at index "+e);e-=1,i={time:data.k[e].t/elem.comp.globalData.frameRate,value:[]};var _=Object.prototype.hasOwnProperty.call(data.k[e],"s")?data.k[e].s:data.k[e-1].e;for(a=_.length,s=0;s<a;s+=1)i[s]=_[s],i.value[s]=_[s];return i}function framesToTime(e,i){return i||(i=elem.comp.globalData.frameRate),e/i}function timeToFrames(e,i){return!e&&e!==0&&(e=time),i||(i=elem.comp.globalData.frameRate),e*i}function seedRandom(e){BMMath.seedrandom(randSeed+e)}function sourceRectAtTime(){return elem.sourceRectAtTime()}function substring(e,i){return typeof value=="string"?i===void 0?value.substring(e):value.substring(e,i):""}function substr(e,i){return typeof value=="string"?i===void 0?value.substr(e):value.substr(e,i):""}function posterizeTime(e){time=e===0?0:Math.floor(time*e)/e,value=valueAtTime(time)}var time,velocity,value,text,textIndex,textTotal,selectorValue,index=elem.data.ind,hasParent=!!(elem.hierarchy&&elem.hierarchy.length),parent,randSeed=Math.floor(Math.random()*1e6),globalData=elem.globalData;function executeExpression(e){return value=e,this.frameExpressionId===elem.globalData.frameId&&this.propType!=="textSelector"?value:(this.propType==="textSelector"&&(textIndex=this.textIndex,textTotal=this.textTotal,selectorValue=this.selectorValue),thisLayer||(text=elem.layerInterface.text,thisLayer=elem.layerInterface,thisComp=elem.comp.compInterface,toWorld=thisLayer.toWorld.bind(thisLayer),fromWorld=thisLayer.fromWorld.bind(thisLayer),fromComp=thisLayer.fromComp.bind(thisLayer),toComp=thisLayer.toComp.bind(thisLayer),mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null,fromCompToSurface=fromComp),transform||(transform=elem.layerInterface("ADBE Transform Group"),$bm_transform=transform,transform&&(anchorPoint=transform.anchorPoint)),elemType===4&&!content&&(content=thisLayer("ADBE Root Vectors Group")),effect||(effect=thisLayer(4)),hasParent=!!(elem.hierarchy&&elem.hierarchy.length),hasParent&&!parent&&(parent=elem.hierarchy[0].layerInterface),time=this.comp.renderedFrame/this.comp.globalData.frameRate,_needsRandom&&seedRandom(randSeed+time),needsVelocity&&(velocity=velocityAtTime(time)),expression_function(),this.frameExpressionId=elem.globalData.frameId,scoped_bm_rt=scoped_bm_rt.propType===propTypes.SHAPE?scoped_bm_rt.v:scoped_bm_rt,scoped_bm_rt)}return executeExpression.__preventDeadCodeRemoval=[$bm_transform,anchorPoint,time,velocity,inPoint,outPoint,width,height,name,loop_in,loop_out,smooth,toComp,fromCompToSurface,toWorld,fromWorld,mask,position,rotation,scale,thisComp,numKeys,active,wiggle,loopInDuration,loopOutDuration,comp,lookAt,easeOut,easeIn,ease,nearestKey,key,text,textIndex,textTotal,selectorValue,framesToTime,timeToFrames,sourceRectAtTime,substring,substr,posterizeTime,index,globalData],executeExpression}return ob.initiateExpression=initiateExpression,ob.__preventDeadCodeRemoval=[window,document,XMLHttpRequest,fetch,frames,$bm_neg,add,$bm_sum,$bm_sub,$bm_mul,$bm_div,$bm_mod,clamp,radians_to_degrees,degreesToRadians,degrees_to_radians,normalize,rgbToHsl,hslToRgb,linear,random,createPath,_lottieGlobal],ob.resetFrame=resetFrame,ob}(),Expressions=function(){var e={};e.initExpressions=i,e.resetFrame=ExpressionManager.resetFrame;function i(s){var a=0,_=[];function et(){a+=1}function nt(){a-=1,a===0&&ct()}function c(dt){_.indexOf(dt)===-1&&_.push(dt)}function ct(){var dt,gt=_.length;for(dt=0;dt<gt;dt+=1)_[dt].release();_.length=0}s.renderer.compInterface=CompExpressionInterface(s.renderer),s.renderer.globalData.projectInterface.registerComposition(s.renderer),s.renderer.globalData.pushExpression=et,s.renderer.globalData.popExpression=nt,s.renderer.globalData.registerExpressionProperty=c}return e}(),MaskManagerInterface=function(){function e(s,a){this._mask=s,this._data=a}Object.defineProperty(e.prototype,"maskPath",{get:function(){return this._mask.prop.k&&this._mask.prop.getValue(),this._mask.prop}}),Object.defineProperty(e.prototype,"maskOpacity",{get:function(){return this._mask.op.k&&this._mask.op.getValue(),this._mask.op.v*100}});var i=function(a){var _=createSizedArray(a.viewData.length),et,nt=a.viewData.length;for(et=0;et<nt;et+=1)_[et]=new e(a.viewData[et],a.masksProperties[et]);var c=function(dt){for(et=0;et<nt;){if(a.masksProperties[et].nm===dt)return _[et];et+=1}return null};return c};return i}(),ExpressionPropertyInterface=function(){var e={pv:0,v:0,mult:1},i={pv:[0,0,0],v:[0,0,0],mult:1};function s(nt,c,ct){Object.defineProperty(nt,"velocity",{get:function(){return c.getVelocityAtTime(c.comp.currentFrame)}}),nt.numKeys=c.keyframes?c.keyframes.length:0,nt.key=function(dt){if(!nt.numKeys)return 0;var gt="";"s"in c.keyframes[dt-1]?gt=c.keyframes[dt-1].s:"e"in c.keyframes[dt-2]?gt=c.keyframes[dt-2].e:gt=c.keyframes[dt-2].s;var Tt=ct==="unidimensional"?new Number(gt):Object.assign({},gt);return Tt.time=c.keyframes[dt-1].t/c.elem.comp.globalData.frameRate,Tt.value=ct==="unidimensional"?gt[0]:gt,Tt},nt.valueAtTime=c.getValueAtTime,nt.speedAtTime=c.getSpeedAtTime,nt.velocityAtTime=c.getVelocityAtTime,nt.propertyGroup=c.propertyGroup}function a(nt){(!nt||!("pv"in nt))&&(nt=e);var c=1/nt.mult,ct=nt.pv*c,dt=new Number(ct);return dt.value=ct,s(dt,nt,"unidimensional"),function(){return nt.k&&nt.getValue(),ct=nt.v*c,dt.value!==ct&&(dt=new Number(ct),dt.value=ct,dt[0]=ct,s(dt,nt,"unidimensional")),dt}}function _(nt){(!nt||!("pv"in nt))&&(nt=i);var c=1/nt.mult,ct=nt.data&&nt.data.l||nt.pv.length,dt=createTypedArray("float32",ct),gt=createTypedArray("float32",ct);return dt.value=gt,s(dt,nt,"multidimensional"),function(){nt.k&&nt.getValue();for(var Tt=0;Tt<ct;Tt+=1)gt[Tt]=nt.v[Tt]*c,dt[Tt]=gt[Tt];return dt}}function et(){return e}return function(nt){return nt?nt.propType==="unidimensional"?a(nt):_(nt):et}}(),TransformExpressionInterface=function(){return function(e){function i(nt){switch(nt){case"scale":case"Scale":case"ADBE Scale":case 6:return i.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return i.rotation;case"ADBE Rotate X":return i.xRotation;case"ADBE Rotate Y":return i.yRotation;case"position":case"Position":case"ADBE Position":case 2:return i.position;case"ADBE Position_0":return i.xPosition;case"ADBE Position_1":return i.yPosition;case"ADBE Position_2":return i.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return i.anchorPoint;case"opacity":case"Opacity":case 11:return i.opacity;default:return null}}Object.defineProperty(i,"rotation",{get:ExpressionPropertyInterface(e.r||e.rz)}),Object.defineProperty(i,"zRotation",{get:ExpressionPropertyInterface(e.rz||e.r)}),Object.defineProperty(i,"xRotation",{get:ExpressionPropertyInterface(e.rx)}),Object.defineProperty(i,"yRotation",{get:ExpressionPropertyInterface(e.ry)}),Object.defineProperty(i,"scale",{get:ExpressionPropertyInterface(e.s)});var s,a,_,et;return e.p?et=ExpressionPropertyInterface(e.p):(s=ExpressionPropertyInterface(e.px),a=ExpressionPropertyInterface(e.py),e.pz&&(_=ExpressionPropertyInterface(e.pz))),Object.defineProperty(i,"position",{get:function(){return e.p?et():[s(),a(),_?_():0]}}),Object.defineProperty(i,"xPosition",{get:ExpressionPropertyInterface(e.px)}),Object.defineProperty(i,"yPosition",{get:ExpressionPropertyInterface(e.py)}),Object.defineProperty(i,"zPosition",{get:ExpressionPropertyInterface(e.pz)}),Object.defineProperty(i,"anchorPoint",{get:ExpressionPropertyInterface(e.a)}),Object.defineProperty(i,"opacity",{get:ExpressionPropertyInterface(e.o)}),Object.defineProperty(i,"skew",{get:ExpressionPropertyInterface(e.sk)}),Object.defineProperty(i,"skewAxis",{get:ExpressionPropertyInterface(e.sa)}),Object.defineProperty(i,"orientation",{get:ExpressionPropertyInterface(e.or)}),i}}(),LayerExpressionInterface=function(){function e(dt){var gt=new Matrix;if(dt!==void 0){var Tt=this._elem.finalTransform.mProp.getValueAtTime(dt);Tt.clone(gt)}else{var Et=this._elem.finalTransform.mProp;Et.applyToMatrix(gt)}return gt}function i(dt,gt){var Tt=this.getMatrix(gt);return Tt.props[12]=0,Tt.props[13]=0,Tt.props[14]=0,this.applyPoint(Tt,dt)}function s(dt,gt){var Tt=this.getMatrix(gt);return this.applyPoint(Tt,dt)}function a(dt,gt){var Tt=this.getMatrix(gt);return Tt.props[12]=0,Tt.props[13]=0,Tt.props[14]=0,this.invertPoint(Tt,dt)}function _(dt,gt){var Tt=this.getMatrix(gt);return this.invertPoint(Tt,dt)}function et(dt,gt){if(this._elem.hierarchy&&this._elem.hierarchy.length){var Tt,Et=this._elem.hierarchy.length;for(Tt=0;Tt<Et;Tt+=1)this._elem.hierarchy[Tt].finalTransform.mProp.applyToMatrix(dt)}return dt.applyToPointArray(gt[0],gt[1],gt[2]||0)}function nt(dt,gt){if(this._elem.hierarchy&&this._elem.hierarchy.length){var Tt,Et=this._elem.hierarchy.length;for(Tt=0;Tt<Et;Tt+=1)this._elem.hierarchy[Tt].finalTransform.mProp.applyToMatrix(dt)}return dt.inversePoint(gt)}function c(dt){var gt=new Matrix;if(gt.reset(),this._elem.finalTransform.mProp.applyToMatrix(gt),this._elem.hierarchy&&this._elem.hierarchy.length){var Tt,Et=this._elem.hierarchy.length;for(Tt=0;Tt<Et;Tt+=1)this._elem.hierarchy[Tt].finalTransform.mProp.applyToMatrix(gt);return gt.inversePoint(dt)}return gt.inversePoint(dt)}function ct(){return[1,1,1,1]}return function(dt){var gt;function Tt(Pt){At.mask=new MaskManagerInterface(Pt,dt)}function Et(Pt){At.effect=Pt}function At(Pt){switch(Pt){case"ADBE Root Vectors Group":case"Contents":case 2:return At.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return gt;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return At.effect;case"ADBE Text Properties":return At.textInterface;default:return null}}At.getMatrix=e,At.invertPoint=nt,At.applyPoint=et,At.toWorld=s,At.toWorldVec=i,At.fromWorld=_,At.fromWorldVec=a,At.toComp=s,At.fromComp=c,At.sampleImage=ct,At.sourceRectAtTime=dt.sourceRectAtTime.bind(dt),At._elem=dt,gt=TransformExpressionInterface(dt.finalTransform.mProp);var Mt=getDescriptor(gt,"anchorPoint");return Object.defineProperties(At,{hasParent:{get:function(){return dt.hierarchy.length}},parent:{get:function(){return dt.hierarchy[0].layerInterface}},rotation:getDescriptor(gt,"rotation"),scale:getDescriptor(gt,"scale"),position:getDescriptor(gt,"position"),opacity:getDescriptor(gt,"opacity"),anchorPoint:Mt,anchor_point:Mt,transform:{get:function(){return gt}},active:{get:function(){return dt.isInRange}}}),At.startTime=dt.data.st,At.index=dt.data.ind,At.source=dt.data.refId,At.height=dt.data.ty===0?dt.data.h:100,At.width=dt.data.ty===0?dt.data.w:100,At.inPoint=dt.data.ip/dt.comp.globalData.frameRate,At.outPoint=dt.data.op/dt.comp.globalData.frameRate,At._name=dt.data.nm,At.registerMaskInterface=Tt,At.registerEffectsInterface=Et,At}}(),propertyGroupFactory=function(){return function(e,i){return function(s){return s=s===void 0?1:s,s<=0?e:i(s-1)}}}(),PropertyInterface=function(){return function(e,i){var s={_name:e};function a(_){return _=_===void 0?1:_,_<=0?s:i(_-1)}return a}}(),EffectsExpressionInterface=function(){var e={createEffectsInterface:i};function i(_,et){if(_.effectsManager){var nt=[],c=_.data.ef,ct,dt=_.effectsManager.effectElements.length;for(ct=0;ct<dt;ct+=1)nt.push(s(c[ct],_.effectsManager.effectElements[ct],et,_));var gt=_.data.ef||[],Tt=function(At){for(ct=0,dt=gt.length;ct<dt;){if(At===gt[ct].nm||At===gt[ct].mn||At===gt[ct].ix)return nt[ct];ct+=1}return null};return Object.defineProperty(Tt,"numProperties",{get:function(){return gt.length}}),Tt}return null}function s(_,et,nt,c){function ct(At){for(var Mt=_.ef,Pt=0,$t=Mt.length;Pt<$t;){if(At===Mt[Pt].nm||At===Mt[Pt].mn||At===Mt[Pt].ix)return Mt[Pt].ty===5?gt[Pt]:gt[Pt]();Pt+=1}throw new Error}var dt=propertyGroupFactory(ct,nt),gt=[],Tt,Et=_.ef.length;for(Tt=0;Tt<Et;Tt+=1)_.ef[Tt].ty===5?gt.push(s(_.ef[Tt],et.effectElements[Tt],et.effectElements[Tt].propertyGroup,c)):gt.push(a(et.effectElements[Tt],_.ef[Tt].ty,c,dt));return _.mn==="ADBE Color Control"&&Object.defineProperty(ct,"color",{get:function(){return gt[0]()}}),Object.defineProperties(ct,{numProperties:{get:function(){return _.np}},_name:{value:_.nm},propertyGroup:{value:dt}}),ct.enabled=_.en!==0,ct.active=ct.enabled,ct}function a(_,et,nt,c){var ct=ExpressionPropertyInterface(_.p);function dt(){return et===10?nt.comp.compInterface(_.p.v):ct()}return _.p.setGroupProperty&&_.p.setGroupProperty(PropertyInterface("",c)),dt}return e}(),ShapePathInterface=function(){return function(i,s,a){var _=s.sh;function et(c){return c==="Shape"||c==="shape"||c==="Path"||c==="path"||c==="ADBE Vector Shape"||c===2?et.path:null}var nt=propertyGroupFactory(et,a);return _.setGroupProperty(PropertyInterface("Path",nt)),Object.defineProperties(et,{path:{get:function(){return _.k&&_.getValue(),_}},shape:{get:function(){return _.k&&_.getValue(),_}},_name:{value:i.nm},ix:{value:i.ix},propertyIndex:{value:i.ix},mn:{value:i.mn},propertyGroup:{value:a}}),et}}(),ShapeExpressionInterface=function(){function e(Mt,Pt,$t){var Lt=[],Bt,Nt=Mt?Mt.length:0;for(Bt=0;Bt<Nt;Bt+=1)Mt[Bt].ty==="gr"?Lt.push(s(Mt[Bt],Pt[Bt],$t)):Mt[Bt].ty==="fl"?Lt.push(a(Mt[Bt],Pt[Bt],$t)):Mt[Bt].ty==="st"?Lt.push(nt(Mt[Bt],Pt[Bt],$t)):Mt[Bt].ty==="tm"?Lt.push(c(Mt[Bt],Pt[Bt],$t)):Mt[Bt].ty==="tr"||(Mt[Bt].ty==="el"?Lt.push(dt(Mt[Bt],Pt[Bt],$t)):Mt[Bt].ty==="sr"?Lt.push(gt(Mt[Bt],Pt[Bt],$t)):Mt[Bt].ty==="sh"?Lt.push(ShapePathInterface(Mt[Bt],Pt[Bt],$t)):Mt[Bt].ty==="rc"?Lt.push(Tt(Mt[Bt],Pt[Bt],$t)):Mt[Bt].ty==="rd"?Lt.push(Et(Mt[Bt],Pt[Bt],$t)):Mt[Bt].ty==="rp"?Lt.push(At(Mt[Bt],Pt[Bt],$t)):Mt[Bt].ty==="gf"?Lt.push(_(Mt[Bt],Pt[Bt],$t)):Lt.push(et(Mt[Bt],Pt[Bt])));return Lt}function i(Mt,Pt,$t){var Lt,Bt=function(Xt){for(var nr=0,ar=Lt.length;nr<ar;){if(Lt[nr]._name===Xt||Lt[nr].mn===Xt||Lt[nr].propertyIndex===Xt||Lt[nr].ix===Xt||Lt[nr].ind===Xt)return Lt[nr];nr+=1}return typeof Xt=="number"?Lt[Xt-1]:null};Bt.propertyGroup=propertyGroupFactory(Bt,$t),Lt=e(Mt.it,Pt.it,Bt.propertyGroup),Bt.numProperties=Lt.length;var Nt=ct(Mt.it[Mt.it.length-1],Pt.it[Pt.it.length-1],Bt.propertyGroup);return Bt.transform=Nt,Bt.propertyIndex=Mt.cix,Bt._name=Mt.nm,Bt}function s(Mt,Pt,$t){var Lt=function(Xt){switch(Xt){case"ADBE Vectors Group":case"Contents":case 2:return Lt.content;default:return Lt.transform}};Lt.propertyGroup=propertyGroupFactory(Lt,$t);var Bt=i(Mt,Pt,Lt.propertyGroup),Nt=ct(Mt.it[Mt.it.length-1],Pt.it[Pt.it.length-1],Lt.propertyGroup);return Lt.content=Bt,Lt.transform=Nt,Object.defineProperty(Lt,"_name",{get:function(){return Mt.nm}}),Lt.numProperties=Mt.np,Lt.propertyIndex=Mt.ix,Lt.nm=Mt.nm,Lt.mn=Mt.mn,Lt}function a(Mt,Pt,$t){function Lt(Bt){return Bt==="Color"||Bt==="color"?Lt.color:Bt==="Opacity"||Bt==="opacity"?Lt.opacity:null}return Object.defineProperties(Lt,{color:{get:ExpressionPropertyInterface(Pt.c)},opacity:{get:ExpressionPropertyInterface(Pt.o)},_name:{value:Mt.nm},mn:{value:Mt.mn}}),Pt.c.setGroupProperty(PropertyInterface("Color",$t)),Pt.o.setGroupProperty(PropertyInterface("Opacity",$t)),Lt}function _(Mt,Pt,$t){function Lt(Bt){return Bt==="Start Point"||Bt==="start point"?Lt.startPoint:Bt==="End Point"||Bt==="end point"?Lt.endPoint:Bt==="Opacity"||Bt==="opacity"?Lt.opacity:null}return Object.defineProperties(Lt,{startPoint:{get:ExpressionPropertyInterface(Pt.s)},endPoint:{get:ExpressionPropertyInterface(Pt.e)},opacity:{get:ExpressionPropertyInterface(Pt.o)},type:{get:function(){return"a"}},_name:{value:Mt.nm},mn:{value:Mt.mn}}),Pt.s.setGroupProperty(PropertyInterface("Start Point",$t)),Pt.e.setGroupProperty(PropertyInterface("End Point",$t)),Pt.o.setGroupProperty(PropertyInterface("Opacity",$t)),Lt}function et(){function Mt(){return null}return Mt}function nt(Mt,Pt,$t){var Lt=propertyGroupFactory(ar,$t),Bt=propertyGroupFactory(nr,Lt);function Nt(mr){Object.defineProperty(nr,Mt.d[mr].nm,{get:ExpressionPropertyInterface(Pt.d.dataProps[mr].p)})}var Vt,Xt=Mt.d?Mt.d.length:0,nr={};for(Vt=0;Vt<Xt;Vt+=1)Nt(Vt),Pt.d.dataProps[Vt].p.setGroupProperty(Bt);function ar(mr){return mr==="Color"||mr==="color"?ar.color:mr==="Opacity"||mr==="opacity"?ar.opacity:mr==="Stroke Width"||mr==="stroke width"?ar.strokeWidth:null}return Object.defineProperties(ar,{color:{get:ExpressionPropertyInterface(Pt.c)},opacity:{get:ExpressionPropertyInterface(Pt.o)},strokeWidth:{get:ExpressionPropertyInterface(Pt.w)},dash:{get:function(){return nr}},_name:{value:Mt.nm},mn:{value:Mt.mn}}),Pt.c.setGroupProperty(PropertyInterface("Color",Lt)),Pt.o.setGroupProperty(PropertyInterface("Opacity",Lt)),Pt.w.setGroupProperty(PropertyInterface("Stroke Width",Lt)),ar}function c(Mt,Pt,$t){function Lt(Nt){return Nt===Mt.e.ix||Nt==="End"||Nt==="end"?Lt.end:Nt===Mt.s.ix?Lt.start:Nt===Mt.o.ix?Lt.offset:null}var Bt=propertyGroupFactory(Lt,$t);return Lt.propertyIndex=Mt.ix,Pt.s.setGroupProperty(PropertyInterface("Start",Bt)),Pt.e.setGroupProperty(PropertyInterface("End",Bt)),Pt.o.setGroupProperty(PropertyInterface("Offset",Bt)),Lt.propertyIndex=Mt.ix,Lt.propertyGroup=$t,Object.defineProperties(Lt,{start:{get:ExpressionPropertyInterface(Pt.s)},end:{get:ExpressionPropertyInterface(Pt.e)},offset:{get:ExpressionPropertyInterface(Pt.o)},_name:{value:Mt.nm}}),Lt.mn=Mt.mn,Lt}function ct(Mt,Pt,$t){function Lt(Nt){return Mt.a.ix===Nt||Nt==="Anchor Point"?Lt.anchorPoint:Mt.o.ix===Nt||Nt==="Opacity"?Lt.opacity:Mt.p.ix===Nt||Nt==="Position"?Lt.position:Mt.r.ix===Nt||Nt==="Rotation"||Nt==="ADBE Vector Rotation"?Lt.rotation:Mt.s.ix===Nt||Nt==="Scale"?Lt.scale:Mt.sk&&Mt.sk.ix===Nt||Nt==="Skew"?Lt.skew:Mt.sa&&Mt.sa.ix===Nt||Nt==="Skew Axis"?Lt.skewAxis:null}var Bt=propertyGroupFactory(Lt,$t);return Pt.transform.mProps.o.setGroupProperty(PropertyInterface("Opacity",Bt)),Pt.transform.mProps.p.setGroupProperty(PropertyInterface("Position",Bt)),Pt.transform.mProps.a.setGroupProperty(PropertyInterface("Anchor Point",Bt)),Pt.transform.mProps.s.setGroupProperty(PropertyInterface("Scale",Bt)),Pt.transform.mProps.r.setGroupProperty(PropertyInterface("Rotation",Bt)),Pt.transform.mProps.sk&&(Pt.transform.mProps.sk.setGroupProperty(PropertyInterface("Skew",Bt)),Pt.transform.mProps.sa.setGroupProperty(PropertyInterface("Skew Angle",Bt))),Pt.transform.op.setGroupProperty(PropertyInterface("Opacity",Bt)),Object.defineProperties(Lt,{opacity:{get:ExpressionPropertyInterface(Pt.transform.mProps.o)},position:{get:ExpressionPropertyInterface(Pt.transform.mProps.p)},anchorPoint:{get:ExpressionPropertyInterface(Pt.transform.mProps.a)},scale:{get:ExpressionPropertyInterface(Pt.transform.mProps.s)},rotation:{get:ExpressionPropertyInterface(Pt.transform.mProps.r)},skew:{get:ExpressionPropertyInterface(Pt.transform.mProps.sk)},skewAxis:{get:ExpressionPropertyInterface(Pt.transform.mProps.sa)},_name:{value:Mt.nm}}),Lt.ty="tr",Lt.mn=Mt.mn,Lt.propertyGroup=$t,Lt}function dt(Mt,Pt,$t){function Lt(Vt){return Mt.p.ix===Vt?Lt.position:Mt.s.ix===Vt?Lt.size:null}var Bt=propertyGroupFactory(Lt,$t);Lt.propertyIndex=Mt.ix;var Nt=Pt.sh.ty==="tm"?Pt.sh.prop:Pt.sh;return Nt.s.setGroupProperty(PropertyInterface("Size",Bt)),Nt.p.setGroupProperty(PropertyInterface("Position",Bt)),Object.defineProperties(Lt,{size:{get:ExpressionPropertyInterface(Nt.s)},position:{get:ExpressionPropertyInterface(Nt.p)},_name:{value:Mt.nm}}),Lt.mn=Mt.mn,Lt}function gt(Mt,Pt,$t){function Lt(Vt){return Mt.p.ix===Vt?Lt.position:Mt.r.ix===Vt?Lt.rotation:Mt.pt.ix===Vt?Lt.points:Mt.or.ix===Vt||Vt==="ADBE Vector Star Outer Radius"?Lt.outerRadius:Mt.os.ix===Vt?Lt.outerRoundness:Mt.ir&&(Mt.ir.ix===Vt||Vt==="ADBE Vector Star Inner Radius")?Lt.innerRadius:Mt.is&&Mt.is.ix===Vt?Lt.innerRoundness:null}var Bt=propertyGroupFactory(Lt,$t),Nt=Pt.sh.ty==="tm"?Pt.sh.prop:Pt.sh;return Lt.propertyIndex=Mt.ix,Nt.or.setGroupProperty(PropertyInterface("Outer Radius",Bt)),Nt.os.setGroupProperty(PropertyInterface("Outer Roundness",Bt)),Nt.pt.setGroupProperty(PropertyInterface("Points",Bt)),Nt.p.setGroupProperty(PropertyInterface("Position",Bt)),Nt.r.setGroupProperty(PropertyInterface("Rotation",Bt)),Mt.ir&&(Nt.ir.setGroupProperty(PropertyInterface("Inner Radius",Bt)),Nt.is.setGroupProperty(PropertyInterface("Inner Roundness",Bt))),Object.defineProperties(Lt,{position:{get:ExpressionPropertyInterface(Nt.p)},rotation:{get:ExpressionPropertyInterface(Nt.r)},points:{get:ExpressionPropertyInterface(Nt.pt)},outerRadius:{get:ExpressionPropertyInterface(Nt.or)},outerRoundness:{get:ExpressionPropertyInterface(Nt.os)},innerRadius:{get:ExpressionPropertyInterface(Nt.ir)},innerRoundness:{get:ExpressionPropertyInterface(Nt.is)},_name:{value:Mt.nm}}),Lt.mn=Mt.mn,Lt}function Tt(Mt,Pt,$t){function Lt(Vt){return Mt.p.ix===Vt?Lt.position:Mt.r.ix===Vt?Lt.roundness:Mt.s.ix===Vt||Vt==="Size"||Vt==="ADBE Vector Rect Size"?Lt.size:null}var Bt=propertyGroupFactory(Lt,$t),Nt=Pt.sh.ty==="tm"?Pt.sh.prop:Pt.sh;return Lt.propertyIndex=Mt.ix,Nt.p.setGroupProperty(PropertyInterface("Position",Bt)),Nt.s.setGroupProperty(PropertyInterface("Size",Bt)),Nt.r.setGroupProperty(PropertyInterface("Rotation",Bt)),Object.defineProperties(Lt,{position:{get:ExpressionPropertyInterface(Nt.p)},roundness:{get:ExpressionPropertyInterface(Nt.r)},size:{get:ExpressionPropertyInterface(Nt.s)},_name:{value:Mt.nm}}),Lt.mn=Mt.mn,Lt}function Et(Mt,Pt,$t){function Lt(Vt){return Mt.r.ix===Vt||Vt==="Round Corners 1"?Lt.radius:null}var Bt=propertyGroupFactory(Lt,$t),Nt=Pt;return Lt.propertyIndex=Mt.ix,Nt.rd.setGroupProperty(PropertyInterface("Radius",Bt)),Object.defineProperties(Lt,{radius:{get:ExpressionPropertyInterface(Nt.rd)},_name:{value:Mt.nm}}),Lt.mn=Mt.mn,Lt}function At(Mt,Pt,$t){function Lt(Vt){return Mt.c.ix===Vt||Vt==="Copies"?Lt.copies:Mt.o.ix===Vt||Vt==="Offset"?Lt.offset:null}var Bt=propertyGroupFactory(Lt,$t),Nt=Pt;return Lt.propertyIndex=Mt.ix,Nt.c.setGroupProperty(PropertyInterface("Copies",Bt)),Nt.o.setGroupProperty(PropertyInterface("Offset",Bt)),Object.defineProperties(Lt,{copies:{get:ExpressionPropertyInterface(Nt.c)},offset:{get:ExpressionPropertyInterface(Nt.o)},_name:{value:Mt.nm}}),Lt.mn=Mt.mn,Lt}return function(Mt,Pt,$t){var Lt;function Bt(Vt){if(typeof Vt=="number")return Vt=Vt===void 0?1:Vt,Vt===0?$t:Lt[Vt-1];for(var Xt=0,nr=Lt.length;Xt<nr;){if(Lt[Xt]._name===Vt)return Lt[Xt];Xt+=1}return null}function Nt(){return $t}return Bt.propertyGroup=propertyGroupFactory(Bt,Nt),Lt=e(Mt,Pt,Bt.propertyGroup),Bt.numProperties=Lt.length,Bt._name="Contents",Bt}}(),TextExpressionInterface=function(){return function(e){var i;function s(a){switch(a){case"ADBE Text Document":return s.sourceText;default:return null}}return Object.defineProperty(s,"sourceText",{get:function(){e.textProperty.getValue();var _=e.textProperty.currentData.t;return(!i||_!==i.value)&&(i=new String(_),i.value=_||new String(_),Object.defineProperty(i,"style",{get:function(){return{fillColor:e.textProperty.currentData.fc}}})),i}}),s}}();function _typeof(e){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof(e)}var FootageInterface=function(){var e=function(a){var _="",et=a.getFootageData();function nt(){return _="",et=a.getFootageData(),c}function c(ct){if(et[ct])return _=ct,et=et[ct],_typeof(et)==="object"?c:et;var dt=ct.indexOf(_);if(dt!==-1){var gt=parseInt(ct.substr(dt+_.length),10);return et=et[gt],_typeof(et)==="object"?c:et}return""}return nt},i=function(a){function _(et){return et==="Outline"?_.outlineInterface():null}return _._name="Outline",_.outlineInterface=e(a),_};return function(s){function a(_){return _==="Data"?a.dataInterface:null}return a._name="Data",a.dataInterface=i(s),a}}(),interfaces={layer:LayerExpressionInterface,effects:EffectsExpressionInterface,comp:CompExpressionInterface,shape:ShapeExpressionInterface,text:TextExpressionInterface,footage:FootageInterface};function getInterface(e){return interfaces[e]||null}var expressionHelpers=function(){function e(nt,c,ct){c.x&&(ct.k=!0,ct.x=!0,ct.initiateExpression=ExpressionManager.initiateExpression,ct.effectsSequence.push(ct.initiateExpression(nt,c,ct).bind(ct)))}function i(nt){return nt*=this.elem.globalData.frameRate,nt-=this.offsetTime,nt!==this._cachingAtTime.lastFrame&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastFrame<nt?this._cachingAtTime.lastIndex:0,this._cachingAtTime.value=this.interpolateValue(nt,this._cachingAtTime),this._cachingAtTime.lastFrame=nt),this._cachingAtTime.value}function s(nt){var c=-.01,ct=this.getValueAtTime(nt),dt=this.getValueAtTime(nt+c),gt=0;if(ct.length){var Tt;for(Tt=0;Tt<ct.length;Tt+=1)gt+=Math.pow(dt[Tt]-ct[Tt],2);gt=Math.sqrt(gt)*100}else gt=0;return gt}function a(nt){if(this.vel!==void 0)return this.vel;var c=-.001,ct=this.getValueAtTime(nt),dt=this.getValueAtTime(nt+c),gt;if(ct.length){gt=createTypedArray("float32",ct.length);var Tt;for(Tt=0;Tt<ct.length;Tt+=1)gt[Tt]=(dt[Tt]-ct[Tt])/c}else gt=(dt-ct)/c;return gt}function _(){return this.pv}function et(nt){this.propertyGroup=nt}return{searchExpressions:e,getSpeedAtTime:s,getVelocityAtTime:a,getValueAtTime:i,getStaticValueAtTime:_,setGroupProperty:et}}();function addPropertyDecorator(){function e(Et,At,Mt){if(!this.k||!this.keyframes)return this.pv;Et=Et?Et.toLowerCase():"";var Pt=this.comp.renderedFrame,$t=this.keyframes,Lt=$t[$t.length-1].t;if(Pt<=Lt)return this.pv;var Bt,Nt;Mt?(At?Bt=Math.abs(Lt-this.elem.comp.globalData.frameRate*At):Bt=Math.max(0,Lt-this.elem.data.ip),Nt=Lt-Bt):((!At||At>$t.length-1)&&(At=$t.length-1),Nt=$t[$t.length-1-At].t,Bt=Lt-Nt);var Vt,Xt,nr;if(Et==="pingpong"){var ar=Math.floor((Pt-Nt)/Bt);if(ar%2!==0)return this.getValueAtTime((Bt-(Pt-Nt)%Bt+Nt)/this.comp.globalData.frameRate,0)}else if(Et==="offset"){var mr=this.getValueAtTime(Nt/this.comp.globalData.frameRate,0),Fr=this.getValueAtTime(Lt/this.comp.globalData.frameRate,0),sn=this.getValueAtTime(((Pt-Nt)%Bt+Nt)/this.comp.globalData.frameRate,0),fn=Math.floor((Pt-Nt)/Bt);if(this.pv.length){for(nr=new Array(mr.length),Xt=nr.length,Vt=0;Vt<Xt;Vt+=1)nr[Vt]=(Fr[Vt]-mr[Vt])*fn+sn[Vt];return nr}return(Fr-mr)*fn+sn}else if(Et==="continue"){var Lr=this.getValueAtTime(Lt/this.comp.globalData.frameRate,0),Qr=this.getValueAtTime((Lt-.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(nr=new Array(Lr.length),Xt=nr.length,Vt=0;Vt<Xt;Vt+=1)nr[Vt]=Lr[Vt]+(Lr[Vt]-Qr[Vt])*((Pt-Lt)/this.comp.globalData.frameRate)/5e-4;return nr}return Lr+(Lr-Qr)*((Pt-Lt)/.001)}return this.getValueAtTime(((Pt-Nt)%Bt+Nt)/this.comp.globalData.frameRate,0)}function i(Et,At,Mt){if(!this.k)return this.pv;Et=Et?Et.toLowerCase():"";var Pt=this.comp.renderedFrame,$t=this.keyframes,Lt=$t[0].t;if(Pt>=Lt)return this.pv;var Bt,Nt;Mt?(At?Bt=Math.abs(this.elem.comp.globalData.frameRate*At):Bt=Math.max(0,this.elem.data.op-Lt),Nt=Lt+Bt):((!At||At>$t.length-1)&&(At=$t.length-1),Nt=$t[At].t,Bt=Nt-Lt);var Vt,Xt,nr;if(Et==="pingpong"){var ar=Math.floor((Lt-Pt)/Bt);if(ar%2===0)return this.getValueAtTime(((Lt-Pt)%Bt+Lt)/this.comp.globalData.frameRate,0)}else if(Et==="offset"){var mr=this.getValueAtTime(Lt/this.comp.globalData.frameRate,0),Fr=this.getValueAtTime(Nt/this.comp.globalData.frameRate,0),sn=this.getValueAtTime((Bt-(Lt-Pt)%Bt+Lt)/this.comp.globalData.frameRate,0),fn=Math.floor((Lt-Pt)/Bt)+1;if(this.pv.length){for(nr=new Array(mr.length),Xt=nr.length,Vt=0;Vt<Xt;Vt+=1)nr[Vt]=sn[Vt]-(Fr[Vt]-mr[Vt])*fn;return nr}return sn-(Fr-mr)*fn}else if(Et==="continue"){var Lr=this.getValueAtTime(Lt/this.comp.globalData.frameRate,0),Qr=this.getValueAtTime((Lt+.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(nr=new Array(Lr.length),Xt=nr.length,Vt=0;Vt<Xt;Vt+=1)nr[Vt]=Lr[Vt]+(Lr[Vt]-Qr[Vt])*(Lt-Pt)/.001;return nr}return Lr+(Lr-Qr)*(Lt-Pt)/.001}return this.getValueAtTime((Bt-((Lt-Pt)%Bt+Lt))/this.comp.globalData.frameRate,0)}function s(Et,At){if(!this.k)return this.pv;if(Et=(Et||.4)*.5,At=Math.floor(At||5),At<=1)return this.pv;var Mt=this.comp.renderedFrame/this.comp.globalData.frameRate,Pt=Mt-Et,$t=Mt+Et,Lt=At>1?($t-Pt)/(At-1):1,Bt=0,Nt=0,Vt;this.pv.length?Vt=createTypedArray("float32",this.pv.length):Vt=0;for(var Xt;Bt<At;){if(Xt=this.getValueAtTime(Pt+Bt*Lt),this.pv.length)for(Nt=0;Nt<this.pv.length;Nt+=1)Vt[Nt]+=Xt[Nt];else Vt+=Xt;Bt+=1}if(this.pv.length)for(Nt=0;Nt<this.pv.length;Nt+=1)Vt[Nt]/=At;else Vt/=At;return Vt}function a(Et){this._transformCachingAtTime||(this._transformCachingAtTime={v:new Matrix});var At=this._transformCachingAtTime.v;if(At.cloneFromProps(this.pre.props),this.appliedTransformations<1){var Mt=this.a.getValueAtTime(Et);At.translate(-Mt[0]*this.a.mult,-Mt[1]*this.a.mult,Mt[2]*this.a.mult)}if(this.appliedTransformations<2){var Pt=this.s.getValueAtTime(Et);At.scale(Pt[0]*this.s.mult,Pt[1]*this.s.mult,Pt[2]*this.s.mult)}if(this.sk&&this.appliedTransformations<3){var $t=this.sk.getValueAtTime(Et),Lt=this.sa.getValueAtTime(Et);At.skewFromAxis(-$t*this.sk.mult,Lt*this.sa.mult)}if(this.r&&this.appliedTransformations<4){var Bt=this.r.getValueAtTime(Et);At.rotate(-Bt*this.r.mult)}else if(!this.r&&this.appliedTransformations<4){var Nt=this.rz.getValueAtTime(Et),Vt=this.ry.getValueAtTime(Et),Xt=this.rx.getValueAtTime(Et),nr=this.or.getValueAtTime(Et);At.rotateZ(-Nt*this.rz.mult).rotateY(Vt*this.ry.mult).rotateX(Xt*this.rx.mult).rotateZ(-nr[2]*this.or.mult).rotateY(nr[1]*this.or.mult).rotateX(nr[0]*this.or.mult)}if(this.data.p&&this.data.p.s){var ar=this.px.getValueAtTime(Et),mr=this.py.getValueAtTime(Et);if(this.data.p.z){var Fr=this.pz.getValueAtTime(Et);At.translate(ar*this.px.mult,mr*this.py.mult,-Fr*this.pz.mult)}else At.translate(ar*this.px.mult,mr*this.py.mult,0)}else{var sn=this.p.getValueAtTime(Et);At.translate(sn[0]*this.p.mult,sn[1]*this.p.mult,-sn[2]*this.p.mult)}return At}function _(){return this.v.clone(new Matrix)}var et=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function(Et,At,Mt){var Pt=et(Et,At,Mt);return Pt.dynamicProperties.length?Pt.getValueAtTime=a.bind(Pt):Pt.getValueAtTime=_.bind(Pt),Pt.setGroupProperty=expressionHelpers.setGroupProperty,Pt};var nt=PropertyFactory.getProp;PropertyFactory.getProp=function(Et,At,Mt,Pt,$t){var Lt=nt(Et,At,Mt,Pt,$t);Lt.kf?Lt.getValueAtTime=expressionHelpers.getValueAtTime.bind(Lt):Lt.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(Lt),Lt.setGroupProperty=expressionHelpers.setGroupProperty,Lt.loopOut=e,Lt.loopIn=i,Lt.smooth=s,Lt.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(Lt),Lt.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(Lt),Lt.numKeys=At.a===1?At.k.length:0,Lt.propertyIndex=At.ix;var Bt=0;return Mt!==0&&(Bt=createTypedArray("float32",At.a===1?At.k[0].s.length:At.k.length)),Lt._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:Bt},expressionHelpers.searchExpressions(Et,At,Lt),Lt.k&&$t.addDynamicProperty(Lt),Lt};function c(Et){return this._cachingAtTime||(this._cachingAtTime={shapeValue:shapePool.clone(this.pv),lastIndex:0,lastTime:initialDefaultFrame}),Et*=this.elem.globalData.frameRate,Et-=this.offsetTime,Et!==this._cachingAtTime.lastTime&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastTime<Et?this._caching.lastIndex:0,this._cachingAtTime.lastTime=Et,this.interpolateShape(Et,this._cachingAtTime.shapeValue,this._cachingAtTime)),this._cachingAtTime.shapeValue}var ct=ShapePropertyFactory.getConstructorFunction(),dt=ShapePropertyFactory.getKeyframedConstructorFunction();function gt(){}gt.prototype={vertices:function(At,Mt){this.k&&this.getValue();var Pt=this.v;Mt!==void 0&&(Pt=this.getValueAtTime(Mt,0));var $t,Lt=Pt._length,Bt=Pt[At],Nt=Pt.v,Vt=createSizedArray(Lt);for($t=0;$t<Lt;$t+=1)At==="i"||At==="o"?Vt[$t]=[Bt[$t][0]-Nt[$t][0],Bt[$t][1]-Nt[$t][1]]:Vt[$t]=[Bt[$t][0],Bt[$t][1]];return Vt},points:function(At){return this.vertices("v",At)},inTangents:function(At){return this.vertices("i",At)},outTangents:function(At){return this.vertices("o",At)},isClosed:function(){return this.v.c},pointOnPath:function(At,Mt){var Pt=this.v;Mt!==void 0&&(Pt=this.getValueAtTime(Mt,0)),this._segmentsLength||(this._segmentsLength=bez.getSegmentsLength(Pt));for(var $t=this._segmentsLength,Lt=$t.lengths,Bt=$t.totalLength*At,Nt=0,Vt=Lt.length,Xt=0,nr;Nt<Vt;){if(Xt+Lt[Nt].addedLength>Bt){var ar=Nt,mr=Pt.c&&Nt===Vt-1?0:Nt+1,Fr=(Bt-Xt)/Lt[Nt].addedLength;nr=bez.getPointInSegment(Pt.v[ar],Pt.v[mr],Pt.o[ar],Pt.i[mr],Fr,Lt[Nt]);break}else Xt+=Lt[Nt].addedLength;Nt+=1}return nr||(nr=Pt.c?[Pt.v[0][0],Pt.v[0][1]]:[Pt.v[Pt._length-1][0],Pt.v[Pt._length-1][1]]),nr},vectorOnPath:function(At,Mt,Pt){At==1?At=this.v.c:At==0&&(At=.999);var $t=this.pointOnPath(At,Mt),Lt=this.pointOnPath(At+.001,Mt),Bt=Lt[0]-$t[0],Nt=Lt[1]-$t[1],Vt=Math.sqrt(Math.pow(Bt,2)+Math.pow(Nt,2));if(Vt===0)return[0,0];var Xt=Pt==="tangent"?[Bt/Vt,Nt/Vt]:[-Nt/Vt,Bt/Vt];return Xt},tangentOnPath:function(At,Mt){return this.vectorOnPath(At,Mt,"tangent")},normalOnPath:function(At,Mt){return this.vectorOnPath(At,Mt,"normal")},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime},extendPrototype([gt],ct),extendPrototype([gt],dt),dt.prototype.getValueAtTime=c,dt.prototype.initiateExpression=ExpressionManager.initiateExpression;var Tt=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function(Et,At,Mt,Pt,$t){var Lt=Tt(Et,At,Mt,Pt,$t);return Lt.propertyIndex=At.ix,Lt.lock=!1,Mt===3?expressionHelpers.searchExpressions(Et,At.pt,Lt):Mt===4&&expressionHelpers.searchExpressions(Et,At.ks,Lt),Lt.k&&Et.addDynamicProperty(Lt),Lt}}function initialize$1(){addPropertyDecorator()}function addDecorator(){function e(){return this.data.d.x?(this.calculateExpression=ExpressionManager.initiateExpression.bind(this)(this.elem,this.data.d,this),this.addEffect(this.getExpressionValue.bind(this)),!0):null}TextProperty.prototype.getExpressionValue=function(i,s){var a=this.calculateExpression(s);if(i.t!==a){var _={};return this.copyData(_,i),_.t=a.toString(),_.__complete=!1,_}return i},TextProperty.prototype.searchProperty=function(){var i=this.searchKeyframes(),s=this.searchExpressions();return this.kf=i||s,this.kf},TextProperty.prototype.searchExpressions=e}function initialize(){addDecorator()}function SVGComposableEffect(){}SVGComposableEffect.prototype={createMergeNode:function e(i,s){var a=createNS("feMerge");a.setAttribute("result",i);var _,et;for(et=0;et<s.length;et+=1)_=createNS("feMergeNode"),_.setAttribute("in",s[et]),a.appendChild(_),a.appendChild(_);return a}};var linearFilterValue="0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0";function SVGTintFilter(e,i,s,a,_){this.filterManager=i;var et=createNS("feColorMatrix");et.setAttribute("type","matrix"),et.setAttribute("color-interpolation-filters","linearRGB"),et.setAttribute("values",linearFilterValue+" 1 0"),this.linearFilter=et,et.setAttribute("result",a+"_tint_1"),e.appendChild(et),et=createNS("feColorMatrix"),et.setAttribute("type","matrix"),et.setAttribute("color-interpolation-filters","sRGB"),et.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),et.setAttribute("result",a+"_tint_2"),e.appendChild(et),this.matrixFilter=et;var nt=this.createMergeNode(a,[_,a+"_tint_1",a+"_tint_2"]);e.appendChild(nt)}extendPrototype([SVGComposableEffect],SVGTintFilter),SVGTintFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=this.filterManager.effectElements[0].p.v,s=this.filterManager.effectElements[1].p.v,a=this.filterManager.effectElements[2].p.v/100;this.linearFilter.setAttribute("values",linearFilterValue+" "+a+" 0"),this.matrixFilter.setAttribute("values",s[0]-i[0]+" 0 0 0 "+i[0]+" "+(s[1]-i[1])+" 0 0 0 "+i[1]+" "+(s[2]-i[2])+" 0 0 0 "+i[2]+" 0 0 0 1 0")}};function SVGFillFilter(e,i,s,a){this.filterManager=i;var _=createNS("feColorMatrix");_.setAttribute("type","matrix"),_.setAttribute("color-interpolation-filters","sRGB"),_.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),_.setAttribute("result",a),e.appendChild(_),this.matrixFilter=_}SVGFillFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=this.filterManager.effectElements[2].p.v,s=this.filterManager.effectElements[6].p.v;this.matrixFilter.setAttribute("values","0 0 0 0 "+i[0]+" 0 0 0 0 "+i[1]+" 0 0 0 0 "+i[2]+" 0 0 0 "+s+" 0")}};function SVGStrokeEffect(e,i,s){this.initialized=!1,this.filterManager=i,this.elem=s,this.paths=[]}SVGStrokeEffect.prototype.initialize=function(){var e=this.elem.layerElement.children||this.elem.layerElement.childNodes,i,s,a,_;for(this.filterManager.effectElements[1].p.v===1?(_=this.elem.maskManager.masksProperties.length,a=0):(a=this.filterManager.effectElements[0].p.v-1,_=a+1),s=createNS("g"),s.setAttribute("fill","none"),s.setAttribute("stroke-linecap","round"),s.setAttribute("stroke-dashoffset",1),a;a<_;a+=1)i=createNS("path"),s.appendChild(i),this.paths.push({p:i,m:a});if(this.filterManager.effectElements[10].p.v===3){var et=createNS("mask"),nt=createElementID();et.setAttribute("id",nt),et.setAttribute("mask-type","alpha"),et.appendChild(s),this.elem.globalData.defs.appendChild(et);var c=createNS("g");for(c.setAttribute("mask","url("+getLocationHref()+"#"+nt+")");e[0];)c.appendChild(e[0]);this.elem.layerElement.appendChild(c),this.masker=et,s.setAttribute("stroke","#fff")}else if(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2){if(this.filterManager.effectElements[10].p.v===2)for(e=this.elem.layerElement.children||this.elem.layerElement.childNodes;e.length;)this.elem.layerElement.removeChild(e[0]);this.elem.layerElement.appendChild(s),this.elem.layerElement.removeAttribute("mask"),s.setAttribute("stroke","#fff")}this.initialized=!0,this.pathMasker=s},SVGStrokeEffect.prototype.renderFrame=function(e){this.initialized||this.initialize();var i,s=this.paths.length,a,_;for(i=0;i<s;i+=1)if(this.paths[i].m!==-1&&(a=this.elem.maskManager.viewData[this.paths[i].m],_=this.paths[i].p,(e||this.filterManager._mdf||a.prop._mdf)&&_.setAttribute("d",a.lastPath),e||this.filterManager.effectElements[9].p._mdf||this.filterManager.effectElements[4].p._mdf||this.filterManager.effectElements[7].p._mdf||this.filterManager.effectElements[8].p._mdf||a.prop._mdf)){var et;if(this.filterManager.effectElements[7].p.v!==0||this.filterManager.effectElements[8].p.v!==100){var nt=Math.min(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,c=Math.max(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,ct=_.getTotalLength();et="0 0 0 "+ct*nt+" ";var dt=ct*(c-nt),gt=1+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01,Tt=Math.floor(dt/gt),Et;for(Et=0;Et<Tt;Et+=1)et+="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01+" ";et+="0 "+ct*10+" 0 0"}else et="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01;_.setAttribute("stroke-dasharray",et)}if((e||this.filterManager.effectElements[4].p._mdf)&&this.pathMasker.setAttribute("stroke-width",this.filterManager.effectElements[4].p.v*2),(e||this.filterManager.effectElements[6].p._mdf)&&this.pathMasker.setAttribute("opacity",this.filterManager.effectElements[6].p.v),(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2)&&(e||this.filterManager.effectElements[3].p._mdf)){var At=this.filterManager.effectElements[3].p.v;this.pathMasker.setAttribute("stroke","rgb("+bmFloor(At[0]*255)+","+bmFloor(At[1]*255)+","+bmFloor(At[2]*255)+")")}};function SVGTritoneFilter(e,i,s,a){this.filterManager=i;var _=createNS("feColorMatrix");_.setAttribute("type","matrix"),_.setAttribute("color-interpolation-filters","linearRGB"),_.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"),e.appendChild(_);var et=createNS("feComponentTransfer");et.setAttribute("color-interpolation-filters","sRGB"),et.setAttribute("result",a),this.matrixFilter=et;var nt=createNS("feFuncR");nt.setAttribute("type","table"),et.appendChild(nt),this.feFuncR=nt;var c=createNS("feFuncG");c.setAttribute("type","table"),et.appendChild(c),this.feFuncG=c;var ct=createNS("feFuncB");ct.setAttribute("type","table"),et.appendChild(ct),this.feFuncB=ct,e.appendChild(et)}SVGTritoneFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=this.filterManager.effectElements[0].p.v,s=this.filterManager.effectElements[1].p.v,a=this.filterManager.effectElements[2].p.v,_=a[0]+" "+s[0]+" "+i[0],et=a[1]+" "+s[1]+" "+i[1],nt=a[2]+" "+s[2]+" "+i[2];this.feFuncR.setAttribute("tableValues",_),this.feFuncG.setAttribute("tableValues",et),this.feFuncB.setAttribute("tableValues",nt)}};function SVGProLevelsFilter(e,i,s,a){this.filterManager=i;var _=this.filterManager.effectElements,et=createNS("feComponentTransfer");(_[10].p.k||_[10].p.v!==0||_[11].p.k||_[11].p.v!==1||_[12].p.k||_[12].p.v!==1||_[13].p.k||_[13].p.v!==0||_[14].p.k||_[14].p.v!==1)&&(this.feFuncR=this.createFeFunc("feFuncR",et)),(_[17].p.k||_[17].p.v!==0||_[18].p.k||_[18].p.v!==1||_[19].p.k||_[19].p.v!==1||_[20].p.k||_[20].p.v!==0||_[21].p.k||_[21].p.v!==1)&&(this.feFuncG=this.createFeFunc("feFuncG",et)),(_[24].p.k||_[24].p.v!==0||_[25].p.k||_[25].p.v!==1||_[26].p.k||_[26].p.v!==1||_[27].p.k||_[27].p.v!==0||_[28].p.k||_[28].p.v!==1)&&(this.feFuncB=this.createFeFunc("feFuncB",et)),(_[31].p.k||_[31].p.v!==0||_[32].p.k||_[32].p.v!==1||_[33].p.k||_[33].p.v!==1||_[34].p.k||_[34].p.v!==0||_[35].p.k||_[35].p.v!==1)&&(this.feFuncA=this.createFeFunc("feFuncA",et)),(this.feFuncR||this.feFuncG||this.feFuncB||this.feFuncA)&&(et.setAttribute("color-interpolation-filters","sRGB"),e.appendChild(et)),(_[3].p.k||_[3].p.v!==0||_[4].p.k||_[4].p.v!==1||_[5].p.k||_[5].p.v!==1||_[6].p.k||_[6].p.v!==0||_[7].p.k||_[7].p.v!==1)&&(et=createNS("feComponentTransfer"),et.setAttribute("color-interpolation-filters","sRGB"),et.setAttribute("result",a),e.appendChild(et),this.feFuncRComposed=this.createFeFunc("feFuncR",et),this.feFuncGComposed=this.createFeFunc("feFuncG",et),this.feFuncBComposed=this.createFeFunc("feFuncB",et))}SVGProLevelsFilter.prototype.createFeFunc=function(e,i){var s=createNS(e);return s.setAttribute("type","table"),i.appendChild(s),s},SVGProLevelsFilter.prototype.getTableValue=function(e,i,s,a,_){for(var et=0,nt=256,c,ct=Math.min(e,i),dt=Math.max(e,i),gt=Array.call(null,{length:nt}),Tt,Et=0,At=_-a,Mt=i-e;et<=256;)c=et/256,c<=ct?Tt=Mt<0?_:a:c>=dt?Tt=Mt<0?a:_:Tt=a+At*Math.pow((c-e)/Mt,1/s),gt[Et]=Tt,Et+=1,et+=256/(nt-1);return gt.join(" ")},SVGProLevelsFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i,s=this.filterManager.effectElements;this.feFuncRComposed&&(e||s[3].p._mdf||s[4].p._mdf||s[5].p._mdf||s[6].p._mdf||s[7].p._mdf)&&(i=this.getTableValue(s[3].p.v,s[4].p.v,s[5].p.v,s[6].p.v,s[7].p.v),this.feFuncRComposed.setAttribute("tableValues",i),this.feFuncGComposed.setAttribute("tableValues",i),this.feFuncBComposed.setAttribute("tableValues",i)),this.feFuncR&&(e||s[10].p._mdf||s[11].p._mdf||s[12].p._mdf||s[13].p._mdf||s[14].p._mdf)&&(i=this.getTableValue(s[10].p.v,s[11].p.v,s[12].p.v,s[13].p.v,s[14].p.v),this.feFuncR.setAttribute("tableValues",i)),this.feFuncG&&(e||s[17].p._mdf||s[18].p._mdf||s[19].p._mdf||s[20].p._mdf||s[21].p._mdf)&&(i=this.getTableValue(s[17].p.v,s[18].p.v,s[19].p.v,s[20].p.v,s[21].p.v),this.feFuncG.setAttribute("tableValues",i)),this.feFuncB&&(e||s[24].p._mdf||s[25].p._mdf||s[26].p._mdf||s[27].p._mdf||s[28].p._mdf)&&(i=this.getTableValue(s[24].p.v,s[25].p.v,s[26].p.v,s[27].p.v,s[28].p.v),this.feFuncB.setAttribute("tableValues",i)),this.feFuncA&&(e||s[31].p._mdf||s[32].p._mdf||s[33].p._mdf||s[34].p._mdf||s[35].p._mdf)&&(i=this.getTableValue(s[31].p.v,s[32].p.v,s[33].p.v,s[34].p.v,s[35].p.v),this.feFuncA.setAttribute("tableValues",i))}};function SVGDropShadowEffect(e,i,s,a,_){var et=i.container.globalData.renderConfig.filterSize,nt=i.data.fs||et;e.setAttribute("x",nt.x||et.x),e.setAttribute("y",nt.y||et.y),e.setAttribute("width",nt.width||et.width),e.setAttribute("height",nt.height||et.height),this.filterManager=i;var c=createNS("feGaussianBlur");c.setAttribute("in","SourceAlpha"),c.setAttribute("result",a+"_drop_shadow_1"),c.setAttribute("stdDeviation","0"),this.feGaussianBlur=c,e.appendChild(c);var ct=createNS("feOffset");ct.setAttribute("dx","25"),ct.setAttribute("dy","0"),ct.setAttribute("in",a+"_drop_shadow_1"),ct.setAttribute("result",a+"_drop_shadow_2"),this.feOffset=ct,e.appendChild(ct);var dt=createNS("feFlood");dt.setAttribute("flood-color","#00ff00"),dt.setAttribute("flood-opacity","1"),dt.setAttribute("result",a+"_drop_shadow_3"),this.feFlood=dt,e.appendChild(dt);var gt=createNS("feComposite");gt.setAttribute("in",a+"_drop_shadow_3"),gt.setAttribute("in2",a+"_drop_shadow_2"),gt.setAttribute("operator","in"),gt.setAttribute("result",a+"_drop_shadow_4"),e.appendChild(gt);var Tt=this.createMergeNode(a,[a+"_drop_shadow_4",_]);e.appendChild(Tt)}extendPrototype([SVGComposableEffect],SVGDropShadowEffect),SVGDropShadowEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){if((e||this.filterManager.effectElements[4].p._mdf)&&this.feGaussianBlur.setAttribute("stdDeviation",this.filterManager.effectElements[4].p.v/4),e||this.filterManager.effectElements[0].p._mdf){var i=this.filterManager.effectElements[0].p.v;this.feFlood.setAttribute("flood-color",rgbToHex(Math.round(i[0]*255),Math.round(i[1]*255),Math.round(i[2]*255)))}if((e||this.filterManager.effectElements[1].p._mdf)&&this.feFlood.setAttribute("flood-opacity",this.filterManager.effectElements[1].p.v/255),e||this.filterManager.effectElements[2].p._mdf||this.filterManager.effectElements[3].p._mdf){var s=this.filterManager.effectElements[3].p.v,a=(this.filterManager.effectElements[2].p.v-90)*degToRads,_=s*Math.cos(a),et=s*Math.sin(a);this.feOffset.setAttribute("dx",_),this.feOffset.setAttribute("dy",et)}}};var _svgMatteSymbols=[];function SVGMatte3Effect(e,i,s){this.initialized=!1,this.filterManager=i,this.filterElem=e,this.elem=s,s.matteElement=createNS("g"),s.matteElement.appendChild(s.layerElement),s.matteElement.appendChild(s.transformedElement),s.baseElement=s.matteElement}SVGMatte3Effect.prototype.findSymbol=function(e){for(var i=0,s=_svgMatteSymbols.length;i<s;){if(_svgMatteSymbols[i]===e)return _svgMatteSymbols[i];i+=1}return null},SVGMatte3Effect.prototype.replaceInParent=function(e,i){var s=e.layerElement.parentNode;if(s){for(var a=s.children,_=0,et=a.length;_<et&&a[_]!==e.layerElement;)_+=1;var nt;_<=et-2&&(nt=a[_+1]);var c=createNS("use");c.setAttribute("href","#"+i),nt?s.insertBefore(c,nt):s.appendChild(c)}},SVGMatte3Effect.prototype.setElementAsMask=function(e,i){if(!this.findSymbol(i)){var s=createElementID(),a=createNS("mask");a.setAttribute("id",i.layerId),a.setAttribute("mask-type","alpha"),_svgMatteSymbols.push(i);var _=e.globalData.defs;_.appendChild(a);var et=createNS("symbol");et.setAttribute("id",s),this.replaceInParent(i,s),et.appendChild(i.layerElement),_.appendChild(et);var nt=createNS("use");nt.setAttribute("href","#"+s),a.appendChild(nt),i.data.hd=!1,i.show()}e.setMatte(i.layerId)},SVGMatte3Effect.prototype.initialize=function(){for(var e=this.filterManager.effectElements[0].p.v,i=this.elem.comp.elements,s=0,a=i.length;s<a;)i[s]&&i[s].data.ind===e&&this.setElementAsMask(this.elem,i[s]),s+=1;this.initialized=!0},SVGMatte3Effect.prototype.renderFrame=function(){this.initialized||this.initialize()};function SVGGaussianBlurEffect(e,i,s,a){e.setAttribute("x","-100%"),e.setAttribute("y","-100%"),e.setAttribute("width","300%"),e.setAttribute("height","300%"),this.filterManager=i;var _=createNS("feGaussianBlur");_.setAttribute("result",a),e.appendChild(_),this.feGaussianBlur=_}SVGGaussianBlurEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=.3,s=this.filterManager.effectElements[0].p.v*i,a=this.filterManager.effectElements[1].p.v,_=a==3?0:s,et=a==2?0:s;this.feGaussianBlur.setAttribute("stdDeviation",_+" "+et);var nt=this.filterManager.effectElements[2].p.v==1?"wrap":"duplicate";this.feGaussianBlur.setAttribute("edgeMode",nt)}};function TransformEffect(){}TransformEffect.prototype.init=function(e){this.effectsManager=e,this.type=effectTypes.TRANSFORM_EFFECT,this.matrix=new Matrix,this.opacity=-1,this._mdf=!1,this._opMdf=!1},TransformEffect.prototype.renderFrame=function(e){if(this._opMdf=!1,this._mdf=!1,e||this.effectsManager._mdf){var i=this.effectsManager.effectElements,s=i[0].p.v,a=i[1].p.v,_=i[2].p.v===1,et=i[3].p.v,nt=_?et:i[4].p.v,c=i[5].p.v,ct=i[6].p.v,dt=i[7].p.v;this.matrix.reset(),this.matrix.translate(-s[0],-s[1],s[2]),this.matrix.scale(nt*.01,et*.01,1),this.matrix.rotate(-dt*degToRads),this.matrix.skewFromAxis(-c*degToRads,(ct+90)*degToRads),this.matrix.translate(a[0],a[1],0),this._mdf=!0,this.opacity!==i[8].p.v&&(this.opacity=i[8].p.v,this._opMdf=!0)}};function SVGTransformEffect(e,i){this.init(i)}extendPrototype([TransformEffect],SVGTransformEffect);function CVTransformEffect(e){this.init(e)}return extendPrototype([TransformEffect],CVTransformEffect),registerRenderer("canvas",CanvasRenderer),registerRenderer("html",HybridRenderer),registerRenderer("svg",SVGRenderer),ShapeModifiers.registerModifier("tm",TrimModifier),ShapeModifiers.registerModifier("pb",PuckerAndBloatModifier),ShapeModifiers.registerModifier("rp",RepeaterModifier),ShapeModifiers.registerModifier("rd",RoundCornersModifier),ShapeModifiers.registerModifier("zz",ZigZagModifier),ShapeModifiers.registerModifier("op",OffsetPathModifier),setExpressionsPlugin(Expressions),setExpressionInterfaces(getInterface),initialize$1(),initialize(),registerEffect$1(20,SVGTintFilter,!0),registerEffect$1(21,SVGFillFilter,!0),registerEffect$1(22,SVGStrokeEffect,!1),registerEffect$1(23,SVGTritoneFilter,!0),registerEffect$1(24,SVGProLevelsFilter,!0),registerEffect$1(25,SVGDropShadowEffect,!0),registerEffect$1(28,SVGMatte3Effect,!1),registerEffect$1(29,SVGGaussianBlurEffect,!0),registerEffect$1(35,SVGTransformEffect,!1),registerEffect(35,CVTransformEffect),lottie})})(lottie$1,lottie$1.exports);var lottieExports=lottie$1.exports;const lottie=getDefaultExportFromCjs(lottieExports);function _arrayLikeToArray(e,i){(i==null||i>e.length)&&(i=e.length);for(var s=0,a=Array(i);s<i;s++)a[s]=e[s];return a}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _defineProperty(e,i,s){return(i=_toPropertyKey(i))in e?Object.defineProperty(e,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[i]=s,e}function _iterableToArrayLimit(e,i){var s=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(s!=null){var a,_,et,nt,c=[],ct=!0,dt=!1;try{if(et=(s=s.call(e)).next,i!==0)for(;!(ct=(a=et.call(s)).done)&&(c.push(a.value),c.length!==i);ct=!0);}catch(gt){dt=!0,_=gt}finally{try{if(!ct&&s.return!=null&&(nt=s.return(),Object(nt)!==nt))return}finally{if(dt)throw _}}return c}}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ownKeys(e,i){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);i&&(a=a.filter(function(_){return Object.getOwnPropertyDescriptor(e,_).enumerable})),s.push.apply(s,a)}return s}function _objectSpread2(e){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?ownKeys(Object(s),!0).forEach(function(a){_defineProperty(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ownKeys(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}function _objectWithoutProperties(e,i){if(e==null)return{};var s,a,_=_objectWithoutPropertiesLoose(e,i);if(Object.getOwnPropertySymbols){var et=Object.getOwnPropertySymbols(e);for(a=0;a<et.length;a++)s=et[a],i.includes(s)||{}.propertyIsEnumerable.call(e,s)&&(_[s]=e[s])}return _}function _objectWithoutPropertiesLoose(e,i){if(e==null)return{};var s={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(i.includes(a))continue;s[a]=e[a]}return s}function _slicedToArray(e,i){return _arrayWithHoles(e)||_iterableToArrayLimit(e,i)||_unsupportedIterableToArray(e,i)||_nonIterableRest()}function _toPrimitive(e,i){if(typeof e!="object"||!e)return e;var s=e[Symbol.toPrimitive];if(s!==void 0){var a=s.call(e,i||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function _toPropertyKey(e){var i=_toPrimitive(e,"string");return typeof i=="symbol"?i:i+""}function _unsupportedIterableToArray(e,i){if(e){if(typeof e=="string")return _arrayLikeToArray(e,i);var s={}.toString.call(e).slice(8,-1);return s==="Object"&&e.constructor&&(s=e.constructor.name),s==="Map"||s==="Set"?Array.from(e):s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?_arrayLikeToArray(e,i):void 0}}var _excluded$1=["animationData","loop","autoplay","initialSegment","onComplete","onLoopComplete","onEnterFrame","onSegmentStart","onConfigReady","onDataReady","onDataFailed","onLoadedImages","onDOMLoaded","onDestroy","lottieRef","renderer","name","assetsPath","rendererSettings"],useLottie=function e(i,s){var a=i.animationData,_=i.loop,et=i.autoplay,nt=i.initialSegment,c=i.onComplete,ct=i.onLoopComplete,dt=i.onEnterFrame,gt=i.onSegmentStart,Tt=i.onConfigReady,Et=i.onDataReady,At=i.onDataFailed,Mt=i.onLoadedImages,Pt=i.onDOMLoaded,$t=i.onDestroy;i.lottieRef,i.renderer,i.name,i.assetsPath,i.rendererSettings;var Lt=_objectWithoutProperties(i,_excluded$1),Bt=reactExports.useState(!1),Nt=_slicedToArray(Bt,2),Vt=Nt[0],Xt=Nt[1],nr=reactExports.useRef(),ar=reactExports.useRef(null),mr=function(){var qr;(qr=nr.current)===null||qr===void 0||qr.play()},Fr=function(){var qr;(qr=nr.current)===null||qr===void 0||qr.stop()},sn=function(){var qr;(qr=nr.current)===null||qr===void 0||qr.pause()},fn=function(qr){var tn;(tn=nr.current)===null||tn===void 0||tn.setSpeed(qr)},Lr=function(qr,tn){var vn;(vn=nr.current)===null||vn===void 0||vn.goToAndPlay(qr,tn)},Qr=function(qr,tn){var vn;(vn=nr.current)===null||vn===void 0||vn.goToAndStop(qr,tn)},dn=function(qr){var tn;(tn=nr.current)===null||tn===void 0||tn.setDirection(qr)},en=function(qr,tn){var vn;(vn=nr.current)===null||vn===void 0||vn.playSegments(qr,tn)},yr=function(qr){var tn;(tn=nr.current)===null||tn===void 0||tn.setSubframe(qr)},Ar=function(qr){var tn;return(tn=nr.current)===null||tn===void 0?void 0:tn.getDuration(qr)},rr=function(){var qr;(qr=nr.current)===null||qr===void 0||qr.destroy(),nr.current=void 0},ur=function(){var qr=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},tn;if(ar.current){(tn=nr.current)===null||tn===void 0||tn.destroy();var vn=_objectSpread2(_objectSpread2(_objectSpread2({},i),qr),{},{container:ar.current});return nr.current=lottie.loadAnimation(vn),Xt(!!nr.current),function(){var hs;(hs=nr.current)===null||hs===void 0||hs.destroy(),nr.current=void 0}}};reactExports.useEffect(function(){var xr=ur();return function(){return xr==null?void 0:xr()}},[a,_]),reactExports.useEffect(function(){nr.current&&(nr.current.autoplay=!!et)},[et]),reactExports.useEffect(function(){if(nr.current){if(!nt){nr.current.resetSegments(!0);return}!Array.isArray(nt)||!nt.length||((nr.current.currentRawFrame<nt[0]||nr.current.currentRawFrame>nt[1])&&(nr.current.currentRawFrame=nt[0]),nr.current.setSegment(nt[0],nt[1]))}},[nt]),reactExports.useEffect(function(){var xr=[{name:"complete",handler:c},{name:"loopComplete",handler:ct},{name:"enterFrame",handler:dt},{name:"segmentStart",handler:gt},{name:"config_ready",handler:Tt},{name:"data_ready",handler:Et},{name:"data_failed",handler:At},{name:"loaded_images",handler:Mt},{name:"DOMLoaded",handler:Pt},{name:"destroy",handler:$t}],qr=xr.filter(function(vn){return vn.handler!=null});if(qr.length){var tn=qr.map(function(vn){var hs;return(hs=nr.current)===null||hs===void 0||hs.addEventListener(vn.name,vn.handler),function(){var Ts;(Ts=nr.current)===null||Ts===void 0||Ts.removeEventListener(vn.name,vn.handler)}});return function(){tn.forEach(function(vn){return vn()})}}},[c,ct,dt,gt,Tt,Et,At,Mt,Pt,$t]);var Br=React.createElement("div",_objectSpread2({style:s,ref:ar},Lt));return{View:Br,play:mr,stop:Fr,pause:sn,setSpeed:fn,goToAndStop:Qr,goToAndPlay:Lr,setDirection:dn,playSegments:en,setSubframe:yr,getDuration:Ar,destroy:rr,animationContainerRef:ar,animationLoaded:Vt,animationItem:nr.current}};function getContainerVisibility(e){var i=e.getBoundingClientRect(),s=i.top,a=i.height,_=window.innerHeight-s,et=window.innerHeight+a;return _/et}function getContainerCursorPosition(e,i,s){var a=e.getBoundingClientRect(),_=a.top,et=a.left,nt=a.width,c=a.height,ct=(i-et)/nt,dt=(s-_)/c;return{x:ct,y:dt}}var useInitInteractivity=function e(i){var s=i.wrapperRef,a=i.animationItem,_=i.mode,et=i.actions;reactExports.useEffect(function(){var nt=s.current;if(!(!nt||!a||!et.length)){a.stop();var c=function(){var gt=null,Tt=function(){var At=getContainerVisibility(nt),Mt=et.find(function($t){var Lt=$t.visibility;return Lt&&At>=Lt[0]&&At<=Lt[1]});if(Mt){if(Mt.type==="seek"&&Mt.visibility&&Mt.frames.length===2){var Pt=Mt.frames[0]+Math.ceil((At-Mt.visibility[0])/(Mt.visibility[1]-Mt.visibility[0])*Mt.frames[1]);//! goToAndStop must be relative to the start of the current segment
a.goToAndStop(Pt-a.firstFrame-1,!0)}Mt.type==="loop"&&(gt===null||gt!==Mt.frames||a.isPaused)&&(a.playSegments(Mt.frames,!0),gt=Mt.frames),Mt.type==="play"&&a.isPaused&&(a.resetSegments(!0),a.play()),Mt.type==="stop"&&a.goToAndStop(Mt.frames[0]-a.firstFrame-1,!0)}};return document.addEventListener("scroll",Tt),function(){document.removeEventListener("scroll",Tt)}},ct=function(){var gt=function(Mt,Pt){var $t=Mt,Lt=Pt;if($t!==-1&&Lt!==-1){var Bt=getContainerCursorPosition(nt,$t,Lt);$t=Bt.x,Lt=Bt.y}var Nt=et.find(function(nr){var ar=nr.position;return ar&&Array.isArray(ar.x)&&Array.isArray(ar.y)?$t>=ar.x[0]&&$t<=ar.x[1]&&Lt>=ar.y[0]&&Lt<=ar.y[1]:ar&&!Number.isNaN(ar.x)&&!Number.isNaN(ar.y)?$t===ar.x&&Lt===ar.y:!1});if(Nt){if(Nt.type==="seek"&&Nt.position&&Array.isArray(Nt.position.x)&&Array.isArray(Nt.position.y)&&Nt.frames.length===2){var Vt=($t-Nt.position.x[0])/(Nt.position.x[1]-Nt.position.x[0]),Xt=(Lt-Nt.position.y[0])/(Nt.position.y[1]-Nt.position.y[0]);a.playSegments(Nt.frames,!0),a.goToAndStop(Math.ceil((Vt+Xt)/2*(Nt.frames[1]-Nt.frames[0])),!0)}Nt.type==="loop"&&a.playSegments(Nt.frames,!0),Nt.type==="play"&&(a.isPaused&&a.resetSegments(!1),a.playSegments(Nt.frames)),Nt.type==="stop"&&a.goToAndStop(Nt.frames[0],!0)}},Tt=function(Mt){gt(Mt.clientX,Mt.clientY)},Et=function(){gt(-1,-1)};return nt.addEventListener("mousemove",Tt),nt.addEventListener("mouseout",Et),function(){nt.removeEventListener("mousemove",Tt),nt.removeEventListener("mouseout",Et)}};switch(_){case"scroll":return c();case"cursor":return ct()}}},[_,a])},useLottieInteractivity=function e(i){var s=i.actions,a=i.mode,_=i.lottieObj,et=_.animationItem,nt=_.View,c=_.animationContainerRef;return useInitInteractivity({actions:s,animationItem:et,mode:a,wrapperRef:c}),nt},_excluded=["style","interactivity"],Lottie=function e(i){var s,a,_,et=i.style,nt=i.interactivity,c=_objectWithoutProperties(i,_excluded),ct=useLottie(c,et),dt=ct.View,gt=ct.play,Tt=ct.stop,Et=ct.pause,At=ct.setSpeed,Mt=ct.goToAndStop,Pt=ct.goToAndPlay,$t=ct.setDirection,Lt=ct.playSegments,Bt=ct.setSubframe,Nt=ct.getDuration,Vt=ct.destroy,Xt=ct.animationContainerRef,nr=ct.animationLoaded,ar=ct.animationItem;return reactExports.useEffect(function(){i.lottieRef&&(i.lottieRef.current={play:gt,stop:Tt,pause:Et,setSpeed:At,goToAndPlay:Pt,goToAndStop:Mt,setDirection:$t,playSegments:Lt,setSubframe:Bt,getDuration:Nt,destroy:Vt,animationContainerRef:Xt,animationLoaded:nr,animationItem:ar})},[(s=i.lottieRef)===null||s===void 0?void 0:s.current]),useLottieInteractivity({lottieObj:{View:dt,play:gt,stop:Tt,pause:Et,setSpeed:At,goToAndStop:Mt,goToAndPlay:Pt,setDirection:$t,playSegments:Lt,setSubframe:Bt,getDuration:Nt,destroy:Vt,animationContainerRef:Xt,animationLoaded:nr,animationItem:ar},actions:(a=nt==null?void 0:nt.actions)!==null&&a!==void 0?a:[],mode:(_=nt==null?void 0:nt.mode)!==null&&_!==void 0?_:"scroll"})};const v$1="5.7.4",fr$1=29.9700012207031,ip$1=0,op$1=210.000008553475,w$1=1e3,h$1=1e3,nm$1="Order Prepare",ddd$1=0,assets$1=[],layers$1=[{ddd:0,ind:1,ty:4,nm:"food Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:180,ix:10},p:{a:0,k:[856,836,0],ix:2,l:2},a:{a:0,k:[11,10.5,0],ix:1,l:2},s:{a:0,k:[-946.729,-946.729,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-1.539,0],[0,0],[0,1.538],[0,0]],o:[[0,0],[1.538,0],[0,0],[0,1.538]],v:[[-5.348,1.393],[5.348,1.393],[8.133,-1.393],[-8.133,-1.393]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.463355449602,.325916963465,.232582466275,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[11.995,16.497],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.029,.024],[-.117,.028],[.022,.306],[-.008,.026],[-.002,.019],[-.035,-.117],[-.124,-.297],[-.007,.007],[-.012,.019],[-.034,.014],[-.055,-.043],[.018,-.051],[.104,-.071],[.077,-.005],[.02,.005],[.145,.068]],o:[[.101,-.082],[-.134,-.281],[-.015,-.024],[.007,-.017],[.03,-.135],[.095,.31],[.008,-.007],[-.004,-.018],[-.004,-.038],[.068,-.026],[.039,.03],[-.039,.116],[-.021,.059],[-.024,.001],[-.164,.049],[-.034,-.017]],v:[[-.465,.568],[-.128,.432],[-.402,-.468],[-.415,-.548],[-.402,-.6],[-.15,-.596],[.182,.308],[.206,.289],[.215,.234],[.264,.137],[.424,.175],[.477,.303],[.251,.585],[.1,.693],[.035,.686],[-.454,.665]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.490714069441,.535409665575,.431828487621,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[16.263,11.185],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.373,.43],[.729,-.144],[.325,-.221],[-.049,-.175],[-1.283,-.751],[-.455,.413],[.229,.919]],o:[[-.457,-.526],[-.291,.059],[-1.295,.885],[.048,.176],[1.283,.75],[.455,-.413],[-.146,-.584]],v:[[1.419,-2.015],[-.478,-2.648],[-1.408,-2.247],[-2.48,-.031],[-1.152,2.042],[1.413,1.921],[2.473,-.307]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.979146082261,.656308821136,.240585072835,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[17.199,13.517],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:2,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.037,.006],[-.116,-.034],[-.13,.277],[-.02,.017],[-.011,.013],[.026,-.12],[.036,-.32],[-.011,.003],[-.019,.01],[-.035,-.004],[-.027,-.064],[.041,-.038],[.126,-.01],[.069,.033],[.015,.013],[.093,.131]],o:[[.128,-.023],[.019,-.312],[-.002,-.028],[.014,-.012],[.091,-.105],[-.069,.316],[.01,-.002],[.004,-.017],[.015,-.035],[.073,.01],[.019,.045],[-.091,.081],[-.046,.042],[-.022,-.011],[-.168,-.037],[-.022,-.03]],v:[[-.467,.339],[-.105,.385],[.094,-.536],[.12,-.611],[.158,-.65],[.376,-.525],[.225,.426],[.255,.421],[.288,.378],[.38,.318],[.501,.428],[.484,.566],[.15,.701],[-.035,.723],[-.087,.686],[-.503,.428]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.490714069441,.535409665575,.431828487621,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[7.231,10.872],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:2,cix:2,bm:0,ix:4,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.116,.557],[.706,.229],[.391,-.036],[.043,-.178],[-.755,-1.281],[-.598,.138],[-.247,.914]],o:[[-.142,-.683],[-.282,-.09],[-1.563,.141],[-.044,.178],[.755,1.28],[.598,-.139],[.158,-.581]],v:[[2.365,-.979],[1.018,-2.456],[.012,-2.558],[-2.005,-1.146],[-1.857,1.31],[.443,2.456],[2.454,1.027]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.979146082261,.656308821136,.240585072835,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[6.983,13.344],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:2,cix:2,bm:0,ix:5,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.037,-.005],[-.1,-.067],[-.209,.224],[-.025,.012],[-.014,.01],[.062,-.107],[.132,-.294],[-.011,-.001],[-.021,.003],[-.032,-.015],[-.007,-.07],[.05,-.023],[.123,.028],[.056,.053],[.01,.018],[.049,.154]],o:[[.129,.018],[.114,-.29],[.007,-.028],[.016,-.006],[.119,-.071],[-.162,.28],[.01,.001],[.008,-.016],[.025,-.029],[.067,.031],[.004,.049],[-.111,.05],[-.057,.026],[-.017,-.018],[-.148,-.087],[-.012,-.036]],v:[[-.527,.128],[-.197,.283],[.275,-.531],[.324,-.596],[.37,-.62],[.54,-.434],[.104,.426],[.135,.43],[.18,.398],[.285,.37],[.367,.512],[.309,.637],[-.051,.663],[-.234,.628],[-.273,.576],[-.59,.202]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.390436269723,.426955608293,.342077846153,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[12.69,11.329],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 6",np:2,cix:2,bm:0,ix:6,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.061,.565],[.602,.433],[.382,.086],[.096,-.155],[-.325,-1.451],[-.612,-.052],[-.516,.794]],o:[[.074,-.693],[-.241,-.174],[-1.53,-.345],[-.096,.155],[.325,1.45],[.613,.051],[.328,-.504]],v:[[2.486,-.079],[1.657,-1.898],[.73,-2.305],[-1.623,-1.581],[-2.235,.803],[-.399,2.6],[1.954,1.857]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.817884677064,.28898043165,.265481268191,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[11.782,13.429],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 7",np:2,cix:2,bm:0,ix:7,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.124,0],[-1.312,.003],[.123,-.001],[1.312,-.003]],o:[[1.312,-.004],[.123,-.001],[-1.312,.003],[-.123,0]],v:[[-1.967,.1],[1.969,.092],[1.969,-.099],[-1.967,-.091]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.951655548694,.448623597388,.329247268976,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[6.905,3.499],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 8",np:2,cix:2,bm:0,ix:8,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.124,-.002],[-1.374,-.017],[.123,.001],[1.374,.016]],o:[[1.374,.016],[.123,.001],[-1.374,-.017],[-.123,-.002]],v:[[-2.061,.096],[2.062,.096],[2.062,-.095],[-2.061,-.095]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.951655548694,.448623597388,.329247268976,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[8.64,5.812],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 9",np:2,cix:2,bm:0,ix:9,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-3.229,-7.487],[-3.229,-6.941],[-1.277,-4.63],[-1.277,7.487],[3.229,7.487],[3.229,-4.63],[1.283,-6.941],[1.283,-7.487]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.986887254902,.735047942517,.48431486242,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[7.815,10.403],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 10",np:2,cix:2,bm:0,ix:10,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-.324,-7.214],[-2.467,-4.902],[-2.467,7.214],[2.467,7.214],[2.467,-4.902]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.958784335267,.52412516276,.43046913895,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[4.911,10.676],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 11",np:2,cix:2,bm:0,ix:11,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0},{ddd:0,ind:2,ty:4,nm:"kitchen Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[488,856,0],ix:2,l:2},a:{a:0,k:[44.5,23,0],ix:1,l:2},s:{a:0,k:[1259.236,1259.236,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.142,.004],[-4.785,.116],[.142,-.003],[4.785,-.116]],o:[[4.785,-.116],[.142,-.004],[-4.785,.117],[-.142,.004]],v:[[-7.178,.176],[7.178,.044],[7.178,-.177],[-7.178,-.045]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[1,.999998743394,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[24.813,25.109],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:4,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.362,0],[0,0],[0,-.361],[0,-.226],[-.002,-.108],[-.153,0],[-.043,-.18],[-.568,0],[0,0],[-.131,.552],[-.185,0],[0,0],[-.043,-.18],[-.568,0],[0,0],[-.131,.552],[-.185,0],[0,0],[-.043,-.18],[-.567,0],[0,0],[-.131,.552],[-.185,0],[-.101,.002],[.001,.055],[0,.123],[0,0]],o:[[0,0],[-.362,0],[0,.226],[0,.108],[.004,.235],[.185,0],[.131,.552],[0,0],[.567,0],[.043,-.18],[0,0],[.185,0],[.131,.552],[0,0],[.567,0],[.043,-.18],[0,0],[.185,0],[.131,.552],[0,0],[.567,0],[.043,-.18],[.102,0],[.047,-.001],[-.002,-.117],[0,0],[0,-.361]],v:[[7.191,-1.53],[-7.187,-1.53],[-7.842,-.875],[-7.846,-.198],[-7.844,.127],[-7.418,.28],[-7.029,.587],[-5.837,1.53],[-4.068,1.53],[-2.877,.587],[-2.488,.28],[-2.463,.28],[-2.074,.587],[-.882,1.53],[.887,1.53],[2.078,.587],[2.467,.28],[2.492,.28],[2.881,.587],[4.072,1.53],[5.842,1.53],[7.033,.587],[7.422,.28],[7.765,.28],[7.845,.227],[7.846,-.266],[7.846,-.875]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.357465945973,.368503884708,.606296015721,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[24.777,25.377],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:4,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,1.152],[-1.152,0],[0,-1.152],[1.152,0]],o:[[0,-1.152],[1.152,0],[0,1.152],[-1.152,0]],v:[[-2.087,.674],[.001,-2.76],[2.087,.674],[.001,2.76]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.947452859318,.905771651922,.884520227769,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[29.724,23.848],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:4,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,1.152],[-1.152,0],[0,-1.152],[1.152,0]],o:[[0,-1.152],[1.152,0],[0,1.152],[-1.152,0]],v:[[-2.087,.674],[.001,-2.76],[2.087,.674],[.001,2.76]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.947452859318,.905771651922,.884520227769,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[24.771,23.848],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:4,cix:2,bm:0,ix:4,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,1.152],[-1.152,0],[0,-1.152],[1.153,0]],o:[[0,-1.152],[1.153,0],[0,1.152],[-1.152,0]],v:[[-2.087,.674],[-.001,-2.76],[2.087,.674],[-.001,2.76]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.947452859318,.905771651922,.884520227769,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[19.818,23.848],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:4,cix:2,bm:0,ix:5,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-1.649,0],[0,0],[0,1.649],[0,0]],o:[[0,0],[1.649,0],[0,0],[0,1.649]],v:[[-5.734,1.493],[5.734,1.493],[8.721,-1.493],[-8.721,-1.493]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.914726526597,.817986462163,.791576071347,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[20.7,25.413],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 6",np:4,cix:2,bm:0,ix:6,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[4.002,-.297],[0,0],[2.52,-1.482],[0,0],[-.741,-2.075],[0,0]],o:[[0,0],[-4.002,.296],[0,0],[-2.519,1.482],[0,0],[.741,2.074],[0,0]],v:[[5.633,4.743],[3.26,-4.594],[.445,.001],[-3.41,-4.299],[-2.223,1.779],[-6.521,1.482],[-1.482,5.781]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.205477456486,.468678672641,.326348368327,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[16.21,19.711],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 7",np:4,cix:2,bm:0,ix:7,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[3.557,.444],[0,0],[3.408,.593],[0,0]],o:[[0,0],[-3.558,-.446],[0,0],[-3.409,-.593],[0,0]],v:[[.592,4.372],[2.372,-1.408],[-2.965,1.408],[-2.52,-4.372],[-5.337,4.965]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.662919646618,.737403959386,.547142238243,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[27.094,20.527],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 8",np:4,cix:2,bm:0,ix:8,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.152,-.06],[.2,-.129],[.205,-.146],[-.214,.13],[-.21,.141],[-.168,.17]],o:[[-.222,.087],[-.212,.138],[-.197,.14],[.216,-.13],[.197,-.13],[.102,-.104]],v:[[.598,-.587],[-.023,-.229],[-.656,.187],[-.462,.517],[.171,.1],[.751,-.325]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.849499511719,.431366355746,.265743719363,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[23.803,20.639],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 9",np:4,cix:2,bm:0,ix:9,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.164,-.094],[.272,-.186],[.233,-.205],[-.181,.104],[-.269,.188],[-.232,.207]],o:[[-.287,.162],[-.256,.174],[-.162,.143],[.284,-.164],[.255,-.176],[.146,-.13]],v:[[.699,-.697],[-.126,-.15],[-.889,.392],[-.661,.687],[.154,.123],[.904,-.431]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.849499511719,.431366355746,.265743719363,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[22.315,18.117],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 10",np:4,cix:2,bm:0,ix:10,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.131,-.029],[.266,-.164],[.293,-.182],[-.217,.136],[-.292,.185],[-.198,.245]],o:[[-.307,.069],[-.294,.181],[-.217,.134],[.292,-.183],[.265,-.166],[.078,-.097]],v:[[.872,-.719],[.021,-.275],[-.857,.271],[-.659,.612],[.219,.062],[.997,-.506]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.849499511719,.431366355746,.265743719363,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[20.644,16.034],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 11",np:4,cix:2,bm:0,ix:11,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.184,-.053],[.823,-.124],[-.248,.039],[-.709,.371]],o:[[-.779,.223],[-.25,.037],[.814,-.122],[.171,-.09]],v:[[1.032,-.712],[-1.083,.348],[-.978,.725],[1.162,-.402]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.849499511719,.431366355746,.265743719363,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[19.196,14.264],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 12",np:4,cix:2,bm:0,ix:12,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[1.436,-1.017],[-.442,-.499],[-.537,-1.014],[-.585,.211],[.238,1.763],[1.064,1.306]],o:[[0,0],[-1.436,1.017],[.442,.499],[.537,1.014],[.584,-.212],[-.239,-1.763],[-1.064,-1.304]],v:[[-1.186,-5.635],[-3.492,-5.848],[-3.574,-2.514],[1.419,3.148],[4.344,6.654],[4.245,3.975],[2.124,-1.029]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.963083543964,.543955485026,.24977164175,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[20.841,18.166],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 13",np:4,cix:2,bm:0,ix:13,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[.406,1.771],[.381,-.562],[-.375,-1.198],[0,0],[.902,.12],[-.306,-.454],[-.897,-1.155],[.657,-.907],[-1.423,-1.051],[0,0],[1.218,.798],[.188,-.618],[-1.528,-.587],[0,0]],o:[[0,0],[-.237,-1.034],[-.381,.56],[.302,.966],[0,0],[-.903,-.121],[1.021,1.514],[0,0],[-.657,.906],[1.091,.807],[0,0],[-1.834,-1.201],[-.256,.839],[3.404,1.308],[0,0]],v:[[4.495,4.184],[3.042,.309],[1.346,-4.762],[2.135,-.371],[3.456,3.479],[-.413,-2.473],[.516,.087],[3.115,3.74],[-3.837,-1.477],[-.02,1.755],[3.43,4.518],[1.874,3.154],[-3.342,1.113],[-.283,2.825],[3.516,5.324]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.231436187146,.400447022681,.341441554649,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[13.884,8.267],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 14",np:4,cix:2,bm:0,ix:14,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[-2.637,3.538],[2.637,-3.538]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[.800162221871,.915541884478,.902066518746,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:1.301,ix:5},lc:2,lj:1,ml:10,bm:0,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[22.509,13.632],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 15",np:2,cix:2,bm:0,ix:15,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[-3.013,3.938],[3.013,-3.938]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[.800162221871,.915541884478,.902066518746,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:1.301,ix:5},lc:2,lj:1,ml:10,bm:0,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[22.863,14.876],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 16",np:2,cix:2,bm:0,ix:16,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[3.462,5.095],[-3.463,5.095],[-3.463,-5.095],[3.462,-5.095]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.800162221871,.915541884478,.902066518746,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[22.898,18.724],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 17",np:4,cix:2,bm:0,ix:17,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-4,-7.738],[4,-7.738],[4,7.738],[-4,7.738]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.702359307981,.876050163718,.851058660769,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[22.898,16.471],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 18",np:4,cix:2,bm:0,ix:18,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[9.784,.202],[-9.784,.202],[-9.784,-.202],[9.784,-.202]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.85749021044,.941752893784,.95355164771,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[45.536,13.431],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 19",np:4,cix:2,bm:0,ix:19,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[5.337,0],[0,0],[0,5.338],[0,0],[0,0],[0,0]],o:[[0,0],[-5.337,0],[0,0],[0,0],[0,0],[0,5.338]],v:[[.001,5.782],[.001,5.782],[-9.665,-3.883],[-9.665,-5.782],[9.665,-5.782],[9.665,-3.883]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.589915017521,.776821420707,.782229554419,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[45.568,19.179],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 20",np:4,cix:2,bm:0,ix:20,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.043,-.046],[.318,-1.062],[0,0],[-1.019,.441],[-.063,.034],[-.059,.04],[-.058,.106],[.168,.124],[.253,-.036],[.212,-.049],[.02,.055],[-.846,.279],[-.263,.051],[-.172,-.005],[-.154,-.11],[-.036,-.2],[.097,-.167],[.311,-.134],[.819,-.138],[0,0],[0,0]],o:[[.043,.045],[0,0],[.77,-.183],[.078,-.032],[.07,-.031],[.116,-.081],[.13,-.21],[-.168,-.131],[-.247,.034],[-.846,.204],[-.019,-.049],[.212,-.067],[.137,-.023],[.163,.007],[.154,.107],[.038,.201],[-.19,.345],[-1.049,.453],[0,0],[0,0],[.421,-1.121]],v:[[-1.228,-.579],[-1.684,1.255],[-1.861,1.051],[.914,.113],[1.128,.014],[1.316,-.098],[1.59,-.38],[1.51,-.947],[.849,-1.027],[.159,-.893],[-1.228,-.579],[.084,-1.165],[.794,-1.352],[1.228,-1.4],[1.725,-1.245],[2.038,-.762],[1.929,-.186],[1.072,.479],[-1.805,1.359],[-2.076,1.406],[-1.982,1.154]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[56.21,15.794],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 21",np:4,cix:2,bm:0,ix:21,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.043,.045],[-.42,-1.121],[0,0],[0,0],[1.05,.454],[.19,.347],[-.04,.2],[-.155,.106],[-.163,.005],[0,0],[0,0],[-.065,-.005],[-.208,-.075],[-.222,-.109],[.022,-.017],[.223,.059],[.4,.117],[.247,.005],[.066,.002],[0,0],[0,0],[.081,-.066],[-.128,-.21],[-.296,-.125],[-.77,-.183],[0,0]],o:[[.043,-.046],[0,0],[0,0],[-.821,-.138],[-.313,-.135],[-.095,-.169],[.037,-.201],[.155,-.11],[0,0],[0,0],[.067,.005],[.272,.021],[.421,.154],[.237,.117],[-.022,.017],[-.262,-.077],[-.211,-.056],[-.064,-.002],[0,0],[0,0],[-.108,.009],[-.169,.122],[.122,.219],[1.02,.443],[0,0],[-.319,-1.062]],v:[[1.228,-.581],[1.981,1.152],[2.076,1.402],[1.805,1.357],[-1.076,.475],[-1.933,-.193],[-2.036,-.771],[-1.719,-1.253],[-1.22,-1.402],[-1.099,-1.4],[-1,-1.393],[-.802,-1.376],[-.067,-1.206],[.899,-.792],[1.228,-.581],[.844,-.646],[-.151,-.938],[-.824,-1.046],[-1.02,-1.053],[-1.123,-1.057],[-1.207,-1.053],[-1.507,-.952],[-1.593,-.385],[-.918,.109],[1.86,1.049],[1.684,1.253]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[34.619,15.796],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 22",np:4,cix:2,bm:0,ix:22,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-14.547,-.924],[14.547,-.924],[14.547,.924],[-14.547,.924]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[47.64,25.859],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 23",np:2,cix:2,bm:0,ix:23,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[35.501,.88],[-35.501,.88],[-35.501,-.881],[35.501,-.881]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.942020730411,.806368300494,.335119030522,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[46.752,27.61],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 24",np:2,cix:2,bm:0,ix:24,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0},{ddd:0,ind:3,ty:4,nm:"Shape Layer 6",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[482,520,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[41.54,30.042,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:16,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:40,s:[0]},{t:63.0000025660426,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:16.0000006516934,op:67.0000027289659,st:16.0000006516934,bm:0},{ddd:0,ind:4,ty:4,nm:"Shape Layer 5",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[482,520,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[41.54,30.042,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:133,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:157,s:[0]},{t:180.00000733155,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:133.000005417201,op:184.000007494474,st:133.000005417201,bm:0},{ddd:0,ind:5,ty:4,nm:"Shape Layer 4",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[534,652,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[58.824,42.542,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:114,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:138,s:[0]},{t:161.000006557664,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:114.000004643315,op:165.000006720588,st:114.000004643315,bm:0},{ddd:0,ind:6,ty:4,nm:"Shape Layer 3",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[462,690,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[82.353,59.559,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:84,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:108,s:[0]},{t:131.000005335739,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:84.0000034213901,op:135.000005498663,st:84.0000034213901,bm:0},{ddd:0,ind:7,ty:4,nm:"Shape Layer 7",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[534,520,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[48.453,35.042,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:42,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:66,s:[0]},{t:89.0000036250443,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:42.0000017106951,op:93.0000037879676,st:42.0000017106951,bm:0},{ddd:0,ind:8,ty:4,nm:"Shape Layer 2",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[552,676,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[58.824,42.542,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:30,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:54,s:[0]},{t:77.0000031362743,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:30.0000012219251,op:81.0000032991976,st:30.0000012219251,bm:0},{ddd:0,ind:9,ty:4,nm:"Shape Layer 1",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[462,690,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[82.353,59.559,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:0,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:24,s:[0]},{t:47.0000019143492,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:51.0000020772726,st:0,bm:0},{ddd:0,ind:10,ty:4,nm:"KC Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[496,670,0],ix:2,l:2},a:{a:0,k:[10.303,22.837,0],ix:1,l:2},s:{a:0,k:[1224.359,1224.359,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.023,.022],[.082,.457],[.72,.417],[.493,.095],[.594,.051],[.661,.192],[.551,.548],[.131,.362],[0,0],[0,0],[-.167,.043],[-.125,-.035],[-.101,-.097],[-.019,-.167],[.176,-.146],[.209,-.022],[.248,.176],[.211,.169],[.674,.391],[-.021,.112],[-.448,-.065],[-.739,-.358],[-.855,-.649],[-.32,.051],[-.05,.046],[-.007,.018],[-.002,.008],[-.002,.004],[0,0],[0,0],[.039,.002],[0,0],[0,0],[.024,-.013],[.012,.001],[.023,.007],[.006,.001],[.003,.009],[.009,.021],[-.091,-.028],[0,0],[-.222,-.221],[-.58,-.177],[-.59,-.073],[-.829,-.545],[-.01,-.552]],o:[[-.057,-.022],[-.082,-.445],[-.348,-.2],[-.498,-.096],[-.59,-.056],[-.653,-.191],[-.285,-.284],[0,0],[0,0],[.039,-.171],[.167,-.053],[.125,.037],[.101,.094],[.032,.309],[-.18,.146],[-.452,.028],[-.245,-.186],[-.824,-.672],[-1.348,-.791],[.004,-.038],[.448,.062],[.741,.355],[.424,.306],[.081,-.01],[.026,-.022],[.004,-.008],[0,-.004],[0,0],[0,0],[-.009,0],[0,0],[0,0],[.002,-.001],[-.026,.018],[-.009,-.009],[-.012,-.002],[-.003,-.001],[-.003,-.022],[-.026,-.078],[0,0],[.098,.265],[.425,.427],[.579,.179],[1.172,.129],[.811,.548],[.001,.564]],v:[[7.036,3.92],[7.035,3.175],[5.848,1.687],[4.546,1.251],[2.902,1.057],[1.003,.754],[-.881,-.289],[-1.525,-1.285],[-1.56,-1.383],[-1.532,-1.502],[-1.152,-1.895],[-.719,-1.897],[-.379,-1.702],[-.171,-1.297],[-.471,-.602],[-1.062,-.364],[-2.074,-.722],[-2.723,-1.245],[-4.969,-2.872],[-7.286,-3.878],[-6.583,-3.877],[-4.749,-3.286],[-2.34,-1.734],[-1.126,-1.03],[-.908,-1.122],[-.859,-1.184],[-.851,-1.208],[-.85,-1.22],[-.85,-1.222],[-.85,-1.223],[-.805,-1.222],[-.805,-1.221],[-.799,-1.221],[-.833,-1.207],[-.853,-1.204],[-.909,-1.233],[-.936,-1.237],[-.941,-1.24],[-.954,-1.299],[-.921,-1.325],[-.872,-1.525],[-.383,-.782],[1.199,.097],[2.971,.416],[6.109,1.268],[7.305,3.147]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[25.25,33.084],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.02,.082],[-1.456,.72],[-.294,.308],[-.057,.089],[-.018,.067],[.002,.004],[.085,.003],[.09,-.034],[.107,-.064],[.232,-.178],[.5,-.382],[.067,-.051],[0,0],[-.395,.944],[0,0],[-.008,.03],[-.001,-.006],[-.045,-.01],[.023,-.008],[.043,-.032],[.083,-.073],[.232,-.307],[.226,-.382],[.044,.019],[-.151,.424],[-.441,.701],[-.37,.339],[-.101,.083],[-.093,.04],[-.173,-.071],[-.012,-.129],[.02,-.089],[.021,-.064],[0,0],[.861,-.942],[0,0],[-.073,.056],[-.474,.359],[-.272,.15],[-.17,.062],[-.189,-.011],[-.169,-.215],[.066,-.167],[.084,-.12],[.099,-.094],[.388,-.165]],o:[[-.03,-.104],[.355,-.182],[.073,-.077],[.057,-.086],[.02,-.074],[.004,-.001],[-.084,-.003],[-.091,.037],[-.224,.131],[-.472,.362],[-.073,.056],[0,0],[.802,-.873],[0,0],[.024,-.06],[.012,-.036],[-.005,.003],[.055,.019],[-.021,.008],[-.091,.068],[-.34,.279],[-.462,.619],[-.223,.385],[-.043,-.02],[.154,-.422],[.222,-.349],[.089,-.088],[.051,-.042],[.09,-.039],[.163,.058],[.02,.133],[-.024,.095],[0,0],[-.387,1.025],[0,0],[.067,-.052],[.502,-.379],[.24,-.178],[.141,-.077],[.174,-.058],[.181,.018],[.165,.208],[-.063,.178],[-.084,.118],[-.4,.375],[-1.562,.628]],v:[[-2.026,2.324],[.383,1.201],[1.412,.495],[1.609,.247],[1.742,-.012],[1.74,-.096],[1.609,-.128],[1.332,-.079],[1.006,.085],[.328,.559],[-1.13,1.678],[-1.343,1.84],[-1.813,1.327],[-.025,-1.469],[.047,-1.646],[.105,-1.796],[.119,-1.861],[.197,-1.775],[.248,-1.768],[.154,-1.712],[-.112,-1.508],[-.961,-.605],[-1.952,.965],[-2.358,1.54],[-2.194,.852],[-1.361,-.883],[-.489,-1.939],[-.197,-2.189],[.022,-2.322],[.436,-2.335],[.727,-1.958],[.709,-1.641],[.639,-1.424],[.568,-1.232],[-1.297,1.799],[-1.766,1.285],[-1.553,1.122],[-.086,.014],[.676,-.495],[1.113,-.699],[1.65,-.771],[2.236,-.486],[2.327,.178],[2.099,.59],[1.82,.906],[.59,1.65]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[26.03,30.112],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.052,-.067],[.378,-.874],[.406,-1.445],[.194,.036],[-.812,2.916],[-.544,.882]],o:[[.075,.077],[-.393,.863],[-.803,2.881],[-.186,-.034],[.408,-1.445],[.53,-.889]],v:[[1.768,-5.097],[1.061,-3.693],[-.066,-.076],[-1.658,5.128],[-.74,-.264],[.622,-3.921]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[7.225,5.987],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,84.544],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:2,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.195,.027],[-.558,2.513],[-.181,-.056],[.547,-2.484]],o:[[-.187,-.025],[.554,-2.515],[.188,.058],[-.552,2.482]],v:[[-1,4.533],[-.501,-.096],[.999,-4.504],[.182,.055]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[17.624,6.314],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,85.892],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:2,cix:2,bm:0,ix:4,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-8.269,-16.731],[3.045,-16.953],[4.154,2.348],[11.919,16.768],[-11.919,16.953],[-11.027,4.783]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.308235318053,.185718865488,.029252067267,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 2",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"fl",c:{a:0,k:[.308235318053,.185718865488,.029252067267,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[13.684,27.153],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:3,cix:2,bm:0,ix:5,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0},{ddd:0,ind:11,ty:4,nm:"tshirt Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[556,604,0],ix:2,l:2},a:{a:0,k:[11.5,14,0],ix:1,l:2},s:{a:0,k:[1373.215,1457.36,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0],[.08,-.09],[.05,-.059],[0,0],[-.08,.02],[-.56,0],[-.17,-.01],[0,0],[-2.27,-.21],[-.045,.103],[0,0],[0,0],[0,0],[.19,.021]],o:[[0,0],[0,0],[0,0],[-.08,.09],[-.05,.05],[0,0],[.08,-.031],[.71,-.219],[.2,0],[0,0],[.22,.779],[1.59,.149],[0,0],[0,0],[0,0],[-.3,-.04],[0,0]],v:[[2.975,2.332],[10.153,19.034],[-12.271,19.906],[-12.882,19.586],[-7.296,.711],[-7.296,.711],[-7.933,-12.294],[-7.703,-12.365],[-6.47,-12.655],[-5.92,-12.635],[-3.693,-12.424],[-.859,-10.1],[2.611,-11.841],[4.155,-12.498],[7.063,-12.338],[2.935,1.952],[2.935,1.952]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.942710487515,.347555332558,.257082142549,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[9.953,14.526],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0},{ddd:0,ind:12,ty:4,nm:"hand1 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:1,k:[{i:{x:[.833],y:[1]},o:{x:[.167],y:[.167]},t:10,s:[0]},{i:{x:[.833],y:[.938]},o:{x:[.167],y:[0]},t:30,s:[-14]},{i:{x:[.833],y:[2.491]},o:{x:[.167],y:[1.464]},t:71,s:[0]},{i:{x:[.833],y:[1]},o:{x:[.167],y:[.06]},t:140,s:[0]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[0]},t:179,s:[-14]},{t:210.000008553475,s:[0]}],ix:10},p:{a:0,k:[448,460,0],ix:2,l:2},a:{a:0,k:[25.542,17.296,0],ix:1,l:2},s:{a:0,k:[694.636,694.636,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.018,.073],[-.433,.033],[-.118,.01],[-.039,-.012],[.021,-.047],[.075,-.033],[.209,-.021]],o:[[-.018,-.069],[.214,-.02],[.117,-.003],[.015,.008],[-.02,.049],[-.151,.067],[-.415,.032]],v:[[-.742,.121],[.008,-.123],[.533,-.145],[.738,-.182],[.738,-.098],[.585,.035],[.031,.142]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[9.865,15.034],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[.018,.923],[-.341,.196],[-.107,-.401],[0,0],[.605,-.7],[0,0],[.143,-.275],[0,0],[-.216,-1.579],[0,0]],o:[[-.379,-1.524],[-.016,-.814],[1.408,-.812],[.087,.328],[0,0],[-.323,.373],[0,0],[-.255,.488],[0,0],[.157,1.148],[0,0]],v:[[-2.528,3.295],[-2.953,-1.622],[-2.099,-2.986],[2.278,-3.985],[-.106,-2.857],[2.364,-2.663],[.313,-2.144],[2.046,-1.671],[.248,-1.25],[1.206,.953],[-.992,4.386]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.985606414197,.768474563898,.65874077292,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[10.351,16.075],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.11,.241],[-.286,-.306],[-1.49,-2.398],[0,0],[0,0],[2.32,2.076],[0,0],[3.391,2.803]],o:[[.174,-.381],[1.322,1.407],[2.112,3.399],[0,0],[0,0],[-1.756,-1.571],[0,0],[-.205,-.169]],v:[[-8.162,-9.56],[-7.198,-9.719],[-1.422,-2.374],[2.089,3.253],[8.272,8.593],[3.338,7.949],[.765,3.598],[-8.005,-8.867]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.436724404728,.356003615435,.281163144579,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[13.538,16.769],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:2,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.192,-.159],[-.003,.41],[.534,-.6]],o:[[.286,-.301],[.004,-.724],[.224,.143]],v:[[-.249,1.176],[.878,-.451],[-.883,.725]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.972558414235,.642884018842,.502590284161,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[10.793,11.983],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:2,cix:2,bm:0,ix:4,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.108,.028],[-.668,2.188],[-.101,-.037],[.663,-2.182]],o:[[-.105,-.026],[.666,-2.192],[.106,.037],[-.665,2.179]],v:[[-1.206,3.958],[-.268,-.077],[1.204,-3.95],[.113,.04]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[10.47,26.425],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:2,cix:2,bm:0,ix:5,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[.474,-1.203],[0,0],[0,0],[4.94,0],[-4.81,9.181],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[-.07,.101],[-1.15,1.42],[-.32,.38],[-.48,.51],[-1.37,-.12]],o:[[0,0],[1.29,.094],[0,0],[0,0],[-4.24,4.47],[-2.86,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[.08,-.1],[1.35,-1.75],[.35,-.41],[2.07,-2.52],[2.14,-2.231],[0,0]],v:[[11.266,-12.46],[11.266,-12.46],[12.91,-9.845],[10.229,-3.038],[8.516,.75],[-8.395,12.57],[-8.574,-3.731],[-7.895,-3.65],[-3.064,-3.061],[-2.514,-2.99],[-2.674,-2.44],[-2.674,-2.43],[-3.624,.95],[-3.395,.649],[.396,-4.13],[1.385,-5.32],[5.445,-10.08],[11.266,-12.45]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.980392216701,.654901960784,.239215701234,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[14.156,25.207],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 6",np:2,cix:2,bm:0,ix:6,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-2.505,2.066],[-.993,-2.624],[2.505,-1.432],[2.346,2.624]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.985606414197,.768474563898,.65874077292,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[8.745,19.546],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 7",np:2,cix:2,bm:0,ix:7,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0},{ddd:0,ind:13,ty:4,nm:"hand Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:1,k:[{i:{x:[.833],y:[1.012]},o:{x:[.167],y:[.167]},t:10,s:[0]},{i:{x:[.833],y:[1]},o:{x:[.167],y:[.013]},t:23,s:[-12]},{i:{x:[.833],y:[.989]},o:{x:[.167],y:[0]},t:40,s:[2]},{i:{x:[.833],y:[1]},o:{x:[.167],y:[-.015]},t:70,s:[-12]},{i:{x:[.833],y:[1.012]},o:{x:[.167],y:[0]},t:104,s:[0]},{i:{x:[.833],y:[.953]},o:{x:[.167],y:[.013]},t:117,s:[-12]},{i:{x:[.833],y:[.149]},o:{x:[.167],y:[-.673]},t:134,s:[2]},{i:{x:[.833],y:[1.009]},o:{x:[.167],y:[.053]},t:169,s:[0]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.016]},t:182,s:[-12]},{t:210.000008553475,s:[2]}],ix:10},p:{a:0,k:[618,468,0],ix:2,l:2},a:{a:0,k:[4.382,27.179,0],ix:1,l:2},s:{a:0,k:[690.078,690.078,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.08,-.07],[.78,.45],[0,.12],[0,0],[-.2,-.03],[-.51,-.301]],o:[[-.08,.08],[-.76,-.451],[0,0],[.01,-.04],[.31,.05],[.84,.489]],v:[[1.395,.83],[-.025,-.03],[-1.475,-.851],[-1.475,-.86],[-1.135,-.88],[.175,-.38]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[18.85,24.454],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.05,0],[.45,.931],[-.08,.08],[-.01,0],[-.23,-.22],[-.24,-.52],[-.01,-.37]],o:[[-.12,0],[-.43,-.96],[0,-.01],[.07,0],[.27,.25],[.23,.51],[.02,.37]],v:[[.795,1.74],[.155,-.071],[-.815,-1.73],[-.795,-1.74],[-.305,-1.41],[.525,-.24],[.875,1.15]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[17.509,25.384],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.08,-.07],[.78,.45],[0,.12],[-.11,.02],[-.51,-.301]],o:[[-.08,.08],[-.76,-.451],[.12,0],[.31,.05],[.84,.489]],v:[[1.395,.815],[-.025,-.045],[-1.475,-.866],[-1.135,-.895],[.175,-.395]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.942710487515,.347555332558,.257082142549,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[18.85,24.469],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:2,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.01,-.37],[.05,0],[.45,.931],[-.08,.08],[-.01,0],[-.23,-.219],[-.24,-.519]],o:[[.02,.37],[-.12,0],[-.43,-.96],[0,-.011],[.07,0],[.27,.25],[.23,.511]],v:[[.875,1.15],[.795,1.74],[.155,-.07],[-.815,-1.73],[-.795,-1.74],[-.305,-1.411],[.525,-.24]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.942710487515,.347555332558,.257082142549,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[17.509,25.384],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:2,cix:2,bm:0,ix:4,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-1.561,-1.339],[.512,-1.321],[3.378,-2.096],[4.406,.418],[.286,1.448],[0,0],[-2.639,.537],[-4.33,.151],[0,-.011],[-.431,-.96],[-.119,0],[.02,.37],[.23,.511],[.27,.25],[.071,0],[-.209,.021],[-.76,-.451],[-.08,.08],[.84,.489],[.31,.05],[-.549,.26],[-1.564,2.58]],o:[[1.075,.923],[-1.429,3.689],[-3.289,2.028],[-1.469,-.139],[0,0],[-1.85,-1.955],[2.009,-.09],[-.009,0],[-.08,.08],[.449,.931],[.05,0],[-.01,-.37],[-.241,-.519],[-.23,-.219],[.23,-.009],[0,.12],[.78,.45],[.079,-.07],[-.509,-.301],[.77,-.08],[2.082,-.978],[1.067,-1.758]],v:[[14.605,-8.695],[15.548,-4.958],[7.615,8.005],[-8.247,9.176],[-13.059,7.398],[-14.615,5.064],[-11.895,-1.865],[.654,-.546],[.635,-.535],[1.605,1.124],[2.245,2.936],[2.325,2.346],[1.975,.954],[1.146,-.215],[.654,-.546],[1.314,-.585],[2.764,.236],[4.186,1.096],[2.965,-.115],[1.654,-.615],[3.654,-1.105],[9.585,-7.906]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.980392216701,.654901960784,.239215701234,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[16.059,24.189],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:4,cix:2,bm:0,ix:5,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[6.865,-5.361],[2.371,-.85],[.445,2.622],[-1.907,1.299],[-.965,1.886],[-.048,.099],[0,0],[-.1,.299],[0,0],[-.093,-1.255],[0,0],[-.652,-.144],[.388,-.451],[0,0],[-.596,-.289],[.71,-.729],[0,0],[-.292,-.157],[.341,-.69],[-.095,-.445],[.873,-2.244],[.098,-.281],[0,0]],o:[[-1.942,1.516],[-.682,-2.58],[1.853,-.383],[2.898,-1.975],[.048,-.099],[0,0],[0,0],[.252,-.75],[0,0],[.092,1.256],[0,0],[.243,.055],[-.387,.449],[0,0],[0,0],[-.985,1.011],[0,0],[.486,.259],[0,0],[.091,.426],[-.065,.22],[0,0],[0,0]],v:[[-2.185,10.463],[-9.046,13.991],[-10.773,6.192],[-4.989,3.815],[2.732,-7.339],[2.877,-7.636],[2.87,-7.639],[3.718,-9.918],[4.277,-12.523],[4.918,-11.449],[5.227,-10.566],[8.155,-13.847],[7.762,-12.559],[6.974,-11.407],[9.79,-13.572],[9.376,-12.654],[7.744,-10.723],[10.287,-12.523],[8.152,-9.578],[9.932,-10.722],[7.226,-6.375],[6.982,-5.622],[6.983,-5.623]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.985606414197,.768474563898,.65874077292,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[25.793,18.914],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 6",np:2,cix:2,bm:0,ix:6,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0},{ddd:0,ind:14,ty:4,nm:"face Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:1,k:[{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:10,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:26,s:[-8]},{i:{x:[.833],y:[.667]},o:{x:[.167],y:[0]},t:56,s:[5]},{i:{x:[.667],y:[1]},o:{x:[.167],y:[.063]},t:109,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:125,s:[-8]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[0]},t:155,s:[5]},{t:183.000007453743,s:[0]}],ix:10},p:{a:0,k:[517.87,475.474,0],ix:2,l:2},a:{a:0,k:[8.573,24.351,0],ix:1,l:2},s:{a:0,k:[920.358,920.358,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.029,-3.684],[-4.085,2.337],[-3.963,2.856],[-.591,-.176],[0,0],[3.321,1.146]],o:[[0,0],[0,0],[0,0],[0,0],[0,0],[-3.32,-1.147]],v:[[-5.445,-1.27],[1.66,-2.955],[4.146,2.136],[5.288,1.89],[5.445,1.941],[1.903,-4.602]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[9.162,6.131],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.068,-.187],[.331,-.114],[.069,.187],[-.332,.114]],o:[[.068,.187],[-.332,.115],[-.068,-.188],[.331,-.115]],v:[[.6,-.208],[.124,.339],[-.6,.208],[-.123,-.339]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[4.026,5.924],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.03,-.196],[.348,.055],[-.03,.195],[-.348,-.055]],o:[[-.03,.195],[-.349,-.055],[.03,-.197],[.348,.055]],v:[[.63,.1],[-.055,.355],[-.631,-.098],[.055,-.355]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[8.83,6.348],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:2,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[-.02,-.239],[-.034,-.095],[-.025,.001],[-.08,.068],[-.074,.093],[-.131,.212],[0,0],[-.062,-.038],[.018,-.056],[.153,-.233],[.118,-.105],[.089,-.036],[.112,.034],[.057,.079],[.021,.076],[-.003,.139],[-.079,.26],[-.059,-.019],[.002,-.05]],o:[[-.009,.25],[.013,.119],[.034,.099],[.016,.009],[.08,-.063],[.146,-.189],[0,0],[.039,-.062],[.053,.033],[-.082,.26],[-.076,.117],[-.061,.052],[-.089,.037],[-.111,-.03],[-.058,-.08],[-.041,-.154],[.006,-.28],[.018,-.059],[.05,.014],[0,0]],v:[[-.447,-.758],[-.438,-.012],[-.374,.318],[-.268,.462],[-.102,.385],[.128,.139],[.544,-.478],[.548,-.482],[.73,-.525],[.786,-.372],[.445,.365],[.163,.699],[-.057,.837],[-.378,.859],[-.641,.674],[-.753,.437],[-.801,.001],[-.667,-.801],[-.527,-.874],[-.447,-.764]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[3.903,7.829],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:2,cix:2,bm:0,ix:4,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[-.04,-.248],[-.137,-.033],[-.176,.179],[-.15,.215],[0,0],[-.06,-.042],[.022,-.056],[.198,-.232],[.151,-.087],[.198,.074],[.065,.156],[.009,.151],[-.079,.281],[-.059,-.017],[.002,-.051]],o:[[-.008,.265],[.038,.249],[.122,.054],[.175,-.178],[0,0],[.042,-.061],[.052,.036],[-.108,.273],[-.099,.114],[-.146,.084],[-.196,-.069],[-.069,-.158],[-.017,-.303],[.017,-.06],[.051,.013],[0,0]],v:[[-.616,-.813],[-.578,-.025],[-.301,.482],[.208,.232],[.7,-.378],[.704,-.383],[.888,-.417],[.936,-.26],[.493,.497],[.129,.807],[-.436,.872],[-.837,.48],[-.941,.014],[-.836,-.852],[-.698,-.93],[-.616,-.818]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[8.288,8.359],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:2,cix:2,bm:0,ix:5,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.116,.336],[.045,-.175],[.088,-.156],[.273,-.235],[0,0],[-.269,-.25],[.322,.162],[0,0],[0,0],[-.104,.129],[-.095,.135]],o:[[.045,.175],[-.046,.178],[-.182,.312],[0,0],[.296,.206],[-.348,-.12],[0,0],[0,0],[.105,-.125],[.102,-.134],[.194,-.272]],v:[[.592,-1.156],[.57,-.617],[.358,-.117],[-.324,.701],[-.35,.486],[.505,1.156],[-.491,.721],[-.637,.648],[-.517,.505],[-.204,.115],[.098,-.285]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[5.41,8.245],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 6",np:2,cix:2,bm:0,ix:6,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.062,.195],[-.159,-.063],[-.138,.002],[-.152,.07],[-.176,.107],[.156,-.15],[.243,.002],[.153,.143]],o:[[.192,.083],[.157,.067],[.138,.001],[.151,-.071],[-.034,.205],[-.15,.152],[-.243,0],[-.162,-.139]],v:[[-.928,-.365],[-.421,-.122],[.019,-.014],[.448,-.124],[.928,-.404],[.638,.139],[.018,.402],[-.598,.148]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[6.174,13.211],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 7",np:2,cix:2,bm:0,ix:7,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.26,-.175],[-.094,.127],[-.167,.064],[-.15,-.085],[-.058,-.144],[.122,.012],[.105,-.041]],o:[[.015,-.16],[.095,-.129],[.168,-.062],[.157,.077],[-.156,-.047],[-.119,-.015],[-.213,.076]],v:[[-.704,.398],[-.529,-.035],[-.135,-.337],[.389,-.299],[.704,.059],[.303,-.055],[-.023,-.023]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[14.148,9.554],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 8",np:2,cix:2,bm:0,ix:8,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.198,-.815],[.815,-.198],[.198,.815],[-.815,.198]],o:[[.198,.815],[-.816,.197],[-.198,-.816],[.815,-.198]],v:[[1.477,-.358],[.359,1.477],[-1.477,.359],[-.359,-1.476]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.985606414197,.768474563898,.65874077292,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[14.149,9.528],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 9",np:2,cix:2,bm:0,ix:9,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[-3.818,2.373],[3.884,-1.285]],o:[[0,0],[0,0],[0,0]],v:[[-2.827,-.517],[3.015,-2.213],[-3.015,2.213]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.721688364066,.479523094028,.467095109528,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[8.539,17.076],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 12",np:2,cix:2,bm:0,ix:10,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.497,3.139],[-4.946,-2.877],[-.316,-1.715],[0,0],[.243,5.732],[0,0]],o:[[.443,-2.796],[1.556,.906],[.221,1.195],[-.419,4.708],[0,0],[-3.583,-1.151]],v:[[-5.204,-5.157],[2.969,-9.751],[5.503,-5.48],[5.301,7.464],[-2.432,7.557],[-2.141,3.632]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.985606414197,.768474563898,.65874077292,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[7.853,12.927],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 13",np:4,cix:2,bm:0,ix:11,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-9.867,-1.823],[2.523,7.152]],o:[[0,0],[-1.641,-4.654]],v:[[2.951,7.533],[4.393,-2.88]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[9.581,8.291],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 14",np:2,cix:2,bm:0,ix:12,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,-1.703],[1.526,0],[0,1.703],[-1.525,0]],o:[[0,1.703],[-1.525,0],[0,-1.703],[1.526,0]],v:[[2.762,-.001],[-.922,5.066],[-2.762,-.001],[-.001,-3.083]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[14.597,14.618],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 15",np:2,cix:2,bm:0,ix:13,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0}],markers$1=[],cookingAnimation={v:v$1,fr:fr$1,ip:ip$1,op:op$1,w:w$1,h:h$1,nm:nm$1,ddd:ddd$1,assets:assets$1,layers:layers$1,markers:markers$1};function LoadingAnimation({message:e="Cooking up something delicious...",className:i="",fullScreen:s=!0,speed:a=2}){const _=reactExports.useRef(null);reactExports.useEffect(()=>{_.current&&_.current.setSpeed(a)},[a]);const et=jsxRuntimeExports.jsxs("div",{className:`flex flex-col items-center justify-center ${i}`,children:[jsxRuntimeExports.jsx("div",{className:"w-64 h-64",children:jsxRuntimeExports.jsx(Lottie,{lottieRef:_,animationData:cookingAnimation,loop:!0})}),e&&jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mt-4 font-medium animate-pulse",children:e})]});return s?jsxRuntimeExports.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background safe-top safe-bottom",children:et}):et}function HomePage(){const{kitchens:e,loading:i,error:s}=useKitchens(),{user:a,loading:_}=useAuth(),{notifications:et}=useNotifications(a==null?void 0:a.id),nt=et.filter(nr=>!nr.read).length,{userLocation:c,locationLoading:ct,isInServiceArea:dt,checkingZone:gt,currentFranchiseId:Tt,refetchLocation:Et}=useLocationContext(),At=useNavigate(),[Mt,Pt]=reactExports.useState("all"),[$t,Lt]=reactExports.useState(""),[Bt,Nt]=reactExports.useState(!0),Vt=reactExports.useRef(0);reactExports.useEffect(()=>{const nr=()=>{const ar=window.scrollY;ar<10?Nt(!0):ar>Vt.current&&ar>50?Nt(!1):ar<Vt.current&&Nt(!0),Vt.current=ar};return window.addEventListener("scroll",nr,{passive:!0}),()=>window.removeEventListener("scroll",nr)},[]),reactExports.useEffect(()=>{!_&&a&&(a.role==="amma"?At("/amma/dashboard"):a.role==="admin"?At("/admin"):a.role==="super_admin"?At("/super-admin"):a.role==="franchise_admin"&&a.franchiseId&&At("/admin"))},[a,_,At]);const Xt=e.filter(nr=>{if(!nr.isApproved||Tt&&nr.franchiseId!==Tt||Mt==="veg"&&!nr.isVeg||Mt==="open"&&!nr.isOpen)return!1;if($t){const ar=$t.toLowerCase();return nr.name.toLowerCase().includes(ar)||nr.specialties.some(mr=>mr.toLowerCase().includes(ar))}return!0});return gt?jsxRuntimeExports.jsx(LoadingAnimation,{message:"Finding your location..."}):dt?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-32",children:[jsxRuntimeExports.jsx(motion.header,{initial:{y:0},animate:{y:Bt?0:"-100%"},transition:{duration:.3},className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"px-4 py-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsxs(motion.button,{whileTap:{scale:.98},onClick:()=>At("/location-select"),className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:ct?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 text-primary animate-spin"}):jsxRuntimeExports.jsx(MapPin,{className:"w-5 h-5 text-primary"})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Deliver to"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-foreground max-w-[180px] truncate",children:ct?"Finding location...":(c==null?void 0:c.address)||"Set location"}),jsxRuntimeExports.jsx(ChevronDown,{className:"w-4 h-4 text-muted-foreground"})]})]})]}),jsxRuntimeExports.jsx(Link,{to:"/notifications",children:jsxRuntimeExports.jsxs(Button,{variant:"ghost",size:"icon",className:"relative",children:[jsxRuntimeExports.jsx(Bell,{className:"w-5 h-5"}),nt>0&&jsxRuntimeExports.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 rounded-full bg-primary animate-pulse"})]})})]}),jsxRuntimeExports.jsx(Link,{to:"/search",children:jsxRuntimeExports.jsxs(motion.div,{whileTap:{scale:.99},className:"relative",children:[jsxRuntimeExports.jsx(Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Search Biryani or Amma's Kitchen",value:$t,onChange:nr=>Lt(nr.target.value),className:"w-full pl-12 pr-4 py-3 rounded-xl bg-secondary border-0 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20"})]})})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 pt-4 pb-2",children:jsxRuntimeExports.jsx(Categories,{onSelectCategory:nr=>Lt(nr),selectedCategory:$t})}),jsxRuntimeExports.jsx(BestSellingSection,{}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4 flex gap-2 overflow-x-auto hide-scrollbar",children:[{id:"all",label:"All"},{id:"open",label:" Open Now"},{id:"veg",label:" Pure Veg"}].map(nr=>jsxRuntimeExports.jsx(motion.button,{whileTap:{scale:.95},onClick:()=>Pt(nr.id),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${Mt===nr.id?"gradient-primary text-primary-foreground":"bg-secondary text-secondary-foreground"}`,children:nr.label},nr.id))}),jsxRuntimeExports.jsxs("div",{className:"px-4 mb-3",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Kitchens Near You"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Order homemade food from loving Ammas"})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 space-y-4",children:[i?jsxRuntimeExports.jsx(LoadingAnimation,{fullScreen:!1,className:"py-12"}):s?jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsx("p",{className:"text-destructive",children:s})}):Xt.map((nr,ar)=>jsxRuntimeExports.jsx(KitchenCard,{kitchen:nr,index:ar},nr.id)),Xt.length===0&&!i&&!s&&jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No kitchens found"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Be the first Amma to register your kitchen!"})]})]}),jsxRuntimeExports.jsx(BottomNav,{})]}):jsxRuntimeExports.jsx(OutOfZoneScreen,{})}function SlideToPay({onSuccess:e,totalAmount:i,itemCount:s,text:a="SLIDE TO VIEW CART"}){const[_,et]=reactExports.useState(0),nt=reactExports.useRef(null),c=useAnimation(),[ct,dt]=reactExports.useState(0);reactExports.useEffect(()=>{nt.current&&et(nt.current.clientWidth)},[nt.current]);const gt=(Et,At)=>{const Mt=Math.max(0,At.offset.x);dt(Mt)},Tt=(Et,At)=>{const Mt=_-56;At.offset.x>=Mt*.9?(c.start({x:Mt}),e()):(c.start({x:0}),dt(0))};return jsxRuntimeExports.jsxs("div",{ref:nt,className:"relative h-14 bg-card rounded-r-full rounded-l-full overflow-hidden shadow-elevated border border-primary/20 select-none",children:[jsxRuntimeExports.jsxs("div",{className:"absolute inset-0 flex items-center justify-between px-6 z-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col ml-14",children:[jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-muted-foreground font-semibold",children:[s," ITEMS"]}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-bold text-foreground",children:["",i]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 animate-pulse-soft opacity-60",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-bold tracking-widest text-primary",children:a}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-4 h-4 text-primary"})]})]}),jsxRuntimeExports.jsx(motion.div,{className:"absolute inset-y-0 left-0 bg-primary/10 z-0",style:{width:ct+50}}),jsxRuntimeExports.jsx(motion.div,{drag:"x",dragConstraints:{left:0,right:_-56},dragElastic:.1,dragMomentum:!1,onDrag:gt,onDragEnd:Tt,animate:c,className:"absolute left-1 top-1 bottom-1 w-[50px] bg-primary rounded-full flex items-center justify-center cursor-grab active:cursor-grabbing z-20 shadow-soft",whileTap:{scale:1.05},children:jsxRuntimeExports.jsx(ChevronRight,{className:"w-6 h-6 text-primary-foreground"})})]})}function KitchenPage(){var Vt;const{id:e}=useParams(),{kitchen:i,loading:s,error:a}=useKitchen(e),{dishes:_,loading:et}=useDishes(e),{cart:nt,getTotal:c,getItemCount:ct}=useCart(),{user:dt,toggleFavorite:gt}=useAuth(),{userLocation:Tt}=useLocationContext(),[Et,At]=reactExports.useState(!1),Mt=useNavigate(),Pt=e&&((Vt=dt==null?void 0:dt.favorites)==null?void 0:Vt.includes(e));reactExports.useEffect(()=>{const Xt=()=>{At(window.scrollY>100)};return window.addEventListener("scroll",Xt),()=>window.removeEventListener("scroll",Xt)},[]);const $t=async()=>{if(navigator.share)try{await navigator.share({title:i==null?void 0:i.name,text:`Check out ${i==null?void 0:i.name} on Amma Cheythi Vanta!`,url:window.location.href})}catch(Xt){console.error("Error sharing:",Xt)}else navigator.clipboard.writeText(window.location.href),alert("Link copied to clipboard!")},Lt=async Xt=>{if(Xt.stopPropagation(),!!e){if(!dt){alert("Please login to add favorites");return}await gt(e)}};if(s)return jsxRuntimeExports.jsx(LoadingAnimation,{});if(a||!i)return jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background px-4",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"Kitchen not found"}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Go Back Home"})})]});const Bt=Tt&&i.address.lat&&i.address.lng?calculateDistance(Tt.lat,Tt.lng,i.address.lat,i.address.lng):`${i.address.line1}, ${i.address.city}`,Nt=[...new Set(_.map(Xt=>Xt.category))];return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-32",children:[jsxRuntimeExports.jsx(AnimatePresence,{children:Et&&jsxRuntimeExports.jsxs(motion.div,{initial:{y:-100},animate:{y:0},exit:{y:-100},transition:{type:"spring",stiffness:300,damping:30},className:"fixed top-0 left-0 right-0 z-50 bg-background/95 backdrop-blur-md shadow-sm border-b border-border px-4 py-2 flex items-center justify-between safe-top",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",className:"h-9 w-9 -ml-2 rounded-full hover:bg-muted",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 text-foreground"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-foreground truncate max-w-[200px]",children:i.name})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full hover:bg-muted",onClick:$t,children:jsxRuntimeExports.jsx(Share2,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full hover:bg-muted",onClick:Lt,children:jsxRuntimeExports.jsx(Heart,{className:cn("w-5 h-5",Pt?"fill-red-500 text-red-500":"")})})]})]})}),jsxRuntimeExports.jsxs("div",{className:"relative h-56",children:[jsxRuntimeExports.jsx(CachedImage,{src:i.coverImage||i.image,alt:i.name,className:"w-full h-full object-cover"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background via-transparent to-transparent"}),jsxRuntimeExports.jsxs("div",{className:"absolute top-4 left-4 right-4 flex justify-between z-10",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-card/90 backdrop-blur-sm flex items-center justify-center shadow-soft cursor-pointer",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(motion.button,{whileTap:{scale:.9},onClick:$t,className:"w-10 h-10 rounded-full bg-card/90 backdrop-blur-sm flex items-center justify-center shadow-soft",children:jsxRuntimeExports.jsx(Share2,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx(motion.button,{whileTap:{scale:.9},onClick:Lt,className:"w-10 h-10 rounded-full bg-card/90 backdrop-blur-sm flex items-center justify-center shadow-soft",children:jsxRuntimeExports.jsx(Heart,{className:cn("w-5 h-5 transition-colors",Pt?"fill-red-500 text-red-500":"")})})]})]})]}),jsxRuntimeExports.jsx("div",{className:"px-4 -mt-8 relative z-10",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl p-4 shadow-elevated",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.isVeg&&jsxRuntimeExports.jsx("div",{className:"p-1 rounded-full bg-veg/10",children:jsxRuntimeExports.jsx(Leaf,{className:"w-3 h-3 text-veg"})}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold text-foreground",children:i.name})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:i.specialties.join("  ")})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 px-2.5 py-1 rounded-lg bg-gold-soft",children:[jsxRuntimeExports.jsx(Star,{className:"w-4 h-4 text-gold fill-gold"}),jsxRuntimeExports.jsx("span",{className:"font-bold text-foreground",children:i.rating}),jsxRuntimeExports.jsxs("span",{className:"text-muted-foreground text-sm",children:["(",i.totalRatings,")"]})]})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:i.description}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5 text-muted-foreground",children:[jsxRuntimeExports.jsx(Clock,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:i.cookingTime})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5 text-muted-foreground",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:Bt})]})]}),jsxRuntimeExports.jsx("div",{className:cn("mt-4 px-3 py-2 rounded-lg text-sm font-medium text-center",i.isOpen?"bg-accent/10 text-accent":"bg-muted text-muted-foreground"),children:i.isOpen?" Kitchen is open and cooking!":" Kitchen is closed"})]})}),jsxRuntimeExports.jsxs("div",{className:"px-4 mt-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-foreground mb-4",children:"Menu"}),et?jsxRuntimeExports.jsx(LoadingAnimation,{fullScreen:!1,className:"py-12"}):_.length===0?jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No dishes available yet"})}):Nt.map(Xt=>jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide mb-3",children:Xt}),jsxRuntimeExports.jsx("div",{className:"space-y-4",children:_.filter(nr=>nr.category===Xt).map(nr=>jsxRuntimeExports.jsx(DishCard,{dish:nr,kitchenId:i.id,kitchenName:i.name},nr.id))})]},Xt))]}),nt.items.length>0&&nt.kitchenId===i.id&&jsxRuntimeExports.jsx(motion.div,{initial:{y:100},animate:{y:0},className:"fixed bottom-0 left-0 right-0 p-4 bg-card/95 backdrop-blur-lg border-t border-border safe-bottom z-50",children:jsxRuntimeExports.jsx(SlideToPay,{itemCount:ct(),totalAmount:c(),onSuccess:()=>Mt("/cart")})})]})}const Textarea=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx("textarea",{className:cn("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...i}));Textarea.displayName="Textarea";function CartPage(){var Et,At;const{cart:e,updateQuantity:i,removeFromCart:s,clearCart:a,getTotal:_,getItemCount:et,updateCookingInstructions:nt}=useCart(),c=Mt=>{var Lt,Bt;const Pt=((Lt=e.cookingInstructions)==null?void 0:Lt.tags)||[],$t=Pt.includes(Mt)?Pt.filter(Nt=>Nt!==Mt):[...Pt,Mt];if($t.length>3){ue.error("You can select up to 3 instructions");return}nt($t,((Bt=e.cookingInstructions)==null?void 0:Bt.note)||"")},ct=Mt=>{var Pt;nt(((Pt=e.cookingInstructions)==null?void 0:Pt.tags)||[],Mt)},dt=30,gt=5,Tt=_()+dt+gt;return e.items.length===0?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 rounded-full bg-secondary flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx(ChefHat,{className:"w-12 h-12 text-muted-foreground"})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Your cart is empty"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-6",children:"Add delicious homemade food from nearby Ammas"}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground px-8",children:"Explore Kitchens"})})]}),jsxRuntimeExports.jsx(BottomNav,{})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-48",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Your Cart"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground",children:["from ",e.kitchenName]})]}),jsxRuntimeExports.jsxs(Button,{onClick:a,variant:"outline",size:"sm",className:"text-destructive border-destructive hover:bg-destructive hover:text-destructive-foreground",children:[jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4 mr-1"}),"Clear"]})]})}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[jsxRuntimeExports.jsx(AnimatePresence,{children:e.items.map((Mt,Pt)=>jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:Pt*.05},className:"flex gap-4 py-4 border-b border-border",children:[jsxRuntimeExports.jsx("div",{className:cn("w-4 h-4 border-2 rounded-sm flex items-center justify-center mt-1 flex-shrink-0",Mt.dish.isVeg?"border-veg":"border-non-veg"),children:jsxRuntimeExports.jsx("div",{className:cn("w-2 h-2 rounded-full",Mt.dish.isVeg?"bg-veg":"bg-non-veg")})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground truncate",children:Mt.dish.name}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground",children:["",Mt.dish.price]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 bg-secondary rounded-lg",children:[jsxRuntimeExports.jsx(Button,{onClick:()=>i(Mt.dish.id,Mt.quantity-1),size:"icon",variant:"ghost",className:"h-8 w-8",children:Mt.quantity===1?jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4 text-destructive"}):jsxRuntimeExports.jsx(Minus,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("span",{className:"font-semibold text-foreground px-2 min-w-[24px] text-center",children:Mt.quantity}),jsxRuntimeExports.jsx(Button,{onClick:()=>i(Mt.dish.id,Mt.quantity+1),size:"icon",variant:"ghost",className:"h-8 w-8",children:jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4"})})]}),jsxRuntimeExports.jsxs("span",{className:"font-semibold text-foreground min-w-[60px] text-right",children:["",Mt.dish.price*Mt.quantity]})]})]},Mt.dish.id))}),jsxRuntimeExports.jsx(Link,{to:`/kitchen/${e.kitchenId}`,children:jsxRuntimeExports.jsx(Button,{variant:"ghost",className:"w-full mt-4 text-primary",children:"+ Add more items"})})]}),jsxRuntimeExports.jsx("div",{className:"px-4 mt-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-3",children:"Cooking Instructions"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:["Less Spicy","More Spicy","No Onions","Extra Cutlery","Leave at Door","Quick","Other"].map(Mt=>{var Pt;return jsxRuntimeExports.jsx("button",{onClick:()=>c(Mt),className:cn("px-3 py-1.5 rounded-full text-xs font-medium border transition-all",(((Pt=e.cookingInstructions)==null?void 0:Pt.tags)||[]).includes(Mt)?"bg-primary/10 border-primary text-primary":"bg-background border-border text-muted-foreground hover:border-primary/50"),children:Mt},Mt)})}),(((Et=e.cookingInstructions)==null?void 0:Et.tags)||[]).includes("Other")&&jsxRuntimeExports.jsx(Textarea,{placeholder:"Please type your custom instructions here...",value:((At=e.cookingInstructions)==null?void 0:At.note)||"",onChange:Mt=>ct(Mt.target.value),className:"bg-secondary border-0 resize-none animate-in fade-in slide-in-from-top-2",rows:2})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 mt-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Bill Details"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Item Total"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",_()]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Delivery Fee"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",dt]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Platform Fee"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",gt]})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-border pt-2 mt-2",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between font-semibold",children:[jsxRuntimeExports.jsx("span",{className:"text-foreground",children:"To Pay"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",Tt]})]})})]})]})}),jsxRuntimeExports.jsx(motion.div,{initial:{y:100},animate:{y:0},className:"fixed bottom-[90px] left-0 right-0 p-4 z-40",children:jsxRuntimeExports.jsx(Link,{to:"/checkout",children:jsxRuntimeExports.jsx(Button,{className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl shadow-elevated",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between w-full",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Proceed to Checkout"}),jsxRuntimeExports.jsxs("span",{className:"font-bold",children:["",Tt]})]})})})}),jsxRuntimeExports.jsx(BottomNav,{})]})}const Input=reactExports.forwardRef(({className:e,type:i,...s},a)=>jsxRuntimeExports.jsx("input",{type:i,className:cn("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:a,...s}));Input.displayName="Input";const RAZORPAY_KEY_ID="rzp_live_HJl9NwyBSY9rwV";function loadRazorpayScript(){return new Promise(e=>{if(window.Razorpay){e(!0);return}const i=document.createElement("script");i.src="https://checkout.razorpay.com/v1/checkout.js",i.onload=()=>e(!0),i.onerror=()=>e(!1),document.body.appendChild(i)})}async function initiatePayment(e,i,s,a,_,et){if(!await loadRazorpayScript())throw new Error("Failed to load Razorpay SDK");const c={key:RAZORPAY_KEY_ID,amount:e*100,currency:"INR",name:"Amma Cheythi Vanta",description:"Homemade food order payment",prefill:{name:i,email:s,contact:a},theme:{color:"#D97706"},handler:_,modal:{ondismiss:et}};new window.Razorpay(c).open()}function CheckoutPage(){var Ar,rr,ur,Br,xr,qr;const{cart:e,getTotal:i,clearCart:s}=useCart(),{user:a}=useAuth(),{currentFranchise:_,userLocation:et}=useLocationContext(),nt=useNavigate(),[c,ct]=reactExports.useState(!1),[dt,gt]=reactExports.useState({line1:((Ar=a==null?void 0:a.address)==null?void 0:Ar.line1)||"",line2:((rr=a==null?void 0:a.address)==null?void 0:rr.line2)||"",city:((ur=a==null?void 0:a.address)==null?void 0:ur.city)||"",pincode:((Br=a==null?void 0:a.address)==null?void 0:Br.pincode)||"",landmark:((xr=a==null?void 0:a.address)==null?void 0:xr.landmark)||"",label:(qr=a==null?void 0:a.address)==null?void 0:qr.label}),[Tt,Et]=reactExports.useState(null);reactExports.useEffect(()=>{a!=null&&a.address&&(a.address.line1||a.address.city)&&(gt(a.address),a.address.lat&&a.address.lng&&Et({lat:a.address.lat,lng:a.address.lng}))},[a]);const[At,Mt]=reactExports.useState(!0),[Pt,$t]=reactExports.useState(""),[Lt,Bt]=reactExports.useState(null),[Nt,Vt]=reactExports.useState(!1),[Xt,nr]=reactExports.useState(""),ar=30,mr=5,Fr=i(),fn=(()=>{if(!Lt)return 0;if(Lt.code.toUpperCase()==="PA1")return Fr+ar+mr-1;if(Lt.discountType==="percentage"){const tn=Fr*Lt.discountValue/100;return Lt.maxDiscount?Math.min(tn,Lt.maxDiscount):tn}else{if(Lt.discountType==="fixed")return Math.min(Lt.discountValue,Fr);if(Lt.discountType==="final_price")return Fr+ar+mr-Lt.discountValue}return 0})(),Lr=Math.max(1,Fr+ar+mr-fn),Qr=async()=>{if(!Pt.trim()){nr("Please enter a coupon code");return}Vt(!0),nr("");try{if(Pt.toUpperCase()==="PA1"){const vn={id:"pa1-default",code:"PA1",kitchenId:"system",discountType:"final_price",discountValue:1,usedCount:0,isActive:!0,createdAt:Date.now()};Bt(vn),ue.success(" Special coupon applied! Final price: 1"),Vt(!1);return}const tn=await getCouponByCode(Pt);if(!tn){nr("Invalid coupon code"),Vt(!1);return}if(!tn.isActive){nr("This coupon is no longer active"),Vt(!1);return}if(tn.expiresAt&&tn.expiresAt<Date.now()){nr("This coupon has expired"),Vt(!1);return}if(tn.usageLimit&&tn.usedCount>=tn.usageLimit){nr("This coupon has reached its usage limit"),Vt(!1);return}if(tn.minOrderAmount&&Fr<tn.minOrderAmount){nr(`Minimum order amount is ${tn.minOrderAmount}`),Vt(!1);return}if(tn.kitchenId!==e.kitchenId&&tn.kitchenId!=="system"){nr("This coupon is not valid for this kitchen"),Vt(!1);return}Bt(tn),ue.success("Coupon applied successfully!")}catch{nr("Failed to apply coupon")}Vt(!1)},dn=()=>{Bt(null),$t(""),nr("")},en=()=>!dt.line1&&!dt.city?(ue.error("Please select a valid delivery address"),!1):!dt.pincode&&!dt.city?(ue.error("Address information is incomplete (missing city/pincode)"),!1):!0,yr=async()=>{if(!a){ue.error("Please login to continue"),nt("/auth");return}if(en()){if(e.items.length===0){ue.error("Your cart is empty");return}ct(!0);try{await initiatePayment(Lr,a.name,a.email,a.phone||"",async tn=>{var vn,hs;try{const Ts=await createOrder({userId:a.id,kitchenId:e.kitchenId,kitchenName:e.kitchenName,items:e.items,status:"pending",totalAmount:Lr,deliveryAddress:dt,notes:[...((vn=e.cookingInstructions)==null?void 0:vn.tags)||[],(hs=e.cookingInstructions)==null?void 0:hs.note].filter(Boolean).join(", "),createdAt:Date.now(),updatedAt:Date.now(),estimatedDelivery:"30-45 mins"});ue.success("Order placed successfully!"),s(),nt("/order-success",{replace:!0})}catch(Ts){console.error("Order creation failed:",Ts),ue.error("Failed to create order. Please contact support.")}ct(!1)},()=>{ct(!1)})}catch(tn){console.error("Payment initiation failed:",tn),ue.error("Payment failed. Please try again."),ct(!1)}}};return e.items.length===0?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"Your cart is empty"}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Explore Kitchens"})})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-32",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[jsxRuntimeExports.jsx(Link,{to:"/cart",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Checkout"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.items.length," items from ",e.kitchenName]})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-5 h-5 text-primary"}),jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:"Delivery Location"})]}),jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2",children:dt.city&&jsxRuntimeExports.jsx(Button,{variant:"link",size:"sm",onClick:()=>nt("/addresses"),className:"text-primary h-auto p-0 font-semibold",children:"Change"})})]}),dt.city?jsxRuntimeExports.jsxs("div",{className:"bg-secondary/30 rounded-xl p-4 border border-border",children:[jsxRuntimeExports.jsx("div",{className:"pt-1",children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-medium text-foreground mb-1 capitalize",children:dt.label||"Home"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground",children:[dt.line1?jsxRuntimeExports.jsx("span",{className:"block truncate max-w-[250px]",children:dt.line1}):jsxRuntimeExports.jsxs("span",{className:"block",children:[dt.pincode?`${dt.pincode}, `:"",dt.city]}),dt.line2&&jsxRuntimeExports.jsx("span",{className:"block",children:dt.line2})]})]})}),_&&At&&jsxRuntimeExports.jsxs("div",{className:"mt-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-xs text-green-600 font-medium",children:[jsxRuntimeExports.jsx(Check,{className:"w-3 h-3"}),"Deliverable address"]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground mt-1 ml-5",children:[_.name," Zone"]})]}),_&&!At&&jsxRuntimeExports.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-destructive font-medium",children:[jsxRuntimeExports.jsx(X,{className:"w-3 h-3"}),"Address outside delivery zone"]})]}):jsxRuntimeExports.jsxs("div",{className:"text-center py-6 bg-secondary/30 rounded-xl border border-dashed border-border",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"No delivery address found"}),jsxRuntimeExports.jsx(Button,{onClick:()=>nt("/addresses"),className:"gradient-primary text-primary-foreground",children:"Add Address"})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 mt-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[jsxRuntimeExports.jsx(Tag,{className:"w-5 h-5 text-primary"}),jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:"Apply Discount Coupon"})]}),Lt?jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between bg-veg/10 rounded-xl p-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Check,{className:"w-5 h-5 text-veg"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-semibold text-foreground",children:Lt.code}),jsxRuntimeExports.jsx("p",{className:"text-xs text-veg",children:Lt.code.toUpperCase()==="PA1"?"Special offer: Final price 1!":`Saving ${fn}`})]})]}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",onClick:dn,className:"text-destructive",children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]}):jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Input,{placeholder:"Enter coupon code ",value:Pt,onChange:tn=>{$t(tn.target.value.toUpperCase()),nr("")},className:"bg-secondary border-0 uppercase"}),jsxRuntimeExports.jsx(Button,{onClick:Qr,disabled:Nt,className:"gradient-primary text-primary-foreground",children:Nt?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}):"Apply"})]}),Xt&&jsxRuntimeExports.jsx("p",{className:"text-xs text-destructive",children:Xt})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 mt-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Order Summary"}),e.items.map(tn=>jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm py-2 border-b border-border",children:[jsxRuntimeExports.jsxs("span",{className:"text-muted-foreground",children:[tn.dish.name," x ",tn.quantity]}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",tn.dish.price*tn.quantity]})]},tn.dish.id)),jsxRuntimeExports.jsxs("div",{className:"space-y-2 text-sm mt-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Item Total"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",Fr]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Delivery Fee"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",ar]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Platform Fee"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",mr]})]}),Lt&&fn>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-veg",children:[jsxRuntimeExports.jsxs("span",{children:["Discount (",Lt.code,")"]}),jsxRuntimeExports.jsxs("span",{children:["-",fn]})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-border pt-2 mt-2",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between font-semibold text-base",children:[jsxRuntimeExports.jsx("span",{className:"text-foreground",children:"Total"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",Lr]})]})})]})]})}),jsxRuntimeExports.jsx(motion.div,{initial:{y:100},animate:{y:0},className:"fixed bottom-0 left-0 right-0 p-4 bg-card/95 backdrop-blur-lg border-t border-border safe-bottom",children:jsxRuntimeExports.jsx(Button,{onClick:yr,disabled:c||!At,className:`w-full py-6 rounded-xl shadow-elevated ${At?"gradient-primary text-primary-foreground":"bg-muted text-muted-foreground cursor-not-allowed"}`,children:c?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin"}),jsxRuntimeExports.jsx("span",{children:"Processing..."})]}):At?jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between w-full",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(CreditCard,{className:"w-5 h-5"}),jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Pay Now"})]}),jsxRuntimeExports.jsxs("span",{className:"font-bold",children:["",Lr]})]}):jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2",children:jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Delivery Not Available"})})})})]})}var NAME="Label",Label$2=reactExports.forwardRef((e,i)=>jsxRuntimeExports.jsx(Primitive.label,{...e,ref:i,onMouseDown:s=>{var _;s.target.closest("button, input, select, textarea")||((_=e.onMouseDown)==null||_.call(e,s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));Label$2.displayName=NAME;var Root$3=Label$2;const labelVariants=cva("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Label$1=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Root$3,{ref:s,className:cn(labelVariants(),e),...i}));Label$1.displayName=Root$3.displayName;function getDashboardRoute(e){switch(e){case"super_admin":return"/super-admin";case"franchise_admin":return"/franchise-admin";case"amma":return"/amma/dashboard";case"admin":return"/admin";default:return"/"}}function AuthPage(){const[e,i]=reactExports.useState("login"),[s,a]=reactExports.useState("user"),[_,et]=reactExports.useState(!1),[nt,c]=reactExports.useState(!1),[ct,dt]=reactExports.useState(!0),[gt,Tt]=reactExports.useState({email:"",password:"",name:"",phone:""}),{signIn:Et,signUp:At,updateUserLocation:Mt,user:Pt,loading:$t}=useAuth(),Lt=useNavigate();if(reactExports.useEffect(()=>{if(!$t&&Pt){const Vt=getDashboardRoute(Pt.role);Lt(Vt,{replace:!0})}else $t||dt(!1)},[Pt,$t,Lt]),ct||$t)return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})});const Bt=async()=>{if(!navigator.geolocation){console.log("Geolocation not supported");return}try{const Vt=await new Promise((ar,mr)=>{navigator.geolocation.getCurrentPosition(ar,mr,{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}),{latitude:Xt,longitude:nr}=Vt.coords;await Mt(Xt,nr),ue.success("Location saved!",{icon:jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4"}),duration:2e3})}catch(Vt){console.log("Could not get location:",Vt)}},Nt=async Vt=>{Vt.preventDefault(),c(!0);try{if(e==="login"){let Xt=gt.email;gt.email==="admin"&&(Xt="admin@admin.com"),await Et(Xt,gt.password),ue.success("Welcome back!");const nr=auth.currentUser;if(nr){const ar=ref(database,`users/${nr.uid}`),mr=await get(ar);if(mr.exists()){const Fr=mr.val();if(Fr.role==="super_admin"){Lt("/super-admin");return}else if(Fr.role==="franchise_admin"){Lt("/franchise-admin");return}else if(Fr.role==="amma"){Lt("/amma/dashboard");return}else if(Fr.role==="admin"){Lt("/admin");return}}}Lt("/")}else await At(gt.email,gt.password,gt.name,gt.phone,s),ue.success("Account created successfully!"),Bt(),s==="amma"?(ue.info("Now register your kitchen to start selling!"),Lt("/amma/register")):Lt("/")}catch(Xt){console.error("Auth error:",Xt);let nr="Authentication failed";Xt.code==="auth/email-already-in-use"?nr="Email already registered. Please login instead.":Xt.code==="auth/weak-password"?nr="Password should be at least 6 characters":Xt.code==="auth/invalid-email"?nr="Invalid email address":(Xt.code==="auth/user-not-found"||Xt.code==="auth/wrong-password"||Xt.code==="auth/invalid-credential")&&(nr="Invalid email or password"),ue.error(nr)}finally{c(!1)}};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("div",{className:"gradient-hero px-6 pt-12 pb-8 text-primary-foreground",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-2xl bg-primary-foreground/20 flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx(ChefHat,{className:"w-8 h-8"})}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Amma Cheythi Vanta"}),jsxRuntimeExports.jsx("p",{className:"text-primary-foreground/80 text-sm",children:e==="login"?"Welcome back!":"Join our family of home cooks"})]})}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex-1 -mt-6 bg-card rounded-t-3xl px-6 pt-8",children:[jsxRuntimeExports.jsx("div",{className:"flex bg-secondary rounded-xl p-1 mb-6",children:["login","signup"].map(Vt=>jsxRuntimeExports.jsx("button",{onClick:()=>i(Vt),className:`flex-1 py-2.5 rounded-lg text-sm font-medium transition-all ${e===Vt?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:Vt==="login"?"Login":"Sign Up"},Vt))}),e==="signup"&&jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx(Label$1,{className:"text-sm font-medium text-foreground mb-3 block",children:"I am a..."}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs(motion.button,{whileTap:{scale:.98},onClick:()=>a("user"),className:`p-4 rounded-xl border-2 text-left transition-all ${s==="user"?"border-primary bg-primary/5":"border-border"}`,children:[jsxRuntimeExports.jsx("span",{className:"text-2xl mb-2 block",children:""}),jsxRuntimeExports.jsx("span",{className:"font-medium text-foreground block",children:"Food Lover"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"I want to order"})]}),jsxRuntimeExports.jsxs(motion.button,{whileTap:{scale:.98},onClick:()=>a("amma"),className:`p-4 rounded-xl border-2 text-left transition-all ${s==="amma"?"border-primary bg-primary/5":"border-border"}`,children:[jsxRuntimeExports.jsx("span",{className:"text-2xl mb-2 block",children:""}),jsxRuntimeExports.jsx("span",{className:"font-medium text-foreground block",children:"Home Cook"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"I want to sell"})]})]})]}),jsxRuntimeExports.jsxs("form",{onSubmit:Nt,className:"space-y-4",children:[e==="signup"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"name",className:"text-sm font-medium text-foreground",children:"Full Name"}),jsxRuntimeExports.jsx(Input,{id:"name",type:"text",placeholder:"Enter your name",value:gt.name,onChange:Vt=>Tt(Xt=>({...Xt,name:Vt.target.value})),className:"mt-1.5 bg-secondary border-0 py-6",required:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"phone",className:"text-sm font-medium text-foreground",children:"Phone Number"}),jsxRuntimeExports.jsx(Input,{id:"phone",type:"tel",placeholder:"Enter phone number",value:gt.phone,onChange:Vt=>Tt(Xt=>({...Xt,phone:Vt.target.value})),className:"mt-1.5 bg-secondary border-0 py-6",required:!0})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"email",className:"text-sm font-medium text-foreground",children:"Email"}),jsxRuntimeExports.jsx(Input,{id:"email",type:"email",placeholder:"Enter your email",value:gt.email,onChange:Vt=>Tt(Xt=>({...Xt,email:Vt.target.value})),className:"mt-1.5 bg-secondary border-0 py-6",required:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"password",className:"text-sm font-medium text-foreground",children:"Password"}),jsxRuntimeExports.jsxs("div",{className:"relative mt-1.5",children:[jsxRuntimeExports.jsx(Input,{id:"password",type:_?"text":"password",placeholder:"Enter password",value:gt.password,onChange:Vt=>Tt(Xt=>({...Xt,password:Vt.target.value})),className:"bg-secondary border-0 py-6 pr-12",required:!0}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>et(!_),className:"absolute right-4 top-1/2 -translate-y-1/2 text-muted-foreground",children:_?jsxRuntimeExports.jsx(EyeOff,{className:"w-5 h-5"}):jsxRuntimeExports.jsx(Eye,{className:"w-5 h-5"})})]})]}),jsxRuntimeExports.jsx(Button,{type:"submit",disabled:nt,className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl mt-6",children:nt?jsxRuntimeExports.jsx(motion.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1},className:"w-5 h-5 border-2 border-primary-foreground border-t-transparent rounded-full"}):jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[e==="login"?"Login":"Create Account",jsxRuntimeExports.jsx(ArrowRight,{className:"w-5 h-5"})]})})]}),jsxRuntimeExports.jsx("div",{className:"text-center mt-6",children:jsxRuntimeExports.jsx(Link,{to:"/",className:"text-sm text-muted-foreground",children:"Skip for now"})})]})]})}async function clearAllDataExceptSuperAdmin(){try{const e={},i=ref(database,"users"),s=await get(i);if(s.exists()){const a=s.val();Object.keys(a).forEach(_=>{a[_].role!=="super_admin"&&(e[`users/${_}`]=null)})}return e.franchises=null,e.kitchens=null,e.dishes=null,e.orders=null,e.coupons=null,e.reviews=null,await update(ref(database),e),console.log("Database cleared successfully! (Super Admin preserved)"),!0}catch(e){return console.error("Error clearing database:",e),!1}}function ProfilePage(){const{user:e,signOut:i}=useAuth(),s=useNavigate();reactExports.useState(!1);const a=async()=>{await i(),s("/")},_=[{icon:ShoppingBag,label:"My Orders",path:"/orders",color:"text-primary"},{icon:Heart,label:"Favorite Kitchens",path:"/favorites",color:"text-destructive"},{icon:MapPin,label:"Saved Addresses",path:"/addresses",color:"text-accent"},{icon:Settings,label:"Settings",path:"/settings",color:"text-muted-foreground"},{icon:CircleHelp,label:"Help & Support",path:"/help",color:"text-gold"},...(e==null?void 0:e.role)==="super_admin"||(e==null?void 0:e.role)==="admin"?[{icon:ShieldCheck,label:"Super Admin Panel",path:"/super-admin",color:"text-primary"}]:[]];return e?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsx("div",{className:"gradient-hero px-6 pt-12 pb-16 text-primary-foreground",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-primary-foreground/20 flex items-center justify-center",children:e.avatar?jsxRuntimeExports.jsx("img",{src:e.avatar,alt:e.name,className:"w-full h-full rounded-full object-cover"}):jsxRuntimeExports.jsx(User,{className:"w-8 h-8"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold",children:e.name}),jsxRuntimeExports.jsx("p",{className:"text-primary-foreground/80 text-sm",children:e.email}),jsxRuntimeExports.jsx("p",{className:"text-primary-foreground/60 text-xs mt-0.5",children:e.role==="amma"?" Home Cook":" Food Lover"})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 -mt-6",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[e.role==="amma"&&jsxRuntimeExports.jsx(Link,{to:"/amma/dashboard",children:jsxRuntimeExports.jsxs(motion.div,{whileTap:{scale:.98},className:"flex items-center gap-4 p-4 border-b border-border bg-gold-soft",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gold/20 flex items-center justify-center text-gold",children:jsxRuntimeExports.jsx(ChefHat,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-foreground block",children:"My Kitchen Dashboard"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Manage orders & menu"})]}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-muted-foreground"})]})}),_.map(et=>jsxRuntimeExports.jsx(Link,{to:et.path,children:jsxRuntimeExports.jsxs(motion.div,{whileTap:{scale:.98},className:"flex items-center gap-4 p-4 border-b border-border last:border-0",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-xl bg-secondary flex items-center justify-center ${et.color}`,children:jsxRuntimeExports.jsx(et.icon,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 font-medium text-foreground",children:et.label}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-muted-foreground"})]})},et.path)),jsxRuntimeExports.jsxs(motion.button,{whileTap:{scale:.98},onClick:a,className:"w-full flex items-center gap-4 p-4 text-destructive",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-destructive/10 flex items-center justify-center",children:jsxRuntimeExports.jsx(LogOut,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 font-medium text-left",children:"Logout"})]})]})}),jsxRuntimeExports.jsx(BottomNav,{})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsx("div",{className:"gradient-hero px-6 pt-12 pb-16 text-primary-foreground",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-primary-foreground/20 flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx(User,{className:"w-10 h-10"})}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold mb-2",children:"Welcome, Guest!"}),jsxRuntimeExports.jsx("p",{className:"text-primary-foreground/80 text-sm mb-4",children:"Login to order delicious homemade food"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"bg-primary-foreground text-primary px-8 py-5 rounded-xl font-semibold",children:"Login / Sign Up"})})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 -mt-6",children:jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:_.slice(3).map((et,nt)=>jsxRuntimeExports.jsx(Link,{to:et.path,children:jsxRuntimeExports.jsxs(motion.div,{whileTap:{scale:.98},className:"flex items-center gap-4 p-4 border-b border-border last:border-0",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-xl bg-secondary flex items-center justify-center ${et.color}`,children:jsxRuntimeExports.jsx(et.icon,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 font-medium text-foreground",children:et.label}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-muted-foreground"})]})},et.path))})}),jsxRuntimeExports.jsx(BottomNav,{})]})}function usePrevious(e){const i=reactExports.useRef({value:e,previous:e});return reactExports.useMemo(()=>(i.current.value!==e&&(i.current.previous=i.current.value,i.current.value=e),i.current.previous),[e])}var SWITCH_NAME="Switch",[createSwitchContext,createSwitchScope]=createContextScope(SWITCH_NAME),[SwitchProvider,useSwitchContext]=createSwitchContext(SWITCH_NAME),Switch$1=reactExports.forwardRef((e,i)=>{const{__scopeSwitch:s,name:a,checked:_,defaultChecked:et,required:nt,disabled:c,value:ct="on",onCheckedChange:dt,form:gt,...Tt}=e,[Et,At]=reactExports.useState(null),Mt=useComposedRefs$1(i,Nt=>At(Nt)),Pt=reactExports.useRef(!1),$t=Et?gt||!!Et.closest("form"):!0,[Lt,Bt]=useControllableState({prop:_,defaultProp:et??!1,onChange:dt,caller:SWITCH_NAME});return jsxRuntimeExports.jsxs(SwitchProvider,{scope:s,checked:Lt,disabled:c,children:[jsxRuntimeExports.jsx(Primitive.button,{type:"button",role:"switch","aria-checked":Lt,"aria-required":nt,"data-state":getState$3(Lt),"data-disabled":c?"":void 0,disabled:c,value:ct,...Tt,ref:Mt,onClick:composeEventHandlers(e.onClick,Nt=>{Bt(Vt=>!Vt),$t&&(Pt.current=Nt.isPropagationStopped(),Pt.current||Nt.stopPropagation())})}),$t&&jsxRuntimeExports.jsx(SwitchBubbleInput,{control:Et,bubbles:!Pt.current,name:a,value:ct,checked:Lt,required:nt,disabled:c,form:gt,style:{transform:"translateX(-100%)"}})]})});Switch$1.displayName=SWITCH_NAME;var THUMB_NAME="SwitchThumb",SwitchThumb=reactExports.forwardRef((e,i)=>{const{__scopeSwitch:s,...a}=e,_=useSwitchContext(THUMB_NAME,s);return jsxRuntimeExports.jsx(Primitive.span,{"data-state":getState$3(_.checked),"data-disabled":_.disabled?"":void 0,...a,ref:i})});SwitchThumb.displayName=THUMB_NAME;var BUBBLE_INPUT_NAME$1="SwitchBubbleInput",SwitchBubbleInput=reactExports.forwardRef(({__scopeSwitch:e,control:i,checked:s,bubbles:a=!0,..._},et)=>{const nt=reactExports.useRef(null),c=useComposedRefs$1(nt,et),ct=usePrevious(s),dt=useSize(i);return reactExports.useEffect(()=>{const gt=nt.current;if(!gt)return;const Tt=window.HTMLInputElement.prototype,At=Object.getOwnPropertyDescriptor(Tt,"checked").set;if(ct!==s&&At){const Mt=new Event("click",{bubbles:a});At.call(gt,s),gt.dispatchEvent(Mt)}},[ct,s,a]),jsxRuntimeExports.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,..._,tabIndex:-1,ref:c,style:{..._.style,...dt,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});SwitchBubbleInput.displayName=BUBBLE_INPUT_NAME$1;function getState$3(e){return e?"checked":"unchecked"}var Root$2=Switch$1,Thumb=SwitchThumb;const Switch=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Root$2,{className:cn("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e),...i,ref:s,children:jsxRuntimeExports.jsx(Thumb,{className:cn("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Switch.displayName=Root$2.displayName;var AUTOFOCUS_ON_MOUNT="focusScope.autoFocusOnMount",AUTOFOCUS_ON_UNMOUNT="focusScope.autoFocusOnUnmount",EVENT_OPTIONS={bubbles:!1,cancelable:!0},FOCUS_SCOPE_NAME="FocusScope",FocusScope=reactExports.forwardRef((e,i)=>{const{loop:s=!1,trapped:a=!1,onMountAutoFocus:_,onUnmountAutoFocus:et,...nt}=e,[c,ct]=reactExports.useState(null),dt=useCallbackRef$1(_),gt=useCallbackRef$1(et),Tt=reactExports.useRef(null),Et=useComposedRefs$1(i,Pt=>ct(Pt)),At=reactExports.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;reactExports.useEffect(()=>{if(a){let Pt=function(Nt){if(At.paused||!c)return;const Vt=Nt.target;c.contains(Vt)?Tt.current=Vt:focus(Tt.current,{select:!0})},$t=function(Nt){if(At.paused||!c)return;const Vt=Nt.relatedTarget;Vt!==null&&(c.contains(Vt)||focus(Tt.current,{select:!0}))},Lt=function(Nt){if(document.activeElement===document.body)for(const Xt of Nt)Xt.removedNodes.length>0&&focus(c)};document.addEventListener("focusin",Pt),document.addEventListener("focusout",$t);const Bt=new MutationObserver(Lt);return c&&Bt.observe(c,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",Pt),document.removeEventListener("focusout",$t),Bt.disconnect()}}},[a,c,At.paused]),reactExports.useEffect(()=>{if(c){focusScopesStack.add(At);const Pt=document.activeElement;if(!c.contains(Pt)){const Lt=new CustomEvent(AUTOFOCUS_ON_MOUNT,EVENT_OPTIONS);c.addEventListener(AUTOFOCUS_ON_MOUNT,dt),c.dispatchEvent(Lt),Lt.defaultPrevented||(focusFirst(removeLinks(getTabbableCandidates(c)),{select:!0}),document.activeElement===Pt&&focus(c))}return()=>{c.removeEventListener(AUTOFOCUS_ON_MOUNT,dt),setTimeout(()=>{const Lt=new CustomEvent(AUTOFOCUS_ON_UNMOUNT,EVENT_OPTIONS);c.addEventListener(AUTOFOCUS_ON_UNMOUNT,gt),c.dispatchEvent(Lt),Lt.defaultPrevented||focus(Pt??document.body,{select:!0}),c.removeEventListener(AUTOFOCUS_ON_UNMOUNT,gt),focusScopesStack.remove(At)},0)}}},[c,dt,gt,At]);const Mt=reactExports.useCallback(Pt=>{if(!s&&!a||At.paused)return;const $t=Pt.key==="Tab"&&!Pt.altKey&&!Pt.ctrlKey&&!Pt.metaKey,Lt=document.activeElement;if($t&&Lt){const Bt=Pt.currentTarget,[Nt,Vt]=getTabbableEdges(Bt);Nt&&Vt?!Pt.shiftKey&&Lt===Vt?(Pt.preventDefault(),s&&focus(Nt,{select:!0})):Pt.shiftKey&&Lt===Nt&&(Pt.preventDefault(),s&&focus(Vt,{select:!0})):Lt===Bt&&Pt.preventDefault()}},[s,a,At.paused]);return jsxRuntimeExports.jsx(Primitive.div,{tabIndex:-1,...nt,ref:Et,onKeyDown:Mt})});FocusScope.displayName=FOCUS_SCOPE_NAME;function focusFirst(e,{select:i=!1}={}){const s=document.activeElement;for(const a of e)if(focus(a,{select:i}),document.activeElement!==s)return}function getTabbableEdges(e){const i=getTabbableCandidates(e),s=findVisible(i,e),a=findVisible(i.reverse(),e);return[s,a]}function getTabbableCandidates(e){const i=[],s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const _=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||_?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)i.push(s.currentNode);return i}function findVisible(e,i){for(const s of e)if(!isHidden(s,{upTo:i}))return s}function isHidden(e,{upTo:i}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(i!==void 0&&e===i)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function isSelectableInput(e){return e instanceof HTMLInputElement&&"select"in e}function focus(e,{select:i=!1}={}){if(e&&e.focus){const s=document.activeElement;e.focus({preventScroll:!0}),e!==s&&isSelectableInput(e)&&i&&e.select()}}var focusScopesStack=createFocusScopesStack();function createFocusScopesStack(){let e=[];return{add(i){const s=e[0];i!==s&&(s==null||s.pause()),e=arrayRemove(e,i),e.unshift(i)},remove(i){var s;e=arrayRemove(e,i),(s=e[0])==null||s.resume()}}}function arrayRemove(e,i){const s=[...e],a=s.indexOf(i);return a!==-1&&s.splice(a,1),s}function removeLinks(e){return e.filter(i=>i.tagName!=="A")}var count=0;function useFocusGuards(){reactExports.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??createFocusGuard()),document.body.insertAdjacentElement("beforeend",e[1]??createFocusGuard()),count++,()=>{count===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(i=>i.remove()),count--}},[])}function createFocusGuard(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var __assign=function(){return __assign=Object.assign||function(i){for(var s,a=1,_=arguments.length;a<_;a++){s=arguments[a];for(var et in s)Object.prototype.hasOwnProperty.call(s,et)&&(i[et]=s[et])}return i},__assign.apply(this,arguments)};function __rest(e,i){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&i.indexOf(a)<0&&(s[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var _=0,a=Object.getOwnPropertySymbols(e);_<a.length;_++)i.indexOf(a[_])<0&&Object.prototype.propertyIsEnumerable.call(e,a[_])&&(s[a[_]]=e[a[_]]);return s}function __spreadArray(e,i,s){if(s||arguments.length===2)for(var a=0,_=i.length,et;a<_;a++)(et||!(a in i))&&(et||(et=Array.prototype.slice.call(i,0,a)),et[a]=i[a]);return e.concat(et||Array.prototype.slice.call(i))}typeof SuppressedError=="function"&&SuppressedError;var zeroRightClassName="right-scroll-bar-position",fullWidthClassName="width-before-scroll-bar",noScrollbarsClassName="with-scroll-bars-hidden",removedBarSizeVariable="--removed-body-scroll-bar-size";function assignRef(e,i){return typeof e=="function"?e(i):e&&(e.current=i),e}function useCallbackRef(e,i){var s=reactExports.useState(function(){return{value:e,callback:i,facade:{get current(){return s.value},set current(a){var _=s.value;_!==a&&(s.value=a,s.callback(a,_))}}}})[0];return s.callback=i,s.facade}var useIsomorphicLayoutEffect=typeof window<"u"?reactExports.useLayoutEffect:reactExports.useEffect,currentValues=new WeakMap;function useMergeRefs(e,i){var s=useCallbackRef(null,function(a){return e.forEach(function(_){return assignRef(_,a)})});return useIsomorphicLayoutEffect(function(){var a=currentValues.get(s);if(a){var _=new Set(a),et=new Set(e),nt=s.current;_.forEach(function(c){et.has(c)||assignRef(c,null)}),et.forEach(function(c){_.has(c)||assignRef(c,nt)})}currentValues.set(s,e)},[e]),s}function ItoI(e){return e}function innerCreateMedium(e,i){i===void 0&&(i=ItoI);var s=[],a=!1,_={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:e},useMedium:function(et){var nt=i(et,a);return s.push(nt),function(){s=s.filter(function(c){return c!==nt})}},assignSyncMedium:function(et){for(a=!0;s.length;){var nt=s;s=[],nt.forEach(et)}s={push:function(c){return et(c)},filter:function(){return s}}},assignMedium:function(et){a=!0;var nt=[];if(s.length){var c=s;s=[],c.forEach(et),nt=s}var ct=function(){var gt=nt;nt=[],gt.forEach(et)},dt=function(){return Promise.resolve().then(ct)};dt(),s={push:function(gt){nt.push(gt),dt()},filter:function(gt){return nt=nt.filter(gt),s}}}};return _}function createSidecarMedium(e){e===void 0&&(e={});var i=innerCreateMedium(null);return i.options=__assign({async:!0,ssr:!1},e),i}var SideCar$1=function(e){var i=e.sideCar,s=__rest(e,["sideCar"]);if(!i)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=i.read();if(!a)throw new Error("Sidecar medium not found");return reactExports.createElement(a,__assign({},s))};SideCar$1.isSideCarExport=!0;function exportSidecar(e,i){return e.useMedium(i),SideCar$1}var effectCar=createSidecarMedium(),nothing=function(){},RemoveScroll=reactExports.forwardRef(function(e,i){var s=reactExports.useRef(null),a=reactExports.useState({onScrollCapture:nothing,onWheelCapture:nothing,onTouchMoveCapture:nothing}),_=a[0],et=a[1],nt=e.forwardProps,c=e.children,ct=e.className,dt=e.removeScrollBar,gt=e.enabled,Tt=e.shards,Et=e.sideCar,At=e.noRelative,Mt=e.noIsolation,Pt=e.inert,$t=e.allowPinchZoom,Lt=e.as,Bt=Lt===void 0?"div":Lt,Nt=e.gapMode,Vt=__rest(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),Xt=Et,nr=useMergeRefs([s,i]),ar=__assign(__assign({},Vt),_);return reactExports.createElement(reactExports.Fragment,null,gt&&reactExports.createElement(Xt,{sideCar:effectCar,removeScrollBar:dt,shards:Tt,noRelative:At,noIsolation:Mt,inert:Pt,setCallbacks:et,allowPinchZoom:!!$t,lockRef:s,gapMode:Nt}),nt?reactExports.cloneElement(reactExports.Children.only(c),__assign(__assign({},ar),{ref:nr})):reactExports.createElement(Bt,__assign({},ar,{className:ct,ref:nr}),c))});RemoveScroll.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};RemoveScroll.classNames={fullWidth:fullWidthClassName,zeroRight:zeroRightClassName};var getNonce=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function makeStyleTag(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var i=getNonce();return i&&e.setAttribute("nonce",i),e}function injectStyles(e,i){e.styleSheet?e.styleSheet.cssText=i:e.appendChild(document.createTextNode(i))}function insertStyleTag(e){var i=document.head||document.getElementsByTagName("head")[0];i.appendChild(e)}var stylesheetSingleton=function(){var e=0,i=null;return{add:function(s){e==0&&(i=makeStyleTag())&&(injectStyles(i,s),insertStyleTag(i)),e++},remove:function(){e--,!e&&i&&(i.parentNode&&i.parentNode.removeChild(i),i=null)}}},styleHookSingleton=function(){var e=stylesheetSingleton();return function(i,s){reactExports.useEffect(function(){return e.add(i),function(){e.remove()}},[i&&s])}},styleSingleton=function(){var e=styleHookSingleton(),i=function(s){var a=s.styles,_=s.dynamic;return e(a,_),null};return i},zeroGap={left:0,top:0,right:0,gap:0},parse=function(e){return parseInt(e||"",10)||0},getOffset=function(e){var i=window.getComputedStyle(document.body),s=i[e==="padding"?"paddingLeft":"marginLeft"],a=i[e==="padding"?"paddingTop":"marginTop"],_=i[e==="padding"?"paddingRight":"marginRight"];return[parse(s),parse(a),parse(_)]},getGapWidth=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return zeroGap;var i=getOffset(e),s=document.documentElement.clientWidth,a=window.innerWidth;return{left:i[0],top:i[1],right:i[2],gap:Math.max(0,a-s+i[2]-i[0])}},Style=styleSingleton(),lockAttribute="data-scroll-locked",getStyles=function(e,i,s,a){var _=e.left,et=e.top,nt=e.right,c=e.gap;return s===void 0&&(s="margin"),`
  .`.concat(noScrollbarsClassName,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(c,"px ").concat(a,`;
  }
  body[`).concat(lockAttribute,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([i&&"position: relative ".concat(a,";"),s==="margin"&&`
    padding-left: `.concat(_,`px;
    padding-top: `).concat(et,`px;
    padding-right: `).concat(nt,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(c,"px ").concat(a,`;
    `),s==="padding"&&"padding-right: ".concat(c,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(zeroRightClassName,` {
    right: `).concat(c,"px ").concat(a,`;
  }
  
  .`).concat(fullWidthClassName,` {
    margin-right: `).concat(c,"px ").concat(a,`;
  }
  
  .`).concat(zeroRightClassName," .").concat(zeroRightClassName,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(fullWidthClassName," .").concat(fullWidthClassName,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(lockAttribute,`] {
    `).concat(removedBarSizeVariable,": ").concat(c,`px;
  }
`)},getCurrentUseCounter=function(){var e=parseInt(document.body.getAttribute(lockAttribute)||"0",10);return isFinite(e)?e:0},useLockAttribute=function(){reactExports.useEffect(function(){return document.body.setAttribute(lockAttribute,(getCurrentUseCounter()+1).toString()),function(){var e=getCurrentUseCounter()-1;e<=0?document.body.removeAttribute(lockAttribute):document.body.setAttribute(lockAttribute,e.toString())}},[])},RemoveScrollBar=function(e){var i=e.noRelative,s=e.noImportant,a=e.gapMode,_=a===void 0?"margin":a;useLockAttribute();var et=reactExports.useMemo(function(){return getGapWidth(_)},[_]);return reactExports.createElement(Style,{styles:getStyles(et,!i,_,s?"":"!important")})},passiveSupported=!1;if(typeof window<"u")try{var options=Object.defineProperty({},"passive",{get:function(){return passiveSupported=!0,!0}});window.addEventListener("test",options,options),window.removeEventListener("test",options,options)}catch{passiveSupported=!1}var nonPassive=passiveSupported?{passive:!1}:!1,alwaysContainsScroll=function(e){return e.tagName==="TEXTAREA"},elementCanBeScrolled=function(e,i){if(!(e instanceof Element))return!1;var s=window.getComputedStyle(e);return s[i]!=="hidden"&&!(s.overflowY===s.overflowX&&!alwaysContainsScroll(e)&&s[i]==="visible")},elementCouldBeVScrolled=function(e){return elementCanBeScrolled(e,"overflowY")},elementCouldBeHScrolled=function(e){return elementCanBeScrolled(e,"overflowX")},locationCouldBeScrolled=function(e,i){var s=i.ownerDocument,a=i;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var _=elementCouldBeScrolled(e,a);if(_){var et=getScrollVariables(e,a),nt=et[1],c=et[2];if(nt>c)return!0}a=a.parentNode}while(a&&a!==s.body);return!1},getVScrollVariables=function(e){var i=e.scrollTop,s=e.scrollHeight,a=e.clientHeight;return[i,s,a]},getHScrollVariables=function(e){var i=e.scrollLeft,s=e.scrollWidth,a=e.clientWidth;return[i,s,a]},elementCouldBeScrolled=function(e,i){return e==="v"?elementCouldBeVScrolled(i):elementCouldBeHScrolled(i)},getScrollVariables=function(e,i){return e==="v"?getVScrollVariables(i):getHScrollVariables(i)},getDirectionFactor=function(e,i){return e==="h"&&i==="rtl"?-1:1},handleScroll=function(e,i,s,a,_){var et=getDirectionFactor(e,window.getComputedStyle(i).direction),nt=et*a,c=s.target,ct=i.contains(c),dt=!1,gt=nt>0,Tt=0,Et=0;do{if(!c)break;var At=getScrollVariables(e,c),Mt=At[0],Pt=At[1],$t=At[2],Lt=Pt-$t-et*Mt;(Mt||Lt)&&elementCouldBeScrolled(e,c)&&(Tt+=Lt,Et+=Mt);var Bt=c.parentNode;c=Bt&&Bt.nodeType===Node.DOCUMENT_FRAGMENT_NODE?Bt.host:Bt}while(!ct&&c!==document.body||ct&&(i.contains(c)||i===c));return(gt&&(Math.abs(Tt)<1||!_)||!gt&&(Math.abs(Et)<1||!_))&&(dt=!0),dt},getTouchXY=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},getDeltaXY=function(e){return[e.deltaX,e.deltaY]},extractRef=function(e){return e&&"current"in e?e.current:e},deltaCompare=function(e,i){return e[0]===i[0]&&e[1]===i[1]},generateStyle=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},idCounter=0,lockStack=[];function RemoveScrollSideCar(e){var i=reactExports.useRef([]),s=reactExports.useRef([0,0]),a=reactExports.useRef(),_=reactExports.useState(idCounter++)[0],et=reactExports.useState(styleSingleton)[0],nt=reactExports.useRef(e);reactExports.useEffect(function(){nt.current=e},[e]),reactExports.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(_));var Pt=__spreadArray([e.lockRef.current],(e.shards||[]).map(extractRef),!0).filter(Boolean);return Pt.forEach(function($t){return $t.classList.add("allow-interactivity-".concat(_))}),function(){document.body.classList.remove("block-interactivity-".concat(_)),Pt.forEach(function($t){return $t.classList.remove("allow-interactivity-".concat(_))})}}},[e.inert,e.lockRef.current,e.shards]);var c=reactExports.useCallback(function(Pt,$t){if("touches"in Pt&&Pt.touches.length===2||Pt.type==="wheel"&&Pt.ctrlKey)return!nt.current.allowPinchZoom;var Lt=getTouchXY(Pt),Bt=s.current,Nt="deltaX"in Pt?Pt.deltaX:Bt[0]-Lt[0],Vt="deltaY"in Pt?Pt.deltaY:Bt[1]-Lt[1],Xt,nr=Pt.target,ar=Math.abs(Nt)>Math.abs(Vt)?"h":"v";if("touches"in Pt&&ar==="h"&&nr.type==="range")return!1;var mr=locationCouldBeScrolled(ar,nr);if(!mr)return!0;if(mr?Xt=ar:(Xt=ar==="v"?"h":"v",mr=locationCouldBeScrolled(ar,nr)),!mr)return!1;if(!a.current&&"changedTouches"in Pt&&(Nt||Vt)&&(a.current=Xt),!Xt)return!0;var Fr=a.current||Xt;return handleScroll(Fr,$t,Pt,Fr==="h"?Nt:Vt,!0)},[]),ct=reactExports.useCallback(function(Pt){var $t=Pt;if(!(!lockStack.length||lockStack[lockStack.length-1]!==et)){var Lt="deltaY"in $t?getDeltaXY($t):getTouchXY($t),Bt=i.current.filter(function(Xt){return Xt.name===$t.type&&(Xt.target===$t.target||$t.target===Xt.shadowParent)&&deltaCompare(Xt.delta,Lt)})[0];if(Bt&&Bt.should){$t.cancelable&&$t.preventDefault();return}if(!Bt){var Nt=(nt.current.shards||[]).map(extractRef).filter(Boolean).filter(function(Xt){return Xt.contains($t.target)}),Vt=Nt.length>0?c($t,Nt[0]):!nt.current.noIsolation;Vt&&$t.cancelable&&$t.preventDefault()}}},[]),dt=reactExports.useCallback(function(Pt,$t,Lt,Bt){var Nt={name:Pt,delta:$t,target:Lt,should:Bt,shadowParent:getOutermostShadowParent(Lt)};i.current.push(Nt),setTimeout(function(){i.current=i.current.filter(function(Vt){return Vt!==Nt})},1)},[]),gt=reactExports.useCallback(function(Pt){s.current=getTouchXY(Pt),a.current=void 0},[]),Tt=reactExports.useCallback(function(Pt){dt(Pt.type,getDeltaXY(Pt),Pt.target,c(Pt,e.lockRef.current))},[]),Et=reactExports.useCallback(function(Pt){dt(Pt.type,getTouchXY(Pt),Pt.target,c(Pt,e.lockRef.current))},[]);reactExports.useEffect(function(){return lockStack.push(et),e.setCallbacks({onScrollCapture:Tt,onWheelCapture:Tt,onTouchMoveCapture:Et}),document.addEventListener("wheel",ct,nonPassive),document.addEventListener("touchmove",ct,nonPassive),document.addEventListener("touchstart",gt,nonPassive),function(){lockStack=lockStack.filter(function(Pt){return Pt!==et}),document.removeEventListener("wheel",ct,nonPassive),document.removeEventListener("touchmove",ct,nonPassive),document.removeEventListener("touchstart",gt,nonPassive)}},[]);var At=e.removeScrollBar,Mt=e.inert;return reactExports.createElement(reactExports.Fragment,null,Mt?reactExports.createElement(et,{styles:generateStyle(_)}):null,At?reactExports.createElement(RemoveScrollBar,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function getOutermostShadowParent(e){for(var i=null;e!==null;)e instanceof ShadowRoot&&(i=e.host,e=e.host),e=e.parentNode;return i}const SideCar=exportSidecar(effectCar,RemoveScrollSideCar);var ReactRemoveScroll=reactExports.forwardRef(function(e,i){return reactExports.createElement(RemoveScroll,__assign({},e,{ref:i,sideCar:SideCar}))});ReactRemoveScroll.classNames=RemoveScroll.classNames;var getDefaultParent=function(e){if(typeof document>"u")return null;var i=Array.isArray(e)?e[0]:e;return i.ownerDocument.body},counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={},lockCount=0,unwrapHost=function(e){return e&&(e.host||unwrapHost(e.parentNode))},correctTargets=function(e,i){return i.map(function(s){if(e.contains(s))return s;var a=unwrapHost(s);return a&&e.contains(a)?a:(console.error("aria-hidden",s,"in not contained inside",e,". Doing nothing"),null)}).filter(function(s){return!!s})},applyAttributeToOthers=function(e,i,s,a){var _=correctTargets(i,Array.isArray(e)?e:[e]);markerMap[s]||(markerMap[s]=new WeakMap);var et=markerMap[s],nt=[],c=new Set,ct=new Set(_),dt=function(Tt){!Tt||c.has(Tt)||(c.add(Tt),dt(Tt.parentNode))};_.forEach(dt);var gt=function(Tt){!Tt||ct.has(Tt)||Array.prototype.forEach.call(Tt.children,function(Et){if(c.has(Et))gt(Et);else try{var At=Et.getAttribute(a),Mt=At!==null&&At!=="false",Pt=(counterMap.get(Et)||0)+1,$t=(et.get(Et)||0)+1;counterMap.set(Et,Pt),et.set(Et,$t),nt.push(Et),Pt===1&&Mt&&uncontrolledNodes.set(Et,!0),$t===1&&Et.setAttribute(s,"true"),Mt||Et.setAttribute(a,"true")}catch(Lt){console.error("aria-hidden: cannot operate on ",Et,Lt)}})};return gt(i),c.clear(),lockCount++,function(){nt.forEach(function(Tt){var Et=counterMap.get(Tt)-1,At=et.get(Tt)-1;counterMap.set(Tt,Et),et.set(Tt,At),Et||(uncontrolledNodes.has(Tt)||Tt.removeAttribute(a),uncontrolledNodes.delete(Tt)),At||Tt.removeAttribute(s)}),lockCount--,lockCount||(counterMap=new WeakMap,counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={})}},hideOthers=function(e,i,s){s===void 0&&(s="data-aria-hidden");var a=Array.from(Array.isArray(e)?e:[e]),_=getDefaultParent(e);return _?(a.push.apply(a,Array.from(_.querySelectorAll("[aria-live]"))),applyAttributeToOthers(a,_,s,"aria-hidden")):function(){return null}},DIALOG_NAME="Dialog",[createDialogContext,createDialogScope]=createContextScope(DIALOG_NAME),[DialogProvider,useDialogContext]=createDialogContext(DIALOG_NAME),Dialog$1=e=>{const{__scopeDialog:i,children:s,open:a,defaultOpen:_,onOpenChange:et,modal:nt=!0}=e,c=reactExports.useRef(null),ct=reactExports.useRef(null),[dt,gt]=useControllableState({prop:a,defaultProp:_??!1,onChange:et,caller:DIALOG_NAME});return jsxRuntimeExports.jsx(DialogProvider,{scope:i,triggerRef:c,contentRef:ct,contentId:useId(),titleId:useId(),descriptionId:useId(),open:dt,onOpenChange:gt,onOpenToggle:reactExports.useCallback(()=>gt(Tt=>!Tt),[gt]),modal:nt,children:s})};Dialog$1.displayName=DIALOG_NAME;var TRIGGER_NAME$4="DialogTrigger",DialogTrigger$1=reactExports.forwardRef((e,i)=>{const{__scopeDialog:s,...a}=e,_=useDialogContext(TRIGGER_NAME$4,s),et=useComposedRefs$1(i,_.triggerRef);return jsxRuntimeExports.jsx(Primitive.button,{type:"button","aria-haspopup":"dialog","aria-expanded":_.open,"aria-controls":_.contentId,"data-state":getState$2(_.open),...a,ref:et,onClick:composeEventHandlers(e.onClick,_.onOpenToggle)})});DialogTrigger$1.displayName=TRIGGER_NAME$4;var PORTAL_NAME$2="DialogPortal",[PortalProvider,usePortalContext]=createDialogContext(PORTAL_NAME$2,{forceMount:void 0}),DialogPortal$1=e=>{const{__scopeDialog:i,forceMount:s,children:a,container:_}=e,et=useDialogContext(PORTAL_NAME$2,i);return jsxRuntimeExports.jsx(PortalProvider,{scope:i,forceMount:s,children:reactExports.Children.map(a,nt=>jsxRuntimeExports.jsx(Presence,{present:s||et.open,children:jsxRuntimeExports.jsx(Portal$2,{asChild:!0,container:_,children:nt})}))})};DialogPortal$1.displayName=PORTAL_NAME$2;var OVERLAY_NAME$1="DialogOverlay",DialogOverlay$1=reactExports.forwardRef((e,i)=>{const s=usePortalContext(OVERLAY_NAME$1,e.__scopeDialog),{forceMount:a=s.forceMount,..._}=e,et=useDialogContext(OVERLAY_NAME$1,e.__scopeDialog);return et.modal?jsxRuntimeExports.jsx(Presence,{present:a||et.open,children:jsxRuntimeExports.jsx(DialogOverlayImpl,{..._,ref:i})}):null});DialogOverlay$1.displayName=OVERLAY_NAME$1;var Slot$1=createSlot("DialogOverlay.RemoveScroll"),DialogOverlayImpl=reactExports.forwardRef((e,i)=>{const{__scopeDialog:s,...a}=e,_=useDialogContext(OVERLAY_NAME$1,s);return jsxRuntimeExports.jsx(ReactRemoveScroll,{as:Slot$1,allowPinchZoom:!0,shards:[_.contentRef],children:jsxRuntimeExports.jsx(Primitive.div,{"data-state":getState$2(_.open),...a,ref:i,style:{pointerEvents:"auto",...a.style}})})}),CONTENT_NAME$4="DialogContent",DialogContent$1=reactExports.forwardRef((e,i)=>{const s=usePortalContext(CONTENT_NAME$4,e.__scopeDialog),{forceMount:a=s.forceMount,..._}=e,et=useDialogContext(CONTENT_NAME$4,e.__scopeDialog);return jsxRuntimeExports.jsx(Presence,{present:a||et.open,children:et.modal?jsxRuntimeExports.jsx(DialogContentModal,{..._,ref:i}):jsxRuntimeExports.jsx(DialogContentNonModal,{..._,ref:i})})});DialogContent$1.displayName=CONTENT_NAME$4;var DialogContentModal=reactExports.forwardRef((e,i)=>{const s=useDialogContext(CONTENT_NAME$4,e.__scopeDialog),a=reactExports.useRef(null),_=useComposedRefs$1(i,s.contentRef,a);return reactExports.useEffect(()=>{const et=a.current;if(et)return hideOthers(et)},[]),jsxRuntimeExports.jsx(DialogContentImpl,{...e,ref:_,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:composeEventHandlers(e.onCloseAutoFocus,et=>{var nt;et.preventDefault(),(nt=s.triggerRef.current)==null||nt.focus()}),onPointerDownOutside:composeEventHandlers(e.onPointerDownOutside,et=>{const nt=et.detail.originalEvent,c=nt.button===0&&nt.ctrlKey===!0;(nt.button===2||c)&&et.preventDefault()}),onFocusOutside:composeEventHandlers(e.onFocusOutside,et=>et.preventDefault())})}),DialogContentNonModal=reactExports.forwardRef((e,i)=>{const s=useDialogContext(CONTENT_NAME$4,e.__scopeDialog),a=reactExports.useRef(!1),_=reactExports.useRef(!1);return jsxRuntimeExports.jsx(DialogContentImpl,{...e,ref:i,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:et=>{var nt,c;(nt=e.onCloseAutoFocus)==null||nt.call(e,et),et.defaultPrevented||(a.current||(c=s.triggerRef.current)==null||c.focus(),et.preventDefault()),a.current=!1,_.current=!1},onInteractOutside:et=>{var ct,dt;(ct=e.onInteractOutside)==null||ct.call(e,et),et.defaultPrevented||(a.current=!0,et.detail.originalEvent.type==="pointerdown"&&(_.current=!0));const nt=et.target;((dt=s.triggerRef.current)==null?void 0:dt.contains(nt))&&et.preventDefault(),et.detail.originalEvent.type==="focusin"&&_.current&&et.preventDefault()}})}),DialogContentImpl=reactExports.forwardRef((e,i)=>{const{__scopeDialog:s,trapFocus:a,onOpenAutoFocus:_,onCloseAutoFocus:et,...nt}=e,c=useDialogContext(CONTENT_NAME$4,s),ct=reactExports.useRef(null),dt=useComposedRefs$1(i,ct);return useFocusGuards(),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(FocusScope,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:_,onUnmountAutoFocus:et,children:jsxRuntimeExports.jsx(DismissableLayer,{role:"dialog",id:c.contentId,"aria-describedby":c.descriptionId,"aria-labelledby":c.titleId,"data-state":getState$2(c.open),...nt,ref:dt,onDismiss:()=>c.onOpenChange(!1)})}),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(TitleWarning,{titleId:c.titleId}),jsxRuntimeExports.jsx(DescriptionWarning$1,{contentRef:ct,descriptionId:c.descriptionId})]})]})}),TITLE_NAME$1="DialogTitle",DialogTitle$1=reactExports.forwardRef((e,i)=>{const{__scopeDialog:s,...a}=e,_=useDialogContext(TITLE_NAME$1,s);return jsxRuntimeExports.jsx(Primitive.h2,{id:_.titleId,...a,ref:i})});DialogTitle$1.displayName=TITLE_NAME$1;var DESCRIPTION_NAME$1="DialogDescription",DialogDescription$1=reactExports.forwardRef((e,i)=>{const{__scopeDialog:s,...a}=e,_=useDialogContext(DESCRIPTION_NAME$1,s);return jsxRuntimeExports.jsx(Primitive.p,{id:_.descriptionId,...a,ref:i})});DialogDescription$1.displayName=DESCRIPTION_NAME$1;var CLOSE_NAME="DialogClose",DialogClose=reactExports.forwardRef((e,i)=>{const{__scopeDialog:s,...a}=e,_=useDialogContext(CLOSE_NAME,s);return jsxRuntimeExports.jsx(Primitive.button,{type:"button",...a,ref:i,onClick:composeEventHandlers(e.onClick,()=>_.onOpenChange(!1))})});DialogClose.displayName=CLOSE_NAME;function getState$2(e){return e?"open":"closed"}var TITLE_WARNING_NAME="DialogTitleWarning",[WarningProvider,useWarningContext]=createContext2(TITLE_WARNING_NAME,{contentName:CONTENT_NAME$4,titleName:TITLE_NAME$1,docsSlug:"dialog"}),TitleWarning=({titleId:e})=>{const i=useWarningContext(TITLE_WARNING_NAME),s=`\`${i.contentName}\` requires a \`${i.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${i.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${i.docsSlug}`;return reactExports.useEffect(()=>{e&&(document.getElementById(e)||console.error(s))},[s,e]),null},DESCRIPTION_WARNING_NAME="DialogDescriptionWarning",DescriptionWarning$1=({contentRef:e,descriptionId:i})=>{const a=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${useWarningContext(DESCRIPTION_WARNING_NAME).contentName}}.`;return reactExports.useEffect(()=>{var et;const _=(et=e.current)==null?void 0:et.getAttribute("aria-describedby");i&&_&&(document.getElementById(i)||console.warn(a))},[a,e,i]),null},Root$1=Dialog$1,Trigger$2=DialogTrigger$1,Portal$1=DialogPortal$1,Overlay=DialogOverlay$1,Content$1=DialogContent$1,Title=DialogTitle$1,Description=DialogDescription$1,Close=DialogClose,ROOT_NAME="AlertDialog",[createAlertDialogContext,createAlertDialogScope]=createContextScope(ROOT_NAME,[createDialogScope]),useDialogScope=createDialogScope(),AlertDialog$1=e=>{const{__scopeAlertDialog:i,...s}=e,a=useDialogScope(i);return jsxRuntimeExports.jsx(Root$1,{...a,...s,modal:!0})};AlertDialog$1.displayName=ROOT_NAME;var TRIGGER_NAME$3="AlertDialogTrigger",AlertDialogTrigger$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,...a}=e,_=useDialogScope(s);return jsxRuntimeExports.jsx(Trigger$2,{..._,...a,ref:i})});AlertDialogTrigger$1.displayName=TRIGGER_NAME$3;var PORTAL_NAME$1="AlertDialogPortal",AlertDialogPortal$1=e=>{const{__scopeAlertDialog:i,...s}=e,a=useDialogScope(i);return jsxRuntimeExports.jsx(Portal$1,{...a,...s})};AlertDialogPortal$1.displayName=PORTAL_NAME$1;var OVERLAY_NAME="AlertDialogOverlay",AlertDialogOverlay$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,...a}=e,_=useDialogScope(s);return jsxRuntimeExports.jsx(Overlay,{..._,...a,ref:i})});AlertDialogOverlay$1.displayName=OVERLAY_NAME;var CONTENT_NAME$3="AlertDialogContent",[AlertDialogContentProvider,useAlertDialogContentContext]=createAlertDialogContext(CONTENT_NAME$3),Slottable=createSlottable("AlertDialogContent"),AlertDialogContent$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,children:a,..._}=e,et=useDialogScope(s),nt=reactExports.useRef(null),c=useComposedRefs$1(i,nt),ct=reactExports.useRef(null);return jsxRuntimeExports.jsx(WarningProvider,{contentName:CONTENT_NAME$3,titleName:TITLE_NAME,docsSlug:"alert-dialog",children:jsxRuntimeExports.jsx(AlertDialogContentProvider,{scope:s,cancelRef:ct,children:jsxRuntimeExports.jsxs(Content$1,{role:"alertdialog",...et,..._,ref:c,onOpenAutoFocus:composeEventHandlers(_.onOpenAutoFocus,dt=>{var gt;dt.preventDefault(),(gt=ct.current)==null||gt.focus({preventScroll:!0})}),onPointerDownOutside:dt=>dt.preventDefault(),onInteractOutside:dt=>dt.preventDefault(),children:[jsxRuntimeExports.jsx(Slottable,{children:a}),jsxRuntimeExports.jsx(DescriptionWarning,{contentRef:nt})]})})})});AlertDialogContent$1.displayName=CONTENT_NAME$3;var TITLE_NAME="AlertDialogTitle",AlertDialogTitle$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,...a}=e,_=useDialogScope(s);return jsxRuntimeExports.jsx(Title,{..._,...a,ref:i})});AlertDialogTitle$1.displayName=TITLE_NAME;var DESCRIPTION_NAME="AlertDialogDescription",AlertDialogDescription$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,...a}=e,_=useDialogScope(s);return jsxRuntimeExports.jsx(Description,{..._,...a,ref:i})});AlertDialogDescription$1.displayName=DESCRIPTION_NAME;var ACTION_NAME="AlertDialogAction",AlertDialogAction$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,...a}=e,_=useDialogScope(s);return jsxRuntimeExports.jsx(Close,{..._,...a,ref:i})});AlertDialogAction$1.displayName=ACTION_NAME;var CANCEL_NAME="AlertDialogCancel",AlertDialogCancel$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,...a}=e,{cancelRef:_}=useAlertDialogContentContext(CANCEL_NAME,s),et=useDialogScope(s),nt=useComposedRefs$1(i,_);return jsxRuntimeExports.jsx(Close,{...et,...a,ref:nt})});AlertDialogCancel$1.displayName=CANCEL_NAME;var DescriptionWarning=({contentRef:e})=>{const i=`\`${CONTENT_NAME$3}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${CONTENT_NAME$3}\` by passing a \`${DESCRIPTION_NAME}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${CONTENT_NAME$3}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return reactExports.useEffect(()=>{var a;document.getElementById((a=e.current)==null?void 0:a.getAttribute("aria-describedby"))||console.warn(i)},[i,e]),null},Root2$2=AlertDialog$1,Trigger2$1=AlertDialogTrigger$1,Portal2=AlertDialogPortal$1,Overlay2=AlertDialogOverlay$1,Content2$2=AlertDialogContent$1,Action=AlertDialogAction$1,Cancel=AlertDialogCancel$1,Title2=AlertDialogTitle$1,Description2=AlertDialogDescription$1;const AlertDialog=Root2$2,AlertDialogTrigger=Trigger2$1,AlertDialogPortal=Portal2,AlertDialogOverlay=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Overlay2,{className:cn("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...i,ref:s}));AlertDialogOverlay.displayName=Overlay2.displayName;const AlertDialogContent=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsxs(AlertDialogPortal,{children:[jsxRuntimeExports.jsx(AlertDialogOverlay,{}),jsxRuntimeExports.jsx(Content2$2,{ref:s,className:cn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...i})]}));AlertDialogContent.displayName=Content2$2.displayName;const AlertDialogHeader=({className:e,...i})=>jsxRuntimeExports.jsx("div",{className:cn("flex flex-col space-y-2 text-center sm:text-left",e),...i});AlertDialogHeader.displayName="AlertDialogHeader";const AlertDialogFooter=({className:e,...i})=>jsxRuntimeExports.jsx("div",{className:cn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...i});AlertDialogFooter.displayName="AlertDialogFooter";const AlertDialogTitle=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Title2,{ref:s,className:cn("text-lg font-semibold",e),...i}));AlertDialogTitle.displayName=Title2.displayName;const AlertDialogDescription=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Description2,{ref:s,className:cn("text-sm text-muted-foreground",e),...i}));AlertDialogDescription.displayName=Description2.displayName;const AlertDialogAction=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Action,{ref:s,className:cn(buttonVariants(),e),...i}));AlertDialogAction.displayName=Action.displayName;const AlertDialogCancel=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Cancel,{ref:s,className:cn(buttonVariants({variant:"outline"}),"mt-2 sm:mt-0",e),...i}));AlertDialogCancel.displayName=Cancel.displayName;function SettingsPage(){const[e,i]=reactExports.useState(!0),[s,a]=reactExports.useState(!0),[_,et]=reactExports.useState(!1),[nt,c]=reactExports.useState(!1),ct=()=>{ue.success("Account deletion request submitted")};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card border-b border-border px-4 py-4 flex items-center gap-4 sticky top-0 z-10",children:[jsxRuntimeExports.jsx(Link,{to:"/profile",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"p-2 -ml-2",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-6 h-6 text-foreground"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-bold text-foreground",children:"Settings"})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center text-primary",children:jsxRuntimeExports.jsx(Bell,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Notifications"})]})}),jsxRuntimeExports.jsxs("div",{className:"divide-y divide-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Push Notifications"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive push notifications"})]}),jsxRuntimeExports.jsx(Switch,{checked:e,onCheckedChange:i})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Order Updates"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified about order status"})]}),jsxRuntimeExports.jsx(Switch,{checked:s,onCheckedChange:a})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Promotions"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive offers and discounts"})]}),jsxRuntimeExports.jsx(Switch,{checked:_,onCheckedChange:et})]})]})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:jsxRuntimeExports.jsx(Moon,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Appearance"})]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Dark Mode"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Switch to dark theme"})]}),jsxRuntimeExports.jsx(Switch,{checked:nt,onCheckedChange:c})]})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-accent/10 flex items-center justify-center text-accent",children:jsxRuntimeExports.jsx(Globe,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Language & Region"})]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Language"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"English (India)"})]}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-muted-foreground"})]})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gold/10 flex items-center justify-center text-gold",children:jsxRuntimeExports.jsx(Lock,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Security"})]})}),jsxRuntimeExports.jsxs("div",{className:"divide-y divide-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Change Password"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Update your password"})]}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-muted-foreground"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Two-Factor Authentication"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Add extra security"})]}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-muted-foreground"})]})]})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:jsxRuntimeExports.jsx(Smartphone,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"App Info"})]})}),jsxRuntimeExports.jsx("div",{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"Version"}),jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"1.0.0"})]})})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-card rounded-2xl shadow-elevated overflow-hidden border border-destructive/20",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-destructive/10 flex items-center justify-center text-destructive",children:jsxRuntimeExports.jsx(Trash2,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"font-semibold text-destructive",children:"Danger Zone"})]})}),jsxRuntimeExports.jsx("div",{className:"p-4",children:jsxRuntimeExports.jsxs(AlertDialog,{children:[jsxRuntimeExports.jsx(AlertDialogTrigger,{asChild:!0,children:jsxRuntimeExports.jsx(Button,{variant:"destructive",className:"w-full",children:"Delete Account"})}),jsxRuntimeExports.jsxs(AlertDialogContent,{children:[jsxRuntimeExports.jsxs(AlertDialogHeader,{children:[jsxRuntimeExports.jsx(AlertDialogTitle,{children:"Are you absolutely sure?"}),jsxRuntimeExports.jsx(AlertDialogDescription,{children:"This action cannot be undone. This will permanently delete your account and remove all your data from our servers."})]}),jsxRuntimeExports.jsxs(AlertDialogFooter,{children:[jsxRuntimeExports.jsx(AlertDialogCancel,{children:"Cancel"}),jsxRuntimeExports.jsx(AlertDialogAction,{onClick:ct,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete Account"})]})]})]})})]})]}),jsxRuntimeExports.jsx(BottomNav,{})]})}var COLLAPSIBLE_NAME="Collapsible",[createCollapsibleContext,createCollapsibleScope]=createContextScope(COLLAPSIBLE_NAME),[CollapsibleProvider,useCollapsibleContext]=createCollapsibleContext(COLLAPSIBLE_NAME),Collapsible=reactExports.forwardRef((e,i)=>{const{__scopeCollapsible:s,open:a,defaultOpen:_,disabled:et,onOpenChange:nt,...c}=e,[ct,dt]=useControllableState({prop:a,defaultProp:_??!1,onChange:nt,caller:COLLAPSIBLE_NAME});return jsxRuntimeExports.jsx(CollapsibleProvider,{scope:s,disabled:et,contentId:useId(),open:ct,onOpenToggle:reactExports.useCallback(()=>dt(gt=>!gt),[dt]),children:jsxRuntimeExports.jsx(Primitive.div,{"data-state":getState$1(ct),"data-disabled":et?"":void 0,...c,ref:i})})});Collapsible.displayName=COLLAPSIBLE_NAME;var TRIGGER_NAME$2="CollapsibleTrigger",CollapsibleTrigger=reactExports.forwardRef((e,i)=>{const{__scopeCollapsible:s,...a}=e,_=useCollapsibleContext(TRIGGER_NAME$2,s);return jsxRuntimeExports.jsx(Primitive.button,{type:"button","aria-controls":_.contentId,"aria-expanded":_.open||!1,"data-state":getState$1(_.open),"data-disabled":_.disabled?"":void 0,disabled:_.disabled,...a,ref:i,onClick:composeEventHandlers(e.onClick,_.onOpenToggle)})});CollapsibleTrigger.displayName=TRIGGER_NAME$2;var CONTENT_NAME$2="CollapsibleContent",CollapsibleContent=reactExports.forwardRef((e,i)=>{const{forceMount:s,...a}=e,_=useCollapsibleContext(CONTENT_NAME$2,e.__scopeCollapsible);return jsxRuntimeExports.jsx(Presence,{present:s||_.open,children:({present:et})=>jsxRuntimeExports.jsx(CollapsibleContentImpl,{...a,ref:i,present:et})})});CollapsibleContent.displayName=CONTENT_NAME$2;var CollapsibleContentImpl=reactExports.forwardRef((e,i)=>{const{__scopeCollapsible:s,present:a,children:_,...et}=e,nt=useCollapsibleContext(CONTENT_NAME$2,s),[c,ct]=reactExports.useState(a),dt=reactExports.useRef(null),gt=useComposedRefs$1(i,dt),Tt=reactExports.useRef(0),Et=Tt.current,At=reactExports.useRef(0),Mt=At.current,Pt=nt.open||c,$t=reactExports.useRef(Pt),Lt=reactExports.useRef(void 0);return reactExports.useEffect(()=>{const Bt=requestAnimationFrame(()=>$t.current=!1);return()=>cancelAnimationFrame(Bt)},[]),useLayoutEffect2(()=>{const Bt=dt.current;if(Bt){Lt.current=Lt.current||{transitionDuration:Bt.style.transitionDuration,animationName:Bt.style.animationName},Bt.style.transitionDuration="0s",Bt.style.animationName="none";const Nt=Bt.getBoundingClientRect();Tt.current=Nt.height,At.current=Nt.width,$t.current||(Bt.style.transitionDuration=Lt.current.transitionDuration,Bt.style.animationName=Lt.current.animationName),ct(a)}},[nt.open,a]),jsxRuntimeExports.jsx(Primitive.div,{"data-state":getState$1(nt.open),"data-disabled":nt.disabled?"":void 0,id:nt.contentId,hidden:!Pt,...et,ref:gt,style:{"--radix-collapsible-content-height":Et?`${Et}px`:void 0,"--radix-collapsible-content-width":Mt?`${Mt}px`:void 0,...e.style},children:Pt&&_})});function getState$1(e){return e?"open":"closed"}var Root=Collapsible,Trigger$1=CollapsibleTrigger,Content=CollapsibleContent,DirectionContext=reactExports.createContext(void 0);function useDirection(e){const i=reactExports.useContext(DirectionContext);return e||i||"ltr"}var ACCORDION_NAME="Accordion",ACCORDION_KEYS=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[Collection$1,useCollection$1,createCollectionScope$1]=createCollection(ACCORDION_NAME),[createAccordionContext,createAccordionScope]=createContextScope(ACCORDION_NAME,[createCollectionScope$1,createCollapsibleScope]),useCollapsibleScope=createCollapsibleScope(),Accordion$1=React.forwardRef((e,i)=>{const{type:s,...a}=e,_=a,et=a;return jsxRuntimeExports.jsx(Collection$1.Provider,{scope:e.__scopeAccordion,children:s==="multiple"?jsxRuntimeExports.jsx(AccordionImplMultiple,{...et,ref:i}):jsxRuntimeExports.jsx(AccordionImplSingle,{..._,ref:i})})});Accordion$1.displayName=ACCORDION_NAME;var[AccordionValueProvider,useAccordionValueContext]=createAccordionContext(ACCORDION_NAME),[AccordionCollapsibleProvider,useAccordionCollapsibleContext]=createAccordionContext(ACCORDION_NAME,{collapsible:!1}),AccordionImplSingle=React.forwardRef((e,i)=>{const{value:s,defaultValue:a,onValueChange:_=()=>{},collapsible:et=!1,...nt}=e,[c,ct]=useControllableState({prop:s,defaultProp:a??"",onChange:_,caller:ACCORDION_NAME});return jsxRuntimeExports.jsx(AccordionValueProvider,{scope:e.__scopeAccordion,value:React.useMemo(()=>c?[c]:[],[c]),onItemOpen:ct,onItemClose:React.useCallback(()=>et&&ct(""),[et,ct]),children:jsxRuntimeExports.jsx(AccordionCollapsibleProvider,{scope:e.__scopeAccordion,collapsible:et,children:jsxRuntimeExports.jsx(AccordionImpl,{...nt,ref:i})})})}),AccordionImplMultiple=React.forwardRef((e,i)=>{const{value:s,defaultValue:a,onValueChange:_=()=>{},...et}=e,[nt,c]=useControllableState({prop:s,defaultProp:a??[],onChange:_,caller:ACCORDION_NAME}),ct=React.useCallback(gt=>c((Tt=[])=>[...Tt,gt]),[c]),dt=React.useCallback(gt=>c((Tt=[])=>Tt.filter(Et=>Et!==gt)),[c]);return jsxRuntimeExports.jsx(AccordionValueProvider,{scope:e.__scopeAccordion,value:nt,onItemOpen:ct,onItemClose:dt,children:jsxRuntimeExports.jsx(AccordionCollapsibleProvider,{scope:e.__scopeAccordion,collapsible:!0,children:jsxRuntimeExports.jsx(AccordionImpl,{...et,ref:i})})})}),[AccordionImplProvider,useAccordionContext]=createAccordionContext(ACCORDION_NAME),AccordionImpl=React.forwardRef((e,i)=>{const{__scopeAccordion:s,disabled:a,dir:_,orientation:et="vertical",...nt}=e,c=React.useRef(null),ct=useComposedRefs$1(c,i),dt=useCollection$1(s),Tt=useDirection(_)==="ltr",Et=composeEventHandlers(e.onKeyDown,At=>{var mr;if(!ACCORDION_KEYS.includes(At.key))return;const Mt=At.target,Pt=dt().filter(Fr=>{var sn;return!((sn=Fr.ref.current)!=null&&sn.disabled)}),$t=Pt.findIndex(Fr=>Fr.ref.current===Mt),Lt=Pt.length;if($t===-1)return;At.preventDefault();let Bt=$t;const Nt=0,Vt=Lt-1,Xt=()=>{Bt=$t+1,Bt>Vt&&(Bt=Nt)},nr=()=>{Bt=$t-1,Bt<Nt&&(Bt=Vt)};switch(At.key){case"Home":Bt=Nt;break;case"End":Bt=Vt;break;case"ArrowRight":et==="horizontal"&&(Tt?Xt():nr());break;case"ArrowDown":et==="vertical"&&Xt();break;case"ArrowLeft":et==="horizontal"&&(Tt?nr():Xt());break;case"ArrowUp":et==="vertical"&&nr();break}const ar=Bt%Lt;(mr=Pt[ar].ref.current)==null||mr.focus()});return jsxRuntimeExports.jsx(AccordionImplProvider,{scope:s,disabled:a,direction:_,orientation:et,children:jsxRuntimeExports.jsx(Collection$1.Slot,{scope:s,children:jsxRuntimeExports.jsx(Primitive.div,{...nt,"data-orientation":et,ref:ct,onKeyDown:a?void 0:Et})})})}),ITEM_NAME$1="AccordionItem",[AccordionItemProvider,useAccordionItemContext]=createAccordionContext(ITEM_NAME$1),AccordionItem$1=React.forwardRef((e,i)=>{const{__scopeAccordion:s,value:a,..._}=e,et=useAccordionContext(ITEM_NAME$1,s),nt=useAccordionValueContext(ITEM_NAME$1,s),c=useCollapsibleScope(s),ct=useId(),dt=a&&nt.value.includes(a)||!1,gt=et.disabled||e.disabled;return jsxRuntimeExports.jsx(AccordionItemProvider,{scope:s,open:dt,disabled:gt,triggerId:ct,children:jsxRuntimeExports.jsx(Root,{"data-orientation":et.orientation,"data-state":getState(dt),...c,..._,ref:i,disabled:gt,open:dt,onOpenChange:Tt=>{Tt?nt.onItemOpen(a):nt.onItemClose(a)}})})});AccordionItem$1.displayName=ITEM_NAME$1;var HEADER_NAME="AccordionHeader",AccordionHeader=React.forwardRef((e,i)=>{const{__scopeAccordion:s,...a}=e,_=useAccordionContext(ACCORDION_NAME,s),et=useAccordionItemContext(HEADER_NAME,s);return jsxRuntimeExports.jsx(Primitive.h3,{"data-orientation":_.orientation,"data-state":getState(et.open),"data-disabled":et.disabled?"":void 0,...a,ref:i})});AccordionHeader.displayName=HEADER_NAME;var TRIGGER_NAME$1="AccordionTrigger",AccordionTrigger$1=React.forwardRef((e,i)=>{const{__scopeAccordion:s,...a}=e,_=useAccordionContext(ACCORDION_NAME,s),et=useAccordionItemContext(TRIGGER_NAME$1,s),nt=useAccordionCollapsibleContext(TRIGGER_NAME$1,s),c=useCollapsibleScope(s);return jsxRuntimeExports.jsx(Collection$1.ItemSlot,{scope:s,children:jsxRuntimeExports.jsx(Trigger$1,{"aria-disabled":et.open&&!nt.collapsible||void 0,"data-orientation":_.orientation,id:et.triggerId,...c,...a,ref:i})})});AccordionTrigger$1.displayName=TRIGGER_NAME$1;var CONTENT_NAME$1="AccordionContent",AccordionContent$1=React.forwardRef((e,i)=>{const{__scopeAccordion:s,...a}=e,_=useAccordionContext(ACCORDION_NAME,s),et=useAccordionItemContext(CONTENT_NAME$1,s),nt=useCollapsibleScope(s);return jsxRuntimeExports.jsx(Content,{role:"region","aria-labelledby":et.triggerId,"data-orientation":_.orientation,...nt,...a,ref:i,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...e.style}})});AccordionContent$1.displayName=CONTENT_NAME$1;function getState(e){return e?"open":"closed"}var Root2$1=Accordion$1,Item$1=AccordionItem$1,Header=AccordionHeader,Trigger2=AccordionTrigger$1,Content2$1=AccordionContent$1;const Accordion=Root2$1,AccordionItem=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Item$1,{ref:s,className:cn("border-b",e),...i}));AccordionItem.displayName="AccordionItem";const AccordionTrigger=reactExports.forwardRef(({className:e,children:i,...s},a)=>jsxRuntimeExports.jsx(Header,{className:"flex",children:jsxRuntimeExports.jsxs(Trigger2,{ref:a,className:cn("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",e),...s,children:[i,jsxRuntimeExports.jsx(ChevronDown,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));AccordionTrigger.displayName=Trigger2.displayName;const AccordionContent=reactExports.forwardRef(({className:e,children:i,...s},a)=>jsxRuntimeExports.jsx(Content2$1,{ref:a,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...s,children:jsxRuntimeExports.jsx("div",{className:cn("pb-4 pt-0",e),children:i})}));AccordionContent.displayName=Content2$1.displayName;const faqs=[{question:"How do I place an order?",answer:"Browse kitchens near you, select dishes from the menu, add them to your cart, and proceed to checkout. You can pay using various payment methods including UPI, cards, and cash on delivery."},{question:"How can I track my order?",answer:"Once your order is placed, you can track it in real-time from the 'My Orders' section. You'll receive notifications at each stage - from acceptance to delivery."},{question:"What if I want to cancel my order?",answer:"You can cancel your order before it's accepted by the kitchen. Go to 'My Orders', select the order, and tap 'Cancel Order'. Once accepted, please contact support for cancellation."},{question:"How do refunds work?",answer:"Refunds are processed within 5-7 business days to your original payment method. For wallet credits, refunds are instant."},{question:"How do I become an Amma (Home Cook)?",answer:"Go to your Profile, tap 'Become an Amma', and follow the registration process. You'll need to provide your kitchen details, FSSAI license (if applicable), and complete verification."},{question:"What areas do you serve?",answer:"We currently serve in select cities. Enter your location on the home page to check if we deliver to your area. We're expanding rapidly!"},{question:"How do I apply a coupon?",answer:"At checkout, enter your coupon code in the 'Apply Discount Coupon' section and tap 'Apply'. Valid coupons will be applied to your order total."}],contactOptions=[{icon:MessageCircle,title:"Live Chat",subtitle:"Chat with our support team",action:"Start Chat",color:"text-primary",bgColor:"bg-primary/10"},{icon:Phone,title:"Call Us",subtitle:"+91 1800-XXX-XXXX",action:"Call Now",color:"text-green-600",bgColor:"bg-green-100"},{icon:Mail,title:"Email Support",subtitle:"support@ammacheythivanta.com",action:"Send Email",color:"text-gold",bgColor:"bg-gold/10"}];function HelpSupportPage(){return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card border-b border-border px-4 py-4 flex items-center gap-4 sticky top-0 z-10",children:[jsxRuntimeExports.jsx(Link,{to:"/profile",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"p-2 -ml-2",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-6 h-6 text-foreground"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-bold text-foreground",children:"Help & Support"})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-border",children:[jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Contact Us"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"We're here to help 24/7"})]}),jsxRuntimeExports.jsx("div",{className:"divide-y divide-border",children:contactOptions.map((e,i)=>jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:i*.1},className:"flex items-center gap-4 p-4",children:[jsxRuntimeExports.jsx("div",{className:`w-12 h-12 rounded-xl ${e.bgColor} flex items-center justify-center ${e.color}`,children:jsxRuntimeExports.jsx(e.icon,{className:"w-6 h-6"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:e.title}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:e.subtitle})]}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",className:"rounded-xl",children:e.action})]},e.title))})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-border",children:[jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Frequently Asked Questions"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Quick answers to common questions"})]}),jsxRuntimeExports.jsx(Accordion,{type:"single",collapsible:!0,className:"px-4",children:faqs.map((e,i)=>jsxRuntimeExports.jsxs(AccordionItem,{value:`item-${i}`,children:[jsxRuntimeExports.jsx(AccordionTrigger,{className:"text-left text-foreground hover:text-primary",children:e.question}),jsxRuntimeExports.jsx(AccordionContent,{className:"text-muted-foreground",children:e.answer})]},i))})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Quick Links"})}),jsxRuntimeExports.jsxs("div",{className:"divide-y divide-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 p-4",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:jsxRuntimeExports.jsx(FileText,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 font-medium text-foreground",children:"Terms & Conditions"}),jsxRuntimeExports.jsx(ExternalLink,{className:"w-5 h-5 text-muted-foreground"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 p-4",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:jsxRuntimeExports.jsx(FileText,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 font-medium text-foreground",children:"Privacy Policy"}),jsxRuntimeExports.jsx(ExternalLink,{className:"w-5 h-5 text-muted-foreground"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 p-4",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:jsxRuntimeExports.jsx(FileText,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 font-medium text-foreground",children:"Refund Policy"}),jsxRuntimeExports.jsx(ExternalLink,{className:"w-5 h-5 text-muted-foreground"})]})]})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-gradient-to-br from-primary/10 to-gold/10 rounded-2xl p-6 text-center",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-2",children:"Love our app?"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Rate us on the Play Store and help us improve!"}),jsxRuntimeExports.jsx(Button,{className:"rounded-xl px-6",children:"Rate Now "})]})]}),jsxRuntimeExports.jsx(BottomNav,{})]})}function SavedAddressesPage(){const{user:e,loading:i,updateUserLocation:s,deleteAddress:a}=useAuth(),_=useNavigate(),et=reactExports.useRef(null),nt=(dt,gt)=>{et.current=setTimeout(()=>{window.confirm("Delete this saved address?")&&a(dt,gt)},800)},c=()=>{et.current&&(clearTimeout(et.current),et.current=null)},ct=async dt=>{try{await s(dt.lat,dt.lng,dt.line1||dt.city,dt.label)}catch(gt){console.error("Failed to set default address:",gt)}};return i?jsxRuntimeExports.jsx(LoadingAnimation,{}):e?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background safe-top pb-24",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},onClick:()=>_(-1),className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center cursor-pointer",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Saved Addresses"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage your delivery locations"})]})]})}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[e.savedAddresses&&e.savedAddresses.length>0?e.savedAddresses.map((dt,gt)=>{var Tt,Et,At,Mt;return jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:gt*.1},className:"bg-card rounded-xl p-4 shadow-sm border border-border select-none",onTouchStart:()=>nt(dt.lat,dt.lng),onTouchEnd:c,onMouseDown:()=>nt(dt.lat,dt.lng),onMouseUp:c,onMouseLeave:c,onContextMenu:Pt=>Pt.preventDefault(),children:jsxRuntimeExports.jsxs("div",{className:"flex gap-4",onClick:()=>ct(dt),children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center shrink-0 cursor-pointer",children:dt.label==="work"?jsxRuntimeExports.jsx(Briefcase,{className:"w-5 h-5 text-primary"}):dt.label==="other"?jsxRuntimeExports.jsx(MapPin,{className:"w-5 h-5 text-primary"}):jsxRuntimeExports.jsx(House,{className:"w-5 h-5 text-primary"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 cursor-pointer",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground capitalize",children:dt.label||(dt.line1?"Home":"Saved Location")}),((Tt=e.address)==null?void 0:Tt.lat)===dt.lat&&((Et=e.address)==null?void 0:Et.lng)===dt.lng&&jsxRuntimeExports.jsx("div",{className:"px-2 py-0.5 rounded text-[10px] font-bold bg-primary/10 text-primary uppercase tracking-wide",children:"Selected"})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[dt.line1?jsxRuntimeExports.jsx("span",{className:"block",children:dt.line1}):jsxRuntimeExports.jsxs("span",{className:"block",children:[dt.pincode?`${dt.pincode}, `:"",dt.city]}),dt.line2&&jsxRuntimeExports.jsx("span",{className:"block",children:dt.line2})]}),((At=e.address)==null?void 0:At.lat)===dt.lat&&((Mt=e.address)==null?void 0:Mt.lng)===dt.lng&&jsxRuntimeExports.jsxs("div",{className:"mt-4 pt-4 border-t border-border",onClick:Pt=>Pt.stopPropagation(),children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Tag this location"}),jsxRuntimeExports.jsx("div",{className:"flex gap-2",children:["home","work","other"].map(Pt=>jsxRuntimeExports.jsxs("button",{onClick:()=>s(dt.lat,dt.lng,dt.line1||dt.city,Pt),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full border text-xs transition-all ${dt.label===Pt?"bg-primary text-primary-foreground border-primary":"bg-background border-border text-muted-foreground hover:border-primary/50"}`,children:[Pt==="home"&&jsxRuntimeExports.jsx(House,{className:"w-3 h-3"}),Pt==="work"&&jsxRuntimeExports.jsx(Briefcase,{className:"w-3 h-3"}),Pt==="other"&&jsxRuntimeExports.jsx(MapPin,{className:"w-3 h-3"}),jsxRuntimeExports.jsx("span",{className:"capitalize",children:Pt})]},Pt))})]})]})]})},gt)}):e.address?jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card rounded-xl p-4 shadow-sm border border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:jsxRuntimeExports.jsx(House,{className:"w-5 h-5 text-primary"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:"Home"}),jsxRuntimeExports.jsx("div",{className:"px-2 py-0.5 rounded text-[10px] font-bold bg-primary/10 text-primary uppercase tracking-wide",children:"Default"})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[e.address.line1?jsxRuntimeExports.jsx("span",{className:"block",children:e.address.line1}):jsxRuntimeExports.jsxs("span",{className:"block",children:[e.address.pincode?`${e.address.pincode}, `:"",e.address.city]}),e.address.line2&&jsxRuntimeExports.jsx("span",{className:"block",children:e.address.line2})]})]})]})}):jsxRuntimeExports.jsxs("div",{className:"text-center py-12 bg-card rounded-xl border border-dashed border-border",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-10 h-10 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"No saved addresses found"}),jsxRuntimeExports.jsx(Button,{onClick:()=>_("/location-select"),children:"Add Address"})]}),jsxRuntimeExports.jsxs(Button,{variant:"ghost",className:"w-full flex items-center justify-center gap-2 py-6 border border-dashed border-border rounded-xl text-muted-foreground hover:text-primary hover:border-primary/50 hover:bg-primary/5 transition-all",onClick:()=>_("/location-select"),children:[jsxRuntimeExports.jsx(Plus,{className:"w-5 h-5"}),jsxRuntimeExports.jsx("span",{children:"Add New Address"})]})]})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background px-4",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-16 h-16 text-muted-foreground mb-4"}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold mb-2",children:"Login Required"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground text-center mb-6",children:"Please login to manage your saved addresses"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Login Now"})})]})}function FavoritesPage(){const{user:e,loading:i}=useAuth(),{kitchens:s,loading:a}=useKitchens();if(useLocationContext(),i||a)return jsxRuntimeExports.jsx(LoadingAnimation,{});if(!e)return jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background px-4",children:[jsxRuntimeExports.jsx(Heart,{className:"w-16 h-16 text-muted-foreground mb-4"}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold mb-2",children:"Login Required"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground text-center mb-6",children:"Please login to view your favorite kitchens"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Login Now"})})]});const _=s.filter(et=>{var nt;return(nt=e.favorites)==null?void 0:nt.includes(et.id)});return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background safe-top pb-24",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-40 bg-background/80 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",className:"h-10 w-10 -ml-2 rounded-full hover:bg-muted",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-6 h-6"})})}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold text-foreground",children:"My Favorites"})]})}),jsxRuntimeExports.jsx("div",{className:"p-4",children:_.length>0?jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:_.map((et,nt)=>jsxRuntimeExports.jsx(KitchenCard,{kitchen:et,index:nt},et.id))}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-muted flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(Heart,{className:"w-8 h-8 text-muted-foreground"})}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-foreground mb-2",children:"No favorites yet"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-6 max-w-xs",children:"Start exploring kitchens and save your favorites here for quick access!"}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground shadow-elevated",children:"Explore Kitchens"})})]})})]})}function SearchPage(){const[e,i]=reactExports.useState(""),[s,a]=reactExports.useState(null),{kitchens:_,loading:et}=useKitchens(),nt=[{id:"veg",label:"Veg",icon:Leaf},{id:"biryani",label:"Biryani",emoji:""},{id:"tiffin",label:"Tiffins",emoji:""},{id:"meals",label:"Meals",emoji:""},{id:"sweets",label:"Sweets",emoji:""}],c=_.filter(ct=>{const dt=!e||ct.name.toLowerCase().includes(e.toLowerCase())||ct.specialties.some(Tt=>Tt.toLowerCase().includes(e.toLowerCase())),gt=!s||s==="veg"&&ct.isVeg||ct.specialties.some(Tt=>Tt.toLowerCase().includes(s.toLowerCase()));return dt&&gt});return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),jsxRuntimeExports.jsx("input",{type:"text",value:e,onChange:ct=>i(ct.target.value),placeholder:"Search dishes, kitchens...",className:"w-full pl-12 pr-4 py-3 rounded-xl bg-secondary border-0 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20",autoFocus:!0})]}),jsxRuntimeExports.jsx("div",{className:"flex gap-2 mt-4 overflow-x-auto hide-scrollbar",children:nt.map(ct=>jsxRuntimeExports.jsxs(motion.button,{whileTap:{scale:.95},onClick:()=>a(s===ct.id?null:ct.id),className:`flex items-center gap-1.5 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${s===ct.id?"gradient-primary text-primary-foreground":"bg-secondary text-secondary-foreground"}`,children:[ct.icon?jsxRuntimeExports.jsx(ct.icon,{className:"w-4 h-4"}):jsxRuntimeExports.jsx("span",{children:ct.emoji}),ct.label]},ct.id))})]}),!e&&jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide mb-3",children:"Popular Searches"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:["Biryani","Idli Dosa","Thali","Chicken Curry","Pickles"].map(ct=>jsxRuntimeExports.jsx(motion.button,{whileTap:{scale:.95},onClick:()=>i(ct),className:"px-4 py-2 rounded-full bg-secondary text-secondary-foreground text-sm",children:ct},ct))})]}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4",children:et?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-12",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):c.length===0?jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No kitchens found"})}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:[c.length," kitchens found"]}),jsxRuntimeExports.jsx("div",{className:"space-y-4",children:c.map((ct,dt)=>jsxRuntimeExports.jsx(KitchenCard,{kitchen:ct,index:dt},ct.id))})]})}),jsxRuntimeExports.jsx(BottomNav,{})]})}function OrderReviewForm({order:e,onClose:i,onSuccess:s}){const[a,_]=reactExports.useState(0),[et,nt]=reactExports.useState({}),[c,ct]=reactExports.useState(""),[dt,gt]=reactExports.useState(!1),Tt=async()=>{if(a===0){ue.error("Please rate the kitchen");return}gt(!0);try{await submitReview({orderId:e.id,kitchenId:e.kitchenId,userId:e.userId,userName:"User",kitchenRating:a,itemRatings:et,comment:c,createdAt:Date.now()}),ue.success("Review submitted successfully!"),s()}catch(At){console.error(At),ue.error("Failed to submit review")}gt(!1)},Et=(At,Mt)=>{nt(Pt=>({...Pt,[At]:Mt}))};return jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"border-t border-border mt-4 pt-4",children:jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:"Rate Your Experience"}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",onClick:i,className:"h-8 text-xs",children:"Cancel"})]}),jsxRuntimeExports.jsxs("div",{className:"text-center bg-secondary/20 rounded-xl p-4",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-sm mb-1",children:e.kitchenName}),jsxRuntimeExports.jsx("div",{className:"flex justify-center gap-2 mt-2",children:[1,2,3,4,5].map(At=>jsxRuntimeExports.jsx("button",{onClick:()=>_(At),className:"transition-transform hover:scale-110 focus:outline-none",children:jsxRuntimeExports.jsx(Star,{className:cn("w-8 h-8",At<=a?"fill-gold text-gold":"text-muted-foreground/30")})},At))})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx("h4",{className:"font-medium text-xs text-muted-foreground uppercase tracking-wider",children:"Rate Items"}),e.items.map((At,Mt)=>jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center bg-secondary/20 rounded-lg p-3",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-sm",children:At.dish.name}),jsxRuntimeExports.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(Pt=>jsxRuntimeExports.jsx("button",{onClick:()=>Et(At.dish.id,Pt),className:"focus:outline-none",children:jsxRuntimeExports.jsx(Star,{className:cn("w-4 h-4",Pt<=(et[At.dish.id]||0)?"fill-gold text-gold":"text-muted-foreground/30")})},Pt))})]},Mt))]}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(Input,{placeholder:"Tell us more about your experience...",value:c,onChange:At=>ct(At.target.value),className:"bg-secondary/20 border-0"})}),jsxRuntimeExports.jsx(Button,{className:"w-full gradient-primary text-primary-foreground",onClick:Tt,disabled:dt,children:dt?"Submitting...":"Submit Review"})]})})}const statusConfig$1={pending:{label:"Order Placed",color:"text-muted-foreground",icon:Clock},accepted:{label:"Accepted",color:"text-gold",icon:Check},cooking:{label:"Cooking",color:"text-primary",icon:ChefHat},packed:{label:"Ready",color:"text-accent",icon:Package},out_for_delivery:{label:"On the way",color:"text-accent",icon:Truck},delivered:{label:"Delivered",color:"text-accent",icon:Check},cancelled:{label:"Cancelled",color:"text-destructive",icon:Clock}};function OrdersPage(){const{user:e}=useAuth(),{orders:i,loading:s,error:a}=useUserOrders(e==null?void 0:e.id),[_,et]=reactExports.useState("active"),[nt,c]=reactExports.useState(null),ct=i.filter(gt=>!["delivered","cancelled"].includes(gt.status)),dt=i.filter(gt=>["delivered","cancelled"].includes(gt.status));return e?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border px-4 py-4",children:[jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold text-foreground",children:"My Orders"}),jsxRuntimeExports.jsx("div",{className:"flex bg-secondary rounded-xl p-1 mt-4",children:["active","past"].map(gt=>jsxRuntimeExports.jsx("button",{onClick:()=>et(gt),className:`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${_===gt?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:gt==="active"?"Active":"Past Orders"},gt))})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-4 space-y-4",children:[s?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-12",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):a?jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsx("p",{className:"text-destructive",children:a})}):(_==="active"?ct:dt).map((gt,Tt)=>{const Et=statusConfig$1[gt.status],At=Et.icon,Mt=gt.isReviewed;return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:Tt*.1},className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:gt.kitchenName}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",gt.id.slice(-8)]})]}),jsxRuntimeExports.jsxs("div",{className:cn("flex items-center gap-1 px-2 py-1 rounded-full bg-secondary",Et.color),children:[jsxRuntimeExports.jsx(At,{className:"w-3 h-3"}),jsxRuntimeExports.jsx("span",{className:"text-xs font-medium",children:Et.label})]})]}),jsxRuntimeExports.jsx("div",{className:"text-sm text-muted-foreground mb-3",children:gt.items.map((Pt,$t)=>jsxRuntimeExports.jsxs("span",{children:[Pt.dish.name," x",Pt.quantity,$t<gt.items.length-1&&", "]},$t))}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-border",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("span",{className:"font-semibold text-foreground",children:["",gt.totalAmount]}),gt.estimatedDelivery&&jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground",children:["ETA: ",gt.estimatedDelivery]})]}),gt.status==="delivered"&&jsxRuntimeExports.jsx(Button,{size:"sm",variant:Mt?"ghost":"outline",className:Mt?"text-muted-foreground cursor-default":"border-gold text-gold hover:bg-gold/10",onClick:()=>{Mt||c(nt===gt.id?null:gt.id)},disabled:Mt&&nt!==gt.id,children:Mt?"Reviewed":"Review Order"})]}),!Mt&&nt===gt.id&&jsxRuntimeExports.jsx(OrderReviewForm,{order:gt,onClose:()=>c(null),onSuccess:()=>c(null)}),!["delivered","cancelled"].includes(gt.status)&&jsxRuntimeExports.jsx("div",{className:"mt-4 pt-4 border-t border-border",children:jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between",children:["accepted","cooking","packed","out_for_delivery"].map((Pt,$t)=>{const Lt=statusConfig$1[Pt],Bt=Lt.icon,Nt=["pending","accepted","cooking","packed","out_for_delivery"],Vt=Nt.indexOf(gt.status),Xt=Nt.indexOf(Pt),nr=Vt>=Xt;return jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center gap-1",children:[jsxRuntimeExports.jsx("div",{className:cn("w-8 h-8 rounded-full flex items-center justify-center transition-all",nr?"bg-primary text-primary-foreground":"bg-secondary text-muted-foreground"),children:jsxRuntimeExports.jsx(Bt,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("span",{className:cn("text-[10px]",nr?"text-foreground":"text-muted-foreground"),children:Lt.label})]},Pt)})})})]},gt.id)}),!s&&(_==="active"?ct:dt).length===0&&jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Package,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:_==="active"?"No active orders":"No past orders"})]})]}),jsxRuntimeExports.jsx(BottomNav,{})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4 pb-24",children:[jsxRuntimeExports.jsx(Package,{className:"w-16 h-16 text-muted-foreground mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"Please login to view orders"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Login"})}),jsxRuntimeExports.jsx(BottomNav,{})]})}function SlideAction({onSuccess:e,text:i="SLIDE TO CONFIRM",icon:s=Check,className:a,sliderColor:_="bg-primary",textColor:et="text-primary",resetOnSuccess:nt=!0}){const[c,ct]=reactExports.useState(0),dt=reactExports.useRef(null),gt=useAnimation(),[Tt,Et]=reactExports.useState(0),[At,Mt]=reactExports.useState(!1);reactExports.useEffect(()=>{dt.current&&ct(dt.current.clientWidth)},[dt.current]);const Pt=(Lt,Bt)=>{const Nt=Math.max(0,Bt.offset.x);Et(Nt)},$t=async(Lt,Bt)=>{const Nt=c-48;Bt.offset.x>=Nt*.9?(await gt.start({x:Nt}),Mt(!0),e(),nt&&setTimeout(()=>{Mt(!1),gt.start({x:0}),Et(0)},1e3)):(gt.start({x:0}),Et(0))};return jsxRuntimeExports.jsxs("div",{ref:dt,className:cn("relative h-12 rounded-full overflow-hidden shadow-sm border select-none w-full",a),children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-0",children:jsxRuntimeExports.jsxs("div",{className:cn("flex items-center gap-1 animate-pulse-soft opacity-100 font-semibold text-xs tracking-widest",et),children:[jsxRuntimeExports.jsx("span",{children:At?"CONFIRMED":i}),!At&&jsxRuntimeExports.jsx(ChevronRight,{className:"w-4 h-4 ml-1"})]})}),jsxRuntimeExports.jsx(motion.div,{className:cn("absolute inset-y-0 left-0 opacity-20 z-0",_),style:{width:Tt+48}}),jsxRuntimeExports.jsx(motion.div,{drag:"x",dragConstraints:{left:0,right:c-48},dragElastic:.1,dragMomentum:!1,onDrag:Pt,onDragEnd:$t,animate:gt,className:cn("absolute left-1 top-1 bottom-1 w-[40px] rounded-full flex items-center justify-center cursor-grab active:cursor-grabbing z-20 shadow-sm transition-colors",_),whileTap:{scale:1.05},children:At?jsxRuntimeExports.jsx(Check,{className:"w-5 h-5 text-white"}):jsxRuntimeExports.jsx(s,{className:"w-5 h-5 text-white"})})]})}const statusConfig={pending:{label:"New Order",color:"bg-gold text-foreground",nextStatus:"accepted"},accepted:{label:"Accepted",color:"bg-primary text-primary-foreground",nextStatus:"cooking"},cooking:{label:"Cooking",color:"bg-accent text-accent-foreground",nextStatus:"packed"},packed:{label:"Ready",color:"bg-veg text-primary-foreground"},out_for_delivery:{label:"Out for Delivery",color:"bg-accent text-accent-foreground",nextStatus:"delivered"},delivered:{label:"Delivered",color:"bg-muted text-muted-foreground"},cancelled:{label:"Cancelled",color:"bg-destructive text-destructive-foreground"}};function AmmaDashboard(){const{user:e,signOut:i}=useAuth(),s=useNavigate(),{kitchens:a,loading:_}=useAmmaKitchens(e==null?void 0:e.id),[et,nt]=reactExports.useState(null),{orders:c,loading:ct}=useKitchenOrders(et||void 0),{dishes:dt}=useDishes(et||void 0),{coupons:gt}=useKitchenCoupons(et||void 0),[Tt,Et]=reactExports.useState("orders"),[At,Mt]=reactExports.useState(!1),[Pt,$t]=reactExports.useState({code:"",discountType:"percentage",discountValue:10,minOrderAmount:0,maxDiscount:0}),[Lt,Bt]=reactExports.useState(!1);reactExports.useEffect(()=>{a.length>0&&!et&&nt(a[0].id)},[a,et]);const Nt=a.find(Lr=>Lr.id===et),Vt=c.filter(Lr=>!["delivered","cancelled"].includes(Lr.status)),Xt=c.filter(Lr=>{const Qr=new Date;return new Date(Lr.createdAt).toDateString()===Qr.toDateString()}),nr=Xt.reduce((Lr,Qr)=>Lr+Qr.totalAmount,0),ar=async(Lr,Qr)=>{try{await updateOrderStatus(Lr,Qr),ue.success(`Order ${Qr==="cancelled"?"cancelled":"updated"}!`)}catch{ue.error("Failed to update order")}},mr=async()=>{if(!(!et||!Nt))try{await updateKitchen(et,{isOpen:!Nt.isOpen}),ue.success(Nt.isOpen?"Kitchen closed":"Kitchen opened")}catch{ue.error("Failed to update kitchen status")}},Fr=async()=>{if(!et||!Pt.code.trim()){ue.error("Please enter a coupon code");return}Bt(!0);try{await createCoupon({code:Pt.code.toUpperCase(),kitchenId:et,discountType:Pt.discountType,discountValue:Pt.discountValue,minOrderAmount:Pt.minOrderAmount||void 0,maxDiscount:Pt.maxDiscount||void 0,usedCount:0,isActive:!0,createdAt:Date.now()}),ue.success("Coupon created!"),Mt(!1),$t({code:"",discountType:"percentage",discountValue:10,minOrderAmount:0,maxDiscount:0})}catch{ue.error("Failed to create coupon")}Bt(!1)},sn=async Lr=>{try{await deleteCoupon(Lr),ue.success("Coupon deleted")}catch{ue.error("Failed to delete coupon")}},fn=async Lr=>{try{await updateCoupon(Lr.id,{isActive:!Lr.isActive}),ue.success(Lr.isActive?"Coupon deactivated":"Coupon activated")}catch{ue.error("Failed to update coupon")}};return!e||e.role!=="amma"?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[jsxRuntimeExports.jsx(ChefHat,{className:"w-16 h-16 text-muted-foreground mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"You need to be registered as an Amma to access this"}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Go Home"})})]}):_?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):a.length===0?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"My Kitchen"}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:async()=>{await i(),s("/auth")},className:"text-destructive",children:jsxRuntimeExports.jsx(LogOut,{className:"w-5 h-5"})})]})}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center px-4 py-16",children:[jsxRuntimeExports.jsx(ChefHat,{className:"w-20 h-20 text-muted-foreground mb-4"}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"No Kitchen Yet"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground text-center mb-6",children:"Start your home kitchen journey and share your delicious food with the community!"}),jsxRuntimeExports.jsx(Link,{to:"/amma/register",children:jsxRuntimeExports.jsxs(Button,{className:"gradient-primary text-primary-foreground",children:[jsxRuntimeExports.jsx(Plus,{className:"w-5 h-5 mr-2"})," Register Your Kitchen"]})})]})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:Nt==null?void 0:Nt.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Kitchen Dashboard"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Button,{onClick:mr,variant:"outline",size:"sm",className:cn("rounded-full",Nt!=null&&Nt.isOpen?"border-veg text-veg":"border-destructive text-destructive"),children:Nt!=null&&Nt.isOpen?" Open":" Closed"}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:()=>s(`/amma/edit-kitchen/${et}`),title:"Edit Kitchen",children:jsxRuntimeExports.jsx(Settings,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:async()=>{await i(),s("/auth")},className:"text-destructive",children:jsxRuntimeExports.jsx(LogOut,{className:"w-5 h-5"})})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-2 px-4 pb-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-secondary rounded-xl p-3 text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-lg font-bold text-foreground",children:Vt.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Active"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-secondary rounded-xl p-3 text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-lg font-bold text-foreground",children:Xt.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Today"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-secondary rounded-xl p-3 text-center",children:[jsxRuntimeExports.jsxs("p",{className:"text-lg font-bold text-primary",children:["",nr]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Earnings"})]})]}),jsxRuntimeExports.jsx("div",{className:"flex bg-secondary mx-4 rounded-xl p-1 mb-4",children:["orders","menu","coupons","stats"].map(Lr=>jsxRuntimeExports.jsx("button",{onClick:()=>Et(Lr),className:`flex-1 py-2 rounded-lg text-xs font-medium transition-all capitalize ${Tt===Lr?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:Lr},Lr))})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[Tt==="orders"&&jsxRuntimeExports.jsx("div",{className:"space-y-4",children:ct?jsxRuntimeExports.jsx("div",{className:"flex justify-center py-8",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):Vt.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Package,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No active orders"})]}):jsxRuntimeExports.jsx(AnimatePresence,{children:Vt.map((Lr,Qr)=>jsxRuntimeExports.jsx(OrderCard,{order:Lr,index:Qr,onStatusUpdate:ar},Lr.id))})}),Tt==="menu"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-foreground",children:["Your Dishes (",dt.length,")"]}),jsxRuntimeExports.jsx(Link,{to:"/amma/add-dish",children:jsxRuntimeExports.jsxs(Button,{size:"sm",className:"gradient-primary text-primary-foreground",children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4 mr-1"})," Add"]})})]}),dt.length===0?jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No dishes yet. Add your first dish!"})}):dt.map(Lr=>jsxRuntimeExports.jsxs(motion.div,{className:"bg-card rounded-xl p-4 shadow-card flex gap-4",children:[jsxRuntimeExports.jsx("img",{src:Lr.image,alt:Lr.name,className:"w-20 h-20 rounded-lg object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:Lr.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:Lr.category}),jsxRuntimeExports.jsxs("p",{className:"text-primary font-semibold",children:["",Lr.price]})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-2",children:[jsxRuntimeExports.jsx(Button,{size:"icon",variant:"ghost",children:jsxRuntimeExports.jsx(SquarePen,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(Button,{size:"icon",variant:"ghost",className:"text-destructive",onClick:()=>{deleteDish(Lr.id),ue.success("Dish deleted")},children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]})]},Lr.id))]}),Tt==="coupons"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-foreground",children:["Your Coupons (",gt.length,")"]}),jsxRuntimeExports.jsxs(Button,{size:"sm",className:"gradient-primary text-primary-foreground",onClick:()=>Mt(!At),children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4 mr-1"})," Create"]})]}),At&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"bg-card rounded-xl p-4 shadow-card space-y-3",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:"Create New Coupon"}),jsxRuntimeExports.jsx(Input,{placeholder:"Coupon Code (e.g., SAVE20)",value:Pt.code,onChange:Lr=>$t({...Pt,code:Lr.target.value.toUpperCase()}),className:"bg-secondary border-0 uppercase"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("select",{value:Pt.discountType,onChange:Lr=>$t({...Pt,discountType:Lr.target.value}),className:"bg-secondary rounded-md px-3 py-2 text-sm text-foreground",children:[jsxRuntimeExports.jsx("option",{value:"percentage",children:"% Off"}),jsxRuntimeExports.jsx("option",{value:"fixed",children:" Fixed Off"}),jsxRuntimeExports.jsx("option",{value:"final_price",children:"Final Price"})]}),jsxRuntimeExports.jsx(Input,{type:"number",placeholder:Pt.discountType==="percentage"?"% value":" amount",value:Pt.discountValue,onChange:Lr=>$t({...Pt,discountValue:Number(Lr.target.value)}),className:"bg-secondary border-0"})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(Input,{type:"number",placeholder:"Min Order  (optional)",value:Pt.minOrderAmount||"",onChange:Lr=>$t({...Pt,minOrderAmount:Number(Lr.target.value)}),className:"bg-secondary border-0"}),Pt.discountType==="percentage"&&jsxRuntimeExports.jsx(Input,{type:"number",placeholder:"Max Discount  (optional)",value:Pt.maxDiscount||"",onChange:Lr=>$t({...Pt,maxDiscount:Number(Lr.target.value)}),className:"bg-secondary border-0"})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Button,{onClick:Fr,disabled:Lt,className:"flex-1 gradient-primary text-primary-foreground",children:Lt?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}):"Create Coupon"}),jsxRuntimeExports.jsx(Button,{variant:"outline",onClick:()=>Mt(!1),children:"Cancel"})]})]}),gt.length===0&&!At?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Tag,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No coupons yet. Create your first coupon!"})]}):gt.map(Lr=>jsxRuntimeExports.jsx(motion.div,{className:"bg-card rounded-xl p-4 shadow-card",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:cn("w-12 h-12 rounded-lg flex items-center justify-center",Lr.isActive?"bg-veg/10":"bg-muted"),children:jsxRuntimeExports.jsx(Percent,{className:cn("w-6 h-6",Lr.isActive?"text-veg":"text-muted-foreground")})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-bold text-foreground",children:Lr.code}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:[Lr.discountType==="percentage"&&`${Lr.discountValue}% off`,Lr.discountType==="fixed"&&`${Lr.discountValue} off`,Lr.discountType==="final_price"&&`Final price: ${Lr.discountValue}`,Lr.minOrderAmount?`  Min ${Lr.minOrderAmount}`:""]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:["Used: ",Lr.usedCount," times"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Button,{size:"icon",variant:"ghost",onClick:()=>fn(Lr),className:Lr.isActive?"text-veg":"text-muted-foreground",children:Lr.isActive?jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"}):jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(Button,{size:"icon",variant:"ghost",className:"text-destructive",onClick:()=>sn(Lr.id),children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]})]})},Lr.id))]}),Tt==="stats"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Today's Summary"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-secondary rounded-xl p-4",children:[jsxRuntimeExports.jsx(DollarSign,{className:"w-6 h-6 text-primary mb-2"}),jsxRuntimeExports.jsxs("p",{className:"text-2xl font-bold text-foreground",children:["",nr]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Earnings"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-secondary rounded-xl p-4",children:[jsxRuntimeExports.jsx(ShoppingBag,{className:"w-6 h-6 text-accent mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:Xt.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Orders Completed"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Kitchen Info"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Rating"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground font-medium",children:[" ",Nt==null?void 0:Nt.rating]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Total Reviews"}),jsxRuntimeExports.jsx("span",{className:"text-foreground font-medium",children:Nt==null?void 0:Nt.totalRatings})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Menu Items"}),jsxRuntimeExports.jsx("span",{className:"text-foreground font-medium",children:dt.length})]})]})]})]})]})]})}function OrderCard({order:e,index:i,onStatusUpdate:s}){const a=statusConfig[e.status];return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-100},transition:{delay:i*.05},className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",e.id.slice(-8)]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(e.createdAt).toLocaleTimeString()})]}),jsxRuntimeExports.jsx("span",{className:cn("px-3 py-1 rounded-full text-xs font-medium",a.color),children:a.label})]}),jsxRuntimeExports.jsx("div",{className:"space-y-1 mb-3",children:e.items.map((_,et)=>jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:[_.dish.name," x",_.quantity]}),jsxRuntimeExports.jsxs("span",{className:"text-muted-foreground",children:["",_.dish.price*_.quantity]})]},et))}),e.notes&&jsxRuntimeExports.jsx("div",{className:"bg-secondary rounded-lg p-2 mb-3",children:jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:["Note: ",e.notes]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-3",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-3 h-3"}),jsxRuntimeExports.jsxs("span",{children:[e.deliveryAddress.line1,", ",e.deliveryAddress.city]})]}),jsxRuntimeExports.jsxs("div",{className:"pt-3 border-t border-border space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Amount"}),jsxRuntimeExports.jsxs("span",{className:"font-bold text-foreground",children:["",e.totalAmount]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2 w-full",children:[e.status!=="cancelled"&&a.nextStatus&&jsxRuntimeExports.jsx("div",{className:"flex-1 min-w-0",children:jsxRuntimeExports.jsx(SlideAction,{onSuccess:()=>s(e.id,a.nextStatus),text:`SLIDE TO ${a.nextStatus==="accepted"?"ACCEPT":a.nextStatus.toUpperCase().replace("_"," ")}`,icon:a.nextStatus==="accepted"?Check:ChevronRight,className:"h-12 bg-secondary/50 border-primary/20 w-full",sliderColor:"bg-primary",textColor:"text-primary"})}),e.status==="pending"&&jsxRuntimeExports.jsx(Button,{size:"icon",variant:"outline",className:"h-12 w-12 shrink-0 text-destructive border-destructive/30 hover:bg-destructive/10 rounded-full",onClick:()=>s(e.id,"cancelled"),children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]})]})]})}const IMGBB_API_KEY="271837f4240842ef12577a95dbae3e88",IMGBB_ENDPOINT="https://api.imgbb.com/1/upload";async function uploadImage(e){const i=new FormData;i.append("key",IMGBB_API_KEY),i.append("image",e);const s=await fetch(IMGBB_ENDPOINT,{method:"POST",body:i});if(!s.ok)throw new Error("Failed to upload image");return s.json()}async function uploadToImgBB(e){try{return(await uploadImage(e)).data}catch(i){return console.error("ImgBB upload error:",i),null}}var mapboxGl={exports:{}};(function(e,i){(function(s,a){e.exports=a()})(commonjsGlobal,function(){var s,a,_;function et(c,ct){if(!s)s=ct;else if(!a)a=ct;else{var dt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+a+")(sharedChunk); self.onerror = null;",gt={};s(gt),_=ct(gt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(_.workerUrl=window.URL.createObjectURL(new Blob([dt],{type:"text/javascript"})))}}et(["exports"],function(c){var ct=1e-6,dt=typeof Float32Array<"u"?Float32Array:Array;function gt(b,o){var g=o[0],_e=o[1],rt=o[2],ot=o[3],at=g*ot-rt*_e;return at?(b[0]=ot*(at=1/at),b[1]=-_e*at,b[2]=-rt*at,b[3]=g*at,b):null}function Tt(){var b=new dt(9);return dt!=Float32Array&&(b[1]=0,b[2]=0,b[3]=0,b[5]=0,b[6]=0,b[7]=0),b[0]=1,b[4]=1,b[8]=1,b}function Et(b,o){var g=o[0],_e=o[1],rt=o[2],ot=o[3],at=o[4],ut=o[5],ft=o[6],xt=o[7],Ct=o[8];return b[0]=at*Ct-ut*xt,b[1]=rt*xt-_e*Ct,b[2]=_e*ut-rt*at,b[3]=ut*ft-ot*Ct,b[4]=g*Ct-rt*ft,b[5]=rt*ot-g*ut,b[6]=ot*xt-at*ft,b[7]=_e*ft-g*xt,b[8]=g*at-_e*ot,b}function At(b,o,g){var _e=o[0],rt=o[1],ot=o[2],at=o[3],ut=o[4],ft=o[5],xt=o[6],Ct=o[7],Rt=o[8],kt=g[0],zt=g[1],Ut=g[2],Kt=g[3],er=g[4],Jt=g[5],or=g[6],cr=g[7],pr=g[8];return b[0]=kt*_e+zt*at+Ut*xt,b[1]=kt*rt+zt*ut+Ut*Ct,b[2]=kt*ot+zt*ft+Ut*Rt,b[3]=Kt*_e+er*at+Jt*xt,b[4]=Kt*rt+er*ut+Jt*Ct,b[5]=Kt*ot+er*ft+Jt*Rt,b[6]=or*_e+cr*at+pr*xt,b[7]=or*rt+cr*ut+pr*Ct,b[8]=or*ot+cr*ft+pr*Rt,b}function Mt(){var b=new dt(16);return dt!=Float32Array&&(b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0),b[0]=1,b[5]=1,b[10]=1,b[15]=1,b}function Pt(b){var o=new dt(16);return o[0]=b[0],o[1]=b[1],o[2]=b[2],o[3]=b[3],o[4]=b[4],o[5]=b[5],o[6]=b[6],o[7]=b[7],o[8]=b[8],o[9]=b[9],o[10]=b[10],o[11]=b[11],o[12]=b[12],o[13]=b[13],o[14]=b[14],o[15]=b[15],o}function $t(b){return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b}function Lt(b,o){var g=o[0],_e=o[1],rt=o[2],ot=o[3],at=o[4],ut=o[5],ft=o[6],xt=o[7],Ct=o[8],Rt=o[9],kt=o[10],zt=o[11],Ut=o[12],Kt=o[13],er=o[14],Jt=o[15],or=g*ut-_e*at,cr=g*ft-rt*at,pr=g*xt-ot*at,Sr=_e*ft-rt*ut,br=_e*xt-ot*ut,Pr=rt*xt-ot*ft,Dr=Ct*Kt-Rt*Ut,Or=Ct*er-kt*Ut,nn=Ct*Jt-zt*Ut,$r=Rt*er-kt*Kt,un=Rt*Jt-zt*Kt,gn=kt*Jt-zt*er,yn=or*gn-cr*un+pr*$r+Sr*nn-br*Or+Pr*Dr;return yn?(b[0]=(ut*gn-ft*un+xt*$r)*(yn=1/yn),b[1]=(rt*un-_e*gn-ot*$r)*yn,b[2]=(Kt*Pr-er*br+Jt*Sr)*yn,b[3]=(kt*br-Rt*Pr-zt*Sr)*yn,b[4]=(ft*nn-at*gn-xt*Or)*yn,b[5]=(g*gn-rt*nn+ot*Or)*yn,b[6]=(er*pr-Ut*Pr-Jt*cr)*yn,b[7]=(Ct*Pr-kt*pr+zt*cr)*yn,b[8]=(at*un-ut*nn+xt*Dr)*yn,b[9]=(_e*nn-g*un-ot*Dr)*yn,b[10]=(Ut*br-Kt*pr+Jt*or)*yn,b[11]=(Rt*pr-Ct*br-zt*or)*yn,b[12]=(ut*Or-at*$r-ft*Dr)*yn,b[13]=(g*$r-_e*Or+rt*Dr)*yn,b[14]=(Kt*cr-Ut*Sr-er*or)*yn,b[15]=(Ct*Sr-Rt*cr+kt*or)*yn,b):null}function Bt(b,o,g){var _e=o[0],rt=o[1],ot=o[2],at=o[3],ut=o[4],ft=o[5],xt=o[6],Ct=o[7],Rt=o[8],kt=o[9],zt=o[10],Ut=o[11],Kt=o[12],er=o[13],Jt=o[14],or=o[15],cr=g[0],pr=g[1],Sr=g[2],br=g[3];return b[0]=cr*_e+pr*ut+Sr*Rt+br*Kt,b[1]=cr*rt+pr*ft+Sr*kt+br*er,b[2]=cr*ot+pr*xt+Sr*zt+br*Jt,b[3]=cr*at+pr*Ct+Sr*Ut+br*or,b[4]=(cr=g[4])*_e+(pr=g[5])*ut+(Sr=g[6])*Rt+(br=g[7])*Kt,b[5]=cr*rt+pr*ft+Sr*kt+br*er,b[6]=cr*ot+pr*xt+Sr*zt+br*Jt,b[7]=cr*at+pr*Ct+Sr*Ut+br*or,b[8]=(cr=g[8])*_e+(pr=g[9])*ut+(Sr=g[10])*Rt+(br=g[11])*Kt,b[9]=cr*rt+pr*ft+Sr*kt+br*er,b[10]=cr*ot+pr*xt+Sr*zt+br*Jt,b[11]=cr*at+pr*Ct+Sr*Ut+br*or,b[12]=(cr=g[12])*_e+(pr=g[13])*ut+(Sr=g[14])*Rt+(br=g[15])*Kt,b[13]=cr*rt+pr*ft+Sr*kt+br*er,b[14]=cr*ot+pr*xt+Sr*zt+br*Jt,b[15]=cr*at+pr*Ct+Sr*Ut+br*or,b}function Nt(b,o,g){var _e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt,Ut,Kt=g[0],er=g[1],Jt=g[2];return o===b?(b[12]=o[0]*Kt+o[4]*er+o[8]*Jt+o[12],b[13]=o[1]*Kt+o[5]*er+o[9]*Jt+o[13],b[14]=o[2]*Kt+o[6]*er+o[10]*Jt+o[14],b[15]=o[3]*Kt+o[7]*er+o[11]*Jt+o[15]):(rt=o[1],ot=o[2],at=o[3],ut=o[4],ft=o[5],xt=o[6],Ct=o[7],Rt=o[8],kt=o[9],zt=o[10],Ut=o[11],b[0]=_e=o[0],b[1]=rt,b[2]=ot,b[3]=at,b[4]=ut,b[5]=ft,b[6]=xt,b[7]=Ct,b[8]=Rt,b[9]=kt,b[10]=zt,b[11]=Ut,b[12]=_e*Kt+ut*er+Rt*Jt+o[12],b[13]=rt*Kt+ft*er+kt*Jt+o[13],b[14]=ot*Kt+xt*er+zt*Jt+o[14],b[15]=at*Kt+Ct*er+Ut*Jt+o[15]),b}function Vt(b,o,g){var _e=g[0],rt=g[1],ot=g[2];return b[0]=o[0]*_e,b[1]=o[1]*_e,b[2]=o[2]*_e,b[3]=o[3]*_e,b[4]=o[4]*rt,b[5]=o[5]*rt,b[6]=o[6]*rt,b[7]=o[7]*rt,b[8]=o[8]*ot,b[9]=o[9]*ot,b[10]=o[10]*ot,b[11]=o[11]*ot,b[12]=o[12],b[13]=o[13],b[14]=o[14],b[15]=o[15],b}function Xt(b,o,g){var _e=Math.sin(g),rt=Math.cos(g),ot=o[4],at=o[5],ut=o[6],ft=o[7],xt=o[8],Ct=o[9],Rt=o[10],kt=o[11];return o!==b&&(b[0]=o[0],b[1]=o[1],b[2]=o[2],b[3]=o[3],b[12]=o[12],b[13]=o[13],b[14]=o[14],b[15]=o[15]),b[4]=ot*rt+xt*_e,b[5]=at*rt+Ct*_e,b[6]=ut*rt+Rt*_e,b[7]=ft*rt+kt*_e,b[8]=xt*rt-ot*_e,b[9]=Ct*rt-at*_e,b[10]=Rt*rt-ut*_e,b[11]=kt*rt-ft*_e,b}function nr(b,o,g){var _e=Math.sin(g),rt=Math.cos(g),ot=o[0],at=o[1],ut=o[2],ft=o[3],xt=o[8],Ct=o[9],Rt=o[10],kt=o[11];return o!==b&&(b[4]=o[4],b[5]=o[5],b[6]=o[6],b[7]=o[7],b[12]=o[12],b[13]=o[13],b[14]=o[14],b[15]=o[15]),b[0]=ot*rt-xt*_e,b[1]=at*rt-Ct*_e,b[2]=ut*rt-Rt*_e,b[3]=ft*rt-kt*_e,b[8]=ot*_e+xt*rt,b[9]=at*_e+Ct*rt,b[10]=ut*_e+Rt*rt,b[11]=ft*_e+kt*rt,b}function ar(b,o,g){var _e=Math.sin(g),rt=Math.cos(g),ot=o[0],at=o[1],ut=o[2],ft=o[3],xt=o[4],Ct=o[5],Rt=o[6],kt=o[7];return o!==b&&(b[8]=o[8],b[9]=o[9],b[10]=o[10],b[11]=o[11],b[12]=o[12],b[13]=o[13],b[14]=o[14],b[15]=o[15]),b[0]=ot*rt+xt*_e,b[1]=at*rt+Ct*_e,b[2]=ut*rt+Rt*_e,b[3]=ft*rt+kt*_e,b[4]=xt*rt-ot*_e,b[5]=Ct*rt-at*_e,b[6]=Rt*rt-ut*_e,b[7]=kt*rt-ft*_e,b}function mr(b,o){return b[0]=o[0],b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=o[1],b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=o[2],b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b}function Fr(b,o,g){var _e,rt,ot,at=g[0],ut=g[1],ft=g[2],xt=Math.sqrt(at*at+ut*ut+ft*ft);return xt<ct?null:(at*=xt=1/xt,ut*=xt,ft*=xt,_e=Math.sin(o),rt=Math.cos(o),b[0]=at*at*(ot=1-rt)+rt,b[1]=ut*at*ot+ft*_e,b[2]=ft*at*ot-ut*_e,b[3]=0,b[4]=at*ut*ot-ft*_e,b[5]=ut*ut*ot+rt,b[6]=ft*ut*ot+at*_e,b[7]=0,b[8]=at*ft*ot+ut*_e,b[9]=ut*ft*ot-at*_e,b[10]=ft*ft*ot+rt,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b)}function sn(b,o){var g=o[0],_e=o[1],rt=o[2],ot=o[4],at=o[5],ut=o[6],ft=o[8],xt=o[9],Ct=o[10];return b[0]=Math.sqrt(g*g+_e*_e+rt*rt),b[1]=Math.sqrt(ot*ot+at*at+ut*ut),b[2]=Math.sqrt(ft*ft+xt*xt+Ct*Ct),b}function fn(b,o){var g=o[0],_e=o[1],rt=o[2],ot=o[3],at=g+g,ut=_e+_e,ft=rt+rt,xt=g*at,Ct=_e*at,Rt=_e*ut,kt=rt*at,zt=rt*ut,Ut=rt*ft,Kt=ot*at,er=ot*ut,Jt=ot*ft;return b[0]=1-Rt-Ut,b[1]=Ct+Jt,b[2]=kt-er,b[3]=0,b[4]=Ct-Jt,b[5]=1-xt-Ut,b[6]=zt+Kt,b[7]=0,b[8]=kt+er,b[9]=zt-Kt,b[10]=1-xt-Rt,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b}var Lr=Bt;function Qr(){var b=new dt(3);return dt!=Float32Array&&(b[0]=0,b[1]=0,b[2]=0),b}function dn(b){var o=new dt(3);return o[0]=b[0],o[1]=b[1],o[2]=b[2],o}function en(b){var o=b[0],g=b[1],_e=b[2];return Math.sqrt(o*o+g*g+_e*_e)}function yr(b,o,g){var _e=new dt(3);return _e[0]=b,_e[1]=o,_e[2]=g,_e}function Ar(b,o,g,_e){return b[0]=o,b[1]=g,b[2]=_e,b}function rr(b,o,g){return b[0]=o[0]+g[0],b[1]=o[1]+g[1],b[2]=o[2]+g[2],b}function ur(b,o,g){return b[0]=o[0]-g[0],b[1]=o[1]-g[1],b[2]=o[2]-g[2],b}function Br(b,o,g){return b[0]=o[0]*g[0],b[1]=o[1]*g[1],b[2]=o[2]*g[2],b}function xr(b,o,g){return b[0]=Math.min(o[0],g[0]),b[1]=Math.min(o[1],g[1]),b[2]=Math.min(o[2],g[2]),b}function qr(b,o,g){return b[0]=Math.max(o[0],g[0]),b[1]=Math.max(o[1],g[1]),b[2]=Math.max(o[2],g[2]),b}function tn(b,o,g){return b[0]=o[0]*g,b[1]=o[1]*g,b[2]=o[2]*g,b}function vn(b,o,g,_e){return b[0]=o[0]+g[0]*_e,b[1]=o[1]+g[1]*_e,b[2]=o[2]+g[2]*_e,b}function hs(b,o){var g=o[0]-b[0],_e=o[1]-b[1],rt=o[2]-b[2];return Math.sqrt(g*g+_e*_e+rt*rt)}function Ts(b,o){var g=o[0]-b[0],_e=o[1]-b[1],rt=o[2]-b[2];return g*g+_e*_e+rt*rt}function ss(b){var o=b[0],g=b[1],_e=b[2];return o*o+g*g+_e*_e}function Mn(b,o){return b[0]=-o[0],b[1]=-o[1],b[2]=-o[2],b}function ds(b,o){var g=o[0],_e=o[1],rt=o[2],ot=g*g+_e*_e+rt*rt;return ot>0&&(ot=1/Math.sqrt(ot)),b[0]=o[0]*ot,b[1]=o[1]*ot,b[2]=o[2]*ot,b}function gs(b,o){return b[0]*o[0]+b[1]*o[1]+b[2]*o[2]}function ys(b,o,g){var _e=o[0],rt=o[1],ot=o[2],at=g[0],ut=g[1],ft=g[2];return b[0]=rt*ft-ot*ut,b[1]=ot*at-_e*ft,b[2]=_e*ut-rt*at,b}function Hs(b,o,g,_e){var rt=o[0],ot=o[1],at=o[2];return b[0]=rt+_e*(g[0]-rt),b[1]=ot+_e*(g[1]-ot),b[2]=at+_e*(g[2]-at),b}function _s(b,o,g){var _e=o[0],rt=o[1],ot=o[2],at=g[3]*_e+g[7]*rt+g[11]*ot+g[15];return b[0]=(g[0]*_e+g[4]*rt+g[8]*ot+g[12])/(at=at||1),b[1]=(g[1]*_e+g[5]*rt+g[9]*ot+g[13])/at,b[2]=(g[2]*_e+g[6]*rt+g[10]*ot+g[14])/at,b}function Ss(b,o,g){var _e=o[0],rt=o[1],ot=o[2];return b[0]=_e*g[0]+rt*g[3]+ot*g[6],b[1]=_e*g[1]+rt*g[4]+ot*g[7],b[2]=_e*g[2]+rt*g[5]+ot*g[8],b}function Vl(b,o,g){var _e=g[0],rt=g[1],ot=g[2],at=g[3],ut=o[0],ft=o[1],xt=o[2],Ct=rt*xt-ot*ft,Rt=ot*ut-_e*xt,kt=_e*ft-rt*ut;return b[0]=ut+at*(Ct+=Ct)+rt*(kt+=kt)-ot*(Rt+=Rt),b[1]=ft+at*Rt+ot*Ct-_e*kt,b[2]=xt+at*kt+_e*Rt-rt*Ct,b}function ba(b){return b[0]=0,b[1]=0,b[2]=0,b}function Qo(b,o){return b[0]===o[0]&&b[1]===o[1]&&b[2]===o[2]}var wo=ur,cu=Br,uu=en;function Pl(){var b=new dt(4);return dt!=Float32Array&&(b[0]=0,b[1]=0,b[2]=0,b[3]=0),b}function Jl(b,o,g){return b[0]=o[0]*g,b[1]=o[1]*g,b[2]=o[2]*g,b[3]=o[3]*g,b}function Ul(b,o){var g=o[0],_e=o[1],rt=o[2],ot=o[3],at=g*g+_e*_e+rt*rt+ot*ot;return at>0&&(at=1/Math.sqrt(at)),b[0]=g*at,b[1]=_e*at,b[2]=rt*at,b[3]=ot*at,b}function xl(b,o,g){var _e=o[0],rt=o[1],ot=o[2],at=o[3];return b[0]=g[0]*_e+g[4]*rt+g[8]*ot+g[12]*at,b[1]=g[1]*_e+g[5]*rt+g[9]*ot+g[13]*at,b[2]=g[2]*_e+g[6]*rt+g[10]*ot+g[14]*at,b[3]=g[3]*_e+g[7]*rt+g[11]*ot+g[15]*at,b}function Yn(){var b=new dt(4);return dt!=Float32Array&&(b[0]=0,b[1]=0,b[2]=0),b[3]=1,b}function xn(b){return b[0]=0,b[1]=0,b[2]=0,b[3]=1,b}function Qn(b,o,g){g*=.5;var _e=o[0],rt=o[1],ot=o[2],at=o[3],ut=Math.sin(g),ft=Math.cos(g);return b[0]=_e*ft+at*ut,b[1]=rt*ft+ot*ut,b[2]=ot*ft-rt*ut,b[3]=at*ft-_e*ut,b}function os(b,o,g){g*=.5;var _e=o[0],rt=o[1],ot=o[2],at=o[3],ut=Math.sin(g),ft=Math.cos(g);return b[0]=_e*ft-ot*ut,b[1]=rt*ft+at*ut,b[2]=ot*ft+_e*ut,b[3]=at*ft-rt*ut,b}Qr(),Pl();var Ks,oo,qo,zn=Ul,Xn=(Ks=Qr(),oo=yr(1,0,0),qo=yr(0,1,0),function(b,o,g){var _e=gs(o,g);return _e<-.999999?(ys(Ks,oo,o),uu(Ks)<1e-6&&ys(Ks,qo,o),ds(Ks,Ks),function(rt,ot,at){at*=.5;var ut=Math.sin(at);rt[0]=ut*ot[0],rt[1]=ut*ot[1],rt[2]=ut*ot[2],rt[3]=Math.cos(at)}(b,Ks,Math.PI),b):_e>.999999?(b[0]=0,b[1]=0,b[2]=0,b[3]=1,b):(ys(Ks,o,g),b[0]=Ks[0],b[1]=Ks[1],b[2]=Ks[2],b[3]=1+_e,zn(b,b))});function xs(){var b=new dt(2);return dt!=Float32Array&&(b[0]=0,b[1]=0),b}function As(b,o){var g=new dt(2);return g[0]=b,g[1]=o,g}function ks(b,o,g){return b[0]=o,b[1]=g,b}function Eo(b,o,g){return b[0]=o[0]+g[0],b[1]=o[1]+g[1],b}function Jo(b,o,g){return b[0]=o[0]-g[0],b[1]=o[1]-g[1],b}function na(b,o,g){return b[0]=o[0]*g,b[1]=o[1]*g,b}function Go(b){var o=b[0],g=b[1];return Math.sqrt(o*o+g*g)}function _c(b,o){var g=o[0],_e=o[1],rt=g*g+_e*_e;return rt>0&&(rt=1/Math.sqrt(rt)),b[0]=o[0]*rt,b[1]=o[1]*rt,b}function Il(b,o){return b[0]*o[0]+b[1]*o[1]}Yn(),Yn(),Tt();var Zs,$l,io=Jo;function zo(b){return b&&b.__esModule&&Object.prototype.hasOwnProperty.call(b,"default")?b.default:b}xs();var Ko=function(){if($l)return Zs;function b(o,g,_e,rt){this.cx=3*o,this.bx=3*(_e-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*g,this.by=3*(rt-g)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=g,this.p2x=_e,this.p2y=rt}return $l=1,Zs=b,b.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,g){if(g===void 0&&(g=1e-6),o<0)return 0;if(o>1)return 1;for(var _e=o,rt=0;rt<8;rt++){var ot=this.sampleCurveX(_e)-o;if(Math.abs(ot)<g)return _e;var at=this.sampleCurveDerivativeX(_e);if(Math.abs(at)<1e-6)break;_e-=ot/at}var ut=0,ft=1;for(_e=o,rt=0;rt<20&&(ot=this.sampleCurveX(_e),!(Math.abs(ot-o)<g));rt++)o>ot?ut=_e:ft=_e,_e=.5*(ft-ut)+ut;return _e},solve:function(o,g){return this.sampleCurveY(this.solveCurveX(o,g))}},Zs}(),vu=zo(Ko);function _n(b,o){this.x=b,this.y=o}function Su(b,o){if(Array.isArray(b)){if(!Array.isArray(o)||b.length!==o.length)return!1;for(let g=0;g<b.length;g++)if(!Su(b[g],o[g]))return!1;return!0}if(typeof b=="object"&&b!==null&&o!==null){if(typeof o!="object"||Object.keys(b).length!==Object.keys(o).length)return!1;for(const g in b)if(!Su(b[g],o[g]))return!1;return!0}return b===o}_n.prototype={clone(){return new _n(this.x,this.y)},add(b){return this.clone()._add(b)},sub(b){return this.clone()._sub(b)},multByPoint(b){return this.clone()._multByPoint(b)},divByPoint(b){return this.clone()._divByPoint(b)},mult(b){return this.clone()._mult(b)},div(b){return this.clone()._div(b)},rotate(b){return this.clone()._rotate(b)},rotateAround(b,o){return this.clone()._rotateAround(b,o)},matMult(b){return this.clone()._matMult(b)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(b){return this.x===b.x&&this.y===b.y},dist(b){return Math.sqrt(this.distSqr(b))},distSqr(b){const o=b.x-this.x,g=b.y-this.y;return o*o+g*g},angle(){return Math.atan2(this.y,this.x)},angleTo(b){return Math.atan2(this.y-b.y,this.x-b.x)},angleWith(b){return this.angleWithSep(b.x,b.y)},angleWithSep(b,o){return Math.atan2(this.x*o-this.y*b,this.x*b+this.y*o)},_matMult(b){const o=b[2]*this.x+b[3]*this.y;return this.x=b[0]*this.x+b[1]*this.y,this.y=o,this},_add(b){return this.x+=b.x,this.y+=b.y,this},_sub(b){return this.x-=b.x,this.y-=b.y,this},_mult(b){return this.x*=b,this.y*=b,this},_div(b){return this.x/=b,this.y/=b,this},_multByPoint(b){return this.x*=b.x,this.y*=b.y,this},_divByPoint(b){return this.x/=b.x,this.y/=b.y,this},_unit(){return this._div(this.mag()),this},_perp(){const b=this.y;return this.y=this.x,this.x=-b,this},_rotate(b){const o=Math.cos(b),g=Math.sin(b),_e=g*this.x+o*this.y;return this.x=o*this.x-g*this.y,this.y=_e,this},_rotateAround(b,o){const g=Math.cos(b),_e=Math.sin(b),rt=o.y+_e*(this.x-o.x)+g*(this.y-o.y);return this.x=o.x+g*(this.x-o.x)-_e*(this.y-o.y),this.y=rt,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:_n},_n.convert=function(b){if(b instanceof _n)return b;if(Array.isArray(b))return new _n(+b[0],+b[1]);if(b.x!==void 0&&b.y!==void 0)return new _n(+b.x,+b.y);throw new Error("Expected [x, y] or {x, y} point format")};const bp=Math.PI/180,bu=180/Math.PI;function Xs(b){return b*bp}function Mu(b){return b*bu}const rv=[[0,0],[1,0],[1,1],[0,1]];function qm(b){if(b<=0)return 0;if(b>=1)return 1;const o=b*b,g=o*b;return 4*(b<.5?g:3*(b-o)+g-.75)}function oy(b,o,g,_e){const rt=new vu(b,o,g,_e);return function(ot){return rt.solve(ot)}}const Wr=oy(.25,.1,.25,1);function tr(b,o,g){return Math.min(g,Math.max(o,b))}function lr(b,o,g){return(g=tr((g-b)/(o-b),0,1))*g*(3-2*g)}function _r(b,o,g){const _e=g-o,rt=((b-o)%_e+_e)%_e+o;return rt===o?g:rt}function Nr(b,o,g){if(!b.length)return g(null,[]);let _e=b.length;const rt=new Array(b.length);let ot=null;b.forEach((at,ut)=>{o(at,(ft,xt)=>{ft&&(ot=ft),rt[ut]=xt,--_e==0&&g(ot,rt)})})}let Mr=1;function Vr(){return Mr++}function Yr(b){return b<=1?1:Math.pow(2,Math.ceil(Math.log2(b)))}function Gr(b,o){b.forEach(g=>{o[g]&&(o[g]=o[g].bind(o))})}function Zr(b,o,g){const _e={};for(const rt in b)_e[rt]=o.call(this,b[rt],rt,b);return _e}function Rn(b,o,g){const _e={};for(const rt in b)o.call(this,b[rt],rt,b)&&(_e[rt]=b[rt]);return _e}function mn(b){return Array.isArray(b)?b.map(mn):typeof b=="object"&&b?Zr(b,mn):b}function Zn(b,o){for(let g=0;g<b.length;g++)if(o.indexOf(b[g])>=0)return!0;return!1}const fs={};function Wn(b){fs[b]||(typeof console<"u"&&console.warn(b),fs[b]=!0)}function zs(b,o,g){return(g.y-b.y)*(o.x-b.x)>(o.y-b.y)*(g.x-b.x)}function Fs(b){let o=0;for(let g,_e,rt=0,ot=b.length,at=ot-1;rt<ot;at=rt++)g=b[rt],_e=b[at],o+=(_e.x-g.x)*(g.y+_e.y);return o}function js([b,o,g]){const _e=Xs(o+90),rt=Xs(g);return{x:b*Math.cos(_e)*Math.sin(rt),y:b*Math.sin(_e)*Math.sin(rt),z:b*Math.cos(rt),azimuthal:o,polar:g}}function lo(b){return(typeof self<"u"||b!==void 0)&&typeof WorkerGlobalScope<"u"&&(b!==void 0?b:self)instanceof WorkerGlobalScope}function Ml(b){const o={};if(b.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(g,_e,rt,ot)=>{const at=rt||ot;return o[_e]=!at||at.toLowerCase(),""}),o["max-age"]){const g=parseInt(o["max-age"],10);isNaN(g)?delete o["max-age"]:o["max-age"]=g}return o}let Xl=null;function Ll(b,o){return[b[4*o],b[4*o+1],b[4*o+2],b[4*o+3]]}function eu(b,o,g,_e){for(;o<g;){const rt=o+g>>1;b[rt]<_e?o=rt+1:g=rt}return o}function Sl(b,o,g,_e){for(;o<g;){const rt=o+g>>1;b[rt]<=_e?o=rt+1:g=rt}return o}function po(b){return b>0?1/(1.001-b):1+b}function Cl(b){return b>0?1-1/(1.001-b):-b}function Vo(b,o,g){return(b-o.min)*(g.max-g.min)/(o.max-o.min)+g.min}const eo={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!eo.API_URL)return null;try{const b=new URL(eo.API_URL);return b.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":b.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ol(b){return eo.API_URL_REGEX.test(b)}function wu(b){return eo.API_SPRITE_REGEX.test(b)}let Cu,Uu,Km,mu,_h,Du;function Dp(){return Cu==null&&(Cu=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Cu}const hu={now:()=>mu!==void 0?mu:performance.now(),setNow(b){mu=b},restoreNow(){mu=void 0},frame(b){const o=requestAnimationFrame(b);return{cancel:()=>cancelAnimationFrame(o)}},getImageData(b,o=0){const{width:g,height:_e}=b;_h||(_h=document.createElement("canvas"));const rt=_h.getContext("2d",{willReadFrequently:!0});if(!rt)throw new Error("failed to create canvas 2d context");return(g>_h.width||_e>_h.height)&&(_h.width=g,_h.height=_e),rt.clearRect(-o,-o,g+2*o,_e+2*o),rt.drawImage(b,0,0,g,_e),rt.getImageData(-o,-o,g+2*o,_e+2*o)},resolveURL:b=>(Uu||(Uu=document.createElement("a")),Uu.href=b,Uu.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Km==null&&(Km=window.matchMedia("(prefers-reduced-motion: reduce)")),Km.matches)},hasCanvasFingerprintNoise(){if(Du!==void 0)return Du;if(!Dp())return Du=!1,!1;const b=new OffscreenCanvas(85,1),o=b.getContext("2d",{willReadFrequently:!0});let g=0;for(let rt=0;rt<b.width;++rt)o.fillStyle=`rgba(${g++},${g++},${g++}, 255)`,o.fillRect(rt,0,1,1);const _e=o.getImageData(0,0,b.width,b.height);g=0;for(let rt=0;rt<_e.data.length;++rt)if(rt%4!=3&&g++!==_e.data[rt])return Du=!0,!0;return Du=!1,!1}};function Xm(b,o){const g=b.indexOf("?");if(g<0)return`${b}?${new URLSearchParams(o).toString()}`;const _e=new URLSearchParams(b.slice(g));for(const rt in o)_e.set(rt,o[rt]);return`${b.slice(0,g)}?${_e.toString()}`}function v0(b,o={persistentParams:[]}){const g=b.indexOf("?");if(g<0)return b;const _e=new URLSearchParams,rt=new URLSearchParams(b.slice(g));for(const at of o.persistentParams){const ut=rt.get(at);ut&&_e.set(at,ut)}const ot=_e.toString();return`${b.slice(0,g)}${ot.length>0?`?${ot}`:""}`}const ax="mapbox-tiles";let lx=500,ux=50;const ay=["language","worldview","jobid"];let Np,$u;function wp(){try{return caches}catch{}}function Ep(){const b=wp();b&&Np==null&&(Np=b.open(ax))}let up=1/0;const Lp={supported:!1,testSupport:function(b){!hx&&Zm&&(Ym?J1(b):wm=b)}};let wm,Zm,hx=!1,Ym=!1;const dx=typeof self<"u"?self:{};function J1(b){const o=b.createTexture();b.bindTexture(b.TEXTURE_2D,o);try{if(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,Zm),b.isContextLost())return;Lp.supported=!0}catch{}b.deleteTexture(o),hx=!0}dx.document&&(Zm=dx.document.createElement("img"),Zm.onload=function(){wm&&J1(wm),wm=null,Ym=!0},Zm.onerror=function(){hx=!0,wm=null},Zm.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ly={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ly);class Xu extends Error{constructor(o,g,_e){g===401&&Ol(_e)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=g,this.url=_e}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const fx=lo()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Qm=function(b,o){if(!(/^file:/.test(g=b.url)||/^file:/.test(fx())&&!/^\w+:/.test(g))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(_e,rt){const ot=new AbortController,at=new Request(_e.url,{method:_e.method||"GET",body:_e.body,credentials:_e.credentials,headers:_e.headers,referrer:fx(),referrerPolicy:_e.referrerPolicy,signal:ot.signal});let ut=!1,ft=!1;const xt=(Ct=at.url).indexOf("sku=")>0&&Ol(Ct);var Ct;_e.type==="json"&&at.headers.set("Accept","application/json");const Rt=(zt,Ut,Kt)=>{if(ft)return;if(zt&&zt.message!=="SecurityError"&&Wn(zt.toString()),Ut&&Kt)return kt(Ut);const er=Date.now();fetch(at).then(Jt=>{if(Jt.ok){const or=xt?Jt.clone():null;return kt(Jt,or,er)}return rt(new Xu(Jt.statusText,Jt.status,_e.url))}).catch(Jt=>{Jt.name!=="AbortError"&&rt(new Error(`${Jt.message} ${_e.url}`))})},kt=(zt,Ut,Kt)=>{(_e.type==="arrayBuffer"?zt.arrayBuffer():_e.type==="json"?zt.json():zt.text()).then(er=>{ft||(Ut&&Kt&&function(Jt,or,cr){if(Ep(),Np==null)return;const pr=Ml(or.headers.get("Cache-Control")||"");if(pr["no-store"])return;const Sr={status:or.status,statusText:or.statusText,headers:new Headers};or.headers.forEach((Dr,Or)=>Sr.headers.set(Or,Dr)),pr["max-age"]&&Sr.headers.set("Expires",new Date(cr+1e3*pr["max-age"]).toUTCString());const br=Sr.headers.get("Expires");if(!br||new Date(br).getTime()-cr<42e4)return;let Pr=v0(Jt.url,{persistentParams:ay});if(or.status===206){const Dr=Jt.headers.get("Range");if(!Dr)return;Sr.status=200,Pr=Xm(Pr,{range:Dr})}(function(Dr,Or){if($u===void 0)try{new Response(new ReadableStream),$u=!0}catch{$u=!1}$u?Or(Dr.body):Dr.blob().then(Or).catch(nn=>Wn(nn.message))})(or,Dr=>{const Or=new Response((nn=or.status)!==200&&nn!==404&&[101,103,204,205,304].includes(nn)?null:Dr,Sr);var nn;Ep(),Np!=null&&Np.then($r=>$r.put(Pr,Or)).catch($r=>Wn($r.message))})}(at,Ut,Kt),ut=!0,rt(null,er,zt.headers))}).catch(er=>{ft||rt(new Error(er.message))})};return xt?function(zt,Ut){if(Ep(),Np==null)return Ut(null);Np.then(Kt=>{let er=v0(zt.url,{persistentParams:ay});const Jt=zt.headers.get("Range");Jt&&(er=Xm(er,{range:Jt})),Kt.match(er).then(or=>{const cr=function(pr){if(!pr)return!1;const Sr=new Date(pr.headers.get("Expires")||0),br=Ml(pr.headers.get("Cache-Control")||"");return Number(Sr)>Date.now()&&!br["no-cache"]}(or);Kt.delete(er).catch(Ut),cr&&Kt.put(er,or.clone()).catch(Ut),Ut(null,or,cr)}).catch(Ut)}).catch(Ut)}(at,Rt):Rt(null,null),{cancel:()=>{ft=!0,ut||ot.abort()}}}(b,o);if(lo(self)&&self.worker.actor)return self.worker.actor.send("getResource",b,o,void 0,!0)}var g;return function(_e,rt){const ot=new XMLHttpRequest;ot.open(_e.method||"GET",_e.url,!0),_e.type==="arrayBuffer"&&(ot.responseType="arraybuffer");for(const at in _e.headers)ot.setRequestHeader(at,_e.headers[at]);return _e.type==="json"&&(ot.responseType="text",ot.setRequestHeader("Accept","application/json")),ot.withCredentials=_e.credentials==="include",ot.onerror=()=>{rt(new Error(ot.statusText))},ot.onload=()=>{if((ot.status>=200&&ot.status<300||ot.status===0)&&ot.response!==null){let at=ot.response;if(_e.type==="json")try{at=JSON.parse(ot.response)}catch(ft){return rt(ft)}const ut=new Headers;ot.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(ft=>{const xt=ft.split(": "),Ct=xt.shift(),Rt=xt.join(": ");ut.append(Ct,Rt)}),rt(null,at,ut)}else rt(new Xu(ot.statusText,ot.status,_e.url))},ot.send(_e.body),{cancel:()=>ot.abort()}}(b,o)},Zp=function(b,o){return Qm(Object.assign(b,{type:"arrayBuffer"}),o)};function YE(b){const o=document.createElement("a");return o.href=b,o.protocol===location.protocol&&o.host===location.host}const _b="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let cy,fo;cy=[],fo=0;const mx=function(b,o){if(Lp.supported&&(b.headers||(b.headers={}),b.headers.accept="image/webp,*/*"),fo>=eo.MAX_PARALLEL_IMAGE_REQUESTS){const ot={requestParameters:b,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return cy.push(ot),ot}fo++;let g=!1;const _e=()=>{if(!g)for(g=!0,fo--;cy.length&&fo<eo.MAX_PARALLEL_IMAGE_REQUESTS;){const ot=cy.shift(),{requestParameters:at,callback:ut,cancelled:ft}=ot;ft||(ot.cancel=mx(at,ut).cancel)}},rt=Zp(b,(ot,at,ut)=>{_e(),ot?o(ot):at&&(self.createImageBitmap?function(ft,xt){const Ct=new Blob([new Uint8Array(ft)],{type:"image/png"});createImageBitmap(Ct).then(Rt=>{xt(null,Rt)}).catch(Rt=>{xt(new Error(`Could not load image because of ${Rt.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(at,(ft,xt)=>o(ft,xt,ut)):function(ft,xt){const Ct=new Image;Ct.onload=()=>{xt(null,Ct),URL.revokeObjectURL(Ct.src),Ct.onload=null,requestAnimationFrame(()=>{Ct.src=_b})},Ct.onerror=()=>xt(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Rt=new Blob([new Uint8Array(ft)],{type:"image/png"});Ct.src=ft.byteLength?URL.createObjectURL(Rt):_b}(at,(ft,xt)=>o(ft,xt,ut)))});return{cancel:()=>{rt.cancel(),_e()}}};var nv,ew,tw,Em={exports:{}},uy={exports:{}},hy={exports:{}},iv=function(){if(tw)return Em.exports;tw=1;var b=(nv||(nv=1,uy.exports=function(g,_e){var rt,ot,at,ut,ft,xt,Ct,Rt;for(ot=g.length-(rt=3&g.length),at=_e,ft=3432918353,xt=461845907,Rt=0;Rt<ot;)Ct=255&g.charCodeAt(Rt)|(255&g.charCodeAt(++Rt))<<8|(255&g.charCodeAt(++Rt))<<16|(255&g.charCodeAt(++Rt))<<24,++Rt,at=27492+(65535&(ut=5*(65535&(at=(at^=Ct=(65535&(Ct=(Ct=(65535&Ct)*ft+(((Ct>>>16)*ft&65535)<<16)&4294967295)<<15|Ct>>>17))*xt+(((Ct>>>16)*xt&65535)<<16)&4294967295)<<13|at>>>19))+((5*(at>>>16)&65535)<<16)&4294967295))+((58964+(ut>>>16)&65535)<<16);switch(Ct=0,rt){case 3:Ct^=(255&g.charCodeAt(Rt+2))<<16;case 2:Ct^=(255&g.charCodeAt(Rt+1))<<8;case 1:at^=Ct=(65535&(Ct=(Ct=(65535&(Ct^=255&g.charCodeAt(Rt)))*ft+(((Ct>>>16)*ft&65535)<<16)&4294967295)<<15|Ct>>>17))*xt+(((Ct>>>16)*xt&65535)<<16)&4294967295}return at^=g.length,at=2246822507*(65535&(at^=at>>>16))+((2246822507*(at>>>16)&65535)<<16)&4294967295,at=3266489909*(65535&(at^=at>>>13))+((3266489909*(at>>>16)&65535)<<16)&4294967295,(at^=at>>>16)>>>0}),uy.exports),o=(ew||(ew=1,hy.exports=function(g,_e){for(var rt,ot=g.length,at=_e^ot,ut=0;ot>=4;)rt=1540483477*(65535&(rt=255&g.charCodeAt(ut)|(255&g.charCodeAt(++ut))<<8|(255&g.charCodeAt(++ut))<<16|(255&g.charCodeAt(++ut))<<24))+((1540483477*(rt>>>16)&65535)<<16),at=1540483477*(65535&at)+((1540483477*(at>>>16)&65535)<<16)^(rt=1540483477*(65535&(rt^=rt>>>24))+((1540483477*(rt>>>16)&65535)<<16)),ot-=4,++ut;switch(ot){case 3:at^=(255&g.charCodeAt(ut+2))<<16;case 2:at^=(255&g.charCodeAt(ut+1))<<8;case 1:at=1540483477*(65535&(at^=255&g.charCodeAt(ut)))+((1540483477*(at>>>16)&65535)<<16)}return at=1540483477*(65535&(at^=at>>>13))+((1540483477*(at>>>16)&65535)<<16),(at^=at>>>15)>>>0}),hy.exports);return Em.exports=b,Em.exports.murmur3=b,Em.exports.murmur2=o,Em.exports}(),gx=zo(iv);class jp{constructor(o,...g){Object.assign(this,g[0]||{}),this.type=o}}class dy extends jp{constructor(o,g={}){super("error",Object.assign({error:o},g))}}function sv(b,o,g){g[b]&&g[b].indexOf(o)!==-1||(g[b]=g[b]||[],g[b].push(o))}function Tm(b,o,g){if(g&&g[b]){const _e=g[b].indexOf(o);_e!==-1&&g[b].splice(_e,1)}}class Jm{on(o,g){return this._listeners=this._listeners||{},sv(o,g,this._listeners),this}off(o,g){return Tm(o,g,this._listeners),Tm(o,g,this._oneTimeListeners),this}once(o,g){return g?(this._oneTimeListeners=this._oneTimeListeners||{},sv(o,g,this._oneTimeListeners),this):new Promise(_e=>{this.once(o,_e)})}fire(o,g){const _e=typeof o=="string"?new jp(o,g):o,rt=_e.type;if(this.listens(rt)){_e.target=this;const ot=this._listeners&&this._listeners[rt]?this._listeners[rt].slice():[];for(const ft of ot)ft.call(this,_e);const at=this._oneTimeListeners&&this._oneTimeListeners[rt]?this._oneTimeListeners[rt].slice():[];for(const ft of at)Tm(rt,ft,this._oneTimeListeners),ft.call(this,_e);const ut=this._eventedParent;if(ut){const ft=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(_e,ft),ut.fire(_e)}}else _e instanceof dy&&console.error(_e.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,g){return this._eventedParent=o,this._eventedParentData=g,this}}class Nu{constructor(o){typeof o=="string"?this.name=o:(this.name=o.name,this.iconsetId=o.iconsetId)}static from(o){return new Nu(o)}static toString(o){return o.iconsetId?`${o.name}${o.iconsetId}`:o.name}static parse(o){const[g,_e]=o.split("");return new Nu({name:g,iconsetId:_e})}static isEqual(o,g){return o.name===g.name&&o.iconsetId===g.iconsetId}toString(){return Nu.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var yx,py={},hp=function(){if(yx)return py;yx=1;var b={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(ot){return(ot=Math.round(ot))<0?0:ot>255?255:ot}function g(ot){return o(ot[ot.length-1]==="%"?parseFloat(ot)/100*255:parseInt(ot))}function _e(ot){return(at=ot[ot.length-1]==="%"?parseFloat(ot)/100:parseFloat(ot))<0?0:at>1?1:at;var at}function rt(ot,at,ut){return ut<0?ut+=1:ut>1&&(ut-=1),6*ut<1?ot+(at-ot)*ut*6:2*ut<1?at:3*ut<2?ot+(at-ot)*(2/3-ut)*6:ot}try{py.parseCSSColor=function(ot){var at,ut=ot.replace(/ /g,"").toLowerCase();if(ut in b)return b[ut].slice();if(ut[0]==="#")return ut.length===4?(at=parseInt(ut.substr(1),16))>=0&&at<=4095?[(3840&at)>>4|(3840&at)>>8,240&at|(240&at)>>4,15&at|(15&at)<<4,1]:null:ut.length===7&&(at=parseInt(ut.substr(1),16))>=0&&at<=16777215?[(16711680&at)>>16,(65280&at)>>8,255&at,1]:null;var ft=ut.indexOf("("),xt=ut.indexOf(")");if(ft!==-1&&xt+1===ut.length){var Ct=ut.substr(0,ft),Rt=ut.substr(ft+1,xt-(ft+1)).split(","),kt=1;switch(Ct){case"rgba":if(Rt.length!==4)return null;kt=_e(Rt.pop());case"rgb":return Rt.length!==3?null:[g(Rt[0]),g(Rt[1]),g(Rt[2]),kt];case"hsla":if(Rt.length!==4)return null;kt=_e(Rt.pop());case"hsl":if(Rt.length!==3)return null;var zt=(parseFloat(Rt[0])%360+360)%360/360,Ut=_e(Rt[1]),Kt=_e(Rt[2]),er=Kt<=.5?Kt*(Ut+1):Kt+Ut-Kt*Ut,Jt=2*Kt-er;return[o(255*rt(Jt,er,zt+1/3)),o(255*rt(Jt,er,zt)),o(255*rt(Jt,er,zt-1/3)),kt];default:return null}}return null}}catch{}return py}();class Ro{constructor(o,g,_e,rt=1){this.r=o,this.g=g,this.b=_e,this.a=rt}static parse(o){if(!o)return;if(o instanceof Ro)return o;if(typeof o!="string")return;const g=hp.parseCSSColor(o);return g?new Ro(g[0]/255,g[1]/255,g[2]/255,g[3]):void 0}toString(){const[o,g,_e,rt]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*o)},${Math.round(255*g)},${Math.round(255*_e)},${rt})`}toNonPremultipliedRenderColor(o){const{r:g,g:_e,b:rt,a:ot}=this;return new nw(o,g,_e,rt,ot)}toPremultipliedRenderColor(o){const{r:g,g:_e,b:rt,a:ot}=this;return new iw(o,g*ot,_e*ot,rt*ot,ot)}clone(){return new Ro(this.r,this.g,this.b,this.a)}}class rw{constructor(o,g,_e,rt,ot,at=!1){if(this.premultiplied=!1,this.premultiplied=at,o){const ut=o.image.height,ft=ut*ut;this.premultiplied?(g=ot===0?0:g/ot*(ut-1),_e=ot===0?0:_e/ot*(ut-1),rt=ot===0?0:rt/ot*(ut-1)):(g*=ut-1,_e*=ut-1,rt*=ut-1);const xt=Math.floor(g),Ct=Math.floor(_e),Rt=Math.floor(rt),kt=Math.ceil(g),zt=Math.ceil(_e),Ut=Math.ceil(rt),Kt=g-xt,er=_e-Ct,Jt=rt-Rt,or=o.image.data,cr=4*(xt+Ct*ft+Rt*ut),pr=4*(xt+Ct*ft+Ut*ut),Sr=4*(xt+zt*ft+Rt*ut),br=4*(xt+zt*ft+Ut*ut),Pr=4*(kt+Ct*ft+Rt*ut),Dr=4*(kt+Ct*ft+Ut*ut),Or=4*(kt+zt*ft+Rt*ut),nn=4*(kt+zt*ft+Ut*ut);if(cr<0||nn>=or.length)throw new Error("out of range");this.r=Cs(Cs(Cs(or[cr],or[pr],Jt),Cs(or[Sr],or[br],Jt),er),Cs(Cs(or[Pr],or[Dr],Jt),Cs(or[Or],or[nn],Jt),er),Kt)/255*(this.premultiplied?ot:1),this.g=Cs(Cs(Cs(or[cr+1],or[pr+1],Jt),Cs(or[Sr+1],or[br+1],Jt),er),Cs(Cs(or[Pr+1],or[Dr+1],Jt),Cs(or[Or+1],or[nn+1],Jt),er),Kt)/255*(this.premultiplied?ot:1),this.b=Cs(Cs(Cs(or[cr+2],or[pr+2],Jt),Cs(or[Sr+2],or[br+2],Jt),er),Cs(Cs(or[Pr+2],or[Dr+2],Jt),Cs(or[Or+2],or[nn+2],Jt),er),Kt)/255*(this.premultiplied?ot:1),this.a=ot}else this.r=g,this.g=_e,this.b=rt,this.a=ot}toArray(){const{r:o,g,b:_e,a:rt}=this;return[255*o,255*g,255*_e,rt]}toHslaArray(){let{r:o,g,b:_e,a:rt}=this;if(this.premultiplied){if(rt===0)return[0,0,0,0];const Ut=1/rt;o*=Ut,g*=Ut,_e*=Ut}const ot=Math.min(Math.max(o,0),1),at=Math.min(Math.max(g,0),1),ut=Math.min(Math.max(_e,0),1),ft=Math.min(ot,at,ut),xt=Math.max(ot,at,ut),Ct=xt-ft,Rt=.5*(ft+xt);if(Ct===0)return[0,0,100*Rt,rt];const kt=Rt>.5?Ct/(2-xt-ft):Ct/(xt+ft);let zt;switch(xt){case ot:zt=60*((at-ut)/Ct+(at<ut?6:0));break;case at:zt=60*((ut-ot)/Ct+2);break;default:zt=60*((ot-at)/Ct+4)}return[zt,100*kt,100*Rt,rt]}toArray01(){const{r:o,g,b:_e,a:rt}=this;return[o,g,_e,rt]}toArray01Scaled(o){const{r:g,g:_e,b:rt}=this;return[g*o,_e*o,rt*o]}toArray01Linear(){const{r:o,g,b:_e,a:rt}=this;return[Math.pow(o,2.2),Math.pow(g,2.2),Math.pow(_e,2.2),rt]}}class nw extends rw{constructor(o,g,_e,rt,ot){super(o,g,_e,rt,ot,!1)}}class iw extends rw{constructor(o,g,_e,rt,ot){super(o,g,_e,rt,ot,!0)}}function Cs(b,o,g){return b*(1-g)+o*g}function ov(b,o,g){return b.map((_e,rt)=>Cs(_e,o[rt],g))}Ro.black=new Ro(0,0,0,1),Ro.white=new Ro(1,1,1,1),Ro.transparent=new Ro(0,0,0,0),Ro.red=new Ro(1,0,0,1),Ro.blue=new Ro(0,0,1,1);var fy=Object.freeze({__proto__:null,array:ov,color:function(b,o,g){return new Ro(Cs(b.r,o.r,g),Cs(b.g,o.g,g),Cs(b.b,o.b,g),Cs(b.a,o.a,g))},number:Cs});class dp extends Error{constructor(o,g){super(g),this.message=g,this.key=o}}class b0{constructor(o,g=[]){this.parent=o,this.bindings={};for(const[_e,rt]of g)this.bindings[_e]=rt}concat(o){return new b0(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const Tp={kind:"null"},us={kind:"number"},ao={kind:"string"},Mo={kind:"boolean"},Gu={kind:"color"},Op={kind:"object"},Ao={kind:"value"},xx={kind:"collator"},my={kind:"formatted"},gy={kind:"resolvedImage"};function Au(b,o){return{kind:"array",itemType:b,N:o}}function Zl(b){if(b.kind==="array"){const o=Zl(b.itemType);return typeof b.N=="number"?`array<${o}, ${b.N}>`:b.itemType.kind==="value"?"array":`array<${o}>`}return b.kind}const QE=[Tp,us,ao,Mo,Gu,my,Op,Au(Ao),gy];function Sm(b,o){if(o.kind==="error")return null;if(b.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Sm(b.itemType,o.itemType))&&(typeof b.N!="number"||b.N===o.N))return null}else{if(b.kind===o.kind)return null;if(b.kind==="value"){for(const g of QE)if(!Sm(g,o))return null}}return`Expected ${Zl(b)} but found ${Zl(o)} instead.`}function av(b,o){return o.some(g=>g.kind===b.kind)}function yy(b,o){return o.some(g=>g==="null"?b===null:g==="array"?Array.isArray(b):g==="object"?b&&!Array.isArray(b)&&typeof b=="object":g===typeof b)}function _x(b,o){return b.kind==="array"&&o.kind==="array"?b.N===o.N&&_x(b.itemType,o.itemType):b.kind===o.kind}class lv{constructor(o,g,_e){this.sensitivity=o?g?"variant":"case":g?"accent":"base",this.locale=_e,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,g){return this.collator.compare(o,g)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class vx{constructor(o,g,_e,rt,ot){this.text=o.normalize?o.normalize():o,this.image=g,this.scale=_e,this.fontStack=rt,this.textColor=ot}}class Lu{constructor(o){this.sections=o}static fromString(o){return new Lu([new vx(o,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||!!o.image&&o.image.hasPrimary())}static factory(o){return o instanceof Lu?o:Lu.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const g of this.sections){if(g.image){const rt=g.image.getPrimary().id.toString();o.push(["image",rt]);continue}o.push(g.text);const _e={};g.fontStack&&(_e["text-font"]=["literal",g.fontStack.split(",")]),g.scale&&(_e["font-scale"]=g.scale),g.textColor&&(_e["text-color"]=["rgba"].concat(g.textColor.toNonPremultipliedRenderColor(null).toArray())),o.push(_e)}return o}}class Yp{constructor(o,g={}){this.id=Nu.from(o),this.params=g.params,this.sx=g.sx||1,this.sy=g.sy||1}toString(){return JSON.stringify(this)}static parse(o){let g,_e,rt,ot;try{({id:g,params:_e,sx:rt,sy:ot}=JSON.parse(o)||{})}catch{return null}return g?new Yp(g,{params:_e,sx:rt,sy:ot}):null}scaleSelf(o,g=o){return this.sx*=o,this.sy*=g,this}}class ju{constructor(o,g,_e,rt,ot=!1){this.primaryId=Nu.from(o),this.primaryOptions=g,_e&&(this.secondaryId=Nu.from(_e)),this.secondaryOptions=rt,this.available=ot}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Yp(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Yp(this.secondaryId,this.secondaryOptions):null}static from(o){return typeof o=="string"?ju.build({name:o}):o}static build(o,g,_e,rt){return!o||typeof o=="object"&&!("name"in o)?null:new ju(o,_e,g,rt)}}function _g(b,o,g,_e){return typeof b=="number"&&b>=0&&b<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof g=="number"&&g>=0&&g<=255?_e===void 0||typeof _e=="number"&&_e>=0&&_e<=1?null:`Invalid rgba value [${[b,o,g,_e].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof _e=="number"?[b,o,g,_e]:[b,o,g]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function w0(b){if(b===null||typeof b=="string"||typeof b=="boolean"||typeof b=="number"||b instanceof Ro||b instanceof lv||b instanceof Lu||b instanceof ju)return!0;if(Array.isArray(b)){for(const o of b)if(!w0(o))return!1;return!0}if(typeof b=="object"){for(const o in b)if(!w0(b[o]))return!1;return!0}return!1}function du(b){if(b===null)return Tp;if(typeof b=="string")return ao;if(typeof b=="boolean")return Mo;if(typeof b=="number")return us;if(b instanceof Ro)return Gu;if(b instanceof lv)return xx;if(b instanceof Lu)return my;if(b instanceof ju)return gy;if(Array.isArray(b)){const o=b.length;let g;for(const _e of b){const rt=du(_e);if(g){if(g===rt)continue;g=Ao;break}g=rt}return Au(g||Ao,o)}return Op}function pp(b){const o=typeof b;return b===null?"":o==="string"||o==="number"||o==="boolean"?String(b):b instanceof Lu||b instanceof ju||b instanceof Ro?b.toString():JSON.stringify(b)}class Qp{constructor(o,g){this.type=o,this.value=g}static parse(o,g){if(o.length!==2)return g.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!w0(o[1]))return g.error("invalid value");const _e=o[1];let rt=du(_e);const ot=g.expectedType;return rt.kind!=="array"||rt.N!==0||!ot||ot.kind!=="array"||typeof ot.N=="number"&&ot.N!==0||(rt=ot),new Qp(rt,_e)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ro?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Lu?this.value.serialize():this.value}}class ou{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const cv={string:ao,number:us,boolean:Mo,object:Op};class Sp{constructor(o,g){this.type=o,this.args=g}static parse(o,g){if(o.length<2)return g.error("Expected at least one argument.");let _e,rt=1;const ot=o[0];if(ot==="array"){let ut,ft;if(o.length>2){const xt=o[1];if(typeof xt!="string"||!(xt in cv)||xt==="object")return g.error('The item type argument of "array" must be one of string, number, boolean',1);ut=cv[xt],rt++}else ut=Ao;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return g.error('The length argument to "array" must be a positive integer literal',2);ft=o[2],rt++}_e=Au(ut,ft)}else _e=cv[ot];const at=[];for(;rt<o.length;rt++){const ut=g.parse(o[rt],rt,Ao);if(!ut)return null;at.push(ut)}return new Sp(_e,at)}evaluate(o){for(let g=0;g<this.args.length;g++){const _e=this.args[g].evaluate(o);if(!Sm(this.type,du(_e)))return _e;if(g===this.args.length-1)throw new ou(`The expression ${JSON.stringify(this.args[g].serialize())} evaluated to ${Zl(du(_e))} but was expected to be of type ${Zl(this.type)}.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,g=[o.kind];if(o.kind==="array"){const _e=o.itemType;if(_e.kind==="string"||_e.kind==="number"||_e.kind==="boolean"){g.push(_e.kind);const rt=o.N;(typeof rt=="number"||this.args.length>1)&&g.push(rt)}}return g.concat(this.args.map(_e=>_e.serialize()))}}class Fp{constructor(o){this.type=my,this.sections=o}static parse(o,g){if(o.length<2)return g.error("Expected at least one argument.");const _e=o[1];if(!Array.isArray(_e)&&typeof _e=="object")return g.error("First argument must be an image or text section.");const rt=[];let ot=!1;for(let at=1;at<=o.length-1;++at){const ut=o[at];if(ot&&typeof ut=="object"&&!Array.isArray(ut)){ot=!1;let ft=null;if(ut["font-scale"]&&(ft=g.parseObjectValue(ut["font-scale"],at,"font-scale",us),!ft))return null;let xt=null;if(ut["text-font"]&&(xt=g.parseObjectValue(ut["text-font"],at,"text-font",Au(ao)),!xt))return null;let Ct=null;if(ut["text-color"]&&(Ct=g.parseObjectValue(ut["text-color"],at,"text-color",Gu),!Ct))return null;const Rt=rt[rt.length-1];Rt.scale=ft,Rt.font=xt,Rt.textColor=Ct}else{const ft=g.parse(o[at],at,Ao);if(!ft)return null;const xt=ft.type.kind;if(xt!=="string"&&xt!=="value"&&xt!=="null"&&xt!=="resolvedImage")return g.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");ot=!0,rt.push({content:ft,scale:null,font:null,textColor:null})}}return new Fp(rt)}evaluate(o){return new Lu(this.sections.map(g=>{const _e=g.content.evaluate(o);return _x(du(_e),gy)?new vx("",_e,null,null,null):new vx(pp(_e),null,g.scale?g.scale.evaluate(o):null,g.font?g.font.evaluate(o).join(","):null,g.textColor?g.textColor.evaluate(o):null)}))}eachChild(o){for(const g of this.sections)o(g.content),g.scale&&o(g.scale),g.font&&o(g.font),g.textColor&&o(g.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const g of this.sections){o.push(g.content.serialize());const _e={};g.scale&&(_e["font-scale"]=g.scale.serialize()),g.font&&(_e["text-font"]=g.font.serialize()),g.textColor&&(_e["text-color"]=g.textColor.serialize()),o.push(_e)}return o}}class Bs{constructor(o,g,_e,rt){this._imageWarnHistory={},this.type=gy,this.namePrimary=o,this.nameSecondary=g,_e&&(this.paramsPrimary=_e.params,this.iconsetIdPrimary=_e.iconset?_e.iconset.id:void 0),rt&&(this.paramsSecondary=rt.params,this.iconsetIdSecondary=rt.iconset?rt.iconset.id:void 0)}static parse(o,g){if(o.length<2)return g.error("Expected two or more arguments.");let _e=1;const rt=[];function ot(){if(_e<o.length){const ut=g.parse(o[_e],_e++,ao);return ut?(rt.push({image:ut,options:{}}),!0):(g.error(rt.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function at(){if(_e<o.length){const ft=o[_e];if((ut=ft)===null||typeof ut!="object"||Array.isArray(ut))return!0;const xt=ft.params,Ct=ft.iconset,Rt=g.concat(_e);if(!xt&&!Ct)return _e++,!0;if(xt){if(typeof xt!="object"||xt.constructor!==Object)return Rt.error('Image options "params" should be an object'),!1;const kt={},zt=Rt.concat(void 0,"params");for(const Ut in xt){if(!Ut)return zt.error("Image parameter name should be non-empty"),!1;const Kt=zt.concat(void 0,Ut).parse(xt[Ut],void 0,Gu,void 0,{typeAnnotation:"coerce"});if(!Kt)return!1;kt[Ut]=Kt}rt[rt.length-1].options.params=kt}if(Ct){if(typeof Ct!="object"||Ct.constructor!==Object)return Rt.error('Image options "iconset" should be an object'),!1;if(!Ct.id)return Rt.error('Image options "iconset" should have an "id" property'),!1;rt[rt.length-1].options.iconset=Ct}return _e++,!0}var ut;return!0}for(let ut=0;ut<2;ut++)if(!ot()||!at())return;return new Bs(rt[0].image,rt[1]?rt[1].image:void 0,rt[0].options,rt[1]?rt[1].options:void 0)}evaluateParams(o,g){const _e={};if(g){for(const rt in g)if(g[rt])try{_e[rt]=g[rt].evaluate(o)}catch{continue}if(Object.keys(_e).length!==0)return{params:_e}}}evaluate(o){const g={name:this.namePrimary.evaluate(o),iconsetId:this.iconsetIdPrimary},_e=this.nameSecondary?{name:this.nameSecondary.evaluate(o),iconsetId:this.iconsetIdSecondary}:void 0,rt=ju.build(g,_e,this.paramsPrimary?this.evaluateParams(o,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(o,this.paramsSecondary):void 0);if(rt&&o.availableImages){const ot=rt.getPrimary().id;if(rt.available=o.availableImages.some(at=>Nu.isEqual(at,ot)),rt.available){const at=rt.getSecondary()?rt.getSecondary().id:null;at&&(rt.available=o.availableImages.some(ut=>Nu.isEqual(ut,at)))}}return rt}eachChild(o){if(o(this.namePrimary),this.paramsPrimary)for(const g in this.paramsPrimary)this.paramsPrimary[g]&&o(this.paramsPrimary[g]);if(this.nameSecondary&&(o(this.nameSecondary),this.paramsSecondary))for(const g in this.paramsSecondary)this.paramsSecondary[g]&&o(this.paramsSecondary[g])}outputDefined(){return!1}serializeOptions(o,g){const _e={};if(g&&(_e.iconset={id:g}),o){_e.params={};for(const rt in o)o[rt]&&(_e.params[rt]=o[rt].serialize())}return Object.keys(_e).length>0?_e:void 0}serialize(){const o=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const g=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);g&&o.push(g)}if(this.nameSecondary&&(o.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const g=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);g&&o.push(g)}return o}}function as(b){return Ps(b)?"string":E0(b)?"number":wx(b)?"boolean":Array.isArray(b)?"array":b===null?"null":bx(b)?"object":typeof b}function bx(b){return b!=null&&!Array.isArray(b)&&typeof b!="function"&&!(b instanceof String||b instanceof Number||b instanceof Boolean)&&typeof b=="object"}function Ps(b){return typeof b=="string"||b instanceof String}function E0(b){return typeof b=="number"||b instanceof Number}function wx(b){return typeof b=="boolean"||b instanceof Boolean}const Rs={"to-boolean":Mo,"to-color":Gu,"to-number":us,"to-string":ao};class Bp{constructor(o,g){this.type=o,this.args=g}static parse(o,g){if(o.length<2)return g.error("Expected at least one argument.");const _e=o[0],rt=[];let ot=Tp;if(_e==="to-array"){if(!Array.isArray(o[1]))return null;const at=o[1].length;if(g.expectedType){if(g.expectedType.kind!=="array")return g.error(`Expected ${g.expectedType.kind} but found array.`);ot=Au(g.expectedType.itemType,at)}else{if(!(at>0&&w0(o[1][0])))return null;ot=Au(du(o[1][0]),at)}for(let ut=0;ut<at;ut++){const ft=o[1][ut];let xt;if(Array.isArray(ft))xt=g.parse(ft,void 0,ot.itemType);else{const Ct=as(ft);if(Ct!==ot.itemType.kind)return g.error(`Expected ${ot.itemType.kind} but found ${Ct}.`);xt=g.registry.literal.parse(["literal",ft===void 0?null:ft],g)}if(!xt)return null;rt.push(xt)}}else{if((_e==="to-boolean"||_e==="to-string")&&o.length!==2)return g.error("Expected one argument.");ot=Rs[_e];for(let at=1;at<o.length;at++){const ut=g.parse(o[at],at,Ao);if(!ut)return null;rt.push(ut)}}return new Bp(ot,rt)}evaluate(o){if(this.type.kind==="boolean")return!!this.args[0].evaluate(o);if(this.type.kind==="color"){let g,_e;for(const rt of this.args){if(g=rt.evaluate(o),_e=null,g instanceof Ro)return g;if(typeof g=="string"){const ot=o.parseColor(g);if(ot)return ot}else if(Array.isArray(g)&&(_e=g.length<3||g.length>4?`Invalid rbga value ${JSON.stringify(g)}: expected an array containing either three or four numeric values.`:_g(g[0],g[1],g[2],g[3]),!_e))return new Ro(g[0]/255,g[1]/255,g[2]/255,g[3])}throw new ou(_e||`Could not parse color from value '${typeof g=="string"?g:String(JSON.stringify(g))}'`)}if(this.type.kind==="number"){let g=null;for(const _e of this.args){if(g=_e.evaluate(o),g===null)return 0;const rt=Number(g);if(!isNaN(rt))return rt}throw new ou(`Could not convert ${JSON.stringify(g)} to number.`)}return this.type.kind==="formatted"?Lu.fromString(pp(this.args[0].evaluate(o))):this.type.kind==="resolvedImage"?ju.build(pp(this.args[0].evaluate(o))):this.type.kind==="array"?this.args.map(g=>g.evaluate(o)):pp(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Fp([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Bs(this.args[0]).serialize();const o=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(g=>{o.push(g.serialize())}),o}}const uv=["Unknown","Point","LineString","Polygon"];class Ex{constructor(o,g,_e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=o,this.options=g,this.iconImageUseTheme=_e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?uv[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(o){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,g=this.featureDistanceData.scale,{x:_e,y:rt}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(_e*g-o[0])+this.featureDistanceData.bearing[1]*(rt*g-o[1])}return 0}parseColor(o){let g=this._parseColorCache[o];return g||(g=this._parseColorCache[o]=Ro.parse(o)),g}getConfig(o){return this.options?this.options.get(o):null}}class Ou{constructor(o,g,_e,rt,ot){this.name=o,this.type=g,this._evaluate=_e,this.args=rt,this._overloadIndex=ot}evaluate(o){if(!this._evaluate){const g=Ou.definitions[this.name];this._evaluate=Array.isArray(g)?g[2]:g.overloads[this._overloadIndex][1]}return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,g){const _e=o[0],rt=Ou.definitions[_e];if(!rt)return g.error(`Unknown expression "${_e}". If you wanted a literal array, use ["literal", [...]].`,0);const ot=Array.isArray(rt)?rt[0]:rt.type,at=Array.isArray(rt)?[[rt[1],rt[2]]]:rt.overloads,ut=[];let ft=null,xt=-1;for(const[Ct,Rt]of at){if(Array.isArray(Ct)&&Ct.length!==o.length-1)continue;ut.push(Ct),xt++,ft=new Lx(g.registry,g.path,null,g.scope,void 0,g._scope,g.options,g.iconImageUseTheme);const kt=[];let zt=!1;for(let Ut=1;Ut<o.length;Ut++){const Kt=o[Ut],er=Array.isArray(Ct)?Ct[Ut-1]:Ct.type,Jt=ft.parse(Kt,1+kt.length,er);if(!Jt){zt=!0;break}kt.push(Jt)}if(!zt)if(Array.isArray(Ct)&&Ct.length!==kt.length)ft.error(`Expected ${Ct.length} arguments, but found ${kt.length} instead.`);else{for(let Ut=0;Ut<kt.length;Ut++){const Kt=Array.isArray(Ct)?Ct[Ut]:Ct.type,er=kt[Ut];ft.concat(Ut+1).checkSubtype(Kt,er.type)}if(ft.errors.length===0)return new Ou(_e,ot,Rt,kt,xt)}}if(ut.length===1)g.errors.push(...ft.errors);else{const Ct=(ut.length?ut:at.map(([kt])=>kt)).map(Tx).join(" | "),Rt=[];for(let kt=1;kt<o.length;kt++){const zt=g.parse(o[kt],1+Rt.length);if(!zt)return null;Rt.push(Zl(zt.type))}g.error(`Expected arguments of type ${Ct}, but found (${Rt.join(", ")}) instead.`)}return null}static register(o,g){Ou.definitions=g;for(const _e in g)o[_e]=Ou}}function Tx(b){return Array.isArray(b)?`(${b.map(Zl).join(", ")})`:`(${Zl(b.type)}...)`}class gu{constructor(o,g,_e){this.type=xx,this.locale=_e,this.caseSensitive=o,this.diacriticSensitive=g}static parse(o,g){if(o.length!==2)return g.error("Expected one argument.");const _e=o[1];if(typeof _e!="object"||Array.isArray(_e))return g.error("Collator options argument must be an object.");const rt=_e["case-sensitive"]===void 0?g.parse(!1,1,Mo):g.parseObjectValue(_e["case-sensitive"],1,"case-sensitive",Mo);if(!rt)return null;const ot=_e["diacritic-sensitive"]===void 0?g.parse(!1,1,Mo):g.parseObjectValue(_e["diacritic-sensitive"],1,"diacritic-sensitive",Mo);if(!ot)return null;let at=null;return _e.locale&&(at=g.parseObjectValue(_e.locale,1,"locale",ao),!at)?null:new gu(rt,ot,at)}evaluate(o){return new lv(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}function Sx(b,o,g=0,_e=b.length-1,rt=hv){for(;_e>g;){if(_e-g>600){const ft=_e-g+1,xt=o-g+1,Ct=Math.log(ft),Rt=.5*Math.exp(2*Ct/3),kt=.5*Math.sqrt(Ct*Rt*(ft-Rt)/ft)*(xt-ft/2<0?-1:1);Sx(b,o,Math.max(g,Math.floor(o-xt*Rt/ft+kt)),Math.min(_e,Math.floor(o+(ft-xt)*Rt/ft+kt)),rt)}const ot=b[o];let at=g,ut=_e;for(Cp(b,g,o),rt(b[_e],ot)>0&&Cp(b,g,_e);at<ut;){for(Cp(b,at,ut),at++,ut--;rt(b[at],ot)<0;)at++;for(;rt(b[ut],ot)>0;)ut--}rt(b[g],ot)===0?Cp(b,g,ut):(ut++,Cp(b,ut,_e)),ut<=o&&(g=ut+1),o<=ut&&(_e=ut-1)}}function Cp(b,o,g){const _e=b[o];b[o]=b[g],b[g]=_e}function hv(b,o){return b<o?-1:b>o?1:0}function Cm(b){let o=0;for(let g,_e,rt=0,ot=b.length,at=ot-1;rt<ot;at=rt++)g=b[rt],_e=b[at],o+=(_e.x-g.x)*(g.y+_e.y);return o}function fp(b,o){b[0]=Math.min(b[0],o[0]),b[1]=Math.min(b[1],o[1]),b[2]=Math.max(b[2],o[0]),b[3]=Math.max(b[3],o[1])}function xy(b,o){return!(b[0]<=o[0]||b[2]>=o[2]||b[1]<=o[1]||b[3]>=o[3])}function JE(b,o,g){const _e=b[0]-o[0],rt=b[1]-o[1],ot=b[0]-g[0],at=b[1]-g[1];return _e*at-ot*rt==0&&_e*ot<=0&&rt*at<=0}function T0(b,o,g=!1){let _e=!1;for(let ut=0,ft=o.length;ut<ft;ut++){const xt=o[ut];for(let Ct=0,Rt=xt.length,kt=Rt-1;Ct<Rt;kt=Ct++){const zt=xt[kt],Ut=xt[Ct];if(JE(b,zt,Ut))return g;(ot=zt)[1]>(rt=b)[1]!=(at=Ut)[1]>rt[1]&&rt[0]<(at[0]-ot[0])*(rt[1]-ot[1])/(at[1]-ot[1])+ot[0]&&(_e=!_e)}}var rt,ot,at;return _e}function _y(b,o,g,_e){const rt=_e[0]-g[0],ot=_e[1]-g[1],at=(b[0]-g[0])*ot-rt*(b[1]-g[1]),ut=(o[0]-g[0])*ot-rt*(o[1]-g[1]);return at>0&&ut<0||at<0&&ut>0}function vy(b,o,g,_e){return(rt=[_e[0]-g[0],_e[1]-g[1]])[0]*(ot=[o[0]-b[0],o[1]-b[1]])[1]-rt[1]*ot[0]!=0&&!(!_y(b,o,g,_e)||!_y(g,_e,b,o));var rt,ot}function Jp(b){const o=new _n(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),g=new _n(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const _e of b[0])o.x>_e.x&&(o.x=_e.x),o.y>_e.y&&(o.y=_e.y),g.x<_e.x&&(g.x=_e.x),g.y<_e.y&&(g.y=_e.y);return{min:o,max:g}}const Am=8192;function eT(b,o){const g=(180+b[0])/360,_e=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+b[1]*Math.PI/360)))/360,rt=Math.pow(2,o.z);return[Math.round(g*rt*Am),Math.round(_e*rt*Am)]}function dv(b,o){for(let g=0;g<o.length;g++)if(T0(b,o[g]))return!0;return!1}function tT(b,o,g){for(const _e of g)for(let rt=0,ot=_e.length,at=ot-1;rt<ot;at=rt++)if(vy(b,o,_e[at],_e[rt]))return!0;return!1}function sw(b,o){for(let g=0;g<b.length;++g)if(!T0(b[g],o))return!1;for(let g=0;g<b.length-1;++g)if(tT(b[g],b[g+1],o))return!1;return!0}function ow(b,o){for(let g=0;g<o.length;g++)if(sw(b,o[g]))return!0;return!1}function pv(b,o,g){const _e=[];for(let rt=0;rt<b.length;rt++){const ot=[];for(let at=0;at<b[rt].length;at++){const ut=eT(b[rt][at],g);fp(o,ut),ot.push(ut)}_e.push(ot)}return _e}function Rm(b,o,g){const _e=[];for(let rt=0;rt<b.length;rt++){const ot=pv(b[rt],o,g);_e.push(ot)}return _e}function aw(b,o,g,_e){if(b[0]<g[0]||b[0]>g[2]){const rt=.5*_e;let ot=b[0]-g[0]>rt?-_e:g[0]-b[0]>rt?_e:0;ot===0&&(ot=b[0]-g[2]>rt?-_e:g[2]-b[0]>rt?_e:0),b[0]+=ot}fp(o,b)}function lw(b,o,g,_e){const rt=Math.pow(2,_e.z)*Am,ot=[_e.x*Am,_e.y*Am],at=[];if(!b)return at;for(const ut of b)for(const ft of ut){const xt=[ft.x+ot[0],ft.y+ot[1]];aw(xt,o,g,rt),at.push(xt)}return at}function Cx(b,o,g,_e){const rt=Math.pow(2,_e.z)*Am,ot=[_e.x*Am,_e.y*Am],at=[];if(!b)return at;for(const ft of b){const xt=[];for(const Ct of ft){const Rt=[Ct.x+ot[0],Ct.y+ot[1]];fp(o,Rt),xt.push(Rt)}at.push(xt)}if(o[2]-o[0]<=rt/2){(ut=o)[0]=ut[1]=1/0,ut[2]=ut[3]=-1/0;for(const ft of at)for(const xt of ft)aw(xt,o,g,rt)}var ut;return at}class Pm{constructor(o,g){this.type=Mo,this.geojson=o,this.geometries=g}static parse(o,g){if(o.length!==2)return g.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(w0(o[1])){const _e=o[1];if(_e.type==="FeatureCollection")for(let rt=0;rt<_e.features.length;++rt){const ot=_e.features[rt].geometry.type;if(ot==="Polygon"||ot==="MultiPolygon")return new Pm(_e,_e.features[rt].geometry)}else if(_e.type==="Feature"){const rt=_e.geometry.type;if(rt==="Polygon"||rt==="MultiPolygon")return new Pm(_e,_e.geometry)}else if(_e.type==="Polygon"||_e.type==="MultiPolygon")return new Pm(_e,_e)}return g.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(g,_e){const rt=[1/0,1/0,-1/0,-1/0],ot=[1/0,1/0,-1/0,-1/0],at=g.canonicalID();if(!at)return!1;if(_e.type==="Polygon"){const ut=pv(_e.coordinates,ot,at),ft=lw(g.geometry(),rt,ot,at);if(!xy(rt,ot))return!1;for(const xt of ft)if(!T0(xt,ut))return!1}if(_e.type==="MultiPolygon"){const ut=Rm(_e.coordinates,ot,at),ft=lw(g.geometry(),rt,ot,at);if(!xy(rt,ot))return!1;for(const xt of ft)if(!dv(xt,ut))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(g,_e){const rt=[1/0,1/0,-1/0,-1/0],ot=[1/0,1/0,-1/0,-1/0],at=g.canonicalID();if(!at)return!1;if(_e.type==="Polygon"){const ut=pv(_e.coordinates,ot,at),ft=Cx(g.geometry(),rt,ot,at);if(!xy(rt,ot))return!1;for(const xt of ft)if(!sw(xt,ut))return!1}if(_e.type==="MultiPolygon"){const ut=Rm(_e.coordinates,ot,at),ft=Cx(g.geometry(),rt,ot,at);if(!xy(rt,ot))return!1;for(const xt of ft)if(!ow(xt,ut))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const by={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},mp=1/298.257223563,cw=mp*(2-mp),S0=Math.PI/180;class C0{static fromTile(o,g,_e){const rt=Math.PI*(1-2*(o+.5)/Math.pow(2,g)),ot=Math.atan(.5*(Math.exp(rt)-Math.exp(-rt)))/S0;return new C0(ot,_e)}static get units(){return by}constructor(o,g){if(o===void 0)throw new Error("No latitude given.");if(g&&!by[g])throw new Error(`Unknown unit ${g}. Use one of: ${Object.keys(by).join(", ")}`);const _e=6378.137*S0*(g?by[g]:1),rt=Math.cos(o*S0),ot=1/(1-cw*(1-rt*rt)),at=Math.sqrt(ot);this.kx=_e*at*rt,this.ky=_e*at*ot*(1-cw)}distance(o,g){const _e=_d(o[0]-g[0])*this.kx,rt=(o[1]-g[1])*this.ky;return Math.sqrt(_e*_e+rt*rt)}bearing(o,g){const _e=_d(g[0]-o[0])*this.kx;return Math.atan2(_e,(g[1]-o[1])*this.ky)/S0}destination(o,g,_e){const rt=_e*S0;return this.offset(o,Math.sin(rt)*g,Math.cos(rt)*g)}offset(o,g,_e){return[o[0]+g/this.kx,o[1]+_e/this.ky]}lineDistance(o){let g=0;for(let _e=0;_e<o.length-1;_e++)g+=this.distance(o[_e],o[_e+1]);return g}area(o){let g=0;for(let _e=0;_e<o.length;_e++){const rt=o[_e];for(let ot=0,at=rt.length,ut=at-1;ot<at;ut=ot++)g+=_d(rt[ot][0]-rt[ut][0])*(rt[ot][1]+rt[ut][1])*(_e?-1:1)}return Math.abs(g)/2*this.kx*this.ky}along(o,g){let _e=0;if(g<=0)return o[0];for(let rt=0;rt<o.length-1;rt++){const ot=o[rt],at=o[rt+1],ut=this.distance(ot,at);if(_e+=ut,_e>g)return Ax(ot,at,(g-(_e-ut))/ut)}return o[o.length-1]}pointToSegmentDistance(o,g,_e){let[rt,ot]=g,at=_d(_e[0]-rt)*this.kx,ut=(_e[1]-ot)*this.ky;if(at!==0||ut!==0){const ft=(_d(o[0]-rt)*this.kx*at+(o[1]-ot)*this.ky*ut)/(at*at+ut*ut);ft>1?(rt=_e[0],ot=_e[1]):ft>0&&(rt+=at/this.kx*ft,ot+=ut/this.ky*ft)}return at=_d(o[0]-rt)*this.kx,ut=(o[1]-ot)*this.ky,Math.sqrt(at*at+ut*ut)}pointOnLine(o,g){let _e=1/0,rt=o[0][0],ot=o[0][1],at=0,ut=0;for(let ft=0;ft<o.length-1;ft++){let xt=o[ft][0],Ct=o[ft][1],Rt=_d(o[ft+1][0]-xt)*this.kx,kt=(o[ft+1][1]-Ct)*this.ky,zt=0;Rt===0&&kt===0||(zt=(_d(g[0]-xt)*this.kx*Rt+(g[1]-Ct)*this.ky*kt)/(Rt*Rt+kt*kt),zt>1?(xt=o[ft+1][0],Ct=o[ft+1][1]):zt>0&&(xt+=Rt/this.kx*zt,Ct+=kt/this.ky*zt)),Rt=_d(g[0]-xt)*this.kx,kt=(g[1]-Ct)*this.ky;const Ut=Rt*Rt+kt*kt;Ut<_e&&(_e=Ut,rt=xt,ot=Ct,at=ft,ut=zt)}return{point:[rt,ot],index:at,t:Math.max(0,Math.min(1,ut))}}lineSlice(o,g,_e){let rt=this.pointOnLine(_e,o),ot=this.pointOnLine(_e,g);if(rt.index>ot.index||rt.index===ot.index&&rt.t>ot.t){const xt=rt;rt=ot,ot=xt}const at=[rt.point],ut=rt.index+1,ft=ot.index;!fv(_e[ut],at[0])&&ut<=ft&&at.push(_e[ut]);for(let xt=ut+1;xt<=ft;xt++)at.push(_e[xt]);return fv(_e[ft],ot.point)||at.push(ot.point),at}lineSliceAlong(o,g,_e){let rt=0;const ot=[];for(let at=0;at<_e.length-1;at++){const ut=_e[at],ft=_e[at+1],xt=this.distance(ut,ft);if(rt+=xt,rt>o&&ot.length===0&&ot.push(Ax(ut,ft,(o-(rt-xt))/xt)),rt>=g)return ot.push(Ax(ut,ft,(g-(rt-xt))/xt)),ot;rt>o&&ot.push(ft)}return ot}bufferPoint(o,g){const _e=g/this.ky,rt=g/this.kx;return[o[0]-rt,o[1]-_e,o[0]+rt,o[1]+_e]}bufferBBox(o,g){const _e=g/this.ky,rt=g/this.kx;return[o[0]-rt,o[1]-_e,o[2]+rt,o[3]+_e]}insideBBox(o,g){return _d(o[0]-g[0])>=0&&_d(o[0]-g[2])<=0&&o[1]>=g[1]&&o[1]<=g[3]}}function fv(b,o){return b[0]===o[0]&&b[1]===o[1]}function Ax(b,o,g){const _e=_d(o[0]-b[0]);return[b[0]+_e*g,b[1]+(o[1]-b[1])*g]}function _d(b){for(;b<-180;)b+=360;for(;b>180;)b-=360;return b}class Rx{constructor(o=[],g=(_e,rt)=>_e<rt?-1:_e>rt?1:0){if(this.data=o,this.length=this.data.length,this.compare=g,this.length>0)for(let _e=(this.length>>1)-1;_e>=0;_e--)this._down(_e)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],g=this.data.pop();return--this.length>0&&(this.data[0]=g,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:g,compare:_e}=this,rt=g[o];for(;o>0;){const ot=o-1>>1,at=g[ot];if(_e(rt,at)>=0)break;g[o]=at,o=ot}g[o]=rt}_down(o){const{data:g,compare:_e}=this,rt=this.length>>1,ot=g[o];for(;o<rt;){let at=1+(o<<1);const ut=at+1;if(ut<this.length&&_e(g[ut],g[at])<0&&(at=ut),_e(g[at],ot)>=0)break;g[o]=g[at],o=at}g[o]=ot}}var jn=8192;function mv(b,o){return o.dist-b.dist}const Px=100,Ix=50;function gv(b){const o=[1/0,1/0,-1/0,-1/0];if(o.length!==b.length)return!1;for(let g=0;g<o.length;g++)if(o[g]!==b[g])return!1;return!0}function wy(b){return b[1]-b[0]+1}function zp(b,o){const g=b[1]>=b[0]&&b[1]<o;return g||console.warn("Distance Expression: Index is out of range"),g}function yv(b,o){if(b[0]>b[1])return[null,null];const g=wy(b);if(o){if(g===2)return[b,null];const _e=Math.floor(g/2);return[[b[0],b[0]+_e],[b[0]+_e,b[1]]]}{if(g===1)return[b,null];const _e=Math.floor(g/2)-1;return[[b[0],b[0]+_e],[b[0]+_e+1,b[1]]]}}function e0(b,o){const g=[1/0,1/0,-1/0,-1/0];if(!zp(o,b.length))return g;for(let _e=o[0];_e<=o[1];++_e)fp(g,b[_e]);return g}function t0(b){const o=[1/0,1/0,-1/0,-1/0];for(let g=0;g<b.length;++g)for(let _e=0;_e<b[g].length;++_e)fp(o,b[g][_e]);return o}function Im(b,o,g){if(gv(b)||gv(o))return NaN;let _e=0,rt=0;return b[2]<o[0]&&(_e=o[0]-b[2]),b[0]>o[2]&&(_e=b[0]-o[2]),b[1]>o[3]&&(rt=b[1]-o[3]),b[3]<o[1]&&(rt=o[1]-b[3]),g.distance([0,0],[_e,rt])}function kx(b){return 360*b-180}function uw(b){return 360/Math.PI*Math.atan(Math.exp((180-360*b)*Math.PI/180))-90}function Mx(b,o){const g=Math.pow(2,o.z),_e=(b.y/jn+o.y)/g;return[kx((b.x/jn+o.x)/g),uw(_e)]}function rT(b,o){const g=[];for(let _e=0;_e<b.length;++_e)g.push(Mx(b[_e],o));return g}function hw(b,o,g){const _e=g.pointOnLine(o,b).point;return g.distance(b,_e)}function xv(b,o,g,_e,rt){const ot=g.slice(_e[0],_e[1]+1);let at=1/0;for(let ut=o[0];ut<=o[1];++ut)if((at=Math.min(at,hw(b[ut],ot,rt)))===0)return 0;return at}function km(b,o,g,_e,rt){const ot=Math.min(rt.pointToSegmentDistance(b,g,_e),rt.pointToSegmentDistance(o,g,_e)),at=Math.min(rt.pointToSegmentDistance(g,b,o),rt.pointToSegmentDistance(_e,b,o));return Math.min(ot,at)}function co(b,o,g,_e,rt){if(!zp(o,b.length)||!zp(_e,g.length))return NaN;let ot=1/0;for(let at=o[0];at<o[1];++at)for(let ut=_e[0];ut<_e[1];++ut){if(vy(b[at],b[at+1],g[ut],g[ut+1]))return 0;ot=Math.min(ot,km(b[at],b[at+1],g[ut],g[ut+1],rt))}return ot}function nT(b,o,g,_e,rt){if(!zp(o,b.length)||!zp(_e,g.length))return NaN;let ot=1/0;for(let at=o[0];at<=o[1];++at)for(let ut=_e[0];ut<=_e[1];++ut)if((ot=Math.min(ot,rt.distance(b[at],g[ut])))===0)return ot;return ot}function iT(b,o,g){if(T0(b,o,!0))return 0;let _e=1/0;for(const rt of o){const ot=rt.length;if(ot<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(rt[0]!==rt[ot-1]&&(_e=Math.min(_e,g.pointToSegmentDistance(b,rt[ot-1],rt[0])))===0||(_e=Math.min(_e,hw(b,rt,g)))===0)return _e}return _e}function sT(b,o,g,_e){if(!zp(o,b.length))return NaN;for(let ot=o[0];ot<=o[1];++ot)if(T0(b[ot],g,!0))return 0;let rt=1/0;for(let ot=o[0];ot<o[1];++ot)for(const at of g)for(let ut=0,ft=at.length,xt=ft-1;ut<ft;xt=ut++){if(vy(b[ot],b[ot+1],at[xt],at[ut]))return 0;rt=Math.min(rt,km(b[ot],b[ot+1],at[xt],at[ut],_e))}return rt}function _v(b,o){for(const g of b)for(let _e=0;_e<=g.length-1;++_e)if(T0(g[_e],o,!0))return!0;return!1}function oT(b,o,g,_e=1/0){const rt=t0(b),ot=t0(o);if(_e!==1/0&&Im(rt,ot,g)>=_e)return _e;if(xy(rt,ot)){if(_v(b,o))return 0}else if(_v(o,b))return 0;let at=_e;for(const ut of b)for(let ft=0,xt=ut.length,Ct=xt-1;ft<xt;Ct=ft++)for(const Rt of o)for(let kt=0,zt=Rt.length,Ut=zt-1;kt<zt;Ut=kt++){if(vy(ut[Ct],ut[ft],Rt[Ut],Rt[kt]))return 0;at=Math.min(at,km(ut[Ct],ut[ft],Rt[Ut],Rt[kt],g))}return at}function $a(b,o,g,_e,rt,ot,at){if(ot===null||at===null)return;const ut=Im(e0(_e,ot),e0(rt,at),g);ut<o&&b.push({dist:ut,range1:ot,range2:at})}function aT(b,o,g,_e,rt=1/0){let ot=Math.min(_e.distance(b[0],g[0][0]),rt);if(ot===0)return ot;const at=new Rx([{dist:0,range1:[0,b.length-1],range2:[0,0]}],mv),ut=o?Ix:Px,ft=t0(g);for(;at.length;){const xt=at.pop();if(xt.dist>=ot)continue;const Ct=xt.range1;if(wy(Ct)<=ut){if(!zp(Ct,b.length))return NaN;if(o){const Rt=sT(b,Ct,g,_e);if((ot=Math.min(ot,Rt))===0)return ot}else for(let Rt=Ct[0];Rt<=Ct[1];++Rt){const kt=iT(b[Rt],g,_e);if((ot=Math.min(ot,kt))===0)return ot}}else{const Rt=yv(Ct,o);if(Rt[0]!==null){const kt=Im(e0(b,Rt[0]),ft,_e);kt<ot&&at.push({dist:kt,range1:Rt[0],range2:[0,0]})}if(Rt[1]!==null){const kt=Im(e0(b,Rt[1]),ft,_e);kt<ot&&at.push({dist:kt,range1:Rt[1],range2:[0,0]})}}}return ot}function dw(b,o,g,_e,rt,ot=1/0){let at=Math.min(ot,rt.distance(b[0],g[0]));if(at===0)return at;const ut=new Rx([{dist:0,range1:[0,b.length-1],range2:[0,g.length-1]}],mv),ft=o?Ix:Px,xt=_e?Ix:Px;for(;ut.length;){const Ct=ut.pop();if(Ct.dist>=at)continue;const Rt=Ct.range1,kt=Ct.range2;if(wy(Rt)<=ft&&wy(kt)<=xt){if(!zp(Rt,b.length)||!zp(kt,g.length))return NaN;if(o&&_e?at=Math.min(at,co(b,Rt,g,kt,rt)):o||_e?o&&!_e?at=Math.min(at,xv(g,kt,b,Rt,rt)):!o&&_e&&(at=Math.min(at,xv(b,Rt,g,kt,rt))):at=Math.min(at,nT(b,Rt,g,kt,rt)),at===0)return at}else{const zt=yv(Rt,o),Ut=yv(kt,_e);$a(ut,at,rt,b,g,zt[0],Ut[0]),$a(ut,at,rt,b,g,zt[0],Ut[1]),$a(ut,at,rt,b,g,zt[1],Ut[0]),$a(ut,at,rt,b,g,zt[1],Ut[1])}}return at}function vv(b,o,g,_e,rt=1/0){let ot=rt;const at=e0(b,[0,b.length-1]);for(const ut of g)if(!(ot!==1/0&&Im(at,e0(ut,[0,ut.length-1]),_e)>=ot)&&(ot=Math.min(ot,dw(b,o,ut,!0,_e,ot)),ot===0))return ot;return ot}function Dx(b,o,g,_e,rt=1/0){let ot=rt;const at=e0(b,[0,b.length-1]);for(const ut of g){if(ot!==1/0&&Im(at,t0(ut),_e)>=ot)continue;const ft=aT(b,o,ut,_e,ot);if(isNaN(ft))return ft;if((ot=Math.min(ot,ft))===0)return ot}return ot}function bv(b){return b==="Point"||b==="MultiPoint"||b==="LineString"||b==="MultiLineString"||b==="Polygon"||b==="MultiPolygon"}class r0{constructor(o,g){this.type=us,this.geojson=o,this.geometries=g}static parse(o,g){if(o.length!==2)return g.error(`'distance' expression requires either one argument, but found ' ${o.length-1} instead.`);if(w0(o[1])){const _e=o[1];if(_e.type==="FeatureCollection"){for(let rt=0;rt<_e.features.length;++rt)if(bv(_e.features[rt].geometry.type))return new r0(_e,_e.features[rt].geometry)}else if(_e.type==="Feature"){if(bv(_e.geometry.type))return new r0(_e,_e.geometry)}else if(bv(_e.type))return new r0(_e,_e)}return g.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(o){const g=o.geometry(),_e=o.canonicalID();if(g!=null&&_e!=null){if(o.geometryType()==="Point")return function(rt,ot,at){const ut=[];for(const xt of rt)for(const Ct of xt)ut.push(Mx(Ct,ot));const ft=new C0(ut[0][1],"meters");return at.type==="Point"||at.type==="MultiPoint"||at.type==="LineString"?dw(ut,!1,at.type==="Point"?[at.coordinates]:at.coordinates,at.type==="LineString",ft):at.type==="MultiLineString"?vv(ut,!1,at.coordinates,ft):at.type==="Polygon"||at.type==="MultiPolygon"?Dx(ut,!1,at.type==="Polygon"?[at.coordinates]:at.coordinates,ft):null}(g,_e,this.geometries);if(o.geometryType()==="LineString")return function(rt,ot,at){const ut=[];for(const xt of rt){const Ct=[];for(const Rt of xt)Ct.push(Mx(Rt,ot));ut.push(Ct)}const ft=new C0(ut[0][0][1],"meters");if(at.type==="Point"||at.type==="MultiPoint"||at.type==="LineString")return vv(at.type==="Point"?[at.coordinates]:at.coordinates,at.type==="LineString",ut,ft);if(at.type==="MultiLineString"){let xt=1/0;for(let Ct=0;Ct<at.coordinates.length;Ct++){const Rt=vv(at.coordinates[Ct],!0,ut,ft,xt);if(isNaN(Rt))return Rt;if((xt=Math.min(xt,Rt))===0)return xt}return xt}if(at.type==="Polygon"||at.type==="MultiPolygon"){let xt=1/0;for(let Ct=0;Ct<ut.length;Ct++){const Rt=Dx(ut[Ct],!0,at.type==="Polygon"?[at.coordinates]:at.coordinates,ft,xt);if(isNaN(Rt))return Rt;if((xt=Math.min(xt,Rt))===0)return xt}return xt}return null}(g,_e,this.geometries);if(o.geometryType()==="Polygon")return function(rt,ot,at){const ut=[];for(const xt of function(Ct,Rt){const kt=Ct.length;if(kt<=1)return[Ct];const zt=[];let Ut,Kt;for(let er=0;er<kt;er++){const Jt=Cm(Ct[er]);Jt!==0&&(Ct[er].area=Math.abs(Jt),Kt===void 0&&(Kt=Jt<0),Kt===Jt<0?(Ut&&zt.push(Ut),Ut=[Ct[er]]):Ut.push(Ct[er]))}return Ut&&zt.push(Ut),zt}(rt)){const Ct=[];for(let Rt=0;Rt<xt.length;++Rt)Ct.push(rT(xt[Rt],ot));ut.push(Ct)}const ft=new C0(ut[0][0][0][1],"meters");if(at.type==="Point"||at.type==="MultiPoint"||at.type==="LineString")return Dx(at.type==="Point"?[at.coordinates]:at.coordinates,at.type==="LineString",ut,ft);if(at.type==="MultiLineString"){let xt=1/0;for(let Ct=0;Ct<at.coordinates.length;Ct++){const Rt=Dx(at.coordinates[Ct],!0,ut,ft,xt);if(isNaN(Rt))return Rt;if((xt=Math.min(xt,Rt))===0)return xt}return xt}return at.type==="Polygon"||at.type==="MultiPolygon"?function(xt,Ct,Rt){let kt=1/0;for(const zt of xt)for(const Ut of Ct){const Kt=oT(zt,Ut,Rt,kt);if(isNaN(Kt))return Kt;if((kt=Math.min(kt,Kt))===0)return kt}return kt}(at.type==="Polygon"?[at.coordinates]:at.coordinates,ut,ft):null}(g,_e,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function A0(b){if(b instanceof Ou&&(b.name==="get"&&b.args.length===1||b.name==="feature-state"||b.name==="has"&&b.args.length===1||b.name==="properties"||b.name==="geometry-type"||b.name==="id"||/^filter-/.test(b.name))||b instanceof Pm||b instanceof r0)return!1;if(b instanceof P0)return b.featureConstant;let o=!0;return b.eachChild(g=>{o&&!A0(g)&&(o=!1)}),o}function Ey(b){if(b instanceof Ou&&b.name==="feature-state")return!1;let o=!0;return b.eachChild(g=>{o&&!Ey(g)&&(o=!1)}),o}function R0(b,o){if(b instanceof Ou&&o.indexOf(b.name)>=0)return!1;let g=!0;return b.eachChild(_e=>{g&&!R0(_e,o)&&(g=!1)}),g}function pw(b,o,g){return[b,o,g].filter(Boolean).join("")}function wv(b,o){switch(b){case"string":return pp(o);case"number":return+o;case"boolean":return!!o;case"color":return Ro.parse(o);case"formatted":return Lu.fromString(pp(o));case"resolvedImage":return ju.build(pp(o))}return o}function fw(b,o,g,_e){return _e!==void 0&&(b=_e*Math.round(b/_e)),o!==void 0&&b<o&&(b=o),g!==void 0&&b>g&&(b=g),b}class P0{constructor(o,g,_e,rt=!1){this.type=o,this.key=g,this.scope=_e,this.featureConstant=rt}static parse(o,g){let _e=g.expectedType;if(_e==null&&(_e=Ao),o.length<2||o.length>3)return g.error("Invalid number of arguments for 'config' expression.");const rt=g.parse(o[1],1);if(!(rt instanceof Qp))return g.error("Key name of 'config' expression must be a string literal.");let ot,at=!0;const ut=pp(rt.value);if(o.length>=3){const ft=g.parse(o[2],2);if(!(ft instanceof Qp))return g.error("Scope of 'config' expression must be a string literal.");ot=pp(ft.value)}if(g.options){const ft=pw(ut,ot,g._scope),xt=g.options.get(ft);xt&&(at=A0(xt.value||xt.default))}return new P0(_e,ut,ot,at)}evaluate(o){const g=pw(this.key,this.scope,o.scope),_e=o.getConfig(g);if(!_e)return null;const{type:rt,value:ot,values:at,minValue:ut,maxValue:ft,stepValue:xt}=_e,Ct=_e.default.evaluate(o);let Rt=Ct;if(ot){const kt=o.scope;o.scope=(kt||"").split("").slice(1).join(""),Rt=ot.evaluate(o),o.scope=kt}return rt&&(Rt=wv(rt,Rt)),Rt===void 0||ut===void 0&&ft===void 0&&xt===void 0||(typeof Rt=="number"?Rt=fw(Rt,ut,ft,xt):Array.isArray(Rt)&&(Rt=Rt.map(kt=>typeof kt=="number"?fw(kt,ut,ft,xt):kt))),ot!==void 0&&Rt!==void 0&&at&&!at.includes(Rt)&&(Rt=Ct,rt&&(Rt=wv(rt,Rt))),(rt&&rt!==this.type||Rt!==void 0&&!_x(du(Rt),this.type))&&(Rt=wv(this.type.kind,Rt)),Rt}eachChild(){}outputDefined(){return!1}serialize(){const o=["config",this.key];return this.scope&&o.concat(this.scope),o}}class Nx{constructor(o,g){this.type=g.type,this.name=o,this.boundExpression=g}static parse(o,g){if(o.length!==2||typeof o[1]!="string")return g.error("'var' expression requires exactly one string literal argument.");const _e=o[1];return g.scope.has(_e)?new Nx(_e,g.scope.get(_e)):g.error(`Unknown variable "${_e}". Make sure "${_e}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Lx{constructor(o,g=[],_e,rt=new b0,ot=[],at,ut,ft){this.registry=o,this.path=g,this.key=g.map(xt=>typeof xt=="string"?`['${xt}']`:`[${xt}]`).join(""),this.scope=rt,this.errors=ot,this.expectedType=_e,this._scope=at,this.options=ut,this.iconImageUseTheme=ft}parse(o,g,_e,rt,ot={}){return g||_e?this.concat(g,null,_e,rt)._parse(o,ot):this._parse(o,ot)}parseObjectValue(o,g,_e,rt,ot,at={}){return this.concat(g,_e,rt,ot)._parse(o,at)}_parse(o,g){function _e(rt,ot,at){return at==="assert"?new Sp(ot,[rt]):at==="coerce"?new Bp(ot,[rt]):rt}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const rt=typeof o[0]=="string"?this.registry[o[0]]:void 0;if(rt){let ot=rt.parse(o,this);if(!ot)return null;if(this.expectedType){const at=this.expectedType,ut=ot.type;if(at.kind!=="string"&&at.kind!=="number"&&at.kind!=="boolean"&&at.kind!=="object"&&at.kind!=="array"||ut.kind!=="value")if(at.kind!=="color"&&at.kind!=="formatted"&&at.kind!=="resolvedImage"||ut.kind!=="value"&&ut.kind!=="string"){if(this.checkSubtype(at,ut))return null}else ot=_e(ot,at,g.typeAnnotation||"coerce");else ot=_e(ot,at,g.typeAnnotation||"assert")}if(!(ot instanceof Qp)&&ot.type.kind!=="resolvedImage"&&Ev(ot)){const at=new Ex(this._scope,this.options,this.iconImageUseTheme);try{ot=new Qp(ot.type,ot.evaluate(at))}catch(ut){return this.error(ut.message),null}}return ot}return Bp.parse(["to-array",o],this)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,g,_e,rt){let ot=typeof o=="number"?this.path.concat(o):this.path;ot=typeof g=="string"?ot.concat(g):ot;const at=rt?this.scope.concat(rt):this.scope;return new Lx(this.registry,ot,_e||null,at,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(o,...g){const _e=`${this.key}${g.map(rt=>`[${rt}]`).join("")}`;this.errors.push(new dp(_e,o))}checkSubtype(o,g){const _e=Sm(o,g);return _e&&this.error(_e),_e}}function Ev(b){if(b instanceof Nx)return Ev(b.boundExpression);if(b instanceof Ou&&b.name==="error"||b instanceof gu||b instanceof Pm||b instanceof r0||b instanceof P0)return!1;const o=b instanceof Bp||b instanceof Sp;let g=!0;return b.eachChild(_e=>{g=o?g&&Ev(_e):g&&_e instanceof Qp}),!!g&&A0(b)&&R0(b,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function jx(b,o){const g=b.length-1;let _e,rt,ot=0,at=g,ut=0;for(;ot<=at;)if(ut=Math.floor((ot+at)/2),_e=b[ut],rt=b[ut+1],_e<=o){if(ut===g||o<rt)return ut;ot=ut+1}else{if(!(_e>o))throw new ou("Input is not a number.");at=ut-1}return 0}class Ty{constructor(o,g,_e){this.type=o,this.input=g,this.labels=[],this.outputs=[];for(const[rt,ot]of _e)this.labels.push(rt),this.outputs.push(ot)}static parse(o,g){if(o.length-1<4)return g.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return g.error("Expected an even number of arguments.");const _e=g.parse(o[1],1,us);if(!_e)return null;const rt=[];let ot=null;g.expectedType&&g.expectedType.kind!=="value"&&(ot=g.expectedType);for(let at=1;at<o.length;at+=2){const ut=at===1?-1/0:o[at],ft=o[at+1],xt=at,Ct=at+1;if(typeof ut!="number")return g.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',xt);if(rt.length&&rt[rt.length-1][0]>=ut)return g.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',xt);const Rt=g.parse(ft,Ct,ot);if(!Rt)return null;ot=ot||Rt.type,rt.push([ut,Rt])}return new Ty(ot,_e,rt)}evaluate(o){const g=this.labels,_e=this.outputs;if(g.length===1)return _e[0].evaluate(o);const rt=this.input.evaluate(o);if(rt<=g[0])return _e[0].evaluate(o);const ot=g.length;return rt>=g[ot-1]?_e[ot-1].evaluate(o):_e[jx(g,rt)].evaluate(o)}eachChild(o){o(this.input);for(const g of this.outputs)o(g)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let g=0;g<this.labels.length;g++)g>0&&o.push(this.labels[g]),o.push(this.outputs[g].serialize());return o}}const mw=.95047,gw=1.08883,yw=4/29,I0=6/29,xw=3*I0*I0,lT=I0*I0*I0,cT=Math.PI/180,uT=180/Math.PI;function Tv(b){return b>lT?Math.pow(b,1/3):b/xw+yw}function Sv(b){return b>I0?b*b*b:xw*(b-yw)}function Cv(b){return 255*(b<=.0031308?12.92*b:1.055*Math.pow(b,1/2.4)-.055)}function Av(b){return(b/=255)<=.04045?b/12.92:Math.pow((b+.055)/1.055,2.4)}function _w(b){const o=Av(b.r),g=Av(b.g),_e=Av(b.b),rt=Tv((.4124564*o+.3575761*g+.1804375*_e)/mw),ot=Tv((.2126729*o+.7151522*g+.072175*_e)/1);return{l:116*ot-16,a:500*(rt-ot),b:200*(ot-Tv((.0193339*o+.119192*g+.9503041*_e)/gw)),alpha:b.a}}function Ox(b){let o=(b.l+16)/116,g=isNaN(b.a)?o:o+b.a/500,_e=isNaN(b.b)?o:o-b.b/200;return o=1*Sv(o),g=mw*Sv(g),_e=gw*Sv(_e),new Ro(Cv(3.2404542*g-1.5371385*o-.4985314*_e),Cv(-.969266*g+1.8760108*o+.041556*_e),Cv(.0556434*g-.2040259*o+1.0572252*_e),b.alpha)}function Fx(b,o,g){const _e=o-b;return b+g*(_e>180||_e<-180?_e-360*Math.round(_e/360):_e)}const k0={forward:_w,reverse:Ox,interpolate:function(b,o,g){return{l:Cs(b.l,o.l,g),a:Cs(b.a,o.a,g),b:Cs(b.b,o.b,g),alpha:Cs(b.alpha,o.alpha,g)}}},Sy={forward:function(b){const{l:o,a:g,b:_e}=_w(b),rt=Math.atan2(_e,g)*uT;return{h:rt<0?rt+360:rt,c:Math.sqrt(g*g+_e*_e),l:o,alpha:b.a}},reverse:function(b){const o=b.h*cT,g=b.c;return Ox({l:b.l,a:Math.cos(o)*g,b:Math.sin(o)*g,alpha:b.alpha})},interpolate:function(b,o,g){return{h:Fx(b.h,o.h,g),c:Cs(b.c,o.c,g),l:Cs(b.l,o.l,g),alpha:Cs(b.alpha,o.alpha,g)}}};var bw=Object.freeze({__proto__:null,hcl:Sy,lab:k0});class ep{constructor(o,g,_e,rt,ot){this.type=o,this.operator=g,this.interpolation=_e,this.input=rt,this.labels=[],this.outputs=[];for(const[at,ut]of ot)this.labels.push(at),this.outputs.push(ut)}static interpolationFactor(o,g,_e,rt){let ot=0;if(o.name==="exponential")ot=Bx(g,o.base,_e,rt);else if(o.name==="linear")ot=Bx(g,1,_e,rt);else if(o.name==="cubic-bezier"){const at=o.controlPoints;ot=new vu(at[0],at[1],at[2],at[3]).solve(Bx(g,1,_e,rt))}return ot}static parse(o,g){let[_e,rt,ot,...at]=o;if(!Array.isArray(rt)||rt.length===0)return g.error("Expected an interpolation type expression.",1);if(rt[0]==="linear")rt={name:"linear"};else if(rt[0]==="exponential"){const xt=rt[1];if(typeof xt!="number")return g.error("Exponential interpolation requires a numeric base.",1,1);rt={name:"exponential",base:xt}}else{if(rt[0]!=="cubic-bezier")return g.error(`Unknown interpolation type ${String(rt[0])}`,1,0);{const xt=rt.slice(1);if(xt.length!==4||xt.some(Ct=>typeof Ct!="number"||Ct<0||Ct>1))return g.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);rt={name:"cubic-bezier",controlPoints:xt}}}if(o.length-1<4)return g.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length-1>3&&(o.length-1)%2!=0)return g.error("Expected an even number of arguments.");if(ot=g.parse(ot,2,us),!ot)return null;const ut=[];let ft=null;_e==="interpolate-hcl"||_e==="interpolate-lab"?ft=Gu:g.expectedType&&g.expectedType.kind!=="value"&&(ft=g.expectedType);for(let xt=0;xt<at.length;xt+=2){const Ct=at[xt],Rt=at[xt+1],kt=xt+3,zt=xt+4;if(typeof Ct!="number")return g.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',kt);if(ut.length&&ut[ut.length-1][0]>=Ct)return g.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',kt);const Ut=g.parse(Rt,zt,ft);if(!Ut)return null;ft=ft||Ut.type,ut.push([Ct,Ut])}return ft.kind==="number"||ft.kind==="color"||ft.kind==="array"&&ft.itemType.kind==="number"&&typeof ft.N=="number"?new ep(ft,_e,rt,ot,ut):g.error(`Type ${Zl(ft)} is not interpolatable.`)}evaluate(o){const g=this.labels,_e=this.outputs;if(g.length===1)return _e[0].evaluate(o);const rt=this.input.evaluate(o);if(rt<=g[0])return _e[0].evaluate(o);const ot=g.length;if(rt>=g[ot-1])return _e[ot-1].evaluate(o);const at=jx(g,rt),ut=ep.interpolationFactor(this.interpolation,rt,g[at],g[at+1]),ft=_e[at].evaluate(o),xt=_e[at+1].evaluate(o);return this.operator==="interpolate"?fy[this.type.kind.toLowerCase()](ft,xt,ut):this.operator==="interpolate-hcl"?Sy.reverse(Sy.interpolate(Sy.forward(ft),Sy.forward(xt),ut)):k0.reverse(k0.interpolate(k0.forward(ft),k0.forward(xt),ut))}eachChild(o){o(this.input);for(const g of this.outputs)o(g)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const g=[this.operator,o,this.input.serialize()];for(let _e=0;_e<this.labels.length;_e++)g.push(this.labels[_e],this.outputs[_e].serialize());return g}}function Bx(b,o,g,_e){const rt=_e-g,ot=b-g;return rt===0?0:o===1?ot/rt:(Math.pow(o,ot)-1)/(Math.pow(o,rt)-1)}class Cy{constructor(o,g){this.type=o,this.args=g}static parse(o,g){if(o.length<2)return g.error("Expectected at least one argument.");let _e=null;const rt=g.expectedType;rt&&rt.kind!=="value"&&(_e=rt);const ot=[];for(const ut of o.slice(1)){const ft=g.parse(ut,1+ot.length,_e,void 0,{typeAnnotation:"omit"});if(!ft)return null;_e=_e||ft.type,ot.push(ft)}const at=rt&&ot.some(ut=>Sm(rt,ut.type));return new Cy(at?Ao:_e,ot)}evaluate(o){let g,_e=null,rt=0;for(const ot of this.args){if(rt++,_e=ot.evaluate(o),_e&&_e instanceof ju&&!_e.available&&(g||(g=_e),_e=null,rt===this.args.length))return g;if(_e!==null)break}return _e}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(g=>{o.push(g.serialize())}),o}}class _f{constructor(o,g){this.type=g.type,this.bindings=[].concat(o),this.result=g}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const g of this.bindings)o(g[1]);o(this.result)}static parse(o,g){if(o.length<4)return g.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const _e=[];for(let ot=1;ot<o.length-1;ot+=2){const at=o[ot];if(typeof at!="string")return g.error(`Expected string, but found ${typeof at} instead.`,ot);if(/[^a-zA-Z0-9_]/.test(at))return g.error("Variable names must contain only alphanumeric characters or '_'.",ot);const ut=g.parse(o[ot+1],ot+1);if(!ut)return null;_e.push([at,ut])}const rt=g.parse(o[o.length-1],o.length-1,g.expectedType,_e);return rt?new _f(_e,rt):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[g,_e]of this.bindings)o.push(g,_e.serialize());return o.push(this.result.serialize()),o}}class zx{constructor(o,g,_e){this.type=o,this.index=g,this.input=_e}static parse(o,g){if(o.length!==3)return g.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const _e=g.parse(o[1],1,us),rt=g.parse(o[2],2,Au(g.expectedType||Ao));return _e&&rt?new zx(rt.type.itemType,_e,rt):null}evaluate(o){const g=this.index.evaluate(o),_e=this.input.evaluate(o);if(g<0)throw new ou("Array index out of bounds: negative index");if(g>=_e.length)throw new ou("Array index out of bounds: index exceeds array size");if(g!==Math.floor(g))throw new ou("Array index must be an integer. Use at-interpolated for fractional indices");return _e[g]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Vx{constructor(o,g,_e){this.type=o,this.index=g,this.input=_e}static parse(o,g){if(o.length!==3)return g.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const _e=g.parse(o[1],1,us),rt=g.parse(o[2],2,Au(g.expectedType||Ao));return _e&&rt?new Vx(rt.type.itemType,_e,rt):null}evaluate(o){const g=this.index.evaluate(o),_e=this.input.evaluate(o);if(g<0)throw new ou(`Array index out of bounds: ${g} < 0.`);if(g>_e.length-1)throw new ou(`Array index out of bounds: ${g} > ${_e.length-1}.`);if(g===Math.floor(g))return _e[g];const rt=Math.floor(g),ot=Math.ceil(g),at=_e[rt],ut=_e[ot];if(typeof at!="number"||typeof ut!="number")throw new ou(`Cannot interpolate between non-number values at index ${g}.`);const ft=g-rt;return at*(1-ft)+ut*ft}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Rv{constructor(o,g){this.type=Mo,this.needle=o,this.haystack=g}static parse(o,g){if(o.length!==3)return g.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const _e=g.parse(o[1],1,Ao),rt=g.parse(o[2],2,Ao);return _e&&rt?av(_e.type,[Mo,ao,us,Tp,Ao])?new Rv(_e,rt):g.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zl(_e.type)} instead`):null}evaluate(o){const g=this.needle.evaluate(o),_e=this.haystack.evaluate(o);if(_e==null)return!1;if(!yy(g,["boolean","string","number","null"]))throw new ou(`Expected first argument to be of type boolean, string, number or null, but found ${Zl(du(g))} instead.`);if(!yy(_e,["string","array"]))throw new ou(`Expected second argument to be of type array or string, but found ${Zl(du(_e))} instead.`);return _e.indexOf(g)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class M0{constructor(o,g,_e){this.type=us,this.needle=o,this.haystack=g,this.fromIndex=_e}static parse(o,g){if(o.length<=2||o.length>=5)return g.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const _e=g.parse(o[1],1,Ao),rt=g.parse(o[2],2,Ao);if(!_e||!rt)return null;if(!av(_e.type,[Mo,ao,us,Tp,Ao]))return g.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zl(_e.type)} instead`);if(o.length===4){const ot=g.parse(o[3],3,us);return ot?new M0(_e,rt,ot):null}return new M0(_e,rt)}evaluate(o){const g=this.needle.evaluate(o),_e=this.haystack.evaluate(o);if(!yy(g,["boolean","string","number","null"]))throw new ou(`Expected first argument to be of type boolean, string, number or null, but found ${Zl(du(g))} instead.`);if(!yy(_e,["string","array"]))throw new ou(`Expected second argument to be of type array or string, but found ${Zl(du(_e))} instead.`);if(this.fromIndex){const rt=this.fromIndex.evaluate(o);return _e.indexOf(g,rt)}return _e.indexOf(g)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ay{constructor(o,g,_e,rt,ot,at){this.inputType=o,this.type=g,this.input=_e,this.cases=rt,this.outputs=ot,this.otherwise=at}static parse(o,g){if(o.length<5)return g.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return g.error("Expected an even number of arguments.");let _e,rt;g.expectedType&&g.expectedType.kind!=="value"&&(rt=g.expectedType);const ot={},at=[];for(let xt=2;xt<o.length-1;xt+=2){let Ct=o[xt];const Rt=o[xt+1];Array.isArray(Ct)||(Ct=[Ct]);const kt=g.concat(xt);if(Ct.length===0)return kt.error("Expected at least one branch label.");for(const Ut of Ct){if(typeof Ut!="number"&&typeof Ut!="string")return kt.error("Branch labels must be numbers or strings.");if(typeof Ut=="number"&&Math.abs(Ut)>Number.MAX_SAFE_INTEGER)return kt.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Ut=="number"&&Math.floor(Ut)!==Ut)return kt.error("Numeric branch labels must be integer values.");if(_e){if(kt.checkSubtype(_e,du(Ut)))return null}else _e=du(Ut);if(ot[String(Ut)]!==void 0)return kt.error("Branch labels must be unique.");ot[String(Ut)]=at.length}const zt=g.parse(Rt,xt,rt);if(!zt)return null;rt=rt||zt.type,at.push(zt)}const ut=g.parse(o[1],1,Ao);if(!ut)return null;const ft=g.parse(o[o.length-1],o.length-1,rt);return ft?ut.type.kind!=="value"&&g.concat(1).checkSubtype(_e,ut.type)?null:new Ay(_e,rt,ut,ot,at,ft):null}evaluate(o){const g=this.input.evaluate(o);return(_x(du(g),this.inputType)&&this.outputs[this.cases[g]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],g=Object.keys(this.cases).sort(),_e=[],rt={};for(const at of g){const ut=rt[this.cases[at]];ut===void 0?(rt[this.cases[at]]=_e.length,_e.push([this.cases[at],[at]])):_e[ut][1].push(at)}const ot=at=>this.inputType.kind==="number"?Number(at):at;for(const[at,ut]of _e)o.push(ut.length===1?ot(ut[0]):ut.map(ot)),o.push(this.outputs[at].serialize());return o.push(this.otherwise.serialize()),o}}class Ry{constructor(o,g,_e){this.type=o,this.branches=g,this.otherwise=_e}static parse(o,g){if(o.length<4)return g.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return g.error("Expected an odd number of arguments.");let _e;g.expectedType&&g.expectedType.kind!=="value"&&(_e=g.expectedType);const rt=[];for(let at=1;at<o.length-1;at+=2){const ut=g.parse(o[at],at,Mo);if(!ut)return null;const ft=g.parse(o[at+1],at+1,_e);if(!ft)return null;rt.push([ut,ft]),_e=_e||ft.type}const ot=g.parse(o[o.length-1],o.length-1,_e);return ot?new Ry(_e,rt,ot):null}evaluate(o){for(const[g,_e]of this.branches)if(g.evaluate(o))return _e.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[g,_e]of this.branches)o(g),o(_e);o(this.otherwise)}outputDefined(){return this.branches.every(([o,g])=>g.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(g=>{o.push(g.serialize())}),o}}class Ux{constructor(o,g,_e,rt){this.type=o,this.input=g,this.beginIndex=_e,this.endIndex=rt}static parse(o,g){if(o.length<=2||o.length>=5)return g.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const _e=g.parse(o[1],1,Ao),rt=g.parse(o[2],2,us);if(!_e||!rt)return null;if(!av(_e.type,[Au(Ao),ao,Ao]))return g.error(`Expected first argument to be of type array or string, but found ${Zl(_e.type)} instead`);if(o.length===4){const ot=g.parse(o[3],3,us);return ot?new Ux(_e.type,_e,rt,ot):null}return new Ux(_e.type,_e,rt)}evaluate(o){const g=this.input.evaluate(o),_e=this.beginIndex.evaluate(o);if(!yy(g,["string","array"]))throw new ou(`Expected first argument to be of type array or string, but found ${Zl(du(g))} instead.`);if(this.endIndex){const rt=this.endIndex.evaluate(o);return g.slice(_e,rt)}return g.slice(_e)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Pv{constructor(o,g){this.type=Au(ao),this.str=o,this.delimiter=g}static parse(o,g){if(o.length!==3)return g.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const _e=g.parse(o[1],1,ao),rt=g.parse(o[2],2,ao);return _e&&rt?new Pv(_e,rt):void 0}evaluate(o){const g=this.str.evaluate(o),_e=this.delimiter.evaluate(o);return g.split(_e)}eachChild(o){o(this.str),o(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Iv(b,o){return b==="=="||b==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function kv(b,o,g,_e){return _e.compare(o,g)===0}function D0(b,o,g){const _e=b!=="=="&&b!=="!=";return class rP{constructor(ot,at,ut){this.type=Mo,this.lhs=ot,this.rhs=at,this.collator=ut,this.hasUntypedArgument=ot.type.kind==="value"||at.type.kind==="value"}static parse(ot,at){if(ot.length!==3&&ot.length!==4)return at.error("Expected two or three arguments.");const ut=ot[0];let ft=at.parse(ot[1],1,Ao);if(!ft)return null;if(!Iv(ut,ft.type))return at.concat(1).error(`"${ut}" comparisons are not supported for type '${Zl(ft.type)}'.`);let xt=at.parse(ot[2],2,Ao);if(!xt)return null;if(!Iv(ut,xt.type))return at.concat(2).error(`"${ut}" comparisons are not supported for type '${Zl(xt.type)}'.`);if(ft.type.kind!==xt.type.kind&&ft.type.kind!=="value"&&xt.type.kind!=="value")return at.error(`Cannot compare types '${Zl(ft.type)}' and '${Zl(xt.type)}'.`);_e&&(ft.type.kind==="value"&&xt.type.kind!=="value"?ft=new Sp(xt.type,[ft]):ft.type.kind!=="value"&&xt.type.kind==="value"&&(xt=new Sp(ft.type,[xt])));let Ct=null;if(ot.length===4){if(ft.type.kind!=="string"&&xt.type.kind!=="string"&&ft.type.kind!=="value"&&xt.type.kind!=="value")return at.error("Cannot use collator to compare non-string types.");if(Ct=at.parse(ot[3],3,xx),!Ct)return null}return new rP(ft,xt,Ct)}evaluate(ot){const at=this.lhs.evaluate(ot),ut=this.rhs.evaluate(ot);if(_e&&this.hasUntypedArgument){const ft=du(at),xt=du(ut);if(ft.kind!==xt.kind||ft.kind!=="string"&&ft.kind!=="number")throw new ou(`Expected arguments for "${b}" to be (string, string) or (number, number), but found (${ft.kind}, ${xt.kind}) instead.`)}if(this.collator&&!_e&&this.hasUntypedArgument){const ft=du(at),xt=du(ut);if(ft.kind!=="string"||xt.kind!=="string")return o(ot,at,ut)}return this.collator?g(ot,at,ut,this.collator.evaluate(ot)):o(ot,at,ut)}eachChild(ot){ot(this.lhs),ot(this.rhs),this.collator&&ot(this.collator)}outputDefined(){return!0}serialize(){const ot=[b];return this.eachChild(at=>{ot.push(at.serialize())}),ot}}}const hT=D0("==",function(b,o,g){return o===g},kv),dT=D0("!=",function(b,o,g){return o!==g},function(b,o,g,_e){return!kv(0,o,g,_e)}),ww=D0("<",function(b,o,g){return o<g},function(b,o,g,_e){return _e.compare(o,g)<0}),Ew=D0(">",function(b,o,g){return o>g},function(b,o,g,_e){return _e.compare(o,g)>0}),$x=D0("<=",function(b,o,g){return o<=g},function(b,o,g,_e){return _e.compare(o,g)<=0}),pT=D0(">=",function(b,o,g){return o>=g},function(b,o,g,_e){return _e.compare(o,g)>=0});class Gx{constructor(o,g,_e,rt,ot,at){this.type=ao,this.number=o,this.locale=g,this.currency=_e,this.unit=rt,this.minFractionDigits=ot,this.maxFractionDigits=at}static parse(o,g){if(o.length!==3)return g.error("Expected two arguments.");const _e=g.parse(o[1],1,us);if(!_e)return null;const rt=o[2];if(typeof rt!="object"||Array.isArray(rt))return g.error("NumberFormat options argument must be an object.");let ot=null;if(rt.locale&&(ot=g.parseObjectValue(rt.locale,2,"locale",ao),!ot))return null;let at=null;if(rt.currency&&(at=g.parseObjectValue(rt.currency,2,"currency",ao),!at))return null;let ut=null;if(rt.unit&&(ut=g.parseObjectValue(rt.unit,2,"unit",ao),!ut))return null;let ft=null;if(rt["min-fraction-digits"]&&(ft=g.parseObjectValue(rt["min-fraction-digits"],2,"min-fraction-digits",us),!ft))return null;let xt=null;return rt["max-fraction-digits"]&&(xt=g.parseObjectValue(rt["max-fraction-digits"],2,"max-fraction-digits",us),!xt)?null:new Gx(_e,ot,at,ut,ft,xt)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class Mv{constructor(o){this.type=us,this.input=o}static parse(o,g){if(o.length!==2)return g.error(`Expected 1 argument, but found ${o.length-1} instead.`);const _e=g.parse(o[1],1);return _e?_e.type.kind!=="array"&&_e.type.kind!=="string"&&_e.type.kind!=="value"?g.error(`Expected argument of type string or array, but found ${Zl(_e.type)} instead.`):new Mv(_e):null}evaluate(o){const g=this.input.evaluate(o);if(typeof g=="string"||Array.isArray(g))return g.length;throw new ou(`Expected value to be of type string or array, but found ${Zl(du(g))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(g=>{o.push(g.serialize())}),o}}function Tw(b){return function(){b=1831565813+(b|=0)|0;let o=Math.imul(b^b>>>15,1|b);return o=o+Math.imul(o^o>>>7,61|o)^o,((o^o>>>14)>>>0)/4294967296}}const N0={"==":hT,"!=":dT,">":Ew,"<":ww,">=":pT,"<=":$x,array:Sp,at:zx,"at-interpolated":Vx,boolean:Sp,case:Ry,coalesce:Cy,collator:gu,format:Fp,image:Bs,in:Rv,"index-of":M0,interpolate:ep,"interpolate-hcl":ep,"interpolate-lab":ep,length:Mv,let:_f,literal:Qp,match:Ay,number:Sp,"number-format":Gx,object:Sp,slice:Ux,step:Ty,string:Sp,"to-boolean":Bp,"to-color":Bp,"to-number":Bp,"to-string":Bp,var:Nx,within:Pm,distance:r0,config:P0,split:Pv};function Dv(b,[o,g,_e,rt]){o=o.evaluate(b),g=g.evaluate(b),_e=_e.evaluate(b);const ot=rt?rt.evaluate(b):1,at=_g(o,g,_e,ot);if(at)throw new ou(at);return new Ro(o/255,g/255,_e/255,ot)}function Nv(b,[o,g,_e,rt]){o=o.evaluate(b),g=g.evaluate(b),_e=_e.evaluate(b);const ot=rt?rt.evaluate(b):1,at=function(xt,Ct,Rt,kt){return typeof xt=="number"&&xt>=0&&xt<=360?typeof Ct=="number"&&Ct>=0&&Ct<=100&&typeof Rt=="number"&&Rt>=0&&Rt<=100?kt===void 0||typeof kt=="number"&&kt>=0&&kt<=1?null:`Invalid hsla value [${[xt,Ct,Rt,kt].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof kt=="number"?[xt,Ct,Rt,kt]:[xt,Ct,Rt]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof kt=="number"?[xt,Ct,Rt,kt]:[xt,Ct,Rt]).join(", ")}]: 'h' must be between 0 and 360.`}(o,g,_e,ot);if(at)throw new ou(at);const ut=`hsla(${o}, ${g}%, ${_e}%, ${ot})`,ft=Ro.parse(ut);if(!ft)throw new ou(`Failed to parse HSLA color: ${ut}`);return ft}function Sw(b,o){return b in o}function Lv(b,o){const g=o[b];return g===void 0?null:g}function Mm(b){return{type:b}}function n0(b){if(b instanceof P0)return new Set([b.key]);let o=new Set;return b.eachChild(g=>{o=new Set([...o,...n0(g)])}),o}function Hx(b){if(b instanceof Ou&&b.name==="is-active-floor")return!0;let o=!1;return b.eachChild(g=>{!o&&Hx(g)&&(o=!0)}),o}function Cw(b){return{result:"success",value:b}}function Dm(b){return{result:"error",value:b}}function jv(b,o){return!!b&&!!b.parameters&&b.parameters.indexOf(o)>-1}function Py(b){return b["property-type"]==="data-driven"}function Aw(b){return jv(b.expression,"measure-light")}function Rw(b){return jv(b.expression,"zoom")}function Wx(b){return!!b.expression&&b.expression.interpolated}function qx(b){return typeof b=="object"&&b!==null&&!Array.isArray(b)}function Pw(b){return b}function Iw(b,o){const g=o.type==="color",_e=b.stops&&typeof b.stops[0][0]=="object",rt=_e||!(_e||b.property!==void 0),ot=b.type||(Wx(o)?"exponential":"interval");if(g&&((b=Object.assign({},b)).stops&&(b.stops=b.stops.map(xt=>[xt[0],Ro.parse(xt[1])])),b.default=Ro.parse(b.default?b.default:o.default)),b.colorSpace&&b.colorSpace!=="rgb"&&!bw[b.colorSpace])throw new Error(`Unknown color space: ${b.colorSpace}`);let at,ut,ft;if(ot==="exponential")at=kw;else if(ot==="interval")at=mT;else if(ot==="categorical"){at=fT,ut=Object.create(null);for(const xt of b.stops)ut[xt[0]]=xt[1];ft=typeof b.stops[0][0]}else{if(ot!=="identity")throw new Error(`Unknown function type "${ot}"`);at=Mw}if(_e){const xt={},Ct=[];for(let zt=0;zt<b.stops.length;zt++){const Ut=b.stops[zt],Kt=Ut[0].zoom;xt[Kt]===void 0&&(xt[Kt]={zoom:Kt,type:b.type,property:b.property,default:b.default,stops:[]},Ct.push(Kt)),xt[Kt].stops.push([Ut[0].value,Ut[1]])}const Rt=[];for(const zt of Ct)Rt.push([xt[zt].zoom,Iw(xt[zt],o)]);const kt={name:"linear"};return{kind:"composite",interpolationType:kt,interpolationFactor:ep.interpolationFactor.bind(void 0,kt),zoomStops:Rt.map(zt=>zt[0]),evaluate:({zoom:zt},Ut)=>kw({stops:Rt,base:b.base},o,zt).evaluate(zt,Ut)}}if(rt){const xt=ot==="exponential"?{name:"exponential",base:b.base!==void 0?b.base:1}:null;return{kind:"camera",interpolationType:xt,interpolationFactor:ep.interpolationFactor.bind(void 0,xt),zoomStops:b.stops.map(Ct=>Ct[0]),evaluate:({zoom:Ct})=>at(b,o,Ct,ut,ft)}}return{kind:"source",evaluate(xt,Ct){const Rt=Ct&&Ct.properties?Ct.properties[b.property]:void 0;return Rt===void 0?Vp(b.default,o.default):at(b,o,Rt,ut,ft)}}}function Vp(b,o,g){return b!==void 0?b:o!==void 0?o:g!==void 0?g:void 0}function fT(b,o,g,_e,rt){return Vp(typeof g===rt?_e[g]:void 0,b.default,o.default)}function mT(b,o,g){if(!E0(g))return Vp(b.default,o.default);const _e=b.stops.length;if(_e===1||g<=b.stops[0][0])return b.stops[0][1];if(g>=b.stops[_e-1][0])return b.stops[_e-1][1];const rt=jx(b.stops.map(ot=>ot[0]),g);return b.stops[rt][1]}function kw(b,o,g){const _e=b.base!==void 0?b.base:1;if(!E0(g))return Vp(b.default,o.default);const rt=b.stops.length;if(rt===1||g<=b.stops[0][0])return b.stops[0][1];if(g>=b.stops[rt-1][0])return b.stops[rt-1][1];const ot=jx(b.stops.map(Ct=>Ct[0]),g),at=function(Ct,Rt,kt,zt){const Ut=zt-kt,Kt=Ct-kt;return Ut===0?0:Rt===1?Kt/Ut:(Math.pow(Rt,Kt)-1)/(Math.pow(Rt,Ut)-1)}(g,_e,b.stops[ot][0],b.stops[ot+1][0]),ut=b.stops[ot][1],ft=b.stops[ot+1][1];let xt=fy[o.type]||Pw;if(b.colorSpace&&b.colorSpace!=="rgb"){const Ct=bw[b.colorSpace];xt=(Rt,kt)=>Ct.reverse(Ct.interpolate(Ct.forward(Rt),Ct.forward(kt),at))}return typeof ut.evaluate=="function"?{evaluate(...Ct){const Rt=ut.evaluate.apply(void 0,Ct),kt=ft.evaluate.apply(void 0,Ct);if(Rt!==void 0&&kt!==void 0)return xt(Rt,kt,at)}}:xt(ut,ft,at)}function Mw(b,o,g){return o.type==="color"?g=Ro.parse(g):o.type==="formatted"?g=Lu.fromString(g.toString()):o.type==="resolvedImage"?g=ju.build(g.toString()):as(g)===o.type||o.type==="enum"&&o.values[g]||(g=void 0),Vp(g,b.default,o.default)}Ou.register(N0,{error:[{kind:"error"},[ao],(b,[o])=>{throw new ou(o.evaluate(b))}],typeof:[ao,[Ao],(b,[o])=>Zl(du(o.evaluate(b)))],"to-rgba":[Au(us,4),[Gu],(b,[o])=>o.evaluate(b).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Au(us,4),[Gu],(b,[o])=>o.evaluate(b).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Gu,[us,us,us],Dv],rgba:[Gu,[us,us,us,us],Dv],hsl:[Gu,[us,us,us],Nv],hsla:[Gu,[us,us,us,us],Nv],has:{type:Mo,overloads:[[[ao],(b,[o])=>Sw(o.evaluate(b),b.properties())],[[ao,Op],(b,[o,g])=>Sw(o.evaluate(b),g.evaluate(b))]]},get:{type:Ao,overloads:[[[ao],(b,[o])=>Lv(o.evaluate(b),b.properties())],[[ao,Op],(b,[o,g])=>Lv(o.evaluate(b),g.evaluate(b))]]},"feature-state":[Ao,[ao],(b,[o])=>Lv(o.evaluate(b),b.featureState||{})],properties:[Op,[],b=>b.properties()],"geometry-type":[ao,[],b=>b.geometryType()],worldview:[ao,[],b=>b.globals.worldview||""],"is-active-floor":[Mo,Mm(ao),(b,o)=>{if(!(b.globals.activeFloors&&b.globals.activeFloors.size>0))return!1;const g=b.globals.activeFloors;return o.some(_e=>{const rt=_e.evaluate(b);return g.has(rt)})}],id:[Ao,[],b=>b.id()],zoom:[us,[],b=>b.globals.zoom],pitch:[us,[],b=>b.globals.pitch||0],"distance-from-center":[us,[],b=>b.distanceFromCenter()],"measure-light":[us,[ao],(b,[o])=>b.measureLight(o.evaluate(b))],"heatmap-density":[us,[],b=>b.globals.heatmapDensity||0],"line-progress":[us,[],b=>b.globals.lineProgress||0],"raster-value":[us,[],b=>b.globals.rasterValue||0],"raster-particle-speed":[us,[],b=>b.globals.rasterParticleSpeed||0],"sky-radial-progress":[us,[],b=>b.globals.skyRadialProgress||0],accumulated:[Ao,[],b=>b.globals.accumulated===void 0?null:b.globals.accumulated],"+":[us,Mm(us),(b,o)=>{let g=0;for(const _e of o)g+=_e.evaluate(b);return g}],"*":[us,Mm(us),(b,o)=>{let g=1;for(const _e of o)g*=_e.evaluate(b);return g}],"-":{type:us,overloads:[[[us,us],(b,[o,g])=>o.evaluate(b)-g.evaluate(b)],[[us],(b,[o])=>-o.evaluate(b)]]},"/":[us,[us,us],(b,[o,g])=>o.evaluate(b)/g.evaluate(b)],"%":[us,[us,us],(b,[o,g])=>o.evaluate(b)%g.evaluate(b)],ln2:[us,[],()=>Math.LN2],pi:[us,[],()=>Math.PI],e:[us,[],()=>Math.E],"^":[us,[us,us],(b,[o,g])=>Math.pow(o.evaluate(b),g.evaluate(b))],sqrt:[us,[us],(b,[o])=>Math.sqrt(o.evaluate(b))],log10:[us,[us],(b,[o])=>Math.log(o.evaluate(b))/Math.LN10],ln:[us,[us],(b,[o])=>Math.log(o.evaluate(b))],log2:[us,[us],(b,[o])=>Math.log2(o.evaluate(b))],sin:[us,[us],(b,[o])=>Math.sin(o.evaluate(b))],cos:[us,[us],(b,[o])=>Math.cos(o.evaluate(b))],tan:[us,[us],(b,[o])=>Math.tan(o.evaluate(b))],asin:[us,[us],(b,[o])=>Math.asin(o.evaluate(b))],acos:[us,[us],(b,[o])=>Math.acos(o.evaluate(b))],atan:[us,[us],(b,[o])=>Math.atan(o.evaluate(b))],min:[us,Mm(us),(b,o)=>Math.min(...o.map(g=>g.evaluate(b)))],max:[us,Mm(us),(b,o)=>Math.max(...o.map(g=>g.evaluate(b)))],abs:[us,[us],(b,[o])=>Math.abs(o.evaluate(b))],round:[us,[us],(b,[o])=>{const g=o.evaluate(b);return g<0?-Math.round(-g):Math.round(g)}],floor:[us,[us],(b,[o])=>Math.floor(o.evaluate(b))],ceil:[us,[us],(b,[o])=>Math.ceil(o.evaluate(b))],"filter-==":[Mo,[ao,Ao],(b,[o,g])=>b.properties()[o.value]===g.value],"filter-id-==":[Mo,[Ao],(b,[o])=>b.id()===o.value],"filter-type-==":[Mo,[ao],(b,[o])=>b.geometryType()===o.value],"filter-<":[Mo,[ao,Ao],(b,[o,g])=>{const _e=b.properties()[o.value],rt=g.value;return typeof _e==typeof rt&&_e<rt}],"filter-id-<":[Mo,[Ao],(b,[o])=>{const g=b.id(),_e=o.value;return typeof g==typeof _e&&g<_e}],"filter->":[Mo,[ao,Ao],(b,[o,g])=>{const _e=b.properties()[o.value],rt=g.value;return typeof _e==typeof rt&&_e>rt}],"filter-id->":[Mo,[Ao],(b,[o])=>{const g=b.id(),_e=o.value;return typeof g==typeof _e&&g>_e}],"filter-<=":[Mo,[ao,Ao],(b,[o,g])=>{const _e=b.properties()[o.value],rt=g.value;return typeof _e==typeof rt&&_e<=rt}],"filter-id-<=":[Mo,[Ao],(b,[o])=>{const g=b.id(),_e=o.value;return typeof g==typeof _e&&g<=_e}],"filter->=":[Mo,[ao,Ao],(b,[o,g])=>{const _e=b.properties()[o.value],rt=g.value;return typeof _e==typeof rt&&_e>=rt}],"filter-id->=":[Mo,[Ao],(b,[o])=>{const g=b.id(),_e=o.value;return typeof g==typeof _e&&g>=_e}],"filter-has":[Mo,[Ao],(b,[o])=>o.value in b.properties()],"filter-has-id":[Mo,[],b=>b.id()!==null&&b.id()!==void 0],"filter-type-in":[Mo,[Au(ao)],(b,[o])=>o.value.indexOf(b.geometryType())>=0],"filter-id-in":[Mo,[Au(Ao)],(b,[o])=>o.value.indexOf(b.id())>=0],"filter-in-small":[Mo,[ao,Au(Ao)],(b,[o,g])=>g.value.indexOf(b.properties()[o.value])>=0],"filter-in-large":[Mo,[ao,Au(Ao)],(b,[o,g])=>function(_e,rt,ot,at){for(;ot<=at;){const ut=ot+at>>1;if(rt[ut]===_e)return!0;rt[ut]>_e?at=ut-1:ot=ut+1}return!1}(b.properties()[o.value],g.value,0,g.value.length-1)],all:{type:Mo,overloads:[[[Mo,Mo],(b,[o,g])=>o.evaluate(b)&&g.evaluate(b)],[Mm(Mo),(b,o)=>{for(const g of o)if(!g.evaluate(b))return!1;return!0}]]},any:{type:Mo,overloads:[[[Mo,Mo],(b,[o,g])=>o.evaluate(b)||g.evaluate(b)],[Mm(Mo),(b,o)=>{for(const g of o)if(g.evaluate(b))return!0;return!1}]]},"!":[Mo,[Mo],(b,[o])=>!o.evaluate(b)],"is-supported-script":[Mo,[ao],(b,[o])=>{const g=b.globals&&b.globals.isSupportedScript;return!g||g(o.evaluate(b))}],upcase:[ao,[ao],(b,[o])=>o.evaluate(b).toUpperCase()],downcase:[ao,[ao],(b,[o])=>o.evaluate(b).toLowerCase()],concat:[ao,Mm(Ao),(b,o)=>o.map(g=>pp(g.evaluate(b))).join("")],"resolved-locale":[ao,[xx],(b,[o])=>o.evaluate(b).resolvedLocale()],random:[us,[us,us,Ao],(b,o)=>{const[g,_e,rt]=o.map(at=>at.evaluate(b));if(g>_e||g===_e)return g;let ot;if(typeof rt=="string")ot=function(at){let ut=0;if(at.length===0)return ut;for(let ft=0;ft<at.length;ft++)ut=(ut<<5)-ut+at.charCodeAt(ft),ut|=0;return ut}(rt);else{if(typeof rt!="number")throw new ou(`Invalid seed input: ${rt}`);ot=rt}return g+Tw(ot)()*(_e-g)}]});class Kx{constructor(o,g,_e,rt,ot){this.expression=o,this._warningHistory={},this._scope=_e,this._options=rt,this._iconImageUseTheme=ot,this._evaluator=new Ex(_e,rt,ot),this._defaultValue=g?function(at){return at.type==="color"&&(qx(at.default)||Array.isArray(at.default))?new Ro(0,0,0,0):at.type==="color"?Ro.parse(at.default)||null:at.default===void 0?null:at.default}(g):null,this._enumValues=g&&g.type==="enum"?g.values:null,this.configDependencies=n0(o),this.isIndoorDependent=Hx(o)}evaluateWithoutErrorHandling(o,g,_e,rt,ot,at,ut,ft){return this._evaluator.globals=o,this._evaluator.feature=g,this._evaluator.featureState=_e,this._evaluator.canonical=rt||null,this._evaluator.availableImages=ot||null,this._evaluator.formattedSection=at,this._evaluator.featureTileCoord=ut||null,this._evaluator.featureDistanceData=ft||null,this.expression.evaluate(this._evaluator)}evaluate(o,g,_e,rt,ot,at,ut,ft,xt){this._evaluator||(this._evaluator=new Ex(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=o,this._evaluator.feature=g||null,this._evaluator.featureState=_e||null,this._evaluator.canonical=rt||null,this._evaluator.availableImages=ot||null,this._evaluator.formattedSection=at||null,this._evaluator.featureTileCoord=ut||null,this._evaluator.featureDistanceData=ft||null,this._evaluator.iconImageUseTheme=xt||null;try{const Ct=this.expression.evaluate(this._evaluator);if(Ct==null||typeof Ct=="number"&&Ct!=Ct)return this._defaultValue;if(this._enumValues&&!(Ct in this._enumValues))throw new ou(`Expected value to be one of ${Object.keys(this._enumValues).map(Rt=>JSON.stringify(Rt)).join(", ")}, but found ${JSON.stringify(Ct)} instead.`);return Ct}catch(Ct){const Rt=Ct;return this._warningHistory[Rt.message]||(this._warningHistory[Rt.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${Rt.message}`)),this._defaultValue}}}function Iy(b){return Array.isArray(b)&&b.length>0&&typeof b[0]=="string"&&b[0]in N0}function Nm(b,o,g,_e,rt){const ot=new Lx(N0,[],o?function(ut){const ft={color:Gu,string:ao,number:us,enum:ao,boolean:Mo,formatted:my,resolvedImage:gy};return ut.type==="array"?Au(ft[ut.value]||Ao,ut.length):ft[ut.type]}(o):void 0,void 0,void 0,g,_e,rt),at=ot.parse(b,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return at?Cw(new Kx(at,o,g,_e,rt)):Dm(ot.errors)}class L0{constructor(o,g,_e,rt){this.kind=o,this._styleExpression=g,this.isLightConstant=_e,this.isLineProgressConstant=rt,this.isStateDependent=o!=="constant"&&!Ey(g.expression),this.configDependencies=n0(g.expression),this.isIndoorDependent=Hx(g.expression)}evaluateWithoutErrorHandling(o,g,_e,rt,ot,at){return this._styleExpression.evaluateWithoutErrorHandling(o,g,_e,rt,ot,at)}evaluate(o,g,_e,rt,ot,at,ut){return this._styleExpression.evaluate(o,g,_e,rt,ot,at,void 0,void 0,ut)}}class i0{constructor(o,g,_e,rt,ot,at){this.kind=o,this.zoomStops=_e,this._styleExpression=g,this.isStateDependent=o!=="camera"&&!Ey(g.expression),this.isIndoorDependent=Hx(g.expression),this.isLightConstant=ot,this.isLineProgressConstant=at,this.configDependencies=n0(g.expression),this.interpolationType=rt}evaluateWithoutErrorHandling(o,g,_e,rt,ot,at){return this._styleExpression.evaluateWithoutErrorHandling(o,g,_e,rt,ot,at)}evaluate(o,g,_e,rt,ot,at){return this._styleExpression.evaluate(o,g,_e,rt,ot,at)}interpolationFactor(o,g,_e){return this.interpolationType?ep.interpolationFactor(this.interpolationType,o,g,_e):0}}function Ov(b,o,g,_e,rt){if((b=Nm(b,o,g,_e,rt)).result==="error")return b;const ot=b.value.expression,at=A0(ot);if(!at&&!Py(o))return Dm([new dp("","data expressions not supported")]);const ut=R0(ot,["zoom","pitch","distance-from-center"]);if(!ut&&!Rw(o))return Dm([new dp("","zoom expressions not supported")]);const ft=R0(ot,["measure-light"]);if(!ft&&!Aw(o))return Dm([new dp("","measure-light expression not supported")]);const xt=R0(ot,["line-progress"]);if(!xt&&!function(kt){return jv(kt.expression,"line-progress")}(o))return Dm([new dp("","line-progress expression not supported")]);const Ct=o.expression&&o.expression.relaxZoomRestriction,Rt=Ap(ot);return Rt||ut||Ct?Rt instanceof dp?Dm([Rt]):Rt instanceof ep&&!Wx(o)?Dm([new dp("",'"interpolate" expressions cannot be used with this property')]):Cw(Rt?new i0(at&&xt?"camera":"composite",b.value,Rt.labels,Rt instanceof ep?Rt.interpolation:void 0,ft,xt):new L0(at&&xt?"constant":"source",b.value,ft,xt)):Dm([new dp("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Xx{constructor(o,g){this._parameters=o,this._specification=g,Object.assign(this,Iw(this._parameters,this._specification))}static deserialize(o){return new Xx(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Ap(b){let o=null;if(b instanceof _f)o=Ap(b.result);else if(b instanceof Cy){for(const g of b.args)if(o=Ap(g),o)break}else(b instanceof Ty||b instanceof ep)&&b.input instanceof Ou&&b.input.name==="zoom"&&(o=b);return o instanceof dp||b.eachChild(g=>{const _e=Ap(g);_e instanceof dp?o=_e:o&&_e&&o!==_e&&(o=new dp("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}var Fv,Dw,Nw=function(){if(Dw)return Fv;Dw=1,Fv=o;var b=3;function o(g,_e,rt){var ot=this.cells=[];if(g instanceof ArrayBuffer){this.arrayBuffer=g;var at=new Int32Array(this.arrayBuffer);g=at[0],this.d=(_e=at[1])+2*(rt=at[2]);for(var ut=0;ut<this.d*this.d;ut++){var ft=at[b+ut],xt=at[b+ut+1];ot.push(ft===xt?null:at.subarray(ft,xt))}var Ct=at[b+ot.length+1];this.keys=at.subarray(at[b+ot.length],Ct),this.bboxes=at.subarray(Ct),this.insert=this._insertReadonly}else{this.d=_e+2*rt;for(var Rt=0;Rt<this.d*this.d;Rt++)ot.push([]);this.keys=[],this.bboxes=[]}this.n=_e,this.extent=g,this.padding=rt,this.scale=_e/g,this.uid=0;var kt=rt/_e*g;this.min=-kt,this.max=g+kt}return o.prototype.insert=function(g,_e,rt,ot,at){this._forEachCell(_e,rt,ot,at,this._insertCell,this.uid++),this.keys.push(g),this.bboxes.push(_e),this.bboxes.push(rt),this.bboxes.push(ot),this.bboxes.push(at)},o.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},o.prototype._insertCell=function(g,_e,rt,ot,at,ut){this.cells[at].push(ut)},o.prototype.query=function(g,_e,rt,ot,at){var ut=this.min,ft=this.max;if(g<=ut&&_e<=ut&&ft<=rt&&ft<=ot&&!at)return Array.prototype.slice.call(this.keys);var xt=[];return this._forEachCell(g,_e,rt,ot,this._queryCell,xt,{},at),xt},o.prototype._queryCell=function(g,_e,rt,ot,at,ut,ft,xt){var Ct=this.cells[at];if(Ct!==null)for(var Rt=this.keys,kt=this.bboxes,zt=0;zt<Ct.length;zt++){var Ut=Ct[zt];if(ft[Ut]===void 0){var Kt=4*Ut;(xt?xt(kt[Kt+0],kt[Kt+1],kt[Kt+2],kt[Kt+3]):g<=kt[Kt+2]&&_e<=kt[Kt+3]&&rt>=kt[Kt+0]&&ot>=kt[Kt+1])?(ft[Ut]=!0,ut.push(Rt[Ut])):ft[Ut]=!1}}},o.prototype._forEachCell=function(g,_e,rt,ot,at,ut,ft,xt){for(var Ct=this._convertToCellCoord(g),Rt=this._convertToCellCoord(_e),kt=this._convertToCellCoord(rt),zt=this._convertToCellCoord(ot),Ut=Ct;Ut<=kt;Ut++)for(var Kt=Rt;Kt<=zt;Kt++){var er=this.d*Kt+Ut;if((!xt||xt(this._convertFromCellCoord(Ut),this._convertFromCellCoord(Kt),this._convertFromCellCoord(Ut+1),this._convertFromCellCoord(Kt+1)))&&at.call(this,g,_e,rt,ot,er,ut,ft,xt))return}},o.prototype._convertFromCellCoord=function(g){return(g-this.padding)/this.scale},o.prototype._convertToCellCoord=function(g){return Math.max(0,Math.min(this.d-1,Math.floor(g*this.scale)+this.padding))},o.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var g=this.cells,_e=b+this.cells.length+1+1,rt=0,ot=0;ot<this.cells.length;ot++)rt+=this.cells[ot].length;var at=new Int32Array(_e+rt+this.keys.length+this.bboxes.length);at[0]=this.extent,at[1]=this.n,at[2]=this.padding;for(var ut=_e,ft=0;ft<g.length;ft++){var xt=g[ft];at[b+ft]=ut,at.set(xt,ut),ut+=xt.length}return at[b+g.length]=ut,at.set(this.keys,ut),at[b+g.length+1]=ut+=this.keys.length,at.set(this.bboxes,ut),ut+=this.bboxes.length,at.buffer},Fv}(),j0=zo(Nw);const s0={};function Jn(b,o,g={}){Object.defineProperty(b,"_classRegistryKey",{value:o,writable:!1}),s0[o]={klass:b,omit:g.omit||[]}}Jn(Object,"Object"),j0.serialize=function(b,o){const g=b.toArrayBuffer();return o&&o.add(g),{buffer:g}},j0.deserialize=function(b){return new j0(b.buffer)},Object.defineProperty(j0,"name",{value:"Grid"}),Jn(j0,"Grid"),delete _n.prototype.constructor,Jn(Ro,"Color"),Jn(Error,"Error"),Jn(Lu,"Formatted"),Jn(vx,"FormattedSection"),Jn(Xu,"AJAXError"),Jn(ju,"ResolvedImage"),Jn(Xx,"StylePropertyFunction"),Jn(Kx,"StyleExpression",{omit:["_evaluator"]}),Jn(Nu,"ImageId"),Jn(Yp,"ImageVariant"),Jn(i0,"ZoomDependentExpression"),Jn(L0,"ZoomConstantExpression"),Jn(Ou,"CompoundExpression",{omit:["_evaluate"]});for(const b in N0)s0[N0[b]._classRegistryKey]||Jn(N0[b],`Expression${b}`);function ky(b){return b&&(b instanceof ArrayBuffer||b.constructor&&b.constructor.name==="ArrayBuffer")}function em(b,o){if(b==null||typeof b=="boolean"||typeof b=="number"||typeof b=="string"||b instanceof Boolean||b instanceof Number||b instanceof String||b instanceof Date||b instanceof RegExp)return b;if(ky(b)||b instanceof ImageBitmap)return o&&o.add(b),b;if(ArrayBuffer.isView(b))return o&&o.add(b.buffer),b;if(b instanceof ImageData)return o&&o.add(b.data.buffer),b;if(Array.isArray(b)){const g=[];for(const _e of b)g.push(em(_e,o));return g}if(b instanceof Map){const g={$name:"Map",entries:[]};for(const[_e,rt]of b.entries())g.entries.push(em(_e),em(rt,o));return g}if(b instanceof Set){const g={$name:"Set"};let _e=0;for(const rt of b.values())g[++_e]=em(rt);return g}if(typeof b=="bigint")return{$name:"BigInt",value:b.toString()};if(typeof b=="object"){const g=b.constructor,_e=g._classRegistryKey;if(!_e)throw new Error(`Can't serialize object of unregistered class "${g.name}".`);const rt=g.serialize?g.serialize(b,o):{};if(!g.serialize){for(const ot in b)b.hasOwnProperty(ot)&&(s0[_e].omit.indexOf(ot)>=0||(rt[ot]=em(b[ot],o)));b instanceof Error&&(rt.message=b.message)}if(rt.$name)throw new Error("$name property is reserved for worker serialization logic.");return _e!=="Object"&&(rt.$name=_e),rt}throw new Error("can't serialize object of type "+typeof b)}function Lm(b){if(b==null||typeof b=="boolean"||typeof b=="number"||typeof b=="string"||b instanceof Boolean||b instanceof Number||b instanceof String||b instanceof Date||b instanceof RegExp||ky(b)||b instanceof ImageBitmap||ArrayBuffer.isView(b)||b instanceof ImageData)return b;if(Array.isArray(b))return b.map(Lm);if(typeof b=="object"){const o=b.$name||"Object";if(o==="Map"){const rt=b.entries||[],ot=new Map;for(let at=0;at<rt.length;at+=2)ot.set(Lm(rt[at]),Lm(rt[at+1]));return ot}if(o==="Set"){const rt=new Set;for(const ot of Object.keys(b))ot!=="$name"&&rt.add(Lm(b[ot]));return rt}if(o==="BigInt")return BigInt(b.value);const{klass:g}=s0[o];if(!g)throw new Error(`Can't deserialize unregistered class "${o}".`);if(g.deserialize)return g.deserialize(b);const _e=Object.create(g.prototype);for(const rt of Object.keys(b))rt!=="$name"&&(_e[rt]=Lm(b[rt]));return _e}throw new Error("can't deserialize object of type "+typeof b)}const vs={"Latin-1 Supplement":b=>b>=128&&b<=255,Arabic:b=>b>=1536&&b<=1791,"Arabic Supplement":b=>b>=1872&&b<=1919,"Arabic Extended-A":b=>b>=2208&&b<=2303,"Hangul Jamo":b=>b>=4352&&b<=4607,"Unified Canadian Aboriginal Syllabics":b=>b>=5120&&b<=5759,Khmer:b=>b>=6016&&b<=6143,"Unified Canadian Aboriginal Syllabics Extended":b=>b>=6320&&b<=6399,"General Punctuation":b=>b>=8192&&b<=8303,"Letterlike Symbols":b=>b>=8448&&b<=8527,"Number Forms":b=>b>=8528&&b<=8591,"Miscellaneous Technical":b=>b>=8960&&b<=9215,"Control Pictures":b=>b>=9216&&b<=9279,"Optical Character Recognition":b=>b>=9280&&b<=9311,"Enclosed Alphanumerics":b=>b>=9312&&b<=9471,"Geometric Shapes":b=>b>=9632&&b<=9727,"Miscellaneous Symbols":b=>b>=9728&&b<=9983,"Miscellaneous Symbols and Arrows":b=>b>=11008&&b<=11263,"CJK Radicals Supplement":b=>b>=11904&&b<=12031,"Kangxi Radicals":b=>b>=12032&&b<=12255,"Ideographic Description Characters":b=>b>=12272&&b<=12287,"CJK Symbols and Punctuation":b=>b>=12288&&b<=12351,Hiragana:b=>b>=12352&&b<=12447,Katakana:b=>b>=12448&&b<=12543,Bopomofo:b=>b>=12544&&b<=12591,"Hangul Compatibility Jamo":b=>b>=12592&&b<=12687,Kanbun:b=>b>=12688&&b<=12703,"Bopomofo Extended":b=>b>=12704&&b<=12735,"CJK Strokes":b=>b>=12736&&b<=12783,"Katakana Phonetic Extensions":b=>b>=12784&&b<=12799,"Enclosed CJK Letters and Months":b=>b>=12800&&b<=13055,"CJK Compatibility":b=>b>=13056&&b<=13311,"CJK Unified Ideographs Extension A":b=>b>=13312&&b<=19903,"Yijing Hexagram Symbols":b=>b>=19904&&b<=19967,"CJK Unified Ideographs":b=>b>=19968&&b<=40959,"Yi Syllables":b=>b>=40960&&b<=42127,"Yi Radicals":b=>b>=42128&&b<=42191,"Hangul Jamo Extended-A":b=>b>=43360&&b<=43391,"Hangul Syllables":b=>b>=44032&&b<=55215,"Hangul Jamo Extended-B":b=>b>=55216&&b<=55295,"Private Use Area":b=>b>=57344&&b<=63743,"CJK Compatibility Ideographs":b=>b>=63744&&b<=64255,"Arabic Presentation Forms-A":b=>b>=64336&&b<=65023,"Vertical Forms":b=>b>=65040&&b<=65055,"CJK Compatibility Forms":b=>b>=65072&&b<=65103,"Small Form Variants":b=>b>=65104&&b<=65135,"Arabic Presentation Forms-B":b=>b>=65136&&b<=65279,"Halfwidth and Fullwidth Forms":b=>b>=65280&&b<=65519,Osage:b=>b>=66736&&b<=66815,"CJK Unified Ideographs Extension B":b=>b>=131072&&b<=173791};function My(b){for(const o of b)if(Zx(o.charCodeAt(0)))return!0;return!1}function Bv(b){for(const o of b)if(!Lw(o.charCodeAt(0)))return!1;return!0}function Lw(b){return!(vs.Arabic(b)||vs["Arabic Supplement"](b)||vs["Arabic Extended-A"](b)||vs["Arabic Presentation Forms-A"](b)||vs["Arabic Presentation Forms-B"](b))}function Zx(b){return!(b!==746&&b!==747&&(b<4352||!(vs["Bopomofo Extended"](b)||vs.Bopomofo(b)||vs["CJK Compatibility Forms"](b)&&!(b>=65097&&b<=65103)||vs["CJK Compatibility Ideographs"](b)||vs["CJK Compatibility"](b)||vs["CJK Radicals Supplement"](b)||vs["CJK Strokes"](b)||!(!vs["CJK Symbols and Punctuation"](b)||b>=12296&&b<=12305||b>=12308&&b<=12319||b===12336)||vs["CJK Unified Ideographs Extension A"](b)||vs["CJK Unified Ideographs"](b)||vs["Enclosed CJK Letters and Months"](b)||vs["Hangul Compatibility Jamo"](b)||vs["Hangul Jamo Extended-A"](b)||vs["Hangul Jamo Extended-B"](b)||vs["Hangul Jamo"](b)||vs["Hangul Syllables"](b)||vs.Hiragana(b)||vs["Ideographic Description Characters"](b)||vs.Kanbun(b)||vs["Kangxi Radicals"](b)||vs["Katakana Phonetic Extensions"](b)||vs.Katakana(b)&&b!==12540||!(!vs["Halfwidth and Fullwidth Forms"](b)||b===65288||b===65289||b===65293||b>=65306&&b<=65310||b===65339||b===65341||b===65343||b>=65371&&b<=65503||b===65507||b>=65512&&b<=65519)||!(!vs["Small Form Variants"](b)||b>=65112&&b<=65118||b>=65123&&b<=65126)||vs["Unified Canadian Aboriginal Syllabics"](b)||vs["Unified Canadian Aboriginal Syllabics Extended"](b)||vs["Vertical Forms"](b)||vs["Yijing Hexagram Symbols"](b)||vs["Yi Syllables"](b)||vs["Yi Radicals"](b))))}function Yx(b){return!(Zx(b)||function(o){return!!(vs["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||vs["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||vs["Letterlike Symbols"](o)||vs["Number Forms"](o)||vs["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||vs["Control Pictures"](o)&&o!==9251||vs["Optical Character Recognition"](o)||vs["Enclosed Alphanumerics"](o)||vs["Geometric Shapes"](o)||vs["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||vs["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||vs["CJK Symbols and Punctuation"](o)||vs.Katakana(o)||vs["Private Use Area"](o)||vs["CJK Compatibility Forms"](o)||vs["Small Form Variants"](o)||vs["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(b))}function Qx(b){return vs.Arabic(b)||vs["Arabic Supplement"](b)||vs["Arabic Extended-A"](b)||vs["Arabic Presentation Forms-A"](b)||vs["Arabic Presentation Forms-B"](b)}function zv(b){return b>=1424&&b<=2303||vs["Arabic Presentation Forms-A"](b)||vs["Arabic Presentation Forms-B"](b)}function tm(b,o){return!(!o&&zv(b)||b>=2304&&b<=3583||b>=3840&&b<=4255||vs.Khmer(b))}function gT(b){for(const o of b)if(zv(o.charCodeAt(0)))return!0;return!1}const Zu={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Vv=null,Fu=Zu.unavailable,rm=null;const Dy=function(b){b&&typeof b=="string"&&b.indexOf("NetworkError")>-1&&(Fu=Zu.error),Vv&&Vv(b)};function Jx(){e_.fire(new jp("pluginStateChange",{pluginStatus:Fu,pluginURL:rm}))}const e_=new Jm,Ny=function(){return Fu},jw=function(){if(Fu!==Zu.deferred||!rm)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Fu=Zu.loading,Jx(),rm&&Zp({url:rm},b=>{b?Dy(b):(Fu=Zu.loaded,Jx())})},im={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Fu===Zu.loaded||im.applyArabicShaping!=null,isLoading:()=>Fu===Zu.loading,setState(b){Fu=b.pluginStatus,rm=b.pluginURL},isParsing:()=>Fu===Zu.parsing,isParsed:()=>Fu===Zu.parsed,getPluginURL:()=>rm};class Xo{constructor(o,g){this.zoom=o,g?(this.now=g.now,this.fadeDuration=g.fadeDuration,this.transition=g.transition,this.pitch=g.pitch,this.brightness=g.brightness,this.worldview=g.worldview,this.activeFloors=g.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(o){return function(g,_e){for(const rt of g)if(!tm(rt.charCodeAt(0),_e))return!1;return!0}(o,im.isLoaded())}}class t_{constructor(o,g,_e,rt,ot){this.property=o,this.value=g,this.expression=function(at,ut,ft,xt,Ct){if(qx(at))return new Xx(at,ut);if(Iy(at)||Array.isArray(at)&&at.length>0){const Rt=Ov(at,ut,ft,xt,Ct);if(Rt.result==="error")throw new Error(Rt.value.map(kt=>`${kt.key}: ${kt.message}`).join(", "));return Rt.value}{let Rt=at;return typeof at=="string"&&ut.type==="color"&&(Rt=Ro.parse(at)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>Rt}}}(g===void 0?o.specification.default:g,o.specification,_e,rt,ot)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,g,_e,rt){return this.property.possiblyEvaluate(this,o,g,_e,rt)}}class Uv{constructor(o,g,_e,rt){this.property=o,this.value=new t_(o,void 0,g,_e,rt)}transitioned(o,g){return new Fw(this.property,this.value,g,Object.assign({},o.transition,this.transition),o.now)}untransitioned(){return new Fw(this.property,this.value,null,{},0)}}class Ow{constructor(o,g,_e,rt){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues),this._scope=g,this._options=_e,this._iconImageUseTheme=rt,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(o){return mn(this._values[o].value.value)}setValue(o,g){this._values.hasOwnProperty(o)||(this._values[o]=new Uv(this._values[o].property,this._scope,this._options,this._iconImageUseTheme)),this._values[o].value=new t_(this._values[o].property,g===null?void 0:mn(g),this._scope,this._options,this._iconImageUseTheme),this._values[o].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[o].value.isIndoorDependent())}setTransitionOrValue(o,g){g&&(this._options=g);const _e=this._properties.properties;if(o)for(const rt in o){const ot=o[rt];if(rt.endsWith("-transition")){const at=rt.slice(0,-11);_e[at]&&this.setTransition(at,ot)}else _e.hasOwnProperty(rt)&&this.setValue(rt,ot)}}getTransition(o){return mn(this._values[o].transition)}setTransition(o,g){this._values.hasOwnProperty(o)||(this._values[o]=new Uv(this._values[o].property)),this._values[o].transition=mn(g)||void 0}serialize(){const o={};for(const g of Object.keys(this._values)){const _e=this.getValue(g);_e!==void 0&&(o[g]=_e);const rt=this.getTransition(g);rt!==void 0&&(o[`${g}-transition`]=rt)}return o}transitioned(o,g){const _e=new Bw(this._properties);for(const rt of Object.keys(this._values))_e._values[rt]=this._values[rt].transitioned(o,g._values[rt]);return _e}untransitioned(){const o=new Bw(this._properties);for(const g of Object.keys(this._values))o._values[g]=this._values[g].untransitioned();return o}isIndoorDependent(){return this._isIndoorDependent}}class Fw{constructor(o,g,_e,rt,ot){const at=rt.delay||0,ut=rt.duration||0;ot=ot||0,this.property=o,this.value=g,this.begin=ot+at,this.end=this.begin+ut,o.specification.transition&&(rt.delay||rt.duration)&&(this.prior=_e)}possiblyEvaluate(o,g,_e){const rt=o.now||0,ot=this.value.possiblyEvaluate(o,g,_e),at=this.prior;if(at){if(rt>this.end)return this.prior=null,ot;if(this.value.isDataDriven())return this.prior=null,ot;if(rt<this.begin)return at.possiblyEvaluate(o,g,_e);{const ut=(rt-this.begin)/(this.end-this.begin);return this.property.interpolate(at.possiblyEvaluate(o,g,_e),ot,qm(ut))}}return ot}}class Bw{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,g,_e){const rt=new a0(this._properties);for(const ot of Object.keys(this._values))rt._values[ot]=this._values[ot].possiblyEvaluate(o,g,_e);return rt}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class zw{constructor(o,g,_e,rt){this._properties=o,this._values=Object.create(o.defaultPropertyValues),this._scope=g,this._options=_e,this._iconImageUseTheme=rt,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(o){return mn(this._values[o].value)}setValue(o,g){this._values[o]=new t_(this._values[o].property,g===null?void 0:mn(g),this._scope,this._options,this._iconImageUseTheme),this._values[o].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[o].isIndoorDependent())}serialize(){const o={};for(const g of Object.keys(this._values)){const _e=this.getValue(g);_e!==void 0&&(o[g]=_e)}return o}possiblyEvaluate(o,g,_e,rt){const ot=new a0(this._properties);for(const at of Object.keys(this._values))ot._values[at]=this._values[at].possiblyEvaluate(o,g,_e,rt);return ot}isIndoorDependent(){return this._isIndoorDependent}}class o0{constructor(o,g,_e,rt){this.property=o,this.value=g,this.parameters=_e,this.iconImageUseTheme=rt}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,g,_e,rt){return this.property.evaluate(this.value,this.parameters,o,g,_e,rt,this.iconImageUseTheme)}}class a0{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class Nn{constructor(o){this.specification=o}possiblyEvaluate(o,g){return o.expression.evaluate(g)}interpolate(o,g,_e){const rt=fy[this.specification.type];return rt?rt(o,g,_e):o}}class Bn{constructor(o,g){this.specification=o,this.overrides=g}possiblyEvaluate(o,g,_e,rt,ot){return o.expression.kind==="constant"||o.expression.kind==="camera"?new o0(this,{kind:"constant",value:o.expression.evaluate(g,null,{},_e,rt,void 0,ot)},g):new o0(this,o.expression,g,ot)}interpolate(o,g,_e){if(o.value.kind!=="constant"||g.value.kind!=="constant")return o;if(o.value.value===void 0||g.value.value===void 0)return new o0(this,{kind:"constant",value:void 0},o.parameters);const rt=fy[this.specification.type];return rt?new o0(this,{kind:"constant",value:rt(o.value.value,g.value.value,_e)},o.parameters):o}evaluate(o,g,_e,rt,ot,at,ut){return o.kind==="constant"?o.value:o.evaluate(g,_e,rt,ot,at,void 0,ut)}}class l0{constructor(o){this.specification=o}possiblyEvaluate(o,g,_e,rt){return!!o.expression.evaluate(g,null,{},_e,rt)}interpolate(){return!1}}class Dl{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const g=new Xo(0,{});for(const _e in o){const rt=o[_e];rt.specification.overridable&&this.overridableProperties.push(_e);const ot=this.defaultPropertyValues[_e]=new t_(rt,void 0),at=this.defaultTransitionablePropertyValues[_e]=new Uv(rt);this.defaultTransitioningPropertyValues[_e]=at.untransitioned(),this.defaultPossiblyEvaluatedValues[_e]=ot.possiblyEvaluate(g)}}}Jn(Bn,"DataDrivenProperty"),Jn(Nn,"DataConstantProperty"),Jn(l0,"ColorRampProperty");var Hr=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Vw(b){return b instanceof Number||b instanceof String||b instanceof Boolean?b.valueOf():b}function r_(b){if(Array.isArray(b))return b.map(r_);if(b instanceof Object&&!(b instanceof Number||b instanceof String||b instanceof Boolean)){const o={};for(const g in b)o[g]=r_(b[g]);return o}return Vw(b)}function Up(b){if(b===!0||b===!1)return!0;if(!Array.isArray(b)||b.length===0)return!1;switch(b[0]){case"has":return b.length>=2&&b[1]!=="$id"&&b[1]!=="$type";case"in":return b.length>=3&&(typeof b[1]!="string"||Array.isArray(b[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return b.length!==3||Array.isArray(b[1])||Array.isArray(b[2]);case"any":case"all":for(const o of b.slice(1))if(!Up(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}function n_(b,o="",g=null,_e="fill"){if(b==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Up(b)||(b=i_(b));const rt=b;let ot=!0;try{ot=function(Ct){if(!O0(Ct))return Ct;let Rt=r_(Ct);return Uw(Rt),Rt=c0(Rt),Rt}(rt)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(rt,null,2)}
        `)}let at=null,ut=null;if(_e!=="background"&&_e!=="sky"&&_e!=="slot"){ut=Hr[`filter_${_e}`];const Ct=Nm(ot,ut,o,g);if(Ct.result==="error")throw new Error(Ct.value.map(Rt=>`${Rt.key}: ${Rt.message}`).join(", "));at=(Rt,kt,zt)=>Ct.value.evaluate(Rt,kt,{},zt)}let ft=null,xt=null;if(ot!==rt){const Ct=Nm(rt,ut,o,g);if(Ct.result==="error")throw new Error(Ct.value.map(Rt=>`${Rt.key}: ${Rt.message}`).join(", "));ft=(Rt,kt,zt,Ut,Kt)=>Ct.value.evaluate(Rt,kt,{},zt,void 0,void 0,Ut,Kt),xt=!A0(Ct.value.expression)}return{filter:at,dynamicFilter:ft||void 0,needGeometry:$w(ot),needFeature:!!xt}}function c0(b){if(!Array.isArray(b))return b;const o=function(g){if(yT.has(g[0])){for(let _e=1;_e<g.length;_e++)if(O0(g[_e]))return!0}return g}(b);return o===!0?o:o.map(g=>c0(g))}function Uw(b){let o=!1;const g=[];if(b[0]==="case"){for(let _e=1;_e<b.length-1;_e+=2)o=o||O0(b[_e]),g.push(b[_e+1]);g.push(b[b.length-1])}else if(b[0]==="match"){o=o||O0(b[1]);for(let _e=2;_e<b.length-1;_e+=2)g.push(b[_e+1]);g.push(b[b.length-1])}else if(b[0]==="step"){o=o||O0(b[1]);for(let _e=1;_e<b.length-1;_e+=2)g.push(b[_e+1])}o&&(b.length=0,b.push("any",...g));for(let _e=1;_e<b.length;_e++)Uw(b[_e])}function O0(b){if(!Array.isArray(b))return!1;if((o=b[0])==="pitch"||o==="distance-from-center")return!0;var o;for(let g=1;g<b.length;g++)if(O0(b[g]))return!0;return!1}const yT=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function xT(b,o){return b<o?-1:b>o?1:0}function $w(b){if(!Array.isArray(b))return!1;if(b[0]==="within"||b[0]==="distance")return!0;for(let o=1;o<b.length;o++)if($w(b[o]))return!0;return!1}function i_(b){if(!b)return!0;const o=b[0];return b.length<=1?o!=="any":o==="=="?s_(b[1],b[2],"=="):o==="!="?Ly(s_(b[1],b[2],"==")):o==="<"||o===">"||o==="<="||o===">="?s_(b[1],b[2],o):o==="any"?(g=b.slice(1),["any"].concat(g.map(i_))):o==="all"?["all"].concat(b.slice(1).map(i_)):o==="none"?["all"].concat(b.slice(1).map(i_).map(Ly)):o==="in"?o_(b[1],b.slice(2)):o==="!in"?Ly(o_(b[1],b.slice(2))):o==="has"?a_(b[1]):o!=="!has"||Ly(a_(b[1]));var g}function s_(b,o,g){switch(b){case"$type":return[`filter-type-${g}`,o];case"$id":return[`filter-id-${g}`,o];default:return[`filter-${g}`,b,o]}}function o_(b,o){if(o.length===0)return!1;switch(b){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(g=>typeof g!=typeof o[0])?["filter-in-large",b,["literal",o.sort(xT)]]:["filter-in-small",b,["literal",o]]}}function a_(b){switch(b){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",b]}}function Ly(b){return["!",b]}const u0="";function Rp(b,o){return o?`${b}${u0}${o}`:b}let Gw;const Hw=()=>Gw||(Gw=new Dl({"icon-size":new Bn(Hr.layout_symbol["icon-size"]),"icon-image":new Bn(Hr.layout_symbol["icon-image"]),"icon-rotate":new Bn(Hr.layout_symbol["icon-rotate"]),"icon-offset":new Bn(Hr.layout_symbol["icon-offset"]),"text-size":new Bn(Hr.layout_symbol["text-size"]),"text-rotate":new Bn(Hr.layout_symbol["text-rotate"]),"text-offset":new Bn(Hr.layout_symbol["text-offset"])}));class Ww{constructor(o,g,_e,rt,ot,at){const ut=Nm(o,Hr.appearance.condition);if(ut.result==="success"&&(this.condition=ut.value),this.name=g,_e){this.properties=new a0(Hw()),this.unevaluatedLayout=new zw(Hw(),rt,ot,at);for(const ft in _e)this.unevaluatedLayout.setValue(ft,_e[ft])}}isActive(o){return!(this.condition||!o.isHidden||this.name!=="hidden")||this.condition.evaluate(o.globals,o.feature,o.featureState,o.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(o){return this.properties.get(o)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(o){return this.unevaluatedLayout._values[o]}recalculate(o,g,_e){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(o,void 0,g,_e))}serialize(){const o={};return o.condition=this.condition.expression.serialize(),this.name&&(o.name=this.name),this.unevaluatedLayout&&(o.properties=this.unevaluatedLayout.serialize()),o}hasIconProperties(){const o=this.hasProperty("icon-image"),g=this.hasProperty("icon-size"),_e=this.hasProperty("icon-offset"),rt=this.hasProperty("icon-rotate");return o||g||_e||rt}hasTextProperties(){const o=this.hasProperty("text-size"),g=this.hasProperty("text-offset"),_e=this.hasProperty("text-rotate");return o||g||_e}hasProperty(o){return this.getUnevaluatedProperty(o).value!==void 0}}const qw="-transition",$p=new Set(["fill","line","background","hillshade","raster"]);class Bu extends Jm{constructor(o,g,_e,rt,ot,at){if(super(),this.id=o.id,this.fqid=Rp(this.id,_e),this.type=o.type,this.scope=_e,this.lut=rt,this.options=ot,this.iconImageUseTheme=at,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},o.type!=="custom"){if(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type&&o.type!=="background"&&o.type!=="sky"&&o.type!=="slot"){this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter;const ut=Nm(this.filter,Hr[`filter_${o.type}`]);ut.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...ut.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||ut.value.isIndoorDependent)}if(o.slot&&(this.slot=o.slot),o.appearances&&this.setAppearances(o.appearances),g.layout&&(this._unevaluatedLayout=new zw(g.layout,this.scope,ot,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),g.paint){this._transitionablePaint=new Ow(g.paint,this.scope,ot);for(const ut in o.paint)this.setPaintProperty(ut,o.paint[ut]);for(const ut in o.layout)this.setLayoutProperty(ut,o.layout[ut]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new a0(g.paint)}}}onAdd(o){}onRemove(o){}isDraped(o){return!this.is3D(!0)&&$p.has(this.type)}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,g){if(this.type==="custom"&&o==="visibility")return void(this.visibility=g);const _e=this._unevaluatedLayout;_e._properties.properties[o]&&(_e.setValue(o,g),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,..._e.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||_e.isIndoorDependent(),o==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(o){this.appearances=[],o.forEach(g=>{this.appearances.push(new Ww(g.condition,g.name,g.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(o){return o.endsWith(qw)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}isPaintProperty(o){return!!this._transitionablePaint._properties.properties[o]}setPaintProperty(o,g){const _e=this._transitionablePaint,rt=_e._properties.properties;if(o.endsWith(qw)){const Rt=o.slice(0,-11);return rt[Rt]&&_e.setTransition(Rt,g||void 0),!1}if(!rt[o])return!1;const ot=_e._values[o],at=ot.value.isDataDriven(),ut=ot.value;_e.setValue(o,g),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,..._e.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||_e.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(o);const ft=_e._values[o].value,xt=ft.isDataDriven(),Ct=o.endsWith("pattern")||o==="line-dasharray";return xt||at||Ct||this._handleOverridablePaintPropertyUpdate(o,ut,ft)}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getDefaultProgramParams(o,g,_e){return null}_handleOverridablePaintPropertyUpdate(o,g,_e){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,g){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,g,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,g)}serialize(){const o={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(o.appearances=this.appearances.map(g=>g.serialize())),Rn(o,(g,_e)=>!(g===void 0||_e==="layout"&&!Object.keys(g).length||_e==="paint"&&!Object.keys(g).length))}is3D(o){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const o in this.paint._values){const g=this.paint.get(o);if(g instanceof o0&&Py(g.property.specification)&&(g.value.kind==="source"||g.value.kind==="composite")&&g.value.isStateDependent)return!0}for(const o of this.appearances)if(!Ey(o.condition.expression))return!0;return!1}compileFilter(o){this._filterCompiled||(this._featureFilter=n_(this.filter,this.scope,o),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(o){this._stats&&(o.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(o,g,_e){return{}}queryRadius(o){}queryIntersectsFeature(o,g,_e,rt,ot,at,ut,ft,xt){}}const Kw={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class jy{constructor(o,g){this._structArray=o,this._pos1=g*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const _T=new ArrayBuffer(0);class ga{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(o,g){return o._trim(),g&&o.arrayBuffer&&g.add(o.arrayBuffer),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const g=Object.create(this.prototype);return g.arrayBuffer=o.arrayBuffer,g.length=o.length,o.arrayBuffer?g.capacity=o.arrayBuffer.byteLength/g.bytesPerElement:(g.capacity=0,g.arrayBuffer=_T),g._refreshViews(),g}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this._reallocCount++,this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const g=this.uint8;this._refreshViews(),g&&this.uint8.set(g)}}reserveForAdditional(o){this.reserve(this.length+o)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...o){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...o){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ys(b,o=1){let g=0,_e=0;return{members:b.map(rt=>{const ot=Kw[rt.type].BYTES_PER_ELEMENT,at=g=Xw(g,Math.max(o,ot)),ut=rt.components||1;return _e=Math.max(_e,ot),g+=ot*ut,{name:rt.name,type:rt.type,components:ut,offset:at}}),size:Xw(g,Math.max(_e,o)),alignment:o}}function Xw(b,o){return Math.ceil(b/o)*o}class jm extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g){const _e=this.length;return this.resize(_e+1),this.emplace(_e,o,g)}emplace(o,g,_e){const rt=2*o;return this.int16[rt+0]=g,this.int16[rt+1]=_e,o}}jm.prototype.bytesPerElement=4,Jn(jm,"StructArrayLayout2i4");class F0 extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,_e){const rt=this.length;return this.resize(rt+1),this.emplace(rt,o,g,_e)}emplace(o,g,_e,rt){const ot=3*o;return this.int16[ot+0]=g,this.int16[ot+1]=_e,this.int16[ot+2]=rt,o}}F0.prototype.bytesPerElement=6,Jn(F0,"StructArrayLayout3i6");class B0 extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt){const ot=this.length;return this.resize(ot+1),this.emplace(ot,o,g,_e,rt)}emplace(o,g,_e,rt,ot){const at=4*o;return this.int16[at+0]=g,this.int16[at+1]=_e,this.int16[at+2]=rt,this.int16[at+3]=ot,o}}B0.prototype.bytesPerElement=8,Jn(B0,"StructArrayLayout4i8");class sm extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const g=this.length;return this.resize(g+1),this.emplace(g,o)}emplace(o,g){return this.float32[1*o+0]=g,o}}sm.prototype.bytesPerElement=4,Jn(sm,"StructArrayLayout1f4");class $v extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e){const rt=this.length;return this.resize(rt+1),this.emplace(rt,o,g,_e)}emplace(o,g,_e,rt){const ot=4*o,at=2*o;return this.int16[ot+0]=g,this.int16[ot+1]=_e,this.float32[at+1]=rt,o}}$v.prototype.bytesPerElement=8,Jn($v,"StructArrayLayout2i1f8");class Gv extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,_e){const rt=this.length;return this.resize(rt+1),this.emplace(rt,o,g,_e)}emplace(o,g,_e,rt){const ot=4*o;return this.int16[ot+0]=g,this.int16[ot+1]=_e,this.int16[ot+2]=rt,o}}Gv.prototype.bytesPerElement=8,Jn(Gv,"StructArrayLayout3i8");class Hv extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot){const at=this.length;return this.resize(at+1),this.emplace(at,o,g,_e,rt,ot)}emplace(o,g,_e,rt,ot,at){const ut=5*o;return this.int16[ut+0]=g,this.int16[ut+1]=_e,this.int16[ut+2]=rt,this.int16[ut+3]=ot,this.int16[ut+4]=at,o}}Hv.prototype.bytesPerElement=10,Jn(Hv,"StructArrayLayout5i10");class l_ extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut){const ft=this.length;return this.resize(ft+1),this.emplace(ft,o,g,_e,rt,ot,at,ut)}emplace(o,g,_e,rt,ot,at,ut,ft){const xt=6*o,Ct=12*o,Rt=3*o;return this.int16[xt+0]=g,this.int16[xt+1]=_e,this.uint8[Ct+4]=rt,this.uint8[Ct+5]=ot,this.uint8[Ct+6]=at,this.uint8[Ct+7]=ut,this.float32[Rt+2]=ft,o}}l_.prototype.bytesPerElement=12,Jn(l_,"StructArrayLayout2i4ub1f12");class tp extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e){const rt=this.length;return this.resize(rt+1),this.emplace(rt,o,g,_e)}emplace(o,g,_e,rt){const ot=3*o;return this.float32[ot+0]=g,this.float32[ot+1]=_e,this.float32[ot+2]=rt,o}}tp.prototype.bytesPerElement=12,Jn(tp,"StructArrayLayout3f12");class Hu extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot){const at=this.length;return this.resize(at+1),this.emplace(at,o,g,_e,rt,ot)}emplace(o,g,_e,rt,ot,at){const ut=6*o,ft=3*o;return this.uint16[ut+0]=g,this.uint16[ut+1]=_e,this.uint16[ut+2]=rt,this.uint16[ut+3]=ot,this.float32[ft+2]=at,o}}Hu.prototype.bytesPerElement=12,Jn(Hu,"StructArrayLayout4ui1f12");class h0 extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt){const ot=this.length;return this.resize(ot+1),this.emplace(ot,o,g,_e,rt)}emplace(o,g,_e,rt,ot){const at=4*o;return this.uint16[at+0]=g,this.uint16[at+1]=_e,this.uint16[at+2]=rt,this.uint16[at+3]=ot,o}}h0.prototype.bytesPerElement=8,Jn(h0,"StructArrayLayout4ui8");class c_ extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at){const ut=this.length;return this.resize(ut+1),this.emplace(ut,o,g,_e,rt,ot,at)}emplace(o,g,_e,rt,ot,at,ut){const ft=6*o;return this.int16[ft+0]=g,this.int16[ft+1]=_e,this.int16[ft+2]=rt,this.int16[ft+3]=ot,this.int16[ft+4]=at,this.int16[ft+5]=ut,o}}c_.prototype.bytesPerElement=12,Jn(c_,"StructArrayLayout6i12");class Wv extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt){const zt=this.length;return this.resize(zt+1),this.emplace(zt,o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt)}emplace(o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt){const Ut=12*o;return this.int16[Ut+0]=g,this.int16[Ut+1]=_e,this.int16[Ut+2]=rt,this.int16[Ut+3]=ot,this.uint16[Ut+4]=at,this.uint16[Ut+5]=ut,this.uint16[Ut+6]=ft,this.uint16[Ut+7]=xt,this.int16[Ut+8]=Ct,this.int16[Ut+9]=Rt,this.int16[Ut+10]=kt,this.int16[Ut+11]=zt,o}}Wv.prototype.bytesPerElement=24,Jn(Wv,"StructArrayLayout4i4ui4i24");class qv extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at){const ut=this.length;return this.resize(ut+1),this.emplace(ut,o,g,_e,rt,ot,at)}emplace(o,g,_e,rt,ot,at,ut){const ft=10*o,xt=5*o;return this.int16[ft+0]=g,this.int16[ft+1]=_e,this.int16[ft+2]=rt,this.float32[xt+2]=ot,this.float32[xt+3]=at,this.float32[xt+4]=ut,o}}qv.prototype.bytesPerElement=20,Jn(qv,"StructArrayLayout3i3f20");class Om extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt){const ot=this.length;return this.resize(ot+1),this.emplace(ot,o,g,_e,rt)}emplace(o,g,_e,rt,ot){const at=4*o;return this.float32[at+0]=g,this.float32[at+1]=_e,this.float32[at+2]=rt,this.float32[at+3]=ot,o}}Om.prototype.bytesPerElement=16,Jn(Om,"StructArrayLayout4f16");class u_ extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const g=this.length;return this.resize(g+1),this.emplace(g,o)}emplace(o,g){return this.uint32[1*o+0]=g,o}}u_.prototype.bytesPerElement=4,Jn(u_,"StructArrayLayout1ul4");class rp extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,g){const _e=this.length;return this.resize(_e+1),this.emplace(_e,o,g)}emplace(o,g,_e){const rt=2*o;return this.uint16[rt+0]=g,this.uint16[rt+1]=_e,o}}rp.prototype.bytesPerElement=4,Jn(rp,"StructArrayLayout2ui4");class h_ extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt){const Ut=this.length;return this.resize(Ut+1),this.emplace(Ut,o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt)}emplace(o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt,Ut){const Kt=20*o,er=10*o;return this.int16[Kt+0]=g,this.int16[Kt+1]=_e,this.int16[Kt+2]=rt,this.int16[Kt+3]=ot,this.int16[Kt+4]=at,this.float32[er+3]=ut,this.float32[er+4]=ft,this.float32[er+5]=xt,this.float32[er+6]=Ct,this.int16[Kt+14]=Rt,this.uint32[er+8]=kt,this.uint16[Kt+18]=zt,this.uint16[Kt+19]=Ut,o}}h_.prototype.bytesPerElement=40,Jn(h_,"StructArrayLayout5i4f1i1ul2ui40");class d_ extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut){const ft=this.length;return this.resize(ft+1),this.emplace(ft,o,g,_e,rt,ot,at,ut)}emplace(o,g,_e,rt,ot,at,ut,ft){const xt=8*o;return this.int16[xt+0]=g,this.int16[xt+1]=_e,this.int16[xt+2]=rt,this.int16[xt+4]=ot,this.int16[xt+5]=at,this.int16[xt+6]=ut,this.int16[xt+7]=ft,o}}d_.prototype.bytesPerElement=16,Jn(d_,"StructArrayLayout3i2i2i16");class p_ extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot){const at=this.length;return this.resize(at+1),this.emplace(at,o,g,_e,rt,ot)}emplace(o,g,_e,rt,ot,at){const ut=4*o,ft=8*o;return this.float32[ut+0]=g,this.float32[ut+1]=_e,this.float32[ut+2]=rt,this.int16[ft+6]=ot,this.int16[ft+7]=at,o}}p_.prototype.bytesPerElement=16,Jn(p_,"StructArrayLayout2f1f2i16");class Kv extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at){const ut=this.length;return this.resize(ut+1),this.emplace(ut,o,g,_e,rt,ot,at)}emplace(o,g,_e,rt,ot,at,ut){const ft=20*o,xt=5*o;return this.uint8[ft+0]=g,this.uint8[ft+1]=_e,this.float32[xt+1]=rt,this.float32[xt+2]=ot,this.float32[xt+3]=at,this.float32[xt+4]=ut,o}}Kv.prototype.bytesPerElement=20,Jn(Kv,"StructArrayLayout2ub4f20");class tu extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,g,_e){const rt=this.length;return this.resize(rt+1),this.emplace(rt,o,g,_e)}emplace(o,g,_e,rt){const ot=3*o;return this.uint16[ot+0]=g,this.uint16[ot+1]=_e,this.uint16[ot+2]=rt,o}}tu.prototype.bytesPerElement=6,Jn(tu,"StructArrayLayout3ui6");class z0 extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt,Ut,Kt,er,Jt,or,cr,pr,Sr){const br=this.length;return this.resize(br+1),this.emplace(br,o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt,Ut,Kt,er,Jt,or,cr,pr,Sr)}emplace(o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt,Ut,Kt,er,Jt,or,cr,pr,Sr,br){const Pr=30*o,Dr=15*o,Or=60*o;return this.int16[Pr+0]=g,this.int16[Pr+1]=_e,this.int16[Pr+2]=rt,this.float32[Dr+2]=ot,this.float32[Dr+3]=at,this.uint16[Pr+8]=ut,this.uint16[Pr+9]=ft,this.uint32[Dr+5]=xt,this.uint32[Dr+6]=Ct,this.uint32[Dr+7]=Rt,this.uint16[Pr+16]=kt,this.uint16[Pr+17]=zt,this.uint16[Pr+18]=Ut,this.float32[Dr+10]=Kt,this.float32[Dr+11]=er,this.uint8[Or+48]=Jt,this.uint8[Or+49]=or,this.uint8[Or+50]=cr,this.uint32[Dr+13]=pr,this.int16[Pr+28]=Sr,this.uint8[Or+58]=br,o}}z0.prototype.bytesPerElement=60,Jn(z0,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Xv extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt,Ut,Kt,er,Jt,or,cr,pr,Sr,br,Pr,Dr,Or,nn,$r,un,gn,yn,Sn,An,wn){const En=this.length;return this.resize(En+1),this.emplace(En,o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt,Ut,Kt,er,Jt,or,cr,pr,Sr,br,Pr,Dr,Or,nn,$r,un,gn,yn,Sn,An,wn)}emplace(o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt,Ut,Kt,er,Jt,or,cr,pr,Sr,br,Pr,Dr,Or,nn,$r,un,gn,yn,Sn,An,wn,En){const ln=20*o,on=40*o,Tn=80*o;return this.float32[ln+0]=g,this.float32[ln+1]=_e,this.int16[on+4]=rt,this.int16[on+5]=ot,this.int16[on+6]=at,this.int16[on+7]=ut,this.int16[on+8]=ft,this.int16[on+9]=xt,this.int16[on+10]=Ct,this.int16[on+11]=Rt,this.int16[on+12]=kt,this.uint16[on+13]=zt,this.uint16[on+14]=Ut,this.uint16[on+15]=Kt,this.uint16[on+16]=er,this.uint16[on+17]=Jt,this.uint16[on+18]=or,this.uint16[on+19]=cr,this.uint16[on+20]=pr,this.uint16[on+21]=Sr,this.uint16[on+22]=br,this.uint16[on+23]=Pr,this.uint16[on+24]=Dr,this.uint16[on+25]=Or,this.uint16[on+26]=nn,this.uint16[on+27]=$r,this.uint32[ln+14]=un,this.float32[ln+15]=gn,this.float32[ln+16]=yn,this.float32[ln+17]=Sn,this.float32[ln+18]=An,this.uint8[Tn+76]=wn,this.uint16[on+39]=En,o}}Xv.prototype.bytesPerElement=80,Jn(Xv,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Zv extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at){const ut=this.length;return this.resize(ut+1),this.emplace(ut,o,g,_e,rt,ot,at)}emplace(o,g,_e,rt,ot,at,ut){const ft=6*o;return this.float32[ft+0]=g,this.float32[ft+1]=_e,this.float32[ft+2]=rt,this.float32[ft+3]=ot,this.float32[ft+4]=at,this.float32[ft+5]=ut,o}}Zv.prototype.bytesPerElement=24,Jn(Zv,"StructArrayLayout6f24");class d0 extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot){const at=this.length;return this.resize(at+1),this.emplace(at,o,g,_e,rt,ot)}emplace(o,g,_e,rt,ot,at){const ut=5*o;return this.float32[ut+0]=g,this.float32[ut+1]=_e,this.float32[ut+2]=rt,this.float32[ut+3]=ot,this.float32[ut+4]=at,o}}d0.prototype.bytesPerElement=20,Jn(d0,"StructArrayLayout5f20");class Yv extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut){const ft=this.length;return this.resize(ft+1),this.emplace(ft,o,g,_e,rt,ot,at,ut)}emplace(o,g,_e,rt,ot,at,ut,ft){const xt=7*o;return this.float32[xt+0]=g,this.float32[xt+1]=_e,this.float32[xt+2]=rt,this.float32[xt+3]=ot,this.float32[xt+4]=at,this.float32[xt+5]=ut,this.float32[xt+6]=ft,o}}Yv.prototype.bytesPerElement=28,Jn(Yv,"StructArrayLayout7f28");class Qv extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt){const kt=this.length;return this.resize(kt+1),this.emplace(kt,o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt)}emplace(o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt){const zt=11*o;return this.float32[zt+0]=g,this.float32[zt+1]=_e,this.float32[zt+2]=rt,this.float32[zt+3]=ot,this.float32[zt+4]=at,this.float32[zt+5]=ut,this.float32[zt+6]=ft,this.float32[zt+7]=xt,this.float32[zt+8]=Ct,this.float32[zt+9]=Rt,this.float32[zt+10]=kt,o}}Qv.prototype.bytesPerElement=44,Jn(Qv,"StructArrayLayout11f44");class V0 extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut,ft,xt){const Ct=this.length;return this.resize(Ct+1),this.emplace(Ct,o,g,_e,rt,ot,at,ut,ft,xt)}emplace(o,g,_e,rt,ot,at,ut,ft,xt,Ct){const Rt=9*o;return this.float32[Rt+0]=g,this.float32[Rt+1]=_e,this.float32[Rt+2]=rt,this.float32[Rt+3]=ot,this.float32[Rt+4]=at,this.float32[Rt+5]=ut,this.float32[Rt+6]=ft,this.float32[Rt+7]=xt,this.float32[Rt+8]=Ct,o}}V0.prototype.bytesPerElement=36,Jn(V0,"StructArrayLayout9f36");class Gp extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g){const _e=this.length;return this.resize(_e+1),this.emplace(_e,o,g)}emplace(o,g,_e){const rt=2*o;return this.float32[rt+0]=g,this.float32[rt+1]=_e,o}}Gp.prototype.bytesPerElement=8,Jn(Gp,"StructArrayLayout2f8");class Wu extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt){const ot=this.length;return this.resize(ot+1),this.emplace(ot,o,g,_e,rt)}emplace(o,g,_e,rt,ot){const at=6*o;return this.uint32[3*o+0]=g,this.uint16[at+2]=_e,this.uint16[at+3]=rt,this.uint16[at+4]=ot,o}}Wu.prototype.bytesPerElement=12,Jn(Wu,"StructArrayLayout1ul3ui12");class Fm extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const g=this.length;return this.resize(g+1),this.emplace(g,o)}emplace(o,g){return this.uint16[1*o+0]=g,o}}Fm.prototype.bytesPerElement=2,Jn(Fm,"StructArrayLayout1ui2");class Jv extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt,Ut,Kt,er){const Jt=this.length;return this.resize(Jt+1),this.emplace(Jt,o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt,Ut,Kt,er)}emplace(o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt,Ut,Kt,er,Jt){const or=16*o;return this.float32[or+0]=g,this.float32[or+1]=_e,this.float32[or+2]=rt,this.float32[or+3]=ot,this.float32[or+4]=at,this.float32[or+5]=ut,this.float32[or+6]=ft,this.float32[or+7]=xt,this.float32[or+8]=Ct,this.float32[or+9]=Rt,this.float32[or+10]=kt,this.float32[or+11]=zt,this.float32[or+12]=Ut,this.float32[or+13]=Kt,this.float32[or+14]=er,this.float32[or+15]=Jt,o}}Jv.prototype.bytesPerElement=64,Jn(Jv,"StructArrayLayout16f64");class f_ extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,_e,rt,ot,at,ut){const ft=this.length;return this.resize(ft+1),this.emplace(ft,o,g,_e,rt,ot,at,ut)}emplace(o,g,_e,rt,ot,at,ut,ft){const xt=10*o,Ct=5*o;return this.uint16[xt+0]=g,this.uint16[xt+1]=_e,this.uint16[xt+2]=rt,this.uint16[xt+3]=ot,this.float32[Ct+2]=at,this.float32[Ct+3]=ut,this.float32[Ct+4]=ft,o}}f_.prototype.bytesPerElement=20,Jn(f_,"StructArrayLayout4ui3f20");class e1 extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o){const g=this.length;return this.resize(g+1),this.emplace(g,o)}emplace(o,g){return this.int16[1*o+0]=g,o}}e1.prototype.bytesPerElement=2,Jn(e1,"StructArrayLayout1i2");class m_ extends ga{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(o){const g=this.length;return this.resize(g+1),this.emplace(g,o)}emplace(o,g){return this.uint8[1*o+0]=g,o}}m_.prototype.bytesPerElement=1,Jn(m_,"StructArrayLayout1ub1");class g_ extends jy{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}g_.prototype.size=40;class Zw extends h_{get(o){return new g_(this,o)}}Jn(Zw,"CollisionBoxArray");class y_ extends jy{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}y_.prototype.size=60;class Yw extends z0{get(o){return new y_(this,o)}}Jn(Yw,"PlacedSymbolArray");class Qw extends jy{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(o){this._structArray.uint32[this._pos4+14]=o}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(o){this._structArray.float32[this._pos4+18]=o}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Qw.prototype.size=80;class t1 extends Xv{get(o){return new Qw(this,o)}}Jn(t1,"SymbolInstanceArray");class x_ extends sm{getoffsetX(o){return this.float32[1*o+0]}}Jn(x_,"GlyphOffsetArray");class Jw extends jm{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}Jn(Jw,"SymbolLineVertexArray");class r1 extends jy{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}r1.prototype.size=12;class n1 extends Wu{get(o){return new r1(this,o)}}Jn(n1,"FeatureIndexArray");class eE extends rp{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}Jn(eE,"FillExtrusionCentroidArray");class __ extends jy{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}__.prototype.size=6;class Oy extends F0{get(o){return new __(this,o)}}Jn(Oy,"FillExtrusionWallArray");const tE=Ys([{name:"a_pos",components:2,type:"Int16"}],4),vT=Ys([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),rE=Ys([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class _l{constructor(o=[]){this.segments=o}_prepareSegment(o,g,_e,rt){let ot=this.segments[this.segments.length-1];return o>_l.MAX_VERTEX_ARRAY_LENGTH&&Wn(`Max vertices per segment is ${_l.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!ot||ot.vertexLength+o>_l.MAX_VERTEX_ARRAY_LENGTH||ot.sortKey!==rt)&&(ot={vertexOffset:g,primitiveOffset:_e,vertexLength:0,primitiveLength:0},rt!==void 0&&(ot.sortKey=rt),this.segments.push(ot)),ot}prepareSegment(o,g,_e,rt){return this._prepareSegment(o,g.length,_e.length,rt)}get(){return this.segments}destroy(){for(const o of this.segments)for(const g in o.vaos)o.vaos[g].destroy()}static simpleSegment(o,g,_e,rt){return new _l([{vertexOffset:o,primitiveOffset:g,vertexLength:_e,primitiveLength:rt,vaos:{},sortKey:0}])}}function v_(b,o){return 256*(b=tr(Math.floor(b),0,255))+tr(Math.floor(o),0,255)}_l.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Jn(_l,"SegmentVector");const bT=Ys([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),wT=Ys([{name:"a_pattern_b",components:4,type:"Uint16"}]),ET=Ys([{name:"a_dash",components:4,type:"Uint16"}]);class Fy{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(o,g,_e,rt){this.ids.push(i1(o)),this.positions.push(g,_e,rt)}eachPosition(o,g){const _e=i1(o);let rt=0,ot=this.ids.length-1;for(;rt<ot;){const at=rt+ot>>1;this.ids[at]>=_e?ot=at:rt=at+1}for(;this.ids[rt]===_e;)g(this.positions[3*rt],this.positions[3*rt+1],this.positions[3*rt+2]),rt++}static serialize(o,g){const _e=new Float64Array(o.ids),rt=new Uint32Array(o.positions);return s1(_e,rt,0,_e.length-1),g&&(g.add(_e.buffer),g.add(rt.buffer)),{ids:_e,positions:rt}}static deserialize(o){const g=new Fy;let _e;g.ids=o.ids,g.positions=o.positions;for(const rt of g.ids)rt!==_e&&g.uniqueIds.push(rt),_e=rt;return g.indexed=!0,g}}function i1(b){const o=+b;return Number.isSafeInteger(o)?o:gx(String(b))}function s1(b,o,g,_e){for(;g<_e;){const rt=b[g+_e>>1];let ot=g-1,at=_e+1;for(;;){do ot++;while(b[ot]<rt);do at--;while(b[at]>rt);if(ot>=at)break;b_(b,ot,at),b_(o,3*ot,3*at),b_(o,3*ot+1,3*at+1),b_(o,3*ot+2,3*at+2)}at-g<_e-at?(s1(b,o,g,at),g=at+1):(s1(b,o,at+1,_e),_e=at)}}function b_(b,o,g){const _e=b[o];b[o]=b[g],b[g]=_e}Jn(Fy,"FeaturePositionMap");class om{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,g){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,g),this.initialized=!0),!!this.location}set(o,g,_e){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class w_ extends om{constructor(o){super(o),this.current=0}set(o,g,_e){this.fetchUniformLocation(o,g)&&this.current!==_e&&(this.current=_e,this.gl.uniform1i(this.location,_e))}}class ru extends om{constructor(o){super(o),this.current=0}set(o,g,_e){this.fetchUniformLocation(o,g)&&this.current!==_e&&(this.current=_e,this.gl.uniform1f(this.location,_e))}}class Hp extends om{constructor(o){super(o),this.current=[0,0]}set(o,g,_e){this.fetchUniformLocation(o,g)&&(_e[0]===this.current[0]&&_e[1]===this.current[1]||(this.current=_e,this.gl.uniform2f(this.location,_e[0],_e[1])))}}class By extends om{constructor(o){super(o),this.current=[0,0,0]}set(o,g,_e){this.fetchUniformLocation(o,g)&&(_e[0]===this.current[0]&&_e[1]===this.current[1]&&_e[2]===this.current[2]||(this.current=_e,this.gl.uniform3f(this.location,_e[0],_e[1],_e[2])))}}class E_ extends om{constructor(o){super(o),this.current=[0,0,0,0]}set(o,g,_e){this.fetchUniformLocation(o,g)&&(_e[0]===this.current[0]&&_e[1]===this.current[1]&&_e[2]===this.current[2]&&_e[3]===this.current[3]||(this.current=_e,this.gl.uniform4f(this.location,_e[0],_e[1],_e[2],_e[3])))}}class zy extends om{constructor(o){super(o),this.current=Ro.transparent.toPremultipliedRenderColor(null)}set(o,g,_e){this.fetchUniformLocation(o,g)&&(_e.r===this.current.r&&_e.g===this.current.g&&_e.b===this.current.b&&_e.a===this.current.a||(this.current=_e,this.gl.uniform4f(this.location,_e.r,_e.g,_e.b,_e.a)))}}const TT=new Float32Array(16);class Vy extends om{constructor(o){super(o),this.current=TT}set(o,g,_e){if(this.fetchUniformLocation(o,g)){if(_e[12]!==this.current[12]||_e[0]!==this.current[0])return this.current=_e,void this.gl.uniformMatrix4fv(this.location,!1,_e);for(let rt=1;rt<16;rt++)if(_e[rt]!==this.current[rt]){this.current=_e,this.gl.uniformMatrix4fv(this.location,!1,_e);break}}}}const T_=new Float32Array(9),ST=new Float32Array(4);class S_ extends om{constructor(o){super(o),this.current=ST}set(o,g,_e){if(this.fetchUniformLocation(o,g)){for(let rt=0;rt<4;rt++)if(_e[rt]!==this.current[rt]){this.current=_e,this.gl.uniformMatrix2fv(this.location,!1,_e);break}}}}function o1(b){return[v_(255*b.r,255*b.g),v_(255*b.b,255*b.a)]}function Uy(b,o,g,_e,rt,ot,at,ut){return!!b&&(b.kind==="composite"||b.kind==="source"?b.evaluate(new Xo(0,{brightness:ot,worldview:ut}),o,g,rt,_e,at)==="none":b.value==="none")}class $y{constructor(o,g,_e,rt){this.value=o,this.uniformNames=g.map(ot=>`u_${ot}`),this.type=_e,this.context=rt}setUniform(o,g,_e,rt,ot){const at=rt.constantOr(this.value);g.set(o,ot,at instanceof Ro?at.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):at)}getBinding(o,g){return this.type==="color"?new zy(o):new ru(o)}}class U0{constructor(o,g){this.uniformNames=g.map(_e=>`u_${_e}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(o,g){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br),this.patternTransition=g?g.tl.concat(g.br):this.pattern}setUniform(o,g,_e,rt,ot){let at=null;ot!=="u_pattern"&&ot!=="u_dash"||(at=this.pattern),ot==="u_pattern_b"&&(at=this.patternTransition),ot==="u_pixel_ratio"&&(at=this.pixelRatio),at&&g.set(o,ot,at)}getBinding(o,g){return g==="u_pattern"||g==="u_pattern_b"||g==="u_dash"?new E_(o):new ru(o)}}class am{constructor(o,g,_e,rt){this.expression=o,this.type=_e,this.maxValue=0,this.paintVertexAttributes=g.map(ot=>({name:`a_${ot}`,type:"Float32",components:_e==="color"?2:1,offset:0})),this.paintVertexArray=new rt}populatePaintArray(o,g,_e,rt,ot,at,ut,ft){const xt=this.paintVertexArray.length,Ct=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Xo(0,{brightness:at,worldview:ft}),g,{},ot,rt,ut):this.expression.kind==="constant"&&this.expression.value,Rt=Uy(this.lutExpression,g,{},rt,ot,at,ut,ft);this.paintVertexArray.resize(o),this._setPaintValue(xt,o,Ct,Rt?null:this.context.lut)}updatePaintArray(o,g,_e,rt,ot,at,ut,ft){const xt=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:ut,worldview:ft},_e,rt,void 0,ot):this.expression.kind==="constant"&&this.expression.value,Ct=Uy(this.lutExpression,_e,rt,ot,void 0,ut,void 0,ft);this._setPaintValue(o,g,xt,Ct?null:this.context.lut)}_setPaintValue(o,g,_e,rt){if(this.type==="color"){const ot=o1(_e.toPremultipliedRenderColor(rt));for(let at=o;at<g;at++)this.paintVertexArray.emplace(at,ot[0],ot[1])}else{for(let ot=o;ot<g;ot++)this.paintVertexArray.emplace(ot,_e);this.maxValue=Math.max(this.maxValue,Math.abs(_e))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class lm{constructor(o,g,_e,rt,ot,at){this.expression=o,this.uniformNames=g.map(ut=>`u_${ut}_t`),this.type=_e,this.useIntegerZoom=rt,this.context=ot,this.maxValue=0,this.paintVertexAttributes=g.map(ut=>({name:`a_${ut}`,type:"Float32",components:_e==="color"?4:2,offset:0})),this.paintVertexArray=new at}populatePaintArray(o,g,_e,rt,ot,at,ut,ft){const xt=this.expression.evaluate(new Xo(this.context.zoom,{brightness:at,worldview:ft}),g,{},ot,rt,ut),Ct=this.expression.evaluate(new Xo(this.context.zoom+1,{brightness:at,worldview:ft}),g,{},ot,rt,ut),Rt=Uy(this.lutExpression,g,{},rt,ot,at,ut,ft),kt=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(kt,o,xt,Ct,Rt?null:this.context.lut)}updatePaintArray(o,g,_e,rt,ot,at,ut,ft){const xt=this.expression.evaluate({zoom:this.context.zoom,brightness:ut,worldview:ft},_e,rt,void 0,ot),Ct=this.expression.evaluate({zoom:this.context.zoom+1,brightness:ut,worldview:ft},_e,rt,void 0,ot),Rt=Uy(this.lutExpression,_e,rt,ot,void 0,ut,void 0,ft);this._setPaintValue(o,g,xt,Ct,Rt?null:this.context.lut)}_setPaintValue(o,g,_e,rt,ot){if(this.type==="color"){const at=o1(_e.toPremultipliedRenderColor(ot)),ut=o1(_e.toPremultipliedRenderColor(ot));for(let ft=o;ft<g;ft++)this.paintVertexArray.emplace(ft,at[0],at[1],ut[0],ut[1])}else{for(let at=o;at<g;at++)this.paintVertexArray.emplace(at,_e,rt);this.maxValue=Math.max(this.maxValue,Math.abs(_e),Math.abs(rt))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,g,_e,rt,ot){const at=this.useIntegerZoom?Math.floor(_e.zoom):_e.zoom,ut=tr(this.expression.interpolationFactor(at,this.context.zoom,this.context.zoom+1),0,1);g.set(o,ot,ut)}getBinding(o,g){return new ru(o)}}class cm{constructor(o,g,_e,rt,ot){this.expression=o,this.layerId=ot,this.paintVertexAttributes=(_e==="array"?ET:bT).members;for(let at=0;at<g.length;++at);this.paintVertexArray=new rt,this.paintTransitionVertexArray=new h0}populatePaintArray(o,g,_e,rt){const ot=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(ot,o,g.patterns&&g.patterns[this.layerId],_e)}updatePaintArray(o,g,_e,rt,ot,at,ut){this._setPaintValues(o,g,_e.patterns&&_e.patterns[this.layerId],at)}_setPaintValues(o,g,_e,rt){if(!rt||!_e)return;const ot=rt[_e[0]],at=rt[_e[1]];if(ot){if(ot){const{tl:ut,br:ft,pixelRatio:xt}=ot;for(let Ct=o;Ct<g;Ct++)this.paintVertexArray.emplace(Ct,ut[0],ut[1],ft[0],ft[1],xt)}if(at){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:ut,br:ft}=at;for(let xt=o;xt<g;xt++)this.paintTransitionVertexArray.emplace(xt,ut[0],ut[1],ft[0],ft[1])}}}upload(o){const g=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,g)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=o.createVertexBuffer(this.paintTransitionVertexArray,wT.members,g))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Bm{constructor(o,g,_e=()=>!0){this.binders={},this._buffers=[],this.context=g;const rt=[];for(const ot in o.paint._values){const at=o.paint.get(ot);if(ot.endsWith("-use-theme")||!_e(ot)||!(at instanceof o0&&Py(at.property.specification)))continue;const ut=AT(ot,o.type),ft=at.value,xt=at.property.specification.type,Ct=!!at.property.useIntegerZoom,Rt=ot==="line-dasharray"||ot.endsWith("pattern"),kt=o.paint.get(`${ot}-use-theme`),zt=ot==="line-dasharray"&&o.layout.get("line-cap").value.kind!=="constant"||kt&&kt.value.kind!=="constant";if(ft.kind!=="constant"||zt)if(ft.kind==="source"||zt||Rt){const Ut=a1(ot,xt,"source");this.binders[ot]=Rt?new cm(ft,ut,xt,Ut,o.id):new am(ft,ut,xt,Ut),rt.push(`/a_${ot}`)}else{const Ut=a1(ot,xt,"composite");this.binders[ot]=new lm(ft,ut,xt,Ct,g,Ut),rt.push(`/z_${ot}`)}else this.binders[ot]=Rt?new U0(ft.value,ut):new $y(ft.value,ut,xt,g),rt.push(`/u_${ot}`);kt&&(this.binders[ot].lutExpression=kt.value)}this.cacheKey=rt.sort().join("")}getMaxValue(o){const g=this.binders[o];return g instanceof am||g instanceof lm?g.maxValue:0}populatePaintArrays(o,g,_e,rt,ot,at,ut,ft){for(const xt in this.binders){const Ct=this.binders[xt];Ct.context=this.context,(Ct instanceof am||Ct instanceof lm||Ct instanceof cm)&&Ct.populatePaintArray(o,g,_e,rt,ot,at,ut,ft)}}setConstantPatternPositions(o,g){for(const _e in this.binders){const rt=this.binders[_e];rt instanceof U0&&rt.setConstantPatternPositions(o,g)}}getPatternTransitionVertexBuffer(o){const g=this.binders[o];return g instanceof cm?g.paintTransitionVertexBuffer:null}updatePaintArrays(o,g,_e,rt,ot,at,ut,ft,xt,Ct){let Rt=!1;const kt=Object.keys(o),zt=kt.length!==0&&!ft,Ut=zt?kt:g.uniqueIds;this.context.lut=ot.lut;for(const Kt in this.binders){const er=this.binders[Kt];if(er.context=this.context,(er instanceof am||er instanceof lm||er instanceof cm)&&er.expression&&er.expression.kind&&er.expression.kind!=="constant"&&(er.expression.isStateDependent===!0||er.expression.isLightConstant===!1)){const Jt=ot.paint.get(Kt);er.expression=Jt.value;for(const or of Ut){const cr=o[or.toString()];g.eachPosition(or,(pr,Sr,br)=>{const Pr=rt.feature(pr);er.updatePaintArray(Sr,br,Pr,cr,at,ut,xt,Ct)})}if(!zt)for(const or of _e.uniqueIds){const cr=o[or.toString()];_e.eachPosition(or,(pr,Sr,br)=>{const Pr=rt.feature(pr);er.updatePaintArray(Sr,br,Pr,cr,at,ut,xt,Ct)})}Rt=!0}}return Rt}defines(){const o=[];for(const g in this.binders){const _e=this.binders[g];(_e instanceof $y||_e instanceof U0)&&o.push(..._e.uniformNames.map(rt=>`#define HAS_UNIFORM_${rt}`))}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const g=[];for(const _e in this.binders){const rt=this.binders[_e];if(rt instanceof $y||rt instanceof U0||rt instanceof lm)for(const ot of rt.uniformNames)g.push({name:ot,property:_e,binding:rt.getBinding(o,ot)})}return g}setUniforms(o,g,_e,rt,ot){for(const{name:at,property:ut,binding:ft}of _e)this.binders[ut].setUniform(o,ft,ot,rt.get(ut),at)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const g=this.binders[o];(g instanceof am||g instanceof lm||g instanceof cm)&&g.paintVertexBuffer&&this._buffers.push(g.paintVertexBuffer),g instanceof cm&&g.paintTransitionVertexBuffer&&this._buffers.push(g.paintTransitionVertexBuffer)}}upload(o){for(const g in this.binders){const _e=this.binders[g];(_e instanceof am||_e instanceof lm||_e instanceof cm)&&_e.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const g=this.binders[o];(g instanceof am||g instanceof lm||g instanceof cm)&&g.destroy()}}}class Pp{constructor(o,g,_e=()=>!0){this.programConfigurations={};for(const rt of o)this.programConfigurations[rt.id]=new Bm(rt,g,_e);this.needsUpload=!1,this._featureMap=new Fy,this._featureMapWithoutIds=new Fy,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(o,g,_e,rt,ot,at,ut,ft,xt){for(const Ct in this.programConfigurations)this.programConfigurations[Ct].populatePaintArrays(o,g,rt,ot,at,ut,ft,xt);g.id!==void 0?this._featureMap.add(g.id,_e,this._bufferOffset,o):(this._featureMapWithoutIds.add(this._idlessCounter,_e,this._bufferOffset,o),this._idlessCounter+=1),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,g,_e,rt,ot,at,ut,ft){for(const xt of _e)this.needsUpload=this.programConfigurations[xt.id].updatePaintArrays(o,this._featureMap,this._featureMapWithoutIds,g,xt,rt,ot,at,ut||0,ft)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const g in this.programConfigurations)this.programConfigurations[g].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const CT={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function AT(b,o){return CT[b]||[b.replace(`${o}-`,"").replace(/-/g,"_")]}const RT={"line-pattern":{source:Hu,composite:Hu},"fill-pattern":{source:Hu,composite:Hu},"fill-extrusion-pattern":{source:Hu,composite:Hu},"line-dasharray":{source:h0,composite:h0}},PT={color:{source:Gp,composite:Om},number:{source:sm,composite:Gp}};function a1(b,o,g){const _e=RT[b];return _e&&_e[g]||PT[o][g]}Jn($y,"ConstantBinder"),Jn(U0,"PatternConstantBinder"),Jn(am,"SourceExpressionBinder"),Jn(cm,"PatternCompositeBinder"),Jn(lm,"CompositeExpressionBinder"),Jn(Bm,"ProgramConfiguration",{omit:["_buffers"]}),Jn(Pp,"ProgramConfigurationSet");const Ru=jn/Math.PI/2,gp=5,C_=6,IT=16383,$0=64,l1=[$0,32,16],yp=-Ru,xp=Ru;function p0(b,o,g,_e=Ru){return g=Xs(g),[b*Math.sin(g)*_e,-o*_e,b*Math.cos(g)*_e]}function G0(b,o,g){return p0(Math.cos(Xs(b)),Math.sin(Xs(b)),o,g)}const it=63710088e-1,d=2*Math.PI*it;class ${constructor(o,g){if(isNaN(o)||isNaN(g))throw new Error(`Invalid LngLat object: (${o}, ${g})`);if(this.lng=+o,this.lat=+g,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new $(_r(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const g=Math.PI/180,_e=this.lat*g,rt=o.lat*g,ot=Math.sin(_e)*Math.sin(rt)+Math.cos(_e)*Math.cos(rt)*Math.cos((o.lng-this.lng)*g);return it*Math.acos(Math.min(ot,1))}toBounds(o=0){const g=360*o/40075017,_e=g/Math.cos(Math.PI/180*this.lat);return new st({lng:this.lng-_e,lat:this.lat-g},{lng:this.lng+_e,lat:this.lat+g})}toEcef(o){return G0(this.lat,this.lng,Ru+o*Ru/it)}static convert(o){if(o instanceof $)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new $(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new $(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class st{constructor(o,g){o&&(g?this.setSouthWest(o).setNorthEast(g):Array.isArray(o)&&o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof $?new $(o.lng,o.lat):$.convert(o),this}setSouthWest(o){return this._sw=o instanceof $?new $(o.lng,o.lat):$.convert(o),this}extend(o){const g=this._sw,_e=this._ne;let rt,ot;if(o instanceof $)rt=o,ot=o;else{if(!(o instanceof st))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(st.convert(o)):this.extend($.convert(o)):typeof o=="object"&&o!==null&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend($.convert(o)):this;if(rt=o._sw,ot=o._ne,!rt||!ot)return this}return g||_e?(g.lng=Math.min(rt.lng,g.lng),g.lat=Math.min(rt.lat,g.lat),_e.lng=Math.max(ot.lng,_e.lng),_e.lat=Math.max(ot.lat,_e.lat)):(this._sw=new $(rt.lng,rt.lat),this._ne=new $(ot.lng,ot.lat)),this}getCenter(){return new $((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new $(this.getWest(),this.getNorth())}getSouthEast(){return new $(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:g,lat:_e}=$.convert(o);let rt=this._sw.lng<=g&&g<=this._ne.lng;return this._sw.lng>this._ne.lng&&(rt=this._sw.lng>=g&&g>=this._ne.lng),this._sw.lat<=_e&&_e<=this._ne.lat&&rt}static convert(o){if(o)return o instanceof st?o:new st(o)}}const lt=0,ht=25.5;function pt(b){return d*Math.cos(b*Math.PI/180)}function mt(b){return(180+b)/360}function St(b){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+b*Math.PI/360)))/360}function It(b,o){return b/pt(o)}function Dt(b){return 360*b-180}function Ht(b){return 360/Math.PI*Math.atan(Math.exp((180-360*b)*Math.PI/180))-90}function Gt(b,o){return b*pt(Ht(o))}const qt=85.051129;function Qt(b){return Math.cos(Xs(tr(b,-qt,qt)))}function Zt(b,o){const g=tr(o,lt,ht),_e=Math.pow(2,g);return Qt(b)*d/(512*_e)}function sr(b){return 1/Math.cos(b*Math.PI/180)}function ir(b,o=0){const g=Math.exp(Math.PI*(1-(b.y+o/jn)/(1<<b.z)*2));return 80150034*g/(g*g+1)/jn/(1<<b.z)}class hr{constructor(o,g,_e=0){this.x=+o,this.y=+g,this.z=+_e}static fromLngLat(o,g=0){const _e=$.convert(o);return new hr(mt(_e.lng),St(_e.lat),It(g,_e.lat))}toLngLat(){return new $(Dt(this.x),Ht(this.y))}toAltitude(){return Gt(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/d*sr(Ht(this.y))}}function gr(b,o,g,_e,rt,ot,at,ut,ft){const xt=(o+_e)/2,Ct=(g+rt)/2,Rt=new _n(xt,Ct);ut(Rt),function(kt,zt,Ut,Kt,er,Jt){const or=Ut-er,cr=Kt-Jt;return Math.abs((Kt-zt)*or-(Ut-kt)*cr)/Math.hypot(or,cr)}(Rt.x,Rt.y,ot.x,ot.y,at.x,at.y)>=ft?(gr(b,o,g,xt,Ct,ot,Rt,ut,ft),gr(b,xt,Ct,_e,rt,Rt,at,ut,ft)):b.push(at)}function dr(b,o,g){let _e=b[0],rt=_e.x,ot=_e.y;o(_e);const at=[_e];for(let ut=1;ut<b.length;ut++){const ft=b[ut],{x:xt,y:Ct}=ft;o(ft),gr(at,rt,ot,xt,Ct,_e,ft,o,g),rt=xt,ot=Ct,_e=ft}return at}function Ir(b,o,g,_e){if(_e(o,g)){const rt=o.add(g)._mult(.5);Ir(b,o,rt,_e),Ir(b,rt,g,_e)}else b.push(g)}function Tr(b,o){let g=b[0];const _e=[g];for(let rt=1;rt<b.length;rt++){const ot=b[rt];Ir(_e,g,ot,o),g=ot}return _e}const Rr=Math.pow(2,14)-1,Er=-Rr-1;function vr(b,o){const g=Math.round(b.x*o),_e=Math.round(b.y*o);return b.x=tr(g,Er,Rr),b.y=tr(_e,Er,Rr),(g<b.x||g>b.x+1||_e<b.y||_e>b.y+1)&&Wn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),b}function kr(b,o,g){const _e=b.loadGeometry(),rt=b.extent,ot=jn/rt;if(o&&g&&g.projection.isReprojectedInTileSpace){const at=1<<o.z,{scale:ut,x:ft,y:xt,projection:Ct}=g,Rt=kt=>{const zt=Dt((o.x+kt.x/rt)/at),Ut=Ht((o.y+kt.y/rt)/at),Kt=Ct.project(zt,Ut);kt.x=(Kt.x*ut-ft)*rt,kt.y=(Kt.y*ut-xt)*rt};for(let kt=0;kt<_e.length;kt++)if(b.type!==1)_e[kt]=dr(_e[kt],Rt,1);else{const zt=[];for(const Ut of _e[kt])Ut.x<0||Ut.x>=rt||Ut.y<0||Ut.y>=rt||(Rt(Ut),zt.push(Ut));_e[kt]=zt}}for(const at of _e)for(const ut of at)vr(ut,ot);return _e}function Ur(b,o){return{type:b.type,id:b.id,properties:b.properties,geometry:o?kr(b):[]}}class zr{constructor(o,g,_e,rt,ot){this.properties={},this.extent=_e,this.type=0,this.id=void 0,this._pbf=o,this._geometry=-1,this._keys=rt,this._values=ot,o.readFields(Jr,this,g)}loadGeometry(){const o=this._pbf;o.pos=this._geometry;const g=o.readVarint()+o.pos,_e=[];let rt,ot=1,at=0,ut=0,ft=0;for(;o.pos<g;){if(at<=0){const xt=o.readVarint();ot=7&xt,at=xt>>3}if(at--,ot===1||ot===2)ut+=o.readSVarint(),ft+=o.readSVarint(),ot===1&&(rt&&_e.push(rt),rt=[]),rt&&rt.push(new _n(ut,ft));else{if(ot!==7)throw new Error(`unknown command ${ot}`);rt&&rt.push(rt[0].clone())}}return rt&&_e.push(rt),_e}bbox(){const o=this._pbf;o.pos=this._geometry;const g=o.readVarint()+o.pos;let _e=1,rt=0,ot=0,at=0,ut=1/0,ft=-1/0,xt=1/0,Ct=-1/0;for(;o.pos<g;){if(rt<=0){const Rt=o.readVarint();_e=7&Rt,rt=Rt>>3}if(rt--,_e===1||_e===2)ot+=o.readSVarint(),at+=o.readSVarint(),ot<ut&&(ut=ot),ot>ft&&(ft=ot),at<xt&&(xt=at),at>Ct&&(Ct=at);else if(_e!==7)throw new Error(`unknown command ${_e}`)}return[ut,xt,ft,Ct]}toGeoJSON(o,g,_e){const rt=this.extent*Math.pow(2,_e),ot=this.extent*o,at=this.extent*g,ut=this.loadGeometry();function ft(kt){return[360*(kt.x+ot)/rt-180,360/Math.PI*Math.atan(Math.exp((1-2*(kt.y+at)/rt)*Math.PI))-90]}function xt(kt){return kt.map(ft)}let Ct;if(this.type===1){const kt=[];for(const Ut of ut)kt.push(Ut[0]);const zt=xt(kt);Ct=kt.length===1?{type:"Point",coordinates:zt[0]}:{type:"MultiPoint",coordinates:zt}}else if(this.type===2){const kt=ut.map(xt);Ct=kt.length===1?{type:"LineString",coordinates:kt[0]}:{type:"MultiLineString",coordinates:kt}}else{if(this.type!==3)throw new Error("unknown feature type");{const kt=function(Ut){const Kt=Ut.length;if(Kt<=1)return[Ut];const er=[];let Jt,or;for(let cr=0;cr<Kt;cr++){const pr=rn(Ut[cr]);pr!==0&&(or===void 0&&(or=pr<0),or===pr<0?(Jt&&er.push(Jt),Jt=[Ut[cr]]):Jt&&Jt.push(Ut[cr]))}return Jt&&er.push(Jt),er}(ut),zt=[];for(const Ut of kt)zt.push(Ut.map(xt));Ct=zt.length===1?{type:"Polygon",coordinates:zt[0]}:{type:"MultiPolygon",coordinates:zt}}}const Rt={type:"Feature",geometry:Ct,properties:this.properties};return this.id!=null&&(Rt.id=this.id),Rt}}function Jr(b,o,g){b===1?o.id=g.readVarint():b===2?function(_e,rt){const ot=_e.readVarint()+_e.pos;for(;_e.pos<ot;){const at=rt._keys[_e.readVarint()],ut=rt._values[_e.readVarint()];rt.properties[at]=ut}}(g,o):b===3?o.type=g.readVarint():b===4&&(o._geometry=g.pos)}function rn(b){let o=0;for(let g,_e,rt=0,ot=b.length,at=ot-1;rt<ot;at=rt++)g=b[rt],_e=b[at],o+=(_e.x-g.x)*(g.y+_e.y);return o}zr.types=["Unknown","Point","LineString","Polygon"];class pn{constructor(o,g){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(Pn,this,g),this.length=this._features.length}feature(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];const g=this._pbf.readVarint()+this._pbf.pos;return new zr(this._pbf,g,this.extent,this._keys,this._values)}}function Pn(b,o,g){b===15?o.version=g.readVarint():b===1?o.name=g.readString():b===5?o.extent=g.readVarint():b===2?o._features.push(g.pos):b===3?o._keys.push(g.readString()):b===4&&o._values.push(function(_e){let rt=null;const ot=_e.readVarint()+_e.pos;for(;_e.pos<ot;){const at=_e.readVarint()>>3;rt=at===1?_e.readString():at===2?_e.readFloat():at===3?_e.readDouble():at===4?_e.readVarint64():at===5?_e.readVarint():at===6?_e.readSVarint():at===7?_e.readBoolean():null}if(rt==null)throw new Error("unknown feature value");return rt}(g))}class Kr{constructor(o,g){this.layers=o.readFields(jr,{},g)}}function jr(b,o,g){if(b===3){const _e=new pn(g,g.readVarint()+g.pos);_e.length&&(o[_e.name]=_e)}}const an="3d_elevation_id",Xr="level";class bn{constructor(){this._valid=!1}reset(o){return this.feature=o,this._valid=!0,this._geometry=o.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(o,g){return this._valid&&o(g(this._geometry)),this}require(o,g,_e){return this.get(o,!0,g,_e)}optional(o,g,_e){return this.get(o,!1,g,_e)}success(){return this._valid}get(o,g,_e,rt){const ot=this.feature.properties.hasOwnProperty(o)?+this.feature.properties[o]:void 0;return this._valid&&ot!==void 0&&!Number.isNaN(ot)?_e(rt?rt(ot):ot):g&&(this._valid=!1),this}}class Fn{constructor(o,g){this.featureFunc=o,this.vertexFunc=g}parseFeature(o,g,_e){return this.featureFunc(o,g,_e)}parseVertex(o,g,_e){return this.vertexFunc(o,g,_e)}}const Hn=new Fn((b,o,g)=>b.reset(o).require(an,_e=>{g.id=_e}).optional("fixed_height_relative",_e=>{g.constantHeight=_e},In.decodeRelativeHeight).geometry(_e=>{g.bounds=_e},Jp).success(),(b,o,g)=>b.reset(o).require(an,_e=>{g.id=_e}).require("elevation_idx",_e=>{g.idx=_e}).require("extent",_e=>{g.extent=_e}).require("height_relative",_e=>{g.height=_e},In.decodeRelativeHeight).geometry(_e=>{g.position=_e},In.getPoint).success()),Ln=new Fn((b,o,g)=>b.reset(o).require(an,_e=>{g.id=_e}).optional("fixed_height",_e=>{g.constantHeight=_e},In.decodeMetricHeight).geometry(_e=>{g.bounds=_e},Jp).success(),(b,o,g)=>b.reset(o).require(an,_e=>{g.id=_e}).require("elevation_idx",_e=>{g.idx=_e}).require("extent",_e=>{g.extent=_e}).require("height",_e=>{g.height=_e},In.decodeMetricHeight).geometry(_e=>{g.position=_e},In.getPoint).success());class In{static getPoint(o){return As(o[0][0].x,o[0][0].y)}static decodeRelativeHeight(o){return 1e-4*o*5}static decodeMetricHeight(o){return 1e-4*o}static getVersionSchema(o){return o?o==="1.0.1"?Ln:void 0:Hn}static parse(o){const g=[],_e=[],rt=o.length,ot=new bn;for(let at=0;at<rt;at++){const ut=o.feature(at),ft=ut.properties.version,xt=In.getVersionSchema(ft);if(xt===void 0){Wn(`Unknown elevation feature version number ${ft||"(unknown)"}`);continue}const Ct=ut.properties.type;if(!Ct)continue;const Rt=zr.types[ut.type];if(Rt==="Point"&&Ct==="curve_point"){const kt={};xt.parseVertex(ot,ut,kt)&&g.push(kt)}else if(Rt==="Polygon"&&Ct==="curve_meta"){const kt={};xt.parseFeature(ot,ut,kt)&&_e.push(kt)}}return{vertices:g,features:_e}}}class ns{constructor(o,g){this.pos=o,this.dir=g}intersectsPlane(o,g,_e){const rt=Il(g,this.dir);if(Math.abs(rt)<1e-6)return!1;const ot=((o[0]-this.pos[0])*g[0]+(o[1]-this.pos[1])*g[1])/rt;return _e[0]=this.pos[0]+this.dir[0]*ot,_e[1]=this.pos[1]+this.dir[1]*ot,!0}}class _i{constructor(o,g){this.pos=o,this.dir=g}intersectsPlane(o,g,_e){const rt=gs(g,this.dir);if(Math.abs(rt)<1e-6)return!1;const ot=((o[0]-this.pos[0])*g[0]+(o[1]-this.pos[1])*g[1]+(o[2]-this.pos[2])*g[2])/rt;return _e[0]=this.pos[0]+this.dir[0]*ot,_e[1]=this.pos[1]+this.dir[1]*ot,_e[2]=this.pos[2]+this.dir[2]*ot,!0}closestPointOnSphere(o,g,_e){if(function(zt,Ut){var Kt=zt[0],er=zt[1],Jt=zt[2],or=Ut[0],cr=Ut[1],pr=Ut[2];return Math.abs(Kt-or)<=ct*Math.max(1,Math.abs(Kt),Math.abs(or))&&Math.abs(er-cr)<=ct*Math.max(1,Math.abs(er),Math.abs(cr))&&Math.abs(Jt-pr)<=ct*Math.max(1,Math.abs(Jt),Math.abs(pr))}(this.pos,o)||g===0)return _e[0]=_e[1]=_e[2]=0,!1;const[rt,ot,at]=this.dir,ut=this.pos[0]-o[0],ft=this.pos[1]-o[1],xt=this.pos[2]-o[2],Ct=rt*rt+ot*ot+at*at,Rt=2*(ut*rt+ft*ot+xt*at),kt=Rt*Rt-4*Ct*(ut*ut+ft*ft+xt*xt-g*g);if(kt<0){const zt=Math.max(-Rt/2,0),Ut=ut+rt*zt,Kt=ft+ot*zt,er=xt+at*zt,Jt=Math.hypot(Ut,Kt,er);return _e[0]=Ut*g/Jt,_e[1]=Kt*g/Jt,_e[2]=er*g/Jt,!1}{const zt=(-Rt-Math.sqrt(kt))/(2*Ct);if(zt<0){const Ut=Math.hypot(ut,ft,xt);return _e[0]=ut*g/Ut,_e[1]=ft*g/Ut,_e[2]=xt*g/Ut,!1}return _e[0]=ut+rt*zt,_e[1]=ft+ot*zt,_e[2]=xt+at*zt,!0}}}class $n{constructor(o,g,_e,rt,ot){this.TL=o,this.TR=g,this.BR=_e,this.BL=rt,this.horizon=ot}static fromInvProjectionMatrix(o,g,_e){const rt=[-1,1,1],ot=[1,1,1],at=[1,-1,1],ut=[-1,-1,1],ft=_s(rt,rt,o),xt=_s(ot,ot,o),Ct=_s(at,at,o),Rt=_s(ut,ut,o);return new $n(ft,xt,Ct,Rt,g/_e)}}function qn(b,o,g){let _e=1/0,rt=-1/0;const ot=[];for(const at of b){wo(ot,at,o);const ut=gs(ot,g);_e=Math.min(_e,ut),rt=Math.max(rt,ut)}return[_e,rt]}function ms(b,o){let g=!0;for(let _e=0;_e<b.planes.length;_e++){const rt=b.planes[_e];let ot=0;for(let at=0;at<o.length;at++)ot+=+(gs(rt,o[at])+rt[3]>=0);if(ot===0)return 0;ot!==o.length&&(g=!1)}return g?2:1}function Ns(b,o){for(const g of b.projections){const _e=qn(o,b.points[0],g.axis);if(g.projection[1]<_e[0]||g.projection[0]>_e[1])return 0}return 1}function to(b,o){let g=0;const _e=[0,0,0,0];for(let at=0;at<b.length;at++)_e[0]=b[at][0],_e[1]=b[at][1],_e[2]=b[at][2],_e[3]=1,(rt=_e)[0]*(ot=o)[0]+rt[1]*ot[1]+rt[2]*ot[2]+rt[3]*ot[3]>=0&&g++;var rt,ot;return g}class _o{constructor(o,g){this.points=o||new Array(8).fill([0,0,0]),this.planes=g||new Array(6).fill([0,0,0,0]),this.bounds=is.fromPoints(this.points),this.projections=[],this.frustumEdges=[wo([],this.points[2],this.points[3]),wo([],this.points[0],this.points[3]),wo([],this.points[4],this.points[0]),wo([],this.points[5],this.points[1]),wo([],this.points[6],this.points[2]),wo([],this.points[7],this.points[3])];for(const _e of this.frustumEdges){const rt=[0,-_e[2],_e[1]],ot=[_e[2],0,-_e[0]];this.projections.push({axis:rt,projection:qn(this.points,this.points[0],rt)}),this.projections.push({axis:ot,projection:qn(this.points,this.points[0],ot)})}}static fromInvProjectionMatrix(o,g,_e,rt){const ot=Math.pow(2,_e),at=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(xt=>{const Ct=xl([],xt,o),Rt=1/Ct[3]/g*ot;return(kt=Ct)[0]=(zt=Ct)[0]*(Ut=[Rt,Rt,rt?1/Ct[3]:Rt,Rt])[0],kt[1]=zt[1]*Ut[1],kt[2]=zt[2]*Ut[2],kt[3]=zt[3]*Ut[3],kt;var kt,zt,Ut}),ut=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(xt=>{const Ct=ds([],ys([],wo([],at[xt[0]],at[xt[1]]),wo([],at[xt[2]],at[xt[1]]))),Rt=-gs(Ct,at[xt[1]]);return Ct.concat(Rt)}),ft=[];for(let xt=0;xt<at.length;xt++)ft.push([at[xt][0],at[xt][1],at[xt][2]]);return new _o(ft,ut)}intersectsPrecise(o,g,_e){for(let rt=0;rt<g.length;rt++)if(!to(o,g[rt]))return 0;for(let rt=0;rt<this.planes.length;rt++)if(!to(o,this.planes[rt]))return 0;for(const rt of _e)for(const ot of this.frustumEdges){const at=ys([],rt,ot),ut=en(at);if(ut===0)continue;tn(at,at,1/ut);const ft=qn(this.points,this.points[0],at),xt=qn(o,this.points[0],at);if(ft[0]>xt[1]||xt[0]>ft[1])return 0}return 1}containsPoint(o){for(const g of this.planes){const _e=g[3];if(gs([g[0],g[1],g[2]],o)+_e<0)return!1}return!0}}class is{static fromPoints(o){const g=[1/0,1/0,1/0],_e=[-1/0,-1/0,-1/0];for(const rt of o)xr(g,g,rt),qr(_e,_e,rt);return new is(g,_e)}static fromTileIdAndHeight(o,g,_e){const rt=1<<o.canonical.z,ot=o.canonical.x,at=o.canonical.y;return new is([ot/rt,at/rt,g],[(ot+1)/rt,(at+1)/rt,_e])}static applyTransform(o,g){const _e=o.getCorners();for(let rt=0;rt<_e.length;++rt)_s(_e[rt],_e[rt],g);return is.fromPoints(_e)}static applyTransformFast(o,g){const _e=[g[12],g[13],g[14]],rt=[..._e];for(let ot=0;ot<3;ot++)for(let at=0;at<3;at++){const ut=g[4*at+ot],ft=ut*o.min[at],xt=ut*o.max[at];_e[ot]+=Math.min(ft,xt),rt[ot]+=Math.max(ft,xt)}return new is(_e,rt)}static projectAabbCorners(o,g){const _e=o.getCorners();for(let rt=0;rt<_e.length;++rt)_s(_e[rt],_e[rt],g);return _e}constructor(o,g){this.min=o,this.max=g,this.center=tn([],rr([],this.min,this.max),.5)}quadrant(o){const g=[o%2==0,o<2],_e=dn(this.min),rt=dn(this.max);for(let ot=0;ot<g.length;ot++)_e[ot]=g[ot]?this.min[ot]:this.center[ot],rt[ot]=g[ot]?this.center[ot]:this.max[ot];return rt[2]=this.max[2],new is(_e,rt)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,g=this.max;return[[o[0],o[1],o[2]],[g[0],o[1],o[2]],[g[0],g[1],o[2]],[o[0],g[1],o[2]],[o[0],o[1],g[2]],[g[0],o[1],g[2]],[g[0],g[1],g[2]],[o[0],g[1],g[2]]]}intersects(o){return this.intersectsAabb(o.bounds)?ms(o,this.getCorners()):0}intersectsFlat(o){return this.intersectsAabb(o.bounds)?ms(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(o,g){return g||this.intersects(o)?Ns(o,this.getCorners()):0}intersectsPreciseFlat(o,g){return g||this.intersectsFlat(o)?Ns(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(o){for(let g=0;g<3;++g)if(this.min[g]>o.max[g]||o.min[g]>this.max[g])return!1;return!0}intersectsAabbXY(o){return!(this.min[0]>o.max[0]||o.min[0]>this.max[0]||this.min[1]>o.max[1]||o.min[1]>this.max[1])}encapsulate(o){for(let g=0;g<3;g++)this.min[g]=Math.min(this.min[g],o.min[g]),this.max[g]=Math.max(this.max[g],o.max[g])}encapsulatePoint(o){for(let g=0;g<3;g++)this.min[g]=Math.min(this.min[g],o[g]),this.max[g]=Math.max(this.max[g],o[g])}closestPoint(o){return[Math.max(Math.min(this.max[0],o[0]),this.min[0]),Math.max(Math.min(this.max[1],o[1]),this.min[1]),Math.max(Math.min(this.max[2],o[2]),this.min[2])]}}Jn(is,"Aabb");class go{constructor(o,g){this.feature=o,this.metersToTile=g,this.index=0}get(){const o=this.feature.vertices[this.index],g=this.feature.vertexProps[this.index].dir,_e=g[1],rt=-g[0],ot=(o.extent+1)*this.metersToTile;return[new _n(Math.trunc(o.position[0]+_e*ot),Math.trunc(o.position[1]+rt*ot)),new _n(Math.trunc(o.position[0]-_e*ot),Math.trunc(o.position[1]-rt*ot))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Ds{constructor(o,g,_e,rt,ot,at){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[xs(),xs(),xs(),xs(),xs(),xs(),xs()],this.id=o,this.heightRange={min:_e,max:_e},this.safeArea=g,this.constantHeight=_e,this.constantHeight==null&&(this.constantHeight!=null||rt.length!==0)){this.vertices=rt,this.edges=ot,this.edges=this.edges.filter(ut=>{return ut.a<this.vertices.length&&ut.b<this.vertices.length&&!((ft=this.vertices[ut.a].position)[0]===(xt=this.vertices[ut.b].position)[0]&&ft[1]===xt[1]);var ft,xt}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const ut of this.vertices)this.vertexProps.push({dir:As(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,ut.height),this.heightRange.max=Math.max(this.heightRange.max,ut.height);for(const ut of this.edges){const ft=this.vertices[ut.a].position,xt=this.vertices[ut.b].position,Ct=Jo(xs(),xt,ft),Rt=Go(Ct),kt=na(xs(),Ct,1/Rt);this.edgeProps.push({vec:Ct,dir:kt,len:Rt});const zt=this.vertexProps[ut.a].dir,Ut=this.vertexProps[ut.b].dir;Eo(zt,zt,kt),Eo(Ut,Ut,kt)}for(const ut of this.vertexProps)ut.dir[0]===0&&ut.dir[1]===0||_c(ut.dir,ut.dir);this.tessellate(at)}}pointElevation(o){if(this.constantHeight!=null)return this.constantHeight;const g=this.getClosestEdge(o);if(g==null)return 0;const[_e,rt]=g;return Cs(this.vertices[this.edges[_e].a].height,this.vertices[this.edges[_e].b].height,rt)}computeSlopeNormal(o,g){const _e=this.getClosestEdge(o);if(!_e)return yr(0,0,1);const rt=_e[0],ot=this.edges[rt],at=this.edgeProps[rt].vec,ut=yr(at[0],at[1],(this.vertices[ot.b].height-this.vertices[ot.a].height)*g),ft=yr(ut[1],-ut[0],0);ys(ft,ft,ut);const xt=en(ft);return xt>0?tn(ft,ft,1/xt):Ar(ft,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(o){if(this.edges.length===0)return;let g=0,_e=Number.POSITIVE_INFINITY,rt=0;const[ot,at,ut,ft,xt,Ct,Rt]=this._tmpVec2;ks(Rt,o.x,o.y);const kt=new ns(Rt,null);for(let zt=0;zt<this.edges.length;zt++){const Ut=this.edges[zt],Kt=this.edgeProps[zt].dir;kt.dir=Kt;const er=this.vertices[Ut.a].position,Jt=this.vertices[Ut.b].position,or=kt.intersectsPlane(er,this.vertexProps[Ut.a].dir,ot),cr=kt.intersectsPlane(Jt,this.vertexProps[Ut.b].dir,at);if(!or||!cr)continue;Jo(ut,at,ot),Jo(ft,Rt,ot);const pr=Il(ut,ut),Sr=pr>0?Il(ft,ut)/pr:0,br=tr(Sr,0,1),Pr=Math.abs((Sr-br)*this.edgeProps[zt].len);Jo(xt,Rt,er),ks(Ct,Kt[1],-Kt[0]);const Dr=Pr+Math.abs(Il(xt,Ct));Dr<_e&&(g=zt,_e=Dr,rt=br)}return[g,rt]}tessellate(o){const g=Qr(),_e=Qr(),rt=Qr(),ot=Qr();for(let at=this.edges.length-1;at>=0;--at){const ut=this.edges[at].a,ft=this.edges[at].b,{position:xt,height:Ct,extent:Rt}=this.vertices[ut],{position:kt,height:zt,extent:Ut}=this.vertices[ft],Kt=this.vertexProps[ut].dir,er=this.vertexProps[ft].dir;if(Ar(g,xt[0]/o,xt[1]/o,Ct),Ar(_e,kt[0]/o,kt[1]/o,zt),Ar(rt,Kt[1],-Kt[0],0),tn(rt,rt,Rt),Ar(ot,er[1],-er[0],0),tn(ot,ot,Ut),this.distSqLines(yr(g[0]+.5*rt[0],g[1]+.5*rt[1],g[2]+.5*rt[2]),yr(_e[0]-.5*ot[0],_e[1]-.5*ot[1],_e[2]-.5*ot[2]),yr(g[0]-.5*rt[0],g[1]-.5*rt[1],g[2]-.5*rt[2]),yr(_e[0]+.5*ot[0],_e[1]+.5*ot[1],_e[2]+.5*ot[2]))<=.0025000000000000005)continue;const Jt=this.vertices.length,or=Eo(xs(),xt,kt);this.vertices.push({position:na(or,or,.5),height:.5*(Ct+zt),extent:.5*(Rt+Ut)});const cr=Eo(xs(),Kt,er);this.vertexProps.push({dir:_c(cr,cr)}),this.edges.splice(at,1),this.edgeProps.splice(at,1),this.edges.push({a:ut,b:Jt}),this.edges.push({a:Jt,b:ft});const pr=Jo(xs(),this.vertices[Jt].position,xt),Sr=Go(pr),br={vec:pr,dir:na(xs(),pr,1/Sr),len:Sr};this.edgeProps.push(br),this.edgeProps.push(br)}}distSqLines(o,g,_e,rt){const ot=ur(Qr(),g,o),at=ur(Qr(),rt,_e),ut=ur(Qr(),o,_e),ft=gs(ot,ot),xt=gs(ot,at),Ct=gs(ot,ut),Rt=gs(at,at),kt=gs(at,ut),zt=ft*Rt-xt*xt;if(zt===0)return Ts(Hs(ot,_e,rt,gs(ut,at)/gs(at,at)),o);const Ut=(ft*kt-xt*Ct)/zt;return Ts(Hs(ot,o,g,(xt*kt-Ct*Rt)/zt),Hs(at,_e,rt,Ut))}}class To{static parseFrom(o,g){const _e=In.parse(o);if(!_e)return[];let{vertices:rt,features:ot}=_e;const at=1/ir(g);ot.sort((Ct,Rt)=>Ct.id-Rt.id),rt.sort((Ct,Rt)=>Ct.id-Rt.id||Ct.idx-Rt.idx),rt=rt.filter((Ct,Rt,kt)=>Rt===kt.findIndex(zt=>zt.id===Ct.id&&zt.idx===Ct.idx));const ut=new Array;let ft=0;const xt=rt.length;for(const Ct of ot){if(Ct.constantHeight){ut.push(new Ds(Ct.id,Ct.bounds,Ct.constantHeight));continue}for(;ft!==xt&&rt[ft].id<Ct.id;)ft++;if(ft===xt||rt[ft].id!==Ct.id)continue;const Rt=new Array,kt=new Array,zt=ft;for(;ft!==xt&&rt[ft].id===Ct.id;){const Ut=rt[ft];if(Rt.push({position:Ut.position,height:Ut.height,extent:Ut.extent}),ft!==zt&&rt[ft-1].idx===Ut.idx-1){const Kt=ft-zt;kt.push({a:Kt-1,b:Kt})}ft++}ut.push(new Ds(Ct.id,Ct.bounds,void 0,Rt,kt,at))}return ut}static getElevationFeature(o,g){if(!g)return;const _e=+o.properties[an];return Number.isNaN(_e)?void 0:g.find(rt=>rt.id===_e)}}class Do{constructor(o,g){this.zScale=1,this.xOffset=0,this.yOffset=0,o.equals(g)||(this.zScale=Math.pow(2,g.z-o.z),this.xOffset=(o.x*this.zScale-g.x)*jn,this.yOffset=(o.y*this.zScale-g.y)*jn)}constantElevation(o,g){if(o.constantHeight!=null)return this.computeBiasedHeight(o.constantHeight,g)}pointElevation(o,g,_e){const rt=this.constantElevation(g,_e);return rt??(o.x=o.x*this.zScale+this.xOffset,o.y=o.y*this.zScale+this.yOffset,this.computeBiasedHeight(g.pointElevation(o),_e))}computeBiasedHeight(o,g){return g<=0?o:o+g*lr(0,g,o>=0?o:Math.abs(.5*o))}}Jn(Ds,"ElevationFeature");class Po{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new jm,this.indexArray=new tu,this.segments=new _l,this.programConfigurations=new Pp(o.layers,{zoom:o.zoom,lut:o.lut}),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new sm),this.worldview=o.worldview,this.hasAppearances=null}updateFootprints(o,g){}updateAppearances(o,g,_e,rt){}populate(o,g,_e,rt){const ot=this.layers[0],at=[];let ut=null;ot.type==="circle"&&(ut=ot.layout.get("circle-sort-key"));for(const{feature:xt,id:Ct,index:Rt,sourceLayerIndex:kt}of o){const zt=this.layers[0]._featureFilter.needGeometry,Ut=Ur(xt,zt);if(!this.layers[0]._featureFilter.filter(new Xo(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),Ut,_e))continue;const Kt=ut?ut.evaluate(Ut,{},_e):void 0,er={id:Ct,properties:xt.properties,type:xt.type,sourceLayerIndex:kt,index:Rt,geometry:zt?Ut.geometry:kr(xt,_e,rt),patterns:{},sortKey:Kt};at.push(er)}ut&&at.sort((xt,Ct)=>xt.sortKey-Ct.sortKey);let ft=null;rt.projection.name==="globe"&&(this.globeExtVertexArray=new c_,ft=rt.projection);for(const xt of at){const{geometry:Ct,index:Rt,sourceLayerIndex:kt}=xt,zt=o[Rt].feature;this.addFeature(xt,Ct,Rt,g.availableImages,_e,ft,g.brightness,g.elevationFeatures),g.featureIndex.insert(zt,Ct,Rt,kt,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(o,g,_e,rt,ot,at,ut){this.programConfigurations.updatePaintArrays(o,g,ot,_e,rt,at,ut,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,tE.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,rE.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=o.createVertexBuffer(this.elevatedLayoutVertexArray,vT.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(o,g,_e,rt,ot,at,ut,ft){let xt;this.elevationMode!=="none"&&(xt=To.getElevationFeature(o,ft));for(const Ct of g)for(const Rt of Ct){const kt=Rt.x,zt=Rt.y;if(kt<0||kt>=jn||zt<0||zt>=jn)continue;if(at){const er=at.projectTilePoint(kt,zt,ot),Jt=at.upVector(ot,kt,zt);this.addGlobeExtVertex(er,Jt),this.addGlobeExtVertex(er,Jt),this.addGlobeExtVertex(er,Jt),this.addGlobeExtVertex(er,Jt)}const Ut=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),Kt=Ut.vertexLength;if(this.addCircleVertex(kt,zt,-1,-1),this.addCircleVertex(kt,zt,1,-1),this.addCircleVertex(kt,zt,1,1),this.addCircleVertex(kt,zt,-1,1),this.elevationMode!=="none"){const er=xt?xt.pointElevation(new _n(kt,zt)):0;this.hasElevation=this.hasElevation||er!==0;for(let Jt=0;Jt<4;Jt++)this.elevatedLayoutVertexArray.emplaceBack(er)}this.indexArray.emplaceBack(Kt,Kt+1,Kt+2),this.indexArray.emplaceBack(Kt,Kt+2,Kt+3),Ut.vertexLength+=4,Ut.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,_e,{},rt,ot,ut,void 0,this.worldview)}addCircleVertex(o,g,_e,rt){this.layoutVertexArray.emplaceBack(2*o+(_e+1)/2,2*g+(rt+1)/2)}addGlobeExtVertex(o,g){this.globeExtVertexArray.emplaceBack(o.x,o.y,o.z,g[0]*16384,g[1]*16384,g[2]*16384)}}function mo(b,o){for(let g=0;g<b.length;g++)if(Oo(o,b[g]))return!0;for(let g=0;g<o.length;g++)if(Oo(b,o[g]))return!0;return!!xa(b,o)}function Vs(b,o,g){return!!Oo(b,o)||!!Yo(o,b,g)}function bo(b,o){if(b.length===1)return wl(o,b[0]);for(let g=0;g<o.length;g++){const _e=o[g];for(let rt=0;rt<_e.length;rt++)if(Oo(b,_e[rt]))return!0}for(let g=0;g<b.length;g++)if(wl(o,b[g]))return!0;for(let g=0;g<o.length;g++)if(xa(b,o[g]))return!0;return!1}function Al(b,o,g){if(b.length>1){if(xa(b,o))return!0;for(let _e=0;_e<o.length;_e++)if(Yo(o[_e],b,g))return!0}for(let _e=0;_e<b.length;_e++)if(Yo(b[_e],o,g))return!0;return!1}function xa(b,o){if(b.length===0||o.length===0)return!1;for(let g=0;g<b.length-1;g++){const _e=b[g],rt=b[g+1];for(let ot=0;ot<o.length-1;ot++)if(So(_e,rt,o[ot],o[ot+1]))return!0}return!1}function So(b,o,g,_e){return zs(b,g,_e)!==zs(o,g,_e)&&zs(b,o,g)!==zs(b,o,_e)}function uo(b,o,g){return(b.x-g.x)*(o.y-g.y)-(b.y-g.y)*(o.x-g.x)}function Us(b,o,g,_e){const rt=uo(b,o,_e),ot=uo(b,o,g);if(Math.sign(rt)===Math.sign(ot))return;const at=uo(g,_e,b),ut=at+ot-rt;return Math.sign(at)!==Math.sign(ut)?[at/(at-ut),ot/(ot-rt)]:void 0}function Yo(b,o,g){const _e=g*g;if(o.length===1)return b.distSqr(o[0])<_e;for(let rt=1;rt<o.length;rt++)if(Fl(b,o[rt-1],o[rt])<_e)return!0;return!1}function Fl(b,o,g){const _e=o.distSqr(g);if(_e===0)return b.distSqr(o);const rt=((b.x-o.x)*(g.x-o.x)+(b.y-o.y)*(g.y-o.y))/_e;return b.distSqr(rt<0?o:rt>1?g:g.sub(o)._mult(rt)._add(o))}function wl(b,o){let g,_e,rt,ot=!1;for(let at=0;at<b.length;at++){g=b[at];for(let ut=0,ft=g.length-1;ut<g.length;ft=ut++)_e=g[ut],rt=g[ft],_e.y>o.y!=rt.y>o.y&&o.x<(rt.x-_e.x)*(o.y-_e.y)/(rt.y-_e.y)+_e.x&&(ot=!ot)}return ot}function Oo(b,o){let g=!1;for(let _e=0,rt=b.length-1;_e<b.length;rt=_e++){const ot=b[_e],at=b[rt];ot.y>o.y!=at.y>o.y&&o.x<(at.x-ot.x)*(o.y-ot.y)/(at.y-ot.y)+ot.x&&(g=!g)}return g}function zu(b,o,g,_e,rt){for(const at of b)if(o<=at.x&&g<=at.y&&_e>=at.x&&rt>=at.y)return!0;const ot=[new _n(o,g),new _n(o,rt),new _n(_e,rt),new _n(_e,g)];if(b.length>2){for(const at of ot)if(Oo(b,at))return!0}for(let at=0;at<b.length-1;at++)if(Eu(b[at],b[at+1],ot))return!0;return!1}function Eu(b,o,g){const _e=g[0],rt=g[2];if(b.x<_e.x&&o.x<_e.x||b.x>rt.x&&o.x>rt.x||b.y<_e.y&&o.y<_e.y||b.y>rt.y&&o.y>rt.y)return!1;const ot=zs(b,o,g[0]);return ot!==zs(b,o,g[1])||ot!==zs(b,o,g[2])||ot!==zs(b,o,g[3])}function nu(b,o,g,_e,rt,ot){let at=o.y-b.y,ut=b.x-o.x;if(ot=ot||0){const ft=at*at+ut*ut;if(ft===0)return!0;const xt=Math.sqrt(ft);at/=xt,ut/=xt}return!((g.x-b.x)*at+(g.y-b.y)*ut-ot<0||(_e.x-b.x)*at+(_e.y-b.y)*ut-ot<0||(rt.x-b.x)*at+(rt.y-b.y)*ut-ot<0)}function Pu(b,o,g,_e,rt,ot,at){return!(nu(b,o,_e,rt,ot,at)||nu(o,g,_e,rt,ot,at)||nu(g,b,_e,rt,ot,at)||nu(_e,rt,b,o,g,at)||nu(rt,ot,b,o,g,at)||nu(ot,_e,b,o,g,at))}function Iu(b,o,g){const _e=o.paint.get(b).value;return _e.kind==="constant"?_e.value:g.programConfigurations.get(o.id).getMaxValue(b)}function xu(b){return Math.sqrt(b[0]*b[0]+b[1]*b[1])}function np(b,o,g,_e,rt){if(!o[0]&&!o[1])return b;const ot=_n.convert(o)._mult(rt);g==="viewport"&&ot._rotate(-_e);const at=[];for(let ut=0;ut<b.length;ut++)at.push(b[ut].sub(ot));return at}function _p(b,o,g,_e){const rt=_n.convert(b)._mult(_e);return o==="viewport"&&rt._rotate(-g),rt}let qu,Nl;function Gl(b,o,g){var _e=2*Math.PI*6378137/256/Math.pow(2,g);return[b*_e-2*Math.PI*6378137/2,o*_e-2*Math.PI*6378137/2]}Jn(Po,"CircleBucket",{omit:["layers"]});class Fo{constructor(o,g,_e){this.z=o,this.x=g,this.y=_e,this.key=El(0,o,o,g,_e)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}isChildOf(o){const g=this.z-o.z;return o.z===0||o.z<this.z&&o.x===this.x>>g&&o.y===this.y>>g}url(o,g){const _e=function(ot,at,ut){var ft=Gl(256*ot,256*(at=Math.pow(2,ut)-at-1),ut),xt=Gl(256*(ot+1),256*(at+1),ut);return ft[0]+","+ft[1]+","+xt[0]+","+xt[1]}(this.x,this.y,this.z),rt=function(ot,at,ut){let ft,xt="";for(let Ct=ot;Ct>0;Ct--)ft=1<<Ct-1,xt+=(at&ft?1:0)+(ut&ft?2:0);return xt}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(g==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",rt).replace("{bbox-epsg-3857}",_e)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Kl{constructor(o,g){this.wrap=o,this.canonical=g,this.key=El(o,g.z,g.z,g.x,g.y)}}class Rl{constructor(o,g,_e,rt,ot){this.overscaledZ=o,this.wrap=g,this.canonical=new Fo(_e,+rt,+ot),this.key=g===0&&o===_e?this.canonical.key:El(g,o,_e,rt,ot)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const g=this.canonical.z-o;return o>this.canonical.z?new Rl(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Rl(o,this.wrap,o,this.canonical.x>>g,this.canonical.y>>g)}calculateScaledKey(o,g=!0){if(this.overscaledZ===o&&g)return this.key;if(o>this.canonical.z)return El(this.wrap*+g,o,this.canonical.z,this.canonical.x,this.canonical.y);{const _e=this.canonical.z-o;return El(this.wrap*+g,o,o,this.canonical.x>>_e,this.canonical.y>>_e)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const g=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.z<this.canonical.z&&o.canonical.x===this.canonical.x>>g&&o.canonical.y===this.canonical.y>>g}children(o){if(this.overscaledZ>=o)return[new Rl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const g=this.canonical.z+1,_e=2*this.canonical.x,rt=2*this.canonical.y;return[new Rl(g,this.wrap,g,_e,rt),new Rl(g,this.wrap,g,_e+1,rt),new Rl(g,this.wrap,g,_e,rt+1),new Rl(g,this.wrap,g,_e+1,rt+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Rl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Rl(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Kl(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function El(b,o,g,_e,rt){const ot=1<<Math.min(g,22);let at=ot*(rt%ot)+_e%ot;return b&&g<22&&(at+=ot*ot*((b<0?-2*b-1:2*b)%(1<<2*(22-g)))),16*(32*at+g)+(o-g)}const vp=[b=>{let o=b.canonical.x-1,g=b.wrap;return o<0&&(o=(1<<b.canonical.z)-1,g--),new Rl(b.overscaledZ,g,b.canonical.z,o,b.canonical.y)},b=>{let o=b.canonical.x+1,g=b.wrap;return o===1<<b.canonical.z&&(o=0,g++),new Rl(b.overscaledZ,g,b.canonical.z,o,b.canonical.y)},b=>new Rl(b.overscaledZ,b.wrap,b.canonical.z,b.canonical.x,(b.canonical.y===0?1<<b.canonical.z:b.canonical.y)-1),b=>new Rl(b.overscaledZ,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y===(1<<b.canonical.z)-1?0:b.canonical.y+1)];Jn(Fo,"CanonicalTileID"),Jn(Rl,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Gy=Ys([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ip}=Gy,Hy=Ys([{name:"a_pos_3",components:3,type:"Int16"}]);var H0=Ys([{name:"a_pos",type:"Int16",components:2}]);function Wp(b){return b*Ru/it}const um=[new is([yp,yp,yp],[xp,xp,xp]),new is([yp,yp,yp],[0,0,xp]),new is([0,yp,yp],[xp,0,xp]),new is([yp,0,yp],[0,xp,xp]),new is([0,0,yp],[xp,xp,xp])];function W0(b,o,g,_e=!0){const rt=tn([],b._camera.position,b.worldSize),ot=[o,g,1,1];xl(ot,ot,b.pixelMatrixInverse),Jl(ot,ot,1/ot[3]);const at=ds([],wo([],ot,rt)),ut=b.globeMatrix,ft=[ut[12],ut[13],ut[14]],xt=wo([],ft,rt),Ct=en(xt),Rt=ds([],xt),kt=b.worldSize/(2*Math.PI),zt=gs(Rt,at),Ut=Math.asin(kt/Ct);if(Ut<Math.acos(zt)){if(!_e)return null;const nn=[],$r=[];tn(nn,at,Ct/zt),ds($r,wo($r,nn,xt)),ds(at,rr(at,xt,tn(at,$r,Math.tan(Ut)*Ct)))}const Kt=[];new _i(rt,at).closestPointOnSphere(ft,kt,Kt);const er=ds([],Ll(ut,0)),Jt=ds([],Ll(ut,1)),or=ds([],Ll(ut,2)),cr=gs(er,Kt),pr=gs(Jt,Kt),Sr=gs(or,Kt),br=Mu(Math.asin(-pr/kt));let Pr=Mu(Math.atan2(cr,Sr));Pr=b.center.lng+function(nn,$r){const un=($r-nn+180)%360-180;return un<-180?un+360:un}(b.center.lng,Pr);const Dr=mt(Pr),Or=tr(St(br),0,1);return new hr(Dr,Or)}class zm{constructor(o,g,_e){this.a=wo([],o,_e),this.b=wo([],g,_e),this.center=_e;const rt=ds([],this.a),ot=ds([],this.b);this.angle=Math.acos(gs(rt,ot))}}function hm(b,o){if(b.angle===0)return null;let g;return g=b.a[o]===0?1/b.angle*.5*Math.PI:1/b.angle*Math.atan(b.b[o]/b.a[o]/Math.sin(b.angle)-1/Math.tan(b.angle)),g<0||g>1?null:function(_e,rt,ot,at){const ut=Math.sin(ot);return _e*(Math.sin((1-at)*ot)/ut)+rt*(Math.sin(at*ot)/ut)}(b.a[o],b.b[o],b.angle,tr(g,0,1))+b.center[o]}function kp(b){if(b.z<=1)return um[b.z+2*b.y+b.x];const o=kT(nE(b));return is.fromPoints(o)}function dm(b,o,g){return tn(b,b,1-g),vn(b,b,o,g)}function YS(b,o,g){for(const _e of b)_s(_e,_e,o),tn(_e,_e,g)}function QS(b,o,g,_e){const rt=o/b.worldSize,ot=b.globeMatrix;if(g.z<=1){const Or=kp(g).getCorners();return YS(Or,ot,rt),is.fromPoints(Or)}const at=nE(g,_e),ut=kT(at,Ru+Wp(b._tileCoverLift));YS(ut,ot,rt);const ft=Number.MAX_VALUE,xt=[-ft,-ft,-ft],Ct=[ft,ft,ft];if(at.contains(b.center)){for(const $r of ut)xr(Ct,Ct,$r),qr(xt,xt,$r);xt[2]=0;const Or=b.point,nn=[Or.x*rt,Or.y*rt,0];return xr(Ct,Ct,nn),qr(xt,xt,nn),new is(Ct,xt)}if(b._tileCoverLift>0){for(const Or of ut)xr(Ct,Ct,Or),qr(xt,xt,Or);return new is(Ct,xt)}const Rt=[ot[12]*rt,ot[13]*rt,ot[14]*rt],kt=at.getCenter(),zt=tr(b.center.lat,-qt,qt),Ut=tr(kt.lat,-qt,qt),Kt=mt(b.center.lng),er=St(zt);let Jt=Kt-mt(kt.lng);const or=er-St(Ut);Jt>.5?Jt-=1:Jt<-.5&&(Jt+=1);let cr=0;Math.abs(Jt)>Math.abs(or)?cr=Jt>=0?1:3:(cr=or>=0?0:2,vn(Rt,Rt,[ot[4]*rt,ot[5]*rt,ot[6]*rt],-Math.sin(Xs(or>=0?at.getSouth():at.getNorth()))*Ru));const pr=ut[cr],Sr=ut[(cr+1)%4],br=new zm(pr,Sr,Rt),Pr=[hm(br,0)||pr[0],hm(br,1)||pr[1],hm(br,2)||pr[2]],Dr=q0(b.zoom);if(Dr>0){const Or=function({x:$r,y:un,z:gn},yn,Sn,An,wn){const En=1/(1<<gn);let ln=$r*En,on=ln+En,Tn=un*En,On=Tn+En,kn=0;const ls=(ln+on)/2-An;return ls>.5?kn=-1:ls<-.5&&(kn=1),ln=((ln+kn)*yn-(An*=yn))*Sn+An,on=((on+kn)*yn-An)*Sn+An,Tn=(Tn*yn-(wn*=yn))*Sn+wn,On=(On*yn-wn)*Sn+wn,[[ln,On,0],[on,On,0],[on,Tn,0],[ln,Tn,0]]}(g,o,b._pixelsPerMercatorPixel,Kt,er);for(let $r=0;$r<ut.length;$r++)dm(ut[$r],Or[$r],Dr);const nn=rr([],Or[cr],Or[(cr+1)%4]);tn(nn,nn,.5),dm(Pr,nn,Dr)}for(const Or of ut)xr(Ct,Ct,Or),qr(xt,xt,Or);return Ct[2]=Math.min(pr[2],Sr[2]),xr(Ct,Ct,Pr),qr(xt,xt,Pr),new is(Ct,xt)}function nE({x:b,y:o,z:g},_e=!1){const rt=1/(1<<g),ot=new $(Dt(b*rt),o===(1<<g)-1&&_e?-90:Ht((o+1)*rt)),at=new $(Dt((b+1)*rt),o===0&&_e?90:Ht(o*rt));return new st(ot,at)}function kT(b,o=Ru){const g=Xs(b.getNorth()),_e=Xs(b.getSouth()),rt=Math.cos(g),ot=Math.cos(_e),at=Math.sin(g),ut=Math.sin(_e),ft=b.getWest(),xt=b.getEast();return[p0(ot,ut,ft,o),p0(ot,ut,xt,o),p0(rt,at,xt,o),p0(rt,at,ft,o)]}function c1(b,o,g,_e){const rt=1<<g.z,ot=(b/jn+g.x)/rt;return G0(Ht((o/jn+g.y)/rt),Dt(ot),_e)}function iE({min:b,max:o}){return IT/Math.max(o[0]-b[0],o[1]-b[1],o[2]-b[2])}const JS=new Float64Array(16);function sE(b){const o=iE(b),g=mr(JS,[o,o,o]);return Nt(g,g,Mn([],b.min))}function MT(b){const o=(_e=b.min,(g=JS)[0]=1,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=1,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=1,g[11]=0,g[12]=_e[0],g[13]=_e[1],g[14]=_e[2],g[15]=1,g);var g,_e;const rt=1/iE(b);return Vt(o,o,[rt,rt,rt])}function DT(b){const o=jn/(2*Math.PI);return b/(2*Math.PI)/o}function eC(b,o){return jn/(512*Math.pow(2,b))*iE(kp(o))}function tC(b,o,g,_e,rt){const ot=DT(g),at=[b,o,-g/(2*Math.PI)],ut=$t(new Float64Array(16));return Nt(ut,ut,at),Vt(ut,ut,[ot,ot,ot]),Xt(ut,ut,Xs(-rt)),nr(ut,ut,Xs(-_e)),ut}function q0(b){return lr(gp,C_,b)}function rC(b,o){const g=G0(o.lat,o.lng),_e=function(Ut){const Kt=G0(Ut._center.lat,Ut._center.lng);let er=ys([],yr(0,1,0),Kt);const Jt=Fr([],-Ut.angle,Kt);er=_s(er,er,Jt),Fr(Jt,-Ut._pitch,er);const or=ds([],Kt);return tn(or,or,Wp(Ut.cameraToCenterDistance/Ut.pixelsPerMeter)),_s(or,or,Jt),rr([],Kt,or)}(b);return at=(rt=ur([],_e,g))[0],ut=rt[1],ft=rt[2],xt=(ot=g)[0],Ct=ot[1],Rt=ot[2],zt=(kt=Math.sqrt((at*at+ut*ut+ft*ft)*(xt*xt+Ct*Ct+Rt*Rt)))&&gs(rt,ot)/kt,Math.acos(Math.min(Math.max(zt,-1),1));var rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt}function NT(b,o){return rC(b,o)>Math.PI/2*1.01}const nC=Xs(85),nP=Math.cos(nC),iP=Math.sin(nC),sP=Mt(),iC=b=>{const o=[];return b.paint.get("circle-pitch-alignment")==="map"&&o.push("PITCH_WITH_MAP"),b.paint.get("circle-pitch-scale")==="map"&&o.push("SCALE_WITH_MAP"),o};function sC(b,o,g,_e,rt,ot,at,ut,ft){if(ot&&b.queryGeometry.isAboveHorizon)return!1;ot&&(ft*=b.pixelToTileUnitsFactor);const xt=b.tileID.canonical,Ct=g.projection.upVectorScale(xt,g.center.lat,g.worldSize).metersToTile;for(const Rt of o)for(const kt of Rt){const zt=kt.add(ut),Ut=rt&&g.elevation?g.elevation.exaggeration()*rt.getElevationAt(zt.x,zt.y,!0):0,Kt=g.projection.projectTilePoint(zt.x,zt.y,xt);if(Ut>0){const cr=g.projection.upVector(xt,zt.x,zt.y);Kt.x+=cr[0]*Ct*Ut,Kt.y+=cr[1]*Ct*Ut,Kt.z+=cr[2]*Ct*Ut}const er=ot?zt:oP(Kt.x,Kt.y,Kt.z,_e),Jt=ot?b.tilespaceRays.map(cr=>lP(cr,Ut)):b.queryGeometry.screenGeometry,or=xl([],[Kt.x,Kt.y,Kt.z,1],_e);if(!at&&ot?ft*=or[3]/g.cameraToCenterDistance:at&&!ot&&(ft*=g.cameraToCenterDistance/or[3]),ot){const cr=Ht((kt.y/jn+xt.y)/(1<<xt.z));ft/=g.projection.pixelsPerMeter(cr,1)/It(1,cr)}if(Vs(Jt,er,ft))return!0}return!1}function oP(b,o,g,_e){const rt=xl([],[b,o,g,1],_e);return new _n(rt[0]/rt[3],rt[1]/rt[3])}const oC=yr(0,0,0),aP=yr(0,0,1);function lP(b,o){const g=Qr();return oC[2]=o,b.intersectsPlane(oC,aP,g),new _n(g[0],g[1])}class aC extends Po{}let lC,cC,uC,hC;function dC(b,{width:o,height:g},_e,rt){if(rt){if(rt instanceof Uint8ClampedArray)rt=new Uint8Array(rt.buffer);else if(rt.length!==o*g*_e)throw new RangeError("mismatched image size")}else rt=new Uint8Array(o*g*_e);return b.width=o,b.height=g,b.data=rt,b}function pC(b,o,g){const{width:_e,height:rt}=o;_e===b.width&&rt===b.height||(LT(b,o,{x:0,y:0},{x:0,y:0},{width:Math.min(b.width,_e),height:Math.min(b.height,rt)},g,null),b.width=_e,b.height=rt,b.data=o.data)}function LT(b,o,g,_e,rt,ot,at,ut){if(rt.width===0||rt.height===0)return o;if(rt.width>b.width||rt.height>b.height||g.x>b.width-rt.width||g.y>b.height-rt.height)throw new RangeError("out of range source coordinates for image copy");if(rt.width>o.width||rt.height>o.height||_e.x>o.width-rt.width||_e.y>o.height-rt.height)throw new RangeError("out of range destination coordinates for image copy");const ft=b.data,xt=o.data,Ct=ot===4&&ut;for(let Rt=0;Rt<rt.height;Rt++){const kt=((g.y+Rt)*b.width+g.x)*ot,zt=((_e.y+Rt)*o.width+_e.x)*ot;if(Ct)for(let Ut=0;Ut<rt.width;Ut++){const Kt=kt+Ut*ot+3,er=zt+Ut*ot;xt[er+0]=255,xt[er+1]=255,xt[er+2]=255,xt[er+3]=ft[Kt]}else if(at)for(let Ut=0;Ut<rt.width;Ut++){const Kt=kt+Ut*ot,er=zt+Ut*ot,Jt=new Ro(ft[Kt+0]/255,ft[Kt+1]/255,ft[Kt+2]/255,ft[Kt+3]).toNonPremultipliedRenderColor(at).toArray();xt[er+0]=Jt[0],xt[er+1]=Jt[1],xt[er+2]=Jt[2],xt[er+3]=Jt[3]}else for(let Ut=0;Ut<rt.width*ot;Ut++)xt[zt+Ut]=ft[kt+Ut]}return o}Jn(aC,"HeatmapBucket",{omit:["layers"]});class K0{constructor(o,g){dC(this,o,1,g)}resize(o){pC(this,new K0(o),1)}clone(){return new K0({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,g,_e,rt,ot){LT(o,g,_e,rt,ot,1,null)}}class ku{constructor(o,g){dC(this,o,4,g)}resize(o){pC(this,new ku(o),4)}replace(o,g){g?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new ku({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,g,_e,rt,ot,at,ut){LT(o,g,_e,rt,ot,4,at,ut)}}class fC{constructor(o,g){this.width=o.width,this.height=o.height,this.data=g instanceof Uint8Array?new Float32Array(g.buffer):g}}function u1(b){const o={},g=b.resolution||256,_e=b.clips?b.clips.length:1,rt=b.image||new ku({width:g,height:_e}),ot=(at,ut,ft)=>{o[b.evaluationKey]=ft;const xt=b.expression.evaluate(o),Ct=xt?xt.toNonPremultipliedRenderColor(null):null;Ct&&(rt.data[at+ut+0]=Math.floor(255*Ct.r),rt.data[at+ut+1]=Math.floor(255*Ct.g),rt.data[at+ut+2]=Math.floor(255*Ct.b),rt.data[at+ut+3]=Math.floor(255*Ct.a))};if(b.clips)for(let at=0,ut=0;at<_e;++at,ut+=4*g)for(let ft=0,xt=0;ft<g;ft++,xt+=4){const Ct=ft/(g-1),{start:Rt,end:kt}=b.clips[at];ot(ut,xt,Rt*(1-Ct)+kt*Ct)}else for(let at=0,ut=0;at<g;at++,ut+=4)ot(0,ut,at/(g-1));return rt}Jn(K0,"AlphaImage"),Jn(ku,"RGBAImage");const cP=Ys([{name:"a_pos",components:2,type:"Int16"}],4),uP=Ys([{name:"a_road_z_offset",components:1,type:"Float32"}],4),hP=Ys([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),dP=Ys([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function A_(b,o,g=2){const _e=o&&o.length,rt=_e?o[0]*g:b.length;let ot=mC(b,0,rt,g,!0);const at=[];if(!ot||ot.next===ot.prev)return at;let ut,ft,xt;if(_e&&(ot=function(Ct,Rt,kt,zt){const Ut=[];for(let Kt=0,er=Rt.length;Kt<er;Kt++){const Jt=mC(Ct,Rt[Kt]*zt,Kt<er-1?Rt[Kt+1]*zt:Ct.length,zt,!1);Jt===Jt.next&&(Jt.steiner=!0),Ut.push(vP(Jt))}Ut.sort(yP);for(let Kt=0;Kt<Ut.length;Kt++)kt=xP(Ut[Kt],kt);return kt}(b,o,ot,g)),b.length>80*g){ut=b[0],ft=b[1];let Ct=ut,Rt=ft;for(let kt=g;kt<rt;kt+=g){const zt=b[kt],Ut=b[kt+1];zt<ut&&(ut=zt),Ut<ft&&(ft=Ut),zt>Ct&&(Ct=zt),Ut>Rt&&(Rt=Ut)}xt=Math.max(Ct-ut,Rt-ft),xt=xt!==0?32767/xt:0}return h1(ot,at,g,ut,ft,xt,0),at}function mC(b,o,g,_e,rt){let ot;if(rt===function(at,ut,ft,xt){let Ct=0;for(let Rt=ut,kt=ft-xt;Rt<ft;Rt+=xt)Ct+=(at[kt]-at[Rt])*(at[Rt+1]+at[kt+1]),kt=Rt;return Ct}(b,o,g,_e)>0)for(let at=o;at<g;at+=_e)ot=_C(at/_e|0,b[at],b[at+1],ot);else for(let at=g-_e;at>=o;at-=_e)ot=_C(at/_e|0,b[at],b[at+1],ot);return ot&&R_(ot,ot.next)&&(f1(ot),ot=ot.next),ot}function Wy(b,o){if(!b)return b;o||(o=b);let g,_e=b;do if(g=!1,_e.steiner||!R_(_e,_e.next)&&yu(_e.prev,_e,_e.next)!==0)_e=_e.next;else{if(f1(_e),_e=o=_e.prev,_e===_e.next)break;g=!0}while(g||_e!==o);return o}function h1(b,o,g,_e,rt,ot,at){if(!b)return;!at&&ot&&function(ft,xt,Ct,Rt){let kt=ft;do kt.z===0&&(kt.z=jT(kt.x,kt.y,xt,Ct,Rt)),kt.prevZ=kt.prev,kt.nextZ=kt.next,kt=kt.next;while(kt!==ft);kt.prevZ.nextZ=null,kt.prevZ=null,function(zt){let Ut,Kt=1;do{let er,Jt=zt;zt=null;let or=null;for(Ut=0;Jt;){Ut++;let cr=Jt,pr=0;for(let br=0;br<Kt&&(pr++,cr=cr.nextZ,cr);br++);let Sr=Kt;for(;pr>0||Sr>0&&cr;)pr!==0&&(Sr===0||!cr||Jt.z<=cr.z)?(er=Jt,Jt=Jt.nextZ,pr--):(er=cr,cr=cr.nextZ,Sr--),or?or.nextZ=er:zt=er,er.prevZ=or,or=er;Jt=cr}or.nextZ=null,Kt*=2}while(Ut>1)}(kt)}(b,_e,rt,ot);let ut=b;for(;b.prev!==b.next;){const ft=b.prev,xt=b.next;if(ot?fP(b,_e,rt,ot):pP(b))o.push(ft.i,b.i,xt.i),f1(b),b=xt.next,ut=xt.next;else if((b=xt)===ut){at?at===1?h1(b=mP(Wy(b),o),o,g,_e,rt,ot,2):at===2&&gP(b,o,g,_e,rt,ot):h1(Wy(b),o,g,_e,rt,ot,1);break}}}function pP(b){const o=b.prev,g=b,_e=b.next;if(yu(o,g,_e)>=0)return!1;const rt=o.x,ot=g.x,at=_e.x,ut=o.y,ft=g.y,xt=_e.y,Ct=Math.min(rt,ot,at),Rt=Math.min(ut,ft,xt),kt=Math.max(rt,ot,at),zt=Math.max(ut,ft,xt);let Ut=_e.next;for(;Ut!==o;){if(Ut.x>=Ct&&Ut.x<=kt&&Ut.y>=Rt&&Ut.y<=zt&&d1(rt,ut,ot,ft,at,xt,Ut.x,Ut.y)&&yu(Ut.prev,Ut,Ut.next)>=0)return!1;Ut=Ut.next}return!0}function fP(b,o,g,_e){const rt=b.prev,ot=b,at=b.next;if(yu(rt,ot,at)>=0)return!1;const ut=rt.x,ft=ot.x,xt=at.x,Ct=rt.y,Rt=ot.y,kt=at.y,zt=Math.min(ut,ft,xt),Ut=Math.min(Ct,Rt,kt),Kt=Math.max(ut,ft,xt),er=Math.max(Ct,Rt,kt),Jt=jT(zt,Ut,o,g,_e),or=jT(Kt,er,o,g,_e);let cr=b.prevZ,pr=b.nextZ;for(;cr&&cr.z>=Jt&&pr&&pr.z<=or;){if(cr.x>=zt&&cr.x<=Kt&&cr.y>=Ut&&cr.y<=er&&cr!==rt&&cr!==at&&d1(ut,Ct,ft,Rt,xt,kt,cr.x,cr.y)&&yu(cr.prev,cr,cr.next)>=0||(cr=cr.prevZ,pr.x>=zt&&pr.x<=Kt&&pr.y>=Ut&&pr.y<=er&&pr!==rt&&pr!==at&&d1(ut,Ct,ft,Rt,xt,kt,pr.x,pr.y)&&yu(pr.prev,pr,pr.next)>=0))return!1;pr=pr.nextZ}for(;cr&&cr.z>=Jt;){if(cr.x>=zt&&cr.x<=Kt&&cr.y>=Ut&&cr.y<=er&&cr!==rt&&cr!==at&&d1(ut,Ct,ft,Rt,xt,kt,cr.x,cr.y)&&yu(cr.prev,cr,cr.next)>=0)return!1;cr=cr.prevZ}for(;pr&&pr.z<=or;){if(pr.x>=zt&&pr.x<=Kt&&pr.y>=Ut&&pr.y<=er&&pr!==rt&&pr!==at&&d1(ut,Ct,ft,Rt,xt,kt,pr.x,pr.y)&&yu(pr.prev,pr,pr.next)>=0)return!1;pr=pr.nextZ}return!0}function mP(b,o){let g=b;do{const _e=g.prev,rt=g.next.next;!R_(_e,rt)&&yC(_e,g,g.next,rt)&&p1(_e,rt)&&p1(rt,_e)&&(o.push(_e.i,g.i,rt.i),f1(g),f1(g.next),g=b=rt),g=g.next}while(g!==b);return Wy(g)}function gP(b,o,g,_e,rt,ot){let at=b;do{let ut=at.next.next;for(;ut!==at.prev;){if(at.i!==ut.i&&bP(at,ut)){let ft=xC(at,ut);return at=Wy(at,at.next),ft=Wy(ft,ft.next),h1(at,o,g,_e,rt,ot,0),void h1(ft,o,g,_e,rt,ot,0)}ut=ut.next}at=at.next}while(at!==b)}function yP(b,o){let g=b.x-o.x;return g===0&&(g=b.y-o.y,g===0)&&(g=(b.next.y-b.y)/(b.next.x-b.x)-(o.next.y-o.y)/(o.next.x-o.x)),g}function xP(b,o){const g=function(rt,ot){let at=ot;const ut=rt.x,ft=rt.y;let xt,Ct=-1/0;if(R_(rt,at))return at;do{if(R_(rt,at.next))return at.next;if(ft<=at.y&&ft>=at.next.y&&at.next.y!==at.y){const Kt=at.x+(ft-at.y)*(at.next.x-at.x)/(at.next.y-at.y);if(Kt<=ut&&Kt>Ct&&(Ct=Kt,xt=at.x<at.next.x?at:at.next,Kt===ut))return xt}at=at.next}while(at!==ot);if(!xt)return null;const Rt=xt,kt=xt.x,zt=xt.y;let Ut=1/0;at=xt;do{if(ut>=at.x&&at.x>=kt&&ut!==at.x&&gC(ft<zt?ut:Ct,ft,kt,zt,ft<zt?Ct:ut,ft,at.x,at.y)){const Kt=Math.abs(ft-at.y)/(ut-at.x);p1(at,rt)&&(Kt<Ut||Kt===Ut&&(at.x>xt.x||at.x===xt.x&&_P(xt,at)))&&(xt=at,Ut=Kt)}at=at.next}while(at!==Rt);return xt}(b,o);if(!g)return o;const _e=xC(g,b);return Wy(_e,_e.next),Wy(g,g.next)}function _P(b,o){return yu(b.prev,b,o.prev)<0&&yu(o.next,b,b.next)<0}function jT(b,o,g,_e,rt){return(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b=(b-g)*rt|0)|b<<8))|b<<4))|b<<2))|b<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-_e)*rt|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function vP(b){let o=b,g=b;do(o.x<g.x||o.x===g.x&&o.y<g.y)&&(g=o),o=o.next;while(o!==b);return g}function gC(b,o,g,_e,rt,ot,at,ut){return(rt-at)*(o-ut)>=(b-at)*(ot-ut)&&(b-at)*(_e-ut)>=(g-at)*(o-ut)&&(g-at)*(ot-ut)>=(rt-at)*(_e-ut)}function d1(b,o,g,_e,rt,ot,at,ut){return!(b===at&&o===ut)&&gC(b,o,g,_e,rt,ot,at,ut)}function bP(b,o){return b.next.i!==o.i&&b.prev.i!==o.i&&!function(g,_e){let rt=g;do{if(rt.i!==g.i&&rt.next.i!==g.i&&rt.i!==_e.i&&rt.next.i!==_e.i&&yC(rt,rt.next,g,_e))return!0;rt=rt.next}while(rt!==g);return!1}(b,o)&&(p1(b,o)&&p1(o,b)&&function(g,_e){let rt=g,ot=!1;const at=(g.x+_e.x)/2,ut=(g.y+_e.y)/2;do rt.y>ut!=rt.next.y>ut&&rt.next.y!==rt.y&&at<(rt.next.x-rt.x)*(ut-rt.y)/(rt.next.y-rt.y)+rt.x&&(ot=!ot),rt=rt.next;while(rt!==g);return ot}(b,o)&&(yu(b.prev,b,o.prev)||yu(b,o.prev,o))||R_(b,o)&&yu(b.prev,b,b.next)>0&&yu(o.prev,o,o.next)>0)}function yu(b,o,g){return(o.y-b.y)*(g.x-o.x)-(o.x-b.x)*(g.y-o.y)}function R_(b,o){return b.x===o.x&&b.y===o.y}function yC(b,o,g,_e){const rt=aE(yu(b,o,g)),ot=aE(yu(b,o,_e)),at=aE(yu(g,_e,b)),ut=aE(yu(g,_e,o));return rt!==ot&&at!==ut||!(rt!==0||!oE(b,g,o))||!(ot!==0||!oE(b,_e,o))||!(at!==0||!oE(g,b,_e))||!(ut!==0||!oE(g,o,_e))}function oE(b,o,g){return o.x<=Math.max(b.x,g.x)&&o.x>=Math.min(b.x,g.x)&&o.y<=Math.max(b.y,g.y)&&o.y>=Math.min(b.y,g.y)}function aE(b){return b>0?1:b<0?-1:0}function p1(b,o){return yu(b.prev,b,b.next)<0?yu(b,o,b.next)>=0&&yu(b,b.prev,o)>=0:yu(b,o,b.prev)<0||yu(b,b.next,o)<0}function xC(b,o){const g=OT(b.i,b.x,b.y),_e=OT(o.i,o.x,o.y),rt=b.next,ot=o.prev;return b.next=o,o.prev=b,g.next=rt,rt.prev=g,_e.next=g,g.prev=_e,ot.next=_e,_e.prev=ot,_e}function _C(b,o,g,_e){const rt=OT(b,o,g);return _e?(rt.next=_e.next,rt.prev=_e,_e.next.prev=rt,_e.next=rt):(rt.prev=rt,rt.next=rt),rt}function f1(b){b.next.prev=b.prev,b.prev.next=b.next,b.prevZ&&(b.prevZ.nextZ=b.nextZ),b.nextZ&&(b.nextZ.prevZ=b.prevZ)}function OT(b,o,g){return{i:b,x:o,y:g,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function m1(b,o){const g=b.length;if(g<=1)return[b];const _e=[];let rt,ot;for(let at=0;at<g;at++){const ut=Fs(b[at]);ut!==0&&(b[at].area=Math.abs(ut),ot===void 0&&(ot=ut<0),ot===ut<0?(rt&&_e.push(rt),rt=[b[at]]):rt.push(b[at]))}if(rt&&_e.push(rt),o>1)for(let at=0;at<_e.length;at++)_e[at].length<=o||(Sx(_e[at],o,1,_e[at].length-1,wP),_e[at]=_e[at].slice(0,o));return _e}function wP(b,o){return o.area-b.area}function vC(b,o,g=1){if(!b)return null;const _e=typeof b=="string"?ju.from(b).getPrimary():b.getPrimary(),rt=typeof b=="string"?null:b.getSecondary();for(const ot of[_e,rt]){if(!ot)continue;const at=ot.id.toString();o.has(at)||o.set(at,[]),ot.scaleSelf(g),o.get(at).push(ot)}return{primary:_e.toString(),secondary:rt?rt.toString():null}}function FT(b,o,g,_e){const rt=_e.patternDependencies;let ot=!1;for(const at of o){const ut=at.paint.get(`${b}-pattern`);ut.isConstant()||(ot=!0),vC(ut.constantOr(null),rt,g)&&(ot=!0)}return ot}function BT(b,o,g,_e,rt,ot){const at=ot.patternDependencies;for(const ut of o){const ft=ut.paint.get(`${b}-pattern`).value;if(ft.kind!=="constant"){let xt=ft.evaluate({zoom:_e},g,{},ot.availableImages);xt=xt&&xt.name?xt.name:xt;const Ct=vC(xt,at,rt);if(!Ct)continue;const{primary:Rt,secondary:kt}=Ct;Rt&&(g.patterns[ut.id]=[Rt,kt].filter(Boolean))}}return g}class bC{constructor(){this.polygons=new Map}add(o,...g){const _e=this.polygons.get(o);_e?_e.push(...g):this.polygons.set(o,g)}merge(o){for(const[g,_e]of o.polygons)this.add(g,..._e)}}class f0{constructor(){this.portals=[]}static isOnBorder(o,g){return o<=0&&g<=0||o>=jn&&g>=jn}static evaluate(o){if(o.length===0)return new f0;let g=[];for(const ft of o)g.push(...ft.portals);if(g.length===0)return new f0;for(const ft of g){const xt=ft.va,Ct=ft.vb;(f0.isOnBorder(xt.x,Ct.x)||f0.isOnBorder(xt.y,Ct.y))&&(ft.type="border")}const _e=g.filter(ft=>ft.type!=="unevaluated"),rt=g.filter(ft=>ft.type==="unevaluated");if(rt.length===0)return new f0;rt.sort((ft,xt)=>ft.hash===xt.hash?ft.isTunnel===xt.isTunnel?0:ft.isTunnel?-1:1:ft.hash<xt.hash?1:-1),g=_e.concat(rt);let ot=_e.length,at=ot,ut=ot;do if(at++,at===g.length||g[ot].hash!==g[at].hash){if(at-ot==2){ut<ot&&(g[ut]=g[ot],g[ot]=null);const ft=g[ut],xt=g[at-1];ft.type=ft.isTunnel!==xt.isTunnel?"tunnel":"polygon",ft.connection={a:ft.connection.a,b:xt.connection.a},ut++}ot=at}while(ot!==g.length);return g.splice(ut),g.sort((ft,xt)=>ft.hash<xt.hash?1:-1),{portals:g}}}Jn(f0,"ElevationPortalGraph"),Jn(bC,"ElevationPolygons");class EP{constructor(o,g,_e){this.outPositions=o,this.outNormals=g,this.outIndices=_e,this.vertexLookup=new Map}addVertex(o,g,_e){let rt=o[2];_e!=null&&(rt*=_e);const ot=`${o[0]},${o[1]},${o[2]},${g[0]},${g[1]},${g[2]}`,at=this.vertexLookup.get(ot);if(at!=null)return at;const ut=this.outPositions.length;this.vertexLookup.set(ot,ut);const ft=Math.trunc(16384*g[0]),xt=Math.trunc(16384*g[1]),Ct=Math.trunc(16384*g[2]);return this.outPositions.emplaceBack(o[0],o[1],rt),this.outNormals.emplaceBack(ft,xt,Ct),ut}addTriangle(o,g,_e){this.outIndices.emplaceBack(o,g,_e)}addTriangles(o,g,_e){if(o.length===0)return;const rt=_e.length===1,ot=Qr(),at=Qr();for(let ut=0;ut<o.length;ut+=3){const ft=g[o[ut+0]],xt=g[o[ut+1]],Ct=g[o[ut+2]],Rt=rt?_e[0]:_e[o[ut+1]],kt=rt?_e[0]:_e[o[ut+2]];Ar(ot,ft.x,ft.y,rt?_e[0]:_e[o[ut+0]]);const zt=this.addVertex(ot,at);Ar(ot,xt.x,xt.y,Rt);const Ut=this.addVertex(ot,at);Ar(ot,Ct.x,Ct.y,kt);const Kt=this.addVertex(ot,at);this.outIndices.emplaceBack(zt,Ut,Kt)}}addQuad(o,g,_e,rt,ot,at){const ut=this.addVertex(o,ot,at),ft=this.addVertex(g,ot,at),xt=this.addVertex(_e,ot,at),Ct=this.addVertex(rt,ot,at);this.addTriangle(ut,ft,xt),this.addTriangle(xt,Ct,ut)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class sp{constructor(o,g,_e,rt){this.unevaluatedPortals=new f0,this.portalPolygons=new bC,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new $v,this.vertexNormals=new Gv,this.indexArray=new tu,this.tileToMeters=ir(o),this.bridgeProgramConfigurations=new Pp(g,{zoom:_e,lut:rt},ot=>ot!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Pp(g,{zoom:_e,lut:rt},ot=>ot!=="fill-bridge-guard-rail-color")}addVertices(o,g){const _e=this.unevalVertices.length;for(let rt=0;rt<o.length;rt++)this.unevalVertices.push(o[rt]),this.unevalHeights.push(g[rt]);return _e}addTriangles(o,g,_e){const rt=_e?this.unevalTunnelTriangles:this.unevalTriangles;for(const ot of o)rt.push(ot+g)}addRenderableRing(o,g,_e,rt,ot,at){const ut=[new _n(ot.min.x,ot.min.y),new _n(ot.max.x,ot.min.y),new _n(ot.max.x,ot.max.y),new _n(ot.min.x,ot.max.y)];for(let ft=0;ft<_e-1;ft++){const xt=g+ft,Ct=xt+1,Rt=this.unevalVertices[xt],kt=this.unevalVertices[Ct];if(!(Rt.x>=ot.min.x&&Rt.x<=ot.max.x&&Rt.y>=ot.min.y&&Rt.y<=ot.max.y||kt.x>=ot.min.x&&kt.x<=ot.max.x&&kt.y>=ot.min.y&&kt.y<=ot.max.y||Eu(Rt,kt,ut))||this.isOnBorder(Rt.x,kt.x)||this.isOnBorder(Rt.y,kt.y))continue;const zt=sp.computeEdgeHash(this.unevalVertices[xt],this.unevalVertices[Ct]);let Ut,Kt=this.vertexHashLookup.get(sp.computePosHash(Rt));Kt!=null?Ut=Kt.next:(Kt=this.vertexHashLookup.get(sp.computePosHash(kt)),Ut=Kt!=null?Kt.prev:zt),this.unevalEdges.push({polygonIdx:o,a:xt,b:Ct,hash:zt,portalHash:Ut,isTunnel:rt,type:"unevaluated",featureInfo:at})}}addPortalCandidates(o,g,_e,rt,ot){if(g.length===0)return;this.portalPolygons.add(o,{geometry:g,zLevel:ot});const at=g[0];this.vertexHashLookup.clear();let ut=sp.computeEdgeHash(at[at.length-2],at[at.length-1]);for(let ft=0;ft<at.length-1;ft++){const xt=at[ft+0],Ct=at[ft+1],Rt=As(Ct.x-xt.x,Ct.y-xt.y),kt=Go(Rt);if(kt===0)continue;let zt="unevaluated";const Ut=rt.pointElevation(xt),Kt=rt.pointElevation(Ct);Math.abs(Ut)<.01&&Math.abs(Kt)<.01?zt="entrance":(this.isOnBorder(xt.x,Ct.x)||this.isOnBorder(xt.y,Ct.y))&&(zt="border");const er=sp.computeEdgeHash(xt,Ct);this.unevaluatedPortals.portals.push({connection:{a:o,b:void 0},va:xt,vb:Ct,vab:Rt,length:kt,hash:er,isTunnel:_e,type:zt});const Jt=sp.computePosHash(xt);this.vertexHashLookup.set(Jt,{prev:ut,next:er}),ut=er}}construct(o){if(this.unevalVertices.length===0)return;const g=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),_e=kt=>{kt.primitiveLength=this.indexArray.length-kt.primitiveOffset},rt=new EP(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(o.portals,this.unevalEdges);const ot=g(),at=g(),ut=g(),ft=(kt,zt)=>{kt.sort((Kt,er)=>Kt.type===zt&&er.type!==zt?-1:Kt.type!==zt&&er.type===zt?1:0);const Ut=kt.findIndex(Kt=>Kt.type!==zt);return Ut>=0?Ut:kt.length};let xt=0;this.unevalEdges.length>0&&(xt=ft(this.unevalEdges,"none"),this.constructBridgeStructures(rt,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:xt},this.tileToMeters)),_e(ut);const Ct=g(),Rt=g();if(this.unevalEdges.length>0){const kt=this.unevalEdges.splice(xt),zt=ft(kt,"tunnel")+xt;this.unevalEdges.push(...kt),this.constructTunnelStructures(rt,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:xt},{min:xt,max:zt})}_e(Ct),rt.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),_e(Rt),rt.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),_e(at),rt.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),_e(ot),this.maskSegments=_l.simpleSegment(0,Rt.primitiveOffset,0,Rt.primitiveLength),this.depthSegments=_l.simpleSegment(0,at.primitiveOffset,0,at.primitiveLength),this.renderableBridgeSegments=_l.simpleSegment(0,ut.primitiveOffset,0,ut.primitiveLength),this.renderableTunnelSegments=_l.simpleSegment(0,Ct.primitiveOffset,0,Ct.primitiveLength),this.shadowCasterSegments=_l.simpleSegment(0,ot.primitiveOffset,0,ot.primitiveLength)}update(o,g,_e,rt,ot,at,ut,ft){this.bridgeProgramConfigurations.updatePaintArrays(o,g,ot,_e,rt,at,ut,ft),this.tunnelProgramConfigurations.updatePaintArrays(o,g,ot,_e,rt,at,ut,ft)}upload(o){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=o.createVertexBuffer(this.vertexPositions,hP.members),this.vertexBufferNormal=o.createVertexBuffer(this.vertexNormals,dP.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(o),this.tunnelProgramConfigurations.upload(o))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(o,g,_e,rt,ot){const at=(ut,ft)=>{for(let xt=0;xt<ft.length-1;xt++){const Ct=ft[xt].featureIndex,Rt=ft[xt+1].vertexStart,kt=o.feature(Ct);ut.populatePaintArrays(Rt,kt,Ct,{},_e,g,rt,void 0,ot)}};at(this.bridgeProgramConfigurations,this.bridgeFeatureSections),at(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(o,g,_e,rt,ot){const at=new Map;for(let ut=rt;ut<ot;ut++){const ft=_e[ut],xt=ft.a,Ct=ft.b,Rt=sp.computePosHash(o[xt]),kt=sp.computePosHash(o[Ct]);let zt=at.get(Rt);zt||(zt={},at.set(Rt,zt));let Ut=at.get(kt);Ut||(Ut={},at.set(kt,Ut)),g[xt]<=0&&g[Ct]<=0||(zt.to=Ct,Ut.from=xt)}return at}isTerminalVertex(o,g){const _e=sp.computePosHash(this.unevalVertices[o]),rt=g.get(_e);return!rt||!rt.from||!rt.to}constructBridgeStructures(o,g,_e,rt,ot,at){o.clearVertexLookup();const ut=this.computeVertexConnections(g,_e,rt,ot.min,ot.max),ft=1/at,xt=.5*ft,Ct=(Sn,An)=>Ar(Sn,g[An].x,g[An].y,_e[An]*ft),Rt=Qr(),kt=Qr(),zt=Qr(),Ut=Qr(),Kt=Qr(),er=(Sn,An)=>{const wn=ut.get(sp.computePosHash(g[An])),En=wn.from,ln=wn.to;if(!En||!ln)return;Ct(Rt,En),Ct(kt,An),Ct(zt,ln),ba(Ut),Qo(Rt,kt)||(wo(Kt,kt,Rt),ds(Ut,Kt)),Qo(zt,kt)||(wo(Kt,zt,kt),rr(Ut,Ut,ds(Kt,Kt)));const on=uu(Ut);return on>0?tn(Sn,Ut,1/on):void 0};let Jt=Number.POSITIVE_INFINITY;this.sortSubarray(rt,ot.min,ot.max,(Sn,An)=>Sn.featureInfo.featureIndex-An.featureInfo.featureIndex);const or=Qr(),cr=Qr(),pr=Qr(),Sr=Qr(),br=Qr(),Pr=Qr(),Dr=Qr(),Or=Qr(),nn=Qr(),$r=[Qr(),Qr(),Qr(),Qr()],un=[Qr(),Qr(),Qr(),Qr()],gn=[{coord:new _n(0,0),height:0},{coord:new _n(0,0),height:0}],yn=(Sn,An)=>Sn>An;for(let Sn=ot.min;Sn<ot.max;Sn++){const An=rt[Sn];if(!An.featureInfo.guardRailEnabled||!this.prepareEdgePoints(gn,g,_e,An,yn))continue;const[wn,En]=gn;if(Ar(or,wn.coord.x,wn.coord.y,ft*wn.height),Ar(cr,En.coord.x,En.coord.y,ft*En.height),Qo(or,cr))continue;wo(pr,cr,or),ds(pr,pr);const ln=er(Or,An.a)||pr,on=er(nn,An.b)||pr;Ar(Sr,ln[1],-ln[0],0),ds(Sr,Sr),Ar(br,on[1],-on[0],0),ds(br,br),ys(Or,Sr,ln),ds(Pr,Or),ys(Or,br,on),ds(Dr,Or),rr($r[0],or,tn(Or,wo(Or,Sr,Pr),xt)),rr($r[1],or,tn(Or,rr(Or,Sr,Pr),xt)),rr($r[2],or,tn(Or,Pr,xt)),$r[3]=or,rr(un[0],cr,tn(Or,wo(Or,br,Dr),xt)),rr(un[1],cr,tn(Or,rr(Or,br,Dr),xt)),rr(un[2],cr,tn(Or,Dr,xt)),un[3]=cr,Jt=this.addFeatureSection(An.featureInfo.featureIndex,Jt,this.bridgeFeatureSections,o);const Tn=o.addVertex($r[0],Sr,at),On=o.addVertex($r[1],Sr,at),kn=o.addVertex(un[0],br,at),ls=o.addVertex(un[1],br,at);o.addTriangle(Tn,On,kn),o.addTriangle(On,ls,kn);const Gn=o.addVertex($r[1],Pr,at),Kn=o.addVertex($r[2],Pr,at),ts=o.addVertex(un[1],Dr,at),qs=o.addVertex(un[2],Dr,at);o.addTriangle(Gn,Kn,ts),o.addTriangle(Kn,qs,ts),Mn(Sr,Sr),Mn(br,br);const Dn=o.addVertex($r[2],Sr,at),rs=o.addVertex($r[3],Sr,at),Ms=o.addVertex(un[2],br,at),ro=o.addVertex(un[3],br,at);o.addTriangle(Dn,rs,Ms),o.addTriangle(rs,ro,Ms);const so=this.isTerminalVertex(An.a,ut),Os=this.isTerminalVertex(An.b,ut);wn.height<.01&&so&&o.addQuad($r[3],$r[2],$r[1],$r[0],Mn(ln,ln),at),En.height<.01&&Os&&o.addQuad(un[0],un[1],un[2],un[3],on,at)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:o.getVertexCount()})}constructTunnelStructures(o,g,_e,rt,ot,at){o.clearVertexLookup();let ut=Number.POSITIVE_INFINITY;const ft=(Jt,or)=>Jt.featureInfo.featureIndex-or.featureInfo.featureIndex;this.sortSubarray(rt,ot.min,ot.max,ft),this.sortSubarray(rt,at.min,at.max,ft);const xt=Jt=>ds(Jt,Jt),Ct=[{coord:new _n(0,0),height:0},{coord:new _n(0,0),height:0}],Rt=(Jt,or)=>Jt<or,kt=Qr(),zt=Qr(),Ut=Qr(),Kt=Qr(),er=Qr();for(let Jt=ot.min;Jt<ot.max;Jt++){if(!this.prepareEdgePoints(Ct,g,_e,rt[Jt],Rt))continue;const[or,cr]=Ct,pr=xt(Ar(er,-(cr.coord.y-or.coord.y),cr.coord.x-or.coord.x,0));ut=this.addFeatureSection(rt[Jt].featureInfo.featureIndex,ut,this.tunnelFeatureSections,o),o.addQuad(Ar(kt,or.coord.x,or.coord.y,or.height),Ar(zt,cr.coord.x,cr.coord.y,cr.height),Ar(Ut,cr.coord.x,cr.coord.y,rt[Jt].isTunnel?-.1:0),Ar(Kt,or.coord.x,or.coord.y,rt[Jt].isTunnel?-.1:0),pr)}for(let Jt=at.min;Jt<at.max;Jt++){const or=rt[Jt];or.isTunnel&&([or.a,or.b]=[or.b,or.a]);const cr=g[or.a],pr=g[or.b],Sr=xt(Ar(er,-(pr.y-cr.y),pr.x-cr.x,0));ut=this.addFeatureSection(or.featureInfo.featureIndex,ut,this.tunnelFeatureSections,o),o.addQuad(Ar(kt,pr.x,pr.y,0),Ar(zt,cr.x,cr.y,0),Ar(Ut,cr.x,cr.y,_e[or.a]+4),Ar(Kt,pr.x,pr.y,_e[or.b]+4),Sr),o.addQuad(Ar(kt,cr.x,cr.y,0),Ar(zt,pr.x,pr.y,0),Ar(Ut,pr.x,pr.y,_e[or.b]+4),Ar(Kt,cr.x,cr.y,_e[or.a]+4),Sr)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:o.getVertexCount()})}setElevatedPoint(o,g,_e,rt){o.coord.x=g,o.coord.y=_e,o.height=rt}prepareEdgePoints(o,g,_e,rt,ot){let at=g[rt.a].x,ut=g[rt.a].y,ft=g[rt.b].x,xt=g[rt.b].y,Ct=_e[rt.a],Rt=_e[rt.b];const kt=ot(Ct,0),zt=ot(Rt,0);if(kt&&zt)return this.setElevatedPoint(o[0],at,ut,Ct),this.setElevatedPoint(o[1],ft,xt,Rt),!0;if(!kt&&!zt)return!1;if(kt){if(!zt){const Ut=Rt/(Rt-Ct);ft=Cs(ft,at,Ut),xt=Cs(xt,ut,Ut),Rt=Cs(Rt,Ct,Ut)}}else{const Ut=Ct/(Ct-Rt);at=Cs(at,ft,Ut),ut=Cs(ut,xt,Ut),Ct=Cs(Ct,Rt,Ut)}return this.setElevatedPoint(o[0],at,ut,Ct),this.setElevatedPoint(o[1],ft,xt,Rt),!0}prepareEdges(o,g){if(g.length===0)return;g.sort((ut,ft)=>ut.hash===ft.hash?ft.polygonIdx-ut.polygonIdx:ft.hash>ut.hash?1:-1);let _e=0,rt=0,ot=0,at=g[_e].polygonIdx;do rt++,(rt===g.length||g[_e].hash!==g[rt].hash)&&((rt-_e==1||g[rt-1].polygonIdx!==at)&&(ot<_e&&(g[ot]=g[_e],g[_e]=null),g[ot].type="none",ot++),_e=rt,_e!==g.length&&(at=g[_e].polygonIdx));while(_e!==g.length);if(g.splice(ot),g.length!==0&&o.length!==0){g.sort((xt,Ct)=>xt.portalHash<Ct.portalHash?1:-1);let ut=0,ft=0;for(;ut!==g.length&&ft!==o.length;){const xt=g[ut],Ct=o[ft];xt.portalHash>Ct.hash?ut++:Ct.hash>xt.portalHash?ft++:(xt.type=Ct.type,ut++)}}}isOnBorder(o,g){return o<=0&&g<=0||o>=jn&&g>=jn}addFeatureSection(o,g,_e,rt){return o!==g&&(g=o,_e.push({featureIndex:o,vertexStart:rt.getVertexCount()}),rt.clearVertexLookup()),g}sortSubarray(o,g,_e,rt){const ot=o.slice(g,_e);ot.sort(rt),o.splice(g,ot.length,...ot)}static computeEdgeHash(o,g){return(o.y===g.y&&o.x>g.x||o.y>g.y)&&([o,g]=[g,o]),BigInt(sp.computePosHash(o))<<32n|BigInt(sp.computePosHash(g))}static computePosHash(o){return((65535&o.x)<<16|65535&o.y)>>>0}}var wC,EC={exports:{}},TC=(wC||(wC=1,function(b){function o(wr,Cr){return wr>Cr?1:wr<Cr?-1:0}var g=function(wr,Cr){wr===void 0&&(wr=o),Cr===void 0&&(Cr=!1),this._compare=wr,this._root=null,this._size=0,this._noDuplicates=!!Cr},_e={size:{configurable:!0}};function rt(wr,Cr,hn,Cn,Vn){var Un=Vn-Cn;if(Un>0){var cs=Cn+Math.floor(Un/2),ps={key:Cr[cs],data:hn[cs],parent:wr};return ps.left=rt(ps,Cr,hn,Cn,cs),ps.right=rt(ps,Cr,hn,cs+1,Vn),ps}return null}function ot(wr,Cr,hn,Cn,Vn){if(!(hn>=Cn)){for(var Un=wr[hn+Cn>>1],cs=hn-1,ps=Cn+1;;){do cs++;while(Vn(wr[cs],Un)<0);do ps--;while(Vn(wr[ps],Un)>0);if(cs>=ps)break;var Ls=wr[cs];wr[cs]=wr[ps],wr[ps]=Ls,Ls=Cr[cs],Cr[cs]=Cr[ps],Cr[ps]=Ls}ot(wr,Cr,hn,ps,Vn),ot(wr,Cr,ps+1,Cn,Vn)}}g.prototype.rotateLeft=function(wr){var Cr=wr.right;Cr&&(wr.right=Cr.left,Cr.left&&(Cr.left.parent=wr),Cr.parent=wr.parent),wr.parent?wr===wr.parent.left?wr.parent.left=Cr:wr.parent.right=Cr:this._root=Cr,Cr&&(Cr.left=wr),wr.parent=Cr},g.prototype.rotateRight=function(wr){var Cr=wr.left;Cr&&(wr.left=Cr.right,Cr.right&&(Cr.right.parent=wr),Cr.parent=wr.parent),wr.parent?wr===wr.parent.left?wr.parent.left=Cr:wr.parent.right=Cr:this._root=Cr,Cr&&(Cr.right=wr),wr.parent=Cr},g.prototype._splay=function(wr){for(;wr.parent;){var Cr=wr.parent;Cr.parent?Cr.left===wr&&Cr.parent.left===Cr?(this.rotateRight(Cr.parent),this.rotateRight(Cr)):Cr.right===wr&&Cr.parent.right===Cr?(this.rotateLeft(Cr.parent),this.rotateLeft(Cr)):Cr.left===wr&&Cr.parent.right===Cr?(this.rotateRight(Cr),this.rotateLeft(Cr)):(this.rotateLeft(Cr),this.rotateRight(Cr)):Cr.left===wr?this.rotateRight(Cr):this.rotateLeft(Cr)}},g.prototype.splay=function(wr){for(var Cr,hn,Cn,Vn,Un;wr.parent;)(hn=(Cr=wr.parent).parent)&&hn.parent?((Cn=hn.parent).left===hn?Cn.left=wr:Cn.right=wr,wr.parent=Cn):(wr.parent=null,this._root=wr),Vn=wr.left,Un=wr.right,wr===Cr.left?(hn&&(hn.left===Cr?(Cr.right?(hn.left=Cr.right,hn.left.parent=hn):hn.left=null,Cr.right=hn,hn.parent=Cr):(Vn?(hn.right=Vn,Vn.parent=hn):hn.right=null,wr.left=hn,hn.parent=wr)),Un?(Cr.left=Un,Un.parent=Cr):Cr.left=null,wr.right=Cr,Cr.parent=wr):(hn&&(hn.right===Cr?(Cr.left?(hn.right=Cr.left,hn.right.parent=hn):hn.right=null,Cr.left=hn,hn.parent=Cr):(Un?(hn.left=Un,Un.parent=hn):hn.left=null,wr.right=hn,hn.parent=wr)),Vn?(Cr.right=Vn,Vn.parent=Cr):Cr.right=null,wr.left=Cr,Cr.parent=wr)},g.prototype.replace=function(wr,Cr){wr.parent?wr===wr.parent.left?wr.parent.left=Cr:wr.parent.right=Cr:this._root=Cr,Cr&&(Cr.parent=wr.parent)},g.prototype.minNode=function(wr){if(wr===void 0&&(wr=this._root),wr)for(;wr.left;)wr=wr.left;return wr},g.prototype.maxNode=function(wr){if(wr===void 0&&(wr=this._root),wr)for(;wr.right;)wr=wr.right;return wr},g.prototype.insert=function(wr,Cr){var hn=this._root,Cn=null,Vn=this._compare;if(this._noDuplicates)for(;hn;){if(Cn=hn,Vn(hn.key,wr)===0)return;hn=Vn(hn.key,wr)<0?hn.right:hn.left}else for(;hn;)Cn=hn,hn=Vn(hn.key,wr)<0?hn.right:hn.left;return hn={key:wr,data:Cr,left:null,right:null,parent:Cn},Cn?Vn(Cn.key,hn.key)<0?Cn.right=hn:Cn.left=hn:this._root=hn,this.splay(hn),this._size++,hn},g.prototype.find=function(wr){for(var Cr=this._root,hn=this._compare;Cr;){var Cn=hn(Cr.key,wr);if(Cn<0)Cr=Cr.right;else{if(!(Cn>0))return Cr;Cr=Cr.left}}return null},g.prototype.contains=function(wr){for(var Cr=this._root,hn=this._compare;Cr;){var Cn=hn(wr,Cr.key);if(Cn===0)return!0;Cr=Cn<0?Cr.left:Cr.right}return!1},g.prototype.remove=function(wr){var Cr=this.find(wr);if(!Cr)return!1;if(this.splay(Cr),Cr.left)if(Cr.right){var hn=this.minNode(Cr.right);hn.parent!==Cr&&(this.replace(hn,hn.right),hn.right=Cr.right,hn.right.parent=hn),this.replace(Cr,hn),hn.left=Cr.left,hn.left.parent=hn}else this.replace(Cr,Cr.left);else this.replace(Cr,Cr.right);return this._size--,!0},g.prototype.removeNode=function(wr){if(!wr)return!1;if(this.splay(wr),wr.left)if(wr.right){var Cr=this.minNode(wr.right);Cr.parent!==wr&&(this.replace(Cr,Cr.right),Cr.right=wr.right,Cr.right.parent=Cr),this.replace(wr,Cr),Cr.left=wr.left,Cr.left.parent=Cr}else this.replace(wr,wr.left);else this.replace(wr,wr.right);return this._size--,!0},g.prototype.erase=function(wr){var Cr=this.find(wr);if(Cr){this.splay(Cr);var hn=Cr.left,Cn=Cr.right,Vn=null;hn&&(hn.parent=null,Vn=this.maxNode(hn),this.splay(Vn),this._root=Vn),Cn&&(hn?Vn.right=Cn:this._root=Cn,Cn.parent=Vn),this._size--}},g.prototype.pop=function(){var wr=this._root,Cr=null;if(wr){for(;wr.left;)wr=wr.left;Cr={key:wr.key,data:wr.data},this.remove(wr.key)}return Cr},g.prototype.next=function(wr){var Cr=wr;if(Cr)if(Cr.right)for(Cr=Cr.right;Cr&&Cr.left;)Cr=Cr.left;else for(Cr=wr.parent;Cr&&Cr.right===wr;)wr=Cr,Cr=Cr.parent;return Cr},g.prototype.prev=function(wr){var Cr=wr;if(Cr)if(Cr.left)for(Cr=Cr.left;Cr&&Cr.right;)Cr=Cr.right;else for(Cr=wr.parent;Cr&&Cr.left===wr;)wr=Cr,Cr=Cr.parent;return Cr},g.prototype.forEach=function(wr){for(var Cr=this._root,hn=[],Cn=!1,Vn=0;!Cn;)Cr?(hn.push(Cr),Cr=Cr.left):hn.length>0?(wr(Cr=hn.pop(),Vn++),Cr=Cr.right):Cn=!0;return this},g.prototype.range=function(wr,Cr,hn,Cn){for(var Vn=[],Un=this._compare,cs=this._root;Vn.length!==0||cs;)if(cs)Vn.push(cs),cs=cs.left;else{if(Un((cs=Vn.pop()).key,Cr)>0)break;if(Un(cs.key,wr)>=0&&hn.call(Cn,cs))return this;cs=cs.right}return this},g.prototype.keys=function(){for(var wr=this._root,Cr=[],hn=[],Cn=!1;!Cn;)wr?(Cr.push(wr),wr=wr.left):Cr.length>0?(wr=Cr.pop(),hn.push(wr.key),wr=wr.right):Cn=!0;return hn},g.prototype.values=function(){for(var wr=this._root,Cr=[],hn=[],Cn=!1;!Cn;)wr?(Cr.push(wr),wr=wr.left):Cr.length>0?(wr=Cr.pop(),hn.push(wr.data),wr=wr.right):Cn=!0;return hn},g.prototype.at=function(wr){for(var Cr=this._root,hn=[],Cn=!1,Vn=0;!Cn;)if(Cr)hn.push(Cr),Cr=Cr.left;else if(hn.length>0){if(Cr=hn.pop(),Vn===wr)return Cr;Vn++,Cr=Cr.right}else Cn=!0;return null},g.prototype.load=function(wr,Cr,hn){if(wr===void 0&&(wr=[]),Cr===void 0&&(Cr=[]),hn===void 0&&(hn=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Cn=wr.length;return hn&&ot(wr,Cr,0,Cn-1,this._compare),this._root=rt(null,wr,Cr,0,Cn),this._size=Cn,this},g.prototype.min=function(){var wr=this.minNode(this._root);return wr?wr.key:null},g.prototype.max=function(){var wr=this.maxNode(this._root);return wr?wr.key:null},g.prototype.isEmpty=function(){return this._root===null},_e.size.get=function(){return this._size},g.createTree=function(wr,Cr,hn,Cn,Vn){return new g(hn,Vn).load(wr,Cr,Cn)},Object.defineProperties(g.prototype,_e);var at=0,ut=1,ft=2,xt=3,Ct=0,Rt=1,kt=2,zt=3;function Ut(wr,Cr,hn){Cr===null?(wr.inOut=!1,wr.otherInOut=!0):(wr.isSubject===Cr.isSubject?(wr.inOut=!Cr.inOut,wr.otherInOut=Cr.otherInOut):(wr.inOut=!Cr.otherInOut,wr.otherInOut=Cr.isVertical()?!Cr.inOut:Cr.inOut),Cr&&(wr.prevInResult=!Kt(Cr,hn)||Cr.isVertical()?Cr.prevInResult:Cr));var Cn=Kt(wr,hn);wr.resultTransition=Cn?function(Vn,Un){var cs,ps=!Vn.inOut,Ls=!Vn.otherInOut;switch(Un){case Ct:cs=ps&&Ls;break;case Rt:cs=ps||Ls;break;case zt:cs=ps^Ls;break;case kt:cs=Vn.isSubject?ps&&!Ls:Ls&&!ps}return cs?1:-1}(wr,hn):0}function Kt(wr,Cr){switch(wr.type){case at:switch(Cr){case Ct:return!wr.otherInOut;case Rt:return wr.otherInOut;case kt:return wr.isSubject&&wr.otherInOut||!wr.isSubject&&!wr.otherInOut;case zt:return!0}break;case ft:return Cr===Ct||Cr===Rt;case xt:return Cr===kt;case ut:return!1}return!1}var er=function(wr,Cr,hn,Cn,Vn){this.left=Cr,this.point=wr,this.otherEvent=hn,this.isSubject=Cn,this.type=Vn||at,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},Jt={inResult:{configurable:!0}};function or(wr,Cr){return wr[0]===Cr[0]&&wr[1]===Cr[1]}er.prototype.isBelow=function(wr){var Cr=this.point,hn=this.otherEvent.point;return this.left?(Cr[0]-wr[0])*(hn[1]-wr[1])-(hn[0]-wr[0])*(Cr[1]-wr[1])>0:(hn[0]-wr[0])*(Cr[1]-wr[1])-(Cr[0]-wr[0])*(hn[1]-wr[1])>0},er.prototype.isAbove=function(wr){return!this.isBelow(wr)},er.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},Jt.inResult.get=function(){return this.resultTransition!==0},er.prototype.clone=function(){var wr=new er(this.point,this.left,this.otherEvent,this.isSubject,this.type);return wr.contourId=this.contourId,wr.resultTransition=this.resultTransition,wr.prevInResult=this.prevInResult,wr.isExteriorRing=this.isExteriorRing,wr.inOut=this.inOut,wr.otherInOut=this.otherInOut,wr},Object.defineProperties(er.prototype,Jt);var cr=11102230246251565e-32,pr=134217729,Sr=(3+8*cr)*cr;function br(wr,Cr,hn,Cn,Vn){var Un,cs,ps,Ls,$s=Cr[0],Ws=Cn[0],Qs=0,Es=0;Ws>$s==Ws>-$s?(Un=$s,$s=Cr[++Qs]):(Un=Ws,Ws=Cn[++Es]);var Is=0;if(Qs<wr&&Es<hn)for(Ws>$s==Ws>-$s?(ps=Un-((cs=$s+Un)-$s),$s=Cr[++Qs]):(ps=Un-((cs=Ws+Un)-Ws),Ws=Cn[++Es]),Un=cs,ps!==0&&(Vn[Is++]=ps);Qs<wr&&Es<hn;)Ws>$s==Ws>-$s?(ps=Un-((cs=Un+$s)-(Ls=cs-Un))+($s-Ls),$s=Cr[++Qs]):(ps=Un-((cs=Un+Ws)-(Ls=cs-Un))+(Ws-Ls),Ws=Cn[++Es]),Un=cs,ps!==0&&(Vn[Is++]=ps);for(;Qs<wr;)ps=Un-((cs=Un+$s)-(Ls=cs-Un))+($s-Ls),$s=Cr[++Qs],Un=cs,ps!==0&&(Vn[Is++]=ps);for(;Es<hn;)ps=Un-((cs=Un+Ws)-(Ls=cs-Un))+(Ws-Ls),Ws=Cn[++Es],Un=cs,ps!==0&&(Vn[Is++]=ps);return Un===0&&Is!==0||(Vn[Is++]=Un),Is}function Pr(wr){return new Float64Array(wr)}var Dr=33306690738754716e-32,Or=22204460492503146e-32,nn=11093356479670487e-47,$r=Pr(4),un=Pr(8),gn=Pr(12),yn=Pr(16),Sn=Pr(4);function An(wr,Cr,hn){var Cn=function(Vn,Un,cs,ps,Ls,$s){var Ws=(Un-$s)*(cs-Ls),Qs=(Vn-Ls)*(ps-$s),Es=Ws-Qs;if(Ws===0||Qs===0||Ws>0!=Qs>0)return Es;var Is=Math.abs(Ws+Qs);return Math.abs(Es)>=Dr*Is?Es:-function(ho,yo,xo,Io,Bo,Lo,vo){var Co,Gs,no,yl,bs,Js,jo,Uo,Zo,Hl,Ho,ws,Tl,ko,_a,iu,fu,Yl,Ql=ho-Bo,lu=xo-Bo,Ku=yo-Lo,Wo=Io-Lo;$r[0]=(_a=(Uo=Ql-(jo=(Js=pr*Ql)-(Js-Ql)))*(Hl=Wo-(Zo=(Js=pr*Wo)-(Js-Wo)))-((ko=Ql*Wo)-jo*Zo-Uo*Zo-jo*Hl))-((Ho=_a-(fu=(Uo=Ku-(jo=(Js=pr*Ku)-(Js-Ku)))*(Hl=lu-(Zo=(Js=pr*lu)-(Js-lu)))-((iu=Ku*lu)-jo*Zo-Uo*Zo-jo*Hl)))+(bs=_a-Ho))+(bs-fu),$r[1]=(Tl=ko-((ws=ko+Ho)-(bs=ws-ko))+(Ho-bs))-((Ho=Tl-iu)+(bs=Tl-Ho))+(bs-iu),$r[2]=ws-((Yl=ws+Ho)-(bs=Yl-ws))+(Ho-bs),$r[3]=Yl;var Bl=function($m,Tu){for(var Vu=Tu[0],lp=1;lp<4;lp++)Vu+=Tu[lp];return Vu}(0,$r),Wl=Or*vo;if(Bl>=Wl||-Bl>=Wl||(Co=ho-(Ql+(bs=ho-Ql))+(bs-Bo),no=xo-(lu+(bs=xo-lu))+(bs-Bo),Gs=yo-(Ku+(bs=yo-Ku))+(bs-Lo),yl=Io-(Wo+(bs=Io-Wo))+(bs-Lo),Co===0&&Gs===0&&no===0&&yl===0)||(Wl=nn*vo+Sr*Math.abs(Bl),(Bl+=Ql*yl+Wo*Co-(Ku*no+lu*Gs))>=Wl||-Bl>=Wl))return Bl;Sn[0]=(_a=(Uo=Co-(jo=(Js=pr*Co)-(Js-Co)))*(Hl=Wo-(Zo=(Js=pr*Wo)-(Js-Wo)))-((ko=Co*Wo)-jo*Zo-Uo*Zo-jo*Hl))-((Ho=_a-(fu=(Uo=Gs-(jo=(Js=pr*Gs)-(Js-Gs)))*(Hl=lu-(Zo=(Js=pr*lu)-(Js-lu)))-((iu=Gs*lu)-jo*Zo-Uo*Zo-jo*Hl)))+(bs=_a-Ho))+(bs-fu),Sn[1]=(Tl=ko-((ws=ko+Ho)-(bs=ws-ko))+(Ho-bs))-((Ho=Tl-iu)+(bs=Tl-Ho))+(bs-iu),Sn[2]=ws-((Yl=ws+Ho)-(bs=Yl-ws))+(Ho-bs),Sn[3]=Yl;var Yu=br(4,$r,4,Sn,un);Sn[0]=(_a=(Uo=Ql-(jo=(Js=pr*Ql)-(Js-Ql)))*(Hl=yl-(Zo=(Js=pr*yl)-(Js-yl)))-((ko=Ql*yl)-jo*Zo-Uo*Zo-jo*Hl))-((Ho=_a-(fu=(Uo=Ku-(jo=(Js=pr*Ku)-(Js-Ku)))*(Hl=no-(Zo=(Js=pr*no)-(Js-no)))-((iu=Ku*no)-jo*Zo-Uo*Zo-jo*Hl)))+(bs=_a-Ho))+(bs-fu),Sn[1]=(Tl=ko-((ws=ko+Ho)-(bs=ws-ko))+(Ho-bs))-((Ho=Tl-iu)+(bs=Tl-Ho))+(bs-iu),Sn[2]=ws-((Yl=ws+Ho)-(bs=Yl-ws))+(Ho-bs),Sn[3]=Yl;var su=br(Yu,un,4,Sn,gn);Sn[0]=(_a=(Uo=Co-(jo=(Js=pr*Co)-(Js-Co)))*(Hl=yl-(Zo=(Js=pr*yl)-(Js-yl)))-((ko=Co*yl)-jo*Zo-Uo*Zo-jo*Hl))-((Ho=_a-(fu=(Uo=Gs-(jo=(Js=pr*Gs)-(Js-Gs)))*(Hl=no-(Zo=(Js=pr*no)-(Js-no)))-((iu=Gs*no)-jo*Zo-Uo*Zo-jo*Hl)))+(bs=_a-Ho))+(bs-fu),Sn[1]=(Tl=ko-((ws=ko+Ho)-(bs=ws-ko))+(Ho-bs))-((Ho=Tl-iu)+(bs=Tl-Ho))+(bs-iu),Sn[2]=ws-((Yl=ws+Ho)-(bs=Yl-ws))+(Ho-bs),Sn[3]=Yl;var Kp=br(su,gn,4,Sn,yn);return yn[Kp-1]}(Vn,Un,cs,ps,Ls,$s,Is)}(wr[0],wr[1],Cr[0],Cr[1],hn[0],hn[1]);return Cn>0?-1:Cn<0?1:0}function wn(wr,Cr){var hn=wr.point,Cn=Cr.point;return hn[0]>Cn[0]?1:hn[0]<Cn[0]?-1:hn[1]!==Cn[1]?hn[1]>Cn[1]?1:-1:function(Vn,Un,cs,ps){return Vn.left!==Un.left?Vn.left?1:-1:An(cs,Vn.otherEvent.point,Un.otherEvent.point)!==0?Vn.isBelow(Un.otherEvent.point)?-1:1:!Vn.isSubject&&Un.isSubject?1:-1}(wr,Cr,hn)}function En(wr,Cr,hn){var Cn=new er(Cr,!1,wr,wr.isSubject),Vn=new er(Cr,!0,wr.otherEvent,wr.isSubject);return or(wr.point,wr.otherEvent.point)&&console.warn("what is that, a collapsed segment?",wr),Cn.contourId=Vn.contourId=wr.contourId,wn(Vn,wr.otherEvent)>0&&(wr.otherEvent.left=!0,Vn.left=!1),wr.otherEvent.otherEvent=Vn,wr.otherEvent=Cn,hn.push(Vn),hn.push(Cn),hn}function ln(wr,Cr){return wr[0]*Cr[1]-wr[1]*Cr[0]}function on(wr,Cr){return wr[0]*Cr[0]+wr[1]*Cr[1]}function Tn(wr,Cr,hn){var Cn=function(Ls,$s,Ws,Qs,Es){var Is=[$s[0]-Ls[0],$s[1]-Ls[1]],ho=[Qs[0]-Ws[0],Qs[1]-Ws[1]];function yo(Js,jo,Uo){return[Js[0]+jo*Uo[0],Js[1]+jo*Uo[1]]}var xo=[Ws[0]-Ls[0],Ws[1]-Ls[1]],Io=ln(Is,ho),Bo=Io*Io,Lo=on(Is,Is);if(Bo>0){var vo=ln(xo,ho)/Io;if(vo<0||vo>1)return null;var Co=ln(xo,Is)/Io;return Co<0||Co>1?null:vo===0||vo===1?[yo(Ls,vo,Is)]:Co===0||Co===1?[yo(Ws,Co,ho)]:[yo(Ls,vo,Is)]}if((Bo=(Io=ln(xo,Is))*Io)>0)return null;var Gs=on(Is,xo)/Lo,no=Gs+on(Is,ho)/Lo,yl=Math.min(Gs,no),bs=Math.max(Gs,no);return yl<=1&&bs>=0?yl===1?[yo(Ls,yl>0?yl:0,Is)]:bs===0?[yo(Ls,bs<1?bs:1,Is)]:[yo(Ls,yl>0?yl:0,Is),yo(Ls,bs<1?bs:1,Is)]:null}(wr.point,wr.otherEvent.point,Cr.point,Cr.otherEvent.point),Vn=Cn?Cn.length:0;if(Vn===0||Vn===1&&(or(wr.point,Cr.point)||or(wr.otherEvent.point,Cr.otherEvent.point))||Vn===2&&wr.isSubject===Cr.isSubject)return 0;if(Vn===1)return or(wr.point,Cn[0])||or(wr.otherEvent.point,Cn[0])||En(wr,Cn[0],hn),or(Cr.point,Cn[0])||or(Cr.otherEvent.point,Cn[0])||En(Cr,Cn[0],hn),1;var Un=[],cs=!1,ps=!1;return or(wr.point,Cr.point)?cs=!0:wn(wr,Cr)===1?Un.push(Cr,wr):Un.push(wr,Cr),or(wr.otherEvent.point,Cr.otherEvent.point)?ps=!0:wn(wr.otherEvent,Cr.otherEvent)===1?Un.push(Cr.otherEvent,wr.otherEvent):Un.push(wr.otherEvent,Cr.otherEvent),cs&&ps||cs?(Cr.type=ut,wr.type=Cr.inOut===wr.inOut?ft:xt,cs&&!ps&&En(Un[1].otherEvent,Un[0].point,hn),2):ps?(En(Un[0],Un[1].point,hn),3):Un[0]!==Un[3].otherEvent?(En(Un[0],Un[1].point,hn),En(Un[1],Un[2].point,hn),3):(En(Un[0],Un[1].point,hn),En(Un[3].otherEvent,Un[2].point,hn),3)}function On(wr,Cr){if(wr===Cr)return 0;if(An(wr.point,wr.otherEvent.point,Cr.point)!==0||An(wr.point,wr.otherEvent.point,Cr.otherEvent.point)!==0)return or(wr.point,Cr.point)?wr.isBelow(Cr.otherEvent.point)?-1:1:wr.point[0]===Cr.point[0]?wr.point[1]<Cr.point[1]?-1:1:wn(wr,Cr)===1?Cr.isAbove(wr.point)?-1:1:wr.isBelow(Cr.point)?-1:1;if(wr.isSubject!==Cr.isSubject)return wr.isSubject?-1:1;var hn=wr.point,Cn=Cr.point;return hn[0]===Cn[0]&&hn[1]===Cn[1]?(hn=wr.otherEvent.point)[0]===(Cn=Cr.otherEvent.point)[0]&&hn[1]===Cn[1]?0:wr.contourId>Cr.contourId?1:-1:wn(wr,Cr)===1?1:-1}var kn=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function ls(wr,Cr,hn,Cn){var Vn,Un=wr+1,cs=Cr[wr].point,ps=Cr.length;for(Un<ps&&(Vn=Cr[Un].point);Un<ps&&Vn[0]===cs[0]&&Vn[1]===cs[1];){if(!hn[Un])return Un;++Un<ps&&(Vn=Cr[Un].point)}for(Un=wr-1;hn[Un]&&Un>Cn;)Un--;return Un}kn.prototype.isExterior=function(){return this.holeOf==null};var Gn=ts,Kn=ts;function ts(wr,Cr){if(!(this instanceof ts))return new ts(wr,Cr);if(this.data=wr||[],this.length=this.data.length,this.compare=Cr||qs,this.length>0)for(var hn=(this.length>>1)-1;hn>=0;hn--)this._down(hn)}function qs(wr,Cr){return wr<Cr?-1:wr>Cr?1:0}ts.prototype={push:function(wr){this.data.push(wr),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var wr=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),wr}},peek:function(){return this.data[0]},_up:function(wr){for(var Cr=this.data,hn=this.compare,Cn=Cr[wr];wr>0;){var Vn=wr-1>>1,Un=Cr[Vn];if(hn(Cn,Un)>=0)break;Cr[wr]=Un,wr=Vn}Cr[wr]=Cn},_down:function(wr){for(var Cr=this.data,hn=this.compare,Cn=this.length>>1,Vn=Cr[wr];wr<Cn;){var Un=1+(wr<<1),cs=Un+1,ps=Cr[Un];if(cs<this.length&&hn(Cr[cs],ps)<0&&(Un=cs,ps=Cr[cs]),hn(ps,Vn)>=0)break;Cr[wr]=ps,wr=Un}Cr[wr]=Vn}},Gn.default=Kn;var Dn=Math.max,rs=Math.min,Ms=0;function ro(wr,Cr,hn,Cn,Vn,Un){var cs,ps,Ls,$s,Ws,Qs;for(cs=0,ps=wr.length-1;cs<ps;cs++)if($s=wr[cs+1],Ws=new er(Ls=wr[cs],!1,void 0,Cr),Qs=new er($s,!1,Ws,Cr),Ws.otherEvent=Qs,Ls[0]!==$s[0]||Ls[1]!==$s[1]){Ws.contourId=Qs.contourId=hn,Un||(Ws.isExteriorRing=!1,Qs.isExteriorRing=!1),wn(Ws,Qs)>0?Qs.left=!0:Ws.left=!0;var Es=Ls[0],Is=Ls[1];Vn[0]=rs(Vn[0],Es),Vn[1]=rs(Vn[1],Is),Vn[2]=Dn(Vn[2],Es),Vn[3]=Dn(Vn[3],Is),Cn.push(Ws),Cn.push(Qs)}}var so=[];function Os(wr,Cr,hn){typeof wr[0][0][0]=="number"&&(wr=[wr]),typeof Cr[0][0][0]=="number"&&(Cr=[Cr]);var Cn=function(Is,ho,yo){var xo=null;return Is.length*ho.length==0&&(yo===Ct?xo=so:yo===kt?xo=Is:yo!==Rt&&yo!==zt||(xo=Is.length===0?ho:Is)),xo}(wr,Cr,hn);if(Cn)return Cn===so?null:Cn;var Vn=[1/0,1/0,-1/0,-1/0],Un=[1/0,1/0,-1/0,-1/0],cs=function(Is,ho,yo,xo,Io){var Bo,Lo,vo,Co,Gs,no,yl=new Gn(null,wn);for(vo=0,Co=Is.length;vo<Co;vo++)for(Gs=0,no=(Bo=Is[vo]).length;Gs<no;Gs++)(Lo=Gs===0)&&Ms++,ro(Bo[Gs],!0,Ms,yl,yo,Lo);for(vo=0,Co=ho.length;vo<Co;vo++)for(Gs=0,no=(Bo=ho[vo]).length;Gs<no;Gs++)Lo=Gs===0,Io===kt&&(Lo=!1),Lo&&Ms++,ro(Bo[Gs],!1,Ms,yl,xo,Lo);return yl}(wr,Cr,Vn,Un,hn);if(Cn=function(Is,ho,yo,xo,Io){var Bo=null;return(yo[0]>xo[2]||xo[0]>yo[2]||yo[1]>xo[3]||xo[1]>yo[3])&&(Io===Ct?Bo=so:Io===kt?Bo=Is:Io!==Rt&&Io!==zt||(Bo=Is.concat(ho))),Bo}(wr,Cr,Vn,Un,hn))return Cn===so?null:Cn;for(var ps=function(Is){var ho,yo,xo=function(vo){var Co,Gs,no,yl,bs=[];for(Gs=0,no=vo.length;Gs<no;Gs++)((Co=vo[Gs]).left&&Co.inResult||!Co.left&&Co.otherEvent.inResult)&&bs.push(Co);for(var Js=!1;!Js;)for(Js=!0,Gs=0,no=bs.length;Gs<no;Gs++)Gs+1<no&&wn(bs[Gs],bs[Gs+1])===1&&(yl=bs[Gs],bs[Gs]=bs[Gs+1],bs[Gs+1]=yl,Js=!1);for(Gs=0,no=bs.length;Gs<no;Gs++)(Co=bs[Gs]).otherPos=Gs;for(Gs=0,no=bs.length;Gs<no;Gs++)(Co=bs[Gs]).left||(yl=Co.otherPos,Co.otherPos=Co.otherEvent.otherPos,Co.otherEvent.otherPos=yl);return bs}(Is),Io={},Bo=[],Lo=function(){if(!Io[ho]){var vo=Bo.length,Co=function(bs,Js,jo){var Uo=new kn;if(bs.prevInResult!=null){var Zo=bs.prevInResult,Hl=Zo.outputContourId;if(Zo.resultTransition>0){var Ho=Js[Hl];if(Ho.holeOf!=null){var ws=Ho.holeOf;Js[ws].holeIds.push(jo),Uo.holeOf=ws,Uo.depth=Js[Hl].depth}else Js[Hl].holeIds.push(jo),Uo.holeOf=Hl,Uo.depth=Js[Hl].depth+1}else Uo.holeOf=null,Uo.depth=Js[Hl].depth}else Uo.holeOf=null,Uo.depth=0;return Uo}(xo[ho],Bo,vo),Gs=function(bs){Io[bs]=!0,bs<xo.length&&xo[bs]&&(xo[bs].outputContourId=vo)},no=ho,yl=ho;for(Co.points.push(xo[ho].point);Gs(no),Gs(no=xo[no].otherPos),Co.points.push(xo[no].point),!((no=ls(no,xo,Io,yl))==yl||no>=xo.length)&&xo[no];);Bo.push(Co)}};for(ho=0,yo=xo.length;ho<yo;ho++)Lo();return Bo}(function(Is,ho,yo,xo,Io,Bo){for(var Lo,vo,Co,Gs=new g(On),no=[],yl=Math.min(xo[2],Io[2]);Is.length!==0;){var bs=Is.pop();if(no.push(bs),Bo===Ct&&bs.point[0]>yl||Bo===kt&&bs.point[0]>xo[2])break;if(bs.left){vo=Lo=Gs.insert(bs),Lo=Lo!==(Co=Gs.minNode())?Gs.prev(Lo):null,vo=Gs.next(vo);var Js=Lo?Lo.key:null;if(Ut(bs,Js,Bo),vo&&Tn(bs,vo.key,Is)===2&&(Ut(bs,Js,Bo),Ut(vo.key,bs,Bo)),Lo&&Tn(Lo.key,bs,Is)===2){var jo=Lo;Ut(Js,(jo=jo!==Co?Gs.prev(jo):null)?jo.key:null,Bo),Ut(bs,Js,Bo)}}else vo=Lo=Gs.find(bs=bs.otherEvent),Lo&&vo&&(Lo=Lo!==Co?Gs.prev(Lo):null,vo=Gs.next(vo),Gs.remove(bs),vo&&Lo&&Tn(Lo.key,vo.key,Is))}return no}(cs,0,0,Vn,Un,hn)),Ls=[],$s=0;$s<ps.length;$s++){var Ws=ps[$s];if(Ws.isExterior()){for(var Qs=[Ws.points],Es=0;Es<Ws.holeIds.length;Es++)Qs.push(ps[Ws.holeIds[Es]].points);Ls.push(Qs)}}return Ls}var No={UNION:Rt,DIFFERENCE:kt,INTERSECTION:Ct,XOR:zt};b.diff=function(wr,Cr){return Os(wr,Cr,kt)},b.intersection=function(wr,Cr){return Os(wr,Cr,Ct)},b.operations=No,b.union=function(wr,Cr){return Os(wr,Cr,Rt)},b.xor=function(wr,Cr){return Os(wr,Cr,zt)},Object.defineProperty(b,"__esModule",{value:!0})}(EC.exports)),EC.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function lE(b,o,g,_e){const rt=[],ot=_e===0?(at,ut,ft,xt,Ct,Rt)=>{at.push(new _n(Rt,ft+(Rt-ut)/(xt-ut)*(Ct-ft)))}:(at,ut,ft,xt,Ct,Rt)=>{at.push(new _n(ut+(Rt-ft)/(Ct-ft)*(xt-ut),Rt))};for(const at of b){const ut=[];for(const ft of at){if(ft.length<=2)continue;const xt=[];for(let kt=0;kt<ft.length-1;kt++){const zt=ft[kt].x,Ut=ft[kt].y,Kt=ft[kt+1].x,er=ft[kt+1].y,Jt=_e===0?zt:Ut,or=_e===0?Kt:er;Jt<o?or>o&&ot(xt,zt,Ut,Kt,er,o):Jt>g?or<g&&ot(xt,zt,Ut,Kt,er,g):xt.push(ft[kt]),or<o&&Jt>=o&&ot(xt,zt,Ut,Kt,er,o),or>g&&Jt<=g&&ot(xt,zt,Ut,Kt,er,g)}let Ct=ft[ft.length-1];const Rt=_e===0?Ct.x:Ct.y;Rt>=o&&Rt<=g&&xt.push(Ct),xt.length&&(Ct=xt[xt.length-1],xt[0].x===Ct.x&&xt[0].y===Ct.y||xt.push(xt[0]),ut.push(xt))}ut.length&&rt.push(ut)}return rt}function TP(b,o){const g=zT(b),_e=zT([o]),rt=TC.intersection(g,_e);return rt==null?[]:SC(rt)}function SP(b,o){let _e=zT(b,65536);const rt=[];for(;o.valid();o.next()){const[ot,at]=o.get(),ut=ot.x*65536,ft=ot.y*65536,xt=at.x*65536,Ct=at.y*65536,Rt=xt-ut,kt=Ct-ft,zt=Math.hypot(Rt,kt);if(zt===0)continue;const Ut=Math.trunc(kt/zt*3),Kt=-Math.trunc(Rt/zt*3);rt.push([[[ut,ft],[xt,Ct],[xt+Ut,Ct+Kt],[ut+Ut,ft+Kt],[ut,ft]]])}return rt.length>0&&(_e=TC.diff(_e,rt)),SC(_e,1/65536)}function zT(b,o=1){return[b.map(g=>g.map(_e=>[_e.x*o,_e.y*o]))]}function SC(b,o=1){return b.map(g=>g.map((_e,rt)=>{const ot=_e.map(at=>new _n(at[0]*o,at[1]*o).round());return rt>0&&ot.reverse(),ot}))}class VT{constructor(o,g){this.layoutVertexArray=new jm,this.indexArray=new tu,this.lineIndexArray=new rp,this.triangleSegments=new _l,this.lineSegments=new _l,this.programConfigurations=new Pp(o.layers,{zoom:o.zoom,lut:o.lut}),this.uploaded=!1,g&&(this.elevatedLayoutVertexArray=new sm)}update(o,g,_e,rt,ot,at,ut,ft){this.programConfigurations.updatePaintArrays(o,g,ot,_e,rt,at,ut,ft)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,cP.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.lineIndexBuffer=o.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=o.createVertexBuffer(this.elevatedLayoutVertexArray,uP.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(o,g,_e,rt,ot,at,ut){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,g,_e,rt,ot,at,void 0,ut)}}class UT{constructor(o){this.zoom=o.zoom,this.pixelRatio=o.pixelRatio,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=o.lut,this.bufferData=new VT(o,!1),this.elevationBufferData=new VT(o,!0),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.projection=o.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=o.sourceLayerIndex,this.worldview=o.worldview,this.hasAppearances=null}updateFootprints(o,g){}updateAppearances(o,g,_e,rt){}populate(o,g,_e,rt){this.hasPattern=FT("fill",this.layers,this.pixelRatio,g);const ot=this.layers[0].layout.get("fill-sort-key"),at=[];for(const{feature:ut,id:ft,index:xt,sourceLayerIndex:Ct}of o){const Rt=this.layers[0]._featureFilter.needGeometry,kt=Ur(ut,Rt);if(!this.layers[0]._featureFilter.filter(new Xo(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),kt,_e))continue;const zt=ot?ot.evaluate(kt,{},_e,g.availableImages):void 0,Ut={id:ft,properties:ut.properties,type:ut.type,sourceLayerIndex:Ct,index:xt,geometry:Rt?kt.geometry:kr(ut,_e,rt),patterns:{},sortKey:zt};at.push(Ut)}ot&&at.sort((ut,ft)=>ut.sortKey-ft.sortKey);for(const ut of at){const{geometry:ft,index:xt,sourceLayerIndex:Ct}=ut;if(this.hasPattern){const Rt=BT("fill",this.layers,ut,this.zoom,this.pixelRatio,g);this.patternFeatures.push(Rt)}else this.addFeature(ut,ft,xt,_e,{},g.availableImages,g.brightness,g.elevationFeatures);g.featureIndex.insert(o[xt].feature,ft,xt,Ct,this.index)}}update(o,g,_e,rt,ot,at,ut){this.bufferData.update(o,g,_e,rt,ot,at,ut,this.worldview),this.elevationBufferData.update(o,g,_e,rt,ot,at,ut,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(o,g,_e,rt,ot,at,ut,this.worldview)}addFeatures(o,g,_e,rt,ot,at){for(const ut of this.patternFeatures)this.addFeature(ut,ut.geometry,ut.index,g,_e,rt,at,o.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(o){this.bufferData.upload(o),this.elevationBufferData.upload(o),this.elevatedStructures&&this.elevatedStructures.upload(o)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(o,g,_e,rt,ot,at=[],ut,ft){const xt=m1(g,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(o,xt,rt,_e,ft):this.addGeometry(xt,this.bufferData),this.bufferData.populatePaintArrays(o,_e,ot,at,rt,ut,this.worldview),this.elevationBufferData.populatePaintArrays(o,_e,ot,at,rt,ut,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(o,g,_e,rt,ot){this.elevatedStructures&&(this.elevatedStructures.construct(o),this.elevatedStructures.populatePaintArrays(g,_e,rt,ot,this.worldview))}addElevatedRoadFeature(o,g,_e,rt,ot){const at=new Array,ut=To.getElevationFeature(o,ot);if(!ut)return void this.addGeometry(g,this.bufferData);{const xt=this.clipPolygonsToTile(g,1);xt.length>0&&at.push({polygons:xt,elevationFeature:ut,elevationTileID:_e})}const ft={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(o,{},_e),featureIndex:rt};for(const xt of at)if(xt.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new sp(xt.elevationTileID,this.layers,this.zoom,this.lut));const Rt=xt.elevationFeature.isTunnel();let kt=0;o.properties.hasOwnProperty(Xr)&&(kt=+o.properties[Xr]);for(const zt of xt.polygons)this.elevatedStructures.addPortalCandidates(xt.elevationFeature.id,zt,Rt,xt.elevationFeature,kt)}xt.elevationFeature.constantHeight==null&&(xt.polygons=this.prepareElevatedPolygons(xt.polygons,xt.elevationFeature,xt.elevationTileID));const Ct=new Do(_e,xt.elevationTileID);this.addElevatedGeometry(xt.polygons,Ct,xt.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,rt,ft)}}addElevatedGeometry(o,g,_e,rt,ot,at){const ut={elevation:_e,elevationSampler:g,bias:rt,index:ot,featureInfo:at},[ft,xt]=this.addGeometry(o,this.elevationBufferData,ut);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:ft,max:xt}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,ft),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,xt))}addGeometry(o,g,_e){let rt=Number.POSITIVE_INFINITY,ot=Number.NEGATIVE_INFINITY,at=null;_e&&(at=_e.elevationSampler.constantElevation(_e.elevation,_e.bias),at!=null&&(rt=at,ot=at));const ut=(ft,xt,Ct)=>{if(_e!=null)if(xt.push(ft),at!=null)g.elevatedLayoutVertexArray.emplaceBack(at),Ct.push(at);else{const Rt=_e.elevationSampler.pointElevation(ft,_e.elevation,_e.bias);g.elevatedLayoutVertexArray.emplaceBack(Rt),Ct.push(Rt),rt=Math.min(rt,Rt),ot=Math.max(ot,Rt)}};for(const ft of o){let xt=0;for(const cr of ft)xt+=cr.length;const Ct=g.triangleSegments.prepareSegment(xt,g.layoutVertexArray,g.indexArray),Rt=Ct.vertexLength,kt=[],zt=[],Ut=[],Kt=[],er=[],Jt=g.layoutVertexArray.length;for(const cr of ft){if(cr.length===0)continue;cr!==ft[0]&&zt.push(kt.length/2);const pr=g.lineSegments.prepareSegment(cr.length,g.layoutVertexArray,g.lineIndexArray),Sr=pr.vertexLength;_e&&er.push(g.layoutVertexArray.length-Jt),ut(cr[0],Ut,Kt),g.layoutVertexArray.emplaceBack(cr[0].x,cr[0].y),g.lineIndexArray.emplaceBack(Sr+cr.length-1,Sr),kt.push(cr[0].x),kt.push(cr[0].y);for(let br=1;br<cr.length;br++)ut(cr[br],Ut,Kt),g.layoutVertexArray.emplaceBack(cr[br].x,cr[br].y),g.lineIndexArray.emplaceBack(Sr+br-1,Sr+br),kt.push(cr[br].x),kt.push(cr[br].y);pr.vertexLength+=cr.length,pr.primitiveLength+=cr.length}const or=A_(kt,zt);for(let cr=0;cr<or.length;cr+=3)g.indexArray.emplaceBack(Rt+or[cr],Rt+or[cr+1],Rt+or[cr+2]);if(or.length>0&&_e&&this.elevationMode==="hd-road-base"){const cr=_e.elevation.isTunnel(),pr=_e.elevation.safeArea,Sr=this.elevatedStructures.addVertices(Ut,Kt);this.elevatedStructures.addTriangles(or,Sr,cr);const br=er.length;if(br>0){for(let Pr=0;Pr<br-1;Pr++)this.elevatedStructures.addRenderableRing(_e.index,er[Pr]+Sr,er[Pr+1]-er[Pr],cr,pr,_e.featureInfo);this.elevatedStructures.addRenderableRing(_e.index,er[br-1]+Sr,Ut.length-er[br-1],cr,pr,_e.featureInfo)}}Ct.vertexLength+=xt,Ct.primitiveLength+=or.length/3}return[rt,ot]}prepareElevatedPolygons(o,g,_e){const rt=1/ir(_e),ot=[];for(const at of o){const ut=SP(at,new go(g,rt));ot.push(...ut)}return ot}clipPolygonsToTile(o,g){const _e=-g,rt=-g,ot=jn+g,at=jn+g;let ut=0;const ft=[],xt=[];for(;ut<o.length;ut++){const kt=o[ut],zt=Jp(kt);(zt.min.x>=_e&&zt.max.x<=ot&&zt.min.y>=rt&&zt.max.y<=at?ft:xt).push(kt)}if(ft.length===o.length)return o;const Ct=[new _n(_e,rt),new _n(ot,rt),new _n(ot,at),new _n(_e,at),new _n(_e,rt)],Rt=ft;for(const kt of xt)Rt.push(...TP(kt,Ct));return Rt}}let CC,AC,RC,PC;Jn(UT,"FillBucket",{omit:["layers","patternFeatures"]}),Jn(VT,"FillBufferData"),Jn(sp,"ElevatedStructures");class cE{constructor(o,g,_e,rt){if(this.triangleCount=g.length/3,this.min=new _n(0,0),this.max=new _n(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||o.length===0)return;const[ot,at]=[o[0].clone(),o[0].clone()];for(let Rt=1;Rt<o.length;++Rt){const kt=o[Rt];ot.x=Math.min(ot.x,kt.x),ot.y=Math.min(ot.y,kt.y),at.x=Math.max(at.x,kt.x),at.y=Math.max(at.y,kt.y)}if(rt){const Rt=Math.ceil(Math.max(at.x-ot.x,at.y-ot.y)/rt);_e=Math.max(_e,Rt)}if(_e===0)return;this.min=ot,this.max=at;const ut=this.max.sub(this.min);ut.x=Math.max(ut.x,1),ut.y=Math.max(ut.y,1);const ft=Math.max(ut.x,ut.y)/_e;this.cellsX=Math.max(1,Math.ceil(ut.x/ft)),this.cellsY=Math.max(1,Math.ceil(ut.y/ft)),this.xScale=1/ft,this.yScale=1/ft;const xt=[];for(let Rt=0;Rt<this.triangleCount;Rt++){const kt=o[g[3*Rt+0]].sub(this.min),zt=o[g[3*Rt+1]].sub(this.min),Ut=o[g[3*Rt+2]].sub(this.min),Kt=Vm(Math.floor(Math.min(kt.x,zt.x,Ut.x)),this.xScale,this.cellsX),er=Vm(Math.floor(Math.max(kt.x,zt.x,Ut.x)),this.xScale,this.cellsX),Jt=Vm(Math.floor(Math.min(kt.y,zt.y,Ut.y)),this.yScale,this.cellsY),or=Vm(Math.floor(Math.max(kt.y,zt.y,Ut.y)),this.yScale,this.cellsY),cr=new _n(0,0),pr=new _n(0,0),Sr=new _n(0,0),br=new _n(0,0);for(let Pr=Jt;Pr<=or;++Pr){cr.y=pr.y=Pr*ft,Sr.y=br.y=(Pr+1)*ft;for(let Dr=Kt;Dr<=er;++Dr)cr.x=Sr.x=Dr*ft,pr.x=br.x=(Dr+1)*ft,(Pu(kt,zt,Ut,cr,pr,br)||Pu(kt,zt,Ut,cr,br,Sr))&&xt.push({cellIdx:Pr*this.cellsX+Dr,triIdx:Rt})}}if(xt.length===0)return;xt.sort((Rt,kt)=>Rt.cellIdx-kt.cellIdx||Rt.triIdx-kt.triIdx);let Ct=0;for(;Ct<xt.length;){const Rt=xt[Ct].cellIdx,kt={start:this.payload.length,len:0};for(;Ct<xt.length&&xt[Ct].cellIdx===Rt;)++kt.len,this.payload.push(xt[Ct++].triIdx);this.cells[Rt]=kt}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(o,g){if(this.triangleCount===0||this.cells.length===0||o.x>this.max.x||this.min.x>o.x||o.y>this.max.y||this.min.y>o.y)return;const _e=Vm(o.x-this.min.x,this.xScale,this.cellsX),rt=Vm(o.y-this.min.y,this.yScale,this.cellsY),ot=this.cells[rt*this.cellsX+_e];if(ot){this._lazyInitLookup();for(let at=0;at<ot.len;at++){const ut=this.payload[ot.start+at],ft=Math.floor(ut/8),xt=1<<ut%8;if(!(this.lookup[ft]&xt)&&(this.lookup[ft]|=xt,g.push(ut),g.length===this.triangleCount))return}}}query(o,g,_e){if(this.triangleCount===0||this.cells.length===0||o.x>this.max.x||this.min.x>g.x||o.y>this.max.y||this.min.y>g.y)return;this._lazyInitLookup();const rt=Vm(o.x-this.min.x,this.xScale,this.cellsX),ot=Vm(g.x-this.min.x,this.xScale,this.cellsX),at=Vm(o.y-this.min.y,this.yScale,this.cellsY),ut=Vm(g.y-this.min.y,this.yScale,this.cellsY);for(let ft=at;ft<=ut;ft++)for(let xt=rt;xt<=ot;xt++){const Ct=this.cells[ft*this.cellsX+xt];if(Ct)for(let Rt=0;Rt<Ct.len;Rt++){const kt=this.payload[Ct.start+Rt],zt=Math.floor(kt/8),Ut=1<<kt%8;if(!(this.lookup[zt]&Ut)&&(this.lookup[zt]|=Ut,_e.push(kt),_e.length===this.triangleCount))return}}}}function Vm(b,o,g){return Math.max(0,Math.min(g-1,Math.floor(b*o)))}Jn(cE,"TriangleGridIndex");class IC{constructor(o){this.zoom=o.zoom,this.layers=o.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=o.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.footprints=[],this.worldview=o.worldview,this.hasAppearances=null}updateFootprints(o,g){for(const _e of this.footprints)g.push({footprint:_e,id:o})}updateAppearances(o,g,_e,rt){}populate(o,g,_e,rt){const ot=[];for(const{feature:at,id:ut,index:ft,sourceLayerIndex:xt}of o){const Ct=this.layers[0]._featureFilter.needGeometry,Rt=Ur(at,Ct);if(!this.layers[0]._featureFilter.filter(new Xo(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),Rt,_e))continue;const kt={id:ut,properties:at.properties,type:at.type,sourceLayerIndex:xt,index:ft,geometry:Ct?Rt.geometry:kr(at,_e,rt),patterns:{}};ot.push(kt)}for(const at of ot){const{geometry:ut,index:ft,sourceLayerIndex:xt}=at;this.addFeature(at,ut,ft,_e,{},g.availableImages,g.brightness),g.featureIndex.insert(o[ft].feature,ut,ft,xt,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(o){}update(o,g,_e,rt,ot,at,ut){}destroy(){}addFeature(o,g,_e,rt,ot,at=[],ut){for(const ft of m1(g,2)){const xt=[],Ct=[],Rt=[],kt=new _n(1/0,1/0),zt=new _n(-1/0,-1/0);for(const er of ft)if(er.length!==0){er!==ft[0]&&Rt.push(Ct.length/2);for(let Jt=0;Jt<er.length;Jt++)Ct.push(er[Jt].x),Ct.push(er[Jt].y),xt.push(er[Jt]),kt.x=Math.min(kt.x,er[Jt].x),kt.y=Math.min(kt.y,er[Jt].y),zt.x=Math.max(zt.x,er[Jt].x),zt.y=Math.max(zt.y,er[Jt].y)}const Ut=A_(Ct,Rt),Kt=new cE(xt,Ut,8,256);this.footprints.push({vertices:xt,indices:Ut,grid:Kt,min:kt,max:zt})}}}Jn(IC,"ClipBucket",{omit:["layers"]});const CP=Ys([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),AP=Ys([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),RP=Ys([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),PP=Ys([{name:"a_centroid_pos",components:2,type:"Uint16"}]),IP=Ys([{name:"a_join_normal_inside",components:3,type:"Int16"}]),kP=Ys([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),MP=Ys([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:DP}=CP,g1=Number.MAX_SAFE_INTEGER,kC=g1-1;function MC(b,o,g,_e){return b.order<o||b.order===g1||!(b.clipMask&g)||function(rt,ot){return ot.length!==0&&ot.find(at=>at===rt)===void 0}(_e,b.clipScope)}function uE(b,o){return b.x-o.x||b.y-o.y}function DC(b,o){return uE(b.min,o.min)===0&&uE(b.max,o.max)===0}function $T(b,o){return!(b.min.x>o.max.x||b.max.x<o.min.x||b.min.y>o.max.y||b.max.y<o.min.y)}function hE(b,o){if(b.length!==o.length)return!1;for(let g=0;g<b.length;g++)if(b[g].sourceId!==o[g].sourceId||!DC(b[g],o[g])||b[g].order!==o[g].order||b[g].clipMask!==o[g].clipMask||!Su(b[g].clipScope,o[g].clipScope))return!1;return!0}function NC(b,o,g){const _e=1/jn,rt=1/(1<<g.canonical.z),ot=(o.x*_e+g.canonical.x)*rt+g.wrap,at=(o.y*_e+g.canonical.y)*rt;return{min:new _n((b.x*_e+g.canonical.x)*rt+g.wrap,(b.y*_e+g.canonical.y)*rt),max:new _n(ot,at)}}function NP(b,o,g){const _e=1<<g.canonical.z,rt=((o.x-g.wrap)*_e-g.canonical.x)*jn,ot=(o.y*_e-g.canonical.y)*jn;return{min:new _n(((b.x-g.wrap)*_e-g.canonical.x)*jn,(b.y*_e-g.canonical.y)*jn),max:new _n(rt,ot)}}function GT(b,o,g,_e,rt,ot,at){const ut=b.indices,ft=b.vertices,xt=[];for(let Ct=_e;Ct<_e+rt;Ct+=3){const Rt=o[g[Ct+0]+ot],kt=o[g[Ct+1]+ot],zt=o[g[Ct+2]+ot],Ut=Math.min(Rt.x,kt.x,zt.x),Kt=Math.max(Rt.x,kt.x,zt.x),er=Math.min(Rt.y,kt.y,zt.y),Jt=Math.max(Rt.y,kt.y,zt.y);xt.length=0,b.grid.query(new _n(Ut,er),new _n(Kt,Jt),xt);for(let or=0;or<xt.length;or++){const cr=xt[or];if(Pu(ft[ut[3*cr+0]],ft[ut[3*cr+1]],ft[ut[3*cr+2]],Rt,kt,zt,at))return!0}}return!1}function LC(b,o,g,_e){if(!b||!g)return!1;let rt=b.vertices;if(!o.canonical.equals(_e.canonical)||o.wrap!==_e.wrap){if(g.vertices.length<b.vertices.length)return LC(g,_e,b,o);const ot=o.canonical,at=_e.canonical,ut=Math.pow(2,at.z-ot.z);rt=b.vertices.map(ft=>new _n((ft.x+ot.x*jn)*ut-at.x*jn,(ft.y+ot.y*jn)*ut-at.y*jn))}return GT(g,rt,b.indices,0,b.indices.length,0,0)}function jC(b,o,g,_e){const rt=Math.pow(2,_e.z-g.z);return new _n((b+g.x*jn)*rt-_e.x*jn,(o+g.y*jn)*rt-_e.y*jn)}function OC(b,o){const g=[];o.grid.queryPoint(b,g);const _e=o.indices,rt=o.vertices;for(let ot=0;ot<g.length;ot++){const at=g[ot];if(Oo([rt[_e[3*at+0]],rt[_e[3*at+1]],rt[_e[3*at+2]]],b))return!0}return!1}const HT=[new _n(0,0),new _n(jn,0),new _n(jn,jn),new _n(0,jn)];function FC(b,o){const g=[];let _e=[];if(!o||b.length<2)return[b];if(b.length===2)return Eu(b[0],b[1],HT)?[b]:[];for(let rt=0;rt<b.length+2;rt++){const ot=b[rt%b.length],at=b[(rt+1)%b.length],ut=Eu(rt===0?b[b.length-1]:b[(rt-1)%b.length],ot,HT),ft=Eu(ot,at,HT),xt=ut||ft;xt&&_e.push(ot),xt&&ft||_e.length>0&&(_e.length>1&&g.push(_e),_e=[])}return _e.length>1&&g.push(_e),g}const WT=zr.types,LP=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],jP=["fill-extrusion-flood-light-ground-radius"],OP=Math.pow(2,13),FP=Math.pow(2,15)-1,BC=new _n(0,1),m0=2147483648,zC=7,VC=450;function y1(b,o,g,_e,rt,ot,at,ut){b.emplaceBack((o<<1)+at,(g<<1)+ot,(Math.floor(_e*OP)<<1)+rt,Math.round(ut))}function x1(b,o,g){b.emplaceBack(o.x*jn,o.y*jn,g?1:0)}function dE(b,o,g,_e,rt,ot){b.emplaceBack(o.x,o.y,(g.x<<1)+_e,(g.y<<1)+rt,ot)}function _1(b,o,g){b.emplaceBack(o.x,o.y,o.z,g[0]*16384,g[1]*16384,g[2]*16384)}class UC{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class $C{constructor(){this.centroidXY=new _n(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new _n(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new _n(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new _n(this.max.x-this.min.x,this.max.y-this.min.y)}}class GC{constructor(){this.acc=new _n(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(o,g){o.min.x===Number.MAX_VALUE&&(o.min.x=o.max.x=g.x,o.min.y=o.max.y=g.y)}appendEdge(o,g,_e){this.accCount++,this.acc._add(g);let rt=!!this.borders;g.x<o.min.x?(o.min.x=g.x,rt=!0):g.x>o.max.x&&(o.max.x=g.x,rt=!0),g.y<o.min.y?(o.min.y=g.y,rt=!0):g.y>o.max.y&&(o.max.y=g.y,rt=!0),((g.x===0||g.x===jn)&&g.x===_e.x)!=((g.y===0||g.y===jn)&&g.y===_e.y)&&this.processBorderOverlap(g,_e),rt&&this.checkBorderIntersection(g,_e)}checkBorderIntersection(o,g){g.x<0!=o.x<0&&this.addBorderIntersection(0,Cs(g.y,o.y,(0-g.x)/(o.x-g.x))),g.x>jn!=o.x>jn&&this.addBorderIntersection(1,Cs(g.y,o.y,(jn-g.x)/(o.x-g.x))),g.y<0!=o.y<0&&this.addBorderIntersection(2,Cs(g.x,o.x,(0-g.y)/(o.y-g.y))),g.y>jn!=o.y>jn&&this.addBorderIntersection(3,Cs(g.x,o.x,(jn-g.y)/(o.y-g.y)))}addBorderIntersection(o,g){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const _e=this.borders[o];g<_e[0]&&(_e[0]=g),g>_e[1]&&(_e[1]=g)}processBorderOverlap(o,g){if(o.x===g.x){if(o.y===g.y)return;const _e=o.x===0?0:1;this.addBorderIntersection(_e,g.y),this.addBorderIntersection(_e,o.y)}else{const _e=o.y===0?2:3;this.addBorderIntersection(_e,g.x),this.addBorderIntersection(_e,o.x)}}centroid(){return this.accCount===0?new _n(0,0):new _n(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((o,g)=>o+ +(g[0]!==Number.MAX_VALUE),0):0}}function HC(b,o){const g=b.add(o)._unit(),_e=tr(b.x*g.x+b.y*g.y,-1,1);var rt,ot,at;return rt=Math.acos(_e),Math.min(4,Math.max(-4,Math.tan(rt)))/4*FP*((ot=b).x*(at=o).y-ot.y*at.x<0?-1:1)}const BP=[b=>b.x<0,b=>b.x>jn,b=>b.y<0,b=>b.y>jn];function zP(b,o,g,_e){const rt=[4];if(_e===0)return rt;g._mult(_e);const ot=b.sub(g),at=o.sub(g),ut=[b,o,ot,at];for(let ft=0;ft<4;ft++)for(const xt of ut)if(BP[ft](xt)){rt.push(ft);break}return rt}class qT{constructor(o){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new Hv,this.indexArray=new tu,this.programConfigurations=new Pp(o.layers,{zoom:o.zoom,lut:o.lut},g=>jP.includes(g)),this._segments=new _l,this.hiddenByLandmarkVertexArray=new m_,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new _l}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(o,g,_e,rt=!1){const ot=o.length;if(ot>2){let at=Math.max(0,this._segments.get().length-1);const ut=this._segments._prepareSegment(4*ot,this.vertexArray.length,2*this._segmentToGroundQuads[at].length);let ft;at!==this._segments.get().length-1&&(at++,this._segmentToGroundQuads[at]=[],this._segmentToRegionTriCounts[at]=[0,0,0,0,0]);{const xt=o[0],Ct=o[1];ft=HC(xt.sub(o[ot-1])._perp()._unit(),Ct.sub(xt)._perp()._unit())}for(let xt=0;xt<ot;xt++){const Ct=xt===ot-1?0:xt+1,Rt=o[xt],kt=o[Ct],zt=o[Ct===ot-1?0:Ct+1],Ut=kt.sub(Rt)._perp()._unit(),Kt=HC(Ut,zt.sub(kt)._perp()._unit()),er=ft,Jt=Kt;if(KT(Rt,kt,g)||rt&&KC(Rt,g)&&KC(kt,g)){ft=Kt;continue}const or=ut.vertexLength;dE(this.vertexArray,Rt,kt,1,1,er),dE(this.vertexArray,Rt,kt,1,0,er),dE(this.vertexArray,Rt,kt,0,1,Jt),dE(this.vertexArray,Rt,kt,0,0,Jt),ut.vertexLength+=4;const cr=zP(Rt,kt,Ut,_e);for(const pr of cr)this._segmentToGroundQuads[at].push({id:or,region:pr}),this._segmentToRegionTriCounts[at][pr]+=2,ut.primitiveLength+=2;ft=Kt}}}prepareBorderSegments(){if(!this.hasData())return;const o=this._segments.get(),g=o.length;for(let _e=0;_e<g;_e++)this._segmentToGroundQuads[_e].sort((rt,ot)=>rt.region-ot.region);for(let _e=0;_e<g;_e++){const rt=this._segmentToGroundQuads[_e],ot=o[_e],at=this._segmentToRegionTriCounts[_e];at.reduce((ft,xt)=>ft+xt,0);let ut=0;for(let ft=0;ft<=4;ft++){const xt=at[ft];if(xt!==0){let Ct=this.regionSegments[ft];Ct||(Ct=this.regionSegments[ft]=new _l);const Rt={vertexOffset:ot.vertexOffset,primitiveOffset:ot.primitiveOffset+ut,vertexLength:ot.vertexLength,primitiveLength:xt};Ct.get().push(Rt)}ut+=xt}for(let ft=0;ft<rt.length;ft++){const xt=rt[ft].id;this.indexArray.emplaceBack(xt,xt+1,xt+3),this.indexArray.emplaceBack(xt,xt+3,xt+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(o,g,_e,rt,ot,at,ut){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,o,g,_e,rt,ot,at,void 0,ut)}upload(o){this.hasData()&&(this.vertexBuffer=o.createVertexBuffer(this.vertexArray,AP.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=o.createVertexBuffer(this.groundRadiusArray,RP.members)))}uploadPaintProperties(o){this.hasData()&&this.programConfigurations.upload(o)}update(o,g,_e,rt,ot,at,ut,ft){this.hasData()&&this.programConfigurations.updatePaintArrays(o,g,_e,rt,ot,at,ut,ft)}updateHiddenByLandmark(o){this.updateHiddenByLandmarkRange(o.groundVertexArrayOffset,o.groundVertexCount,!!(o.flags&m0))}updateHiddenByLandmarkRange(o,g,_e){if(!this.hasData())return;const rt=g+o;if(g!==0){for(let ot=o;ot<rt;++ot)this.hiddenByLandmarkVertexArray.emplace(ot,_e?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(o){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=o.createVertexBuffer(this.hiddenByLandmarkVertexArray,kP.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let o=0;o<=4;o++){const g=this.regionSegments[o];g&&g.destroy()}}}}class pE{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.pixelRatio=o.pixelRatio,this.layerIds=this.layers.map(g=>g.fqid),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new tu,this.footprintVertices=new jm,this.footprintSegments=[],this.layoutVertexArray=new B0,this.centroidVertexArray=new eE,this.wallVertexArray=new Oy,this.indexArray=new tu,this.programConfigurations=new Pp(o.layers,{zoom:o.zoom,lut:o.lut},g=>LP.includes(g)),this.segments=new _l,this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.groundEffect=new qT(o),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=o.worldview,this.hasAppearances=null}updateFootprints(o,g){}updateAppearances(o,g,_e,rt){}populate(o,g,_e,rt){this.features=[],this.hasPattern=FT("fill-extrusion",this.layers,this.pixelRatio,g),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=ir(_e),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:ot,id:at,index:ut,sourceLayerIndex:ft}of o){const xt=this.layers[0]._featureFilter.needGeometry,Ct=Ur(ot,xt);if(!this.layers[0]._featureFilter.filter(new Xo(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),Ct,_e))continue;const Rt={id:at,sourceLayerIndex:ft,index:ut,geometry:xt?Ct.geometry:kr(ot,_e,rt),properties:ot.properties,type:ot.type,patterns:{}},kt=this.layoutVertexArray.length,zt=WT[Rt.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:ot.id,feature:BT("fill-extrusion",this.layers,Rt,this.zoom,this.pixelRatio,g)});else if(this.wallMode)for(const Ut of Rt.geometry)for(const Kt of FC(Ut,zt))this.addFeature(ot.id,Rt,[Kt],ut,_e,{},g.availableImages,rt,g.brightness);else this.addFeature(ot.id,Rt,Rt.geometry,ut,_e,{},g.availableImages,rt,g.brightness);g.featureIndex.insert(ot,Rt.geometry,ut,ft,this.index,kt)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(o,g,_e,rt,ot,at){for(const{featureId:ut,feature:ft}of this.features){const xt=WT[ft.type]==="Polygon",{geometry:Ct}=ft;if(this.wallMode)for(const Rt of Ct)for(const kt of FC(Rt,xt))this.addFeature(ut,ft,[kt],ft.index,g,_e,rt,ot,at);else this.addFeature(ut,ft,Ct,ft.index,g,_e,rt,ot,at)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(o,g,_e,rt,ot,at,ut){this.programConfigurations.updatePaintArrays(o,g,ot,_e,rt,at,ut,this.worldview),this.groundEffect.update(o,g,ot,_e,rt,at,ut,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,DP),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.wallVertexBuffer=o.createVertexBuffer(this.wallVertexArray,IP.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,MP.members,!0)),this.groundEffect.upload(o)),this.groundEffect.uploadPaintProperties(o),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){this.groundEffect.uploadHiddenByLandmark(o),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,PP.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,g,_e,rt,ot,at,ut,ft,xt){const Ct=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(g,{})/this.tileToMeter,Rt=[new _n(0,0),new _n(jn,jn)],kt=ft.projection,zt=kt.name==="globe",Ut=this.wallMode||WT[g.type]==="Polygon",Kt=new GC;Kt.centroidDataIndex=this.centroidData.length;const er=new $C;er.buildingId=o,g.properties&&g.properties.hasOwnProperty("building_id")&&(er.buildingId=g.properties.building_id);const Jt=this.layers[0].paint.get("fill-extrusion-base").evaluate(g,{},ot)<=0,or=this.layers[0].paint.get("fill-extrusion-height").evaluate(g,{},ot);let cr;if(er.height=or,er.vertexArrayOffset=this.layoutVertexArray.length,er.groundVertexArrayOffset=this.groundEffect.vertexArray.length,zt&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new c_),this.wallMode){if(zt)return void Wn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(_e.length!==1)return;cr=function($r){const un=$r[0].x===$r[$r.length-1].x&&$r[0].y===$r[$r.length-1].y;(function(Kn){let ts=0;const qs=Kn.length;for(let Dn=0;Dn<qs;Dn++)ts+=(Kn[(Dn+1)%qs].x-Kn[Dn].x)*(Kn[(Dn+1)%qs].y+Kn[Dn].y);return ts>=0})($r)||($r=$r.reverse());const yn={geometry:[],joinNormals:[],indices:[]},Sn=[],An=[],wn=[];let En=$r.length;for(;En>=2&&$r[En-1].equals($r[En-2]);)En--;if(En<(un?3:2))return yn;let ln,on,Tn,On,kn,ls=0;for(;ls<En-1&&$r[ls].equals($r[ls+1]);)ls++;un&&(ln=$r[En-2],kn=$r[ls].sub(ln)._unit()._perp());for(let Kn=ls;Kn<En;Kn++){if(Tn=Kn===En-1?un?$r[ls+1]:void 0:$r[Kn+1],Tn&&$r[Kn].equals(Tn))continue;kn&&(On=kn),ln&&(on=ln),ln=$r[Kn],kn=Tn?Tn.sub(ln)._unit()._perp():On,On=On||kn;let ts=On.add(kn);ts.x===0&&ts.y===0||ts._unit();const qs=ts.x*kn.x+ts.y*kn.y,Dn=qs!==0?1/qs:1/0,rs=On.x*kn.y-On.y*kn.x>0;let Ms="miter";const ro=2;Ms==="miter"&&Dn>ro&&(Ms="bevel"),Ms==="bevel"&&(Dn>100&&(Ms="flipbevel"),Dn<ro&&(Ms="miter"));const so=(Os,No,wr,Cr)=>{const hn=new _n(Os.x,Os.y),Cn=new _n(Os.x,Os.y);hn.x+=No.x*Cr,hn.y+=No.y*Cr,Cn.x-=No.x*Math.max(wr,1),Cn.y-=No.y*Math.max(wr,1),wn.push(No),Sn.push(hn),An.push(Cn)};if(Ms==="miter")ts._mult(Dn),so(ln,ts,0,0);else if(Ms==="flipbevel")ts=kn.mult(-1),so(ln,ts,0,0),so(ln,ts.mult(-1),0,0);else{const Os=-Math.sqrt(Dn*Dn-1),No=rs?Os:0,wr=rs?0:Os;on&&so(ln,On,No,wr),Tn&&so(ln,kn,No,wr)}}yn.geometry=[...Sn,...An.reverse(),Sn[0]],yn.joinNormals=[...wn,...wn.reverse(),wn[wn.length-1]];const Gn=yn.geometry.length-1;for(let Kn=0;Kn<Gn/2;Kn++)if(Kn+1<Gn/2){let ts=Kn,qs=Kn+1,Dn=Gn-1-Kn,rs=Gn-2-Kn;ts=ts===0?Gn-1:ts-1,qs=qs===0?Gn-1:qs-1,Dn=Dn===0?Gn-1:Dn-1,rs=rs===0?Gn-1:rs-1,yn.indices.push(Dn),yn.indices.push(qs),yn.indices.push(ts),yn.indices.push(Dn),yn.indices.push(rs),yn.indices.push(qs)}return yn}(_e[0]),_e=[cr.geometry]}const pr=($r,un)=>$r<(un.length-1)/2||$r===un.length-1,Sr=this.wallMode?[_e]:m1(_e,500);for(let $r=Sr.length-1;$r>=0;$r--){const un=Sr[$r];(un.length===0||(br=un[0]).every(gn=>gn.x<=0)||br.every(gn=>gn.x>=jn)||br.every(gn=>gn.y<=0)||br.every(gn=>gn.y>=jn))&&Sr.splice($r,1)}var br;let Pr;if(zt)Pr=QC(Sr,Rt,ot);else{Pr=[];for(const $r of Sr)Pr.push({polygon:$r,bounds:Rt})}const Dr=Ut?this.edgeRadius:0,Or=Dr>0&&this.zoom<17,nn=($r,un)=>{if($r.length===0)return!1;const gn=$r[$r.length-1];return un.x===gn.x&&un.y===gn.y};for(const{polygon:$r,bounds:un}of Pr){let gn=0,yn=0;for(const En of $r)Ut&&!En[0].equals(En[En.length-1])&&En.push(En[0]),yn+=Ut?En.length-1:En.length;const Sn=this.segments.prepareSegment((Ut?5:4)*yn,this.layoutVertexArray,this.indexArray);er.footprintSegIdx<0&&(er.footprintSegIdx=this.footprintSegments.length),er.polygonSegIdx<0&&(er.polygonSegIdx=this.polygonSegments.length);const An={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},wn=new UC;if(wn.vertexOffset=this.footprintVertices.length,wn.indexOffset=3*this.footprintIndices.length,wn.ringIndices=[],Ut){const En=[],ln=[];gn=Sn.vertexLength;for(let Tn=0;Tn<$r.length;Tn++){const On=$r[Tn];On.length&&Tn!==0&&ln.push(En.length/2);const kn=[];let ls,Gn;ls=On[1].sub(On[0])._perp()._unit(),wn.ringIndices.push(On.length-1);for(let Kn=1;Kn<On.length;Kn++){const ts=On[Kn],qs=On[Kn===On.length-1?1:Kn+1],Dn=ts.clone();if(Dr){Gn=qs.sub(ts)._perp()._unit();const rs=ls.add(Gn)._unit(),Ms=Dr*Math.min(4,1/(ls.x*rs.x+ls.y*rs.y));Dn.x+=Ms*rs.x,Dn.y+=Ms*rs.y,Dn.x=Math.round(Dn.x),Dn.y=Math.round(Dn.y),ls=Gn}if(!Jt||Dr!==0&&!Or||nn(kn,Dn)||kn.push(Dn),y1(this.layoutVertexArray,Dn.x,Dn.y,0,0,1,1,0),this.wallMode){const rs=pr(Kn,On);x1(this.wallVertexArray,cr.joinNormals[Kn],!rs)}Sn.vertexLength++,this.footprintVertices.emplaceBack(ts.x,ts.y),En.push(ts.x,ts.y),zt&&_1(this.layoutVertexExtArray,kt.projectTilePoint(Dn.x,Dn.y,ot),kt.upVector(ot,Dn.x,Dn.y))}Jt&&(Dr===0||Or)&&(kn.length!==0&&nn(kn,kn[0])&&kn.pop(),this.groundEffect.addData(kn,un,Ct))}const on=this.wallMode?cr.indices:A_(En,ln);for(let Tn=0;Tn<on.length;Tn+=3)this.footprintIndices.emplaceBack(wn.vertexOffset+on[Tn+0],wn.vertexOffset+on[Tn+1],wn.vertexOffset+on[Tn+2]),this.indexArray.emplaceBack(gn+on[Tn],gn+on[Tn+2],gn+on[Tn+1]),Sn.primitiveLength++;wn.indexCount+=on.length,wn.vertexCount+=this.footprintVertices.length-wn.vertexOffset}for(let En=0;En<$r.length;En++){const ln=$r[En];Kt.startRing(er,ln[0]);let on=ln.length>4&&XC(ln[ln.length-2],ln[0],ln[1]),Tn=Dr?VP(ln[ln.length-2],ln[0],ln[1],Dr):0;const On=[];let kn,ls,Gn;ls=ln[1].sub(ln[0])._perp()._unit();let Kn=!0;for(let ts=1,qs=0;ts<ln.length;ts++){let Dn=ln[ts-1],rs=ln[ts];const Ms=ln[ts===ln.length-1?1:ts+1];if(Kt.appendEdge(er,rs,Dn),KT(rs,Dn,un)){Dr&&(ls=Ms.sub(rs)._perp()._unit(),Kn=!Kn);continue}const ro=rs.sub(Dn)._perp(),so=ro.x/(Math.abs(ro.x)+Math.abs(ro.y)),Os=ro.y>0?1:0,No=Dn.dist(rs);if(qs+No>32768&&(qs=0),Dr){Gn=Ms.sub(rs)._perp()._unit();let Cn=qC(Dn,rs,Ms,WC(ls,Gn),Dr);isNaN(Cn)&&(Cn=0);const Vn=rs.sub(Dn)._unit();Dn=Dn.add(Vn.mult(Tn))._round(),rs=rs.add(Vn.mult(-Cn))._round(),Tn=Cn,ls=Gn,Jt&&this.zoom>=17&&(nn(On,Dn)||On.push(Dn),nn(On,rs)||On.push(rs))}const wr=Sn.vertexLength,Cr=ln.length>4&&XC(Dn,rs,Ms);let hn=ZC(qs,on,Kn);if(y1(this.layoutVertexArray,Dn.x,Dn.y,so,Os,0,0,hn),y1(this.layoutVertexArray,Dn.x,Dn.y,so,Os,0,1,hn),this.wallMode){const Cn=pr(ts-1,ln),Vn=cr.joinNormals[ts-1];x1(this.wallVertexArray,Vn,Cn),x1(this.wallVertexArray,Vn,Cn)}if(qs+=No,hn=ZC(qs,Cr,!Kn),on=Cr,y1(this.layoutVertexArray,rs.x,rs.y,so,Os,0,0,hn),y1(this.layoutVertexArray,rs.x,rs.y,so,Os,0,1,hn),this.wallMode){const Cn=pr(ts,ln),Vn=cr.joinNormals[ts];x1(this.wallVertexArray,Vn,Cn),x1(this.wallVertexArray,Vn,Cn)}if(Sn.vertexLength+=4,this.indexArray.emplaceBack(wr+0,wr+1,wr+2),this.indexArray.emplaceBack(wr+1,wr+3,wr+2),Sn.primitiveLength+=2,Dr){const Cn=gn+(ts===1?ln.length-2:ts-2),Vn=ts===1?gn:Cn+1;if(this.indexArray.emplaceBack(wr+1,Cn,wr+3),this.indexArray.emplaceBack(Cn,Vn,wr+3),Sn.primitiveLength+=2,kn===void 0&&(kn=wr),!KT(Ms,ln[ts],un)){const Un=ts===ln.length-1?kn:Sn.vertexLength;this.indexArray.emplaceBack(wr+2,wr+3,Un),this.indexArray.emplaceBack(wr+3,Un+1,Un),this.indexArray.emplaceBack(wr+3,Vn,Un+1),Sn.primitiveLength+=3}Kn=!Kn}if(zt){const Cn=this.layoutVertexExtArray,Vn=kt.projectTilePoint(Dn.x,Dn.y,ot),Un=kt.projectTilePoint(rs.x,rs.y,ot),cs=kt.upVector(ot,Dn.x,Dn.y),ps=kt.upVector(ot,rs.x,rs.y);_1(Cn,Vn,cs),_1(Cn,Vn,cs),_1(Cn,Un,ps),_1(Cn,Un,ps)}}Ut&&(gn+=ln.length-1),Jt&&Dr&&this.zoom>=17&&(On.length!==0&&nn(On,On[0])&&On.pop(),this.groundEffect.addData(On,un,Ct,Dr>0))}this.footprintSegments.push(wn),An.triangleCount=this.indexArray.length-An.triangleArrayOffset,this.polygonSegments.push(An),++er.footprintSegLen,++er.polygonSegLen}if(er.vertexCount=this.layoutVertexArray.length-er.vertexArrayOffset,er.groundVertexCount=this.groundEffect.vertexArray.length-er.groundVertexArrayOffset,er.vertexCount!==0){if(er.centroidXY=Kt.borders?BC:this.encodeCentroid(Kt,er),this.centroidData.push(er),Kt.borders){this.featuresOnBorder.push(Kt);const $r=this.featuresOnBorder.length-1;for(let un=0;un<Kt.borders.length;un++)Kt.borders[un][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[un].push($r)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,g,rt,at,ut,ot,xt,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(g,rt,at,ut,ot,xt,this.worldview),this.maxHeight=Math.max(this.maxHeight,or)}}sortBorders(){for(let o=0;o<this.borderFeatureIndices.length;o++)this.borderFeatureIndices[o].sort((g,_e)=>this.featuresOnBorder[g].borders[o][0]-this.featuresOnBorder[_e].borders[o][0])}splitToSubtiles(){const o=[];for(let ut=0;ut<this.centroidData.length;ut++){const ft=this.centroidData[ut],xt=+(ft.min.y+ft.max.y>jn),Ct=2*xt+(+(ft.min.x+ft.max.x>jn)^xt);for(let Rt=0;Rt<ft.polygonSegLen;Rt++){const kt=ft.polygonSegIdx+Rt;o.push({centroidIdx:ut,subtile:Ct,polygonSegmentIdx:kt,triangleSegmentIdx:this.polygonSegments[kt].triangleSegIdx})}}const g=new tu;o.sort((ut,ft)=>ut.triangleSegmentIdx===ft.triangleSegmentIdx?ut.subtile-ft.subtile:ut.triangleSegmentIdx-ft.triangleSegmentIdx);let _e=0,rt=0,ot=0;for(const ut of o){if(ut.triangleSegmentIdx!==_e)break;ot++}const at=o.length;for(;rt!==o.length;){_e=o[rt].triangleSegmentIdx;let ut=0,ft=rt,xt=rt;for(let Ct=ft;Ct<ot&&o[Ct].subtile===ut;Ct++)xt++;for(;ft!==ot;){const Ct=o[ft];ut=Ct.subtile;const Rt=this.centroidData[Ct.centroidIdx].min.clone(),kt=this.centroidData[Ct.centroidIdx].max.clone(),zt={vertexOffset:this.segments.segments[_e].vertexOffset,primitiveOffset:g.length,vertexLength:this.segments.segments[_e].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let Ut=ft;Ut<xt;Ut++){const Kt=o[Ut],er=this.polygonSegments[Kt.polygonSegmentIdx],Jt=this.centroidData[Kt.centroidIdx].min,or=this.centroidData[Kt.centroidIdx].max,cr=this.indexArray.uint16;for(let pr=er.triangleArrayOffset;pr<er.triangleArrayOffset+er.triangleCount;pr++)g.emplaceBack(cr[3*pr],cr[3*pr+1],cr[3*pr+2]);zt.primitiveLength+=er.triangleCount,Rt.x=Math.min(Rt.x,Jt.x),Rt.y=Math.min(Rt.y,Jt.y),kt.x=Math.max(kt.x,or.x),kt.y=Math.max(kt.y,or.y)}zt.primitiveLength>0&&this.triangleSubSegments.push({segment:zt,min:Rt,max:kt}),ft=xt;for(let Ut=ft;Ut<ot&&o[Ut].subtile===o[ft].subtile;Ut++)xt++}rt=ot;for(let Ct=rt;Ct<at&&o[Ct].triangleSegmentIdx===o[rt].triangleSegmentIdx;Ct++)ot++}g._trim(),this.indexArray=g}getVisibleSegments(o,g,_e){const rt=new _l;if(this.wallMode){for(const Kt of this.triangleSubSegments)rt.segments.push(Kt.segment);return rt}let ot=0,at=0;const ut=1<<o.canonical.z;if(g){const Kt=g.getMinMaxForTile(o);Kt&&(ot=Kt.min,at=Kt.max)}at+=this.maxHeight;const ft=o.toUnwrapped();let xt;const Ct=[ft.canonical.x/ut+ft.wrap,ft.canonical.y/ut],Rt=[(ft.canonical.x+1)/ut+ft.wrap,(ft.canonical.y+1)/ut],kt=(Kt,er,Jt)=>[Kt[0]*(1-Jt[0])+er[0]*Jt[0],Kt[1]*(1-Jt[1])+er[1]*Jt[1]],zt=[],Ut=[];for(const Kt of this.triangleSubSegments){zt[0]=Kt.min.x/jn,zt[1]=Kt.min.y/jn,Ut[0]=Kt.max.x/jn,Ut[1]=Kt.max.y/jn;const er=kt(Ct,Rt,zt),Jt=kt(Ct,Rt,Ut);if(new is([er[0],er[1],ot],[Jt[0],Jt[1],at]).intersectsPrecise(_e)===0){xt&&(rt.segments.push(xt),xt=void 0);continue}const or=Kt.segment;xt&&xt.vertexOffset!==or.vertexOffset&&(rt.segments.push(xt),xt=void 0),xt?(xt.vertexLength+=or.vertexLength,xt.primitiveLength+=or.primitiveLength):xt={vertexOffset:or.vertexOffset,primitiveLength:or.primitiveLength,vertexLength:or.vertexLength,primitiveOffset:or.primitiveOffset,sortKey:void 0,vaos:{}}}return xt&&rt.segments.push(xt),rt}encodeCentroid(o,g){const _e=o.centroid(),rt=g.span(),ot=Math.min(7,Math.round(rt.x*this.tileToMeter/10)),at=Math.min(7,Math.round(rt.y*this.tileToMeter/10));return new _n(tr(_e.x,1,jn-1)<<3|ot,tr(_e.y,1,jn-1)<<3|at)}encodeBorderCentroid(o){if(!o.borders)return new _n(0,0);const g=o.borders,_e=Number.MAX_VALUE;if(g[0][0]!==_e||g[1][0]!==_e){const rt=g[0][0]!==_e?0:1;return new _n(6|(g[0][0]!==_e?0:65528),(g[rt][0]+g[rt][1])/2<<3|6)}{const rt=g[2][0]!==_e?2:3;return new _n((g[rt][0]+g[rt][1])/2<<3|6,6|(g[2][0]!==_e?0:65528))}}showCentroid(o){const g=this.centroidData[o.centroidDataIndex];g.flags&=2147483647,g.centroidXY.x=0,g.centroidXY.y=0,this.writeCentroidToBuffer(g)}writeCentroidToBuffer(o){this.groundEffect.updateHiddenByLandmark(o);const g=o.vertexArrayOffset,_e=o.vertexCount+o.vertexArrayOffset,rt=o.flags&m0?BC:o.centroidXY,ot=this.centroidVertexArray.geta_centroid_pos0(g);if(this.centroidVertexArray.geta_centroid_pos1(g)!==rt.y||ot!==rt.x){for(let at=g;at<_e;++at)this.centroidVertexArray.emplace(at,rt.x,rt.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const o of this.centroidData)this.writeCentroidToBuffer(o)}updateReplacement(o,g,_e){if(g.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=g.updateTime;const rt=g.getReplacementRegionsForTile(o.toUnwrapped());if(hE(this.activeReplacements,rt))return;if(this.activeReplacements=rt,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const at of this.centroidData)at.flags&=2147483647;const ot=[];for(const at of this.activeReplacements){if(at.order<_e)continue;const ut=Math.max(1,Math.pow(2,at.footprintTileId.canonical.z-o.canonical.z));if(at.footprint.buildingIds)for(const ft of this.centroidData)ft.flags&m0||at.min.x>ft.max.x||ft.min.x>at.max.x||at.min.y>ft.max.y||ft.min.y>at.max.y||at.footprint.buildingIds.has(ft.buildingId)&&(ft.flags|=m0);else for(const ft of this.centroidData)if(!(ft.flags&m0||at.min.x>ft.max.x||ft.min.x>at.max.x||at.min.y>ft.max.y||ft.min.y>at.max.y))for(let xt=0;xt<ft.footprintSegLen;xt++){const Ct=this.footprintSegments[ft.footprintSegIdx+xt];if(ot.length=0,UP(this.footprintVertices,Ct.vertexOffset,Ct.vertexCount,at.footprintTileId.canonical,o.canonical,ot),GT(at.footprint,ot,this.footprintIndices.uint16,Ct.indexOffset,Ct.indexCount,-Ct.vertexOffset,-ut)){ft.flags|=m0;break}}}for(const at of this.centroidData)this.writeCentroidToBuffer(at);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(o,g,_e){let rt=!1;for(let ot=0;ot<_e.footprintSegLen;ot++){const at=this.footprintSegments[_e.footprintSegIdx+ot];let ut=0;for(const ft of at.ringIndices){for(let xt=ut,Ct=ft+ut-1;xt<ft+ut;Ct=xt++){const Rt=this.footprintVertices.int16[2*(xt+at.vertexOffset)+0],kt=this.footprintVertices.int16[2*(xt+at.vertexOffset)+1],zt=this.footprintVertices.int16[2*(Ct+at.vertexOffset)+1];kt>g!=zt>g&&o<(this.footprintVertices.int16[2*(Ct+at.vertexOffset)+0]-Rt)*(g-kt)/(zt-kt)+Rt&&(rt=!rt)}ut=ft}}return rt}getHeightAtTileCoord(o,g){let _e=Number.NEGATIVE_INFINITY,rt=!0;const ot=4*(o+jn)*jn+(g+jn);if(this.partLookup.hasOwnProperty(ot)){const at=this.partLookup[ot];return at?{height:at.height,hidden:!!(at.flags&m0)}:void 0}for(const at of this.centroidData)o>at.max.x||at.min.x>o||g>at.max.y||at.min.y>g||at.height<=_e||this.footprintContainsPoint(o,g,at)&&(_e=at.height,this.partLookup[ot]=at,rt=!!(at.flags&m0));if(_e!==Number.NEGATIVE_INFINITY)return{height:_e,hidden:rt};this.partLookup[ot]=void 0}}function WC(b,o){const g=b.add(o)._unit();return b.x*g.x+b.y*g.y}function VP(b,o,g,_e){const rt=o.sub(b)._perp()._unit(),ot=g.sub(o)._perp()._unit();return qC(b,o,g,WC(rt,ot),_e)}function qC(b,o,g,_e,rt){const ot=Math.sqrt(1-_e*_e);return Math.min(b.dist(o)/3,o.dist(g)/3,rt*ot/_e)}function KT(b,o,g){return b.x<g[0].x&&o.x<g[0].x||b.x>g[1].x&&o.x>g[1].x||b.y<g[0].y&&o.y<g[0].y||b.y>g[1].y&&o.y>g[1].y}function KC(b,o){return b.x<o[0].x||b.x>o[1].x||b.y<o[0].y||b.y>o[1].y}function XC(b,o,g){if(b.x<0||b.x>=jn||o.x<0||o.x>=jn||g.x<0||g.x>=jn)return!1;const _e=g.sub(o),rt=_e.perp(),ot=b.sub(o);return(_e.x*ot.x+_e.y*ot.y)/Math.sqrt((_e.x*_e.x+_e.y*_e.y)*(ot.x*ot.x+ot.y*ot.y))>-.866&&rt.x*ot.x+rt.y*ot.y<0}function ZC(b,o,g){const _e=o?2|b:-3&b;return g?1|_e:-2&_e}function YC(){const b=Math.PI/32,o=Math.tan(b),g=it;return g*Math.sqrt(1+2*o*o)-g}function QC(b,o,g){const _e=1<<g.z,rt=Dt(g.x/_e),ot=Dt((g.x+1)/_e),at=Ht(g.y/_e),ut=Ht((g.y+1)/_e);return function(ft,xt,Ct,Rt,kt=0,zt){const Ut=[];if(!ft.length||!Ct||!Rt)return Ut;const Kt=(br,Pr)=>{for(const Dr of br)Ut.push({polygon:Dr,bounds:Pr})},er=Math.ceil(Math.log2(Ct)),Jt=Math.ceil(Math.log2(Rt)),or=er-Jt,cr=[];for(let br=0;br<Math.abs(or);br++)cr.push(or>0?0:1);for(let br=0;br<Math.min(er,Jt);br++)cr.push(0),cr.push(1);let pr=ft;if(pr=lE(pr,xt[0].y-kt,xt[1].y+kt,1),pr=lE(pr,xt[0].x-kt,xt[1].x+kt,0),!pr.length)return Ut;const Sr=[];for(cr.length?Sr.push({polygons:pr,bounds:xt,depth:0}):Kt(pr,xt);Sr.length;){const br=Sr.pop(),Pr=br.depth,Dr=cr[Pr],Or=br.bounds[0],nn=br.bounds[1],$r=Dr===0?Or.x:Or.y,un=Dr===0?nn.x:nn.y,gn=zt?zt(Dr,$r,un):.5*($r+un),yn=lE(br.polygons,$r-kt,gn+kt,Dr),Sn=lE(br.polygons,gn-kt,un+kt,Dr);if(yn.length){const An=[Or,new _n(Dr===0?gn:nn.x,Dr===1?gn:nn.y)];cr.length>Pr+1?Sr.push({polygons:yn,bounds:An,depth:Pr+1}):Kt(yn,An)}if(Sn.length){const An=[new _n(Dr===0?gn:Or.x,Dr===1?gn:Or.y),nn];cr.length>Pr+1?Sr.push({polygons:Sn,bounds:An,depth:Pr+1}):Kt(Sn,An)}}return Ut}(b,o,Math.ceil((ot-rt)/11.25),Math.ceil((at-ut)/11.25),1,(ft,xt,Ct)=>{if(ft===0)return .5*(xt+Ct);{const Rt=Ht((g.y+xt/jn)/_e);return(St(.5*(Ht((g.y+Ct/jn)/_e)+Rt))*_e-g.y)*jn}})}function UP(b,o,g,_e,rt,ot){const at=Math.pow(2,_e.z-rt.z);for(let ut=0;ut<g;ut++){let ft=b.int16[2*(ut+o)+0],xt=b.int16[2*(ut+o)+1];ft=(ft+rt.x*jn)*at-_e.x*jn,xt=(xt+rt.y*jn)*at-_e.y*jn,ot.push(new _n(ft,xt))}}let JC,e2;Jn(pE,"FillExtrusionBucket",{omit:["layers","features"]}),Jn($C,"PartData"),Jn(UC,"FootprintSegment"),Jn(GC,"BorderCentroidData"),Jn(qT,"GroundEffect");class qy extends _n{constructor(o,g,_e){super(o,g),this.z=_e}}class t2 extends qy{constructor(o,g,_e,rt){super(o,g,_e),this.w=rt}}function r2(b,o,g,_e){const rt=g==="x"?"y":"x",ot=(_e-b[g])/(o[g]-b[g]);b[rt]=Math.round(b[rt]+(o[rt]-b[rt])*ot),b[g]=_e,b.hasOwnProperty("z")&&(b.z=Cs(b.z,o.z,ot)),b.hasOwnProperty("w")&&(b.w=Cs(b.w,o.w,ot))}function n2(b,o,g,_e){const rt=g,ot=_e;for(const at of["x","y"]){let ut=b,ft=o;ut[at]>=ft[at]&&(ut=o,ft=b),ut[at]<rt&&ft[at]>rt&&r2(ut,ft,at,rt),ut[at]<ot&&ft[at]>ot&&r2(ft,ut,at,ot)}}function fE(b,o,g,_e,rt,ot){const at=[];for(let ut=0;ut<b.length;ut++){const ft=b[ut];let xt;const Ct=at.length;let Rt=0;for(let kt=0;kt<ft.length-1;kt++){let zt=ft[kt],Ut=ft[kt+1],Kt=0;const er=Rt;let Jt,or;ot&&(Kt=Math.hypot(Ut.x-zt.x,Ut.y-zt.y),Rt+=Kt,Jt=zt,or=Ut),zt.x<o&&Ut.x<o||(zt.x<o?zt=new _n(o,zt.y+(o-zt.x)/(Ut.x-zt.x)*(Ut.y-zt.y))._round():Ut.x<o&&(Ut=new _n(o,zt.y+(o-zt.x)/(Ut.x-zt.x)*(Ut.y-zt.y))._round()),zt.y<g&&Ut.y<g||(zt.y<g?zt=new _n(zt.x+(g-zt.y)/(Ut.y-zt.y)*(Ut.x-zt.x),g)._round():Ut.y<g&&(Ut=new _n(zt.x+(g-zt.y)/(Ut.y-zt.y)*(Ut.x-zt.x),g)._round()),zt.x>=_e&&Ut.x>=_e||(zt.x>=_e?zt=new _n(_e,zt.y+(_e-zt.x)/(Ut.x-zt.x)*(Ut.y-zt.y))._round():Ut.x>=_e&&(Ut=new _n(_e,zt.y+(_e-zt.x)/(Ut.x-zt.x)*(Ut.y-zt.y))._round()),zt.y>=rt&&Ut.y>=rt||(zt.y>=rt?zt=new _n(zt.x+(rt-zt.y)/(Ut.y-zt.y)*(Ut.x-zt.x),rt)._round():Ut.y>=rt&&(Ut=new _n(zt.x+(rt-zt.y)/(Ut.y-zt.y)*(Ut.x-zt.x),rt)._round()),xt&&zt.equals(xt[xt.length-1])||(xt=[zt],at.push(xt),ot&&ot.push({progress:{min:er+i2(Jt,or,zt)*Kt,max:1},parentIndex:ut,prevPoint:Jt,nextPoint:or})),xt.push(Ut),ot&&(ot[ot.length-1].progress.max=er+i2(Jt,or,Ut)*Kt,ot[ot.length-1].nextPoint=or)))))}if(ot&&Rt>0)for(let kt=Ct;kt<at.length;kt++)ot[kt].progress.min/=Rt,ot[kt].progress.max/=Rt}return at}function $P(b,o,g,_e,rt){if(b.length<2)return void _e.push(b);const ot=[];for(;o.valid();){const[xt,Ct]=o.get();for(let Rt=0;Rt<b.length-1;Rt++){const kt=b[Rt],zt=b[Rt+1],Ut=Us(kt,zt,xt,Ct);if(Ut){const[Kt]=Ut,er=new _n(Cs(kt.x,zt.x,Kt),Cs(kt.y,zt.y,Kt));ot.push({t:Rt+Kt,distance:0,point:er})}}o.next()}if(ot.length===0)return void _e.push(b);ot.sort((xt,Ct)=>xt.t-Ct.t);let at=0,ut=0,ft=[];for(_e.push(ft);at!==b.length;){if(ut===ot.length){for(;at!==b.length;)ft.length!==0&&ft[ft.length-1].equals(b[at])||ft.push(b[at]),at++;break}ot[ut].t<=at?(ft.length!==0&&ft[ft.length-1].equals(ot[ut].point)||ft.push(ot[ut].point),Math.trunc(ot[ut].t),ut++):(ft.length!==0&&ft[ft.length-1].equals(b[at])||ft.push(b[at]),at++)}}function i2(b,o,g){return b.x!==o.x?(g.x-b.x)/(o.x-b.x):b.y!==o.y?(g.y-b.y)/(o.y-b.y):0}function v1(b,o){return b.x*o.x+b.y*o.y}function s2(b,o){if(b.length===1){let g=0;const _e=o[g++];let rt;for(;!rt||_e.equals(rt);)if(rt=o[g++],!rt)return 1/0;for(;g<o.length;g++){const ot=o[g],at=b[0],ut=rt.sub(_e),ft=ot.sub(_e),xt=at.sub(_e),Ct=v1(ut,ut),Rt=v1(ut,ft),kt=v1(ft,ft),zt=v1(xt,ut),Ut=v1(xt,ft),Kt=Ct*kt-Rt*Rt,er=(kt*zt-Rt*Ut)/Kt,Jt=(Ct*Ut-Rt*zt)/Kt,or=_e.z*(1-er-Jt)+rt.z*er+ot.z*Jt;if(isFinite(or))return or}return 1/0}{let g=1/0;for(const _e of o)g=Math.min(g,_e.z);return g}}function o2(b,o,g){let _e=1/0;bo(g,o)&&(_e=s2(g,o[0]));for(let rt=0;rt<o.length;rt++){const ot=o[rt],at=b[rt];for(let ut=0;ut<ot.length-1;ut++){const ft=ot[ut],xt=[ft,ot[ut+1],at[ut+1],at[ut],ft];mo(g,xt)&&(_e=Math.min(_e,s2(g,xt)))}}return _e!==1/0&&_e}function a2(b,o,g,_e,rt,ot,at,ut,ft,xt,Ct){return b.projection.name==="globe"?function(Rt,kt,zt,Ut,Kt,er,Jt,or,cr,pr,Sr){const br=[],Pr=[],Dr=Rt.projection.upVectorScale(Sr,Rt.center.lat,Rt.worldSize).metersToTile,Or=[0,0,0,1],nn=[0,0,0,1],$r=(gn,yn,Sn,An)=>{gn[0]=yn,gn[1]=Sn,gn[2]=An,gn[3]=1},un=YC();zt>0&&(zt+=un),Ut+=un;for(const gn of kt){const yn=[],Sn=[];for(const An of gn){const wn=An.x+Kt.x,En=An.y+Kt.y,ln=Rt.projection.projectTilePoint(wn,En,Sr),on=Rt.projection.upVector(Sr,An.x,An.y);let Tn=zt,On=Ut;if(Jt){const kn=l2(wn,En,zt,Ut,Jt,or,cr,pr);Tn+=kn.base,On+=kn.top}zt!==0?$r(Or,ln.x+on[0]*Dr*Tn,ln.y+on[1]*Dr*Tn,ln.z+on[2]*Dr*Tn):$r(Or,ln.x,ln.y,ln.z),$r(nn,ln.x+on[0]*Dr*On,ln.y+on[1]*Dr*On,ln.z+on[2]*Dr*On),_s(Or,Or,er),_s(nn,nn,er),yn.push(new qy(Or[0],Or[1],Or[2])),Sn.push(new qy(nn[0],nn[1],nn[2]))}br.push(yn),Pr.push(Sn)}return[br,Pr]}(b,o,g,_e,rt,ot,at,ut,ft,xt,Ct):at?function(Rt,kt,zt,Ut,Kt,er,Jt,or,cr){const pr=[],Sr=[],br=[0,0,0,1];for(const Pr of Rt){const Dr=[],Or=[];for(const nn of Pr){const $r=nn.x+Ut.x,un=nn.y+Ut.y,gn=l2($r,un,kt,zt,er,Jt,or,cr);br[0]=$r,br[1]=un,br[2]=gn.base,br[3]=1,xl(br,br,Kt),br[3]=Math.max(br[3],1e-5);const yn=new qy(br[0]/br[3],br[1]/br[3],br[2]/br[3]);br[0]=$r,br[1]=un,br[2]=gn.top,br[3]=1,xl(br,br,Kt),br[3]=Math.max(br[3],1e-5);const Sn=new qy(br[0]/br[3],br[1]/br[3],br[2]/br[3]);Dr.push(yn),Or.push(Sn)}pr.push(Dr),Sr.push(Or)}return[pr,Sr]}(o,g,_e,rt,ot,at,ut,ft,xt):function(Rt,kt,zt,Ut,Kt){const er=[],Jt=[],or=Kt[8]*kt,cr=Kt[9]*kt,pr=Kt[10]*kt,Sr=Kt[11]*kt,br=Kt[8]*zt,Pr=Kt[9]*zt,Dr=Kt[10]*zt,Or=Kt[11]*zt;for(const nn of Rt){const $r=[],un=[];for(const gn of nn){const yn=gn.x+Ut.x,Sn=gn.y+Ut.y,An=Kt[0]*yn+Kt[4]*Sn+Kt[12],wn=Kt[1]*yn+Kt[5]*Sn+Kt[13],En=Kt[2]*yn+Kt[6]*Sn+Kt[14],ln=Kt[3]*yn+Kt[7]*Sn+Kt[15],on=An+or,Tn=wn+cr,On=En+pr,kn=Math.max(ln+Sr,1e-5),ls=An+br,Gn=wn+Pr,Kn=En+Dr,ts=Math.max(ln+Or,1e-5);$r.push(new qy(on/kn,Tn/kn,On/kn)),un.push(new qy(ls/ts,Gn/ts,Kn/ts))}er.push($r),Jt.push(un)}return[er,Jt]}(o,g,_e,rt,ot)}function l2(b,o,g,_e,rt,ot,at,ut){const ft=at*rt.getElevationAt(b,o,!0,!0),xt=ot[0]!==0,Ct=xt?ot[1]===0?at*(ot[0]/zC-VC):at*function(Rt,kt,zt){const Ut=Math.floor(kt[0]/8),Kt=Math.floor(kt[1]/8),er=10*(kt[0]-8*Ut),Jt=10*(kt[1]-8*Kt),or=Rt.getElevationAt(Ut,Kt,!0,!0),cr=Rt.getMeterToDEM(zt),pr=Math.floor(.5*(er*cr-1)),Sr=Math.floor(.5*(Jt*cr-1)),br=Rt.tileCoordToPixel(Ut,Kt),Pr=2*pr+1,Dr=2*Sr+1,Or=function(Sn,An,wn,En,ln){return[Sn.getElevationAtPixel(An,wn,!0),Sn.getElevationAtPixel(An+ln,wn,!0),Sn.getElevationAtPixel(An,wn+ln,!0),Sn.getElevationAtPixel(An+En,wn+ln,!0)]}(Rt,br.x-pr,br.y-Sr,Pr,Dr),nn=Math.abs(Or[0]-Or[1]),$r=Math.abs(Or[2]-Or[3]),un=Math.abs(Or[0]-Or[2])+Math.abs(Or[1]-Or[3]),gn=Math.min(.25,.5*cr*(nn+$r)/Pr),yn=Math.min(.25,.5*cr*un/Dr);return or+Math.max(gn*er,yn*Jt)}(rt,ot,ut):ft;return{base:ft+(g===0?-1:g),top:xt?Math.max(Ct+_e,ft+g+2):ft+_e}}class GP{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class HP{constructor(){this.tasks={},this.taskQueue=[],Gr(["process"],this),this.invoker=new GP(this.process),this.nextId=0}add(o,g){const _e=this.nextId++,rt=function({type:ot,isSymbolTile:at,zoom:ut}){return ut=ut||0,ot==="message"?0:ot!=="maybePrepare"||at?ot!=="parseTile"||at?ot==="parseTile"&&at?300-ut:ot==="maybePrepare"&&at?400-ut:500:200-ut:100-ut}(g);if(rt===0){try{o()}finally{}return null}return this.tasks[_e]={fn:o,metadata:g,priority:rt,id:_e},this.taskQueue.push(_e),this.invoker.trigger(),{cancel:()=>{delete this.tasks[_e]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(_e=>!!this.tasks[_e]),!this.taskQueue.length)return;const o=this.pick();if(o===null)return;const g=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!g)return;g.fn()}finally{}}pick(){let o=null,g=1/0;for(let rt=0;rt<this.taskQueue.length;rt++){const ot=this.tasks[this.taskQueue[rt]];ot.priority<g&&(g=ot.priority,o=rt)}if(o===null)return null;const _e=this.taskQueue[o];return this.taskQueue.splice(o,1),_e}remove(){this.invoker.remove()}}class c2{constructor(o,g,_e){this.target=o,this.parent=g,this.mapId=_e,this.callbacks={},this.cancelCallbacks={},Gr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new HP}send(o,g,_e,rt,ot=!1,at){const ut=Math.round(1e18*Math.random()).toString(36).substring(0,10);_e&&(_e.metadata=at,this.callbacks[ut]=_e);const ft=new Set;return this.target.postMessage({id:ut,type:o,hasCallback:!!_e,targetMapId:rt,mustQueue:ot,sourceMapId:this.mapId,data:em(g,ft)},ft),{cancel:()=>{_e&&delete this.callbacks[ut],this.target.postMessage({id:ut,type:"<cancel>",targetMapId:rt,sourceMapId:this.mapId})}}}receive(o){const g=o.data;if(!g)return;const _e=g.id;if(_e&&(!g.targetMapId||this.mapId===g.targetMapId))if(g.type==="<cancel>"){const rt=this.cancelCallbacks[_e];delete this.cancelCallbacks[_e],rt&&rt.cancel()}else if(g.mustQueue||lo(self)){const rt=this.callbacks[_e],ot=this.scheduler.add(()=>this.processTask(_e,g),rt&&rt.metadata||{type:"message"});ot&&(this.cancelCallbacks[_e]=ot)}else this.processTask(_e,g)}processTask(o,g){if(delete this.cancelCallbacks[o],g.type==="<response>"){const _e=this.callbacks[o];delete this.callbacks[o],_e&&(g.error?_e(Lm(g.error)):_e(null,Lm(g.data)))}else{const _e=new Set,rt=g.hasCallback?(at,ut)=>{this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:at?em(at):null,data:em(ut,_e)},_e)}:()=>{},ot=Lm(g.data);if(this.parent[g.type])this.parent[g.type](g.sourceMapId,ot,rt);else if(this.parent.getWorkerSource){const at=g.type.split("."),{source:ut,scope:ft}=ot;this.parent.getWorkerSource(g.sourceMapId,at[0],ut,ft)[at[1]](ot,rt)}else rt(new Error(`Could not find function ${g.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var b1={workerUrl:"",workerClass:null,workerParams:void 0};const XT="mapboxgl_preloaded_worker_pool";class Ky{constructor(o){this.active={},this.name=o}acquire(o,g=Ky.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<g;){const rt=(_e=`${this.name||""}WorkerPool: ${o}-${this.workers.length}`,b1.workerClass!=null?new b1.workerClass:new self.Worker(b1.workerUrl,Object.assign({name:_e},b1.workerParams)));this.workers.push(rt)}var _e;return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.workers&&this.numActive()===0&&(this.workers.forEach(g=>{g.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[XT]}numActive(){return Object.keys(this.active).length}}Ky.workerCount=2;class P_{constructor(o,g,_e="Worker",rt=Ky.workerCount){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=Vr();const ot=this.workerPool.acquire(this.id,rt);for(let at=0;at<ot.length;at++){const ut=new P_.Actor(ot[at],g,this.id);ut.name=`${_e} ${at}`,this.actors.push(ut)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,g,_e){Nr(this.actors,(rt,ot)=>{rt.send(o,g,ot)},_e=_e||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}let w1,ZT;function mE(){return w1||(w1=new Ky),w1}P_.Actor=c2;const YT=4096;class WP{constructor(o){this.module=o,this.memoryStack=this.module.malloc(YT),this.memoryStackNextFree=this.memoryStack}createIntArray(o){const g=this.memoryStackNextFree;return this.memoryStackNextFree+=o.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>YT?-1:(new Int32Array(this.module.heap32.buffer,g,o.length).set(o),g)}createFloatArray(o){const g=this.memoryStackNextFree;return this.memoryStackNextFree+=o.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>YT?-1:(new Float32Array(this.module.heapF32.buffer,g,o.length).set(o),g)}readStringBuffer(o){let g="";for(;this.module.heapU8[o]!==0;)g+=String.fromCharCode(this.module.heapU8[o]),++o;return g}setStyle(o){const g=o.normalScale;this.module.setStyle(g[0],g[1],g[2],o.tileToMeters)}setAOOptions(o,g){this.module.setAOOptions(o?1:0,g)}setMetricOptions(o,g){this.module.setMetricOptions(o?1:0,g)}setStructuralOptions(o){this.module.setStructuralOptions(o?1:0)}setFacadeOptions(o,g){this.module.setFacadeOptions(o,g?1:0)}setFauxFacadeOptions(o,g,_e){this.module.setFauxFacadeOptions(o?1:0,g?1:0,_e)}setFacadeClassifierOptions(o){this.module.setFacadeClassifierOptions(o)}generateMesh(o,g){this.memoryStackNextFree=this.memoryStack;for(const ut of o){const ft=this.createIntArray(ut.ringIndices),xt=this.createFloatArray(ut.coordinates);if(ft===-1||xt===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(ut.id,ut.sourceId,ut.minHeight,ut.height,ut.roofType,xt,ft,ut.ringIndices.length-1)}for(const ut of g){let ft;ft=ut.entrances?JSON.parse(ut.entrances):[];const xt=this.createFloatArray(ft),Ct=this.createFloatArray(ut.coordinates);if(xt===-1||Ct===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(ut.sourceId,ut.crossPerc,ut.distanceToRoad,xt,ft.length,Ct,ut.coordinates.length)}if(!this.module.generateMesh()){const ut=this.module.getLastError();return this.readStringBuffer(ut)}const _e=this.module.getMeshCount(),rt=new Array(_e);for(let ut=0;ut<_e;ut++){const ft=this.module.getPositionsPtr(ut),xt=this.module.getPositionsLength(ut),Ct=new Float32Array(this.module.heapF32.buffer,ft,xt),Rt=this.module.getNormalsPtr(ut),kt=this.module.getNormalsLength(ut),zt=new Float32Array(this.module.heapF32.buffer,Rt,kt),Ut=this.module.getAOPtr(ut),Kt=this.module.getAOLength(ut),er=new Float32Array(this.module.heapF32.buffer,Ut,Kt),Jt=this.module.getUVPtr(ut),or=this.module.getUVLength(ut),cr=new Float32Array(this.module.heapF32.buffer,Jt,or),pr=this.module.getFauxFacadePtr(ut),Sr=this.module.getFauxFacadeLength(ut),br=new Uint8Array(this.module.heapU8.buffer,pr,Sr),Pr=this.module.getIndicesPtr(ut),Dr=this.module.getIndicesLength(ut),Or=new Int16Array(this.module.heap16.buffer,Pr,Dr),nn=this.module.getBuildingPart(ut);rt[ut]={positions:Ct,normals:zt,ao:er,uv:cr,isFauxFacade:br,indices:Or,buildingPart:nn}}const ot=this.module.getRingCount(),at=[];for(let ut=0;ut<ot;ut++){const ft=this.module.getRingPtr(ut),xt=this.module.getRingLength(ut),Ct=new Float32Array(this.module.heapF32.buffer,ft,xt);at.push(Ct)}return{meshes:rt,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:at}}}let E1,QT,pm,I_,JT,k_=null,M_=null,u2=null,gE=null;function h2(){return lo(self)&&self.worker.dracoUrl?self.worker.dracoUrl:QT||eo.DRACO_URL}function d2(){if(lo(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(I_)return I_;const b=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return I_=WebAssembly.validate(b)?eo.MESHOPT_SIMD_URL:eo.MESHOPT_URL,I_}function qP(){return gE}const yE={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},KP={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},T1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function p2(b,o,g){const _e=g.json.bufferViews.length,rt=g.buffers.length;o.bufferView=_e,g.json.bufferViews[_e]={buffer:rt,byteLength:b.byteLength},g.buffers[rt]=b}const eS="KHR_draco_mesh_compression";function XP(b,o){const g=b.extensions&&b.extensions[eS];if(!g)return;const _e=new pm.Decoder,rt=y2(o,g.bufferView),ot=new pm.Mesh;if(!_e.DecodeArrayToMesh(rt,rt.byteLength,ot))throw new Error("Failed to decode Draco mesh");const at=o.json.accessors[b.indices],ut=yE[at.componentType],ft=at.count*ut.BYTES_PER_ELEMENT,xt=pm._malloc(ft);ut===Uint16Array?_e.GetTrianglesUInt16Array(ot,ft,xt):_e.GetTrianglesUInt32Array(ot,ft,xt),p2(pm.memory.buffer.slice(xt,xt+ft),at,o),pm._free(xt);for(const Ct of Object.keys(g.attributes)){const Rt=_e.GetAttributeByUniqueId(ot,g.attributes[Ct]),kt=o.json.accessors[b.attributes[Ct]],zt=KP[kt.componentType],Ut=kt.count*T1[kt.type]*yE[kt.componentType].BYTES_PER_ELEMENT,Kt=pm._malloc(Ut);_e.GetAttributeDataArrayForAllPoints(ot,Rt,pm[zt],Ut,Kt),p2(pm.memory.buffer.slice(Kt,Kt+Ut),kt,o),pm._free(Kt)}_e.destroy(),ot.destroy(),delete b.extensions[eS]}const xE="EXT_meshopt_compression";function ZP(b,o){if(!b.extensions||!b.extensions[xE])return;const g=b.extensions[xE],_e=new Uint8Array(o.buffers[g.buffer],g.byteOffset||0,g.byteLength||0),rt=new Uint8Array(g.count*g.byteStride);JT.decodeGltfBuffer(rt,g.count,g.byteStride,_e,g.mode,g.filter),b.buffer=o.buffers.length,b.byteOffset=0,o.buffers[b.buffer]=rt.buffer,delete b.extensions[xE]}const f2=1179937895,m2=new TextDecoder("utf8");function g2(b,o){return new URL(b,o).href}function YP(b,o,g,_e){return fetch(g2(b.uri,_e)).then(rt=>rt.arrayBuffer()).then(rt=>{o.buffers[g]=rt})}function y2(b,o){const g=b.json.bufferViews[o];return new Uint8Array(b.buffers[g.buffer],g.byteOffset||0,g.byteLength)}function QP(b,o,g,_e){if(b.uri){const rt=g2(b.uri,_e);return fetch(rt).then(ot=>ot.blob()).then(ot=>createImageBitmap(ot)).then(ot=>{o.images[g]=ot})}if(b.bufferView!==void 0){const rt=y2(o,b.bufferView),ot=new Blob([rt],{type:b.mimeType});return createImageBitmap(ot).then(at=>{o.images[g]=at})}}function x2(b,o=0,g){const _e={json:null,images:[],buffers:[]};if(new Uint32Array(b,o,1)[0]===f2){const Ct=new Uint32Array(b,o);let Rt=2;const kt=(Ct[Rt++]>>2)-3,zt=Ct[Rt++]>>2;if(Rt++,_e.json=JSON.parse(m2.decode(Ct.subarray(Rt,Rt+zt))),Rt+=zt,Rt<kt){const Ut=Ct[Rt++];Rt++;const Kt=o+(Rt<<2);_e.buffers[0]=b.slice(Kt,Kt+Ut)}}else _e.json=JSON.parse(m2.decode(new Uint8Array(b,o)));const{buffers:rt,images:ot,meshes:at,extensionsUsed:ut,bufferViews:ft}=_e.json;let xt=Promise.resolve();if(rt){const Ct=[];for(let Rt=0;Rt<rt.length;Rt++){const kt=rt[Rt];kt.uri?Ct.push(YP(kt,_e,Rt,g)):_e.buffers[Rt]||(_e.buffers[Rt]=null)}xt=Promise.all(Ct)}return xt.then(()=>{const Ct=[],Rt=ut&&ut.includes(eS),kt=ut&&ut.includes(xE);if(Rt&&Ct.push(function(){if(!pm)return E1??(E1=function(zt){let Ut,Kt=null;function er(){Ut=new Uint8Array(Kt.buffer)}function Jt(){throw new Error("Unexpected Draco error.")}const or={a:{a:Jt,d:function(cr,pr,Sr){return Ut.copyWithin(cr,pr,pr+Sr)},c:function(cr){const pr=Ut.length,Sr=Math.max(cr>>>0,Math.ceil(1.2*pr)),br=Math.ceil((Sr-pr)/65536);try{return Kt.grow(br),er(),!0}catch{return!1}},b:Jt}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(zt,or):zt.then(cr=>cr.arrayBuffer()).then(cr=>WebAssembly.instantiate(cr,or))).then(cr=>{const{Rb:pr,Qb:Sr,P:br,T:Pr,X:Dr,Ja:Or,La:nn,Qa:$r,Va:un,Wa:gn,eb:yn,jb:Sn,f:An,e:wn,yb:En,zb:ln,Ab:on,Bb:Tn,Db:On,Gb:kn}=cr.instance.exports;Kt=wn;const ls=(()=>{let Gn=0,Kn=0,ts=0,qs=0;return Dn=>{ts&&(pr(qs),pr(Gn),Kn+=ts,ts=Gn=0),Gn||(Kn+=128,Gn=Sr(Kn));const rs=Dn.length+7&-8;let Ms=Gn;rs>=Kn&&(ts=rs,Ms=qs=Sr(rs));for(let ro=0;ro<Dn.length;ro++)Ut[Ms+ro]=Dn[ro];return Ms}})();return er(),An(),{memory:wn,_free:pr,_malloc:Sr,Mesh:class{constructor(){this.ptr=br()}destroy(){Pr(this.ptr)}},Decoder:class{constructor(){this.ptr=Or()}destroy(){Sn(this.ptr)}DecodeArrayToMesh(Gn,Kn,ts){const qs=ls(Gn),Dn=nn(this.ptr,qs,Kn,ts.ptr);return!!Dr(Dn)}GetAttributeByUniqueId(Gn,Kn){return{ptr:$r(this.ptr,Gn.ptr,Kn)}}GetTrianglesUInt16Array(Gn,Kn,ts){un(this.ptr,Gn.ptr,Kn,ts)}GetTrianglesUInt32Array(Gn,Kn,ts){gn(this.ptr,Gn.ptr,Kn,ts)}GetAttributeDataArrayForAllPoints(Gn,Kn,ts,qs,Dn){yn(this.ptr,Gn.ptr,Kn.ptr,ts,qs,Dn)}},DT_INT8:En(),DT_UINT8:ln(),DT_INT16:on(),DT_UINT16:Tn(),DT_UINT32:On(),DT_FLOAT32:kn()}})}(fetch(h2())),E1.then(zt=>{pm=zt,E1=void 0}))}()),kt&&Ct.push(function(){if(JT)return;const zt=function(Ut){let Kt;const er=WebAssembly.instantiateStreaming(Ut,{}).then(cr=>{Kt=cr.instance,Kt.exports.__wasm_call_ctors()}),Jt={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},or={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:er,supported:!0,decodeGltfBuffer(cr,pr,Sr,br,Pr,Dr){(function(Or,nn,$r,un,gn,yn,Sn){const An=Or.exports.sbrk,wn=un+3&-4,En=An(wn*gn),ln=An(yn.length),on=new Uint8Array(Or.exports.memory.buffer);on.set(yn,ln);const Tn=nn(En,un,gn,ln,yn.length);if(Tn===0&&Sn&&Sn(En,wn,gn),$r.set(on.subarray(En,En+un*gn)),An(En-An(0)),Tn!==0)throw new Error(`Malformed buffer data: ${Tn}`)})(Kt,Kt.exports[or[Pr]],cr,pr,Sr,br,Kt.exports[Jt[Dr]])}}}(fetch(d2()));return zt.ready.then(()=>{JT=zt})}()),ot)for(let zt=0;zt<ot.length;zt++)Ct.push(QP(ot[zt],_e,zt,g));return(Ct.length?Promise.all(Ct):Promise.resolve()).then(()=>{if(Rt&&at)for(const{primitives:zt}of at)for(const Ut of zt)XP(Ut,_e);if(kt&&at&&ft)for(const zt of ft)ZP(zt,_e);return _e})})}function _2(b){return fetch(b).then(o=>o.arrayBuffer()).then(o=>x2(o,0,b))}function tS(b){switch(b){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function rS(b){switch(b){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class nS{constructor(o,g,_e,rt){this.context=o,this.format=_e,this.useMipmap=rt&&rt.useMipmap,this.texture=o.gl.createTexture(),this.update(g,{premultiply:rt&&rt.premultiply})}update(o,g){const _e=o&&o instanceof HTMLVideoElement&&o.width===0?o.videoWidth:o.width,rt=o&&o instanceof HTMLVideoElement&&o.height===0?o.videoHeight:o.height,{context:ot}=this,{gl:at}=ot,{x:ut,y:ft}=g&&g.position?g.position:{x:0,y:0},xt=ut+_e,Ct=ft+rt;!this.size||this.size[0]===xt&&this.size[1]===Ct||(at.bindTexture(at.TEXTURE_2D,null),at.deleteTexture(this.texture),this.texture=at.createTexture(),this.size=null),at.bindTexture(at.TEXTURE_2D,this.texture),ot.pixelStoreUnpackFlipY.set(!1),ot.pixelStoreUnpack.set(1),ot.pixelStoreUnpackPremultiplyAlpha.set(this.format===at.RGBA8&&(!g||g.premultiply!==!1));const Rt=o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||ImageBitmap&&o instanceof ImageBitmap;if(!this.size&&xt>0&&Ct>0){const kt=this.useMipmap?Math.floor(Math.log2(Math.max(xt,Ct)))+1:1;at.texStorage2D(at.TEXTURE_2D,kt,this.format,xt,Ct),this.size=[xt,Ct]}this.size&&(Rt?at.texSubImage2D(at.TEXTURE_2D,0,ut,ft,tS(this.format),rS(this.format),o):"data"in o&&o.data&&at.texSubImage2D(at.TEXTURE_2D,0,ut,ft,_e,rt,tS(this.format),rS(this.format),o.data)),this.useMipmap&&at.generateMipmap(at.TEXTURE_2D)}bind(o,g,_e=!1){const{context:rt}=this,{gl:ot}=rt;ot.bindTexture(ot.TEXTURE_2D,this.texture),o!==this.minFilter&&(ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_MAG_FILTER,o),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_MIN_FILTER,this.useMipmap&&!_e?o===ot.NEAREST?ot.NEAREST_MIPMAP_NEAREST:ot.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),g!==this.wrapS&&(ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_WRAP_S,g),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_WRAP_T,g),this.wrapS=g)}bindExtraParam(o,g,_e,rt,ot){const{context:at}=this,{gl:ut}=at;ut.bindTexture(ut.TEXTURE_2D,this.texture),g!==this.magFilter&&(ut.texParameteri(ut.TEXTURE_2D,ut.TEXTURE_MAG_FILTER,g),this.magFilter=g),o!==this.minFilter&&(ut.texParameteri(ut.TEXTURE_2D,ut.TEXTURE_MIN_FILTER,this.useMipmap?o===ut.NEAREST?ut.NEAREST_MIPMAP_NEAREST:ut.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),_e!==this.wrapS&&(ut.texParameteri(ut.TEXTURE_2D,ut.TEXTURE_WRAP_S,_e),this.wrapS=_e),rt!==this.wrapT&&(ut.texParameteri(ut.TEXTURE_2D,ut.TEXTURE_WRAP_T,rt),this.wrapT=rt),ot!==this.compareMode&&(ot?(ut.texParameteri(ut.TEXTURE_2D,ut.TEXTURE_COMPARE_MODE,ut.COMPARE_REF_TO_TEXTURE),ut.texParameteri(ut.TEXTURE_2D,ut.TEXTURE_COMPARE_FUNC,ot)):ut.texParameteri(ut.TEXTURE_2D,ut.TEXTURE_COMPARE_MODE,ut.NONE),this.compareMode=ot)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class S1{constructor(o,g){this.context=o,this.texture=g}bind(o,g){const{context:_e}=this,{gl:rt}=_e;rt.bindTexture(rt.TEXTURE_2D,this.texture),o!==this.minFilter&&(rt.texParameteri(rt.TEXTURE_2D,rt.TEXTURE_MAG_FILTER,o),rt.texParameteri(rt.TEXTURE_2D,rt.TEXTURE_MIN_FILTER,o),this.minFilter=o),g!==this.wrapS&&(rt.texParameteri(rt.TEXTURE_2D,rt.TEXTURE_WRAP_S,g),rt.texParameteri(rt.TEXTURE_2D,rt.TEXTURE_WRAP_T,g),this.wrapS=g)}}const JP=Ys([{name:"a_pos_3f",components:3,type:"Float32"}]),eI=Ys([{name:"a_color_3f",components:3,type:"Float32"}]),tI=Ys([{name:"a_color_4f",components:4,type:"Float32"}]),rI=Ys([{name:"a_uv_2f",components:2,type:"Float32"}]),nI=Ys([{name:"a_normal_3f",components:3,type:"Float32"}]),iI=Ys([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),sI=Ys([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function v2(b,o){const g=_E(b.projection,b.zoom,b.width,b.height),_e=function(ot,at,ut,ft,xt){const Ct=new $(ut.lng-180*X0,ut.lat),Rt=new $(ut.lng+180*X0,ut.lat),kt=ot.project(Ct.lng,Ct.lat),zt=ot.project(Rt.lng,Rt.lat),Ut=-Math.atan2(zt.y-kt.y,zt.x-kt.x),Kt=hr.fromLngLat(ut);Kt.y=tr(Kt.y,-1+X0,1-X0);const er=Kt.toLngLat(),Jt=ot.project(er.lng,er.lat),or=hr.fromLngLat(er);or.x+=X0;const cr=or.toLngLat(),pr=ot.project(cr.lng,cr.lat),Sr=w2(pr.x-Jt.x,pr.y-Jt.y,Ut),br=hr.fromLngLat(er);br.y+=X0;const Pr=br.toLngLat(),Dr=ot.project(Pr.lng,Pr.lat),Or=w2(Dr.x-Jt.x,Dr.y-Jt.y,Ut),nn=Math.abs(Sr.x)/Math.abs(Or.y),$r=$t([]);ar($r,$r,-Ut*(1-(xt?0:ft)));const un=$t([]);return Vt(un,un,[1,1-(1-nn)*ft,1]),un[4]=-Or.x/Or.y*ft,ar(un,un,Ut),Bt(un,$r,un),un}(b.projection,0,b.center,g,o),rt=b2(b);return Vt(_e,_e,[rt,rt,1]),_e}function b2(b){const o=b.projection,g=_E(b.projection,b.zoom,b.width,b.height),_e=iS(o,b.center),rt=iS(o,$.convert(o.center));return Math.pow(2,_e*g+(1-g)*rt)}function _E(b,o,g,_e,rt=1/0){const ot=b.range;if(!ot)return 0;const at=Math.min(rt,Math.max(g,_e)),ut=Math.log2(at/1024);return lr(ot[0]+ut,ot[1]+ut,o)}const X0=1/4e4;function iS(b,o){const g=tr(o.lat,-qt,qt),_e=new $(o.lng-180*X0,g),rt=new $(o.lng+180*X0,g),ot=b.project(_e.lng,g),at=b.project(rt.lng,g),ut=hr.fromLngLat(_e),ft=hr.fromLngLat(rt),xt=at.x-ot.x,Ct=at.y-ot.y,Rt=ft.x-ut.x,kt=ft.y-ut.y,zt=Math.sqrt((Rt*Rt+kt*kt)/(xt*xt+Ct*Ct));return Math.log2(zt)}function w2(b,o,g){const _e=Math.cos(g),rt=Math.sin(g);return{x:b*_e-o*rt,y:b*rt+o*_e}}function E2(b,o,g){$t(b),ar(b,b,Xs(o[2])),Xt(b,b,Xs(o[0])),nr(b,b,Xs(o[1])),Vt(b,b,g),Bt(b,b,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function vE(b,o,g,_e,rt,ot,at,ut){const ft=[g[0]-o[0],g[1]-o[1],0],xt=[_e[0]-o[0],_e[1]-o[1],0];if(en(ft)<1e-12||en(xt)<1e-12)return xn(b);const Ct=ys([],ft,xt);ds(Ct,Ct),ur(xt,_e,o),ft[2]=(ot-rt)*ut,xt[2]=(at-rt)*ut;const Rt=ft;return ys(Rt,ft,xt),ds(Rt,Rt),Xn(b,Ct,Rt)}function bE(b,o,g=!1){const _e=q0(o.zoom),rt=function(ot,at,ut){const ft=at.worldSize,xt=[ot[12],ot[13],ot[14]],Ct=Ht(xt[1]/ft),Rt=Dt(xt[0]/ft),kt=$t([]),zt=It(1,Ct)*ft,Ut=It(1,0)*ft*Zt(Ct,at.zoom),Kt=1/DT(ft);let er=Ut*Kt;if(ut){const pr=_E(at.projection,at.zoom,at.width,at.height,1024);er=Kt*at.projection.pixelSpaceConversion(at.center.lat,ft,pr)}const Jt=G0(Ct,Rt);rr(Jt,Jt,tn([],ds([],Jt),zt*er*xt[2]));const or=function(pr){const Sr=[pr[0],pr[1],pr[2]];let br=[0,1,0];const Pr=ys([],br,Sr);return ys(br,Sr,Pr),ss(br)===0&&(br=[0,1,0],ys(Pr,Sr,br)),ds(Pr,Pr),ds(br,br),ds(Sr,Sr),[Pr[0],Pr[1],Pr[2],0,br[0],br[1],br[2],0,Sr[0],Sr[1],Sr[2],0,pr[0],pr[1],pr[2],1]}(Jt);Vt(kt,kt,[er,er,er*zt]),Nt(kt,kt,[-xt[0],-xt[1],-xt[2]]);const cr=Bt([],at.globeMatrix,or);return Bt(cr,cr,kt),Bt(cr,cr,ot),cr}(b,o,g);if(_e>0){const ot=function(at,ut){const ft=ut.worldSize,xt=It(1,0)*ft*Zt(ut.center.lat,ut.zoom)/DT(ft),Ct=It(1,ut.center.lat)*ft,Rt=$t([]);nr(Rt,Rt,Xs(ut.center.lng)),Xt(Rt,Rt,Xs(ut.center.lat)),Nt(Rt,Rt,[0,0,Ru]),Vt(Rt,Rt,[xt,xt,xt*Ct]);const kt=ut.point;return Nt(Rt,Rt,[-kt.x,-kt.y,0]),Bt(Rt,Rt,at),Bt(Rt,ut.globeMatrix,Rt)}(b,o);return function(at,ut,ft){const xt=(Ut,Kt,er)=>{const Jt=en(Ut),or=en(Kt),cr=dm(Ut,Kt,er);return tn(cr,cr,1/en(cr)*Cs(Jt,or,er))},Ct=xt([at[0],at[1],at[2]],[ut[0],ut[1],ut[2]],ft),Rt=xt([at[4],at[5],at[6]],[ut[4],ut[5],ut[6]],ft),kt=xt([at[8],at[9],at[10]],[ut[8],ut[9],ut[10]],ft),zt=dm([at[12],at[13],at[14]],[ut[12],ut[13],ut[14]],ft);return[Ct[0],Ct[1],Ct[2],0,Rt[0],Rt[1],Rt[2],0,kt[0],kt[1],kt[2],0,zt[0],zt[1],zt[2],1]}(rt,ot,_e)}return rt}function sS(b,o,g,_e){const rt=is.projectAabbCorners(_e,g);let ot=Number.MAX_VALUE;for(let ut=0;ut<rt.length;++ut){const ft=rt[ut];ft[0]=(.5*ft[0]+.5)*o.width,ft[1]=(.5-.5*ft[1])*o.height,ft[2]<ot&&(ot=ft[2])}const at=function(ut){const ft=[];let xt=0;for(let zt=1;zt<ut.length;zt++)(ut[zt][0]<ut[xt][0]||ut[zt][0]===ut[xt][0]&&ut[zt][1]<ut[xt][1])&&(xt=zt);let Ct,Rt=xt;const kt=new Uint8Array(ut.length);do{if(kt[Rt])break;ft.push(new _n(ut[Rt][0],ut[Rt][1])),kt[Rt]=1,Ct=(Rt+1)%ut.length;for(let zt=0;zt<ut.length;zt++){if(ut[zt][0]===ut[Ct][0]&&ut[zt][1]===ut[Ct][1]||ut[zt][0]===ut[Rt][0]&&ut[zt][1]===ut[Rt][1])continue;const Ut=[ut[zt][0]-ut[Rt][0],ut[zt][1]-ut[Rt][1]],Kt=[ut[Ct][0]-ut[Rt][0],ut[Ct][1]-ut[Rt][1]],er=Ut[0]*Kt[1]-Ut[1]*Kt[0];(er>0||er===0&&Ut[0]*Kt[0]+Ut[1]*Kt[1]>=0&&Ut[0]*Ut[0]+Ut[1]*Ut[1]>Kt[0]*Kt[0]+Kt[1]*Kt[1])&&(Ct=zt)}Rt=Ct}while(Rt!==xt);return ft.length>0&&ft.push(ft[0]),ft}(rt);if(mo(b,at))return ot}const Xy=64,D_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function wE(b,o,g,_e,rt,ot,at,ut,ft,xt=!1){const Ct=g.zoom,Rt=g.project(_e),kt=Zt(_e.lat,Ct),zt=1/kt;$t(b),Nt(b,b,[Rt.x+at[0]*zt,Rt.y+at[1]*zt,at[2]]);let Ut=1,Kt=1;const er=g.worldSize;if(xt){if(g.projection.name==="mercator"){let pr=0;g.elevation&&(pr=g.elevation.getAtPointOrZero(new hr(Rt.x/er,Rt.y/er),0));const Sr=xl([],[Rt.x,Rt.y,pr,1],g.projMatrix)[3]/g.cameraToCenterDistance;Ut=Sr,Kt=Sr*Zt(g.center.lat,Ct)}else if(g.projection.name==="globe"){const pr=bE(b,g),Sr=[0,0,0,1];xl(Sr,Sr,Bt([],g.projMatrix,pr));const br=Sr[3]/g.cameraToCenterDistance,Pr=q0(Ct),Dr=g.projection.pixelsPerMeter(_e.lat,er)*Zt(_e.lat,Ct),Or=g.projection.pixelsPerMeter(g.center.lat,er)*Zt(g.center.lat,Ct);Ut=br/Cs(Dr,Qt(g.center.lat),Pr),Kt=br*kt/Dr,Ut*=Or,Kt*=Or}}else Ut=zt;Vt(b,b,[Ut,Ut,Kt]);const Jt=[...b],or=o.orientation,cr=[];if(E2(cr,[or[0]+(rt?rt[0]:0),or[1]+(rt?rt[1]:0),or[2]+(rt?rt[2]:0)],ot),Bt(b,Jt,cr),ut&&g.elevation){let pr=0;const Sr=[];if(ft&&g.elevation){pr=function(Pr,Dr,Or,nn,$r){const un=Dr.elevation;if(!un)return 0;const gn=is.projectAabbCorners(Or,nn),yn=It(1,$r.lat)*Dr.worldSize,Sn=function(Kn,ts){const qs=[0,0,1],Dn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const rs of Dn){const Ms=Kn[rs.corners[0]],ro=Kn[rs.corners[1]],so=Kn[rs.corners[2]],Os=[ro[0]-Ms[0],ro[1]-Ms[1],ts*(ro[2]-Ms[2])],No=ys(Os,Os,[so[0]-Ms[0],so[1]-Ms[1],ts*(so[2]-Ms[2])]);ds(No,No),rs.dotProductWithUp=gs(No,qs)}return Dn.sort((rs,Ms)=>rs.dotProductWithUp-Ms.dotProductWithUp),Dn[0].corners}(gn,yn),An=gn[Sn[0]],wn=gn[Sn[1]],En=gn[Sn[2]],ln=gn[Sn[3]],on=un.getAtPointOrZero(new hr(An[0]/Dr.worldSize,An[1]/Dr.worldSize),0),Tn=un.getAtPointOrZero(new hr(wn[0]/Dr.worldSize,wn[1]/Dr.worldSize),0),On=un.getAtPointOrZero(new hr(En[0]/Dr.worldSize,En[1]/Dr.worldSize),0),kn=un.getAtPointOrZero(new hr(ln[0]/Dr.worldSize,ln[1]/Dr.worldSize),0),ls=(on+kn)/2,Gn=(Tn+On)/2;return ls>Gn?Tn<On?vE(Pr,wn,ln,An,Tn,kn,on,yn):vE(Pr,En,An,ln,On,on,kn,yn):on<kn?vE(Pr,An,wn,En,on,Tn,On,yn):vE(Pr,ln,En,wn,kn,On,Tn,yn),Math.max(ls,Gn)}(Sr,g,o.aabb,b,_e);const br=Bt([],fn([],Sr),cr);Bt(b,Jt,br)}else pr=g.elevation.getAtPointOrZero(new hr(Rt.x/er,Rt.y/er),0);pr!==0&&(b[14]+=pr)}}class T2{constructor(o,g,_e,rt,ot){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=o,this.uri=g,this.position=_e!=null?new $(_e[0],_e[1]):new $(0,0),this.orientation=rt??[0,0,0],this.nodes=ot,this.uploaded=!1,this.aabb=new is([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(o,g){Bt(o.globalMatrix,g,o.localMatrix);const _e=this.nodeOverrides.get(o.name);if(_e!==void 0){const at=[];ot=_e.orientation,$t(rt=at),nr(rt,rt,Xs(ot[1])),ar(rt,rt,Xs(ot[2])),Xt(rt,rt,Xs(ot[0])),Bt(o.globalMatrix,o.globalMatrix,at)}var rt,ot;if(o.meshes)for(const at of o.meshes){const ut=is.applyTransformFast(at.aabb,o.globalMatrix);this.aabb.encapsulate(ut)}if(o.children)for(const at of o.children)this._applyTransformations(at,o.globalMatrix)}computeBoundsAndApplyParent(){const o=$t([]);this.aabb=new is([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const g of this.nodes)this._applyTransformations(g,o)}computeModelMatrix(o,g,_e,rt,ot,at,ut=!1){wE(this.matrix,this,o.transform,this.position,g,_e,rt,ot,at,ut)}upload(o){if(!this.uploaded){for(const g of this.nodes)oS(g,o);for(const g of this.nodes)EE(g);this.uploaded=!0}}destroy(){for(const o of this.nodes)aS(o)}}function C1(b,o,g=!1){b.uploaded||(b.gfxTexture=new nS(o,b.image,g?o.gl.R8:o.gl.RGBA8,{useMipmap:b.sampler.minFilter>=o.gl.NEAREST_MIPMAP_NEAREST}),b.uploaded=!0,b.image=null)}function oI(b,o,g){b.indexBuffer=o.createIndexBuffer(b.indexArray,!1,!0),b.vertexBuffer=o.createVertexBuffer(b.vertexArray,JP.members,!1,!0),b.normalArray&&(b.normalBuffer=o.createVertexBuffer(b.normalArray,nI.members,!1,!0)),b.texcoordArray&&(b.texcoordBuffer=o.createVertexBuffer(b.texcoordArray,rI.members,!1,!0)),b.colorArray&&(b.colorBuffer=o.createVertexBuffer(b.colorArray,(b.colorArray.bytesPerElement===12?eI:tI).members,!1,!0)),b.featureArray&&(b.pbrBuffer=o.createVertexBuffer(b.featureArray,sI.members,!0)),b.segments=_l.simpleSegment(0,0,b.vertexArray.length,b.indexArray.length);const _e=b.material;_e.pbrMetallicRoughness.baseColorTexture&&C1(_e.pbrMetallicRoughness.baseColorTexture,o),_e.pbrMetallicRoughness.metallicRoughnessTexture&&C1(_e.pbrMetallicRoughness.metallicRoughnessTexture,o),_e.normalTexture&&C1(_e.normalTexture,o),_e.occlusionTexture&&C1(_e.occlusionTexture,o,g),_e.emissionTexture&&C1(_e.emissionTexture,o)}function oS(b,o,g){if(b.meshes)for(const _e of b.meshes)oI(_e,o,g);if(b.children)for(const _e of b.children)oS(_e,o,g)}function EE(b){if(b.meshes)for(const o of b.meshes)o.indexArray.destroy(),o.vertexArray.destroy(),o.colorArray&&o.colorArray.destroy(),o.normalArray&&o.normalArray.destroy(),o.texcoordArray&&o.texcoordArray.destroy(),o.featureArray&&o.featureArray.destroy();if(b.children)for(const o of b.children)EE(o)}function aS(b){if(b.meshes)for(const g of b.meshes)g.vertexBuffer&&(g.vertexBuffer.destroy(),g.indexBuffer.destroy(),g.normalBuffer&&g.normalBuffer.destroy(),g.texcoordBuffer&&g.texcoordBuffer.destroy(),g.colorBuffer&&g.colorBuffer.destroy(),g.pbrBuffer&&g.pbrBuffer.destroy(),g.segments.destroy(),g.material&&((o=g.material).pbrMetallicRoughness.baseColorTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),o.pbrMetallicRoughness.metallicRoughnessTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),o.normalTexture&&o.normalTexture.gfxTexture&&o.normalTexture.gfxTexture.destroy(),o.emissionTexture&&o.emissionTexture.gfxTexture&&o.emissionTexture.gfxTexture.destroy(),o.occlusionTexture&&o.occlusionTexture.gfxTexture&&o.occlusionTexture.gfxTexture.destroy()));var o;if(b.children)for(const g of b.children)aS(g)}function Zy(b,o){const g=b.json.bufferViews[o.bufferView],_e=yE[o.componentType];return new _e(b.buffers[g.buffer],(o.byteOffset||0)+(g.byteOffset||0),o.count*(g.byteStride&&g.byteStride!==T1[o.type]*_e.BYTES_PER_ELEMENT?g.byteStride/_e.BYTES_PER_ELEMENT:T1[o.type]))}function lS(b,o,g,_e){const rt=yE[o.componentType],ot=function(Ct){switch(Ct){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(rt),at=b.json.bufferViews[o.bufferView],ut=at.byteStride?at.byteStride/rt.BYTES_PER_ELEMENT:T1[o.type],ft=g.float32,xt=ft.length/g.capacity;for(let Ct=0,Rt=0;Ct<o.count*ut;Ct+=ut,Rt+=xt)for(let kt=0;kt<xt;kt++)ft[Rt+kt]=_e[Ct+kt]*ot;g._trim()}function aI(b,o,g){const _e=b.indices,rt=b.attributes,ot={};ot.indexArray=new tu;const at=o.json.accessors[_e],ut=at.count/3;ot.indexArray.reserve(ut);const ft=Zy(o,at);for(let kt=0;kt<ut;kt++)ot.indexArray.emplaceBack(ft[3*kt],ft[3*kt+1],ft[3*kt+2]);ot.indexArray._trim(),ot.vertexArray=new tp;const xt=o.json.accessors[rt.POSITION];ot.vertexArray.reserve(xt.count);const Ct=Zy(o,xt);for(let kt=0;kt<xt.count;kt++)ot.vertexArray.emplaceBack(Ct[3*kt],Ct[3*kt+1],Ct[3*kt+2]);if(ot.vertexArray._trim(),ot.aabb=new is(xt.min,xt.max),ot.centroid=function(kt,zt){const Ut=[0,0,0],Kt=kt.length;if(Kt>0){for(let er=0;er<Kt;er++){const Jt=3*kt[er];Ut[0]+=zt[Jt],Ut[1]+=zt[Jt+1],Ut[2]+=zt[Jt+2]}Ut[0]/=Kt,Ut[1]/=Kt,Ut[2]/=Kt}return Ut}(ft,Ct),rt.COLOR_0!==void 0){const kt=o.json.accessors[rt.COLOR_0],zt=T1[kt.type],Ut=Zy(o,kt);ot.colorArray=zt===3?new tp:new Om,ot.colorArray.resize(kt.count),lS(o,kt,ot.colorArray,Ut)}if(rt.NORMAL!==void 0){ot.normalArray=new tp;const kt=o.json.accessors[rt.NORMAL];ot.normalArray.resize(kt.count);const zt=Zy(o,kt);lS(o,kt,ot.normalArray,zt)}if(rt.TEXCOORD_0!==void 0&&g.length>0){ot.texcoordArray=new Gp;const kt=o.json.accessors[rt.TEXCOORD_0];ot.texcoordArray.resize(kt.count);const zt=Zy(o,kt);lS(o,kt,ot.texcoordArray,zt)}if(rt._FEATURE_ID_RGBA4444!==void 0){const kt=o.json.accessors[rt._FEATURE_ID_RGBA4444];o.json.extensionsUsed&&o.json.extensionsUsed.includes("EXT_meshopt_compression")&&(ot.featureData=Zy(o,kt))}rt._FEATURE_RGBA4444!==void 0&&(ot.featureData=new Uint32Array(Zy(o,o.json.accessors[rt._FEATURE_RGBA4444]).buffer));const Rt=b.material;return ot.material=function(kt,zt){const{emissiveFactor:Ut=[0,0,0],alphaMode:Kt="OPAQUE",alphaCutoff:er=.5,normalTexture:Jt,occlusionTexture:or,emissiveTexture:cr,doubleSided:pr,name:Sr}=kt,{baseColorFactor:br=[1,1,1,1],metallicFactor:Pr=1,roughnessFactor:Dr=1,baseColorTexture:Or,metallicRoughnessTexture:nn}=kt.pbrMetallicRoughness||{},$r=or?zt[or.index]:void 0;if(or&&or.extensions&&or.extensions.KHR_texture_transform&&$r){const un=or.extensions.KHR_texture_transform;$r.offsetScale=[un.offset[0],un.offset[1],un.scale[0],un.scale[1]]}return{name:Sr,pbrMetallicRoughness:{baseColorFactor:new Ro(...br),metallicFactor:Pr,roughnessFactor:Dr,baseColorTexture:Or?zt[Or.index]:void 0,metallicRoughnessTexture:nn?zt[nn.index]:void 0},doubleSided:pr,emissiveFactor:new Ro(...Ut),alphaMode:Kt,alphaCutoff:er,normalTexture:Jt?zt[Jt.index]:void 0,occlusionTexture:$r,emissionTexture:cr?zt[cr.index]:void 0,defined:kt.defined===void 0}}(Rt!==void 0?o.json.materials[Rt]:{defined:!1},g),ot}function S2(b,o,g){const{matrix:_e,rotation:rt,translation:ot,scale:at,mesh:ut,extras:ft,children:xt,name:Ct}=b,Rt={};if(Rt.name=Ct,Rt.localMatrix=_e||function(kt,zt,Ut,Kt){var er=zt[0],Jt=zt[1],or=zt[2],cr=zt[3],pr=er+er,Sr=Jt+Jt,br=or+or,Pr=er*pr,Dr=er*Sr,Or=er*br,nn=Jt*Sr,$r=Jt*br,un=or*br,gn=cr*pr,yn=cr*Sr,Sn=cr*br,An=Kt[0],wn=Kt[1],En=Kt[2];return kt[0]=(1-(nn+un))*An,kt[1]=(Dr+Sn)*An,kt[2]=(Or-yn)*An,kt[3]=0,kt[4]=(Dr-Sn)*wn,kt[5]=(1-(Pr+un))*wn,kt[6]=($r+gn)*wn,kt[7]=0,kt[8]=(Or+yn)*En,kt[9]=($r-gn)*En,kt[10]=(1-(Pr+nn))*En,kt[11]=0,kt[12]=Ut[0],kt[13]=Ut[1],kt[14]=Ut[2],kt[15]=1,kt}([],rt||[0,0,0,1],ot||[0,0,0],at||[1,1,1]),Rt.globalMatrix=Pt(Rt.localMatrix),ut!==void 0){Rt.meshes=g[ut];const kt=Rt.anchor=[0,0];for(const zt of Rt.meshes){const{min:Ut,max:Kt}=zt.aabb;kt[0]+=Ut[0]+Kt[0],kt[1]+=Ut[1]+Kt[1]}kt[0]=Math.floor(kt[0]/Rt.meshes.length/2),kt[1]=Math.floor(kt[1]/Rt.meshes.length/2)}if(ft&&(ft.id&&(Rt.id=ft.id),ft.lights&&(Rt.lights=function(kt){if(!kt.length)return[];const zt=function(or){const cr=atob(or),pr=new Uint8Array(cr.length);for(let Sr=0;Sr<cr.length;Sr++)pr[Sr]=cr.codePointAt(Sr);return pr}(kt),Ut=[],Kt=zt.length/24,er=new Uint16Array(zt.buffer),Jt=new Float32Array(zt.buffer);for(let or=0;or<Kt;or++){const cr=er[2*or*6]/30,pr=er[2*or*6+1]/30,Sr=er[2*or*6+10]/100,br=Jt[6*or+1],Pr=Jt[6*or+2],Dr=Jt[6*or+3],Or=Jt[6*or+4],nn=Dr-br,$r=Or-Pr,un=Math.hypot(nn,$r);Ut.push({pos:[br+.5*nn,Pr+.5*$r,pr],normal:[$r/un,-nn/un,0],width:un,height:cr,depth:Sr,points:[br,Pr,Dr,Or]})}return Ut}(ft.lights)),ft.MAPBOX_geometry_bloom&&(Rt.isGeometryBloom=ft.MAPBOX_geometry_bloom)),xt){const kt=[];for(const zt of xt)kt.push(S2(o.json.nodes[zt],o,g));Rt.children=kt}return Rt}function lI(b){if(b.vertices.length===0||b.indices.length===0)return null;const o=new cE(b.vertices,b.indices,8,256),[g,_e]=[o.min.clone(),o.max.clone()];return{vertices:b.vertices,indices:b.indices,grid:o,min:g,max:_e}}function cI(b){if(!b.extras||!b.extras.ground)return null;const o=b.extras.ground;if(!o||!Array.isArray(o)||o.length===0)return null;const g=o[0];if(!g||!Array.isArray(g)||g.length===0)return null;const _e=[];for(const at of g){if(!Array.isArray(at)||at.length!==2)continue;const ut=at[0],ft=at[1];typeof ut=="number"&&typeof ft=="number"&&_e.push(new _n(ut,ft))}if(_e.length<3)return null;_e.length>1&&_e[_e.length-1].equals(_e[0])&&_e.pop();let rt=0;for(let at=0;at<_e.length;at++){const ut=_e[at],ft=_e[(at+1)%_e.length],xt=_e[(at+2)%_e.length];rt+=(ut.x-ft.x)*(xt.y-ft.y)-(xt.x-ft.x)*(ut.y-ft.y)}rt>0&&_e.reverse();const ot=A_(_e.flatMap(at=>[at.x,at.y]),[]);return ot.length===0?null:{vertices:_e,indices:ot}}function uI(b,o){const g=[],_e=[];let rt=0;const ot=[];for(const at of b){rt=g.length;const ut=at.vertexArray.float32,ft=at.indexArray.uint16;for(let xt=0;xt<at.vertexArray.length;xt++)ot[0]=ut[3*xt+0],ot[1]=ut[3*xt+1],ot[2]=ut[3*xt+2],_s(ot,ot,o),g.push(new _n(ot[0],ot[1]));for(let xt=0;xt<3*at.indexArray.length;xt++)_e.push(ft[xt]+rt)}if(_e.length%3!=0)return null;for(let at=0;at<_e.length;at+=3){const ut=g[_e[at+0]],ft=g[_e[at+1]],xt=g[_e[at+2]];(ut.x-ft.x)*(xt.y-ft.y)-(xt.x-ft.x)*(ut.y-ft.y)>0&&([_e[at+1],_e[at+2]]=[_e[at+2],_e[at+1]])}return{vertices:g,indices:_e}}function cS(b){const o=function(ft,xt){const Ct=[],Rt=WebGL2RenderingContext;if(ft.json.textures)for(const kt of ft.json.textures){const zt={magFilter:Rt.LINEAR,minFilter:Rt.NEAREST,wrapS:Rt.REPEAT,wrapT:Rt.REPEAT};kt.sampler!==void 0&&Object.assign(zt,ft.json.samplers[kt.sampler]),Ct.push({image:xt[kt.source],sampler:zt,uploaded:!1})}return Ct}(b,b.images),g=function(ft,xt){const Ct=[];for(const Rt of ft.json.meshes){const kt=[];for(const zt of Rt.primitives)kt.push(aI(zt,ft,xt));Ct.push(kt)}return Ct}(b,o),{scenes:_e,scene:rt,nodes:ot}=b.json,at=_e?_e[rt||0].nodes:[...ot.keys()],ut=[];for(const ft of at)ut.push(S2(ot[ft],b,g));return function(ft,xt,Ct){const Rt={},kt=new Set;for(let zt=0;zt<ft.length;zt++){const Ut=Ct[xt[zt]];if(!Ut.extras)continue;const Kt=Ut.extras["mapbox:footprint:version"],er=Ut.extras["mapbox:footprint:id"];(Kt||er)&&kt.add(zt),Kt==="1.0.0"&&er&&(Rt[er]=zt)}for(let zt=0;zt<ft.length;zt++){if(kt.has(zt))continue;const Ut=ft[zt],Kt=Ct[xt[zt]];if(!Kt.extras)continue;let er=null;Ut.id in Rt&&(er=uI(ft[Rt[Ut.id]].meshes,Ut.localMatrix)),er||(er=cI(Kt)),er&&(Ut.footprint=lI(er))}if(kt.size>0){const zt=Array.from(kt.values()).sort((Ut,Kt)=>Ut-Kt);for(let Ut=zt.length-1;Ut>=0;Ut--)ft.splice(zt[Ut],1)}}(ut,at,b.json.nodes),ut}function hI(b){b.heightmap=new Float32Array(4096),b.heightmap.fill(-1);const o=b.vertexArray.float32,g=b.aabb.min[0]-1,_e=b.aabb.min[1]-1,rt=Xy/(b.aabb.max[0]-g+2),ot=Xy/(b.aabb.max[1]-_e+2);for(let at=0;at<o.length;at+=3){const ut=o[at+2],ft=(o[at+0]-g)*rt|0,xt=(o[at+1]-_e)*ot|0;ut>b.heightmap[xt*Xy+ft]&&(b.heightmap[xt*Xy+ft]=ut)}}function C2(b,o,g,_e,rt){g.reserve(g.length+4*b.length),_e.reserve(_e.length+10*b.length),rt.reserve(rt.length+10*b.length);let ot=_e.length;for(const at of b){const ut=Math.min(10,Math.max(4,1.3*at.height))*o,ft=[-at.normal[1],at.normal[0],0],xt=Math.min(.29,.1*at.width/at.depth),Ct=at.width-2*at.depth*o*(xt+.01),Rt=vn([],at.pos,ft,Ct/2),kt=vn([],at.pos,ft,-Ct/2),zt=[Rt[0],Rt[1],Rt[2]+at.height],Ut=[kt[0],kt[1],kt[2]+at.height],Kt=vn([],at.normal,ft,xt);tn(Kt,Kt,ut);const er=vn([],at.normal,ft,-xt);tn(er,er,ut),rr(Kt,Rt,Kt),rr(er,kt,er),Rt[2]+=.1,kt[2]+=.1,_e.emplaceBack(Kt[0],Kt[1],Kt[2]),_e.emplaceBack(er[0],er[1],er[2]),_e.emplaceBack(Rt[0],Rt[1],Rt[2]),_e.emplaceBack(kt[0],kt[1],kt[2]),_e.emplaceBack(zt[0],zt[1],zt[2]),_e.emplaceBack(Ut[0],Ut[1],Ut[2]),_e.emplaceBack(Rt[0],Rt[1],Rt[2]),_e.emplaceBack(kt[0],kt[1],kt[2]),_e.emplaceBack(Kt[0],Kt[1],Kt[2]),_e.emplaceBack(er[0],er[1],er[2]);const Jt=Ct/ut/2;rt.emplaceBack(-Jt-xt,-1,Jt,.8),rt.emplaceBack(Jt+xt,-1,Jt,.8),rt.emplaceBack(-Jt,0,Jt,1.3),rt.emplaceBack(Jt,0,Jt,1.3),rt.emplaceBack(Jt+xt,-.8,Jt,.7),rt.emplaceBack(Jt+xt,-.8,Jt,.7),rt.emplaceBack(0,0,Jt,1.3),rt.emplaceBack(0,0,Jt,1.3),rt.emplaceBack(Jt+xt,-1.2,Jt,.8),rt.emplaceBack(Jt+xt,-1.2,Jt,.8),g.emplaceBack(6+ot,4+ot,8+ot),g.emplaceBack(7+ot,9+ot,5+ot),g.emplaceBack(0+ot,1+ot,2+ot),g.emplaceBack(1+ot,3+ot,2+ot),ot+=10}}function dI(b,o){const g={};g.indexArray=new tu,g.vertexArray=new tp,g.colorArray=new Om,C2(b,o,g.indexArray,g.vertexArray,g.colorArray);const _e={defined:!0};_e.emissiveFactor=Ro.black;const rt={};return rt.baseColorFactor=Ro.white,_e.pbrMetallicRoughness=rt,g.material=_e,g.aabb=new is([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),g}const A2=Ys([{name:"a_pos_3f",components:3,type:"Float32"}]),pI=Ys([{name:"a_normal_3",components:3,type:"Int16"}]),fI=Ys([{name:"a_centroid_3",components:3,type:"Int16"}]),R2=Ys([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),mI=Ys([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),gI=Ys([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),yI=Ys([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),xI=Ys([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),_I=Ys([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),P2=zr.types,TE=32767;function vI(b,o){const g=jn+o;for(const _e of b)for(const rt of _e)if(rt.x<-o||rt.x>g||rt.y<-o||rt.y>g)return!1;return!0}function bI(b){switch(b){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${b}`)}}class uS{constructor(){this.layoutVertexArray=new tp,this.layoutAttenuationArray=new Om,this.layoutColorArray=new rp,this.indexArray=new tu,this.indexArrayForConflation=new tu,this.segmentsBucket=new _l}}class hS{constructor(o){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new _l,this.entranceBloom=new uS;const g=66560;this.layoutVertexArray=new tp,this.layoutVertexArray.reserve(g),this.layoutNormalArray=new F0,this.layoutNormalArray.reserve(g),this.layoutCentroidArray=new F0,this.layoutCentroidArray.reserve(g),this.layoutColorArray=new rp,this.layoutColorArray.reserve(g),this.layoutFloodLightDataArray=new Fm,this.layoutFloodLightDataArray.reserve(g),this.layoutAOArray=new m_,this.layoutAOArray.reserve(g),this.indexArray=new tu,this.indexArray.reserve(66560),this.indexArrayForConflation=new tu,this.segmentsBucket=new _l,this.entranceBloom=new uS,o&&(this.layoutFacadePaintArray=new rp,this.layoutFacadeDataArray=new h0,this.layoutFacadeVerticalRangeArray=new rp)}reserve(o,g,_e){this.layoutVertexArray.reserveForAdditional(o),this.layoutCentroidArray.reserveForAdditional(o),this.layoutFloodLightDataArray.reserveForAdditional(o),this.layoutNormalArray.reserveForAdditional(o),this.layoutAOArray.reserveForAdditional(o),this.layoutColorArray.reserveForAdditional(o),this.indexArray.reserveForAdditional(g),_e&&(this.layoutFacadePaintArray.reserveForAdditional(o),this.layoutFacadeDataArray.reserveForAdditional(o),this.layoutFacadeVerticalRangeArray.reserveForAdditional(o))}}class I2{constructor(o){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Gp,this.footprintsIndices=new Fm,this.footprintsMin=new _n(1/0,1/0),this.footprintsMax=new _n(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new hS(!1),this.buildingWithFacade=new hS(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=o.zoom,this.canonical=o.canonical,this.layers=o.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=o.index,this.hasPattern=!1,this.worldview=o.worldview,this.lut=o.lut,this.programConfigurations=new Pp(o.layers,{zoom:o.zoom,lut:o.lut}),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.projection=o.projection,this.groundEffect=new qT(o),this.groundEffect.groundRadiusArray=new sm,this.hasAppearances=null}updateFootprints(o,g){const _e=new cE([],[],1),rt={vertices:[],indices:new Uint32Array(0),grid:_e,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};g.push({footprint:rt,id:o})}updateAppearances(o,g,_e,rt){}prepare(){return function(){if(gE!=null||u2!=null)return null;if(M_!=null)return M_;const o=fetch(eo.BUILDING_GEN_URL);return M_=function(g){let _e,rt,ot,at,ut;function ft(){_e=new Uint8Array(ut.buffer),rt=new Int16Array(ut.buffer),ot=new Int32Array(ut.buffer),at=new Float32Array(ut.buffer)}function xt(){throw new Error("Unexpected BuildingGen error.")}const Ct=()=>{},Rt={a:{a:xt,f:function(kt){const zt=_e.length,Ut=Math.max(kt>>>0,Math.ceil(1.2*zt)),Kt=Math.ceil((Ut-zt)/65536);try{return ut.grow(Kt),ft(),!0}catch{return!1}},g:xt,b:Ct,c:Ct,d:Ct,e:Ct}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(g,Rt):g.then(kt=>kt.arrayBuffer()).then(kt=>WebAssembly.instantiate(kt,Rt))).then(kt=>{const zt=kt.instance.exports;return(0,zt.g)(),ut=zt.f,ft(),new WP({setStyle:zt.h,setAOOptions:zt.i,setMetricOptions:zt.j,setStructuralOptions:zt.k,setFacadeOptions:zt.l,setFauxFacadeOptions:zt.m,setFacadeClassifierOptions:zt.n,addFeature:zt.o,addFacade:zt.p,generateMesh:zt.q,getLastError:zt.r,getOuterRingLength:zt.s,getMeshCount:zt.t,getPositionsPtr:zt.u,getPositionsLength:zt.v,getNormalsPtr:zt.w,getNormalsLength:zt.x,getAOPtr:zt.y,getAOLength:zt.z,getUVPtr:zt.A,getUVLength:zt.B,getFauxFacadePtr:zt.C,getFauxFacadeLength:zt.D,getIndicesPtr:zt.E,getIndicesLength:zt.F,getBuildingPart:zt.G,getRingCount:zt.H,getRingPtr:zt.I,getRingLength:zt.J,malloc:zt.K,free:zt.L,heapU8:_e,heap16:rt,heap32:ot,heapF32:at})})}(o).then(g=>(M_=null,gE=g,gE)).catch(g=>{Wn("Could not load building-gen"),M_=null,u2=g}),M_}()}populate(o,g,_e,rt){const ot=qP();if(!ot)return;const at=ir(_e);this.tileToMeter=at,this.brightness=g.brightness,ot.setStyle({normalScale:[1,-1,at],tileToMeters:at}),ot.setAOOptions(!1,.3),ot.setMetricOptions(!1,16),ot.setStructuralOptions(!0),ot.setFacadeClassifierOptions(3);const ut=new Map,ft=new Map;let xt=0;for(const{feature:Jt}of o){if(P2[Jt.type]!=="LineString"){ut.set(Jt.id,Jt.properties.source_id);continue}const or=this.layers[0]._featureFilter.needGeometry;if(or&&!this.layers[0]._featureFilter.filter(new Xo(this.zoom),Jt,_e))continue;const cr=Ur(Jt,or);if(!or&&!this.layers[0]._featureFilter.filter(new Xo(this.zoom),cr,_e))continue;const pr=or?cr.geometry:kr(Jt,_e,rt),Sr=[];for(const Or of pr)for(const nn of Or)Sr.push(nn.x),Sr.push(nn.y);const br={coordinates:Sr,crossPerc:Jt.properties.cross_perc,distanceToRoad:Jt.properties.distance_to_road,entrances:Jt.properties.entrances,sourceId:0},Pr=Jt.properties.source_id;let Dr=ft.get(Pr);Dr||(Dr=[],ft.set(Pr,Dr)),Dr.push(br),++xt}this.maxHeight=0;const Ct=new Array,Rt=new Set,kt=Jt=>{Jt!=null&&Rt.add(Jt)},zt=(Jt,or)=>{Jt!=null&&Ct.push({buildingId:Jt,footprintIndex:or})},Ut=64*(o.length-xt),Kt=Ut/2;this.buildingWithFacade.reserve(Ut,Kt,!0),this.buildingWithoutFacade.reserve(2*Ut,2*Kt,!1),this.footprintsIndices.reserve(16*(o.length-xt)),this.footprintsVertices.reserve(8*(o.length-xt));for(const{feature:Jt,id:or,index:cr,sourceLayerIndex:pr}of o){if(P2[Jt.type]==="LineString")continue;const Sr=this.layers[0]._featureFilter.needGeometry;if(Sr&&!this.layers[0]._featureFilter.filter(new Xo(this.zoom),Jt,_e))continue;let br=null;if(Jt.properties&&Jt.properties.hasOwnProperty("building_id")&&(br=Jt.properties.building_id,Rt.has(br)))continue;const Pr=Ur(Jt,Sr);if(!Sr&&!this.layers[0]._featureFilter.filter(new Xo(this.zoom),Pr,_e))continue;const Dr=Sr?Pr.geometry:kr(Jt,_e,rt),Or=m1(Dr,500);let nn=!1;for(const ws of Or)if(ws.length!==1){nn=!0;break}if(nn){kt(br);continue}if(!vI(Dr,163)){kt(br);continue}const $r=this.layers[0],un=bI($r.layout.get("building-roof-shape").evaluate(Jt,{},_e)),gn=$r.layout.get("building-base").evaluate(Jt,{},_e),yn=$r.layout.get("building-height").evaluate(Jt,{},_e),Sn=$r.layout.get("building-flood-light-ground-radius").evaluate(Jt,{},_e),An=$r.paint.get("building-ambient-occlusion-intensity"),wn=Sn/this.tileToMeter;Jt.properties["building-part"]="roof";const En=$r.paint.get("building-color").evaluate(Jt,{},this.canonical).toPremultipliedRenderColor(this.lut),ln=$r.paint.get("building-emissive-strength").evaluate(Jt,{},this.canonical);Jt.properties["building-part"]="wall";const on=$r.paint.get("building-color").evaluate(Jt,{},this.canonical).toPremultipliedRenderColor(this.lut),Tn=$r.paint.get("building-emissive-strength").evaluate(Jt,{},this.canonical);Jt.properties["building-part"]="window";const On=$r.paint.get("building-color").evaluate(Jt,{},this.canonical).toPremultipliedRenderColor(this.lut),kn=$r.paint.get("building-emissive-strength").evaluate(Jt,{},this.canonical);Jt.properties["building-part"]="door";const ls=$r.paint.get("building-color").evaluate(Jt,{},this.canonical).toPremultipliedRenderColor(this.lut),Gn=$r.paint.get("building-emissive-strength").evaluate(Jt,{},this.canonical);let Kn=$r.layout.get("building-flood-light-wall-radius").evaluate(Jt,{},_e);Kn=tr(Kn,0,2048);const ts=Kn/2048*TE,qs=ut.get(or),Dn=ft.get(qs)||[],rs=Dn.length!==0&&$r.layout.get("building-facade").evaluate(Jt,{},_e);ot.setFacadeOptions(4,!0),ot.setFauxFacadeOptions(rs,!1,1);let Ms=0,ro=0,so=0,Os=0,No=0,wr=0,Cr=0,hn=0,Cn=0,Vn=0,Un=0;if(rs){let ws=Math.round($r.layout.get("building-facade-floors").evaluate(Jt,{},_e));if(gn===0){ws=Math.max(1,ws-(Dn.length>0?1:0));let ko=4;if(yn>100){const _a=[10,13,15];ko=_a[Jt.id?Jt.id%_a.length:0]}else yn<=10&&(ko=3);ot.setFacadeOptions(ko,!0),No=(yn<15?1.3:1.61803)*ko/at}else No=gn/at;wr=yn/at,No=Math.min(No,wr),so=$r.layout.get("building-facade-unit-width").evaluate(Jt,{},_e)/at,Os=(wr-No)/ws,ot.setFauxFacadeOptions(!0,!0,so);const Tl=$r.layout.get("building-facade-window").evaluate(Jt,{},_e);Ms=Tl[0],ro=Tl[1],Cr=Math.floor(65535*Math.min(1,No/jn)),hn=Math.floor(65535*Math.min(1,wr/jn)),Cn=Math.floor(255*Ms)<<8|Math.floor(255*ro),Vn=Math.floor(65535*Math.min(1,so/jn)),Un=Math.floor(65535*Math.min(1,Os/jn))}const cs=Array(Or.length),ps={x:1/0,y:1/0},Ls={x:-1/0,y:-1/0},$s={x:0,y:0};let Ws=0;for(let ws=0;ws<Or.length;ws++){const Tl=Or[ws];if(Tl.length>0){const ko=[],_a=Array(Tl.length+1);_a[0]=0;for(let iu=0;iu<Tl.length;iu++){const fu=Tl[iu];for(let Yl=0;Yl<fu.length;Yl++){const Ql=fu[fu.length-Yl-1];ps.x=Math.min(ps.x,Ql.x),ps.y=Math.min(ps.y,Ql.y),Ls.x=Math.max(Ls.x,Ql.x),Ls.y=Math.max(Ls.y,Ql.y),$s.x+=Ql.x,$s.y+=Ql.y,Ws++,ko.push(Ql.x),ko.push(Ql.y)}_a[iu+1]=ko.length}cs[ws]={id:Jt.id?Jt.id:0,height:yn,minHeight:gn,sourceId:0,roofType:un,coordinates:ko,ringIndices:_a}}}$s.x/=Ws||1,$s.y/=Ws||1;const Qs=ot.generateMesh(cs,Dn);if(typeof Qs=="string"){Wn(`Unable to generate building ${Jt.id}: ${Qs}`),kt(br);continue}if(Qs.meshes.length===0||Qs.modifiedPolygonRings.length===0){kt(br);continue}const Es=rs?this.buildingWithFacade:this.buildingWithoutFacade;let Is=0;for(const ws of Qs.meshes)Is+=ws.positions.length/3;const ho=Es.segmentsBucket.prepareSegment(Is,Es.layoutVertexArray,Es.indexArray),yo=[];let xo=null,Io=0,Bo=-1;const Lo=Es.layoutVertexArray.length,vo=Lo+Is;Es.layoutVertexArray.resize(vo),Es.layoutCentroidArray.resize(vo),Es.layoutNormalArray.resize(vo),Es.layoutAOArray.resize(vo),Es.layoutColorArray.resize(vo),Es.layoutFloodLightDataArray.resize(vo),rs&&(Es.layoutFacadePaintArray.resize(vo),Es.layoutFacadeDataArray.resize(vo),Es.layoutFacadeVerticalRangeArray.resize(vo));const Co=Es.indexArray.length;let Gs=0,no=Lo;for(const ws of Qs.meshes){let Tl,ko;if(ws.buildingPart===1)Tl=En,ko=ln;else if(ws.buildingPart===0)Tl=on,ko=Tn;else if(ws.buildingPart===2)Tl=On,ko=kn;else{if(ws.buildingPart!==3)continue;Tl=ls,ko=Gn}if(ko=tr(ko,0,1),ws.buildingPart===3){const Wo=new Array;for(let su=0;su<ws.positions.length;su+=12){const Kp=ws.positions[su+0],$m=ws.positions[su+1],Tu=ws.positions[su+3],Vu=ws.positions[su+4],lp=ws.positions[su+2],J0=ws.positions[su+8]-lp,W_=1,xm=Tu-Kp,_m=Vu-$m,Z1=Math.hypot(xm,_m);Wo.push({pos:[Kp+.5*xm,$m+.5*_m,lp],normal:[_m/Z1,-xm/Z1,0],width:Z1,height:J0,depth:W_,points:[Kp,$m,Tu,Vu]})}const Bl=Es.entranceBloom.segmentsBucket.prepareSegment(10*Wo.length,Es.entranceBloom.layoutVertexArray,Es.entranceBloom.indexArray),Wl=Es.entranceBloom.layoutVertexArray.length;Io=Es.entranceBloom.indexArray.length,C2(Wo,.5/this.tileToMeter,Es.entranceBloom.indexArray,Es.entranceBloom.layoutVertexArray,Es.entranceBloom.layoutAttenuationArray);const Yu=Es.entranceBloom.layoutVertexArray.length-Wl;Bo=Es.entranceBloom.indexArray.length-Io;for(let su=0;su<Yu;su++)Es.entranceBloom.layoutColorArray.emplaceBack(255*ls.r<<8|255*ls.g,255*ls.b<<8|51*Gn);Bl.vertexLength+=Yu,Bl.primitiveLength+=Bo,xo={part:ws.buildingPart,vertexOffset:Wl,vertexLength:Yu}}Es.layoutVertexArray.float32.set(ws.positions,3*no);const _a=ws.positions.length/3;for(let Wo=0;Wo<_a;++Wo){const Bl=3*Wo;Gs=Math.max(Gs,ws.positions[Bl+2]);const Wl=ws.normals[Bl+1]*TE,Yu=ws.normals[Bl+2]*TE,su=3*(no+Wo);Es.layoutNormalArray.int16[su]=ws.normals[Bl]*TE,Es.layoutNormalArray.int16[su+1]=Wl,Es.layoutNormalArray.int16[su+2]=Yu;const Kp=ws.ao[Wo];Es.layoutAOArray.uint8[no+Wo]=255*Kp;const $m=1+(Kp-1)*An,Tu=255*Tl.b*$m<<8|255*ko;Es.layoutColorArray.uint16[2*(no+Wo)]=255*Tl.r*$m<<8|255*Tl.g*$m,Es.layoutColorArray.uint16[2*(no+Wo)+1]=Tu}const iu=Math.floor($s.x),fu=Math.floor($s.y),Yl=Math.floor(yn);for(let Wo=0;Wo<_a;++Wo){const Bl=3*(no+Wo);Es.layoutCentroidArray.int16[Bl]=iu,Es.layoutCentroidArray.int16[Bl+1]=fu,Es.layoutCentroidArray.int16[Bl+2]=Yl}if(Es.layoutFloodLightDataArray.uint16.fill(ws.buildingPart===0?ts:0,no,no+_a),rs){const Wo=255*On.r<<8|255*On.g,Bl=255*On.b<<8|255*kn;for(let Wl=0;Wl<_a;++Wl){const Yu=2*(no+Wl);Es.layoutFacadePaintArray.uint16[Yu]=Wo,Es.layoutFacadePaintArray.uint16[Yu+1]=Bl}for(let Wl=0;Wl<_a;++Wl)if(ws.isFauxFacade[Wl]){const Yu=Math.min(65535,Math.floor(ws.uv[2*Wl]*Qs.outerRingLength));Es.layoutFacadeDataArray.emplace(no+Wl,1|Yu,Cn,Vn,Un),Es.layoutFacadeVerticalRangeArray.emplace(no+Wl,Cr,hn)}else Es.layoutFacadeDataArray.emplace(no+Wl,0,0,0,0),Es.layoutFacadeVerticalRangeArray.emplace(no+Wl,0,0)}const Ql=ho.vertexLength,lu=ws.indices.length/3,Ku=Es.indexArray.length;Es.indexArray.resize(Ku+lu);for(let Wo=0;Wo<lu;++Wo){const Bl=3*Wo,Wl=3*Ku+Bl;Es.indexArray.uint16[Wl]=Ql+ws.indices[Bl],Es.indexArray.uint16[Wl+1]=Ql+ws.indices[Bl+1],Es.indexArray.uint16[Wl+2]=Ql+ws.indices[Bl+2]}ws.buildingPart!==1&&ws.buildingPart!==0&&ws.buildingPart!==2&&ws.buildingPart!==3||yo.push({part:ws.buildingPart,vertexOffset:no,vertexLength:ws.positions.length/3}),no+=_a,ho.vertexLength+=_a,ho.primitiveLength+=ws.indices.length/3}this.maxHeight=Math.max(this.maxHeight,Gs);const yl=Es.indexArray.length-Co,bs=this.footprintsIndices.length,Js=this.footprintsVertices.length,jo=[],Uo=new _n(1/0,1/0),Zo=new _n(-1/0,-1/0),Hl=this.groundEffect.vertexArray.length;for(const ws of Qs.modifiedPolygonRings){const Tl=[],ko=new _n(1/0,1/0),_a=new _n(-1/0,-1/0);for(let iu=0;iu<ws.length;iu+=2){const fu=ws.length-iu-2;ko.x=Math.min(ko.x,ws[fu]),ko.y=Math.min(ko.y,ws[fu+1]),_a.x=Math.max(_a.x,ws[fu]),_a.y=Math.max(_a.y,ws[fu+1]);const Yl=new _n(ws[fu],ws[fu+1]);Tl.push(Yl),jo.push(Yl.x,Yl.y),this.footprintsVertices.emplaceBack(Yl.x,Yl.y)}Uo.x=Math.min(Uo.x,ko.x),Uo.y=Math.min(Uo.y,ko.y),Zo.x=Math.max(Zo.x,_a.x),Zo.y=Math.max(Zo.y,_a.y),this.groundEffect.addData(Tl,[ko,_a],wn)}const Ho=this.groundEffect.vertexArray.length-Hl;this.groundEffect.groundRadiusArray.reserveForAdditional(Ho);for(let ws=0;ws<Ho;ws++)this.groundEffect.groundRadiusArray.emplaceBack(Sn);(ps.x<0||Ls.x>jn||ps.y<0||Ls.y>jn)&&this.featuresOnBorder.push({featureId:Jt.id,footprintIndex:this.footprints.length});{const ws=A_(jo,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+ws.length),this.footprintsIndices.uint16.set(ws,bs),this.buildingIds.add(br??Jt.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,Uo.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,Uo.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,Zo.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,Zo.y);const Tl={footprintVertexOffset:Js,footprintVertexLength:this.footprintsVertices.length-Js,footprintIndexOffset:bs,footprintIndexLength:this.footprintsIndices.length-bs,min:Uo,max:Zo,hiddenFlags:0,indicesOffset:Co,indicesLength:yl,bloomIndicesOffset:Io,bloomIndicesLength:Bo,groundEffectVertexOffset:Hl,groundEffectVertexLength:Ho,hasFauxFacade:rs,height:Gs,promoteId:or,feature:Pr,parts:yo,buildingBloom:xo},ko=this.footprints.length;Jt.id!==void 0&&this.featureFootprintLookup.set(Jt.id,ko),zt(br,ko),this.footprints.push(Tl)}this.programConfigurations.populatePaintArrays(Es.layoutVertexArray.length,Jt,cr,{},g.availableImages,_e,g.brightness),this.groundEffect.addPaintPropertiesData(Jt,cr,{},g.availableImages,_e,g.brightness),g.featureIndex.insert(Jt,Dr,cr,pr,this.index,Lo)}Ct.forEach(({buildingId:Jt,footprintIndex:or})=>{Rt.has(Jt)&&(this.footprints[or].hiddenFlags|=4)});const er=new Set;this.buildingIds.forEach((Jt,or,cr)=>{Rt.has(Jt)||er.add(Jt)}),this.buildingIds=er,this.groundEffect.prepareBorderSegments()}update(o,g,_e,rt,ot,at,ut){this.programConfigurations.updatePaintArrays(o,g,ot,_e,rt,at,ut),this.groundEffect.update(o,g,ot,_e,rt,at,ut),this.evaluate(this.layers[0],o),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(o){const g=_e=>{_e.layoutVertexBuffer=o.createVertexBuffer(_e.layoutVertexArray,A2.members),_e.layoutNormalBuffer=o.createVertexBuffer(_e.layoutNormalArray,pI.members),_e.layoutCentroidBuffer=o.createVertexBuffer(_e.layoutCentroidArray,fI.members),_e.layoutFloodLightDataBuffer=o.createVertexBuffer(_e.layoutFloodLightDataArray,_I.members),_e.layoutFacadeDataArray&&_e.layoutFacadeDataArray.length&&(_e.layoutFacadeDataBuffer=o.createVertexBuffer(_e.layoutFacadeDataArray,gI.members)),_e.layoutFacadeVerticalRangeArray&&_e.layoutFacadeVerticalRangeArray.length&&(_e.layoutFacadeVerticalRangeBuffer=o.createVertexBuffer(_e.layoutFacadeVerticalRangeArray,yI.members)),_e.entranceBloom.layoutVertexArray.length&&(_e.entranceBloom.layoutVertexBuffer=o.createVertexBuffer(_e.entranceBloom.layoutVertexArray,A2.members),_e.entranceBloom.layoutAttenuationBuffer=o.createVertexBuffer(_e.entranceBloom.layoutAttenuationArray,xI.members)),this.uploadUpdatedColorBuffer(o),this.uploadUpdatedIndexBuffer(o)};this.uploaded||(g(this.buildingWithoutFacade),g(this.buildingWithFacade),this.groundEffect.upload(o)),this.groundEffect.uploadPaintProperties(o),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){const o=g=>{g.layoutVertexBuffer&&(g.layoutVertexBuffer.destroy(),g.layoutNormalBuffer.destroy(),g.layoutColorBuffer.destroy(),g.segmentsBucket.destroy(),g.indexBuffer&&g.indexBuffer.destroy(),g.entranceBloom.layoutVertexBuffer&&(g.entranceBloom.layoutVertexBuffer.destroy(),g.entranceBloom.layoutColorBuffer.destroy(),g.entranceBloom.layoutAttenuationBuffer.destroy(),g.entranceBloom.indexBuffer.destroy(),g.entranceBloom.segmentsBucket.destroy()))};o(this.buildingWithoutFacade),o(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(o,g,_e=!0){let rt=!1;const ot=_e?g:0,at=0|(_e?-1:~g);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const ut of o){const ft=this.footprints[ut],xt=ft.hiddenFlags&at|ot;ft.hiddenFlags!==xt&&(ft.hiddenFlags=xt,rt=!0,this.groundEffect.updateHiddenByLandmarkRange(ft.groundEffectVertexOffset,ft.groundEffectVertexLength,ft.hiddenFlags!==0))}return rt&&(this.indexArrayForConflationUploaded=!1),rt}uploadUpdatedIndexBuffer(o){if(this.groundEffect.uploadHiddenByLandmark(o),this.indexArrayForConflationUploaded)return;const g=rt=>{rt.indexArray.length!==0&&(rt.indexArrayForConflation.resize(rt.indexArray.length),rt.indexArrayForConflation.uint16.set(rt.indexArray.uint16),rt.entranceBloom.indexArrayForConflation.resize(rt.entranceBloom.indexArray.length),rt.entranceBloom.indexArrayForConflation.uint16.set(rt.entranceBloom.indexArray.uint16))};g(this.buildingWithoutFacade),g(this.buildingWithFacade);for(const rt of this.footprints){const ot=rt.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,at=rt.indicesOffset+rt.indicesLength;if(rt.hiddenFlags!==0){for(let ft=rt.indicesOffset;ft<at;ft++)ot.indexArrayForConflation.uint16[3*ft+0]=0,ot.indexArrayForConflation.uint16[3*ft+1]=0,ot.indexArrayForConflation.uint16[3*ft+2]=0;const ut=rt.bloomIndicesOffset+rt.bloomIndicesLength;for(let ft=rt.bloomIndicesOffset;ft<ut;ft++)ot.entranceBloom.indexArrayForConflation.uint16[3*ft+0]=0,ot.entranceBloom.indexArrayForConflation.uint16[3*ft+1]=0,ot.entranceBloom.indexArrayForConflation.uint16[3*ft+2]=0}}const _e=rt=>{rt.indexArray.length!==0&&(rt.indexBuffer?rt.indexBuffer.updateData(rt.indexArrayForConflation):rt.indexBuffer=o.createIndexBuffer(rt.indexArrayForConflation,!0),rt.entranceBloom.indexBuffer?rt.entranceBloom.indexBuffer.updateData(rt.entranceBloom.indexArrayForConflation):rt.entranceBloom.indexBuffer=o.createIndexBuffer(rt.entranceBloom.indexArrayForConflation,!0))};_e(this.buildingWithoutFacade),_e(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(o){const g=_e=>{_e.layoutColorBuffer?_e.layoutColorBuffer.updateData(_e.layoutColorArray):_e.layoutColorBuffer=o.createVertexBuffer(_e.layoutColorArray,R2.members,!0),_e.layoutFacadePaintArray&&(_e.layoutFacadePaintBuffer?_e.layoutFacadePaintBuffer.updateData(_e.layoutFacadePaintArray):_e.layoutFacadePaintBuffer=o.createVertexBuffer(_e.layoutFacadePaintArray,mI.members,!0)),_e.entranceBloom.layoutColorBuffer?_e.entranceBloom.layoutColorBuffer.updateData(_e.entranceBloom.layoutColorArray):_e.entranceBloom.layoutColorBuffer=o.createVertexBuffer(_e.entranceBloom.layoutColorArray,R2.members,!0)};g(this.buildingWithoutFacade),g(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(o,g){const _e=o.paint.get("building-ambient-occlusion-intensity");for(const rt of this.footprints){if(4&rt.hiddenFlags)continue;const ot=g[rt.promoteId],at=rt.feature;at.properties["building-part"]="roof";const ut=o.paint.get("building-color").evaluate(at,ot,this.canonical).toPremultipliedRenderColor(this.lut),ft=o.paint.get("building-emissive-strength").evaluate(at,ot,this.canonical);at.properties["building-part"]="wall";const xt=o.paint.get("building-color").evaluate(at,ot,this.canonical).toPremultipliedRenderColor(this.lut),Ct=o.paint.get("building-emissive-strength").evaluate(at,ot,this.canonical);at.properties["building-part"]="window";const Rt=o.paint.get("building-color").evaluate(at,ot,this.canonical).toPremultipliedRenderColor(this.lut),kt=o.paint.get("building-emissive-strength").evaluate(at,ot,this.canonical);at.properties["building-part"]="door";const zt=o.paint.get("building-color").evaluate(at,ot,this.canonical).toPremultipliedRenderColor(this.lut),Ut=o.paint.get("building-emissive-strength").evaluate(at,ot,this.canonical),Kt=rt.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const Jt of rt.parts){let or,cr=ut;Jt.part===1?(cr=ut,or=ft):Jt.part===0?(cr=xt,or=Ct):Jt.part===2?(cr=Rt,or=kt):Jt.part===3&&(cr=zt,or=Ut),or=tr(or,0,1);for(let pr=0;pr<Jt.vertexLength;pr++){const Sr=Jt.vertexOffset+pr,br=1+(Kt.layoutAOArray.uint8[Sr]/255-1)*_e;Kt.layoutColorArray.emplace(Sr,cr.r*br*255<<8|cr.g*br*255,cr.b*br*255<<8|255*or),rt.hasFauxFacade&&Kt.layoutFacadePaintArray.emplace(Sr,255*Rt.r<<8|255*Rt.g,255*Rt.b<<8|255*kt)}}const er=rt.buildingBloom;if(er)for(let Jt=0;Jt<er.vertexLength;Jt++)Kt.entranceBloom.layoutColorArray.emplace(er.vertexOffset+Jt,255*zt.r<<8|255*zt.g,255*zt.b<<8|51*Ut)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(o,g,_e){if(g.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=g.updateTime;const rt=g.getReplacementRegionsForTile(o.toUnwrapped());if(hE(this.activeReplacements,rt))return;this.activeReplacements=rt;for(const at of this.footprints)at.hiddenFlags&=-2;const ot=[];for(const at of this.activeReplacements){if(at.order<=kC)continue;const ut=Math.max(1,Math.pow(2,at.footprintTileId.canonical.z-o.canonical.z));for(const ft of this.footprints)ft.min.x>at.max.x||ft.max.x<at.min.x||ft.min.y>at.max.y||ft.max.y<at.min.y||(ot.length=0,EI(this.footprintsVertices,ft.footprintVertexOffset,ft.footprintVertexLength,at.footprintTileId.canonical,o.canonical,ot),GT(at.footprint,ot,this.footprintsIndices.uint16,ft.footprintIndexOffset,ft.footprintIndexLength,0,-ut)&&(ft.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const at of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(at.groundEffectVertexOffset,at.groundEffectVertexLength,at.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(o){if(o.id!==void 0){const g=this.featureFootprintLookup.get(o.id);return this.footprints[g]}return null}getHeightAtTileCoord(o,g){let _e=Number.NEGATIVE_INFINITY,rt=!0;const ot=4*(o+jn)*jn+(g+jn);if(this.footprintLookup.hasOwnProperty(ot)){const ut=this.footprintLookup[ot];return ut?{height:ut.height,hidden:ut.hiddenFlags!==0}:void 0}const at=new _n(o,g);for(const ut of this.footprints)o>ut.max.x||ut.min.x>o||g>ut.max.y||ut.min.y>g||ut.height<=_e||wI(at,this.footprintsVertices.float32.subarray(2*ut.footprintVertexOffset,2*(ut.footprintVertexOffset+ut.footprintVertexLength)),this.footprintsIndices.uint16.subarray(ut.footprintIndexOffset,ut.footprintIndexOffset+ut.footprintIndexLength))&&(_e=ut.height,this.footprintLookup[ot]=ut,rt=ut.hiddenFlags!==0);if(_e!==Number.NEGATIVE_INFINITY)return{height:_e,hidden:rt};this.footprintLookup[ot]=void 0}}function wI(b,o,g){for(let _e=0;_e<g.length;_e+=3){const rt=g[_e],ot=g[_e+1],at=g[_e+2],ut=o[2*rt+0],ft=o[2*rt+1],xt=o[2*ot+0],Ct=o[2*ot+1],Rt=o[2*at+0],kt=o[2*at+1],zt=(ut-Rt)*(b.y-kt)-(ft-kt)*(b.x-Rt),Ut=(xt-ut)*(b.y-ft)-(Ct-ft)*(b.x-ut);if(zt<0!=Ut<0&&zt!==0&&Ut!==0)continue;const Kt=(Rt-xt)*(b.y-Ct)-(kt-Ct)*(b.x-xt);if(Kt===0||Kt<0==zt+Ut<=0)return!0}return!1}function EI(b,o,g,_e,rt,ot){const at=Math.pow(2,_e.z-rt.z);for(let ut=0;ut<g;ut++){let ft=b.float32[2*(ut+o)+0],xt=b.float32[2*(ut+o)+1];ft=(ft+rt.x*jn)*at-_e.x*jn,xt=(xt+rt.y*jn)*at-_e.y*jn,ot.push(new _n(ft,xt))}}let k2,M2;Jn(I2,"BuildingBucket",{omit:["layers"]}),Jn(hS,"BuildingGeometry"),Jn(uS,"BuildingBloomGeometry");const TI=Ys([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),SI=Ys([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:CI}=TI,AI=Ys([{name:"a_packed",components:3,type:"Float32"}]),{members:RI}=AI,PI=Ys([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:II}=PI;class D2{constructor(o,g){this.width=o,this.height=g,this.nextRow=0,this.image=new K0({width:o,height:g}),this.positions={},this.uploaded=!1}getDash(o,g){const _e=this.getKey(o,g);return this.positions[_e]}trim(){const o=this.width,g=this.height=Yr(this.nextRow);this.image.resize({width:o,height:g})}getKey(o,g){return o.join(",")+g}getDashRanges(o,g,_e){const rt=[];let ot=o.length%2==1?-o[o.length-1]*_e:0,at=o[0]*_e,ut=!0;rt.push({left:ot,right:at,isDash:ut,zeroLength:o[0]===0});let ft=o[0];for(let xt=1;xt<o.length;xt++){ut=!ut;const Ct=o[xt];ot=ft*_e,ft+=Ct,at=ft*_e,rt.push({left:ot,right:at,isDash:ut,zeroLength:Ct===0})}return rt}addRoundDash(o,g,_e){const rt=g/2;for(let ot=-_e;ot<=_e;ot++){const at=this.width*(this.nextRow+_e+ot);let ut=0,ft=o[ut];for(let xt=0;xt<this.width;xt++){xt/ft.right>1&&(ft=o[++ut]);const Ct=Math.abs(xt-ft.left),Rt=Math.abs(xt-ft.right),kt=Math.min(Ct,Rt);let zt;const Ut=ot/_e*(rt+1);if(ft.isDash){const Kt=rt-Math.abs(Ut);zt=Math.sqrt(kt*kt+Kt*Kt)}else zt=rt-Math.sqrt(kt*kt+Ut*Ut);this.image.data[at+xt]=Math.max(0,Math.min(255,zt+128))}}}addRegularDash(o,g){for(let ft=o.length-1;ft>=0;--ft){const xt=o[ft],Ct=o[ft+1];xt.zeroLength?o.splice(ft,1):Ct&&Ct.isDash===xt.isDash&&(Ct.left=xt.left,o.splice(ft,1))}const _e=o[0],rt=o[o.length-1];_e.isDash===rt.isDash&&(_e.left=rt.left-this.width,rt.right=_e.right+this.width);const ot=this.width*this.nextRow;let at=0,ut=o[at];for(let ft=0;ft<this.width;ft++){ft/ut.right>1&&(ut=o[++at]);const xt=Math.abs(ft-ut.left),Ct=Math.abs(ft-ut.right),Rt=Math.min(xt,Ct);this.image.data[ot+ft]=Math.max(0,Math.min(255,(ut.isDash?Rt:-Rt)+g+128))}}addDash(o,g){const _e=this.getKey(o,g);if(this.positions[_e])return this.positions[_e];const rt=g==="round",ot=rt?7:0,at=2*ot+1;if(this.nextRow+at>this.height)return Wn("LineAtlas out of space"),null;o.length===0&&o.push(1);let ut=0;for(let Ct=0;Ct<o.length;Ct++)o[Ct]<0&&(Wn("Negative value is found in line dasharray, replacing values with 0"),o[Ct]=0),ut+=o[Ct];if(ut!==0){const Ct=this.width/ut,Rt=this.getDashRanges(o,this.width,Ct);rt?this.addRoundDash(Rt,Ct,ot):this.addRegularDash(Rt,g==="square"?.5*Ct:0)}const ft=this.nextRow+ot;this.nextRow+=at;const xt={tl:[ft,ot],br:[ut,0]};return this.positions[_e]=xt,xt}}Jn(D2,"LineAtlas");const kI=zr.types,MI=Math.cos(Math.PI/180*37.5),DI=Math.cos(Math.PI/180*5);class dS{constructor(o){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=o.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=o.overscaling,this.pixelRatio=o.pixelRatio,this.layers=o.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(g=>{this.gradients[g.id]={}}),this.layoutVertexArray=new l_,this.layoutVertexArray2=new tp,this.patternVertexArray=new tp,this.indexArray=new tu,this.programConfigurations=new Pp(o.layers,{zoom:o.zoom,lut:o.lut}),this.segments=new _l,this.maxLineLength=0,this.zOffsetVertexArray=new tp,this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.tessellationStep=o.tessellationStep?o.tessellationStep:jn/64,this.worldview=o.worldview,this.hasAppearances=null}updateFootprints(o,g){}updateAppearances(o,g,_e,rt){}populate(o,g,_e,rt){this.hasPattern=FT("line",this.layers,this.pixelRatio,g);const ot=this.layers[0].layout.get("line-sort-key");this.tileToMeter=ir(_e);const at=this.layers[0].layout.get("line-elevation-reference");if(at==="hd-road-markup")this.elevationType="road";else{const kt=this.layers[0].layout.get("line-z-offset"),zt=kt.isConstant()&&!kt.constantOr(0);this.elevationType=at!=="sea"&&at!=="ground"&&zt?"none":"offset",this.elevationType==="offset"&&at==="none"&&Wn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const ut=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&ut!==void 0;const ft=[];for(const{feature:kt,id:zt,index:Ut,sourceLayerIndex:Kt}of o){const er=this.layers[0]._featureFilter.needGeometry,Jt=Ur(kt,er);if(!this.layers[0]._featureFilter.filter(new Xo(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),Jt,_e))continue;const or=ot?ot.evaluate(Jt,{},_e):void 0,cr={id:zt,properties:kt.properties,type:kt.type,sourceLayerIndex:Kt,index:Ut,geometry:er?Jt.geometry:kr(kt,_e,rt),patterns:{},sortKey:or};ft.push(cr)}ot&&ft.sort((kt,zt)=>kt.sortKey-zt.sortKey);const{lineAtlas:xt,featureIndex:Ct}=g,Rt=this.addConstantDashes(xt);for(const kt of ft){const{geometry:zt,index:Ut,sourceLayerIndex:Kt}=kt;if(Rt&&this.addFeatureDashes(kt,xt),this.hasPattern){const er=BT("line",this.layers,kt,this.zoom,this.pixelRatio,g);this.patternFeatures.push(er)}else this.addFeature(kt,zt,Ut,_e,xt.positions,g.availableImages,g.brightness,g.elevationFeatures);Ct.insert(o[Ut].feature,zt,Ut,Kt,this.index)}}addConstantDashes(o){let g=!1;for(const _e of this.layers){const rt=_e.paint.get("line-dasharray").value,ot=_e.layout.get("line-cap").value;if(rt.kind!=="constant"||ot.kind!=="constant")g=!0;else{const at=ot.value,ut=rt.value;if(!ut)continue;o.addDash(ut,at)}}return g}addFeatureDashes(o,g){const _e=this.zoom;for(const rt of this.layers){const ot=rt.paint.get("line-dasharray").value,at=rt.layout.get("line-cap").value;if(ot.kind==="constant"&&at.kind==="constant")continue;let ut,ft;if(ot.kind==="constant"){if(ut=ot.value,!ut)continue}else ut=ot.evaluate({zoom:_e},o);ft=at.kind==="constant"?at.value:at.evaluate({zoom:_e},o),g.addDash(ut,ft),o.patterns[rt.id]=[g.getKey(ut,ft)]}}update(o,g,_e,rt,ot,at,ut,ft){this.programConfigurations.updatePaintArrays(o,g,ot,_e,rt,at,ut,ft)}addFeatures(o,g,_e,rt,ot,at){for(const ut of this.patternFeatures)this.addFeature(ut,ut.geometry,ut.index,g,_e,rt,at,o.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,RI)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=o.createVertexBuffer(this.patternVertexArray,II)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,SI.members,!0)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,CI),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o,g){let _e,rt;if(g&&g>0?(_e=`mapbox_clip_start_${g}`,rt=`mapbox_clip_end_${g}`):(_e="mapbox_clip_start",rt="mapbox_clip_end"),o.properties&&o.properties.hasOwnProperty(_e)&&o.properties.hasOwnProperty(rt))return{start:+o.properties[_e],end:+o.properties[rt]}}addFeature(o,g,_e,rt,ot,at,ut,ft){const xt=this.layers[0].layout,Ct=xt.get("line-join").evaluate(o,{}),Rt=xt.get("line-cap").evaluate(o,{}),kt=xt.get("line-miter-limit"),zt=xt.get("line-round-limit");this.lineClips=this.lineFeatureClips(o),this.lineFeature=o;const Ut=!(!o.properties||!o.properties.hasOwnProperty("mapbox_line_metrics"))&&o.properties.mapbox_line_metrics;this.zOffsetValue=xt.get("line-z-offset").value;const Kt=this.layers[0].paint.get("line-width").value;if(Kt.kind!=="constant"&&Kt.isLineProgressConstant===!1&&(this.variableWidthValue=Kt),this.elevationType==="road"){const er=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(o,g,rt,ft,Ct,Rt,kt,zt)){const[Jt,or]=this.clipRuntimeLinesToTile(g,1);for(let cr=0;cr<Jt.length;cr++){const pr=Jt[cr],Sr=or[cr],br={progress:{min:Sr.progress.min,max:Sr.progress.max},nextDir:this.computeSegNextDir(Sr,pr),prevDir:this.computeSegPrevDir(Sr,pr)};this.addLine(pr,o,rt,Ct,Rt,kt,zt,br,Ut&&Sr.parentIndex>0?Sr.parentIndex:null)}this.fillNonElevatedRoadSegment(er)}}else for(let er=0;er<g.length;er++)this.addLine(g[er],o,rt,Ct,Rt,kt,zt,void 0,Ut&&er>0?er:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,_e,ot,at,rt,ut,void 0,this.worldview)}computeSegNextDir(o,g){return o.nextPoint.sub(g.at(-2)).unit()}computeSegPrevDir(o,g){return g[1].sub(o.prevPoint).unit()}clipLinesToTile(o,g){return fE(o,-g,-g,jn+g,jn+g)}clipRuntimeLinesToTile(o,g){const _e=[];return[fE(o,-g,-g,jn+g,jn+g,_e),_e]}addElevatedRoadFeature(o,g,_e,rt,ot,at,ut,ft){const xt=[],Ct=To.getElevationFeature(o,rt);if(Ct){const Rt=this.clipLinesToTile(g,1),kt=this.prepareElevatedLines(Rt,Ct,_e);for(const zt of kt)xt.push({geometry:zt,elevation:Ct,elevationTileID:_e,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(xt.length===0)return!1;for(const Rt of xt){const kt=this.layoutVertexArray.length;this.addLine(Rt.geometry,o,_e,ot,at,ut,ft);const zt=new Do(_e,Rt.elevationTileID);if(Rt.elevation)for(let Ut=kt;Ut<this.layoutVertexArray.length;Ut++){const Kt=new _n(this.layoutVertexArray.int16[6*Ut]>>1,this.layoutVertexArray.int16[6*Ut+1]>>1),er=zt.pointElevation(Kt,Rt.elevation,.05);this.updateHeightRange(er),this.zOffsetVertexArray.emplaceBack(er,0,0)}else this.fillNonElevatedRoadSegment(kt)}return!0}prepareElevatedLines(o,g,_e){if(g.constantHeight!=null)return o;const rt=[],ot=1/ir(_e);for(const at of o)$P(at,new go(g,ot),0,rt);return rt}fillNonElevatedRoadSegment(o){for(let g=o;g<this.layoutVertexArray.length;g++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(o){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,o),this.heightRange.max=Math.max(this.heightRange.max,o)):this.heightRange={min:o,max:o}}addLine(o,g,_e,rt,ot,at,ut,ft,xt){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=xt?this.lineFeatureClips(g,xt):this.lineClips;const Ct=rt==="none";this.patternJoinNone=this.hasPattern&&Ct,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const Rt=ft&&ft.progress.min>0,kt=ft&&ft.progress.max<1;if(this.lineClips){let Or={min:this.lineClips.start,max:this.lineClips.end},nn=1;if(ft){const gn=this.lineClips.end-this.lineClips.start;Or=function(yn,Sn,An){return{min:Vo(yn.min,Sn,An),max:Vo(yn.max,Sn,An)}}(ft.progress,{min:0,max:1},Or),gn>0&&(nn=(Or.max-Or.min)/gn)}const $r=+g.properties.mapbox_clip_feature_len,un=+g.properties.mapbox_clip_seg_len;if(Number.isNaN($r)||Number.isNaN(un)){for(let yn=0;yn<o.length-1;yn++)this.totalDistance+=o[yn].dist(o[yn+1]);const gn=this.totalDistance/(Or.max-Or.min);this.totalFeatureLength=Number.isFinite(gn)?gn:0,this.lineClips.start=Or.min,this.lineClips.end=Or.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=$r,this.distance=un*nn,this.lineClips.start=Or.min,this.lineClips.end=Or.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const zt=kI[g.type]==="Polygon";let Ut=o.length;for(;Ut>=2&&o[Ut-1].equals(o[Ut-2]);)Ut--;let Kt=0;for(;Kt<Ut-1&&o[Kt].equals(o[Kt+1]);)Kt++;if(Ut<(zt?3:2))return;rt==="bevel"&&(at=1.05);const er=this.segments.prepareSegment(10*Ut,this.layoutVertexArray,this.indexArray);let Jt,or,cr,pr,Sr,br,Pr,Dr;ft&&ft.prevDir&&(br=ft.prevDir.perp()),ft&&ft.nextDir&&(Pr=ft.nextDir.perp()),this.e1=this.e2=-1,zt&&(Jt=o[Ut-2],Sr=o[Kt].sub(Jt)._unit()._perp());for(let Or=Kt;Or<Ut;Or++){if(cr=Or===Ut-1?zt?o[Kt+1]:void 0:o[Or+1],cr&&o[Or].equals(cr))continue;Sr&&(pr=Sr),Jt&&(or=Jt),Jt=o[Or],Dr=this.evaluateLineProgressFeatures(or?or.dist(Jt):0),Sr=cr?cr.sub(Jt)._unit()._perp():pr,pr=pr||Sr;const nn=or&&cr;let $r=nn?rt:zt||Ct?"butt":ot;const un=pr.x*Sr.x+pr.y*Sr.y;if(Ct){const on=function(Tn){if(Tn.patternJoinNone){const On=Tn.segmentPoints.length/2,kn=Tn.lineSoFar-Tn.segmentStart;for(let ls=0;ls<On;++ls){const Gn=Tn.segmentPoints[2*ls+1],Kn=Math.round(Tn.segmentPoints[2*ls])+.5+.25*Gn;Tn.patternVertexArray.emplaceBack(Kn,kn,Tn.segmentStart),Tn.patternVertexArray.emplaceBack(Kn,kn,Tn.segmentStart)}Tn.segmentPoints.length=0}Tn.e1=Tn.e2=-1};if(nn&&un<DI){this.updateDistance(or,Jt),this.addCurrentVertex(Jt,pr,1,1,er,Dr),on(this),this.addCurrentVertex(Jt,Sr,-1,-1,er,Dr);continue}if(or){if(!cr){this.updateDistance(or,Jt),this.addCurrentVertex(Jt,pr,1,1,er,Dr),on(this);continue}$r="miter"}}let gn=pr.add(Sr);gn.x===0&&gn.y===0||gn._unit();const yn=gn.x*Sr.x+gn.y*Sr.y,Sn=yn!==0?1/yn:1/0,An=2*Math.sqrt(2-2*yn),wn=yn<MI&&or&&cr,En=pr.x*Sr.y-pr.y*Sr.x>0,ln=this.overscaling<=16?15*jn/(512*this.overscaling):0;if(nn&&$r==="round"){if(Sn<ut)$r="miter";else if(Sn<=2){const on=pS(Jt,-10,jn+10);$r=this.elevationType==="offset"&&(on||this.hasCrossSlope)?"miter":"fakeround"}}if($r==="miter"&&Sn>at&&($r="bevel"),$r==="bevel"&&(Sn>2&&($r="flipbevel"),Sn<at&&($r="miter")),or&&!($r==="miter"&&wn)&&this.updateDistance(or,Jt),$r==="miter")if(wn){const on=Jt.dist(or);if(on>2*ln){const On=Jt.sub(Jt.sub(or)._mult(ln/on)._round());this.updateDistance(or,On),this.addCurrentVertex(On,pr,0,0,er,Dr),or=On}this.updateDistance(or,Jt),gn._mult(Sn),this.addCurrentVertex(Jt,gn,0,0,er,Dr);const Tn=Jt.dist(cr);if(Tn>2*ln){const On=Jt.add(cr.sub(Jt)._mult(ln/Tn)._round());this.updateDistance(Jt,On),this.addCurrentVertex(On,Sr,0,0,er,Dr),Jt=On}}else gn._mult(Sn),this.addCurrentVertex(Jt,gn,0,0,er,Dr);else if($r==="flipbevel"){if(Sn>100)gn=Sr.mult(-1);else{const on=Sn*pr.add(Sr).mag()/pr.sub(Sr).mag();gn._perp()._mult(on*(En?-1:1))}this.addCurrentVertex(Jt,gn,0,0,er,Dr),this.addCurrentVertex(Jt,gn.mult(-1),0,0,er,Dr)}else if($r==="bevel"||$r==="fakeround"){Dr!=null&&or&&this.addCurrentVertex(Jt,Pr||pr,-1,-1,er,Dr);const on=Jt.dist(or)<=2*ln&&$r!=="bevel",Tn=gn.mult(En?1:-1);Tn._mult(Sn);const On=Sr.mult(En?-1:1),kn=pr.mult(En?-1:1),ls=this.evaluateLineProgressFeatures(this.distance);if(Dr==null&&(this.addHalfVertex(Jt,Tn.x,Tn.y,!1,!En,0,er,ls),on||this.addHalfVertex(Jt,Tn.x+2*kn.x,Tn.y+2*kn.y,!1,En,0,er,ls)),$r==="fakeround"){const Gn=Math.round(180*An/Math.PI/20);this.addHalfVertex(Jt,kn.x,kn.y,!1,En,0,er,ls);for(let Kn=0;Kn<Gn;Kn++){let ts=Kn/Gn;if(ts!==.5){const Dn=ts-.5;ts+=ts*Dn*(ts-1)*((1.0904+un*(un*(3.55645-1.43519*un)-3.2452))*Dn*Dn+(.848013+un*(.215638*un-1.06021)))}const qs=On.sub(kn)._mult(ts)._add(kn)._unit();this.addHalfVertex(Jt,qs.x,qs.y,!1,En,0,er,ls)}this.addHalfVertex(Jt,On.x,On.y,!1,En,0,er,ls)}on||Dr!=null||this.addHalfVertex(Jt,Tn.x+2*On.x,Tn.y+2*On.y,!1,En,0,er,ls),Dr!=null&&cr&&this.addCurrentVertex(Jt,br||Sr,1,1,er,Dr)}else if($r==="butt")this.addCurrentVertex(Jt,gn,0,0,er,Dr);else if($r==="square"){if(!or){const on=Rt?0:-1;this.addCurrentVertex(Jt,gn,on,on,er,Dr)}if(this.addCurrentVertex(Jt,gn,0,0,er,Dr),or){const on=kt?0:1;this.addCurrentVertex(Jt,gn,on,on,er,Dr)}}else if($r==="round"){if(or){const on=!nn&&Pr?Pr:pr;this.addCurrentVertex(Jt,on,0,0,er,Dr),!nn&&kt||this.addCurrentVertex(Jt,on,1,1,er,Dr,!0)}if(cr){const on=!nn&&br?br:Sr;!nn&&Rt||this.addCurrentVertex(Jt,on,-1,-1,er,Dr,!0),this.addCurrentVertex(Jt,on,0,0,er,Dr)}}}}addVerticesTo(o,g,_e,rt,ot,at,ut,ft,xt,Ct){const Rt=(g.w-o.w)/this.tessellationStep|0;let kt=0;const zt=this.scaledDistance;if(Rt>1){this.lineSoFar=o.w;const Kt=(g.x-o.x)/Rt,er=(g.y-o.y)/Rt,Jt=(g.z-o.z)/Rt,or=(g.w-o.w)/Rt;for(let cr=1;cr<Rt;++cr){o.x+=Kt,o.y+=er,o.z+=Jt,this.lineSoFar+=or,kt+=or;const pr=this.evaluateLineProgressFeatures(this.prevDistance+kt);this.scaledDistance=(this.prevDistance+kt)/this.totalDistance,this.addHalfVertex(o,_e,rt,Ct,!1,ut,xt,pr),this.addHalfVertex(o,ot,at,Ct,!0,-ft,xt,pr)}}this.lineSoFar=g.w,this.scaledDistance=zt;const Ut=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(g,_e,rt,Ct,!1,ut,xt,Ut),this.addHalfVertex(g,ot,at,Ct,!0,-ft,xt,Ut)}evaluateLineProgressFeatures(o){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+o)/this.totalFeatureLength):Wn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let g=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(g=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:g}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:g}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:g}}addCurrentVertex(o,g,_e,rt,ot,at,ut=!1){const ft=g.x+g.y*_e,xt=g.y-g.x*_e,Ct=g.y*rt-g.x,Rt=-g.y-g.x*rt;if(at!=null){const kt=this.elevationType==="offset",zt=-10,Ut=jn+10,Kt=at.zOffset,er=new t2(o.x,o.y,Kt,this.lineSoFar),Jt=!!kt&&pS(o,zt,Ut),or=this.lineSoFar,cr=this.distance;if(this.currentVertex)if(Jt){const pr=this.currentVertexIsOutside,Sr=this.currentVertex,br=new t2(o.x,o.y,Kt,this.lineSoFar);if(n2(Sr,br,zt,Ut),!pS(br,zt,Ut)){if(pr){this.e1=this.e2=-1,this.distance-=Sr.dist(er),this.lineSoFar=Sr.w;const Pr=this.evaluateLineProgressFeatures(Sr.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Sr,ft,xt,ut,!1,_e,ot,Pr),this.addHalfVertex(Sr,Ct,Rt,ut,!0,-rt,ot,Pr),this.prevDistance=this.distance}this.distance=this.prevDistance+Sr.dist(br),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Sr,br,ft,xt,Ct,Rt,_e,rt,ot,ut),this.distance=cr,this.scaledDistance=this.distance/this.totalDistance}}else{const pr=this.currentVertex;if(this.currentVertexIsOutside){n2(pr,er,zt,Ut),this.e1=this.e2=-1,this.distance-=pr.dist(er),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=pr.w;const Sr=this.evaluateLineProgressFeatures(pr.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(pr,ft,xt,ut,!1,_e,ot,Sr),this.addHalfVertex(pr,Ct,Rt,ut,!0,-rt,ot,Sr),this.prevDistance=this.distance,this.distance=cr,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(pr,er,ft,xt,Ct,Rt,_e,rt,ot,ut)}else Jt||(this.addHalfVertex(o,ft,xt,ut,!1,_e,ot,at),this.addHalfVertex(o,Ct,Rt,ut,!0,-rt,ot,at));this.currentVertex=er,this.currentVertexIsOutside=Jt,this.lineSoFar=or}else this.addHalfVertex(o,ft,xt,ut,!1,_e,ot,at),this.addHalfVertex(o,Ct,Rt,ut,!0,-rt,ot,at)}addHalfVertex({x:o,y:g},_e,rt,ot,at,ut,ft,xt){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),at||this.segmentPoints.push(this.lineSoFar-this.segmentStart,ut)),this.layoutVertexArray.emplaceBack((o<<1)+(ot?1:0),(g<<1)+(at?1:0),Math.round(63*_e)+128,Math.round(63*rt)+128,1+(ut===0?0:ut<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const Rt=Cs(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,Rt)}const Ct=ft.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Ct),ft.primitiveLength++),at?this.e2=Ct:this.e1=Ct,xt!=null&&this.zOffsetVertexArray.emplaceBack(xt.zOffset,xt.variableWidth,xt.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(o,g){this.prevDistance=this.distance,this.distance+=o.dist(g),this.updateScaledDistance()}}function pS(b,o,g){return b.x<o||b.x>g||b.y<o||b.y>g}let N2,L2;function j2(b,o,g){return o*(jn/(b.tileSize*Math.pow(2,g-b.tileID.overscaledZ)))}Jn(dS,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const O2=(b,o,g)=>(1-g)*b+g*o;function F2(b,o){return 1/j2(b,1,o.tileZoom)}function B2(b,o,g,_e){return b.translatePosMatrix(_e||o.tileID.projMatrix,o,g.paint.get("line-translate"),g.paint.get("line-translate-anchor"))}const z2=b=>{const o=[];V2(b)&&o.push("RENDER_LINE_DASH"),b.paint.get("line-gradient")&&o.push("RENDER_LINE_GRADIENT");const g=b.paint.get("line-trim-offset");g[0]===0&&g[1]===0||o.push("RENDER_LINE_TRIM_OFFSET"),b.paint.get("line-border-width").constantOr(1)!==0&&o.push("RENDER_LINE_BORDER");const _e=b.layout.get("line-join").constantOr("miter")==="none",rt=!!b.paint.get("line-pattern").constantOr(1);return _e&&rt&&o.push("LINE_JOIN_NONE"),o};function V2(b){const o=b.paint.get("line-dasharray").value;return o.kind!=="constant"||o.value}let fS;const U2=()=>fS||(fS={layout:N2||(N2=new Dl({"line-cap":new Bn(Hr.layout_line["line-cap"]),"line-join":new Bn(Hr.layout_line["line-join"]),"line-miter-limit":new Nn(Hr.layout_line["line-miter-limit"]),"line-round-limit":new Nn(Hr.layout_line["line-round-limit"]),"line-sort-key":new Bn(Hr.layout_line["line-sort-key"]),"line-z-offset":new Bn(Hr.layout_line["line-z-offset"]),"line-elevation-reference":new Nn(Hr.layout_line["line-elevation-reference"]),"line-cross-slope":new Nn(Hr.layout_line["line-cross-slope"]),visibility:new Nn(Hr.layout_line.visibility),"line-width-unit":new Nn(Hr.layout_line["line-width-unit"])})),paint:L2||(L2=new Dl({"line-opacity":new Bn(Hr.paint_line["line-opacity"]),"line-color":new Bn(Hr.paint_line["line-color"]),"line-translate":new Nn(Hr.paint_line["line-translate"]),"line-translate-anchor":new Nn(Hr.paint_line["line-translate-anchor"]),"line-width":new Bn(Hr.paint_line["line-width"]),"line-gap-width":new Bn(Hr.paint_line["line-gap-width"]),"line-offset":new Bn(Hr.paint_line["line-offset"]),"line-blur":new Bn(Hr.paint_line["line-blur"]),"line-dasharray":new Bn(Hr.paint_line["line-dasharray"]),"line-pattern":new Bn(Hr.paint_line["line-pattern"]),"line-pattern-cross-fade":new Nn(Hr.paint_line["line-pattern-cross-fade"]),"line-gradient":new l0(Hr.paint_line["line-gradient"]),"line-trim-offset":new Nn(Hr.paint_line["line-trim-offset"]),"line-trim-fade-range":new Nn(Hr.paint_line["line-trim-fade-range"]),"line-trim-color":new Nn(Hr.paint_line["line-trim-color"]),"line-emissive-strength":new Bn(Hr.paint_line["line-emissive-strength"]),"line-border-width":new Bn(Hr.paint_line["line-border-width"]),"line-border-color":new Bn(Hr.paint_line["line-border-color"]),"line-occlusion-opacity":new Nn(Hr.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"})}))},fS);class NI extends Bn{possiblyEvaluate(o,g){return g=new Xo(Math.floor(g.zoom),{now:g.now,fadeDuration:g.fadeDuration,transition:g.transition,worldview:g.worldview}),super.possiblyEvaluate(o,g)}evaluate(o,g,_e,rt){return g=Object.assign({},g,{zoom:Math.floor(g.zoom)}),super.evaluate(o,g,_e,rt)}}let A1;function $2(b,o){return o>0?o+2*b:b}const LI=Ys([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),jI=Ys([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),OI=Ys([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ys([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const FI=Ys([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),BI=Ys([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),zI=Ys([{name:"a_texb",components:2,type:"Uint16"}]),VI=Ys([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),UI=Ys([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Ys([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const G2=Ys([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$I=Ys([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ys([{name:"triangle",components:3,type:"Uint16"}]),Ys([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ys([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Ys([{type:"Float32",name:"offsetX"}]),Ys([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var pu=24;function GI(b,o,g){return b.sections.forEach(_e=>{_e.text=function(rt,ot,at){const ut=ot.layout.get("text-transform").evaluate(at,{});return ut==="uppercase"?rt=rt.toLocaleUpperCase():ut==="lowercase"&&(rt=rt.toLocaleLowerCase()),im.applyArabicShaping&&(rt=im.applyArabicShaping(rt)),rt}(_e.text,o,g)}),b}const R1={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function HI(b){return b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""}function WI(b){return b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""}const mS=4294967296,H2=1/mS,W2=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let SE=class{constructor(b=new Uint8Array(16)){this.buf=ArrayBuffer.isView(b)?b:new Uint8Array(b),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(b,o,g=this.length){for(;this.pos<g;){const _e=this.readVarint(),rt=_e>>3,ot=this.pos;this.type=7&_e,b(rt,o,this),this.pos===ot&&this.skip(_e)}return o}readMessage(b,o){return this.readFields(b,o,this.readVarint()+this.pos)}readFixed32(){const b=this.dataView.getUint32(this.pos,!0);return this.pos+=4,b}readSFixed32(){const b=this.dataView.getInt32(this.pos,!0);return this.pos+=4,b}readFixed64(){const b=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*mS;return this.pos+=8,b}readSFixed64(){const b=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*mS;return this.pos+=8,b}readFloat(){const b=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,b}readDouble(){const b=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,b}readVarint(b){const o=this.buf;let g,_e;return _e=o[this.pos++],g=127&_e,_e<128?g:(_e=o[this.pos++],g|=(127&_e)<<7,_e<128?g:(_e=o[this.pos++],g|=(127&_e)<<14,_e<128?g:(_e=o[this.pos++],g|=(127&_e)<<21,_e<128?g:(_e=o[this.pos],g|=(15&_e)<<28,function(rt,ot,at){const ut=at.buf;let ft,xt;if(xt=ut[at.pos++],ft=(112&xt)>>4,xt<128||(xt=ut[at.pos++],ft|=(127&xt)<<3,xt<128)||(xt=ut[at.pos++],ft|=(127&xt)<<10,xt<128)||(xt=ut[at.pos++],ft|=(127&xt)<<17,xt<128)||(xt=ut[at.pos++],ft|=(127&xt)<<24,xt<128)||(xt=ut[at.pos++],ft|=(1&xt)<<31,xt<128))return N_(rt,ft,ot);throw new Error("Expected varint not more than 10 bytes")}(g,b,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const b=this.readVarint();return b%2==1?(b+1)/-2:b/2}readBoolean(){return!!this.readVarint()}readString(){const b=this.readVarint()+this.pos,o=this.pos;return this.pos=b,b-o>=12&&W2?W2.decode(this.buf.subarray(o,b)):function(g,_e,rt){let ot="",at=_e;for(;at<rt;){const ut=g[at];let ft,xt,Ct,Rt=null,kt=ut>239?4:ut>223?3:ut>191?2:1;if(at+kt>rt)break;kt===1?ut<128&&(Rt=ut):kt===2?(ft=g[at+1],(192&ft)==128&&(Rt=(31&ut)<<6|63&ft,Rt<=127&&(Rt=null))):kt===3?(ft=g[at+1],xt=g[at+2],(192&ft)==128&&(192&xt)==128&&(Rt=(15&ut)<<12|(63&ft)<<6|63&xt,(Rt<=2047||Rt>=55296&&Rt<=57343)&&(Rt=null))):kt===4&&(ft=g[at+1],xt=g[at+2],Ct=g[at+3],(192&ft)==128&&(192&xt)==128&&(192&Ct)==128&&(Rt=(15&ut)<<18|(63&ft)<<12|(63&xt)<<6|63&Ct,(Rt<=65535||Rt>=1114112)&&(Rt=null))),Rt===null?(Rt=65533,kt=1):Rt>65535&&(Rt-=65536,ot+=String.fromCharCode(Rt>>>10&1023|55296),Rt=56320|1023&Rt),ot+=String.fromCharCode(Rt),at+=kt}return ot}(this.buf,o,b)}readBytes(){const b=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,b);return this.pos=b,o}readPackedVarint(b=[],o){const g=this.readPackedEnd();for(;this.pos<g;)b.push(this.readVarint(o));return b}readPackedSVarint(b=[]){const o=this.readPackedEnd();for(;this.pos<o;)b.push(this.readSVarint());return b}readPackedBoolean(b=[]){const o=this.readPackedEnd();for(;this.pos<o;)b.push(this.readBoolean());return b}readPackedFloat(b=[]){const o=this.readPackedEnd();for(;this.pos<o;)b.push(this.readFloat());return b}readPackedDouble(b=[]){const o=this.readPackedEnd();for(;this.pos<o;)b.push(this.readDouble());return b}readPackedFixed32(b=[]){const o=this.readPackedEnd();for(;this.pos<o;)b.push(this.readFixed32());return b}readPackedSFixed32(b=[]){const o=this.readPackedEnd();for(;this.pos<o;)b.push(this.readSFixed32());return b}readPackedFixed64(b=[]){const o=this.readPackedEnd();for(;this.pos<o;)b.push(this.readFixed64());return b}readPackedSFixed64(b=[]){const o=this.readPackedEnd();for(;this.pos<o;)b.push(this.readSFixed64());return b}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(b){const o=7&b;if(o===0)for(;this.buf[this.pos++]>127;);else if(o===2)this.pos=this.readVarint()+this.pos;else if(o===5)this.pos+=4;else{if(o!==1)throw new Error(`Unimplemented type: ${o}`);this.pos+=8}}writeTag(b,o){this.writeVarint(b<<3|o)}realloc(b){let o=this.length||16;for(;o<this.pos+b;)o*=2;if(o!==this.length){const g=new Uint8Array(o);g.set(this.buf),this.buf=g,this.dataView=new DataView(g.buffer),this.length=o}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(b){this.realloc(4),this.dataView.setInt32(this.pos,b,!0),this.pos+=4}writeSFixed32(b){this.realloc(4),this.dataView.setInt32(this.pos,b,!0),this.pos+=4}writeFixed64(b){this.realloc(8),this.dataView.setInt32(this.pos,-1&b,!0),this.dataView.setInt32(this.pos+4,Math.floor(b*H2),!0),this.pos+=8}writeSFixed64(b){this.realloc(8),this.dataView.setInt32(this.pos,-1&b,!0),this.dataView.setInt32(this.pos+4,Math.floor(b*H2),!0),this.pos+=8}writeVarint(b){(b=+b||0)>268435455||b<0?function(o,g){let _e,rt;if(o>=0?(_e=o%4294967296|0,rt=o/4294967296|0):(_e=~(-o%4294967296),rt=~(-o/4294967296),4294967295^_e?_e=_e+1|0:(_e=0,rt=rt+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");g.realloc(10),function(ot,at,ut){ut.buf[ut.pos++]=127&ot|128,ot>>>=7,ut.buf[ut.pos++]=127&ot|128,ot>>>=7,ut.buf[ut.pos++]=127&ot|128,ot>>>=7,ut.buf[ut.pos++]=127&ot|128,ut.buf[ut.pos]=127&(ot>>>=7)}(_e,0,g),function(ot,at){const ut=(7&ot)<<4;at.buf[at.pos++]|=ut|((ot>>>=3)?128:0),ot&&(at.buf[at.pos++]=127&ot|((ot>>>=7)?128:0),ot&&(at.buf[at.pos++]=127&ot|((ot>>>=7)?128:0),ot&&(at.buf[at.pos++]=127&ot|((ot>>>=7)?128:0),ot&&(at.buf[at.pos++]=127&ot|((ot>>>=7)?128:0),ot&&(at.buf[at.pos++]=127&ot)))))}(rt,g)}(b,this):(this.realloc(4),this.buf[this.pos++]=127&b|(b>127?128:0),b<=127||(this.buf[this.pos++]=127&(b>>>=7)|(b>127?128:0),b<=127||(this.buf[this.pos++]=127&(b>>>=7)|(b>127?128:0),b<=127||(this.buf[this.pos++]=b>>>7&127))))}writeSVarint(b){this.writeVarint(b<0?2*-b-1:2*b)}writeBoolean(b){this.writeVarint(+b)}writeString(b){b=String(b),this.realloc(4*b.length),this.pos++;const o=this.pos;this.pos=function(_e,rt,ot){for(let at,ut,ft=0;ft<rt.length;ft++){if(at=rt.charCodeAt(ft),at>55295&&at<57344){if(!ut){at>56319||ft+1===rt.length?(_e[ot++]=239,_e[ot++]=191,_e[ot++]=189):ut=at;continue}if(at<56320){_e[ot++]=239,_e[ot++]=191,_e[ot++]=189,ut=at;continue}at=ut-55296<<10|at-56320|65536,ut=null}else ut&&(_e[ot++]=239,_e[ot++]=191,_e[ot++]=189,ut=null);at<128?_e[ot++]=at:(at<2048?_e[ot++]=at>>6|192:(at<65536?_e[ot++]=at>>12|224:(_e[ot++]=at>>18|240,_e[ot++]=at>>12&63|128),_e[ot++]=at>>6&63|128),_e[ot++]=63&at|128)}return ot}(this.buf,b,this.pos);const g=this.pos-o;g>=128&&q2(o,g,this),this.pos=o-1,this.writeVarint(g),this.pos+=g}writeFloat(b){this.realloc(4),this.dataView.setFloat32(this.pos,b,!0),this.pos+=4}writeDouble(b){this.realloc(8),this.dataView.setFloat64(this.pos,b,!0),this.pos+=8}writeBytes(b){const o=b.length;this.writeVarint(o),this.realloc(o);for(let g=0;g<o;g++)this.buf[this.pos++]=b[g]}writeRawMessage(b,o){this.pos++;const g=this.pos;b(o,this);const _e=this.pos-g;_e>=128&&q2(g,_e,this),this.pos=g-1,this.writeVarint(_e),this.pos+=_e}writeMessage(b,o,g){this.writeTag(b,2),this.writeRawMessage(o,g)}writePackedVarint(b,o){o.length&&this.writeMessage(b,qI,o)}writePackedSVarint(b,o){o.length&&this.writeMessage(b,KI,o)}writePackedBoolean(b,o){o.length&&this.writeMessage(b,YI,o)}writePackedFloat(b,o){o.length&&this.writeMessage(b,XI,o)}writePackedDouble(b,o){o.length&&this.writeMessage(b,ZI,o)}writePackedFixed32(b,o){o.length&&this.writeMessage(b,QI,o)}writePackedSFixed32(b,o){o.length&&this.writeMessage(b,JI,o)}writePackedFixed64(b,o){o.length&&this.writeMessage(b,_k,o)}writePackedSFixed64(b,o){o.length&&this.writeMessage(b,eM,o)}writeBytesField(b,o){this.writeTag(b,2),this.writeBytes(o)}writeFixed32Field(b,o){this.writeTag(b,5),this.writeFixed32(o)}writeSFixed32Field(b,o){this.writeTag(b,5),this.writeSFixed32(o)}writeFixed64Field(b,o){this.writeTag(b,1),this.writeFixed64(o)}writeSFixed64Field(b,o){this.writeTag(b,1),this.writeSFixed64(o)}writeVarintField(b,o){this.writeTag(b,0),this.writeVarint(o)}writeSVarintField(b,o){this.writeTag(b,0),this.writeSVarint(o)}writeStringField(b,o){this.writeTag(b,2),this.writeString(o)}writeFloatField(b,o){this.writeTag(b,5),this.writeFloat(o)}writeDoubleField(b,o){this.writeTag(b,1),this.writeDouble(o)}writeBooleanField(b,o){this.writeVarintField(b,+o)}};function N_(b,o,g){return g?4294967296*o+(b>>>0):4294967296*(o>>>0)+(b>>>0)}function q2(b,o,g){const _e=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));g.realloc(_e);for(let rt=g.pos-1;rt>=b;rt--)g.buf[rt+_e]=g.buf[rt]}function qI(b,o){for(let g=0;g<b.length;g++)o.writeVarint(b[g])}function KI(b,o){for(let g=0;g<b.length;g++)o.writeSVarint(b[g])}function XI(b,o){for(let g=0;g<b.length;g++)o.writeFloat(b[g])}function ZI(b,o){for(let g=0;g<b.length;g++)o.writeDouble(b[g])}function YI(b,o){for(let g=0;g<b.length;g++)o.writeBoolean(b[g])}function QI(b,o){for(let g=0;g<b.length;g++)o.writeFixed32(b[g])}function JI(b,o){for(let g=0;g<b.length;g++)o.writeSFixed32(b[g])}function _k(b,o){for(let g=0;g<b.length;g++)o.writeFixed64(b[g])}function eM(b,o){for(let g=0;g<b.length;g++)o.writeSFixed64(b[g])}const gS=3;function tM(b,o,g){o.glyphs=[],b===1&&g.readMessage(rM,o)}function rM(b,o,g){if(b===3){const{id:_e,bitmap:rt,width:ot,height:at,left:ut,top:ft,advance:xt}=g.readMessage(nM,{});o.glyphs.push({id:_e,bitmap:new K0({width:ot+2*gS,height:at+2*gS},rt),metrics:{width:ot,height:at,left:ut,top:ft,advance:xt}})}else b===4?o.ascender=g.readSVarint():b===5&&(o.descender=g.readSVarint())}function nM(b,o,g){b===1?o.id=g.readVarint():b===2?o.bitmap=g.readBytes():b===3?o.width=g.readVarint():b===4?o.height=g.readVarint():b===5?o.left=g.readSVarint():b===6?o.top=g.readSVarint():b===7&&(o.advance=g.readVarint())}const K2=gS,ap={horizontal:1,vertical:2,horizontalOnly:3};class P1{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(o,g){const _e=new P1;return _e.scale=o||1,_e.fontStack=g,_e}static forImage(o){const g=new P1;return g.image=o,g}}class L_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,g,_e){const rt=new L_;for(let ot=0;ot<o.sections.length;ot++){const at=o.sections[ot];at.image?rt.addImageSection(at,_e):rt.addTextSection(at,g)}return rt}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCodePoint(o){return this.text.codePointAt(o)}verticalizePunctuation(o){this.text=function(g,_e){let rt="";for(let ot=0;ot<g.length;ot++){const at=g.charCodeAt(ot+1)||null,ut=g.charCodeAt(ot-1)||null;rt+=!_e&&(at&&Yx(at)&&!R1[g[ot+1]]||ut&&Yx(ut)&&!R1[g[ot-1]])||!R1[g[ot]]?g[ot]:R1[g[ot]]}return rt}(this.text,o)}trim(){let o=0;for(let _e=0;_e<this.text.length&&CE[this.text.charCodeAt(_e)];_e++)o++;let g=this.text.length;for(let _e=this.text.length-1;_e>=0&&_e>=o&&CE[this.text.charCodeAt(_e)];_e--)g--;this.text=this.text.substring(o,g),this.sectionIndex=this.sectionIndex.slice(o,g)}substring(o,g){const _e=new L_;return _e.text=this.text.substring(o,g),_e.sectionIndex=this.sectionIndex.slice(o,g),_e.sections=this.sections,_e}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,g)=>Math.max(o,this.sections[g].scale),0)}addTextSection(o,g){this.text+=o.text,this.sections.push(P1.forText(o.scale,o.fontStack||g));const _e=this.sections.length-1;for(let rt=0;rt<o.text.length;++rt)this.sectionIndex.push(_e)}addImageSection(o,g){const _e=o.image?o.image.getPrimary():null;if(!_e)return void Wn("Can't add FormattedSection with an empty image.");_e.scaleSelf(g);const rt=this.getNextImageSectionCharCode();rt?(this.text+=String.fromCodePoint(rt),this.sections.push(P1.forImage(_e)),this.sectionIndex.push(this.sections.length-1)):Wn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function yS(b,o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt,Ut,Kt=1){const er=L_.fromFeature(b,rt,Kt);Rt===ap.vertical&&er.verticalizePunctuation(kt);let Jt=[];const or=function(Pr,Dr,Or,nn,$r,un){if(!Pr)return[];const gn=[],yn=function(En,ln,on,Tn,On,kn){let ls=0;for(let Gn=0;Gn<En.length();Gn++){const Kn=En.getSection(Gn);ls+=X2(En.getCodePoint(Gn),Kn,Tn,On,ln,kn)}return ls/Math.max(1,Math.ceil(ls/on))}(Pr,Dr,Or,nn,$r,un),Sn=Pr.text.indexOf("")>=0;let An=0;for(let En=0;En<Pr.length();En++){const ln=Pr.getSection(En),on=Pr.getCodePoint(En);if(CE[on]||(An+=X2(on,ln,nn,$r,Dr,un)),En<Pr.length()-1){const Tn=!((wn=on)<11904||!(vs["Bopomofo Extended"](wn)||vs.Bopomofo(wn)||vs["CJK Compatibility Forms"](wn)||vs["CJK Compatibility Ideographs"](wn)||vs["CJK Compatibility"](wn)||vs["CJK Radicals Supplement"](wn)||vs["CJK Strokes"](wn)||vs["CJK Symbols and Punctuation"](wn)||vs["CJK Unified Ideographs Extension A"](wn)||vs["CJK Unified Ideographs"](wn)||vs["Enclosed CJK Letters and Months"](wn)||vs["Halfwidth and Fullwidth Forms"](wn)||vs.Hiragana(wn)||vs["Ideographic Description Characters"](wn)||vs["Kangxi Radicals"](wn)||vs["Katakana Phonetic Extensions"](wn)||vs.Katakana(wn)||vs["Vertical Forms"](wn)||vs["Yi Radicals"](wn)||vs["Yi Syllables"](wn)));(iM[on]||Tn||ln.image)&&gn.push(Y2(En+1,An,yn,gn,sM(on,Pr.getCodePoint(En+1),Tn&&Sn),!1))}}var wn;return Q2(Y2(Pr.length(),An,yn,gn,0,!0))}(er,xt,ot,o,_e,zt),{processBidirectionalText:cr,processStyledBidirectionalText:pr}=im;if(cr&&er.sections.length===1){const Pr=cr(er.toString(),or);for(const Dr of Pr){const Or=new L_;Or.text=Dr,Or.sections=er.sections;for(let nn=0;nn<Dr.length;nn++)Or.sectionIndex.push(0);Jt.push(Or)}}else if(pr){const Pr=pr(er.text,er.sectionIndex,or);for(const Dr of Pr){const Or=new L_;Or.text=Dr[0],Or.sectionIndex=Dr[1],Or.sections=er.sections,Jt.push(Or)}}else Jt=function(Pr,Dr){const Or=[],nn=Pr.text;let $r=0;for(const un of Dr)Or.push(Pr.substring($r,un)),$r=un;return $r<nn.length&&Or.push(Pr.substring($r,nn.length)),Or}(er,or);const Sr=[],br={positionedLines:Sr,text:er.toString(),top:Ct[1],bottom:Ct[1],left:Ct[0],right:Ct[0],writingMode:Rt,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Pr,Dr,Or,nn,$r,un,gn,yn,Sn,An,wn,En){let ln=0,on=0,Tn=0;const On=yn==="right"?1:yn==="left"?0:.5;let kn=!1;for(const Dn of $r){const rs=Dn.getSections();for(const Ms of rs){if(Ms.image)continue;const ro=Dr[Ms.fontStack];if(ro&&(kn=ro.ascender!==void 0&&ro.descender!==void 0,!kn))break}if(!kn)break}let ls=0;for(const Dn of $r){Dn.trim();const rs=Dn.getMaxScale(),Ms=(rs-1)*pu,ro={positionedGlyphs:[],lineOffset:0};Pr.positionedLines[ls]=ro;const so=ro.positionedGlyphs;let Os=0;if(!Dn.length()){on+=un,++ls;continue}let No=0,wr=0;for(let hn=0;hn<Dn.length();hn++){const Cn=Dn.getSection(hn),Vn=Dn.getSectionIndex(hn),Un=Dn.getCodePoint(hn);let cs=Cn.scale,ps=null,Ls=null,$s=null,Ws=pu,Qs=0,Es=Sn;Es===ap.vertical&&((Gn=Un)===12312||Gn===12313||Gn===12316||Gn===12540||Gn===12448)&&(Es=ap.horizontal);const Is=!(Es===ap.horizontal||!wn&&!Zx(Un)||wn&&(CE[Un]||Qx(Un)));if(Cn.image){const ho=nn.get(Cn.image.toString());if(!ho)continue;$s=Cn.image,Pr.iconsInText=Pr.iconsInText||!0,Ls=ho.paddedRect;const yo=ho.displaySize;cs=cs*pu/En,ps={width:yo[0],height:yo[1],left:0,top:-K2,advance:Is?yo[1]:yo[0],localGlyph:!1},Qs=kn?-ps.height*cs:rs*pu-17-yo[1]*cs,Ws=ps.advance;const xo=(Is?yo[0]:yo[1])*cs-pu*rs;xo>0&&xo>Os&&(Os=xo)}else{const ho=Or[Cn.fontStack];if(!ho)continue;ho[Un]&&(Ls=ho[Un]);const yo=Dr[Cn.fontStack];if(!yo)continue;const xo=yo.glyphs[Un];if(!xo)continue;if(ps=xo.metrics,Ws=Un!==8203?pu:0,kn){const Io=yo.ascender!==void 0?Math.abs(yo.ascender):0,Bo=yo.descender!==void 0?Math.abs(yo.descender):0,Lo=(Io+Bo)*cs;No<Lo&&(No=Lo,wr=(Io-Bo)/2*cs),Qs=-Io*cs}else Qs=(rs-cs)*pu-17}Is?(Pr.verticalizable=!0,so.push({glyph:Un,image:$s,x:ln,y:on+Qs,vertical:Is,scale:cs,localGlyph:ps.localGlyph,fontStack:Cn.fontStack,sectionIndex:Vn,metrics:ps,rect:Ls}),ln+=Ws*cs+An):(so.push({glyph:Un,image:$s,x:ln,y:on+Qs,vertical:Is,scale:cs,localGlyph:ps.localGlyph,fontStack:Cn.fontStack,sectionIndex:Vn,metrics:ps,rect:Ls}),ln+=ps.advance*cs+An)}so.length!==0&&(Tn=Math.max(ln-An,Tn),kn?J2(so,On,Os,wr,un*rs/2):J2(so,On,Os,0,un/2)),ln=0;const Cr=un*rs+Os;ro.lineOffset=Math.max(Os,Ms),on+=Cr,++ls}var Gn;const Kn=on,{horizontalAlign:ts,verticalAlign:qs}=xS(gn);(function(Dn,rs,Ms,ro,so,Os){const No=(rs-Ms)*so,wr=-Os*ro;for(const Cr of Dn)for(const hn of Cr.positionedGlyphs)hn.x+=No,hn.y+=wr})(Pr.positionedLines,On,ts,qs,Tn,Kn),Pr.top+=-qs*Kn,Pr.bottom=Pr.top+Kn,Pr.left+=-ts*Tn,Pr.right=Pr.left+Tn,Pr.hasBaseline=kn}(br,o,g,_e,Jt,at,ut,ft,Rt,xt,kt,Ut),!function(Pr){for(const Dr of Pr)if(Dr.positionedGlyphs.length!==0)return!1;return!0}(Sr))return br}const CE={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},iM={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function X2(b,o,g,_e,rt,ot){if(o.image){const at=_e.get(o.image.toString());return at?at.displaySize[0]*o.scale*pu/ot+rt:0}{const at=g[o.fontStack],ut=at&&at.glyphs[b];return ut?ut.metrics.advance*o.scale+rt:0}}function Z2(b,o,g,_e){const rt=Math.pow(b-o,2);return _e?b<o?rt/2:2*rt:rt+Math.abs(g)*g}function sM(b,o,g){let _e=0;return b===10&&(_e-=1e4),g&&(_e+=150),b!==40&&b!==65288||(_e+=50),o!==41&&o!==65289||(_e+=50),_e}function Y2(b,o,g,_e,rt,ot){let at=null,ut=Z2(o,g,rt,ot);for(const ft of _e){const xt=Z2(o-ft.x,g,rt,ot)+ft.badness;xt<=ut&&(at=ft,ut=xt)}return{index:b,x:o,priorBreak:at,badness:ut}}function Q2(b){return b?Q2(b.priorBreak).concat(b.index):[]}function xS(b){let o=.5,g=.5;switch(b){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(b){case"bottom":case"bottom-right":case"bottom-left":g=1;break;case"top":case"top-right":case"top-left":g=0}return{horizontalAlign:o,verticalAlign:g}}function J2(b,o,g,_e,rt){if(!(o||g||_e||rt))return;const ot=b.length-1,at=b[ot],ut=(at.x+at.metrics.advance*at.scale)*o;for(let ft=0;ft<=ot;ft++)b[ft].x-=ut,b[ft].y+=g+_e+rt}function _S(b){return b.imagePrimary!==void 0&&b.top!==void 0&&b.bottom!==void 0&&b.left!==void 0&&b.right!==void 0}function AE(b,o,g,_e){const{horizontalAlign:rt,verticalAlign:ot}=xS(_e),at=g[0]-b.displaySize[0]*rt,ut=g[1]-b.displaySize[1]*ot;return{imagePrimary:b,imageSecondary:o,top:ut,bottom:ut+b.displaySize[1],left:at,right:at+b.displaySize[0]}}function vS(b,o,g,_e,rt,ot){const at=b.imagePrimary;let ut;if(at.content){const er=at.content,Jt=at.pixelRatio||1;ut=[er[0]/Jt,er[1]/Jt,at.displaySize[0]-er[2]/Jt,at.displaySize[1]-er[3]/Jt]}const ft=o.left*ot,xt=o.right*ot;let Ct,Rt,kt,zt;g==="width"||g==="both"?(zt=rt[0]+ft-_e[3],Rt=rt[0]+xt+_e[1]):(zt=rt[0]+(ft+xt-at.displaySize[0])/2,Rt=zt+at.displaySize[0]);const Ut=o.top*ot,Kt=o.bottom*ot;return g==="height"||g==="both"?(Ct=rt[1]+Ut-_e[0],kt=rt[1]+Kt+_e[2]):(Ct=rt[1]+(Ut+Kt-at.displaySize[1])/2,kt=Ct+at.displaySize[1]),{imagePrimary:at,imageSecondary:void 0,top:Ct,right:Rt,bottom:kt,left:zt,collisionPadding:ut}}function eA(b){return!b.imagePrimary.stretchX}function tA(b){return!b.imagePrimary.stretchY}function rA(b){return{width:b.right-b.left,height:b.bottom-b.top}}const fm=128;function j_(b,o,g){const{expression:_e}=o;if(_e.kind==="constant")return{kind:"constant",layoutSize:_e.evaluate(new Xo(b+1,{worldview:g}))};if(_e.kind==="source")return{kind:"source"};{const{zoomStops:rt,interpolationType:ot}=_e;let at=0;for(;at<rt.length&&rt[at]<=b;)at++;at=Math.max(0,at-1);let ut=at;for(;ut<rt.length&&rt[ut]<b+1;)ut++;ut=Math.min(rt.length-1,ut);const ft=rt[at],xt=rt[ut];return _e.kind==="composite"?{kind:"composite",minZoom:ft,maxZoom:xt,interpolationType:ot}:{kind:"camera",minZoom:ft,maxZoom:xt,minSize:_e.evaluate(new Xo(ft,{worldview:g})),maxSize:_e.evaluate(new Xo(xt,{worldview:g})),interpolationType:ot}}}function bS(b,{uSize:o,uSizeT:g},{lowerSize:_e,upperSize:rt}){return b.kind==="source"?_e/fm:b.kind==="composite"?Cs(_e/fm,rt/fm,g):o}function O_(b,o,g=1){let _e=0,rt=0;if(b.kind==="constant")rt=b.layoutSize*g;else if(b.kind!=="source"){const{interpolationType:ot,minZoom:at,maxZoom:ut}=b,ft=ot?tr(ep.interpolationFactor(ot,o,at,ut),0,1):0;b.kind==="camera"?rt=Cs(b.minSize,b.maxSize,ft)*g:_e=ft*g}return{uSizeT:_e,uSize:rt}}class g0 extends _n{constructor(o,g,_e,rt,ot){super(o,g),this.angle=rt,this.z=_e,ot!==void 0&&(this.segment=ot)}clone(){return new g0(this.x,this.y,this.z,this.angle,this.segment)}}function nA(b,o,g,_e,rt){if(o.segment===void 0)return!0;let ot=o,at=o.segment+1,ut=0;for(;ut>-g/2;){if(at--,at<0)return!1;ut-=b[at].dist(ot),ot=b[at]}ut+=b[at].dist(b[at+1]),at++;const ft=[];let xt=0;for(;ut<g/2;){const Ct=b[at],Rt=b[at+1];if(!Rt)return!1;let kt=b[at-1].angleTo(Ct)-Ct.angleTo(Rt);for(kt=Math.abs((kt+3*Math.PI)%(2*Math.PI)-Math.PI),ft.push({distance:ut,angleDelta:kt}),xt+=kt;ut-ft[0].distance>_e;)xt-=ft.shift().angleDelta;if(xt>rt)return!1;at++,ut+=Ct.dist(Rt)}return!0}function iA(b){let o=0;for(let g=0;g<b.length-1;g++)o+=b[g].dist(b[g+1]);return o}function sA(b,o,g){return b?.6*o*g:0}function oA(b,o){return Math.max(b?b.right-b.left:0,o?o.right-o.left:0)}function oM(b,o,g,_e,rt,ot){const at=sA(g,rt,ot),ut=oA(g,_e)*ot;let ft=0;const xt=iA(b)/2;for(let Ct=0;Ct<b.length-1;Ct++){const Rt=b[Ct],kt=b[Ct+1],zt=Rt.dist(kt);if(ft+zt>xt){const Ut=(xt-ft)/zt,Kt=Cs(Rt.x,kt.x,Ut),er=Cs(Rt.y,kt.y,Ut),Jt=new g0(Kt,er,0,kt.angleTo(Rt),Ct);return!at||nA(b,Jt,ut,at,o)?Jt:void 0}ft+=zt}}function aM(b,o,g,_e,rt,ot,at,ut,ft){const xt=sA(_e,ot,at),Ct=oA(_e,rt),Rt=Ct*at,kt=b[0].x===0||b[0].x===ft||b[0].y===0||b[0].y===ft;return o-Rt<o/4&&(o=Rt+o/4),aA(b,kt?o/2*ut%o:(Ct/2+2*ot)*at*ut%o,o,xt,g,Rt,kt,!1,ft)}function aA(b,o,g,_e,rt,ot,at,ut,ft){const xt=ot/2,Ct=iA(b);let Rt=0,kt=o-g,zt=[];for(let Ut=0;Ut<b.length-1;Ut++){const Kt=b[Ut],er=b[Ut+1],Jt=Kt.dist(er),or=er.angleTo(Kt);for(;kt+g<Rt+Jt;){kt+=g;const cr=(kt-Rt)/Jt,pr=Cs(Kt.x,er.x,cr),Sr=Cs(Kt.y,er.y,cr);if(pr>=0&&pr<ft&&Sr>=0&&Sr<ft&&kt-xt>=0&&kt+xt<=Ct){const br=new g0(pr,Sr,0,or,Ut);_e&&!nA(b,br,ot,_e,rt)||zt.push(br)}}Rt+=Jt}return ut||zt.length||at||(zt=aA(b,Rt/2,g,_e,rt,ot,at,!0,ft)),zt}function lA(b){let o=0,g=0;for(const at of b)o+=at.w*at.h,g=Math.max(g,at.w);b.sort((at,ut)=>ut.h-at.h);const _e=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),g),h:1/0}];let rt=0,ot=0;for(const at of b)for(let ut=_e.length-1;ut>=0;ut--){const ft=_e[ut];if(!(at.w>ft.w||at.h>ft.h)){if(at.x=ft.x,at.y=ft.y,ot=Math.max(ot,at.y+at.h),rt=Math.max(rt,at.x+at.w),at.w===ft.w&&at.h===ft.h){const xt=_e.pop();xt&&ut<_e.length&&(_e[ut]=xt)}else at.h===ft.h?(ft.x+=at.w,ft.w-=at.w):at.w===ft.w?(ft.y+=at.h,ft.h-=at.h):(_e.push({x:ft.x+at.w,y:ft.y,w:ft.w-at.w,h:at.h}),ft.y+=at.h,ft.h-=at.h);break}}return{w:rt,h:ot,fill:o/(rt*ot)||0}}Jn(g0,"Anchor");const Yy=1;class I1{static getImagePositionScale(o,g,_e){if(g&&o){const{sx:rt,sy:ot}=o;return{x:rt,y:ot}}return{x:_e,y:_e}}constructor(o,g,_e,rt){this.paddedRect=o;const{pixelRatio:ot,version:at,stretchX:ut,stretchY:ft,content:xt,sdf:Ct,usvg:Rt}=g;this.pixelRatio=ot,this.stretchX=ut,this.stretchY=ft,this.content=xt,this.version=at,this.padding=_e,this.sdf=Ct,this.usvg=Rt,this.scale=I1.getImagePositionScale(rt,Rt,ot)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function wS(b,o,g){const _e=Yp.parse(b),rt=function(ot,at,ut=[1,1]){return{x:0,y:0,w:(ot.data?ot.data.width:ot.width*ut[0])+2*at,h:(ot.data?ot.data.height:ot.height*ut[1])+2*at}}(o,g,[_e.sx,_e.sy]);return{bin:rt,imagePosition:new I1(rt,o,g,_e),imageVariant:_e}}class cA{constructor(o,g,_e){const rt=new Map,ot=new Map;this.haveRenderCallbacks=[];const at=[];this.addImages(o,rt,Yy,at),this.addImages(g,ot,2,at);const{w:ut,h:ft}=lA(at),xt=new ku({width:ut||1,height:ft||1});for(const[Ct,Rt]of o.entries()){const kt=rt.get(Ct).paddedRect;ku.copy(Rt.data,xt,{x:0,y:0},{x:kt.x+Yy,y:kt.y+Yy},Rt.data,null,Rt.sdf)}for(const[Ct,Rt]of g.entries()){const kt=ot.get(Ct),zt=kt.paddedRect;let Ut=kt.padding;const Kt=zt.x+Ut,er=zt.y+Ut,Jt=Rt.data.width,or=Rt.data.height;Ut=Ut>1?Ut-1:Ut,ku.copy(Rt.data,xt,{x:0,y:0},{x:Kt,y:er},Rt.data,_e),ku.copy(Rt.data,xt,{x:0,y:or-Ut},{x:Kt,y:er-Ut},{width:Jt,height:Ut},_e),ku.copy(Rt.data,xt,{x:0,y:0},{x:Kt,y:er+or},{width:Jt,height:Ut},_e),ku.copy(Rt.data,xt,{x:Jt-Ut,y:0},{x:Kt-Ut,y:er},{width:Ut,height:or},_e),ku.copy(Rt.data,xt,{x:0,y:0},{x:Kt+Jt,y:er},{width:Ut,height:or},_e),ku.copy(Rt.data,xt,{x:Jt-Ut,y:or-Ut},{x:Kt-Ut,y:er-Ut},{width:Ut,height:Ut},_e),ku.copy(Rt.data,xt,{x:0,y:or-Ut},{x:Kt+Jt,y:er-Ut},{width:Ut,height:Ut},_e),ku.copy(Rt.data,xt,{x:0,y:0},{x:Kt+Jt,y:er+or},{width:Ut,height:Ut},_e),ku.copy(Rt.data,xt,{x:Jt-Ut,y:0},{x:Kt-Ut,y:er+or},{width:Ut,height:Ut},_e)}this.lut=_e,this.image=xt,this.iconPositions=rt,this.patternPositions=ot}addImages(o,g,_e,rt){for(const[ot,at]of o.entries()){const{bin:ut,imagePosition:ft,imageVariant:xt}=wS(ot,at,_e);g.set(ot,ft),rt.push(ut),at.hasRenderCallback&&this.haveRenderCallbacks.push(xt.id)}}patchUpdatedImages(o,g,_e){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(rt=>o.hasImage(rt,_e)),o.dispatchRenderCallbacks(this.haveRenderCallbacks,_e);for(const rt of o.getUpdatedImages(_e)){for(const ot of this.iconPositions.keys()){const at=Yp.parse(ot);if(Nu.isEqual(at.id,rt)){const ut=o.getImage(rt,_e);this.patchUpdatedImage(this.iconPositions.get(ot),ut,g,null)}}for(const ot of this.patternPositions.keys()){const at=Yp.parse(ot);if(Nu.isEqual(at.id,rt)){const ut=o.getImage(rt,_e);this.patchUpdatedImage(this.patternPositions.get(ot),ut,g,this.lut)}}}}patchUpdatedImage(o,g,_e,rt=null){if(!o||!g||o.version===g.version)return;o.version=g.version;const[ot,at]=o.tl,ut=o.sdf;if(this.lut||ut){const ft={width:g.data.width,height:g.data.height},xt=new ku(ft);ku.copy(g.data,xt,{x:0,y:0},{x:0,y:0},ft,rt,ut),_e.update(xt,{position:{x:ot,y:at}})}else _e.update(g.data,{position:{x:ot,y:at}})}}Jn(I1,"ImagePosition"),Jn(cA,"ImageAtlas");const k1=1e20;function uA(b,o,g,_e,rt,ot,at,ut,ft){for(let xt=o;xt<o+_e;xt++)hA(b,g*ot+xt,ot,rt,at,ut,ft);for(let xt=g;xt<g+rt;xt++)hA(b,xt*ot+o,1,_e,at,ut,ft)}function hA(b,o,g,_e,rt,ot,at){ot[0]=0,at[0]=-k1,at[1]=k1,rt[0]=b[o];for(let ut=1,ft=0,xt=0;ut<_e;ut++){rt[ut]=b[o+ut*g];const Ct=ut*ut;do{const Rt=ot[ft];xt=(rt[ut]-rt[Rt]+Ct-Rt*Rt)/(ut-Rt)/2}while(xt<=at[ft]&&--ft>-1);ft++,ot[ft]=ut,at[ft]=xt,at[ft+1]=k1}for(let ut=0,ft=0;ut<_e;ut++){for(;at[ft+1]<ut;)ft++;const xt=ot[ft],Ct=ut-xt;b[o+ut*g]=rt[xt]+Ct*Ct}}const mm=2,ES={none:0,ideographs:1,all:2};class F_{constructor(o,g,_e){this.requestManager=o,this.localGlyphMode=g,this.localFontFamily=_e,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o){this.url=o}getGlyphs(o,g){const _e=[],rt=this.url||eo.GLYPHS_URL;for(const ot in o)for(const at of o[ot])_e.push({stack:ot,id:at});Nr(_e,({stack:ot,id:at},ut)=>{let ft=this.entries[ot];ft||(ft=this.entries[ot]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let xt=ft.glyphs[at];if(xt!==void 0)return void ut(null,{stack:ot,id:at,glyph:xt});if(xt=this._tinySDF(ft,ot,at),xt)return ft.glyphs[at]=xt,void ut(null,{stack:ot,id:at,glyph:xt});const Ct=Math.floor(at/256);if(256*Ct>65535)return Wn("glyphs > 65535 not supported"),void ut(null,{stack:ot,id:at,glyph:xt});if(ft.ranges[Ct])return void ut(null,{stack:ot,id:at,glyph:xt});let Rt=ft.requests[Ct];Rt||(Rt=ft.requests[Ct]=[],F_.loadGlyphRange(ot,Ct,rt,this.requestManager,(kt,zt)=>{if(zt){ft.ascender=zt.ascender,ft.descender=zt.descender;for(const Ut in zt.glyphs)this._doesCharSupportLocalGlyph(+Ut)||(ft.glyphs[+Ut]=zt.glyphs[+Ut]);ft.ranges[Ct]=!0}for(const Ut of Rt)Ut(kt,zt);delete ft.requests[Ct]})),Rt.push((kt,zt)=>{kt?ut(kt):zt&&ut(null,{stack:ot,id:at,glyph:zt.glyphs[at]||null})})},(ot,at)=>{if(ot)g(ot);else if(at){const ut={};for(const{stack:ft,id:xt,glyph:Ct}of at)ut[ft]===void 0&&(ut[ft]={}),ut[ft].glyphs===void 0&&(ut[ft].glyphs={}),ut[ft].glyphs[xt]=Ct&&{id:Ct.id,bitmap:Ct.bitmap.clone(),metrics:Ct.metrics},ut[ft].ascender=this.entries[ft].ascender,ut[ft].descender=this.entries[ft].descender;g(null,ut)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==ES.none&&(this.localGlyphMode===ES.all?!!this.localFontFamily:!!this.localFontFamily&&(vs["CJK Unified Ideographs"](o)||vs["Hangul Syllables"](o)||vs.Hiragana(o)||vs.Katakana(o)||vs["CJK Symbols and Punctuation"](o)||vs["CJK Unified Ideographs Extension A"](o)||vs["CJK Unified Ideographs Extension B"](o)||vs.Osage(o)))}_tinySDF(o,g,_e){const rt=this.localFontFamily;if(!rt||!this._doesCharSupportLocalGlyph(_e))return;let ot=o.tinySDF;if(!ot){let Kt="400";/bold/i.test(g)?Kt="900":/medium/i.test(g)?Kt="500":/light/i.test(g)&&(Kt="200"),ot=o.tinySDF=new F_.TinySDF({fontFamily:rt,fontWeight:Kt,fontSize:24*mm,buffer:3*mm,radius:8*mm}),ot.fontWeight=Kt}if(this.localGlyphs[ot.fontWeight][_e])return this.localGlyphs[ot.fontWeight][_e];const at=String.fromCodePoint(_e),{data:ut,width:ft,height:xt,glyphWidth:Ct,glyphHeight:Rt,glyphLeft:kt,glyphTop:zt,glyphAdvance:Ut}=ot.draw(at);return this.localGlyphs[ot.fontWeight][_e]={id:_e,bitmap:new K0({width:ft,height:xt},ut),metrics:{width:Ct/mm,height:Rt/mm,left:kt/mm,top:zt/mm-27,advance:Ut/mm,localGlyph:!0}}}}F_.loadGlyphRange=function(b,o,g,_e,rt){const ot=256*o,at=ot+255,ut=_e.transformRequest(_e.normalizeGlyphsURL(g).replace("{fontstack}",b).replace("{range}",`${ot}-${at}`),ly.Glyphs);Zp(ut,(ft,xt)=>{if(ft)rt(ft);else if(xt){const Ct={},Rt=function(kt){return new SE(kt).readFields(tM,{})}(xt);for(const kt of Rt.glyphs)Ct[kt.id]=kt;rt(null,{glyphs:Ct,ascender:Rt.ascender,descender:Rt.descender})}})},F_.TinySDF=class{constructor({fontSize:b=24,buffer:o=3,radius:g=8,cutoff:_e=.25,fontFamily:rt="sans-serif",fontWeight:ot="normal",fontStyle:at="normal",lang:ut=null}={}){this.buffer=o,this.cutoff=_e,this.radius=g,this.lang=ut;const ft=this.size=b+4*o,xt=this._createCanvas(ft),Ct=this.ctx=xt.getContext("2d",{willReadFrequently:!0});Ct.font=`${at} ${ot} ${b}px ${rt}`,Ct.textBaseline="alphabetic",Ct.textAlign="left",Ct.fillStyle="black",this.gridOuter=new Float64Array(ft*ft),this.gridInner=new Float64Array(ft*ft),this.f=new Float64Array(ft),this.z=new Float64Array(ft+1),this.v=new Uint16Array(ft)}_createCanvas(b){const o=document.createElement("canvas");return o.width=o.height=b,o}draw(b){const{width:o,actualBoundingBoxAscent:g,actualBoundingBoxDescent:_e,actualBoundingBoxLeft:rt,actualBoundingBoxRight:ot}=this.ctx.measureText(b),at=Math.ceil(g),ut=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(ot-rt))),ft=Math.min(this.size-this.buffer,at+Math.ceil(_e)),xt=ut+2*this.buffer,Ct=ft+2*this.buffer,Rt=Math.max(xt*Ct,0),kt=new Uint8ClampedArray(Rt),zt={data:kt,width:xt,height:Ct,glyphWidth:ut,glyphHeight:ft,glyphTop:at,glyphLeft:0,glyphAdvance:o};if(ut===0||ft===0)return zt;const{ctx:Ut,buffer:Kt,gridInner:er,gridOuter:Jt}=this;this.lang&&(Ut.lang=this.lang),Ut.clearRect(Kt,Kt,ut,ft),Ut.fillText(b,Kt,Kt+at);const or=Ut.getImageData(Kt,Kt,ut,ft);Jt.fill(k1,0,Rt),er.fill(0,0,Rt);for(let cr=0;cr<ft;cr++)for(let pr=0;pr<ut;pr++){const Sr=or.data[4*(cr*ut+pr)+3]/255;if(Sr===0)continue;const br=(cr+Kt)*xt+pr+Kt;if(Sr===1)Jt[br]=0,er[br]=k1;else{const Pr=.5-Sr;Jt[br]=Pr>0?Pr*Pr:0,er[br]=Pr<0?Pr*Pr:0}}uA(Jt,0,0,xt,Ct,xt,this.f,this.v,this.z),uA(er,Kt,Kt,ut,ft,xt,this.f,this.v,this.z);for(let cr=0;cr<Rt;cr++){const pr=Math.sqrt(Jt[cr])-Math.sqrt(er[cr]);kt[cr]=Math.round(255-255*(pr/this.radius+this.cutoff))}return zt}};const Um=Yy;function dA(b,o){return b+o[1]-o[0]}function TS(b,o,g,_e,rt=1){const ot=[],at=b.imagePrimary,ut=at.pixelRatio,ft=at.paddedRect.w-2*Um,xt=at.paddedRect.h-2*Um,Ct=(b.right-b.left)*rt,Rt=(b.bottom-b.top)*rt,kt=at.stretchX||[[0,ft]],zt=at.stretchY||[[0,xt]],Ut=kt.reduce(dA,0),Kt=zt.reduce(dA,0),er=ft-Ut,Jt=xt-Kt;let or=0,cr=Ut,pr=0,Sr=Kt,br=0,Pr=er,Dr=0,Or=Jt;if(at.content&&_e){const $r=at.content;or=RE(kt,0,$r[0]),pr=RE(zt,0,$r[1]),cr=RE(kt,$r[0],$r[2]),Sr=RE(zt,$r[1],$r[3]),br=$r[0]-or,Dr=$r[1]-pr,Pr=$r[2]-$r[0]-cr,Or=$r[3]-$r[1]-Sr}const nn=($r,un,gn,yn)=>{const Sn=PE($r.stretch-or,cr,Ct,b.left*rt),An=IE($r.fixed-br,Pr,$r.stretch,Ut),wn=PE(un.stretch-pr,Sr,Rt,b.top*rt),En=IE(un.fixed-Dr,Or,un.stretch,Kt),ln=PE(gn.stretch-or,cr,Ct,b.left*rt),on=IE(gn.fixed-br,Pr,gn.stretch,Ut),Tn=PE(yn.stretch-pr,Sr,Rt,b.top*rt),On=IE(yn.fixed-Dr,Or,yn.stretch,Kt),kn=new _n(Sn,wn),ls=new _n(ln,wn),Gn=new _n(ln,Tn),Kn=new _n(Sn,Tn),ts=new _n(An/ut,En/ut),qs=new _n(on/ut,On/ut),Dn=o*Math.PI/180;if(Dn){const No=Math.sin(Dn),wr=Math.cos(Dn),Cr=[wr,-No,No,wr];kn._matMult(Cr),ls._matMult(Cr),Kn._matMult(Cr),Gn._matMult(Cr)}const rs=$r.stretch+$r.fixed,Ms=gn.stretch+gn.fixed,ro=un.stretch+un.fixed,so=yn.stretch+yn.fixed,Os=b.imageSecondary;return{tl:kn,tr:ls,bl:Kn,br:Gn,texPrimary:{x:at.paddedRect.x+Um+rs,y:at.paddedRect.y+Um+ro,w:Ms-rs,h:so-ro},texSecondary:Os?{x:Os.paddedRect.x+Um+rs,y:Os.paddedRect.y+Um+ro,w:Ms-rs,h:so-ro}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ts,pixelOffsetBR:qs,minFontScaleX:Pr/ut/Ct,minFontScaleY:Or/ut/Rt,isSDF:g}};if(_e&&(at.stretchX||at.stretchY)){const $r=pA(kt,er,Ut),un=pA(zt,Jt,Kt);for(let gn=0;gn<$r.length-1;gn++){const yn=$r[gn],Sn=$r[gn+1];for(let An=0;An<un.length-1;An++)ot.push(nn(yn,un[An],Sn,un[An+1]))}}else ot.push(nn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:ft+1},{fixed:0,stretch:xt+1}));return ot}function lM(b,o){const g=b.stretchY||[[0,b.paddedRect.h-2*Um]];return o&&(b.stretchX||b.stretchY)?fA(b.stretchX||[[0,b.paddedRect.w-2*Um]])*fA(g):1}function RE(b,o,g){let _e=0;for(const rt of b)_e+=Math.max(o,Math.min(g,rt[1]))-Math.max(o,Math.min(g,rt[0]));return _e}function pA(b,o,g){const _e=[{fixed:-Um,stretch:0}];for(const[rt,ot]of b){const at=_e[_e.length-1];_e.push({fixed:rt-at.stretch,stretch:at.stretch}),_e.push({fixed:rt-at.stretch,stretch:at.stretch+(ot-rt)})}return _e.push({fixed:o+Um,stretch:g}),_e}function fA(b){return 2*b.length+1}function PE(b,o,g,_e){return b/o*g+_e}function IE(b,o,g,_e){return b-o*g/_e}function cM(b,o,g,_e){const rt=o+b.positionedLines[_e].lineOffset;return _e===0?g+rt/2:g+(rt+(o+b.positionedLines[_e-1].lineOffset))/2}function uM(b,o=1,g=!1){let _e=1/0,rt=1/0,ot=-1/0,at=-1/0;const ut=b[0];for(let zt=0;zt<ut.length;zt++){const Ut=ut[zt];(!zt||Ut.x<_e)&&(_e=Ut.x),(!zt||Ut.y<rt)&&(rt=Ut.y),(!zt||Ut.x>ot)&&(ot=Ut.x),(!zt||Ut.y>at)&&(at=Ut.y)}const ft=Math.min(ot-_e,at-rt);let xt=ft/2;const Ct=new Rx([],hM);if(ft===0)return new _n(_e,rt);for(let zt=_e;zt<ot;zt+=ft)for(let Ut=rt;Ut<at;Ut+=ft)Ct.push(new B_(zt+xt,Ut+xt,xt,b));let Rt=function(zt){let Ut=0,Kt=0,er=0;const Jt=zt[0];for(let or=0,cr=Jt.length,pr=cr-1;or<cr;pr=or++){const Sr=Jt[or],br=Jt[pr],Pr=Sr.x*br.y-br.x*Sr.y;Kt+=(Sr.x+br.x)*Pr,er+=(Sr.y+br.y)*Pr,Ut+=3*Pr}return new B_(Kt/Ut,er/Ut,0,zt)}(b),kt=Ct.length;for(;Ct.length;){const zt=Ct.pop();(zt.d>Rt.d||!Rt.d)&&(Rt=zt,g&&console.log("found best %d after %d probes",Math.round(1e4*zt.d)/1e4,kt)),zt.max-Rt.d<=o||(xt=zt.h/2,Ct.push(new B_(zt.p.x-xt,zt.p.y-xt,xt,b)),Ct.push(new B_(zt.p.x+xt,zt.p.y-xt,xt,b)),Ct.push(new B_(zt.p.x-xt,zt.p.y+xt,xt,b)),Ct.push(new B_(zt.p.x+xt,zt.p.y+xt,xt,b)),kt+=4)}return g&&(console.log(`num probes: ${kt}`),console.log(`best distance: ${Rt.d}`)),Rt.p}function hM(b,o){return o.max-b.max}class B_{constructor(o,g,_e,rt){this.p=new _n(o,g),this.h=_e,this.d=function(ot,at){let ut=!1,ft=1/0;for(let xt=0;xt<at.length;xt++){const Ct=at[xt];for(let Rt=0,kt=Ct.length,zt=kt-1;Rt<kt;zt=Rt++){const Ut=Ct[Rt],Kt=Ct[zt];Ut.y>ot.y!=Kt.y>ot.y&&ot.x<(Kt.x-Ut.x)*(ot.y-Ut.y)/(Kt.y-Ut.y)+Ut.x&&(ut=!ut),ft=Math.min(ft,Fl(ot,Ut,Kt))}}return(ut?1:-1)*Math.sqrt(ft)}(this.p,rt),this.max=this.d+this.h*Math.SQRT2}}const dM=Object.keys,SS=Number.POSITIVE_INFINITY,pM=Math.sqrt(2);function Z0(b,o,g,_e,rt){const ot=_S(b)&&b.collisionPadding?b.collisionPadding:[0,0,0,0],at={top:b.top-ot[1],bottom:b.bottom+ot[3],left:b.left-ot[0],right:b.right+ot[2],scaled:!1};return _e!==void 0&&function(ut,ft){ut.top*=ft,ut.bottom*=ft,ut.left*=ft,ut.right*=ft,ut.scaled=!0}(at,_e),g&&function(ut,ft){if(!ft)return;const xt=Xs(ft),Ct=new _n(ut.left,ut.top),Rt=new _n(ut.right,ut.top),kt=new _n(ut.left,ut.bottom),zt=new _n(ut.right,ut.bottom),Ut=new _n(0,0);Ct._rotateAround(xt,Ut),Rt._rotateAround(xt,Ut),kt._rotateAround(xt,Ut),zt._rotateAround(xt,Ut),ut.left=Math.min(Ct.x,Rt.x,kt.x,zt.x),ut.right=Math.max(Ct.x,Rt.x,kt.x,zt.x),ut.top=Math.min(Ct.y,Rt.y,kt.y,zt.y),ut.bottom=Math.max(Ct.y,Rt.y,kt.y,zt.y)}(at,g),rt&&(at.left+=rt[0],at.right+=rt[0],at.top+=rt[1],at.bottom+=rt[1]),o?{top:Math.min(o.top,at.top),bottom:Math.max(o.bottom,at.bottom),left:Math.min(o.left,at.left),right:Math.max(o.right,at.right),scaled:o.scaled||at.scaled}:at}function mA(b,[o,g]){let _e=0,rt=0;if(g===SS){o<0&&(o=0);const ot=o/pM;switch(b){case"top-right":case"top-left":rt=ot-7;break;case"bottom-right":case"bottom-left":rt=7-ot;break;case"bottom":rt=7-o;break;case"top":rt=o-7}switch(b){case"top-right":case"bottom-right":_e=-ot;break;case"top-left":case"bottom-left":_e=ot;break;case"left":_e=o;break;case"right":_e=-o}}else{switch(o=Math.abs(o),g=Math.abs(g),b){case"top-right":case"top-left":case"top":rt=g-7;break;case"bottom-right":case"bottom-left":case"bottom":rt=7-g}switch(b){case"top-right":case"bottom-right":case"right":_e=-o;break;case"top-left":case"bottom-left":case"left":_e=o}}return[_e,rt]}function fM(b,o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt){const Ut=b.layers[0],Kt=Ut.appearances;if(Kt.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const er={iconBBox:null,iconVerticalBBox:null},Jt={textBBox:null,textVerticalBBox:null},{baseIconRotate:or,baseTextRotate:cr,iconScaleFactor:pr}=function(br,Pr,Dr){const Or=br.get("icon-rotate").evaluate(Pr,{},Dr),nn=br.get("text-rotate").evaluate(Pr,{},Dr),[$r,un]=br.get("icon-size-scale-range");return{baseIconRotate:Or,baseTextRotate:nn,iconScaleFactor:tr(1,$r,un)}}(_e,rt,ot);o&&(er.iconBBox=Z0(o,er.iconBBox,or,at),g)&&(er.iconVerticalBBox=Z0(g,er.iconVerticalBBox,or+90,at));const Sr=ME(Rt.horizontal);Sr&&(Jt.textBBox=Z0(Sr,Jt.textBBox,cr,1,zt)),Rt.vertical&&(Jt.textVerticalBBox=Z0(Rt.vertical,Jt.textVerticalBBox,cr+90,1,zt));for(const br of Kt)br.hasIconProperties()&&mM(er,b,Ut,br,rt,ot,ut,or,at,ft,o,xt,pr,Ct),br.hasTextProperties()&&gM(Jt,Ut,br,rt,ot,zt,cr,kt,Sr,Rt.vertical);return{iconBBox:er.iconBBox,iconVerticalBBox:er.iconVerticalBBox,textBBox:Jt.textBBox,textVerticalBBox:Jt.textVerticalBBox}}function mM(b,o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt){const{appearanceIconOffset:Ut,appearanceIconRotate:Kt,appearanceIconSize:er}=function(pr,Sr,br,Pr,Dr,Or,nn,$r){const un=pr.hasProperty("icon-offset")?Sr.getAppearanceValueAndResolveTokens(pr,"icon-offset",br,Pr,[]):null,gn=un&&Array.isArray(un)?un:Dr,yn=pr.hasProperty("icon-rotate")?Sr.getAppearanceValueAndResolveTokens(pr,"icon-rotate",br,Pr,[]):null,Sn=typeof yn=="number"?yn:Or,An=pr.hasProperty("icon-size")?Sr.getAppearanceValueAndResolveTokens(pr,"icon-size",br,Pr,[]):null;return{appearanceIconOffset:gn,appearanceIconRotate:Sn,appearanceIconSize:typeof An=="number"?An*$r.iconScaleFactor:nn}}(_e,g,rt,ot,at,ut,ft,xt);let Jt=null,or=null,cr=null;_e.hasProperty("icon-image")?cr=function(pr,Sr,br,Pr,Dr,Or,nn){let $r=null;const un=Sr.getAppearanceValueAndResolveTokens(br,"icon-image",Pr,Dr,[]);if(un){const gn=pr.getResolvedImageFromTokens(un),yn=br.getUnevaluatedProperty("icon-size"),Sn=M1(gn,j_(pr.zoom,yn,pr.worldview),yn,Dr,pr.zoom,Pr,pr.pixelRatio,nn,pr.worldview);$r=Or.get(Sn.iconPrimary.toString())}return $r}(o,g,_e,rt,ot,Rt,kt):Ct&&(cr=Ct.imagePrimary),cr&&(Jt=AE(cr,null,Ut,zt),o.allowVerticalPlacement&&(or=AE(cr,null,Ut,zt))),Jt&&(b.iconBBox=Z0(Jt,b.iconBBox,Kt,er)),or&&(b.iconVerticalBBox=Z0(or,b.iconVerticalBBox,Kt+90,er))}function gM(b,o,g,_e,rt,ot,at,ut,ft,xt){const{appearanceTextOffset:Ct,appearanceTextRotate:Rt,appearanceTextSize:kt}=function(Ut,Kt,er,Jt,or,cr,pr){const Sr=Ut.hasProperty("text-offset")?Kt.getAppearanceValueAndResolveTokens(Ut,"text-offset",er,Jt,[]):null,br=Sr&&Array.isArray(Sr)?[Sr[0]*pu,Sr[1]*pu]:or,Pr=Ut.hasProperty("text-rotate")?Kt.getAppearanceValueAndResolveTokens(Ut,"text-rotate",er,Jt,[]):null,Dr=typeof Pr=="number"?Pr:cr,Or=Ut.hasProperty("text-size")?Kt.getAppearanceValueAndResolveTokens(Ut,"text-size",er,Jt,[]):null;return{appearanceTextOffset:br,appearanceTextRotate:Dr,appearanceTextSize:typeof Or=="number"?Or:pr}}(g,o,_e,rt,ot,at,ut),zt=kt/ut;ft&&(b.textBBox=Z0(ft,b.textBBox,Rt,zt,Ct)),xt&&(b.textVerticalBBox=Z0(xt,b.textVerticalBBox,Rt+90,zt,Ct))}function kE(b,o,g,_e,rt,ot,at,ut,ft){if(!o||!o.usvg)return;const xt=rA(_e),Ct=rA(rt),Rt=ot!=="both"&&ot!=="width"||!eA(_e)?1:Ct.width/xt.width,kt=ot!=="both"&&ot!=="height"||!tA(_e)?1:Ct.height/xt.height;g.scaleSelf(Rt,kt);const zt=g.toString();at.set(zt,g),ut.set(zt,o);const{imagePosition:Ut}=wS(zt,o,Yy);ft.set(zt,Ut)}function gA(b,o,g,_e,rt,ot,at,ut,ft){if(!b)return;const xt=function(Ct,Rt,kt,zt,Ut,Kt){if(Ct.kind==="camera")return Ct.maxSize;if(Ct.kind==="composite"){const er=Rt.possiblyEvaluate(new Xo(Ct.maxZoom,{worldview:Kt}),kt).evaluate(Ut,{},kt),Jt=Rt.possiblyEvaluate(new Xo(Ct.minZoom,{worldview:Kt}),kt).evaluate(Ut,{},kt);return Math.max(er,Jt)}return Rt.possiblyEvaluate(new Xo(zt,{worldview:Kt})).evaluate(Ut,{},kt)}(o,g,_e,rt,ot,ft);return b.scaleSelf(xt*ut*at)}function M1(b,o,g,_e,rt,ot,at,ut,ft){return{iconPrimary:gA(b.getPrimary(),o,g,_e,rt,ot,at,ut,ft),iconSecondary:gA(b.getSecondary(),o,g,_e,rt,ot,at,ut,ft)}}function yM(b,o,g){if(!o)return;const _e=g.get(b.toString()),rt=g.get(o.toString());_e&&rt&&(_e.paddedRect.w===rt.paddedRect.w&&_e.paddedRect.h===rt.paddedRect.h||Wn(`Mismatch in icon variant sizes: ${b.toString()} and ${o.toString()}`),_e.usvg!==rt.usvg&&Wn(`Mismatch in icon variant image types: ${b.id} and ${o.id}`))}function yA(b,o,g,_e){if(!b)return;const rt=o.get(g.toString());if(b.imagePrimary=rt,_e){const ot=o.get(_e.toString());b.imageSecondary=ot}}function xM(b,o){for(const g in b.horizontal)xA(b.horizontal[g],o);xA(b.vertical,o)}function xA(b,o){if(b){for(const g of b.positionedLines)for(const _e of g.positionedGlyphs)if(_e.image!==null){const rt=_e.image.toString();_e.rect=o.get(rt).paddedRect}}}function CS(b){switch(b){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function _M(b,o,g,_e,rt,ot,at,ut,ft){const xt=ME(ot.horizontal)||ot.vertical,Ct=g.get("icon-text-fit-padding").evaluate(_e,{},rt);let Rt,kt=o;return o&&ft!=="none"&&(b.allowVerticalPlacement&&ot.vertical&&(Rt=vS(o,ot.vertical,ft,Ct,ut,at)),xt&&(kt=vS(o,xt,ft,Ct,ut,at))),{defaultShapedIcon:kt,verticallyShapedIcon:Rt}}function vM(b,o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt,Ut,Kt,er,Jt,or,cr,pr,Sr,br,Pr){let Dr=at.textMaxSize.evaluate(o,{},kt);Dr===void 0?Dr=ut*at.textScaleFactor:Dr*=at.textScaleFactor;const Or=b.layers[0].layout,nn=pu,$r=ut*at.textScaleFactor/nn,un=ME(g.horizontal)||g.vertical;if(er!=="none"&&b.appearanceFeatureData&&o.index<b.appearanceFeatureData.length){const Gn=b.appearanceFeatureData[o.index];Gn&&(Gn.textShaping=un,Gn.iconTextFitPadding=Or.get("icon-text-fit-padding").evaluate(o,{},kt),Gn.fontScale=$r)}const gn=zt.name==="globe",yn=b.tilePixelRatio*Dr/nn,Sn=(Tn=b.overscaling,b.zoom>18&&Tn>2&&(Tn>>=1),Math.max(jn/(512*Tn),1)*Or.get("symbol-spacing")),An=Or.get("text-padding")*b.tilePixelRatio,wn=Or.get("icon-padding")*b.tilePixelRatio,En=Xs(Or.get("text-max-angle")),ln=Or.get("icon-rotation-alignment")==="map"&&cr!=="point",on=Sn/2;var Tn;b.hasAnyIconTextFit===!1&&er!=="none"&&(b.hasAnyIconTextFit=!0);const On=o.properties?+o.properties[an]:null,kn=On&&b.elevationFeatureIdToIndex?b.elevationFeatureIdToIndex.get(On):65535,ls=(Gn,Kn,ts)=>{if(Kn.x<0||Kn.x>=jn||Kn.y<0||Kn.y>=jn)return;let qs=null;if(gn){const{x:Dn,y:rs,z:Ms}=zt.projectTilePoint(Kn.x,Kn.y,ts);qs={anchor:new g0(Dn,rs,Ms,0,void 0),up:zt.upVector(ts,Kn.x,Kn.y)}}(function(Dn,rs,Ms,ro,so,Os,No,wr,Cr,hn,Cn,Vn,Un,cs,ps,Ls,$s,Ws,Qs,Es,Is,ho,yo,xo,Io,Bo,Lo,vo,Co,Gs,no,yl,bs){const Js=Dn.addToLineVertexArray(rs,ro);let jo,Uo,Zo,Hl,Ho,ws,Tl,ko=0,_a=0,iu=0,fu=0,Yl=-1,Ql=-1;const lu={};let Ku=gx("");const Wo=Ms?Ms.anchor:rs,Bl=vo!=="none";let Wl=0,Yu=0;if(Cr._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Tu=Cr.layout.get("text-offset").evaluate(Is,{},Io);Wl=Tu[0]*pu,Yu=Tu[1]*pu}else Wl=Cr.layout.get("text-radial-offset").evaluate(Is,{},Io)*pu,Yu=SS;if(Dn.allowVerticalPlacement&&so.vertical){const Tu=so.vertical;if(ps)ws=AS(Tu),wr&&(Tl=AS(wr));else{const Vu=Cr.layout.get("text-rotate").evaluate(Is,{},Io)+90;Zo=DE(hn,Wo,rs,Cn,Vn,Un,Tu,cs,Vu,Ls,yl),wr&&(Hl=DE(hn,Wo,rs,Cn,Vn,Un,wr,Ws,Vu,null,no))}}if(Os){const Tu=Dn.iconSizeData,Vu=Cr.layout.get("icon-rotate").evaluate(Is,{},Io),lp=TS(Os,Vu,yo,Bl,ho.iconScaleFactor),J0=wr?TS(wr,Vu,yo,Bl,ho.iconScaleFactor):void 0;Uo=DE(hn,Wo,rs,Cn,Vn,Un,Os,Ws,Vu,null,Gs);const W_=function(_m,Z1,OR,MD,FR,BR,DD,ND){const zR=_m.layers[0],VR=zR.appearances;let q_=Z1.length;if(OR&&(q_=Math.max(q_,OR.length)),VR.length===0)return q_;const[LD,jD]=MD.get("icon-size-scale-range"),OD=tr(1,LD,jD);for(const UR of VR){const $R=UR.getUnevaluatedProperties();if($R._values["icon-image"].value!==void 0){const GR=zR.getAppearanceValueAndResolveTokens(UR,"icon-image",FR,BR,[]);if(GR){const HR=_m.getResolvedImageFromTokens(GR);if(HR){const WR=$R._values["icon-size"],FD=M1(HR,j_(_m.zoom,WR,_m.worldview),WR,BR,_m.zoom,FR,_m.pixelRatio,OD,_m.worldview),BD=DD.get(FD.iconPrimary.toString());q_=Math.max(q_,lM(BD,ND))}}}}return q_}(Dn,lp,J0,Cr.layout,Is,Io,Dn.iconAtlasPositions,Bl);ko=4*W_;let xm=null;Tu.kind==="source"?(xm=[fm*Cr.layout.get("icon-size").evaluate(Is,{},Io)*ho.iconScaleFactor],xm[0]>y0&&Wn(`${Dn.layerIds[0]}: Value for "icon-size" is >= ${D1}. Reduce your "icon-size".`)):Tu.kind==="composite"&&(xm=[fm*ho.compositeIconSizes[0].evaluate(Is,{},Io)*ho.iconScaleFactor,fm*ho.compositeIconSizes[1].evaluate(Is,{},Io)*ho.iconScaleFactor],(xm[0]>y0||xm[1]>y0)&&Wn(`${Dn.layerIds[0]}: Value for "icon-size" is >= ${D1}. Reduce your "icon-size".`)),Dn.addSymbols(Dn.icon,lp,xm,Es,Qs,Is,void 0,Ms,rs,Js.lineStartIndex,Js.lineLength,-1,xo,Io,Bo,Lo,Dn.symbolInstances.length,W_),Yl=Dn.icon.placedSymbolArray.length-1,J0&&(_a=4*W_,Dn.addSymbols(Dn.icon,J0,xm,Es,Qs,Is,ap.vertical,Ms,rs,Js.lineStartIndex,Js.lineLength,-1,xo,Io,Bo,Lo,Dn.symbolInstances.length,W_),Ql=Dn.icon.placedSymbolArray.length-1)}for(const Tu in so.horizontal){const Vu=Tu,lp=so.horizontal[Vu];jo||(Ku=gx(lp.text),ps?Ho=AS(lp):jo=DE(hn,Wo,rs,Cn,Vn,Un,lp,cs,Cr.layout.get("text-rotate").evaluate(Is,{},Io),Ls,yl));const J0=lp.positionedLines.length===1;if(iu+=_A(Dn,Ms,rs,lp,No,Cr,ps,Is,Ls,Js,so.vertical?ap.horizontal:ap.horizontalOnly,J0?dM(so.horizontal):[Vu],lu,Yl,ho,xo,Io,Dn.symbolInstances.length,Bo),J0)break}so.vertical&&(fu+=_A(Dn,Ms,rs,so.vertical,No,Cr,ps,Is,Ls,Js,ap.vertical,["vertical"],lu,Ql,ho,xo,Io,Dn.symbolInstances.length,Bo));let su=-1;const Kp=(Tu,Vu)=>Tu?Math.max(Tu,Vu):Vu;su=Kp(Ho,su),su=Kp(ws,su),su=Kp(Tl,su);const $m=su>-1?1:0;Dn.glyphOffsetArray.length>=65535&&Wn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Is.sortKey!==void 0&&Dn.addToSortKeyRanges(Dn.symbolInstances.length,Is.sortKey),Dn.symbolInstances.emplaceBack(rs.x,rs.y,Wo.x,Wo.y,Wo.z,lu.right>=0?lu.right:-1,lu.center>=0?lu.center:-1,lu.left>=0?lu.left:-1,lu.vertical>=0?lu.vertical:-1,Yl,Ql,Ku,jo!==void 0?jo:Dn.collisionBoxArray.length,jo!==void 0?jo+1:Dn.collisionBoxArray.length,Zo!==void 0?Zo:Dn.collisionBoxArray.length,Zo!==void 0?Zo+1:Dn.collisionBoxArray.length,Uo!==void 0?Uo:Dn.collisionBoxArray.length,Uo!==void 0?Uo+1:Dn.collisionBoxArray.length,Hl||Dn.collisionBoxArray.length,Hl?Hl+1:Dn.collisionBoxArray.length,Cn,iu,fu,ko,_a,$m,0,Wl,Yu,su,0,Bl?1:0,Co)})(b,Kn,qs,Gn,g,_e,ot,rt,b.layers[0],b.collisionBoxArray,o.index,o.sourceLayerIndex,b.index,An,or,xt,0,wn,ln,Jt,o,at,Ct,Rt,kt,Ut,Kt,er,kn,pr,Sr,br)};if(cr==="line")for(const Gn of fE(o.geometry,0,0,jn,jn)){const Kn=aM(Gn,Sn,En,g.vertical||un,_e,nn,yn,b.overscaling,jn);for(const ts of Kn)un&&bM(b,un.text,on,ts)||ls(Gn,ts,kt)}else if(cr==="line-center"){for(const Gn of o.geometry)if(Gn.length>1){const Kn=oM(Gn,En,g.vertical||un,_e,nn,yn);Kn&&ls(Gn,Kn,kt)}}else if(o.type==="Polygon")for(const Gn of m1(o.geometry,0)){const Kn=uM(Gn,16);ls(Gn[0],new g0(Kn.x,Kn.y,0,0,void 0),kt)}else if(o.type==="LineString")for(const Gn of o.geometry)ls(Gn,new g0(Gn[0].x,Gn[0].y,0,0,void 0),kt);else if(o.type==="Point")for(const Gn of o.geometry)for(const Kn of Gn)ls([Kn],new g0(Kn.x,Kn.y,0,0,void 0),kt)}const D1=255,y0=D1*fm;function _A(b,o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt,Ut,Kt,er,Jt,or){const cr=function(br,Pr,Dr,Or,nn,$r,un,gn){const yn=[];if(Pr.positionedLines.length===0)return yn;const Sn=Or.layout.get("text-rotate").evaluate($r,{})*Math.PI/180,An=function(Tn){const On=Tn[0],kn=Tn[1],ls=On*kn;return ls>0?[On,-kn]:ls<0?[-On,kn]:On===0?[kn,On]:[kn,-On]}(Dr);let wn=Math.abs(Pr.top-Pr.bottom);for(const Tn of Pr.positionedLines)wn-=Tn.lineOffset;const En=Pr.positionedLines.length,ln=wn/En;let on=Pr.top-Dr[1];for(let Tn=0;Tn<En;++Tn){const On=Pr.positionedLines[Tn];on=cM(Pr,ln,on,Tn);for(const kn of On.positionedGlyphs){if(!kn.rect)continue;const ls=kn.rect||{};let Gn=K2+1,Kn=!0,ts=1,qs=0;if(kn.image){const $s=un.get(kn.image.toString());if(!$s)continue;if($s.sdf){Wn("SDF images are not supported in formatted text and will be ignored.");continue}Kn=!1,ts=$s.pixelRatio,Gn=Yy/ts}const Dn=(nn||gn)&&kn.vertical,rs=kn.metrics.advance*kn.scale/2,Ms=kn.metrics,ro=kn.rect;if(ro===null)continue;gn&&Pr.verticalizable&&(qs=kn.image?rs-kn.metrics.width*kn.scale/2:0);const so=nn?[kn.x+rs,kn.y]:[0,0];let Os=[0,0],No=[0,0],wr=!1;nn||(Dn?(No=[kn.x+rs+An[0],kn.y+An[1]-qs],wr=!0):Os=[kn.x+rs+Dr[0],kn.y+Dr[1]-qs]);const Cr=ro.w*kn.scale/(ts*(kn.localGlyph?mm:1)),hn=ro.h*kn.scale/(ts*(kn.localGlyph?mm:1));let Cn,Vn,Un,cs;if(Dn){const $s=kn.y-on,Ws=new _n(-rs,rs-$s),Qs=-Math.PI/2,Es=new _n(...No);Cn=new _n(-rs+Os[0],Os[1]),Cn._rotateAround(Qs,Ws)._add(Es),Cn.x+=-$s+rs,Cn.y-=(Ms.left-Gn)*kn.scale;const Is=kn.image?Ms.advance*kn.scale:pu*kn.scale,ho=String.fromCodePoint(kn.glyph);HI(ho)?Cn.x+=(1-Gn)*kn.scale:WI(ho)?Cn.x+=Is-Ms.height*kn.scale+(-Gn-1)*kn.scale:Cn.x+=kn.image||Ms.width+2*Gn===ro.w&&Ms.height+2*Gn===ro.h?(Is-hn)/2:(Is-(Ms.height+2*Gn)*kn.scale)/2,Vn=new _n(Cn.x,Cn.y-Cr),Un=new _n(Cn.x+hn,Cn.y),cs=new _n(Cn.x+hn,Cn.y-Cr)}else{const $s=(Ms.left-Gn)*kn.scale-rs+Os[0],Ws=(-Ms.top-Gn)*kn.scale+Os[1],Qs=$s+Cr,Es=Ws+hn;Cn=new _n($s,Ws),Vn=new _n(Qs,Ws),Un=new _n($s,Es),cs=new _n(Qs,Es)}if(Sn){let $s;$s=nn?new _n(0,0):wr?new _n(An[0],An[1]):new _n(Dr[0],Dr[1]),Cn._rotateAround(Sn,$s),Vn._rotateAround(Sn,$s),Un._rotateAround(Sn,$s),cs._rotateAround(Sn,$s)}const ps=new _n(0,0),Ls=new _n(0,0);yn.push({tl:Cn,tr:Vn,bl:Un,br:cs,texPrimary:ls,texSecondary:void 0,writingMode:Pr.writingMode,glyphOffset:so,sectionIndex:kn.sectionIndex,isSDF:Kn,pixelOffsetTL:ps,pixelOffsetBR:Ls,minFontScaleX:0,minFontScaleY:0})}}return yn}(0,_e,ft,ot,at,ut,rt,b.allowVerticalPlacement),pr=b.textSizeData;let Sr=null;pr.kind==="source"?(Sr=[fm*ot.layout.get("text-size").evaluate(ut,{},er)*Ut.textScaleFactor],Sr[0]>y0&&Wn(`${b.layerIds[0]}: Value for "text-size" is >= ${D1}. Reduce your "text-size".`)):pr.kind==="composite"&&(Sr=[fm*Ut.compositeTextSizes[0].evaluate(ut,{},er)*Ut.textScaleFactor,fm*Ut.compositeTextSizes[1].evaluate(ut,{},er)*Ut.textScaleFactor],(Sr[0]>y0||Sr[1]>y0)&&Wn(`${b.layerIds[0]}: Value for "text-size" is >= ${D1}. Reduce your "text-size".`)),b.addSymbols(b.text,cr,Sr,ft,at,ut,Ct,o,g,xt.lineStartIndex,xt.lineLength,zt,Kt,er,or,!1,Jt,cr.length);for(const br of Rt)kt[br]=b.text.placedSymbolArray.length-1;return 4*cr.length}function ME(b){for(const o in b)return b[o];return null}function DE(b,o,g,_e,rt,ot,at,ut,ft,xt,Ct){let Rt,kt,zt,Ut;if(Rt=Ct?Ct.top:at.top,kt=Ct?Ct.bottom:at.bottom,zt=Ct?Ct.left:at.left,Ut=Ct?Ct.right:at.right,_S(at)&&at.collisionPadding){const Kt=at.collisionPadding;zt-=Kt[0],Rt-=Kt[1],Ut+=Kt[2],kt+=Kt[3]}if(ft){const Kt=new _n(zt,Rt),er=new _n(Ut,Rt),Jt=new _n(zt,kt),or=new _n(Ut,kt),cr=Xs(ft);let pr=new _n(0,0);xt&&(pr=new _n(xt[0],xt[1])),Kt._rotateAround(cr,pr),er._rotateAround(cr,pr),Jt._rotateAround(cr,pr),or._rotateAround(cr,pr),zt=Math.min(Kt.x,er.x,Jt.x,or.x),Ut=Math.max(Kt.x,er.x,Jt.x,or.x),Rt=Math.min(Kt.y,er.y,Jt.y,or.y),kt=Math.max(Kt.y,er.y,Jt.y,or.y)}return b.emplaceBack(o.x,o.y,o.z,g.x,g.y,zt,Rt,Ut,kt,ut,_e,rt,ot),b.length-1}function AS(b){_S(b)&&b.collisionPadding&&(b.top-=b.collisionPadding[1],b.bottom+=b.collisionPadding[3]);const o=b.bottom-b.top;return o>0?Math.max(10,o):null}function bM(b,o,g,_e){const rt=b.compareText;if(o in rt){const ot=rt[o];for(let at=ot.length-1;at>=0;at--)if(_e.dist(ot[at])<g)return!0}else rt[o]=[];return rt[o].push(_e),!1}function vA(b,o){const g=b.fovAboveCenter,_e=b.elevation?b.elevation.getMinElevationBelowMSL()*o:0,rt=(b._camera.position[2]*b.worldSize-_e)/Math.cos(b._pitch),ot=Math.sin(g)*rt/Math.sin(Math.max(Math.PI/2-b._pitch-g,.01));let at=Math.sin(b._pitch)*ot+rt;const ut=rt*(1/b._horizonShift);if(!b.elevation||b.elevation.exaggeration()===0){let ft=Math.max(b.zoom-17,0);b.isOrthographic&&(ft/=10),at*=1+ft}return Math.min(1.01*at,ut)}function N1(b,o){if(!o.isReprojectedInTileSpace)return{scale:1<<b.z,x:b.x,y:b.y,x2:b.x+1,y2:b.y+1,projection:o};const g=Math.pow(2,-b.z),_e=b.x*g,rt=(b.x+1)*g,ot=b.y*g,at=(b.y+1)*g,ut=Dt(_e),ft=Dt(rt),xt=Ht(ot),Ct=Ht(at),Rt=o.project(ut,xt),kt=o.project(ft,xt),zt=o.project(ft,Ct),Ut=o.project(ut,Ct);let Kt=Math.min(Rt.x,kt.x,zt.x,Ut.x),er=Math.min(Rt.y,kt.y,zt.y,Ut.y),Jt=Math.max(Rt.x,kt.x,zt.x,Ut.x),or=Math.max(Rt.y,kt.y,zt.y,Ut.y);const cr=g/16;function pr(br,Pr,Dr,Or,nn,$r){const un=(Dr+nn)/2,gn=(Or+$r)/2,yn=o.project(Dt(un),Ht(gn)),Sn=Math.max(0,Kt-yn.x,er-yn.y,yn.x-Jt,yn.y-or);Kt=Math.min(Kt,yn.x),Jt=Math.max(Jt,yn.x),er=Math.min(er,yn.y),or=Math.max(or,yn.y),Sn>cr&&(pr(br,yn,Dr,Or,un,gn),pr(yn,Pr,un,gn,nn,$r))}pr(Rt,kt,_e,ot,rt,ot),pr(kt,zt,rt,ot,rt,at),pr(zt,Ut,rt,at,_e,at),pr(Ut,Rt,_e,at,_e,ot),Kt-=cr,er-=cr,Jt+=cr,or+=cr;const Sr=1/Math.max(Jt-Kt,or-er);return{scale:Sr,x:Kt*Sr,y:er*Sr,x2:Jt*Sr,y2:or*Sr,projection:o}}function bA(b,{x:o,y:g},_e=0){return new _n(((o-_e)*b.scale-b.x)*jn,(g*b.scale-b.y)*jn)}const wM=$t(new Float32Array(16));class Y0{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,g){return{x:0,y:0,z:0}}unproject(o,g){return new $(0,0)}projectTilePoint(o,g,_e){return{x:o,y:g,z:0}}locationPoint(o,g,_e,rt=!0){return o._coordinatePoint(o.locationCoordinate(g,_e),rt)}pixelsPerMeter(o,g){return It(1,o)*g}pixelSpaceConversion(o,g,_e){return 1}farthestPixelDistance(o){return vA(o,o.pixelsPerMeter)}pointCoordinate(o,g,_e,rt){const ot=o.horizonLineFromTop(!1),at=new _n(g,Math.max(ot,_e));return o.rayIntersectionCoordinate(o.pointRayIntersection(at,rt))}pointCoordinate3D(o,g,_e){const rt=new _n(g,_e);if(o.elevation)return o.elevation.pointCoordinate(rt);{const ot=this.pointCoordinate(o,rt.x,rt.y,0);return[ot.x,ot.y,ot.z]}}isPointAboveHorizon(o,g){if(o.elevation&&o.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(o,g.x,g.y);const _e=o.horizonLineFromTop();return g.y<_e}createInversionMatrix(o,g){return wM}createTileMatrix(o,g,_e){let rt,ot,at;const ut=_e.canonical,ft=$t(new Float64Array(16));if(this.isReprojectedInTileSpace){const xt=N1(ut,this);rt=1,ot=xt.x+_e.wrap*xt.scale,at=xt.y,Vt(ft,ft,[rt/xt.scale,rt/xt.scale,o.pixelsPerMeter/g])}else rt=g/o.zoomScale(ut.z),ot=(ut.x+Math.pow(2,ut.z)*_e.wrap)*rt,at=ut.y*rt;return Nt(ft,ft,[ot,at,0]),Vt(ft,ft,[rt/jn,rt/jn,1]),ft}upVector(o,g,_e){return[0,0,1]}upVectorScale(o,g,_e){return{metersToTile:1}}}class EM extends Y0{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[g,_e]=this.parallels=o.parallels||[29.5,45.5],rt=Math.sin(Xs(g));this.n=(rt+Math.sin(Xs(_e)))/2,this.c=1+rt*(2*this.n-rt),this.r0=Math.sqrt(this.c)/this.n}project(o,g){const{n:_e,c:rt,r0:ot}=this,at=Xs(o-this.center[0]),ut=Xs(g),ft=Math.sqrt(rt-2*_e*Math.sin(ut))/_e;return{x:ft*Math.sin(at*_e),y:ft*Math.cos(at*_e)-ot,z:0}}unproject(o,g){const{n:_e,c:rt,r0:ot}=this,at=ot+g;let ut=Math.atan2(o,Math.abs(at))*Math.sign(at);at*_e<0&&(ut-=Math.PI*Math.sign(o)*Math.sign(at));const ft=Xs(this.center[0])*_e;ut=_r(ut,-Math.PI-ft,Math.PI-ft);const xt=tr(Mu(ut/_e)+this.center[0],-180,180),Ct=Math.asin(tr((rt-(o*o+at*at)*_e*_e)/(2*_e),-1,1)),Rt=tr(Mu(Ct),-qt,qt);return new $(xt,Rt)}}const L1=1.340264,j1=-.081106,O1=893e-6,F1=.003796,NE=Math.sqrt(3)/2;class TM extends Y0{project(o,g){g=g/180*Math.PI,o=o/180*Math.PI;const _e=Math.asin(NE*Math.sin(g)),rt=_e*_e,ot=rt*rt*rt;return{x:.5*(o*Math.cos(_e)/(NE*(L1+3*j1*rt+ot*(7*O1+9*F1*rt)))/Math.PI+.5),y:1-.5*(_e*(L1+j1*rt+ot*(O1+F1*rt))/Math.PI+1),z:0}}unproject(o,g){o=(2*o-.5)*Math.PI;let _e=g=(2*(1-g)-1)*Math.PI,rt=_e*_e,ot=rt*rt*rt;for(let Ct,Rt,kt,zt=0;zt<12&&(Rt=_e*(L1+j1*rt+ot*(O1+F1*rt))-g,kt=L1+3*j1*rt+ot*(7*O1+9*F1*rt),Ct=Rt/kt,_e=tr(_e-Ct,-Math.PI/3,Math.PI/3),rt=_e*_e,ot=rt*rt*rt,!(Math.abs(Ct)<1e-12));++zt);const at=NE*o*(L1+3*j1*rt+ot*(7*O1+9*F1*rt))/Math.cos(_e),ut=Math.asin(Math.sin(_e)/NE),ft=tr(180*at/Math.PI,-180,180),xt=tr(180*ut/Math.PI,-qt,qt);return new $(ft,xt)}}class SM extends Y0{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,g){return{x:.5+o/360,y:.5-g/360,z:0}}unproject(o,g){const _e=360*(o-.5),rt=tr(360*(.5-g),-qt,qt);return new $(_e,rt)}}const z_=Math.PI/2;function LE(b){return Math.tan((z_+b)/2)}class CM extends Y0{constructor(o){super(o),this.center=o.center||[0,30];const[g,_e]=this.parallels=o.parallels||[30,30];let rt=Xs(g),ot=Xs(_e);this.southernCenter=rt+ot<0,this.southernCenter&&(rt=-rt,ot=-ot);const at=Math.cos(rt),ut=LE(rt);this.n=rt===ot?Math.sin(rt):Math.log(at/Math.cos(ot))/Math.log(LE(ot)/ut),this.f=at*Math.pow(LE(rt),this.n)/this.n}project(o,g){g=Xs(g),this.southernCenter&&(g=-g),o=Xs(o-this.center[0]);const _e=1e-6,{n:rt,f:ot}=this;ot>0?g<-z_+_e&&(g=-z_+_e):g>z_-_e&&(g=z_-_e);const at=ot/Math.pow(LE(g),rt);let ut=at*Math.sin(rt*o),ft=ot-at*Math.cos(rt*o);return ut=.5*(ut/Math.PI+.5),ft=.5*(ft/Math.PI+.5),{x:ut,y:this.southernCenter?ft:1-ft,z:0}}unproject(o,g){o=(2*o-.5)*Math.PI,this.southernCenter&&(g=1-g),g=(2*(1-g)-.5)*Math.PI;const{n:_e,f:rt}=this,ot=rt-g,at=Math.sign(ot),ut=Math.sign(_e)*Math.sqrt(o*o+ot*ot);let ft=Math.atan2(o,Math.abs(ot))*at;ot*_e<0&&(ft-=Math.PI*Math.sign(o)*at);const xt=tr(Mu(ft/_e)+this.center[0],-180,180),Ct=tr(Mu(2*Math.atan(Math.pow(rt/ut,1/_e))-z_),-qt,qt);return new $(xt,this.southernCenter?-Ct:Ct)}}class wA extends Y0{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,g){return{x:mt(o),y:St(g),z:0}}unproject(o,g){const _e=Dt(o),rt=Ht(g);return new $(_e,rt)}}const EA=Xs(qt);class AM extends Y0{project(o,g){const _e=(g=Xs(g))*g,rt=_e*_e;return{x:.5*((o=Xs(o))*(.8707-.131979*_e+rt*(rt*(.003971*_e-.001529*rt)-.013791))/Math.PI+.5),y:1-.5*(g*(1.007226+_e*(.015085+rt*(.028874*_e-.044475-.005916*rt)))/Math.PI+1),z:0}}unproject(o,g){o=(2*o-.5)*Math.PI;let _e=g=(2*(1-g)-1)*Math.PI,rt=25,ot=0,at=_e*_e;do{at=_e*_e;const xt=at*at;ot=(_e*(1.007226+at*(.015085+xt*(.028874*at-.044475-.005916*xt)))-g)/(1.007226+at*(.045255+xt*(.259866*at-.311325-.005916*11*xt))),_e=tr(_e-ot,-EA,EA)}while(Math.abs(ot)>1e-6&&--rt>0);at=_e*_e;const ut=tr(Mu(o/(.8707+at*(at*(at*at*at*(.003971-.001529*at)-.013791)-.131979))),-180,180),ft=Mu(_e);return new $(ut,ft)}}const TA=Xs(qt);class RM extends Y0{project(o,g){g=Xs(g),o=Xs(o);const _e=Math.cos(g),rt=2/Math.PI,ot=Math.acos(_e*Math.cos(o/2)),at=Math.sin(ot)/ot,ut=.5*(o*rt+2*_e*Math.sin(o/2)/at)||0,ft=.5*(g+Math.sin(g)/at)||0;return{x:.5*(ut/Math.PI+.5),y:1-.5*(ft/Math.PI+1),z:0}}unproject(o,g){let _e=o=(2*o-.5)*Math.PI,rt=g=(2*(1-g)-1)*Math.PI,ot=25;const at=1e-6;let ut=0,ft=0;do{const xt=Math.cos(rt),Ct=Math.sin(rt),Rt=2*Ct*xt,kt=Ct*Ct,zt=xt*xt,Ut=Math.cos(_e/2),Kt=Math.sin(_e/2),er=2*Ut*Kt,Jt=Kt*Kt,or=1-zt*Ut*Ut,cr=or?1/or:0,pr=or?Math.acos(xt*Ut)*Math.sqrt(1/or):0,Sr=.5*(2*pr*xt*Kt+2*_e/Math.PI)-o,br=.5*(pr*Ct+rt)-g,Pr=.5*cr*(zt*Jt+pr*xt*Ut*kt)+1/Math.PI,Dr=cr*(er*Rt/4-pr*Ct*Kt),Or=.125*cr*(Rt*Kt-pr*Ct*zt*er),nn=.5*cr*(kt*Ut+pr*Jt*xt)+.5,$r=Dr*Or-nn*Pr;ut=(br*Dr-Sr*nn)/$r,ft=(Sr*Or-br*Pr)/$r,_e=tr(_e-ut,-Math.PI,Math.PI),rt=tr(rt-ft,-TA,TA)}while((Math.abs(ut)>at||Math.abs(ft)>at)&&--ot>0);return new $(Mu(_e),Mu(rt))}}class SA extends Y0{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Xs(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,g){const{scale:_e,cosPhi:rt}=this;return{x:Xs(o)*rt*_e+.5,y:-Math.sin(Xs(g))/rt*_e+.5,z:0}}unproject(o,g){const{scale:_e,cosPhi:rt}=this,ot=-(g-.5)/_e,at=tr(Mu((o-.5)/_e)/rt,-180,180),ut=Math.asin(tr(ot*rt,-1,1)),ft=tr(Mu(ut),-qt,qt);return new $(at,ft)}}class PM extends wA{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,g,_e){const rt=c1(o,g,_e);return _s(rt,rt,sE(kp(_e))),{x:rt[0],y:rt[1],z:rt[2]}}locationPoint(o,g,_e){const rt=G0(g.lat,g.lng),ot=ds([],rt),at=_e?o._centerAltitude+_e:o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(g),o._centerAltitude):o._centerAltitude;vn(rt,rt,ot,It(1,0)*jn*at);const ut=$t(new Float64Array(16));return Bt(ut,o.pixelMatrix,o.globeMatrix),_s(rt,rt,ut),new _n(rt[0],rt[1])}pixelsPerMeter(o,g){return It(1,0)*g}pixelSpaceConversion(o,g,_e){const rt=It(1,o)*g,ot=Cs(It(1,45)*g,rt,_e);return this.pixelsPerMeter(o,g)/ot}createTileMatrix(o,g,_e){const rt=MT(kp(_e.canonical));return Bt(new Float64Array(16),o.globeMatrix,rt)}createInversionMatrix(o,g){const{center:_e}=o,rt=sE(kp(g));return nr(rt,rt,Xs(_e.lng)),Xt(rt,rt,Xs(_e.lat)),Vt(rt,rt,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(rt)}pointCoordinate(o,g,_e,rt){return W0(o,g,_e,!0)||new hr(0,0)}pointCoordinate3D(o,g,_e){const rt=this.pointCoordinate(o,g,_e,0);return[rt.x,rt.y,rt.z]}isPointAboveHorizon(o,g){return!W0(o,g.x,g.y,!1)}farthestPixelDistance(o){const g=function(rt,ot){const at=rt.cameraToCenterDistance,ut=rt._centerAltitude*ot,ft=rt._camera,xt=rt._camera.forward(),Ct=rr([],tn([],xt,-at),[0,0,ut]),Rt=rt.worldSize/(2*Math.PI),kt=[0,0,-Rt],zt=rt.width/rt.height,Ut=Math.tan(rt.fovAboveCenter),Kt=tn([],ft.up(),Ut),er=tn([],ft.right(),Ut*zt),Jt=ds([],rr([],rr([],xt,Kt),er)),or=[];let cr;if(new _i(Ct,Jt).closestPointOnSphere(kt,Rt,or)){const pr=rr([],or,kt),Sr=wo([],pr,Ct);cr=Math.cos(rt.fovAboveCenter)*en(Sr)}else{const pr=wo([],Ct,kt),Sr=wo([],kt,Ct);ds(Sr,Sr);const br=en(pr)-Rt;cr=Math.sqrt(br*(br+2*Rt));const Pr=Math.acos(cr/(Rt+br))-Math.acos(gs(xt,Sr));cr*=Math.cos(Pr)}return 1.01*cr}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),_e=q0(o.zoom);if(_e>0){const rt=vA(o,It(1,o.center.lat)*o.worldSize),ot=o.worldSize/(2*Math.PI),at=Math.max(o.width,o.height)/o.worldSize*Math.PI;return Cs(g,rt+ot*(1-Math.cos(at)),Math.pow(_e,10))}return g}upVector(o,g,_e){return c1(g,_e,o,1)}upVectorScale(o){return{metersToTile:Wp(iE(kp(o)))}}}function CA(b){const o=b.parallels,g=!!o&&Math.abs(o[0]+o[1])<.01;switch(b.name){case"mercator":return new wA(b);case"equirectangular":return new SM(b);case"naturalEarth":return new AM(b);case"equalEarth":return new TM(b);case"winkelTripel":return new RM(b);case"albers":return g?new SA(b):new EM(b);case"lambertConformalConic":return g?new SA(b):new CM(b);case"globe":return new PM(b)}throw new Error(`Invalid projection name: ${b.name}`)}const IM=zr.types,kM=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function B1(b,o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt){const zt=ut?Math.min(y0,Math.round(ut[0])):0,Ut=ut?Math.min(y0,Math.round(ut[1])):0;b.emplaceBack(o,g,Math.round(32*_e),Math.round(32*rt),ot,at,(zt<<1)+(ft?1:0),0+(Ut<<1),16*xt,16*Ct,256*Rt,256*kt)}function z1(b,o,g){b.emplaceBack(o,g)}function V1(b,o,g,_e,rt,ot,at){b.emplaceBack(o,g,_e,rt,ot,at)}const jE=(b,o,g,_e)=>{for(let rt=0;rt<o;rt++)b.emplaceBack(g[0],g[1],g[2],_e[0],_e[1],_e[2])};function V_(b,o,g,_e,rt){b.emplaceBack(o,g,_e,rt),b.emplaceBack(o,g,_e,rt),b.emplaceBack(o,g,_e,rt),b.emplaceBack(o,g,_e,rt)}function MM(b){for(const o of b.sections)if(gT(o.text))return!0;return!1}class RS{constructor(o){this.layoutVertexArray=new Wv,this.indexArray=new tu,this.programConfigurations=o,this.segments=new _l,this.dynamicLayoutVertexArray=new Om,this.opacityVertexArray=new u_,this.placedSymbolArray=new Yw,this.iconTransitioningVertexArray=new rp,this.globeExtVertexArray=new qv,this.zOffsetVertexArray=new sm,this.orientationVertexArray=new Zv,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(o,g){const _e=[],rt=this.layoutVertexArray.uint16;for(let ot=0;ot<g;++ot){const at=12*(o+ot);_e.push(...rt.slice(at,at+12))}return _e}updateIconVertexData(o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt){const Ut=this.layoutVertexArray.uint16,Kt=12*o;Ut[Kt]=g,Ut[Kt+1]=_e,Ut[Kt+2]=rt,Ut[Kt+3]=ot,Ut[Kt+4]=at,Ut[Kt+5]=ut,Ut[Kt+6]=ft,Ut[Kt+7]=xt,Ut[Kt+8]=Ct,Ut[Kt+9]=Rt,Ut[Kt+10]=kt,Ut[Kt+11]=zt}upload(o,g,_e,rt,ot,at){this.isEmpty()||(_e&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,LI.members,!!at),this.indexBuffer=o.createIndexBuffer(this.indexArray,g),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,OI.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,kM,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=o.createVertexBuffer(this.iconTransitioningVertexArray,zI.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,jI.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||ot)&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,FI.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=o.createVertexBuffer(this.orientationVertexArray,BI.members,!0)),this.opacityVertexBuffer.itemSize=1),(_e||rt)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Jn(RS,"SymbolBuffers");class PS{constructor(o,g,_e){this.layoutVertexArray=new o,this.layoutAttributes=g,this.indexArray=new _e,this.segments=new _l,this.collisionVertexArray=new Kv,this.collisionVertexArrayExt=new Om}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,VI.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,UI.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Jn(PS,"CollisionBuffers");class OE{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(at=>at.fqid),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=$t([]),this.placementViewportMatrix=$t([]);const g=this.layers[0]._unevaluatedLayout._values;this.worldview=o.worldview,this.localizable=o.localizable,this.textSizeData=j_(this.zoom,g["text-size"],this.worldview),this.iconSizeData=j_(this.zoom,g["icon-size"],this.worldview);const _e=this.layers[0].layout,rt=_e.get("symbol-sort-key"),ot=_e.get("symbol-z-order");this.lut=o.lut,this.canOverlap=_e.get("text-allow-overlap")||_e.get("icon-allow-overlap")||_e.get("text-ignore-placement")||_e.get("icon-ignore-placement"),this.sortFeaturesByKey=ot!=="viewport-y"&&rt.constantOr(1)!==void 0,this.sortFeaturesByY=(ot==="viewport-y"||ot==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=_e.get("text-writing-mode").map(at=>ap[at]),this.stateDependentLayerIds=this.layers.filter(at=>at.isStateDependent()).map(at=>at.id),this.sourceID=o.sourceID,this.projection=o.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(o){const g=this.layers[0].getAppearances();return!(!g||g.length===0)&&g.some(_e=>_e.getProperty(o)!=null)}createArrays(){this.text=new RS(new Pp(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("text")||o.startsWith("symbol"))),this.icon=new RS(new Pp(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("icon")||o.startsWith("symbol"))),this.glyphOffsetArray=new x_,this.lineVertexArray=new Jw,this.symbolInstances=new t1}calculateGlyphDependencies(o,g,_e,rt,ot){for(const at of o){const ut=at.codePointAt(0);if(ut===void 0)break;if(g[ut]=!0,rt&&ot&&ut<=65535){const ft=R1[at];ft&&(g[ft.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(o,g,_e,rt,ot,at){let ut=1;const ft=o.getUnevaluatedProperties()._values["icon-size"],xt=j_(this.zoom,ft,this.worldview),Ct=O_(xt,g);if(xt.kind!=="constant"&&xt.kind!=="camera"||(ut=Ct.uSize),xt.kind==="composite"){const{minZoom:Rt,maxZoom:kt}=xt,zt=ft.possiblyEvaluate(new Xo(Rt,{worldview:this.worldview}),rt),Ut=ft.possiblyEvaluate(new Xo(kt,{worldview:this.worldview}),rt),Kt=zt.evaluate(_e,{},rt,ot);ut=Kt+(Ut.evaluate(_e,{},rt,ot)-Kt)*Ct.uSizeT}return xt.kind==="source"&&(ut=ft.possiblyEvaluate(new Xo(this.zoom,{worldview:this.worldview}),rt).evaluate(_e,{},rt,ot)),ut*at}updateFootprints(o,g){}updateReplacement(o,g){if(g.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=g.updateTime;const _e=g.getReplacementRegionsForTile(o.toUnwrapped(),!0);return!hE(this.activeReplacements,_e)&&(this.activeReplacements=_e,!0)}getResolvedImageFromTokens(o){return typeof o=="string"?ju.build(o):o}populate(o,g,_e,rt){const ot=this.layers[0],at=ot.layout,ut=this.projection.name==="globe",ft=at.get("text-font"),xt=at.get("text-field"),Ct=at.get("icon-image"),[Rt,kt]=at.get("icon-size-scale-range"),zt=tr(g.scaleFactor||1,Rt,kt),Ut=(xt.value.kind!=="constant"||xt.value.value instanceof Lu&&!xt.value.value.isEmpty()||xt.value.value.toString().length>0)&&(ft.value.kind!=="constant"||ft.value.value.length>0),Kt=Ct.value.kind!=="constant"||!!Ct.value.value||Object.keys(Ct.parameters).length>0,er=this.hasAnyAppearanceProperty("icon-image"),Jt=at.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!Ut&&!Kt&&!er)return;const or=g.iconDependencies,cr=g.glyphDependencies,pr=g.availableImages,Sr=new Xo(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),br=Pr=>{const Dr=Pr.id.toString();or.has(Dr)?or.get(Dr).push(Pr):or.set(Dr,[Pr])};for(const Pr of o){const{feature:Dr,id:Or,index:nn,sourceLayerIndex:$r}=Pr,un=ot._featureFilter.needGeometry,gn=Ur(Dr,un);if(!ot._featureFilter.filter(Sr,gn,_e))continue;if(un||(gn.geometry=kr(Dr,_e,rt)),ut&&Dr.type!==1&&_e.z<=5){const Tn=gn.geometry,On=.98078528056,kn=(ls,Gn)=>gs(c1(ls.x,ls.y,_e,1),c1(Gn.x,Gn.y,_e,1))<On;for(let ls=0;ls<Tn.length;ls++)Tn[ls]=Tr(Tn[ls],kn)}let yn,Sn;if(Ut){const Tn=ot.getValueAndResolveTokens("text-field",gn,_e,pr),On=Lu.factory(Tn);MM(On)&&(this.hasRTLText=!0),(!this.hasRTLText||Ny()==="unavailable"||this.hasRTLText&&im.isParsed())&&(yn=GI(On,ot,gn))}if(Kt){const Tn=ot.getValueAndResolveTokens("icon-image",gn,_e,pr);Sn=this.getResolvedImageFromTokens(Tn)}const An=this.layers[0];let wn=!1;if(!Sn&&er){const Tn=An.getAppearances();for(const On of Tn)if(On.getProperty("icon-image")){const kn=An.getAppearanceValueAndResolveTokens(On,"icon-image",gn,_e,pr);if(kn){Sn=this.getResolvedImageFromTokens(kn),wn=!0;break}}}if(!yn&&!Sn)continue;const En=this.sortFeaturesByKey?Jt.evaluate(gn,{},_e):void 0,ln={id:Or,text:yn,icon:Sn,index:nn,sourceLayerIndex:$r,geometry:gn.geometry,properties:Dr.properties,type:IM[Dr.type],sortKey:En};if(this.features.push(ln),this.featureToAppearanceIndex[nn]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:Or,properties:Dr.properties,usesAppearanceIconAsPlaceholder:wn,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),Sn){const Tn=An._unevaluatedLayout._values,{iconPrimary:On,iconSecondary:kn}=M1(Sn,this.iconSizeData,Tn["icon-size"],_e,this.zoom,ln,this.pixelRatio,zt,this.worldview);br(On),kn&&(this.hasAnySecondaryIcon=!0,br(kn))}const on=An.getAppearances();if(on.length!==0&&on.forEach(Tn=>{if(!Tn.getProperty("icon-image"))return;const On=this.getCombinedIconPrimary(Tn,An,gn,_e,pr,ln,zt);On&&br(On)}),yn){const Tn=ft.evaluate(gn,{},_e).join(","),On=at.get("text-rotation-alignment")==="map"&&at.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ap.vertical)>=0;for(const kn of yn.sections)if(kn.image){const ls=kn.image.getPrimary().scaleSelf(this.pixelRatio),Gn=ls.id.toString(),Kn=or.get(Gn)||[];Kn.push(ls),or.set(Gn,Kn)}else{const ls=My(yn.toString()),Gn=kn.fontStack||Tn,Kn=cr[Gn]=cr[Gn]||{};this.calculateGlyphDependencies(kn.text,Kn,On,this.allowVerticalPlacement,ls)}}}if(at.get("symbol-placement")==="line"&&(this.features=function(Pr){const Dr={},Or={},nn=[];let $r=0;function un(An){nn.push(Pr[An]),$r++}function gn(An,wn,En){const ln=Or[An];return delete Or[An],Or[wn]=ln,nn[ln].geometry[0].pop(),nn[ln].geometry[0]=nn[ln].geometry[0].concat(En[0]),ln}function yn(An,wn,En){const ln=Dr[wn];return delete Dr[wn],Dr[An]=ln,nn[ln].geometry[0].shift(),nn[ln].geometry[0]=En[0].concat(nn[ln].geometry[0]),ln}function Sn(An,wn,En){const ln=En?wn[0][wn[0].length-1]:wn[0][0];return`${An}:${ln.x}:${ln.y}`}for(let An=0;An<Pr.length;An++){const wn=Pr[An],En=wn.geometry,ln=wn.text?wn.text.toString():null;if(!ln){un(An);continue}const on=Sn(ln,En),Tn=Sn(ln,En,!0);if(on in Or&&Tn in Dr&&Or[on]!==Dr[Tn]){const On=yn(on,Tn,En),kn=gn(on,Tn,nn[On].geometry);delete Dr[on],delete Or[Tn],Or[Sn(ln,nn[kn].geometry,!0)]=kn,nn[On].geometry=null}else on in Or?gn(on,Tn,En):Tn in Dr?yn(on,Tn,En):(un(An),Dr[on]=$r-1,Or[Tn]=$r-1)}return nn.filter(An=>An.geometry)}(this.features)),at.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",g.elevationFeatures){!this.elevationFeatures&&g.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Pr of g.elevationFeatures)this.elevationFeatureIdToIndex.set(Pr.id,this.elevationFeatures.length),this.elevationFeatures.push(Pr)}}else at.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Pr,Dr)=>Pr.sortKey-Dr.sortKey)}getCombinedIconPrimary(o,g,_e,rt,ot,at,ut){let ft,xt;const Ct=o.getUnevaluatedProperties();if(Ct._values["icon-image"].value!==void 0){const Rt=g.getAppearanceValueAndResolveTokens(o,"icon-image",_e,rt,ot);ft=this.getResolvedImageFromTokens(Rt)}else{const Rt=g.getValueAndResolveTokens("icon-image",_e,rt,ot);ft=this.getResolvedImageFromTokens(Rt)}if(ft){const Rt=Ct._values["icon-size"]||g._unevaluatedLayout._values["icon-size"];xt=M1(ft,j_(this.zoom,Rt,this.worldview),Rt,rt,this.zoom,at,this.pixelRatio,ut,this.worldview).iconPrimary}return xt}updateAppearanceBasedIconTextures(o,g,_e,rt){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const ot=this.layers[0];let at=!1,ut=0;const ft=ot.layout,[xt,Ct]=ft.get("icon-size-scale-range"),Rt=tr(1,xt,Ct);for(let kt=0;kt<this.symbolInstances.length;kt++){const zt=this.symbolInstances.get(kt),Ut=this.featureToAppearanceIndex[zt.featureIndex],Kt=Ut!==void 0?this.appearanceFeatureData[Ut]:void 0;if(Kt&&zt.placedIconSymbolIndex>=0){const er=Kt.id,Jt=g&&er!==void 0?g[String(er)]:void 0,or={type:"Point",id:Kt.id,properties:Kt.properties,geometry:[]},cr=this.layers[0].appearances&&this.layers[0].appearances.find(pr=>pr.isActive({globals:rt,feature:or,canonical:o,featureState:Jt}));if(Kt.activeAppearance===cr){ut+=zt.numIconVertices;continue}if(cr){Kt.activeAppearance=cr;const pr=this.getCombinedIconPrimary(cr,ot,or,o,_e,{sortKey:void 0,text:void 0,icon:null,index:zt.featureIndex,sourceLayerIndex:zt.featureIndex,geometry:[],properties:Kt.properties,type:"Point",id:Kt.id},Rt);if(!pr)continue;const Sr=pr.toString(),br=this.iconAtlasPositions&&this.iconAtlasPositions.get(Sr);if(br){const Pr=ot.getAppearanceValueAndResolveTokens(cr,"icon-offset",or,o,_e),Dr=Pr&&Array.isArray(Pr)?Pr:[0,0];let Or=AE(br,void 0,Dr,ot.layout.get("icon-anchor").evaluate(or,{},o));const nn=ot.getAppearanceValueAndResolveTokens(cr,"icon-rotate",or,o,_e),$r=typeof nn=="number"?nn:0,un=br.sdf,gn=ot.layout.get("icon-text-fit").constantOr("none");gn!=="none"&&Kt.textShaping&&Kt.iconTextFitPadding&&Kt.fontScale&&(Or=vS(Or,Kt.textShaping,gn,Kt.iconTextFitPadding,Dr,Kt.fontScale));const yn=this.calculateEffectiveAppearanceIconSize(cr,rt.zoom,or,o,_e,Rt),Sn=0,An=1+(Math.min(y0,Math.round(yn*fm))<<1),wn=TS(Or,$r,un,gn!=="none",Rt);Kt.isUsingAppearanceVertexData||(Kt.isUsingAppearanceVertexData=!0,Kt.layoutBasedVertexData=this.icon.getIconVertexData(ut,zt.numIconVertices));for(let ln=0;ln<wn.length;++ln){const on=wn[ln],Tn=Kt.layoutBasedVertexData[0]||zt.tileAnchorX,On=Kt.layoutBasedVertexData[1]||zt.tileAnchorY,kn=16*on.pixelOffsetTL.x,ls=16*on.pixelOffsetTL.y,Gn=16*on.pixelOffsetBR.x,Kn=16*on.pixelOffsetBR.y,ts=16*on.minFontScaleX,qs=16*on.minFontScaleY;this.icon.updateIconVertexData(ut,Tn,On,Math.round(32*on.tl.x),Math.round(32*on.tl.y),on.texPrimary.x,on.texPrimary.y,Sn,An,kn,ls,ts,qs),this.icon.updateIconVertexData(ut+1,Tn,On,Math.round(32*on.tr.x),Math.round(32*on.tr.y),on.texPrimary.x+on.texPrimary.w,on.texPrimary.y,Sn,An,Gn,ls,ts,qs),this.icon.updateIconVertexData(ut+2,Tn,On,Math.round(32*on.bl.x),Math.round(32*on.bl.y),on.texPrimary.x,on.texPrimary.y+on.texPrimary.h,Sn,An,kn,Kn,ts,qs),this.icon.updateIconVertexData(ut+3,Tn,On,Math.round(32*on.br.x),Math.round(32*on.br.y),on.texPrimary.x+on.texPrimary.w,on.texPrimary.y+on.texPrimary.h,Sn,An,Gn,Kn,ts,qs),ut+=4}const En=zt.numIconVertices-4*wn.length;for(let ln=0;ln<En;++ln)this.icon.updateIconVertexData(ut+ln,0,0,0,0,0,0,0,0,0,0,0,0);at=!0}else ut+=zt.numIconVertices}else if(Kt.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(ut,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(ut+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(ut+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(ut+3,0,0,0,0,0,0,0,0,0,0,0,0),at=!0),ut+=zt.numIconVertices,Kt.activeAppearance=null;else if(Kt.isUsingAppearanceVertexData){const Sr=Kt.layoutBasedVertexData.length/12;for(let br=0;br<Sr;++br){const Pr=br*12;this.icon.updateIconVertexData(ut+br,Kt.layoutBasedVertexData[Pr+0],Kt.layoutBasedVertexData[Pr+1],Kt.layoutBasedVertexData[Pr+2],Kt.layoutBasedVertexData[Pr+3],Kt.layoutBasedVertexData[Pr+4],Kt.layoutBasedVertexData[Pr+5],Kt.layoutBasedVertexData[Pr+6],Kt.layoutBasedVertexData[Pr+7],Kt.layoutBasedVertexData[Pr+8],Kt.layoutBasedVertexData[Pr+9],Kt.layoutBasedVertexData[Pr+10],Kt.layoutBasedVertexData[Pr+11])}ut+=Sr,Kt.isUsingAppearanceVertexData=!1,Kt.activeAppearance=null,at=!0}else ut+=zt.numIconVertices,Kt.activeAppearance=null}}return at}update(o,g,_e,rt,ot,at,ut){this.text.programConfigurations.updatePaintArrays(o,g,ot,_e,rt,at,ut,this.worldview),this.icon.programConfigurations.updatePaintArrays(o,g,ot,_e,rt,at,ut,this.worldview)}updateRoadElevation(o){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let g=!1;const _e=ir(o),rt=1/_e;let ot=!1,at=!1;for(let ut=0;ut<this.symbolInstances.length;ut++){const ft=this.symbolInstances.get(ut),xt=yr(1,0,0),Ct=yr(0,1,0),{numHorizontalGlyphVertices:Rt,numVerticalGlyphVertices:kt,numIconVertices:zt,numVerticalIconVertices:Ut}=ft,Kt=Rt>0||kt>0,er=zt>0,Jt=this.elevationFeatures[ft.elevationFeatureIndex];if(Jt){const or=new _n(ft.tileAnchorX,ft.tileAnchorY),cr=.075+Jt.pointElevation(or);ft.zOffset!==cr&&(g=!0,ft.zOffset=cr),cr!==0&&(this.hasAnyZOffset=!0);const pr=Jt.computeSlopeNormal(or,rt),Sr=Xn(Yn(),yr(0,0,1),pr);Vl(xt,xt,Sr),Vl(Ct,Ct,Sr),xt[2]*=_e,Ct[2]*=_e,xt[0]===1&&xt[1]===0&&xt[2]===0&&Ct[0]===0&&Ct[1]===1&&Ct[2]===0||(ot=ot||Kt,at=at||er)}if(Kt&&(jE(this.text.orientationVertexArray,Rt,xt,Ct),jE(this.text.orientationVertexArray,kt,xt,Ct)),er){const{placedIconSymbolIndex:or,verticalPlacedIconSymbolIndex:cr}=ft;or>=0&&jE(this.icon.orientationVertexArray,zt,xt,Ct),cr>=0&&jE(this.icon.orientationVertexArray,Ut,xt,Ct)}}ot||(this.text.orientationVertexArray=void 0),at||(this.icon.orientationVertexArray=void 0),g&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const o=(ot,at,ut)=>{_e+=at,_e>ot.length&&ot.resize(_e);for(let ft=-at;ft<0;ft++)ot.emplace(ft+_e,ut)},g=(ot,at,ut)=>{rt+=at,rt>ot.length&&ot.resize(rt);for(let ft=-at;ft<0;ft++)ot.emplace(ft+rt,ut)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let _e=0,rt=0;for(let ot=0;ot<this.symbolInstances.length;ot++){const at=this.symbolInstances.get(ot),{numHorizontalGlyphVertices:ut,numVerticalGlyphVertices:ft,numIconVertices:xt}=at,Ct=at.zOffset,Rt=xt>0;if((ut>0||ft>0)&&(o(this.text.zOffsetVertexArray,ut,Ct),o(this.text.zOffsetVertexArray,ft,Ct)),Rt){const{placedIconSymbolIndex:kt,verticalPlacedIconSymbolIndex:zt}=at;kt>=0&&g(this.icon.zOffsetVertexArray,xt,Ct),zt>=0&&g(this.icon.zOffsetVertexArray,at.numVerticalIconVertices,Ct)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o,g,_e,rt,ot){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(at=>at.appearances&&at.appearances.length>0)),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(o,g,_e,rt){return!!(o&&g&&_e)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(o,g,_e,rt)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=CA(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,g){const _e=this.lineVertexArray.length;if(o.segment!==void 0)for(const{x:rt,y:ot}of g)this.lineVertexArray.emplaceBack(rt,ot);return{lineStartIndex:_e,lineLength:this.lineVertexArray.length-_e}}addSymbols(o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt,Ut,Kt,er,Jt,or){const cr=o.indexArray,pr=o.layoutVertexArray,Sr=o.globeExtVertexArray,br=o.segments.prepareSegment(4*or,pr,cr,this.canOverlap?at.sortKey:void 0),Pr=this.glyphOffsetArray.length,Dr=br.vertexLength,Or=this.allowVerticalPlacement&&ut===ap.vertical?Math.PI/2:0,nn=at.text&&at.text.sections;for(let gn=0;gn<g.length;gn++){const{tl:yn,tr:Sn,bl:An,br:wn,texPrimary:En,texSecondary:ln,pixelOffsetTL:on,pixelOffsetBR:Tn,minFontScaleX:On,minFontScaleY:kn,glyphOffset:ls,isSDF:Gn,sectionIndex:Kn}=g[gn],ts=br.vertexLength,qs=ls[1];if(B1(pr,xt.x,xt.y,yn.x,qs+yn.y,En.x,En.y,_e,Gn,on.x,on.y,On,kn),B1(pr,xt.x,xt.y,Sn.x,qs+Sn.y,En.x+En.w,En.y,_e,Gn,Tn.x,on.y,On,kn),B1(pr,xt.x,xt.y,An.x,qs+An.y,En.x,En.y+En.h,_e,Gn,on.x,Tn.y,On,kn),B1(pr,xt.x,xt.y,wn.x,qs+wn.y,En.x+En.w,En.y+En.h,_e,Gn,Tn.x,Tn.y,On,kn),ft){const{x:Dn,y:rs,z:Ms}=ft.anchor,[ro,so,Os]=ft.up;V1(Sr,Dn,rs,Ms,ro,so,Os),V1(Sr,Dn,rs,Ms,ro,so,Os),V1(Sr,Dn,rs,Ms,ro,so,Os),V1(Sr,Dn,rs,Ms,ro,so,Os),V_(o.dynamicLayoutVertexArray,Dn,rs,Ms,Or)}else V_(o.dynamicLayoutVertexArray,xt.x,xt.y,xt.z,Or);if(er){const Dn=ln||En;z1(o.iconTransitioningVertexArray,Dn.x,Dn.y),z1(o.iconTransitioningVertexArray,Dn.x+Dn.w,Dn.y),z1(o.iconTransitioningVertexArray,Dn.x,Dn.y+Dn.h),z1(o.iconTransitioningVertexArray,Dn.x+Dn.w,Dn.y+Dn.h)}cr.emplaceBack(ts,ts+1,ts+2),cr.emplaceBack(ts+1,ts+2,ts+3),br.vertexLength+=4,br.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ls[0]),gn!==g.length-1&&Kn===g[gn+1].sectionIndex||o.programConfigurations.populatePaintArrays(pr.length,at,at.index,{},zt,Ut,Kt,nn&&nn[Kn],this.worldview)}const $r=or-g.length;$r!==0&&this._addNullVertices($r,pr,_e,ft,Sr,o,er,br,cr);const un=ft?ft.anchor:xt;o.placedSymbolArray.emplaceBack(un.x,un.y,un.z,xt.x,xt.y,Pr,this.glyphOffsetArray.length-Pr,Dr,Ct,Rt,xt.segment,_e?_e[0]:0,_e?_e[1]:0,rt[0],rt[1],ut,0,0,0,kt,0),o.symbolInstanceIndices.push(Jt)}_addNullVertices(o,g,_e,rt,ot,at,ut,ft,xt){for(let Ct=0;Ct<o;Ct++){for(let kt=0;kt<4;kt++)B1(g,0,0,0,0,0,0,_e,!1,0,0,0,0),rt&&V1(ot,0,0,0,0,0,0),V_(at.dynamicLayoutVertexArray,0,0,0,0),ut&&z1(at.iconTransitioningVertexArray,0,0);const Rt=ft.vertexLength;xt.emplaceBack(Rt,Rt+1,Rt+2),xt.emplaceBack(Rt+1,Rt+2,Rt+3),ft.vertexLength+=4,ft.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(o,g,_e,rt,ot,at,ut){o.emplaceBack(g,_e,rt,ot,at,Math.round(ut.x),Math.round(ut.y))}_addCollisionDebugVertices(o,g,_e,rt,ot,at,ut){const ft=_e.segments.prepareSegment(4,_e.layoutVertexArray,_e.indexArray),xt=ft.vertexLength,Ct=ut.tileAnchorX,Rt=ut.tileAnchorY;for(let zt=0;zt<4;zt++)_e.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(_e.collisionVertexArrayExt,g,o.padding,ut.zOffset),this._commitLayoutVertex(_e.layoutVertexArray,rt,ot,at,Ct,Rt,new _n(o.x1,o.y1)),this._commitLayoutVertex(_e.layoutVertexArray,rt,ot,at,Ct,Rt,new _n(o.x2,o.y1)),this._commitLayoutVertex(_e.layoutVertexArray,rt,ot,at,Ct,Rt,new _n(o.x2,o.y2)),this._commitLayoutVertex(_e.layoutVertexArray,rt,ot,at,Ct,Rt,new _n(o.x1,o.y2)),ft.vertexLength+=4;const kt=_e.indexArray;kt.emplaceBack(xt,xt+1),kt.emplaceBack(xt+1,xt+2),kt.emplaceBack(xt+2,xt+3),kt.emplaceBack(xt+3,xt),ft.primitiveLength+=4}_addTextDebugCollisionBoxes(o,g,_e,rt,ot,at){for(let ut=rt;ut<ot;ut++){const ft=_e.get(ut),xt=this.getSymbolInstanceTextSize(o,at,g,ut);this._addCollisionDebugVertices(ft,xt,this.textCollisionBox,ft.projectedAnchorX,ft.projectedAnchorY,ft.projectedAnchorZ,at)}}_addIconDebugCollisionBoxes(o,g,_e,rt,ot,at){for(let ut=rt;ut<ot;ut++){const ft=_e.get(ut),xt=this.getSymbolInstanceIconSize(o,g,at.placedIconSymbolIndex);this._addCollisionDebugVertices(ft,xt,this.iconCollisionBox,ft.projectedAnchorX,ft.projectedAnchorY,ft.projectedAnchorZ,at)}}generateCollisionDebugBuffers(o,g,_e){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new PS(d_,G2.members,rp),this.iconCollisionBox=new PS(d_,G2.members,rp);const rt=O_(this.iconSizeData,o),ot=O_(this.textSizeData,o,_e);for(let at=0;at<this.symbolInstances.length;at++){const ut=this.symbolInstances.get(at);this._addTextDebugCollisionBoxes(ot,o,g,ut.textBoxStartIndex,ut.textBoxEndIndex,ut),this._addTextDebugCollisionBoxes(ot,o,g,ut.verticalTextBoxStartIndex,ut.verticalTextBoxEndIndex,ut),this._addIconDebugCollisionBoxes(rt,o,g,ut.iconBoxStartIndex,ut.iconBoxEndIndex,ut),this._addIconDebugCollisionBoxes(rt,o,g,ut.verticalIconBoxStartIndex,ut.verticalIconBoxEndIndex,ut)}}getSymbolInstanceTextSize(o,g,_e,rt){const ot=this.text.placedSymbolArray.get(g.rightJustifiedTextSymbolIndex>=0?g.rightJustifiedTextSymbolIndex:g.centerJustifiedTextSymbolIndex>=0?g.centerJustifiedTextSymbolIndex:g.leftJustifiedTextSymbolIndex>=0?g.leftJustifiedTextSymbolIndex:g.verticalPlacedTextSymbolIndex>=0?g.verticalPlacedTextSymbolIndex:rt),at=bS(this.textSizeData,o,ot)/pu;return this.tilePixelRatio*at}getSymbolInstanceIconSize(o,g,_e){const rt=this.icon.placedSymbolArray.get(_e),ot=bS(this.iconSizeData,o,rt);return this.tilePixelRatio*ot}_commitDebugCollisionVertexUpdate(o,g,_e,rt){o.emplaceBack(g,-_e,-_e,rt),o.emplaceBack(g,_e,-_e,rt),o.emplaceBack(g,_e,_e,rt),o.emplaceBack(g,-_e,_e,rt)}_updateTextDebugCollisionBoxes(o,g,_e,rt,ot,at,ut){for(let ft=rt;ft<ot;ft++){const xt=_e.get(ft),Ct=this.getSymbolInstanceTextSize(o,at,g,ft);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,Ct,xt.padding,at.zOffset)}}_updateIconDebugCollisionBoxes(o,g,_e,rt,ot,at,ut){for(let ft=rt;ft<ot;ft++){const xt=_e.get(ft),Ct=this.getSymbolInstanceIconSize(o,g,at.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,Ct,xt.padding,at.zOffset)}}updateCollisionDebugBuffers(o,g,_e,rt){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const ot=O_(this.iconSizeData,o,rt),at=O_(this.textSizeData,o,_e);for(let ut=0;ut<this.symbolInstances.length;ut++){const ft=this.symbolInstances.get(ut);this._updateTextDebugCollisionBoxes(at,o,g,ft.textBoxStartIndex,ft.textBoxEndIndex,ft,_e),this._updateTextDebugCollisionBoxes(at,o,g,ft.verticalTextBoxStartIndex,ft.verticalTextBoxEndIndex,ft,_e),this._updateIconDebugCollisionBoxes(ot,o,g,ft.iconBoxStartIndex,ft.iconBoxEndIndex,ft,rt),this._updateIconDebugCollisionBoxes(ot,o,g,ft.verticalIconBoxStartIndex,ft.verticalIconBoxEndIndex,ft,rt)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,g,_e,rt,ot,at,ut,ft,xt){const Ct={};if(g<_e){const{x1:Rt,y1:kt,x2:zt,y2:Ut,padding:Kt,projectedAnchorX:er,projectedAnchorY:Jt,projectedAnchorZ:or,tileAnchorX:cr,tileAnchorY:pr,featureIndex:Sr}=o.get(g);Ct.textBox={x1:Rt,y1:kt,x2:zt,y2:Ut,padding:Kt,projectedAnchorX:er,projectedAnchorY:Jt,projectedAnchorZ:or,tileAnchorX:cr,tileAnchorY:pr},Ct.textFeatureIndex=Sr}if(rt<ot){const{x1:Rt,y1:kt,x2:zt,y2:Ut,padding:Kt,projectedAnchorX:er,projectedAnchorY:Jt,projectedAnchorZ:or,tileAnchorX:cr,tileAnchorY:pr,featureIndex:Sr}=o.get(rt);Ct.verticalTextBox={x1:Rt,y1:kt,x2:zt,y2:Ut,padding:Kt,projectedAnchorX:er,projectedAnchorY:Jt,projectedAnchorZ:or,tileAnchorX:cr,tileAnchorY:pr},Ct.verticalTextFeatureIndex=Sr}if(at<ut){const{x1:Rt,y1:kt,x2:zt,y2:Ut,padding:Kt,projectedAnchorX:er,projectedAnchorY:Jt,projectedAnchorZ:or,tileAnchorX:cr,tileAnchorY:pr,featureIndex:Sr}=o.get(at);Ct.iconBox={x1:Rt,y1:kt,x2:zt,y2:Ut,padding:Kt,projectedAnchorX:er,projectedAnchorY:Jt,projectedAnchorZ:or,tileAnchorX:cr,tileAnchorY:pr},Ct.iconFeatureIndex=Sr}if(ft<xt){const{x1:Rt,y1:kt,x2:zt,y2:Ut,padding:Kt,projectedAnchorX:er,projectedAnchorY:Jt,projectedAnchorZ:or,tileAnchorX:cr,tileAnchorY:pr,featureIndex:Sr}=o.get(ft);Ct.verticalIconBox={x1:Rt,y1:kt,x2:zt,y2:Ut,padding:Kt,projectedAnchorX:er,projectedAnchorY:Jt,projectedAnchorZ:or,tileAnchorX:cr,tileAnchorY:pr},Ct.verticalIconFeatureIndex=Sr}return Ct}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let g=0;g<this.symbolInstances.length;g++){const _e=this.symbolInstances.get(g);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,_e.textBoxStartIndex,_e.textBoxEndIndex,_e.verticalTextBoxStartIndex,_e.verticalTextBoxEndIndex,_e.iconBoxStartIndex,_e.iconBoxEndIndex,_e.verticalIconBoxStartIndex,_e.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(o,g){const _e=o.placedSymbolArray.get(g),rt=_e.vertexStartIndex+4*_e.numGlyphs;for(let ot=_e.vertexStartIndex;ot<rt;ot+=4)o.indexArray.emplaceBack(ot,ot+1,ot+2),o.indexArray.emplaceBack(ot+1,ot+2,ot+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const g=Math.sin(o),_e=Math.cos(o),rt=[],ot=[],at=[];for(let ut=0;ut<this.symbolInstances.length;++ut){at.push(ut);const ft=this.symbolInstances.get(ut);rt.push(0|Math.round(g*ft.tileAnchorX+_e*ft.tileAnchorY)),ot.push(ft.featureIndex)}return at.sort((ut,ft)=>rt[ut]-rt[ft]||ot[ft]-ot[ut]),at}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let o=0;o<this.symbolInstances.length;++o)this.symbolInstanceIndexesSortedZOffset.push(o)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((o,g)=>this.symbolInstances.get(g).zOffset-this.symbolInstances.get(o).zOffset)}addToSortKeyRanges(o,g){const _e=this.sortKeyRanges[this.sortKeyRanges.length-1];_e&&_e.sortKey===g?_e.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:g,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const g of this.symbolInstanceIndexes){const _e=this.symbolInstances.get(g);this.featureSortOrder.push(_e.featureIndex);const{rightJustifiedTextSymbolIndex:rt,centerJustifiedTextSymbolIndex:ot,leftJustifiedTextSymbolIndex:at,verticalPlacedTextSymbolIndex:ut,placedIconSymbolIndex:ft,verticalPlacedIconSymbolIndex:xt}=_e;rt>=0&&this.addIndicesForPlacedSymbol(this.text,rt),ot>=0&&ot!==rt&&this.addIndicesForPlacedSymbol(this.text,ot),at>=0&&at!==ot&&at!==rt&&this.addIndicesForPlacedSymbol(this.text,at),ut>=0&&this.addIndicesForPlacedSymbol(this.text,ut),ft>=0&&this.addIndicesForPlacedSymbol(this.icon,ft),xt>=0&&this.addIndicesForPlacedSymbol(this.icon,xt)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(o){const g=this.symbolInstances.get(this.text.symbolInstanceIndices[o]).elevationFeatureIndex;let _e;return this.elevationFeatures&&g<this.elevationFeatures.length&&(_e=this.elevationFeatures[g]),_e}}function AA(b,o){return o.replace(/{([^{}]+)}/g,(g,_e)=>_e in b?String(b[_e]):"")}let RA,PA,IS;Jn(OE,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),OE.addDynamicAttributes=V_;class IA{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:Tp,this.defaultValue=o}evaluate(o){if(o.formattedSection){const g=this.defaultValue.property.overrides;if(g&&g.hasOverride(o.formattedSection))return g.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Jn(IA,"FormatSectionOverride",{omit:["defaultValue"]});const kS=()=>IS||(IS={layout:RA||(RA=new Dl({"symbol-placement":new Nn(Hr.layout_symbol["symbol-placement"]),"symbol-spacing":new Nn(Hr.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Nn(Hr.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Bn(Hr.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Nn(Hr.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Nn(Hr.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Nn(Hr.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Nn(Hr.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Nn(Hr.layout_symbol["icon-ignore-placement"]),"icon-optional":new Nn(Hr.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Nn(Hr.layout_symbol["icon-rotation-alignment"]),"icon-size":new Bn(Hr.layout_symbol["icon-size"]),"icon-size-scale-range":new Nn(Hr.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Bn(Hr.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Bn(Hr.layout_symbol["icon-text-fit-padding"]),"icon-image":new Bn(Hr.layout_symbol["icon-image"]),"icon-image-use-theme":new Nn({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Bn(Hr.layout_symbol["icon-rotate"]),"icon-padding":new Nn(Hr.layout_symbol["icon-padding"]),"icon-keep-upright":new Nn(Hr.layout_symbol["icon-keep-upright"]),"icon-offset":new Bn(Hr.layout_symbol["icon-offset"]),"icon-anchor":new Bn(Hr.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Nn(Hr.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Nn(Hr.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Nn(Hr.layout_symbol["text-rotation-alignment"]),"text-field":new Bn(Hr.layout_symbol["text-field"]),"text-font":new Bn(Hr.layout_symbol["text-font"]),"text-size":new Bn(Hr.layout_symbol["text-size"]),"text-size-scale-range":new Nn(Hr.layout_symbol["text-size-scale-range"]),"text-max-width":new Bn(Hr.layout_symbol["text-max-width"]),"text-line-height":new Bn(Hr.layout_symbol["text-line-height"]),"text-letter-spacing":new Bn(Hr.layout_symbol["text-letter-spacing"]),"text-justify":new Bn(Hr.layout_symbol["text-justify"]),"text-radial-offset":new Bn(Hr.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Nn(Hr.layout_symbol["text-variable-anchor"]),"text-anchor":new Bn(Hr.layout_symbol["text-anchor"]),"text-max-angle":new Nn(Hr.layout_symbol["text-max-angle"]),"text-writing-mode":new Nn(Hr.layout_symbol["text-writing-mode"]),"text-rotate":new Bn(Hr.layout_symbol["text-rotate"]),"text-padding":new Nn(Hr.layout_symbol["text-padding"]),"text-keep-upright":new Nn(Hr.layout_symbol["text-keep-upright"]),"text-transform":new Bn(Hr.layout_symbol["text-transform"]),"text-offset":new Bn(Hr.layout_symbol["text-offset"]),"text-allow-overlap":new Nn(Hr.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Nn(Hr.layout_symbol["text-ignore-placement"]),"text-optional":new Nn(Hr.layout_symbol["text-optional"]),visibility:new Nn(Hr.layout_symbol.visibility)})),paint:PA||(PA=new Dl({"icon-opacity":new Bn(Hr.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Bn(Hr.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Bn(Hr.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Bn(Hr.paint_symbol["text-emissive-strength"]),"icon-color":new Bn(Hr.paint_symbol["icon-color"]),"icon-halo-color":new Bn(Hr.paint_symbol["icon-halo-color"]),"icon-halo-width":new Bn(Hr.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Bn(Hr.paint_symbol["icon-halo-blur"]),"icon-translate":new Nn(Hr.paint_symbol["icon-translate"]),"icon-translate-anchor":new Nn(Hr.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Nn(Hr.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Bn(Hr.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Bn(Hr.paint_symbol["text-occlusion-opacity"]),"text-color":new Bn(Hr.paint_symbol["text-color"],{runtimeType:Gu,getOverride:b=>b.textColor,hasOverride:b=>!!b.textColor}),"text-halo-color":new Bn(Hr.paint_symbol["text-halo-color"]),"text-halo-width":new Bn(Hr.paint_symbol["text-halo-width"]),"text-halo-blur":new Bn(Hr.paint_symbol["text-halo-blur"]),"text-translate":new Nn(Hr.paint_symbol["text-translate"]),"text-translate-anchor":new Nn(Hr.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Nn(Hr.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Nn(Hr.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Nn(Hr.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Nn(Hr.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Bn(Hr.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"})}))},IS);class FE extends Bu{constructor(o,g,_e,rt){super(o,kS(),g,_e,rt,o.layout?o.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=$t([]),this.hasOcclusionOpacityProperties=o.paint!==void 0&&("icon-occlusion-opacity"in o.paint||"text-occlusion-opacity"in o.paint)}_handleSpecialPaintPropertyUpdate(o){o!=="icon-occlusion-opacity"&&o!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(o,g){super.recalculate(o,g),this.appearances&&this.appearances.forEach(rt=>{rt.recalculate(o,g,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const _e=this.layout.get("text-writing-mode");if(_e){const rt=[];for(const ot of _e)rt.indexOf(ot)<0&&rt.push(ot);this.layout._values["text-writing-mode"]=rt}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(o,g,_e,rt){return this._saturation===o&&this._contrast===g&&this._brightnessMin===_e&&this._brightnessMax===rt||(this._colorAdjustmentMatrix=function(ot,at,ut,ft){ot=Cl(ot),at=po(at);const xt=Mt(),Ct=ot/3,Rt=1-2*Ct,kt=[Rt,Ct,Ct,0,Ct,Rt,Ct,0,Ct,Ct,Rt,0,0,0,0,1],zt=.5-.5*at,Ut=ft-ut;return Bt(xt,[Ut,0,0,0,0,Ut,0,0,0,0,Ut,0,ut,ut,ut,1],[at,0,0,0,0,at,0,0,0,0,at,0,zt,zt,zt,1]),Bt(xt,xt,kt),xt}(o,g,_e,rt),this._saturation=o,this._contrast=g,this._brightnessMin=_e,this._brightnessMax=rt),this._colorAdjustmentMatrix}getValueAndResolveTokens(o,g,_e,rt){const ot=this.layout.get(o).evaluate(g,{},_e,rt),at=this._unevaluatedLayout._values[o];return at.isDataDriven()||Iy(at.value)||!ot?ot:AA(g.properties,ot)}getAppearanceValueAndResolveTokens(o,g,_e,rt,ot){const at=o.getProperty(g);if(!at)return;const ut=at.evaluate(_e,{},rt,ot),ft=o.getUnevaluatedProperties()._values[g];return ft.isDataDriven()||Iy(ft.value)||!ut||typeof ut!="string"?ut:AA(_e.properties,ut)}createBucket(o){return new OE(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of kS().paint.overridableProperties){if(!FE.hasPaintOverride(this.layout,o))continue;const g=this.paint.get(o),_e=new IA(g),rt=new Kx(_e,g.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let ot=null;ot=g.value.kind==="constant"||g.value.kind==="source"?new L0("source",rt):new i0("composite",rt,g.value.zoomStops,g.value.interpolationType),this.paint._values[o]=new o0(g.property,ot,g.parameters)}}_handleOverridablePaintPropertyUpdate(o,g,_e){return!(!this.layout||g.isDataDriven()||_e.isDataDriven())&&FE.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,g){const _e=o.get("text-field"),rt=kS().paint.properties[g];let ot=!1;const at=ut=>{for(const ft of ut)if(rt.overrides&&rt.overrides.hasOverride(ft))return void(ot=!0)};if(_e.value.kind==="constant"&&_e.value.value instanceof Lu)at(_e.value.value.sections);else if(_e.value.kind==="source"){const ut=xt=>{ot||(xt instanceof Qp&&du(xt.value)===my?at(xt.value.sections):xt instanceof Fp?at(xt.sections):xt.eachChild(ut))},ft=_e.value;ft._styleExpression&&ut(ft._styleExpression.expression)}return ot}getProgramIds(){return["symbol"]}getDefaultProgramParams(o,g,_e){return{config:new Bm(this,{zoom:g,lut:_e}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let kA,MA,DA,NA;var MS=Ys([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function BE(b,o,g,_e,rt,ot,at,ut){const ft=[b,o,1,g,_e,1,rt,ot,1],xt=[at,ut,1],Ct=Et([],ft),[Rt,kt,zt]=Ss(xt,xt,Ct);return At(ft,ft,[Rt,0,0,0,kt,0,0,0,zt])}function LA(b,o,g,_e,rt,ot,at,ut){const ft=function(xt,Ct,Rt,kt,zt,Ut,Kt,er){const Jt=BE(0,0,1,0,1,1,0,1),or=BE(xt,Ct,Rt,kt,zt,Ut,Kt,er);return At(or,or,Et([],Jt))}(b,o,g,_e,rt,ot,at,ut);return[ft[2]/ft[8]/jn,ft[5]/ft[8]/jn]}function zE(b){return[b[0],Math.min(Math.max(b[1],-qt),qt)]}class jA extends Jm{constructor(o,g,_e,rt){super(),this.id=o,this.dispatcher=_e,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(rt),this.options=g,this._dirty=!1}load(o,g){if(this._loaded=g||!1,this.fire(new jp("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return o&&(this.coordinates=o),this._loaded=!0,void this._finishLoading();this._imageRequest=mx(this.map._requestManager.transformRequest(this.url,ly.Image),(_e,rt)=>{this._imageRequest=null,this._loaded=!0,_e?this.fire(new dy(_e)):rt&&(this.image=rt instanceof HTMLImageElement?hu.getImageData(rt):rt,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return o.url?(this._imageRequest&&o.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=o.url,this.load(o.coordinates,this._loaded),this):this}setTexture(o){if(!(o.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new S1(this.map.painter.context,o.handle),this.width=o.dimensions[0],this.height=o.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new jp("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(o){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof S1||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(o){if(this.coordinates=o,this._boundsArray=void 0,this._unsupportedCoords=!1,!o.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let g=o[0][1],_e=o[0][1];for(const ot of o)ot[1]>_e&&(_e=ot[1]),ot[1]<g&&(g=ot[1]);const rt=(_e+g)/2;if(rt>qt?this.onNorthPole=!0:rt<-qt&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const ot=o.map(hr.fromLngLat);this.tileID=function(at){let ut=1/0,ft=1/0,xt=-1/0,Ct=-1/0;for(const Kt of at)ut=Math.min(ut,Kt.x),ft=Math.min(ft,Kt.y),xt=Math.max(xt,Kt.x),Ct=Math.max(Ct,Kt.y);const Rt=Math.max(xt-ut,Ct-ft),kt=Math.max(0,Math.floor(-Math.log2(Rt))),zt=Math.pow(2,kt);let Ut=Math.floor((ut+xt)/2*zt);return Ut>1&&(Ut-=1),new Fo(kt,Ut,Math.floor((ft+Ct)/2*zt))}(ot),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new jp("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof S1||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(o){for(const Jt in this.tiles){const or=this.tiles[Jt];or.state!=="loaded"&&(or.state="loaded",or.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const g=N1(new Fo(0,0,0),this.map.transform.projection),_e=[g.projection.project(this.coordinates[0][0],this.coordinates[0][1]),g.projection.project(this.coordinates[1][0],this.coordinates[1][1]),g.projection.project(this.coordinates[2][0],this.coordinates[2][1]),g.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(Jt){const or=Jt[1].x-Jt[0].x,cr=Jt[1].y-Jt[0].y,pr=Jt[2].x-Jt[1].x,Sr=Jt[2].y-Jt[1].y,br=Jt[3].x-Jt[2].x,Pr=Jt[3].y-Jt[2].y,Dr=Jt[0].x-Jt[3].x,Or=Jt[0].y-Jt[3].y,nn=or*Sr-pr*cr,$r=pr*Pr-br*Sr,un=br*Or-Dr*Pr,gn=Dr*cr-or*Or;return nn>0&&$r>0&&un>0&&gn>0||nn<0&&$r<0&&un<0&&gn<0}(_e))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const rt=N1(this.tileID,this.map.transform.projection),[ot,at,ut,ft]=this.coordinates.map(Jt=>{const or=rt.projection.project(Jt[0],Jt[1]);return bA(rt,or)._round()});this.perspectiveTransform=LA(ot.x,ot.y,at.x,at.y,ut.x,ut.y,ft.x,ft.y);const xt=this._boundsArray=new B0;xt.emplaceBack(ot.x,ot.y,0,0),xt.emplaceBack(at.x,at.y,jn,0),xt.emplaceBack(ft.x,ft.y,0,jn),xt.emplaceBack(ut.x,ut.y,jn,jn),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=o.createVertexBuffer(xt,MS.members),this.boundsSegments=_l.simpleSegment(0,0,4,2);const Ct=[],Rt=[zE((kt=this.coordinates)[0]),zE(kt[1]),zE(kt[2]),zE(kt[3])];var kt;const[zt,Ut,Kt,er]=function(Jt){let or=Jt[0][0],cr=or,pr=Jt[0][1],Sr=pr;for(let br=1;br<Jt.length;br++)Jt[br][0]<or?or=Jt[br][0]:Jt[br][0]>cr&&(cr=Jt[br][0]),Jt[br][1]<pr?pr=Jt[br][1]:Jt[br][1]>Sr&&(Sr=Jt[br][1]);return[or,pr,cr-or,Sr-pr]}(Rt);{const Jt=new B0,[or,cr,pr,Sr]=function(wn){let En=wn[0].x,ln=En,on=wn[0].y,Tn=on;for(let On=1;On<wn.length;On++)wn[On].x<En?En=wn[On].x:wn[On].x>ln&&(ln=wn[On].x),wn[On].y<on?on=wn[On].y:wn[On].y>Tn&&(Tn=wn[On].y);return[En,on,ln-En,Tn-on]}(_e),br=wn=>[(wn.x-or)/pr,(wn.y-cr)/Sr],[Pr,Dr,Or,nn]=_e.map(br),$r=function(wn,En,ln,on,Tn,On,kn,ls){const Gn=BE(0,0,1,0,1,1,0,1);return At(Gn,Gn,Et([],BE(wn,En,ln,on,Tn,On,kn,ls)))}(Pr[0],Pr[1],Dr[0],Dr[1],Or[0],Or[1],nn[0],nn[1]);this.elevatedGlobePerspectiveTransform=LA(Pr[0],Pr[1],Dr[0],Dr[1],Or[0],Or[1],nn[0],nn[1]);const un=(wn,En)=>{Ct.push(wn.lng);const ln=Math.round((wn.lng-zt)/Kt*jn),on=Math.round((wn.lat-Ut)/er*jn),Tn=br(En),On=Ss([],[Tn[0],Tn[1],1],$r),kn=Math.round(On[0]/On[2]*jn),ls=Math.round(On[1]/On[2]*jn);Jt.emplaceBack(ln,on,kn,ls)},gn=_e[3].x-_e[0].x,yn=_e[3].y-_e[0].y,Sn=_e[2].x-_e[1].x,An=_e[2].y-_e[1].y;for(let wn=0;wn<65;wn++){const En=wn/64,ln=[_e[0].x+En*gn,_e[0].y+En*yn],on=[_e[1].x+En*Sn,_e[1].y+En*An],Tn=on[0]-ln[0],On=on[1]-ln[1];for(let kn=0;kn<65;kn++){const ls=kn/64,Gn={x:ln[0]+Tn*ls,y:ln[1]+On*ls};un(g.projection.unproject(Gn.x,Gn.y),Gn)}}this.elevatedGlobeVertexBuffer=o.createVertexBuffer(Jt,MS.members)}{this.maxLongitudeTriangleSize=0;let Jt=[],or=new tu;const cr=(pr,Sr,br)=>{or.emplaceBack(pr,Sr,br);const Pr=Ct[pr],Dr=Ct[Sr],Or=Ct[br],nn=Math.min(Math.min(Pr,Dr),Or),$r=Math.max(Math.max(Pr,Dr),Or)-nn;$r>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=$r),Jt.push(nn+$r/2)};for(let pr=0;pr<64;pr++)for(let Sr=0;Sr<64;Sr++){const br=65*pr+Sr,Pr=br+1,Dr=br+65,Or=Dr+1;cr(br,Dr,Pr),cr(Pr,Dr,Or)}[Jt,or]=function(pr,Sr){const br=Array.from({length:pr.length},(Or,nn)=>nn);br.sort((Or,nn)=>pr[Or]-pr[nn]);const Pr=[],Dr=new tu;for(let Or=0;Or<br.length;Or++){const nn=br[Or];Pr.push(pr[nn]);const $r=3*nn,un=$r+1;Dr.emplaceBack(Sr.uint16[$r],Sr.uint16[un],Sr.uint16[un+1])}return[Pr,Dr]}(Jt,or),this.elevatedGlobeTrianglesCenterLongitudes=Jt,this.elevatedGlobeIndexBuffer=o.createIndexBuffer(or)}this.elevatedGlobeSegments=_l.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,Kt/jn,0,er/jn,0,0,Ut,zt,0])}prepare(){const o=Object.keys(this.tiles).length!==0;if(this.tileID&&!o)return;const g=this.map.painter.context,_e=g.gl;!this._dirty||this.texture instanceof S1||(this.texture?this.texture.update(this.image):(this.texture=new nS(g,this.image,_e.RGBA8),this.texture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)),this._dirty=!1),o&&this._prepareData(g)}loadTile(o,g){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},g(null)):(o.state="errored",g(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(o){const g=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!g)return null;const _e=this.elevatedGlobeTrianglesCenterLongitudes;let rt=(ot=o+180)+360*Math.round((_e[0]-ot)/360);var ot;const at=new _l,ut=(Rt,kt)=>{at.segments.push({vertexOffset:0,primitiveOffset:Rt,vertexLength:g.segments[0].vertexLength,primitiveLength:kt,sortKey:void 0,vaos:{}})},ft=.51*this.maxLongitudeTriangleSize;if(Math.abs(_e[0]-rt)<=ft){const Rt=Sl(_e,0,_e.length,rt+ft);return Rt===_e.length||ut(Rt,eu(_e,Rt+1,_e.length,rt+360-ft)-Rt),at}rt<_e[0]&&(rt+=360);const xt=eu(_e,0,_e.length,rt-ft);if(xt===_e.length)return ut(0,_e.length),at;ut(0,xt-0);const Ct=Sl(_e,xt+1,_e.length,rt+ft);return Ct!==_e.length&&ut(Ct,_e.length-Ct),at}}const DM=(Math.pow(256,2)-1)/16907520;class OA extends Bu{constructor(o,g,_e,rt){super(o,{layout:DA||(DA=new Dl({visibility:new Nn(Hr.layout_raster.visibility)})),paint:NA||(NA=new Dl({"raster-opacity":new Nn(Hr.paint_raster["raster-opacity"]),"raster-color":new l0(Hr.paint_raster["raster-color"]),"raster-color-mix":new Nn(Hr.paint_raster["raster-color-mix"]),"raster-color-range":new Nn(Hr.paint_raster["raster-color-range"]),"raster-hue-rotate":new Nn(Hr.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Nn(Hr.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Nn(Hr.paint_raster["raster-brightness-max"]),"raster-saturation":new Nn(Hr.paint_raster["raster-saturation"]),"raster-contrast":new Nn(Hr.paint_raster["raster-contrast"]),"raster-resampling":new Nn(Hr.paint_raster["raster-resampling"]),"raster-fade-duration":new Nn(Hr.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Nn(Hr.paint_raster["raster-emissive-strength"]),"raster-array-band":new Nn(Hr.paint_raster["raster-array-band"]),"raster-elevation":new Nn(Hr.paint_raster["raster-elevation"]),"raster-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"})}))},g,_e,rt),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(o){return!(o&&o._source instanceof jA&&(o._source.onNorthPole||o._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(o){o!=="raster-color"&&o!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(o){if(!this.hasColorMap()||!this._curRampRange)return;const g=this._transitionablePaint._values["raster-color"].value.expression,[_e,rt]=o||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(_e)&&isNaN(rt)||_e===this._curRampRange[0]&&rt===this._curRampRange[1]||(this.colorRamp=u1({expression:g,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:_e,end:rt}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[_e,rt])}}let FA,BA,zA,VA,UA;class $A extends Bu{constructor(o,g,_e,rt){super(o,{layout:FA||(FA=new Dl({visibility:new Nn(Hr["layout_raster-particle"].visibility)})),paint:BA||(BA=new Dl({"raster-particle-array-band":new Nn(Hr["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Nn(Hr["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new l0(Hr["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Nn(Hr["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Nn(Hr["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Nn(Hr["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Nn(Hr["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Nn(Hr["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"})}))},g,_e,rt),this._updateColorRamp(),this.lastInvalidatedAt=hu.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(o){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(o){return!1}_handleSpecialPaintPropertyUpdate(o){o!=="raster-particle-color"&&o!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),o==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const o=this._transitionablePaint._values["raster-particle-color"].value.expression,g=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=u1({expression:o,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:g}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=hu.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class NM extends Bu{constructor(o,g){super(o,{},g,null),this.implementation=o,o.slot&&(this.slot=o.slot)}is3D(o){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(o){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}function DS(b,o,g){const _e=[0,0,1],rt=xn([]);return os(rt,rt,g?-Xs(b)+Math.PI:Xs(b)),Qn(rt,rt,-Xs(o)),Vl(_e,_e,rt),ds(_e,_e)}const GA={None:0,Model:1,Symbol:2,FillExtrusion:4};class VE{constructor(o,g,_e,rt){this.message=(o?`${o}: `:"")+_e,rt&&(this.identifier=rt),g!=null&&g.__line__&&(this.line=g.__line__)}}function NS(b,o){const g=b.indexOf("://")===-1;try{return new URL(b,g&&o?"http://example.com":void 0),!0}catch{return!1}}class HA{constructor(o,g){this.feature=o,this.instancedDataOffset=g,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class WA{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Jv,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(o){const g=16*o,_e=this.instancedDataArray.float32;let rt=Math.floor(_e[g+2]);const ot=1.05*(_e[g+2]-rt);return rt/=100,[_e[g]%1*1.05,_e[g+1]%1*1.05,ot,rt]}tileCoordinatesForInstance(o){const g=16*o,_e=this.instancedDataArray.float32;let rt=_e[g+0];return rt=rt>jn?rt-jn:rt,new _n(Math.trunc(rt),Math.trunc(_e[g+1]))}translationForInstance(o){const g=16*o,_e=this.instancedDataArray.float32;return[_e[g+4],_e[g+5],_e[g+6]]}rotationScaleForInstance(o){const g=16*o,_e=this.instancedDataArray.float32;return[_e[g+7],_e[g+8],_e[g+9],_e[g+10],_e[g+11],_e[g+12],_e[g+13],_e[g+14],_e[g+15]]}transformForInstance(o){const g=16*o,_e=this.instancedDataArray.float32;return[_e[g+7],_e[g+8],_e[g+9],_e[g+4],_e[g+10],_e[g+11],_e[g+12],_e[g+5],_e[g+13],_e[g+14],_e[g+15],_e[g+6],0,0,0,1]}}class LS{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaledZ=this.canonical.z+Math.log2(o.overscaling),this.layers=o.layers,this.layerIds=this.layers.map(g=>g.fqid),this.projection=o.projection,this.index=o.index,this.worldview=o.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=o.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(o,g){}updateAppearances(o,g,_e,rt){}populate(o,g,_e,rt){this.tileToMeter=ir(_e);const ot=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:at,id:ut,index:ft,sourceLayerIndex:xt}of o){const Ct=ut??(at.properties&&at.properties.hasOwnProperty("id")?at.properties.id:void 0),Rt=Ur(at,ot);if(!this.layers[0]._featureFilter.filter(new Xo(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),Rt,_e))continue;const kt={id:Ct,sourceLayerIndex:xt,index:ft,geometry:ot?Rt.geometry:kr(at,_e,rt),properties:at.properties,type:at.type,patterns:{}},zt=this.addFeature(kt,kt.geometry,Rt);zt&&g.featureIndex.insert(at,kt.geometry,ft,xt,this.index,this.instancesPerModel[zt].instancedDataArray.length,jn/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const o=this.layers[0].modelManager,g=this.layers[0].scope;let _e=0;for(const rt of this.modelUris){const ot=o.getModel(rt,g);if(!ot)continue;const at=this.instancesPerModel[rt];if(at){const ut=.5*hs(ot.aabb.max,ot.aabb.min)*at.maxScale+at.maxXYTranslationDistance,ft=Math.min(jn,Math.max(ut/this.tileToMeter,jn/32));_e=Math.max(ft,_e)}}return _e}update(o,g,_e,rt){for(const ot in this.instancesPerModel){const at=this.instancesPerModel[ot];for(const ut in o)at.idToFeaturesIndex.hasOwnProperty(ut)&&(this.evaluate(at.features[at.idToFeaturesIndex[ut]],o[ut],at,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let o=!1;for(const g in this.instancesPerModel){const _e=this.instancesPerModel[g];for(const rt of _e.features){const ot=this.layers[0],at=rt.feature,ut=this.canonical,ft=ot.paint.get("model-rotation").evaluate(at,{},ut),xt=ot.paint.get("model-scale").evaluate(at,{},ut),Ct=ot.paint.get("model-translation").evaluate(at,{},ut);Qo(rt.rotation,ft)&&Qo(rt.scale,xt)&&Qo(rt.translation,Ct)||(this.evaluate(rt,rt.featureStates,_e,!0),o=!0)}}return o}updateReplacement(o,g,_e,rt){if(g.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=g.updateTime;const ot=g.getReplacementRegionsForTile(o.toUnwrapped(),!0);if(hE(this.activeReplacements,ot))return!1;this.activeReplacements=ot;let at=!1;for(const ut in this.instancesPerModel){const ft=this.instancesPerModel[ut],xt=ft.instancedDataArray;for(const Ct of ft.features){const Rt=Ct.instancedDataOffset,kt=Ct.instancedDataCount;for(let zt=0;zt<kt;zt++){const Ut=16*(zt+Rt);let Kt=xt.float32[Ut+0];const er=Kt>jn;Kt=er?Kt-jn:Kt;const Jt=Math.floor(Kt),or=Math.floor(xt.float32[Ut+1]);let cr=!1;for(const pr of this.activeReplacements)if(!MC(pr,_e,GA.Model,rt)&&!(pr.min.x>Jt||Jt>pr.max.x||pr.min.y>or||or>pr.max.y)&&(cr=OC(jC(Jt,or,o.canonical,pr.footprintTileId.canonical),pr.footprint),cr))break;xt.float32[Ut]=cr?Kt+jn:Kt,at=at||cr!==er}}}return at}isEmpty(){for(const o in this.instancesPerModel)if(this.instancesPerModel[o].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(o){if(!this.uploaded)for(const g in this.instancesPerModel){const _e=this.instancesPerModel[g];_e.instancedDataArray.length<0||_e.instancedDataArray.length===0||(_e.instancedDataBuffer?_e.instancedDataBuffer.updateData(_e.instancedDataArray):_e.instancedDataBuffer=o.createVertexBuffer(_e.instancedDataArray,iI.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(o){for(const _e in this.instancesPerModel){const rt=this.instancesPerModel[_e];rt.instancedDataArray.length!==0&&rt.instancedDataBuffer&&rt.instancedDataBuffer.destroy()}const g=this.layers[0].modelManager;if(o&&g&&this.modelUris&&this.modelsRequested)for(const _e of this.modelUris)g.removeModel(_e,"",!0)}addFeature(o,g,_e){const rt=this.layers[0],ot=rt.layout.get("model-id").evaluate(_e,{},this.canonical);if(!ot)return Wn(`modelId is not evaluated for layer ${rt.id} and it is not going to get rendered.`),ot;(NS(ot,!1)||this.styleDefinedModelURLs[ot]!==void 0)&&(this.modelUris.includes(ot)||this.modelUris.push(ot)),this.instancesPerModel[ot]||(this.instancesPerModel[ot]=new WA);const at=this.instancesPerModel[ot],ut=at.instancedDataArray,ft=new HA(_e,ut.length);for(const xt of g)for(const Ct of xt){if(Ct.x<0||Ct.x>=jn||Ct.y<0||Ct.y>=jn)continue;if(this.lookupDim!==0){const kt=(this.lookupDim-1)/jn,zt=this.lookupDim*(Ct.y*kt|0)+Ct.x*kt|0;if(this.lookup){if(this.lookup[zt]!==0)continue;this.lookup[zt]=1}}this.instanceCount++;const Rt=ut.length;ut.resize(Rt+1),at.instancesEvaluatedElevation.push(0),ut.float32[16*Rt]=Ct.x,ut.float32[16*Rt+1]=Ct.y}return ft.instancedDataCount=at.instancedDataArray.length-ft.instancedDataOffset,ft.instancedDataCount>0&&(o.id&&(at.idToFeaturesIndex[o.id]=at.features.length),at.features.push(ft),this.evaluate(ft,{},at,!1)),ot}getModelUris(){return this.modelUris}evaluate(o,g,_e,rt){const ot=this.layers[0],at=o.feature,ut=this.canonical,ft=o.rotation=ot.paint.get("model-rotation").evaluate(at,g,ut),xt=o.scale=ot.paint.get("model-scale").evaluate(at,g,ut),Ct=o.translation=ot.paint.get("model-translation").evaluate(at,g,ut),Rt=Object.assign({},ot.paint.get("model-color").evaluate(at,g,ut));Rt.a=ot.paint.get("model-color-mix-intensity").evaluate(at,g,ut);const kt=[];this.maxVerticalOffset<Ct[2]&&(this.maxVerticalOffset=Ct[2]);const zt=Ct[0]*Ct[0]+Ct[1]*Ct[1],Ut=zt>0?Math.sqrt(zt):0;_e.maxScale=Math.max(Math.max(_e.maxScale,xt[0]),Math.max(xt[1],xt[2])),_e.maxXYTranslationDistance=Math.max(_e.maxXYTranslationDistance,Ut),this.maxScale=Math.max(Math.max(this.maxScale,xt[0]),Math.max(xt[1],xt[2])),E2(kt,ft,xt);const Kt=Math.round(100*Rt.a)+Rt.b/1.05;for(let er=0;er<o.instancedDataCount;++er){const Jt=o.instancedDataOffset+er,or=16*Jt,cr=_e.instancedDataArray.float32;let pr=0;rt&&(pr=cr[or+6]-_e.instancesEvaluatedElevation[Jt]);const Sr=0|cr[or+1];cr[or]=(0|cr[or])+Rt.r/1.05,cr[or+1]=Sr+Rt.g/1.05,cr[or+2]=Kt,cr[or+3]=1/(ut.z>10?this.tileToMeter:ir(ut,Sr)),cr[or+4]=Ct[0],cr[or+5]=Ct[1],cr[or+6]=Ct[2]+pr,cr[or+7]=kt[0],cr[or+8]=kt[1],cr[or+9]=kt[2],cr[or+10]=kt[4],cr[or+11]=kt[5],cr[or+12]=kt[6],cr[or+13]=kt[8],cr[or+14]=kt[9],cr[or+15]=kt[10],_e.instancesEvaluatedElevation[Jt]=Ct[2]}}}let qA,KA;Jn(LS,"ModelBucket",{omit:["layers"]}),Jn(WA,"PerModelAttributes"),Jn(HA,"ModelFeature");class U_{constructor(o,g,_e){this._demTile=o,this._dem=this._demTile.dem,this._scale=g,this._offset=_e}static create(o,g,_e){const rt=_e||o.findDEMTileFor(g);if(!rt||!rt.dem)return;const ot=rt.dem,at=rt.tileID,ut=1<<g.canonical.z-at.canonical.z;return new U_(rt,ot.dim/jn/ut,[(g.canonical.x/ut-at.canonical.x)*ot.dim,(g.canonical.y/ut-at.canonical.y)*ot.dim])}tileCoordToPixel(o,g){const _e=g*this._scale+this._offset[1];return new _n(Math.floor(o*this._scale+this._offset[0]),Math.floor(_e))}getElevationAt(o,g,_e,rt){const ot=o*this._scale+this._offset[0],at=g*this._scale+this._offset[1],ut=Math.floor(ot),ft=Math.floor(at),xt=this._dem;return rt=!!rt,_e?Cs(Cs(xt.get(ut,ft,rt),xt.get(ut,ft+1,rt),at-ft),Cs(xt.get(ut+1,ft,rt),xt.get(ut+1,ft+1,rt),at-ft),ot-ut):xt.get(ut,ft,rt)}getElevationAtPixel(o,g,_e){return this._dem.get(o,g,!!_e)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*It(1,o)*this._dem.stride}}const jS=new Float32Array(262144),Qy=new Uint8Array(262144);function XA(b){let o=0;if(b.meshes)for(const g of b.meshes)o=Math.max(o,g.aabb.max[2]);if(b.children)for(const g of b.children)o=Math.max(o,XA(g));return o}function ZA(b,o,g){if(b.meshes)for(const _e of b.meshes){if(_e.aabb.min[0]===1/0)continue;const rt=is.applyTransform(_e.aabb,b.globalMatrix);g.insert(o,rt.min[0],rt.min[1],rt.max[0],rt.max[1])}if(b.children)for(const _e of b.children)ZA(_e,o,g)}const YA=["","wall","door","roof","window","lamp","logo"];class QA{constructor(o){this.node=o,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:o.id,geometry:[],properties:{height:XA(o)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new is([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let o=0;const g=new is([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const _e of this.node.meshes)this.node.lightMeshIndex!==o&&(_e.transformedAabb=is.applyTransformFast(_e.aabb,this.node.globalMatrix),g.encapsulate(_e.transformedAabb)),o++;this.aabb=g}return this.aabb}}class UE{constructor(o,g,_e,rt,ot,at,ut,ft){this.id=_e,this.layers=o,this.layerIds=this.layers.map(xt=>xt.fqid),this.stateDependentLayerIds=this.layers.filter(xt=>xt.isStateDependent()).map(xt=>xt.id),this.modelTraits|=D_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,rt&&(this.modelTraits|=D_.HasMapboxMeshFeatures),ot&&(this.modelTraits|=D_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=at,this.worldview=ft,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const xt of g)this.nodesInfo.push(new QA(xt)),ZA(xt,ut.featureIndexArray.length,ut.grid),ut.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,ut.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(o,g){for(const _e of this.getNodesInfo()){const rt=_e.node;rt.footprint&&g.push({footprint:rt.footprint,id:o})}}updateAppearances(o,g,_e,rt){}update(o){const g=Object.keys(o).length!==0;if(g&&!this.stateDependentLayers.length)return;const _e=g?this.stateDependentLayers:this.layers;if(!Su(o,this.states))for(const rt of _e)this.evaluate(rt,o);this.states=structuredClone(o)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(o){if(!this.needsUpload)return;const g=this.getNodesInfo();for(const _e of g){const rt=_e.node;this.uploaded?this.updatePbrBuffer(rt):oS(rt,o,!0)}for(const _e of g)EE(_e.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(o){let g=!1;if(!o.meshes)return g;for(const _e of o.meshes)_e.pbrBuffer&&(_e.pbrBuffer.updateData(_e.featureArray),g=!0);return g}needsReEvaluation(o,g,_e){const rt=o.transform.projectionOptions,ot=o.style.getBrightness(),at=this.brightness!==ot;if(!this.uploaded||this.dirty||rt.name!==this.projection.name||U1(_e.paint.get("model-color").value,at)||U1(_e.paint.get("model-color-mix-intensity").value,at)||U1(_e.paint.get("model-roughness").value,at)||U1(_e.paint.get("model-emissive-strength").value,at)||U1(_e.paint.get("model-height-based-emissive-strength-multiplier").value,at)){this.projection=rt,this.brightness=ot;const ut=this.getNodesInfo();for(const ft of ut)ft.state=null;return!0}return!1}evaluateTransform(o,g){if(o.transform.zoom===this.zoom)return;this.zoom=o.transform.zoom;const _e=this.getNodesInfo(),rt=this.id.canonical;for(const ot of _e){const at=ot.feature;ot.evaluatedTranslation=g.paint.get("model-translation").evaluate(at,{},rt),ot.evaluatedScale=g.paint.get("model-scale").evaluate(at,{},rt)}}evaluate(o,g){const _e=this.getNodesInfo();for(const rt of _e){if(!rt.node.meshes)continue;const ot=rt.feature,at=g&&g[ot.id];if(Su(at,rt.state))continue;rt.state=structuredClone(at);const ut=rt.node.meshes&&rt.node.meshes[0].featureData,ft=rt.evaluatedColor[2],xt=rt.evaluatedRMEA[2],Ct=this.id.canonical;if(rt.hasTranslucentParts=!1,ut){for(let Rt=0;Rt<YA.length;Rt++){const kt=YA[Rt];kt.length&&(ot.properties.part=kt);const zt=o.paint.get("model-color").evaluate(ot,at,Ct).toPremultipliedRenderColor(null),Ut=o.paint.get("model-color-mix-intensity").evaluate(ot,at,Ct);rt.evaluatedColor[Rt]=[zt.r,zt.g,zt.b,Ut],rt.evaluatedRMEA[Rt][0]=o.paint.get("model-roughness").evaluate(ot,at,Ct),rt.evaluatedRMEA[Rt][2]=o.paint.get("model-emissive-strength").evaluate(ot,at,Ct),rt.evaluatedRMEA[Rt][3]=zt.a,rt.emissionHeightBasedParams[Rt]=o.paint.get("model-height-based-emissive-strength-multiplier").evaluate(ot,at,Ct),!rt.hasTranslucentParts&&zt.a<1&&(rt.hasTranslucentParts=!0)}delete ot.properties.part,jM(rt,ft!==rt.evaluatedColor[2]||xt!==rt.evaluatedRMEA[2],this.modelTraits)}else rt.evaluatedRMEA[0][2]=o.paint.get("model-emissive-strength").evaluate(ot,at,Ct);rt.evaluatedTranslation=o.paint.get("model-translation").evaluate(ot,at,Ct),rt.evaluatedScale=o.paint.get("model-scale").evaluate(ot,at,Ct),this.updatePbrBuffer(rt.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(o,g,_e,rt){const ot=o.findDEMTileFor(_e);if(ot&&(ot.tileID.canonical!==this.terrainTile||g!==this.terrainExaggeration)){if(ot.dem&&ot.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=ot.tileID.overscaledZ;const at=U_.create(o,_e,ot);if(!at)return;this.modelTraits&D_.HasMapboxMeshFeatures&&this.updateDEM(o,at,_e,rt);for(const ut of this.getNodesInfo()){const ft=ut.node;if(!ft.footprint||!ft.footprint.vertices||!ft.footprint.vertices.length)continue;const xt=ft.footprint.vertices;let Ct=at.getElevationAt(xt[0].x,xt[0].y,!0,!0);for(let Rt=1;Rt<xt.length;Rt++)Ct=Math.min(Ct,at.getElevationAt(xt[Rt].x,xt[Rt].y,!0,!0));ft.elevation=Ct}}this.terrainTile=ot.tileID.canonical,this.terrainExaggeration=g}}updateDEM(o,g,_e,rt){let ot=g._dem._modifiedForSources[rt];if(ot===void 0&&(g._dem._modifiedForSources[rt]=[],ot=g._dem._modifiedForSources[rt]),ot.includes(_e.canonical))return;const at=g._dem.dim;ot.push(_e.canonical);let ut=!1;for(const ft of this.getNodesInfo()){const xt=ft.node;if(!xt.footprint||!xt.footprint.grid)continue;const Ct=xt.footprint.grid,Rt=g.tileCoordToPixel(Ct.min.x,Ct.min.y),kt=g.tileCoordToPixel(Ct.max.x,Ct.max.y),zt=Math.min(Math.min(at-kt.y,Rt.x),Math.min(Rt.y,at-kt.x));if(zt<0)continue;const Ut=tr(zt,2,5);let Kt=Math.max(0,Rt.x-Ut),er=Math.max(0,Rt.y-Ut),Jt=Math.min(kt.x+Ut,at-1),or=Math.min(kt.y+Ut,at-1);for(let br=er;br<=or;++br)for(let Pr=Kt;Pr<=Jt;++Pr)Qy[br*at+Pr]=255;let cr=0,pr=0;for(let br=0;br<Ct.cellsY;++br)for(let Pr=0;Pr<Ct.cellsX;++Pr){if(!Ct.cells[br*Ct.cellsX+Pr])continue;const Dr=g.tileCoordToPixel(Ct.min.x+Pr/Ct.xScale,Ct.min.y+br/Ct.yScale),Or=g.tileCoordToPixel(Ct.min.x+(Pr+1)/Ct.xScale,Ct.min.y+(br+1)/Ct.yScale);for(let nn=Dr.y;nn<=Math.min(Or.y+1,at-1);++nn)for(let $r=Dr.x;$r<=Math.min(Or.x+1,at-1);++$r)Qy[nn*at+$r]===255&&(Qy[nn*at+$r]=0,cr+=g.getElevationAtPixel($r,nn),pr++)}const Sr=cr/pr;Kt=Math.max(1,Rt.x-Ut),er=Math.max(1,Rt.y-Ut),Jt=Math.min(kt.x+Ut,at-2),or=Math.min(kt.y+Ut,at-2),ut=!0;for(let br=er;br<=or;++br)for(let Pr=Kt;Pr<=Jt;++Pr)Qy[br*at+Pr]===0&&(jS[br*at+Pr]=g._dem.set(Pr,br,Sr));for(let br=1;br<Ut;++br){Kt=Math.max(1,Rt.x-br),er=Math.max(1,Rt.y-br),Jt=Math.min(kt.x+br,at-2),or=Math.min(kt.y+br,at-2);for(let Pr=er;Pr<=or;++Pr)for(let Dr=Kt;Dr<=Jt;++Dr){const Or=Pr*at+Dr;if(Qy[Or]===255){let nn=0,$r=0,un=-1,gn=-1;for(let yn=-1;yn<=1;++yn)for(let Sn=-1;Sn<=1;++Sn){const An=(Pr+yn)*at+Dr+Sn;if(Qy[An]>=br)continue;const wn=jS[An],En=Math.abs(wn);En>$r&&(nn=wn,$r=En,un=Sn,gn=yn)}if($r>.1){const yn=1-(br+.5*Math.abs(un*gn))/Ut;let Sn=g._dem.get(Dr,Pr)+nn*yn;const An=g._dem.get(Dr+un,Pr+gn),wn=g._dem.get(Dr-un,Pr-gn,!0);(Sn-An)*(Sn-wn)>0&&(Sn=(An+wn)/2),jS[Or]=g._dem.set(Dr,Pr,Sn),Qy[Or]=br}}}}}ut&&(g._demTile.needsDEMTextureUpload=!0,g._dem._timestamp=hu.now())}setFilter(o){this.filter=o?n_(o):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(o=>this.filter.filter(new Xo(this.id.overscaledZ,{worldview:this.worldview}),o.feature,this.id.canonical)):this.nodesInfo}destroy(){const o=this.getNodesInfo();for(const g of o)EE(g.node),aS(g.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(o,g){if(g.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=g.updateTime;const _e=g.getReplacementRegionsForTile(o.toUnwrapped());for(const rt of this.getNodesInfo()){const ot=rt.node.footprint;rt.hiddenByReplacement=!!ot&&!_e.find(at=>at.footprint===ot)}}getHeightAtTileCoord(o,g){const _e=[],rt=[0,0,0],ot=$t([]);for(const at of this.getNodesInfo()){const ut=at.node.meshes[0],ft=ut.transformedAabb;if(o<ft.min[0]||g<ft.min[1]||o>ft.max[0]||g>ft.max[1])continue;if(at.node.hidden===!0)return{height:1/0,maxHeight:at.feature.properties.height,hidden:!1,verticalScale:at.evaluatedScale[2]};Lt(ot,at.node.globalMatrix),rt[0]=o,rt[1]=g,_s(rt,rt,ot);const xt=(rt[0]-ut.aabb.min[0])/(ut.aabb.max[0]-ut.aabb.min[0])*Xy|0,Ct=Math.min(63,(rt[1]-ut.aabb.min[1])/(ut.aabb.max[1]-ut.aabb.min[1])*Xy|0)*Xy+Math.min(63,xt),Rt=ut.heightmap[Ct];if(!(Rt<0&&at.node.footprint))return at.hiddenByReplacement?void 0:{height:Rt,maxHeight:at.feature.properties.height,hidden:!1,verticalScale:at.evaluatedScale[2]};if(at.node.footprint.grid.query(new _n(o,g),new _n(o,g),_e),_e.length>0)return{height:void 0,maxHeight:at.feature.properties.height,hidden:at.hiddenByReplacement,verticalScale:at.evaluatedScale[2]}}}}function U1(b,o){return b instanceof L0&&!b.isLightConstant&&o}function LM(b,o,g,_e,rt,ot,at,ut){let ft=(61440&o|(61440&o)>>4)>>8,xt=(3840&o|(3840&o)>>4)>>4,Ct=240&o|(240&o)>>4;g[3]>0&&(ft=Cs(ft,255*g[0],g[3]),xt=Cs(xt,255*g[1],g[3]),Ct=Cs(Ct,255*g[2],g[3]));const Rt=ft<<8|xt,kt=Ct<<8|Math.floor(255*_e[3]),zt=function(br){const Pr=tr(br,0,2);return Math.min(Math.round(.5*Pr*255),255)}(_e[2])<<8|15*_e[0]<<4|15*_e[1],Ut=tr(rt[0],0,1),Kt=tr(rt[1],0,1),er=tr(rt[2],0,1),Jt=tr(rt[3],0,1);let or,cr,pr,Sr;if(Ut!==Kt&&at!==ot&&Kt!==Ut){const br=at-ot;cr=1/(br*(Kt-Ut)),pr=-(ot+br*Ut)/(br*(Kt-Ut));const Pr=tr(rt[4],-1,1);Sr=Math.pow(10,Pr),or=255*er<<8|255*Jt}else or=65535,cr=0,pr=1,Sr=1;if(b.emplaceBack(Rt,kt,zt,or,cr,pr,Sr),ut){const br=ut.length;ut.clear();for(let Pr=0;Pr<br;Pr++)ut.emplaceBack(Rt,kt,zt,or,cr,pr,Sr)}}function jM(b,o,g){const _e=b.node;let rt=0;const ot=g&D_.HasMeshoptCompression;for(const at of _e.meshes){if(_e.lights&&_e.lightMeshIndex===rt||!at.featureData)continue;at.featureArray=new f_,at.featureArray.reserve(at.featureData.length);let ut=o;for(const ft of at.featureData){const xt=ot?65535&ft:ft>>16&65535,Ct=ot?ft>>16&65535:65535&ft,Rt=(15&Ct)<8?15&Ct:0,kt=b.evaluatedRMEA[Rt],zt=b.evaluatedColor[Rt],Ut=b.emissionHeightBasedParams[Rt];let Kt;if(ut&&Rt===2&&_e.lights&&(Kt=new f_,Kt.resize(10*_e.lights.length)),LM(at.featureArray,xt,zt,kt,Ut,at.aabb.min[2],at.aabb.max[2],Kt),Kt&&ut){ut=!1;const er=_e.meshes[_e.lightMeshIndex];er.featureArray=Kt,er.featureArray._trim()}}at.featureArray._trim(),rt++}}Jn(UE,"Tiled3dModelBucket",{omit:["layers"]}),Jn(QA,"Tiled3dModelFeature");const OM=["id","tile","layer","source","sourceLayer","state"];class Jy{constructor(o,g,_e,rt,ot){this.type="Feature",this._vectorTileFeature=o,this._z=g,this._x=_e,this._y=rt,this.properties=o?o.properties:{},this.id=ot}clone(){const o=new Jy(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(o.state=Object.assign({},this.state)),this.layer&&(o.layer=Object.assign({},this.layer)),this.source&&(o.source=this.source),this.sourceLayer&&(o.sourceLayer=this.sourceLayer),o}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const g of OM)this[g]!==void 0&&(o[g]=this[g]);return o}}class ex extends Jm{constructor(o,g,_e,rt){super(),this.id=o,this.type="model",this.models=[],this._loaded=!1,this._options=g,this._modelsInfo=new Map}load(){const o=[];for(const g in this._options.models){const _e=this._options.models[g],rt=this._modelsInfo.get(g);if(rt){const ot=rt.model;ot.position=_e.position!=null?new $(_e.position[0],_e.position[1]):new $(0,0),ot.orientation=_e.orientation!=null?_e.orientation:[0,0,0],rt.modelSpec=_e,ex.applyModelSpecification(ot,_e),ot.computeBoundsAndApplyParent(),this.models.push(ot)}else{const ot=_2(this.map._requestManager.transformRequest(_e.uri,ly.Model).url).then(at=>{if(!at)return;const ut=cS(at),ft=new T2(g,_e.uri,_e.position,_e.orientation,ut);ex.applyModelSpecification(ft,_e),ft.computeBoundsAndApplyParent(),this.models.push(ft),this._modelsInfo.set(g,{modelSpec:_e,model:ft})}).catch(at=>{this.fire(new dy(new Error(`Could not load model ${g} from ${_e.uri}: ${at.message}`)))});o.push(ot)}}Promise.allSettled(o).then(()=>{this._loaded=!0,this.fire(new jp("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(g=>{this._loaded=!0,this.fire(new dy(new Error(`Could not load models: ${g.message}`)))})}static applyModelSpecification(o,g){g.nodeOverrides&&ex.convertNodeOverrides(o,g.nodeOverrides),g.materialOverrides&&ex.convertMaterialOverrides(o,g.materialOverrides),g.nodeOverrideNames&&(o.nodeOverrideNames=[...g.nodeOverrideNames]),g.materialOverrideNames&&(o.materialOverrideNames=[...g.materialOverrideNames]),g.featureProperties&&(o.featureProperties=g.featureProperties)}static convertNodeOverrides(o,g){if(Array.isArray(g)&&g.every(_e=>typeof _e=="string")){o.nodeOverrideNames=[];for(const _e of g)o.nodeOverrideNames.push(_e)}else Object.entries(g).forEach(([_e,rt])=>{const ot={orientation:[0,0,0]};if(rt.hasOwnProperty("orientation")){const at=rt.orientation;at&&(ot.orientation=at)}o.nodeOverrides.set(_e,ot)})}static convertMaterialOverrides(o,g){if(Array.isArray(g)&&g.every(_e=>typeof _e=="string")){o.materialOverrideNames=[];for(const _e of g)o.materialOverrideNames.push(_e)}else Object.entries(g).forEach(([_e,rt])=>{const ot={color:new Ro(1,1,1),colorMix:0,emissionStrength:0,opacity:1},at=rt["model-color"];at!==void 0&&(ot.color.r=at[0],ot.color.g=at[1],ot.color.b=at[2]);const ut=rt["model-color-mix-intensity"];ut!==void 0&&(ot.colorMix=ut);const ft=rt["model-emissive-strength"];ft!==void 0&&(ot.emissionStrength=ft);const xt=rt["model-opacity"];xt!==void 0&&(ot.opacity=xt),o.materialOverrides.set(_e,ot)})}onAdd(o){this.map=o,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(o,g){}serialize(){return this._options}setProperty(o,g){return!1}reload(){const o=Rp(this.id,this.scope);this.map.style.clearSource(o),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(o){this.models=[];const g=new Map;for(const _e in o){const rt=o[_e];if(this._modelsInfo.has(_e)){const ot=this._modelsInfo.get(_e);ot&&ot.modelSpec.uri===rt.uri&&g.set(_e,ot)}}this._modelsInfo=g,this._options.models=o,this._loaded=!1,this.load()}}function OS(b,o,g,_e){const rt=1<<b.z;o.lat=Ht((_e/jn+b.y)/rt),o.lng=Dt((g/jn+b.x)/rt)}function FM(b,o,g,_e){const rt=b.getNodesInfo()[o];if(!rt||rt.hiddenByReplacement||!rt.node.meshes)return;let ot=Number.MAX_VALUE;const at=rt.node,ut=g.tile,ft=_e.calculatePosMatrix(ut.tileID.toUnwrapped(),_e.worldSize),xt=rt.evaluatedScale;let Ct=0;_e.elevation&&at.elevation&&(Ct=at.elevation*_e.elevation.exaggeration()),Nt(ft,ft,[(at.anchor?at.anchor[0]:0)*(xt[0]-1),(at.anchor?at.anchor[1]:0)*(xt[1]-1),Ct]),Vt(ft,ft,xt);const Rt=g.queryGeometry,kt=Rt.isPointQuery()?Rt.screenBounds:Rt.screenGeometry,zt=function(Kt){const er=Bt([],ft,Kt.globalMatrix);Bt(er,_e.expandedFarZProjMatrix,er);for(let Jt=0;Jt<Kt.meshes.length;++Jt){const or=Kt.meshes[Jt];if(Jt===Kt.lightMeshIndex)continue;const cr=sS(kt,_e,er,or.aabb);cr!=null&&(ot=Math.min(cr,ot))}if(Kt.children)for(const Jt of Kt.children)zt(Jt)};if(zt(at),ot===Number.MAX_VALUE)return;const Ut=new $(0,0);return OS(ut.tileID.canonical,Ut,rt.node.anchor[0],rt.node.anchor[1]),{intersectionZ:ot,position:Ut,feature:rt.feature}}const BM={circle:class extends Bu{constructor(b,o,g,_e){super(b,{layout:qu||(qu=new Dl({"circle-sort-key":new Bn(Hr.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Nn(Hr.layout_circle["circle-elevation-reference"]),visibility:new Nn(Hr.layout_circle.visibility)})),paint:Nl||(Nl=new Dl({"circle-radius":new Bn(Hr.paint_circle["circle-radius"]),"circle-color":new Bn(Hr.paint_circle["circle-color"]),"circle-blur":new Bn(Hr.paint_circle["circle-blur"]),"circle-opacity":new Bn(Hr.paint_circle["circle-opacity"]),"circle-translate":new Nn(Hr.paint_circle["circle-translate"]),"circle-translate-anchor":new Nn(Hr.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Nn(Hr.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Nn(Hr.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Bn(Hr.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Bn(Hr.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Bn(Hr.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Nn(Hr.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"})}))},o,g,_e)}createBucket(b){return new Po(b)}queryRadius(b){const o=b;return Iu("circle-radius",this,o)+Iu("circle-stroke-width",this,o)+xu(this.paint.get("circle-translate"))}queryIntersectsFeature(b,o,g,_e,rt,ot,at,ut){const ft=_p(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),ot.angle,b.pixelToTileUnitsFactor),xt=this.paint.get("circle-radius").evaluate(o,g)+this.paint.get("circle-stroke-width").evaluate(o,g);return sC(b,_e,ot,at,ut,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",ft,xt)}getProgramIds(){return["circle"]}getDefaultProgramParams(b,o,g){const _e=iC(this);return{config:new Bm(this,{zoom:o,lut:g}),defines:_e,overrideFog:!1}}is3D(b){return!b&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Bu{createBucket(b){return new aC(b)}constructor(b,o,g,_e){super(b,{layout:lC||(lC=new Dl({visibility:new Nn(Hr.layout_heatmap.visibility)})),paint:cC||(cC=new Dl({"heatmap-radius":new Bn(Hr.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Bn(Hr.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Nn(Hr.paint_heatmap["heatmap-intensity"]),"heatmap-color":new l0(Hr.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Nn(Hr.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"})}))},o,g,_e),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(b){b==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=u1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(b){return Iu("heatmap-radius",this,b)}queryIntersectsFeature(b,o,g,_e,rt,ot,at,ut){const ft=this.paint.get("heatmap-radius").evaluate(o,g);return sC(b,_e,ot,at,ut,!0,!0,new _n(0,0),ft)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(b,o,g){return b==="heatmap"?{config:new Bm(this,{zoom:o,lut:g}),overrideFog:!1}:{}}},hillshade:class extends Bu{constructor(b,o,g,_e){super(b,{layout:uC||(uC=new Dl({visibility:new Nn(Hr.layout_hillshade.visibility)})),paint:hC||(hC=new Dl({"hillshade-illumination-direction":new Nn(Hr.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Nn(Hr.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Nn(Hr.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Nn(Hr.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Nn(Hr.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Nn(Hr.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Nn(Hr.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"})}))},o,g,_e)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(b,o,g){return{overrideFog:!1}}},fill:class extends Bu{constructor(b,o,g,_e){super(b,{layout:CC||(CC=new Dl({"fill-sort-key":new Bn(Hr.layout_fill["fill-sort-key"]),visibility:new Nn(Hr.layout_fill.visibility),"fill-elevation-reference":new Nn(Hr.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Bn(Hr.layout_fill["fill-construct-bridge-guard-rail"])})),paint:AC||(AC=new Dl({"fill-antialias":new Nn(Hr.paint_fill["fill-antialias"]),"fill-opacity":new Bn(Hr.paint_fill["fill-opacity"]),"fill-color":new Bn(Hr.paint_fill["fill-color"]),"fill-outline-color":new Bn(Hr.paint_fill["fill-outline-color"]),"fill-translate":new Nn(Hr.paint_fill["fill-translate"]),"fill-translate-anchor":new Nn(Hr.paint_fill["fill-translate-anchor"]),"fill-pattern":new Bn(Hr.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Nn(Hr.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Nn(Hr.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Bn(Hr.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Bn(Hr.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Bn(Hr.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"})}))},o,g,_e)}getProgramIds(){const b=this.paint.get("fill-pattern"),o=b&&b.constantOr(1),g=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&g.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),g}getDefaultProgramParams(b,o,g){return{config:new Bm(this,{zoom:o,lut:g}),overrideFog:!1}}recalculate(b,o){super.recalculate(b,o);const g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(b){return new UT(b)}queryRadius(){return xu(this.paint.get("fill-translate"))}queryIntersectsFeature(b,o,g,_e,rt,ot){return!b.queryGeometry.isAboveHorizon&&bo(np(b.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),ot.angle,b.pixelToTileUnitsFactor),_e)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(b){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const o=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return b!=null?o&&!b:o}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Bu{constructor(b,o,g,_e){super(b,{layout:JC||(JC=new Dl({visibility:new Nn(Hr["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Nn(Hr["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:e2||(e2=new Dl({"fill-extrusion-opacity":new Nn(Hr["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Bn(Hr["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Nn(Hr["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Nn(Hr["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Bn(Hr["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Nn(Hr["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Bn(Hr["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Bn(Hr["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Nn(Hr["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Nn(Hr["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Nn(Hr["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Nn(Hr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Nn(Hr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Nn(Hr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Nn(Hr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Nn(Hr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Nn(Hr["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Nn(Hr["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Bn(Hr["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Bn(Hr["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Nn(Hr["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Nn(Hr["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Nn(Hr["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Nn(Hr["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Bn(Hr["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Bn(Hr["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Nn(Hr["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"})}))},o,g,_e),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(b){return new pE(b)}queryRadius(){return xu(this.paint.get("fill-extrusion-translate"))}is3D(b){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(b,o,g,_e,rt,ot,at,ut,ft){const xt=_p(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),ot.angle,b.pixelToTileUnitsFactor),Ct=this.paint.get("fill-extrusion-height").evaluate(o,g),Rt=this.paint.get("fill-extrusion-base").evaluate(o,g),kt=[0,0],zt=ut&&ot.elevation,Ut=ot.elevation?ot.elevation.exaggeration():1,Kt=b.tile.getBucket(this);if(zt&&Kt instanceof pE){const pr=Kt.centroidVertexArray,Sr=ft+1;Sr<pr.length&&(kt[0]=pr.geta_centroid_pos0(Sr),kt[1]=pr.geta_centroid_pos1(Sr))}if(kt[0]===0&&kt[1]===1)return!1;ot.projection.name==="globe"&&(_e=QC([_e],[new _n(0,0),new _n(jn,jn)],b.tileID.canonical).map(pr=>pr.polygon).flat());const er=zt?ut:null,[Jt,or]=a2(ot,_e,Rt,Ct,xt,at,er,kt,Ut,ot.center.lat,b.tileID.canonical),cr=b.queryGeometry;return o2(Jt,or,cr.isPointQuery()?cr.screenBounds:cr.screenGeometry)}},building:class extends Bu{constructor(b,o,g,_e){super(b,{layout:k2||(k2=new Dl({visibility:new Nn(Hr.layout_building.visibility),"building-facade":new Bn(Hr.layout_building["building-facade"]),"building-facade-floors":new Bn(Hr.layout_building["building-facade-floors"]),"building-facade-unit-width":new Bn(Hr.layout_building["building-facade-unit-width"]),"building-facade-window":new Bn(Hr.layout_building["building-facade-window"]),"building-roof-shape":new Bn(Hr.layout_building["building-roof-shape"]),"building-height":new Bn(Hr.layout_building["building-height"]),"building-base":new Bn(Hr.layout_building["building-base"]),"building-flood-light-wall-radius":new Bn(Hr.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Bn(Hr.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Bn(Hr.layout_building["building-flip-roof-orientation"])})),paint:M2||(M2=new Dl({"building-opacity":new Nn(Hr.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Nn(Hr.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Nn(Hr.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Nn(Hr.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Nn(Hr.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Nn(Hr.paint_building["building-vertical-scale"]),"building-cast-shadows":new Nn(Hr.paint_building["building-cast-shadows"]),"building-color":new Bn(Hr.paint_building["building-color"]),"building-emissive-strength":new Bn(Hr.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Nn(Hr.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Nn(Hr.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Nn(Hr.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Nn(Hr.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Nn(Hr.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"})}))},o,g,_e),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(b){return new I2(b)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(b){return!0}queryRadius(b){return 0}queryIntersectsFeature(b,o,g,_e,rt,ot,at,ut,ft){let xt=this.layout.get("building-height").evaluate(o,g);const Ct=this.layout.get("building-base").evaluate(o,g),Rt=b.tile.getBucket(this).getFootprint(o);if(Rt){if(Rt.hiddenFlags!==0)return!1;xt=Rt.height}const[kt,zt]=a2(ot,_e,Ct,xt,new _n(0,0),at,null,[0,0],1,ot.center.lat,b.tileID.canonical),Ut=b.queryGeometry;return o2(kt,zt,Ut.isPointQuery()?Ut.screenBounds:Ut.screenGeometry)}},line:class extends Bu{constructor(b,o,g,_e){const rt=U2();super(b,rt,o,g,_e),rt.layout&&(this.layout=new a0(rt.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(b){if(b==="line-gradient"){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof Ty,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(b,o){super.recalculate(b,o),this.paint._values["line-floorwidth"]=(()=>{if(A1)return A1;const g=U2();return A1=new NI(g.paint.properties["line-width"].specification),A1.useIntegerZoom=!0,A1})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,b)}createBucket(b){return new dS(b)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(b,o,g){const _e=z2(this);return{config:new Bm(this,{zoom:o,lut:g}),defines:_e,overrideFog:!1}}queryRadius(b){const o=b,g=$2(Iu("line-width",this,o),Iu("line-gap-width",this,o)),_e=Iu("line-offset",this,o);return g/2+Math.abs(_e)+xu(this.paint.get("line-translate"))}queryIntersectsFeature(b,o,g,_e,rt,ot){if(b.queryGeometry.isAboveHorizon)return!1;const at=np(b.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),ot.angle,b.pixelToTileUnitsFactor),ut=b.pixelToTileUnitsFactor/2*$2(this.paint.get("line-width").evaluate(o,g),this.paint.get("line-gap-width").evaluate(o,g)),ft=this.paint.get("line-offset").evaluate(o,g);return ft&&(_e=function(xt,Ct){const Rt=[],kt=new _n(0,0);for(let zt=0;zt<xt.length;zt++){const Ut=xt[zt],Kt=[];for(let er=0;er<Ut.length;er++){const Jt=Ut[er],or=Ut[er+1],cr=er===0?kt:Jt.sub(Ut[er-1])._unit()._perp(),pr=er===Ut.length-1?kt:or.sub(Jt)._unit()._perp(),Sr=cr._add(pr)._unit();Sr._mult(1/(Sr.x*pr.x+Sr.y*pr.y)),Kt.push(Sr._mult(Ct)._add(Jt))}Rt.push(Kt)}return Rt}(_e,ft*b.pixelToTileUnitsFactor)),function(xt,Ct,Rt){for(let kt=0;kt<Ct.length;kt++){const zt=Ct[kt];if(xt.length>=3){for(let Ut=0;Ut<zt.length;Ut++)if(Oo(xt,zt[Ut]))return!0}if(Al(xt,zt,Rt))return!0}return!1}(at,_e,ut)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(b){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:FE,background:class extends Bu{constructor(b,o,g,_e){super(b,{layout:kA||(kA=new Dl({visibility:new Nn(Hr.layout_background.visibility)})),paint:MA||(MA=new Dl({"background-pitch-alignment":new Nn(Hr.paint_background["background-pitch-alignment"]),"background-color":new Nn(Hr.paint_background["background-color"]),"background-pattern":new Nn(Hr.paint_background["background-pattern"]),"background-opacity":new Nn(Hr.paint_background["background-opacity"]),"background-emissive-strength":new Nn(Hr.paint_background["background-emissive-strength"]),"background-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"})}))},o,g,_e)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(b,o,g){return{overrideFog:!1}}is3D(b){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:OA,"raster-particle":$A,sky:class extends Bu{constructor(b,o,g,_e){super(b,{layout:zA||(zA=new Dl({visibility:new Nn(Hr.layout_sky.visibility)})),paint:VA||(VA=new Dl({"sky-type":new Nn(Hr.paint_sky["sky-type"]),"sky-atmosphere-sun":new Nn(Hr.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Nn(Hr.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Nn(Hr.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Nn(Hr.paint_sky["sky-gradient-radius"]),"sky-gradient":new l0(Hr.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Nn(Hr.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Nn(Hr.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Nn(Hr.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"})}))},o,g,_e),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(b){b==="sky-gradient"?this._updateColorRamp():b!=="sky-atmosphere-sun"&&b!=="sky-atmosphere-halo-color"&&b!=="sky-atmosphere-color"&&b!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=u1({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(b){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=b.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(b,o){if(this.paint.get("sky-type")==="atmosphere"){const _e=this.paint.get("sky-atmosphere-sun"),rt=!_e,ot=b.style.light,at=ot.properties.get("position");return rt&&ot.properties.get("anchor")==="viewport"&&Wn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),rt?DS(at.azimuthal,90-at.polar,o):DS(_e[0],90-_e[1],o)}const g=this.paint.get("sky-gradient-center");return DS(g[0],90-g[1],o)}isSky(){return!0}markSkyboxValid(b){this._skyboxInvalidated=!1,this._lightPosition=b.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const b=this.paint.get("sky-type");return b==="atmosphere"?["skyboxCapture","skybox"]:b==="gradient"?["skyboxGradient"]:null}},slot:class extends Bu{constructor(b,o,g,_e){super(b,{paint:UA||(UA=new Dl({}))},o,null)}},model:class extends Bu{constructor(b,o,g,_e){super(b,{layout:qA||(qA=new Dl({visibility:new Nn(Hr.layout_model.visibility),"model-id":new Bn(Hr.layout_model["model-id"])})),paint:KA||(KA=new Dl({"model-opacity":new Bn(Hr.paint_model["model-opacity"]),"model-rotation":new Bn(Hr.paint_model["model-rotation"]),"model-scale":new Bn(Hr.paint_model["model-scale"]),"model-translation":new Bn(Hr.paint_model["model-translation"]),"model-color":new Bn(Hr.paint_model["model-color"]),"model-color-mix-intensity":new Bn(Hr.paint_model["model-color-mix-intensity"]),"model-type":new Nn(Hr.paint_model["model-type"]),"model-cast-shadows":new Nn(Hr.paint_model["model-cast-shadows"]),"model-receive-shadows":new Nn(Hr.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Nn(Hr.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Bn(Hr.paint_model["model-emissive-strength"]),"model-roughness":new Bn(Hr.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Bn(Hr.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Nn(Hr.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Nn(Hr.paint_model["model-front-cutoff"]),"model-elevation-reference":new Nn(Hr.paint_model["model-elevation-reference"]),"model-color-use-theme":new Bn({type:"string",default:"default","property-type":"data-driven"})}))},o,g,_e),this.layer=b,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(b){return new LS(b)}getProgramIds(){return["model"]}is3D(b){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(b){return b instanceof UE?jn-1:0}queryRenderedFeatures(b,o,g){const _e=o.getSource();if(!(_e&&_e instanceof ex))return{};const rt=_e,ot={};ot[this.id]=[];const at=ot[this.id];let ut=0;for(const ft of rt.models){const xt=o.getFeatureState(this.sourceLayer,ft.id),Ct={type:"Unknown",id:ft.id,properties:ft.featureProperties},Rt=this.paint.get("model-rotation").evaluate(Ct,xt),kt=this.paint.get("model-scale").evaluate(Ct,xt),zt=this.paint.get("model-translation").evaluate(Ct,xt),Ut=this.paint.get("model-elevation-reference");let Kt=[];wE(Kt,ft,g,ft.position,Rt,kt,zt,Ut==="ground",Ut==="ground",!1),g.projection.name==="globe"&&(Kt=bE(Kt,g));const er=Bt([],g.projMatrix,Kt),Jt=sS(b.isPointQuery()?b.screenBounds:b.screenGeometry,g,er,ft.aabb);if(Jt!=null){const or=new Jy(void 0,0,0,0,ft.id);or.layer=this.layer,or.properties=structuredClone(ft.featureProperties),or.properties.layer=this.id,or.properties.uri=ft.uri,or.properties.orientation=ft.orientation,or.sourceLayer=this.sourceLayer,or.geometry={type:"Point",coordinates:[ft.position.lng,ft.position.lat]},or.state=xt,or.source=this.source,at.push({featureIndex:ut,feature:or,intersectionZ:Jt})}++ut}return ot}queryIntersectsFeature(b,o,g,_e,rt,ot){if(!this.modelManager)return!1;const at=this.modelManager,ut=b.tile.getBucket(this);if(!(ut&&ut instanceof LS))return!1;for(const ft in ut.instancesPerModel){const xt=ut.instancesPerModel[ft],Ct=o.id!==void 0?o.id:o.properties&&o.properties.hasOwnProperty("id")?o.properties.id:void 0;if(xt.idToFeaturesIndex.hasOwnProperty(Ct)){const Rt=xt.features[xt.idToFeaturesIndex[Ct]],kt=at.getModel(ft,this.scope);if(!kt)return!1;let zt=[];const Ut=new $(0,0),Kt=ut.canonical;let er=Number.MAX_VALUE;for(let Jt=0;Jt<Rt.instancedDataCount;++Jt){const or=16*(Rt.instancedDataOffset+Jt),cr=xt.instancedDataArray.float32,pr=[cr[or+4],cr[or+5],cr[or+6]];OS(Kt,Ut,Math.floor(cr[or]),Math.floor(cr[or+1])),wE(zt,kt,ot,Ut,Rt.rotation,Rt.scale,pr,!1,!1,!1),ot.projection.name==="globe"&&(zt=bE(zt,ot));const Sr=Bt([],ot.projMatrix,zt),br=b.queryGeometry,Pr=sS(br.isPointQuery()?br.screenBounds:br.screenGeometry,ot,Sr,kt.aabb);Pr!=null&&(er=Math.min(Pr,er))}return er!==Number.MAX_VALUE&&er}}return!1}_handleOverridablePaintPropertyUpdate(b,o,g){return!(!this.layout||o.isDataDriven()||g.isDataDriven()||b!=="model-color"&&b!=="model-color-mix-intensity"&&b!=="model-rotation"&&b!=="model-scale"&&b!=="model-translation"&&b!=="model-emissive-strength")}_isPropertyZoomDependent(b){const o=this._transitionablePaint._values[b];return o!=null&&o.value!=null&&o.value.expression!=null&&o.value.expression instanceof i0}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Bu{constructor(b,o,g,_e){super(b,{layout:RC||(RC=new Dl({"clip-layer-types":new Nn(Hr.layout_clip["clip-layer-types"]),"clip-layer-scope":new Nn(Hr.layout_clip["clip-layer-scope"])})),paint:PC||(PC=new Dl({}))},o,g,_e)}recalculate(b,o){super.recalculate(b,o)}createBucket(b){return new IC(b)}is3D(b){return!0}}},FS=new Ro(0,0,0),BS={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},zS={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},$E={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},zM={PAINT_ORDER_FILL_AND_STROKE:1},$1={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},JA={MASK_TYPE_LUMINANCE:1};function VM(b,o,g){b===1&&o.icons.push(function(_e,rt){return function(ot){if(ot.usvg_tree.height||(ot.usvg_tree.height=ot.usvg_tree.width),!ot.metadata)return ot;const{metadata:at}=ot;if(at.content_area){const{content_area:ut}=at;ut.left==null&&(ut.left=0),ut.top==null&&(ut.top=ut.left),ut.width==null&&(ut.width=ot.usvg_tree.width),ut.height==null&&(ut.height=ut.width)}if(at.text_placeholder){const{text_placeholder:ut}=at;ut.top==null&&(ut.top=ut.left),ut.height==null&&(ut.height=ut.width)}return at.stretch_x&&at.stretch_x.length&&eR(at,"x"),at.stretch_y&&at.stretch_y.length&&eR(at,"y"),ot}(_e.readFields(UM,{name:void 0},rt))}(g,g.readVarint()+g.pos))}function eR(b,o){const g=[],_e=b[`stretch_${o}`];let rt=null;for(let ot=0;ot<_e.length;ot++)rt===null?rt=g.length===0?_e[0]:g[g.length-1][1]+_e[ot]:(g.push([rt,rt+_e[ot]]),rt=null);b[`stretch_${o}_areas`]=g}function UM(b,o,g){b===1?o.name=g.readString():b===2?o.metadata=function(_e,rt){return _e.readFields($M,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},rt)}(g,g.readVarint()+g.pos):b===3&&(o.usvg_tree=function(_e,rt){return _e.readFields(WM,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},rt)}(g,g.readVarint()+g.pos),o.data="usvg_tree")}function $M(b,o,g){b===1?o.stretch_x=g.readPackedVarint():b===2?o.stretch_y=g.readPackedVarint():b===3?o.content_area=tR(g,g.readVarint()+g.pos):b===4?o.variables.push(function(_e,rt){return _e.readFields(HM,{name:void 0},rt)}(g,g.readVarint()+g.pos)):b===5&&(o.text_placeholder=tR(g,g.readVarint()+g.pos))}function tR(b,o){return b.readFields(GM,{},o)}function GM(b,o,g){b===1?o.left=g.readVarint():b===2?o.width=g.readVarint():b===3?o.top=g.readVarint():b===4&&(o.height=g.readVarint())}function HM(b,o,g){b===1?o.name=g.readString():b===2&&(o.rgb_color=WE(g.readVarint()),o.value="rgb_color")}function WM(b,o,g){b===1?o.width=o.height=g.readVarint():b===2?o.height=g.readVarint():b===3?o.children.push(GE(g,g.readVarint()+g.pos)):b===4?o.linear_gradients.push(function(_e,rt){return _e.readFields(JM,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},rt)}(g,g.readVarint()+g.pos)):b===5?o.radial_gradients.push(function(_e,rt){return _e.readFields(tD,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},rt)}(g,g.readVarint()+g.pos)):b===7?o.clip_paths.push(function(_e,rt){return _e.readFields(rD,{children:[]},rt)}(g,g.readVarint()+g.pos)):b===8&&o.masks.push(function(_e,rt){const ot=_e.readFields(nD,{left:0,width:20,mask_type:JA.MASK_TYPE_LUMINANCE,children:[]},rt);return ot.height==null&&(ot.height=ot.width),ot.top==null&&(ot.top=ot.left),ot}(g,g.readVarint()+g.pos))}function GE(b,o){return b.readFields(qM,{},o)}function qM(b,o,g){b===1?(o.group=function(_e,rt){return _e.readFields(KM,{opacity:255,children:[]},rt)}(g,g.readVarint()+g.pos),o.node="group"):b===2&&(o.path=function(_e,rt){return _e.readFields(ZM,{paint_order:1,commands:[],step:1,diffs:[],rule:BS.PATH_RULE_NON_ZERO},rt)}(g,g.readVarint()+g.pos),o.node="path")}function KM(b,o,g){b===1?o.transform=HE(g,g.readVarint()+g.pos):b===2?o.opacity=g.readVarint():b===5?o.clip_path_idx=g.readVarint():b===6?o.mask_idx=g.readVarint():b===7&&o.children.push(GE(g,g.readVarint()+g.pos))}function HE(b,o){return b.readFields(XM,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},o)}function XM(b,o,g){b===1?o.sx=g.readFloat():b===2?o.ky=g.readFloat():b===3?o.kx=g.readFloat():b===4?o.sy=g.readFloat():b===5?o.tx=g.readFloat():b===6&&(o.ty=g.readFloat())}function ZM(b,o,g){b===1?o.fill=function(_e,rt){return _e.readFields(YM,{rgb_color:FS,paint:"rgb_color",opacity:255},rt)}(g,g.readVarint()+g.pos):b===2?o.stroke=function(_e,rt){return _e.readFields(QM,{rgb_color:FS,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},rt)}(g,g.readVarint()+g.pos):b===3?o.paint_order=g.readVarint():b===5?g.readPackedVarint(o.commands):b===6?o.step=g.readFloat():b===7?g.readPackedSVarint(o.diffs):b===8&&(o.rule=g.readVarint())}function YM(b,o,g){b===1?(o.rgb_color=WE(g.readVarint()),o.paint="rgb_color"):b===2?(o.linear_gradient_idx=g.readVarint(),o.paint="linear_gradient_idx"):b===3?(o.radial_gradient_idx=g.readVarint(),o.paint="radial_gradient_idx"):b===5&&(o.opacity=g.readVarint())}function WE(b){return new Ro((b>>16&255)/255,(b>>8&255)/255,(255&b)/255,1)}function QM(b,o,g){b===1?(o.rgb_color=WE(g.readVarint()),o.paint="rgb_color"):b===2?(o.linear_gradient_idx=g.readVarint(),o.paint="linear_gradient_idx"):b===3?(o.radial_gradient_idx=g.readVarint(),o.paint="radial_gradient_idx"):b===5?g.readPackedFloat(o.dasharray):b===6?o.dashoffset=g.readFloat():b===7?o.miterlimit=g.readFloat():b===8?o.opacity=g.readVarint():b===9?o.width=g.readFloat():b===10?o.linecap=g.readVarint():b===11&&(o.linejoin=g.readVarint())}function JM(b,o,g){b===1?o.transform=HE(g,g.readVarint()+g.pos):b===2?o.spread_method=g.readVarint():b===3?o.stops.push(rR(g,g.readVarint()+g.pos)):b===4?o.x1=g.readFloat():b===5?o.y1=g.readFloat():b===6?o.x2=g.readFloat():b===7&&(o.y2=g.readFloat())}function rR(b,o){return b.readFields(eD,{offset:0,opacity:255,rgb_color:FS},o)}function eD(b,o,g){b===1?o.offset=g.readFloat():b===2?o.opacity=g.readVarint():b===3&&(o.rgb_color=WE(g.readVarint()))}function tD(b,o,g){b===1?o.transform=HE(g,g.readVarint()+g.pos):b===2?o.spread_method=g.readVarint():b===3?o.stops.push(rR(g,g.readVarint()+g.pos)):b===4?o.cx=g.readFloat():b===5?o.cy=g.readFloat():b===6?o.r=g.readFloat():b===7?o.fx=g.readFloat():b===8?o.fy=g.readFloat():b===9&&(o.fr=g.readFloat())}function rD(b,o,g){b===1?o.transform=HE(g,g.readVarint()+g.pos):b===2?o.clip_path_idx=g.readVarint():b===3&&o.children.push(GE(g,g.readVarint()+g.pos))}function nD(b,o,g){b===1?o.left=o.top=g.readFloat():b===2?o.width=o.height=g.readFloat():b===3?o.top=g.readFloat():b===4?o.height=g.readFloat():b===5?o.mask_type=g.readVarint():b===6?o.mask_idx=g.readVarint():b===7&&o.children.push(GE(g,g.readVarint()+g.pos))}class iD{static calculate(o={},g=[]){const _e=new Map,rt=new Map;if(Object.keys(o).length===0)return _e;g.forEach(ot=>{rt.set(ot.name,ot.rgb_color||new Ro(0,0,0))});for(const[ot,at]of Object.entries(o))rt.has(ot)?_e.set(rt.get(ot).toString(),at):console.warn(`Ignoring unknown image variable "${ot}"`);return _e}}function $_(b,o=255,g){const _e=o/255,rt=b.toString(),ot=g.has(rt)?g.get(rt).clone():b.clone();return ot.a*=_e,ot.toString()}function G1(b,o){if(!Dp()){const g=document.createElement("canvas");return g.width=b,g.height=o,g}return new OffscreenCanvas(b,o)}let VS,H1=null;function US(b,o,g,_e,rt){for(const ot of _e.children)nR(b,o,g,ot,rt)}function nR(b,o,g,_e,rt){_e.group?(b.save(),function(ot,at,ut,ft,xt){const Ct=ft.mask_idx!=null?ut.masks[ft.mask_idx]:null,Rt=ft.clip_path_idx!=null?ut.clip_paths[ft.clip_path_idx]:null;if(ft.transform&&(at=G_(ft.transform).preMultiplySelf(at)),!function(Ut,Kt,er){return Ut.opacity!==255||Kt||er}(ft,Rt!=null,Ct!=null))return void US(ot,at,ut,ft,xt);const kt=G1(ot.canvas.width,ot.canvas.height),zt=kt.getContext("2d");US(zt,at,ut,ft,xt),Rt&&uR(zt,at,ut,Rt),Ct&&hR(zt,at,ut,Ct,xt),ot.globalAlpha=ft.opacity/255,ot.drawImage(kt,0,0)}(b,o,g,_e.group,rt),b.restore()):_e.path&&(b.save(),function(ot,at,ut,ft,xt){ot.setTransform(at),ft.paint_order===zM.PAINT_ORDER_FILL_AND_STROKE?(iR(ot,ut,ft,xt),oR(ot,ut,ft,xt)):(oR(ot,ut,ft,xt),iR(ot,ut,ft,xt))}(b,o,g,_e.path,rt),b.restore())}function iR(b,o,g,_e){const rt=g.fill;if(!rt)return;const ot=rt.opacity/255;switch(b.save(),b.beginPath(),dR(g,b),rt.paint){case"rgb_color":b.fillStyle=$_(rt.rgb_color,rt.opacity,_e);break;case"linear_gradient_idx":{const at=o.linear_gradients[rt.linear_gradient_idx];at.transform&&b.setTransform(G_(at.transform).preMultiplySelf(b.getTransform())),b.fillStyle=aR(b,at,ot,_e);break}case"radial_gradient_idx":{const at=o.radial_gradients[rt.radial_gradient_idx];at.transform&&b.setTransform(G_(at.transform).preMultiplySelf(b.getTransform())),b.fillStyle=lR(b,at,ot,_e)}}b.fill(sR(g)),b.restore()}function sR(b){return b.rule===BS.PATH_RULE_NON_ZERO?"nonzero":b.rule===BS.PATH_RULE_EVEN_ODD?"evenodd":void 0}function oR(b,o,g,_e){const rt=g.stroke;if(!rt)return;const ot=pR(g);b.lineWidth=rt.width,b.miterLimit=rt.miterlimit,b.setLineDash(rt.dasharray),b.lineDashOffset=rt.dashoffset;const at=rt.opacity/255;switch(rt.paint){case"rgb_color":b.strokeStyle=$_(rt.rgb_color,rt.opacity,_e);break;case"linear_gradient_idx":b.strokeStyle=aR(b,o.linear_gradients[rt.linear_gradient_idx],at,_e,!0);break;case"radial_gradient_idx":b.strokeStyle=lR(b,o.radial_gradients[rt.radial_gradient_idx],at,_e,!0)}switch(rt.linejoin){case $E.LINE_JOIN_MITER_CLIP:case $E.LINE_JOIN_MITER:b.lineJoin="miter";break;case $E.LINE_JOIN_ROUND:b.lineJoin="round";break;case $E.LINE_JOIN_BEVEL:b.lineJoin="bevel"}switch(rt.linecap){case zS.LINE_CAP_BUTT:b.lineCap="butt";break;case zS.LINE_CAP_ROUND:b.lineCap="round";break;case zS.LINE_CAP_SQUARE:b.lineCap="square"}b.stroke(ot)}function aR(b,o,g,_e,rt=!1){if(o.stops.length===1){const kt=o.stops[0];return $_(kt.rgb_color,kt.opacity*g,_e)}const{x1:ot,y1:at,x2:ut,y2:ft}=o;let xt=new DOMPoint(ot,at),Ct=new DOMPoint(ut,ft);if(rt){const kt=G_(o.transform);xt=kt.transformPoint(xt),Ct=kt.transformPoint(Ct)}const Rt=b.createLinearGradient(xt.x,xt.y,Ct.x,Ct.y);for(const kt of o.stops)Rt.addColorStop(kt.offset,$_(kt.rgb_color,kt.opacity*g,_e));return Rt}function lR(b,o,g,_e,rt=!1){if(o.stops.length===1){const Jt=o.stops[0];return $_(Jt.rgb_color,Jt.opacity*g,_e)}const ot=G_(o.transform),{fx:at,fy:ut,fr:ft,cx:xt,cy:Ct,r:Rt}=o;let kt=new DOMPoint(at,ut),zt=new DOMPoint(xt,Ct),Ut=ft,Kt=Rt;if(rt){kt=ot.transformPoint(kt),zt=ot.transformPoint(zt);const Jt=(ot.a+ot.d)/2;Ut=ft*Jt,Kt=o.r*Jt}const er=b.createRadialGradient(kt.x,kt.y,Ut,zt.x,zt.y,Kt);for(const Jt of o.stops)er.addColorStop(Jt.offset,$_(Jt.rgb_color,Jt.opacity*g,_e));return er}function cR(b,o,g,_e){const rt=_e.transform?G_(_e.transform).preMultiplySelf(o):o,ot=G1(b.canvas.width,b.canvas.height),at=ot.getContext("2d");for(const ft of _e.children)if(ft.group)cR(at,rt,g,ft.group);else if(ft.path){const xt=ft.path,Ct=new Path2D;Ct.addPath(pR(xt),rt),at.fill(Ct,sR(xt))}const ut=_e.clip_path_idx!=null?g.clip_paths[_e.clip_path_idx]:null;ut&&uR(at,rt,g,ut),b.globalCompositeOperation="source-over",b.drawImage(ot,0,0)}function uR(b,o,g,_e){const rt=G1(b.canvas.width,b.canvas.height);cR(rt.getContext("2d"),o,g,_e),b.globalCompositeOperation="destination-in",b.drawImage(rt,0,0)}function hR(b,o,g,_e,rt){if(_e.children.length===0)return;const ot=_e.mask_idx!=null?g.masks[_e.mask_idx]:null;ot&&hR(b,o,g,ot,rt);const at=b.canvas.width,ut=b.canvas.height,ft=G1(at,ut),xt=ft.getContext("2d"),Ct=_e.width,Rt=_e.height,kt=_e.left,zt=_e.top,Ut=new Path2D,Kt=new Path2D;Kt.rect(kt,zt,Ct,Rt),Ut.addPath(Kt,o),xt.clip(Ut);for(const or of _e.children)nR(xt,o,g,or,rt);const er=xt.getImageData(0,0,at,ut),Jt=er.data;if(_e.mask_type===JA.MASK_TYPE_LUMINANCE)for(let or=0;or<Jt.length;or+=4)Jt[or+3]=Jt[or+3]/255*(.2126*Jt[or]+.7152*Jt[or+1]+.0722*Jt[or+2]);xt.putImageData(er,0,0),b.globalCompositeOperation="destination-in",b.drawImage(ft,0,0)}function G_(b){return b?new DOMMatrix([b.sx,b.ky,b.kx,b.sy,b.tx,b.ty]):new DOMMatrix}function dR(b,o){const g=b.step;let _e=b.diffs[0]*g,rt=b.diffs[1]*g;o.moveTo(_e,rt);for(let ot=0,at=2;ot<b.commands.length;ot++)switch(b.commands[ot]){case $1.PATH_COMMAND_MOVE:_e+=b.diffs[at++]*g,rt+=b.diffs[at++]*g,o.moveTo(_e,rt);break;case $1.PATH_COMMAND_LINE:_e+=b.diffs[at++]*g,rt+=b.diffs[at++]*g,o.lineTo(_e,rt);break;case $1.PATH_COMMAND_QUAD:{const ut=_e+b.diffs[at++]*g,ft=rt+b.diffs[at++]*g;_e=ut+b.diffs[at++]*g,rt=ft+b.diffs[at++]*g,o.quadraticCurveTo(ut,ft,_e,rt);break}case $1.PATH_COMMAND_CUBIC:{const ut=_e+b.diffs[at++]*g,ft=rt+b.diffs[at++]*g,xt=ut+b.diffs[at++]*g,Ct=ft+b.diffs[at++]*g;_e=xt+b.diffs[at++]*g,rt=Ct+b.diffs[at++]*g,o.bezierCurveTo(ut,ft,xt,Ct,_e,rt);break}case $1.PATH_COMMAND_CLOSE:o.closePath()}return o}function pR(b){return dR(b,new Path2D)}class qE{constructor(o){this.capacity=o,this.cache=new Map}get(o){if(!this.cache.has(o))return;const g=this.cache.get(o);return this.cache.delete(o),this.cache.set(o,g),g}put(o,g){this.cache.has(o)?this.cache.delete(o):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(o,g)}delete(o){this.cache.delete(o)}}Jn(qE,"LRUCache");class $S{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(o){return new ku(o,o.data)}getFromCache(o,g,_e){return this.cacheMap.has(_e)||this.cacheMap.set(_e,new qE(150)),this.cacheMap.get(_e).get(Rp(o.toString(),g))}setInCache(o,g,_e,rt){this.cacheDependenciesMap.has(rt)||this.cacheDependenciesMap.set(rt,new Map),this.cacheMap.has(rt)||this.cacheMap.set(rt,new qE(150));const ot=this.cacheDependenciesMap.get(rt),at=Rp(o.id.toString(),_e);ot.get(at)||ot.set(at,new Set);const ut=this.cacheMap.get(rt),ft=o.toString();ot.get(at).add(ft),ut.put(Rp(o.toString(),_e),g)}removeImagesFromCacheByIds(o,g,_e=0){if(!this.cacheMap.has(_e)||!this.cacheDependenciesMap.has(_e))return;const rt=this.cacheMap.get(_e),ot=this.cacheDependenciesMap.get(_e);for(const at of o){const ut=Rp(at.toString(),g);if(ot.has(ut)){for(const ft of ot.get(ut))rt.delete(ft);ot.delete(ut)}}}rasterize(o,g,_e,rt){const ot=this.getFromCache(o,_e,rt);if(ot)return ot.clone();const at=function(ft,xt){const Ct=iD.calculate(xt.params,ft.metadata?ft.metadata.variables:[]),Rt=ft.usvg_tree,kt=Rt.width,zt=Rt.height,Ut=Math.max(1,Math.round(kt*xt.sx)),Kt=Math.max(1,Math.round(zt*xt.sy)),er=new DOMMatrix([Ut/kt,0,0,Kt/zt,0,0]);return H1===null&&(H1=G1(10,10),VS=H1.getContext("2d",{willReadFrequently:!0})),H1.width=Ut,H1.height=Kt,US(VS,er,Rt,Rt,Ct),VS.getImageData(0,0,Ut,Kt)}(g.icon,o),ut=$S._getImage(at);return this.setInCache(o,ut,_e,rt),ut.clone()}}class fR{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,g){const _e=this.toIdx(o,g);return{min:this.minimums[_e],max:this.maximums[_e]}}isLeaf(o,g){return this.leaves[this.toIdx(o,g)]}toIdx(o,g){return g*this.size+o}}function mR(b,o,g,_e){let rt=0,ot=Number.MAX_VALUE;for(let at=0;at<3;at++)if(Math.abs(_e[at])<1e-15){if(g[at]<b[at]||g[at]>o[at])return null}else{const ut=1/_e[at];let ft=(b[at]-g[at])*ut,xt=(o[at]-g[at])*ut;if(ft>xt){const Ct=ft;ft=xt,xt=Ct}if(ft>rt&&(rt=ft),xt<ot&&(ot=xt),rt>ot)return null}return rt}function gR(b,o,g,_e,rt,ot,at,ut,ft,xt,Ct){const Rt=_e-b,kt=rt-o,zt=ot-g,Ut=at-b,Kt=ut-o,er=ft-g,Jt=Ct[1]*er-Ct[2]*Kt,or=Ct[2]*Ut-Ct[0]*er,cr=Ct[0]*Kt-Ct[1]*Ut,pr=Rt*Jt+kt*or+zt*cr;if(Math.abs(pr)<1e-15)return null;const Sr=1/pr,br=xt[0]-b,Pr=xt[1]-o,Dr=xt[2]-g,Or=(br*Jt+Pr*or+Dr*cr)*Sr;if(Or<0||Or>1)return null;const nn=Pr*zt-Dr*kt,$r=Dr*Rt-br*zt,un=br*kt-Pr*Rt,gn=(Ct[0]*nn+Ct[1]*$r+Ct[2]*un)*Sr;return gn<0||Or+gn>1?null:(Ut*nn+Kt*$r+er*un)*Sr}function yR(b,o,g){return(b-o)/(g-o)}function xR(b,o,g,_e,rt,ot,at,ut,ft){const xt=1<<g,Ct=ot-_e,Rt=at-rt,kt=(b+1)/xt*Ct+_e,zt=(o+0)/xt*Rt+rt,Ut=(o+1)/xt*Rt+rt;ut[0]=(b+0)/xt*Ct+_e,ut[1]=zt,ft[0]=kt,ft[1]=Ut}class _R{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const g=function(ot){const at=Math.ceil(Math.log2(ot.dim/8)),ut=[];let ft=Math.ceil(Math.pow(2,at));const xt=1/ft,Ct=(zt,Ut,Kt,er,Jt)=>{const or=er?1:0,cr=(zt+1)*Kt-or,pr=Ut*Kt,Sr=(Ut+1)*Kt-or;Jt[0]=zt*Kt,Jt[1]=pr,Jt[2]=cr,Jt[3]=Sr};let Rt=new fR(ft);const kt=[];for(let zt=0;zt<ft*ft;zt++){Ct(zt%ft,Math.floor(zt/ft),xt,!1,kt);const Ut=Q0(kt[0],kt[1],ot),Kt=Q0(kt[2],kt[1],ot),er=Q0(kt[2],kt[3],ot),Jt=Q0(kt[0],kt[3],ot);Rt.minimums.push(Math.min(Ut,Kt,er,Jt)),Rt.maximums.push(Math.max(Ut,Kt,er,Jt)),Rt.leaves.push(1)}for(ut.push(Rt),ft/=2;ft>=1;ft/=2){const zt=ut[ut.length-1];Rt=new fR(ft);for(let Ut=0;Ut<ft*ft;Ut++){Ct(Ut%ft,Math.floor(Ut/ft),2,!0,kt);const Kt=zt.getElevation(kt[0],kt[1]),er=zt.getElevation(kt[2],kt[1]),Jt=zt.getElevation(kt[2],kt[3]),or=zt.getElevation(kt[0],kt[3]),cr=zt.isLeaf(kt[0],kt[1]),pr=zt.isLeaf(kt[2],kt[1]),Sr=zt.isLeaf(kt[2],kt[3]),br=zt.isLeaf(kt[0],kt[3]),Pr=Math.min(Kt.min,er.min,Jt.min,or.min),Dr=Math.max(Kt.max,er.max,Jt.max,or.max),Or=cr&&pr&&Sr&&br;Rt.maximums.push(Dr),Rt.minimums.push(Pr),Rt.leaves.push(Dr-Pr<=5&&Or?1:0)}ut.push(Rt)}return ut}(this.dem),_e=g.length-1,rt=g[_e];this._addNode(rt.minimums[0],rt.maximums[0],rt.leaves[0]),this._construct(g,0,0,_e,0)}raycastRoot(o,g,_e,rt,ot,at,ut=1){return mR([o,g,-100],[_e,rt,this.maximums[0]*ut],ot,at)}raycast(o,g,_e,rt,ot,at,ut=1){if(!this.nodeCount)return null;const ft=this.raycastRoot(o,g,_e,rt,ot,at,ut);if(ft==null)return null;const xt=[],Ct=[],Rt=[],kt=[],zt=[{idx:0,t:ft,nodex:0,nodey:0,depth:0}];for(;zt.length>0;){const{idx:Ut,t:Kt,nodex:er,nodey:Jt,depth:or}=zt.pop();if(this.leaves[Ut]){xR(er,Jt,or,o,g,_e,rt,Rt,kt);const pr=1<<or,Sr=(er+0)/pr,br=(er+1)/pr,Pr=(Jt+0)/pr,Dr=(Jt+1)/pr,Or=Q0(Sr,Pr,this.dem)*ut,nn=Q0(br,Pr,this.dem)*ut,$r=Q0(br,Dr,this.dem)*ut,un=Q0(Sr,Dr,this.dem)*ut,gn=gR(Rt[0],Rt[1],Or,kt[0],Rt[1],nn,kt[0],kt[1],$r,ot,at),yn=gR(kt[0],kt[1],$r,Rt[0],kt[1],un,Rt[0],Rt[1],Or,ot,at),Sn=Math.min(gn!==null?gn:Number.MAX_VALUE,yn!==null?yn:Number.MAX_VALUE);if(Sn!==Number.MAX_VALUE)return Sn;{const An=vn([],ot,at,Kt);if(vR(Or,nn,un,$r,yR(An[0],Rt[0],kt[0]),yR(An[1],Rt[1],kt[1]))>=An[2])return Kt}continue}let cr=0;for(let pr=0;pr<this._siblingOffset.length;pr++){xR((er<<1)+this._siblingOffset[pr][0],(Jt<<1)+this._siblingOffset[pr][1],or+1,o,g,_e,rt,Rt,kt),Rt[2]=-100,kt[2]=this.maximums[this.childOffsets[Ut]+pr]*ut;const Sr=mR(Rt,kt,ot,at);if(Sr!=null){const br=Sr;xt[pr]=br;let Pr=!1;for(let Dr=0;Dr<cr&&!Pr;Dr++)br>=xt[Ct[Dr]]&&(Ct.splice(Dr,0,pr),Pr=!0);Pr||(Ct[cr]=pr),cr++}}for(let pr=0;pr<cr;pr++){const Sr=Ct[pr];zt.push({idx:this.childOffsets[Ut]+Sr,t:xt[Sr],nodex:(er<<1)+this._siblingOffset[Sr][0],nodey:(Jt<<1)+this._siblingOffset[Sr][1],depth:or+1})}}return null}_addNode(o,g,_e){return this.minimums.push(o),this.maximums.push(g),this.leaves.push(_e),this.childOffsets.push(0),this.nodeCount++}_construct(o,g,_e,rt,ot){if(o[rt].isLeaf(g,_e)===1)return;this.childOffsets[ot]||(this.childOffsets[ot]=this.nodeCount);const at=rt-1,ut=o[at];let ft=0,xt=0;for(let Ct=0;Ct<this._siblingOffset.length;Ct++){const Rt=2*g+this._siblingOffset[Ct][0],kt=2*_e+this._siblingOffset[Ct][1],zt=ut.getElevation(Rt,kt),Ut=ut.isLeaf(Rt,kt),Kt=this._addNode(zt.min,zt.max,Ut);Ut&&(ft|=1<<Ct),xt||(xt=Kt)}for(let Ct=0;Ct<this._siblingOffset.length;Ct++)ft&1<<Ct||this._construct(o,2*g+this._siblingOffset[Ct][0],2*_e+this._siblingOffset[Ct][1],at,xt+Ct)}}function vR(b,o,g,_e,rt,ot){return Cs(Cs(b,g,ot),Cs(o,_e,ot),rt)}function Q0(b,o,g){const _e=g.dim,rt=tr(b*_e-.5,0,_e-1),ot=tr(o*_e-.5,0,_e-1),at=Math.floor(rt),ut=Math.floor(ot),ft=Math.min(at+1,_e-1),xt=Math.min(ut+1,_e-1);return vR(g.get(at,ut),g.get(ft,ut),g.get(at,xt),g.get(ft,xt),rt-at,ot-ut)}const sD={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function oD(b,o,g){return(256*b*256+256*o+g)/10-1e4}function aD(b,o,g){return 256*b+o+g/256-32768}class KE{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,g,_e,rt=!1){if(this.uid=o,g.height!==g.width)throw new RangeError("DEM tiles must be square");if(_e&&_e!=="mapbox"&&_e!=="terrarium")return void Wn(`"${_e}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=g.height;const ot=this.dim=g.height-2,at=new Uint32Array(g.data.buffer);if(this.pixels=new Uint8Array(g.data.buffer),this.floatView=new Float32Array(g.data.buffer),this.borderReady=rt,this._modifiedForSources={},!rt){for(let ft=0;ft<ot;ft++)at[this._idx(-1,ft)]=at[this._idx(0,ft)],at[this._idx(ot,ft)]=at[this._idx(ot-1,ft)],at[this._idx(ft,-1)]=at[this._idx(ft,0)],at[this._idx(ft,ot)]=at[this._idx(ft,ot-1)];at[this._idx(-1,-1)]=at[this._idx(0,0)],at[this._idx(ot,-1)]=at[this._idx(ot-1,0)],at[this._idx(-1,ot)]=at[this._idx(0,ot-1)],at[this._idx(ot,ot)]=at[this._idx(ot-1,ot-1)]}const ut=_e==="terrarium"?aD:oD;for(let ft=0;ft<at.length;++ft){const xt=4*ft;this.floatView[ft]=ut(this.pixels[xt],this.pixels[xt+1],this.pixels[xt+2])}this._timestamp=hu.now()}_buildQuadTree(){this._tree=new _R(this)}get(o,g,_e=!1){_e&&(o=tr(o,-1,this.dim),g=tr(g,-1,this.dim));const rt=this._idx(o,g);return this.floatView[rt]}set(o,g,_e){const rt=this._idx(o,g),ot=this.floatView[rt];return this.floatView[rt]=_e,_e-ot}static getUnpackVector(o){return sD[o]}_idx(o,g){if(o<-1||o>=this.dim+1||g<-1||g>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(g+1)*this.stride+(o+1)}static pack(o,g){const _e=[0,0,0,0],rt=KE.getUnpackVector(g);let ot=Math.floor((o+rt[3])/rt[2]);return _e[2]=ot%256,ot=Math.floor(ot/256),_e[1]=ot%256,ot=Math.floor(ot/256),_e[0]=ot,_e}getPixels(){return new fC({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,g,_e){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let rt=g*this.dim,ot=g*this.dim+this.dim,at=_e*this.dim,ut=_e*this.dim+this.dim;switch(g){case-1:rt=ot-1;break;case 1:ot=rt+1}switch(_e){case-1:at=ut-1;break;case 1:ut=at+1}const ft=-g*this.dim,xt=-_e*this.dim;for(let Ct=at;Ct<ut;Ct++)for(let Rt=rt;Rt<ot;Rt++){const kt=4*this._idx(Rt,Ct),zt=4*this._idx(Rt+ft,Ct+xt);this.pixels[kt+0]=o.pixels[zt+0],this.pixels[kt+1]=o.pixels[zt+1],this.pixels[kt+2]=o.pixels[zt+2],this.pixels[kt+3]=o.pixels[zt+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function lD(b,o,g){b===1?o.headerLength=g.readFixed32():b===2?o.x=g.readVarint():b===3?o.y=g.readVarint():b===4?o.z=g.readVarint():b===5&&o.layers.push(function(_e,rt){return _e.readFields(pD,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},rt)}(g,g.readVarint()+g.pos))}function cD(b,o,g){b===1?(o.delta_filter=function(_e,rt){return _e.readFields(uD,{blockSize:0},rt)}(g,g.readVarint()+g.pos),o.filter="delta_filter"):b===2?(g.readVarint(),o.filter="zigzag_filter"):b===3?(g.readVarint(),o.filter="bitshuffle_filter"):b===4&&(g.readVarint(),o.filter="byteshuffle_filter")}function uD(b,o,g){b===1&&(o.blockSize=g.readVarint())}function hD(b,o,g){b===1?(g.readVarint(),o.codec="gzip_data"):b===2?(g.readVarint(),o.codec="jpeg_image"):b===3?(g.readVarint(),o.codec="webp_image"):b===4&&(g.readVarint(),o.codec="png_image")}function dD(b,o,g){let _e=0,rt=0;b===1?o.firstByte=g.readFixed64():b===2?o.lastByte=g.readFixed64():b===3?o.filters.push(function(ot,at){return ot.readFields(cD,{},at)}(g,g.readVarint()+g.pos)):b===4?o.codec=function(ot,at){return ot.readFields(hD,{},at)}(g,g.readVarint()+g.pos):b===5?rt=g.readFloat():b===6?_e=g.readFloat():b===7?o.bands.push(g.readString()):b===8?o.offset=g.readDouble():b===9&&(o.scale=g.readDouble()),o.offset===0&&(o.offset=rt),o.scale===0&&(o.scale=_e)}function pD(b,o,g){b===1?o.version=g.readVarint():b===2?o.name=g.readString():b===3?o.units=g.readString():b===4?o.tileSize=g.readVarint():b===5?o.buffer=g.readVarint():b===6?o.pixelFormat=g.readVarint():b===7&&o.dataIndex.push(function(_e,rt){return _e.readFields(dD,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},rt)}(g,g.readVarint()+g.pos))}function fD(b,o,g){if(b===2)(function(_e,rt,ot){_e.readFields(mD,ot,rt)})(g,g.readVarint()+g.pos,o);else if(b===3)throw new Error("Not implemented")}function mD(b,o,g){if(b===1){let _e=0;const rt=g.readVarint()+g.pos;for(;g.pos<rt;)o[_e++]=g.readVarint()}}function gD(b,o){if(o.length!==4)throw new Error(`Expected data of dimension 4 but got ${o.length}.`);let g=o[3];for(let _e=2;_e>=1;_e--){const rt=_e===1?1:0,ot=_e===2?1:0;for(let at=0;at<o[0];at++){const ut=o[1]*at;for(let ft=rt;ft<o[1];ft++){const xt=o[2]*(ft+ut);for(let Ct=ot;Ct<o[2];Ct++){const Rt=o[3]*(Ct+xt);for(let kt=0;kt<o[3];kt++){const zt=Rt+kt;b[zt]+=b[zt-g]}}}}g*=o[_e]}return b}function yD(b){for(let o=0,g=b.length;o<g;o++)b[o]=b[o]>>>1^-(1&b[o]);return b}function xD(b,o){switch(o){case"uint32":return b;case"uint16":for(let g=0;g<b.length;g+=2){const _e=b[g],rt=b[g+1];b[g]=(240&_e)>>4|(61440&_e)>>8|(240&rt)<<4|61440&rt,b[g+1]=15&_e|(3840&_e)>>4|(15&rt)<<8|(3840&rt)<<4}return b;case"uint8":for(let g=0;g<b.length;g+=4){const _e=b[g],rt=b[g+1],ot=b[g+2],at=b[g+3];b[g+0]=(192&_e)>>6|(192&rt)>>4|(192&ot)>>2|192&at,b[g+1]=(48&_e)>>4|(48&rt)>>2|48&ot|(48&at)<<2,b[g+2]=(12&_e)>>2|12&rt|(12&ot)<<2|(12&at)<<4,b[g+3]=3&_e|(3&rt)<<2|(3&ot)<<4|(3&at)<<6}return b;default:throw new Error(`Invalid pixel format, "${o}"`)}}Jn(KE,"DEMData"),Jn(_R,"DemMinMaxQuadTree",{omit:["dem"]});var Mp=Uint8Array,W1=Uint16Array,_D=Int32Array,bR=new Mp([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),wR=new Mp([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),vD=new Mp([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ER=function(b,o){for(var g=new W1(31),_e=0;_e<31;++_e)g[_e]=o+=1<<b[_e-1];var rt=new _D(g[30]);for(_e=1;_e<30;++_e)for(var ot=g[_e];ot<g[_e+1];++ot)rt[ot]=ot-g[_e]<<5|_e;return{b:g,r:rt}},TR=ER(bR,2),SR=TR.b,bD=TR.r;SR[28]=258,bD[258]=28;for(var wD=ER(wR,0).b,CR=new W1(32768),au=0;au<32768;++au){var H_=(43690&au)>>1|(21845&au)<<1;CR[au]=((65280&(H_=(61680&(H_=(52428&H_)>>2|(13107&H_)<<2))>>4|(3855&H_)<<4))>>8|(255&H_)<<8)>>1}var q1=function(b,o,g){for(var _e=b.length,rt=0,ot=new W1(o);rt<_e;++rt)b[rt]&&++ot[b[rt]-1];var at,ut=new W1(o);for(rt=1;rt<o;++rt)ut[rt]=ut[rt-1]+ot[rt-1]<<1;at=new W1(1<<o);var ft=15-o;for(rt=0;rt<_e;++rt)if(b[rt])for(var xt=rt<<4|b[rt],Ct=o-b[rt],Rt=ut[b[rt]-1]++<<Ct,kt=Rt|(1<<Ct)-1;Rt<=kt;++Rt)at[CR[Rt]>>ft]=xt;return at},K1=new Mp(288);for(au=0;au<144;++au)K1[au]=8;for(au=144;au<256;++au)K1[au]=9;for(au=256;au<280;++au)K1[au]=7;for(au=280;au<288;++au)K1[au]=8;var AR=new Mp(32);for(au=0;au<32;++au)AR[au]=5;var ED=q1(K1,9),TD=q1(AR,5),GS=function(b){for(var o=b[0],g=1;g<b.length;++g)b[g]>o&&(o=b[g]);return o},gm=function(b,o,g){var _e=o/8|0;return(b[_e]|b[_e+1]<<8)>>(7&o)&g},HS=function(b,o){var g=o/8|0;return(b[g]|b[g+1]<<8|b[g+2]<<16)>>(7&o)},SD=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ym=function(b,o,g){var _e=new Error(o||SD[b]);if(_e.code=b,Error.captureStackTrace&&Error.captureStackTrace(_e,ym),!g)throw _e;return _e},CD=new Mp(0),AD=typeof TextDecoder<"u"&&new TextDecoder;try{AD.decode(CD,{stream:!0})}catch{}const RD={gzip_data:"gzip"};class qp extends Error{constructor(o){super(o),this.name="MRTError"}}const PD={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},RR={uint32:1,uint16:2,uint8:4},ID={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let WS;class XE{constructor(o=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=o}getLayer(o){const g=this.layers[o];if(!g)throw new qp(`Layer '${o}' not found`);return g}getHeaderLength(o){const g=new Uint8Array(o),_e=new DataView(o);if(g[0]!==13)throw new qp("File is not a valid MRT.");return _e.getUint32(1,!0)}parseHeader(o){const g=new Uint8Array(o),_e=this.getHeaderLength(o);if(g.length<_e)throw new qp(`Expected header with length >= ${_e} but got buffer of length ${g.length}`);const rt=new WS(g.subarray(0,_e)).readFields(lD,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==rt.x||this.y!==rt.y||this.z!==rt.z))throw new qp(`Invalid attempt to parse header ${rt.z}/${rt.x}/${rt.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=rt.x,this.y=rt.y,this.z=rt.z;for(const ot of rt.layers)this.layers[ot.name]=new PR(ot,{cacheSize:this._cacheSize});return this}createDecodingTask(o){const g=[],_e=this.getLayer(o.layerName);for(let rt of o.blockIndices){const ot=_e.dataIndex[rt],at=ot.firstByte-o.firstByte,ut=ot.lastByte-o.firstByte;if(_e._blocksInProgress.has(rt))continue;const ft={layerName:_e.name,firstByte:at,lastByte:ut,pixelFormat:_e.pixelFormat,blockIndex:rt,blockShape:[ot.bands.length].concat(_e.bandShape),buffer:_e.buffer,codec:ot.codec.codec,filters:ot.filters.map(xt=>xt.filter)};_e._blocksInProgress.add(rt),g.push(ft)}return new IR(g,()=>{g.forEach(rt=>_e._blocksInProgress.delete(rt.blockIndex))},(rt,ot)=>{if(g.forEach(at=>_e._blocksInProgress.delete(at.blockIndex)),rt)throw rt;ot.forEach(at=>{this.getLayer(at.layerName).processDecodedData(at)})})}}class PR{constructor({version:o,name:g,units:_e,tileSize:rt,pixelFormat:ot,buffer:at,dataIndex:ut},ft){if(this.version=o,this.version!==1)throw new qp(`Cannot parse raster layer encoded with MRT version ${o}`);this.name=g,this.units=_e,this.tileSize=rt,this.buffer=at,this.pixelFormat=PD[ot],this.dataIndex=ut,this.bandShape=[rt+2*at,rt+2*at,RR[this.pixelFormat]],this._decodedBlocks=new qE(ft?ft.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return RR[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:o})=>o).flat()}processDecodedData(o){const g=o.blockIndex.toString();this._decodedBlocks.get(g)||this._decodedBlocks.put(g,o.data)}getBlockForBand(o){let g=0;switch(typeof o){case"string":for(const[_e,rt]of this.dataIndex.entries()){for(const[ot,at]of rt.bands.entries())if(at===o)return{bandIndex:g+ot,blockIndex:_e,blockBandIndex:ot};g+=rt.bands.length}break;case"number":for(const[_e,rt]of this.dataIndex.entries()){if(o>=g&&o<g+rt.bands.length)return{bandIndex:o,blockIndex:_e,blockBandIndex:o-g};g+=rt.bands.length}break;default:throw new qp(`Invalid band \`${JSON.stringify(o)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(o){let g=1/0,_e=-1/0;const rt=[],ot=new Set;for(const at of o){const{blockIndex:ut}=this.getBlockForBand(at);if(ut<0)throw new qp(`Invalid band: ${JSON.stringify(at)}`);const ft=this.dataIndex[ut];rt.includes(ut)||rt.push(ut),ot.add(ut),g=Math.min(g,ft.firstByte),_e=Math.max(_e,ft.lastByte)}if(ot.size>this.cacheSize)throw new qp(`Number of blocks to decode (${ot.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:g,lastByte:_e,blockIndices:rt}}hasBand(o){const{blockIndex:g}=this.getBlockForBand(o);return g>=0}hasDataForBand(o){const{blockIndex:g}=this.getBlockForBand(o);return g>=0&&!!this._decodedBlocks.get(g.toString())}getBandView(o){const{blockIndex:g,blockBandIndex:_e}=this.getBlockForBand(o);if(g<0)throw new qp(`Band not found: ${JSON.stringify(o)}`);const rt=this._decodedBlocks.get(g.toString());if(!rt)throw new qp(`Data for band ${JSON.stringify(o)} of layer "${this.name}" not decoded.`);const ot=this.dataIndex[g],at=this.bandShape.reduce((xt,Ct)=>xt*Ct,1),ut=_e*at,ft=rt.subarray(ut,ut+at);return{data:ft,bytes:new Uint8Array(ft.buffer).subarray(ft.byteOffset,ft.byteOffset+ft.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:ot.offset,scale:ot.scale}}}XE.setPbf=function(b){WS=b};class IR{constructor(o,g,_e){this.tasks=o,this._onCancel=g,this._onComplete=_e,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(o,g){this._finalized||(this._onComplete(o,g),this._finalized=!0)}}XE.performDecoding=function(b,o){const g=new Uint8Array(b);return Promise.all(o.tasks.map(_e=>{const{layerName:rt,firstByte:ot,lastByte:at,pixelFormat:ut,blockShape:ft,blockIndex:xt,filters:Ct,codec:Rt}=_e,kt=g.subarray(ot,at+1),zt=new Uint32Array(ft[0]*ft[1]*ft[2]);let Ut;if(Rt!=="gzip_data")throw new qp(`Unhandled codec: ${Rt}`);return Ut=function(Kt,er){if(!globalThis.DecompressionStream&&er==="gzip_data")return Promise.resolve(((pr=function(Pr){Pr[0]==31&&Pr[1]==139&&Pr[2]==8||ym(6,"invalid gzip data");var Dr=Pr[3],Or=10;4&Dr&&(Or+=2+(Pr[10]|Pr[11]<<8));for(var nn=(Dr>>3&1)+(Dr>>4&1);nn>0;nn-=!Pr[Or++]);return Or+(2&Dr)}(cr=Kt))+8>cr.length&&ym(6,"invalid gzip data"),function(Pr,Dr,Or,nn){var $r=Pr.length;if(!$r||Dr.f&&!Dr.l)return Or||new Mp(0);var un=!Or,gn=un||Dr.i!=2,yn=Dr.i;un&&(Or=new Mp(3*$r));var Sn,An,wn=function(Lo){var vo=Or.length;if(Lo>vo){var Co=new Mp(Math.max(2*vo,Lo));Co.set(Or),Or=Co}},En=Dr.f||0,ln=Dr.p||0,on=Dr.b||0,Tn=Dr.l,On=Dr.d,kn=Dr.m,ls=Dr.n,Gn=8*$r;do{if(!Tn){En=gm(Pr,ln,1);var Kn=gm(Pr,ln+1,3);if(ln+=3,!Kn){var ts=Pr[(hn=4+((ln+7)/8|0))-4]|Pr[hn-3]<<8,qs=hn+ts;if(qs>$r){yn&&ym(0);break}gn&&wn(on+ts),Or.set(Pr.subarray(hn,qs),on),Dr.b=on+=ts,Dr.p=ln=8*qs,Dr.f=En;continue}if(Kn==1)Tn=ED,On=TD,kn=9,ls=5;else if(Kn==2){var Dn=gm(Pr,ln,31)+257,rs=gm(Pr,ln+10,15)+4,Ms=Dn+gm(Pr,ln+5,31)+1;ln+=14;for(var ro=new Mp(Ms),so=new Mp(19),Os=0;Os<rs;++Os)so[vD[Os]]=gm(Pr,ln+3*Os,7);ln+=3*rs;var No=GS(so),wr=(1<<No)-1,Cr=q1(so,No);for(Os=0;Os<Ms;){var hn,Cn=Cr[gm(Pr,ln,wr)];if(ln+=15&Cn,(hn=Cn>>4)<16)ro[Os++]=hn;else{var Vn=0,Un=0;for(hn==16?(Un=3+gm(Pr,ln,3),ln+=2,Vn=ro[Os-1]):hn==17?(Un=3+gm(Pr,ln,7),ln+=3):hn==18&&(Un=11+gm(Pr,ln,127),ln+=7);Un--;)ro[Os++]=Vn}}var cs=ro.subarray(0,Dn),ps=ro.subarray(Dn);kn=GS(cs),ls=GS(ps),Tn=q1(cs,kn),On=q1(ps,ls)}else ym(1);if(ln>Gn){yn&&ym(0);break}}gn&&wn(on+131072);for(var Ls=(1<<kn)-1,$s=(1<<ls)-1,Ws=ln;;Ws=ln){var Qs=(Vn=Tn[HS(Pr,ln)&Ls])>>4;if((ln+=15&Vn)>Gn){yn&&ym(0);break}if(Vn||ym(2),Qs<256)Or[on++]=Qs;else{if(Qs==256){Ws=ln,Tn=null;break}var Es=Qs-254;Qs>264&&(Es=gm(Pr,ln,(1<<(yo=bR[Os=Qs-257]))-1)+SR[Os],ln+=yo);var Is=On[HS(Pr,ln)&$s],ho=Is>>4;if(Is||ym(3),ln+=15&Is,ps=wD[ho],ho>3){var yo=wR[ho];ps+=HS(Pr,ln)&(1<<yo)-1,ln+=yo}if(ln>Gn){yn&&ym(0);break}gn&&wn(on+131072);var xo=on+Es;if(on<ps){var Io=0-ps,Bo=Math.min(ps,xo);for(Io+on<0&&ym(3);on<Bo;++on)Or[on]=(void 0)[Io+on]}for(;on<xo;++on)Or[on]=Or[on-ps]}}Dr.l=Tn,Dr.p=Ws,Dr.b=on,Dr.f=En,Tn&&(En=1,Dr.m=kn,Dr.d=On,Dr.n=ls)}while(!En);return on!=Or.length&&un?(Sn=Or,((An=on)==null||An>Sn.length)&&(An=Sn.length),new Mp(Sn.subarray(0,An))):Or.subarray(0,on)}(cr.subarray(pr,-8),{i:2},new Mp(((Jt=cr)[(or=Jt.length)-4]|Jt[or-3]<<8|Jt[or-2]<<16|Jt[or-1]<<24)>>>0))));var Jt,or,cr,pr;const Sr=RD[er];if(!Sr)throw new Error(`Unhandled codec: ${er}`);const br=new globalThis.DecompressionStream(Sr);return new Response(new Blob([Kt]).stream().pipeThrough(br)).arrayBuffer().then(Pr=>new Uint8Array(Pr))}(kt,Rt).then(Kt=>(function(er,Jt){er.readFields(fD,Jt)}(new WS(Kt),zt),new ID[ut](zt.buffer))),Ut.then(Kt=>{for(let er=Ct.length-1;er>=0;er--)switch(Ct[er]){case"delta_filter":gD(Kt,ft);break;case"zigzag_filter":yD(Kt);break;case"bitshuffle_filter":xD(Kt,ut);break;default:throw new qp(`Unhandled filter "${Ct[er]}"`)}return{layerName:rt,blockIndex:xt,data:Kt}}).catch(Kt=>{throw Kt})}))},Jn(IR,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Jn(XE,"MapboxRasterTile"),Jn(PR,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class kR{constructor(o){this._stringToNumber={},this._numberToString=[];for(let g=0;g<o.length;g++){const _e=o[g];this._stringToNumber[_e]=g,this._numberToString[g]=_e}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}class MR{constructor(o,g){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new j0(jn,16,0),this.featureIndexArray=new n1,this.promoteId=g,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(o,g,_e,rt,ot,at=0,ut=0){const ft=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(_e,rt,ot,at);const xt=this.grid;for(let Ct=0;Ct<g.length;Ct++){const Rt=g[Ct],kt=[1/0,1/0,-1/0,-1/0];for(let zt=0;zt<Rt.length;zt++){const Ut=Rt[zt];kt[0]=Math.min(kt[0],Ut.x),kt[1]=Math.min(kt[1],Ut.y),kt[2]=Math.max(kt[2],Ut.x),kt[3]=Math.max(kt[3],Ut.y)}ut!==0&&(kt[0]-=ut,kt[1]-=ut,kt[2]+=ut,kt[3]+=ut),kt[0]<jn&&kt[1]<jn&&kt[2]>=0&&kt[3]>=0&&xt.insert(ft,kt[0],kt[1],kt[2],kt[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Kr(new SE(this.rawTileData)).layers,this.sourceLayerCoder=new kR(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,g){const{tilespaceGeometry:_e,transform:rt,tileTransform:ot,pixelPosMatrix:at,availableImages:ut,worldview:ft}=g;this.loadVTLayers(),this.serializedLayersCache.clear();const xt=g.queryRadius?g.queryRadius:0,Ct=_e.bufferedTilespaceBounds,Rt=this.grid.query(Ct.min.x,Ct.min.y,Ct.max.x,Ct.max.y,(Kt,er,Jt,or)=>zu(_e.bufferedTilespaceGeometry,Kt-xt,er-xt,Jt+xt,or+xt));Rt.sort(kD);let kt=null;rt.elevation&&Rt.length>0&&(kt=U_.create(rt.elevation,this.tileID));const zt={};let Ut;for(let Kt=0;Kt<Rt.length;Kt++){const er=Rt[Kt];if(er===Ut)continue;Ut=er;const Jt=this.featureIndexArray.get(er);let or=null;this.is3DTile?this.loadMatchingModelFeature(zt,Jt,o,_e,rt,ft):this.loadMatchingFeature(zt,Jt,o,ut,ft,(cr,pr,Sr,br=0)=>(or||(or=kr(cr,this.tileID.canonical,ot)),pr.queryIntersectsFeature(_e,cr,Sr,or,this.z,rt,at,kt,br)))}return zt}loadMatchingFeature(o,g,_e,rt,ot,at){const{featureIndex:ut,bucketIndex:ft,sourceLayerIndex:xt,layoutVertexArrayOffset:Ct}=g,Rt=this.bucketLayerIDs[ft],kt=_e.layers,zt=Object.keys(kt);if(zt.length&&!Zn(zt,Rt))return;const Ut=_e.sourceCache,Kt=this.sourceLayerCoder.decode(xt),er=this.vtLayers[Kt].feature(ut),Jt=this.getId(er,Kt);for(let or=0;or<Rt.length;or++){const cr=Rt[or];if(!kt[cr])continue;const{styleLayer:pr,targets:Sr}=kt[cr];let br={};Jt!==void 0&&(br=Ut.getFeatureState(pr.sourceLayer,Jt));const Pr=!at||at(er,pr,br,Ct);if(!Pr)continue;const Dr=new Jy(er,this.z,this.x,this.y,Jt);Dr.tile=this.tileID.canonical,Dr.state=br;let Or=this.serializedLayersCache.get(cr);Or||(Or=pr.serialize(),Or.id=cr,this.serializedLayersCache.set(cr,Or)),Dr.source=Or.source,Dr.sourceLayer=Or["source-layer"],Dr.layer=Object.assign({},Or),Dr.layer.paint=DR(Or.paint,pr.paint,er,br,rt),Dr.layer.layout=DR(Or.layout,pr.layout,er,br,rt);let nn=!1;for(const $r of Sr){this.updateFeatureProperties(Dr,$r);const{filter:un}=$r;if(un){if(er.properties=Dr.properties,un.needGeometry){const gn=Ur(er,!0);if(!un.filter(new Xo(this.tileID.overscaledZ,{worldview:ot}),gn,this.tileID.canonical))continue}else if(!un.filter(new Xo(this.tileID.overscaledZ,{worldview:ot}),er))continue}nn=!0,$r.targetId&&this.addFeatureVariant(Dr,$r)}nn&&this.appendToResult(o,cr,ut,Dr,Pr)}}loadMatchingModelFeature(o,g,_e,rt,ot,at){const{featureIndex:ut,bucketIndex:ft}=g,xt=this.bucketLayerIDs[ft],Ct=_e.layers,Rt=Object.keys(Ct);if(!Rt.length||Zn(Rt,xt))for(let kt=0;kt<xt.length;kt++){const zt=xt[kt],{styleLayer:Ut,targets:Kt}=Ct[zt];if(Ut.type!=="model")continue;const er=rt.tile,Jt=er.getBucket(Ut);if(!(Jt&&Jt instanceof UE))continue;const or=FM(Jt,ut,rt,ot);if(!or)continue;const{z:cr,x:pr,y:Sr}=er.tileID.canonical,{feature:br,intersectionZ:Pr,position:Dr}=or;let Or={};br.id!==void 0&&(Or=_e.sourceCache.getFeatureState(Ut.sourceLayer,br.id));const nn=new Jy({},cr,pr,Sr,br.id);nn.tile=this.tileID.canonical,nn.state=Or,nn.properties=br.properties,nn.geometry={type:"Point",coordinates:[Dr.lng,Dr.lat]};let $r=this.serializedLayersCache.get(zt);$r||($r=Ut.serialize(),$r.id=zt,this.serializedLayersCache.set(zt,$r)),nn.source=$r.source,nn.sourceLayer=$r["source-layer"],nn.layer=Object.assign({},$r);let un=!1;for(const gn of Kt){this.updateFeatureProperties(nn,gn);const{filter:yn}=gn;if(yn){if(br.properties=nn.properties,yn.needGeometry){if(!yn.filter(new Xo(this.tileID.overscaledZ,{worldview:at}),br,this.tileID.canonical))continue}else if(!yn.filter(new Xo(this.tileID.overscaledZ,{worldview:at}),br))continue}un=!0,gn.targetId&&this.addFeatureVariant(nn,gn)}un&&this.appendToResult(o,zt,ut,nn,Pr)}}updateFeatureProperties(o,g,_e){if(g.properties){const rt={};for(const ot in g.properties){const at=g.properties[ot].evaluate({zoom:this.z},o._vectorTileFeature,o.state,o.tile,_e);at!=null&&(rt[ot]=at)}o.properties=rt}}addFeatureVariant(o,g,_e){const rt={target:g.target,namespace:g.namespace,uniqueFeatureID:g.uniqueFeatureID};g.properties&&(rt.properties=o.properties),o.variants=o.variants||{},o.variants[g.targetId]=o.variants[g.targetId]||[],o.variants[g.targetId].push(rt)}appendToResult(o,g,_e,rt,ot){let at=o[g];at===void 0&&(at=o[g]=[]),at.push({featureIndex:_e,feature:rt,intersectionZ:ot})}lookupSymbolFeatures(o,g,_e,rt,ot,at){const ut={};this.loadVTLayers();for(const ft of o)this.loadMatchingFeature(ut,{bucketIndex:g,sourceLayerIndex:_e,featureIndex:ft,layoutVertexArrayOffset:0},rt,ot,at);return ut}loadFeature(o){const{featureIndex:g,sourceLayerIndex:_e}=o;this.loadVTLayers();const rt=this.sourceLayerCoder.decode(_e),ot=this.vtFeatures[rt];if(ot[g])return ot[g];const at=this.vtLayers[rt].feature(g);return ot[g]=at,at}hasLayer(o){for(const g of this.bucketLayerIDs)for(const _e of g)if(o===_e)return!0;return!1}getId(o,g){let _e=o.id;if(this.promoteId){const rt=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[g];if(rt!=null)if(Array.isArray(rt)){if(!this.promoteIdExpression){const ot=Nm(rt);if(ot.result!=="success"){const at=ot.value.map(ut=>`${ut.key}: ${ut.message}`).join(", ");return void Wn(`Failed to create expression for promoteId: ${at}`)}this.promoteIdExpression=ot.value}_e=this.promoteIdExpression.evaluate({zoom:0},o)}else _e=o.properties[rt];typeof _e=="boolean"&&(_e=Number(_e))}return _e}}function DR(b,o,g,_e,rt){return Zr(b,(ot,at)=>{const ut=o instanceof a0?o.get(at):null;return ut&&ut.evaluate?ut.evaluate(g,_e,void 0,rt):ut})}function kD(b,o){return o-b}Jn(MR,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const NR=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class qS{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[g,_e]=new Uint8Array(o,0,2);if(g!==219)throw new Error("Data does not appear to be in a KDBush format.");const rt=_e>>4;if(rt!==1)throw new Error(`Got v${rt} data when expected v1.`);const ot=NR[15&_e];if(!ot)throw new Error("Unrecognized array type.");const[at]=new Uint16Array(o,2,1),[ut]=new Uint32Array(o,4,1);return new qS(ut,at,ot,o)}constructor(o,g=64,_e=Float64Array,rt){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+g,2),65535),this.ArrayType=_e,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const ot=NR.indexOf(this.ArrayType),at=2*o*this.ArrayType.BYTES_PER_ELEMENT,ut=o*this.IndexArrayType.BYTES_PER_ELEMENT,ft=(8-ut%8)%8;if(ot<0)throw new Error(`Unexpected typed array class: ${_e}.`);rt&&rt instanceof ArrayBuffer?(this.data=rt,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+ut+ft,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+at+ut+ft),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+ut+ft,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+ot]),new Uint16Array(this.data,2,1)[0]=g,new Uint32Array(this.data,4,1)[0]=o)}add(o,g){const _e=this._pos>>1;return this.ids[_e]=_e,this.coords[this._pos++]=o,this.coords[this._pos++]=g,_e}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return KS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,g,_e,rt){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:ot,coords:at,nodeSize:ut}=this,ft=[0,ot.length-1,0],xt=[];for(;ft.length;){const Ct=ft.pop()||0,Rt=ft.pop()||0,kt=ft.pop()||0;if(Rt-kt<=ut){for(let er=kt;er<=Rt;er++){const Jt=at[2*er],or=at[2*er+1];Jt>=o&&Jt<=_e&&or>=g&&or<=rt&&xt.push(ot[er])}continue}const zt=kt+Rt>>1,Ut=at[2*zt],Kt=at[2*zt+1];Ut>=o&&Ut<=_e&&Kt>=g&&Kt<=rt&&xt.push(ot[zt]),(Ct===0?o<=Ut:g<=Kt)&&(ft.push(kt),ft.push(zt-1),ft.push(1-Ct)),(Ct===0?_e>=Ut:rt>=Kt)&&(ft.push(zt+1),ft.push(Rt),ft.push(1-Ct))}return xt}within(o,g,_e){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:rt,coords:ot,nodeSize:at}=this,ut=[0,rt.length-1,0],ft=[],xt=_e*_e;for(;ut.length;){const Ct=ut.pop()||0,Rt=ut.pop()||0,kt=ut.pop()||0;if(Rt-kt<=at){for(let er=kt;er<=Rt;er++)jR(ot[2*er],ot[2*er+1],o,g)<=xt&&ft.push(rt[er]);continue}const zt=kt+Rt>>1,Ut=ot[2*zt],Kt=ot[2*zt+1];jR(Ut,Kt,o,g)<=xt&&ft.push(rt[zt]),(Ct===0?o-_e<=Ut:g-_e<=Kt)&&(ut.push(kt),ut.push(zt-1),ut.push(1-Ct)),(Ct===0?o+_e>=Ut:g+_e>=Kt)&&(ut.push(zt+1),ut.push(Rt),ut.push(1-Ct))}return ft}}function KS(b,o,g,_e,rt,ot){if(rt-_e<=g)return;const at=_e+rt>>1;LR(b,o,at,_e,rt,ot),KS(b,o,g,_e,at-1,1-ot),KS(b,o,g,at+1,rt,1-ot)}function LR(b,o,g,_e,rt,ot){for(;rt>_e;){if(rt-_e>600){const xt=rt-_e+1,Ct=g-_e+1,Rt=Math.log(xt),kt=.5*Math.exp(2*Rt/3),zt=.5*Math.sqrt(Rt*kt*(xt-kt)/xt)*(Ct-xt/2<0?-1:1);LR(b,o,g,Math.max(_e,Math.floor(g-Ct*kt/xt+zt)),Math.min(rt,Math.floor(g+(xt-Ct)*kt/xt+zt)),ot)}const at=o[2*g+ot];let ut=_e,ft=rt;for(X1(b,o,_e,g),o[2*rt+ot]>at&&X1(b,o,_e,rt);ut<ft;){for(X1(b,o,ut,ft),ut++,ft--;o[2*ut+ot]<at;)ut++;for(;o[2*ft+ot]>at;)ft--}o[2*_e+ot]===at?X1(b,o,_e,ft):(ft++,X1(b,o,ft,rt)),ft<=g&&(_e=ft+1),g<=ft&&(rt=ft-1)}}function X1(b,o,g,_e){XS(b,g,_e),XS(o,2*g,2*_e),XS(o,2*g+1,2*_e+1)}function XS(b,o,g){const _e=b[o];b[o]=b[g],b[g]=_e}function jR(b,o,g,_e){const rt=b-g,ot=o-_e;return rt*rt+ot*ot}c.$=wx,c.A=Yp,c.B=Rp,c.C=2,c.D=P_,c.E=Jm,c.F=I1,c.G=lA,c.H=bx,c.I=Nu,c.J=Vw,c.K=as,c.L=E0,c.M=Wx,c.N=Py,c.O=Rw,c.P=_n,c.Q=Iy,c.R=ly,c.S=r_,c.T=nS,c.U=Nm,c.V=VE,c.W=Ov,c.X=R0,c.Y=A0,c.Z=Ey,c._=Ou,c.a=function(b){return eo.API_CDN_URL_REGEX.test(b)},c.a$=Ht,c.a0=Ps,c.a1=hp,c.a2=Up,c.a3=class extends VE{},c.a4=qx,c.a5=Aw,c.a6=Hr,c.a7=function(b){const o=b.value;return o?Ps(o)?NS(o,!0)?[]:[new VE(b.key,o,`invalid url "${o}"`)]:[new VE(b.key,o,`string expected, "${as(o)}" found`)]:[]},c.a8=Ow,c.a9=Dl,c.aA=tr,c.aB=Bt,c.aC=xl,c.aD=Ru,c.aE=Oo,c.aF=mt,c.aG=dr,c.aH=function(b,o){const g={};for(let _e=0;_e<o.length;_e++){const rt=o[_e];rt in b&&(g[rt]=b[rt])}return g},c.aI=st,c.aJ=St,c.aK=class{constructor(b){this.entries={},this.scheduler=b}request(b,o,g,_e){const rt=this.entries[b]=this.entries[b]||{callbacks:[]};if(rt.result){const[ot,at]=rt.result;return this.scheduler?this.scheduler.add(()=>{_e(ot,at)},o):_e(ot,at),()=>{}}return rt.callbacks.push(_e),rt.cancel||(rt.cancel=g((ot,at)=>{rt.result=[ot,at];for(const ut of rt.callbacks)this.scheduler?this.scheduler.add(()=>{ut(ot,at)},o):ut(ot,at);setTimeout(()=>delete this.entries[b],3e3)})),()=>{rt.result||(rt.callbacks=rt.callbacks.filter(ot=>ot!==_e),rt.callbacks.length||(rt.cancel(),delete this.entries[b]))}}},c.aL=function(b,o,g){const _e=JSON.stringify(b.request);return b.data&&(this.deduped.entries[_e]={result:[null,b.data]}),this.deduped.request(_e,{type:"parseTile",isSymbolTile:b.isSymbolTile,zoom:b.tileZoom},rt=>{const ot=Zp(b.request,(at,ut,ft)=>{at?rt(at):ut&&rt(null,{rawData:ut,vectorTile:g?void 0:new Kr(new SE(ut)),responseHeaders:new Map(ft.entries())})});return()=>{ot.cancel(),rt()}},o)},c.aM=function(b){return b?{cacheControl:b.get("Cache-Control"),expires:b.get("Expires")}:{cacheControl:void 0,expires:void 0}},c.aN=Xu,c.aO=function(b){up++,up>ux&&(b.getActor().send("enforceCacheSizeLimit",lx),up=0)},c.aP=function(b){return b<=1?1:Math.pow(2,Math.floor(Math.log2(b)))},c.aQ=Rl,c.aR=OA,c.aS=$A,c.aT=$,c.aU=jA,c.aV=function(b,o){const g=document.createElement("video");g.muted=!0,g.onloadstart=function(){o(null,g)};for(let _e=0;_e<b.length;_e++){const rt=document.createElement("source");YE(b[_e])||(g.crossOrigin="Anonymous"),rt.src=b[_e],g.appendChild(rt)}return{cancel:()=>{}}},c.aW=S1,c.aX=ex,c.aY=Gr,c.aZ=N1,c.a_=Dt,c.aa=Nn,c.ab=class{constructor(b){this.specification=b}possiblyEvaluate(b,o){return js(b.expression.evaluate(o))}interpolate(b,o,g){return{x:Cs(b.x,o.x,g),y:Cs(b.y,o.y,g),z:Cs(b.z,o.z,g),azimuthal:Cs(b.azimuthal,o.azimuthal,g),polar:Cs(b.polar,o.polar,g)}}},c.ac=Xo,c.ad=i0,c.ae=hr,c.af=_s,c.ag=en,c.ah=lr,c.ai=a0,c.aj=q0,c.ak=Cs,c.al=jn,c.am=ov,c.an=Xs,c.ao=Ro,c.ap=class{constructor(b){this.specification=b}possiblyEvaluate(b,o){return function([g,_e]){const rt=js([1,g,_e]);return{x:rt.x,y:rt.y,z:rt.z}}(b.expression.evaluate(o))}interpolate(b,o,g){return{x:Cs(b.x,o.x,g),y:Cs(b.y,o.y,g),z:Cs(b.z,o.z,g)}}},c.aq=function(b,o,g=0,_e=!0){const rt=new _n(g,g),ot=b.sub(rt),at=o.add(rt),ut=[ot,new _n(at.x,ot.y),at,new _n(ot.x,at.y)];return _e&&ut.push(ot.clone()),ut},c.ar=function(b,o){const g=[];for(let _e=0;_e<b.length;_e++){const rt=_r(_e-1,-1,b.length-1),ot=_r(_e+1,-1,b.length-1),at=b[_e],ut=b[ot],ft=b[rt].sub(at).unit(),xt=ut.sub(at).unit(),Ct=xt.angleWithSep(ft.x,ft.y),Rt=ft.add(xt).unit().mult(-1*o/Math.sin(Ct/2));g.push(at.add(Rt))}return g},c.as=bA,c.at=zu,c.au=function(b,o,g=0){return yr(((o.x-g)*b.scale-b.x)*jn,(o.y*b.scale-b.y)*jn,Gt(o.z,o.y))},c.av=wo,c.aw=ds,c.ax=_i,c.ay=j2,c.az=function(b){let o=1/0,g=1/0,_e=-1/0,rt=-1/0;for(const ot of b)o=Math.min(o,ot.x),g=Math.min(g,ot.y),_e=Math.max(_e,ot.x),rt=Math.max(rt,ot.y);return{min:new _n(o,g),max:new _n(_e,rt)}},c.b=function(b){return eo.API_FONTS_REGEX.test(b)},c.b$=jC,c.b0=tu,c.b1=B0,c.b2=Vr,c.b3=Zw,c.b4=OE,c.b5=function(){im.isLoading()||im.isLoaded()||Ny()!=="deferred"||jw()},c.b6=n_,c.b7=Ur,c.b8=Jy,c.b9=Ml,c.bA=$t,c.bB=ar,c.bC=Mt,c.bD=function(b,o){const{x:g,y:_e}=b.point,rt=tC(g,_e,b.worldSize/b._pixelsPerMercatorPixel,0,0);return Bt(rt,rt,MT(kp(o)))},c.bE=gt,c.bF=ba,c.bG=hs,c.bH=vn,c.bI=ys,c.bJ=gs,c.bK=O_,c.bL=ap,c.bM=bS,c.bN=function(b,o,g,_e,rt){const ot=5*o+2;b.float32[ot+0]=g,b.float32[ot+1]=_e,b.float32[ot+2]=rt},c.bO=V_,c.bP=As,c.bQ=na,c.bR=Eo,c.bS=io,c.bT=_r,c.bU=function(b,o,g,_e){var rt=new dt(4);return rt[0]=b,rt[1]=o,rt[2]=g,rt[3]=_e,rt},c.bV=class{isDataAvailableAtPoint(b){const o=this._source();if(this.isUsingMockSource()||!o||b.y<0||b.y>1)return!1;const g=o.getSource().maxzoom,_e=1<<g,rt=Math.floor(b.x),ot=Math.floor((b.x-rt)*_e),at=Math.floor(b.y*_e),ut=this.findDEMTileFor(new Rl(g,rt,g,ot,at));return!(!ut||!ut.dem)}getAtPointOrZero(b,o=0){return this.getAtPoint(b,o)||0}getAtPoint(b,o,g=!0){if(this.isUsingMockSource())return null;o==null&&(o=null);const _e=this._source();if(!_e||b.y<0||b.y>1)return o;const rt=_e.getSource().maxzoom,ot=1<<rt,at=Math.floor(b.x),ut=b.x-at,ft=new Rl(rt,at,rt,Math.floor(ut*ot),Math.floor(b.y*ot)),xt=this.findDEMTileFor(ft);if(!xt||!xt.dem)return o;const Ct=xt.dem,Rt=1<<xt.tileID.canonical.z,kt=(ut*Rt-xt.tileID.canonical.x)*Ct.dim,zt=(b.y*Rt-xt.tileID.canonical.y)*Ct.dim,Ut=Math.floor(kt),Kt=Math.floor(zt);return(g?this.exaggeration():1)*Cs(Cs(Ct.get(Ut,Kt),Ct.get(Ut,Kt+1),zt-Kt),Cs(Ct.get(Ut+1,Kt),Ct.get(Ut+1,Kt+1),zt-Kt),kt-Ut)}static getAtTileOffset(b,o,g,_e){const rt=1<<b.canonical.z;return _e?_e.pointElevation(o):g?g.getAtPointOrZero(new hr(b.wrap+(b.canonical.x+o.x/jn)/rt,(b.canonical.y+o.y/jn)/rt)):0}static getAtTileOffsetFunc(b,o,g,_e){return(rt,ot,at)=>{const ut=this.getAtTileOffset(b,rt,ot,at),ft=_e.upVector(b.canonical,rt.x,rt.y);return tn(ft,ft,ut*_e.upVectorScale(b.canonical,o,g).metersToTile),ft}}getForTilePoints(b,o,g,_e){if(this.isUsingMockSource())return!1;const rt=U_.create(this,b,_e);return!!rt&&(o.forEach(ot=>{ot[2]=this.exaggeration()*rt.getElevationAt(ot[0],ot[1],g)}),!0)}getMinMaxForTile(b){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(b);if(!o||!o.dem)return null;const g=o.dem.tree,_e=o.tileID,rt=1<<b.canonical.z-_e.canonical.z;let ot=b.canonical.x/rt-_e.canonical.x,at=b.canonical.y/rt-_e.canonical.y,ut=0;for(let ft=0;ft<b.canonical.z-_e.canonical.z&&!g.leaves[ut];ft++){ot*=2,at*=2;const xt=2*Math.floor(at)+Math.floor(ot);ut=g.childOffsets[ut]+xt,ot%=1,at%=1}return{min:this.exaggeration()*g.minimums[ut],max:this.exaggeration()*g.maximums[ut]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(b,o,g){throw new Error("Pure virtual method called.")}pointCoordinate(b){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(b){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const b=this.visibleDemTiles;if(b.length===0)return null;let o=!1,g=Number.MAX_VALUE,_e=Number.MIN_VALUE;for(const rt of b){const ot=this.getMinMaxForTile(rt.tileID);ot&&(g=Math.min(g,ot.min),_e=Math.max(_e,ot.max),o=!0)}return o?{min:g,max:_e}:null}},c.bW=fE,c.bX=mo,c.bY=pu,c.bZ=MC,c.b_=GA,c.ba=dS,c.bb=UT,c.bc=kr,c.bd=jm,c.be=Fm,c.bf=H0,c.bg=_l,c.bh=A_,c.bi=MS,c.bj=function(b,o){const g=q0(o.zoom);if(g===0)return kp(b);const _e=nE(b),rt=kT(_e),ot=mt(_e.getWest())*o.worldSize,at=mt(_e.getEast())*o.worldSize,ut=St(_e.getNorth())*o.worldSize,ft=St(_e.getSouth())*o.worldSize,xt=[ot,ut,0],Ct=[at,ut,0],Rt=[ot,ft,0],kt=[at,ft,0],zt=Lt([],o.globeMatrix);return _s(xt,xt,zt),_s(Ct,Ct,zt),_s(Rt,Rt,zt),_s(kt,kt,zt),rt[0]=dm(rt[0],Rt,g),rt[1]=dm(rt[1],kt,g),rt[2]=dm(rt[2],Ct,g),rt[3]=dm(rt[3],xt,g),is.fromPoints(rt)},c.bk=sE,c.bl=Lt,c.bm=c1,c.bn=dm,c.bo=F0,c.bp=Hy,c.bq=mr,c.br=Nt,c.bs=XE,c.bt=SE,c.bu=Zp,c.bv=function(b,o){const g=[];for(const _e in b)_e in o||g.push(_e);return g},c.bw=Nr,c.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],c.by=Su,c.bz=Pt,c.c=wu,c.c$=function(b,o,g){let _e=0;for(let rt=0;rt<2;++rt)b[rt]>0&&(_e+=(b[rt]-0)*(b[rt]-0)),o[rt]<0&&(_e+=(0-o[rt])*(0-o[rt]));return _e},c.c0=OC,c.c1=xS,c.c2=mA,c.c3=CS,c.c4=qS,c.c5=tn,c.c6=uu,c.c7=xn,c.c8=function(b,o,g){g*=.5;var _e=o[0],rt=o[1],ot=o[2],at=o[3],ut=Math.sin(g),ft=Math.cos(g);return b[0]=_e*ft+rt*ut,b[1]=rt*ft-_e*ut,b[2]=ot*ft+at*ut,b[3]=at*ft-ot*ut,b},c.c9=Qn,c.cA=Qr,c.cB=_o,c.cC=b2,c.cD=Fo,c.cE=QS,c.cF=function(b,o,g,_e,rt,ot,at,ut,ft){if(ft.name==="globe")return QS(b,o,new Fo(g,_e,rt),!1);const xt=N1({z:g,x:_e,y:rt},ft);return new is([(ot+xt.x/xt.scale)*o,o*(xt.y/xt.scale),at],[(ot+xt.x2/xt.scale)*o,o*(xt.y2/xt.scale),ut])},c.cG=function(b,o,g){return b[0]=Math.min(o[0],g[0]),b[1]=Math.min(o[1],g[1]),b[2]=Math.min(o[2],g[2]),b[3]=Math.min(o[3],g[3]),b},c.cH=function(b,o,g){return b[0]=Math.max(o[0],g[0]),b[1]=Math.max(o[1],g[1]),b[2]=Math.max(o[2],g[2]),b[3]=Math.max(o[3],g[3]),b},c.cI=function(b){const o=Math.round((b+45+360)%360/90)%4;return rv[o]},c.cJ=qt,c.cK=Jl,c.cL=C_,c.cM=function(b){const o=$t(new Float64Array(16));Bt(o,b.pixelMatrix,b.globeMatrix);const g=[0,yp,0],_e=[0,xp,0];return _s(g,g,o),_s(_e,_e,o),[g[0]>0&&g[0]<=b.width&&g[1]>0&&g[1]<=b.height&&!NT(b,new $(b.center.lat,90)),_e[0]>0&&_e[0]<=b.width&&_e[1]>0&&_e[1]<=b.height&&!NT(b,new $(b.center.lat,-90))]},c.cN=function(b,o){const{scale:g}=b.tileTransform,_e=g*jn/(b.tileSize*Math.pow(2,o.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return function(rt,ot,at){var ut=ot[1],ft=ot[2],xt=ot[3],Ct=at[0],Rt=at[1];return rt[0]=ot[0]*Ct,rt[1]=ut*Ct,rt[2]=ft*Rt,rt[3]=xt*Rt,rt}(new Float32Array(4),o.inverseAdjustmentMatrix,[_e,_e])},c.cO=_E,c.cP=Lr,c.cQ=v2,c.cR=function(b){const o=v2(b,!0);return gt([],[o[0],o[1],o[4],o[5]])},c.cS=Vt,c.cT=$n,c.cU=Xt,c.cV=function(b){const{x:o,y:g}=b.point,{lng:_e,lat:rt}=b._center;return tC(o,g,b.worldSize,_e,rt)},c.cW=Br,c.cX=Mu,c.cY=El,c.cZ=Eu,c.c_=gp,c.ca=Ll,c.cb=function(b,o){return b[0]=-o[0],b[1]=-o[1],b[2]=-o[2],b[3]=o[3],b},c.cc=fn,c.cd=function(b,o,g,_e,rt){var ot=1/Math.tan(o/2);if(b[0]=ot/g,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=ot,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=-1,b[12]=0,b[13]=0,b[15]=0,rt!=null&&rt!==1/0){var at=1/(_e-rt);b[10]=(rt+_e)*at,b[14]=2*rt*_e*at}else b[10]=-1,b[14]=-2*_e;return b},c.ce=function(b,o,g,_e,rt,ot,at){var ut=1/(o-g),ft=1/(_e-rt),xt=1/(ot-at);return b[0]=-2*ut,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=-2*ft,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=2*xt,b[11]=0,b[12]=(o+g)*ut,b[13]=(rt+_e)*ft,b[14]=(at+ot)*xt,b[15]=1,b},c.cf=It,c.cg=function(b,o,g){b[4*o+0]=g[0],b[4*o+1]=g[1],b[4*o+2]=g[2],b[4*o+3]=g[3]},c.ch=w_,c.ci=By,c.cj=ru,c.ck=Hp,c.cl=Vy,c.cm=CA,c.cn=function(){var b=new dt(4);return dt!=Float32Array&&(b[1]=0,b[2]=0),b[0]=1,b[3]=1,b},c.co=function(b,o,g){var _e=o[0],rt=o[1],ot=o[2],at=o[3],ut=Math.sin(g),ft=Math.cos(g);return b[0]=_e*ft+ot*ut,b[1]=rt*ft+at*ut,b[2]=_e*-ut+ot*ft,b[3]=rt*-ut+at*ft,b},c.cp=function(b,o){return b[0]===o[0]&&b[1]===o[1]&&b[2]===o[2]&&b[3]===o[3]},c.cq=Qo,c.cr=function(b){var o=b[0],g=b[1],_e=b[2],rt=b[3];return Math.sqrt(o*o+g*g+_e*_e+rt*rt)},c.cs=zn,c.ct=Vl,c.cu=Kl,c.cv=3,c.cw=2,c.cx=7,c.cy=6,c.cz=Hs,c.d=function(b){return eo.API_TILEJSON_REGEX.test(b)},c.d$=class{constructor(b,o,g,_e){this.context=b,this.format=_e,this.size=g,this.texture=b.gl.createTexture();const[rt,ot,at]=this.size,{gl:ut}=b;ut.bindTexture(ut.TEXTURE_3D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in o&&o.data&&ut.texImage3D(ut.TEXTURE_3D,0,this.format,rt,ot,at,0,tS(this.format),rS(this.format),o.data)}bind(b,o){const{context:g}=this,{gl:_e}=g;_e.bindTexture(_e.TEXTURE_3D,this.texture),b!==this.minFilter&&(_e.texParameteri(_e.TEXTURE_3D,_e.TEXTURE_MAG_FILTER,b),_e.texParameteri(_e.TEXTURE_3D,_e.TEXTURE_MIN_FILTER,b),this.minFilter=b),o!==this.wrapS&&(_e.texParameteri(_e.TEXTURE_3D,_e.TEXTURE_WRAP_S,o),_e.texParameteri(_e.TEXTURE_3D,_e.TEXTURE_WRAP_T,o),this.wrapS=o)}destroy(){const{gl:b}=this.context;b.deleteTexture(this.texture),this.texture=null}},c.d0=function(b){return b*b*b*b*b},c.d1=pt,c.d2=45,c.d3=E_,c.d4=function(b,o,g){const _e=Math.sqrt(b*b+o*o+g*g),rt=_e>0?Math.acos(g/_e)*bu:0;let ot=b!==0||o!==0?Math.atan2(-o,-b)*bu+90:0;return ot<0&&(ot+=360),[_e,ot,rt]},c.d5=yr,c.d6=js,c.d7=ir,c.d8=rr,c.d9=is,c.dA=function(b){return b({pluginStatus:Fu,pluginURL:rm}),e_.on("pluginStateChange",b),b},c.dB=zy,c.dC=class extends om{constructor(b){super(b),this.current=T_}set(b,o,g){if(this.fetchUniformLocation(b,o)){for(let _e=0;_e<9;_e++)if(g[_e]!==this.current[_e]){this.current=g,this.gl.uniformMatrix3fv(this.location,!1,g);break}}}},c.dD=qm,c.dE=function(b,o,g){const _e=q0(g.zoom),rt=b.style.map._antialias,ot=b.terrain&&b.terrain.exaggeration()>0;return _e===0&&!rt&&!ot},c.dF=function(b){const o=b.pixelsPerMeter,g=o/It(1,b.center.lat),_e=$t(new Float64Array(16));return Nt(_e,_e,[b.point.x,b.point.y,0]),Vt(_e,_e,[g,g,o]),Float32Array.from(_e)},c.dG=nE,c.dH=function(b){const o=qt-5;b=tr(b,-o,o)/o*90;const g=Math.pow(Math.abs(Math.sin(Xs(b))),3);return Math.round(g*(l1.length-1))},c.dI=function(b,o,g,_e){const rt=o.getNorth(),ot=o.getSouth(),at=o.getWest(),ut=o.getEast(),ft=1<<b.z,xt=ut-at,Ct=rt-ot,Rt=xt/$0,kt=-Ct/l1[g],zt=[0,Rt,0,kt,0,0,rt,at,0];if(b.z>0){const Ut=180/_e;At(zt,zt,[Ut/xt+1,0,0,0,Ut/Ct+1,0,-.5*Ut/Rt,.5*Ut/kt,1])}return zt[2]=ft,zt[5]=b.x,zt[8]=b.y,zt},c.dJ=kp,c.dK=function(b,o,g){const _e=$t(new Float64Array(16)),rt=(o/(1<<b)-.5)*Math.PI*2;return nr(_e,g.globeMatrix,rt),Float32Array.from(_e)},c.dL=fC,c.dM=Wp,c.dN=function(b,o){return[Math.pow(b[0],2.2)*o,Math.pow(b[1],2.2)*o,Math.pow(b[2],2.2)*o]},c.dO=Tt,c.dP=function(b,o){var g=Math.sin(o),_e=Math.cos(o);return b[0]=_e,b[1]=g,b[2]=0,b[3]=-g,b[4]=_e,b[5]=0,b[6]=0,b[7]=0,b[8]=1,b},c.dQ=Ss,c.dR=eC,c.dS=po,c.dT=Cl,c.dU=256,c.dV=function(b,o){const g=[0,0,0];return _s(g,g,sE(kp(o.canonical))),_s(g,g,b),g},c.dW=b=>({u_matrix:new Vy(b),u_texsize:new Hp(b),u_pixels_to_tile_units:new S_(b),u_device_pixel_ratio:new ru(b),u_width_scale:new ru(b),u_floor_width_scale:new ru(b),u_image:new w_(b),u_units_to_pixels:new Hp(b),u_tile_units_to_pixels:new ru(b),u_alpha_discard_threshold:new ru(b),u_trim_offset:new Hp(b),u_trim_fade_range:new Hp(b),u_trim_color:new E_(b),u_zbias_factor:new ru(b),u_tile_to_meter:new ru(b),u_ground_shadow_factor:new By(b),u_pattern_transition:new ru(b)}),c.dX=b=>({u_matrix:new Vy(b),u_pixels_to_tile_units:new S_(b),u_device_pixel_ratio:new ru(b),u_width_scale:new ru(b),u_floor_width_scale:new ru(b),u_units_to_pixels:new Hp(b),u_dash_image:new w_(b),u_gradient_image:new w_(b),u_image_height:new ru(b),u_texsize:new Hp(b),u_tile_units_to_pixels:new ru(b),u_alpha_discard_threshold:new ru(b),u_trim_offset:new Hp(b),u_trim_fade_range:new Hp(b),u_trim_color:new E_(b),u_zbias_factor:new ru(b),u_tile_to_meter:new ru(b),u_ground_shadow_factor:new By(b)}),c.dY=b=>({u_camera_to_center_distance:new ru(b),u_extrude_scale:new S_(b),u_device_pixel_ratio:new ru(b),u_matrix:new Vy(b),u_inv_rot_matrix:new Vy(b),u_merc_center:new Hp(b),u_tile_id:new By(b),u_zoom_transition:new ru(b),u_up_dir:new By(b),u_emissive_strength:new ru(b)}),c.dZ=p_,c.d_=$I,c.da=ur,c.db=function(b){return[Math.pow(b[0],1/2.2),Math.pow(b[1],1/2.2),Math.pow(b[2],1/2.2)]},c.dc=_2,c.dd=cS,c.de=T2,c.df=NS,c.dg=function(b,o){return b.readFields(VM,{icons:[]},o)},c.dh=mE,c.di=F_,c.dj=ES,c.dk=fx,c.dl=Dy,c.dm=v0,c.dn=gx,c.dp=mn,c.dq=function(b){const o=b.indexOf(u0);return o>=0?b.slice(0,o):b},c.dr=function(b){return b.indexOf(u0)>=0},c.ds=function(b){const o=b.lastIndexOf(u0);return o>=0?b.slice(o+1):""},c.dt=function(b){const o=[],g=b.id;return g===void 0&&o.push({message:`layers.${g}: missing required property "id"`}),b.render===void 0&&o.push({message:`layers.${g}: missing required method "render"`}),b.renderingMode&&b.renderingMode!=="2d"&&b.renderingMode!=="3d"&&o.push({message:`layers.${g}: property "renderingMode" must be either "2d" or "3d"`}),o},c.du=function(b,o,g,_e){return b.type==="custom"?new NM(b,o):new BM[b.type](b,o,g,_e)},c.dv=Rn,c.dw=function(b){const o=b.indexOf(u0);return o>=0?b.slice(o+1):""},c.dx=class extends Jy{constructor(b,o){super(b._vectorTileFeature,b._z,b._x,b._y,b.id),b.state&&(this.state=Object.assign({},b.state)),this.target=o.target,this.namespace=o.namespace,o.properties&&(this.properties=o.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=b.source,this.sourceLayer=b.sourceLayer,this.layer=b.layer)}toJSON(){const b=super.toJSON();return b.target=this.target,b.namespace=this.namespace,b}},c.dy=e_,c.dz=Qm,c.e=eo,c.e$=Ar,c.e0=iC,c.e1=(b,o,g,_e,rt,ot)=>{const at=b.transform,ut=at.projection.name==="globe";let ft;if(ot.paint.get("circle-pitch-alignment")==="map")if(ut){const Ct=eC(at.zoom,o.canonical)*at._pixelsPerMercatorPixel;ft=Float32Array.from([Ct,0,0,Ct])}else ft=at.calculatePixelsToTileUnitsMatrix(g);else ft=new Float32Array([at.pixelsToGLUnits[0],0,0,at.pixelsToGLUnits[1]]);const xt={u_camera_to_center_distance:b.transform.getCameraToCenterDistance(at.projection),u_matrix:b.translatePosMatrix(o.projMatrix,g,ot.paint.get("circle-translate"),ot.paint.get("circle-translate-anchor")),u_device_pixel_ratio:hu.devicePixelRatio,u_extrude_scale:ft,u_inv_rot_matrix:sP,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:ot.paint.get("circle-emissive-strength")};if(ut){xt.u_inv_rot_matrix=_e,xt.u_merc_center=rt,xt.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],xt.u_zoom_transition=q0(at.zoom);const Ct=rt[0]*jn,Rt=rt[1]*jn;xt.u_up_dir=at.projection.upVector(new Fo(0,0,0),Ct,Rt)}return xt},c.e2=z2,c.e3=ju,c.e4=(b,o,g,_e,rt,ot,at,ut,ft,xt)=>{const Ct=b.transform,Rt=Ct.pitch<15?O2(.07,.7,tr((14-Ct.zoom)/5,0,1)):.07,kt=g.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:B2(b,o,g,_e),u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:Ct.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:rt,u_width_scale:ot,u_floor_width_scale:at,u_image:0,u_tile_units_to_pixels:F2(o,Ct),u_units_to_pixels:[1/Ct.pixelsToGLUnits[0],1/Ct.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:ut,u_trim_fade_range:g.paint.get("line-trim-fade-range"),u_trim_color:g.paint.get("line-trim-color").toPremultipliedRenderColor(kt?null:g.lut).toArray01(),u_zbias_factor:Rt,u_tile_to_meter:ir(o.tileID.canonical,0),u_ground_shadow_factor:ft,u_pattern_transition:xt}},c.e5=(b,o,g,_e,rt,ot,at,ut,ft,xt)=>{const Ct=b.transform,Rt=Ct.calculatePixelsToTileUnitsMatrix(o),kt=g.paint.get("line-trim-color-use-theme").constantOr("default")==="none",zt=Ct.pitch<15?O2(.07,.7,tr((14-Ct.zoom)/5,0,1)):.07;return{u_matrix:B2(b,o,g,_e),u_pixels_to_tile_units:Rt,u_device_pixel_ratio:ot,u_width_scale:at,u_floor_width_scale:ut,u_units_to_pixels:[1/Ct.pixelsToGLUnits[0],1/Ct.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:rt,u_texsize:V2(g)&&o.lineAtlasTexture?o.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:F2(o,b.transform),u_alpha_discard_threshold:0,u_trim_offset:ft,u_trim_fade_range:g.paint.get("line-trim-fade-range"),u_trim_color:g.paint.get("line-trim-color").toPremultipliedRenderColor(kt?null:g.lut).toArray01(),u_zbias_factor:zt,u_tile_to_meter:ir(o.tileID.canonical,0),u_ground_shadow_factor:xt}},c.e6=Yr,c.e7=u1,c.e8=Gt,c.e9=vp,c.eA=function(b,o){var g=2*Math.acos(o[3]),_e=Math.sin(g/2);return _e>ct?(b[0]=o[0]/_e,b[1]=o[1]/_e,b[2]=o[2]/_e):(b[0]=1,b[1]=0,b[2]=0),g},c.eB=OS,c.eC=wE,c.eD=bE,c.eE=[1,1,1],c.eF=U_,c.eG=Pl,c.eH=function(b,o,g,_e){var rt=o[0],ot=o[1],at=o[2],ut=o[3];return b[0]=rt+_e*(g[0]-rt),b[1]=ot+_e*(g[1]-ot),b[2]=at+_e*(g[2]-at),b[3]=ut+_e*(g[3]-ut),b},c.eI=D_,c.eJ=rp,c.eK=Gp,c.eL=function(b,o,g,_e,rt,ot,at,ut,ft,xt,Ct,Rt,kt,zt,Ut,Kt){var er=new dt(16);return er[0]=b,er[1]=o,er[2]=g,er[3]=_e,er[4]=rt,er[5]=ot,er[6]=at,er[7]=ut,er[8]=ft,er[9]=xt,er[10]=Ct,er[11]=Rt,er[12]=kt,er[13]=zt,er[14]=Ut,er[15]=Kt,er},c.eM=it,c.eN=V0,c.eO=Qv,c.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new _n(1/0,1/0),max:new _n(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(b,o=!1){const g=NC(new _n(0,0),new _n(jn,jn),b),_e=[];if(o&&!$T(g,this._globalClipBounds))return _e;for(const rt of this._activeRegions){if(rt.hiddenByOverlap||!$T(g,rt))continue;const ot=NP(rt.min,rt.max,b);_e.push({min:ot.min,max:ot.max,sourceId:this._sourceIds[rt.priority],footprint:rt.footprint,footprintTileId:rt.tileId,order:rt.order,clipMask:rt.clipMask,clipScope:rt.clipScope})}return _e}setSources(b){this._setSources(b.map(o=>({getSourceId:()=>o.cache.id,getFootprints:()=>{const g=[];for(const _e of o.cache.getVisibleCoordinates()){const rt=o.cache.getTile(_e).buckets[o.layer];rt&&rt.updateFootprints(_e.toUnwrapped(),g)}return g},getOrder:()=>o.order,getClipMask:()=>o.clipMask,getClipScope:()=>o.clipScope})))}_addSource(b){const o=b.getFootprints();if(o.length===0)return;const g=b.getOrder(),_e=b.getClipMask(),rt=b.getClipScope();for(const ot of o){if(!ot.footprint)continue;const at=NC(ot.footprint.min,ot.footprint.max,ot.id);this._activeRegions.push({min:at.min,max:at.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:ot.id,footprint:ot.footprint,order:g,clipMask:_e,clipScope:rt})}this._sourceIds.push(b.getSourceId())}_computeReplacement(){this._activeRegions.sort((o,g)=>o.priority-g.priority||uE(o.min,g.min)||uE(o.max,g.max)||o.order-g.order||o.clipMask-g.clipMask||function(_e,rt){const ot=(at,ut)=>at+ut;return _e.length-rt.length||_e.reduce(ot,"").localeCompare(rt.reduce(ot,""))}(o.clipScope,g.clipScope));let b=this._activeRegions.length!==this._prevRegions.length;if(!b){let o=0;for(;!b&&o!==this._activeRegions.length;){const g=this._activeRegions[o],_e=this._prevRegions[o];b=g.priority!==_e.priority||!DC(g,_e)||g.order!==_e.order||g.clipMask!==_e.clipMask||!Su(g.clipScope,_e.clipScope),this._activeRegions[o].hiddenByOverlap=_e.hiddenByOverlap,++o}}if(b){++this._updateTime;for(const g of this._activeRegions)g.order!==g1&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,g.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,g.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,g.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,g.max.y));const o=g=>{const _e=this._activeRegions;if(g>=_e.length)return g;const rt=_e[g].priority;for(;g<_e.length&&_e[g].priority===rt;)++g;return g};if(this._sourceIds.length>1){let g=0,_e=o(g);for(;g!==_e;){let rt=g;const ot=g;for(;rt!==_e;){const at=this._activeRegions[rt];at.hiddenByOverlap=!1;for(let ut=0;ut<ot;ut++){const ft=this._activeRegions[ut];if(!ft.hiddenByOverlap&&at.order===g1&&$T(at,ft)&&(at.hiddenByOverlap=LC(at.footprint,at.tileId,ft.footprint,ft.tileId),at.hiddenByOverlap))break}++rt}g=_e,_e=o(g)}}}}_setSources(b){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let o=b.length-1;o>=0;o--)this._addSource(b[o]);this._computeReplacement()}},c.eQ=g1,c.eR=class{constructor(b){this._createGrid(b),this._createPoles(b)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const b of this._poleSegments)b.destroy();for(const b of this._gridSegments)b.withSkirts.destroy(),b.withoutSkirts.destroy()}_fillGridMeshWithLods(b,o){const g=new jm,_e=new tu,rt=[],ot=b+1+2,at=o[0]+1,ut=o[0]+1+(1+o.length),ft=(xt,Ct,Rt)=>{let kt=xt===ot-1?xt-2:xt===0?xt:xt-1;return kt+=Rt?24575:0,[kt,Ct]};for(let xt=0;xt<ot;++xt)g.emplaceBack(...ft(xt,0,!0));for(let xt=0;xt<at;++xt)for(let Ct=0;Ct<ot;++Ct)g.emplaceBack(...ft(Ct,xt,(Ct===0||Ct===ot-1)&&!0));for(let xt=0;xt<o.length;++xt){const Ct=o[xt];for(let Rt=0;Rt<ot;++Rt)g.emplaceBack(...ft(Rt,Ct,!0))}for(let xt=0;xt<o.length;++xt){const Ct=_e.length,Rt=o[xt]+1+2,kt=new tu;for(let Kt=0;Kt<Rt-1;Kt++){const er=Kt===Rt-2,Jt=er?ot*(ut-o.length+xt-Kt):ot;for(let or=0;or<ot-1;or++){const cr=Kt*ot+or;Kt===0||er||or===0||or===ot-2?(kt.emplaceBack(cr+1,cr,cr+Jt),kt.emplaceBack(cr+Jt,cr+Jt+1,cr+1)):(_e.emplaceBack(cr+1,cr,cr+Jt),_e.emplaceBack(cr+Jt,cr+Jt+1,cr+1))}}const zt=_l.simpleSegment(0,Ct,g.length,_e.length-Ct);for(let Kt=0;Kt<kt.uint16.length;Kt+=3)_e.emplaceBack(kt.uint16[Kt],kt.uint16[Kt+1],kt.uint16[Kt+2]);const Ut=_l.simpleSegment(0,Ct,g.length,_e.length-Ct);rt.push({withoutSkirts:zt,withSkirts:Ut})}return{vertices:g,indices:_e,segments:rt}}_createGrid(b){const o=this._fillGridMeshWithLods($0,l1);this._gridSegments=o.segments,this._gridBuffer=b.createVertexBuffer(o.vertices,H0.members),this._gridIndexBuffer=b.createIndexBuffer(o.indices,!0)}_createPoles(b){const o=new tu;for(let at=0;at<=$0;at++)o.emplaceBack(0,at+1,at+2);this._poleIndexBuffer=b.createIndexBuffer(o,!0);const g=new d0,_e=new d0,rt=new d0,ot=new d0;this._poleSegments=[];for(let at=0,ut=0;at<gp;at++){const ft=360/(1<<at);g.emplaceBack(0,-Ru,0,.5,0),_e.emplaceBack(0,-Ru,0,.5,1),rt.emplaceBack(0,-Ru,0,.5,.5),ot.emplaceBack(0,-Ru,0,.5,.5);for(let xt=0;xt<=$0;xt++){let Ct=xt/$0,Rt=0;const kt=Cs(0,ft,Ct),[zt,Ut,Kt]=p0(nP,iP,kt,Ru);g.emplaceBack(zt,Ut,Kt,Ct,Rt),_e.emplaceBack(zt,Ut,Kt,Ct,1-Rt);const er=Xs(kt);Ct=.5+.5*Math.sin(er),Rt=.5+.5*Math.cos(er),rt.emplaceBack(zt,Ut,Kt,Ct,Rt),ot.emplaceBack(zt,Ut,Kt,Ct,1-Rt)}this._poleSegments.push(_l.simpleSegment(ut,0,66,64)),ut+=66}this._poleNorthVertexBuffer=b.createVertexBuffer(g,Ip,!1),this._poleSouthVertexBuffer=b.createVertexBuffer(_e,Ip,!1),this._texturedPoleNorthVertexBuffer=b.createVertexBuffer(rt,Ip,!1),this._texturedPoleSouthVertexBuffer=b.createVertexBuffer(ot,Ip,!1)}getGridBuffers(b,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[b].withSkirts:this._gridSegments[b].withoutSkirts]}getPoleBuffers(b,o){return[o?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,o?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[b]]}},c.eS=kC,c.eT=oy,c.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},c.eV=Wr,c.eW=sr,c.eX=function(b,o,g){return b[0]=o[0]/g[0],b[1]=o[1]/g[1],b[2]=o[2]/g[2],b},c.eY=cu,c.eZ=G0,c.e_=ss,c.ea=pE,c.eb=YC,c.ec=m0,c.ed=VC,c.ee=zC,c.ef=Zt,c.eg=function(b,o){if(b===o){var g=o[1],_e=o[2],rt=o[3],ot=o[6],at=o[7],ut=o[11];b[1]=o[4],b[2]=o[8],b[3]=o[12],b[4]=g,b[6]=o[9],b[7]=o[13],b[8]=_e,b[9]=ot,b[11]=o[14],b[12]=rt,b[13]=at,b[14]=ut}else b[0]=o[0],b[1]=o[4],b[2]=o[8],b[3]=o[12],b[4]=o[1],b[5]=o[5],b[6]=o[9],b[7]=o[13],b[8]=o[2],b[9]=o[6],b[10]=o[10],b[11]=o[14],b[12]=o[3],b[13]=o[7],b[14]=o[11],b[15]=o[15];return b},c.eh=DM,c.ei=Ys,c.ej=e1,c.ek=256,c.el=MT,c.em=tp,c.en=nr,c.eo=function(b,o){return b[0]=o[0],b[1]=o[1],b[2]=o[2],b[3]=o[4],b[4]=o[5],b[5]=o[6],b[6]=o[8],b[7]=o[9],b[8]=o[10],b},c.ep=d0,c.eq=Tw,c.er=Yv,c.es=function(b,o,g,_e,rt){return tr((b-o)/(g-o)*(rt-_e)+_e,_e,rt)},c.et=os,c.eu=function(b,o){var g=o[0],_e=o[1],rt=o[2],ot=o[3],at=o[4],ut=o[5],ft=o[6],xt=o[7],Ct=o[8],Rt=Ct*at-ut*xt,kt=-Ct*ot+ut*ft,zt=xt*ot-at*ft,Ut=g*Rt+_e*kt+rt*zt;return Ut?(b[0]=Rt*(Ut=1/Ut),b[1]=(-Ct*_e+rt*xt)*Ut,b[2]=(ut*_e-rt*at)*Ut,b[3]=kt*Ut,b[4]=(Ct*g-rt*ft)*Ut,b[5]=(-ut*g+rt*ot)*Ut,b[6]=zt*Ut,b[7]=(-xt*g+_e*ft)*Ut,b[8]=(at*g-_e*ot)*Ut,b):null},c.ev=2,c.ew=Mn,c.ex=Yn,c.ey=sn,c.ez=function(b,o){var g=new dt(3);sn(g,o);var _e=1/g[0],rt=1/g[1],ot=1/g[2],at=o[0]*_e,ut=o[1]*rt,ft=o[2]*ot,xt=o[4]*_e,Ct=o[5]*rt,Rt=o[6]*ot,kt=o[8]*_e,zt=o[9]*rt,Ut=o[10]*ot,Kt=at+Ct+Ut,er=0;return Kt>0?(er=2*Math.sqrt(Kt+1),b[3]=.25*er,b[0]=(Rt-zt)/er,b[1]=(kt-ft)/er,b[2]=(ut-xt)/er):at>Ct&&at>Ut?(er=2*Math.sqrt(1+at-Ct-Ut),b[3]=(Rt-zt)/er,b[0]=.25*er,b[1]=(ut+xt)/er,b[2]=(kt+ft)/er):Ct>Ut?(er=2*Math.sqrt(1+Ct-at-Ut),b[3]=(kt-ft)/er,b[0]=(ut+xt)/er,b[1]=.25*er,b[2]=(Rt+zt)/er):(er=2*Math.sqrt(1+Ut-at-Ct),b[3]=(ut-xt)/er,b[0]=(kt+ft)/er,b[1]=(Rt+zt)/er,b[2]=.25*er),b},c.f=function(b){return btoa(encodeURIComponent(b).replace(/%([0-9A-F]{2})/g,(o,g)=>String.fromCharCode(+("0x"+g))))},c.f0=function([b,o,g]){const _e=Math.hypot(b,o,g),rt=Math.atan2(b,g),ot=.5*Math.PI-Math.acos(-o/_e);return new $(Mu(rt),Mu(ot))},c.f1=Ul,c.f2=iS,c.f3=function(b){const o=b.navigator?b.navigator.userAgent:null;return!!function(g){if(Xl==null){const _e=g.navigator?g.navigator.userAgent:null;Xl=!!g.safari||!(!_e||!(/\b(iPad|iPhone|iPod)\b/.test(_e)||_e.match("Safari")&&!_e.match("Chrome")))}return Xl}(b)&&!(!o||!(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},c.f4=function(b,o){lx=b,ux=o},c.f5=NT,c.f6=rC,c.f7=function(b){const o=[0,0,0],g=$t(new Float64Array(16));return Bt(g,b.pixelMatrix,b.globeMatrix),_s(o,o,g),new _n(o[0],o[1])},c.f8=function(){const b=w1;b&&(b.isPreloaded()&&b.numActive()===1?(b.release(XT),w1=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.f9=function(){mE().acquire(XT)},c.fA=KE,c.fB=zr,c.fC=function(b){let o=0;if(new Uint32Array(b,0,1)[0]!==f2){const g=new Uint32Array(b,0,7),[,,_e,rt,ot,at]=g;o=g.byteLength+rt+ot+at+ot,(_e!==b.byteLength||o>=b.byteLength)&&Wn("Invalid b3dm header information.")}return x2(b,o)},c.fD=function(b,o){const g=cS(b);for(const _e of g){for(const rt of _e.meshes)hI(rt);_e.lights&&(_e.lightMeshIndex=_e.meshes.length,_e.meshes.push(dI(_e.lights,o)))}return g},c.fE=UE,c.fF=lo,c.fG=c2,c.fH=im,c.fI=Zu,c.fJ=function(b){Ep(),Np!=null&&Np.then(o=>{o.keys().then(g=>{for(let _e=0;_e<g.length-b;_e++)o.delete(g[_e]).catch(rt=>Wn(rt.message))}).catch(g=>Wn(g.message))}).catch(o=>Wn(o.message))},c.fa=Ny,c.fb=function(b,o,g=!1){if(Fu===Zu.deferred||Fu===Zu.loading||Fu===Zu.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");rm=hu.resolveURL(b),Fu=Zu.deferred,Vv=o,Jx(),g||jw()},c.fc=function(b){I_=hu.resolveURL(b),k_||(k_=new P_(mE(),new Jm)),k_.broadcast("setMeshoptUrl",I_)},c.fd=d2,c.fe=function(b){QT=hu.resolveURL(b),k_||(k_=new P_(mE(),new Jm)),k_.broadcast("setDracoUrl",QT)},c.ff=h2,c.fg=b1,c.fh=function(b){const o=wp();if(!o)return;const g=o.delete(ax);b&&g.then(()=>b()).catch(b)},c.fi=Ky,c.fj=Jn,c.fk=K0,c.fl=mm,c.fm=kR,c.fn=MR,c.fo=D2,c.fp=an,c.fq="hd_road_elevation",c.fr=To,c.fs=Zr,c.ft=f0,c.fu=wS,c.fv=Yy,c.fw=function(b,o,g,_e,rt,ot,at,ut=1,ft,xt,Ct){b.createArrays(),b.tilePixelRatio=jn/(512*b.overscaling),b.compareText={},b.iconsNeedLinear=!1;const Rt=b.layers[0].layout,kt=b.layers[0]._unevaluatedLayout._values,zt={};zt.scaleFactor=ut,zt.textSizeScaleRange=Rt.get("text-size-scale-range"),zt.iconSizeScaleRange=Rt.get("icon-size-scale-range");const[Ut,Kt]=zt.textSizeScaleRange,[er,Jt]=zt.iconSizeScaleRange;zt.textScaleFactor=tr(zt.scaleFactor,Ut,Kt),zt.iconScaleFactor=tr(zt.scaleFactor,er,Jt);const or=kt["text-size"],cr=kt["icon-size"];if(b.textSizeData.kind==="composite"){const{minZoom:Or,maxZoom:nn}=b.textSizeData;zt.compositeTextSizes=[or.possiblyEvaluate(new Xo(Or,{worldview:Ct}),ot),or.possiblyEvaluate(new Xo(nn,{worldview:Ct}),ot)]}if(b.iconSizeData.kind==="composite"){const{minZoom:Or,maxZoom:nn}=b.iconSizeData;zt.compositeIconSizes=[cr.possiblyEvaluate(new Xo(Or,{worldview:Ct}),ot),cr.possiblyEvaluate(new Xo(nn,{worldview:Ct}),ot)]}zt.layoutTextSize=or.possiblyEvaluate(new Xo(at+1,{worldview:Ct}),ot),zt.layoutIconSize=cr.possiblyEvaluate(new Xo(at+1,{worldview:Ct}),ot),zt.textMaxSize=or.possiblyEvaluate(new Xo(18,{worldview:Ct}),ot);const pr=Rt.get("symbol-placement"),Sr=Rt.get("text-rotation-alignment")==="map"&&pr!=="point",br=Rt.get("text-size");let Pr=!1;const Dr=[];for(const Or of b.features){const nn=Rt.get("text-font").evaluate(Or,{},ot).join(","),$r=br.evaluate(Or,{},ot)*zt.textScaleFactor,un=zt.layoutTextSize.evaluate(Or,{},ot)*zt.textScaleFactor,gn=zt.layoutIconSize.evaluate(Or,{},ot)*zt.iconScaleFactor,yn={horizontal:{},vertical:void 0},Sn=Or.text;let An,wn=[0,0];if(Sn){const Os=Sn.toString(),No=Rt.get("text-letter-spacing").evaluate(Or,{},ot)*pu,wr=Rt.get("text-line-height").evaluate(Or,{},ot)*pu,Cr=Bv(Os)?No:0,hn=Rt.get("text-anchor").evaluate(Or,{},ot),Cn=Rt.get("text-variable-anchor");if(!Cn){const Ls=Rt.get("text-radial-offset").evaluate(Or,{},ot);if(Ls)wn=mA(hn,[Ls*pu,SS]);else{const $s=Rt.get("text-offset").evaluate(Or,{},ot);wn=[$s[0]*pu,$s[1]*pu]}}let Vn=Sr?"center":Rt.get("text-justify").evaluate(Or,{},ot);const Un=pr==="point",cs=Un?Rt.get("text-max-width").evaluate(Or,{},ot)*pu:1/0,ps=Ls=>{b.allowVerticalPlacement&&My(Os)&&(yn.vertical=yS(Sn,o,g,rt,nn,cs,wr,hn,Ls,Cr,wn,ap.vertical,!0,un,$r,ft))};if(!Sr&&Cn){const Ls=Vn==="auto"?Cn.map(Ws=>CS(Ws)):[Vn];let $s=!1;for(let Ws=0;Ws<Ls.length;Ws++){const Qs=Ls[Ws];if(!yn.horizontal[Qs])if($s)yn.horizontal[Qs]=yn.horizontal[0];else{const Es=yS(Sn,o,g,rt,nn,cs,wr,"center",Qs,Cr,wn,ap.horizontal,!1,un,$r,ft);Es&&(yn.horizontal[Qs]=Es,$s=Es.positionedLines.length===1)}}ps("left")}else{if(Vn==="auto"&&(Vn=CS(hn)),Un||Rt.get("text-writing-mode").indexOf("horizontal")>=0||!My(Os)){const Ls=yS(Sn,o,g,rt,nn,cs,wr,hn,Vn,Cr,wn,ap.horizontal,!1,un,$r,ft);Ls&&(yn.horizontal[Vn]=Ls)}ps(Un?"left":Vn)}}let En,ln,on,Tn,On,kn,ls=!1;const Gn=Rt.get("icon-text-fit").evaluate(Or,{},ot);if(Or.icon&&Or.icon.hasPrimary()){const Os=M1(Or.icon,b.iconSizeData,kt["icon-size"],ot,b.zoom,Or,ft,zt.iconScaleFactor,Ct);En=Os.iconPrimary,on=Os.iconSecondary;const No=En.toString();if(ln=_e.get(No),ln&&(On=Rt.get("icon-offset").evaluate(Or,{},ot),kn=Rt.get("icon-anchor").evaluate(Or,{},ot),An=AE(rt.get(No),on?rt.get(on.toString()):void 0,On,kn),ls=ln.sdf,b.sdfIcons===void 0?b.sdfIcons=ln.sdf:b.sdfIcons!==ln.sdf&&Wn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ln.pixelRatio!==b.pixelRatio||Rt.get("icon-rotate").constantOr(1)!==0)&&(b.iconsNeedLinear=!0)),on){const wr=on.toString();Tn=_e.get(wr)}}Pr=Pr||!(!Or.icon||!Or.icon.hasSecondary());const Kn=ME(yn.horizontal)||yn.vertical;b.iconsInText||(b.iconsInText=!!Kn&&Kn.iconsInText);const ts=un*zt.textScaleFactor/pu,{defaultShapedIcon:qs,verticallyShapedIcon:Dn}=_M(b,An,Rt,Or,ot,yn,ts,On,Gn);Gn!=="none"&&An&&(eA(An)||tA(An))&&(kE(0,ln,En,An,qs,Gn,xt,_e,rt),kE(0,Tn,on,An,qs,Gn,xt,_e,rt),Dn&&(kE(0,ln,En,An,Dn,Gn,xt,_e,rt),kE(0,Tn,on,An,Dn,Gn,xt,_e,rt))),An=qs;const{iconBBox:rs,iconVerticalBBox:Ms,textBBox:ro,textVerticalBBox:so}=fM(b,An,Dn,Rt,Or,ot,gn,On,zt,rt,kn,yn,un,wn);Dr.push({feature:Or,shapedTextOrientations:yn,shapedText:Kn,shapedIcon:An,iconPrimary:En,iconSecondary:on,iconOffset:On,iconAnchor:kn,verticallyShapedIcon:Dn,layoutTextSize:un,layoutIconSize:gn,textOffset:wn,isSDFIcon:ls,iconTextFit:Gn,iconCollisionBounds:rs,iconVerticalCollisionBounds:Ms,textCollisionBounds:ro,textVerticalCollisionBounds:so})}return{featureData:Dr,sizes:zt,hasAnySecondaryIcon:Pr,textAlongLine:Sr,symbolPlacement:pr}},c.fx=cA,c.fy=function(b,o,g,_e,rt,ot,at,ut,ft,xt){b.iconAtlasPositions=xt.iconPositions;const{featureData:Ct,hasAnySecondaryIcon:Rt,sizes:kt,textAlongLine:zt,symbolPlacement:Ut}=o;for(const Kt of Ct){const{shapedIcon:er,verticallyShapedIcon:Jt,feature:or,shapedTextOrientations:cr,shapedText:pr,layoutTextSize:Sr,textOffset:br,isSDFIcon:Pr,iconPrimary:Dr,iconSecondary:Or,iconTextFit:nn,iconOffset:$r,iconCollisionBounds:un,iconVerticalCollisionBounds:gn,textCollisionBounds:yn}=Kt;yA(er,xt.iconPositions,Dr,Or),yA(Jt,xt.iconPositions,Dr,Or),xM(cr,xt.iconPositions),yM(Dr,Or,xt.iconPositions),(pr||er)&&vM(b,or,cr,er,Jt,ft,kt,Sr,0,br,Pr,_e,rt,at,ut,Rt,nn,$r,zt,Ut,un,gn,yn)}g&&b.generateCollisionDebugBuffers(ot,b.collisionBoxArray,kt.textScaleFactor)},c.fz=Kr,c.g=function(b,o){return Qm(Object.assign(b,{method:"GET"}),o)},c.h=function(b){return b.indexOf("mapbox:")===0},c.i=function(b){return eo.API_STYLE_REGEX.test(b)&&!wu(b)},c.j=Ol,c.k=Lp,c.l=function(b){return decodeURIComponent(atob(b).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join(""))},c.m=function(b,o){return Qm(Object.assign(b,{type:"json"}),o)},c.n=mx,c.o=hu,c.p=function(b,o){return Qm(Object.assign(b,{method:"POST"}),o)},c.q=ku,c.r=Dp,c.s=function(b){try{const o=self[b];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch{return!1}},c.t=function(){return ZT||(ZT=new Ky("ImageRasterizer")),ZT},c.u=function(){return function b(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,b)}()},c.v=function(b){return!!b&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(b)},c.w=Wn,c.x=$S,c.y=dy,c.z=jp}),et(["./shared"],function(c){function ct(Wr){const tr=Wr?Wr.url.toString():void 0;return tr?performance.getEntriesByName(tr):[]}function dt(Wr){if(typeof Wr=="number"||typeof Wr=="boolean"||typeof Wr=="string"||Wr==null)return JSON.stringify(Wr);if(Array.isArray(Wr)){let lr="[";for(const _r of Wr)lr+=`${dt(_r)},`;return`${lr}]`}let tr="{";for(const lr of Object.keys(Wr).sort())tr+=`${lr}:${dt(Wr[lr])},`;return`${tr}}`}function gt(Wr){let tr="";for(const lr of c.bx)tr+=`/${dt(Wr[lr])}`;return tr}class Tt{constructor(tr){this.keyCache={},this._layers={},this._layerConfigs={},tr&&this.replace(tr)}replace(tr,lr){this._layerConfigs={},this._layers={},this.update(tr,[],lr)}update(tr,lr,_r){this._options=_r;for(const Mr of tr)this._layerConfigs[Mr.id]=Mr,(this._layers[Mr.id]=c.du(Mr,this.scope,null,this._options)).compileFilter(_r),this.keyCache[Mr.id]&&delete this.keyCache[Mr.id];for(const Mr of lr)delete this.keyCache[Mr],delete this._layerConfigs[Mr],delete this._layers[Mr];this.familiesBySource={};const Nr=function(Mr,Vr){const Yr={};for(let Zr=0;Zr<Mr.length;Zr++){const Rn=Mr[Zr];let mn=Vr&&Vr[Rn.id];mn||(Rn.type==="symbol"?mn=Rn.id:(mn=gt(Rn),Rn.type==="line"&&Rn.paint&&function fs(Wn){return typeof Wn=="string"&&Wn==="line-progress"||(Array.isArray(Wn)?Wn.some(fs):!(!Wn||typeof Wn!="object")&&Object.values(Wn).some(fs))}(Rn.paint["line-width"])&&(mn+=`/${dt(Rn.paint["line-width"])}`))),Vr&&(Vr[Rn.id]=mn);let Zn=Yr[mn];Zn||(Zn=Yr[mn]=[]),Zn.push(Rn)}const Gr=[];for(const Zr in Yr)Gr.push(Yr[Zr]);return Gr}(Object.values(this._layerConfigs),this.keyCache);for(const Mr of Nr){const Vr=Mr.map(Zn=>this._layers[Zn.id]),Yr=Vr[0];if(Yr.visibility==="none")continue;const Gr=Yr.source||"";let Zr=this.familiesBySource[Gr];Zr||(Zr=this.familiesBySource[Gr]={});const Rn=Yr.sourceLayer||"_geojsonTileLayer";let mn=Zr[Rn];mn||(mn=Zr[Rn]=[]),mn.push(Vr)}}}const Et=1*c.fl;class At{constructor(tr){const lr={},_r=[];for(const Yr in tr){const Gr=tr[Yr],Zr=lr[Yr]={};for(const Rn in Gr.glyphs){const mn=Gr.glyphs[+Rn];if(!mn||mn.bitmap.width===0||mn.bitmap.height===0)continue;const Zn=mn.metrics.localGlyph?Et:1,fs={x:0,y:0,w:mn.bitmap.width+2*Zn,h:mn.bitmap.height+2*Zn};_r.push(fs),Zr[Rn]=fs}}const{w:Nr,h:Mr}=c.G(_r),Vr=new c.fk({width:Nr||1,height:Mr||1});for(const Yr in tr){const Gr=tr[Yr];for(const Zr in Gr.glyphs){const Rn=Gr.glyphs[+Zr];if(!Rn||Rn.bitmap.width===0||Rn.bitmap.height===0)continue;const mn=lr[Yr][Zr],Zn=Rn.metrics.localGlyph?Et:1;c.fk.copy(Rn.bitmap,Vr,{x:0,y:0},{x:mn.x+Zn,y:mn.y+Zn},Rn.bitmap)}}this.image=Vr,this.positions=lr}}function Mt(Wr,tr,lr){Wr[tr]?lr&&(Wr[tr].center=lr):Wr[tr]={floorIds:new Set,center:lr||[0,0],floors:{}}}function Pt(Wr,tr,lr,_r){for(const Nr of tr)Mt(Wr,Nr),Wr[Nr].floors[lr]=_r,Wr[Nr].floorIds.add(lr)}function $t(Wr){return{id:Wr.properties.id.toString(),center:Wr.properties.center.toString().split(";").map(Number)}}function Lt(Wr){return{id:Wr.properties.id.toString(),isDefault:!!Wr.properties.is_default&&Wr.properties.is_default,connections:Wr.properties.connected_floor_ids?new Set(Wr.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Wr.properties.conflicted_floor_ids?new Set(Wr.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Wr.properties.building_ids?new Set(Wr.properties.building_ids.toString().split(";")):new Set,name:Wr.properties.name.toString(),zIndex:Wr.properties.z_index}}function Bt(Wr,tr){return tr.every(lr=>Wr.properties&&Wr.properties[lr]!=null)}function Nt(Wr){return Bt(Wr,["type","id","name"])&&Wr.properties.type==="building"}function Vt(Wr){return Bt(Wr,["type","id","name","z_index"])&&Wr.properties.type==="floor"}c.fj(At,"GlyphAtlas");class Xt{constructor(tr){this.tileID=new c.aQ(tr.tileID.overscaledZ,tr.tileID.wrap,tr.tileID.canonical.z,tr.tileID.canonical.x,tr.tileID.canonical.y),this.tileZoom=tr.tileZoom,this.uid=tr.uid,this.zoom=tr.zoom,this.lut=tr.lut,this.canonical=tr.tileID.canonical,this.pixelRatio=tr.pixelRatio,this.tileSize=tr.tileSize,this.source=tr.source,this.scope=tr.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=tr.showCollisionBoxes,this.collectResourceTiming=!!tr.request&&tr.request.collectResourceTiming,this.promoteId=tr.promoteId,this.isSymbolTile=tr.isSymbolTile,this.tileTransform=c.aZ(tr.tileID.canonical,tr.projection),this.projection=tr.projection,this.worldview=tr.worldview,this.localizableLayerIds=tr.localizableLayerIds,this.brightness=tr.brightness,this.extraShadowCaster=!!tr.extraShadowCaster,this.tessellationStep=tr.tessellationStep,this.scaleFactor=tr.scaleFactor,this.worldview=tr.worldview,this.indoor=tr.indoor}parse(tr,lr,_r,Nr,Mr,Vr){this.status="parsing",this.data=tr,this.collisionBoxArray=new c.b3;const Yr=new c.fm(Object.keys(tr.layers).sort()),Gr=new c.fn(this.tileID,this.promoteId);Gr.bucketLayerIDs=[];const Zr={},Rn=new c.fo(256,256),mn={featureIndex:Gr,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Rn,availableImages:_r,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const zs=this.indoor.indoorState.activeFloorsVisible,Fs=function(js,lo,Ml){const Xl=function(Sl,po){if(!Sl)return c.w("No source layers defined in indoor specification"),po;if(Sl.size===0)return po;const Cl=Sl.difference(po);for(const Vo of Cl)c.w(`Missing source layer required in indoor specification: ${Vo}`);return po.intersection(po)}(lo.sourceLayers,new Set(Object.keys(js.layers))),Ll=lo.indoorState,eu=function(Sl,po,Cl,Vo){const eo=new Set,Ol=new Set,wu=new Set,Cu=new Map,Uu={},Km=mu=>{const _h=Cu.get(mu)||new Set;for(const Du of eo)if((Cu.get(Du)||new Set).has(mu)||_h.has(Du))return!0;return!1};for(const mu of po){const _h=Sl.layers[mu];if(_h)for(let Du=0;Du<_h.length;Du++){const Dp=_h.feature(Du);if(Nt(Dp)){const{id:hu,center:Xm}=$t(Dp);Mt(Uu,hu,Xm),eo.add(hu)}else if(Vt(Dp)){const{id:hu,isDefault:Xm,connections:v0,conflicts:ax,buildings:lx,name:ux,zIndex:ay}=Lt(Dp);Pt(Uu,lx,hu,{name:ux,zIndex:ay}),Cu.set(hu,ax),(hu===Vo||v0.has(Vo))&&eo.add(hu),Ol.add(hu),Xm&&wu.add(hu)}}else c.w(`indoor source layer not found: ${mu}`)}if(Cl)for(const mu of Cl)Ol.has(mu)&&(Km(mu)||eo.add(mu));for(const mu of wu)eo.has(mu)||Km(mu)||eo.add(mu);return{buildings:Uu,activeFloors:eo}}(js,Xl,Ll.lastActiveFloors,Ll.selectedFloorId);return Ml.send("setIndoorData",eu),eu}(tr,this.indoor,Mr);mn.activeFloors=zs?Fs.activeFloors:void 0}const Zn=[],fs=lr.familiesBySource[this.source];for(const zs in fs){const Fs=tr.layers[zs];if(!Fs)continue;let js=!1,lo=!1,Ml=!1;for(const po of fs[zs])po[0].type==="symbol"?js=!0:lo=!0,po[0].is3D()&&po[0].type!=="model"&&(Ml=!0);if(this.extraShadowCaster&&!Ml||this.isSymbolTile===!0&&!js||this.isSymbolTile===!1&&!lo)continue;Fs.version===1&&c.w(`Vector tile source "${this.source}" layer "${zs}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Xl=Yr.encode(zs),Ll=[],eu=this.localizableLayerIds&&this.localizableLayerIds.has(zs);let Sl=!1;for(let po=0,Cl=0;po<Fs.length;po++){const Vo=Fs.feature(po),eo=Gr.getId(Vo,zs),Ol=Vo.properties?Vo.properties.worldview:null;if(eu&&this.worldview&&typeof Ol=="string")if(Ol==="all")Vo.properties.$localized=!0;else{if(!Ol.split(",").includes(this.worldview))continue;Vo.properties.$localized=!0,Vo.properties.worldview=this.worldview}!Sl&&Vo.properties&&Vo.properties.hasOwnProperty(c.fp)&&(Sl=!0),Ll.push({feature:Vo,id:eo,index:Cl,sourceLayerIndex:Xl}),Cl++}Sl&&!mn.elevationFeatures&&tr.layers.hasOwnProperty(c.fq)&&(mn.elevationFeatures=c.fr.parseFrom(tr.layers[c.fq],this.canonical));for(const po of fs[zs]){const Cl=po[0];if(this.extraShadowCaster&&(!Cl.is3D()||Cl.type==="model")||this.isSymbolTile!==void 0&&Cl.type==="symbol"!==this.isSymbolTile||Cl.minzoom&&this.zoom<Math.floor(Cl.minzoom)||Cl.maxzoom&&this.zoom>=Cl.maxzoom||Cl.visibility==="none")continue;nr(po,this.zoom,mn.brightness,_r,this.worldview);const Vo=Zr[Cl.id]=Cl.createBucket({index:Gr.bucketLayerIDs.length,layers:po,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Xl,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Nr,worldview:this.worldview,localizable:eu});Gr.bucketLayerIDs.push(po.map(Ol=>c.B(Ol.id,Ol.scope)));let eo=Vo.prepare?Vo.prepare():null;eo!=null?(eo=eo.then(()=>Vo.populate(Ll,mn,this.tileID.canonical,this.tileTransform)),Zn.push(eo)):Vo.populate(Ll,mn,this.tileID.canonical,this.tileTransform)}}const Wn=()=>{let zs,Fs,js,lo,Ml,Xl;Rn.trim();const Ll={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},eu=()=>{if(zs)return this.status="done",Vr(zs);if(this.extraShadowCaster)this.status="done",Vr(null,{buckets:Object.values(Zr).filter(po=>!po.isEmpty()),featureIndex:Gr,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:mn.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Fs&&js&&lo){const po=new At(Fs),Cl=new Map;for(const[Ol,wu]of js.entries()){const{imagePosition:Cu}=c.fu(Ol,wu,c.fv);Cl.set(Ol,Cu)}const Vo={};for(const Ol in Zr){const wu=Zr[Ol];wu instanceof c.b4&&(nr(wu.layers,this.zoom,mn.brightness,_r,this.worldview),Vo[Ol]=c.fw(wu,Fs,po.positions,js,Cl,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Ml,this.worldview))}const eo={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Mr,js,Ml,()=>{eo.iconsPending=!1,Sl(Vo,po,eo)}),this.rasterizeIfNeeded(Mr,lo,Xl,()=>{eo.patternsPending=!1,Sl(Vo,po,eo)})}},Sl=(po,Cl,Vo,eo)=>{if(Vo.iconsPending||Vo.patternsPending)return;const Ol=new c.fx(js,lo,this.lut);for(const wu in Zr){const Cu=Zr[wu];if(wu in po)c.fy(Cu,po[wu],this.showCollisionBoxes,_r,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,js,Ol);else if(Cu.hasPattern&&(Cu instanceof c.ba||Cu instanceof c.bb||Cu instanceof c.ea)){nr(Cu.layers,this.zoom,mn.brightness,_r,this.worldview);const Uu=Object.fromEntries(Ol.patternPositions);Cu.addFeatures(mn,this.tileID.canonical,Uu,_r,this.tileTransform,this.brightness)}}this.status="done",Vr(null,{buckets:Object.values(Zr).filter(wu=>!wu.isEmpty()),featureIndex:Gr,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Cl.image,lineAtlas:Rn,imageAtlas:Ol,brightness:mn.brightness})};if(!this.extraShadowCaster){const po=c.fs(mn.glyphDependencies,eo=>Object.keys(eo).map(Number));Object.keys(po).length?Mr.send("getGlyphs",{uid:this.uid,stacks:po},(eo,Ol)=>{zs||(zs=eo,Fs=Ol,eu())},void 0,!1,Ll):Fs={};const Cl=Array.from(mn.iconDependencies.keys()).map(eo=>c.I.parse(eo));Cl.length?Mr.send("getImages",{images:Cl,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(eo,Ol)=>{zs||(zs=eo,js=new Map,Ml=this.updateImageMapAndGetImageTaskQueue(js,Ol,mn.iconDependencies),eu())},void 0,!1,Ll):(js=new Map,Ml=new Map);const Vo=Array.from(mn.patternDependencies.keys()).map(eo=>c.I.parse(eo));Vo.length?Mr.send("getImages",{images:Vo,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(eo,Ol)=>{zs||(zs=eo,lo=new Map,Xl=this.updateImageMapAndGetImageTaskQueue(lo,Ol,mn.patternDependencies),eu())},void 0,!1,Ll):(lo=new Map,Xl=new Map)}if(mn.elevationFeatures&&mn.elevationFeatures.length>0){const po=[];for(const Vo of Object.values(Zr))if(Vo instanceof c.bb){const eo=Vo.getUnevaluatedPortalGraph();eo&&po.push(eo)}const Cl=c.ft.evaluate(po);for(const Vo of Object.values(Zr))if(Vo instanceof c.bb){const eo=tr.layers[Yr.decode(Vo.sourceLayerIndex)];Vo.setEvaluatedPortalGraph(Cl,eo,this.tileID.canonical,mn.availableImages,mn.brightness)}}eu()};Zn.length>0?Promise.allSettled(Zn).then(Wn).catch(Vr):Wn()}updateParameters(tr){this.scaleFactor=tr.scaleFactor,this.showCollisionBoxes=tr.showCollisionBoxes,this.projection=tr.projection,this.brightness=tr.brightness,this.tileTransform=c.aZ(tr.tileID.canonical,tr.projection),this.extraShadowCaster=tr.extraShadowCaster,this.lut=tr.lut,this.worldview=tr.worldview,this.indoor=tr.indoor}rasterizeIfNeeded(tr,lr,_r,Nr){Array.from(lr.values()).some(Mr=>Mr.usvg)?this.rasterize(tr,lr,_r,Nr):Nr()}updateImageMapAndGetImageTaskQueue(tr,lr,_r){const Nr=new Map;for(const Mr of lr.keys()){const Vr=_r.get(Mr)||[];for(const Yr of Vr){const Gr=Yr.toString(),Zr=lr.get(Yr.id.toString());Zr.usvg?Nr.has(Gr)||(Nr.set(Gr,Yr),tr.set(Gr,Object.assign({},Zr))):tr.set(Gr,Zr)}}return Nr}rasterize(tr,lr,_r,Nr){this.rasterizeTask=tr.send("rasterizeImages",{scope:this.scope,tasks:_r},(Mr,Vr)=>{if(!Mr)for(const[Yr,Gr]of Vr.entries()){const Zr=Object.assign(lr.get(Yr),{data:Gr});lr.set(Yr,Zr)}Nr()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function nr(Wr,tr,lr,_r,Nr){const Mr=new c.ac(tr,{brightness:lr,worldview:Nr});for(const Vr of Wr)Vr.recalculate(Mr,_r)}class ar extends c.E{constructor(tr,lr,_r,Nr,Mr,Vr,Yr){super(),this.actor=tr,this.layerIndex=lr,this.availableImages=_r,this.availableModels=Nr,this.loadVectorData=Vr||c.aL,this.loading={},this.loaded={},this.deduped=new c.aK(tr.scheduler),this.isSpriteLoaded=Mr,this.scheduler=tr.scheduler,this.brightness=Yr}loadTile(tr,lr){const _r=tr.uid,Nr=tr&&tr.request,Mr=Nr&&Nr.collectResourceTiming,Vr=this.loading[_r]=new Xt(tr);Vr.abort=this.loadVectorData(tr,(Yr,Gr)=>{const Zr=!this.loading[_r];if(delete this.loading[_r],Vr.cancelRasterize(),Zr||Yr||!Gr)return Vr.status="done",Zr||(this.loaded[_r]=Vr),lr(Yr);const Rn=Gr.rawData,mn={},Zn=c.aM(Gr.responseHeaders);Zn&&Zn.expires&&(mn.expires=Zn.expires),Zn&&Zn.cacheControl&&(mn.cacheControl=Zn.cacheControl),Vr.vectorTile=Gr.vectorTile||new c.fz(new c.bt(Rn));const fs=()=>{Vr.parse(Vr.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Wn,zs)=>{if(Wn||!zs)return lr(Wn);const Fs={};if(Mr){const js=ct(Nr);js.length>0&&(Fs.resourceTiming=JSON.parse(JSON.stringify(js)))}lr(null,Object.assign({rawTileData:Rn.slice(0),responseHeaders:Gr.responseHeaders},zs,mn,Fs))})};this.isSpriteLoaded?fs():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(fs,{type:"parseTile",isSymbolTile:tr.isSymbolTile,zoom:tr.tileZoom}):fs()}),this.loaded=this.loaded||{},this.loaded[_r]=Vr})}reloadTile(tr,lr){const _r=this.loaded,Nr=tr.uid;if(_r&&_r[Nr]){const Mr=_r[Nr];Mr.updateParameters(tr);const Vr=(Yr,Gr)=>{const Zr=Mr.reloadCallback;Zr&&(delete Mr.reloadCallback,Mr.parse(Mr.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Zr)),lr(Yr,Gr)};Mr.status==="parsing"?Mr.reloadCallback=Vr:Mr.status==="done"&&(Mr.vectorTile?Mr.parse(Mr.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Vr):Vr())}else lr(null,void 0)}abortTile(tr,lr){const _r=tr.uid,Nr=this.loading[_r];Nr&&(Nr.abort&&Nr.abort(),delete this.loading[_r]),lr()}removeTile(tr,lr){const _r=this.loaded,Nr=tr.uid;_r&&_r[Nr]&&delete _r[Nr],lr()}}class mr{loadTile(tr,lr){const{uid:_r,encoding:Nr,rawImageData:Mr,padding:Vr}=tr,Yr=ImageBitmap&&Mr instanceof ImageBitmap?this.getImageData(Mr,Vr):Mr;lr(null,new c.fA(_r,Yr,Nr,Vr<1))}reloadTile(tr,lr){lr(null,null)}abortTile(tr,lr){lr()}removeTile(tr,lr){lr()}getImageData(tr,lr){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(tr.width,tr.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=tr.width,this.offscreenCanvas.height=tr.height,this.offscreenCanvasContext.drawImage(tr,0,0,tr.width,tr.height);const _r=this.offscreenCanvasContext.getImageData(-lr,-lr,tr.width+2*lr,tr.height+2*lr);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),_r}}c.bs.setPbf(c.bt);class Fr{constructor(tr){this._mrt=new c.bs(tr.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=tr.uid,this.tileID=tr.tileID,this.source=tr.source}parse(tr,lr){const _r=this._mrt;this.status="parsing",this._entireBuffer=tr;try{_r.parseHeader(tr),this._isHeaderLoaded=!0;const Nr=[];for(const Mr in _r.layers){const Vr=_r.getLayer(Mr),Yr=Vr.getDataRange(Vr.getBandList()),Gr=_r.createDecodingTask(Yr),Zr=tr.slice(Yr.firstByte,Yr.lastByte+1),Rn=c.bs.performDecoding(Zr,Gr).then(mn=>Gr.complete(null,mn)).catch(mn=>Gr.complete(mn,null));Nr.push(Rn)}Promise.allSettled(Nr).then(()=>lr(null,_r)).catch(Mr=>lr(Mr))}catch(Nr){lr(Nr)}}}class sn{constructor(tr){this.actor=tr,this.loading={},this.loaded={}}loadTile(tr,lr){const _r=tr.uid,Nr=tr.request,Mr=this.loading[_r]=new Fr(tr),{cancel:Vr}=c.bu(Nr,(Yr,Gr,Zr)=>{const Rn=!this.loading[_r];if(delete this.loading[_r],Rn||Yr||!Gr)return Mr.status="done",Rn||(this.loaded[_r]=Mr),lr(Yr);Mr.parse(Gr,(mn,Zn)=>{if(mn||!Zn)return lr(mn);lr(null,Zn,Zr)}),this.loaded[_r]=Mr});Mr.abort=Vr}reloadTile(tr,lr){lr(null,void 0)}abortTile(tr,lr){const _r=tr.uid,Nr=this.loading[_r];Nr&&(Nr.abort&&Nr.abort(),delete this.loading[_r]),lr()}removeTile(tr,lr){const _r=tr.uid;this.loaded[_r]&&delete this.loaded[_r],lr()}decodeRasterArray(tr,lr){c.bs.performDecoding(tr.buffer,tr.task).then(_r=>lr(null,_r)).catch(_r=>lr(_r))}}const fn=c.fB.prototype.toGeoJSON;class Lr{constructor(tr){this._feature=tr,this.extent=c.al,this.type=tr.type,this.properties=tr.tags,"id"in tr&&!isNaN(tr.id)&&(this.id=parseInt(tr.id,10))}loadGeometry(){if(this._feature.type===1){const tr=[];for(const lr of this._feature.geometry)tr.push([new c.P(lr[0],lr[1])]);return tr}{const tr=[];for(const lr of this._feature.geometry){const _r=[];for(const Nr of lr)_r.push(new c.P(Nr[0],Nr[1]));tr.push(_r)}return tr}}toGeoJSON(tr,lr,_r){return fn.call(this,tr,lr,_r)}}class Qr{constructor(tr,lr){this.name=tr,this.extent=c.al,this.length=lr.length,this._jsonFeatures=lr}feature(tr){return new Lr(this._jsonFeatures[tr])}}class dn{constructor(tr){this.layers={},this.extent=c.al;for(const lr of Object.keys(tr))this.layers[lr]=new Qr(lr,tr[lr])}}const en=64/4096,yr=128;class Ar{constructor(){this.features=new Map}clear(){this.features.clear()}load(tr=[],lr){for(const _r of tr){const Nr=_r.id;if(Nr==null)continue;let Mr=this.features.get(Nr);Mr&&this.updateCache(Mr,lr),_r.geometry?(Mr=ur(_r),this.updateCache(Mr,lr),this.features.set(Nr,Mr)):this.features.delete(Nr),this.updateCache(Mr,lr)}}updateCache(tr,lr){for(const{canonical:_r,uid:Nr}of Object.values(lr)){const{z:Mr,x:Vr,y:Yr}=_r;rr(tr,Math.pow(2,Mr),Vr,Yr)&&delete lr[Nr]}}getTile(tr,lr,_r){const Nr=Math.pow(2,tr),Mr=[];for(const Vr of this.features.values())rr(Vr,Nr,lr,_r)&&Mr.push(tn(Vr,Nr,lr,_r));return{features:Mr}}getFeatures(){return[...this.features.values()]}}function rr({minX:Wr,minY:tr,maxX:lr,maxY:_r},Nr,Mr,Vr){return Wr<(Mr+1+en)/Nr&&tr<(Vr+1+en)/Nr&&lr>(Mr-en)/Nr&&_r>(Vr-en)/Nr}function ur(Wr){const{id:tr,geometry:lr,properties:_r}=Wr;if(!lr)return;if(lr.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Nr,coordinates:Mr}=lr,Vr={id:tr,type:1,geometry:[],tags:_r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Yr=Vr.geometry;if(Nr==="Point")Br(Mr,Yr,Vr);else if(Nr==="MultiPoint")for(const Gr of Mr)Br(Gr,Yr,Vr);else if(Nr==="LineString")Vr.type=2,xr(Mr,Yr,Vr);else if(Nr==="MultiLineString")Vr.type=2,qr(Mr,Yr,Vr);else if(Nr==="Polygon")Vr.type=3,qr(Mr,Yr,Vr,!0);else{if(Nr!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Vr.type=3;for(const Gr of Mr)qr(Gr,Yr,Vr,!0)}return Vr}function Br([Wr,tr],lr,_r){const Nr=c.aF(Wr);let Mr=c.aJ(tr);Mr=Mr<0?0:Mr>1?1:Mr,lr.push(Nr,Mr),_r.minX=Math.min(_r.minX,Nr),_r.minY=Math.min(_r.minY,Mr),_r.maxX=Math.max(_r.maxX,Nr),_r.maxY=Math.max(_r.maxY,Mr)}function xr(Wr,tr,lr,_r=!1,Nr=!1){const Mr=[];for(const Vr of Wr)Br(Vr,Mr,lr);tr.push(Mr),_r&&function(Vr,Yr){let Gr=0;for(let Zr=0,Rn=Vr.length,mn=Rn-2;Zr<Rn;mn=Zr,Zr+=2)Gr+=(Vr[Zr]-Vr[mn])*(Vr[Zr+1]+Vr[mn+1]);if(Gr>0===Yr)for(let Zr=0,Rn=Vr.length;Zr<Rn/2;Zr+=2){const mn=Vr[Zr],Zn=Vr[Zr+1];Vr[Zr]=Vr[Rn-2-Zr],Vr[Zr+1]=Vr[Rn-1-Zr],Vr[Rn-2-Zr]=mn,Vr[Rn-1-Zr]=Zn}}(Mr,Nr)}function qr(Wr,tr,lr,_r=!1){for(let Nr=0;Nr<Wr.length;Nr++)xr(Wr[Nr],tr,lr,_r,Nr===0)}function tn(Wr,tr,lr,_r){const{id:Nr,type:Mr,geometry:Vr,tags:Yr}=Wr,Gr=[];if(Mr===1)(function(Zr,Rn,mn,Zn,fs){for(let Wn=0;Wn<Zr.length;Wn+=2){const zs=Math.round(c.al*(Zr[Wn+0]*Rn-mn)),Fs=Math.round(c.al*(Zr[Wn+1]*Rn-Zn));fs.push([zs,Fs])}})(Vr,tr,lr,_r,Gr);else if(Mr===2)for(const Zr of Vr)vn(Zr,tr,lr,_r,Gr);else if(Mr===3)for(const Zr of Vr)hs(Zr,tr,lr,_r,Gr);return{id:Nr,type:Mr,geometry:Gr,tags:Yr}}function vn(Wr,tr,lr,_r,Nr){const Mr=-yr,Vr=c.al+yr;let Yr;for(let Gr=0;Gr<Wr.length-2;Gr+=2){let Zr=Math.round(c.al*(Wr[Gr+0]*tr-lr)),Rn=Math.round(c.al*(Wr[Gr+1]*tr-_r)),mn=Math.round(c.al*(Wr[Gr+2]*tr-lr)),Zn=Math.round(c.al*(Wr[Gr+3]*tr-_r));const fs=mn-Zr,Wn=Zn-Rn;Zr<Mr&&mn<Mr||(Zr<Mr?(Rn+=Math.round(Wn*((Mr-Zr)/fs)),Zr=Mr):mn<Mr&&(Zn=Rn+Math.round(Wn*((Mr-Zr)/fs)),mn=Mr),Rn<Mr&&Zn<Mr||(Rn<Mr?(Zr+=Math.round(fs*((Mr-Rn)/Wn)),Rn=Mr):Zn<Mr&&(mn=Zr+Math.round(fs*((Mr-Rn)/Wn)),Zn=Mr),Zr>=Vr&&mn>=Vr||(Zr>=Vr?(Rn+=Math.round(Wn*((Vr-Zr)/fs)),Zr=Vr):mn>=Vr&&(Zn=Rn+Math.round(Wn*((Vr-Zr)/fs)),mn=Vr),Rn>=Vr&&Zn>=Vr||(Rn>=Vr?(Zr+=Math.round(fs*((Vr-Rn)/Wn)),Rn=Vr):Zn>=Vr&&(mn=Zr+Math.round(fs*((Vr-Rn)/Wn)),Zn=Vr),Yr&&Zr===Yr[Yr.length-1][0]&&Rn===Yr[Yr.length-1][1]||(Yr=[[Zr,Rn]],Nr.push(Yr)),Yr.push([mn,Zn])))))}}function hs(Wr,tr,lr,_r,Nr){const Mr=(lr-en)/tr,Vr=(_r-en)/tr,Yr=(lr+1+en)/tr,Gr=(_r+1+en)/tr;function Zr(Zn,fs){let Wn=0;return Zn<Mr?Wn|=1:Zn>Yr&&(Wn|=2),fs<Vr?Wn|=4:fs>Gr&&(Wn|=8),Wn}let Rn=[];for(let Zn=1;Zn<=8;Zn*=2){let fs=Wr[Wr.length-2],Wn=Wr[Wr.length-1],zs=!(Zr(fs,Wn)&Zn);for(let Fs=0;Fs<Wr.length;Fs+=2){const js=Wr[Fs],lo=Wr[Fs+1],Ml=!(Zr(js,lo)&Zn);Ml!==zs&&(8&Zn?Rn.push(fs+(js-fs)*(Gr-Wn)/(lo-Wn),Gr):4&Zn?Rn.push(fs+(js-fs)*(Vr-Wn)/(lo-Wn),Vr):2&Zn?Rn.push(Yr,Wn+(lo-Wn)*(Yr-fs)/(js-fs)):1&Zn&&Rn.push(Mr,Wn+(lo-Wn)*(Mr-fs)/(js-fs))),Ml&&Rn.push(js,lo),fs=js,Wn=lo,zs=Ml}if(!(Wr=Rn).length||Zn===8)break;Rn=[]}const mn=[];for(let Zn=0;Zn<Rn.length;Zn+=2)mn.push([Math.round(c.al*(Rn[Zn]*tr-lr)),Math.round(c.al*(Rn[Zn+1]*tr-_r))]);Nr.push(mn)}function Ts({name:Wr,features:tr},lr){lr.writeStringField(1,Wr),lr.writeVarintField(5,c.al);const _r=new Map,Nr=new Map,Mr={keys:_r,values:Nr,feature:null};for(const Vr of tr)Mr.feature=Vr,lr.writeMessage(2,ss,Mr);for(const Vr of _r.keys())lr.writeStringField(3,Vr);for(const Vr of Nr.keys())lr.writeMessage(4,Hs,Vr)}function ss(Wr,tr){const lr=Wr.feature;lr.id!==void 0&&Number.isSafeInteger(+lr.id)&&tr.writeVarintField(1,+lr.id),lr.tags&&tr.writeMessage(2,Mn,Wr),tr.writeVarintField(3,lr.type),tr.writeMessage(4,ys,lr)}function Mn({keys:Wr,values:tr,feature:lr},_r){for(const Nr of Object.keys(lr.tags)){let Mr=lr.tags[Nr];if(Mr===null)continue;let Vr=Wr.get(Nr);Vr===void 0&&(Vr=Wr.size,Wr.set(Nr,Vr)),_r.writeVarint(Vr);const Yr=typeof Mr;Yr!=="string"&&Yr!=="boolean"&&Yr!=="number"&&(Mr=JSON.stringify(Mr));let Gr=tr.get(Mr);Gr===void 0&&(Gr=tr.size,tr.set(Mr,Gr)),_r.writeVarint(Gr)}}function ds(Wr,tr){return(tr<<3)+(7&Wr)}function gs(Wr){return Wr<<1^Wr>>31}function ys(Wr,tr){const{geometry:lr,type:_r}=Wr;let Nr=0,Mr=0;if(_r===1){tr.writeVarint(ds(1,lr.length));for(const Vr of lr){const Yr=Vr[0]-Nr,Gr=Vr[1]-Mr;tr.writeVarint(gs(Yr)),tr.writeVarint(gs(Gr)),Nr+=Yr,Mr+=Gr}}else for(const Vr of lr){tr.writeVarint(ds(1,1));const Yr=Vr.length-(_r===3?1:0);for(let Gr=0;Gr<Yr;Gr++){Gr===1&&tr.writeVarint(ds(2,Yr-1));const Zr=Vr[Gr][0]-Nr,Rn=Vr[Gr][1]-Mr;tr.writeVarint(gs(Zr)),tr.writeVarint(gs(Rn)),Nr+=Zr,Mr+=Rn}_r===3&&tr.writeVarint(ds(7,1))}}function Hs(Wr,tr){const lr=typeof Wr;lr==="string"?tr.writeStringField(1,Wr):lr==="boolean"?tr.writeBooleanField(7,Wr):lr==="number"&&(Wr%1!=0?tr.writeDoubleField(3,Wr):Wr<0?tr.writeSVarintField(6,Wr):tr.writeVarintField(5,Wr))}const _s={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Wr=>Wr},Ss=Math.fround||(Vl=new Float32Array(1),Wr=>(Vl[0]=+Wr,Vl[0]));var Vl;const ba=3,Qo=5,wo=6;class cu{constructor(tr){this.options=Object.assign(Object.create(_s),tr),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(tr){const{log:lr,minZoom:_r,maxZoom:Nr}=this.options;lr&&console.time("total time");const Mr=`prepare ${tr.length} points`;lr&&console.time(Mr),this.points=tr;const Vr=[];for(let Gr=0;Gr<tr.length;Gr++){const Zr=tr[Gr];if(!Zr.geometry)continue;const[Rn,mn]=Zr.geometry.coordinates,Zn=Ss(Jl(Rn)),fs=Ss(Ul(mn));Vr.push(Zn,fs,1/0,Gr,-1,1),this.options.reduce&&Vr.push(0)}let Yr=this.trees[Nr+1]=this._createTree(Vr);lr&&console.timeEnd(Mr);for(let Gr=Nr;Gr>=_r;Gr--){const Zr=+Date.now();Yr=this.trees[Gr]=this._createTree(this._cluster(Yr,Gr)),lr&&console.log("z%d: %d clusters in %dms",Gr,Yr.numItems,+Date.now()-Zr)}return lr&&console.timeEnd("total time"),this}getClusters(tr,lr){let _r=((tr[0]+180)%360+360)%360-180;const Nr=Math.max(-90,Math.min(90,tr[1]));let Mr=tr[2]===180?180:((tr[2]+180)%360+360)%360-180;const Vr=Math.max(-90,Math.min(90,tr[3]));if(tr[2]-tr[0]>=360)_r=-180,Mr=180;else if(_r>Mr){const mn=this.getClusters([_r,Nr,180,Vr],lr),Zn=this.getClusters([-180,Nr,Mr,Vr],lr);return mn.concat(Zn)}const Yr=this.trees[this._limitZoom(lr)],Gr=Yr.range(Jl(_r),Ul(Vr),Jl(Mr),Ul(Nr)),Zr=Yr.data,Rn=[];for(const mn of Gr){const Zn=this.stride*mn;Rn.push(Zr[Zn+Qo]>1?uu(Zr,Zn,this.clusterProps):this.points[Zr[Zn+ba]])}return Rn}getChildren(tr){const lr=this._getOriginId(tr),_r=this._getOriginZoom(tr),Nr="No cluster with the specified id.",Mr=this.trees[_r];if(!Mr)throw new Error(Nr);const Vr=Mr.data;if(lr*this.stride>=Vr.length)throw new Error(Nr);const Yr=this.options.radius/(this.options.extent*Math.pow(2,_r-1)),Gr=Mr.within(Vr[lr*this.stride],Vr[lr*this.stride+1],Yr),Zr=[];for(const Rn of Gr){const mn=Rn*this.stride;Vr[mn+4]===tr&&Zr.push(Vr[mn+Qo]>1?uu(Vr,mn,this.clusterProps):this.points[Vr[mn+ba]])}if(Zr.length===0)throw new Error(Nr);return Zr}getLeaves(tr,lr,_r){const Nr=[];return this._appendLeaves(Nr,tr,lr=lr||10,_r=_r||0,0),Nr}getTile(tr,lr,_r){const Nr=this.trees[this._limitZoom(tr)],Mr=Math.pow(2,tr),{extent:Vr,radius:Yr}=this.options,Gr=Yr/Vr,Zr=(_r-Gr)/Mr,Rn=(_r+1+Gr)/Mr,mn={features:[]};return this._addTileFeatures(Nr.range((lr-Gr)/Mr,Zr,(lr+1+Gr)/Mr,Rn),Nr.data,lr,_r,Mr,mn),lr===0&&this._addTileFeatures(Nr.range(1-Gr/Mr,Zr,1,Rn),Nr.data,Mr,_r,Mr,mn),lr===Mr-1&&this._addTileFeatures(Nr.range(0,Zr,Gr/Mr,Rn),Nr.data,-1,_r,Mr,mn),mn.features.length?mn:null}getClusterExpansionZoom(tr){let lr=this._getOriginZoom(tr)-1;for(;lr<=this.options.maxZoom;){const _r=this.getChildren(tr);if(lr++,_r.length!==1)break;tr=_r[0].properties.cluster_id}return lr}_appendLeaves(tr,lr,_r,Nr,Mr){const Vr=this.getChildren(lr);for(const Yr of Vr){const Gr=Yr.properties;if(Gr&&Gr.cluster?Mr+Gr.point_count<=Nr?Mr+=Gr.point_count:Mr=this._appendLeaves(tr,Gr.cluster_id,_r,Nr,Mr):Mr<Nr?Mr++:tr.push(Yr),tr.length===_r)break}return Mr}_createTree(tr){const lr=new c.c4(tr.length/this.stride|0,this.options.nodeSize,Float32Array);for(let _r=0;_r<tr.length;_r+=this.stride)lr.add(tr[_r],tr[_r+1]);return lr.finish(),lr.data=tr,lr}_addTileFeatures(tr,lr,_r,Nr,Mr,Vr){for(const Yr of tr){const Gr=Yr*this.stride,Zr=lr[Gr+Qo]>1;let Rn,mn,Zn;if(Zr)Rn=Pl(lr,Gr,this.clusterProps),mn=lr[Gr],Zn=lr[Gr+1];else{const zs=this.points[lr[Gr+ba]];Rn=zs.properties;const[Fs,js]=zs.geometry.coordinates;mn=Jl(Fs),Zn=Ul(js)}const fs={type:1,geometry:[[Math.round(this.options.extent*(mn*Mr-_r)),Math.round(this.options.extent*(Zn*Mr-Nr))]],tags:Rn};let Wn;Wn=Zr||this.options.generateId?lr[Gr+ba]:this.points[lr[Gr+ba]].id,Wn!==void 0&&(fs.id=Wn),Vr.features.push(fs)}}_limitZoom(tr){return Math.max(this.options.minZoom,Math.min(Math.floor(+tr),this.options.maxZoom+1))}_cluster(tr,lr){const{radius:_r,extent:Nr,reduce:Mr,minPoints:Vr}=this.options,Yr=_r/(Nr*Math.pow(2,lr)),Gr=tr.data,Zr=[],Rn=this.stride;for(let mn=0;mn<Gr.length;mn+=Rn){if(Gr[mn+2]<=lr)continue;Gr[mn+2]=lr;const Zn=Gr[mn],fs=Gr[mn+1],Wn=tr.within(Gr[mn],Gr[mn+1],Yr),zs=Gr[mn+Qo];let Fs=zs;for(const js of Wn){const lo=js*Rn;Gr[lo+2]>lr&&(Fs+=Gr[lo+Qo])}if(Fs>zs&&Fs>=Vr){let js,lo=Zn*zs,Ml=fs*zs,Xl=-1;const Ll=(mn/Rn<<5)+(lr+1)+this.points.length;for(const eu of Wn){const Sl=eu*Rn;if(Gr[Sl+2]<=lr)continue;Gr[Sl+2]=lr;const po=Gr[Sl+Qo];lo+=Gr[Sl]*po,Ml+=Gr[Sl+1]*po,Gr[Sl+4]=Ll,Mr&&(js||(js=this._map(Gr,mn,!0),Xl=this.clusterProps.length,this.clusterProps.push(js)),Mr(js,this._map(Gr,Sl)))}Gr[mn+4]=Ll,Zr.push(lo/Fs,Ml/Fs,1/0,Ll,-1,Fs),Mr&&Zr.push(Xl)}else{for(let js=0;js<Rn;js++)Zr.push(Gr[mn+js]);if(Fs>1)for(const js of Wn){const lo=js*Rn;if(!(Gr[lo+2]<=lr)){Gr[lo+2]=lr;for(let Ml=0;Ml<Rn;Ml++)Zr.push(Gr[lo+Ml])}}}}return Zr}_getOriginId(tr){return tr-this.points.length>>5}_getOriginZoom(tr){return(tr-this.points.length)%32}_map(tr,lr,_r){if(tr[lr+Qo]>1){const Vr=this.clusterProps[tr[lr+wo]];return _r?Object.assign({},Vr):Vr}const Nr=this.points[tr[lr+ba]].properties,Mr=this.options.map(Nr);return _r&&Mr===Nr?Object.assign({},Mr):Mr}}function uu(Wr,tr,lr){return{type:"Feature",id:Wr[tr+ba],properties:Pl(Wr,tr,lr),geometry:{type:"Point",coordinates:[(_r=Wr[tr],360*(_r-.5)),xl(Wr[tr+1])]}};var _r}function Pl(Wr,tr,lr){const _r=Wr[tr+Qo],Nr=_r>=1e4?`${Math.round(_r/1e3)}k`:_r>=1e3?Math.round(_r/100)/10+"k":_r,Mr=Wr[tr+wo],Vr=Mr===-1?{}:Object.assign({},lr[Mr]);return Object.assign(Vr,{cluster:!0,cluster_id:Wr[tr+ba],point_count:_r,point_count_abbreviated:Nr})}function Jl(Wr){return Wr/360+.5}function Ul(Wr){const tr=Math.sin(Wr*Math.PI/180),lr=.5-.25*Math.log((1+tr)/(1-tr))/Math.PI;return lr<0?0:lr>1?1:lr}function xl(Wr){const tr=(180-360*Wr)*Math.PI/180;return 360*Math.atan(Math.exp(tr))/Math.PI-90}function Yn(Wr,tr,lr,_r){let Nr=_r;const Mr=tr+(lr-tr>>1);let Vr,Yr=lr-tr;const Gr=Wr[tr],Zr=Wr[tr+1],Rn=Wr[lr],mn=Wr[lr+1];for(let Zn=tr+3;Zn<lr;Zn+=3){const fs=xn(Wr[Zn],Wr[Zn+1],Gr,Zr,Rn,mn);if(fs>Nr)Vr=Zn,Nr=fs;else if(fs===Nr){const Wn=Math.abs(Zn-Mr);Wn<Yr&&(Vr=Zn,Yr=Wn)}}Nr>_r&&(Vr-tr>3&&Yn(Wr,tr,Vr,_r),Wr[Vr+2]=Nr,lr-Vr>3&&Yn(Wr,Vr,lr,_r))}function xn(Wr,tr,lr,_r,Nr,Mr){let Vr=Nr-lr,Yr=Mr-_r;if(Vr!==0||Yr!==0){const Gr=((Wr-lr)*Vr+(tr-_r)*Yr)/(Vr*Vr+Yr*Yr);Gr>1?(lr=Nr,_r=Mr):Gr>0&&(lr+=Vr*Gr,_r+=Yr*Gr)}return Vr=Wr-lr,Yr=tr-_r,Vr*Vr+Yr*Yr}function Qn(Wr,tr,lr,_r){const Nr={id:Wr??null,type:tr,geometry:lr,tags:_r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(tr==="Point"||tr==="MultiPoint"||tr==="LineString")os(Nr,lr);else if(tr==="Polygon")os(Nr,lr[0]);else if(tr==="MultiLineString")for(const Mr of lr)os(Nr,Mr);else if(tr==="MultiPolygon")for(const Mr of lr)os(Nr,Mr[0]);return Nr}function os(Wr,tr){for(let lr=0;lr<tr.length;lr+=3)Wr.minX=Math.min(Wr.minX,tr[lr]),Wr.minY=Math.min(Wr.minY,tr[lr+1]),Wr.maxX=Math.max(Wr.maxX,tr[lr]),Wr.maxY=Math.max(Wr.maxY,tr[lr+1])}function Ks(Wr,tr,lr,_r){if(!tr.geometry)return;const Nr=tr.geometry.coordinates;if(Nr&&Nr.length===0)return;const Mr=tr.geometry.type,Vr=Math.pow(lr.tolerance/((1<<lr.maxZoom)*lr.extent),2);let Yr=[],Gr=tr.id;if(lr.promoteId?Gr=tr.properties[lr.promoteId]:lr.generateId&&(Gr=_r||0),Mr==="Point")oo(Nr,Yr);else if(Mr==="MultiPoint")for(const Zr of Nr)oo(Zr,Yr);else if(Mr==="LineString")qo(Nr,Yr,Vr,!1);else if(Mr==="MultiLineString"){if(lr.lineMetrics){for(const Zr of Nr)Yr=[],qo(Zr,Yr,Vr,!1),Wr.push(Qn(Gr,"LineString",Yr,tr.properties));return}zn(Nr,Yr,Vr,!1)}else if(Mr==="Polygon")zn(Nr,Yr,Vr,!0);else{if(Mr!=="MultiPolygon"){if(Mr==="GeometryCollection"){for(const Zr of tr.geometry.geometries)Ks(Wr,{id:Gr,geometry:Zr,properties:tr.properties},lr,_r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Zr of Nr){const Rn=[];zn(Zr,Rn,Vr,!0),Yr.push(Rn)}}Wr.push(Qn(Gr,Mr,Yr,tr.properties))}function oo(Wr,tr){tr.push(Xn(Wr[0]),xs(Wr[1]),0)}function qo(Wr,tr,lr,_r){let Nr,Mr,Vr=0;for(let Gr=0;Gr<Wr.length;Gr++){const Zr=Xn(Wr[Gr][0]),Rn=xs(Wr[Gr][1]);tr.push(Zr,Rn,0),Gr>0&&(Vr+=_r?(Nr*Rn-Zr*Mr)/2:Math.sqrt(Math.pow(Zr-Nr,2)+Math.pow(Rn-Mr,2))),Nr=Zr,Mr=Rn}const Yr=tr.length-3;tr[2]=1,Yn(tr,0,Yr,lr),tr[Yr+2]=1,tr.size=Math.abs(Vr),tr.start=0,tr.end=tr.size}function zn(Wr,tr,lr,_r){for(let Nr=0;Nr<Wr.length;Nr++){const Mr=[];qo(Wr[Nr],Mr,lr,_r),tr.push(Mr)}}function Xn(Wr){return Wr/360+.5}function xs(Wr){const tr=Math.sin(Wr*Math.PI/180),lr=.5-.25*Math.log((1+tr)/(1-tr))/Math.PI;return lr<0?0:lr>1?1:lr}function As(Wr,tr,lr,_r,Nr,Mr,Vr,Yr){if(_r/=tr,Mr>=(lr/=tr)&&Vr<_r)return Wr;if(Vr<lr||Mr>=_r)return null;const Gr=[];for(const Zr of Wr){const Rn=Zr.geometry;let mn=Zr.type;const Zn=Nr===0?Zr.minX:Zr.minY,fs=Nr===0?Zr.maxX:Zr.maxY;if(Zn>=lr&&fs<_r){Gr.push(Zr);continue}if(fs<lr||Zn>=_r)continue;let Wn=[];if(mn==="Point"||mn==="MultiPoint")ks(Rn,Wn,lr,_r,Nr);else if(mn==="LineString")Eo(Rn,Wn,lr,_r,Nr,!1,Yr.lineMetrics);else if(mn==="MultiLineString")na(Rn,Wn,lr,_r,Nr,!1);else if(mn==="Polygon")na(Rn,Wn,lr,_r,Nr,!0);else if(mn==="MultiPolygon")for(const zs of Rn){const Fs=[];na(zs,Fs,lr,_r,Nr,!0),Fs.length&&Wn.push(Fs)}if(Wn.length){if(Yr.lineMetrics&&mn==="LineString"){for(const zs of Wn)Gr.push(Qn(Zr.id,mn,zs,Zr.tags));continue}mn!=="LineString"&&mn!=="MultiLineString"||(Wn.length===1?(mn="LineString",Wn=Wn[0]):mn="MultiLineString"),mn!=="Point"&&mn!=="MultiPoint"||(mn=Wn.length===3?"Point":"MultiPoint"),Gr.push(Qn(Zr.id,mn,Wn,Zr.tags))}}return Gr.length?Gr:null}function ks(Wr,tr,lr,_r,Nr){for(let Mr=0;Mr<Wr.length;Mr+=3){const Vr=Wr[Mr+Nr];Vr>=lr&&Vr<=_r&&Go(tr,Wr[Mr],Wr[Mr+1],Wr[Mr+2])}}function Eo(Wr,tr,lr,_r,Nr,Mr,Vr){let Yr=Jo(Wr);const Gr=Nr===0?_c:Il;let Zr,Rn,mn=Wr.start;for(let Fs=0;Fs<Wr.length-3;Fs+=3){const js=Wr[Fs],lo=Wr[Fs+1],Ml=Wr[Fs+2],Xl=Wr[Fs+3],Ll=Wr[Fs+4],eu=Nr===0?js:lo,Sl=Nr===0?Xl:Ll;let po=!1;Vr&&(Zr=Math.sqrt(Math.pow(js-Xl,2)+Math.pow(lo-Ll,2))),eu<lr?Sl>lr&&(Rn=Gr(Yr,js,lo,Xl,Ll,lr),Vr&&(Yr.start=mn+Zr*Rn)):eu>_r?Sl<_r&&(Rn=Gr(Yr,js,lo,Xl,Ll,_r),Vr&&(Yr.start=mn+Zr*Rn)):Go(Yr,js,lo,Ml),Sl<lr&&eu>=lr&&(Rn=Gr(Yr,js,lo,Xl,Ll,lr),po=!0),Sl>_r&&eu<=_r&&(Rn=Gr(Yr,js,lo,Xl,Ll,_r),po=!0),!Mr&&po&&(Vr&&(Yr.end=mn+Zr*Rn),tr.push(Yr),Yr=Jo(Wr)),Vr&&(mn+=Zr)}let Zn=Wr.length-3;const fs=Wr[Zn],Wn=Wr[Zn+1],zs=Nr===0?fs:Wn;zs>=lr&&zs<=_r&&Go(Yr,fs,Wn,Wr[Zn+2]),Zn=Yr.length-3,Mr&&Zn>=3&&(Yr[Zn]!==Yr[0]||Yr[Zn+1]!==Yr[1])&&Go(Yr,Yr[0],Yr[1],Yr[2]),Yr.length&&tr.push(Yr)}function Jo(Wr){const tr=[];return tr.size=Wr.size,tr.start=Wr.start,tr.end=Wr.end,tr}function na(Wr,tr,lr,_r,Nr,Mr){for(const Vr of Wr)Eo(Vr,tr,lr,_r,Nr,Mr,!1)}function Go(Wr,tr,lr,_r){Wr.push(tr,lr,_r)}function _c(Wr,tr,lr,_r,Nr,Mr){const Vr=(Mr-tr)/(_r-tr);return Go(Wr,Mr,lr+(Nr-lr)*Vr,1),Vr}function Il(Wr,tr,lr,_r,Nr,Mr){const Vr=(Mr-lr)/(Nr-lr);return Go(Wr,tr+(_r-tr)*Vr,Mr,1),Vr}function Zs(Wr,tr){const lr=[];for(let _r=0;_r<Wr.length;_r++){const Nr=Wr[_r],Mr=Nr.type;let Vr;if(Mr==="Point"||Mr==="MultiPoint"||Mr==="LineString")Vr=$l(Nr.geometry,tr);else if(Mr==="MultiLineString"||Mr==="Polygon"){Vr=[];for(const Yr of Nr.geometry)Vr.push($l(Yr,tr))}else if(Mr==="MultiPolygon"){Vr=[];for(const Yr of Nr.geometry){const Gr=[];for(const Zr of Yr)Gr.push($l(Zr,tr));Vr.push(Gr)}}lr.push(Qn(Nr.id,Mr,Vr,Nr.tags))}return lr}function $l(Wr,tr){const lr=[];lr.size=Wr.size,Wr.start!==void 0&&(lr.start=Wr.start,lr.end=Wr.end);for(let _r=0;_r<Wr.length;_r+=3)lr.push(Wr[_r]+tr,Wr[_r+1],Wr[_r+2]);return lr}function io(Wr,tr){if(Wr.transformed)return Wr;const lr=1<<Wr.z,_r=Wr.x,Nr=Wr.y;for(const Mr of Wr.features){const Vr=Mr.geometry,Yr=Mr.type;if(Mr.geometry=[],Yr===1)for(let Gr=0;Gr<Vr.length;Gr+=2)Mr.geometry.push(zo(Vr[Gr],Vr[Gr+1],tr,lr,_r,Nr));else for(let Gr=0;Gr<Vr.length;Gr++){const Zr=[];for(let Rn=0;Rn<Vr[Gr].length;Rn+=2)Zr.push(zo(Vr[Gr][Rn],Vr[Gr][Rn+1],tr,lr,_r,Nr));Mr.geometry.push(Zr)}}return Wr.transformed=!0,Wr}function zo(Wr,tr,lr,_r,Nr,Mr){return[Math.round(lr*(Wr*_r-Nr)),Math.round(lr*(tr*_r-Mr))]}function Ko(Wr,tr,lr,_r,Nr){const Mr=tr===Nr.maxZoom?0:Nr.tolerance/((1<<tr)*Nr.extent),Vr={features:[],numPoints:0,numSimplified:0,numFeatures:Wr.length,source:null,x:lr,y:_r,z:tr,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Yr of Wr)vu(Vr,Yr,Mr,Nr);return Vr}function vu(Wr,tr,lr,_r){const Nr=tr.geometry,Mr=tr.type,Vr=[];if(Wr.minX=Math.min(Wr.minX,tr.minX),Wr.minY=Math.min(Wr.minY,tr.minY),Wr.maxX=Math.max(Wr.maxX,tr.maxX),Wr.maxY=Math.max(Wr.maxY,tr.maxY),Mr==="Point"||Mr==="MultiPoint")for(let Yr=0;Yr<Nr.length;Yr+=3)Vr.push(Nr[Yr],Nr[Yr+1]),Wr.numPoints++,Wr.numSimplified++;else if(Mr==="LineString")_n(Vr,Nr,Wr,lr,!1,!1);else if(Mr==="MultiLineString"||Mr==="Polygon")for(let Yr=0;Yr<Nr.length;Yr++)_n(Vr,Nr[Yr],Wr,lr,Mr==="Polygon",Yr===0);else if(Mr==="MultiPolygon")for(let Yr=0;Yr<Nr.length;Yr++){const Gr=Nr[Yr];for(let Zr=0;Zr<Gr.length;Zr++)_n(Vr,Gr[Zr],Wr,lr,!0,Zr===0)}if(Vr.length){let Yr=tr.tags||null;if(Mr==="LineString"&&_r.lineMetrics){Yr={};for(const Zr in tr.tags)Yr[Zr]=tr.tags[Zr];Yr.mapbox_clip_start=Nr.start/Nr.size,Yr.mapbox_clip_end=Nr.end/Nr.size}const Gr={geometry:Vr,type:Mr==="Polygon"||Mr==="MultiPolygon"?3:Mr==="LineString"||Mr==="MultiLineString"?2:1,tags:Yr};tr.id!==null&&(Gr.id=tr.id),Wr.features.push(Gr)}}function _n(Wr,tr,lr,_r,Nr,Mr){const Vr=_r*_r;if(_r>0&&tr.size<(Nr?Vr:_r))return void(lr.numPoints+=tr.length/3);const Yr=[];for(let Gr=0;Gr<tr.length;Gr+=3)(_r===0||tr[Gr+2]>Vr)&&(lr.numSimplified++,Yr.push(tr[Gr],tr[Gr+1])),lr.numPoints++;Nr&&function(Gr,Zr){let Rn=0;for(let mn=0,Zn=Gr.length,fs=Zn-2;mn<Zn;fs=mn,mn+=2)Rn+=(Gr[mn]-Gr[fs])*(Gr[mn+1]+Gr[fs+1]);if(Rn>0===Zr)for(let mn=0,Zn=Gr.length;mn<Zn/2;mn+=2){const fs=Gr[mn],Wn=Gr[mn+1];Gr[mn]=Gr[Zn-2-mn],Gr[mn+1]=Gr[Zn-1-mn],Gr[Zn-2-mn]=fs,Gr[Zn-1-mn]=Wn}}(Yr,Mr),Wr.push(Yr)}const Su={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class bp{constructor(tr,lr){const _r=(lr=this.options=function(Mr,Vr){for(const Yr in Vr)Mr[Yr]=Vr[Yr];return Mr}(Object.create(Su),lr)).debug;if(_r&&console.time("preprocess data"),lr.maxZoom<0||lr.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(lr.promoteId&&lr.generateId)throw new Error("promoteId and generateId cannot be used together.");let Nr=function(Mr,Vr){const Yr=[];if(Mr.type==="FeatureCollection")for(let Gr=0;Gr<Mr.features.length;Gr++)Ks(Yr,Mr.features[Gr],Vr,Gr);else Ks(Yr,Mr.type==="Feature"?Mr:{geometry:Mr},Vr);return Yr}(tr,lr);this.tiles={},this.tileCoords=[],_r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",lr.indexMaxZoom,lr.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Nr=function(Mr,Vr){const Yr=Vr.buffer/Vr.extent;let Gr=Mr;const Zr=As(Mr,1,-1-Yr,Yr,0,-1,2,Vr),Rn=As(Mr,1,1-Yr,2+Yr,0,-1,2,Vr);return(Zr||Rn)&&(Gr=As(Mr,1,-Yr,1+Yr,0,-1,2,Vr)||[],Zr&&(Gr=Zs(Zr,1).concat(Gr)),Rn&&(Gr=Gr.concat(Zs(Rn,-1)))),Gr}(Nr,lr),Nr.length&&this.splitTile(Nr,0,0,0),_r&&(Nr.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(tr,lr,_r,Nr,Mr,Vr,Yr){const Gr=[tr,lr,_r,Nr],Zr=this.options,Rn=Zr.debug;for(;Gr.length;){Nr=Gr.pop(),_r=Gr.pop(),lr=Gr.pop(),tr=Gr.pop();const mn=1<<lr,Zn=bu(lr,_r,Nr);let fs=this.tiles[Zn];if(!fs&&(Rn>1&&console.time("creation"),fs=this.tiles[Zn]=Ko(tr,lr,_r,Nr,Zr),this.tileCoords.push({z:lr,x:_r,y:Nr}),Rn)){Rn>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",lr,_r,Nr,fs.numFeatures,fs.numPoints,fs.numSimplified),console.timeEnd("creation"));const po=`z${lr}`;this.stats[po]=(this.stats[po]||0)+1,this.total++}if(fs.source=tr,Mr==null){if(lr===Zr.indexMaxZoom||fs.numPoints<=Zr.indexMaxPoints)continue}else{if(lr===Zr.maxZoom||lr===Mr)continue;if(Mr!=null){const po=Mr-lr;if(_r!==Vr>>po||Nr!==Yr>>po)continue}}if(fs.source=null,tr.length===0)continue;Rn>1&&console.time("clipping");const Wn=.5*Zr.buffer/Zr.extent,zs=.5-Wn,Fs=.5+Wn,js=1+Wn;let lo=null,Ml=null,Xl=null,Ll=null,eu=As(tr,mn,_r-Wn,_r+Fs,0,fs.minX,fs.maxX,Zr),Sl=As(tr,mn,_r+zs,_r+js,0,fs.minX,fs.maxX,Zr);tr=null,eu&&(lo=As(eu,mn,Nr-Wn,Nr+Fs,1,fs.minY,fs.maxY,Zr),Ml=As(eu,mn,Nr+zs,Nr+js,1,fs.minY,fs.maxY,Zr),eu=null),Sl&&(Xl=As(Sl,mn,Nr-Wn,Nr+Fs,1,fs.minY,fs.maxY,Zr),Ll=As(Sl,mn,Nr+zs,Nr+js,1,fs.minY,fs.maxY,Zr),Sl=null),Rn>1&&console.timeEnd("clipping"),Gr.push(lo||[],lr+1,2*_r,2*Nr),Gr.push(Ml||[],lr+1,2*_r,2*Nr+1),Gr.push(Xl||[],lr+1,2*_r+1,2*Nr),Gr.push(Ll||[],lr+1,2*_r+1,2*Nr+1)}}getTile(tr,lr,_r){tr=+tr,lr=+lr,_r=+_r;const Nr=this.options,{extent:Mr,debug:Vr}=Nr;if(tr<0||tr>24)return null;const Yr=1<<tr,Gr=bu(tr,lr=lr+Yr&Yr-1,_r);if(this.tiles[Gr])return io(this.tiles[Gr],Mr);Vr>1&&console.log("drilling down to z%d-%d-%d",tr,lr,_r);let Zr,Rn=tr,mn=lr,Zn=_r;for(;!Zr&&Rn>0;)Rn--,mn>>=1,Zn>>=1,Zr=this.tiles[bu(Rn,mn,Zn)];return Zr&&Zr.source?(Vr>1&&(console.log("found parent tile z%d-%d-%d",Rn,mn,Zn),console.time("drilling down")),this.splitTile(Zr.source,Rn,mn,Zn,tr,lr,_r),Vr>1&&console.timeEnd("drilling down"),this.tiles[Gr]?io(this.tiles[Gr],Mr):null):null}}function bu(Wr,tr,lr){return 32*((1<<Wr)*lr+tr)+Wr}function Xs(Wr,tr){const lr=Wr.tileID.canonical;if(!this._geoJSONIndex)return void tr(null,null);const _r=this._geoJSONIndex.getTile(lr.z,lr.x,lr.y);if(!_r)return void tr(null,null);const Nr=Zr=>Zr.tags&&"3d_elevation_id"in Zr.tags&&"source"in Zr.tags&&Zr.tags.source==="elevation",Mr=_r.features.filter(Zr=>Nr(Zr));let Vr={_geojsonTileLayer:_r.features};Mr.length>0&&(Vr={_geojsonTileLayer:_r.features.filter(Zr=>!Nr(Zr)),hd_road_elevation:Mr});const Yr=new dn(Vr),Gr=function(Zr){const Rn=new c.bt;for(const mn of Object.keys(Zr))Rn.writeMessage(3,Ts,{name:mn,features:Zr[mn]});return Rn.finish()}(Vr).buffer;tr(null,{vectorTile:Yr,rawData:Gr})}class Mu extends ar{constructor(tr,lr,_r,Nr,Mr,Vr,Yr){super(tr,lr,_r,Nr,Mr,Xs,Yr),Vr&&(this.loadGeoJSON=Vr),this._dynamicIndex=new Ar}loadData(tr,lr){const _r=tr&&tr.request,Nr=_r&&_r.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(tr,(Mr,Vr)=>{if(Mr||!Vr)return lr(Mr);if(typeof Vr!="object")return lr(new Error(`Input data given to '${tr.source}' is not a valid GeoJSON object.`));{try{if(tr.filter){const Gr=c.U(tr.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Gr.result==="error")throw new Error(Gr.value.map(Zr=>`${Zr.key}: ${Zr.message}`).join(", "));Vr.features=Vr.features.filter(Zr=>Gr.value.evaluate({zoom:0},Zr))}tr.dynamic?(Vr.type==="Feature"&&(Vr={type:"FeatureCollection",features:[Vr]}),tr.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Vr.features,this.loaded),tr.cluster&&(Vr.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=tr.cluster?new cu(function({superclusterOptions:Gr,clusterProperties:Zr}){if(!Zr||!Gr)return Gr;const Rn={},mn={},Zn={accumulated:null,zoom:0},fs={properties:null},Wn=Object.keys(Zr);for(const zs of Wn){const[Fs,js]=Zr[zs],lo=c.U(js),Ml=c.U(typeof Fs=="string"?[Fs,["accumulated"],["get",zs]]:Fs);Rn[zs]=lo.value,mn[zs]=Ml.value}return Gr.map=zs=>{fs.properties=zs;const Fs={};for(const js of Wn)Fs[js]=Rn[js].evaluate(Zn,fs);return Fs},Gr.reduce=(zs,Fs)=>{fs.properties=Fs;for(const js of Wn)Zn.accumulated=zs[js],zs[js]=mn[js].evaluate(Zn,fs)},Gr}(tr)).load(Vr.features):tr.dynamic?this._dynamicIndex:function(Gr,Zr){return new bp(Gr,Zr)}(Vr,tr.geojsonVtOptions)}catch(Gr){return lr(Gr)}const Yr={};if(Nr){const Gr=ct(_r);Gr&&(Yr.resourceTiming={},Yr.resourceTiming[tr.source]=JSON.parse(JSON.stringify(Gr)))}lr(null,Yr)}})}reloadTile(tr,lr){const _r=this.loaded;return _r&&_r[tr.uid]?tr.partial?lr(null,void 0):super.reloadTile(tr,lr):this.loadTile(tr,lr)}loadGeoJSON(tr,lr){if(tr.request)c.m(tr.request,lr);else{if(typeof tr.data!="string")return lr(new Error(`Input data given to '${tr.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return lr(null,JSON.parse(tr.data))}catch{return lr(new Error(`Input data given to '${tr.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(tr,lr){try{lr(null,this._geoJSONIndex.getClusterExpansionZoom(tr.clusterId))}catch(_r){lr(_r)}}getClusterChildren(tr,lr){try{lr(null,this._geoJSONIndex.getChildren(tr.clusterId))}catch(_r){lr(_r)}}getClusterLeaves(tr,lr){try{lr(null,this._geoJSONIndex.getLeaves(tr.clusterId,tr.limit,tr.offset))}catch(_r){lr(_r)}}}class rv{constructor(tr,lr,_r){this.tileID=new c.aQ(tr.tileID.overscaledZ,tr.tileID.wrap,tr.tileID.canonical.z,tr.tileID.canonical.x,tr.tileID.canonical.y),this.tileZoom=tr.tileZoom,this.uid=tr.uid,this.zoom=tr.zoom,this.canonical=tr.tileID.canonical,this.pixelRatio=tr.pixelRatio,this.tileSize=tr.tileSize,this.source=tr.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=tr.projection,this.brightness=lr,this.worldview=_r}parse(tr,lr,_r,Nr){this.status="parsing";const Mr=new c.aQ(_r.tileID.overscaledZ,_r.tileID.wrap,_r.tileID.canonical.z,_r.tileID.canonical.x,_r.tileID.canonical.y),Vr=[],Yr=lr.familiesBySource[_r.source],Gr=new c.fn(Mr,_r.promoteId);Gr.bucketLayerIDs=[],Gr.is3DTile=!0,c.fC(tr).then(Zr=>{if(!Zr)return Nr(new Error("Could not parse tile"));const Rn=Zr.json.extensionsUsed&&Zr.json.extensionsUsed.includes("MAPBOX_mesh_features")||Zr.json.asset.extras&&Zr.json.asset.extras.MAPBOX_mesh_features,mn=Zr.json.extensionsUsed&&Zr.json.extensionsUsed.includes("EXT_meshopt_compression"),Zn=new c.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const fs in Yr)for(const Wn of Yr[fs]){const zs=Wn[0];Gr.bucketLayerIDs.push(Wn.map(lo=>c.B(lo.id,lo.scope))),zs.recalculate(Zn,[]);const Fs=c.fD(Zr,1/c.d7(_r.tileID.canonical)),js=new c.fE(Wn,Fs,Mr,Rn,mn,this.brightness,Gr,this.worldview);Rn||(js.needsUpload=!0),Vr.push(js),js.evaluate(zs)}this.status="done",Nr(null,{buckets:Vr,featureIndex:Gr,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Zr=>Nr(new Error(Zr.message)))}}class qm{constructor(tr,lr,_r,Nr,Mr,Vr,Yr,Gr){this.actor=tr,this.layerIndex=lr,this.availableImages=_r,this.availableModels=Nr,this.brightness=Yr,this.loading={},this.loaded={},this.worldview=Gr}loadTile(tr,lr){const _r=tr.uid,Nr=this.loading[_r]=new rv(tr,this.brightness,this.worldview);c.bu(tr.request,(Mr,Vr)=>{const Yr=!this.loading[_r];return delete this.loading[_r],Yr||Mr?(Nr.status="done",Yr||(this.loaded[_r]=Nr),lr(Mr)):Vr&&Vr.byteLength!==0?void Nr.parse(Vr,this.layerIndex,tr,(Gr,Zr)=>{Nr.status="done",this.loaded=this.loaded||{},this.loaded[_r]=Nr,Gr||!Zr?lr(Gr):lr(null,Zr)}):(Nr.status="done",this.loaded[_r]=Nr,lr())})}reloadTile(tr,lr){const _r=this.loaded,Nr=tr.uid;if(_r&&_r[Nr]){const Mr=_r[Nr];Mr.projection=tr.projection,Mr.brightness=tr.brightness;const Vr=(Yr,Gr)=>{Mr.reloadCallback&&(delete Mr.reloadCallback,this.loadTile(tr,lr)),lr(Yr,Gr)};Mr.status==="parsing"?Mr.reloadCallback=Vr:Mr.status==="done"&&this.loadTile(tr,lr)}}abortTile(tr,lr){const _r=tr.uid;this.loading[_r]&&delete this.loading[_r],lr()}removeTile(tr,lr){const _r=this.loaded,Nr=tr.uid;_r&&_r[Nr]&&delete _r[Nr],lr()}}class oy{constructor(tr){this.self=tr,this.actor=new c.fG(tr,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new c.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=c.cm({name:"mercator"}),this.workerSourceTypes={vector:ar,geojson:Mu,"raster-dem":mr,"raster-array":sn,"batched-model":qm},this.workerSources={},this.self.registerWorkerSource=(lr,_r)=>{if(this.workerSourceTypes[lr])throw new Error(`Worker source with name "${lr}" already registered.`);this.workerSourceTypes[lr]=_r},this.self.registerRTLTextPlugin=lr=>{if(c.fH.isParsed())throw new Error("RTL text plugin already registered.");c.fH.setState({pluginStatus:c.fI.parsed,pluginURL:c.fH.getPluginURL()}),c.fH.applyArabicShaping=lr.applyArabicShaping,c.fH.processBidirectionalText=lr.processBidirectionalText,c.fH.processStyledBidirectionalText=lr.processStyledBidirectionalText;for(const _r of this.rtlPluginParsingListeners)_r(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(tr,lr,_r){delete this.layerIndexes[tr],delete this.availableImages[tr],delete this.availableModels[tr],delete this.workerSources[tr],_r()}checkIfReady(tr,lr,_r){_r()}setReferrer(tr,lr){this.referrer=lr}spriteLoaded(tr,lr){this.isSpriteLoaded[tr]||(this.isSpriteLoaded[tr]={});const{scope:_r,isLoaded:Nr}=lr;if(this.isSpriteLoaded[tr][_r]=Nr,this.workerSources[tr]&&this.workerSources[tr][_r])for(const Mr in this.workerSources[tr][_r]){const Vr=this.workerSources[tr][_r][Mr];for(const Yr in Vr){const Gr=Vr[Yr];Gr instanceof ar&&(Gr.isSpriteLoaded=Nr,Gr.fire(new c.z("isSpriteLoaded")))}}}setImages(tr,lr,_r){this.availableImages[tr]||(this.availableImages[tr]={});const{scope:Nr,images:Mr}=lr;if(this.availableImages[tr][Nr]=Mr,this.workerSources[tr]&&this.workerSources[tr][Nr]){for(const Vr in this.workerSources[tr][Nr]){const Yr=this.workerSources[tr][Nr][Vr];for(const Gr in Yr)Yr[Gr].availableImages=Mr}_r()}else _r()}setModels(tr,{scope:lr,models:_r},Nr){if(this.availableModels[tr]||(this.availableModels[tr]={}),this.availableModels[tr][lr]=_r,this.workerSources[tr]&&this.workerSources[tr][lr]){for(const Mr in this.workerSources[tr][lr]){const Vr=this.workerSources[tr][lr][Mr];for(const Yr in Vr)Vr[Yr].availableModels=_r}Nr()}else Nr()}setProjection(tr,lr){this.projections[tr]=c.cm(lr)}setBrightness(tr,lr,_r){this.brightness=lr,_r()}setWorldview(tr,lr,_r){this.worldview=lr,_r()}setLayers(tr,lr,_r){this.getLayerIndex(tr,lr.scope).replace(lr.layers,lr.options),_r()}updateLayers(tr,lr,_r){this.getLayerIndex(tr,lr.scope).update(lr.layers,lr.removedIds,lr.options),_r()}loadTile(tr,lr,_r){lr.projection=this.projections[tr]||this.defaultProjection,this.getWorkerSource(tr,lr.type,lr.source,lr.scope).loadTile(lr,_r)}decodeRasterArray(tr,lr,_r){this.getWorkerSource(tr,lr.type,lr.source,lr.scope).decodeRasterArray(lr,_r)}reloadTile(tr,lr,_r){lr.projection=this.projections[tr]||this.defaultProjection,this.getWorkerSource(tr,lr.type,lr.source,lr.scope).reloadTile(lr,_r)}abortTile(tr,lr,_r){this.getWorkerSource(tr,lr.type,lr.source,lr.scope).abortTile(lr,_r)}removeTile(tr,lr,_r){this.getWorkerSource(tr,lr.type,lr.source,lr.scope).removeTile(lr,_r)}removeSource(tr,lr,_r){if(!(this.workerSources[tr]&&this.workerSources[tr][lr.scope]&&this.workerSources[tr][lr.scope][lr.type]&&this.workerSources[tr][lr.scope][lr.type][lr.source]))return;const Nr=this.workerSources[tr][lr.scope][lr.type][lr.source];delete this.workerSources[tr][lr.scope][lr.type][lr.source],Nr.removeSource!==void 0?Nr.removeSource(lr,_r):_r()}loadWorkerSource(tr,lr,_r){try{this.self.importScripts(lr.url),_r()}catch(Nr){_r(Nr)}}syncRTLPluginState(tr,lr,_r){if(c.fH.isParsed())_r(null,!0);else if(c.fH.isParsing())this.rtlPluginParsingListeners.push(_r);else try{c.fH.setState(lr);const Nr=c.fH.getPluginURL();!c.fH.isLoaded()||c.fH.isParsed()||c.fH.isParsing()||Nr==null||(c.fH.setState({pluginStatus:c.fI.parsing,pluginURL:c.fH.getPluginURL()}),this.self.importScripts(Nr),c.fH.isParsed()?_r(null,!0):this.rtlPluginParsingListeners.push(_r))}catch(Nr){_r(Nr)}}setDracoUrl(tr,lr){this.dracoUrl=lr}getAvailableImages(tr,lr){this.availableImages[tr]||(this.availableImages[tr]={});let _r=this.availableImages[tr][lr];return _r||(_r=[]),_r}getAvailableModels(tr,lr){this.availableModels[tr]||(this.availableModels[tr]={});let _r=this.availableModels[tr][lr];return _r||(_r={}),_r}getLayerIndex(tr,lr){this.layerIndexes[tr]||(this.layerIndexes[tr]={});let _r=this.layerIndexes[tr][lr];return _r||(_r=this.layerIndexes[tr][lr]=new Tt,_r.scope=lr),_r}getWorkerSource(tr,lr,_r,Nr){const Mr=this.workerSources;return Mr[tr]||(Mr[tr]={}),Mr[tr][Nr]||(Mr[tr][Nr]={}),Mr[tr][Nr][lr]||(Mr[tr][Nr][lr]={}),this.isSpriteLoaded[tr]||(this.isSpriteLoaded[tr]={}),Mr[tr][Nr][lr][_r]||(Mr[tr][Nr][lr][_r]=new this.workerSourceTypes[lr]({send:(Vr,Yr,Gr,Zr,Rn,mn)=>this.actor.send(Vr,Yr,Gr,tr,Rn,mn),scheduler:this.actor.scheduler},this.getLayerIndex(tr,Nr),this.getAvailableImages(tr,Nr),this.getAvailableModels(tr,Nr),this.isSpriteLoaded[tr][Nr],void 0,this.brightness,this.worldview)),Mr[tr][Nr][lr][_r]}rasterizeImagesWorker(tr,lr,_r){const Nr=new Map;for(const[Mr,{image:Vr,imageVariant:Yr}]of lr.tasks.entries()){const Gr=this.imageRasterizer.rasterize(Yr,Vr,lr.scope,tr);Nr.set(Mr,Gr)}_r(void 0,Nr)}removeRasterizedImages(tr,lr,_r){this.imageRasterizer.removeImagesFromCacheByIds(lr.imageIds,lr.scope,tr),_r()}enforceCacheSizeLimit(tr,lr){c.fJ(lr)}getWorkerPerformanceMetrics(tr,lr,_r){_r(void 0,void 0)}}return c.fF(self)&&(self.worker=new oy(self)),oy}),et(["./shared"],function(c){var ct="3.17.0";const dt={create:"create",load:"load",fullLoad:"fullLoad"},gt={mark(it){performance.mark(it)},measure(it,d,$){performance.measure(it,d,$)}};function Tt(it){const d=it.name.split("?")[0];return c.a(d)&&d.includes("mapbox-gl.js")?"javascript":c.a(d)&&d.includes("mapbox-gl.css")?"css":c.b(d)?"fontRange":c.c(d)?"sprite":c.i(d)?"style":c.d(d)?"tilejson":"other"}var Et,At={},Mt=function(){if(Et)return At;function it(st){return!d(st)}function d(st){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var ht,pt,mt=new Blob([""],{type:"text/javascript"}),St=URL.createObjectURL(mt);try{pt=new Worker(St),ht=!0}catch{ht=!1}return pt&&pt.terminate(),URL.revokeObjectURL(St),ht}()?function(){var ht=document.createElement("canvas");ht.width=ht.height=1;var pt=ht.getContext("2d");if(!pt)return!1;var mt=pt.getImageData(0,0,1,1);return mt&&mt.width===ht.width}()?($[lt=st&&st.failIfMajorPerformanceCaveat]===void 0&&($[lt]=function(ht){var pt,mt=function(St){var It=document.createElement("canvas"),Dt=Object.create(it.webGLContextAttributes);return Dt.failIfMajorPerformanceCaveat=St,It.getContext("webgl2",Dt)}(ht);if(!mt)return!1;try{pt=mt.createShader(mt.VERTEX_SHADER)}catch{return!1}return!(!pt||mt.isContextLost())&&(mt.shaderSource(pt,"void main() {}"),mt.compileShader(pt),mt.getShaderParameter(pt,mt.COMPILE_STATUS)===!0)}(lt)),$[lt]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var lt}Et=1,At.supported=it,At.notSupportedReason=d;var $={};return it.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},At}();function Pt(it,d,$){const st=document.createElement(it);return d!=null&&(st.className=d),$&&$.appendChild(st),st}function $t(it,d,$){const st=document.createElementNS("http://www.w3.org/2000/svg",it);for(const lt of Object.keys(d))st.setAttributeNS(null,lt,String(d[lt]));return $&&$.appendChild(st),st}const Lt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Bt=Lt&&Lt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Nt;function Vt(){Lt&&Bt&&(Nt=Lt[Bt],Lt[Bt]="none")}function Xt(){Lt&&Bt&&(Lt[Bt]=Nt)}function nr(it){it.preventDefault(),it.stopPropagation(),window.removeEventListener("click",nr,!0)}function ar(){window.addEventListener("click",nr,!0),window.setTimeout(()=>{window.removeEventListener("click",nr,!0)},0)}function mr(it,d){const $=it.getBoundingClientRect();return fn(it,$,d)}function Fr(it,d){const $=it.getBoundingClientRect(),st=[];for(let lt=0;lt<d.length;lt++)st.push(fn(it,$,d[lt]));return st}function sn(it){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&it.button===2&&it.ctrlKey?0:it.button}function fn(it,d,$){const st=it.offsetWidth===d.width?1:it.offsetWidth/d.width;return new c.P(($.clientX-d.left)*st,($.clientY-d.top)*st)}const Lr="01",Qr="NO_ACCESS_TOKEN";class dn{constructor(d,$,st){this._transformRequestFn=d,this._customAccessToken=$,this._silenceAuthErrors=!!st,this._createSkuToken()}_createSkuToken(){const d=function(){let $="";for(let st=0;st<10;st++)$+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Lr,$].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=d.token,this._skuTokenExpiresAt=d.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(d,$){return this._transformRequestFn&&this._transformRequestFn(d,$)||{url:d}}normalizeStyleURL(d,$){if(!c.h(d))return d;const st=yr(d);return st.params.push(`sdk=js-${ct}`),st.path=`/styles/v1${st.path}`,this._makeAPIURL(st,this._customAccessToken||$)}normalizeGlyphsURL(d,$){if(!c.h(d))return d;const st=yr(d);return st.path=`/fonts/v1${st.path}`,this._makeAPIURL(st,this._customAccessToken||$)}normalizeModelURL(d,$){if(!c.h(d))return d;const st=yr(d);return st.path=`/models/v1${st.path}`,this._makeAPIURL(st,this._customAccessToken||$)}normalizeSourceURL(d,$,st,lt){if(!c.h(d))return d;const ht=yr(d);return ht.path=`/v4/${ht.authority}.json`,ht.params.push("secure"),st&&ht.params.push(`language=${st}`),lt&&ht.params.push(`worldview=${lt}`),this._makeAPIURL(ht,this._customAccessToken||$)}normalizeIconsetURL(d,$){const st=yr(d);return c.h(d)?(st.path=`/styles/v1${st.path}/iconset.pbf`,this._makeAPIURL(st,this._customAccessToken||$)):Ar(st)}normalizeSpriteURL(d,$,st,lt){const ht=yr(d);return c.h(d)?(ht.path=`/styles/v1${ht.path}/sprite${$}${st}`,this._makeAPIURL(ht,this._customAccessToken||lt)):(ht.path+=`${$}${st}`,Ar(ht))}normalizeTileURL(d,$,st){if(this._isSkuTokenExpired()&&this._createSkuToken(),d&&!c.h(d))return d;const lt=yr(d);lt.path=lt.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${$||st&&lt.authority!=="raster"&&st===512?"@2x":""}${c.k.supported?".webp":"$1"}`),lt.authority==="raster"?lt.path=`/${c.e.RASTER_URL_PREFIX}${lt.path}`:lt.authority==="rasterarrays"?lt.path=`/${c.e.RASTERARRAYS_URL_PREFIX}${lt.path}`:lt.authority==="3dtiles"?lt.path=`/${c.e.TILES3D_URL_PREFIX}${lt.path}`:(lt.path=lt.path.replace(/^.+\/v4\//,"/"),lt.path=`/${c.e.TILE_URL_VERSION}${lt.path}`);const ht=this._customAccessToken||function(pt){for(const mt of pt){const St=mt.match(/^access_token=(.*)$/);if(St)return St[1]}return null}(lt.params)||c.e.ACCESS_TOKEN;return c.e.REQUIRE_ACCESS_TOKEN&&ht&&this._skuToken&&lt.params.push(`sku=${this._skuToken}`),this._makeAPIURL(lt,ht)}canonicalizeTileURL(d,$){const st=yr(d);if(!st.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!st.path.match(/\.[\w]+$/))return d;let lt="mapbox://";st.path.match(/^\/raster\/v1\//)?lt+=`raster/${st.path.replace(`/${c.e.RASTER_URL_PREFIX}/`,"")}`:st.path.match(/^\/rasterarrays\/v1\//)?lt+=`rasterarrays/${st.path.replace(`/${c.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:lt+=`tiles/${st.path.replace(`/${c.e.TILE_URL_VERSION}/`,"")}`;let ht=st.params;return $&&(ht=ht.filter(pt=>!pt.match(/^access_token=/))),ht.length&&(lt+=`?${ht.join("&")}`),lt}canonicalizeTileset(d,$){const st=!!$&&c.h($),lt=[];for(const ht of d.tiles||[])c.j(ht)?lt.push(this.canonicalizeTileURL(ht,st)):lt.push(ht);return lt}_makeAPIURL(d,$){const st="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",lt=yr(c.e.API_URL);if(d.protocol=lt.protocol,d.authority=lt.authority,d.protocol==="http"){const ht=d.params.indexOf("secure");ht>=0&&d.params.splice(ht,1)}if(lt.path!=="/"&&(d.path=`${lt.path}${d.path}`),!c.e.REQUIRE_ACCESS_TOKEN)return Ar(d);if($=$||c.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!$)throw new Error(`An API access token is required to use Mapbox GL. ${st}`);if($[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${st}`)}return d.params=d.params.filter(ht=>ht.indexOf("access_token")===-1),d.params.push(`access_token=${$||""}`),Ar(d)}}const en=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function yr(it){const d=it.match(en);if(!d)throw new Error("Unable to parse URL object");return{protocol:d[1],authority:d[2],path:d[3]||"/",params:d[4]?d[4].split("&"):[]}}function Ar(it){const d=it.params.length?`?${it.params.join("&")}`:"";return`${it.protocol}://${it.authority}${it.path}${d}`}const rr="mapbox.eventData";function ur(it){if(!it)return null;const d=it.split(".");if(!d||d.length!==3)return null;try{return JSON.parse(c.l(d[1]))}catch{return null}}class Br{constructor(d){this.type=d,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(d){const $=ur(c.e.ACCESS_TOKEN);let st="";return st=$&&$.u?c.f($.u):c.e.ACCESS_TOKEN||"",d?`${rr}.${d}:${st}`:`${rr}:${st}`}fetchEventData(){const d=c.s("localStorage"),$=this.getStorageKey(),st=this.getStorageKey("uuid"),lt=this.getStorageKey("uuidTimestamp");if(d)try{const ht=localStorage.getItem($);ht&&(this.eventData=JSON.parse(ht));const pt=localStorage.getItem(st);pt&&(this.anonId=pt);const mt=localStorage.getItem(lt);mt&&(this.anonIdTimestamp=Number(mt));const St=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<St)&&this.refreshUUID()}catch{c.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=c.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const d=c.s("localStorage"),$=this.getStorageKey(),st=this.getStorageKey("uuid"),lt=this.getStorageKey("uuidTimestamp"),ht=this.anonId,pt=this.anonIdTimestamp;if(d&&ht)try{localStorage.setItem(st,ht),Object.keys(this.eventData).length>=1&&localStorage.setItem($,JSON.stringify(this.eventData)),pt&&localStorage.setItem(lt,pt.toString())}catch{c.w("Unable to write to LocalStorage")}}processRequests(d){}postEvent(d,$,st,lt){if(!c.e.EVENTS_URL)return;const ht=yr(c.e.EVENTS_URL);ht.params.push(`access_token=${lt||c.e.ACCESS_TOKEN||""}`);const pt={event:this.type,created:new Date(d).toISOString()},mt=$?Object.assign(pt,$):pt,St={url:Ar(ht),headers:{"Content-Type":"text/plain"},body:JSON.stringify([mt])};this.pendingRequest=c.p(St,It=>{this.pendingRequest=null,st(It),this.saveEventData(),this.processRequests(lt)})}queueRequest(d,$){this.queue.push(d),this.processRequests($)}}class xr extends Br{constructor(d){super("metrics"),d&&(this.data=d)}postMetricsEvent(d){if(!c.e.EVENTS_URL||!d&&!c.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),c.v(this.anonId)||this.refreshUUID();const $=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:$},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:$,payload:st}=this.queue.shift();this.postEvent($,st,()=>{},d)}}const qr=new class extends Br{constructor(it){super("appUserTurnstile"),this._customAccessToken=it}postTurnstileEvent(it,d){c.e.EVENTS_URL&&c.e.ACCESS_TOKEN&&Array.isArray(it)&&it.some($=>c.h($)||c.j($))&&this.queueRequest(Date.now(),d)}processRequests(it){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const d=ur(c.e.ACCESS_TOKEN),$=d?d.u:c.e.ACCESS_TOKEN;let st=$!==this.eventData.tokenU;c.v(this.anonId)||(this.refreshUUID(),st=!0);const lt=this.queue.shift();if(this.eventData.lastSuccess){const ht=new Date(this.eventData.lastSuccess),pt=new Date(lt),mt=(lt-this.eventData.lastSuccess)/864e5;st=st||mt>=1||mt<-1||ht.getDate()!==pt.getDate()}else st=!0;st?this.postEvent(lt,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ct,skuId:Lr,"enabled.telemetry":!1,userId:this.anonId},ht=>{ht||(this.eventData.lastSuccess=lt,this.eventData.tokenU=$)},it):this.processRequests()}},tn=qr.postTurnstileEvent.bind(qr),vn=new class extends Br{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(it,d,$,st){this.skuToken=d,this.errorCb=st,c.e.EVENTS_URL&&($||c.e.ACCESS_TOKEN?this.queueRequest({id:it,timestamp:Date.now()},$):this.errorCb(new Error(Qr)))}processRequests(it){if(this.pendingRequest||this.queue.length===0)return;const{id:d,timestamp:$}=this.queue.shift();d&&this.success[d]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),c.v(this.anonId)||this.refreshUUID(),this.postEvent($,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ct,skuId:Lr,skuToken:this.skuToken,userId:this.anonId},st=>{st?this.errorCb(st):d&&(this.success[d]=!0)},it))}remove(){this.errorCb=null}},hs=vn.postMapLoadEvent.bind(vn),Ts=new class extends Br{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(it){let d=this.mapInstanceIdMap.get(it);return d||(d=c.u(),this.mapInstanceIdMap.set(it,d)),d}getEventId(it){const d=this.eventIdPerMapInstanceMap.get(it)||0;return this.eventIdPerMapInstanceMap.set(it,d+1),d}postStyleLoadEvent(it,d){const{map:$,style:st,importedStyles:lt}=d;if(!c.e.EVENTS_URL||!it&&!c.e.ACCESS_TOKEN)return;const ht=this.getMapInstanceId($),pt={mapInstanceId:ht,eventId:this.getEventId(ht),style:st};lt.length&&(pt.importedStyles=lt),this.queueRequest({timestamp:Date.now(),payload:pt},it)}processRequests(it){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:d,payload:$}=this.queue.shift();this.postEvent(d,$,()=>{},it)}},ss=Ts.postStyleLoadEvent.bind(Ts),Mn=new xr({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),ds=Mn.postMetricsEvent.bind(Mn),gs=new xr({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),ys=gs.postMetricsEvent.bind(gs),Hs=new class extends Br{constructor(){super("gljs.performance")}postPerformanceEvent(it,d){c.e.EVENTS_URL&&(it||c.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:d},it)}processRequests(it){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:d,performanceData:$}=this.queue.shift(),st=function(lt){const ht=performance.getEntriesByType("resource"),pt=performance.getEntriesByType("mark"),mt=function(qt){const Qt={};if(qt){for(const Zt in qt)if(Zt!=="other")for(const sr of qt[Zt]){const ir=`${Zt}ResolveRangeMin`,hr=`${Zt}ResolveRangeMax`,gr=`${Zt}RequestCount`,dr=`${Zt}RequestCachedCount`;Qt[ir]=Math.min(Qt[ir]||1/0,sr.startTime),Qt[hr]=Math.max(Qt[hr]||-1/0,sr.responseEnd);const Ir=Tr=>{Qt[Tr]===void 0&&(Qt[Tr]=0),++Qt[Tr]};sr.transferSize!==void 0&&sr.transferSize===0&&Ir(dr),Ir(gr)}}return Qt}(function(qt,Qt){const Zt={};if(qt)for(const sr of qt){const ir=Qt(sr);Zt[ir]===void 0&&(Zt[ir]=[]),Zt[ir].push(sr)}return Zt}(ht,Tt)),St=window.devicePixelRatio,It=navigator.connection||navigator.mozConnection||navigator.webkitConnection,Dt=It?It.effectiveType:void 0,Ht={counters:[],metadata:[],attributes:[]},Gt=(qt,Qt,Zt)=>{Zt!=null&&qt.push({name:Qt,value:Zt.toString()})};for(const qt in mt)Gt(Ht.counters,qt,mt[qt]);if(lt.interactionRange[0]!==1/0&&lt.interactionRange[1]!==-1/0&&(Gt(Ht.counters,"interactionRangeMin",lt.interactionRange[0]),Gt(Ht.counters,"interactionRangeMax",lt.interactionRange[1])),pt)for(const qt of Object.values(dt)){const Qt=pt.find(Zt=>Zt.name===qt);Qt&&Gt(Ht.counters,qt,Qt.startTime)}return Gt(Ht.counters,"visibilityHidden",lt.visibilityHidden),Gt(Ht.attributes,"style",function(qt){if(qt)for(const Qt of qt){const Zt=Qt.name.split("?")[0];if(c.i(Zt)){const sr=Zt.split("/").slice(-2);if(sr.length===2)return`mapbox://styles/${sr[0]}/${sr[1]}`}}}(ht)),Gt(Ht.attributes,"terrainEnabled",lt.terrainEnabled?"true":"false"),Gt(Ht.attributes,"fogEnabled",lt.fogEnabled?"true":"false"),Gt(Ht.attributes,"projection",lt.projection),Gt(Ht.attributes,"zoom",lt.zoom),Gt(Ht.metadata,"devicePixelRatio",St),Gt(Ht.metadata,"connectionEffectiveType",Dt),Gt(Ht.metadata,"navigatorUserAgent",navigator.userAgent),Gt(Ht.metadata,"screenWidth",window.screen.width),Gt(Ht.metadata,"screenHeight",window.screen.height),Gt(Ht.metadata,"windowWidth",window.innerWidth),Gt(Ht.metadata,"windowHeight",window.innerHeight),Gt(Ht.metadata,"mapWidth",lt.width/St),Gt(Ht.metadata,"mapHeight",lt.height/St),Gt(Ht.metadata,"webglRenderer",lt.renderer),Gt(Ht.metadata,"webglVendor",lt.vendor),Gt(Ht.metadata,"sdkVersion",ct),Gt(Ht.metadata,"sdkIdentifier","mapbox-gl-js"),Ht}($);for(const lt of st.metadata);for(const lt of st.counters);for(const lt of st.attributes);this.postEvent(d,st,()=>{},it)}},_s=Hs.postPerformanceEvent.bind(Hs),Ss=new class extends Br{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(it,d,$,st){if(!c.e.API_URL||!c.e.SESSION_PATH)return;const lt=yr(c.e.API_URL+c.e.SESSION_PATH);lt.params.push(`sku=${d||""}`),lt.params.push(`access_token=${st||c.e.ACCESS_TOKEN||""}`);const ht={url:Ar(lt),headers:{"Content-Type":"text/plain"}};this.pendingRequest=c.g(ht,pt=>{this.pendingRequest=null,$(pt),this.saveEventData(),this.processRequests(st)})}getSessionAPI(it,d,$,st){this.skuToken=d,this.errorCb=st,c.e.SESSION_PATH&&c.e.API_URL&&($||c.e.ACCESS_TOKEN?this.queueRequest({id:it,timestamp:Date.now()},$):this.errorCb(new Error(Qr)))}processRequests(it){if(this.pendingRequest||this.queue.length===0)return;const{id:d,timestamp:$}=this.queue.shift();d&&this.success[d]||this.getSession($,this.skuToken,st=>{st?this.errorCb(st):d&&(this.success[d]=!0)},it)}remove(){this.errorCb=null}},Vl=Ss.getSessionAPI.bind(Ss),ba=new Set;function Qo(it,d){d?ba.add(it):ba.delete(it)}class wo{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(d,$){this._updatedSourceCaches[d]=$,this.setDirty()}discardSourceCacheUpdate(d){delete this._updatedSourceCaches[d]}updateLayer(d){const $=d.scope;this._updatedLayers[$]=this._updatedLayers[$]||new Set,this._updatedLayers[$].add(d.id),this.setDirty()}removeLayer(d){const $=d.scope;this._removedLayers[$]=this._removedLayers[$]||{},this._updatedLayers[$]=this._updatedLayers[$]||new Set,this._removedLayers[$][d.id]=d,this._updatedLayers[$].delete(d.id),this._updatedPaintProps.delete(d.fqid),this.setDirty()}getRemovedLayer(d){return this._removedLayers[d.scope]?this._removedLayers[d.scope][d.id]:null}discardLayerRemoval(d){this._removedLayers[d.scope]&&delete this._removedLayers[d.scope][d.id]}getLayerUpdatesByScope(){const d={};for(const $ in this._updatedLayers)d[$]=d[$]||{},d[$].updatedIds=Array.from(this._updatedLayers[$].values());for(const $ in this._removedLayers)d[$]=d[$]||{},d[$].removedIds=Object.keys(this._removedLayers[$]);return d}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(d){this._updatedPaintProps.add(d.fqid),this.setDirty()}getUpdatedImages(d){return this._updatedImages[d]?Array.from(this._updatedImages[d].values()):[]}updateImage(d,$){this._updatedImages[$]=this._updatedImages[$]||new Set,this._updatedImages[$].add(c.I.toString(d)),this.setDirty()}resetUpdatedImages(d){this._updatedImages[d]&&this._updatedImages[d].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function cu(it){const{userImage:d}=it;return!!(d&&d.render&&d.render())&&(it.data.replace(new Uint8Array(d.data.buffer)),!0)}class uu extends c.E{constructor(d){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=d,d!=="raster"&&c.r()&&(this.imageRasterizerDispatcher=new c.D(c.t(),this,"Image Rasterizer Worker",1))}addScope(d){this.loaded.set(d,!1),this.imageProviders.set(d,new Map),this.images.set(d,new Map),this.updatedImages.set(d,new Set),this.callbackDispatchedThisFrame.set(d,new Set),this.patterns.set(d,new Map),this.atlasImage.set(d,new c.q({width:1,height:1}))}removeScope(d){this.loaded.delete(d),this.imageProviders.delete(d),this.images.delete(d),this.updatedImages.delete(d),this.callbackDispatchedThisFrame.delete(d),this.patterns.delete(d),this.atlasImage.delete(d);const $=this.atlasTexture.get(d);$&&($.destroy(),this.atlasTexture.delete(d))}addImageProvider(d,$){this.imageProviders.has($)||this.imageProviders.set($,new Map),this.imageProviders.get($).set(d.id,d)}removeImageProvider(d,$){this.imageProviders.has($)&&this.imageProviders.get($).delete(d)}getPendingImageProviders(){const d=[];for(const $ of this.imageProviders.values())for(const st of $.values())st.hasPendingRequests()&&d.push(st);return d}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new c.x),this._imageRasterizer}isLoaded(){for(const d of this.loaded.keys())if(!this.loaded.get(d))return!1;return!0}setLoaded(d,$){if(this.loaded.get($)!==d&&(this.loaded.set($,d),d)){for(const{ids:st,callback:lt}of this.requestors)this._notify(st,$,lt);this.requestors=[]}}hasImage(d,$){return!!this.getImage(d,$)}getImage(d,$){return this.images.get($).get(d.toString())}addImage(d,$,st){this._validate(d,st)&&this.images.get($).set(d.toString(),st)}_validate(d,$){let st=!0;return this._validateStretch($.stretchX,$.data&&$.data.width)||(this.fire(new c.y(new Error(`Image "${d.name}" has invalid "stretchX" value`))),st=!1),this._validateStretch($.stretchY,$.data&&$.data.height)||(this.fire(new c.y(new Error(`Image "${d.name}" has invalid "stretchY" value`))),st=!1),this._validateContent($.content,$)||(this.fire(new c.y(new Error(`Image "${d.name}" has invalid "content" value`))),st=!1),st}_validateStretch(d,$){if(!d)return!0;let st=0;for(const lt of d){if(lt[0]<st||lt[1]<lt[0]||$<lt[1])return!1;st=lt[1]}return!0}_validateContent(d,$){return d?d.length!==4||!$.usvg&&(d[0]<0||$.data.width<d[0]||d[1]<0||$.data.height<d[1]||d[2]<0||$.data.width<d[2]||d[3]<0||$.data.height<d[3])?!1:!(d[2]<d[0]||d[3]<d[1]):!0}updateImage(d,$,st){const lt=this.images.get($).get(d.toString());st.version=lt.version+1,this.images.get($).set(d.toString(),st),this.updatedImages.get($).add(d),this.removeFromImageRasterizerCache(d,$)}clearUpdatedImages(d){this.updatedImages.get(d).clear()}removeFromImageRasterizerCache(d,$){this.spriteFormat!=="raster"&&(c.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[d],scope:$}):this.imageRasterizer.removeImagesFromCacheByIds([d],$))}removeImage(d,$){const st=this.images.get($),lt=st.get(d.toString());st.delete(d.toString()),this.patterns.get($).delete(d.toString()),this.removeFromImageRasterizerCache(d,$),lt.userImage&&lt.userImage.onRemove&&lt.userImage.onRemove()}listImages(d){return Array.from(this.images.get(d).keys()).map($=>c.I.from($))}getImages(d,$,st){const lt=[],ht=[],pt=this.imageProviders.get($);for(const Dt of d){if(!Dt.iconsetId){lt.push(Dt);continue}const Ht=pt.get(Dt.iconsetId);Ht&&(this.getImage(Dt,$)?ht.push(Dt):Ht.addPendingRequest(Dt))}if(lt.length===0)return void this._notify(ht,$,st);let mt=!0;const St=!!this.loaded.get($),It=this.images.get($);if(!St)for(const Dt of lt)It.has(Dt.toString())||(mt=!1);St||mt?this._notify(lt,$,st):this.requestors.push({ids:lt,scope:$,callback:st})}rasterizeImages(d,$){const st=new Map,{tasks:lt,scope:ht}=d;for(const[pt,mt]of lt.entries()){const St=this.getImage(mt.id,ht);St&&st.set(pt,{image:St,imageVariant:mt})}this._rasterizeImages(ht,st,$)}_rasterizeImages(d,$,st){if(c.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:$,scope:d},st);else{const lt=new Map;for(const[ht,{image:pt,imageVariant:mt}]of $.entries())lt.set(ht,this.imageRasterizer.rasterize(mt,pt,d,0));st(void 0,lt)}}getUpdatedImages(d){return this.updatedImages.get(d)||new Set}_notify(d,$,st){const lt=this.images.get($),ht=new Map;for(const pt of d){if(!lt.get(pt.toString())){if(pt.iconsetId)continue;this.fire(new c.z("styleimagemissing",{id:pt.name}))}const mt=lt.get(pt.toString());if(!mt){c.w(`Image "${pt.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const St={data:mt.usvg?null:mt.data.clone(),pixelRatio:mt.pixelRatio,sdf:mt.sdf,usvg:mt.usvg,version:mt.version,stretchX:mt.stretchX,stretchY:mt.stretchY,content:mt.content,hasRenderCallback:!!(mt.userImage&&mt.userImage.render)};mt.usvg&&Object.assign(St,{width:mt.icon.usvg_tree.width,height:mt.icon.usvg_tree.height}),ht.set(c.I.toString(pt),St)}st(null,ht)}getPixelSize(d){const{width:$,height:st}=this.atlasImage.get(d);return{width:$,height:st}}getPattern(d,$,st){const lt=d.toString(),ht=this.patterns.get($),pt=ht.get(lt),mt=this.getImage(d,$);if(!mt)return null;if(pt){if(pt.position.version===mt.version)return pt.position;pt.position.version=mt.version}else{if(mt.usvg&&!mt.data){const St=this.getPatternInFlightId(lt,$);if(this.patternsInFlight.has(St))return null;this.patternsInFlight.add(St);const It=new c.A(d).scaleSelf(c.o.devicePixelRatio),Dt=new Map([[It.toString(),{image:mt,imageVariant:It}]]);return this._rasterizeImages($,Dt,(Ht,Gt)=>this.storePatternImage(It,$,mt,st,Gt)),null}this.storePattern(d,$,mt)}return this._updatePatternAtlas($,st),ht.get(lt).position}getPatternInFlightId(d,$){return c.B(d,$)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(d,$,st,lt,ht){const pt=d.toString(),mt=ht?ht.get(pt):void 0;mt&&(st.data=mt,this.storePattern(d.id,$,st),this._updatePatternAtlas($,lt),this.patternsInFlight.delete(this.getPatternInFlightId(d.id.toString(),$)))}storePattern(d,$,st){const lt={w:st.data.width+2*c.C,h:st.data.height+2*c.C,x:0,y:0},ht=new c.F(lt,st,c.C);this.patterns.get($).set(d.toString(),{bin:lt,position:ht})}destroyAtlasTextures(){for(const d of this.atlasTexture.values())d&&d.destroy();this.atlasTexture.clear()}bind(d,$){const st=d.gl;let lt=this.atlasTexture.get($);lt?this.dirty&&(lt.update(this.atlasImage.get($)),this.dirty=!1):(lt=new c.T(d,this.atlasImage.get($),st.RGBA8),this.atlasTexture.set($,lt)),lt.bind(st.LINEAR,st.CLAMP_TO_EDGE)}_updatePatternAtlas(d,$){const st=this.patterns.get(d),lt=Array.from(st.values()).map(({bin:It})=>It),{w:ht,h:pt}=c.G(lt),mt=this.atlasImage.get(d);mt.resize({width:ht||1,height:pt||1});const St=this.images.get(d);for(const[It,{bin:Dt,position:Ht}]of st.entries()){let Gt=Ht.padding;const qt=Dt.x+Gt,Qt=Dt.y+Gt,Zt=St.get(It).data,sr=Zt.width,ir=Zt.height;Gt=Gt>1?Gt-1:Gt,c.q.copy(Zt,mt,{x:0,y:0},{x:qt,y:Qt},{width:sr,height:ir},$),c.q.copy(Zt,mt,{x:0,y:ir-Gt},{x:qt,y:Qt-Gt},{width:sr,height:Gt},$),c.q.copy(Zt,mt,{x:0,y:0},{x:qt,y:Qt+ir},{width:sr,height:Gt},$),c.q.copy(Zt,mt,{x:sr-Gt,y:0},{x:qt-Gt,y:Qt},{width:Gt,height:ir},$),c.q.copy(Zt,mt,{x:0,y:0},{x:qt+sr,y:Qt},{width:Gt,height:ir},$),c.q.copy(Zt,mt,{x:sr-Gt,y:ir-Gt},{x:qt-Gt,y:Qt-Gt},{width:Gt,height:Gt},$),c.q.copy(Zt,mt,{x:0,y:ir-Gt},{x:qt+sr,y:Qt-Gt},{width:Gt,height:Gt},$),c.q.copy(Zt,mt,{x:0,y:0},{x:qt+sr,y:Qt+ir},{width:Gt,height:Gt},$),c.q.copy(Zt,mt,{x:sr-Gt,y:0},{x:qt-Gt,y:Qt+ir},{width:Gt,height:Gt},$)}this.dirty=!0}beginFrame(){for(const d of this.images.keys())this.callbackDispatchedThisFrame.set(d,new Set)}dispatchRenderCallbacks(d,$){const st=this.images.get($);for(const lt of d){if(this.callbackDispatchedThisFrame.get($).has(lt.toString()))continue;this.callbackDispatchedThisFrame.get($).add(lt.toString());const ht=st.get(lt.toString());cu(ht)&&this.updateImage(lt,$,ht)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Pl(it){const d=it.value,$=it.valueSpec,st=it.style,lt=it.styleSpec,ht=it.key,pt=it.arrayElementValidator||Zs;if(!Array.isArray(d))return[new c.V(ht,d,`array expected, ${c.K(d)} found`)];if($.length&&d.length!==$.length)return[new c.V(ht,d,`array length ${$.length} expected, length ${d.length} found`)];if($["min-length"]&&d.length<$["min-length"])return[new c.V(ht,d,`array length at least ${$["min-length"]} expected, length ${d.length} found`)];let mt={type:$.value,values:$.values,minimum:$.minimum,maximum:$.maximum,function:void 0};lt.$version<7&&(mt.function=$.function),c.H($.value)&&(mt=$.value);let St=[];for(let It=0;It<d.length;It++)St=St.concat(pt({array:d,arrayIndex:It,value:d[It],valueSpec:mt,style:st,styleSpec:lt,key:`${ht}[${It}]`},!0));return St}function Jl(it){const d=it.key,$=it.value,st=it.valueSpec;if(!c.L($))return[new c.V(d,$,`number expected, ${c.K($)} found`)];if($!=$)return[new c.V(d,$,"number expected, NaN found")];if("minimum"in st){let lt=st.minimum;if(Array.isArray(st.minimum)&&(lt=st.minimum[it.arrayIndex]),$<lt)return[new c.V(d,$,`${$} is less than the minimum value ${lt}`)]}if("maximum"in st){let lt=st.maximum;if(Array.isArray(st.maximum)&&(lt=st.maximum[it.arrayIndex]),$>lt)return[new c.V(d,$,`${$} is greater than the maximum value ${lt}`)]}return[]}function Ul(it){const d=it.key,$=it.value;if(!c.H($))return[new c.V(d,$,`object expected, ${c.K($)} found`)];const st=it.valueSpec,lt=c.J($.type);let ht,pt,mt,St={};const It=lt!=="categorical"&&$.property===void 0,Dt=!It,Ht=function(Zt){const sr=Zt.stops;return Array.isArray(sr)&&Array.isArray(sr[0])&&c.H(sr[0][0])}($),Gt=$l({key:it.key,value:it.value,valueSpec:it.styleSpec.function,style:it.style,styleSpec:it.styleSpec,objectElementValidators:{stops:function(Zt){if(lt==="identity")return[new c.V(Zt.key,Zt.value,'identity function may not have a "stops" property')];let sr=[];const ir=Zt.value;return sr=sr.concat(Pl({key:Zt.key,value:ir,valueSpec:Zt.valueSpec,style:Zt.style,styleSpec:Zt.styleSpec,arrayElementValidator:qt})),Array.isArray(ir)&&ir.length===0&&sr.push(new c.V(Zt.key,ir,"array must have at least one stop")),sr},default:function(Zt){return Zs({key:Zt.key,value:Zt.value,valueSpec:st,style:Zt.style,styleSpec:Zt.styleSpec})}}});return lt==="identity"&&It&&Gt.push(new c.V(it.key,it.value,'missing required property "property"')),lt==="identity"||$.stops||Gt.push(new c.V(it.key,it.value,'missing required property "stops"')),lt==="exponential"&&st.expression&&!c.M(st)&&Gt.push(new c.V(it.key,it.value,"exponential functions not supported")),it.styleSpec.$version>=8&&(Dt&&!c.N(st)?Gt.push(new c.V(it.key,it.value,"property functions not supported")):It&&!c.O(st)&&Gt.push(new c.V(it.key,it.value,"zoom functions not supported"))),lt!=="categorical"&&!Ht||$.property!==void 0||Gt.push(new c.V(it.key,it.value,'"property" property is required')),Gt;function qt(Zt){let sr=[];const ir=Zt.value,hr=Zt.key;if(!Array.isArray(ir))return[new c.V(hr,ir,`array expected, ${c.K(ir)} found`)];if(ir.length!==2)return[new c.V(hr,ir,`array length 2 expected, length ${ir.length} found`)];if(Ht){if(!c.H(ir[0]))return[new c.V(hr,ir,`object expected, ${c.K(ir[0])} found`)];const gr=ir[0];if(gr.zoom===void 0)return[new c.V(hr,ir,"object stop key must have zoom")];if(gr.value===void 0)return[new c.V(hr,ir,"object stop key must have value")];const dr=c.J(gr.zoom);if(typeof dr!="number")return[new c.V(hr,gr.zoom,"stop zoom values must be numbers")];if(mt&&mt>dr)return[new c.V(hr,gr.zoom,"stop zoom values must appear in ascending order")];dr!==mt&&(mt=dr,pt=void 0,St={}),sr=sr.concat($l({key:`${hr}[0]`,value:ir[0],valueSpec:{zoom:{}},style:Zt.style,styleSpec:Zt.styleSpec,objectElementValidators:{zoom:Jl,value:Qt}}))}else sr=sr.concat(Qt({key:`${hr}[0]`,value:ir[0],style:Zt.style,styleSpec:Zt.styleSpec},ir));return c.Q(c.S(ir[1]))?sr.concat([new c.V(`${hr}[1]`,ir[1],"expressions are not allowed in function stops.")]):sr.concat(Zs({key:`${hr}[1]`,value:ir[1],valueSpec:st,style:Zt.style,styleSpec:Zt.styleSpec}))}function Qt(Zt,sr){const ir=c.K(Zt.value),hr=c.J(Zt.value),gr=Zt.value!==null?Zt.value:sr;if(ht){if(ir!==ht)return[new c.V(Zt.key,gr,`${ir} stop domain type must match previous stop domain type ${ht}`)]}else ht=ir;if(ir!=="number"&&ir!=="string"&&ir!=="boolean"&&typeof hr!="number"&&typeof hr!="string"&&typeof hr!="boolean")return[new c.V(Zt.key,gr,"stop domain value must be a number, string, or boolean")];if(ir!=="number"&&lt!=="categorical"){let dr=`number expected, ${ir} found`;return c.N(st)&&lt===void 0&&(dr+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new c.V(Zt.key,gr,dr)]}return lt!=="categorical"||ir!=="number"||typeof hr=="number"&&isFinite(hr)&&Math.floor(hr)===hr?lt!=="categorical"&&ir==="number"&&typeof hr=="number"&&typeof pt=="number"&&pt!==void 0&&hr<pt?[new c.V(Zt.key,gr,"stop domain values must appear in ascending order")]:(pt=hr,lt==="categorical"&&hr in St?[new c.V(Zt.key,gr,"stop domain values must be unique")]:(St[hr]=!0,[])):[new c.V(Zt.key,gr,`integer expected, found ${String(hr)}`)]}}function xl(it){const d=(it.expressionContext==="property"?c.W:c.U)(c.S(it.value),it.valueSpec);if(d.result==="error")return d.value.map(st=>new c.V(`${it.key}${st.key}`,it.value,st.message));const $=d.value.expression||d.value._styleExpression.expression;if(it.expressionContext==="property"&&it.propertyKey==="text-font"&&!$.outputDefined())return[new c.V(it.key,it.value,`Invalid data expression for "${it.propertyKey}". Output values must be contained as literals within the expression.`)];if(it.expressionContext==="property"&&it.propertyType==="layout"&&!c.Z($))return[new c.V(it.key,it.value,'"feature-state" data expressions are not supported with layout properties.')];if(it.expressionContext==="filter")return Yn($,it);if(it.expressionContext==="appearance")return xn($,it);if(it.expressionContext&&it.expressionContext.indexOf("cluster")===0){if(!c.X($,["zoom","feature-state"]))return[new c.V(it.key,it.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(it.expressionContext==="cluster-initial"&&!c.Y($))return[new c.V(it.key,it.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Yn(it,d){const $=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(d.valueSpec&&d.valueSpec.expression)for(const lt of d.valueSpec.expression.parameters)$.delete(lt);if($.size===0)return[];const st=[];return it instanceof c._&&$.has(it.name)?[new c.V(d.key,d.value,`["${it.name}"] expression is not supported in a filter for a ${d.object.type} layer with id: ${d.object.id}`)]:(it.eachChild(lt=>{st.push(...Yn(lt,d))}),st)}function xn(it,d){const $=new Set;if(d.valueSpec&&d.valueSpec.expression)for(const lt of d.valueSpec.expression.parameters)$.add(lt);if($.size===0)return[];const st=[];return it instanceof c._&&!$.has(it.name)?[new c.V(d.key,d.value,`["${it.name}"] is not an allowed parameter`)]:(it.eachChild(lt=>{st.push(...xn(lt,d))}),st)}function Qn(it){const d=it.key,$=it.value,st=it.valueSpec,lt=[];return Array.isArray(st.values)?st.values.indexOf(c.J($))===-1&&lt.push(new c.V(d,$,`expected one of [${st.values.join(", ")}], ${JSON.stringify($)} found`)):Object.keys(st.values).indexOf(c.J($))===-1&&lt.push(new c.V(d,$,`expected one of [${Object.keys(st.values).join(", ")}], ${JSON.stringify($)} found`)),lt}function os(it){return c.a2(c.S(it.value))?xl(Object.assign({},it,{expressionContext:"filter",valueSpec:it.styleSpec[`filter_${it.layerType||"fill"}`]})):Ks(it)}function Ks(it){const d=it.value,$=it.key;if(!Array.isArray(d))return[new c.V($,d,`array expected, ${c.K(d)} found`)];if(d.length<1)return[new c.V($,d,"filter array must have at least 1 element")];const st=it.styleSpec;let lt=Qn({key:`${$}[0]`,value:d[0],valueSpec:st.filter_operator});const ht=()=>{d.length>=2&&(c.a0(d[1])||lt.push(new c.V(`${$}[1]`,d[1],`string expected, ${c.K(d[1])} found`)));for(let pt=2;pt<d.length;pt++)c.J(d[1])==="$type"?lt=lt.concat(Qn({key:`${$}[${pt}]`,value:d[pt],valueSpec:st.geometry_type})):c.a0(d[pt])||c.L(d[pt])||c.$(d[pt])||lt.push(new c.V(`${$}[${pt}]`,d[pt],`string, number, or boolean expected, ${c.K(d[pt])} found.`))};switch(c.J(d[0])){case"<":case"<=":case">":case">=":d.length>=2&&c.J(d[1])==="$type"&&lt.push(new c.V($,d,`"$type" cannot be use with operator "${d[0]}"`)),d.length!==3&&lt.push(new c.V($,d,`filter array for operator "${d[0]}" must have 3 elements`)),ht();break;case"==":case"!=":d.length!==3&&lt.push(new c.V($,d,`filter array for operator "${d[0]}" must have 3 elements`)),ht();break;case"in":case"!in":ht();break;case"any":case"all":case"none":for(let pt=1;pt<d.length;pt++)lt=lt.concat(Ks({key:`${$}[${pt}]`,value:d[pt],style:it.style,styleSpec:it.styleSpec}));break;case"has":case"!has":d.length!==2?lt.push(new c.V($,d,`filter array for "${d[0]}" operator must have 2 elements`)):c.a0(d[1])||lt.push(new c.V(`${$}[1]`,d[1],`string expected, ${c.K(d[1])} found`))}return lt}function oo(it,d){const $=it.key,st=it.style,lt=it.layer,ht=it.styleSpec,pt=it.value,mt=it.objectKey,St=ht[`${d}_${it.layerType}`];if(!St)return[];const It=mt.match(/^(.*)-use-theme$/);if(It&&St[It[1]])return c.Q(c.S(pt))?[].concat(Zs({key:$,value:pt,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:st,styleSpec:ht,expressionContext:"property",propertyType:d,propertyKey:mt})):Zs({key:$,value:pt,valueSpec:{type:"string"},style:st,styleSpec:ht});const Dt=mt.match(/^(.*)-transition$/);if(d==="paint"&&Dt&&St[Dt[1]]&&St[Dt[1]].transition)return Zs({key:$,value:pt,valueSpec:ht.transition,style:st,styleSpec:ht});const Ht=it.valueSpec||St[mt];if(!Ht)return[new c.a3($,pt,`unknown property "${mt}"`)];let Gt;if(c.a0(pt)&&c.N(Ht)&&!Ht.tokens&&(Gt=/^{([^}]+)}$/.exec(pt))){const Qt=`\`{ "type": "identity", "property": ${Gt?JSON.stringify(Gt[1]):'"_"'} }\``;return[new c.V($,pt,`"${mt}" does not support interpolation syntax
Use an identity property function instead: ${Qt}.`)]}const qt=[];if(it.layerType==="symbol")mt!=="text-field"||!st||st.glyphs||st.imports||qt.push(new c.V($,pt,'use of "text-field" requires a style "glyphs" property')),mt==="text-font"&&c.a4(c.S(pt))&&c.J(pt.type)==="identity"&&qt.push(new c.V($,pt,'"text-font" does not support identity functions'));else if(it.layerType==="model"&&d==="paint"&&lt&&lt.layout&&lt.layout.hasOwnProperty("model-id")&&c.N(Ht)&&(c.a5(Ht)||c.O(Ht))){const Qt=c.W(c.S(pt),Ht).value,Zt="expression"in Qt&&Qt.expression||"_styleExpression"in Qt&&Qt._styleExpression&&Qt._styleExpression.expression;Zt&&!c.X(Zt,["measure-light"])&&(mt==="model-emissive-strength"&&c.Y(Zt)&&c.Z(Zt)||qt.push(new c.V($,pt,`${mt} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return qt.concat(Zs({key:it.key,value:pt,valueSpec:Ht,style:st,styleSpec:ht,expressionContext:"property",propertyType:d,propertyKey:mt}))}function qo(it){return oo(it,"paint")}function zn(it){return oo(it,"layout")}function Xn(it){let d=[];const $=it.value,st=it.key,lt=it.style,ht=it.styleSpec;if(!c.H($))return[new c.V(st,$,"object expected")];$.type||$.ref||d.push(new c.V(st,$,'either "type" or "ref" is required'));let pt=c.J($.type);const mt=c.J($.ref);if($.id){const St=c.J($.id);for(let It=0;It<it.arrayIndex;It++){const Dt=lt.layers[It];c.J(Dt.id)===St&&d.push(new c.V(st,$.id,`duplicate layer id "${St}", previously used at line ${Dt.id.__line__}`))}}if("ref"in $){let St;["type","source","source-layer","filter","layout"].forEach(It=>{It in $&&d.push(new c.V(st,$[It],`"${It}" is prohibited for ref layers`))}),lt.layers.forEach(It=>{c.J(It.id)===mt&&(St=It)}),St?St.ref?d.push(new c.V(st,$.ref,"ref cannot reference another ref layer")):pt=c.J(St.type):typeof mt=="string"&&d.push(new c.V(st,$.ref,`ref layer "${mt}" not found`))}else if(pt!=="background"&&pt!=="sky"&&pt!=="slot")if($.source)if(c.a0($.source)){const St=lt.sources&&lt.sources[$.source],It=St&&c.J(St.type);St?It==="vector"&&pt==="raster"?d.push(new c.V(st,$.source,`layer "${$.id}" requires a raster source`)):It==="raster"&&pt!=="raster"?d.push(new c.V(st,$.source,`layer "${$.id}" requires a vector source`)):It!=="vector"||$["source-layer"]?It==="raster-dem"&&pt!=="hillshade"?d.push(new c.V(st,$.source,"raster-dem source can only be used with layer type 'hillshade'.")):It!=="raster-array"||["raster","raster-particle"].includes(pt)?pt==="line"&&$.paint&&($.paint["line-gradient"]||$.paint["line-trim-offset"])&&It==="geojson"&&!St.lineMetrics?d.push(new c.V(st,$,`layer "${$.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):pt==="raster-particle"&&It!=="raster-array"&&d.push(new c.V(st,$.source,`layer "${$.id}" requires a 'raster-array' source.`)):d.push(new c.V(st,$.source,"raster-array source can only be used with layer type 'raster'.")):d.push(new c.V(st,$,`layer "${$.id}" must specify a "source-layer"`)):d.push(new c.V(st,$.source,`source "${$.source}" not found`))}else d.push(new c.V(`${st}.source`,$.source,'"source" must be a string'));else d.push(new c.V(st,$,'missing required property "source"'));return d=d.concat($l({key:st,value:$,valueSpec:ht.layer,style:it.style,styleSpec:it.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Zs({key:`${st}.type`,value:$.type,valueSpec:ht.layer.type,style:it.style,styleSpec:it.styleSpec,object:$,objectKey:"type"}),filter:St=>os(Object.assign({layerType:pt},St)),layout:St=>$l({layer:$,key:St.key,value:St.value,valueSpec:{},style:St.style,styleSpec:St.styleSpec,objectElementValidators:{"*":It=>zn(Object.assign({layerType:pt},It))}}),paint:St=>$l({layer:$,key:St.key,value:St.value,valueSpec:{},style:St.style,styleSpec:St.styleSpec,objectElementValidators:{"*":It=>qo(Object.assign({layerType:pt,layer:$},It))}}),appearances(St){const It=Pl({key:St.key,value:St.value,valueSpec:St.valueSpec,style:St.style,styleSpec:St.styleSpec,arrayElementValidator:Gt=>function(qt){const{key:Qt,layer:Zt,layerType:sr}=qt,ir=c.J(qt.value),hr=c.J(ir.name),gr=c.J(ir.condition),dr=$l({key:Qt,value:ir,valueSpec:qt.styleSpec.appearance,style:qt.style,styleSpec:qt.styleSpec,objectElementValidators:{condition:Ir=>function(Tr){const Rr=[];return Rr.push(...xl({key:Tr.key,value:Tr.object.condition,valueSpec:c.a6.appearance.condition,expressionContext:"appearance"})),Rr}(Object.assign({layer:Zt,layerType:sr},Ir)),properties:Ir=>function(Tr){const Rr=[],{styleSpec:Er,layer:vr,layerType:kr}=Tr,Ur=Er[`paint_${kr}`],zr=Er[`layout_${kr}`],Jr=Tr.object[Tr.objectKey];for(const rn in Jr){const pn=rn in Ur?"paint":rn in zr?"layout":void 0;if(!pn){Rr.push(new c.V(Tr.key,rn,`unknown property "${rn}" for layer type "${kr}"`));continue}const Pn=Object.assign({},Tr,{key:`${Tr.key}.${rn}`,object:Jr,objectKey:rn,layer:vr,layerType:kr,value:Jr[rn],valueSpec:pn==="paint"?Ur[rn]:zr[rn]});Rr.push(...oo(Pn,pn))}return Rr}(Object.assign({layer:Zt,layerType:sr},Ir))}});return hr!=="hidden"&&gr===void 0&&dr.push(new c.V(qt.key,"name",'Appearance with name different than "hidden" must have a condition')),dr}(Object.assign({layerType:pt,layer:$},Gt))}),Dt=Array.isArray(St.value)?St.value:[],Ht=new Set;return Dt.forEach((Gt,qt)=>{const Qt=c.J(Gt.name);if(Qt)if(Ht.has(Qt)){const Zt=c.J($.id);It.push(new c.V(St.key,Qt,`Duplicated appearance name "${Qt}" for layer "${Zt}"`))}else Ht.add(Qt)}),It}}})),d}function xs({key:it,value:d}){return c.a0(d)?[]:[new c.V(it,d,`string expected, ${c.K(d)} found`)]}const As={promoteId:function it({key:d,value:$}){if(c.a0($))return xs({key:d,value:$});if(Array.isArray($)){const lt=[],ht=c.S($),pt=c.U(ht);return pt.result==="error"&&pt.value.forEach(mt=>{lt.push(new c.V(`${d}${mt.key}`,null,`${mt.message}`))}),c.X(pt.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||lt.push(new c.V(`${d}`,null,"promoteId expression should be only feature dependent")),lt}if(!c.H($))return[new c.V(d,$,`string, expression or object expected, "${c.K($)}" found`)];const st=[];for(const lt in $)st.push(...it({key:`${d}.${lt}`,value:$[lt]}));return st}};function ks(it){const d=it.value,$=it.key,st=it.styleSpec,lt=it.style;if(!c.H(d))return[new c.V($,d,`object expected, ${c.K(d)} found`)];if(!("type"in d))return[new c.V($,d,'"type" is required')];const ht=c.J(d.type);let pt=[];switch(["vector","raster","raster-dem","raster-array"].includes(ht)&&("url"in d||"tiles"in d||pt.push(new c.a3($,d,'Either "url" or "tiles" is required.'))),ht){case"vector":case"raster":case"raster-dem":case"raster-array":return pt=pt.concat($l({key:$,value:d,valueSpec:st[`source_${ht.replace("-","_")}`],style:it.style,styleSpec:st,objectElementValidators:As})),pt;case"geojson":if(pt=$l({key:$,value:d,valueSpec:st.source_geojson,style:lt,styleSpec:st,objectElementValidators:As}),"cluster"in d&&"clusterProperties"in d){if(!c.H(d.clusterProperties))return[new c.V(`${$}.clusterProperties`,d,`object expected, ${c.K(d)} found`)];for(const mt in d.clusterProperties){const St=d.clusterProperties[mt];if(!Array.isArray(St))return[new c.V(`${$}.clusterProperties.${mt}`,St,"array expected")];const[It,Dt]=St,Ht=typeof It=="string"?[It,["accumulated"],["get",mt]]:It;pt.push(...xl({key:`${$}.${mt}.map`,value:Dt,expressionContext:"cluster-map"})),pt.push(...xl({key:`${$}.${mt}.reduce`,value:Ht,expressionContext:"cluster-reduce"}))}}return pt;case"video":return $l({key:$,value:d,valueSpec:st.source_video,style:lt,styleSpec:st});case"image":return $l({key:$,value:d,valueSpec:st.source_image,style:lt,styleSpec:st});case"canvas":return[new c.V($,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Qn({key:`${$}.type`,value:d.type,valueSpec:{values:Eo(st)}})}}function Eo(it){return it.source.reduce((d,$)=>{const st=it[$];return st.type.type==="enum"&&(d=d.concat(Object.keys(st.type.values||{}))),d},[])}function Jo(it){const d=it.value,$=it.styleSpec,st=$.light,lt=it.style;if(d===void 0)return[];if(!c.H(d))return[new c.V("light",d,`object expected, ${c.K(d)} found`)];let ht=[];for(const pt in d){const mt=pt.match(/^(.*)-transition$/),St=pt.match(/^(.*)-use-theme$/);ht=ht.concat(St&&st[St[1]]?Zs({key:pt,value:d[pt],valueSpec:{type:"string"},style:lt,styleSpec:$}):mt&&st[mt[1]]&&st[mt[1]].transition?Zs({key:pt,value:d[pt],valueSpec:$.transition,style:lt,styleSpec:$}):st[pt]?Zs({key:pt,value:d[pt],valueSpec:st[pt],style:lt,styleSpec:$}):[new c.V(pt,d[pt],`unknown property "${pt}"`)])}return ht}function na(it){const d=it.value;if(!d)return[];const $=it.key;if(!c.H(d))return[new c.V($,d,`object expected, ${c.K(d)} found`)];let st=[];const lt=it.styleSpec,ht=lt["light-3d"],pt=it.style,mt=it.style.lights;for(const Dt of["type","id"])if(!(Dt in d))return st=st.concat([new c.V($,d,`missing property "${Dt}"`)]),st;if(!c.a0(d.type))return st=st.concat([new c.V(`${$}.type`,d.type,"string expected")]),st;if(mt)for(let Dt=0;Dt<it.arrayIndex;Dt++){const Ht=c.J(d.type),Gt=mt[Dt];c.J(Gt.type)===Ht&&st.push(new c.V($,d.id,`duplicate light type "${d.type}", previously defined at line ${Gt.id.__line__}`))}const St=`properties_light_${d.type}`;if(!(St in lt))return st=st.concat([new c.V(`${$}.type`,d,`Invalid light type ${d.type}`)]),st;const It=lt[St];for(const Dt in d)if(Dt==="properties"){const Ht=d[Dt];if(!c.H(Ht))return st=st.concat([new c.V("properties",Ht,`object expected, ${c.K(Ht)} found`)]),st;for(const Gt in Ht){const qt=Gt.match(/^(.*)-transition$/),Qt=Gt.match(/^(.*)-use-theme$/);st=st.concat(Qt&&It[Qt[1]]?Zs({key:Dt,value:Ht[Gt],valueSpec:{type:"string"},style:pt,styleSpec:lt}):qt&&It[qt[1]]&&It[qt[1]].transition?Zs({key:Dt,value:d[Dt],valueSpec:lt.transition,style:pt,styleSpec:lt}):It[Gt]?Zs({key:Gt,value:Ht[Gt],valueSpec:It[Gt],style:pt,styleSpec:lt}):[new c.a3(it.key,Ht[Gt],`unknown property "${Gt}"`)])}}else st=st.concat(ht[Dt]?Zs({key:Dt,value:d[Dt],valueSpec:ht[Dt],style:pt,styleSpec:lt}):[new c.a3(Dt,d[Dt],`unknown property "${Dt}"`)]);return st}function Go(it){const d=it.value,$=it.key,st=it.style,lt=it.styleSpec,ht=lt.terrain;if(d==null)return[];if(!c.H(d))return[new c.V("terrain",d,`object expected, ${c.K(d)} found`)];let pt=[];for(const mt in d){const St=mt.match(/^(.*)-transition$/),It=mt.match(/^(.*)-use-theme$/);pt=pt.concat(It&&ht[It[1]]?Zs({key:mt,value:d[mt],valueSpec:{type:"string"},style:st,styleSpec:lt}):St&&ht[St[1]]&&ht[St[1]].transition?Zs({key:mt,value:d[mt],valueSpec:lt.transition,style:st,styleSpec:lt}):ht[mt]?Zs({key:mt,value:d[mt],valueSpec:ht[mt],style:st,styleSpec:lt}):[new c.a3(mt,d[mt],`unknown property "${mt}"`)])}if(d.source)if(c.a0(d.source)){const mt=st.sources&&st.sources[d.source],St=mt&&c.J(mt.type);mt?St!=="raster-dem"&&pt.push(new c.V(`${$}.source`,d.source,`terrain cannot be used with a source of type ${St}, it only be used with a "raster-dem" source type`)):pt.push(new c.V(`${$}.source`,d.source,`source "${d.source}" not found`))}else pt.push(new c.V(`${$}.source`,d.source,"source must be a string"));else pt.push(new c.V($,d,'terrain is missing required property "source"'));return pt}function _c(it){const d=it.value,$=it.style,st=it.styleSpec,lt=st.fog;if(d===void 0)return[];if(!c.H(d))return[new c.V("fog",d,`object expected, ${c.K(d)} found`)];let ht=[];for(const pt in d){const mt=pt.match(/^(.*)-transition$/),St=pt.match(/^(.*)-use-theme$/);ht=ht.concat(St&&lt[St[1]]?Zs({key:pt,value:d[pt],valueSpec:{type:"string"},style:$,styleSpec:st}):mt&&lt[mt[1]]&&lt[mt[1]].transition?Zs({key:pt,value:d[pt],valueSpec:st.transition,style:$,styleSpec:st}):lt[pt]?Zs({key:pt,value:d[pt],valueSpec:lt[pt],style:$,styleSpec:st}):[new c.a3(pt,d[pt],`unknown property "${pt}"`)])}return ht}const Il={"*":()=>[],array:Pl,boolean:function(it){const d=it.value,$=it.key;return c.$(d)?[]:[new c.V($,d,`boolean expected, ${c.K(d)} found`)]},number:Jl,color:function({key:it,value:d}){return c.a0(d)?c.a1.parseCSSColor(d)===null?[new c.V(it,d,`color expected, "${d}" found`)]:[]:[new c.V(it,d,`color expected, ${c.K(d)} found`)]},enum:Qn,filter:os,function:Ul,layer:Xn,object:$l,source:ks,model:c.a7,light:Jo,"light-3d":na,terrain:Go,fog:_c,string:xs,formatted:function(it){return xs(it).length===0?[]:xl(it)},resolvedImage:function(it){return xs(it).length===0?[]:xl(it)},projection:function(it){const d=it.value,$=it.styleSpec,st=$.projection,lt=it.style;if(c.H(d)){let ht=[];for(const pt in d)ht=ht.concat(Zs({key:pt,value:d[pt],valueSpec:st[pt],style:lt,styleSpec:$}));return ht}return c.a0(d)?[]:[new c.V("projection",d,`object or string expected, ${c.K(d)} found`)]},import:function(it){const d=it.key,{value:$,styleSpec:st}=it;if(!c.H($))return[new c.V(d,$,"import must be an object")];const{data:lt,...ht}=$;Object.defineProperty(ht,"__line__",{value:$.__line__,enumerable:!1});let pt=$l(Object.assign({},it,{value:ht,valueSpec:st.import}));return c.J(ht.id)===""&&pt.push(new c.V(`${it.key}.id`,ht,"import id can't be an empty string")),lt&&(pt=pt.concat(zo(lt,st,{key:`${it.key}.data`}))),pt},iconset:function(it){const d=it.value,$=it.key,st=it.styleSpec,lt=it.style;if(!c.H(d))return[new c.V($,d,"object expected")];if(!d.type)return[new c.V($,d,'"type" is required')];const ht=c.J(d.type);let pt=[];if(pt=pt.concat($l({key:$,value:d,valueSpec:st[`iconset_${ht}`],style:lt,styleSpec:st})),function(mt,St){return!(mt!=="source"||!St.source)}(ht,d)){const mt=lt.sources&&lt.sources[d.source],St=mt&&c.J(mt.type);mt?St!=="raster-array"&&pt.push(new c.V($,d.source,`iconset cannot be used with a source of type ${String(St)}, it only be used with a "raster-array" source type`)):pt.push(new c.V($,d.source,`source "${d.source}" not found`))}return pt}};function Zs(it,d=!1){const $=it.value,st=it.valueSpec,lt=it.styleSpec;if(st.expression){if(c.a4(c.J($)))return Ul(it);if(c.Q(c.S($)))return xl(it)}if(st.type&&Il[st.type]){const ht=Il[st.type](it);return d===!0&&ht.length>0&&Array.isArray(it.value)?xl(it):ht}return $l(Object.assign({},it,{valueSpec:st.type?lt[st.type]:st}))}function $l(it){const d=it.key,$=it.value,st=it.valueSpec||{},lt=it.objectElementValidators||{},ht=it.style,pt=it.styleSpec;if(!c.H($))return[new c.V(d,$,`object expected, ${c.K($)} found`)];let mt=[];for(const St in $){const It=St.split(".")[0];let Dt;lt[It]?Dt=lt[It]:st[It]?Dt=Zs:lt["*"]?Dt=lt["*"]:st["*"]&&(Dt=Zs),Dt?mt=mt.concat(Dt({key:(d&&`${d}.`)+St,value:$[St],valueSpec:st[It]||st["*"],style:ht,styleSpec:pt,object:$,objectKey:St},$)):mt.push(new c.a3(d,$[St],`unknown property "${St}"`))}for(const St in st){if(lt[St])continue;const It=st[St];It.required&&It.default===void 0&&$[St]===void 0&&mt.push(new c.V(d,$,`missing required property "${St}"`))}return mt}function io({key:it,value:d}){const $=xs({key:it,value:d});if($.length)return $;const st=d;return st.indexOf("{fontstack}")===-1&&$.push(new c.V(it,d,'"glyphs" url must include a "{fontstack}" token')),st.indexOf("{range}")===-1&&$.push(new c.V(it,d,'"glyphs" url must include a "{range}" token')),$}function zo(it,d=c.a6,$={}){return $l({key:$.key||"",value:it,valueSpec:Object.assign(d.$root,{"*":{type:"*"}}),styleSpec:d,style:it,objectElementValidators:{glyphs:io}})}function Ko(it,d=c.a6){return lr(zo(it,d))}const vu=it=>lr(ks(it)),_n=it=>lr(Jo(it)),Su=it=>lr(na(it)),bp=it=>lr(Go(it)),bu=it=>lr(_c(it)),Xs=it=>lr(function(d){const $=d.value,st=d.style,lt=d.styleSpec,ht=lt.snow;if($===void 0)return[];if(!c.H($))return[new c.V("snow",$,`object expected, ${c.K($)} found`)];let pt=[];for(const mt in $){const St=mt.match(/^(.*)-transition$/);pt=pt.concat(St&&ht[St[1]]&&ht[St[1]].transition?Zs({key:mt,value:$[mt],valueSpec:lt.transition,style:st,styleSpec:lt}):ht[mt]?Zs({key:mt,value:$[mt],valueSpec:ht[mt],style:st,styleSpec:lt}):[new c.a3(mt,$[mt],`unknown property "${mt}"`)])}return pt}(it)),Mu=it=>lr(function(d){const $=d.value,st=d.style,lt=d.styleSpec,ht=lt.rain;if($===void 0)return[];if(!c.H($))return[new c.V("rain",$,`object expected, ${c.K($)} found`)];let pt=[];for(const mt in $){const St=mt.match(/^(.*)-transition$/);pt=pt.concat(St&&ht[St[1]]&&ht[St[1]].transition?Zs({key:mt,value:$[mt],valueSpec:lt.transition,style:st,styleSpec:lt}):ht[mt]?Zs({key:mt,value:$[mt],valueSpec:ht[mt],style:st,styleSpec:lt}):[new c.a3(mt,$[mt],`unknown property "${mt}"`)])}return pt}(it)),rv=it=>lr(Xn(it)),qm=it=>lr(os(it)),oy=it=>lr(qo(it)),Wr=it=>lr(zn(it)),tr=it=>lr(c.a7(it));function lr(it){return it.slice().sort((d,$)=>d.line&&$.line?d.line-$.line:0)}function _r(it,d){let $=!1;if(d&&d.length)for(const st of d)st instanceof c.a3?c.w(st.message):(it.fire(new c.y(new Error(st.message))),$=!0);return $}const Nr=c.a6.light;let Mr;class Vr extends c.E{constructor(d,$="flat"){super(),this._transitionable=new c.a8(Mr||(Mr=new c.a9({anchor:new c.aa(Nr.anchor),position:new c.ab(Nr.position),color:new c.aa(Nr.color),intensity:new c.aa(Nr.intensity)}))),this.setLight(d,$),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(d,$,st={}){this._validate(_n,d,st)||(this._transitionable.setTransitionOrValue(d),this.id=$)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,$,st){return(!st||st.validate!==!1)&&_r(this,d.call(Ko,Object.assign({value:$,style:{glyphs:!0,sprite:!0},styleSpec:c.a6})))}}const Yr=c.a6.terrain;let Gr=class extends c.E{constructor(it,d,$,st,lt){super(),this.scope=$,this._transitionable=new c.a8(new c.a9({source:new c.aa(Yr.source),exaggeration:new c.aa(Yr.exaggeration)}),$,st),this._transitionable.setTransitionOrValue(it,st),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=d,this.worldview=lt}get(){return this._transitionable.serialize()}set(it,d){this._transitionable.setTransitionOrValue(it,d)}updateTransitions(it){this._transitioning=this._transitionable.transitioned(it,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(it){this.properties=this._transitioning.possiblyEvaluate(it)}getExaggeration(it){return this._transitioning.possiblyEvaluate(new c.ac(it,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const it=this._transitionable._values.exaggeration;if(!it)return null;const d=it.value.expression;if(!d)return null;let $=-1,st=-1,lt=1;for(const ht of d.zoomStops)lt=d.evaluate(new c.ac(ht,{worldview:this.worldview})),lt>.01?($=ht,st=-1):st=ht;return lt<.01&&$>0&&st>$?[$,st]:null}isZoomDependent(){const it=this._transitionable._values.exaggeration;return it!=null&&it.value!=null&&it.value.expression!=null&&it.value.expression instanceof c.ad}};const Zr=45,Rn=65,mn=.05;function Zn(it,d,$,st){const lt=c.ah(Zr,Rn,$),[ht,pt]=fs(it,st);let mt=1-Math.min(1,Math.exp((d-ht)/(pt-ht)*-6));return mt*=mt*mt,mt=Math.min(1,1.00747*mt),mt*lt*it.alpha}function fs(it,d){const $=.5/Math.tan(.5*d);return[it.range[0]+$,it.range[1]+$]}function Wn(it,d,$,st,lt){const ht=c.af([],[d,$,st],lt.mercatorFogMatrix);return Zn(it,c.ag(ht),lt.pitch,lt._fov)}function zs(it,d,$,st,lt,ht,pt){const mt=[[$,st,0],[lt,st,0],[lt,ht,0],[$,ht,0]];let St=Number.MAX_VALUE,It=-Number.MAX_VALUE;for(const Dt of mt){const Ht=c.af([],Dt,d),Gt=c.ag(Ht);St=Math.min(St,Gt),It=Math.max(It,Gt)}return[Zn(it,St,pt.pitch,pt._fov),Zn(it,It,pt.pitch,pt._fov)]}const Fs=c.a6.fog;class js extends c.E{constructor(d,$,st,lt){super();const ht=new c.a9({range:new c.aa(Fs.range),color:new c.aa(Fs.color),"color-use-theme":new c.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new c.aa(Fs["high-color"]),"high-color-use-theme":new c.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new c.aa(Fs["space-color"]),"space-color-use-theme":new c.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new c.aa(Fs["horizon-blend"]),"star-intensity":new c.aa(Fs["star-intensity"]),"vertical-range":new c.aa(Fs["vertical-range"])});this._transitionable=new c.a8(ht,st,new Map(lt)),this.set(d,lt),this._transitioning=this._transitionable.untransitioned(),this._transform=$,this.properties=new c.ai(ht),this.scope=st}get state(){const d=this._transform,$=d.projection.name==="globe",st=c.aj(d.zoom),lt=this.properties.get("range"),ht=[.5,3];return{range:$?[c.ak(ht[0],lt[0],st),c.ak(ht[1],lt[1],st)]:lt,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(d,$,st={}){if(this._validate(bu,d,st))return;const lt=Object.assign({},d);for(const ht of Object.keys(Fs))lt[ht]===void 0&&(lt[ht]=Fs[ht].default);this._options=lt,this._transitionable.setTransitionOrValue(this._options,$)}getOpacity(d){if(!this._transform.projection.supportsFog)return 0;const $=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:c.ah(Zr,Rn,d))*$.a}getOpacityAtLatLng(d,$){return this._transform.projection.supportsFog?function(st,lt,ht){const pt=c.ae.fromLngLat(lt),mt=ht.elevation?ht.elevation.getAtPointOrZero(pt):0;return Wn(st,pt.x,pt.y,mt,ht)}(this.state,d,$):0}getOpacityForTile(d){if(!this._transform.projection.supportsFog)return[1,1];const $=this._transform.calculateFogTileMatrix(d.toUnwrapped());return zs(this.state,$,0,0,c.al,c.al,this._transform)}getOpacityForBounds(d,$,st,lt,ht){return this._transform.projection.supportsFog?zs(this.state,d,$,st,lt,ht,this._transform):[1,1]}getFovAdjustedRange(d){return this._transform.projection.supportsFog?fs(this.state,d):[0,1]}isVisibleOnFrustum(d){if(!this._transform.projection.supportsFog)return!1;const $=[4,5,6,7];for(const st of $){const lt=d.points[st];let ht;if(lt[2]>=0)ht=lt;else{const pt=d.points[st-4];ht=c.am(pt,lt,pt[2]/(pt[2]-lt[2]))}if(Wn(this.state,ht[0],ht[1],0,this._transform)>=mn)return!0}return!1}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,$,st){return(!st||st.validate!==!1)&&_r(this,d.call(Ko,Object.assign({value:$,style:{glyphs:!0,sprite:!0},styleSpec:c.a6})))}}let lo,Ml,Xl,Ll,eu=class extends c.E{constructor(it,d,$,st){super();const lt=lo||(lo=new c.a9({density:new c.aa(c.a6.snow.density),intensity:new c.aa(c.a6.snow.intensity),color:new c.aa(c.a6.snow.color),opacity:new c.aa(c.a6.snow.opacity),vignette:new c.aa(c.a6.snow.vignette),"vignette-color":new c.aa(c.a6.snow["vignette-color"]),"center-thinning":new c.aa(c.a6.snow["center-thinning"]),direction:new c.aa(c.a6.snow.direction),"flake-size":new c.aa(c.a6.snow["flake-size"])}));this._transitionable=new c.a8(lt,$,new Map(st)),this.set(it,st),this._transitioning=this._transitionable.untransitioned(),this.properties=new c.ai(lt),this.scope=$}get state(){const it=this.properties.get("opacity"),d=this.properties.get("color"),$=this.properties.get("direction"),st=c.an($[0]),lt=-Math.max(c.an($[1]),.01),ht=[Math.cos(st)*Math.cos(lt),Math.sin(st)*Math.cos(lt),Math.sin(lt)],pt=this.properties.get("vignette"),mt=this.properties.get("vignette-color");return mt.a=pt,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new c.ao(d.r,d.g,d.b,d.a*it),direction:ht,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:mt}}get(){return this._transitionable.serialize()}set(it,d,$={}){if(this._validate(Xs,it,$))return;const st=Object.assign({},it),lt=c.a6.snow;for(const ht of Object.keys(lt))st[ht]===void 0&&(st[ht]=lt[ht].default);this._options=st,this._transitionable.setTransitionOrValue(this._options,d)}updateConfig(it){this._transitionable.setTransitionOrValue(this._options,new Map(it))}updateTransitions(it){this._transitioning=this._transitionable.transitioned(it,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(it){this.properties=this._transitioning.possiblyEvaluate(it)}_validate(it,d,$){return(!$||$.validate!==!1)&&_r(this,it.call(Ko,Object.assign({value:d,style:{glyphs:!0,sprite:!0},styleSpec:c.a6})))}},Sl=class extends c.E{constructor(it,d,$,st){super();const lt=Ml||(Ml=new c.a9({density:new c.aa(c.a6.rain.density),intensity:new c.aa(c.a6.rain.intensity),color:new c.aa(c.a6.rain.color),opacity:new c.aa(c.a6.rain.opacity),vignette:new c.aa(c.a6.rain.vignette),"vignette-color":new c.aa(c.a6.rain["vignette-color"]),"center-thinning":new c.aa(c.a6.rain["center-thinning"]),direction:new c.aa(c.a6.rain.direction),"droplet-size":new c.aa(c.a6.rain["droplet-size"]),"distortion-strength":new c.aa(c.a6.rain["distortion-strength"])}));this._transitionable=new c.a8(lt,$,new Map(st)),this.set(it,st),this._transitioning=this._transitionable.untransitioned(),this.properties=new c.ai(lt),this.scope=$}get state(){const it=this.properties.get("opacity"),d=this.properties.get("color"),$=this.properties.get("direction"),st=c.an($[0]),lt=-Math.max(c.an($[1]),.01),ht=[Math.cos(st)*Math.cos(lt),Math.sin(st)*Math.cos(lt),Math.sin(lt)],pt=this.properties.get("vignette-color");return pt.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new c.ao(d.r,d.g,d.b,d.a*it),direction:ht,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:pt}}get(){return this._transitionable.serialize()}set(it,d,$={}){if(this._validate(Mu,it,$))return;const st=Object.assign({},it),lt=c.a6.rain;for(const ht of Object.keys(lt))st[ht]===void 0&&(st[ht]=lt[ht].default);this._options=st,this._transitionable.setTransitionOrValue(this._options,d)}updateConfig(it){this._transitionable.setTransitionOrValue(this._options,new Map(it))}updateTransitions(it){this._transitioning=this._transitionable.transitioned(it,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(it){this.properties=this._transitioning.possiblyEvaluate(it)}_validate(it,d,$){return(!$||$.validate!==!1)&&_r(this,it.call(Ko,Object.assign({value:d,style:{glyphs:!0,sprite:!0},styleSpec:c.a6})))}};class po extends c.E{constructor(d,$,st,lt){super(),this.scope=st,this._options=d,this.properties=new c.ai($),this._transitionable=new c.a8($,st,new Map(lt)),this._transitionable.setTransitionOrValue(d.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(d){this._transitionable.setTransitionOrValue(this._options.properties,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(d,$){this._options=d,this._transitionable.setTransitionOrValue(d.properties,$)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Cl{constructor(d,$,st){this.screenBounds=d,this.cameraPoint=st.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=$,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,st)}static createFromScreenPoints(d,$){let st,lt;if(d instanceof c.P||typeof d[0]=="number"){const ht=c.P.convert(d);st=[ht],lt=$.isPointAboveHorizon(ht)}else{const ht=c.P.convert(d[0]),pt=c.P.convert(d[1]),mt=ht.add(pt)._div(2);st=[ht,pt],lt=c.aq(ht,pt).every(St=>$.isPointAboveHorizon(St))&&$.isPointAboveHorizon(mt)}return new Cl(st,lt,$)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(d){return c.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],d)}bufferedCameraGeometry(d){const $=this.screenBounds[0],st=this.screenBounds.length===1?this.screenBounds[0].add(new c.P(1,1)):this.screenBounds[1],lt=c.aq($,st,0,!1);return this.cameraPoint.y>st.y&&(this.cameraPoint.x>$.x&&this.cameraPoint.x<st.x?lt.splice(3,0,this.cameraPoint):this.cameraPoint.x>=st.x?lt[2]=this.cameraPoint:this.cameraPoint.x<=$.x&&(lt[3]=this.cameraPoint)),c.ar(lt,d)}bufferedCameraGeometryGlobe(d){const $=this.screenBounds[0],st=this.screenBounds.length===1?this.screenBounds[0].add(new c.P(1,1)):this.screenBounds[1],lt=c.aq($,st,d),ht=this.cameraPoint.clone();switch(3*((ht.y>$.y)+(ht.y>st.y))+((ht.x>$.x)+(ht.x>st.x))){case 0:lt[0]=ht,lt[4]=ht.clone();break;case 1:lt.splice(1,0,ht);break;case 2:lt[1]=ht;break;case 3:lt.splice(4,0,ht);break;case 5:lt.splice(2,0,ht);break;case 6:lt[3]=ht;break;case 7:lt.splice(3,0,ht);break;case 8:lt[2]=ht}return lt}containsTile(d,$,st,lt=0){const ht=Math.max(d.queryPadding,d.evaluateQueryRenderedFeaturePadding())/$._pixelsPerMercatorPixel+1,pt=st?this._bufferedCameraMercator(ht,$):this._bufferedScreenMercator(ht,$);let mt=d.tileID.wrap+(pt.unwrapped?lt:0);const St=pt.polygon.map(sr=>c.as(d.tileTransform,sr,mt));if(!c.at(St,0,0,c.al,c.al))return;mt=d.tileID.wrap+(this.screenGeometryMercator.unwrapped?lt:0);const It=this.screenGeometryMercator.polygon.map(sr=>c.au(d.tileTransform,sr,mt)),Dt=It.map(sr=>new c.P(sr[0],sr[1])),Ht=$.getFreeCameraOptions().position||new c.ae(0,0,0),Gt=c.au(d.tileTransform,Ht,mt),qt=It.map(sr=>{const ir=c.av(sr,sr,Gt);return c.aw(ir,ir),new c.ax(Gt,ir)}),Qt=c.ay(d,1,$.zoom)*$._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:Dt,tilespaceRays:qt,bufferedTilespaceGeometry:St,bufferedTilespaceBounds:(Zt=c.az(St),Zt.min.x=c.aA(Zt.min.x,0,c.al),Zt.min.y=c.aA(Zt.min.y,0,c.al),Zt.max.x=c.aA(Zt.max.x,0,c.al),Zt.max.y=c.aA(Zt.max.y,0,c.al),Zt),tile:d,tileID:d.tileID,pixelToTileUnitsFactor:Qt};var Zt}_bufferedScreenMercator(d,$){const st=Ol(d);if(this._screenRaycastCache[st])return this._screenRaycastCache[st];{let lt;return lt=$.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(d),$):{polygon:this.bufferedScreenGeometry(d).map(ht=>$.pointCoordinate3D(ht)),unwrapped:!0},this._screenRaycastCache[st]=lt,lt}}_bufferedCameraMercator(d,$){const st=Ol(d);if(this._cameraRaycastCache[st])return this._cameraRaycastCache[st];{let lt;return lt=$.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(d),$):{polygon:this.bufferedCameraGeometry(d).map(ht=>$.pointCoordinate3D(ht)),unwrapped:!0},this._cameraRaycastCache[st]=lt,lt}}_projectAndResample(d,$){const st=function(ht,pt){const mt=c.aB([],pt.pixelMatrix,pt.globeMatrix),St=[0,-c.aD,0,1],It=[0,c.aD,0,1],Dt=[0,0,0,1];c.aC(St,St,mt),c.aC(It,It,mt),c.aC(Dt,Dt,mt);const Ht=new c.P(St[0]/St[3],St[1]/St[3]),Gt=new c.P(It[0]/It[3],It[1]/It[3]),qt=c.aE(ht,Ht)&&St[3]<Dt[3],Qt=c.aE(ht,Gt)&&It[3]<Dt[3];if(!qt&&!Qt)return null;const Zt=function(Rr,Er,vr){for(let kr=1;kr<Rr.length;kr++){const Ur=eo(Er.pointCoordinate3D(Rr[kr-1]).x),zr=eo(Er.pointCoordinate3D(Rr[kr]).x);if(vr<0){if(Ur<zr)return{idx:kr,t:-Ur/(zr-1-Ur)}}else if(zr<Ur)return{idx:kr,t:(1-Ur)/(zr+1-Ur)}}return null}(ht,pt,qt?-1:1);if(!Zt)return null;const{idx:sr,t:ir}=Zt;let hr=sr>1?Vo(ht.slice(0,sr),pt):[],gr=sr<ht.length?Vo(ht.slice(sr),pt):[];hr=hr.map(Rr=>new c.P(eo(Rr.x),Rr.y)),gr=gr.map(Rr=>new c.P(eo(Rr.x),Rr.y));const dr=[...hr];dr.length===0&&dr.push(gr[gr.length-1]);const Ir=c.ak(dr[dr.length-1].y,(gr.length===0?hr[0]:gr[0]).y,ir);let Tr;return Tr=qt?[new c.P(0,Ir),new c.P(0,0),new c.P(1,0),new c.P(1,Ir)]:[new c.P(1,Ir),new c.P(1,1),new c.P(0,1),new c.P(0,Ir)],dr.push(...Tr),gr.length===0?dr.push(hr[0]):dr.push(...gr),{polygon:dr.map(Rr=>new c.ae(Rr.x,Rr.y)),unwrapped:!1}}(d,$);if(st)return st;const lt=function(ht,pt){let mt=!1,St=-1/0,It=0;for(let Ht=0;Ht<ht.length-1;Ht++)ht[Ht].x>St&&(St=ht[Ht].x,It=Ht);for(let Ht=0;Ht<ht.length-1;Ht++){const Gt=(It+Ht)%(ht.length-1),qt=ht[Gt],Qt=ht[Gt+1];Math.abs(qt.x-Qt.x)>.5&&(qt.x<Qt.x?(qt.x+=1,Gt===0&&(ht[ht.length-1].x+=1)):(Qt.x+=1,Gt+1===ht.length-1&&(ht[0].x+=1)),mt=!0)}const Dt=c.aF(pt.center.lng);return mt&&Dt<Math.abs(Dt-1)&&ht.forEach(Ht=>{Ht.x-=1}),{polygon:ht,unwrapped:mt}}(Vo(d,$).map(ht=>new c.P(eo(ht.x),ht.y)),$);return{polygon:lt.polygon.map(ht=>new c.ae(ht.x,ht.y)),unwrapped:lt.unwrapped}}}function Vo(it,d){return c.aG(it,$=>{const st=d.pointCoordinate3D($);$.x=st.x,$.y=st.y},1/256)}function eo(it){return it<0?1+it%1:it%1}function Ol(it){return 100*it|0}function wu(it,d,$,st,lt){const ht=function(mt,St){if(mt)return lt(mt);if(St){if(it.url&&St.tiles&&it.tiles&&delete it.tiles,St.variants){if(!Array.isArray(St.variants))return lt(new Error("variants must be an array"));for(const Dt of St.variants){if(Dt==null||typeof Dt!="object"||Dt.constructor!==Object)return lt(new Error("variant must be an object"));if(!Array.isArray(Dt.capabilities))return lt(new Error("capabilities must be an array"));if(Dt.capabilities.length===1&&Dt.capabilities[0]==="meshopt"){St=Object.assign(St,Dt);break}}}const It=c.aH(Object.assign({},St,it),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);It.tiles=d.canonicalizeTileset(It,it.url),lt(null,It)}},pt=function(mt,St,It){if(!mt)return null;if(!St&&!It)return mt;It=It||mt.worldview_default;const Dt=Object.values(mt.language||{});if(Dt.length===0)return null;const Ht=Object.values(mt.worldview||{});if(Ht.length===0)return null;const Gt=Dt.every(Qt=>Qt===St),qt=Ht.every(Qt=>Qt===It);return Gt&&qt?mt:St in(mt.language_options||{})||It in(mt.worldview_options||{})?null:mt.language_options&&mt.worldview_options?mt:null}(it.data,$,st);return pt?c.o.frame(()=>ht(null,pt)):it.url?c.m(d.transformRequest(d.normalizeSourceURL(it.url,null,$,st),c.R.Source),ht):c.o.frame(()=>{const{data:mt,...St}=it;ht(null,St)})}function Cu(it,d){const $=Math.pow(2,d.z),st=Math.floor(c.aF(it.getWest())*$),lt=Math.floor(c.aJ(it.getNorth())*$),ht=Math.ceil(c.aF(it.getEast())*$),pt=Math.ceil(c.aJ(it.getSouth())*$);return d.x>=st&&d.x<ht&&d.y>=lt&&d.y<pt}class Uu{constructor(d,$,st){this.bounds=d?c.aI.convert(this.validateBounds(d)):null,this.minzoom=$||0,this.maxzoom=st||24}validateBounds(d){return Array.isArray(d)&&d.length===4?[Math.max(-180,d[0]),Math.max(-90,d[1]),Math.min(180,d[2]),Math.min(90,d[3])]:[-180,-90,180,90]}addExtraBounds(d){if(d){this.extraBounds||(this.extraBounds=[]);for(const $ of d)this.extraBounds.push(c.aI.convert(this.validateBounds($)))}}contains(d){if(d.z>this.maxzoom||d.z<this.minzoom||this.bounds&&!Cu(this.bounds,d))return!1;if(!this.extraBounds)return!0;for(const $ of this.extraBounds)if(Cu($,d))return!0;return!1}static fromTileJSON(d){if(!d.bounds&&!d.extra_bounds)return null;const $=new Uu(d.bounds,d.minzoom,d.maxzoom);return $.addExtraBounds(d.extra_bounds),$}}class Km extends c.E{constructor(d,$,st,lt){if(super(),this.id=d,this.dispatcher=st,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,c.aH($,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},$),this._collectResourceTiming=!!$.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(lt),this._tileWorkers={},this._deduped=new c.aK}load(d){this._loaded=!1,this.fire(new c.z("dataloading",{dataType:"source"}));const $=Array.isArray(this.map._language)?this.map._language.join():this.map._language,st=this.map.getWorldview();this._tileJSONRequest=wu(this._options,this.map._requestManager,$,st,(lt,ht)=>{if(this._tileJSONRequest=null,this._loaded=!0,lt)$&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${$}`),st&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${st}`),this.fire(new c.y(lt));else if(ht){if(Object.assign(this,ht),this.hasWorldviews=!!ht.worldview_options,ht.worldview_default&&(this.worldviewDefault=ht.worldview_default),ht.vector_layers){this.vectorLayers=ht.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const pt of ht.vector_layers)this.vectorLayerIds.push(pt.id),ht.worldview&&ht.worldview[pt.source]&&this.localizableLayerIds.add(pt.id)}this.tileBounds=Uu.fromTileJSON(ht),tn(ht.tiles,this.map._requestManager._customAccessToken),this.fire(new c.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))}d&&d(lt)})}loaded(){return this._loaded}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}onAdd(d){this.map=d,this.load()}reload(){this.cancelTileJSONRequest();const d=c.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(d))}setTiles(d){return this._options.tiles=d,this.reload(),this}setUrl(d){return this.url=d,this._options.url=d,this.reload(),this}onRemove(d){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(d,$){const st=d.tileID.canonical.url(this.tiles,this.scheme),lt=this.map._requestManager.normalizeTileURL(st),ht=this.map._requestManager.transformRequest(lt,c.R.Tile),pt=this.map.style?this.map.style.getLut(this.scope):null,mt=pt?{image:pt.image.clone()}:null,St={request:ht,data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,lut:mt,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:c.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:d.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&c.h(st)&&(St.localizableLayerIds=this.localizableLayerIds),St.request.collectResourceTiming=this._collectResourceTiming,d.actor&&d.state!=="expired")d.state==="loading"?d.reloadCallback=$:d.request=d.actor.send("reloadTile",St,It.bind(this));else if(d.actor=this._tileWorkers[lt]=this._tileWorkers[lt]||this.dispatcher.getActor(),this.dispatcher.ready)d.request=d.actor.send("loadTile",St,It.bind(this),void 0,!0);else{const Dt=c.aL.call({deduped:this._deduped},St,(Ht,Gt)=>{if(Ht||!Gt)It.call(this,Ht);else{const qt=c.aM(Gt.responseHeaders);St.data={rawData:Gt.rawData.slice(0),expires:qt.expires,cacheControl:qt.cacheControl},d.actor&&d.actor.send("loadTile",St,It.bind(this),void 0,!0)}},!0);d.request={cancel:Dt}}function It(Dt,Ht){return delete d.request,d.aborted?$(null):Dt&&Dt instanceof c.aN&&Dt.status!==404?$(Dt):(Ht&&Ht.resourceTiming&&(d.resourceTiming=Ht.resourceTiming),this.map._refreshExpiredTiles&&Ht&&d.setExpiryData(Ht),d.loadVectorData(Ht,this.map.painter),c.aO(this.dispatcher),$(null,Ht),void(d.reloadCallback&&(this.loadTile(d,d.reloadCallback),d.reloadCallback=null)))}}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(d,$){d.actor&&d.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class mu extends c.E{constructor(d,$,st,lt){super(),this.id=d,this.dispatcher=st,this.setEventedParent(lt),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},$),Object.assign(this,c.aH($,["url","scheme","tileSize"]))}load(d){this._loaded=!1,this.fire(new c.z("dataloading",{dataType:"source"}));const $=this.map.getWorldview();this._tileJSONRequest=wu(this._options,this.map._requestManager,null,$,(st,lt)=>{this._tileJSONRequest=null,this._loaded=!0,st?this.fire(new c.y(st)):lt&&(Object.assign(this,lt),lt.raster_layers&&(this.rasterLayers=lt.raster_layers,this.rasterLayerIds=this.rasterLayers.map(ht=>ht.id)),this.tileBounds=Uu.fromTileJSON(lt),tn(lt.tiles),this.fire(new c.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))),d&&d(st)})}loaded(){return this._loaded}onAdd(d){this.map=d,this.load()}reload(){this.cancelTileJSONRequest();const d=c.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(d))}setTiles(d){return this._options.tiles=d,this.reload(),this}setUrl(d){return this.url=d,this._options.url=d,this.reload(),this}onRemove(d){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,$){const st=c.o.devicePixelRatio>=2,lt=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),st,this.tileSize);d.request=c.n(this.map._requestManager.transformRequest(lt,c.R.Tile),(ht,pt,mt)=>{if(delete d.request,d.aborted)return d.state="unloaded",$(null);if(ht)return d.state="errored",$(ht);if(!pt)return $(null);const St=c.aM(mt);this.map._refreshExpiredTiles&&d.setExpiryData(St),d.setTexture(pt,this.map.painter),d.state="loaded",c.aO(this.dispatcher),$(null)})}abortTile(d,$){d.request&&(d.request.cancel(),delete d.request),$&&$()}unloadTile(d,$){d.texture&&d.texture instanceof c.T?(d.destroy(!1),d.texture&&d.texture instanceof c.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),$&&$()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function _h([it,d],$,st,{scaled:lt=!0}={}){const{tileSize:ht,buffer:pt}=st,{x:mt,y:St,z:It}=$;if(!isFinite(mt)||!isFinite(St)||!isFinite(It))throw new Error("Invalid MRT header");const Dt=2**It,Ht=Dt*c.aF(it),Gt=Dt*c.aJ(d);return function([qt,Qt],Zt,{scaled:sr=!0}={}){if(!Zt)throw new Error("bandView is undefined");const{data:ir,tileSize:hr,buffer:gr,offset:dr,scale:Ir,dimension:Tr}=Zt;if(qt<-gr||qt>hr+gr||Qt<-gr||Qt>hr+gr)throw new Error(`Point (${qt}, ${Qt}) out of bounds for tileSize=${hr}, buffer=${gr}`);const Rr=(Qt+gr)*(hr+2*gr)+(qt+gr);if(new Uint32Array(ir.buffer)[Rr]===4294967295)return null;let Er=[];Er=sr?[]:new Zt.data.constructor(Tr);for(let vr=0;vr<Tr;vr++)Er[vr]=Math.round(1e12*(ir[Tr*Rr+vr]*Ir+dr))/1e12;return Er}([Math.min(Math.max(-pt,Math.floor((Ht-mt)*ht)),ht-1+pt),Math.min(Math.max(-pt,Math.floor((Gt-St)*ht)),ht-1+pt)],st,{scaled:lt})}class Du extends mu{constructor(d,$,st,lt){super(d,$,st,lt),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},$)}triggerRepaint(d){const $=this.map.painter._terrain,st=this.map.style.getSourceCache(this.id);$&&$.enabled&&st&&$._clearRenderCacheForTile(st.id,d.tileID),this.map.triggerRepaint()}loadTile(d,$){const st=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),lt=this.map._requestManager.transformRequest(st,c.R.Tile),ht={request:lt,uid:d.uid,tileID:d.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};d.source=this.id,d.scope=this.scope,d.requestParams=lt,d.actor||(d.actor=this.dispatcher.getActor());const pt=(mt,St,It)=>{if(delete d.request,d.aborted)return d.state="unloaded",$(null);if(mt)return mt.name==="AbortError"?void 0:(d.state="errored",$(mt));if(this.map._refreshExpiredTiles&&St){const Dt=c.aM(It);d.setExpiryData(Dt)}if(this.partial&&d.state!=="expired")d.state="empty";else if(!this.partial){if(!St)return $(null);d.state="loaded",d._isHeaderLoaded=!0,d._mrt=St}$(null)};d.request=this.partial?d.fetchHeader(void 0,pt.bind(this)):d.actor.send("loadTile",ht,pt.bind(this),void 0,!0)}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(d,$){const st=d.texturePerLayer;if(d.flushAllQueues(),st.size){d.destroy(!1);for(const lt of st.values())this.map.painter.saveTileTexture(lt)}else d.destroy()}prepareTile(d,$,st,lt){d._isHeaderLoaded&&(d.state!=="empty"&&(d.state="reloading"),d.fetchBandForRender($,st,lt,(ht,pt)=>{if(ht)return d.state="errored",this.fire(new c.y(ht)),void this.triggerRepaint(d);pt&&(d._isHeaderLoaded=!0,d.setTexturePerLayer(st,pt,this.map.painter),d.state="loaded",this.triggerRepaint(d))}))}getInitialBand(d){if(!this.rasterLayers)return 0;const $=this.rasterLayers.find(({id:ht})=>ht===d),st=$&&$.fields,lt=st&&st.bands&&st.bands;return lt?lt[0]:0}getTextureDescriptor(d,$,st){if(!d)return;const lt=$.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!lt)return;let ht=null;$ instanceof c.aR?ht=$.paint.get("raster-array-band"):$ instanceof c.aS&&(ht=$.paint.get("raster-particle-array-band"));const pt=ht||this.getInitialBand(lt);if(pt==null)return;if(!d.textureDescriptorPerLayer.get($.id))return void this.prepareTile(d,lt,$.id,pt);if(d.updateNeeded($.id,pt)&&!st)return;const mt=d.textureDescriptorPerLayer.get($.id);return Object.assign({},mt,{texture:d.texturePerLayer.get($.id)})}getImages(d,$){const st=new Map;for(const lt of d)for(const ht of $){const[pt,mt]=ht.split("/"),St=lt.getLayer(pt);if(!St||!St.hasBand(mt)||!St.hasDataForBand(mt))continue;const{bytes:It,tileSize:Dt,buffer:Ht}=St.getBandView(mt),Gt=Dt+2*Ht,qt={data:new c.q({width:Gt,height:Gt},It),pixelRatio:2,sdf:!1,usvg:!1,version:0};st.set(ht,qt)}return st}queryRasterArrayValueByBandId(d,$,st){const lt=$._mrt;return new Promise(ht=>{const pt={},mt=new Set;for(const[St,It]of Object.entries(lt.layers)){if(st.layerName&&St!==st.layerName)continue;const Dt={};pt[St]=Dt;for(const{bands:Ht}of It.dataIndex)for(const Gt of Ht)st.bands&&!st.bands.includes(Gt)||(mt.add(c.B(St,Gt)),$.fetchBand(St,null,Gt,qt=>{c.o.frame(()=>{Dt[Gt]=qt?null:_h([d.lng,d.lat],lt,It.getBandView(Gt)),mt.delete(c.B(St,Gt)),mt.size===0&&ht(pt)})},!1))}mt.size===0&&ht(pt)})}_loadTileForQuery(d,$){if(this._loadTileLoaded[d.uid])return void $(null,d._mrt);if(this._loadTilePending[d.uid])return void this._loadTilePending[d.uid].push($);this._loadTilePending[d.uid]=[$];const st=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),lt=this.map._requestManager.transformRequest(st,c.R.Tile);d.actor.send("loadTile",{request:lt,uid:d.uid,tileID:d.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(ht,pt,mt)=>{if(ht)return this._loadTilePending[d.uid].forEach(St=>St(ht,null)),void delete this._loadTilePending[d.uid];if(!pt)return this._loadTilePending[d.uid].forEach(St=>St(null,null)),void delete this._loadTilePending[d.uid];if(this.map._refreshExpiredTiles&&pt){const St=c.aM(mt);d.setExpiryData(St)}d._mrt=pt,d._isHeaderLoaded=!0,d.state="loaded",this._loadTilePending[d.uid].forEach(St=>St(null,pt)),this._loadTileLoaded[d.uid]=!0,delete this._loadTilePending[d.uid]},void 0,!0)}queryRasterArrayValueByAllBands(d,$,st){return new Promise((lt,ht)=>{this._loadTileForQuery($,(pt,mt)=>{pt?ht(pt):lt(mt?this.queryRasterArrayValueByBandId(d,$,st):null)})})}queryRasterArrayValue(d,$){const st=c.aT.convert(d),lt=this.findLoadedParent(st);return lt&&lt._mrt?$.bands||!this.partial?this.queryRasterArrayValueByBandId(st,lt,$):this.queryRasterArrayValueByAllBands(st,lt,$):Promise.resolve(null)}findLoadedParent(d){const $=c.ae.fromLngLat(d,this.map.transform.tileSize),st=this.maxzoom+1,lt=1<<st,ht=Math.floor($.x),pt=Math.floor(($.x-ht)*lt),mt=Math.floor($.y*lt),St=this.map.style.getSourceCache(this.id),It=new c.aQ(st,ht,st,pt,mt);return St.findLoadedParent(It,this.minzoom)}}const Dp={vector:Km,raster:mu,"raster-dem":class extends mu{constructor(it,d,$,st){super(it,d,$,st),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}loadTile(it,d){const $=this.map._requestManager.normalizeTileURL(it.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function st(lt,ht){lt&&(it.state="errored",d(lt)),ht&&(it.dem=ht,it.dem.onDeserialize(),it.needsHillshadePrepare=!0,it.needsDEMTextureUpload=!0,it.state="loaded",d(null))}it.request=c.n(this.map._requestManager.transformRequest($,c.R.Tile),(function(lt,ht,pt){if(delete it.request,it.aborted)it.state="unloaded",d(null);else if(lt)it.state="errored",d(lt);else if(ht){const mt=c.aM(pt);this.map._refreshExpiredTiles&&it.setExpiryData(mt);const St=ImageBitmap&&ht instanceof ImageBitmap&&c.r(),It=1-(ht.width-c.aP(ht.width))/2;It<1||it.neighboringTiles||(it.neighboringTiles=this._getNeighboringTiles(it.tileID));const Dt=St?ht:c.o.getImageData(ht,It),Ht={uid:it.uid,tileID:it.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:Dt,encoding:this.encoding,padding:It};it.actor&&it.state!=="expired"||(it.actor=this.dispatcher.getActor(),it.actor.send("loadTile",Ht,st.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(it){const d=it.canonical,$=Math.pow(2,d.z),st=(d.x-1+$)%$,lt=d.x===0?it.wrap-1:it.wrap,ht=(d.x+1+$)%$,pt=d.x+1===$?it.wrap+1:it.wrap,mt={};return mt[new c.aQ(it.overscaledZ,lt,d.z,st,d.y).key]={backfilled:!1},mt[new c.aQ(it.overscaledZ,pt,d.z,ht,d.y).key]={backfilled:!1},d.y>0&&(mt[new c.aQ(it.overscaledZ,lt,d.z,st,d.y-1).key]={backfilled:!1},mt[new c.aQ(it.overscaledZ,it.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},mt[new c.aQ(it.overscaledZ,pt,d.z,ht,d.y-1).key]={backfilled:!1}),d.y+1<$&&(mt[new c.aQ(it.overscaledZ,lt,d.z,st,d.y+1).key]={backfilled:!1},mt[new c.aQ(it.overscaledZ,it.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},mt[new c.aQ(it.overscaledZ,pt,d.z,ht,d.y+1).key]={backfilled:!1}),mt}},"raster-array":Du,geojson:class extends c.E{constructor(it,d,$,st){super(),this.id=it,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=$.getActor(),this.setEventedParent(st),this._data=d.data,this._options=Object.assign({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.minzoom!==void 0&&(this.minzoom=d.minzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const lt=c.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*lt,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*lt,extent:c.al,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:c.al,radius:(d.clusterRadius!==void 0?d.clusterRadius:50)*lt,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter,dynamic:d.dynamic},d.workerOptions)}onAdd(it){this.map=it,this.setData(this._data)}setData(it){return this._data=it,this._updateWorkerData(),this}updateData(it){if(!this._options.dynamic)return this.fire(new c.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof it!="string"&&(it.type==="Feature"&&(it={type:"FeatureCollection",features:[it]}),it.type!=="FeatureCollection"))return this.fire(new c.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof it!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const d=new Map;for(const $ of this._data.features)d.set($.id,$);for(const $ of it.features)d.set($.id,$);this._data.features=[...d.values()]}else this._data=it;return this._updateWorkerData(!0),this}getClusterExpansionZoom(it,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:it,source:this.id,scope:this.scope},d),this}getClusterChildren(it,d){return this.actor.send("geojson.getClusterChildren",{clusterId:it,source:this.id,scope:this.scope},d),this}getClusterLeaves(it,d,$,st){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:it,limit:d,offset:$},st),this}_updateWorkerData(it=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new c.z("dataloading",{dataType:"source"})),this._loaded=!1;const d=Object.assign({append:it},this.workerOptions);d.scope=this.scope;const $=this._data;typeof $=="string"?(d.request=this.map._requestManager.transformRequest(c.o.resolveURL($),c.R.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify($),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(st,lt)=>{if(this._loaded=!0,this._pendingLoad=null,st)this.fire(new c.y(st));else{const ht={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&lt&&lt.resourceTiming&&lt.resourceTiming[this.id]&&(ht.resourceTiming=lt.resourceTiming[this.id]),it&&(this._partialReload=!0),this.fire(new c.z("data",ht)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(it),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const it=c.B(this.id,this.scope);this.map.style.clearSource(it),this._updateWorkerData()}loadTile(it,d){const $=it.actor?"reloadTile":"loadTile";it.actor=this.actor;const st=this.map.style?this.map.style.getLut(this.scope):null,lt=st?{image:st.image.clone()}:null,ht=this._partialReload,pt={type:this.type,uid:it.uid,tileID:it.tileID,tileZoom:it.tileZoom,zoom:it.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:lt,scope:this.scope,pixelRatio:c.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:it.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:ht,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};it.request=this.actor.send($,pt,(mt,St)=>ht&&!St?(it.state="loaded",d(null)):(delete it.request,it.destroy(!1),it.aborted?d(null):mt?d(mt):(it.loadVectorData(St,this.map.painter,$==="reloadTile"),d(null))),void 0,$==="loadTile")}abortTile(it){it.request&&(it.request.cancel(),delete it.request),it.aborted=!0}unloadTile(it,d){this.actor.send("removeTile",{uid:it.uid,type:this.type,source:this.id,scope:this.scope}),it.destroy()}onRemove(it){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends c.aU{constructor(it,d,$,st){super(it,d,$,st),this.roundZoom=!0,this.type="video",this.options=d}load(){this._loaded=!1;const it=this.options;this.urls=[];for(const d of it.urls)this.urls.push(this.map._requestManager.transformRequest(d,c.R.Source).url);c.aV(this.urls,(d,$)=>{this._loaded=!0,d?this.fire(new c.y(d)):$&&(this.video=$,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(it){if(this.video){const d=this.video.seekable;it<d.start(0)||it>d.end(0)?this.fire(new c.y(new c.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=it}}getVideo(){return this.video}onAdd(it){this.map||(this.map=it,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const it=this.map.painter.context,d=it.gl;this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(it,this.video,d.RGBA8),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(it)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:c.aU,model:c.aX,"batched-model":class extends c.E{constructor(it,d,$,st){super(),this.type="batched-model",this.id=it,this.tileSize=512,this._options=d,this.tiles=this._options.tiles,this.maxzoom=d.maxzoom||19,this.minzoom=d.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=$,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(st)}onAdd(it){this.map=it,this.load()}reload(){this.cancelTileJSONRequest();const it=c.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(it))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(it){this._loaded=!1,this.fire(new c.z("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,$=this.map.getWorldview();this._tileJSONRequest=wu(this._options,this.map._requestManager,d,$,(st,lt)=>{this._tileJSONRequest=null,this._loaded=!0,st?(d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),$&&$.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${$}`),this.fire(new c.y(st))):lt&&(Object.assign(this,lt),lt.bounds&&(this.tileBounds=new Uu(lt.bounds,this.minzoom,this.maxzoom)),tn(lt.tiles,this.map._requestManager._customAccessToken),this.fire(new c.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))),it&&it(st)})}hasTransition(){return!1}hasTile(it){return!this.tileBounds||this.tileBounds.contains(it.canonical)}loaded(){return this._loaded}loadTile(it,d){const $=this.map._requestManager.normalizeTileURL(it.tileID.canonical.url(this.tiles,this.scheme)),st={request:this.map._requestManager.transformRequest($,c.R.Tile),data:void 0,uid:it.uid,tileID:it.tileID,tileZoom:it.tileZoom,zoom:it.tileID.overscaledZ,tileSize:this.tileSize*it.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:it.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:c.o.devicePixelRatio,promoteId:this.promoteId};if(it.actor&&it.state!=="expired")if(it.state==="loading")it.reloadCallback=d;else{if(it.buckets){const ht=Object.values(it.buckets);for(const pt of ht)pt.dirty=!0;return void(it.state="loaded")}it.request=it.actor.send("reloadTile",st,lt.bind(this))}else it.actor=this.dispatcher.getActor(),it.request=it.actor.send("loadTile",st,lt.bind(this),void 0,!0);function lt(ht,pt){return it.aborted?d(null):ht&&ht.status!==404?d(ht):(this.map._refreshExpiredTiles&&pt&&it.setExpiryData(pt),it.loadModelData(pt,this.map.painter),it.state="loaded",void d(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends c.aU{constructor(it,d,$,st){super(it,d,$,st),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(lt=>!Array.isArray(lt)||lt.length!==2||lt.some(ht=>typeof ht!="number"))||this.fire(new c.y(new c.V(`sources.${it}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.y(new c.V(`sources.${it}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new c.y(new c.V(`sources.${it}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new c.y(new c.V(`sources.${it}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.y(new c.V(`sources.${it}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(it){this.map=it,this.load(),this.canvas&&this.animate&&this.play()}onRemove(it){this.pause()}prepare(){let it=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,it=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,it=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context;this.texture?!it&&!this._playing||this.texture instanceof c.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.T(d,this.canvas,d.gl.RGBA8,{premultiply:!0}),this._prepareData(d)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const it of[this.canvas.width,this.canvas.height])if(isNaN(it)||it<=0)return!0;return!1}},custom:class extends c.E{constructor(it,d,$,st){super(),this.id=it,this.type="custom",this._dataType="raster",this._dispatcher=$,this._implementation=d,this.setEventedParent(st),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new c.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new c.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Uu(this._implementation.bounds,this.minzoom,this.maxzoom)),d.update=this._update.bind(this),d.clearTiles=this._clearTiles.bind(this),d.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,c.aH(d,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return c.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new c.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(it){this.map=it,this._loaded=!1,this.fire(new c.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(it),this.load()}onRemove(it){this._implementation.onRemove&&this._implementation.onRemove(it)}hasTile(it){if(this._implementation.hasTile){const{x:d,y:$,z:st}=it.canonical;return this._implementation.hasTile({x:d,y:$,z:st})}return!this.tileBounds||this.tileBounds.contains(it.canonical)}loadTile(it,d){const{x:$,y:st,z:lt}=it.tileID.canonical,ht=new AbortController;it.request=Promise.resolve(this._implementation.loadTile({x:$,y:st,z:lt},{signal:ht.signal})).then((function(pt){return delete it.request,it.aborted?(it.state="unloaded",d(null)):pt===void 0?(it.state="errored",d(null)):pt===null?(this.loadTileData(it,{width:this.tileSize,height:this.tileSize,data:null}),it.state="loaded",d(null)):function(mt){return mt instanceof ImageData||mt instanceof HTMLCanvasElement||mt instanceof ImageBitmap||mt instanceof HTMLImageElement}(pt)?(this.loadTileData(it,pt),it.state="loaded",void d(null)):(it.state="errored",d(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(pt=>{pt.name!=="AbortError"&&(it.state="errored",d(pt))}),it.request.cancel=()=>ht.abort()}loadTileData(it,d){it.setTexture(d,this.map.painter)}unloadTile(it,d){if(it.texture&&it.texture instanceof c.T?(it.destroy(!1),it.texture&&it.texture instanceof c.T&&this.map.painter.saveTileTexture(it.texture)):it.destroy(),this._implementation.unloadTile){const{x:$,y:st,z:lt}=it.tileID.canonical;this._implementation.unloadTile({x:$,y:st,z:lt})}d&&d()}abortTile(it,d){it.request&&it.request.cancel&&(it.request.cancel(),delete it.request),d&&d()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(it=>({x:it.canonical.x,y:it.canonical.y,z:it.canonical.z}))}_clearTiles(){const it=c.B(this.id,this.scope);this.map.style.clearSource(it)}_update(){this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))}}},hu=function(it,d,$,st){const lt=new Dp[d.type](it,d,$,st);if(lt.id!==it)throw new Error(`Expected Source id to be ${it} instead of ${lt.id}`);return c.aY(["load","abort","unload","serialize","prepare"],lt),lt};function Xm(it,d,$=""){return`${$}:${d.id||""}:${d.layer.id}:${function(st){if("layerId"in st)return`layer:${st.layerId}`;{const{featuresetId:lt,importId:ht}=st;return`featureset:${lt}${ht?`:import:${ht}`:""}`}}(it.target)}`}function v0(it,d,$,st=""){if(it.uniqueFeatureID){const lt=Xm(it,d,st);if($.has(lt))return!0;$.add(lt)}return!1}function ax(it,d,$,st,lt=!1){const ht=d.sourceCache.transform,pt=d.sourceCache.tilesIn(it,d.has3DLayers,lt);pt.sort(ay);const mt=[];for(const St of pt){const It=St.tile.queryRenderedFeatures(d,St,$,st,ht,lt);Object.keys(It).length&&mt.push({wrappedTileID:St.tile.tileID.wrapped().key,queryResults:It})}for(const St in d.layers){const It=d.layers[St];if(It.styleLayer){const Dt=It.styleLayer.queryRenderedFeatures(it,d.sourceCache,st);Object.keys(Dt).length&&mt.push({wrappedTileID:0,queryResults:Dt})}}return mt.length===0?{}:function(St){const It={},Dt={};for(const Ht of St){const Gt=Ht.queryResults,qt=Ht.wrappedTileID,Qt=Dt[qt]=Dt[qt]||{};for(const Zt in Gt){const sr=Gt[Zt],ir=Qt[Zt]=Qt[Zt]||{},hr=It[Zt]=It[Zt]||[];for(const gr of sr)ir[gr.featureIndex]||(ir[gr.featureIndex]=!0,hr.push(gr))}}return It}(mt)}function lx(it,d,$,st,lt,ht){const pt={},mt=st.queryRenderedSymbols(it),St=[];for(const It of Object.keys(mt).map(Number))St.push(lt[It]);St.sort(ay);for(const It of St){const Dt=It.featureIndex.lookupSymbolFeatures(mt[It.bucketInstanceId],It.bucketIndex,It.sourceLayerIndex,d,$,ht);for(const Ht in Dt){const Gt=pt[Ht]=pt[Ht]||[],qt=Dt[Ht];qt.sort((Qt,Zt)=>{const sr=It.featureSortOrder;if(sr){const ir=sr.indexOf(Qt.featureIndex);return sr.indexOf(Zt.featureIndex)-ir}return Zt.featureIndex-Qt.featureIndex});for(const Qt of qt)Gt.push(Qt)}}return pt}function ux(it,d){const $=it.getRenderableIds().map(ht=>it.getTileByID(ht)),st=[],lt={};for(let ht=0;ht<$.length;ht++){const pt=$[ht],mt=pt.tileID.canonical.key;lt[mt]||(lt[mt]=!0,pt.querySourceFeatures(st,d))}return st}function ay(it,d){const $=it.tileID,st=d.tileID;return $.overscaledZ-st.overscaledZ||$.canonical.y-st.canonical.y||$.wrap-st.wrap||$.canonical.x-st.canonical.x}function Np(it,d){const $={};if(!d)return $;for(const st of it){const lt=st.layerIds.map(ht=>d.getLayer(ht)).filter(Boolean);if(lt.length!==0){st.layers=lt,st.stateDependentLayerIds&&(st.stateDependentLayers=st.stateDependentLayerIds.map(ht=>lt.filter(pt=>pt.id===ht)[0]));for(const ht of lt)$[ht.fqid]=st}}return $}const $u=32,wp=33,Ep=new Uint16Array(8184);for(let it=0;it<2046;it++){let d=it+2,$=0,st=0,lt=0,ht=0,pt=0,mt=0;for(1&d?lt=ht=pt=$u:$=st=mt=$u;(d>>=1)>1;){const It=$+lt>>1,Dt=st+ht>>1;1&d?(lt=$,ht=st,$=pt,st=mt):($=lt,st=ht,lt=pt,ht=mt),pt=It,mt=Dt}const St=4*it;Ep[St+0]=$,Ep[St+1]=st,Ep[St+2]=lt,Ep[St+3]=ht}const up=new Uint16Array(2178),Lp=new Uint8Array(1089),wm=new Uint16Array(1089);function Zm(it){return it===0?-.03125:it===32?.03125:0}const hx={type:2,extent:c.al,loadGeometry:()=>[[new c.P(0,0),new c.P(c.al+1,0),new c.P(c.al+1,c.al+1),new c.P(0,c.al+1),new c.P(0,0)]]};class Ym{constructor(d,$,st,lt,ht,pt){this.tileID=d,this.uid=c.b2(),this.uses=0,this.tileSize=$,this.tileZoom=st,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=ht,lt&&lt.style&&(this._lastUpdatedBrightness=lt.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",lt&&lt.transform&&(this.projection=lt.transform.projection),this.worldview=pt,this._hasAppearances=null}registerFadeDuration(d){const $=d+this.timeAdded;$<c.o.now()||this.fadeEndTime&&$<this.fadeEndTime||(this.fadeEndTime=$)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=c.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(d,$,st){if(this.unloadVectorData(),this.state="loaded",d){d.featureIndex&&(this.latestFeatureIndex=d.featureIndex,d.rawTileData?(this.latestRawTileData=d.rawTileData,this.latestFeatureIndex.rawTileData=d.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=d.collisionBoxArray,this.buckets=Np(d.buckets,$.style),this.hasSymbolBuckets=!1;for(const lt in this.buckets){const ht=this.buckets[lt];if(ht instanceof c.b4){if(this.hasSymbolBuckets=!0,!st)break;ht.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const lt in this.buckets){const ht=this.buckets[lt];if(ht instanceof c.b4&&ht.hasRTLText){this.hasRTLText=!0,c.b5();break}}this.queryPadding=0;for(const lt in this.buckets){const ht=this.buckets[lt],pt=$.style.getOwnLayer(lt);if(!pt)continue;const mt=pt.queryRadius(ht);this.queryPadding=Math.max(this.queryPadding,mt)}d.imageAtlas&&(this.imageAtlas=d.imageAtlas),d.glyphAtlasImage&&(this.glyphAtlasImage=d.glyphAtlasImage),d.lineAtlas&&(this.lineAtlas=d.lineAtlas),this._lastUpdatedBrightness=d.brightness}else this.collisionBoxArray=new c.b3}unloadVectorData(){if(this.hasData()){for(const d in this.buckets)this.buckets[d].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(d,$,st){d&&(d.resourceTiming&&(this.resourceTiming=d.resourceTiming),this.buckets=Object.assign({},this.buckets,Np(d.buckets,$.style)),d.featureIndex&&(this.latestFeatureIndex=d.featureIndex))}getBucket(d){return this.buckets[d.fqid]}upload(d,$){for(const ht in this.buckets){const pt=this.buckets[ht];if(pt.uploadPending()){let mt={},St=[],It={zoom:0,pitch:0,brightness:0,worldview:""};if($){if($.style){St=$.style.listImages();const Dt=pt.layers[0],Ht=Dt.sourceLayer||"_geojsonTileLayer",Gt=$.style.getLayerSourceCache(Dt);Gt&&(mt=Gt._state.getState(Ht,void 0))}It={zoom:$.transform.zoom||0,pitch:$.transform.pitch||0,brightness:$.style.getBrightness()||0,worldview:$.worldview||""}}pt.upload(d,this.tileID.canonical,mt,St,It)}}const st=d.gl,lt=this.imageAtlas;lt&&!lt.uploaded&&(this.imageAtlasTexture=new c.T(d,lt.image,st.RGBA8,{useMipmap:!!lt.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(d,this.glyphAtlasImage,st.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new c.T(d,this.lineAtlas.image,st.R8),this.lineAtlas.uploaded=!0)}prepare(d,$,st){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(d,this.imageAtlasTexture,st),!$||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const lt=$.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances($)),(this._lastUpdatedBrightness||lt||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&lt&&Math.abs(this._lastUpdatedBrightness-lt)<.001||(this.updateBuckets($,this._lastUpdatedBrightness!==lt),this._lastUpdatedBrightness=lt))}evaluateQueryRenderedFeaturePadding(){let d=0;for(const $ in this.buckets){const st=this.buckets[$];st.evaluateQueryRenderedFeaturePadding&&(d=Math.max(d,st.evaluateQueryRenderedFeaturePadding()))}return d}queryRenderedFeatures(d,$,st,lt,ht,pt){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const mt=this.evaluateQueryRenderedFeaturePadding(),St=function(It,Dt){const Ht=c.bq([],[.5*It.width,.5*-It.height,1]);return c.br(Ht,Ht,[1,-1,0]),c.aB(Ht,Ht,It.calculateProjMatrix(Dt.toUnwrapped())),Float32Array.from(Ht)}(ht,this.tileID);return this.latestFeatureIndex.query(d,{tilespaceGeometry:$,pixelPosMatrix:St,transform:lt,availableImages:st,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:mt})}querySourceFeatures(d,$){const st=this.latestFeatureIndex;if(!st||!st.rawTileData)return;const lt=st.loadVTLayers(),ht=$?$.sourceLayer:"",pt=lt._geojsonTileLayer||lt[ht];if(!pt)return;const mt=c.b6($&&$.filter),{z:St,x:It,y:Dt}=this.tileID.canonical,Ht={z:St,x:It,y:Dt};for(let Gt=0;Gt<pt.length;Gt++){const qt=pt.feature(Gt);if(mt.needGeometry){const sr=c.b7(qt,!0);if(!mt.filter(new c.ac(this.tileID.overscaledZ,{worldview:this.worldview}),sr,this.tileID.canonical))continue}else if(!mt.filter(new c.ac(this.tileID.overscaledZ,{worldview:this.worldview}),qt))continue;const Qt=st.getId(qt,ht),Zt=new c.b8(qt,St,It,Dt,Qt);Zt.tile=Ht,d.push(Zt)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(d){const $=this.expirationTime;if(d.cacheControl){const st=c.b9(d.cacheControl);st["max-age"]&&(this.expirationTime=Date.now()+1e3*st["max-age"])}else d.expires&&(this.expirationTime=new Date(d.expires).getTime());if(this.expirationTime){const st=Date.now();let lt=!1;if(this.expirationTime>st)lt=!1;else if($)if(this.expirationTime<$)lt=!0;else{const ht=this.expirationTime-$;ht?this.expirationTime=st+Math.max(ht,3e4):lt=!0}else lt=!0;lt?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(d){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&d&&this.updateBuckets(d)}hasAppearances(d){for(const $ in this.buckets)if(d.style.hasLayer($)&&this.buckets[$].layers.some(st=>st.appearances&&st.appearances.length>0))return!0;return!1}updateBuckets(d,$){if(!this.latestFeatureIndex||!d.style)return;const st=d.style.listImages(),lt=d.style.getBrightness();for(const ht in this.buckets){if(!d.style.hasLayer(ht))continue;const pt=this.buckets[ht],mt=pt.layers[0],St=mt.sourceLayer||"_geojsonTileLayer",It=d.style.getLayerSourceCache(mt);let Dt={};It&&(Dt=It._state.getState(St,void 0));const Ht=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Gt=Object.keys(Dt).length>0&&!$;pt.hasAppearances=pt.layers.some(Zt=>Zt.appearances&&Zt.appearances.length>0);const qt=Gt?pt.stateDependentLayers:pt.layers;if(Gt&&pt.stateDependentLayers.length!==0||$){const Zt=this.latestFeatureIndex.loadVTLayers();pt.update(Dt,Zt[St],st,Ht,qt,$,lt)}if(Gt&&pt.stateDependentLayers.length!==0||$||pt.hasAppearances){const Zt={zoom:d.transform.zoom,pitch:d.transform.pitch,brightness:d.style.getBrightness()||0,worldview:d.worldview};pt.updateAppearances(this.tileID.canonical,Dt,st,Zt)}(pt instanceof c.ba||pt instanceof c.bb)&&d._terrain&&d._terrain.enabled&&It&&pt.uploadPending()&&d._terrain._clearRenderCacheForTile(It.id,this.tileID);const Qt=d&&d.style&&d.style.getOwnLayer(ht);Qt&&(this.queryPadding=Math.max(this.queryPadding,Qt.queryRadius(pt)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<c.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(d){this.symbolFadeHoldUntil=c.o.now()+d}setTexture(d,$){const st=$.context,lt=st.gl;this.texture=this.texture||$.getTileTexture(d.width),this.texture&&this.texture instanceof c.T?this.texture.update(d):(this.texture=new c.T(st,d,lt.RGBA8,{useMipmap:!0}),this.texture.bind(lt.LINEAR,lt.CLAMP_TO_EDGE))}setDependencies(d,$){const st={};for(const lt of $)st[lt]=!0;this.dependencies[d]=st}hasDependency(d,$){for(const st of d){const lt=this.dependencies[st];if(lt){for(const ht of $)if(lt[ht])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(d,$){if(!$||$.name==="mercator"||this._tileDebugBuffer)return;const st=c.bc(hx,this.tileID.canonical,this.tileTransform)[0],lt=new c.bd,ht=new c.be;for(let pt=0;pt<st.length;pt++){const{x:mt,y:St}=st[pt];lt.emplaceBack(mt,St),ht.emplaceBack(pt)}ht.emplaceBack(0),this._tileDebugIndexBuffer=d.createIndexBuffer(ht),this._tileDebugBuffer=d.createVertexBuffer(lt,c.bf.members),this._tileDebugSegments=c.bg.simpleSegment(0,0,lt.length,ht.length)}_makeTileBoundsBuffers(d,$){if(this._tileBoundsBuffer||!$||$.name==="mercator")return;const st=c.bc(hx,this.tileID.canonical,this.tileTransform)[0];let lt,ht;if(this.isRaster){const pt=function(mt,St){const It=c.aZ(mt,St),Dt=Math.pow(2,mt.z);for(let sr=0;sr<wp;sr++)for(let ir=0;ir<wp;ir++){const hr=c.a_((mt.x+(ir+Zm(ir))/$u)/Dt),gr=c.a$((mt.y+(sr+Zm(sr))/$u)/Dt),dr=St.project(hr,gr),Ir=sr*wp+ir;up[2*Ir+0]=Math.round((dr.x*It.scale-It.x)*c.al),up[2*Ir+1]=Math.round((dr.y*It.scale-It.y)*c.al)}Lp.fill(0),wm.fill(0);for(let sr=2045;sr>=0;sr--){const ir=4*sr,hr=Ep[ir+0],gr=Ep[ir+1],dr=Ep[ir+2],Ir=Ep[ir+3],Tr=hr+dr>>1,Rr=gr+Ir>>1,Er=Tr+Rr-gr,vr=Rr+hr-Tr,kr=gr*wp+hr,Ur=Ir*wp+dr,zr=Rr*wp+Tr,Jr=Math.hypot((up[2*kr+0]+up[2*Ur+0])/2-up[2*zr+0],(up[2*kr+1]+up[2*Ur+1])/2-up[2*zr+1])>=16;Lp[zr]=Lp[zr]||(Jr?1:0),sr<1022&&(Lp[zr]=Lp[zr]||Lp[(gr+vr>>1)*wp+(hr+Er>>1)]||Lp[(Ir+vr>>1)*wp+(dr+Er>>1)])}const Ht=new c.b1,Gt=new c.b0;let qt=0;function Qt(sr,ir){const hr=ir*wp+sr;return wm[hr]===0&&(Ht.emplaceBack(up[2*hr+0],up[2*hr+1],sr*c.al/$u,ir*c.al/$u),wm[hr]=++qt),wm[hr]-1}function Zt(sr,ir,hr,gr,dr,Ir){const Tr=sr+hr>>1,Rr=ir+gr>>1;if(Math.abs(sr-dr)+Math.abs(ir-Ir)>1&&Lp[Rr*wp+Tr])Zt(dr,Ir,sr,ir,Tr,Rr),Zt(hr,gr,dr,Ir,Tr,Rr);else{const Er=Qt(sr,ir),vr=Qt(hr,gr),kr=Qt(dr,Ir);Gt.emplaceBack(Er,vr,kr)}}return Zt(0,0,$u,$u,$u,0),Zt($u,$u,0,0,0,$u),{vertices:Ht,indices:Gt}}(this.tileID.canonical,$);lt=pt.vertices,ht=pt.indices}else{lt=new c.b1,ht=new c.b0;for(const{x:mt,y:St}of st)lt.emplaceBack(mt,St,0,0);const pt=c.bh(lt.int16.subarray(0,4*lt.length),void 0,4);for(let mt=0;mt<pt.length;mt+=3)ht.emplaceBack(pt[mt],pt[mt+1],pt[mt+2])}this._tileBoundsBuffer=d.createVertexBuffer(lt,c.bi.members),this._tileBoundsIndexBuffer=d.createIndexBuffer(ht),this._tileBoundsSegments=c.bg.simpleSegment(0,0,lt.length,ht.length)}_makeGlobeTileDebugBuffers(d,$){const st=$.projection;if(!st||st.name!=="globe"||$.freezeTileCoverage)return;const lt=this.tileID.canonical,ht=c.bj(lt,$),pt=c.bk(ht),mt=c.aj($.zoom);let St;mt>0&&(St=c.bl(new Float64Array(16),$.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(d,lt,$,pt,St,mt),this._makeGlobeTileDebugTextBuffer(d,lt,$,pt,St,mt)}_globePoint(d,$,st,lt,ht,pt,mt){let St=c.bm(d,$,st);if(pt){const It=1<<st.z,Dt=c.aF(lt.center.lng),Ht=c.aJ(lt.center.lat),Gt=(st.x+.5)/It-Dt;let qt=0;Gt>.5?qt=-1:Gt<-.5&&(qt=1);let Qt=(d/c.al+st.x)/It+qt,Zt=($/c.al+st.y)/It;Qt=(Qt-Dt)*lt._pixelsPerMercatorPixel+Dt,Zt=(Zt-Ht)*lt._pixelsPerMercatorPixel+Ht;const sr=[Qt*lt.worldSize,Zt*lt.worldSize,0];c.af(sr,sr,pt),St=c.bn(St,sr,mt)}return c.af(St,St,ht)}_makeGlobeTileDebugBorderBuffer(d,$,st,lt,ht,pt){const mt=new c.bd,St=new c.be,It=new c.bo,Dt=(Gt,qt,Qt,Zt,sr)=>{const ir=(Qt-Gt)/(sr-1),hr=(Zt-qt)/(sr-1),gr=mt.length;for(let dr=0;dr<sr;dr++){const Ir=Gt+dr*ir,Tr=qt+dr*hr;mt.emplaceBack(Ir,Tr);const Rr=this._globePoint(Ir,Tr,$,st,lt,ht,pt);It.emplaceBack(Rr[0],Rr[1],Rr[2]),St.emplaceBack(gr+dr)}},Ht=c.al;Dt(0,0,Ht,0,16),Dt(Ht,0,Ht,Ht,16),Dt(Ht,Ht,0,Ht,16),Dt(0,Ht,0,0,16),this._tileDebugIndexBuffer=d.createIndexBuffer(St),this._tileDebugBuffer=d.createVertexBuffer(mt,c.bf.members),this._globeTileDebugBorderBuffer=d.createVertexBuffer(It,c.bp.members),this._tileDebugSegments=c.bg.simpleSegment(0,0,mt.length,St.length)}_makeGlobeTileDebugTextBuffer(d,$,st,lt,ht,pt){const mt=c.al/4,St=new c.bd,It=new c.b0,Dt=new c.bo,Ht=25;It.reserve(32),St.reserve(Ht),Dt.reserve(Ht);const Gt=(qt,Qt)=>Ht*qt+Qt;for(let qt=0;qt<Ht;qt++){const Qt=qt*mt;for(let Zt=0;Zt<Ht;Zt++){const sr=Zt*mt;St.emplaceBack(sr,Qt);const ir=this._globePoint(sr,Qt,$,st,lt,ht,pt);Dt.emplaceBack(ir[0],ir[1],ir[2])}}for(let qt=0;qt<4;qt++)for(let Qt=0;Qt<4;Qt++){const Zt=Gt(qt,Qt),sr=Gt(qt,Qt+1),ir=Gt(qt+1,Qt),hr=Gt(qt+1,Qt+1);It.emplaceBack(Zt,sr,ir),It.emplaceBack(ir,sr,hr)}this._tileDebugTextIndexBuffer=d.createIndexBuffer(It),this._tileDebugTextBuffer=d.createVertexBuffer(St,c.bf.members),this._globeTileDebugTextBuffer=d.createVertexBuffer(Dt,c.bp.members),this._tileDebugTextSegments=c.bg.simpleSegment(0,0,Ht,32)}destroy(d=!0){for(const $ in this.buckets)this.buckets[$].destroy(d);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),d&&this.texture&&this.texture instanceof c.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof c.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}c.bs.setPbf(c.bt);class dx extends Ym{constructor(d,$,st,lt,ht){super(d,$,st,lt,ht),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(d){return this._mrt&&this._mrt.getLayer(d)}setTexturePerLayer(d,$,st){const lt=st.context,ht=lt.gl;let pt=this.texturePerLayer.get(d)||st.getTileTexture($.width);pt&&pt instanceof c.T?pt.update($,{premultiply:!1}):pt=new c.T(lt,$,ht.RGBA8,{premultiply:!1}),this.texturePerLayer.has(d)||this.texturePerLayer.set(d,pt)}flushQueues(d){const $=this._workQueuePerLayer.get(d)||[],st=this._fetchQueuePerLayer.get(d)||[];for(;$.length;)$.pop()();for(;st.length;)st.pop()()}flushAllQueues(){for(const d of this._workQueuePerLayer.keys()){const $=this._workQueuePerLayer.get(d)||[];for(;$.length;)$.pop()()}for(const d of this._fetchQueuePerLayer.keys()){const $=this._fetchQueuePerLayer.get(d)||[];for(;$.length;)$.pop()()}}fetchHeader(d=16384,$){const st=this._mrt=new c.bs(30),lt=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(d-1)}});return this.entireBuffer=null,this.request=c.bu(lt,(ht,pt,mt)=>{if(ht)$(ht);else try{const St=st.getHeaderLength(pt);if(St>d)return void(this.request=this.fetchHeader(St,$));st.parseHeader(pt),this._isHeaderLoaded=!0;let It=0;for(const Dt of Object.values(st.layers))It=Math.max(It,Dt.dataIndex[Dt.dataIndex.length-1].lastByte);pt.byteLength>=It&&(this.entireBuffer=pt),$(null,this.entireBuffer||pt,mt)}catch(St){$(St)}}),this.request}fetchBandForRender(d,$,st,lt){this.fetchBand(d,$,st,ht=>{if(ht)return void lt(ht);this.updateTextureDescriptor(d,$,st);const pt=this.textureDescriptorPerLayer.get($);lt(null,pt?pt.img:null)})}fetchBand(d,$,st,lt,ht=!0){const pt=this._mrt;if(!this._isHeaderLoaded||!pt)return void lt(new Error("Tile header is not ready"));const mt=this.actor;if(!mt)return void lt(new Error("Can't fetch tile band without an actor"));let St;const It=c.B(String(st),c.B(this.tileID.key,d));let Dt=this._taskQueue.get(It);Dt?Dt.add(lt):(Dt=new Set,Dt.add(lt),this._taskQueue.set(It,Dt));const Ht=(Zt,sr)=>{St.complete(Zt,sr),Zt?lt(Zt):(Dt.forEach(ir=>ir(null,sr)),this._taskQueue.delete(It))},Gt=(Zt,sr)=>{if(Zt)return lt(Zt);const ir=mt.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:sr,task:St},Ht,void 0,!0);if($!==null){const hr=this._workQueuePerLayer.get($)||[];hr.push(()=>{ir&&ir.cancel(),St.cancel()}),this._workQueuePerLayer.has($)||this._workQueuePerLayer.set($,hr)}};let qt;try{qt=pt.getLayer(d)}catch(Zt){if(this.state==="reloading")return;throw Zt}if(!qt)return void lt(new Error(`Unknown sourceLayer "${d}"`));if(qt.hasDataForBand(st))return Dt.forEach(Zt=>Zt(null,null)),void this._taskQueue.delete(It);const Qt=qt.getDataRange([st]);if(St=pt.createDecodingTask(Qt),!St||St.tasks.length)if($!==null&&this.flushQueues($),this.entireBuffer)Gt(null,this.entireBuffer.slice(Qt.firstByte,Qt.lastByte+1));else{const Zt=Object.assign({},this.requestParams,{headers:{Range:`bytes=${Qt.firstByte}-${Qt.lastByte}`}}),sr=c.bu(Zt,Gt);if($!==null){const ir=this._fetchQueuePerLayer.get($)||[];ir.push(()=>{sr.cancel(),St.cancel()}),this._fetchQueuePerLayer.has($)||this._fetchQueuePerLayer.set($,ir)}}}updateNeeded(d,$){return(!this.textureDescriptorPerLayer.get(d)||this.textureDescriptorPerLayer.get(d).band!==$||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(d,$,st){if(!this._mrt)return;const lt=this._mrt.getLayer(d);if(!lt||!lt.hasBand(st)||!lt.hasDataForBand(st))return;const{bytes:ht,tileSize:pt,buffer:mt,offset:St,scale:It}=lt.getBandView(st),Dt=pt+2*mt,Ht=new c.q({width:Dt,height:Dt},ht),Gt=this.texturePerLayer.get($);Gt&&Gt instanceof c.T&&Gt.update(Ht,{premultiply:!1}),this.textureDescriptorPerLayer.set($,{layer:d,band:st,img:Ht,buffer:mt,offset:St,tileSize:pt,format:lt.pixelFormat,mix:[It,256*It,65536*It,16777216*It]})}destroy(d=!1){if(super.destroy(d),delete this._mrt,!d)for(const $ of this.texturePerLayer.values())$&&$ instanceof c.T&&$.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class J1{constructor(d,$){this.max=d,this.onRemove=$,this.reset()}reset(){for(const d in this.data)for(const $ of this.data[d])$.timeout&&clearTimeout($.timeout),this.onRemove($.value);return this.data={},this.order=[],this}add(d,$,st){const lt=d.wrapped().key;this.data[lt]===void 0&&(this.data[lt]=[]);const ht={value:$,timeout:void 0};if(st!==void 0&&(ht.timeout=setTimeout(()=>{this.remove(d,ht)},st)),this.data[lt].push(ht),this.order.push(lt),this.order.length>this.max){const pt=this._getAndRemoveByKey(this.order[0]);pt&&this.onRemove(pt)}return this}has(d){return d.wrapped().key in this.data}getAndRemove(d){return this.has(d)?this._getAndRemoveByKey(d.wrapped().key):null}_getAndRemoveByKey(d){const $=this.data[d].shift();return $.timeout&&clearTimeout($.timeout),this.data[d].length===0&&delete this.data[d],this.order.splice(this.order.indexOf(d),1),$.value}getByKey(d){const $=this.data[d];return $?$[0].value:null}get(d){return this.has(d)?this.data[d.wrapped().key][0].value:null}remove(d,$){if(!this.has(d))return this;const st=d.wrapped().key,lt=$===void 0?0:this.data[st].indexOf($),ht=this.data[st][lt];return this.data[st].splice(lt,1),ht.timeout&&clearTimeout(ht.timeout),this.data[st].length===0&&delete this.data[st],this.onRemove(ht.value),this.order.splice(this.order.indexOf(st),1),this}setMaxSize(d){for(this.max=d;this.order.length>this.max;){const $=this._getAndRemoveByKey(this.order[0]);$&&this.onRemove($)}return this}filter(d){const $=[];for(const st in this.data)for(const lt of this.data[st])d(lt.value)||$.push(lt);for(const st of $)this.remove(st.value.tileID,st)}}class ly{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(d,$,st){const lt=String($);if(this.stateChanges[d]=this.stateChanges[d]||{},this.stateChanges[d][lt]=this.stateChanges[d][lt]||{},Object.assign(this.stateChanges[d][lt],st),this.deletedStates[d]===null){this.deletedStates[d]={};for(const ht in this.state[d])ht!==lt&&(this.deletedStates[d][ht]=null)}else if(this.deletedStates[d]&&this.deletedStates[d][lt]===null){this.deletedStates[d][lt]={};for(const ht in this.state[d][lt])st[ht]||(this.deletedStates[d][lt][ht]=null)}else for(const ht in st)this.deletedStates[d]&&this.deletedStates[d][lt]&&this.deletedStates[d][lt][ht]===null&&delete this.deletedStates[d][lt][ht]}removeFeatureState(d,$,st){if(this.deletedStates[d]===null)return;const lt=String($);if(this.deletedStates[d]=this.deletedStates[d]||{},st&&$!==void 0)this.deletedStates[d][lt]!==null&&(this.deletedStates[d][lt]=this.deletedStates[d][lt]||{},this.deletedStates[d][lt][st]=null);else if($!==void 0)if(this.stateChanges[d]&&this.stateChanges[d][lt])for(st in this.deletedStates[d][lt]={},this.stateChanges[d][lt])this.deletedStates[d][lt][st]=null;else this.deletedStates[d][lt]=null;else this.deletedStates[d]=null}getState(d,$){const st=this.state[d]||{},lt=this.stateChanges[d]||{},ht=this.deletedStates[d];if(ht===null)return{};if($!==void 0){const mt=String($),St=Object.assign({},st[mt],lt[mt]);if(ht){const It=ht[$];if(It===null)return{};for(const Dt in It)delete St[Dt]}return St}const pt=Object.assign({},st,lt);if(ht)for(const mt in ht)delete pt[mt];return pt}initializeTileState(d,$){d.refreshFeatureState($)}coalesceChanges(d,$){const st={};for(const lt in this.stateChanges){this.state[lt]=this.state[lt]||{};const ht={};for(const pt in this.stateChanges[lt])this.state[lt][pt]||(this.state[lt][pt]={}),Object.assign(this.state[lt][pt],this.stateChanges[lt][pt]),ht[pt]=this.state[lt][pt];st[lt]=ht}for(const lt in this.deletedStates){this.state[lt]=this.state[lt]||{};const ht={};if(this.deletedStates[lt]===null)for(const pt in this.state[lt])ht[pt]={},this.state[lt][pt]={};else for(const pt in this.deletedStates[lt]){if(this.deletedStates[lt][pt]===null)this.state[lt][pt]={};else if(this.state[lt][pt])for(const mt of Object.keys(this.deletedStates[lt][pt]))delete this.state[lt][pt][mt];ht[pt]=this.state[lt][pt]}st[lt]=st[lt]||{},Object.assign(st[lt],ht)}if(this.stateChanges={},this.deletedStates={},Object.keys(st).length!==0)for(const lt in d)d[lt].refreshFeatureState($)}}class Xu extends c.E{constructor(d,$,st){super(),this.id=d,this._onlySymbols=st,$.on("data",lt=>{lt.dataType==="source"&&lt.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&lt.dataType==="source"&&lt.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),$.on("error",()=>{this._sourceErrored=!0}),this._source=$,this._tiles={},this._cache=new J1(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=$.minTileCacheSize,this._maxTileCacheSize=$.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new ly,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(d){this.map=d,this._minTileCacheSize=this._minTileCacheSize===void 0&&d?d._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&d?d._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const d in this._tiles)if(!this._tiles[d].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const d=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,d&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(d,$){return d.isSymbolTile=this._onlySymbols,d.isExtraShadowCaster=this._shadowCasterTiles[d.tileID.key],this._source.loadTile(d,$)}_unloadTile(d){if(this._source.unloadTile)return this._source.unloadTile(d)}_abortTile(d){if(this._source.abortTile)return this._source.abortTile(d)}serialize(){return this._source.serialize()}prepare(d){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const $ in this._tiles){const st=this._tiles[$];st.upload(d,this.map?this.map.painter:void 0),st.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(d=>d.tileID).sort(fx).map(d=>d.key)}getRenderableIds(d,$){const st=[];for(const lt in this._tiles)this._isIdRenderable(+lt,d,$)&&st.push(this._tiles[lt]);return d?st.sort((lt,ht)=>{const pt=lt.tileID,mt=ht.tileID,St=new c.P(pt.canonical.x,pt.canonical.y)._rotate(this.transform.angle),It=new c.P(mt.canonical.x,mt.canonical.y)._rotate(this.transform.angle);return pt.overscaledZ-mt.overscaledZ||It.y-St.y||It.x-St.x}).map(lt=>lt.tileID.key):st.map(lt=>lt.tileID).sort(fx).map(lt=>lt.key)}hasRenderableParent(d){const $=this.findLoadedParent(d,0);return!!$&&this._isIdRenderable($.tileID.key)}_isIdRenderable(d,$,st){return this._tiles[d]&&this._tiles[d].hasData()&&!this._coveredTiles[d]&&($||!this._tiles[d].holdingForFade())&&(st||!this._shadowCasterTiles[d])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const d in this._tiles)this._tiles[d].state!=="errored"&&this._reloadTile(+d,"reloading")}}_reloadTile(d,$){const st=this._tiles[d];st&&(st.state!=="loading"&&(st.state=$),this._loadTile(st,this._tileLoaded.bind(this,st,d,$)))}_tileLoaded(d,$,st,lt,ht){if(lt){if(d.state="errored",lt.status!==404)this._source.fire(new c.y(lt,{tile:d}));else{if(this._source.fire(new c.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:d})),!(d.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const mt=this.map.painter.terrain;this.update(this.transform,mt.getScaledDemTileSize(),!0),mt.resetTileLookupCache(this.id)}else this.update(this.transform)}return}d.timeAdded=c.o.now(),st==="expired"&&(d.refreshedUponExpiration=!0),this._setTileReloadTimer($,d),this._source.type==="raster-dem"&&d.dem&&this._backfillDEM(d),this._state.initializeTileState(d,this.map?this.map.painter:null);let pt=new Map;ht&&ht.responseHeaders&&(pt=ht.responseHeaders),this._source.fire(new c.z("data",{dataType:"source",tile:d,coord:d.tileID,sourceCacheId:this.id,responseHeaders:pt}))}_backfillDEM(d){const $=this.getRenderableIds();for(let lt=0;lt<$.length;lt++){const ht=$[lt];if(d.neighboringTiles&&d.neighboringTiles[ht]){const pt=this.getTileByID(ht);st(d,pt),st(pt,d)}}function st(lt,ht){if(!lt.dem||lt.dem.borderReady)return;lt.needsHillshadePrepare=!0,lt.needsDEMTextureUpload=!0;let pt=ht.tileID.canonical.x-lt.tileID.canonical.x;const mt=ht.tileID.canonical.y-lt.tileID.canonical.y,St=Math.pow(2,lt.tileID.canonical.z),It=ht.tileID.key;pt===0&&mt===0||Math.abs(mt)>1||(Math.abs(pt)>1&&(Math.abs(pt+St)===1?pt+=St:Math.abs(pt-St)===1&&(pt-=St)),ht.dem&&lt.dem&&(lt.dem.backfillBorder(ht.dem,pt,mt),lt.neighboringTiles&&lt.neighboringTiles[It]&&(lt.neighboringTiles[It].backfilled=!0)))}}getTile(d){return this.getTileByID(d.key)}getTileByID(d){return this._tiles[d]}_retainLoadedChildren(d,$,st,lt){for(const ht in this._tiles){let pt=this._tiles[ht];if(lt[ht]||!pt.hasData()||pt.tileID.overscaledZ<=$||pt.tileID.overscaledZ>st)continue;let mt=pt.tileID;for(;pt&&pt.tileID.overscaledZ>$+1;){const It=pt.tileID.scaledTo(pt.tileID.overscaledZ-1);pt=this._tiles[It.key],pt&&pt.hasData()&&(mt=It)}let St=mt;for(;St.overscaledZ>$;)if(St=St.scaledTo(St.overscaledZ-1),d[St.key]){lt[mt.key]=mt;break}}}findLoadedParent(d,$){if(d.key in this._loadedParentTiles){const st=this._loadedParentTiles[d.key];return st&&st.tileID.overscaledZ>=$?st:null}for(let st=d.overscaledZ-1;st>=$;st--){const lt=d.scaledTo(st),ht=this._getLoadedTile(lt);if(ht)return ht}}_getLoadedTile(d){const $=this._tiles[d.key];return $&&$.hasData()?$:this._cache.getByKey(this._source.reparseOverscaled?d.wrapped().key:d.canonical.key)}updateCacheSize(d,$){$=$||this._source.tileSize;const st=Math.ceil(d.width/$)+1,lt=Math.ceil(d.height/$)+1,ht=Math.floor(st*lt*5),pt=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,ht):ht,mt=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,pt):pt;this._cache.setMaxSize(mt)}handleWrapJump(d){const $=Math.round((d-(this._prevLng===void 0?d:this._prevLng))/360);if(this._prevLng=d,$){const st={};for(const lt in this._tiles){const ht=this._tiles[lt];ht.tileID=ht.tileID.unwrapTo(ht.tileID.wrap+$),st[ht.tileID.key]=ht}this._tiles=st;for(const lt in this._timers)clearTimeout(this._timers[lt]),delete this._timers[lt];for(const lt in this._tiles)this._setTileReloadTimer(+lt,this._tiles[lt])}}update(d,$,st,lt,ht){if(this.transform=d,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!st)return;this.updateCacheSize(d,$),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const pt=this._source.type==="batched-model";let mt,St=this._source.maxzoom;const It=this.map&&this.map.painter?this.map.painter._terrain:null;if(It&&It.sourceCache===this&&It.attenuationRange()){const Gt=It.attenuationRange()[0],qt=Math.floor(Gt)-Math.log2(It.getDemUpscale());St>qt&&(St=qt)}if(this.used||this.usedForTerrain){if(this._source.tileID)mt=d.getVisibleUnwrappedCoordinates(this._source.tileID).map(Gt=>new c.aQ(Gt.canonical.z,Gt.wrap,Gt.canonical.z,Gt.canonical.x,Gt.canonical.y));else if(this.tileCoverLift!==0){const Gt=d.clone();Gt.tileCoverLift=this.tileCoverLift,mt=Gt.coveringTiles({tileSize:$||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:St,roundZoom:this._source.roundZoom&&!st,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:pt}),this._source.minzoom<=1&&d.projection.name==="globe"&&(mt.push(new c.aQ(1,0,1,0,0)),mt.push(new c.aQ(1,0,1,1,0)),mt.push(new c.aQ(1,0,1,0,1)),mt.push(new c.aQ(1,0,1,1,1)))}else if(mt=d.coveringTiles({tileSize:$||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:St,roundZoom:this._source.roundZoom&&!st,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:pt}),this._source.hasTile){const Gt=this._source.hasTile.bind(this._source);mt=mt.filter(qt=>Gt(qt))}}else mt=[];if(mt.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Qm(this._source.type)){const Gt=d.coveringZoomLevel({tileSize:$||this._source.tileSize,roundZoom:this._source.roundZoom&&!st}),qt=Math.min(Gt,this._source.maxzoom);if(pt){const Qt=d.extendTileCover(mt,qt);for(const Zt of Qt)mt.push(Zt)}else if(ht){const Qt=d.extendTileCoverToNearPlane(mt,this.transform.getFrustum(qt),qt);for(const Zt of Qt)mt.push(Zt)}else if(this.castsShadows&&lt){const Qt=d.extendTileCover(mt,qt,lt,16);for(const Zt of Qt)this._shadowCasterTiles[Zt.key]=!0,mt.push(Zt)}}const Dt=this._updateRetainedTiles(mt);if(Qm(this._source.type)&&mt.length!==0){const Gt={},qt={},Qt=Object.keys(Dt);for(const sr of Qt){const ir=Dt[sr],hr=this._tiles[sr];if(!hr||hr.fadeEndTime&&hr.fadeEndTime<=c.o.now())continue;const gr=this.findLoadedParent(ir,Math.max(ir.overscaledZ-Xu.maxOverzooming,this._source.minzoom));gr&&(this._addTile(gr.tileID),Gt[gr.tileID.key]=gr.tileID),qt[sr]=ir}const Zt=mt[mt.length-1].overscaledZ;for(const sr in this._tiles){const ir=this._tiles[sr];if(Dt[sr]||!ir.hasData())continue;let hr=ir.tileID;for(;hr.overscaledZ>Zt;){hr=hr.scaledTo(hr.overscaledZ-1);const gr=this._tiles[hr.key];if(gr&&gr.hasData()&&qt[hr.key]){Dt[sr]=ir.tileID;break}}}for(const sr in Gt)Dt[sr]||(this._coveredTiles[sr]=!0,Dt[sr]=Gt[sr])}for(const Gt in Dt)this._tiles[Gt].clearFadeHold();const Ht=c.bv(this._tiles,Dt);for(const Gt of Ht){const qt=this._tiles[Gt];qt.hasSymbolBuckets&&!qt.holdingForFade()?qt.setHoldDuration(this.map._fadeDuration):qt.hasSymbolBuckets&&!qt.symbolFadeFinished()||this._removeTile(+Gt)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const d in this._tiles)this._tiles[d].holdingForFade()&&this._removeTile(+d)}_updateRetainedTiles(d){const $={};if(d.length===0)return $;const st={},lt=d.reduce((It,Dt)=>Math.min(It,Dt.overscaledZ),1/0),ht=d[0].overscaledZ,pt=Math.max(ht-Xu.maxOverzooming,this._source.minzoom),mt=Math.max(ht+Xu.maxUnderzooming,this._source.minzoom),St={};for(const It of d){const Dt=this._addTile(It);$[It.key]=It,Dt.hasData()||lt<this._source.maxzoom&&(St[It.key]=It)}this._retainLoadedChildren(St,lt,mt,$);for(const It of d){let Dt=this._tiles[It.key];if(Dt.hasData())continue;if(It.canonical.z>=this._source.maxzoom){const Gt=It.children(this._source.maxzoom)[0],qt=this.getTile(Gt);if(qt&&qt.hasData()){$[Gt.key]=Gt;continue}}else{const Gt=It.children(this._source.maxzoom);if($[Gt[0].key]&&$[Gt[1].key]&&$[Gt[2].key]&&$[Gt[3].key])continue}let Ht=Dt.wasRequested();for(let Gt=It.overscaledZ-1;Gt>=pt;--Gt){const qt=It.scaledTo(Gt);if(st[qt.key]||(st[qt.key]=!0,Dt=this.getTile(qt),!Dt&&Ht&&(Dt=this._addTile(qt)),Dt&&($[qt.key]=qt,Ht=Dt.wasRequested(),Dt.hasData())))break}}return $}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const d in this._tiles){const $=[];let st,lt=this._tiles[d].tileID;for(;lt.overscaledZ>0;){if(lt.key in this._loadedParentTiles){st=this._loadedParentTiles[lt.key];break}$.push(lt.key);const ht=lt.scaledTo(lt.overscaledZ-1);if(st=this._getLoadedTile(ht),st)break;lt=ht}for(const ht of $)this._loadedParentTiles[ht]=st}}_addTile(d){let $=this._tiles[d.key];if($)return $.isExtraShadowCaster!==!0||this._shadowCasterTiles[d.key]||this._reloadTile(d.key,"reloading"),$;$=this._cache.getAndRemove(d),$&&(this._setTileReloadTimer(d.key,$),$.tileID=d,this._state.initializeTileState($,this.map?this.map.painter:null),this._cacheTimers[d.key]&&(clearTimeout(this._cacheTimers[d.key]),delete this._cacheTimers[d.key],this._setTileReloadTimer(d.key,$)));const st=!!$;if(!st){const lt=this.map?this.map.painter:null,ht=this._source.tileSize*d.overscaleFactor();$=this._source.type==="raster-array"?new dx(d,ht,this.transform.tileZoom,lt,this._isRaster):new Ym(d,ht,this.transform.tileZoom,lt,this._isRaster,this._source.worldview),this._loadTile($,this._tileLoaded.bind(this,$,d.key,$.state))}return $.uses++,this._tiles[d.key]=$,st||this._source.fire(new c.z("dataloading",{tile:$,coord:$.tileID,dataType:"source"})),$}_setTileReloadTimer(d,$){d in this._timers&&(clearTimeout(this._timers[d]),delete this._timers[d]);const st=$.getExpiryTimeout();st&&(this._timers[d]=setTimeout(()=>{this._reloadTile(d,"expired"),delete this._timers[d]},st))}_removeTile(d){const $=this._tiles[d];$&&($.uses--,delete this._tiles[d],this._timers[d]&&(clearTimeout(this._timers[d]),delete this._timers[d]),$.uses>0||($.hasData()&&$.state!=="reloading"||$.state==="empty"?this._cache.add($.tileID,$,$.getExpiryTimeout()):($.aborted=!0,this._abortTile($),this._unloadTile($))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const d in this._tiles)this._removeTile(+d);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(d,$,st){const lt=[],ht=this.transform;if(!ht)return lt;const pt=ht.projection.name==="globe",mt=c.aF(ht.center.lng);for(const St in this._tiles){const It=this._tiles[St];if(st&&It.clearQueryDebugViz(),It.holdingForFade())continue;let Dt;if(pt){const Ht=It.tileID.canonical;if(Ht.z===0){const Gt=[Math.abs(c.aA(mt,...Zp(Ht,-1))-mt),Math.abs(c.aA(mt,...Zp(Ht,1))-mt)];Dt=[0,2*Gt.indexOf(Math.min(...Gt))-1]}else{const Gt=[Math.abs(c.aA(mt,...Zp(Ht,-1))-mt),Math.abs(c.aA(mt,...Zp(Ht,0))-mt),Math.abs(c.aA(mt,...Zp(Ht,1))-mt)];Dt=[Gt.indexOf(Math.min(...Gt))-1]}}else Dt=[0];for(const Ht of Dt){const Gt=d.containsTile(It,ht,$,Ht);Gt&&lt.push(Gt)}}return lt}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(d){return this._getRenderableCoordinates(d)}_getRenderableCoordinates(d,$){const st=this.getRenderableIds(d,$).map(ht=>this._tiles[ht].tileID),lt=this.transform.projection.name==="globe";for(const ht of st)ht.projMatrix=this.transform.calculateProjMatrix(ht.toUnwrapped()),ht.expandedProjMatrix=lt?this.transform.calculateProjMatrix(ht.toUnwrapped(),!1,!0):ht.projMatrix;return st}sortCoordinatesByDistance(d){const $=d.slice(),st=this.transform._camera.position,lt=this.transform._camera.forward(),ht={};for(const pt of $){const mt=1/(1<<pt.canonical.z);ht[pt.key]=((pt.canonical.x+.5)*mt+pt.wrap-st[0])*lt[0]+((pt.canonical.y+.5)*mt-st[1])*lt[1]-st[2]*lt[2]}return $.sort((pt,mt)=>ht[pt.key]-ht[mt.key]),$}hasTransition(){if(this._source.hasTransition())return!0;if(Qm(this._source.type))for(const d in this._tiles){const $=this._tiles[d];if($.fadeEndTime!==void 0&&$.fadeEndTime>=c.o.now())return!0}return!1}setFeatureState(d,$,st){this._state.updateState(d=d||"_geojsonTileLayer",$,st)}removeFeatureState(d,$,st){this._state.removeFeatureState(d=d||"_geojsonTileLayer",$,st)}getFeatureState(d,$){return this._state.getState(d=d||"_geojsonTileLayer",$)}setDependencies(d,$,st){const lt=this._tiles[d];lt&&lt.setDependencies($,st)}reloadTilesForDependencies(d,$){for(const st in this._tiles)this._tiles[st].hasDependency(d,$)&&this._reloadTile(+st,"reloading");this._cache.filter(st=>!st.hasDependency(d,$))}_preloadTiles(d,$){if(!this._sourceLoaded){const St=()=>{this._sourceLoaded&&(this._source.off("data",St),this._preloadTiles(d,$))};return void this._source.on("data",St)}const st=new Map,lt=Array.isArray(d)?d:[d],ht=this.map.painter.terrain,pt=this.usedForTerrain&&ht?ht.getScaledDemTileSize():this._source.tileSize;for(const St of lt){const It=St.coveringTiles({tileSize:pt,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const Dt of It)st.set(Dt.key,Dt);this.usedForTerrain&&St.updateElevation(!1)}const mt=Array.from(st.values());c.bw(mt,(St,It)=>{const Dt=new Ym(St,this._source.tileSize*St.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(Dt,Ht=>{this._source.type==="raster-dem"&&Dt.dem&&this._backfillDEM(Dt),It(Ht,Dt)})},$)}}function fx(it,d){const $=Math.abs(2*it.wrap)-+(it.wrap<0),st=Math.abs(2*d.wrap)-+(d.wrap<0);return it.overscaledZ-d.overscaledZ||st-$||d.canonical.y-it.canonical.y||d.canonical.x-it.canonical.x}function Qm(it){return it==="raster"||it==="image"||it==="video"||it==="custom"}function Zp(it,d){const $=1<<it.z;return[it.x/$+d,(it.x+1)/$+d]}Xu.maxOverzooming=10,Xu.maxUnderzooming=3;class YE{constructor(d){this.style=d,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const d=!1,$=!1;for(const st in this.style._mergedLayers){const lt=this.style._mergedLayers[st];if(lt.type==="fill-extrusion"||lt.type==="building")this.layers.push({layer:lt,visible:d,visibilityChanged:$});else if(lt.type==="model"){const ht=this.style.getLayerSource(lt);ht&&ht.type==="batched-model"&&this.layers.push({layer:lt,visible:d,visibilityChanged:$})}}}onNewFrame(d){this.layersGotHidden=!1;for(const $ of this.layers){const st=$.layer;let lt=!1;st.type==="fill-extrusion"?lt=!st.isHidden(d)&&st.paint.get("fill-extrusion-opacity")>0:st.type==="building"?lt=!st.isHidden(d)&&st.paint.get("building-opacity")>0:st.type==="model"&&(lt=!st.isHidden(d)&&st.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!lt&&$.visible,$.visible=lt}}updateZOffset(d,$){this.currentBuildingBuckets=[];for(const lt of this.layers){const ht=lt.layer,pt=this.style.getLayerSourceCache(ht);let mt=1;ht.type==="fill-extrusion"?mt=lt.visible?ht.paint.get("fill-extrusion-vertical-scale"):0:ht.type==="building"&&(mt=lt.visible?ht.paint.get("building-vertical-scale"):0);let St=pt?pt.getTile($):null;if(!St&&pt)for(const It in pt._tiles){const Dt=pt._tiles[It];if($.canonical.isChildOf(Dt.tileID.canonical)){St=Dt;break}}this.currentBuildingBuckets.push({bucket:St?St.getBucket(ht):null,tileID:St?St.tileID:$,verticalScale:mt})}d.hasAnyZOffset=!1;let st=!1;for(let lt=0;lt<d.symbolInstances.length;lt++){const ht=d.symbolInstances.get(lt),pt=ht.zOffset,mt=this._getHeightAtTileOffset($,ht.tileAnchorX,ht.tileAnchorY);ht.zOffset=mt!==Number.NEGATIVE_INFINITY?mt:pt,st||pt===ht.zOffset||(st=!0),d.hasAnyZOffset||ht.zOffset===0||(d.hasAnyZOffset=!0)}st&&(d.zOffsetBuffersNeedUpload=!0,d.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(d,$,st,lt){let ht=$,pt=st;if(d.canonical.z!==lt.canonical.z){const mt=lt.canonical,St=1/(1<<d.canonical.z-mt.z);ht=($+d.canonical.x*c.al)*St-mt.x*c.al|0,pt=(st+d.canonical.y*c.al)*St-mt.y*c.al|0}return{tileX:ht,tileY:pt}}_getHeightAtTileOffset(d,$,st){let lt,ht;for(let pt=0;pt<this.layers.length;++pt){const mt=this.layers[pt].layer;if(mt.type!=="fill-extrusion"&&mt.type!=="building")continue;const{bucket:St,tileID:It,verticalScale:Dt}=this.currentBuildingBuckets[pt];if(!St)continue;const{tileX:Ht,tileY:Gt}=this._mapCoordToOverlappingTile(d,$,st,It),qt=St.getHeightAtTileCoord(Ht,Gt);qt&&qt.height!==void 0&&(qt.hidden?lt=qt.height:ht=Math.max(qt.height*Dt,ht||0))}if(ht!==void 0)return ht;for(let pt=0;pt<this.layers.length;++pt){const mt=this.layers[pt];if(mt.layer.type!=="model"||!mt.visible)continue;const{bucket:St,tileID:It}=this.currentBuildingBuckets[pt];if(!St)continue;const{tileX:Dt,tileY:Ht}=this._mapCoordToOverlappingTile(d,$,st,It),Gt=St.getHeightAtTileCoord(Dt,Ht);if(Gt&&!Gt.hidden)return Gt.height===void 0&&lt!==void 0?Math.min(Gt.maxHeight,lt)*Gt.verticalScale:Gt.height?Gt.height*Gt.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function _b(it,d){const $={};for(const st in it)st!=="ref"&&($[st]=it[st]);return c.bx.forEach(st=>{st in d&&($[st]=d[st])}),$}function cy(it){it=it.slice();const d=Object.create(null);for(let $=0;$<it.length;$++)d[it[$].id]=it[$];for(let $=0;$<it.length;$++)"ref"in it[$]&&(it[$]=_b(it[$],d[it[$].ref]));return it}const fo={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function mx(it,d,$){$.push({command:fo.addSource,args:[it,d[it]]})}function nv(it,d,$){d.push({command:fo.removeSource,args:[it]}),$[it]=!0}function ew(it,d,$,st){nv(it,$,st),mx(it,d,$)}function tw(it,d,$){let st;for(st in it[$])if(it[$].hasOwnProperty(st)&&st!=="data"&&!c.by(it[$][st],d[$][st]))return!1;for(st in d[$])if(d[$].hasOwnProperty(st)&&st!=="data"&&!c.by(it[$][st],d[$][st]))return!1;return!0}function Em(it,d,$,st,lt,ht){let pt;for(pt in d=d||{},it=it||{})it.hasOwnProperty(pt)&&(c.by(it[pt],d[pt])||$.push({command:ht,args:[st,pt,d[pt],lt]}));for(pt in d)d.hasOwnProperty(pt)&&!it.hasOwnProperty(pt)&&(c.by(it[pt],d[pt])||$.push({command:ht,args:[st,pt,d[pt],lt]}))}function uy(it){return it.id}function hy(it,d){return it[d.id]=d,it}function iv(it,d,$){const st=d.createTileMatrix(it,it.worldSize,$.toUnwrapped());return c.aB(new Float32Array(16),it.projMatrix,st)}function gx(it,d,$){if(d.projection.name===$.projection.name)return it.projMatrix;const st=$.clone();return st.setProjection(d.projection),iv(st,d.getProjection(),it)}function jp(it,d,$){return d.name===$.projection.name?it.projMatrix:iv($,d,it)}class dy{constructor(d,$){this.reset(d,$)}reset(d,$){this.points=d||[],this._distances=[0];for(let st=1;st<this.points.length;st++)this._distances[st]=this._distances[st-1]+this.points[st].dist(this.points[st-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min($||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(d){if(this.points.length===1)return this.points[0];d=c.aA(d,0,1);let $=1,st=this._distances[$];const lt=d*this.paddedLength+this.padding;for(;st<lt&&$<this._distances.length;)st=this._distances[++$];const ht=$-1,pt=this._distances[ht],mt=st-pt,St=mt>0?(lt-pt)/mt:0;return this.points[ht].mult(1-St).add(this.points[$].mult(St))}}class sv{constructor(d,$,st){const lt=this.boxCells=[],ht=this.circleCells=[];this.xCellCount=Math.ceil(d/st),this.yCellCount=Math.ceil($/st);for(let pt=0;pt<this.xCellCount*this.yCellCount;pt++)lt.push([]),ht.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=d,this.height=$,this.xScale=this.xCellCount/d,this.yScale=this.yCellCount/$,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(d,$,st,lt,ht){this._forEachCell($,st,lt,ht,this._insertBoxCell,this.boxUid++),this.boxKeys.push(d),this.bboxes.push($),this.bboxes.push(st),this.bboxes.push(lt),this.bboxes.push(ht)}insertCircle(d,$,st,lt){this._forEachCell($-lt,st-lt,$+lt,st+lt,this._insertCircleCell,this.circleUid++),this.circleKeys.push(d),this.circles.push($),this.circles.push(st),this.circles.push(lt)}_insertBoxCell(d,$,st,lt,ht,pt){this.boxCells[ht].push(pt)}_insertCircleCell(d,$,st,lt,ht,pt){this.circleCells[ht].push(pt)}_query(d,$,st,lt,ht,pt){if(st<0||d>this.width||lt<0||$>this.height)return!ht&&[];const mt=[];if(d<=0&&$<=0&&this.width<=st&&this.height<=lt){if(ht)return!0;for(let St=0;St<this.boxKeys.length;St++)mt.push({key:this.boxKeys[St],x1:this.bboxes[4*St],y1:this.bboxes[4*St+1],x2:this.bboxes[4*St+2],y2:this.bboxes[4*St+3]});for(let St=0;St<this.circleKeys.length;St++){const It=this.circles[3*St],Dt=this.circles[3*St+1],Ht=this.circles[3*St+2];mt.push({key:this.circleKeys[St],x1:It-Ht,y1:Dt-Ht,x2:It+Ht,y2:Dt+Ht})}return pt?mt.filter(pt):mt}return this._forEachCell(d,$,st,lt,this._queryCell,mt,{hitTest:ht,seenUids:{box:{},circle:{}}},pt),ht?mt.length>0:mt}_queryCircle(d,$,st,lt,ht){const pt=d-st,mt=d+st,St=$-st,It=$+st;if(mt<0||pt>this.width||It<0||St>this.height)return!lt&&[];const Dt=[];return this._forEachCell(pt,St,mt,It,this._queryCellCircle,Dt,{hitTest:lt,circle:{x:d,y:$,radius:st},seenUids:{box:{},circle:{}}},ht),lt?Dt.length>0:Dt}query(d,$,st,lt,ht){return this._query(d,$,st,lt,!1,ht)}hitTest(d,$,st,lt,ht){return this._query(d,$,st,lt,!0,ht)}hitTestCircle(d,$,st,lt){return this._queryCircle(d,$,st,!0,lt)}_queryCell(d,$,st,lt,ht,pt,mt,St){const It=mt.seenUids,Dt=this.boxCells[ht];if(Dt!==null){const Gt=this.bboxes;for(const qt of Dt)if(!It.box[qt]){It.box[qt]=!0;const Qt=4*qt;if(d<=Gt[Qt+2]&&$<=Gt[Qt+3]&&st>=Gt[Qt+0]&&lt>=Gt[Qt+1]&&(!St||St(this.boxKeys[qt]))){if(mt.hitTest)return pt.push(!0),!0;pt.push({key:this.boxKeys[qt],x1:Gt[Qt],y1:Gt[Qt+1],x2:Gt[Qt+2],y2:Gt[Qt+3]})}}}const Ht=this.circleCells[ht];if(Ht!==null){const Gt=this.circles;for(const qt of Ht)if(!It.circle[qt]){It.circle[qt]=!0;const Qt=3*qt;if(this._circleAndRectCollide(Gt[Qt],Gt[Qt+1],Gt[Qt+2],d,$,st,lt)&&(!St||St(this.circleKeys[qt]))){if(mt.hitTest)return pt.push(!0),!0;{const Zt=Gt[Qt],sr=Gt[Qt+1],ir=Gt[Qt+2];pt.push({key:this.circleKeys[qt],x1:Zt-ir,y1:sr-ir,x2:Zt+ir,y2:sr+ir})}}}}}_queryCellCircle(d,$,st,lt,ht,pt,mt,St){const It=mt.circle,Dt=mt.seenUids,Ht=this.boxCells[ht];if(Ht!==null){const qt=this.bboxes;for(const Qt of Ht)if(!Dt.box[Qt]){Dt.box[Qt]=!0;const Zt=4*Qt;if(this._circleAndRectCollide(It.x,It.y,It.radius,qt[Zt+0],qt[Zt+1],qt[Zt+2],qt[Zt+3])&&(!St||St(this.boxKeys[Qt])))return pt.push(!0),!0}}const Gt=this.circleCells[ht];if(Gt!==null){const qt=this.circles;for(const Qt of Gt)if(!Dt.circle[Qt]){Dt.circle[Qt]=!0;const Zt=3*Qt;if(this._circlesCollide(qt[Zt],qt[Zt+1],qt[Zt+2],It.x,It.y,It.radius)&&(!St||St(this.circleKeys[Qt])))return pt.push(!0),!0}}}_forEachCell(d,$,st,lt,ht,pt,mt,St){const It=this._convertToXCellCoord(d),Dt=this._convertToYCellCoord($),Ht=this._convertToXCellCoord(st),Gt=this._convertToYCellCoord(lt);for(let qt=It;qt<=Ht;qt++)for(let Qt=Dt;Qt<=Gt;Qt++)if(ht.call(this,d,$,st,lt,this.xCellCount*Qt+qt,pt,mt,St))return}_convertToXCellCoord(d){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(d*this.xScale)))}_convertToYCellCoord(d){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(d*this.yScale)))}_circlesCollide(d,$,st,lt,ht,pt){const mt=lt-d,St=ht-$,It=st+pt;return It*It>mt*mt+St*St}_circleAndRectCollide(d,$,st,lt,ht,pt,mt){const St=(pt-lt)/2,It=Math.abs(d-(lt+St));if(It>St+st)return!1;const Dt=(mt-ht)/2,Ht=Math.abs($-(ht+Dt));if(Ht>Dt+st)return!1;if(It<=St||Ht<=Dt)return!0;const Gt=It-St,qt=Ht-Dt;return Gt*Gt+qt*qt<=st*st}}const Tm={unknown:0,flipRequired:1,flipNotRequired:2},Jm=Math.tan(85*Math.PI/180);function Nu(it,d,$,st,lt,ht,pt){const mt=c.bC();if($)if(ht.name==="globe"){const St=c.bD(lt,d);c.aB(mt,mt,St)}else{const St=c.bE([],pt);mt[0]=St[0],mt[1]=St[1],mt[4]=St[2],mt[5]=St[3],st||c.bB(mt,mt,lt.angle)}else c.aB(mt,lt.labelPlaneMatrix,it);return mt}function yx(it,d,$,st,lt,ht,pt){const mt=Nu(it,d,$,st,lt,ht,pt);return ht.name==="globe"&&$||(mt[2]=mt[6]=mt[10]=mt[14]=0),mt}function py(it,d,$,st,lt,ht,pt){if($){if(ht.name==="globe"){const mt=Nu(it,d,$,st,lt,ht,pt);return c.bl(mt,mt),c.aB(mt,it,mt),mt}{const mt=c.bz(it),St=c.bA([]);return St[0]=pt[0],St[1]=pt[1],St[4]=pt[2],St[5]=pt[3],c.aB(mt,mt,St),st||c.bB(mt,mt,-lt.angle),mt}}return lt.glCoordMatrix}function hp(it,d,$,st){const lt=[it,d,$,1];$?c.aC(lt,lt,st):us(lt,lt,st);const ht=lt[3];return lt[0]/=ht,lt[1]/=ht,lt[2]/=ht,lt}function Ro(it,d){return Math.min(.5+it/d*.5,1.5)}function rw(it,d){const $=it[0]/it[3],st=it[1]/it[3];return $>=-d[0]&&$<=d[0]&&st>=-d[1]&&st<=d[1]}function nw(it,d,$,st,lt,ht,pt,mt,St,It,Dt=1){const Ht=$.transform,Gt=st?it.textSizeData:it.iconSizeData,qt=c.bK(Gt,$.transform.zoom,Dt),Qt=Ht.projection.name==="globe",Zt=[256/$.width*2+1,256/$.height*2+1],sr=st?it.text.dynamicLayoutVertexArray:it.icon.dynamicLayoutVertexArray;sr.clear();let ir=null;Qt&&(ir=st?it.text.globeExtVertexArray:it.icon.globeExtVertexArray);const hr=it.lineVertexArray,gr=st?it.text.placedSymbolArray:it.icon.placedSymbolArray,dr=$.transform.width/$.transform.height;let Ir,Tr=!1;for(let Rr=0;Rr<gr.length;Rr++){const Er=gr.get(Rr),{numGlyphs:vr,writingMode:kr}=Er;if(kr!==c.bL.vertical||Tr||Ir===c.bL.horizontal||(Tr=!0),Ir=kr,(Er.hidden||kr===c.bL.vertical)&&!Tr){Tp(vr,sr);continue}Tr=!1;const Ur=new c.P(Er.tileAnchorX,Er.tileAnchorY),zr=it.elevationType==="road",Jr=!!Ht.elevation||zr;let{x:rn,y:pn,z:Pn}=Ht.projection.projectTilePoint(Ur.x,Ur.y,It.canonical),Kr=null;if(Jr){const qn=zr?it.getElevationFeatureForText(Rr):null;Kr={getElevation:St,elevation:Ht.elevation,elevationFeature:qn};const[ms,Ns,to]=St(Ur,Ht.elevation,qn);rn+=ms,pn+=Ns,Pn+=to}const jr=[rn,pn,Pn,1];if(c.aC(jr,jr,d),!rw(jr,Zt)){Tp(vr,sr);continue}const an=jr[3],Xr=Ro($.transform.getCameraToCenterDistance(Ht.projection),an),bn=c.bM(Gt,qt,Er),Fn=pt?bn/Xr:bn*Xr,Hn=hp(rn,pn,Pn,lt);if(Hn[3]<=0){Tp(vr,sr);continue}let Ln={};const In=c.an(it.layers[0].layout.get("text-max-angle")),ns=Math.cos(In),_i=pt?null:Kr,$n=ov(Er,Fn,!1,mt,d,lt,ht,it.glyphOffsetArray,hr,sr,ir,Hn,Ur,Ln,dr,_i,Ht.projection,It,pt,ns);Tr=$n.useVertical,_i&&$n.needsFlipping&&(Ln={}),($n.notEnoughRoom||Tr||$n.needsFlipping&&ov(Er,Fn,!0,mt,d,lt,ht,it.glyphOffsetArray,hr,sr,ir,Hn,Ur,Ln,dr,_i,Ht.projection,It,pt,ns).notEnoughRoom)&&Tp(vr,sr)}st?(it.text.dynamicLayoutVertexBuffer.updateData(sr),ir&&it.text.globeExtVertexBuffer&&it.text.globeExtVertexBuffer.updateData(ir)):(it.icon.dynamicLayoutVertexBuffer.updateData(sr),ir&&it.icon.globeExtVertexBuffer&&it.icon.globeExtVertexBuffer.updateData(ir))}function iw(it,d,$,st,lt,ht,pt,mt,St,It,Dt,Ht,Gt,qt,Qt,Zt,sr){const{lineStartIndex:ir,glyphStartIndex:hr,segment:gr}=mt,dr=hr+mt.numGlyphs,Ir=ir+mt.lineLength,Tr=d.getoffsetX(hr),Rr=d.getoffsetX(dr-1),Er=b0(it*Tr,$,st,lt,ht,pt,gr,ir,Ir,St,It,Dt,Ht,Gt,!0,qt,Qt,Zt,sr);if(!Er)return null;const vr=b0(it*Rr,$,st,lt,ht,pt,gr,ir,Ir,St,It,Dt,Ht,Gt,!0,qt,Qt,Zt,sr);return vr?{first:Er,last:vr}:null}function Cs(it,d,$,st){return it===c.bL.horizontal&&Math.abs(st)>Math.abs($)?{useVertical:!0}:it===c.bL.vertical?st>0?{needsFlipping:!0}:null:d!==Tm.unknown&&function(lt,ht){return lt===0||Math.abs(ht/lt)>Jm}($,st)?d===Tm.flipRequired?{needsFlipping:!0}:null:$<0?{needsFlipping:!0}:null}function ov(it,d,$,st,lt,ht,pt,mt,St,It,Dt,Ht,Gt,qt,Qt,Zt,sr,ir,hr,gr){const dr=d/24,Ir=it.lineOffsetX*dr,Tr=it.lineOffsetY*dr,{lineStartIndex:Rr,glyphStartIndex:Er,numGlyphs:vr,segment:kr,writingMode:Ur,flipState:zr}=it,Jr=Rr+it.lineLength,rn=pn=>{if(Dt){const[an,Xr,bn]=pn.up,Fn=It.length;c.bN(Dt,Fn+0,an,Xr,bn),c.bN(Dt,Fn+1,an,Xr,bn),c.bN(Dt,Fn+2,an,Xr,bn),c.bN(Dt,Fn+3,an,Xr,bn)}const[Pn,Kr,jr]=pn.point;c.bO(It,Pn,Kr,jr,pn.angle)};if(vr>1){const pn=iw(dr,mt,Ir,Tr,$,Ht,Gt,it,St,ht,qt,Zt,!1,sr,ir,hr,gr);if(!pn)return{notEnoughRoom:!0};if(st&&!$){let[Pn,Kr,jr]=pn.first.point,[an,Xr,bn]=pn.last.point;[Pn,Kr]=hp(Pn,Kr,jr,pt),[an,Xr]=hp(an,Xr,bn,pt);const Fn=Cs(Ur,zr,(an-Pn)*Qt,Xr-Kr);if(it.flipState=Fn&&Fn.needsFlipping?Tm.flipRequired:Tm.flipNotRequired,Fn)return Fn}rn(pn.first);for(let Pn=Er+1;Pn<Er+vr-1;Pn++){const Kr=b0(dr*mt.getoffsetX(Pn),Ir,Tr,$,Ht,Gt,kr,Rr,Jr,St,ht,qt,Zt,!1,!1,sr,ir,hr,gr);if(!Kr)return It.length-=4*(Pn-Er),{notEnoughRoom:!0};rn(Kr)}rn(pn.last)}else{if(st&&!$){const Pn=hp(Gt.x,Gt.y,0,lt),Kr=Rr+kr+1,jr=new c.P(St.getx(Kr),St.gety(Kr)),an=hp(jr.x,jr.y,0,lt),Xr=an[3]>0?an:dp(Gt,jr,Pn,1,lt,void 0,sr,ir.canonical),bn=Cs(Ur,zr,(Xr[0]-Pn[0])*Qt,Xr[1]-Pn[1]);if(it.flipState=bn&&bn.needsFlipping?Tm.flipRequired:Tm.flipNotRequired,bn)return bn}const pn=b0(dr*mt.getoffsetX(Er),Ir,Tr,$,Ht,Gt,kr,Rr,Jr,St,ht,qt,Zt,!1,!1,sr,ir,hr,gr);if(!pn)return{notEnoughRoom:!0};rn(pn)}return{}}function fy(it,d,$,st,lt){const{x:ht,y:pt,z:mt}=st.projectTilePoint(it.x,it.y,d);if(!lt)return hp(ht,pt,mt,$);const[St,It,Dt]=lt.getElevation(it,lt.elevation,lt.elevationFeature);return hp(ht+St,pt+It,mt+Dt,$)}function dp(it,d,$,st,lt,ht,pt,mt){const St=fy(it.sub(d)._unit()._add(it),mt,lt,pt,ht);return c.av(St,$,St),c.aw(St,St),c.bH(St,$,St,st)}function b0(it,d,$,st,lt,ht,pt,mt,St,It,Dt,Ht,Gt,qt,Qt,Zt,sr,ir,hr){const gr=st?it-d:it+d;let dr=gr>0?1:-1,Ir=0;st&&(dr*=-1,Ir=Math.PI),dr<0&&(Ir+=Math.PI);let Tr=mt+pt+(dr>0?0:1)|0,Rr=lt,Er=lt,vr=0,kr=0;const Ur=Math.abs(gr),zr=[],Jr=[];let rn=ht,pn=rn,Pn=c.bF([]);const Kr=()=>dp(pn,rn,Er,Ur-vr+1,Dt,Gt,Zt,sr.canonical);for(;vr+kr<=Ur;){if(Tr+=dr,Tr<mt||Tr>=St)return null;if(Er=Rr,pn=rn,zr.push(Er),qt&&Jr.push(pn),rn=new c.P(It.getx(Tr),It.gety(Tr)),Rr=Ht[Tr],!Rr){const _i=fy(rn,sr.canonical,Dt,Zt,Gt);Rr=_i[3]>0?Ht[Tr]=_i:Kr()}vr+=kr;const In=c.av([],Rr,Er),ns=c.bG(Er,Rr);if($&&ns>0&&kr>0&&c.bJ(Pn,In)/(kr*ns)<hr)return null;kr=ns,Pn=In}Qt&&Gt&&(Ht[Tr]&&(Rr=Kr(),kr=c.bG(Er,Rr),Pn=c.av([],Rr,Er)),Ht[Tr]=Rr);const jr=(Ur-vr)/kr,an=rn.sub(pn)._mult(jr)._add(pn),Xr=c.bH([],Er,Pn,jr);let bn=[0,0,1],Fn=Pn[0],Hn=Pn[1];if(ir&&(bn=Zt.upVector(sr.canonical,an.x,an.y),bn[0]!==0||bn[1]!==0||bn[2]!==1)){const In=[bn[2],0,-bn[0]],ns=c.bI([],bn,In);c.aw(In,In),c.aw(ns,ns),Fn=c.bJ(Pn,In),Hn=c.bJ(Pn,ns)}if($){const In=c.bI([],bn,Pn);c.aw(In,In),c.bH(Xr,Xr,In,$*dr)}const Ln=Ir+Math.atan2(Hn,Fn);return zr.push(Xr),qt&&Jr.push(an),{point:Xr,angle:Ln,path:zr,tilePath:Jr,up:bn}}function Tp(it,d){const $=d.length,st=$+4*it;d.resize(st),d.float32.fill(-1/0,4*$,4*st)}function us(it,d,$){const st=d[0],lt=d[1];return it[0]=$[0]*st+$[4]*lt+$[12],it[1]=$[1]*st+$[5]*lt+$[13],it[3]=$[3]*st+$[7]*lt+$[15],it}const ao=100;class Mo{constructor(d,$,st=new sv(d.width+200,d.height+200,25),lt=new sv(d.width+200,d.height+200,25)){this.transform=d,this.grid=st,this.ignoredGrid=lt,this.pitchfactor=Math.cos(d._pitch)*d.cameraToCenterDistance,this.screenRightBoundary=d.width+ao,this.screenBottomBoundary=d.height+ao,this.gridRightBoundary=d.width+200,this.gridBottomBoundary=d.height+200,this.fogState=$}placeCollisionBox(d,$,st,lt,ht,pt,mt,St,It,Dt,Ht){let Gt=st.projectedAnchorX,qt=st.projectedAnchorY,Qt=st.projectedAnchorZ;const Zt=st.tileAnchorX,sr=st.tileAnchorY,ir=st.elevation,hr=st.tileID,gr=d.getProjection();if(ir&&hr){const[Jr,rn,pn]=gr.upVector(hr.canonical,st.tileAnchorX,st.tileAnchorY),Pn=gr.upVectorScale(hr.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;Gt+=Jr*ir*Pn,qt+=rn*ir*Pn,Qt+=pn*ir*Pn}const dr=d.projection.name==="globe",Ir=d.projection.name==="globe"?c.aj(this.transform.zoom):0;if(hr&&dr&&Ir<1&&!pt){const Jr=1<<hr.canonical.z,rn=c.bP(Zt,sr);c.bQ(rn,rn,1/c.al),c.bR(rn,rn,c.bP(hr.canonical.x,hr.canonical.y)),c.bQ(rn,rn,1/Jr),c.bS(rn,rn,c.bP(lt[0],lt[1])),rn[0]=c.bT(rn[0],-.5,.5),c.bQ(rn,rn,c.al);const pn=c.bU(rn[0],rn[1],c.al/(2*Math.PI),1);c.aC(pn,pn,ht),Gt=c.ak(Gt,pn[0],Ir),qt=c.ak(qt,pn[1],Ir),Qt=c.ak(Qt,pn[2],Ir)}const Tr=this.projectAndGetPerspectiveRatio(Dt,Gt,qt,Qt,st.tileID,gr.name==="globe"||!!ir||this.transform.pitch>0,gr),Rr=It*Tr.perspectiveRatio,Er=(st.x1*$+mt.x-st.padding)*Rr+Tr.point.x,vr=(st.y1*$+mt.y-st.padding)*Rr+Tr.point.y,kr=(st.x2*$+mt.x+st.padding)*Rr+Tr.point.x,Ur=(st.y2*$+mt.y+st.padding)*Rr+Tr.point.y,zr=Tr.perspectiveRatio<=.55||Tr.occluded;return!this.isInsideGrid(Er,vr,kr,Ur)||!St&&this.grid.hitTest(Er,vr,kr,Ur,Ht)||zr?{box:[],offscreen:!1,occluded:Tr.occluded}:{box:[Er,vr,kr,Ur],offscreen:this.isOffscreen(Er,vr,kr,Ur),occluded:!1}}placeCollisionCircles(d,$,st,lt,ht,pt,mt,St,It,Dt,Ht,Gt,qt,Qt,Zt,sr){const ir=[],hr=this.transform.elevation,gr=d.getProjection(),dr=d.elevationType==="road",Ir=!!hr||dr,Tr=c.bV.getAtTileOffsetFunc(sr,this.transform.center.lat,this.transform.worldSize,gr),Rr=new c.P(st.tileAnchorX,st.tileAnchorY),Er=new c.P(st.tileAnchorX,st.tileAnchorY);let{x:vr,y:kr,z:Ur}=gr.projectTilePoint(Er.x,Er.y,sr.canonical),zr=null;if(Ir){const ns=dr?d.getElevationFeatureForText(lt):null;zr={getElevation:Tr,elevation:hr,elevationFeature:ns};const[_i,$n,qn]=Tr(Rr,hr,ns);vr+=_i,kr+=$n,Ur+=qn}const Jr=gr.name==="globe",rn=this.projectAndGetPerspectiveRatio(St,vr,kr,Ur,sr,Jr||!!hr||this.transform.pitch>0,gr),{perspectiveRatio:pn}=rn,Pn=(Gt?mt/pn:mt*pn)/c.bY,Kr=hp(vr,kr,Ur,It),jr=st.lineOffsetX*Pn,an=st.lineOffsetY*Pn,Xr=c.an(d.layers[0].layout.get("text-max-angle")),bn=Math.cos(Xr),Fn=rn.signedDistanceFromCamera>0?iw(Pn,pt,jr,an,dr&&st.flipState===1,Kr,Er,st,ht,It,{},Ir&&!Gt?zr:null,Gt&&Ir,gr,sr,Gt,bn):null;let Hn=!1,Ln=!1,In=!0;if(Fn&&!rn.occluded){const ns=.5*Qt*pn+Zt,_i=new c.P(-100,-100),$n=new c.P(this.screenRightBoundary,this.screenBottomBoundary),qn=new dy,{first:ms,last:Ns}=Fn,to=ms.path.length;let _o=[];for(let Ds=to-1;Ds>=1;Ds--)_o.push(ms.path[Ds]);for(let Ds=1;Ds<Ns.path.length;Ds++)_o.push(Ns.path[Ds]);const is=2.5*ns;Dt&&(_o=_o.map(([Ds,To,Do],Po)=>(Ir&&!Jr&&(Do=Tr(Po<to-1?ms.tilePath[to-1-Po]:Ns.tilePath[Po-to+2],hr,zr.elevationFeature)[2]),hp(Ds,To,Do,Dt))),_o.some(Ds=>Ds[3]<=0)&&(_o=[]));let go=[];if(_o.length>0){let Ds=1/0,To=-1/0,Do=1/0,Po=-1/0;for(const mo of _o)Ds=Math.min(Ds,mo[0]),Do=Math.min(Do,mo[1]),To=Math.max(To,mo[0]),Po=Math.max(Po,mo[1]);To>=_i.x&&Ds<=$n.x&&Po>=_i.y&&Do<=$n.y&&(go=[_o.map(mo=>new c.P(mo[0],mo[1]))],(Ds<_i.x||To>$n.x||Do<_i.y||Po>$n.y)&&(go=c.bW(go,_i.x,_i.y,$n.x,$n.y)))}for(const Ds of go){qn.reset(Ds,.25*ns);let To=0;To=qn.length<=.5*ns?1:Math.ceil(qn.paddedLength/is)+1;for(let Do=0;Do<To;Do++){const Po=Do/Math.max(To-1,1),mo=qn.lerp(Po),Vs=mo.x+ao,bo=mo.y+ao;ir.push(Vs,bo,ns,0);const Al=Vs-ns,xa=bo-ns,So=Vs+ns,uo=bo+ns;if(In=In&&this.isOffscreen(Al,xa,So,uo),Ln=Ln||this.isInsideGrid(Al,xa,So,uo),!$&&this.grid.hitTestCircle(Vs,bo,ns,qt)&&(Hn=!0,!Ht))return{circles:[],offscreen:!1,collisionDetected:Hn,occluded:!1}}}}return{circles:!Ht&&Hn||!Ln?[]:ir,offscreen:In,collisionDetected:Hn,occluded:rn.occluded}}queryRenderedSymbols(d){if(d.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const $=[];let st=1/0,lt=1/0,ht=-1/0,pt=-1/0;for(const Dt of d){const Ht=new c.P(Dt.x+ao,Dt.y+ao);st=Math.min(st,Ht.x),lt=Math.min(lt,Ht.y),ht=Math.max(ht,Ht.x),pt=Math.max(pt,Ht.y),$.push(Ht)}const mt=this.grid.query(st,lt,ht,pt).concat(this.ignoredGrid.query(st,lt,ht,pt)),St={},It={};for(const Dt of mt){const Ht=Dt.key;if(St[Ht.bucketInstanceId]===void 0&&(St[Ht.bucketInstanceId]={}),St[Ht.bucketInstanceId][Ht.featureIndex])continue;const Gt=[new c.P(Dt.x1,Dt.y1),new c.P(Dt.x2,Dt.y1),new c.P(Dt.x2,Dt.y2),new c.P(Dt.x1,Dt.y2)];c.bX($,Gt)&&(St[Ht.bucketInstanceId][Ht.featureIndex]=!0,It[Ht.bucketInstanceId]===void 0&&(It[Ht.bucketInstanceId]=[]),It[Ht.bucketInstanceId].push(Ht.featureIndex))}return It}insertCollisionBox(d,$,st,lt,ht){($?this.ignoredGrid:this.grid).insert({bucketInstanceId:st,featureIndex:lt,collisionGroupID:ht},d[0],d[1],d[2],d[3])}insertCollisionCircles(d,$,st,lt,ht){const pt=$?this.ignoredGrid:this.grid,mt={bucketInstanceId:st,featureIndex:lt,collisionGroupID:ht};for(let St=0;St<d.length;St+=4)pt.insertCircle(mt,d[St],d[St+1],d[St+2])}projectAndGetPerspectiveRatio(d,$,st,lt,ht,pt,mt){const St=[$,st,lt,1];let It=!1;lt||this.transform.pitch>0?(c.aC(St,St,d),this.fogState&&ht&&mt.name!=="globe"&&(It=function(Gt,qt,Qt,Zt,sr,ir){const hr=ir.calculateFogTileMatrix(sr),gr=[qt,Qt,Zt];return c.af(gr,gr,hr),Zn(Gt,c.ag(gr),ir.pitch,ir._fov)}(this.fogState,$,st,lt,ht.toUnwrapped(),this.transform)>.9)):us(St,St,d);const Dt=St[3];return{point:new c.P((St[0]/Dt+1)/2*this.transform.width+ao,(-St[1]/Dt+1)/2*this.transform.height+ao),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(mt)/Dt*.5,1.5),signedDistanceFromCamera:Dt,occluded:pt&&St[2]>Dt||It}}isOffscreen(d,$,st,lt){return st<ao||d>=this.screenRightBoundary||lt<ao||$>this.screenBottomBoundary}isInsideGrid(d,$,st,lt){return st>=0&&d<this.gridRightBoundary&&lt>=0&&$<this.gridBottomBoundary}getViewportMatrix(){const d=c.bA([]);return c.br(d,d,[-100,-100,0]),d}}class Gu{constructor(d,$,st,lt){this.opacity=d?Math.max(0,Math.min(1,d.opacity+(d.placed?$:-$))):lt&&st?1:0,this.placed=st}isHidden(){return this.opacity===0&&!this.placed}}class Op{constructor(d,$,st,lt,ht,pt=!1){this.text=new Gu(d?d.text:null,$,st,ht),this.icon=new Gu(d?d.icon:null,$,lt,ht),this.clipped=pt}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ao{constructor(d,$,st,lt=!1){this.text=d,this.icon=$,this.skipFade=st,this.clipped=lt}}class xx{constructor(){this.invProjMatrix=c.bC(),this.viewportMatrix=c.bC(),this.circles=[]}}class my{constructor(d,$,st,lt,ht){this.bucketInstanceId=d,this.featureIndex=$,this.sourceLayerIndex=st,this.bucketIndex=lt,this.tileID=ht}}class gy{constructor(d){this.crossSourceCollisions=d,this.maxGroupID=0,this.collisionGroups={}}get(d){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[d]){const $=++this.maxGroupID;this.collisionGroups[d]={ID:$,predicate:st=>st.collisionGroupID===$}}return this.collisionGroups[d]}}function Au(it,d,$,st,lt){const{horizontalAlign:ht,verticalAlign:pt}=c.c1(it),mt=-(ht-.5)*d,St=-(pt-.5)*$,It=c.c2(it,st);return new c.P(mt+It[0]*lt,St+It[1]*lt)}function Zl(it,d,$,st,lt){const ht=new c.P(it,d);return $&&ht._rotate(st?lt:-lt),ht}class QE{constructor(d,$,st,lt,ht,pt){this.transform=d.clone(),this.projection=d.projection.name,this.collisionIndex=new Mo(this.transform,ht),this.buildingIndex=pt,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=$,this.retainedQueryData={},this.collisionGroups=new gy(st),this.collisionCircleArrays={},this.prevPlacement=lt,lt&&(lt.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(d,$,st,lt,ht=1){const pt=st.getBucket($),mt=st.latestFeatureIndex;if(!pt||!mt||$.fqid!==pt.layerIds[0])return;const St=pt.layers[0].layout,It=pt.layers[0].paint,Dt=st.collisionBoxArray,Ht=Math.pow(2,this.transform.zoom-st.tileID.overscaledZ),Gt=st.tileSize/c.al,qt=st.tileID.toUnwrapped();this.transform.setProjection(pt.projection);const Qt=(Zt=st.tileID,sr=pt.getProjection(),ir=this.transform,sr.name===this.projection?ir.calculateProjMatrix(Zt.toUnwrapped()):iv(ir,sr,Zt));var Zt,sr,ir;const hr=St.get("text-pitch-alignment")==="map",gr=St.get("text-rotation-alignment")==="map";$.compileFilter($.options);const dr=$.dynamicFilter(),Ir=$.dynamicFilterNeedsFeature(),Tr=this.transform.calculatePixelsToTileUnitsMatrix(st),Rr=yx(Qt,st.tileID.canonical,hr,gr,this.transform,pt.getProjection(),Tr);let Er=null;const vr=pt.getProjection().createInversionMatrix(this.transform,st.tileID.canonical);if(hr){const jr=py(Qt,st.tileID.canonical,hr,gr,this.transform,pt.getProjection(),Tr);Er=c.aB([],this.transform.labelPlaneMatrix,jr)}let kr=null;dr&&st.latestFeatureIndex&&(kr={unwrappedTileID:qt,dynamicFilter:dr,dynamicFilterNeedsFeature:Ir}),this.retainedQueryData[pt.bucketInstanceId]=new my(pt.bucketInstanceId,mt,pt.sourceLayerIndex,pt.index,st.tileID);const[Ur,zr]=pt.layers[0].layout.get("text-size-scale-range"),Jr=c.aA(ht,Ur,zr),[rn,pn]=St.get("icon-size-scale-range"),Pn=c.aA(ht,rn,pn),Kr={bucket:pt,layout:St,paint:It,posMatrix:Qt,invMatrix:vr,mercatorCenter:[c.aF(this.transform.center.lng),c.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Rr,labelToScreenMatrix:Er,clippingData:kr,scale:Ht,textPixelRatio:Gt,holdingForFade:st.holdingForFade(),collisionBoxArray:Dt,partiallyEvaluatedTextSize:c.bK(pt.textSizeData,this.transform.zoom,Jr),partiallyEvaluatedIconSize:c.bK(pt.iconSizeData,this.transform.zoom,Pn),collisionGroup:this.collisionGroups.get(pt.sourceID),latestFeatureIndex:st.latestFeatureIndex};if(lt)for(const jr of pt.sortKeyRanges){const{sortKey:an,symbolInstanceStart:Xr,symbolInstanceEnd:bn}=jr;d.push({sortKey:an,symbolInstanceStart:Xr,symbolInstanceEnd:bn,parameters:Kr})}else d.push({symbolInstanceStart:0,symbolInstanceEnd:pt.symbolInstances.length,parameters:Kr})}attemptAnchorPlacement(d,$,st,lt,ht,pt,mt,St,It,Dt,Ht,Gt,qt,Qt,Zt,sr,ir,hr,gr,dr,Ir){const{textOffset0:Tr,textOffset1:Rr,crossTileID:Er}=Zt,vr=[Tr,Rr],kr=Au(d,pt,mt,vr,St),Ur=this.collisionIndex.placeCollisionBox(ir,St,$,st,lt,ht,Zl(kr.x,kr.y,It,Dt,this.transform.angle),Qt,Ht,Gt,qt.predicate);if(gr){const zr=ir.getSymbolInstanceIconSize(Ir,this.transform.zoom,Zt.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ir,zr,gr,st,lt,ht,Zl(kr.x,kr.y,It,Dt,this.transform.angle),Qt,Ht,Gt,qt.predicate).box.length===0)return}if(Ur.box.length>0){let zr;return this.prevPlacement&&this.prevPlacement.variableOffsets[Er]&&this.prevPlacement.placements[Er]&&this.prevPlacement.placements[Er].text&&(zr=this.prevPlacement.variableOffsets[Er].anchor),this.variableOffsets[Er]={textOffset:vr,width:pt,height:mt,anchor:d,textScale:St,prevAnchor:zr},this.markUsedJustification(ir,d,Zt,hr),ir.allowVerticalPlacement&&(this.markUsedOrientation(ir,hr,Zt),this.placedOrientations[Er]=hr),{shift:kr,placedGlyphBoxes:Ur}}}placeLayerBucketPart(d,$,st,lt,ht=1){const{bucket:pt,layout:mt,paint:St,posMatrix:It,textLabelPlaneMatrix:Dt,labelToScreenMatrix:Ht,clippingData:Gt,textPixelRatio:qt,mercatorCenter:Qt,invMatrix:Zt,holdingForFade:sr,collisionBoxArray:ir,partiallyEvaluatedTextSize:hr,partiallyEvaluatedIconSize:gr,collisionGroup:dr,latestFeatureIndex:Ir}=d.parameters,Tr=mt.get("text-optional"),Rr=mt.get("icon-optional"),Er=mt.get("text-allow-overlap"),vr=mt.get("icon-allow-overlap"),kr=mt.get("text-rotation-alignment")==="map",Ur=mt.get("icon-rotation-alignment")==="map",zr=mt.get("text-pitch-alignment")==="map",Jr=St.get("symbol-z-offset"),rn=mt.get("symbol-elevation-reference")==="sea",pn=mt.get("symbol-placement"),[Pn,Kr]=mt.get("text-size-scale-range"),[jr,an]=mt.get("icon-size-scale-range"),Xr=c.aA(ht,Pn,Kr),bn=c.aA(ht,jr,an),Fn=mt.get("text-variable-anchor"),Hn=kr&&pn!=="point",Ln=Ur&&pn!=="point",In=Fn&&pt.hasTextData(),ns=pt.hasIconTextFit()&&In&&pt.hasIconData();this.transform.setProjection(pt.projection);const _i=In||Hn,$n=Ln||ns;let qn=Er&&(vr||!pt.hasIconData()||Rr),ms=vr&&(Er||!pt.hasTextData()||Tr);const Ns=!Jr.isConstant();!pt.collisionArrays&&ir&&pt.deserializeCollisionBoxes(ir),st&&lt&&pt.updateCollisionDebugBuffers(this.transform.zoom,ir,Xr,bn);const to=(is,go,Ds)=>{const{crossTileID:To,numVerticalGlyphVertices:Do}=is;let Po=null;if(Gt&&Gt.dynamicFilterNeedsFeature||Ns){const Nl=this.retainedQueryData[pt.bucketInstanceId];Po=Ir.loadFeature({featureIndex:is.featureIndex,bucketIndex:Nl.bucketIndex,sourceLayerIndex:Nl.sourceLayerIndex,layoutVertexArrayOffset:0});const Gl=Po.properties?Po.properties.worldview:null;if(pt.localizable&&pt.worldview&&typeof Gl=="string")if(Gl==="all")Po.properties.$localized=!0;else{if(!Gl.split(",").includes(pt.worldview))return;Po.properties.$localized=!0,Po.properties.worldview=pt.worldview}}if(Gt&&!(0,Gt.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:pt.worldview},Po,this.retainedQueryData[pt.bucketInstanceId].tileID.canonical,new c.P(is.tileAnchorX,is.tileAnchorY),this.transform.calculateDistanceTileData(Gt.unwrappedTileID)))return this.placements[To]=new Ao(!1,!1,!1,!0),void $.add(To);const mo=Jr.evaluate(Po,{});if($.has(To))return;if(sr)return void(this.placements[To]=new Ao(!1,!1,!1));let Vs=!1,bo=!1,Al=!0,xa=!1,So=!1,uo=null,Us={box:null,offscreen:null,occluded:null},Yo={box:null},Fl=null,wl=null,Oo=null,zu=0,Eu=0,nu=0;Ds.textFeatureIndex?zu=Ds.textFeatureIndex:is.useRuntimeCollisionCircles&&(zu=is.featureIndex),Ds.verticalTextFeatureIndex&&(Eu=Ds.verticalTextFeatureIndex);const Pu=pt.elevationFeatures?pt.elevationFeatures[is.elevationFeatureIndex]:void 0,Iu=Nl=>{Nl.tileID=this.retainedQueryData[pt.bucketInstanceId].tileID;const Gl=this.transform.elevation;Nl.elevation=rn?mo:mo+c.bV.getAtTileOffset(Nl.tileID,new c.P(Nl.tileAnchorX,Nl.tileAnchorY),Gl,Pu),Nl.elevation+=is.zOffset},xu=Ds.textBox;if(xu){Iu(xu);const Nl=Fo=>{let Kl=c.bL.horizontal;if(pt.allowVerticalPlacement&&!Fo&&this.prevPlacement){const Rl=this.prevPlacement.placedOrientations[To];Rl&&(this.placedOrientations[To]=Rl,Kl=Rl,this.markUsedOrientation(pt,Kl,is))}return Kl},Gl=(Fo,Kl)=>{if(pt.allowVerticalPlacement&&Do>0&&Ds.verticalTextBox){for(const Rl of pt.writingModes)if(Rl===c.bL.vertical?(Us=Kl(),Yo=Us):Us=Fo(),Us&&Us.box&&Us.box.length)break}else Us=Fo()};if(Fn){let Fo=Fn;if(this.prevPlacement&&this.prevPlacement.variableOffsets[To]){const El=this.prevPlacement.variableOffsets[To];Fo.indexOf(El.anchor)>0&&(Fo=Fo.filter(vp=>vp!==El.anchor),Fo.unshift(El.anchor))}const Kl=(El,vp,Gy)=>{const Ip=pt.getSymbolInstanceTextSize(hr,is,this.transform.zoom,go),Hy=(El.x2-El.x1)*Ip+2*El.padding,H0=(El.y2-El.y1)*Ip+2*El.padding,Wp=is.hasIconTextFit&&!vr?vp:null;Wp&&Iu(Wp);let um={box:[],offscreen:!1,occluded:!1};const W0=Er?2*Fo.length:Fo.length;for(let zm=0;zm<W0;++zm){const hm=this.attemptAnchorPlacement(Fo[zm%Fo.length],El,Qt,Zt,_i,Hy,H0,Ip,kr,zr,qt,It,dr,zm>=Fo.length,is,go,pt,Gy,Wp,hr,gr);if(hm&&(um=hm.placedGlyphBoxes,um&&um.box&&um.box.length)){Vs=!0,uo=hm.shift;break}}return um};Gl(()=>Kl(xu,Ds.iconBox,c.bL.horizontal),()=>{const El=Ds.verticalTextBox;return El&&Iu(El),pt.allowVerticalPlacement&&!(Us&&Us.box&&Us.box.length)&&Do>0&&El?Kl(El,Ds.verticalIconBox,c.bL.vertical):{box:null,offscreen:null,occluded:null}}),Us&&(Vs=Us.box,Al=Us.offscreen,xa=Us.occluded);const Rl=Nl(!(!Us||!Us.box));if(!Vs&&this.prevPlacement){const El=this.prevPlacement.variableOffsets[To];El&&(this.variableOffsets[To]=El,this.markUsedJustification(pt,El.anchor,is,Rl))}}else{const Fo=(Kl,Rl)=>{const El=pt.getSymbolInstanceTextSize(hr,is,this.transform.zoom,go),vp=this.collisionIndex.placeCollisionBox(pt,El,Kl,Qt,Zt,_i,new c.P(0,0),Er,qt,It,dr.predicate);return vp&&vp.box&&vp.box.length&&(this.markUsedOrientation(pt,Rl,is),this.placedOrientations[To]=Rl),vp};Gl(()=>Fo(xu,c.bL.horizontal),()=>{const Kl=Ds.verticalTextBox;return pt.allowVerticalPlacement&&Do>0&&Kl?(Iu(Kl),Fo(Kl,c.bL.vertical)):{box:null,offscreen:null,occluded:null}}),Nl(!!(Us&&Us.box&&Us.box.length))}}if(Fl=Us,Vs=Fl&&Fl.box&&Fl.box.length>0,Al=Fl&&Fl.offscreen,xa=Fl&&Fl.occluded,is.useRuntimeCollisionCircles){const Nl=is.centerJustifiedTextSymbolIndex>=0?is.centerJustifiedTextSymbolIndex:is.verticalPlacedTextSymbolIndex,Gl=pt.text.placedSymbolArray.get(Nl),Fo=c.bM(pt.textSizeData,hr,Gl),Kl=mt.get("text-padding");wl=this.collisionIndex.placeCollisionCircles(pt,Er,Gl,Nl,pt.lineVertexArray,pt.glyphOffsetArray,Fo,It,Dt,Ht,st,zr,dr.predicate,is.collisionCircleDiameter*Fo/c.bY,Kl,this.retainedQueryData[pt.bucketInstanceId].tileID),Vs=Er||wl.circles.length>0&&!wl.collisionDetected,Al=Al&&wl.offscreen,xa=wl.occluded}if(Ds.iconFeatureIndex&&(nu=Ds.iconFeatureIndex),Ds.iconBox){const Nl=Gl=>{Iu(Gl);const Fo=is.hasIconTextFit&&uo?Zl(uo.x,uo.y,kr,zr,this.transform.angle):new c.P(0,0),Kl=pt.getSymbolInstanceIconSize(gr,this.transform.zoom,is.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(pt,Kl,Gl,Qt,Zt,$n,Fo,vr,qt,It,dr.predicate)};Yo&&Yo.box&&Yo.box.length&&Ds.verticalIconBox?(Oo=Nl(Ds.verticalIconBox),bo=Oo.box.length>0):(Oo=Nl(Ds.iconBox),bo=Oo.box.length>0),Al=Al&&Oo.offscreen,So=Oo.occluded}const np=Tr||is.numHorizontalGlyphVertices===0&&Do===0,_p=Rr||is.numIconVertices===0;if(np||_p?_p?np||(bo=bo&&Vs):Vs=bo&&Vs:bo=Vs=bo&&Vs,Vs&&Fl&&Fl.box&&this.collisionIndex.insertCollisionBox(Fl.box,mt.get("text-ignore-placement"),pt.bucketInstanceId,Yo&&Yo.box&&Eu?Eu:zu,dr.ID),bo&&Oo&&this.collisionIndex.insertCollisionBox(Oo.box,mt.get("icon-ignore-placement"),pt.bucketInstanceId,nu,dr.ID),wl&&(Vs&&this.collisionIndex.insertCollisionCircles(wl.circles,mt.get("text-ignore-placement"),pt.bucketInstanceId,zu,dr.ID),st)){const Nl=pt.bucketInstanceId;let Gl=this.collisionCircleArrays[Nl];Gl===void 0&&(Gl=this.collisionCircleArrays[Nl]=new xx);for(let Fo=0;Fo<wl.circles.length;Fo+=4)Gl.circles.push(wl.circles[Fo+0]),Gl.circles.push(wl.circles[Fo+1]),Gl.circles.push(wl.circles[Fo+2]),Gl.circles.push(wl.collisionDetected?1:0)}const qu=pt.projection.name!=="globe";qn=qn&&(qu||!xa),ms=ms&&(qu||!So),this.placements[To]=new Ao(Vs||qn,bo||ms,Al||pt.justReloaded),$.add(To)},_o=this.retainedQueryData[pt.bucketInstanceId].tileID;if(pt.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(pt,_o),pt.elevationType==="road"&&pt.updateRoadElevation(_o.canonical),pt.updateZOffset(),pt.sortFeaturesByY){const is=pt.getSortedSymbolIndexes(this.transform.angle);for(let go=is.length-1;go>=0;--go){const Ds=is[go];to(pt.symbolInstances.get(Ds),Ds,pt.collisionArrays[Ds])}pt.hasAnyZOffset&&c.w(`${pt.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(pt.hasAnyZOffset){const is=pt.getSortedIndexesByZOffset();for(let go=0;go<is.length;++go){const Ds=is[go];to(pt.symbolInstances.get(Ds),Ds,pt.collisionArrays[Ds])}}else for(let is=d.symbolInstanceStart;is<d.symbolInstanceEnd;is++)to(pt.symbolInstances.get(is),is,pt.collisionArrays[is]);if(st&&pt.bucketInstanceId in this.collisionCircleArrays){const is=this.collisionCircleArrays[pt.bucketInstanceId];c.bl(is.invProjMatrix,It),is.viewportMatrix=this.collisionIndex.getViewportMatrix()}pt.justReloaded=!1}markUsedJustification(d,$,st,lt){const{leftJustifiedTextSymbolIndex:ht,centerJustifiedTextSymbolIndex:pt,rightJustifiedTextSymbolIndex:mt,verticalPlacedTextSymbolIndex:St,crossTileID:It}=st,Dt=c.c3($),Ht=lt===c.bL.vertical?St:Dt==="left"?ht:Dt==="center"?pt:Dt==="right"?mt:-1;ht>=0&&(d.text.placedSymbolArray.get(ht).crossTileID=Ht>=0&&ht!==Ht?0:It),pt>=0&&(d.text.placedSymbolArray.get(pt).crossTileID=Ht>=0&&pt!==Ht?0:It),mt>=0&&(d.text.placedSymbolArray.get(mt).crossTileID=Ht>=0&&mt!==Ht?0:It),St>=0&&(d.text.placedSymbolArray.get(St).crossTileID=Ht>=0&&St!==Ht?0:It)}markUsedOrientation(d,$,st){const lt=$===c.bL.horizontal||$===c.bL.horizontalOnly?$:0,ht=$===c.bL.vertical?$:0,{leftJustifiedTextSymbolIndex:pt,centerJustifiedTextSymbolIndex:mt,rightJustifiedTextSymbolIndex:St,verticalPlacedTextSymbolIndex:It}=st,Dt=d.text.placedSymbolArray;pt>=0&&(Dt.get(pt).placedOrientation=lt),mt>=0&&(Dt.get(mt).placedOrientation=lt),St>=0&&(Dt.get(St).placedOrientation=lt),It>=0&&(Dt.get(It).placedOrientation=ht)}commit(d){this.commitTime=d,this.zoomAtLastRecencyCheck=this.transform.zoom;const $=this.prevPlacement;let st=!1;this.prevZoomAdjustment=$?$.zoomAdjustment(this.transform.zoom):0;const lt=$?$.symbolFadeChange(d):1,ht=$?$.opacities:{},pt=$?$.variableOffsets:{},mt=$?$.placedOrientations:{};for(const St in this.placements){const It=this.placements[St],Dt=ht[St];Dt?(this.opacities[St]=new Op(Dt,lt,It.text,It.icon,null,It.clipped),st=st||It.text!==Dt.text.placed||It.icon!==Dt.icon.placed):(this.opacities[St]=new Op(null,lt,It.text,It.icon,It.skipFade,It.clipped),st=st||It.text||It.icon)}for(const St in ht){const It=ht[St];if(!this.opacities[St]){const Dt=new Op(It,lt,!1,!1);Dt.isHidden()||(this.opacities[St]=Dt,st=st||It.text.placed||It.icon.placed)}}for(const St in pt)this.variableOffsets[St]||!this.opacities[St]||this.opacities[St].isHidden()||(this.variableOffsets[St]=pt[St]);for(const St in mt)this.placedOrientations[St]||!this.opacities[St]||this.opacities[St].isHidden()||(this.placedOrientations[St]=mt[St]);st?this.lastPlacementChangeTime=d:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=$?$.lastPlacementChangeTime:d)}updateLayerOpacities(d,$,st,lt){lt&&(this.lastReplacementSourceUpdateTime=lt.updateTime);const ht=new Set;for(const pt of $){const mt=pt.getBucket(d);mt&&pt.latestFeatureIndex&&d.fqid===mt.layerIds[0]&&(this.updateBucketOpacities(mt,ht,pt,pt.collisionBoxArray,st,lt,pt.tileID,d.scope),mt.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(mt,pt.tileID),mt.elevationType==="road"&&mt.updateRoadElevation(pt.tileID.canonical),mt.updateZOffset())}}updateBucketOpacities(d,$,st,lt,ht,pt,mt,St){d.hasTextData()&&d.text.opacityVertexArray.clear(),d.hasIconData()&&d.icon.opacityVertexArray.clear(),d.hasIconCollisionBoxData()&&d.iconCollisionBox.collisionVertexArray.clear(),d.hasTextCollisionBoxData()&&d.textCollisionBox.collisionVertexArray.clear();const It=d.layers[0].layout,Dt=d.layers[0].paint,Ht=!!d.layers[0].dynamicFilter(),Gt=new Op(null,0,!1,!1,!0),qt=It.get("text-allow-overlap"),Qt=It.get("icon-allow-overlap"),Zt=It.get("text-variable-anchor"),sr=It.get("text-rotation-alignment")==="map",ir=It.get("text-pitch-alignment")==="map",hr=Dt.get("symbol-z-offset"),gr=It.get("symbol-elevation-reference")==="sea",dr=!hr.isConstant(),Ir=new Op(null,0,qt&&(Qt||!d.hasIconData()||It.get("icon-optional")),Qt&&(qt||!d.hasTextData()||It.get("text-optional")),!0);!d.collisionArrays&&lt&&(d.hasIconCollisionBoxData()||d.hasTextCollisionBoxData())&&d.deserializeCollisionBoxes(lt);const Tr=(Er,vr,kr)=>{for(let Ur=0;Ur<vr/4;Ur++)Er.opacityVertexArray.emplaceBack(kr)};let Rr=0;pt&&d.updateReplacement(mt,pt);for(let Er=0;Er<d.symbolInstances.length;Er++){const vr=d.symbolInstances.get(Er),{numHorizontalGlyphVertices:kr,numVerticalGlyphVertices:Ur,crossTileID:zr,numIconVertices:Jr,tileAnchorX:rn,tileAnchorY:pn}=vr;let Pn=null;const Kr=this.retainedQueryData[d.bucketInstanceId];dr&&vr&&Kr&&(Pn=st.latestFeatureIndex.loadFeature({featureIndex:vr.featureIndex,bucketIndex:Kr.bucketIndex,sourceLayerIndex:Kr.sourceLayerIndex,layoutVertexArrayOffset:0}));const jr=hr.evaluate(Pn,{}),an=$.has(zr);let Xr=this.opacities[zr];an?Xr=Gt:Xr||(Xr=Ir,this.opacities[zr]=Xr),$.add(zr);const bn=kr>0||Ur>0,Fn=Jr>0,Hn=this.placedOrientations[zr],Ln=Hn===c.bL.vertical,In=Hn===c.bL.horizontal||Hn===c.bL.horizontalOnly;!bn&&!Fn||Xr.isHidden()||Rr++;let ns=!1;if((bn||Fn)&&pt)for(const _i of d.activeReplacements){if(c.bZ(_i,ht,c.b_.Symbol,St)||_i.min.x>rn||rn>_i.max.x||_i.min.y>pn||pn>_i.max.y)continue;const $n=c.b$(rn,pn,mt.canonical,_i.footprintTileId.canonical);if(ns=c.c0($n,_i.footprint),ns)break}if(bn){const _i=ns?_g:ju(Xr.text);Tr(d.text,kr,Ln?_g:_i),Tr(d.text,Ur,In?_g:_i);const $n=Xr.text.isHidden(),{leftJustifiedTextSymbolIndex:qn,centerJustifiedTextSymbolIndex:ms,rightJustifiedTextSymbolIndex:Ns,verticalPlacedTextSymbolIndex:to}=vr,_o=d.text.placedSymbolArray,is=$n||Ln?1:0;qn>=0&&(_o.get(qn).hidden=is),ms>=0&&(_o.get(ms).hidden=is),Ns>=0&&(_o.get(Ns).hidden=is),to>=0&&(_o.get(to).hidden=$n||In?1:0);const go=this.variableOffsets[zr];go&&this.markUsedJustification(d,go.anchor,vr,Hn);const Ds=this.placedOrientations[zr];Ds&&(this.markUsedJustification(d,"left",vr,Ds),this.markUsedOrientation(d,Ds,vr))}if(Fn){const _i=ns?_g:ju(Xr.icon),{placedIconSymbolIndex:$n,verticalPlacedIconSymbolIndex:qn}=vr,ms=d.icon.placedSymbolArray,Ns=Xr.icon.isHidden()?1:0;$n>=0&&(Tr(d.icon,Jr,Ln?_g:_i),ms.get($n).hidden=Ns),qn>=0&&(Tr(d.icon,vr.numVerticalIconVertices,In?_g:_i),ms.get(qn).hidden=Ns)}if(d.hasIconCollisionBoxData()||d.hasTextCollisionBoxData()){const _i=d.collisionArrays[Er];if(_i){let $n=new c.P(0,0),qn=!0;if(_i.textBox||_i.verticalTextBox){if(Zt){const Ns=this.variableOffsets[zr];Ns?($n=Au(Ns.anchor,Ns.width,Ns.height,Ns.textOffset,Ns.textScale),sr&&$n._rotate(ir?this.transform.angle:-this.transform.angle)):qn=!1}Ht&&(qn=!Xr.clipped),_i.textBox&&Sm(d.textCollisionBox.collisionVertexArray,Xr.text.placed,!qn||Ln,jr,gr,$n.x,$n.y),_i.verticalTextBox&&Sm(d.textCollisionBox.collisionVertexArray,Xr.text.placed,!qn||In,jr,gr,$n.x,$n.y)}const ms=qn&&!!(!In&&_i.verticalIconBox);_i.iconBox&&Sm(d.iconCollisionBox.collisionVertexArray,Xr.icon.placed,ms,jr,gr,vr.hasIconTextFit?$n.x:0,vr.hasIconTextFit?$n.y:0),_i.verticalIconBox&&Sm(d.iconCollisionBox.collisionVertexArray,Xr.icon.placed,!ms,jr,gr,vr.hasIconTextFit?$n.x:0,vr.hasIconTextFit?$n.y:0)}}}if(d.fullyClipped=Rr===0,d.sortFeatures(this.transform.angle),this.retainedQueryData[d.bucketInstanceId]&&(this.retainedQueryData[d.bucketInstanceId].featureSortOrder=d.featureSortOrder),d.hasTextData()&&d.text.opacityVertexBuffer&&d.text.opacityVertexBuffer.updateData(d.text.opacityVertexArray),d.hasIconData()&&d.icon.opacityVertexBuffer&&d.icon.opacityVertexBuffer.updateData(d.icon.opacityVertexArray),d.hasIconCollisionBoxData()&&d.iconCollisionBox.collisionVertexBuffer&&d.iconCollisionBox.collisionVertexBuffer.updateData(d.iconCollisionBox.collisionVertexArray),d.hasTextCollisionBoxData()&&d.textCollisionBox.collisionVertexBuffer&&d.textCollisionBox.collisionVertexBuffer.updateData(d.textCollisionBox.collisionVertexArray),d.bucketInstanceId in this.collisionCircleArrays){const Er=this.collisionCircleArrays[d.bucketInstanceId];d.placementInvProjMatrix=Er.invProjMatrix,d.placementViewportMatrix=Er.viewportMatrix,d.collisionCircleArray=Er.circles,delete this.collisionCircleArrays[d.bucketInstanceId]}}symbolFadeChange(d){return this.fadeDuration===0?1:(d-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(d){return Math.max(0,(this.transform.zoom-d)/1.5)}hasTransitions(d){return this.stale||d-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(d,$){const st=this.zoomAtLastRecencyCheck===$?1-this.zoomAdjustment($):1;return this.zoomAtLastRecencyCheck=$,this.commitTime+this.fadeDuration*st>d}isStale(){return this.stale}setStale(){this.stale=!0}}function Sm(it,d,$,st,lt,ht,pt){it.emplaceBack(d?1:0,$?1:0,ht||0,pt||0,st,lt?1:0),it.emplaceBack(d?1:0,$?1:0,ht||0,pt||0,st,lt?1:0),it.emplaceBack(d?1:0,$?1:0,ht||0,pt||0,st,lt?1:0),it.emplaceBack(d?1:0,$?1:0,ht||0,pt||0,st,lt?1:0)}const av=Math.pow(2,25),yy=Math.pow(2,24),_x=Math.pow(2,17),lv=Math.pow(2,16),vx=Math.pow(2,9),Lu=Math.pow(2,8),Yp=Math.pow(2,1);function ju(it){if(it.opacity===0&&!it.placed)return 0;if(it.opacity===1&&it.placed)return 4294967295;const d=it.placed?1:0,$=Math.floor(127*it.opacity);return $*av+d*yy+$*_x+d*lv+$*vx+d*Lu+$*Yp+d}const _g=0;class w0{constructor(d){this._sortAcrossTiles=d.layout.get("symbol-z-order")!=="viewport-y"&&d.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(d,$,st,lt,ht,pt){const mt=this._bucketParts;for(;this._currentTileIndex<d.length;)if($.getBucketParts(mt,lt,d[this._currentTileIndex],this._sortAcrossTiles,pt),this._currentTileIndex++,ht())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,mt.sort((St,It)=>St.sortKey-It.sortKey));this._currentPartIndex<mt.length;){const St=mt[this._currentPartIndex];if($.placeLayerBucketPart(St,this._seenCrossTileIDs,st,St.symbolInstanceStart===0,pt),this._currentPartIndex++,ht())return!0}return!1}}class du{constructor(d,$,st,lt,ht,pt,mt,St,It){this.placement=new QE(d,ht,pt,mt,St,It),this._currentPlacementIndex=$.length-1,this._forceFullPlacement=st,this._showCollisionBoxes=lt,this._done=!1}isDone(){return this._done}continuePlacement(d,$,st,lt,ht){const pt=c.o.now(),mt=()=>{const St=c.o.now()-pt;return!this._forceFullPlacement&&St>2};for(;this._currentPlacementIndex>=0;){const St=$[d[this._currentPlacementIndex]],It=this.placement.collisionIndex.transform.zoom;if(St.type==="symbol"&&St.visibility!=="none"&&(!St.minzoom||St.minzoom<=It)&&(!St.maxzoom||St.maxzoom>It)){const Dt=St,Ht=Dt.layout.get("symbol-z-elevate"),Gt=Dt.layout.get("symbol-sort-key").constantOr(1)!==void 0,qt=Dt.layout.get("symbol-z-order"),Qt=qt==="viewport-y"||qt==="auto"&&!(qt!=="viewport-y"&&Gt),Zt=Dt.layout.get("text-allow-overlap")||Dt.layout.get("icon-allow-overlap")||Dt.layout.get("text-ignore-placement")||Dt.layout.get("icon-ignore-placement"),sr=Qt&&Zt,ir=this._inProgressLayer=this._inProgressLayer||new w0(Dt),hr=c.B(St.source,St.scope);if(ir.continuePlacement(Ht||sr?lt[hr]:st[hr],this.placement,this._showCollisionBoxes,St,mt,ht))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(d){return this.placement.commit(d),this.placement}}const pp=512/c.al/2;class Qp{constructor(d,$,st){this.tileID=d,this.bucketInstanceId=st,this.index=new c.c4($.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const lt=d.canonical.x*c.al,ht=d.canonical.y*c.al;for(let pt=0;pt<$.length;pt++){const{key:mt,crossTileID:St,tileAnchorX:It,tileAnchorY:Dt}=$.get(pt),Ht=Math.floor((lt+It)*pp),Gt=Math.floor((ht+Dt)*pp);this.index.add(Ht,Gt),this.keys.push(mt),this.crossTileIDs.push(St)}this.index.finish()}findMatches(d,$,st){const lt=this.tileID.canonical.z<$.canonical.z?1:Math.pow(2,this.tileID.canonical.z-$.canonical.z),ht=pp/Math.pow(2,$.canonical.z-this.tileID.canonical.z),pt=$.canonical.x*c.al,mt=$.canonical.y*c.al;for(let St=0;St<d.length;St++){const It=d.get(St);if(It.crossTileID)continue;const{key:Dt,tileAnchorX:Ht,tileAnchorY:Gt}=It,qt=Math.floor((pt+Ht)*ht),Qt=Math.floor((mt+Gt)*ht),Zt=this.index.range(qt-lt,Qt-lt,qt+lt,Qt+lt).sort((sr,ir)=>sr-ir);for(const sr of Zt){const ir=this.crossTileIDs[sr];if(this.keys[sr]===Dt&&!st.has(ir)){st.add(ir),It.crossTileID=ir;break}}}}}class ou{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class cv{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(d){const $=Math.round((d-this.lng)/360);if($!==0)for(const st in this.indexes){const lt=this.indexes[st],ht={};for(const pt in lt){const mt=lt[pt];mt.tileID=mt.tileID.unwrapTo(mt.tileID.wrap+$),ht[mt.tileID.key]=mt}this.indexes[st]=ht}this.lng=d}addBucket(d,$,st){if(this.indexes[d.overscaledZ]&&this.indexes[d.overscaledZ][d.key]){if(this.indexes[d.overscaledZ][d.key].bucketInstanceId===$.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(d.overscaledZ,this.indexes[d.overscaledZ][d.key])}for(let ht=0;ht<$.symbolInstances.length;ht++)$.symbolInstances.get(ht).crossTileID=0;this.usedCrossTileIDs[d.overscaledZ]||(this.usedCrossTileIDs[d.overscaledZ]=new Set);const lt=this.usedCrossTileIDs[d.overscaledZ];for(const ht in this.indexes){const pt=this.indexes[ht];if(Number(ht)>d.overscaledZ)for(const mt in pt){const St=pt[mt];St.tileID.isChildOf(d)&&St.findMatches($.symbolInstances,d,lt)}else{const mt=pt[d.scaledTo(Number(ht)).key];mt&&mt.findMatches($.symbolInstances,d,lt)}}for(let ht=0;ht<$.symbolInstances.length;ht++){const pt=$.symbolInstances.get(ht);pt.crossTileID||(pt.crossTileID=st.generate(),lt.add(pt.crossTileID))}return this.indexes[d.overscaledZ]===void 0&&(this.indexes[d.overscaledZ]={}),this.indexes[d.overscaledZ][d.key]=new Qp(d,$.symbolInstances,$.bucketInstanceId),!0}removeBucketCrossTileIDs(d,$){for(const st of $.crossTileIDs)this.usedCrossTileIDs[d].delete(st)}removeStaleBuckets(d){let $=!1;for(const st in this.indexes){const lt=this.indexes[st];for(const ht in lt)d[lt[ht].bucketInstanceId]||(this.removeBucketCrossTileIDs(st,lt[ht]),delete lt[ht],$=!0)}return $}}class Sp{constructor(){this.layerIndexes={},this.crossTileIDs=new ou,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(d,$,st,lt){let ht=this.layerIndexes[d.fqid];ht===void 0&&(ht=this.layerIndexes[d.fqid]=new cv);let pt=!1;const mt={};lt.name!=="globe"&&ht.handleWrapJump(st);for(const St of $){const It=St.getBucket(d);It&&d.fqid===It.layerIds[0]&&(It.bucketInstanceId||(It.bucketInstanceId=++this.maxBucketInstanceId),ht.addBucket(St.tileID,It,this.crossTileIDs)&&(pt=!0),mt[It.bucketInstanceId]=!0)}return ht.removeStaleBuckets(mt)&&(pt=!0),pt}pruneUnusedLayers(d){const $={};d.forEach(st=>{$[st]=!0});for(const st in this.layerIndexes)$[st]||delete this.layerIndexes[st]}}const Fp=771;class Bs{constructor(d,$,st,lt){this.blendFunction=d,this.blendColor=$.toNonPremultipliedRenderColor(null),this.mask=st,this.blendEquation=lt}}Bs.Replace=[1,0,1,0],Bs.disabled=new Bs(Bs.Replace,c.ao.transparent,[!1,!1,!1,!1]),Bs.unblended=new Bs(Bs.Replace,c.ao.transparent,[!0,!0,!0,!0]),Bs.alphaBlended=new Bs([1,Fp,1,Fp],c.ao.transparent,[!0,!0,!0,!0]),Bs.alphaBlendedNonPremultiplied=new Bs([770,Fp,770,Fp],c.ao.transparent,[!0,!0,!0,!0]),Bs.multiply=new Bs([774,0,774,0],c.ao.transparent,[!0,!0,!0,!0]),Bs.additive=new Bs([1,1,1,1],c.ao.transparent,[!0,!0,!0,!0]);class as{constructor(d,$,st){this.func=d,this.mask=$,this.range=st}}as.ReadOnly=!1,as.ReadWrite=!0,as.disabled=new as(519,as.ReadOnly,[0,1]);const bx=7680;class Ps{constructor(d,$,st,lt,ht,pt){this.test=d,this.ref=$,this.mask=st,this.fail=lt,this.depthFail=ht,this.pass=pt}}Ps.disabled=new Ps({func:519,mask:0},0,0,bx,bx,bx);const E0=1029,wx=2305;class Rs{constructor(d,$,st){this.enable=d,this.mode=$,this.frontFace=st}}function Bp(it,d){const $=c.ca(it,3);c.cc(it,d),c.cg(it,3,$)}function uv(it,d){const $=c.c7([]);return c.c8($,$,-d),c.c9($,$,-it),$}function Ex(it,d){const $=[it[0],it[1],0],st=[d[0],d[1],0];if(c.ag($)>=1e-15){const pt=c.aw([],$);c.c5(st,pt,c.bJ(st,pt)),d[0]=st[0],d[1]=st[1]}const lt=c.bI([],d,it);if(c.c6(lt)<1e-15)return null;const ht=Math.atan2(-lt[1],lt[0]);return uv(Math.atan2(Math.sqrt(it[0]*it[0]+it[1]*it[1]),-it[2]),ht)}Rs.disabled=new Rs(!1,E0,wx),Rs.backCCW=new Rs(!0,E0,wx),Rs.backCW=new Rs(!0,E0,2304),Rs.frontCW=new Rs(!0,1028,2304),Rs.frontCCW=new Rs(!0,1028,wx);class Ou{constructor(d,$){this.position=d,this.orientation=$}get position(){return this._position}set position(d){if(d){const $=d instanceof c.ae?d:new c.ae(d[0],d[1],d[2]);this._renderWorldCopies&&($.x=c.bT($.x,0,1)),this._position=$}else this._position=null}lookAtPoint(d,$,st){if(this.orientation=null,!this.position)return;const lt=this.position,ht=st||(this._elevation?this._elevation.getAtPointOrZero(c.ae.fromLngLat(d)):0),pt=c.ae.fromLngLat(d,ht),mt=[pt.x-lt.x,pt.y-lt.y,pt.z-lt.z];$||($=[0,0,1]),$[2]=Math.abs($[2]),this.orientation=Ex(mt,$)}setPitchBearing(d,$){this.orientation=uv(c.an(d),c.an(-$))}}class Tx{constructor(d,$){this._transform=c.bA([]),this.orientation=$,this.position=d}get mercatorPosition(){const d=this.position;return new c.ae(d[0],d[1],d[2])}get position(){const d=c.ca(this._transform,3);return[d[0],d[1],d[2]]}set position(d){var $;d&&c.cg(this._transform,3,[($=d)[0],$[1],$[2],1])}get orientation(){return this._orientation}set orientation(d){this._orientation=d||c.c7([]),d&&Bp(this._transform,this._orientation)}getPitchBearing(){const d=this.forward(),$=this.right();return{bearing:Math.atan2(-$[1],$[0]),pitch:Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2])}}setPitchBearing(d,$){this._orientation=uv(d,$),Bp(this._transform,this._orientation)}forward(){const d=c.ca(this._transform,2);return[-d[0],-d[1],-d[2]]}up(){const d=c.ca(this._transform,1);return[-d[0],-d[1],-d[2]]}right(){const d=c.ca(this._transform,0);return[d[0],d[1],d[2]]}getCameraToWorld(d,$){const st=new Float64Array(16);return c.bl(st,this.getWorldToCamera(d,$)),st}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(d,$,st){const lt=this.position;c.c5(lt,lt,-d);const ht=new Float64Array(16);return c.bq(ht,[st,st,st]),c.br(ht,ht,lt),ht[10]*=$,ht}getWorldToCamera(d,$){const st=new Float64Array(16),lt=new Float64Array(4),ht=this.position;return c.cb(lt,this._orientation),c.c5(ht,ht,-d),c.cc(st,lt),c.br(st,st,ht),st[1]*=-1,st[5]*=-1,st[9]*=-1,st[13]*=-1,st[8]*=$,st[9]*=$,st[10]*=$,st[11]*=$,st}getCameraToClipPerspective(d,$,st,lt){const ht=new Float64Array(16);return c.cd(ht,d,$,st,lt),ht}getCameraToClipOrthographic(d,$,st,lt,ht,pt){const mt=new Float64Array(16);return c.ce(mt,d,$,st,lt,ht,pt),mt}getDistanceToElevation(d,$=!1){const st=d===0?0:c.cf(d,$?c.a$(this.position[1]):this.position[1]),lt=this.forward();return(st-this.position[2])/lt[2]}clone(){return new Tx([...this.position],[...this.orientation])}}const gu={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Sx{constructor(d=0,$=0,st=0,lt=0){if(isNaN(d)||d<0||isNaN($)||$<0||isNaN(st)||st<0||isNaN(lt)||lt<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=d,this.bottom=$,this.left=st,this.right=lt}interpolate(d,$,st){return $.top!=null&&d.top!=null&&(this.top=c.ak(d.top,$.top,st)),$.bottom!=null&&d.bottom!=null&&(this.bottom=c.ak(d.bottom,$.bottom,st)),$.left!=null&&d.left!=null&&(this.left=c.ak(d.left,$.left,st)),$.right!=null&&d.right!=null&&(this.right=c.ak(d.right,$.right,st)),this}getCenter(d,$){const st=c.aA((this.left+d-this.right)/2,0,d),lt=c.aA((this.top+$-this.bottom)/2,0,$);return new c.P(st,lt)}equals(d){return this.top===d.top&&this.bottom===d.bottom&&this.left===d.left&&this.right===d.right}clone(){return new Sx(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Cp=15;class hv{constructor(d,$,st,lt,ht,pt,mt){this.tileSize=512,this._renderWorldCopies=ht===void 0||ht,this._minZoom=d||0,this._maxZoom=$||22,this._minPitch=st??0,this._maxPitch=lt??60,this.setProjection(pt),this.setMaxBounds(mt),this.width=0,this.height=0,this._center=new c.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Sx,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Tx,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const d=new hv(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return d._elevation=this._elevation,d._centerAltitude=this._centerAltitude,d._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,d.tileSize=this.tileSize,d.mercatorFromTransition=this.mercatorFromTransition,d.width=this.width,d.height=this.height,d.cameraElevationReference=this.cameraElevationReference,d._center=this._center,d._setZoom(this.zoom),d._seaLevelZoom=this._seaLevelZoom,d.angle=this.angle,d._fov=this._fov,d._pitch=this._pitch,d._nearZ=this._nearZ,d._farZ=this._farZ,d._averageElevation=this._averageElevation,d._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,d._unmodified=this._unmodified,d._edgeInsets=this._edgeInsets.clone(),d._camera=this._camera.clone(),d._calcMatrices(),d.freezeTileCoverage=this.freezeTileCoverage,d.frustumCorners=this.frustumCorners,d._allowWorldUnderZoom=this._allowWorldUnderZoom,d}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Cp}get elevation(){return this._elevation}set elevation(d){this._elevation!==d&&(this._elevation=d,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(d,$=!1){const st=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||st)&&this._updateCameraOnTerrain(),(d||st)&&this._constrainCamera($),this._calcMatrices()}getProjection(){return c.aH(this.projection,["name","center","parallels"])}setProjection(d){this.projectionOptions=d||{name:"mercator"};const $=this.projection?this.getProjection():void 0;this.projection=c.cm(this.projectionOptions);const st=this.getProjection(),lt=!c.by($,st);return lt&&this._calcMatrices(),this.mercatorFromTransition=!1,lt}setOrthographicProjectionAtLowPitch(d){return this._orthographicProjectionAtLowPitch!==d&&(this._orthographicProjectionAtLowPitch=d,this._calcMatrices(),!0)}setMercatorFromTransition(){const d=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=c.cm({name:"mercator"});const $=d!==this.projection.name;return $&&this._calcMatrices(),$}get minZoom(){return this._minZoom}set minZoom(d){this._minZoom!==d&&(this._minZoom=d,this.zoom=Math.max(this.zoom,d))}get maxZoom(){return this._maxZoom}set maxZoom(d){this._maxZoom!==d&&(this._maxZoom=d,this.zoom=Math.min(this.zoom,d))}get minPitch(){return this._minPitch}set minPitch(d){this._minPitch!==d&&(this._minPitch=d,this.pitch=Math.max(this.pitch,d))}get maxPitch(){return this._maxPitch}set maxPitch(d){this._maxPitch!==d&&(this._maxPitch=d,this.pitch=Math.min(this.pitch,d))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(d){d===void 0?d=!0:d===null&&(d=!1),this._renderWorldCopies=d}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const d=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(d))}get cameraWorldSize(){const d=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(d))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return c.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return c.bT(this.rotation,-180,180)}set bearing(d){this.rotation=d}get rotation(){return-this.angle/Math.PI*180}set rotation(d){const $=-d*Math.PI/180;this.angle!==$&&(this._unmodified=!1,this.angle=$,this._calcMatrices(),this.rotationMatrix=c.cn(),c.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(d){const $=c.aA(d,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==$&&(this._unmodified=!1,this._pitch=$,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(d){d=Math.max(.01,Math.min(60,d)),this._fov!==d&&(this._unmodified=!1,this._fov=c.an(d),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const d=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/d)}get averageElevation(){return this._averageElevation}set averageElevation(d){this._averageElevation=d,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(d){const $=Math.min(Math.max(d,this.minZoom),this.maxZoom);this._zoom!==$&&(this._unmodified=!1,this._setZoom($),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(d){this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(d){this._tileCoverLift!==d&&(this._tileCoverLift=d)}_updateCameraOnTerrain(){const d=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,$=this.elevation&&d===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||d===Number.NEGATIVE_INFINITY&&(!$||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const st=this._elevation;$||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&st.exaggeration()&&this._centerAltitudeValidForExaggeration!==st.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*st.exaggeration(),this._centerAltitudeValidForExaggeration=st.exaggeration()):(this._centerAltitude=d||0,this._centerAltitudeValidForExaggeration=st.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const d=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(d)}sampleAverageElevation(){if(!this._elevation)return 0;const d=this._elevation,$=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],st=this.horizonLineFromTop();let lt=0,ht=0;for(let pt=0;pt<$.length;pt++){const mt=new c.P($[pt][0]*this.width,st+$[pt][1]*(this.height-st)),St=d.pointCoordinate(mt);if(!St)continue;const It=1/Math.hypot(St[0]-this._camera.position[0],St[1]-this._camera.position[1]);lt+=St[3]*It,ht+=It}return ht===0?NaN:lt/ht}get center(){return this._center}set center(d){d.lat===this._center.lat&&d.lng===this._center.lng||(this._unmodified=!1,this._center=d,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const d=this._seaLevelZoom,$=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),st=this.pixelsPerMeter/this.worldSize*$,lt=this._mercatorZfromZoom(d),ht=this._mercatorZfromZoom(this._maxZoom),pt=Math.max(lt-st,ht);this._setZoom(this._zoomFromMercatorZ(pt))}get padding(){return this._edgeInsets.toJSON()}set padding(d){this._edgeInsets.equals(d)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,d,1),this._calcMatrices())}equals(d){const $=this.elevation,st=d.elevation,lt=$!=null!=(st!=null)||$&&st&&$.exaggeration()!==st.exaggeration();return this.width===d.width&&this.height===d.height&&this.center.lng===d.center.lng&&this.center.lat===d.center.lat&&this.zoom===d.zoom&&this.bearing===d.bearing&&this.pitch===d.pitch&&this.fov===d.fov&&this.projection.name===d.projection.name&&this._edgeInsets.equals(d.padding)&&!lt}computeZoomRelativeTo(d){const $=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,d.toAltitude()));let st;st=d.z<this._camera.position[2]?[$.x,$.y,$.z]:[d.x,d.y,d.z];const lt=c.ag(c.av([],this._camera.position,st));return c.aA(this._zoomFromMercatorZ(lt),this._minZoom,this._maxZoom)}setFreeCameraOptions(d){if(!this.height||!d.position&&!d.orientation)return;this._updateCameraState();let $=!1;if(d.orientation&&!c.cp(d.orientation,this._camera.orientation)&&($=this._setCameraOrientation(d.orientation)),d.position){const st=[d.position.x,d.position.y,d.position.z];c.cq(st,this._camera.position)||(this._setCameraPosition(st),$=!0)}$&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const d=this._camera.position,$=new Ou;return $.position=new c.ae(d[0],d[1],d[2]),$.orientation=this._camera.orientation,$._elevation=this.elevation,$._renderWorldCopies=this.renderWorldCopies,$}_setCameraOrientation(d){if(!c.cr(d))return!1;c.cs(d,d);const $=c.ct([],[0,0,-1],d),st=c.ct([],[0,-1,0],d);if(st[2]<0)return!1;const lt=Ex($,st);return!!lt&&(this._camera.orientation=lt,!0)}_setCameraPosition(d){const $=this.zoomScale(this.minZoom)*this.tileSize,st=this.zoomScale(this.maxZoom)*this.tileSize,lt=this.cameraToCenterDistance;d[2]=c.aA(d[2],lt/st,lt/$),this._camera.position=d}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(d){return this._edgeInsets.equals(d)}interpolatePadding(d,$,st){this._unmodified=!1,this._edgeInsets.interpolate(d,$,st),this._constrain(),this._calcMatrices()}coveringZoomLevel(d){const $=(d.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/d.tileSize));return Math.max(0,$)}getVisibleUnwrappedCoordinates(d){const $=[new c.cu(0,d)];if(this.renderWorldCopies){const st=this.pointCoordinate(new c.P(0,0)),lt=this.pointCoordinate(new c.P(this.width,0)),ht=this.pointCoordinate(new c.P(this.width,this.height)),pt=this.pointCoordinate(new c.P(0,this.height)),mt=Math.floor(Math.min(st.x,lt.x,ht.x,pt.x)),St=Math.floor(Math.max(st.x,lt.x,ht.x,pt.x)),It=1;for(let Dt=mt-It;Dt<=St+It;Dt++)Dt!==0&&$.push(new c.cu(Dt,d))}return $}isLODDisabled(d){return(!d||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(d,$,st,lt){let ht=[];const pt=st!=null,mt=!pt;if(mt&&this.zoom<$||pt&&st[0]===0&&st[1]===0)return ht;const St=new Set,It=(Ht,Gt,qt,Qt,Zt)=>{const sr=c.cY(Gt,Ht,qt,Qt,Zt);St.has(sr)||(ht.push(new c.aQ(Ht,Gt,qt,Qt,Zt)),St.add(sr))};for(let Ht=0;Ht<d.length;Ht++){const Gt=d[Ht];if(mt&&Gt.canonical.z!==$||pt&&lt!==void 0&&lt>Gt.canonical.z)continue;const qt=Gt.canonical,Qt=Gt.overscaledZ,Zt=Gt.wrap,sr=1<<qt.z,ir=qt.x+1<sr,hr=qt.x>0,gr=qt.y+1<sr,dr=qt.y>0,Ir=Gt.wrap-(hr?0:1),Tr=Gt.wrap+(ir?0:1),Rr=hr?qt.x-1:sr-1,Er=ir?qt.x+1:0;if(pt)st[0]<0?(It(Qt,Tr,qt.z,Er,qt.y),st[1]<0&&gr&&(It(Qt,Zt,qt.z,qt.x,qt.y+1),It(Qt,Tr,qt.z,Er,qt.y+1)),st[1]>0&&dr&&(It(Qt,Zt,qt.z,qt.x,qt.y-1),It(Qt,Tr,qt.z,Er,qt.y-1))):st[0]>0?(It(Qt,Ir,qt.z,Rr,qt.y),st[1]<0&&gr&&(It(Qt,Zt,qt.z,qt.x,qt.y+1),It(Qt,Ir,qt.z,Rr,qt.y+1)),st[1]>0&&dr&&(It(Qt,Zt,qt.z,qt.x,qt.y-1),It(Qt,Ir,qt.z,Rr,qt.y-1))):st[1]<0&&gr?It(Qt,Zt,qt.z,qt.x,qt.y+1):dr&&It(Qt,Zt,qt.z,qt.x,qt.y-1);else{const vr=Gt.visibleQuadrants;1&vr&&(It(Qt,Ir,qt.z,Rr,qt.y),dr&&(It(Qt,Zt,qt.z,qt.x,qt.y-1),It(Qt,Ir,qt.z,Rr,qt.y-1))),2&vr&&(It(Qt,Tr,qt.z,Er,qt.y),dr&&(It(Qt,Zt,qt.z,qt.x,qt.y-1),It(Qt,Tr,qt.z,Er,qt.y-1))),4&vr&&(It(Qt,Ir,qt.z,Rr,qt.y),gr&&(It(Qt,Zt,qt.z,qt.x,qt.y+1),It(Qt,Ir,qt.z,Rr,qt.y+1))),8&vr&&(It(Qt,Tr,qt.z,Er,qt.y),gr&&(It(Qt,Zt,qt.z,qt.x,qt.y+1),It(Qt,Tr,qt.z,Er,qt.y+1)))}}const Dt=[];for(const Ht of ht)ht.some(Gt=>Ht.isChildOf(Gt))||Dt.push(Ht);if(ht=Dt.filter(Ht=>!d.some(Gt=>!!(Ht.overscaledZ<$&&Gt.isChildOf(Ht))||Ht.equals(Gt)||Ht.isChildOf(Gt))),mt){const Ht=1<<$,Gt=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),qt=[Ht*Gt.x,Ht*Gt.y],Qt=4,Zt=Qt*Qt;ht=ht.filter(sr=>{const ir=sr.canonical.x+.5-qt[0],hr=sr.canonical.y+.5-qt[1];return ir*ir+hr*hr<Zt})}return ht}extendTileCoverToNearPlane(d,$,st){const lt=[],ht=new Set;for(const hr of d)ht.add(hr.key);const pt=(hr,gr,dr,Ir,Tr)=>{const Rr=c.cY(gr,hr,dr,Ir,Tr);ht.has(Rr)||(lt.push(new c.aQ(hr,gr,dr,Ir,Tr)),ht.add(Rr))},mt=d.reduce((hr,gr)=>Math.max(hr,gr.overscaledZ),st),St=1<<st,It=[new c.P(0,0),new c.P(c.al,0),new c.P(c.al,c.al),new c.P(0,c.al)],Dt=new c.P(0,0),Ht=new c.P(0,0),Gt=(hr,gr)=>{const dr=Math.floor(hr[0]),Ir=Math.floor(hr[1]),Tr=(hr[0]-dr)*c.al,Rr=(hr[1]-Ir)*c.al,Er=Math.floor(gr[0]),vr=Math.floor(gr[1]),kr=(gr[0]-Er)*c.al,Ur=(gr[1]-vr)*c.al;for(let zr=-1;zr<=1;zr++){const Jr=dr+zr;if(!(Jr<0||Jr>=St)){Dt.x=Tr-zr*c.al,Ht.x=kr-(Jr-Er)*c.al;for(let rn=-1;rn<=1;rn++){const pn=Ir+rn;Dt.y=Rr-rn*c.al,Ht.y=Ur-(pn-vr)*c.al,c.cZ(Dt,Ht,It)&&pt(mt,0,st,Jr,pn)}}}},qt=$.points,Qt=qt[c.cv],Zt=qt[c.cw],sr=this._projectToGround(Qt,qt[c.cx]),ir=this._projectToGround(Zt,qt[c.cy]);return Gt(Qt,sr),Gt(Zt,ir),lt}_projectToGround(d,$){return c.cz(c.cA(),d,$,d[2]/(d[2]-$[2]))}coveringTiles(d){let $=this.coveringZoomLevel(d);const st=$,lt=this.elevation&&this.elevation.exaggeration(),ht=lt&&!d.isTerrainDEM,pt=this.projection.name==="mercator";if(d.minzoom!==void 0&&$<d.minzoom)return[];d.maxzoom!==void 0&&$>d.maxzoom&&($=d.maxzoom);const mt=this.locationCoordinate(this.center),St=this.center.lat,It=1<<$,Dt=[It*mt.x,It*mt.y,0],Ht=this.projection.name==="globe",Gt=!Ht,qt=c.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,$,Gt),Qt=Ht?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Zt=It*c.cf(1,this.center.lat),sr=this._camera.position[2]/c.cf(1,this.center.lat),ir=[It*Qt.x,It*Qt.y,sr*(Gt?1:Zt)],hr=Ht||lt,gr=this.cameraToCenterDistance/d.tileSize*(d.roundZoom?1:.502),dr=this.isLODDisabled(!0)?$:0;let Ir;if(this._elevation&&d.isTerrainDEM)Ir=1e4*this._elevation.exaggeration();else if(this._elevation){const jr=this._elevation.getMinMaxForVisibleTiles();Ir=jr?jr.max:this._centerAltitude}else Ir=this._centerAltitude;const Tr=d.isTerrainDEM?-Ir:this._elevation?this._elevation.getMinElevationBelowMSL():0,Rr=this.projection.isReprojectedInTileSpace?c.cC(this):1,Er=jr=>{const Xr=new c.ae(jr.x+25e-6,jr.y,jr.z),bn=new c.ae(jr.x,jr.y+25e-6,jr.z),Fn=jr.toLngLat(),Hn=Xr.toLngLat(),Ln=bn.toLngLat(),In=this.locationCoordinate(Fn),ns=this.locationCoordinate(Hn),_i=this.locationCoordinate(Ln),$n=Math.hypot(ns.x-In.x,ns.y-In.y),qn=Math.hypot(_i.x-In.x,_i.y-In.y);return Math.sqrt($n*qn)*Rr/25e-6},vr=jr=>{const an=Ir,Xr=Tr;return{aabb:c.cF(this,It,0,0,0,jr,Xr,an,this.projection),zoom:0,x:0,y:0,minZ:Xr,maxZ:an,wrap:jr,fullyVisible:!1}},kr=[];let Ur=[];const zr=$,Jr=d.reparseOverscaled?st:$,rn=(sr-this._centerAltitude)*Zt,pn=jr=>{if(!this._elevation||!jr.tileID||!pt)return;const an=this._elevation.getMinMaxForTile(jr.tileID),Xr=jr.aabb;an?(Xr.min[2]=an.min,Xr.max[2]=an.max,Xr.center[2]=(Xr.min[2]+Xr.max[2])/2):(jr.shouldSplit=Kr(jr),jr.shouldSplit||(Xr.min[2]=Xr.max[2]=Xr.center[2]=this._centerAltitude))},Pn=(jr,an)=>{if(.707*an<jr)return 1;const Xr=an/jr;return Xr/(1.4144271570014144+(Math.pow(1.1,Xr-1.4144271570014144+1)-1)/(1.1-1)-1)},Kr=jr=>{if(jr.zoom<dr)return!0;if(jr.zoom===zr)return!1;if(jr.shouldSplit!=null)return jr.shouldSplit;const an=jr.aabb.distanceX(ir),Xr=jr.aabb.distanceY(ir);let bn=rn,Fn=1;if(Ht){bn=jr.aabb.distanceZ(ir);const qn=Math.pow(2,jr.zoom),ms=c.a$((jr.y+1)/qn),Ns=c.a$(jr.y/qn),to=Math.min(Math.max(St,ms),Ns),_o=c.d1(to)/c.d1(St);if(Fn=to===St?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,_o/this._mercatorScaleRatio),this.zoom<=c.c_&&jr.zoom===zr-1&&_o>=.9)return!0}else if(ht&&(bn=jr.aabb.distanceZ(ir)*Zt),this.projection.isReprojectedInTileSpace&&st<=5){const qn=Math.pow(2,jr.zoom),ms=Er(new c.ae((jr.x+.5)/qn,(jr.y+.5)/qn));Fn=ms>.85?1:ms}if(!pt&&!Ht){const qn=Math.sqrt(an*an+Xr*Xr+bn*bn);let ms=(1<<zr-jr.zoom)*gr*Fn;return ms*=Pn(Math.max(bn,rn),qn),qn<ms}let Hn=Number.MAX_VALUE,Ln=0;const In=jr.aabb.getCorners(),ns=[];for(const qn of In){c.av(ns,qn,ir),Ht||(ht?ns[2]*=Zt:ns[2]=rn);const ms=c.bJ(ns,this._camera.forward());ms<Hn&&(Hn=ms,Ln=Math.abs(ns[2]))}let _i=(1<<zr-jr.zoom)*gr*Fn;if(_i*=Pn(Math.max(Ln,rn),Hn),Hn<_i)return!0;const $n=jr.aabb.closestPoint(Dt);return $n[0]===Dt[0]&&$n[1]===Dt[1]};if(this.renderWorldCopies)for(let jr=1;jr<=3;jr++)kr.push(vr(-jr)),kr.push(vr(jr));for(kr.push(vr(0));kr.length>0;){const jr=kr.pop(),an=jr.x,Xr=jr.y;let bn=jr.fullyVisible;const Fn=()=>this.projection.name==="globe"&&(jr.y===0||jr.y===(1<<jr.zoom)-1);if(!bn){let Hn=hr?jr.aabb.intersects(qt):jr.aabb.intersectsFlat(qt);if(Hn===0&&Fn()){const Ln=new c.cD(jr.zoom,an,Xr);Hn=c.cE(this,It,Ln,!0).intersects(qt)}if(Hn===0)continue;bn=Hn===2}if(jr.zoom!==zr&&Kr(jr))for(let Hn=0;Hn<4;Hn++){const Ln=(an<<1)+Hn%2,In=(Xr<<1)+(Hn>>1),ns={aabb:pt?jr.aabb.quadrant(Hn):c.cF(this,It,jr.zoom+1,Ln,In,jr.wrap,jr.minZ,jr.maxZ,this.projection),zoom:jr.zoom+1,x:Ln,y:In,wrap:jr.wrap,fullyVisible:bn,tileID:void 0,shouldSplit:void 0,minZ:jr.minZ,maxZ:jr.maxZ};ht&&!Ht&&(ns.tileID=new c.aQ(jr.zoom+1===zr?Jr:jr.zoom+1,jr.wrap,jr.zoom+1,Ln,In),pn(ns)),kr.push(ns)}else{const Hn=jr.zoom===zr?Jr:jr.zoom;if(d.minzoom&&d.minzoom>Hn)continue;let Ln=0;if(!bn){let $n=hr?jr.aabb.intersectsPrecise(qt):jr.aabb.intersectsPreciseFlat(qt);if($n===0&&Fn()){const qn=new c.cD(jr.zoom,an,Xr);$n=c.cE(this,It,qn,!0).intersectsPrecise(qt)}if($n===0)continue;if(d.calculateQuadrantVisibility)if(qt.containsPoint(jr.aabb.center))Ln=15;else for(let qn=0;qn<4;qn++)jr.aabb.quadrant(qn).intersects(qt)!==0&&(Ln|=1<<qn)}const In=Dt[0]-(.5+an+(jr.wrap<<jr.zoom))*(1<<$-jr.zoom),ns=Dt[1]-.5-Xr,_i=jr.tileID?jr.tileID:new c.aQ(Hn,jr.wrap,jr.zoom,an,Xr);d.calculateQuadrantVisibility&&(_i.visibleQuadrants=Ln),Ur.push({tileID:_i,distanceSq:In*In+ns*ns})}}if(this.fogCullDistSq){const jr=this.fogCullDistSq,an=this.horizonLineFromTop();Ur=Ur.filter(Xr=>{const bn=[0,0,0,1],Fn=[c.al,c.al,0,1],Hn=this.calculateFogTileMatrix(Xr.tileID.toUnwrapped());c.aC(bn,bn,Hn),c.aC(Fn,Fn,Hn);const Ln=c.cG([],bn,Fn),In=c.cH([],bn,Fn),ns=c.c$(Ln,In);if(ns===0)return!0;let _i=!1;const $n=this._elevation;if($n&&ns>jr&&an!==0){const qn=this.calculateProjMatrix(Xr.tileID.toUnwrapped());let ms;d.isTerrainDEM||(ms=$n.getMinMaxForTile(Xr.tileID)),ms||(ms={min:Tr,max:Ir});const Ns=c.cI(this.rotation),to=[Ns[0]*c.al,Ns[1]*c.al,ms.max];c.af(to,to,qn),_i=(1-to[1])*this.height*.5<an}return ns<jr||_i})}return Ur.sort((jr,an)=>jr.distanceSq-an.distanceSq).map(jr=>jr.tileID)}resize(d,$){this.width=d,this.height=$,this.pixelsToGLUnits=[2/d,-2/$],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(d){return Math.pow(2,d)}scaleZoom(d){return Math.log2(d)}project(d){const $=c.aA(d.lat,-c.cJ,c.cJ),st=this.projection.project(d.lng,$);return new c.P(st.x*this.worldSize,st.y*this.worldSize)}unproject(d){return this.projection.unproject(d.x/this.worldSize,d.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/c.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(d,$){let st,lt;const ht=this.centerPoint;if(this.projection.name==="globe"){const mt=this.worldSize;st=($.x-ht.x)/mt,lt=($.y-ht.y)/mt}else{const mt=this.pointCoordinate($),St=this.pointCoordinate(ht);st=mt.x-St.x,lt=mt.y-St.y}const pt=this.locationCoordinate(d);this.setLocation(new c.ae(pt.x-st,pt.y-lt))}setLocation(d){this.center=this.coordinateLocation(d),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(d,$){return this.projection.locationPoint(this,d,$)}locationPoint3D(d,$){return this.projection.locationPoint(this,d,$,!0)}pointLocation(d){return this.coordinateLocation(this.pointCoordinate(d))}pointLocation3D(d,$){return this.coordinateLocation(this.pointCoordinate3D(d,$))}locationCoordinate(d,$){const st=$?c.cf($,d.lat):void 0,lt=this.projection.project(d.lng,d.lat);return new c.ae(lt.x,lt.y,st)}coordinateLocation(d){return this.projection.unproject(d.x,d.y)}pointRayIntersection(d,$){const st=$??this._centerAltitude,lt=[d.x,d.y,0,1],ht=[d.x,d.y,1,1];c.aC(lt,lt,this.pixelMatrixInverse),c.aC(ht,ht,this.pixelMatrixInverse);const pt=ht[3];c.cK(lt,lt,1/lt[3]),c.cK(ht,ht,1/pt);const mt=lt[2],St=ht[2];return{p0:lt,p1:ht,t:mt===St?0:(st-mt)/(St-mt)}}screenPointToMercatorRay(d){const $=[d.x,d.y,0,1],st=[d.x,d.y,1,1];return c.aC($,$,this.pixelMatrixInverse),c.aC(st,st,this.pixelMatrixInverse),c.cK($,$,1/$[3]),c.cK(st,st,1/st[3]),$[2]=c.cf($[2],this._center.lat)*this.worldSize,st[2]=c.cf(st[2],this._center.lat)*this.worldSize,c.cK($,$,1/this.worldSize),c.cK(st,st,1/this.worldSize),new c.ax([$[0],$[1],$[2]],c.aw([],c.av([],st,$)))}rayIntersectionCoordinate(d){const{p0:$,p1:st,t:lt}=d,ht=c.cf($[2],this._center.lat),pt=c.cf(st[2],this._center.lat);return new c.ae(c.ak($[0],st[0],lt)/this.worldSize,c.ak($[1],st[1],lt)/this.worldSize,c.ak(ht,pt,lt))}pointCoordinate(d,$=this._centerAltitude){return this.projection.pointCoordinate(this,d.x,d.y,$)}pointCoordinate3D(d,$){if(!this.elevation)return this.pointCoordinate(d,$);let st=this.projection.pointCoordinate3D(this,d.x,d.y);if(st)return new c.ae(st[0],st[1],st[2]);let lt=0,ht=this.horizonLineFromTop();if(d.y>ht)return this.pointCoordinate(d,$);const pt=.02*ht,mt=d.clone();for(let St=0;St<10&&ht-lt>pt;St++){mt.y=c.ak(lt,ht,.66);const It=this.projection.pointCoordinate3D(this,mt.x,mt.y);It?(ht=mt.y,st=It):lt=mt.y}return st?new c.ae(st[0],st[1],st[2]):this.pointCoordinate(d)}isPointAboveHorizon(d){return this.projection.isPointAboveHorizon(this,d)}isPointOnSurface(d){if(d.y<0||d.y>this.height||d.x<0||d.x>this.width)return!1;if(this.elevation||this.zoom>=c.cL)return!this.isPointAboveHorizon(d);const $=this.pointCoordinate(d);return $.y>=0&&$.y<=1}_coordinatePoint(d,$){const st=$&&this.elevation?this.elevation.getAtPointOrZero(d,this._centerAltitude):this._centerAltitude,lt=[d.x*this.worldSize,d.y*this.worldSize,st+d.toAltitude(),1];return c.aC(lt,lt,this.pixelMatrix),lt[3]>0?new c.P(lt[0]/lt[3],lt[1]/lt[3]):new c.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:d,left:$}=this._edgeInsets,st=this.height-this._edgeInsets.bottom,lt=this.width-this._edgeInsets.right,ht=this.pointLocation3D(new c.P($,d)),pt=this.pointLocation3D(new c.P(lt,d)),mt=this.pointLocation3D(new c.P(lt,st)),St=this.pointLocation3D(new c.P($,st));let It=Math.min(ht.lng,pt.lng,mt.lng,St.lng),Dt=Math.max(ht.lng,pt.lng,mt.lng,St.lng),Ht=Math.min(ht.lat,pt.lat,mt.lat,St.lat),Gt=Math.max(ht.lat,pt.lat,mt.lat,St.lat);const qt=Math.pow(2,-this.zoom)/16*270,Qt=this.projection.name==="globe"?1:4,Zt=(sr,ir,hr,gr,dr)=>{const Ir=(sr+hr)/2,Tr=(ir+gr)/2,Rr=new c.P(Ir,Tr),{lng:Er,lat:vr}=this.pointLocation3D(Rr),kr=Math.max(0,It-Er,Ht-vr,Er-Dt,vr-Gt);It=Math.min(It,Er),Dt=Math.max(Dt,Er),Ht=Math.min(Ht,vr),Gt=Math.max(Gt,vr),(dr<Qt||kr>qt)&&(Zt(sr,ir,Ir,Tr,dr+1),Zt(Ir,Tr,hr,gr,dr+1))};if(Zt($,d,lt,d,1),Zt(lt,d,lt,st,1),Zt(lt,st,$,st,1),Zt($,st,$,d,1),this.projection.name==="globe"){const[sr,ir]=c.cM(this);sr?(Gt=90,Dt=180,It=-180):ir&&(Ht=-90,Dt=180,It=-180)}return new c.aI(new c.aT(It,Ht),new c.aT(Dt,Gt))}_getBoundsRectangular(d,$){const{top:st,left:lt}=this._edgeInsets,ht=this.height-this._edgeInsets.bottom,pt=this.width-this._edgeInsets.right,mt=new c.P(lt,st),St=new c.P(pt,st),It=new c.P(pt,ht),Dt=new c.P(lt,ht);let Ht=this.pointCoordinate(mt,d),Gt=this.pointCoordinate(St,d);const qt=this.pointCoordinate(It,$),Qt=this.pointCoordinate(Dt,$),Zt=(sr,ir)=>(ir.y-sr.y)/(ir.x-sr.x);return Ht.y>1&&Gt.y>=0?Ht=new c.ae((1-Qt.y)/Zt(Qt,Ht)+Qt.x,1):Ht.y<0&&Gt.y<=1&&(Ht=new c.ae(-Qt.y/Zt(Qt,Ht)+Qt.x,0)),Gt.y>1&&Ht.y>=0?Gt=new c.ae((1-qt.y)/Zt(qt,Gt)+qt.x,1):Gt.y<0&&Ht.y<=1&&(Gt=new c.ae(-qt.y/Zt(qt,Gt)+qt.x,0)),new c.aI().extend(this.coordinateLocation(Ht)).extend(this.coordinateLocation(Gt)).extend(this.coordinateLocation(Qt)).extend(this.coordinateLocation(qt))}_getBoundsRectangularTerrain(){const d=this.elevation;if(!d.visibleDemTiles.length||d.isUsingMockSource())return this._getBoundsRectangular(0,0);const $=d.visibleDemTiles.reduce((st,lt)=>{if(lt.dem){const ht=lt.dem.tree;st.min=Math.min(st.min,ht.minimums[0]),st.max=Math.max(st.max,ht.maximums[0])}return st},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular($.min*d.exaggeration(),$.max*d.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(d=!0){const $=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,st=this.height/2-$*(1-this._horizonShift);return d?Math.max(0,st):st}getMaxBounds(){return this.maxBounds}setMaxBounds(d){this.maxBounds=d,this.minLat=-c.cJ,this.maxLat=c.cJ,this.minLng=-180,this.maxLng=180,d&&(this.minLat=d.getSouth(),this.maxLat=d.getNorth(),this.minLng=d.getWest(),this.maxLng=d.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=c.aF(this.minLng)*this.tileSize,this.worldMaxX=c.aF(this.maxLng)*this.tileSize,this.worldMinY=c.aJ(this.maxLat)*this.tileSize,this.worldMaxY=c.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(d,$){return this.projection.createTileMatrix(this,$,d)}calculateDistanceTileData(d){const $=d.key,st=this._distanceTileDataCache;if(st[$])return st[$];const lt=d.canonical,ht=1/this.height,pt=this.cameraWorldSize,mt=pt/this.zoomScale(lt.z),St=(lt.x+Math.pow(2,lt.z)*d.wrap)*mt,It=lt.y*mt,Dt=this.point;Dt.x*=pt/this.worldSize,Dt.y*=pt/this.worldSize;const Ht=this.angle,Gt=Math.sin(-Ht),qt=-Math.cos(-Ht);return st[$]={bearing:[Gt,qt],center:[(Dt.x-St)*ht,(Dt.y-It)*ht],scale:mt/c.al*ht},st[$]}calculateFogTileMatrix(d){const $=d.key,st=this._fogTileMatrixCache;if(st[$])return st[$];const lt=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,d);return c.aB(lt,this.worldToFogMatrix,lt),st[$]=new Float32Array(lt),st[$]}calculateProjMatrix(d,$=!1,st=!1){const lt=d.key;let ht;if(ht=st?this._expandedProjMatrixCache:$?this._alignedProjMatrixCache:this._projMatrixCache,ht[lt])return ht[lt];const pt=this.calculatePosMatrix(d,this.worldSize);let mt;return mt=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:st?this.expandedFarZProjMatrix:$?this.alignedProjMatrix:this.projMatrix,c.aB(pt,mt,pt),ht[lt]=new Float32Array(pt),ht[lt]}calculatePixelsToTileUnitsMatrix(d){const $=d.tileID.key,st=this._pixelsToTileUnitsCache;if(st[$])return st[$];const lt=c.cN(d,this);return st[$]=lt,st[$]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const d=1/this.worldSize,$=c.bq([],[d,d,d]);return c.aB($,$,this.globeMatrix),$}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const d=this._elevation;this._updateCameraState();const $=c.cf(1,this._center.lat)*this.worldSize,st=this._computeCameraPosition($),lt=this._camera.forward(),ht=c.cf(1,this._center.lat);st[2]/=ht,lt[2]/=ht,c.aw(lt,lt);const pt=d.raycast(st,lt,d.exaggeration());if(pt){const mt=c.bH([],st,lt,pt),St=new c.ae(mt[0],mt[1],c.cf(mt[2],c.a$(mt[1]))),It=(St.z+c.ag([St.x-st[0],St.y-st[1],St.z-st[2]*ht]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(It),this._centerAltitude=St.toAltitude(),this._center=this.coordinateLocation(St),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(d=!1){if(!this._elevation)return;const $=this._elevation,st=c.cf(1,this._center.lat)*this.worldSize,lt=this._computeCameraPosition(st),ht=$.getAtPointOrZero(new c.ae(...lt)),pt=this.pixelsPerMeter/this.worldSize*ht,mt=this._minimumHeightOverTerrain(),St=lt[2]-pt;if(St<=mt)if(St<0||d){const It=this.locationCoordinate(this._center,this._centerAltitude),Dt=[lt[0],lt[1],It.z-lt[2]],Ht=c.ag(Dt);Dt[2]-=(mt-St)/this._pixelsPerMercatorPixel;const Gt=c.ag(Dt);if(Gt===0)return;c.c5(Dt,Dt,Ht/Gt*this._pixelsPerMercatorPixel),this._camera.position=[lt[0],lt[1],It.z*this._pixelsPerMercatorPixel-Dt[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const d=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||d){const Gt=this.center;return Gt.lat=c.aA(Gt.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!d)&&(Gt.lng=c.aA(Gt.lng,this.minLng,this.maxLng)),this.center=Gt,void(this._constraining=!1)}const $=this._unmodified,{x:st,y:lt}=this.point;let ht=0,pt=st,mt=lt;const St=this.width/2,It=this.height/2,Dt=this.worldMinY*this.scale,Ht=this.worldMaxY*this.scale;if(lt-It<Dt&&(mt=Dt+It),lt+It>Ht&&(mt=Ht-It),Ht-Dt<this.height&&(ht=Math.max(ht,this.height/(Ht-Dt)),mt=(Ht+Dt)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Gt=this.worldMinX*this.scale,qt=this.worldMaxX*this.scale,Qt=this.worldSize/2-(Gt+qt)/2;pt=(st+Qt+this.worldSize)%this.worldSize-Qt,pt-St<Gt&&(pt=Gt+St),pt+St>qt&&(pt=qt-St),qt-Gt<this.width&&(ht=Math.max(ht,this.width/(qt-Gt)),pt=(qt+Gt)/2)}pt===st&&mt===lt||this._allowWorldUnderZoom||(this.center=this.unproject(new c.P(pt,mt))),ht&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(ht)),this._constrainCamera(),this._unmodified=$,this._constraining=!1}_minZoomForBounds(){let d=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(d=Math.max(d,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),d}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const d=this.centerOffset,$=this.projection.name==="globe",st=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=c.cf(1,this.center.lat)/c.cf(1,c.d2));const lt=c.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,lt),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const ht=this.projection.zAxisUnit==="meters"?st:1,pt=this._camera.getWorldToCamera(this.worldSize,ht);let mt;const St=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(St[8]=2*-d.x/this.width,St[9]=2*d.y/this.height,this.isOrthographic){let vr=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),kr=vr*this.aspect,Ur=-kr,zr=-vr;kr-=d.x,Ur-=d.x,vr+=d.y,zr+=d.y,mt=this._camera.getCameraToClipOrthographic(Ur,kr,zr,vr,this._nearZ,this._farZ),((Jr,rn,pn,Pn)=>{for(let Kr=0;Kr<16;Kr++)Jr[Kr]=c.ak(rn[Kr],pn[Kr],Pn)})(mt,mt,St,c.d0(this.pitch>=Cp?1:this.pitch/Cp))}else mt=St;const It=c.cP([],St,pt);let Dt=c.cP([],mt,pt);if(this.projection.isReprojectedInTileSpace){const vr=this.locationCoordinate(this.center),kr=c.bA([]);c.br(kr,kr,[vr.x*this.worldSize,vr.y*this.worldSize,0]),c.aB(kr,kr,c.cQ(this)),c.br(kr,kr,[-vr.x*this.worldSize,-vr.y*this.worldSize,0]),c.aB(Dt,Dt,kr),c.aB(It,It,kr),this.inverseAdjustmentMatrix=c.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=c.cS([],Dt,[this.worldSize,this.worldSize,this.worldSize/ht,1]),this.projMatrix=Dt,this.invProjMatrix=c.bl(new Float64Array(16),this.projMatrix),$){const vr=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);vr[8]=2*-d.x/this.width,vr[9]=2*d.y/this.height,this.expandedFarZProjMatrix=c.cP([],vr,pt)}else this.expandedFarZProjMatrix=this.projMatrix;const Ht=c.bl([],mt);this.frustumCorners=c.cT.fromInvProjectionMatrix(Ht,this.horizonLineFromTop(),this.height),this.cameraFrustum=c.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!$);const Gt=new Float32Array(16);c.bA(Gt),c.cS(Gt,Gt,[1,-1,1]),c.cU(Gt,Gt,this._pitch),c.bB(Gt,Gt,this.angle);const qt=c.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=c.bz(qt);const Qt=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;qt[8]=2*-d.x/this.width,qt[9]=2*(d.y+Qt)/this.height,this.skyboxMatrix=c.aB(Gt,qt,Gt);const Zt=this.point,sr=Zt.x,ir=Zt.y,hr=this.width%2/2,gr=this.height%2/2,dr=Math.cos(this.angle),Ir=Math.sin(this.angle),Tr=sr-Math.round(sr)+dr*hr+Ir*gr,Rr=ir-Math.round(ir)+dr*gr+Ir*hr,Er=new Float64Array(Dt);if(c.br(Er,Er,[Tr>.5?Tr-1:Tr,Rr>.5?Rr-1:Rr,0]),this.alignedProjMatrix=Er,Dt=c.bC(),c.cS(Dt,Dt,[this.width/2,-this.height/2,1]),c.br(Dt,Dt,[1,-1,0]),this.labelPlaneMatrix=Dt,Dt=c.bC(),c.cS(Dt,Dt,[1,-1,1]),c.br(Dt,Dt,[-1,-1,0]),c.cS(Dt,Dt,[2/this.width,2/this.height,1]),this.glCoordMatrix=Dt,this.pixelMatrix=c.aB(new Float64Array(16),this.labelPlaneMatrix,It),this._calcFogMatrices(),this._distanceTileDataCache={},Dt=c.bl(new Float64Array(16),this.pixelMatrix),!Dt)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=Dt,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=c.cV(this);const vr=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=c.af(vr,vr,pt),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=Dt;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const d=this.cameraWorldSizeForFog,$=this.cameraPixelsPerMeter,st=this._camera.position,lt=1/this.height/this._pixelsPerMercatorPixel,ht=[d,d,$];c.c5(ht,ht,lt),c.c5(st,st,-1),c.cW(st,st,ht);const pt=c.bC();c.br(pt,pt,st),c.cS(pt,pt,ht),this.mercatorFogMatrix=pt,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(d,$,lt)}_computeCameraPosition(d){const $=(d=d||this.pixelsPerMeter)/this.pixelsPerMeter,st=this._camera.forward(),lt=this.point,ht=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*$-d/this.worldSize*this._centerAltitude;return[lt.x/this.worldSize-st[0]*ht,lt.y/this.worldSize-st[1]*ht,d/this.worldSize*this._centerAltitude-st[2]*ht]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(d){const $=this._maxCameraBoundsDistance()*Math.cos(this._pitch),st=this._camera.position[2],lt=d[2];let ht=1;this.projection.wrap&&(this.center=this.center.wrap()),lt>0&&(ht=Math.min(($-st)/lt,1)),this._camera.position=c.bH([],this._camera.position,d,ht),this._updateStateFromCamera()}_updateStateFromCamera(){const d=this._camera.position,$=this._camera.forward(),{pitch:st,bearing:lt}=this._camera.getPitchBearing(),ht=c.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,pt=this._mercatorZfromZoom(this._maxZoom)*Math.cos(c.an(this._maxPitch)),mt=Math.max((d[2]-ht)/Math.cos(st),pt),St=this._zoomFromMercatorZ(mt);c.bH(d,d,$,mt),this._pitch=c.aA(st,c.an(this.minPitch),c.an(this.maxPitch)),this.angle=c.bT(lt,-Math.PI,Math.PI),this._setZoom(c.aA(St,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new c.ae(d[0],d[1],d[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(d){return Math.pow(2,d)*this.tileSize}_mercatorZfromZoom(d){return this.cameraToCenterDistance/this._worldSizeFromZoom(d)}_minimumHeightOverTerrain(){const d=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(d)}_zoomFromMercatorZ(d){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,d)*this.tileSize))}zoomFromMercatorZAdjusted(d){let $=0,st=c.cL,lt=0,ht=1/0;for(;st-$>1e-6&&st>$;){const pt=$+.5*(st-$),mt=this.tileSize*Math.pow(2,pt),St=this.getCameraToCenterDistance(this.projection,pt,mt),It=this.scaleZoom(St/(Math.max(0,d)*this.tileSize)),Dt=Math.abs(pt-It);Dt<ht&&(ht=Dt,lt=pt),pt<It?$=pt:st=pt}return lt}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(c.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(d,$){const st=Math.min(d.x,$.x),lt=Math.max(d.x,$.x),ht=Math.min(d.y,$.y),pt=Math.max(d.y,$.y);if(ht<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const mt=[new c.P(st,ht),new c.P(lt,pt),new c.P(st,pt),new c.P(lt,ht)],St=this.renderWorldCopies?-3:0,It=this.renderWorldCopies?4:1;for(const Dt of mt){const Ht=this.pointRayIntersection(Dt);if(Ht.t<0)return!0;const Gt=this.rayIntersectionCoordinate(Ht);if(Gt.x<St||Gt.y<0||Gt.x>It||Gt.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+c.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new c.P(0,0),new c.P(this.width,this.height))}zoomDeltaToMovement(d,$){const st=c.ag(c.av([],this._camera.position,d)),lt=this._zoomFromMercatorZ(st)+$;return st-this._mercatorZfromZoom(lt)}getCameraPoint(){if(this.projection.name==="globe"){const d=function([$,st,lt],ht){const pt=[$,st,lt,1];c.aC(pt,pt,ht);const mt=pt[3]=Math.max(pt[3],1e-6);return pt[0]/=mt,pt[1]/=mt,pt[2]/=mt,pt}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new c.P(d[0],d[1])}{const d=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,d))}}getCameraToCenterDistance(d,$=this.zoom,st=this.worldSize){const lt=c.cO(d,$,this.width,this.height,1024),ht=d.pixelSpaceConversion(this.center.lat,st,lt);let pt=.5/Math.tan(.5*this._fov)*this.height*ht;return this.isOrthographic&&(pt=c.ak(1,pt,c.d0(this.pitch>=Cp?1:this.pitch/Cp))),pt}getWorldToCameraMatrix(){const d=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&c.aB(d,d,this.globeMatrix),d}getFrustum(d){return c.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,this.projection.zAxisUnit==="meters")}}const Cm=(it,d)=>{if(d>0&&it.terrain&&c.w("Cutoff is currently disabled on terrain"),d<=0||it.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const $=it.transform,st=Math.max(Math.abs($._zoom-(it.minCutoffZoom-1)),1),lt=$.isLODDisabled(!1)?c.ah(60,45,$.pitch):c.ah(30,15,$.pitch),ht=$._farZ-$._nearZ,pt=d*$.height,mt=((1-(St=lt))*$.cameraToCenterDistance+St*($._farZ+pt))*st;var St;return{shouldRenderCutoff:lt<1,uniformValues:{u_cutoff_params:[$._nearZ,$._farZ,(mt-$._nearZ)/ht,(mt-pt-$._nearZ)/ht]}}},fp=2048;class xy{constructor(d,$){this.aabb=d,this.lastCascade=$}}class JE{add(d,$){const st=this.receivers[d.key];st!==void 0?(st.aabb.min[0]=Math.min(st.aabb.min[0],$.min[0]),st.aabb.min[1]=Math.min(st.aabb.min[1],$.min[1]),st.aabb.min[2]=Math.min(st.aabb.min[2],$.min[2]),st.aabb.max[0]=Math.max(st.aabb.max[0],$.max[0]),st.aabb.max[1]=Math.max(st.aabb.max[1],$.max[1]),st.aabb.max[2]=Math.max(st.aabb.max[2],$.max[2])):this.receivers[d.key]=new xy($,null)}clear(){this.receivers={}}get(d){return this.receivers[d.key]}computeRequiredCascades(d,$,st){const lt=c.d9.fromPoints(d.points);let ht=0;for(const pt in this.receivers){const mt=this.receivers[pt];if(!mt||!lt.intersectsAabb(mt.aabb))continue;mt.aabb.min=lt.closestPoint(mt.aabb.min),mt.aabb.max=lt.closestPoint(mt.aabb.max);const St=mt.aabb.getCorners();for(let It=0;It<st.length;It++){let Dt=!0;for(const Ht of St){const Gt=[Ht[0]*$,Ht[1]*$,Ht[2]];if(c.af(Gt,Gt,st[It].matrix),Gt[0]<-1||Gt[0]>1||Gt[1]<-1||Gt[1]>1){Dt=!1;break}}if(mt.lastCascade=It,ht=Math.max(ht,It),Dt)break}}return ht+1}}class T0{constructor(d){this.painter=d,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new JE,this._depthMode=new as(d.context.gl.LEQUAL,as.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const d of this._cascades)d.texture.destroy(),d.framebuffer.destroy();this._cascades=[]}updateShadowParameters(d,$){const st=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!$||!$.properties)return;const lt=$.properties.get("shadow-intensity");if(!$.shadowsEnabled()||lt<=0||(this._shadowLayerCount=st.style.order.reduce((Qt,Zt)=>{const sr=st.style._mergedLayers[Zt];return Qt+(sr.hasShadowPass()&&!sr.isHidden(d.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const ht=st.context,pt=fp,mt=fp;if(this._cascades.length===0||fp!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Qt=0;Qt<2;++Qt){const Zt=st._shadowMapDebug,sr=ht.gl,ir=ht.createFramebuffer(pt,mt,Zt?1:0,"texture"),hr=new c.T(ht,{width:pt,height:mt,data:null},sr.DEPTH_COMPONENT16);if(ir.depthAttachment.set(hr.texture),Zt){const gr=new c.T(ht,{width:pt,height:mt,data:null},sr.RGBA8);ir.colorAttachment0.set(gr.texture)}this._cascades.push({framebuffer:ir,texture:hr,matrix:[],far:0,boundingSphereRadius:0,frustum:new c.cB,scale:0})}}this.shadowDirection=vy($);let St=0;if(d.elevation){const Qt=d.elevation,Zt=[1e4,-1e4];Qt.visibleDemTiles.filter(sr=>sr.dem).forEach(sr=>{const ir=sr.dem.tree;Zt[0]=Math.min(Zt[0],ir.minimums[0]),Zt[1]=Math.max(Zt[1],ir.maximums[0])}),Zt[0]!==1e4&&(St=(Zt[1]-Zt[0])*Qt.exaggeration())}const It=1.5*d.cameraToCenterDistance,Dt=3*It,Ht=new Float64Array(16);for(let Qt=0;Qt<this._cascades.length;++Qt){const Zt=this._cascades[Qt];let sr=d.height/50,ir=1;Qt===0?ir=It:(sr=It,ir=Dt);const[hr,gr]=Am(d,this.shadowDirection,sr,ir,fp,St);Zt.scale=d.scale,Zt.matrix=hr,Zt.boundingSphereRadius=gr,c.bl(Ht,Zt.matrix),Zt.frustum=c.cB.fromInvProjectionMatrix(Ht,1,0,!0),Zt.far=ir}const Gt=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[Gt].far,this._cascades[Gt].far],this._uniformValues.u_shadow_intensity=lt,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=fp,this._uniformValues.u_shadowmap_0=gu.ShadowMap0,this._uniformValues.u_shadowmap_1=gu.ShadowMap0+1,this._groundShadowTiles=st.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const qt=st.transform.elevation;for(const Qt of this._groundShadowTiles){let Zt={min:0,max:0};if(qt){const sr=qt.getMinMaxForTile(Qt);sr&&(Zt=sr)}this.addShadowReceiver(Qt.toUnwrapped(),Zt.min,Zt.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(d){this._enabled=d}drawShadowPass(d,$){if(!this.enabled)return;const st=this.painter,lt=st.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(st.transform.getFrustum(0),st.transform.worldSize,this._cascades),lt.viewport.set([0,0,fp,fp]);for(let ht=0;ht<this._numCascadesToRender;++ht){st.currentShadowCascade=ht,lt.bindFramebuffer.set(this._cascades[ht].framebuffer.framebuffer),lt.clear({color:c.ao.white,depth:1});for(const pt of d.order){const mt=d._mergedLayers[pt];if(!mt.hasShadowPass()||mt.isHidden(st.transform.zoom))continue;const St=d.getLayerSourceCache(mt),It=St?$[St.id]:void 0;(mt.type==="model"||It&&It.length)&&st.renderLayer(st,St,mt,It)}}st.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const d=this.painter,$=d.style,st=d.context,lt=st.gl,ht=$.directionalLight,pt=$.ambientLight;if(!ht||!pt)return;const mt=[],St=Cm(d,d.longestCutoffRange);St.shouldRenderCutoff&&mt.push("RENDER_CUTOFF"),mt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&mt.push("NORMAL_OFFSET");const It=Jp($,ht,pt),Dt=new as(lt.LEQUAL,as.ReadOnly,d.depthRangeFor3D),Ht=new Ps({func:lt.EQUAL,mask:255},0,255,lt.KEEP,lt.KEEP,lt.KEEP);for(const Gt of this._groundShadowTiles){const qt=Gt.toUnwrapped(),Qt=d.isTileAffectedByFog(Gt),Zt=d.getOrCreateProgram("groundShadow",{defines:mt,overrideFog:Qt});this.setupShadows(qt,Zt),d.uploadCommonUniforms(st,Zt,qt,null,St);const sr={u_matrix:d.transform.calculateProjMatrix(qt),u_ground_shadow_factor:It};Zt.draw(d,lt.TRIANGLES,Dt,Ht,Bs.multiply,Rs.disabled,sr,"ground_shadow",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments,null,d.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Bs.unblended:Bs.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(d){const $=this.painter.transform,st=$.calculatePosMatrix(d,$.worldSize);return c.aB(st,this._cascades[this.painter.currentShadowCascade].matrix,st),Float32Array.from(st)}calculateShadowPassMatrixFromMatrix(d){const $=c.bz(d);return c.aB($,this._cascades[this.painter.currentShadowCascade].matrix,d),$}setupShadows(d,$,st){if(!this.enabled)return;const lt=this.painter.transform,ht=this.painter.context,pt=ht.gl,mt=this._uniformValues,St=new Float64Array(16),It=lt.calculatePosMatrix(d,lt.worldSize);for(let Dt=0;Dt<this._cascades.length;Dt++)c.aB(St,this._cascades[Dt].matrix,It),mt[Dt===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(St),ht.activeTexture.set(pt.TEXTURE0+gu.ShadowMap0+Dt),this._cascades[Dt].texture.bindExtraParam(pt.LINEAR,pt.LINEAR,pt.CLAMP_TO_EDGE,pt.CLAMP_TO_EDGE,pt.GREATER);if(this.useNormalOffset=!!st,this.useNormalOffset){const Dt=c.d7(d.canonical),Ht=2/lt.tileSize*c.al/fp,Gt=Ht*this._cascades[0].boundingSphereRadius,qt=Ht*this._cascades[this._cascades.length-1].boundingSphereRadius,Qt=(st==="vector-tile"?1:3)*function(Zt,sr,ir,hr,gr){const dr=c.aA((Zt-22)/-22,0,1);return .125*(1-dr)+4*dr}(lt.zoom);mt.u_shadow_normal_offset=[Dt,Gt*Qt,qt*Qt],mt.u_shadow_bias=[1e-4,.0012,.012]}else mt.u_shadow_bias=[36e-5,.0012,.012];$.setShadowUniformValues(ht,mt)}setupShadowsFromMatrix(d,$,st=!1){if(!this.enabled)return;const lt=this.painter.context,ht=lt.gl,pt=this._uniformValues,mt=new Float64Array(16);for(let St=0;St<2;St++)c.aB(mt,this._cascades[St].matrix,d),pt[St===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(mt),lt.activeTexture.set(ht.TEXTURE0+gu.ShadowMap0+St),this._cascades[St].texture.bindExtraParam(ht.LINEAR,ht.LINEAR,ht.CLAMP_TO_EDGE,ht.CLAMP_TO_EDGE,ht.GREATER);this.useNormalOffset=st,st?(pt.u_shadow_normal_offset=[1,3,3],pt.u_shadow_bias=[6e-5,.0012,.012]):pt.u_shadow_bias=[36e-5,.0012,.012],$.setShadowUniformValues(lt,pt)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(d,$,st,lt){if(lt[2]>=0)return{};const ht=function(St,It,Dt){const Ht=Dt/(1<<St.canonical.z);return new c.d9([St.canonical.x*Ht+St.wrap*Dt,St.canonical.y*Ht+St.wrap*Dt,0],[(St.canonical.x+1)*Ht+St.wrap*Dt,(St.canonical.y+1)*Ht+St.wrap*Dt,It])}(d,$,st).getCorners(),pt=$/-lt[2];lt[0]<0?(c.d8(ht[0],ht[0],[lt[0]*pt,0,0]),c.d8(ht[3],ht[3],[lt[0]*pt,0,0])):lt[0]>0&&(c.d8(ht[1],ht[1],[lt[0]*pt,0,0]),c.d8(ht[2],ht[2],[lt[0]*pt,0,0])),lt[1]<0?(c.d8(ht[0],ht[0],[0,lt[1]*pt,0]),c.d8(ht[1],ht[1],[0,lt[1]*pt,0])):lt[1]>0&&(c.d8(ht[2],ht[2],[0,lt[1]*pt,0]),c.d8(ht[3],ht[3],[0,lt[1]*pt,0]));const mt={};return mt.vertices=ht,mt.planes=[_y(ht[1],ht[0],ht[4]),_y(ht[2],ht[1],ht[5]),_y(ht[3],ht[2],ht[6]),_y(ht[0],ht[3],ht[7])],mt}addShadowReceiver(d,$,st){this._receivers.add(d,c.d9.fromTileIdAndHeight(d,$,st))}getMaxCascadeForTile(d){const $=this._receivers.get(d);return $&&$.lastCascade?$.lastCascade:0}}function _y(it,d,$){const st=c.av([],$,d),lt=c.av([],it,d),ht=c.bI([],st,lt),pt=c.ag(ht);return pt===0?[0,0,1,0]:(c.c5(ht,ht,1/pt),[ht[0],ht[1],ht[2],-c.bJ(ht,d)])}function vy(it){const d=it.properties.get("direction"),$=c.d4(d.x,d.y,d.z);$[2]=c.aA($[2],0,75);const st=c.d6([$[0],$[1],$[2]]);return c.d5(st.x,st.y,st.z)}function Jp(it,d,$){const st=d.properties.get("color-use-theme")==="none",lt=d.properties.get("color"),ht=d.properties.get("intensity"),pt=d.properties.get("direction"),mt=[pt.x,pt.y,pt.z],St=$.properties.get("color-use-theme")==="none",It=$.properties.get("color"),Dt=$.properties.get("intensity"),Ht=Math.max(c.bJ([0,0,1],mt),0),Gt=[0,0,0];c.c5(Gt,It.toPremultipliedRenderColor(St?null:it.getLut(d.scope)).toArray01Linear().slice(0,3),Dt);const qt=[0,0,0];return c.c5(qt,lt.toPremultipliedRenderColor(st?null:it.getLut($.scope)).toArray01Linear().slice(0,3),Ht*ht),c.db([Gt[0]>0?Gt[0]/(Gt[0]+qt[0]):0,Gt[1]>0?Gt[1]/(Gt[1]+qt[1]):0,Gt[2]>0?Gt[2]/(Gt[2]+qt[2]):0])}function Am(it,d,$,st,lt,ht){const pt=it.zoom,mt=it.scale,St=it.worldSize,It=1/St,Dt=it.aspect,Ht=Math.sqrt(1+Dt*Dt)*Math.tan(.5*it.fovX),Gt=Ht*Ht,qt=st-$,Qt=st+$;let Zt,sr;Gt>qt/Qt?(Zt=st,sr=st*Ht):(Zt=.5*Qt*(1+Gt),sr=.5*Math.sqrt(qt*qt+2*(st*st+$*$)*Gt+Qt*Qt*Gt*Gt));const ir=it.projection.pixelsPerMeter(it.center.lat,St),hr=it._camera.getCameraToWorldMercator(),gr=[0,0,-Zt*It];c.af(gr,gr,hr);let dr=sr*It;const Ir=it._edgeInsets;if(!(Ir.left===0&&Ir.top===0&&Ir.right===0&&Ir.bottom===0||Ir.left===Ir.right&&Ir.top===Ir.bottom)){const bn=it._camera.getWorldToCamera(it.worldSize,it.projection.zAxisUnit==="meters"?ir:1),Fn=it._camera.getCameraToClipPerspective(it._fov,it.width/it.height,$,st);Fn[8]=2*-it.centerOffset.x/it.width,Fn[9]=2*it.centerOffset.y/it.height;const Hn=new Float64Array(16);c.cP(Hn,Fn,bn);const Ln=new Float64Array(16);c.bl(Ln,Hn);const In=c.cB.fromInvProjectionMatrix(Ln,St,pt,!0);for(const ns of In.points){const _i=((Tr=ns)[0]/=mt,Tr[1]/=mt,Tr[2]=c.cf(Tr[2],it._center.lat),Tr);dr=Math.max(dr,c.c6(c.da([],gr,_i)))}}var Tr;dr*=lt/(lt-1);const Rr=Math.acos(d[2]),Er=Math.atan2(-d[0],-d[1]),vr=new Tx;vr.position=gr,vr.setPitchBearing(Rr,Er);const kr=vr.getWorldToCamera(St,ir),Ur=dr*St,zr=Math.min(it._mercatorZfromZoom(17)*St*-2,-2*Ur),Jr=vr.getCameraToClipOrthographic(-Ur,Ur,-Ur,Ur,zr,(Ur+ht*ir)/d[2]),rn=new Float64Array(16);c.aB(rn,Jr,kr);const pn=c.d5(Math.floor(1e6*gr[0])/1e6*St,Math.floor(1e6*gr[1])/1e6*St,0),Pn=.5*lt,Kr=[0,0,0];c.af(Kr,pn,rn),c.c5(Kr,Kr,Pn);const jr=[Math.floor(Kr[0]),Math.floor(Kr[1]),Math.floor(Kr[2])],an=[0,0,0];c.av(an,Kr,jr),c.c5(an,an,-1/Pn);const Xr=new Float64Array(16);return c.bA(Xr),c.br(Xr,Xr,an),c.aB(rn,Xr,rn),[rn,Ur]}class eT extends c.E{constructor(d){super(),this.requestManager=d,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(d,$){return c.dc(this.requestManager.transformRequest($,c.R.Model).url).then(st=>{if(!st)return;const lt=c.dd(st),ht=new c.de(d,$,void 0,void 0,lt);return ht.computeBoundsAndApplyParent(),ht}).catch(st=>{if(st&&st.status===404)return null;this.fire(new c.y(new Error(`Could not load model ${d} from ${$}: ${st.message}`)))})}load(d,$,st={forceReload:!1}){this.models[$]||(this.models[$]={});const lt=Object.keys(d),ht=[],pt=[];for(const mt of lt){const St=d[mt];this.hasURLBeenRequested(St)&&!st.forceReload||(this.modelByURL[St]={modelId:mt,scope:$},ht.push(this.loadModel(mt,St)),pt.push(mt)),this.models[$][mt]||(this.models[$][mt]={model:null,numReferences:1})}this.numModelsLoading[$]=(this.numModelsLoading[$]||0)+pt.length,Promise.allSettled(ht).then(mt=>{for(let St=0;St<mt.length;St++){const{status:It}=mt[St];if(It==="rejected")continue;const{value:Dt}=mt[St];this.models[$][pt[St]]||(this.models[$][pt[St]]={model:null,numReferences:1}),this.models[$][pt[St]].model=Dt}this.numModelsLoading[$]-=pt.length,this.fire(new c.z("data",{dataType:"style"}))}).catch(mt=>{this.fire(new c.y(new Error(`Could not load models: ${mt.message}`)))})}isLoaded(){for(const d in this.numModelsLoading)if(this.numModelsLoading[d]>0)return!1;return!0}hasModel(d,$,st={exactIdMatch:!1}){return!!(st.exactIdMatch?this.getModel(d,$):this.getModelByURL(this.modelUris[$][d]))}getModel(d,$){return this.models[$]||(this.models[$]={}),this.models[$][d]?this.models[$][d].model:void 0}getModelByURL(d){if(!d)return null;const $=this.modelByURL[d];return $?this.models[$.scope][$.modelId].model:null}hasModelBeenAdded(d,$){return this.models[$]&&this.models[$][d]!==void 0}getModelURIs(d){return this.modelUris[d]||{}}addModel(d,$,st){this.models[st]||(this.models[st]={}),this.modelUris[st]||(this.modelUris[st]={});const lt=this.requestManager.normalizeModelURL($);if((this.hasModel(d,st,{exactIdMatch:!0})||this.hasModelBeenAdded(d,st))&&this.modelUris[st][d]===lt)this.models[st][d].numReferences++;else if(this.hasURLBeenRequested(lt)){const{scope:ht,modelId:pt}=this.modelByURL[lt];this.models[ht][pt].numReferences++}else this.modelUris[st][d]=lt,this.load({[d]:this.modelUris[st][d]},st)}addModelURLs(d,$){this.models[$]||(this.models[$]={}),this.modelUris[$]||(this.modelUris[$]={});const st=this.modelUris[$];for(const lt in d)st[lt]=this.requestManager.normalizeModelURL(d[lt])}reloadModels(d){this.load(this.modelUris[d],d,{forceReload:!0})}addModelsFromBucket(d,$){this.models[$]||(this.models[$]={}),this.modelUris[$]||(this.modelUris[$]={});const st={};for(const lt of d)this.hasModel(lt,$,{exactIdMatch:!0})||this.hasURLBeenRequested(lt)?this.models[$][lt].numReferences++:this.modelUris[$][lt]&&!this.hasURLBeenRequested(lt)?st[lt]=this.modelUris[$][lt]:!this.hasURLBeenRequested(lt)&&c.df(lt,!1)&&(this.modelUris[$][lt]=this.requestManager.normalizeModelURL(lt),st[lt]=this.modelUris[$][lt]);this.load(st,$)}hasURLBeenRequested(d){return this.modelByURL[d]!==void 0}removeModel(d,$,st=!1,lt=!1){if(this.models[$]&&this.models[$][d]&&(this.models[$][d].numReferences--,this.models[$][d].numReferences===0||lt)){const ht=this.modelUris[$][d];st||delete this.modelUris[$][d],delete this.modelByURL[ht];const pt=this.models[$][d].model;if(!pt)return;delete this.models[$][d],pt.destroy()}}destroy(){for(const d of Object.keys(this.models))for(const $ of Object.keys(this.models[d])){const st=this.models[d][$].model;delete this.models[d][$],st&&st.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(d){return this.models[d]||(this.models[d]={}),Object.keys(this.models[d])}upload(d,$){this.models[$]||(this.models[$]={});for(const st in this.models[$])this.models[$][st].model&&this.models[$][st].model.upload(d.context)}}const dv=c.a6.colorTheme,tT=new c.a9({data:new c.aa(dv.data)});function sw(it){if(!it.metadata||!it.metadata.content_area)return;const d=c.o.devicePixelRatio,{left:$,top:st,width:lt,height:ht}=it.metadata.content_area,pt=$*d,mt=st*d;return[pt,mt,pt+lt*d,mt+ht*d]}function ow(it){if(it)return it.map(([d,$])=>[d*c.o.devicePixelRatio,$*c.o.devicePixelRatio])}class pv{constructor(d,$,st){this.id=d,this.scope=$,this.sourceCache=st,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(d){this.missingRequests.has(d.name)||this.pendingRequests.has(d.name)||this.pendingRequests.add(d.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const d=new Map;if(!this.sourceCache.loaded())return d;const $=this.sourceCache.getVisibleCoordinates();if($.length===0)return d;const st=this.sourceCache.getSource();if(!(st instanceof Du))return d;const lt=$.map(pt=>this.sourceCache.getTile(pt)),ht=st.getImages(lt,Array.from(this.pendingRequests));for(const[pt,mt]of ht)d.set(c.I.from({name:pt,iconsetId:this.id}),mt),this.pendingRequests.delete(pt);for(const pt of this.pendingRequests)this.missingRequests.add(pt);return this.pendingRequests.clear(),d}}const Rm=(it,d)=>_r(it,d&&d.filter($=>$.identifier!=="source.canvas")),aw=c.aH(fo,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),lw=c.aH(fo,["setCenter","setZoom","setBearing","setPitch"]),Cx=new Set(["background","sky","slot","custom"]),Pm={version:8,layers:[],sources:{}},by={duration:300,delay:0};class mp extends c.E{constructor(d,$={}){super(),this.map=d,this.scope=$.scope||"",this.globalId=null,this.fragments=[],this.importDepth=$.importDepth||0,this.importsCache=$.importsCache||new Map,this.resolvedImports=$.resolvedImports||new Set,this.transition=Object.assign({},by),this._buildingIndex=new YE(this),this.crossTileSymbolIndex=new Sp,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=$.styleChanges||new wo,this._hasDataDrivenEmissive=!1,this.dispatcher=$.dispatcher?$.dispatcher:new c.D(c.dh(),this),$.imageManager?this.imageManager=$.imageManager:(this.imageManager=new uu(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=$.glyphManager?$.glyphManager:new c.di(d._requestManager,$.localFontFamily?c.dj.all:$.localIdeographFontFamily?c.dj.ideographs:c.dj.none,$.localFontFamily||$.localIdeographFontFamily),$.modelManager?this.modelManager=$.modelManager:(this.modelManager=new eT(d._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=$.configOptions?$.configOptions:new Map,this._configDependentLayers=$.configDependentLayers?$.configDependentLayers:new Set,this._indoorDependentLayers=$.indoorDependentLayers?$.indoorDependentLayers:new Set,this._config=$.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:$.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=$.initialConfig,this.dispatcher.broadcast("setReferrer",c.dk());const st=this;this._rtlTextPluginCallback=mp.registerForPluginStateChange(lt=>{st.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:lt.pluginStatus,pluginURL:lt.pluginURL},(ht,pt)=>{if(c.dl(ht),pt&&pt.every(mt=>mt))for(const mt in st._sourceCaches){const St=st._sourceCaches[mt],It=St.getSource().type;It!=="vector"&&It!=="geojson"||St.reload()}})}),this.on("data",lt=>{if(lt.dataType!=="source"||lt.sourceDataType!=="metadata")return;const ht=this.getOwnSource(lt.sourceId);if(ht&&ht.vectorLayerIds)for(const pt in this._layers){const mt=this._layers[pt];mt.source===ht.id&&this._validateLayer(mt)}})}load(d){return d?(typeof d=="string"?this.loadURL(d):this.loadJSON(d),this):this}_getGlobalId(d){if(!d)return null;if(typeof d=="string"){if(c.h(d))return d;const $=c.dm(d);if(!$.startsWith("http"))try{return new URL($,location.href).toString()}catch{return $}return $}return`json://${c.dn(JSON.stringify(d))}`}_diffStyle(d,$,st){this.globalId=this._getGlobalId(d);const lt=(ht,pt)=>{try{pt(null,this.setState(ht,st))}catch(mt){pt(mt,!1)}};if(typeof d=="string"){const ht=this.map._requestManager.normalizeStyleURL(d),pt=this.map._requestManager.transformRequest(ht,c.R.Style);c.m(pt,(mt,St)=>{mt?this.fire(new c.y(mt)):St&&lt(St,$)})}else typeof d=="object"&&lt(d,$)}loadURL(d,$={}){this.fire(new c.z("dataloading",{dataType:"style"}));const st=typeof $.validate=="boolean"?$.validate:!c.h(d);this.globalId=this._getGlobalId(d),d=this.map._requestManager.normalizeStyleURL(d,$.accessToken),this.resolvedImports.add(d);const lt=this.importsCache.get(d);if(lt)return this._load(lt,st);const ht=this.map._requestManager.transformRequest(d,c.R.Style);this._request=c.m(ht,(pt,mt)=>{if(this._request=null,pt)this.fire(new c.y(pt));else if(mt)return this.importsCache.set(d,mt),this._load(mt,st)})}loadJSON(d,$={}){this.fire(new c.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(d),this._request=c.o.frame(()=>{this._request=null,this._load(d,$.validate!==!1)})}loadEmpty(){this.fire(new c.z("dataloading",{dataType:"style"})),this._load(Pm,!1)}_loadImports(d,$,st){if(this.importDepth>=4)return c.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const lt=[];for(const ht of d){const pt=this._createFragmentStyle(ht),mt=new Promise(Dt=>{pt.once("style.import.load",Dt),pt.once("error",Dt)}).then(()=>this.mergeAll());if(lt.push(mt),this.resolvedImports.has(ht.url)){pt.loadEmpty();continue}const St=ht.data||this.importsCache.get(ht.url);St?(pt.loadJSON(St,{validate:$}),this._isInternalStyle(St)&&(pt.globalId=null)):ht.url?pt.loadURL(ht.url,{validate:$}):pt.loadEmpty();const It={style:pt,id:ht.id,config:ht.config};if(st){const Dt=this.fragments.findIndex(({id:Ht})=>Ht===st);this.fragments=this.fragments.slice(0,Dt).concat(It).concat(this.fragments.slice(Dt))}else this.fragments.push(It)}return Promise.allSettled(lt)}getImportGlobalIds(d=this,$=new Set){for(const st of d.fragments)st.style.globalId&&$.add(st.style.globalId),this.getImportGlobalIds(st.style,$);return[...$.values()]}_createFragmentStyle(d){const $=this.scope?c.B(d.id,this.scope):d.id;let st;const lt=this._initialConfig&&this._initialConfig[$];(d.config||lt)&&(st=Object.assign({},d.config,lt));const ht=new mp(this.map,{scope:$,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:st,configOptions:this.options,colorThemeOverride:d["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return ht.setEventedParent(this.map,{style:ht}),ht}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(d){return this.isRootStyle()&&(d.fragment||!!d.schema&&d.fragment!==!1)}_load(d,$){if(this._isInternalStyle(d)){const ht=Object.assign({},Pm,{imports:[{id:"basemap",data:d,url:""}]},d.center?{center:d.center}:{},d.bearing?{bearing:d.bearing}:{},d.pitch?{pitch:d.pitch}:{},d.zoom?{zoom:d.zoom}:{},d.light?{light:d.light}:{});return this._importedAsBasemap=!0,void this._load(ht,$)}if(this.updateConfig(this._config,d.schema),$&&Rm(this,Ko(d)))return;this._loaded=!0,this.stylesheet=c.dp(d);const st=()=>{for(const St in d.sources)this.addSource(St,d.sources[St],{validate:!1,isInitialLoad:!0});if(d.iconsets)for(const St in d.iconsets)this.addIconset(St,d.iconsets[St]);d.sprite?this._loadIconset(d.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&d.glyphs&&this.glyphManager.setURL(d.glyphs);const ht=cy(this.stylesheet.layers);if(this._order=ht.map(St=>St.id),this.stylesheet.light&&c.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const St=this.stylesheet.lights[0];this.light=new Vr(St.properties,St.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Vr(this.stylesheet.light)),this._layers={};for(const St of ht){const It=c.du(St,this.scope,this._styleColorTheme.lut,this.options);It.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(It.fqid),It.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(It.fqid),this._hasAppearances=this._hasAppearances||It.getAppearances().length!==0,It.setEventedParent(this,{layer:{id:It.id}}),this._layers[It.id]=It;const Dt=this.getOwnLayerSourceCache(It),Ht=!!this.directionalLight&&this.directionalLight.shadowsEnabled();Dt&&It.canCastShadows()&&Ht&&(Dt.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const pt=this.stylesheet.terrain;pt&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(pt,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new c.z("data",{dataType:"style"}));const mt=this.isRootStyle();d.imports?this._loadImports(d.imports,$).then(()=>{this._reloadImports(),this.fire(new c.z(mt?"style.load":"style.import.load"))}).catch(St=>{this.fire(new c.y(new Error("Failed to load imports",St))),this.fire(new c.z(mt?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new c.z(mt?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const lt=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(lt){const ht=this._evaluateColorThemeData(lt);this._loadColorTheme(ht).then(()=>{st()}).catch(pt=>{c.w(`Couldn't load color theme from the stylesheet: ${pt}`),st()})}else this._styleColorTheme.lut=null,st()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(d=>d.style.hasAppearances())}mergeAll(){let d,$,st,lt,ht,pt,mt,St,It,Dt;const Ht={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(Gt=>{if(Gt.stylesheet){if(Gt.light!=null&&(d=Gt.light),Gt.stylesheet.lights)for(const qt of Gt.stylesheet.lights)qt.type==="ambient"&&Gt.ambientLight!=null&&($=Gt.ambientLight),qt.type==="directional"&&Gt.directionalLight!=null&&(st=Gt.directionalLight);lt=this._prioritizeTerrain(lt,Gt.terrain,Gt.stylesheet.terrain),Gt.stylesheet.fog&&Gt.fog!=null&&(ht=Gt.fog),Gt.stylesheet.snow&&Gt.snow!=null&&(pt=Gt.snow),Gt.stylesheet.rain&&Gt.rain!=null&&(mt=Gt.rain),Gt.stylesheet.camera!=null&&(Dt=Gt.stylesheet.camera),Gt.stylesheet.projection!=null&&(St=Gt.stylesheet.projection),Gt.stylesheet.transition!=null&&(It=Gt.stylesheet.transition),Ht[Gt.scope]=Gt._styleColorTheme}}),this.light=d,this.ambientLight=$,this.directionalLight=st,this.fog=ht,this.snow=pt,this.rain=mt,this._styleColorThemeForScope=Ht,lt===null?delete this.terrain:this.terrain=lt,this.camera=Dt||{"camera-projection":"perspective"},this.projection=St||{name:"mercator"},this.transition=Object.assign({},by,It),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(d){const $=st=>{for(const lt of st.fragments)$(lt.style);d(st)};$(this)}_prioritizeTerrain(d,$,st){const lt=d&&d.drapeRenderMode===0;return st===null?$&&$.drapeRenderMode===0?$:lt?d:null:$!=null&&(!d||lt||$&&$.drapeRenderMode===1)?$:d}mergeTerrain(){let d;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle($=>{d=this._prioritizeTerrain(d,$.terrain,$.stylesheet.terrain)}),d===null?delete this.terrain:this.terrain=d}mergeProjection(){let d;this.forEachFragmentStyle($=>{$.stylesheet.projection!=null&&(d=$.stylesheet.projection)}),this.projection=d||{name:"mercator"}}mergeSources(){const d={},$={},st={};this.forEachFragmentStyle(lt=>{for(const ht in lt._sourceCaches){const pt=c.B(ht,lt.scope);d[pt]=lt._sourceCaches[ht]}for(const ht in lt._otherSourceCaches){const pt=c.B(ht,lt.scope);$[pt]=lt._otherSourceCaches[ht]}for(const ht in lt._symbolSourceCaches){const pt=c.B(ht,lt.scope);st[pt]=lt._symbolSourceCaches[ht]}}),this._mergedSourceCaches=d,this._mergedOtherSourceCaches=$,this._mergedSymbolSourceCaches=st}mergeIndoor(){this.forEachFragmentStyle(d=>{if(d.stylesheet&&d.stylesheet.indoor)for(const $ of Object.values(d.stylesheet.indoor)){const st=$,lt=c.B(st.sourceId,d.scope);this._mergedIndoor[lt]=new Set(st.sourceLayers||[])}})}mergeLayers(){const d={},$=[],st={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(pt=>{for(const mt of pt._order){const St=pt._layers[mt];if(St.type==="slot"){const It=c.dq(mt);if(d[It])continue;d[It]=[]}St.slot&&d[St.slot]?d[St.slot].push(St):$.push(St)}}),this._mergedOrder=[];let lt=-1;const ht=(pt=[])=>{for(const mt of pt)if(mt.type==="slot"){const St=c.dq(mt.id);d[St]&&ht(d[St]),this._mergedSlots.push(St)}else{const St=c.B(mt.id,mt.scope);this._mergedOrder.push(St),st[St]=mt,mt.is3D(!!this.terrain)&&(this._has3DLayers=!0,lt=this._mergedOrder.length-1),mt.type==="circle"&&(this._hasCircleLayers=!0),mt.type==="symbol"&&(this._hasSymbolLayers=!0),mt.type==="clip"&&(this._clipLayerPresent=!0)}};if(ht($),this._has3DLayers){const pt={};for(let mt=0;mt<this._mergedOrder.length;++mt){const St=this._mergedOrder[mt];pt[St]=mt===lt?1:mt<lt?st[St].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((mt,St)=>pt[mt]-pt[St])}this._mergedLayers=st,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(d){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,d),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(d){return d.data?function($,st,lt,ht){const pt=Object.assign({},st);for(const St of Object.keys(dv))pt[St]===void 0&&(pt[St]=dv[St].default);const mt=new c.a8(tT,$,new Map(lt));return mt.setTransitionOrValue(pt,lt),mt.untransitioned().possiblyEvaluate(new c.ac(0,{worldview:void 0}))}(this.scope,d,this.options).get("data"):null}_loadColorTheme(d){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const $=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((st,lt)=>{const ht="data:image/png;base64,";if(!d||d.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void st();let pt=d;pt.startsWith(ht)||(pt=ht+pt);const mt=c.I.from("mapbox-reserved-lut"),St=new Image;St.src=pt,St.onerror=()=>{this._styleColorTheme.lutLoading=!1,lt(new Error("Failed to load image data"))},St.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==$)return void st();this._styleColorTheme.lutLoading=!1;const{width:It,height:Dt,data:Ht}=c.o.getImageData(St);if(Dt>32)return void lt(new Error("The height of the image must be less than or equal to 32 pixels."));if(It!==Dt*Dt)return void lt(new Error("The width of the image must be equal to the height squared."));this.getImage(mt)&&this.removeImage(mt),this.addImage(mt,{data:new c.q({width:It,height:Dt},Ht),pixelRatio:1,sdf:!1,usvg:!1,version:0});const Gt=this.imageManager.getImage(mt,this.scope);Gt?(this._styleColorTheme.lut={image:Gt.data,data:d},st()):lt(new Error("Missing LUT image."))}})}getLut(d){const $=this._styleColorThemeForScope[d];return $?$.lut:null}setProjection(d){d?this.stylesheet.projection=d:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(d){this._spriteRequest=function($,st,lt){let ht,pt,mt;const St=c.o.devicePixelRatio>1?"@2x":"";let It=c.m(st.transformRequest(st.normalizeSpriteURL($,St,".json"),c.R.SpriteJSON),(Gt,qt)=>{It=null,mt||(mt=Gt,ht=qt,Ht())}),Dt=c.n(st.transformRequest(st.normalizeSpriteURL($,St,".png"),c.R.SpriteImage),(Gt,qt)=>{Dt=null,mt||(mt=Gt,pt=qt,Ht())});function Ht(){if(mt)lt(mt);else if(ht&&pt){const Gt=c.o.getImageData(pt),qt={};for(const Qt in ht){const{width:Zt,height:sr,x:ir,y:hr,sdf:gr,pixelRatio:dr,stretchX:Ir,stretchY:Tr,content:Rr}=ht[Qt],Er=new c.q({width:Zt,height:sr});c.q.copy(Gt,Er,{x:ir,y:hr},{x:0,y:0},{width:Zt,height:sr},null),qt[Qt]={data:Er,pixelRatio:dr!==void 0?dr:1,sdf:gr!==void 0&&gr,stretchX:Ir,stretchY:Tr,content:Rr,usvg:!1,version:0}}lt(null,qt)}}return{cancel(){It&&(It.cancel(),It=null),Dt&&(Dt.cancel(),Dt=null)}}}(d,this.map._requestManager,($,st)=>{if(this._spriteRequest=null,$)this.fire(new c.y($));else if(st){const lt=new Map;for(const ht in st)lt.set(c.I.from(ht),st[ht]);this.addImages(lt)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new c.z("data",{dataType:"style"}))})}addIconset(d,$){if($.type==="sprite")return void this._loadSprite($.url);const st=this.getOwnSourceCache($.source);if(!st)return void this.fire(new c.y(new Error(`Source "${$.source}" as specified by iconset "${d}" does not exist and cannot be used as an iconset source`)));const lt=st.getSource();if(lt.type!=="raster-array")return void this.fire(new c.y(new Error(`Source "${$.source}" as specified by iconset "${d}" is not a "raster-array" source and cannot be used as an iconset source`)));lt.partial=!1;const ht=new pv(d,this.scope,st);this.imageManager.addImageProvider(ht,this.scope)}removeIconset(d){this.imageManager.removeImageProvider(d,this.scope)}_loadIconset(d){if(!c.h(d)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(d);const $=this.map._spriteFormat==="auto";var st,lt;this._spriteRequest=(lt=(ht,pt)=>{if(this._spriteRequest=null,ht)$?this._loadSprite(d):this.fire(new c.y(ht));else if(pt){const mt=new Map;for(const St in pt)mt.set(c.I.from(St),pt[St]);this.addImages(mt)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new c.z("data",{dataType:"style"}))},c.bu((st=this.map._requestManager).transformRequest(st.normalizeIconsetURL(d),c.R.Iconset),(ht,pt)=>{if(ht)return void lt(ht);const mt={},St=c.dg(new c.bt(pt));for(const It of St.icons){const Dt={version:1,pixelRatio:c.o.devicePixelRatio,content:sw(It),stretchX:It.metadata?ow(It.metadata.stretch_x_areas):void 0,stretchY:It.metadata?ow(It.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:It};mt[It.name]=Dt}lt(null,mt)}))}_validateLayer(d){const $=this.getOwnSource(d.source);if(!$)return;const st=d.sourceLayer;st&&($.type==="geojson"||$.vectorLayerIds&&$.vectorLayerIds.indexOf(st)===-1)&&this.fire(new c.y(new Error(`Source layer "${st}" does not exist on source "${$.id}" as specified by style layer "${d.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const d in this._sourceCaches)if(!this._sourceCaches[d].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:d}of this.fragments)if(!d.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((d,$)=>{const st=this.fragments[$];return st&&st.style&&(d.data=st.style.serialize()),d})}_serializeSources(){const d={};for(const $ in this._sourceCaches){const st=this._sourceCaches[$].getSource();d[st.id]||(d[st.id]=st.serialize())}return d}_serializeLayers(d){const $=[];for(const st of d){const lt=this._layers[st];lt&&lt.type!=="custom"&&$.push(lt.serialize())}return $}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const d in this._sourceCaches)if(this._sourceCaches[d].hasTransition())return!0;for(const d in this._layers)if(this._layers[d].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const d in this._mergedLayers){const $=this._mergedLayers[d];if($._transitionablePaint&&$._transitionablePaint._values){const st=$._transitionablePaint._values["line-emissive-strength"];if(st&&st.value&&st.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(d){return d?this.order:this._mergedOrder}isLayerDraped(d){return!!this.terrain&&d.isDraped(this.getLayerSourceCache(d))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(d){const $=this.getOwnLayer(d);if($)return $;this.fire(new c.y(new Error(`The layer '${d}' does not exist in the map's style.`)))}_checkSource(d){const $=this.getOwnSource(d);if($)return $;this.fire(new c.y(new Error(`The source '${d}' does not exist in the map's style.`)))}precompilePrograms(d,$){const st=this.map.painter;if(st)for(let lt=d.minzoom||0;lt<(d.maxzoom||25.5);lt++){const ht=d.getProgramIds();if(ht)for(const pt of ht){const mt=d.getDefaultProgramParams(pt,$.zoom,this._styleColorTheme.lut);mt&&(st.style=this,this.fog&&(st._fogVisible=!0,mt.overrideFog=!0,st.getOrCreateProgram(pt,mt)),st._fogVisible=!1,mt.overrideFog=!1,st.getOrCreateProgram(pt,mt),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(mt.overrideRtt=!0,st.getOrCreateProgram(pt,mt)))}}}update(d){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(d),this.directionalLight&&this.directionalLight.recalculate(d);const $=this.calculateLightsBrightness();d.brightness=$||0,$!==this._brightness&&(this._brightness=$,this.dispatcher.broadcast("setBrightness",$)),d.worldview!==this._worldview&&(this._worldview=d.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const st=this._changes.isDirty();let lt=!1;if(this._changes.isDirty()){const mt=this._changes.getLayerUpdatesByScope();for(const St in mt){const{updatedIds:It,removedIds:Dt}=mt[St];(It||Dt)&&(this._updateWorkerLayers(St,It,Dt),lt=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(d),this.light&&this.light.updateTransitions(d),this.ambientLight&&this.ambientLight.updateTransitions(d),this.directionalLight&&this.directionalLight.updateTransitions(d),this.fog&&this.fog.updateTransitions(d),this.snow&&this.snow.updateTransitions(d),this.rain&&this.rain.updateTransitions(d),this._changes.reset()}const ht={};for(const mt in this._mergedSourceCaches){const St=this._mergedSourceCaches[mt];ht[mt]=St.used,St.used=!1,St.tileCoverLift=0}for(const mt of this._mergedOrder){const St=this._mergedLayers[mt];if(St.visibility!=="none"&&St.recalculate(d,this._availableImages),!St.isHidden(d.zoom)){const It=this.getLayerSourceCache(St);It&&(It.used=!0,It.tileCoverLift=Math.max(It.tileCoverLift,St.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(St,d)}):this.precompilePrograms(St,d))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&lt&&this.mergeLayers();const pt=this.imageManager.getPendingImageProviders();for(const mt of pt)mt.sourceCache.used=!0;for(const mt in ht){const St=this._mergedSourceCaches[mt];ht[mt]!==St.used&&St.getSource().fire(new c.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:St.getSource().id}))}this.light&&this.light.recalculate(d),this.terrain&&this.terrain.recalculate(d),this.fog&&this.fog.recalculate(d),this.snow&&this.snow.recalculate(d),this.rain&&this.rain.recalculate(d),this.z=d.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),st&&this.fire(new c.z("data",{dataType:"style"}))}updateImageProviders(){const d=this.imageManager.getPendingImageProviders();for(const $ of d){const st=$.resolvePendingRequests(),lt=this.getFragmentStyle($.scope);lt&&lt.addImages(st)}}_updateTilesForChangedImages(){const d={};for(const $ in this._mergedSourceCaches){const st=this._mergedSourceCaches[$].getSource().scope;d[st]=d[st]||this._changes.getUpdatedImages(st),d[st].length!==0&&this._mergedSourceCaches[$].reloadTilesForDependencies(["icons","patterns"],d[st])}for(const $ in d)this._changes.resetUpdatedImages($)}_updateWorkerLayers(d,$,st){const lt=this.getFragmentStyle(d);lt&&this.dispatcher.broadcast("updateLayers",{layers:$?lt._serializeLayers($):[],scope:d,removedIds:st||[],options:lt.options})}setState(d,$){if(this._checkLoaded(),Rm(this,Ko(d)))return!1;(d=c.dp(d)).layers=cy(d.layers);const st=function(pt,mt){if(!pt)return[{command:fo.setStyle,args:[mt]}];let St=[];try{if(!c.by(pt.version,mt.version))return[{command:fo.setStyle,args:[mt]}];if(c.by(pt.center,mt.center)||St.push({command:fo.setCenter,args:[mt.center]}),c.by(pt.zoom,mt.zoom)||St.push({command:fo.setZoom,args:[mt.zoom]}),c.by(pt.bearing,mt.bearing)||St.push({command:fo.setBearing,args:[mt.bearing]}),c.by(pt.pitch,mt.pitch)||St.push({command:fo.setPitch,args:[mt.pitch]}),c.by(pt.sprite,mt.sprite)||St.push({command:fo.setSprite,args:[mt.sprite]}),c.by(pt.glyphs,mt.glyphs)||St.push({command:fo.setGlyphs,args:[mt.glyphs]}),c.by(pt.imports,mt.imports)||function(qt=[],Qt=[],Zt){Qt=Qt||[];const sr=(qt=qt||[]).map(uy),ir=Qt.map(uy),hr=qt.reduce(hy,{}),gr=Qt.reduce(hy,{}),dr=sr.slice();let Ir,Tr,Rr,Er;for(Ir=0,Tr=0;Ir<sr.length;Ir++)Rr=sr[Ir],gr.hasOwnProperty(Rr)?Tr++:(Zt.push({command:fo.removeImport,args:[Rr]}),dr.splice(dr.indexOf(Rr,Tr),1));for(Ir=0,Tr=0;Ir<ir.length;Ir++)Rr=ir[ir.length-1-Ir],dr[dr.length-1-Ir]!==Rr&&(hr.hasOwnProperty(Rr)?(Zt.push({command:fo.removeImport,args:[Rr]}),dr.splice(dr.lastIndexOf(Rr,dr.length-Tr),1)):Tr++,Er=dr[dr.length-Ir],Zt.push({command:fo.addImport,args:[gr[Rr],Er]}),dr.splice(dr.length-Ir,0,Rr));for(const vr of Qt){const kr=hr[vr.id];kr&&(delete kr.data,c.by(kr,vr)||Zt.push({command:fo.updateImport,args:[vr.id,vr]}))}}(pt.imports,mt.imports,St),c.by(pt.transition,mt.transition)||St.push({command:fo.setTransition,args:[mt.transition]}),c.by(pt.light,mt.light)||St.push({command:fo.setLight,args:[mt.light]}),c.by(pt.fog,mt.fog)||St.push({command:fo.setFog,args:[mt.fog]}),c.by(pt.snow,mt.snow)||St.push({command:fo.setSnow,args:[mt.snow]}),c.by(pt.rain,mt.rain)||St.push({command:fo.setRain,args:[mt.rain]}),c.by(pt.projection,mt.projection)||St.push({command:fo.setProjection,args:[mt.projection]}),c.by(pt.lights,mt.lights)||St.push({command:fo.setLights,args:[mt.lights]}),c.by(pt.camera,mt.camera)||St.push({command:fo.setCamera,args:[mt.camera]}),c.by(pt.iconsets,mt.iconsets)||function(qt,Qt,Zt){let sr;for(sr in Qt=Qt||{},qt=qt||{})qt.hasOwnProperty(sr)&&(Qt.hasOwnProperty(sr)||Zt.push({command:fo.removeIconset,args:[sr]}));for(sr in Qt){if(!Qt.hasOwnProperty(sr))continue;const ir=Qt[sr];qt.hasOwnProperty(sr)?c.by(qt[sr],ir)||(Zt.push({command:fo.removeIconset,args:[sr]}),Zt.push({command:fo.addIconset,args:[sr,ir]})):Zt.push({command:fo.addIconset,args:[sr,ir]})}}(pt.iconsets,mt.iconsets,St),!c.by(pt["color-theme"],mt["color-theme"]))return[{command:fo.setStyle,args:[mt]}];const It={},Dt=[];(function(qt,Qt,Zt,sr){let ir;for(ir in Qt=Qt||{},qt=qt||{})qt.hasOwnProperty(ir)&&(Qt.hasOwnProperty(ir)||nv(ir,Zt,sr));for(ir in Qt){if(!Qt.hasOwnProperty(ir))continue;const hr=Qt[ir];qt.hasOwnProperty(ir)?c.by(qt[ir],hr)||(qt[ir].type==="geojson"&&hr.type==="geojson"&&tw(qt,Qt,ir)?Zt.push({command:fo.setGeoJSONSourceData,args:[ir,hr.data]}):ew(ir,Qt,Zt,sr)):mx(ir,Qt,Zt)}})(pt.sources,mt.sources,Dt,It);const Ht=[];pt.layers&&pt.layers.forEach(qt=>{qt.source&&It[qt.source]?St.push({command:fo.removeLayer,args:[qt.id]}):Ht.push(qt)});let Gt=pt.terrain;Gt&&It[Gt.source]&&(St.push({command:fo.setTerrain,args:[void 0]}),Gt=void 0),St=St.concat(Dt),c.by(Gt,mt.terrain)||St.push({command:fo.setTerrain,args:[mt.terrain]}),function(qt,Qt,Zt){Qt=Qt||[];const sr=(qt=qt||[]).map(uy),ir=Qt.map(uy),hr=qt.reduce(hy,{}),gr=Qt.reduce(hy,{}),dr=sr.slice(),Ir=Object.create(null);let Tr,Rr,Er,vr,kr,Ur,zr;for(Tr=0,Rr=0;Tr<sr.length;Tr++)Er=sr[Tr],gr.hasOwnProperty(Er)?Rr++:(Zt.push({command:fo.removeLayer,args:[Er]}),dr.splice(dr.indexOf(Er,Rr),1));for(Tr=0,Rr=0;Tr<ir.length;Tr++)Er=ir[ir.length-1-Tr],dr[dr.length-1-Tr]!==Er&&(hr.hasOwnProperty(Er)?(Zt.push({command:fo.removeLayer,args:[Er]}),dr.splice(dr.lastIndexOf(Er,dr.length-Rr),1)):Rr++,Ur=dr[dr.length-Tr],Zt.push({command:fo.addLayer,args:[gr[Er],Ur]}),dr.splice(dr.length-Tr,0,Er),Ir[Er]=!0);for(Tr=0;Tr<ir.length;Tr++)if(Er=ir[Tr],vr=hr[Er],kr=gr[Er],!Ir[Er]&&!c.by(vr,kr))if(c.by(vr.source,kr.source)&&c.by(vr["source-layer"],kr["source-layer"])&&c.by(vr.type,kr.type)){for(zr in Em(vr.layout,kr.layout,Zt,Er,null,fo.setLayoutProperty),Em(vr.paint,kr.paint,Zt,Er,null,fo.setPaintProperty),c.by(vr.slot,kr.slot)||Zt.push({command:fo.setSlot,args:[Er,kr.slot]}),c.by(vr.filter,kr.filter)||Zt.push({command:fo.setFilter,args:[Er,kr.filter]}),c.by(vr.minzoom,kr.minzoom)&&c.by(vr.maxzoom,kr.maxzoom)||Zt.push({command:fo.setLayerZoomRange,args:[Er,kr.minzoom,kr.maxzoom]}),vr)vr.hasOwnProperty(zr)&&zr!=="layout"&&zr!=="paint"&&zr!=="filter"&&zr!=="metadata"&&zr!=="minzoom"&&zr!=="maxzoom"&&zr!=="slot"&&(zr.indexOf("paint.")===0?Em(vr[zr],kr[zr],Zt,Er,zr.slice(6),fo.setPaintProperty):c.by(vr[zr],kr[zr])||Zt.push({command:fo.setLayerProperty,args:[Er,zr,kr[zr]]}));for(zr in kr)kr.hasOwnProperty(zr)&&!vr.hasOwnProperty(zr)&&zr!=="layout"&&zr!=="paint"&&zr!=="filter"&&zr!=="metadata"&&zr!=="minzoom"&&zr!=="maxzoom"&&zr!=="slot"&&(zr.indexOf("paint.")===0?Em(vr[zr],kr[zr],Zt,Er,zr.slice(6),fo.setPaintProperty):c.by(vr[zr],kr[zr])||Zt.push({command:fo.setLayerProperty,args:[Er,zr,kr[zr]]}))}else Zt.push({command:fo.removeLayer,args:[Er]}),Ur=dr[dr.lastIndexOf(Er)+1],Zt.push({command:fo.addLayer,args:[kr,Ur]})}(Ht,mt.layers,St)}catch(It){console.warn("Unable to compute style diff:",It),St=[{command:fo.setStyle,args:[mt]}]}return St}(this.serialize(),d).filter(pt=>!(pt.command in lw));if(st.length===0)return!1;const lt=st.filter(pt=>!(pt.command in aw));if(lt.length>0)throw new Error(`Unimplemented: ${lt.map(pt=>pt.command).join(", ")}.`);const ht=[];return st.forEach(pt=>{ht.push(this[pt.command](...pt.args))}),$&&Promise.all(ht).then($).catch($),this.stylesheet=d,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(d){if(d.size===0)return this;for(const[$,st]of d.entries()){if(this.getImage($))return this.fire(new c.y(new Error(`An image with the name "${$.name}" already exists.`)));this.imageManager.addImage($,this.scope,st),this._changes.updateImage($,this.scope)}return this._updateWorkerImages(),this.fire(new c.z("data",{dataType:"style"})),this}addImage(d,$){return this.getImage(d)?this.fire(new c.y(new Error(`An image with the name "${d.name}" already exists.`))):(this.imageManager.addImage(d,this.scope,$),this._changes.updateImage(d,this.scope),this._updateWorkerImages(),this.fire(new c.z("data",{dataType:"style"})),this)}updateImage(d,$,st=!1){this.imageManager.updateImage(d,this.scope,$),st&&(this._changes.updateImage(d,this.scope),this._updateWorkerImages(),this.fire(new c.z("data",{dataType:"style"})))}getImage(d){return this.imageManager.getImage(d,this.scope)}removeImage(d){return this.getImage(d)?(this.imageManager.removeImage(d,this.scope),this._changes.updateImage(d,this.scope),this._updateWorkerImages(),this.fire(new c.z("data",{dataType:"style"})),this):this.fire(new c.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(d){return this.modelManager.addModelURLs(d,this.getActualScope()),this._updateWorkerModels(),this.fire(new c.z("data",{dataType:"style"})),this}addModel(d,$,st={}){return this._checkLoaded(),this._validate(tr,`models.${d}`,$,null,st)||(this.modelManager.addModel(d,$,this.getActualScope()),this.fire(new c.z("data",{dataType:"style"}))),this}hasModel(d){return this.modelManager.hasModel(d,this.getActualScope())}removeModel(d){return this.hasModel(d)?(this.modelManager.removeModel(d,this.getActualScope(),!1,!0),this.fire(new c.z("data",{dataType:"style"})),this):this.fire(new c.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(d,$,st={}){if(this._checkLoaded(),this.getOwnSource(d)!==void 0)throw new Error(`There is already a source with ID "${d}".`);if(!$.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys($).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf($.type)>=0&&this._validate(vu,`sources.${d}`,$,null,st))return;this.map&&this.map._collectResourceTiming&&($.collectResourceTiming=!0);const lt=hu(d,$,this.dispatcher,this);lt.scope=this.scope,lt.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(lt.id),source:lt.serialize(),sourceId:lt.id}));const ht=pt=>{const mt=(pt?"symbol:":"other:")+lt.id,St=c.B(mt,this.scope),It=this._sourceCaches[mt]=new Xu(St,lt,pt);(pt?this._symbolSourceCaches:this._otherSourceCaches)[lt.id]=It,It.onAdd(this.map)};ht(!1),$.type!=="vector"&&$.type!=="geojson"||ht(!0),lt.onAdd&&lt.onAdd(this.map),st.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(d){this._checkLoaded();const $=this.getOwnSource(d);if(!$)throw new Error("There is no source with this ID");for(const lt in this._layers)if(this._layers[lt].source===d)return this.fire(new c.y(new Error(`Source "${d}" cannot be removed while layer "${lt}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===d)return this.fire(new c.y(new Error(`Source "${d}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const lt=Object.entries(this.stylesheet.iconsets).find(([ht,pt])=>pt.type==="source"&&pt.source===d);if(lt)return this.fire(new c.y(new Error(`Source "${d}" cannot be removed while iconset "${lt[0]}" is using it.`)))}const st=this.getOwnSourceCaches(d);for(const lt of st){const ht=c.dq(lt.id);delete this._sourceCaches[ht],this._changes.discardSourceCacheUpdate(lt.id),lt.fire(new c.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:lt.getSource().id})),lt.setEventedParent(null),lt.clearTiles()}return delete this._otherSourceCaches[d],delete this._symbolSourceCaches[d],this.mergeSources(),$.setEventedParent(null),$.onRemove&&$.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(d,$){this._checkLoaded(),this.getOwnSource(d).setData($),this._changes.setDirty()}getOwnSource(d){const $=this.getOwnSourceCache(d);return $&&$.getSource()}getOwnSources(){const d=[];for(const $ in this._otherSourceCaches){const st=this.getOwnSourceCache($);st&&d.push(st.getSource())}return d}areTilesLoaded(){const d=this._mergedSourceCaches;for(const $ in d){const st=d[$]._tiles;for(const lt in st){const ht=st[lt];if(ht.state!=="loaded"&&ht.state!=="errored")return!1}}return!0}setLights(d){if(this._checkLoaded(),!d)return delete this.ambientLight,void delete this.directionalLight;const $=this._getTransitionParameters();for(const ht of d){if(this._validate(Su,"lights",ht))return;switch(ht.type){case"ambient":if(this.ambientLight){const pt=this.ambientLight;pt.set(ht),pt.updateTransitions($)}else this.ambientLight=new po(ht,Xl||(Xl=new c.a9({color:new c.aa(c.a6.properties_light_ambient.color),"color-use-theme":new c.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new c.aa(c.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const pt=this.directionalLight;pt.set(ht),pt.updateTransitions($)}else this.directionalLight=new po(ht,Ll||(Ll=new c.a9({direction:new c.ap(c.a6.properties_light_directional.direction),color:new c.aa(c.a6.properties_light_directional.color),"color-use-theme":new c.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new c.aa(c.a6.properties_light_directional.intensity),"cast-shadows":new c.aa(c.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new c.aa(c.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new c.aa(c.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const st=Object.assign($,{worldview:this.map.getWorldview()}),lt=new c.ac(this.z||0,st);this.ambientLight&&this.ambientLight.recalculate(lt),this.directionalLight&&this.directionalLight.recalculate(lt),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const d=this.directionalLight,$=this.ambientLight;if(!d||!$)return;const st=Gt=>.2126*(Gt[0]<=.03928?Gt[0]/12.92:Math.pow((Gt[0]+.055)/1.055,2.4))+.7152*(Gt[1]<=.03928?Gt[1]/12.92:Math.pow((Gt[1]+.055)/1.055,2.4))+.0722*(Gt[2]<=.03928?Gt[2]/12.92:Math.pow((Gt[2]+.055)/1.055,2.4)),lt=d.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),ht=d.properties.get("intensity"),pt=d.properties.get("direction"),mt=1-c.d4(pt.x,pt.y,pt.z)[2]/90,St=st(lt)*ht*mt,It=$.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),Dt=$.properties.get("intensity"),Ht=st(It)*Dt;return Number(((St+Ht)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const d=[];return this.directionalLight&&d.push(this.directionalLight.get()),this.ambientLight&&d.push(this.ambientLight.get()),d}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(d){if(d==null||d===""&&this.isRootStyle())return this;if(c.dr(d)){const $=c.ds(d),st=this.fragments.find(({id:ht})=>ht===$);if(!st)return;const lt=c.dq(d);return st.style.getFragmentStyle(lt)}{const $=this.fragments.find(({id:st})=>st===d);return $?$.style:void 0}}setFeaturesetSelectors(d){if(!d)return;const $={},st=(lt,ht="")=>`${lt}::${ht}`;this._featuresetSelectors={};for(const lt in d){const ht=this._featuresetSelectors[lt]=[];for(const pt of d[lt].selectors){if(pt.featureNamespace){const St=this.getOwnLayer(pt.layer);if(!St){c.w(`Layer is undefined for selector: ${pt.layer}`);continue}const It=st(St.source,St.sourceLayer);if(It in $&&$[It]!==pt.featureNamespace){c.w(`"featureNamespace ${pt.featureNamespace} of featureset ${lt}'s selector is not associated to the same source, skip this selector`);continue}$[It]=pt.featureNamespace}let mt;if(pt.properties)for(const St in pt.properties){const It=c.U(pt.properties[St]);It.result==="success"&&(mt=mt||{},mt[St]=It.value)}ht.push({layerId:pt.layer,namespace:pt.featureNamespace,properties:mt,uniqueFeatureID:pt._uniqueFeatureID})}}}getFeaturesetDescriptors(d){const $=this.getFragmentStyle(d);if(!$||!$.stylesheet.featuresets)return[];const st=[];for(const lt in $.stylesheet.featuresets)st.push({featuresetId:lt,importId:$.scope?$.scope:void 0});return st}getFeaturesetLayers(d,$){const st=this.getFragmentStyle($),lt=st.stylesheet.featuresets;if(!lt||!lt[d])return this.fire(new c.y(new Error(`The featureset '${d}' does not exist in the map's style and cannot be queried.`))),[];const ht=[];for(const pt of lt[d].selectors){const mt=st.getOwnLayer(pt.layer);mt&&ht.push(mt)}return ht}getConfigProperty(d,$){const st=this.getFragmentStyle(d);if(!st)return null;const lt=c.B($,st.scope),ht=st.options.get(lt),pt=ht?ht.value||ht.default:null;return pt?pt.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(d,$){const st=c.B(d,$);return this._mergedIndoor[st]}setIndoorData(d,$){this.map.indoor.setIndoorData($)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(d,$,st){const lt=this.getFragmentStyle(d);if(!lt)return;const ht=lt.stylesheet.schema;if(!ht||!ht[$])return;const pt=c.U(st);if(pt.result!=="success")return void Rm(this,pt.value);const mt=pt.value.expression,St=c.B($,lt.scope),It=lt.options.get(St);if(!It)return;let Dt;const{minValue:Ht,maxValue:Gt,stepValue:qt,type:Qt,values:Zt}=ht[$],sr=c.U(ht[$].default);sr.result==="success"&&(Dt=sr.value.expression),Dt?(this.options.set(St,Object.assign({},It,{value:mt,default:Dt,minValue:Ht,maxValue:Gt,stepValue:qt,type:Qt,values:Zt})),this.updateConfigDependencies($)):this.fire(new c.y(new Error(`No schema defined for the config option "${$}" in the "${d}" fragment.`)))}getConfig(d){const $=this.getFragmentStyle(d);if(!$)return null;const st=$.stylesheet.schema;if(!st)return null;const lt={};for(const ht in st){const pt=c.B(ht,$.scope),mt=$.options.get(pt),St=mt?mt.value||mt.default:null;lt[ht]=St?St.serialize():null}return lt}setConfig(d,$){const st=this.getFragmentStyle(d);st&&(st.updateConfig($,st.stylesheet.schema),this.updateConfigDependencies())}getSchema(d){const $=this.getFragmentStyle(d);return $?$.stylesheet.schema:null}setSchema(d,$){const st=this.getFragmentStyle(d);st&&(st.stylesheet.schema=$,st.updateConfig(st._config,$),this.updateConfigDependencies())}updateConfig(d,$){if(this._config=d,d||$)if($)for(const st in $){let lt,ht;const pt=c.U($[st].default);if(pt.result==="success"&&(lt=pt.value.expression),d&&d[st]!==void 0){const Gt=c.U(d[st]);Gt.result==="success"&&(ht=Gt.value.expression)}const{minValue:mt,maxValue:St,stepValue:It,type:Dt,values:Ht}=$[st];if(lt){const Gt=c.B(st,this.scope);this.options.set(Gt,{default:lt,value:ht,minValue:mt,maxValue:St,stepValue:It,type:Dt,values:Ht})}else this.fire(new c.y(new Error(`No schema defined for config option "${st}".`)))}else this.fire(new c.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(d,$=()=>!0){for(const st of d){const lt=this.getLayer(st);lt&&$(lt)&&(lt.possiblyEvaluateVisibility(),this._updateLayer(lt),this._changes.setDirty())}}updateConfigDependencies(d){this._updateLayers(this._configDependentLayers,$=>!d||$.expressionDependencies.configDependencies.has(d)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle($=>{const st=$._styleColorTheme.colorThemeOverride?$._styleColorTheme.colorThemeOverride:$._styleColorTheme.colorTheme;if(st){const lt=$._evaluateColorThemeData(st);(!$._styleColorTheme.lut&&lt!==""||$._styleColorTheme.lut&&lt!==$._styleColorTheme.lut.data)&&$.setColorTheme(st)}}),this._changes.setDirty()}addLayer(d,$,st={}){this._checkLoaded();const lt=d.id;if(this._layers[lt])return void this.fire(new c.y(new Error(`Layer with id "${lt}" already exists on this map`)));let ht;if(d.type==="custom"){if(Rm(this,c.dt(d)))return;ht=c.du(d,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof d.source=="object"&&(this.addSource(lt,d.source),d=c.dp(d),d=Object.assign(d,{source:lt})),this._validate(rv,`layers.${lt}`,d,{arrayIndex:-1},st))return;ht=c.du(d,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(ht),ht.setEventedParent(this,{layer:{id:lt}})}const pt=c.B(ht.source,ht.scope);ht.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(pt),ht.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(pt);let mt=this._order.length;if($){const Ht=this._order.indexOf($);if(Ht===-1)return void this.fire(new c.y(new Error(`Layer with id "${$}" does not exist on this map.`)));ht.slot===this._layers[$].slot?mt=Ht:c.w(`Layer with id "${$}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(mt,0,lt),this._layerOrderChanged=!0,this._layers[lt]=ht;const St=this.getOwnLayerSourceCache(ht),It=!!this.directionalLight&&this.directionalLight.shadowsEnabled();St&&ht.canCastShadows()&&It&&(St.castsShadows=!0);const Dt=this._changes.getRemovedLayer(ht);if(Dt&&ht.source&&St&&ht.type!=="custom"){this._changes.discardLayerRemoval(ht);const Ht=c.B(ht.source,ht.scope);Dt.type!==ht.type?this._changes.updateSourceCache(Ht,"clear"):(this._changes.updateSourceCache(Ht,"reload"),St.pause())}this._updateLayer(ht),ht.onAdd&&ht.onAdd(this.map),ht.scope=this.scope,this.mergeLayers()}moveLayer(d,$){this._checkLoaded();const st=this._checkLayer(d);if(!st||d===$)return;const lt=this._order.indexOf(d);this._order.splice(lt,1);let ht=this._order.length;if($){const pt=this._order.indexOf($);if(pt===-1)return void this.fire(new c.y(new Error(`Layer with id "${$}" does not exist on this map.`)));st.slot===this._layers[$].slot?ht=pt:c.w(`Layer with id "${$}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(ht,0,d),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(d){this._checkLoaded();const $=this._checkLayer(d);if(!$)return;$.setEventedParent(null);const st=this._order.indexOf(d);this._order.splice(st,1),delete this._layers[d],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete($.fqid),this._indoorDependentLayers.delete($.fqid),this._changes.removeLayer($);const lt=this.getOwnLayerSourceCache($);if(lt&&lt.castsShadows){let ht=!1;for(const pt in this._layers)if(this._layers[pt].source===$.source&&this._layers[pt].canCastShadows()){ht=!0;break}lt.castsShadows=ht}$.onRemove&&$.onRemove(this.map),this.mergeLayers()}getOwnLayer(d){return this._layers[d]}hasLayer(d){return d in this._mergedLayers}hasLayerType(d){for(const $ in this._layers)if(this._layers[$].type===d)return!0;return!1}setLayerZoomRange(d,$,st){this._checkLoaded();const lt=this._checkLayer(d);lt&&(lt.minzoom===$&&lt.maxzoom===st||($!=null&&(lt.minzoom=$),st!=null&&(lt.maxzoom=st),this._updateLayer(lt)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(d,$){this._checkLoaded();const st=this._checkLayer(d);st&&st.slot!==$&&(st.slot=$,this._updateLayer(st))}setFilter(d,$,st={}){this._checkLoaded();const lt=this._checkLayer(d);if(lt&&!c.by(lt.filter,$))return $==null?(lt.filter=void 0,void this._updateLayer(lt)):void(this._validate(qm,`layers.${lt.id}.filter`,$,{layerType:lt.type},st)||(lt.filter=c.dp($),this._updateLayer(lt)))}getFilter(d){const $=this._checkLayer(d);if($)return c.dp($.filter)}setLayoutProperty(d,$,st,lt={}){this._checkLoaded();const ht=this._checkLayer(d);if(ht&&!c.by(ht.getLayoutProperty($),st)){if(st!=null&&(!lt||lt.validate!==!1)&&Rm(ht,Wr.call(Ko,{key:`layers.${d}.layout.${$}`,layerType:ht.type,objectKey:$,value:st,styleSpec:c.a6,style:{glyphs:!0,sprite:!0}})))return;ht.setLayoutProperty($,st),ht.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(ht.fqid),ht.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(ht.fqid),this._updateLayer(ht)}}setLayerProperty(d,$,st,lt={}){this._checkLoaded();const ht=this._checkLayer(d);ht&&($==="appearances"?(ht.setAppearances(st),this._changes.setDirty()):ht.isPaintProperty($)?this.setPaintProperty(d,$,st,lt):this.setLayoutProperty(d,$,st,lt))}getLayoutProperty(d,$){const st=this._checkLayer(d);if(st)return st.getLayoutProperty($)}setPaintProperty(d,$,st,lt={}){this._checkLoaded();const ht=this._checkLayer(d);if(!ht||c.by(ht.getPaintProperty($),st)||st!=null&&(!lt||lt.validate!==!1)&&Rm(ht,oy.call(Ko,{key:`layers.${d}.paint.${$}`,layerType:ht.type,objectKey:$,value:st,styleSpec:c.a6})))return;const pt=ht.setPaintProperty($,st);ht.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(ht.fqid),ht.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(ht.fqid),pt&&this._updateLayer(ht),this._changes.updatePaintProperties(ht)}getPaintProperty(d,$){const st=this._checkLayer(d);if(st)return st.getPaintProperty($)}setFeatureState(d,$){if(this._checkLoaded(),"target"in d){if("featuresetId"in d.target){const{featuresetId:St,importId:It}=d.target,Dt=this.getFragmentStyle(It),Ht=Dt.getFeaturesetLayers(St);for(const{source:Gt,sourceLayer:qt}of Ht)Dt.setFeatureState({id:d.id,source:Gt,sourceLayer:qt},$)}else if("layerId"in d.target){const{layerId:St}=d.target,It=this.getLayer(St);this.setFeatureState({id:d.id,source:It.source,sourceLayer:It.sourceLayer},$)}return}const st=d.source,lt=d.sourceLayer,ht=this._checkSource(st);if(!ht)return;const pt=ht.type;if(pt==="geojson"&&lt)return void this.fire(new c.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(pt==="vector"&&!lt)return void this.fire(new c.y(new Error("The sourceLayer parameter must be provided for vector source types.")));d.id===void 0&&this.fire(new c.y(new Error("The feature id parameter must be provided.")));const mt=this.getOwnSourceCaches(st);for(const St of mt)St.setFeatureState(lt,d.id,$)}removeFeatureState(d,$){if(this._checkLoaded(),"target"in d){if("featuresetId"in d.target){const{featuresetId:St,importId:It}=d.target,Dt=this.getFragmentStyle(It),Ht=Dt.getFeaturesetLayers(St);for(const{source:Gt,sourceLayer:qt}of Ht)Dt.removeFeatureState({id:d.id,source:Gt,sourceLayer:qt},$)}else if("layerId"in d.target){const{layerId:St}=d.target,It=this.getLayer(St);this.removeFeatureState({id:d.id,source:It.source,sourceLayer:It.sourceLayer},$)}return}const st=d.source,lt=this._checkSource(st);if(!lt)return;const ht=lt.type,pt=ht==="vector"?d.sourceLayer:void 0;if(ht==="vector"&&!pt)return void this.fire(new c.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if($&&typeof d.id!="string"&&typeof d.id!="number")return void this.fire(new c.y(new Error("A feature id is required to remove its specific state property.")));const mt=this.getOwnSourceCaches(st);for(const St of mt)St.removeFeatureState(pt,d.id,$)}getFeatureState(d){if(this._checkLoaded(),"target"in d){let ht;if("featuresetId"in d.target){const{featuresetId:pt,importId:mt}=d.target,St=this.getFragmentStyle(mt),It=St.getFeaturesetLayers(pt);for(const{source:Dt,sourceLayer:Ht}of It){const Gt=St.getFeatureState({id:d.id,source:Dt,sourceLayer:Ht});if(Gt&&!ht)ht=Gt;else if(!c.by(ht,Gt))return void this.fire(new c.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in d.target){const{layerId:pt}=d.target,mt=this.getLayer(pt);ht=this.getFeatureState({id:d.id,source:mt.source,sourceLayer:mt.sourceLayer})}return ht}const $=d.source,st=d.sourceLayer,lt=this._checkSource($);if(lt){if(lt.type!=="vector"||st)return d.id===void 0&&this.fire(new c.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches($)[0].getFeatureState(st,d.id);this.fire(new c.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(d){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,d),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const d=this.getTerrain(),$=d&&this.terrain&&this.terrain.scope===this.scope?d:this.stylesheet.terrain;return c.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:$,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},st=>st!==void 0)}_updateFilteredLayers(d){for(const $ of Object.values(this._mergedLayers))d($)&&this._updateLayer($)}_updateLayer(d){this._changes.updateLayer(d);const $=this.getLayerSourceCache(d),st=c.B(d.source,d.scope),lt=this._changes.getUpdatedSourceCaches();d.source&&!lt[st]&&$&&$.getSource().type!=="raster"&&(this._changes.updateSourceCache(st,"reload"),$.pause()),d.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(d){const $=mt=>this._mergedLayers[mt].is3D(!!this.terrain),st=this.order,lt={},ht=[];for(let mt=st.length-1;mt>=0;mt--){const St=st[mt];if($(St)){lt[St]=mt;for(const It of d){const Dt=It[St];if(Dt)for(const Ht of Dt)ht.push(Ht)}}}ht.sort((mt,St)=>St.intersectionZ-mt.intersectionZ);const pt=[];for(let mt=st.length-1;mt>=0;mt--){const St=st[mt];if($(St))for(let It=ht.length-1;It>=0;It--){const Dt=ht[It].feature;if(Dt.layer&&lt[Dt.layer.id]<mt)break;pt.push(Dt),ht.pop()}else for(const It of d){const Dt=It[St];if(Dt)for(const Ht of Dt)pt.push(Ht.feature)}}return pt}queryRasterValue(d,$,st){const lt=this.getOwnSource(d);return lt?lt.type!=="raster-array"?(this.fire(new c.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):lt.queryRasterArrayValue($,st):(this.fire(new c.y(new Error(`Source with id "${d}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(d,$,st){let lt;$&&!Array.isArray($)&&$.filter&&(this._validate(qm,"queryRenderedFeatures.filter",$.filter,null,$),lt=c.b6($.filter));const ht={},pt=Dt=>{if(Cx.has(Dt.type))return;const Ht=this.getOwnLayerSourceCache(Dt),Gt=ht[Ht.id]=ht[Ht.id]||{sourceCache:Ht,layers:{},has3DLayers:!1};Dt.is3D(!!this.terrain)&&(Gt.has3DLayers=!0),Gt.layers[Dt.fqid]=Gt.layers[Dt.fqid]||{styleLayer:Dt,targets:[]},Gt.layers[Dt.fqid].targets.push({filter:lt})};if($&&$.layers){if(!Array.isArray($.layers))return this.fire(new c.y(new Error("parameters.layers must be an Array."))),[];for(const Dt of $.layers){const Ht=this._layers[Dt];if(!Ht)return this.fire(new c.y(new Error(`The layer '${Dt}' does not exist in the map's style and cannot be queried for features.`))),[];pt(Ht)}}else for(const Dt in this._layers)pt(this._layers[Dt]);const mt=this._queryRenderedFeatures(d,ht,st),St=this._flattenAndSortRenderedFeatures(mt),It=[];for(const Dt of St)c.dw(Dt.layer.id)===this.scope&&It.push(Dt);return It}queryRenderedFeatureset(d,$,st){let lt;$&&!Array.isArray($)&&$.filter&&(this._validate(qm,"queryRenderedFeatures.filter",$.filter,null,$),lt=c.b6($.filter));const ht="mock",pt=[];if($&&$.target)pt.push(Object.assign({},$,{targetId:ht,filter:lt}));else{const Dt=this.getFeaturesetDescriptors();for(const Ht of Dt)pt.push({targetId:ht,filter:lt,target:Ht});for(const{style:Ht}of this.fragments){const Gt=Ht.getFeaturesetDescriptors();for(const qt of Gt)pt.push({targetId:ht,filter:lt,target:qt})}}const mt=this.queryRenderedTargets(d,pt,st),St=[],It=new Set;for(const Dt of mt)for(const Ht of Dt.variants[ht])v0(Ht,Dt,It)||St.push(new c.dx(Dt,Ht));return St}queryRenderedTargets(d,$,st){const lt={},ht=(mt,St,It,Dt)=>{const Ht=lt[St.id]=lt[St.id]||{sourceCache:St,layers:{},has3DLayers:!1};if(Ht.layers[mt.fqid]=Ht.layers[mt.fqid]||{styleLayer:mt,targets:[]},mt.is3D(!!this.terrain)&&(Ht.has3DLayers=!0),!Dt)return It.uniqueFeatureID=!1,void Ht.layers[mt.fqid].targets.push(It);Ht.layers[mt.fqid].targets.push(Object.assign({},It,{namespace:Dt.namespace,properties:Dt.properties,uniqueFeatureID:Dt.uniqueFeatureID}))};for(const mt of $)if("featuresetId"in mt.target){const{featuresetId:St,importId:It}=mt.target,Dt=this.getFragmentStyle(It);if(!Dt||!Dt._featuresetSelectors)continue;const Ht=Dt._featuresetSelectors[St];if(!Ht){this.fire(new c.y(new Error(`The featureset '${St}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const Gt of Ht){const qt=Dt.getOwnLayer(Gt.layerId);qt&&!Cx.has(qt.type)&&ht(qt,Dt.getOwnLayerSourceCache(qt),mt,Gt)}}else if("layerId"in mt.target){const{layerId:St}=mt.target,It=this.getLayer(St);if(!It||Cx.has(It.type))continue;ht(It,this.getLayerSourceCache(It),mt)}const pt=this._queryRenderedFeatures(d,lt,st);return this._flattenAndSortRenderedFeatures(pt)}_queryRenderedFeatures(d,$,st){const lt=[],ht=!!this.map._showQueryGeometry,pt=Cl.createFromScreenPoints(d,st);for(const mt in $){const St=ax(pt,$[mt],this._availableImages,st,ht);Object.keys(St).length&&lt.push(St)}if(this.placement)for(const mt in $){if(!$[mt].sourceCache._onlySymbols)continue;const St=lx(pt.screenGeometry,$[mt],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(St).length&&lt.push(St)}return lt}querySourceFeatures(d,$){const st=$&&$.filter;st&&this._validate(qm,"querySourceFeatures.filter",st,null,$);let lt=[];const ht=this.getOwnSourceCaches(d);for(const pt of ht)lt=lt.concat(ux(pt,$));return lt}addSourceType(d,$,st){return mp.getSourceType(d)?st(new Error(`A source type called "${d}" already exists.`)):(mp.setSourceType(d,$),$.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:d,url:$.workerSourceURL},st):st(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(d,$,st={}){this._checkLoaded();const lt=this.light.getLight();let ht=!1;for(const mt in d)if(!c.by(d[mt],lt[mt])){ht=!0;break}if(!ht)return;const pt=this._getTransitionParameters();this.light.setLight(d,$,st),this.light.updateTransitions(pt)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=c.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&c.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(d,$=1){if(this._checkLoaded(),!d)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),$===0&&delete this.terrain,d===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let st=d;const lt=!("source"in d)||d.source==null;if($===1){if(this.disableElevatedTerrain)return;if("source"in st&&typeof st.source=="object"){const mt="terrain-dem-src";this.addSource(mt,st.source),st=c.dp(st),st=Object.assign(st,{source:mt})}const ht=Object.assign({},st),pt={};if(this.terrain&&lt){ht.source=this.terrain.get().source;const mt=this.terrain?this.getFragmentStyle(this.terrain.scope):null;mt&&(pt.style=mt.serialize())}if(this._validate(bp,"terrain",ht,pt))return}if(!this.terrain||this.terrain.scope!==this.scope&&!lt||this.terrain&&$!==this.terrain.drapeRenderMode){if(!st)return;this._createTerrain(st,$),this.fire(new c.z("data",{dataType:"style"}))}else{const ht=this.terrain,pt=ht.get();for(const mt of Object.keys(c.a6.terrain))!st.hasOwnProperty(mt)&&c.a6.terrain[mt].default&&(st[mt]=c.a6.terrain[mt].default);for(const mt in d)if(!c.by(d[mt],pt[mt])){ht.set(d,this.options),this.stylesheet.terrain=d;const St=this._getTransitionParameters({duration:0});ht.updateTransitions(St),this.fire(new c.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(d){const $=this.fog=new js(d,this.map.transform,this.scope,this.options);this.stylesheet.fog=$.get();const st=this._getTransitionParameters({duration:0});$.updateTransitions(st)}_createSnow(d){const $=this.snow=new eu(d,this.map.transform,this.scope,this.options);this.stylesheet.snow=$.get();const st=this._getTransitionParameters({duration:0});$.updateTransitions(st)}_createRain(d){const $=this.rain=new Sl(d,this.map.transform,this.scope,this.options);this.stylesheet.rain=$.get();const st=this._getTransitionParameters({duration:0});$.updateTransitions(st)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const d of this.map._markers)d._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(d){if(this._checkLoaded(),!d)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const $=this.fog;if(!c.by($.get(),d)){$.set(d,this.options),this.stylesheet.fog=$.get();const st=this._getTransitionParameters({duration:0});$.updateTransitions(st)}}else this._createFog(d);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(d){if(this._checkLoaded(),!d)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const $=this.snow;if(!c.by($.get(),d)){$.set(d,this.options),this.stylesheet.snow=$.get();const st=this._getTransitionParameters({duration:0});$.updateTransitions(st)}}else this._createSnow(d);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(d){if(this._checkLoaded(),!d)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const $=this.rain;if(!c.by($.get(),d)){$.set(d,this.options),this.stylesheet.rain=$.get();const st=this._getTransitionParameters({duration:0});$.updateTransitions(st)}}else this._createRain(d);this._markersNeedUpdate=!0}_reloadColorTheme(){const d=()=>{for(const lt in this._layers)this._layers[lt].lut=this._styleColorTheme.lut;for(const lt in this._sourceCaches)this._sourceCaches[lt].clearTiles()},$=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!$)return this._styleColorTheme.lut=null,void d();const st=this._evaluateColorThemeData($);this._loadColorTheme(st).then(()=>{this.fire(new c.z("colorthemeset")),d()}).catch(lt=>{c.w(`Couldn't set color theme: ${lt}`)})}setColorTheme(d){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&c.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=d,this._reloadColorTheme()}setImportColorTheme(d,$){const st=this.getFragmentStyle(d);st&&(st._styleColorTheme.colorThemeOverride=$,st._reloadColorTheme())}_getTransitionParameters(d){return{now:c.o.now(),transition:Object.assign(this.transition,d)}}updateDrapeFirstLayers(){if(!this.terrain)return;const d=[],$=[];for(const st of this._mergedOrder)this.isLayerDraped(this._mergedLayers[st])?d.push(st):$.push(st);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...d),this._drapedFirstOrder.push(...$)}_createTerrain(d,$){const st=this.terrain=new Gr(d,$,this.scope,this.options,this.map.getWorldview());$===1&&(this.stylesheet.terrain=d),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const lt=this._getTransitionParameters({duration:0});st.updateTransitions(lt)}_force3DLayerUpdate(){for(const d in this._layers){const $=this._layers[d];$.type==="fill-extrusion"&&this._updateLayer($)}}_forceSymbolLayerUpdate(){for(const d in this._layers){const $=this._layers[d];$.type==="symbol"&&this._updateLayer($)}}_validate(d,$,st,lt,ht={}){if(ht&&ht.validate===!1)return!1;const pt=Object.assign({},this.serialize());return Rm(this,d.call(Ko,Object.assign({key:$,style:pt,value:st,styleSpec:c.a6},lt)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const d in this._mergedLayers)this._mergedLayers[d].setEventedParent(null);for(const d in this._mergedSourceCaches)this._mergedSourceCaches[d].clearTiles(),this._mergedSourceCaches[d].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(d){const $=this.getSourceCaches(d);for(const st of $)st.clearTiles()}clearSources(){for(const d in this._mergedSourceCaches)this._mergedSourceCaches[d].clearTiles()}clearLayers(){for(const d in this._mergedLayers){const $=this._mergedLayers[d];$._clear&&$._clear()}}reloadSource(d){const $=this.getSourceCaches(d);for(const st of $)st.resume(),st.reload()}reloadSources(){for(const d of this.getSources())d.reload&&d.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(d=>{d.modelManager.reloadModels(d.scope)})}updateSources(d){let $;this.directionalLight&&($=vy(this.directionalLight));const st=new Set,lt=new Set;for(const ht in this._mergedLayers){const pt=this._mergedLayers[ht];pt.type==="building"&&st.add(pt.source),pt.hasElevation()&&!lt.has(pt.source)&&lt.add(pt.source)}for(const ht in this._mergedSourceCaches){const pt=this._mergedSourceCaches[ht],mt=lt.has(pt._source.id);st.has(pt._source.id)&&(pt._source.reparseOverscaled=!1),pt.update(d,void 0,void 0,$,mt)}}_generateCollisionBoxes(){for(const d in this._sourceCaches){const $=this._sourceCaches[d];$.resume(),$.reload()}}_updatePlacement(d,$,st,lt,ht,pt,mt=!1){let St=!1,It=!1;const Dt={},Ht={};for(const Zt of this._mergedOrder){const sr=this._mergedLayers[Zt];if(sr.type!=="symbol")continue;const ir=c.B(sr.source,sr.scope);let hr=Dt[ir];if(!hr){const dr=this.getLayerSourceCache(sr);if(!dr)continue;const Ir=dr.getRenderableIds(!0).map(Tr=>dr.getTileByID(Tr));Ht[ir]=Ir.slice(),hr=Dt[ir]=Ir.sort((Tr,Rr)=>Rr.tileID.overscaledZ-Tr.tileID.overscaledZ||(Tr.tileID.isLessThan(Rr.tileID)?-1:1))}const gr=this.crossTileSymbolIndex.addLayer(sr,hr,$.center.lng,$.projection);St=St||gr}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),mt=mt||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new c.z("neworder"));const Gt=!!(this.placement&&!$.equals(this.placement.transform)),qt=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!pt||this.placement.lastReplacementSourceUpdateTime!==pt.updateTime)),Qt=(Gt||qt||St||this.placement&&this.placement.isStale())&&lt===0;if((mt||!this.pauseablePlacement||Qt||lt!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.o.now(),$.zoom))&&(this.pauseablePlacement=new du($,this._mergedOrder,mt||lt===0,st,lt,ht,this.placement,this.fog&&$.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,Dt,Ht,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.o.now()),It=!0),St&&this.pauseablePlacement.placement.setStale()),It||St){this._buildingIndex.onNewFrame($.zoom);for(let Zt=0;Zt<this._mergedOrder.length;Zt++){const sr=this._mergedLayers[this._mergedOrder[Zt]];if(sr.type!=="symbol"||sr.visibility==="none")continue;const ir=this.isLayerClipped(sr);this.placement.updateLayerOpacities(sr,Dt[c.B(sr.source,sr.scope)],Zt,ir?pt:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.o.now())}}_releaseSymbolFadeTiles(){for(const d in this._sourceCaches)this._sourceCaches[d].releaseSymbolFadeTiles()}addImport(d,$){this._checkLoaded();const st=this.stylesheet.imports=this.stylesheet.imports||[];if(st.findIndex(({id:ht})=>ht===d.id)!==-1)return void this.fire(new c.y(new Error(`Import with id '${d.id}' already exists in the map's style.`)));if(!$)return st.push(d),this._loadImports([d],!0);const lt=st.findIndex(({id:ht})=>ht===$);return lt===-1&&this.fire(new c.y(new Error(`Import with id "${$}" does not exist on this map.`))),this.stylesheet.imports=st.slice(0,lt).concat(d).concat(st.slice(lt)),this._loadImports([d],!0,$)}updateImport(d,$){this._checkLoaded();const st=this.stylesheet.imports||[],lt=this.getImportIndex(d);return lt===-1?this:typeof $=="string"?(this.setImportUrl(d,$),this):($.url&&$.url!==st[lt].url&&this.setImportUrl(d,$.url),c.by($.config,st[lt].config)||this.setImportConfig(d,$.config,$.data.schema),c.by($.data,st[lt].data)||this.setImportData(d,$.data),this)}moveImport(d,$){this._checkLoaded();let st=this.stylesheet.imports||[];const lt=this.getImportIndex(d);if(lt===-1)return this;const ht=this.getImportIndex($);if(ht===-1)return this;const pt=st[lt],mt=this.fragments[lt];return st=st.filter(({id:St})=>St!==d),this.fragments=this.fragments.filter(({id:St})=>St!==d),this.stylesheet.imports=st.slice(0,ht).concat(pt).concat(st.slice(ht)),this.fragments=this.fragments.slice(0,ht).concat(mt).concat(this.fragments.slice(ht)),this.mergeLayers(),this}setImportUrl(d,$){this._checkLoaded();const st=this.stylesheet.imports||[],lt=this.getImportIndex(d);if(lt===-1)return this;st[lt].url=$;const ht=this.fragments[lt];return ht.style=this._createFragmentStyle(st[lt]),ht.style.on("style.import.load",()=>this.mergeAll()),ht.style.loadURL($),this}setImportData(d,$){this._checkLoaded();const st=this.getImportIndex(d),lt=this.stylesheet.imports||[];return st===-1?this:$?(this.fragments[st].style.setState($),this._reloadImports(),this):(delete lt[st].data,this.setImportUrl(d,lt[st].url))}setImportConfig(d,$,st){this._checkLoaded();const lt=this.getImportIndex(d),ht=this.stylesheet.imports||[];if(lt===-1)return this;$?ht[lt].config=$:delete ht[lt].config;const pt=this.fragments[lt];st&&pt.style.stylesheet&&(pt.style.stylesheet.schema=st);const mt=pt.style.stylesheet&&pt.style.stylesheet.schema;return pt.config=$,pt.style.updateConfig($,mt),this.updateConfigDependencies(),this}removeImport(d){this._checkLoaded();const $=this.stylesheet.imports||[],st=this.getImportIndex(d);st!==-1&&($.splice(st,1),this.fragments[st].style._remove(),this.fragments.splice(st,1),this._reloadImports())}getImportIndex(d){const $=(this.stylesheet.imports||[]).findIndex(st=>st.id===d);return $===-1&&this.fire(new c.y(new Error(`Import '${d}' does not exist in the map's style and cannot be updated.`))),$}getLayer(d){return this._mergedLayers[d]}getSources(){const d=[];for(const $ in this._mergedOtherSourceCaches){const st=this._mergedOtherSourceCaches[$];st&&d.push(st.getSource())}return d}getSource(d,$){const st=this.getSourceCache(d,$);return st&&st.getSource()}getLayerSource(d){const $=this.getLayerSourceCache(d);return $&&$.getSource()}getSourceCache(d,$){const st=c.B(d,$);return this._mergedOtherSourceCaches[st]}getLayerSourceCache(d){const $=c.B(d.source,d.scope);return d.type==="symbol"?this._mergedSymbolSourceCaches[$]:this._mergedOtherSourceCaches[$]}getSourceCaches(d){if(d==null)return Object.values(this._mergedSourceCaches);const $=[];return this._mergedOtherSourceCaches[d]&&$.push(this._mergedOtherSourceCaches[d]),this._mergedSymbolSourceCaches[d]&&$.push(this._mergedSymbolSourceCaches[d]),$}updateSourceCaches(){const d=this._changes.getUpdatedSourceCaches();for(const $ in d){const st=d[$];st==="reload"?this.reloadSource($):st==="clear"&&this.clearSource($)}}updateLayers(d){const $=this._changes.getUpdatedPaintProperties();for(const st of $){const lt=this.getLayer(st);lt&&lt.updateTransitions(d)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(d){this.stylesheet.glyphs=d,this.glyphManager.setURL(d)}getImages(d,$,st){this.imageManager.getImages($.images,$.scope,st),this._updateTilesForChangedImages();const lt=pt=>{if(pt){const mt=$.images.map(St=>c.I.toString(St));pt.setDependencies($.tileID.key,$.type,mt)}},ht=c.B($.source,$.scope);lt(this._mergedOtherSourceCaches[ht]),lt(this._mergedSymbolSourceCaches[ht]),$.images.some(pt=>pt.iconsetId)&&this.fire(new c.z("data",{dataType:"style"}))}rasterizeImages(d,$,st){this.imageManager.rasterizeImages($,st)}getGlyphs(d,$,st){this.glyphManager.getGlyphs($.stacks,st)}getResource(d,$,st){return c.dz($,st)}getOwnSourceCache(d){return this._otherSourceCaches[d]}getOwnLayerSourceCache(d){return d.type==="symbol"?this._symbolSourceCaches[d.source]:this._otherSourceCaches[d.source]}getOwnSourceCaches(d){const $=[];return this._otherSourceCaches[d]&&$.push(this._otherSourceCaches[d]),this._symbolSourceCaches[d]&&$.push(this._symbolSourceCaches[d]),$}_isSourceCacheLoaded(d){const $=this.getOwnSourceCaches(d);return $.length===0?(this.fire(new c.y(new Error(`There is no source with ID '${d}'`))),!1):$.every(st=>st.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(d,$){if(!this._clipLayerPresent&&d.type!=="fill-extrusion"&&d.type!=="building")return!1;const st=d.type==="fill-extrusion"&&(d.sourceLayer==="building"||d.sourceLayer==="procedural_buildings"),lt=d.type==="building";if(d.is3D(!!this.terrain)){if(st||lt||$&&$.type==="batched-model"||d.type==="model")return!0}else if(d.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(d=>{d.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}mp.getSourceType=function(it){return Dp[it]},mp.setSourceType=function(it,d){Dp[it]=d},mp.registerForPluginStateChange=c.dA;class cw extends c.E{constructor(d){super(),this._style=d,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},c.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(d){d===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=d,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(d){this._activeFloorsVisible=d,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(d){for(const[$,st]of Object.entries(d.buildings))if(this._buildings[$])for(const lt of st.floorIds)this._buildings[$].floors[lt]||(this._buildings[$].floors[lt]=st.floors[lt]);else this._buildings[$]=st;for(const $ of d.activeFloors)this._activeFloors.add($);this._updateIndoorSelector()}getIndoorTileOptions(d,$){const st=this._style.getIndoorSourceLayers(d,$);return st&&this._indoorState?{sourceLayers:st,indoorState:this._indoorState}:null}_updateUI(d,$,st){const lt=function(ht,pt,mt,St){let It=null,Dt=Number.MAX_SAFE_INTEGER;if(St<16)return null;for(const[Ht,Gt]of Object.entries(ht)){const qt=Gt.center;if(qt){const Qt=pt.distanceTo(c.aT.convert(qt));Qt<Dt&&mt.contains(qt)&&(Dt=Qt,It=Ht)}}return It}(this._buildings,$,st,d);lt!==this._closestBuildingId&&(this._closestBuildingId=lt,this._updateIndoorSelector())}_updateIndoorSelector(){const d=this._buildings,$=this._closestBuildingId,st=$&&d?d[$]:void 0;if(!st)return void this.fire(new c.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let lt=null;for(const pt of st.floorIds)if(this._activeFloors&&this._activeFloors.has(pt)){lt=pt;break}const ht=Array.from(st.floorIds).map(pt=>({id:pt,name:st.floors[pt].name,zIndex:st.floors[pt].zIndex})).sort((pt,mt)=>mt.zIndex-pt.zIndex);this.fire(new c.z("selector-update",{selectedFloorId:lt,activeFloorsVisible:this._activeFloorsVisible,floors:ht}))}_updateActiveFloors(){const d=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:d,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var S0=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,C0=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,fv=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Ax="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",_d=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,Rx=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,jn=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,mv=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Px=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Ix=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,gv=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const wy=/#include\s+"([^"]+)"/g,zp=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,yv=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,e0=new Set(["ifdef","ifndef","elif","if","defined"]),t0=new Set;km(S0,t0),km(fv,t0),km(C0,t0);const Im={"_prelude_fog.vertex.glsl":Rx,"_prelude_terrain.vertex.glsl":_d,"_prelude_shadow.vertex.glsl":Ix,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":jn,"_prelude_shadow.fragment.glsl":gv,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":mv,"_prelude_raster_particle.glsl":Px},kx={};co("",_d),co(jn,Rx),co(gv,Ix),co(mv,""),co(Px,"");const uw=co(C0,fv),Mx=S0,rT=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",Mx,uw.fragmentSource].join(`
`),hw=["precision highp float;",Mx,uw.vertexSource].join(`
`);var xv={background:co(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:co(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:co(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:co(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:co(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:co(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:co("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:co(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:co(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:co("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:co("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:co("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:co(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:co(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:co(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:co(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:co(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:co(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:co(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:co(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:co(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:co(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:co(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:co(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:co(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:co(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:co(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:co(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:co(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:co(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:co("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:co("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:co(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:co(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:co(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:co("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:co(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ax),skyboxGradient:co(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ax),skyboxCapture:co(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:co(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:co(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:co(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:co(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:co(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:co("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:co("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:co("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:co("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function km(it,d){const $=it.split(`
`);for(let st of $){if(st=st.trimStart(),st[0]!=="#"||!st.includes("if")||st.startsWith("#endif"))continue;const lt=st.match(yv);if(lt)for(const ht of lt)e0.has(ht)||d.add(ht)}}function co(it,d){const $=new Set,st=[],lt=[];it=it.replace(wy,(pt,mt)=>(lt.push(mt),"")),d=d.replace(wy,(pt,mt)=>(st.push(mt),""));let ht=new Set(t0);km(it,ht),km(d,ht);for(const pt of[...st,...lt])kx[pt]||(kx[pt]=new Set,km(Im[pt],kx[pt])),ht=new Set([...ht,...kx[pt]]);return{fragmentSource:it=it.replace(zp,(pt,mt,St,It,Dt)=>($.add(Dt),mt==="define"?`
#ifndef HAS_UNIFORM_u_${Dt}
in ${St} ${It} ${Dt};
#else
uniform ${St} ${It} u_${Dt};
#endif
`:mt==="initialize"?`
#ifdef HAS_UNIFORM_u_${Dt}
    ${St} ${It} ${Dt} = u_${Dt};
#endif
`:mt==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Dt}
    in ${St} ${It} ${Dt};
#endif
`:mt==="initialize-attribute"?"":void 0)),vertexSource:d=d.replace(zp,(pt,mt,St,It,Dt)=>{const Ht=`MATERIAL_ATTRIBUTE_OFFSET_${Dt}`,Gt=It==="float"?"vec2":It,qt=`GET_ATTRIBUTE_${Gt}(a_${Dt}, materialInfo, ${Ht})`,Qt=Dt.match(/color/)?"color":Gt;return mt==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Dt}
in ${St} ${It} a_${Dt};
#endif
`:$.has(Dt)?mt==="define"?`
#ifndef HAS_UNIFORM_u_${Dt}
uniform lowp float u_${Dt}_t;
    #if !defined(${Ht})
        in ${St} ${Gt} a_${Dt};
    #endif
out ${St} ${It} ${Dt};
#else
uniform ${St} ${It} u_${Dt};
#endif
`:mt==="initialize"?Qt==="vec4"?`
#ifndef HAS_UNIFORM_u_${Dt}
    ${Dt} = a_${Dt};
#else
    ${St} ${It} ${Dt} = u_${Dt};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${Dt})
    #ifdef ${Ht}
        ${Dt} = unpack_mix_${Qt}(${qt}, u_${Dt}_t);
    #else
        ${Dt} = unpack_mix_${Qt}(a_${Dt}, u_${Dt}_t);
    #endif
#else
    ${St} ${It} ${Dt} = u_${Dt};
#endif
`:mt==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Dt}
    in ${St} ${It} a_${Dt};
    out ${St} ${It} ${Dt};
#endif
`:mt==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Dt}
    ${Dt} = a_${Dt};
#endif
`:void 0:mt==="define"?`
#ifndef HAS_UNIFORM_u_${Dt}
uniform lowp float u_${Dt}_t;
    #if !defined(${Ht})
        in ${St} ${Gt} a_${Dt};
    #endif
#else
uniform ${St} ${It} u_${Dt};
#endif
`:mt==="define-instanced"?Qt==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Dt}0;
in vec4 a_${Dt}1;
in vec4 a_${Dt}2;
in vec4 a_${Dt}3;
#else
uniform ${St} ${It} u_${Dt};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${St} ${Gt} a_${Dt};
#else
uniform ${St} ${It} u_${Dt};
#endif
`:mt==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Dt}
    ${St} ${It} ${Dt} = a_${Dt};
#endif
`:Qt==="vec4"?`
#ifndef HAS_UNIFORM_u_${Dt}
    #ifdef ${Ht}
        ${St} ${It} ${Dt} = ${qt};
    #else
        ${St} ${It} ${Dt} = a_${Dt};
    #endif
#else
    ${St} ${It} ${Dt} = u_${Dt};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Dt}
    #ifdef ${Ht}
        ${St} ${It} ${Dt} = unpack_mix_${Qt}(${qt}, u_${Dt}_t);
    #else
        ${St} ${It} ${Dt} = unpack_mix_${Qt}(a_${Dt}, u_${Dt}_t);
    #endif
#else
    ${St} ${It} ${Dt} = u_${Dt};
#endif
`}),usedDefines:ht,vertexIncludes:st,fragmentIncludes:lt}}class nT{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(d,$,st,lt,ht,pt,mt,St){this.context=d;let It=this.boundPaintVertexBuffers.length!==lt.length;for(let Ht=0;!It&&Ht<lt.length;Ht++)this.boundPaintVertexBuffers[Ht]!==lt[Ht]&&(It=!0);let Dt=this.boundDynamicVertexBuffers.length!==mt.length;for(let Ht=0;!Dt&&Ht<mt.length;Ht++)this.boundDynamicVertexBuffers[Ht]!==mt[Ht]&&(Dt=!0);if(!this.vao||this.boundProgram!==$||this.boundLayoutVertexBuffer!==st||It||Dt||this.boundIndexBuffer!==ht||this.boundVertexOffset!==pt)this.freshBind($,st,lt,ht,pt,mt,St);else{d.bindVertexArrayOES.set(this.vao);for(const Ht of mt)Ht&&(Ht.bind(),St&&Ht.instanceCount&&Ht.setVertexAttribDivisor(d.gl,$,St));ht&&ht.dynamicDraw&&ht.bind()}}freshBind(d,$,st,lt,ht,pt,mt){const St=this.context,It=St.gl;this.vao&&this.destroy(),this.vao=St.gl.createVertexArray(),St.bindVertexArrayOES.set(this.vao),this.boundProgram=d,this.boundLayoutVertexBuffer=$,this.boundPaintVertexBuffers=st,this.boundIndexBuffer=lt,this.boundVertexOffset=ht,this.boundDynamicVertexBuffers=pt,$.enableAttributes(It,d),$.bind(),$.setVertexAttribPointers(It,d,ht);for(const Dt of st)Dt.enableAttributes(It,d),Dt.bind(),Dt.setVertexAttribPointers(It,d,ht);for(const Dt of pt)Dt&&(Dt.enableAttributes(It,d),Dt.bind(),Dt.setVertexAttribPointers(It,d,ht),mt&&Dt.instanceCount&&Dt.setVertexAttribDivisor(It,d,mt));lt&&lt.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function iT(it,d){const $=Math.pow(2,d.canonical.z),st=d.canonical.y;return[new c.ae(0,st/$).toLngLat().lat,new c.ae(0,(st+1)/$).toLngLat().lat]}function sT(it,d,$,st,lt,ht,pt){const mt=it.context,St=mt.gl,It=$.hillshadeFBO;if(!It)return;it.prepareDrawTile();const Dt=it.isTileAffectedByFog(d),Ht=[];it.terrain&&it.terrain.renderingToTexture&&it.emissiveMode==="mrt-fallback"&&Ht.push("USE_MRT1");const Gt=it.getOrCreateProgram("hillshade",{overrideFog:Dt,defines:Ht});mt.activeTexture.set(St.TEXTURE0),St.bindTexture(St.TEXTURE_2D,It.colorAttachment0.get());const qt=((ir,hr,gr,dr)=>{const Ir=gr.paint.get("hillshade-shadow-color"),Tr=gr.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Rr=gr.paint.get("hillshade-highlight-color"),Er=gr.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",vr=gr.paint.get("hillshade-accent-color"),kr=gr.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ur=gr.paint.get("hillshade-emissive-strength");let zr=c.an(gr.paint.get("hillshade-illumination-direction"));if(gr.paint.get("hillshade-illumination-anchor")==="viewport")zr-=ir.transform.angle;else if(ir.style&&ir.style.enable3dLights()&&ir.style.directionalLight){const rn=ir.style.directionalLight.properties.get("direction"),pn=c.d4(rn.x,rn.y,rn.z);zr=c.an(pn[1])}const Jr=!ir.options.moving;return{u_matrix:dr||ir.transform.calculateProjMatrix(hr.tileID.toUnwrapped(),Jr),u_image:0,u_latrange:iT(0,hr.tileID),u_light:[gr.paint.get("hillshade-exaggeration"),zr],u_shadow:Ir.toPremultipliedRenderColor(Tr?null:gr.lut),u_highlight:Rr.toPremultipliedRenderColor(Er?null:gr.lut),u_emissive_strength:Ur,u_accent:vr.toPremultipliedRenderColor(kr?null:gr.lut)}})(it,$,st,it.terrain?d.projMatrix:null);it.uploadCommonUniforms(mt,Gt,d.toUnwrapped());const{tileBoundsBuffer:Qt,tileBoundsIndexBuffer:Zt,tileBoundsSegments:sr}=it.getTileBoundsBuffers($);Gt.draw(it,St.TRIANGLES,lt,ht,pt,Rs.disabled,qt,st.id,Qt,Zt,sr)}function _v(it,d,$){if(!d.needsDEMTextureUpload)return;const st=it.context,lt=st.gl;st.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||it.getTileTexture($.stride);const ht=$.getPixels();d.demTexture?d.demTexture.update(ht,{premultiply:!1}):d.demTexture=new c.T(st,ht,lt.R32F,{premultiply:!1}),d.needsDEMTextureUpload=!1}function oT(it,d,$){const st=it.context,lt=st.gl;if(!d.dem)return;const ht=d.dem;if(st.activeTexture.set(lt.TEXTURE1),_v(it,d,ht),!d.demTexture)return;d.demTexture.bind(lt.NEAREST,lt.CLAMP_TO_EDGE);const pt=ht.dim;st.activeTexture.set(lt.TEXTURE0);let mt=d.hillshadeFBO;if(!mt){const Gt=new c.T(st,{width:pt,height:pt,data:null},lt.RGBA8);Gt.bind(lt.LINEAR,lt.CLAMP_TO_EDGE),mt=d.hillshadeFBO=st.createFramebuffer(pt,pt,1,"renderbuffer"),mt.colorAttachment0.set(Gt.texture)}st.bindFramebuffer.set(mt.framebuffer),st.viewport.set([0,0,pt,pt]);const{tileBoundsBuffer:St,tileBoundsIndexBuffer:It,tileBoundsSegments:Dt}=it.getMercatorTileBoundsBuffers(),Ht=[];it.linearFloatFilteringSupported()&&Ht.push("TERRAIN_DEM_FLOAT_FORMAT"),it.terrain&&it.terrain.renderingToTexture&&it.emissiveMode==="mrt-fallback"&&Ht.push("USE_MRT1"),it.getOrCreateProgram("hillshadePrepare",{defines:Ht}).draw(it,lt.TRIANGLES,as.disabled,Ps.disabled,Bs.unblended,Rs.disabled,((Gt,qt)=>{const Qt=qt.stride,Zt=c.bC();return c.ce(Zt,0,c.al,-c.al,0,0,1),c.br(Zt,Zt,[0,-c.al,0]),{u_matrix:Zt,u_image:1,u_dimension:[Qt,Qt],u_zoom:Gt.overscaledZ}})(d.tileID,ht),$.id,St,It,Dt),d.needsHillshadePrepare=!1}class $a{constructor(d){this.gl=d.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(d){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class aT extends $a{getDefault(){return c.ao.transparent.toNonPremultipliedRenderColor(null)}set(d){const $=this.current;(d.r!==$.r||d.g!==$.g||d.b!==$.b||d.a!==$.a||this.dirty)&&(this.gl.clearColor(d.r,d.g,d.b,d.a),this.current=d,this.dirty=!1)}}class dw extends $a{getDefault(){return 1}set(d){(d!==this.current||this.dirty)&&(this.gl.clearDepth(d),this.current=d,this.dirty=!1)}}class vv extends $a{getDefault(){return 0}set(d){(d!==this.current||this.dirty)&&(this.gl.clearStencil(d),this.current=d,this.dirty=!1)}}class Dx extends $a{getDefault(){return[!0,!0,!0,!0]}set(d){const $=this.current;(d[0]!==$[0]||d[1]!==$[1]||d[2]!==$[2]||d[3]!==$[3]||this.dirty)&&(this.gl.colorMask(d[0],d[1],d[2],d[3]),this.current=d,this.dirty=!1)}}class bv extends $a{getDefault(){return!0}set(d){(d!==this.current||this.dirty)&&(this.gl.depthMask(d),this.current=d,this.dirty=!1)}}class r0 extends $a{getDefault(){return 255}set(d){(d!==this.current||this.dirty)&&(this.gl.stencilMask(d),this.current=d,this.dirty=!1)}}class A0 extends $a{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(d){const $=this.current;(d.func!==$.func||d.ref!==$.ref||d.mask!==$.mask||this.dirty)&&(this.gl.stencilFunc(d.func,d.ref,d.mask),this.current=d,this.dirty=!1)}}class Ey extends $a{getDefault(){const d=this.gl;return[d.KEEP,d.KEEP,d.KEEP]}set(d){const $=this.current;(d[0]!==$[0]||d[1]!==$[1]||d[2]!==$[2]||this.dirty)&&(this.gl.stencilOp(d[0],d[1],d[2]),this.current=d,this.dirty=!1)}}class R0 extends $a{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;d?$.enable($.STENCIL_TEST):$.disable($.STENCIL_TEST),this.current=d,this.dirty=!1}}class pw extends $a{getDefault(){return[0,1]}set(d){const $=this.current;(d[0]!==$[0]||d[1]!==$[1]||this.dirty)&&(this.gl.depthRange(d[0],d[1]),this.current=d,this.dirty=!1)}}class wv extends $a{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;d?$.enable($.DEPTH_TEST):$.disable($.DEPTH_TEST),this.current=d,this.dirty=!1}}class fw extends $a{getDefault(){return this.gl.LESS}set(d){(d!==this.current||this.dirty)&&(this.gl.depthFunc(d),this.current=d,this.dirty=!1)}}class P0 extends $a{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;d?$.enable($.BLEND):$.disable($.BLEND),this.current=d,this.dirty=!1}}class Nx extends $a{getDefault(){const d=this.gl;return[d.ONE,d.ZERO,d.ONE,d.ZERO]}set(d){const $=this.current;(d[0]!==$[0]||d[1]!==$[1]||d[2]!==$[2]||d[3]!==$[3]||this.dirty)&&(this.gl.blendFuncSeparate(d[0],d[1],d[2],d[3]),this.current=d,this.dirty=!1)}}class Lx extends $a{getDefault(){return c.ao.transparent.toNonPremultipliedRenderColor(null)}set(d){const $=this.current;(d.r!==$.r||d.g!==$.g||d.b!==$.b||d.a!==$.a||this.dirty)&&(this.gl.blendColor(d.r,d.g,d.b,d.a),this.current=d,this.dirty=!1)}}class Ev extends $a{getDefault(){return this.gl.FUNC_ADD}set(d){(d!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(d,d),this.current=d,this.dirty=!1)}}class jx extends $a{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;d?$.enable($.CULL_FACE):$.disable($.CULL_FACE),this.current=d,this.dirty=!1}}class Ty extends $a{getDefault(){return this.gl.BACK}set(d){(d!==this.current||this.dirty)&&(this.gl.cullFace(d),this.current=d,this.dirty=!1)}}class mw extends $a{getDefault(){return this.gl.CCW}set(d){(d!==this.current||this.dirty)&&(this.gl.frontFace(d),this.current=d,this.dirty=!1)}}let gw=class extends $a{getDefault(){return null}set(it){(it!==this.current||this.dirty)&&(this.gl.useProgram(it),this.current=it,this.dirty=!1)}};class yw extends $a{getDefault(){return this.gl.TEXTURE0}set(d){(d!==this.current||this.dirty)&&(this.gl.activeTexture(d),this.current=d,this.dirty=!1)}}class I0 extends $a{getDefault(){const d=this.gl;return[0,0,d.drawingBufferWidth,d.drawingBufferHeight]}set(d){const $=this.current;(d[0]!==$[0]||d[1]!==$[1]||d[2]!==$[2]||d[3]!==$[3]||this.dirty)&&(this.gl.viewport(d[0],d[1],d[2],d[3]),this.current=d,this.dirty=!1)}}class xw extends $a{getDefault(){return null}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;$.bindFramebuffer($.FRAMEBUFFER,d),this.current=d,this.dirty=!1}}class lT extends $a{getDefault(){return null}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;$.bindRenderbuffer($.RENDERBUFFER,d),this.current=d,this.dirty=!1}}class cT extends $a{getDefault(){return null}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;$.bindTexture($.TEXTURE_2D,d),this.current=d,this.dirty=!1}}class uT extends $a{getDefault(){return null}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;$.bindBuffer($.ARRAY_BUFFER,d),this.current=d,this.dirty=!1}}class Tv extends $a{getDefault(){return null}set(d){const $=this.gl;$.bindBuffer($.ELEMENT_ARRAY_BUFFER,d),this.current=d,this.dirty=!1}}class Sv extends $a{getDefault(){return null}set(d){this.gl&&(d!==this.current||this.dirty)&&(this.gl.bindVertexArray(d),this.current=d,this.dirty=!1)}}class Cv extends $a{getDefault(){return 4}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;$.pixelStorei($.UNPACK_ALIGNMENT,d),this.current=d,this.dirty=!1}}class Av extends $a{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;$.pixelStorei($.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d),this.current=d,this.dirty=!1}}class _w extends $a{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const $=this.gl;$.pixelStorei($.UNPACK_FLIP_Y_WEBGL,d),this.current=d,this.dirty=!1}}class Ox extends $a{constructor(d,$){super(d),this.context=d,this.parent=$}getDefault(){return null}}class Fx extends Ox{constructor(d,$,st=0){super(d,$),this.attachmentPoint=d.gl.COLOR_ATTACHMENT0+st}setDirty(){this.dirty=!0}set(d){if(d===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const $=this.gl;$.framebufferTexture2D($.FRAMEBUFFER,this.attachmentPoint,$.TEXTURE_2D,d,0),this.current=d,this.dirty=!1}}class k0 extends Ox{attachment(){return this.gl.DEPTH_ATTACHMENT}set(d){if(d===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const $=this.gl;$.framebufferRenderbuffer($.FRAMEBUFFER,this.attachment(),$.RENDERBUFFER,d),this.current=d,this.dirty=!1}}class Sy extends Ox{attachment(){return this.gl.DEPTH_ATTACHMENT}set(d){if(d===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const $=this.gl;$.framebufferTexture2D($.FRAMEBUFFER,this.attachment(),$.TEXTURE_2D,d,0),this.current=d,this.dirty=!1}}class bw extends k0{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const ep=(it,d,$,st)=>({u_matrix:it,u_image0:0,u_image1:1,u_skirt_height:d,u_ground_shadow_factor:$,u_emissive_texture_available:st}),Bx=(it,d,$,st,lt,ht,pt,mt,St,It,Dt,Ht,Gt,qt,Qt,Zt,sr)=>({u_proj_matrix:Float32Array.from(it),u_globe_matrix:d,u_normalize_matrix:Float32Array.from(st),u_merc_matrix:$,u_zoom_transition:lt,u_merc_center:ht,u_image0:0,u_image1:1,u_frustum_tl:pt,u_frustum_tr:mt,u_frustum_br:St,u_frustum_bl:It,u_globe_pos:Dt,u_globe_radius:Ht,u_viewport:Gt,u_grid_matrix:sr?Float32Array.from(sr):new Float32Array(9),u_skirt_height:qt,u_far_z_cutoff:Qt,u_emissive_texture_available:Zt});function Cy(it,d){return it!=null&&d!=null&&!(!it.hasData()||!d.hasData())&&it.demTexture!=null&&d.demTexture!=null&&it.tileID.key!==d.tileID.key}const _f=new class{constructor(){this.operations={}}newMorphing(it,d,$,st,lt){if(it in this.operations){const ht=this.operations[it];ht.to.tileID.key!==$.tileID.key&&(ht.queued=$)}else this.operations[it]={startTime:st,phase:0,duration:lt,from:d,to:$,queued:null}}getMorphValuesForProxy(it){if(!(it in this.operations))return null;const d=this.operations[it];return{from:d.from,to:d.to,phase:d.phase}}update(it){for(const d in this.operations){const $=this.operations[d];for($.phase=(it-$.startTime)/$.duration;$.phase>=1||!this._validOp($);)if(!this._nextOp($,it)){delete this.operations[d];break}}}_nextOp(it,d){return!!it.queued&&(it.from=it.to,it.to=it.queued,it.queued=null,it.phase=0,it.startTime=d,!0)}_validOp(it){return it.from.hasData()&&it.to.hasData()}},zx={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Vx(it,d,$){if(d===0)return 0;const st=d<1&&$===514?.25/d:1;return 6*Math.pow(1.5,22-it)*Math.max(d,1)*st}function Rv(it,d){const $=1<<it.z;return!d&&(it.x===0||it.x===$-1)||it.y===0||it.y===$-1}function M0(it,d){if(!it.style||!it.style.enable3dLights())return;const $=it.context,st=$.gl;$.activeTexture.set(st.TEXTURE1),d?d.bind(st.LINEAR,st.CLAMP_TO_EDGE):it.emptyTexture.bind(st.LINEAR,st.CLAMP_TO_EDGE)}const Ay=it=>({u_matrix:it});function Ry(it,d,$,st,lt){if(lt>0){const ht=c.o.now(),pt=(ht-it.timeAdded)/lt,mt=d?(ht-d.timeAdded)/lt:-1,St=$.getSource(),It=st.coveringZoomLevel({tileSize:St.tileSize,roundZoom:St.roundZoom}),Dt=!d||Math.abs(d.tileID.overscaledZ-It)>Math.abs(it.tileID.overscaledZ-It),Ht=Dt&&it.refreshedUponExpiration?1:c.aA(Dt?pt:1-mt,0,1);return d?{opacity:1,mix:1-Ht,isFading:pt<1}:{opacity:Ht,mix:0,isFading:pt<1}}return{opacity:1,mix:0,isFading:!1}}class Ux extends Xu{constructor(d){const $=hu("mock-dem",{type:"raster-dem",maxzoom:d.transform.maxZoom},d.style.dispatcher,d.style);super("mock-dem",$,!1),$.setEventedParent(this),this._sourceLoaded=!0}_loadTile(d,$){d.state="loaded",$(null)}}class Pv extends Xu{constructor(d){const $=hu("proxy",{type:"geojson",maxzoom:d.transform.maxZoom},d.style.dispatcher,d.style);super("proxy",$,!1),$.setEventedParent(this),this.map=this.getSource().map=d,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(d,$,st){if(d.freezeTileCoverage)return;this.transform=d;const lt=d.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((ht,pt)=>{if(ht[pt.key]="",!this._tiles[pt.key]){const mt=new Ym(pt,this._source.tileSize*pt.overscaleFactor(),d.tileZoom,void 0,void 0,this._source.worldview);mt.state="loaded",this._tiles[pt.key]=mt}return ht},{});for(const ht in this._tiles)ht in lt||(this.freeFBO(ht),this._tiles[ht].unloadVectorData(),delete this._tiles[ht])}freeFBO(d){const $=this.proxyCachedFBO[d];if($!==void 0){const st=Object.values($);this.renderCachePool.push(...st),delete this.proxyCachedFBO[d]}}deallocRenderCache(){this.renderCache.forEach(d=>d.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Iv extends c.aQ{constructor(d,$,st){super(d.overscaledZ,d.wrap,d.canonical.z,d.canonical.x,d.canonical.y),this.proxyTileKey=$,this.projMatrix=st}}class kv extends c.bV{constructor(d,$){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=d,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[st,lt,ht]=function(St){const It=new c.bd,Dt=new c.b0,Ht=131;It.reserve(17161),Dt.reserve(33800);const Gt=c.al/128,qt=c.al+Gt/2,Qt=qt+Gt;for(let sr=-Gt;sr<Qt;sr+=Gt)for(let ir=-Gt;ir<Qt;ir+=Gt){const hr=ir<0||ir>qt||sr<0||sr>qt?24575:0,gr=c.aA(Math.round(ir),0,c.al),dr=c.aA(Math.round(sr),0,c.al);It.emplaceBack(gr+hr,dr)}const Zt=(sr,ir)=>{const hr=ir*Ht+sr;Dt.emplaceBack(hr+1,hr,hr+Ht),Dt.emplaceBack(hr+Ht,hr+Ht+1,hr+1)};for(let sr=1;sr<129;sr++)for(let ir=1;ir<129;ir++)Zt(ir,sr);return[0,129].forEach(sr=>{for(let ir=0;ir<130;ir++)Zt(ir,sr),Zt(sr,ir)}),[It,Dt,32768]}(),pt=d.context;this.gridBuffer=pt.createVertexBuffer(st,c.bf.members),this.gridIndexBuffer=pt.createIndexBuffer(lt),this.gridSegments=c.bg.simpleSegment(0,0,st.length,lt.length),this.gridNoSkirtSegments=c.bg.simpleSegment(0,0,st.length,ht),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Pv($.map),this.orthoMatrix=c.bC(),c.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,c.al,0,c.al,0,1);const mt=pt.gl;this._overlapStencilMode=new Ps({func:mt.GEQUAL,mask:255},0,255,mt.KEEP,mt.KEEP,mt.REPLACE),this._previousZoom=d.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=$,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ux($.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(d){d.on("data",this._onStyleDataEvent.bind(this)),this._style=d,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(d,$,st){if(d&&d.terrain){this._style!==d&&(this.style=d,this._evaluationZoom=void 0);const lt=d.terrain.properties,ht=d.terrain.drapeRenderMode===0,pt=d.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=c.o.now();const mt=d.terrain&&d.terrain.scope,St=lt.get("source"),It=ht?this._mockSourceCache:d.getSourceCache(St,mt);if(!It)return void c.w(`Couldn't find terrain source "${St}".`);if(this.sourceCache=It,this._attenuationRange=d.terrain.getAttenuationRange(),this._exaggeration=pt?this.calculateExaggeration($):lt.get("exaggeration"),!$.projection.requiresDraping&&pt&&this._exaggeration===0)return void this._disable();this.enabled=!0;const Dt=()=>{this.sourceCache.used&&c.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Ht=this.getScaledDemTileSize();this.sourceCache.update($,Ht,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,Dt(),this._initializing=!0),Dt(),$.updateElevation(!0,st),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update($),this._emptyDEMTextureDirty=!0,this._previousZoom=$.zoom}else this._disable()}calculateExaggeration(d){if(this._attenuationRange&&d.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(d.zoom);const $=this._previousCameraAltitude,st=d.getFreeCameraOptions().position.z/d.pixelsPerMeter*d.worldSize;this._previousCameraAltitude=st;const lt=$!=null?st-$:Number.MAX_VALUE;if(Math.abs(lt)<2)return this._exaggeration;const ht=d.zoom,pt=this._style.terrain;if(!this._previousUpdateTimestamp)return pt.getExaggeration(ht);let mt=ht-this._previousZoom;const St=this._previousUpdateTimestamp;let It=ht;this._evaluationZoom!=null&&(It=this._evaluationZoom,Math.abs(ht-It)>.5&&(mt=.5*(ht-It+mt)),mt*lt<0&&(It+=mt)),this._evaluationZoom=It;const Dt=pt.getExaggeration(It),Ht=Dt===pt.getExaggeration(Math.max(0,It-.1));if(Ht&&Math.abs(Dt-this._exaggeration)<.01)return Dt;let Gt=Math.min(.1,.00375*(this._updateTimestamp-St));return(Ht||Dt<.1||Math.abs(mt)<1e-4)&&(Gt=Math.min(.2,4*Gt)),c.ak(this._exaggeration,Dt,Gt)}resetTileLookupCache(d){this._findCoveringTileCache[d]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(d){d.dataType==="source"&&d.coord?this._clearRenderCacheForTile(d.sourceCacheId,d.coord):d.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const d in this._style._mergedSourceCaches)this._style._mergedSourceCaches[d].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(d=>d.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const d=2*this.proxySourceCache.getSource().tileSize;return[d,d]}set useVertexMorphing(d){this._useVertexMorphing=d}updateTileBinding(d){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const $=this.proxySourceCache,st=this.painter.transform;this._initializing&&(this._initializing=st._centerAltitude===0&&this.getAtPointOrZero(c.ae.fromLngLat(st.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const lt=this.proxyCoords=$.getIds().map(St=>{const It=$.getTileByID(St).tileID;return It.projMatrix=st.calculateProjMatrix(It.toUnwrapped()),It});(function(St,It){const Dt=It.transform.pointCoordinate(It.transform.getCameraPoint()),Ht=new c.P(Dt.x,Dt.y);St.sort((Gt,qt)=>{if(qt.overscaledZ-Gt.overscaledZ)return qt.overscaledZ-Gt.overscaledZ;const Qt=new c.P(Gt.canonical.x+(1<<Gt.canonical.z)*Gt.wrap,Gt.canonical.y),Zt=new c.P(qt.canonical.x+(1<<qt.canonical.z)*qt.wrap,qt.canonical.y),sr=Ht.mult(1<<Gt.canonical.z);return sr.x-=.5,sr.y-=.5,sr.distSqr(Qt)-sr.distSqr(Zt)})})(lt,this.painter);const ht=this.proxyToSource||{};this.proxyToSource={},lt.forEach(St=>{this.proxyToSource[St.key]={}}),this.terrainTileForTile={};const pt=this._style._mergedSourceCaches;for(const St in pt){const It=pt[St];if(!It.used||(It!==this.sourceCache&&this.resetTileLookupCache(It.id),this._setupProxiedCoordsForOrtho(It,d[St],ht),It.usedForTerrain))continue;const Dt=d[St];It.getSource().reparseOverscaled&&this._assignTerrainTiles(Dt)}this.proxiedCoords[$.id]=lt.map(St=>new Iv(St,St.key,this.orthoMatrix)),this._assignTerrainTiles(lt),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(ht),this.renderingToTexture=!1;const mt={};this._visibleDemTiles=[];for(const St of this.proxyCoords){const It=this.terrainTileForTile[St.key];if(!It)continue;const Dt=It.tileID.key;Dt in mt||(this._visibleDemTiles.push(It),mt[Dt]=Dt)}}_assignTerrainTiles(d){this._initializing||d.forEach($=>{if(this.terrainTileForTile[$.key])return;const st=this._findTileCoveringTileID($,this.sourceCache);st&&(this.terrainTileForTile[$.key]=st)})}_prepareDEMTextures(){const d=this.painter.context,$=d.gl;for(const st in this.terrainTileForTile){const lt=this.terrainTileForTile[st],ht=lt.dem;!ht||lt.demTexture&&!lt.needsDEMTextureUpload||(d.activeTexture.set($.TEXTURE1),_v(this.painter,lt,ht))}}_prepareDemTileUniforms(d,$,st,lt){if(!$||$.demTexture==null)return!1;const ht=d.tileID.canonical,pt=Math.pow(2,$.tileID.canonical.z-ht.z),mt=lt||"";return st[`u_dem_tl${mt}`]=[ht.x*pt%1,ht.y*pt%1],st[`u_dem_scale${mt}`]=pt,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let d=0;const $=this._visibleDemTiles.reduce((st,lt)=>{if(!lt.dem)return st;const ht=lt.dem.tree.minimums[0];return ht>0&&d++,st+ht},0);return d?$/d:0}_updateEmptyDEMTexture(){const d=this.painter.context,$=d.gl;d.activeTexture.set($.TEXTURE2);const st=this._getLoadedAreaMinimum(),lt=new c.dL({width:1,height:1},new Float32Array([st]));this._emptyDEMTextureDirty=!1;let ht=this._emptyDEMTexture;return ht?ht.update(lt,{premultiply:!1}):ht=this._emptyDEMTexture=new c.T(d,lt,$.R32F,{premultiply:!1}),ht}setupElevationDraw(d,$,st){const lt=this.painter.context,ht=lt.gl,pt={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};pt.u_exaggeration=this.exaggeration();let mt=null,St=null,It=1;if(st&&st.morphing&&this._useVertexMorphing){const qt=st.morphing.srcDemTile,Qt=st.morphing.dstDemTile;It=st.morphing.phase,qt&&Qt&&(this._prepareDemTileUniforms(d,qt,pt,"_prev")&&(St=qt),this._prepareDemTileUniforms(d,Qt,pt)&&(mt=Qt))}const Dt=qt=>qt&&qt.demTexture&&this.painter.linearFloatFilteringSupported()?ht.LINEAR:ht.NEAREST;let Ht=null;var Gt;if(this.enabled?St&&mt?(Ht=mt.demTexture,lt.activeTexture.set(ht.TEXTURE4),St.demTexture.bind(Dt(St),ht.CLAMP_TO_EDGE),pt.u_dem_lerp=It):(mt=this.terrainTileForTile[d.tileID.key],Ht=this._prepareDemTileUniforms(d,mt,pt)?mt.demTexture:this.emptyDEMTexture):Ht=this.emptyDEMTexture,lt.activeTexture.set(ht.TEXTURE2),Ht&&(pt.u_dem_size=(Gt=Ht).size[0]===1?1:Gt.size[0]-2,Ht.bind(Dt(mt),ht.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(st&&st.useDepthForOcclusion,$,pt),st&&st.useMeterToDem&&mt){const qt=(1<<mt.tileID.canonical.z)*c.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;pt.u_meter_to_dem=qt}if(st&&st.labelPlaneMatrixInv&&(pt.u_label_plane_matrix_inv=st.labelPlaneMatrixInv),$.setTerrainUniformValues(lt,pt),this.painter.transform.projection.name==="globe"){const qt=this.globeUniformValues(this.painter.transform,d.tileID.canonical,st&&st.useDenormalizedUpVectorScale);$.setGlobeUniformValues(lt,qt)}}globeUniformValues(d,$,st){const lt=d.projection;return{u_tile_tl_up:lt.upVector($,0,0),u_tile_tr_up:lt.upVector($,c.al,0),u_tile_br_up:lt.upVector($,c.al,c.al),u_tile_bl_up:lt.upVector($,0,c.al),u_tile_up_scale:st?c.dM(1):lt.upVectorScale($,d.center.lat,d.worldSize).metersToTile}}renderToBackBuffer(d){const $=this.painter,st=this.painter.context;d.length!==0&&(st.bindFramebuffer.set(null),st.viewport.set([0,0,$.width,$.height]),$.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(lt,ht,pt,mt,St){if(lt.transform.projection.name==="globe")(function(It,Dt,Ht,Gt,qt){const Qt=It.context,Zt=Qt.gl;let sr,ir;const hr=It.transform,gr=c.dE(It,Qt,hr),dr=(Jr,rn)=>{if(ir===rn)return;const pn=[zx[rn],"PROJECTION_GLOBE_VIEW"];gr&&pn.push("CUSTOM_ANTIALIASING");const Pn=It.isTileAffectedByFog(Jr);sr=It.getOrCreateProgram("globeRaster",{defines:pn,overrideFog:Pn}),ir=rn},Ir=It.colorModeForRenderPass(),Tr=new as(Zt.LEQUAL,as.ReadWrite,It.depthRangeFor3D);_f.update(qt);const Rr=c.dF(hr),Er=[c.aF(hr.center.lng),c.aJ(hr.center.lat)],vr=It.globeSharedBuffers,kr=[hr.width*c.o.devicePixelRatio,hr.height*c.o.devicePixelRatio],Ur=Float32Array.from(hr.globeMatrix),zr={useDenormalizedUpVectorScale:!0};{const Jr=It.transform,rn=Vx(Jr.zoom,Dt.exaggeration(),Dt.sourceCache._source.tileSize);ir=-1;const pn=Zt.TRIANGLES;for(const Pn of Gt){const Kr=Ht.getTile(Pn),jr=Ps.disabled,an=Dt.prevTerrainTileForTile[Pn.key],Xr=Dt.terrainTileForTile[Pn.key];Cy(an,Xr)&&_f.newMorphing(Pn.key,an,Xr,qt,250),M0(It,Kr.emissiveTexture),Qt.activeTexture.set(Zt.TEXTURE0),Kr.texture&&Kr.texture.bind(Zt.LINEAR,Zt.CLAMP_TO_EDGE);const bn=_f.getMorphValuesForProxy(Pn.key),Fn=bn?1:0;bn&&Object.assign(zr,{morphing:{srcDemTile:bn.from,dstDemTile:bn.to,phase:c.dD(bn.phase)}});const Hn=c.dG(Pn.canonical),Ln=c.dH(Hn.getCenter().lat),In=c.dI(Pn.canonical,Hn,Ln,Jr.worldSize/Jr._pixelsPerMercatorPixel),ns=c.bk(c.dJ(Pn.canonical)),_i=It.emissiveMode==="mrt-fallback"?1:0,$n=Bx(Jr.expandedFarZProjMatrix,Ur,Rr,ns,c.aj(Jr.zoom),Er,Jr.frustumCorners.TL,Jr.frustumCorners.TR,Jr.frustumCorners.BR,Jr.frustumCorners.BL,Jr.globeCenterInViewSpace,Jr.globeRadius,kr,rn,Jr._farZ,_i,In);if(dr(Pn,Fn),sr&&(Dt.setupElevationDraw(Kr,sr,zr),It.uploadCommonUniforms(Qt,sr,Pn.toUnwrapped()),vr)){const[qn,ms,Ns]=vr.getGridBuffers(Ln,rn!==0);sr.draw(It,pn,Tr,jr,Ir,Rs.backCCW,$n,"globe_raster",qn,ms,Ns)}}}if(vr&&(It.renderDefaultNorthPole||It.renderDefaultSouthPole)){const Jr=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];gr&&Jr.push("CUSTOM_ANTIALIASING"),sr=It.getOrCreateProgram("globeRaster",{defines:Jr});for(const rn of Gt){const{x:pn,y:Pn,z:Kr}=rn.canonical,jr=Pn===0,an=Pn===(1<<Kr)-1,[Xr,bn,Fn,Hn]=vr.getPoleBuffers(Kr,!1);if(Hn&&(jr||an)){const Ln=Ht.getTile(rn);M0(It,Ln.emissiveTexture),Qt.activeTexture.set(Zt.TEXTURE0),Ln.texture&&Ln.texture.bind(Zt.LINEAR,Zt.CLAMP_TO_EDGE);let In=c.dK(Kr,pn,hr);const ns=c.bk(c.dJ(rn.canonical)),_i=It.emissiveMode==="mrt-fallback"?1:0,$n=(qn,ms)=>qn.draw(It,Zt.TRIANGLES,Tr,Ps.disabled,Ir,Rs.disabled,Bx(hr.expandedFarZProjMatrix,In,In,ns,0,Er,hr.frustumCorners.TL,hr.frustumCorners.TR,hr.frustumCorners.BR,hr.frustumCorners.BL,hr.globeCenterInViewSpace,hr.globeRadius,kr,0,hr._farZ,_i),"globe_pole_raster",ms,Fn,Hn);Dt.setupElevationDraw(Ln,sr,zr),It.uploadCommonUniforms(Qt,sr,rn.toUnwrapped()),jr&&It.renderDefaultNorthPole&&$n(sr,Xr),an&&It.renderDefaultSouthPole&&(In=c.cS(c.bC(),In,[1,-1,1]),$n(sr,bn))}}}})(lt,ht,pt,mt,St);else{const It=lt.context,Dt=It.gl;let Ht,Gt;const qt=lt.shadowRenderer,Qt=Cm(lt,lt.longestCutoffRange),Zt=Ir=>{if(Gt===Ir)return;const Tr=[];Tr.push(zx[Ir]),Qt.shouldRenderCutoff&&Tr.push("RENDER_CUTOFF"),qt&&(Tr.push("RENDER_SHADOWS","DEPTH_TEXTURE"),qt.useNormalOffset&&Tr.push("NORMAL_OFFSET")),Ht=lt.getOrCreateProgram("terrainRaster",{defines:Tr}),Gt=Ir},sr=lt.colorModeForRenderPass(),ir=new as(Dt.LEQUAL,as.ReadWrite,lt.depthRangeFor3D);_f.update(St);const hr=lt.transform,gr=Vx(hr.zoom,ht.exaggeration(),ht.sourceCache._source.tileSize);let dr=[0,0,0];if(qt){const Ir=lt.style.directionalLight,Tr=lt.style.ambientLight;Ir&&Tr&&(dr=Jp(lt.style,Ir,Tr))}{Gt=-1;const Ir=Dt.TRIANGLES,[Tr,Rr]=[ht.gridIndexBuffer,ht.gridSegments];for(const Er of mt){const vr=pt.getTile(Er),kr=Ps.disabled,Ur=ht.prevTerrainTileForTile[Er.key],zr=ht.terrainTileForTile[Er.key];Cy(Ur,zr)&&_f.newMorphing(Er.key,Ur,zr,St,250),M0(lt,vr.emissiveTexture),It.activeTexture.set(Dt.TEXTURE0),vr.texture&&vr.texture.bind(Dt.LINEAR,Dt.CLAMP_TO_EDGE);const Jr=_f.getMorphValuesForProxy(Er.key),rn=Jr?1:0;let pn;Jr&&(pn={morphing:{srcDemTile:Jr.from,dstDemTile:Jr.to,phase:c.dD(Jr.phase)}});const Pn=lt.emissiveMode==="mrt-fallback"?1:0,Kr=ep(Er.projMatrix,Rv(Er.canonical,hr.renderWorldCopies)?gr/10:gr,dr,Pn);if(Zt(rn),!Ht)continue;ht.setupElevationDraw(vr,Ht,pn);const jr=Er.toUnwrapped();qt&&qt.setupShadows(jr,Ht),lt.uploadCommonUniforms(It,Ht,jr,null,Qt),Ht.draw(lt,Ir,ir,kr,sr,Rs.backCCW,Kr,"terrain_raster",ht.gridBuffer,Tr,Rr)}}}}($,this,this.proxySourceCache,d,this._updateTimestamp),this.renderingToTexture=!0,$.gpuTimingDeferredRenderEnd(),d.splice(0,d.length))}renderBatch(d){if(this._drapedRenderBatches.length===0)return d+1;this.renderingToTexture=!0;const $=this.painter,st=this.painter.context,lt=this.proxySourceCache,ht=this.proxiedCoords[lt.id],pt=this._drapedRenderBatches.shift(),mt=$.style.order,St=[];this._updateFBOs($.emissiveMode==="mrt-fallback");let It=0;for(const Dt of ht){const Ht=lt.getTileByID(Dt.proxyTileKey),Gt=lt.proxyCachedFBO[Dt.key]?lt.proxyCachedFBO[Dt.key][d]:void 0,qt=Gt!==void 0?lt.renderCache[Gt]:this.pool[It++],Qt=Gt!==void 0;if(Ht.texture=qt.tex,Ht.emissiveTexture=qt.emissiveTex,Qt&&!qt.dirty){St.push(Ht.tileID);continue}st.bindFramebuffer.set(qt.fb.framebuffer);const Zt=st.gl;let sr;Zt.drawBuffers($.emissiveMode==="mrt-fallback"?[Zt.COLOR_ATTACHMENT0,Zt.COLOR_ATTACHMENT1]:[Zt.COLOR_ATTACHMENT0]),this.renderedToTile=!1,qt.dirty&&(st.clear({color:c.ao.transparent,stencil:0}),qt.dirty=!1);for(let ir=pt.start;ir<=pt.end;++ir){const hr=$.style._mergedLayers[mt[ir]];if(hr.isHidden($.transform.zoom))continue;const gr=$.style.getLayerSourceCache(hr),dr=gr?this.proxyToSource[Dt.key][gr.id]:[Dt];if(!dr)continue;const Ir=dr;st.viewport.set([0,0,qt.fb.width,qt.fb.height]),sr!==(gr?gr.id:null)&&(this._setupStencil(qt,dr,hr,gr),sr=gr?gr.id:null),$.renderLayer($,gr,hr,Ir)}if(Zt.drawBuffers([Zt.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const ir of this._pendingGroundEffectLayers){const hr=$.style._mergedLayers[mt[ir]];if(hr.isHidden($.transform.zoom))continue;const gr=$.style.getLayerSourceCache(hr),dr=gr?this.proxyToSource[Dt.key][gr.id]:[Dt];if(!dr)continue;const Ir=dr;st.viewport.set([0,0,qt.fb.width,qt.fb.height]),sr!==(gr?gr.id:null)&&(this._setupStencil(qt,dr,hr,gr),sr=gr?gr.id:null),$.renderLayer($,gr,hr,Ir)}this.renderedToTile?(qt.dirty=!0,St.push(Ht.tileID)):Qt||--It,It===5&&(It=0,this.renderToBackBuffer(St))}return this.renderToBackBuffer(St),this.renderingToTexture=!1,st.bindFramebuffer.set(null),st.viewport.set([0,0,$.width,$.height]),pt.end+1}postRender(){}isLayerOrderingCorrect(d){const $=d.order.length;let st=-1,lt=$;for(let ht=0;ht<$;++ht)this._style.isLayerDraped(d._mergedLayers[d.order[ht]])?st=Math.max(st,ht):lt=Math.min(lt,ht);return lt>st}getMinElevationBelowMSL(){let d=0;return this._visibleDemTiles.filter($=>$.dem).forEach($=>{d=Math.min(d,$.dem.tree.minimums[0])}),d===0?d:(d-30)*this._exaggeration}raycast(d,$,st){if(!this._visibleDemTiles)return null;const lt=this._visibleDemTiles.filter(ht=>ht.dem).map(ht=>{const pt=ht.tileID,mt=1<<pt.overscaledZ,{x:St,y:It}=pt.canonical,Dt=St/mt,Ht=(St+1)/mt,Gt=It/mt,qt=(It+1)/mt;return{minx:Dt,miny:Gt,maxx:Ht,maxy:qt,t:ht.dem.tree.raycastRoot(Dt,Gt,Ht,qt,d,$,st),tile:ht}});lt.sort((ht,pt)=>(ht.t!==null?ht.t:Number.MAX_VALUE)-(pt.t!==null?pt.t:Number.MAX_VALUE));for(const ht of lt){if(ht.t==null)return null;const pt=ht.tile.dem.tree.raycast(ht.minx,ht.miny,ht.maxx,ht.maxy,d,$,st);if(pt!=null)return pt}return null}_createFBO(){const d=this.painter.context,$=d.gl,st=this.drapeBufferSize;d.activeTexture.set($.TEXTURE0);const lt=new c.T(d,{width:st[0],height:st[1],data:null},$.RGBA8);lt.bind($.LINEAR,$.CLAMP_TO_EDGE);const ht=d.createFramebuffer(st[0],st[1],1,null);let pt;return ht.colorAttachment0.set(lt.texture),this._emissiveTexture&&(pt=new c.T(d,{width:st[0],height:st[1],data:null},$.R8),pt.bind($.LINEAR,$.CLAMP_TO_EDGE),ht.createColorAttachment(d,1),ht.colorAttachment1.set(pt.texture)),ht.depthAttachment=new bw(d,ht.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=d.createRenderbuffer(d.gl.DEPTH_STENCIL,st[0],st[1]),this._stencilRef=0,ht.depthAttachment.set(this._sharedDepthStencil),d.clear({stencil:0})):ht.depthAttachment.set(this._sharedDepthStencil),d.extTextureFilterAnisotropic&&$.texParameterf($.TEXTURE_2D,d.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,d.extTextureFilterAnisotropicMax),{fb:ht,tex:lt,emissiveTex:pt,dirty:!1}}_updateFBOs(d){if(this._emissiveTexture!==d){for(const $ of this.pool)this._updateFBO($,d);for(const $ of this.proxySourceCache.renderCache)this._updateFBO($,d);this._emissiveTexture=d}}_updateFBO(d,$){const st=d.fb,lt=this.painter.context,ht=lt.gl,pt=this.drapeBufferSize;if($){const mt=new c.T(lt,{width:pt[0],height:pt[1],data:null},ht.R8);mt.bind(ht.LINEAR,ht.CLAMP_TO_EDGE),d.emissiveTex=mt,st.createColorAttachment(lt,1),st.colorAttachment1.set(mt.texture)}else d.emissiveTex=void 0,st.removeColorAttachment(lt,1);d.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d].hasTransition())return!0;return this._style.order.some(d=>{const $=this._style._mergedLayers[d],st=$.isHidden(this.painter.transform.zoom);return $.type==="hillshade"||$.type==="custom"?!st&&$.shouldRedrape():!st&&$.hasTransition()})}_clearLineLayersFromRenderCache(){let d=!1;for(const st of this._style.getSources())if(st instanceof Km){d=!0;break}if(!d)return;const $={};for(let st=0;st<this._style.order.length;++st){const lt=this._style._mergedLayers[this._style.order[st]],ht=this._style.getLayerSourceCache(lt);if(!ht||$[ht.id]||lt.isHidden(this.painter.transform.zoom)||lt.type!=="line")continue;const pt=lt.widthExpression(),mt=lt.emissiveStrengthExpression();if(pt instanceof c.ad||mt instanceof c.ad){$[ht.id]=!0;for(const St of this.proxyCoords){const It=this.proxyToSource[St.key][ht.id];if(It)for(const Dt of It)this._clearRenderCacheForTile(ht.id,Dt)}}}}_clearRasterLayersFromRenderCache(){let d=!1;for(const st in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[st]._source instanceof mu){d=!0;break}if(!d)return;const $={};for(let st=0;st<this._style.order.length;++st){const lt=this._style._mergedLayers[this._style.order[st]],ht=this._style.getLayerSourceCache(lt);if(!ht||$[ht.id]||lt.isHidden(this.painter.transform.zoom)||lt.type!=="raster")continue;const pt=lt.paint.get("raster-fade-duration");for(const mt of this.proxyCoords){const St=this.proxyToSource[mt.key][ht.id];if(St)for(const It of St){const Dt=Ry(ht.getTile(It),ht.findLoadedParent(It,0),ht,this.painter.transform,pt);(Dt.opacity!==1||Dt.mix!==0)&&this._clearRenderCacheForTile(ht.id,It)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const d=this._style.order,$=d.length;if($===0)return;const st=[];this._pendingGroundEffectLayers=[];let lt,ht=0,pt=this._style._mergedLayers[d[ht]];for(;!this._style.isLayerDraped(pt)&&pt.isHidden(this.painter.transform.zoom)&&++ht<$;)pt=this._style._mergedLayers[d[ht]];for(;ht<$;++ht){const mt=this._style._mergedLayers[d[ht]];mt.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(mt)?lt===void 0&&(lt=ht):(mt.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(ht),lt!==void 0&&(st.push({start:lt,end:ht-1}),lt=void 0)))}if(lt!==void 0&&st.push({start:lt,end:ht-1}),st.length!==0){const mt=st[st.length-1];this._pendingGroundEffectLayers.every(St=>St>mt.end)||c.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=st}_setupRenderCache(d){const $=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,$.renderCache.length>$.renderCachePool.length){const pt=Object.values($.proxyCachedFBO);$.proxyCachedFBO={};for(let mt=0;mt<pt.length;++mt){const St=Object.values(pt[mt]);$.renderCachePool.push(...St)}}return}this._clearRasterLayersFromRenderCache();const st=this.proxyCoords,lt=this._tilesDirty;for(let pt=st.length-1;pt>=0;pt--){const mt=st[pt];if($.getTileByID(mt.key),$.proxyCachedFBO[mt.key]!==void 0){const St=d[mt.key],It=this.proxyToSource[mt.key];let Dt=0;for(const Ht in It){const Gt=It[Ht],qt=St[Ht];if(!qt||qt.length!==Gt.length||Gt.some((Qt,Zt)=>Qt!==qt[Zt]||lt[Ht]&&lt[Ht].hasOwnProperty(Qt.key))){Dt=-1;break}++Dt}for(const Ht in $.proxyCachedFBO[mt.key])$.renderCache[$.proxyCachedFBO[mt.key][Ht]].dirty=Dt<0||Dt!==Object.values(St).length}}const ht=[...this._drapedRenderBatches];ht.sort((pt,mt)=>mt.end-mt.start-(pt.end-pt.start));for(const pt of ht)for(const mt of st){if($.proxyCachedFBO[mt.key])continue;let St=$.renderCachePool.pop();St===void 0&&$.renderCache.length<50&&(St=$.renderCache.length,$.renderCache.push(this._createFBO())),St!==void 0&&($.proxyCachedFBO[mt.key]={},$.proxyCachedFBO[mt.key][pt.start]=St,$.renderCache[St].dirty=!0)}this._tilesDirty={}}_setupStencil(d,$,st,lt){if(!lt||!this._sourceTilesOverlap[lt.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const ht=this.painter.context,pt=ht.gl;if($.length<=1)return void(this._overlapStencilType=!1);let mt;if(st.isTileClipped())mt=$.length,this._overlapStencilMode.test={func:pt.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!($[0].overscaledZ>$[$.length-1].overscaledZ))return void(this._overlapStencilType=!1);mt=1,this._overlapStencilMode.test={func:pt.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+mt>255&&(ht.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=mt,this._overlapStencilMode.ref=this._stencilRef,st.isTileClipped()&&this._renderTileClippingMasks($,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(d){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[d.key]),this._overlapStencilMode):Ps.disabled}_renderTileClippingMasks(d,$){const st=this.painter,lt=this.painter.context,ht=lt.gl;st._tileClippingMaskIDs={},lt.setColorMode(Bs.disabled),lt.setDepthMode(as.disabled);const pt=st.getOrCreateProgram("clippingMask");for(const mt of d){const St=st._tileClippingMaskIDs[mt.key]=--$;pt.draw(st,ht.TRIANGLES,as.disabled,new Ps({func:ht.ALWAYS,mask:0},St,255,ht.KEEP,ht.KEEP,ht.REPLACE),Bs.disabled,Rs.disabled,Ay(mt.projMatrix),"$clipping",st.tileExtentBuffer,st.quadTriangleIndexBuffer,st.tileExtentSegments)}}pointCoordinate(d){const $=this.painter.transform;if(d.x<0||d.x>$.width||d.y<0||d.y>$.height)return null;const st=[d.x,d.y,1,1];c.aC(st,st,$.pixelMatrixInverse),c.cK(st,st,1/st[3]),st[0]/=$.worldSize,st[1]/=$.worldSize;const lt=$._camera.position,ht=c.cf(1,$.center.lat),pt=[lt[0],lt[1],lt[2]/ht,0],mt=c.da([],st.slice(0,3),pt);c.aw(mt,mt);const St=this.raycast(pt,mt,this._exaggeration);return St!==null&&St?(c.bH(pt,pt,mt,St),pt[3]=pt[2],pt[2]*=ht,pt):null}_setupProxiedCoordsForOrtho(d,$,st){if(d.getSource()instanceof c.aU)return this._setupProxiedCoordsForImageSource(d,$,st);this._findCoveringTileCache[d.id]=this._findCoveringTileCache[d.id]||{};const lt=this.proxiedCoords[d.id]=[],ht=this.proxyCoords;for(let St=0;St<ht.length;St++){const It=ht[St],Dt=this._findTileCoveringTileID(It,d);if(Dt){const Ht=this._createProxiedId(It,Dt,st[It.key]&&st[It.key][d.id]);lt.push(Ht),this.proxyToSource[It.key][d.id]=[Ht]}}let pt=!1;const mt=new Set;for(let St=0;St<$.length;St++){const It=d.getTile($[St]);if(!It||!It.hasData())continue;const Dt=this._findTileCoveringTileID(It.tileID,this.proxySourceCache);if(Dt&&Dt.tileID.canonical.z!==It.tileID.canonical.z){const Ht=this.proxyToSource[Dt.tileID.key][d.id],Gt=this._createProxiedId(Dt.tileID,It,st[Dt.tileID.key]&&st[Dt.tileID.key][d.id]);Ht?Ht.splice(Ht.length-1,0,Gt):this.proxyToSource[Dt.tileID.key][d.id]=[Gt];const qt=this.proxyToSource[Dt.tileID.key][d.id];mt.has(qt)||mt.add(qt),lt.push(Gt),pt=!0}}if(this._sourceTilesOverlap[d.id]=pt,pt&&this._debugParams.sortTilesHiZFirst)for(const St of mt)St.sort((It,Dt)=>Dt.overscaledZ-It.overscaledZ)}_setupProxiedCoordsForImageSource(d,$,st){if(!d.getSource().loaded())return;const lt=this.proxiedCoords[d.id]=[],ht=this.proxyCoords,pt=d.getSource(),mt=pt.tileID;if(!mt)return;const St=new c.P(mt.x,mt.y)._div(1<<mt.z),It=pt.coordinates.map(c.ae.fromLngLat).reduce((Ht,Gt)=>(Ht.min.x=Math.min(Ht.min.x,Gt.x-St.x),Ht.min.y=Math.min(Ht.min.y,Gt.y-St.y),Ht.max.x=Math.max(Ht.max.x,Gt.x-St.x),Ht.max.y=Math.max(Ht.max.y,Gt.y-St.y),Ht),{min:new c.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new c.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),Dt=(Ht,Gt)=>{const qt=Ht.wrap+Ht.canonical.x/(1<<Ht.canonical.z),Qt=Ht.canonical.y/(1<<Ht.canonical.z),Zt=c.al/(1<<Ht.canonical.z),sr=Gt.wrap+Gt.canonical.x/(1<<Gt.canonical.z),ir=Gt.canonical.y/(1<<Gt.canonical.z);return qt+Zt<sr+It.min.x||qt>sr+It.max.x||Qt+Zt<ir+It.min.y||Qt>ir+It.max.y};for(let Ht=0;Ht<ht.length;Ht++){const Gt=ht[Ht];for(let qt=0;qt<$.length;qt++){const Qt=d.getTile($[qt]);if(!Qt||!Qt.hasData()||Dt(Gt,Qt.tileID))continue;const Zt=this._createProxiedId(Gt,Qt,st[Gt.key]&&st[Gt.key][d.id]),sr=this.proxyToSource[Gt.key][d.id];sr?sr.push(Zt):this.proxyToSource[Gt.key][d.id]=[Zt],lt.push(Zt)}}}_createProxiedId(d,$,st){let lt=this.orthoMatrix;if(st){const ht=st.find(pt=>pt.key===$.tileID.key);if(ht)return ht}if($.tileID.key!==d.key){const ht=d.canonical.z-$.tileID.canonical.z;let pt,mt,St;lt=c.bC();const It=$.tileID.wrap-d.wrap<<d.overscaledZ;ht>0?(pt=c.al>>ht,mt=pt*(($.tileID.canonical.x<<ht)-d.canonical.x+It),St=pt*(($.tileID.canonical.y<<ht)-d.canonical.y)):(pt=c.al<<-ht,mt=c.al*($.tileID.canonical.x-(d.canonical.x+It<<-ht)),St=c.al*($.tileID.canonical.y-(d.canonical.y<<-ht))),c.ce(lt,0,pt,0,pt,0,1),c.br(lt,lt,[mt,St,0])}return new Iv($.tileID,d.key,lt)}_findTileCoveringTileID(d,$){let st=$.getTile(d);if(st&&st.hasData())return st;const lt=this._findCoveringTileCache[$.id],ht=lt[d.key];if(st=ht?$.getTileByID(ht):null,st&&st.hasData()||ht===null)return st;let pt=st?st.tileID:d,mt=pt.overscaledZ;const St=$.getSource().minzoom,It=[];if(!ht){const Ht=$.getSource().maxzoom;if(d.canonical.z>=Ht){const Gt=d.canonical.z-Ht;$.getSource().reparseOverscaled?(mt=Math.max(d.canonical.z+2,$.transform.tileZoom),pt=new c.aQ(mt,d.wrap,Ht,d.canonical.x>>Gt,d.canonical.y>>Gt)):Gt!==0&&(mt=Ht,pt=new c.aQ(mt,d.wrap,Ht,d.canonical.x>>Gt,d.canonical.y>>Gt))}pt.key!==d.key&&(It.push(pt.key),st=$.getTile(pt))}const Dt=Ht=>{It.forEach(Gt=>{lt[Gt]=Ht}),It.length=0};for(mt-=1;mt>=St&&(!st||!st.hasData());mt--){st&&Dt(st.tileID.key);const Ht=pt.calculateScaledKey(mt);if(st=$.getTileByID(Ht),st&&st.hasData())break;const Gt=lt[Ht];if(Gt===null)break;Gt===void 0?It.push(Ht):st=$.getTileByID(Gt)}return Dt(st?st.tileID.key:null),st&&st.hasData()?st:null}findDEMTileFor(d){return this.enabled?this._findTileCoveringTileID(d,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(d,$){let st=this._tilesDirty[d];st||(st=this._tilesDirty[d]={}),st[$.key]=!0}}function D0(it,d,$){const st=function(mt,St,It){const Dt=c.bJ(St,mt),Ht=c.bJ(It,[.2126,.7152,.0722]),Gt=(Qt,Zt,sr)=>(1-sr)*Qt+sr*Zt,qt=Gt(1-.3*Math.min(Ht,1),1,Math.min(Dt+1,1));return Gt(.92,1,Math.asin(c.aA(St[2],-1,1))/Math.PI+.5)*qt}(it,[0,0,1],d),lt=[0,0,0];c.c5(lt,$.slice(0,3),st);const ht=[0,0,0];c.c5(ht,d.slice(0,3),it[2]);const pt=[0,0,0];return c.d8(pt,lt,ht),c.db(pt)}const hT=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],dT=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class ww{static cacheKey(d,$,st,lt){const ht=[$];lt&&ht.push(lt.cacheKey);for(const pt of st)d.usedDefines.has(pt)&&ht.push(pt);return ht.join("/")}constructor(d,$,st,lt,ht,pt){const mt=d.gl;this.program=mt.createProgram(),this.configuration=lt,this.name=$,this.fixedDefines=[...pt];const St=`#version 300 es
${(lt?lt.defines():[]).concat(pt.map(Zt=>`#define ${Zt}`)).join(`
`)}`,It=[St,rT];for(const Zt of st.fragmentIncludes)It.push(Im[Zt]);It.push(st.fragmentSource);const Dt=It.join(`
`),Ht=[St,hw];for(const Zt of st.vertexIncludes)Ht.push(Im[Zt]);this.forceManualRenderingForInstanceIDShaders=d.forceManualRenderingForInstanceIDShaders&&st.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&Ht.push("uniform int u_instanceID;"),Ht.push(st.vertexSource);let Gt=Ht.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(Gt=Gt.replaceAll("gl_InstanceID","u_instanceID"));const qt=mt.createShader(mt.FRAGMENT_SHADER);if(mt.isContextLost())return void(this.failedToCreate=!0);mt.shaderSource(qt,Dt),mt.compileShader(qt),mt.attachShader(this.program,qt);const Qt=mt.createShader(mt.VERTEX_SHADER);mt.isContextLost()?this.failedToCreate=!0:(mt.shaderSource(Qt,Gt),mt.compileShader(Qt),mt.attachShader(this.program,Qt),this.attributes={},mt.linkProgram(this.program),mt.deleteShader(Qt),mt.deleteShader(qt),this.fixedUniforms=ht(d),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=lt?lt.getUniforms(d):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Zt=>({u_instanceID:new c.ch(Zt)}))(d)),(pt.includes("TERRAIN")||$.includes("symbol")||$.includes("circle"))&&(this.terrainUniforms=(Zt=>({u_dem:new c.ch(Zt),u_dem_prev:new c.ch(Zt),u_dem_tl:new c.ck(Zt),u_dem_scale:new c.cj(Zt),u_dem_tl_prev:new c.ck(Zt),u_dem_scale_prev:new c.cj(Zt),u_dem_size:new c.cj(Zt),u_dem_lerp:new c.cj(Zt),u_exaggeration:new c.cj(Zt),u_depth:new c.ch(Zt),u_depth_size_inv:new c.ck(Zt),u_depth_range_unpack:new c.ck(Zt),u_occluder_half_size:new c.cj(Zt),u_occlusion_depth_offset:new c.cj(Zt),u_meter_to_dem:new c.cj(Zt),u_label_plane_matrix_inv:new c.cl(Zt)}))(d)),pt.includes("GLOBE")&&(this.globeUniforms=(Zt=>({u_tile_tl_up:new c.ci(Zt),u_tile_tr_up:new c.ci(Zt),u_tile_br_up:new c.ci(Zt),u_tile_bl_up:new c.ci(Zt),u_tile_up_scale:new c.cj(Zt)}))(d)),pt.includes("FOG")&&(this.fogUniforms=(Zt=>({u_fog_matrix:new c.cl(Zt),u_fog_range:new c.ck(Zt),u_fog_color:new c.d3(Zt),u_fog_horizon_blend:new c.cj(Zt),u_fog_vertical_limit:new c.ck(Zt),u_fog_temporal_offset:new c.cj(Zt),u_frustum_tl:new c.ci(Zt),u_frustum_tr:new c.ci(Zt),u_frustum_br:new c.ci(Zt),u_frustum_bl:new c.ci(Zt),u_globe_pos:new c.ci(Zt),u_globe_radius:new c.cj(Zt),u_globe_transition:new c.cj(Zt),u_is_globe:new c.ch(Zt),u_viewport:new c.ck(Zt)}))(d)),pt.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Zt=>({u_cutoff_params:new c.d3(Zt)}))(d)),pt.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Zt=>({u_lighting_ambient_color:new c.ci(Zt),u_lighting_directional_dir:new c.ci(Zt),u_lighting_directional_color:new c.ci(Zt),u_ground_radiance:new c.ci(Zt)}))(d)),pt.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Zt=>({u_light_matrix_0:new c.cl(Zt),u_light_matrix_1:new c.cl(Zt),u_fade_range:new c.ck(Zt),u_shadow_normal_offset:new c.ci(Zt),u_shadow_intensity:new c.cj(Zt),u_shadow_texel_size:new c.cj(Zt),u_shadow_map_resolution:new c.cj(Zt),u_shadow_direction:new c.ci(Zt),u_shadow_bias:new c.ci(Zt),u_shadowmap_0:new c.ch(Zt),u_shadowmap_1:new c.ch(Zt)}))(d)))}getAttributeLocation(d,$){let st=this.attributes[$];return st===void 0&&(st=this.attributes[$]=d.getAttribLocation(this.program,$)),st}setTerrainUniformValues(d,$){if(!this.terrainUniforms)return;const st=this.terrainUniforms;if(!this.failedToCreate){d.program.set(this.program);for(const lt in $)st[lt]&&st[lt].set(this.program,lt,$[lt])}}setGlobeUniformValues(d,$){if(!this.globeUniforms)return;const st=this.globeUniforms;if(!this.failedToCreate){d.program.set(this.program);for(const lt in $)st[lt]&&st[lt].set(this.program,lt,$[lt])}}setFogUniformValues(d,$){if(!this.fogUniforms)return;const st=this.fogUniforms;if(!this.failedToCreate){d.program.set(this.program);for(const lt in $)st[lt].set(this.program,lt,$[lt])}}setCutoffUniformValues(d,$){if(!this.cutoffUniforms)return;const st=this.cutoffUniforms;if(!this.failedToCreate){d.program.set(this.program);for(const lt in $)st[lt].set(this.program,lt,$[lt])}}setLightsUniformValues(d,$){if(!this.lightsUniforms)return;const st=this.lightsUniforms;if(!this.failedToCreate){d.program.set(this.program);for(const lt in $)st[lt].set(this.program,lt,$[lt])}}setShadowUniformValues(d,$){if(this.failedToCreate||!this.shadowUniforms)return;const st=this.shadowUniforms;d.program.set(this.program);for(const lt in $)st[lt].set(this.program,lt,$[lt])}_drawDebugWireframe(d,$,st,lt,ht,pt,mt,St,It,Dt){const Ht=d.options.wireframe;if(Ht.terrain===!1&&Ht.layers2D===!1&&Ht.layers3D===!1)return;const Gt=d.context;if(!(!(!Ht.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Ht.layers2D||d._terrain&&d._terrain.renderingToTexture||!hT.includes(this.name))||!(!Ht.layers3D||!dT.includes(this.name))))return;const qt=Gt.gl,Qt=d.wireframeDebugCache.getLinesFromTrianglesBuffer(d.frameCounter,ht,Gt);if(!Qt)return;const Zt=[...this.fixedDefines,"DEBUG_WIREFRAME"],sr=d.getOrCreateProgram(this.name,{config:this.configuration,defines:Zt});Gt.program.set(sr.program);const ir=(dr,Ir,Tr)=>{if(Ir[dr]&&Tr[dr])for(const Rr in Ir[dr])Tr[dr][Rr]&&Tr[dr][Rr].set(Tr.program,Rr,Ir[dr][Rr].current)};It&&It.setUniforms(sr.program,Gt,sr.binderUniforms,mt,{zoom:St}),ir("fixedUniforms",this,sr),ir("terrainUniforms",this,sr),ir("globeUniforms",this,sr),ir("fogUniforms",this,sr),ir("lightsUniforms",this,sr),ir("shadowUniforms",this,sr),Qt.bind(),Gt.setColorMode(new Bs([qt.ONE,qt.ONE_MINUS_SRC_ALPHA,qt.ZERO,qt.ONE],c.ao.transparent,[!0,!0,!0,!1])),Gt.setDepthMode(new as($.func===qt.LESS?qt.LEQUAL:$.func,as.ReadOnly,$.range)),Gt.setStencilMode(Ps.disabled);const hr=3*pt.primitiveLength*2,gr=3*pt.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const dr=Dt||1;for(let Ir=0;Ir<dr;++Ir)sr.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ir),qt.drawElements(qt.LINES,hr,qt.UNSIGNED_SHORT,gr)}else Dt&&Dt>1?qt.drawElementsInstanced(qt.LINES,hr,qt.UNSIGNED_SHORT,gr,Dt):qt.drawElements(qt.LINES,hr,qt.UNSIGNED_SHORT,gr);ht.bind(),Gt.program.set(this.program),Gt.setDepthMode($),Gt.setStencilMode(st),Gt.setColorMode(lt)}checkUniforms(d,$,st){if(this.fixedDefines.includes($)){for(const lt of Object.keys(st))if(!st[lt].initialized)throw new Error(`Program '${this.name}', from draw '${d}': uniform ${lt} not set but required by ${$} being defined`)}}draw(d,$,st,lt,ht,pt,mt,St,It,Dt,Ht,Gt,qt,Qt,Zt,sr){const ir=d.context,hr=ir.gl;if(this.failedToCreate)return;ir.program.set(this.program),ir.setDepthMode(st),ir.setStencilMode(lt),ir.setColorMode(ht),ir.setCullFace(pt);for(const[Er,vr]of this.fixedUniformsEntries)vr.set(this.program,Er,mt[Er]);Qt&&Qt.setUniforms(this.program,ir,this.binderUniforms,Gt,{zoom:qt});const gr={[hr.POINTS]:1,[hr.LINES]:2,[hr.TRIANGLES]:3,[hr.LINE_STRIP]:1}[$];this.checkUniforms(St,"RENDER_SHADOWS",this.shadowUniforms);const dr=Zt||[],Ir=Qt?Qt.getPaintVertexBuffers():[],Tr=$===hr.TRIANGLES&&Dt,Rr=sr&&sr>0?1:void 0;for(const Er of Ht.get()){const vr=Er.vaos||(Er.vaos={});if((vr[St]||(vr[St]=new nT)).bind(ir,this,It,Ir,Dt,Er.vertexOffset,dr,Rr),this.forceManualRenderingForInstanceIDShaders){const kr=sr||1;for(let Ur=0;Ur<kr;++Ur)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ur),Dt?hr.drawElements($,Er.primitiveLength*gr,hr.UNSIGNED_SHORT,Er.primitiveOffset*gr*2):hr.drawArrays($,Er.vertexOffset,Er.vertexLength)}else sr&&sr>1?hr.drawElementsInstanced($,Er.primitiveLength*gr,hr.UNSIGNED_SHORT,Er.primitiveOffset*gr*2,sr):Dt?hr.drawElements($,Er.primitiveLength*gr,hr.UNSIGNED_SHORT,Er.primitiveOffset*gr*2):hr.drawArrays($,Er.vertexOffset,Er.vertexLength);Tr&&this._drawDebugWireframe(d,st,lt,ht,Dt,Er,Gt,qt,Qt,sr)}}}function Ew(it,d,$=0){const st=Math.pow(2,d.tileID.overscaledZ),lt=d.tileSize*Math.pow(2,it.transform.tileZoom)/st,ht=lt*(d.tileID.canonical.x+d.tileID.wrap*st),pt=lt*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture?d.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/c.ay(d,1,it.transform.tileZoom),u_pixel_coord_upper:[ht>>16,pt>>16],u_pixel_coord_lower:[65535&ht,65535&pt],u_pattern_transition:$}}const $x={terrain:0,flat:1},pT=c.bC(),Gx=(it,d,$,st,lt,ht,pt,mt,St,It,Dt,Ht,Gt,qt,Qt,Zt,sr,ir)=>{const hr=d.style.light,gr=hr.properties.get("position"),dr=[gr.x,gr.y,gr.z],Ir=c.dO();hr.properties.get("anchor")==="viewport"&&(c.dP(Ir,-d.transform.angle),c.dQ(dr,dr,Ir));const Tr=hr.properties.get("color").toPremultipliedRenderColor(null),Rr=d.transform,Er={u_matrix:it,u_lightpos:dr,u_lightintensity:hr.properties.get("intensity"),u_lightcolor:[Tr.r,Tr.g,Tr.b],u_vertical_gradient:+$,u_opacity:st,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:pT,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:$x[It],u_base_type:$x[Dt],u_ao:lt,u_edge_radius:ht,u_width_scale:pt,u_flood_light_color:Qt,u_vertical_scale:Zt,u_flood_light_intensity:sr,u_ground_shadow_factor:ir};return Rr.projection.name==="globe"&&(Er.u_tile_id=[mt.canonical.x,mt.canonical.y,1<<mt.canonical.z],Er.u_zoom_transition=Ht,Er.u_inv_rot_matrix=qt,Er.u_merc_center=Gt,Er.u_up_dir=Rr.projection.upVector(new c.cD(0,0,0),Gt[0]*c.al,Gt[1]*c.al),Er.u_height_lift=St),Er},Mv=(it,d,$,st,lt,ht)=>({u_matrix:it,u_edge_radius:d,u_width_scale:$,u_vertical_scale:st,u_height_type:$x[lt],u_base_type:$x[ht]}),Tw=(it,d,$,st,lt,ht,pt,mt,St,It,Dt,Ht,Gt,qt,Qt,Zt,sr,ir)=>{const hr=Gx(it,d,$,st,lt,ht,pt,mt,It,Dt,Ht,Gt,qt,Qt,Zt,sr,1,[0,0,0]),gr={u_height_factor:-Math.pow(2,mt.overscaledZ)/St.tileSize/8};return Object.assign(hr,Ew(d,St,ir),gr)},N0=(it,d,$,st,lt,ht,pt,mt,St,It,Dt)=>({u_matrix:d,u_opacity:$,u_ao_pass:st?1:0,u_meter_to_tile:lt,u_ao:ht,u_flood_light_intensity:pt,u_flood_light_color:mt,u_attenuation:St,u_edge_radius:It,u_fb:0,u_fb_size:Dt,u_dynamic_offset:1}),Dv=(it,d,$)=>({u_matrix:it,u_emissive_strength:d,u_ground_shadow_factor:$}),Nv=(it,d,$,st,lt,ht=0)=>Object.assign(Dv(it,d,lt),Ew($,st,ht)),Sw=(it,d,$,st)=>({u_matrix:it,u_world:$,u_emissive_strength:d,u_ground_shadow_factor:st}),Lv=(it,d,$,st,lt,ht,pt=0)=>Object.assign(Nv(it,d,$,st,ht,pt),{u_world:lt}),Mm=(it,d)=>({u_matrix:it,u_ground_shadow_factor:d}),n0=(it,d,$,st,lt)=>({u_matrix:it,u_camera_pos:[d[0],d[1],d[2]],u_depth_bias:$,u_height_scale:st,u_reset_depth:lt}),Hx=(it,d,$,st,lt,ht,pt,mt,St)=>({u_matrix:it,u_normal_matrix:d,u_opacity:$,u_faux_facade_ao_intensity:st,u_camera_pos:lt,u_tile_to_meter:ht,u_facade_emissive_chance:pt,u_flood_light_color:mt,u_flood_light_intensity:St}),Cw=it=>({u_matrix:it}),Dm=it=>({u_matrix:it}),jv=(it,d,$,st,lt,ht,pt,mt)=>{const St=c.al/ht.tileSize;return{u_matrix:it,u_inv_rot_matrix:d,u_camera_to_center_distance:$.getCameraToCenterDistance(mt),u_extrude_scale:[$.pixelsToGLUnits[0]/St,$.pixelsToGLUnits[1]/St],u_zoom_transition:st,u_tile_id:pt,u_merc_center:lt}},Py=(it,d,$=1)=>({u_matrix:it,u_color:d,u_overlay:0,u_overlay_scale:$}),Aw=c.bC(),Rw=(it,d,$,st,lt,ht,pt)=>{const mt=it.transform,St=mt.projection.name==="globe",It=St?c.dR(mt.zoom,d.canonical)*mt._pixelsPerMercatorPixel:c.ay($,1,ht),Dt={u_matrix:d.projMatrix,u_extrude_scale:It,u_intensity:pt,u_inv_rot_matrix:Aw,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(St){Dt.u_inv_rot_matrix=st,Dt.u_merc_center=lt,Dt.u_tile_id=[d.canonical.x,d.canonical.y,1<<d.canonical.z],Dt.u_zoom_transition=c.aj(mt.zoom);const Ht=lt[0]*c.al,Gt=lt[1]*c.al;Dt.u_up_dir=mt.projection.upVector(new c.cD(0,0,0),Ht,Gt)}return Dt};function Wx(it,[d,$,st,lt],[ht,pt]){if(ht===pt)return[0,0,0,0];const mt=255*(it-1)/(it*(pt-ht));return[d*mt,$*mt,st*mt,lt*mt]}function qx(it,d,[$,st]){return $===st?0:.5/it+(d-$)*(it-1)/(it*(st-$))}const Pw=(it,d,$,st,lt,ht,pt,mt,St,It,Dt,Ht,Gt,qt,Qt,Zt,sr,ir,hr,gr,dr)=>({u_matrix:it,u_normalize_matrix:d,u_globe_matrix:$,u_merc_matrix:st,u_grid_matrix:lt,u_tl_parent:ht,u_scale_parent:It,u_fade_t:Dt.mix,u_opacity:Dt.opacity*Ht.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Ht.paint.get("raster-brightness-min"),u_brightness_high:Ht.paint.get("raster-brightness-max"),u_saturation_factor:c.dT(Ht.paint.get("raster-saturation")),u_contrast_factor:c.dS(Ht.paint.get("raster-contrast")),u_spin_weights:Iw(Ht.paint.get("raster-hue-rotate")),u_perspective_transform:Gt,u_raster_elevation:qt,u_zoom_transition:pt,u_merc_center:mt,u_cutoff_params:St,u_colorization_mix:Wx(c.dU,Zt,ir),u_colorization_offset:qx(c.dU,sr,ir),u_color_ramp:Qt,u_texture_offset:[gr/(hr+2*gr),hr/(hr+2*gr)],u_texture_res:[hr+2*gr,hr+2*gr],u_emissive_strength:dr});function Iw(it){it*=Math.PI/180;const d=Math.sin(it),$=Math.cos(it);return[(2*$+1)/3,(-Math.sqrt(3)*d-$+1)/3,(Math.sqrt(3)*d-$+1)/3]}const Vp=.05,fT=(it,d,$,st,lt,ht,pt,mt,St,It,Dt,Ht)=>({u_matrix:it,u_normalize_matrix:d,u_globe_matrix:$,u_merc_matrix:st,u_grid_matrix:lt,u_tl_parent:ht,u_scale_parent:It,u_fade_t:Dt.mix,u_opacity:Dt.opacity,u_image0:0,u_image1:1,u_raster_elevation:Ht,u_zoom_transition:pt,u_merc_center:mt,u_cutoff_params:St}),mT=(it,d,$,st,lt,ht,pt,mt,St,It)=>({u_particle_texture:it,u_particle_texture_side_len:d,u_tile_offset:$,u_velocity:st,u_color_ramp:ht,u_velocity_res:lt,u_max_speed:pt,u_uv_offset:mt,u_data_scale:[255*St[0],255*St[1]],u_data_offset:It,u_particle_pos_scale:1.1,u_particle_pos_offset:[Vp,Vp]}),kw=(it,d,$,st,lt,ht,pt,mt,St,It)=>({u_particle_texture:it,u_particle_texture_side_len:d,u_velocity:$,u_velocity_res:st,u_max_speed:lt,u_speed_factor:ht,u_reset_rate:pt,u_rand_seed:Math.random(),u_uv_offset:mt,u_data_scale:[255*St[0],255*St[1]],u_data_offset:It,u_particle_pos_scale:1.1,u_particle_pos_offset:[Vp,Vp]}),Mw=c.bC(),Kx=(it,d,$,st,lt,ht,pt,mt,St,It,Dt,Ht,Gt,qt,Qt,Zt,sr,ir,hr,gr,dr,Ir,Tr,Rr)=>{const Er=lt.transform,vr={u_is_size_zoom_constant:+(it==="constant"||it==="source"),u_is_size_feature_constant:+(it==="constant"||it==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:Er.getCameraToCenterDistance(hr),u_rotate_symbol:+$,u_aspect_ratio:Er.width/Er.height,u_fade_change:lt.options.fadeDuration?lt.symbolFadeChange:1,u_matrix:ht,u_label_plane_matrix:pt,u_coord_matrix:mt,u_is_text:+It,u_elevation_from_sea:St?1:0,u_pitch_with_map:+st,u_texsize:Dt,u_texsize_icon:Ht,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Mw,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Mw,u_up_vector:[0,-1,0],u_color_adj_mat:Ir,u_icon_transition:Tr||0,u_gamma_scale:st?lt.transform.getCameraToCenterDistance(hr)*Math.cos(lt.terrain?0:lt.transform._pitch):1,u_device_pixel_ratio:c.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Rr||1,u_ground_shadow_factor:gr,u_inv_matrix:c.bl(c.bC(),pt),u_normal_scale:dr,u_lutTexture:gu.LUT};return hr.name==="globe"&&(vr.u_tile_id=[qt.canonical.x,qt.canonical.y,1<<qt.canonical.z],vr.u_zoom_transition=Qt,vr.u_inv_rot_matrix=sr,vr.u_merc_center=Zt,vr.u_camera_forward=Er._camera.forward(),vr.u_ecef_origin=c.dV(Er.globeMatrix,qt.toUnwrapped()),vr.u_tile_matrix=Float32Array.from(Er.globeMatrix),vr.u_up_vector=ir),vr},Iy=(it,d,$,st)=>({u_matrix:it,u_emissive_strength:d,u_opacity:$,u_color:st}),Nm=(it,d,$,st,lt,ht,pt,mt,St)=>Object.assign(function(It,Dt,Ht,Gt,qt,Qt){const{width:Zt,height:sr}=Gt.imageManager.getPixelSize(Dt),ir=Math.pow(2,Qt.tileID.overscaledZ),hr=Qt.tileSize*Math.pow(2,Gt.transform.tileZoom)/ir,gr=hr*(Qt.tileID.canonical.x+Qt.tileID.wrap*ir),dr=hr*Qt.tileID.canonical.y;return{u_image:0,u_pattern_tl:Ht.tl,u_pattern_br:Ht.br,u_texsize:[Zt,sr],u_pattern_size:Ht.displaySize,u_pattern_units_to_pixels:qt?[Gt.transform.width,-1*Gt.transform.height]:[1/c.ay(Qt,1,Gt.transform.tileZoom),1/c.ay(Qt,1,Gt.transform.tileZoom)],u_pixel_coord_upper:[gr>>16,dr>>16],u_pixel_coord_lower:[65535&gr,65535&dr]}}(0,ht,pt,st,mt,St),{u_matrix:it,u_emissive_strength:d,u_opacity:$}),L0=new Float32Array(c.bA([])),i0=(it,d,$,st,lt,ht,pt,mt,St,It,Dt,Ht,Gt,qt=[0,0,0],Qt,Zt,sr)=>{const ir=lt.style.light,hr=ir.properties.get("position"),gr=[-hr.x,-hr.y,hr.z],dr=c.dO();ir.properties.get("anchor")==="viewport"&&(c.dP(dr,-lt.transform.angle),c.dQ(gr,gr,dr));const Ir=Dt.alphaMode==="MASK",Tr=ir.properties.get("color").toNonPremultipliedRenderColor(null),Rr=Gt.paint.get("model-ambient-occlusion-intensity"),Er=Gt.paint.get("model-color").constantOr(c.ao.white).toNonPremultipliedRenderColor(null);return Er.a=Gt.paint.get("model-color-mix-intensity").constantOr(0),sr&&(Er.r=sr[0],Er.g=sr[1],Er.b=sr[2],Er.a=sr[3]),Zt&&(Er.r=Zt.color.r,Er.g=Zt.color.g,Er.b=Zt.color.b,Er.a=Zt.colorMix,Ht=Zt.emissionStrength,ht*=Zt.opacity),{u_matrix:it,u_lighting_matrix:d,u_normal_matrix:$,u_node_matrix:st||L0,u_lightpos:gr,u_lightintensity:ir.properties.get("intensity"),u_lightcolor:[Tr.r,Tr.g,Tr.b],u_camera_pos:qt,u_opacity:ht,u_baseTextureIsAlpha:0,u_alphaMask:+Ir,u_alphaCutoff:Dt.alphaCutoff,u_baseColorFactor:pt.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:mt.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:St,u_roughnessFactor:It,u_baseColorTexture:gu.BaseColor,u_metallicRoughnessTexture:gu.MetallicRoughness,u_normalTexture:gu.Normal,u_occlusionTexture:gu.Occlusion,u_emissionTexture:gu.Emission,u_lutTexture:gu.LUT,u_color_mix:Er.toArray01(),u_aoIntensity:Rr,u_emissive_strength:Ht,u_occlusionTextureTransform:Qt||[0,0,0,0]}},Ov=(it,d=L0,$=L0)=>({u_matrix:it,u_instance:d,u_node_matrix:$}),Xx={fillExtrusion:it=>({u_matrix:new c.cl(it),u_lightpos:new c.ci(it),u_lightintensity:new c.cj(it),u_lightcolor:new c.ci(it),u_vertical_gradient:new c.cj(it),u_opacity:new c.cj(it),u_edge_radius:new c.cj(it),u_width_scale:new c.cj(it),u_ao:new c.ck(it),u_height_type:new c.ch(it),u_base_type:new c.ch(it),u_tile_id:new c.ci(it),u_zoom_transition:new c.cj(it),u_inv_rot_matrix:new c.cl(it),u_merc_center:new c.ck(it),u_up_dir:new c.ci(it),u_height_lift:new c.cj(it),u_flood_light_color:new c.ci(it),u_vertical_scale:new c.cj(it),u_flood_light_intensity:new c.cj(it),u_ground_shadow_factor:new c.ci(it)}),fillExtrusionDepth:it=>({u_matrix:new c.cl(it),u_edge_radius:new c.cj(it),u_width_scale:new c.cj(it),u_vertical_scale:new c.cj(it),u_height_type:new c.ch(it),u_base_type:new c.ch(it)}),fillExtrusionPattern:it=>({u_matrix:new c.cl(it),u_lightpos:new c.ci(it),u_lightintensity:new c.cj(it),u_lightcolor:new c.ci(it),u_vertical_gradient:new c.cj(it),u_height_factor:new c.cj(it),u_edge_radius:new c.cj(it),u_width_scale:new c.cj(it),u_ao:new c.ck(it),u_height_type:new c.ch(it),u_base_type:new c.ch(it),u_tile_id:new c.ci(it),u_zoom_transition:new c.cj(it),u_inv_rot_matrix:new c.cl(it),u_merc_center:new c.ck(it),u_up_dir:new c.ci(it),u_height_lift:new c.cj(it),u_image:new c.ch(it),u_texsize:new c.ck(it),u_pixel_coord_upper:new c.ck(it),u_pixel_coord_lower:new c.ck(it),u_tile_units_to_pixels:new c.cj(it),u_opacity:new c.cj(it),u_pattern_transition:new c.cj(it)}),fillExtrusionGroundEffect:it=>({u_matrix:new c.cl(it),u_opacity:new c.cj(it),u_ao_pass:new c.cj(it),u_meter_to_tile:new c.cj(it),u_ao:new c.ck(it),u_flood_light_intensity:new c.cj(it),u_flood_light_color:new c.ci(it),u_attenuation:new c.cj(it),u_edge_radius:new c.cj(it),u_fb:new c.ch(it),u_fb_size:new c.cj(it),u_dynamic_offset:new c.cj(it)}),fill:it=>({u_matrix:new c.cl(it),u_emissive_strength:new c.cj(it),u_ground_shadow_factor:new c.ci(it)}),fillPattern:it=>({u_matrix:new c.cl(it),u_emissive_strength:new c.cj(it),u_image:new c.ch(it),u_texsize:new c.ck(it),u_pixel_coord_upper:new c.ck(it),u_pixel_coord_lower:new c.ck(it),u_tile_units_to_pixels:new c.cj(it),u_ground_shadow_factor:new c.ci(it),u_pattern_transition:new c.cj(it)}),fillOutline:it=>({u_matrix:new c.cl(it),u_emissive_strength:new c.cj(it),u_world:new c.ck(it),u_ground_shadow_factor:new c.ci(it)}),fillOutlinePattern:it=>({u_matrix:new c.cl(it),u_emissive_strength:new c.cj(it),u_world:new c.ck(it),u_image:new c.ch(it),u_texsize:new c.ck(it),u_pixel_coord_upper:new c.ck(it),u_pixel_coord_lower:new c.ck(it),u_tile_units_to_pixels:new c.cj(it),u_ground_shadow_factor:new c.ci(it),u_pattern_transition:new c.cj(it)}),building:it=>({u_matrix:new c.cl(it),u_normal_matrix:new c.cl(it),u_opacity:new c.cj(it),u_faux_facade_ao_intensity:new c.cj(it),u_camera_pos:new c.ci(it),u_tile_to_meter:new c.cj(it),u_facade_emissive_chance:new c.cj(it),u_flood_light_color:new c.ci(it),u_flood_light_intensity:new c.cj(it)}),buildingBloom:it=>({u_matrix:new c.cl(it)}),buildingDepth:it=>({u_matrix:new c.cl(it)}),elevatedStructuresDepth:it=>({u_matrix:new c.cl(it),u_depth_bias:new c.cj(it)}),elevatedStructures:it=>({u_matrix:new c.cl(it),u_ground_shadow_factor:new c.ci(it)}),elevatedStructuresDepthReconstruct:it=>({u_matrix:new c.cl(it),u_camera_pos:new c.ci(it),u_depth_bias:new c.cj(it),u_height_scale:new c.cj(it),u_reset_depth:new c.cj(it)}),circle:c.dY,collisionBox:it=>({u_matrix:new c.cl(it),u_inv_rot_matrix:new c.cl(it),u_camera_to_center_distance:new c.cj(it),u_extrude_scale:new c.ck(it),u_zoom_transition:new c.cj(it),u_merc_center:new c.ck(it),u_tile_id:new c.ci(it)}),collisionCircle:it=>({u_matrix:new c.cl(it),u_inv_matrix:new c.cl(it),u_camera_to_center_distance:new c.cj(it),u_viewport_size:new c.ck(it)}),debug:it=>({u_color:new c.dB(it),u_matrix:new c.cl(it),u_overlay:new c.ch(it),u_overlay_scale:new c.cj(it)}),clippingMask:it=>({u_matrix:new c.cl(it)}),heatmap:it=>({u_extrude_scale:new c.cj(it),u_intensity:new c.cj(it),u_matrix:new c.cl(it),u_inv_rot_matrix:new c.cl(it),u_merc_center:new c.ck(it),u_tile_id:new c.ci(it),u_zoom_transition:new c.cj(it),u_up_dir:new c.ci(it)}),heatmapTexture:it=>({u_image:new c.ch(it),u_color_ramp:new c.ch(it),u_opacity:new c.cj(it)}),hillshade:it=>({u_matrix:new c.cl(it),u_image:new c.ch(it),u_latrange:new c.ck(it),u_light:new c.ck(it),u_shadow:new c.dB(it),u_highlight:new c.dB(it),u_emissive_strength:new c.cj(it),u_accent:new c.dB(it)}),hillshadePrepare:it=>({u_matrix:new c.cl(it),u_image:new c.ch(it),u_dimension:new c.ck(it),u_zoom:new c.cj(it)}),line:c.dX,linePattern:c.dW,raster:it=>({u_matrix:new c.cl(it),u_normalize_matrix:new c.cl(it),u_globe_matrix:new c.cl(it),u_merc_matrix:new c.cl(it),u_grid_matrix:new c.dC(it),u_tl_parent:new c.ck(it),u_scale_parent:new c.cj(it),u_fade_t:new c.cj(it),u_opacity:new c.cj(it),u_image0:new c.ch(it),u_image1:new c.ch(it),u_brightness_low:new c.cj(it),u_brightness_high:new c.cj(it),u_saturation_factor:new c.cj(it),u_contrast_factor:new c.cj(it),u_spin_weights:new c.ci(it),u_perspective_transform:new c.ck(it),u_raster_elevation:new c.cj(it),u_zoom_transition:new c.cj(it),u_merc_center:new c.ck(it),u_cutoff_params:new c.d3(it),u_colorization_mix:new c.d3(it),u_colorization_offset:new c.cj(it),u_color_ramp:new c.ch(it),u_texture_offset:new c.ck(it),u_texture_res:new c.ck(it),u_emissive_strength:new c.cj(it)}),rasterParticle:it=>({u_matrix:new c.cl(it),u_normalize_matrix:new c.cl(it),u_globe_matrix:new c.cl(it),u_merc_matrix:new c.cl(it),u_grid_matrix:new c.dC(it),u_tl_parent:new c.ck(it),u_scale_parent:new c.cj(it),u_fade_t:new c.cj(it),u_opacity:new c.cj(it),u_image0:new c.ch(it),u_image1:new c.ch(it),u_raster_elevation:new c.cj(it),u_zoom_transition:new c.cj(it),u_merc_center:new c.ck(it),u_cutoff_params:new c.d3(it)}),rasterParticleTexture:it=>({u_texture:new c.ch(it),u_opacity:new c.cj(it)}),rasterParticleDraw:it=>({u_particle_texture:new c.ch(it),u_particle_texture_side_len:new c.cj(it),u_tile_offset:new c.ck(it),u_velocity:new c.ch(it),u_color_ramp:new c.ch(it),u_velocity_res:new c.ck(it),u_max_speed:new c.cj(it),u_uv_offset:new c.ck(it),u_data_scale:new c.ck(it),u_data_offset:new c.cj(it),u_particle_pos_scale:new c.cj(it),u_particle_pos_offset:new c.ck(it)}),rasterParticleUpdate:it=>({u_particle_texture:new c.ch(it),u_particle_texture_side_len:new c.cj(it),u_velocity:new c.ch(it),u_velocity_res:new c.ck(it),u_max_speed:new c.cj(it),u_speed_factor:new c.cj(it),u_reset_rate:new c.cj(it),u_rand_seed:new c.cj(it),u_uv_offset:new c.ck(it),u_data_scale:new c.ck(it),u_data_offset:new c.cj(it),u_particle_pos_scale:new c.cj(it),u_particle_pos_offset:new c.ck(it)}),symbol:it=>({u_is_size_zoom_constant:new c.ch(it),u_is_size_feature_constant:new c.ch(it),u_size_t:new c.cj(it),u_size:new c.cj(it),u_camera_to_center_distance:new c.cj(it),u_rotate_symbol:new c.ch(it),u_aspect_ratio:new c.cj(it),u_fade_change:new c.cj(it),u_matrix:new c.cl(it),u_label_plane_matrix:new c.cl(it),u_coord_matrix:new c.cl(it),u_is_text:new c.ch(it),u_elevation_from_sea:new c.ch(it),u_pitch_with_map:new c.ch(it),u_texsize:new c.ck(it),u_texsize_icon:new c.ck(it),u_texture:new c.ch(it),u_texture_icon:new c.ch(it),u_gamma_scale:new c.cj(it),u_device_pixel_ratio:new c.cj(it),u_tile_id:new c.ci(it),u_zoom_transition:new c.cj(it),u_inv_rot_matrix:new c.cl(it),u_merc_center:new c.ck(it),u_camera_forward:new c.ci(it),u_tile_matrix:new c.cl(it),u_up_vector:new c.ci(it),u_ecef_origin:new c.ci(it),u_is_halo:new c.ch(it),u_icon_transition:new c.cj(it),u_color_adj_mat:new c.cl(it),u_scale_factor:new c.cj(it),u_ground_shadow_factor:new c.ci(it),u_inv_matrix:new c.cl(it),u_normal_scale:new c.cj(it),u_lutTexture:new c.ch(it)}),background:it=>({u_matrix:new c.cl(it),u_emissive_strength:new c.cj(it),u_opacity:new c.cj(it),u_color:new c.dB(it)}),backgroundPattern:it=>({u_matrix:new c.cl(it),u_emissive_strength:new c.cj(it),u_opacity:new c.cj(it),u_image:new c.ch(it),u_pattern_tl:new c.ck(it),u_pattern_br:new c.ck(it),u_texsize:new c.ck(it),u_pattern_size:new c.ck(it),u_pixel_coord_upper:new c.ck(it),u_pixel_coord_lower:new c.ck(it),u_pattern_units_to_pixels:new c.ck(it)}),terrainRaster:it=>({u_matrix:new c.cl(it),u_image0:new c.ch(it),u_image1:new c.ch(it),u_skirt_height:new c.cj(it),u_ground_shadow_factor:new c.ci(it),u_emissive_texture_available:new c.cj(it)}),skybox:it=>({u_matrix:new c.cl(it),u_sun_direction:new c.ci(it),u_cubemap:new c.ch(it),u_opacity:new c.cj(it),u_temporal_offset:new c.cj(it)}),skyboxGradient:it=>({u_matrix:new c.cl(it),u_color_ramp:new c.ch(it),u_center_direction:new c.ci(it),u_radius:new c.cj(it),u_opacity:new c.cj(it),u_temporal_offset:new c.cj(it)}),skyboxCapture:it=>({u_matrix_3f:new c.dC(it),u_sun_direction:new c.ci(it),u_sun_intensity:new c.cj(it),u_color_tint_r:new c.d3(it),u_color_tint_m:new c.d3(it),u_luminance:new c.cj(it)}),globeRaster:it=>({u_proj_matrix:new c.cl(it),u_globe_matrix:new c.cl(it),u_normalize_matrix:new c.cl(it),u_merc_matrix:new c.cl(it),u_zoom_transition:new c.cj(it),u_merc_center:new c.ck(it),u_image0:new c.ch(it),u_image1:new c.ch(it),u_grid_matrix:new c.dC(it),u_skirt_height:new c.cj(it),u_far_z_cutoff:new c.cj(it),u_frustum_tl:new c.ci(it),u_frustum_tr:new c.ci(it),u_frustum_br:new c.ci(it),u_frustum_bl:new c.ci(it),u_globe_pos:new c.ci(it),u_globe_radius:new c.cj(it),u_viewport:new c.ck(it),u_emissive_texture_available:new c.cj(it)}),globeAtmosphere:it=>({u_frustum_tl:new c.ci(it),u_frustum_tr:new c.ci(it),u_frustum_br:new c.ci(it),u_frustum_bl:new c.ci(it),u_horizon:new c.cj(it),u_transition:new c.cj(it),u_fadeout_range:new c.cj(it),u_atmosphere_fog_color:new c.d3(it),u_high_color:new c.d3(it),u_space_color:new c.d3(it),u_temporal_offset:new c.cj(it),u_horizon_angle:new c.cj(it)}),model:it=>({u_matrix:new c.cl(it),u_lighting_matrix:new c.cl(it),u_normal_matrix:new c.cl(it),u_node_matrix:new c.cl(it),u_lightpos:new c.ci(it),u_lightintensity:new c.cj(it),u_lightcolor:new c.ci(it),u_camera_pos:new c.ci(it),u_opacity:new c.cj(it),u_baseColorFactor:new c.d3(it),u_emissiveFactor:new c.d3(it),u_metallicFactor:new c.cj(it),u_roughnessFactor:new c.cj(it),u_baseTextureIsAlpha:new c.ch(it),u_alphaMask:new c.ch(it),u_alphaCutoff:new c.cj(it),u_baseColorTexture:new c.ch(it),u_metallicRoughnessTexture:new c.ch(it),u_normalTexture:new c.ch(it),u_occlusionTexture:new c.ch(it),u_emissionTexture:new c.ch(it),u_lutTexture:new c.ch(it),u_color_mix:new c.d3(it),u_aoIntensity:new c.cj(it),u_emissive_strength:new c.cj(it),u_occlusionTextureTransform:new c.d3(it)}),modelDepth:it=>({u_matrix:new c.cl(it),u_instance:new c.cl(it),u_node_matrix:new c.cl(it)}),groundShadow:it=>({u_matrix:new c.cl(it),u_ground_shadow_factor:new c.ci(it)}),stars:it=>({u_matrix:new c.cl(it),u_up:new c.ci(it),u_right:new c.ci(it),u_intensity_multiplier:new c.cj(it)}),snowParticle:it=>({u_modelview:new c.cl(it),u_projection:new c.cl(it),u_time:new c.cj(it),u_cam_pos:new c.ci(it),u_velocityConeAperture:new c.cj(it),u_velocity:new c.cj(it),u_horizontalOscillationRadius:new c.cj(it),u_horizontalOscillationRate:new c.cj(it),u_boxSize:new c.cj(it),u_billboardSize:new c.cj(it),u_simpleShapeParameters:new c.ck(it),u_screenSize:new c.ck(it),u_thinningCenterPos:new c.ck(it),u_thinningShape:new c.ci(it),u_thinningAffectedRatio:new c.cj(it),u_thinningParticleOffset:new c.cj(it),u_particleColor:new c.d3(it),u_direction:new c.ci(it)}),rainParticle:it=>({u_modelview:new c.cl(it),u_projection:new c.cl(it),u_time:new c.cj(it),u_cam_pos:new c.ci(it),u_texScreen:new c.ch(it),u_velocityConeAperture:new c.cj(it),u_velocity:new c.cj(it),u_boxSize:new c.cj(it),u_rainDropletSize:new c.ck(it),u_distortionStrength:new c.cj(it),u_rainDirection:new c.ci(it),u_color:new c.d3(it),u_screenSize:new c.ck(it),u_thinningCenterPos:new c.ck(it),u_thinningShape:new c.ci(it),u_thinningAffectedRatio:new c.cj(it),u_thinningParticleOffset:new c.cj(it),u_shapeDirectionalPower:new c.cj(it),u_shapeNormalPower:new c.cj(it),u_mode:new c.cj(it)}),vignette:it=>({u_vignetteShape:new c.ci(it),u_vignetteColor:new c.d3(it)}),occlusion:it=>({u_matrix:new c.cl(it),u_anchorPos:new c.ci(it),u_screenSizePx:new c.ck(it),u_occluderSizePx:new c.ck(it),u_color:new c.d3(it)})};class Ap{constructor(d,$,st,lt){this.id=Ap.uniqueIdxCounter,Ap.uniqueIdxCounter++,this.context=d;const ht=d.gl;this.buffer=ht.createBuffer(),this.dynamicDraw=!!st,this.context.unbindVAO(),d.bindElementBuffer.set(this.buffer),ht.bufferData(ht.ELEMENT_ARRAY_BUFFER,$.arrayBuffer,this.dynamicDraw?ht.DYNAMIC_DRAW:ht.STATIC_DRAW),this.dynamicDraw||lt||$.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(d){this.id=Ap.uniqueIdxCounter,Ap.uniqueIdxCounter++;const $=this.context.gl;this.context.unbindVAO(),this.bind(),$.bufferSubData($.ELEMENT_ARRAY_BUFFER,0,d.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ap.uniqueIdxCounter=0;const Fv={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Dw{constructor(d,$,st,lt,ht,pt){this.length=$.length,this.attributes=st,this.itemSize=$.bytesPerElement,this.dynamicDraw=lt,this.instanceCount=pt,this.context=d;const mt=d.gl;this.buffer=mt.createBuffer(),d.bindVertexBuffer.set(this.buffer),mt.bufferData(mt.ARRAY_BUFFER,$.arrayBuffer,this.dynamicDraw?mt.DYNAMIC_DRAW:mt.STATIC_DRAW),this.dynamicDraw||ht||$.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(d){const $=this.context.gl;this.bind(),$.bufferSubData($.ARRAY_BUFFER,0,d.arrayBuffer)}enableAttributes(d,$){for(let st=0;st<this.attributes.length;st++){const lt=$.getAttributeLocation(d,this.attributes[st].name);lt!==-1&&d.enableVertexAttribArray(lt)}}setVertexAttribPointers(d,$,st){for(let lt=0;lt<this.attributes.length;lt++){const ht=this.attributes[lt],pt=$.getAttributeLocation(d,ht.name);pt!==-1&&d.vertexAttribPointer(pt,ht.components,d[Fv[ht.type]],!1,this.itemSize,ht.offset+this.itemSize*(st||0))}}setVertexAttribDivisor(d,$,st){for(let lt=0;lt<this.attributes.length;lt++){const ht=$.getAttributeLocation(d,this.attributes[lt].name);ht!==-1&&this.instanceCount&&this.instanceCount>0&&d.vertexAttribDivisor(ht,st)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Nw{constructor(d,$,st,lt,ht){this.context=d,this.width=$,this.height=st;const pt=this.framebuffer=d.gl.createFramebuffer();lt>0&&(this.colorAttachment0=new Fx(d,pt,0)),lt>1&&(this.colorAttachment1=new Fx(d,pt,1)),ht&&(this.depthAttachmentType=ht,this.depthAttachment=ht==="renderbuffer"?new k0(d,pt):new Sy(d,pt))}createColorAttachment(d,$){$===0?this.colorAttachment0=new Fx(d,this.framebuffer,0):$===1&&(this.colorAttachment1=new Fx(d,this.framebuffer,1))}removeColorAttachment(d,$){const st=this.context.gl;let lt;$===0?(lt=this.colorAttachment0.get(),this.colorAttachment0=void 0):$===1&&(lt=this.colorAttachment1.get(),this.colorAttachment1=void 0),lt&&st.deleteTexture(lt)}destroy(){const d=this.context.gl;if(this.colorAttachment0){const $=this.colorAttachment0.get();$&&d.deleteTexture($)}if(this.colorAttachment1){const $=this.colorAttachment1.get();$&&d.deleteTexture($)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const $=this.depthAttachment.get();$&&d.deleteRenderbuffer($)}else{const $=this.depthAttachment.get();$&&d.deleteTexture($)}d.deleteFramebuffer(this.framebuffer)}}class j0{constructor(d,$){this.gl=d,this.clearColor=new aT(this),this.clearDepth=new dw(this),this.clearStencil=new vv(this),this.colorMask=new Dx(this),this.depthMask=new bv(this),this.stencilMask=new r0(this),this.stencilFunc=new A0(this),this.stencilOp=new Ey(this),this.stencilTest=new R0(this),this.depthRange=new pw(this),this.depthTest=new wv(this),this.depthFunc=new fw(this),this.blend=new P0(this),this.blendFunc=new Nx(this),this.blendColor=new Lx(this),this.blendEquation=new Ev(this),this.cullFace=new jx(this),this.cullFaceSide=new Ty(this),this.frontFace=new mw(this),this.program=new gw(this),this.activeTexture=new yw(this),this.viewport=new I0(this),this.bindFramebuffer=new xw(this),this.bindRenderbuffer=new lT(this),this.bindTexture=new cT(this),this.bindVertexBuffer=new uT(this),this.bindElementBuffer=new Tv(this),this.bindVertexArrayOES=new Sv(this),this.pixelStoreUnpack=new Cv(this),this.pixelStoreUnpackPremultiplyAlpha=new Av(this),this.pixelStoreUnpackFlipY=new _w(this),this.options=$?Object.assign({},$):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=d.getExtension("EXT_texture_filter_anisotropic")||d.getExtension("MOZ_EXT_texture_filter_anisotropic")||d.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=d.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=d.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=d.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=d.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=$&&!!$.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=d.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=d.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=d.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=d.getParameter(d.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=d.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(d,$,st){return new Ap(this,d,$,st)}createVertexBuffer(d,$,st,lt,ht){return new Dw(this,d,$,st,lt,ht)}createRenderbuffer(d,$,st){const lt=this.gl,ht=lt.createRenderbuffer();return this.bindRenderbuffer.set(ht),lt.renderbufferStorage(lt.RENDERBUFFER,d,$,st),this.bindRenderbuffer.set(null),ht}createFramebuffer(d,$,st,lt){return new Nw(this,d,$,st,lt)}clear({color:d,depth:$,stencil:st,colorMask:lt}){const ht=this.gl;let pt=0;d&&(pt|=ht.COLOR_BUFFER_BIT,this.clearColor.set(d.toNonPremultipliedRenderColor(null)),this.colorMask.set(lt||[!0,!0,!0,!0])),$!==void 0&&(pt|=ht.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set($),this.depthMask.set(!0)),st!==void 0&&(pt|=ht.STENCIL_BUFFER_BIT,this.clearStencil.set(st),this.stencilMask.set(255)),ht.clear(pt)}setCullFace(d){d.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(d.mode),this.frontFace.set(d.frontFace))}setDepthMode(d){d.func!==this.gl.ALWAYS||d.mask?(this.depthTest.set(!0),this.depthFunc.set(d.func),this.depthMask.set(d.mask),this.depthRange.set(d.range)):this.depthTest.set(!1)}setStencilMode(d){d.test.func!==this.gl.ALWAYS||d.mask?(this.stencilTest.set(!0),this.stencilMask.set(d.mask),this.stencilOp.set([d.fail,d.depthFail,d.pass]),this.stencilFunc.set({func:d.test.func,ref:d.ref,mask:d.test.mask})):this.stencilTest.set(!1)}setColorMode(d){c.by(d.blendFunction,Bs.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(d.blendFunction),this.blendColor.set(d.blendColor),d.blendEquation?this.blendEquation.set(d.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(d.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let s0;function Jn(it,d,$,st,lt,ht,pt){const mt=it.context,St=mt.gl,It=it.transform,Dt=[c.aF(It.center.lng),c.aJ(It.center.lat)],Ht=$.layout.get("symbol-placement"),Gt=$.layout.get("text-variable-anchor"),qt=$.layout.get("icon-rotation-alignment")==="map",Qt=$.layout.get("text-rotation-alignment")==="map",Zt=Ht!=="point",sr=[];let ir=0,hr=0;for(let vr=0;vr<st.length;vr++){const kr=st[vr],Ur=d.getTile(kr),zr=Ur.getBucket($);if(!zr)continue;const Jr=zr.getProjection().createInversionMatrix(It,kr.canonical),rn=[],pn=gx(kr,zr,It),Pn=!pt&&qt&&Zt,Kr=pt&&Qt&&Zt,jr=Gt&&zr.hasTextData(),an=zr.hasIconTextFit()&&jr&&zr.hasIconData(),Xr=Pn||Kr||pt&&jr||an,bn=zr.projection.name==="globe",Fn=bn?c.aj(It.zoom):0;bn&&(rn.push("PROJECTION_GLOBE_VIEW"),Xr&&rn.push("PROJECTED_POS_ON_VIEWPORT"));const Hn=it.getOrCreateProgram("collisionBox",{defines:rn});let Ln=pn;lt[0]===0&&lt[1]===0||(Ln=it.translatePosMatrix(pn,Ur,lt,ht));const In=pt?zr.textCollisionBox:zr.iconCollisionBox,ns=zr.collisionCircleArray;if(ns.length>0){const $n=c.bC(),qn=Ln;c.cP($n,zr.placementInvProjMatrix,It.glCoordMatrix),c.cP($n,$n,zr.placementViewportMatrix),sr.push({circleArray:ns,circleOffset:hr,transform:qn,invTransform:$n,projection:zr.getProjection()}),ir+=ns.length/4,hr=ir}if(!In)continue;it.terrain&&it.terrain.setupElevationDraw(Ur,Hn);const _i=bn?[kr.canonical.x,kr.canonical.y,1<<kr.canonical.z]:[0,0,0];Hn.draw(it,St.LINES,as.disabled,Ps.disabled,it.colorModeForRenderPass(),Rs.disabled,jv(Ln,Jr,It,Fn,Dt,Ur,_i,zr.getProjection()),$.id,In.layoutVertexBuffer,In.indexBuffer,In.segments,null,It.zoom,null,[In.collisionVertexBuffer,In.collisionVertexBufferExt])}if(!pt||!sr.length)return;const gr=it.getOrCreateProgram("collisionCircle"),dr=new c.dZ;dr.resize(4*ir),dr._trim();let Ir=0;for(const vr of sr)for(let kr=0;kr<vr.circleArray.length/4;kr++){const Ur=4*kr,zr=vr.circleArray[Ur+0],Jr=vr.circleArray[Ur+1],rn=vr.circleArray[Ur+2],pn=vr.circleArray[Ur+3];dr.emplace(Ir++,zr,Jr,rn,pn,0),dr.emplace(Ir++,zr,Jr,rn,pn,1),dr.emplace(Ir++,zr,Jr,rn,pn,2),dr.emplace(Ir++,zr,Jr,rn,pn,3)}(!s0||s0.length<2*ir)&&(s0=function(vr){const kr=2*vr,Ur=new c.b0;Ur.resize(kr),Ur._trim();for(let zr=0;zr<kr;zr++){const Jr=6*zr;Ur.uint16[Jr+0]=4*zr+0,Ur.uint16[Jr+1]=4*zr+1,Ur.uint16[Jr+2]=4*zr+2,Ur.uint16[Jr+3]=4*zr+2,Ur.uint16[Jr+4]=4*zr+3,Ur.uint16[Jr+5]=4*zr+0}return Ur}(ir));const Tr=mt.createIndexBuffer(s0,!0),Rr=mt.createVertexBuffer(dr,c.d_.members,!0);for(const vr of sr){const kr={u_matrix:vr.transform,u_inv_matrix:vr.invTransform,u_camera_to_center_distance:(Er=It).getCameraToCenterDistance(vr.projection),u_viewport_size:[Er.width,Er.height]};gr.draw(it,St.TRIANGLES,as.disabled,Ps.disabled,it.colorModeForRenderPass(),Rs.disabled,kr,$.id,Rr,Tr,c.bg.simpleSegment(0,2*vr.circleOffset,vr.circleArray.length,vr.circleArray.length/2),null,It.zoom)}var Er;Rr.destroy(),Tr.destroy()}const ky=c.bC();function em(it){const d=it._camera.getWorldToCamera(it.worldSize,1),$=c.aB([],d,it.globeMatrix);c.bl($,$);const st=[0,0,0],lt=[0,1,0,0];return c.aC(lt,lt,$),st[0]=lt[0],st[1]=lt[1],st[2]=lt[2],c.aw(st,st),st}function Lm({width:it,height:d,anchor:$,textOffset:st,textScale:lt},ht){const{horizontalAlign:pt,verticalAlign:mt}=c.c1($),St=-(pt-.5)*it,It=-(mt-.5)*d,Dt=c.c2($,st);return new c.P((St/lt+Dt[0])*ht,(It/lt+Dt[1])*ht)}function vs(it,d,$,st,lt,ht,pt,mt,St,It){const Dt=it.text.placedSymbolArray,Ht=it.text.dynamicLayoutVertexArray,Gt=it.icon.dynamicLayoutVertexArray,qt={},Qt=it.getProjection(),Zt=jp(pt,Qt,lt),sr=lt.elevation,ir=Qt.upVectorScale(pt.canonical,lt.center.lat,lt.worldSize).metersToTile;Ht.clear();for(let hr=0;hr<Dt.length;hr++){const gr=Dt.get(hr),{tileAnchorX:dr,tileAnchorY:Ir,numGlyphs:Tr}=gr,Rr=gr.hidden||!gr.crossTileID||it.allowVerticalPlacement&&!gr.placedOrientation?null:st[gr.crossTileID];if(Rr){let Er=0,vr=0,kr=0;const Ur=it.elevationType==="road";if(sr||Ur){const Xr=Ur?it.getElevationFeatureForText(hr):null,bn=c.bV.getAtTileOffset(pt,new c.P(dr,Ir),sr,Xr),[Fn,Hn,Ln]=Qt.upVector(pt.canonical,dr,Ir);Er=bn*Fn*ir,vr=bn*Hn*ir,kr=bn*Ln*ir}let[zr,Jr,rn,pn]=hp(gr.projectedAnchorX+Er,gr.projectedAnchorY+vr,gr.projectedAnchorZ+kr,$?Zt:ht);const Pn=Ro(lt.getCameraToCenterDistance(Qt),pn);let Kr=c.bM(it.textSizeData,St,gr)*Pn/c.bY;$&&(Kr*=it.tilePixelRatio/mt);const jr=Lm(Rr,Kr);$?({x:zr,y:Jr,z:rn}=Qt.projectTilePoint(dr+jr.x,Ir+jr.y,pt.canonical),[zr,Jr,rn]=hp(zr+Er,Jr+vr,rn+kr,ht)):(d&&jr._rotate(-lt.angle),zr+=jr.x,Jr+=jr.y,rn=0);const an=it.allowVerticalPlacement&&gr.placedOrientation===c.bL.vertical?Math.PI/2:0;for(let Xr=0;Xr<Tr;Xr++)c.bO(Ht,zr,Jr,rn,an);It&&gr.associatedIconIndex>=0&&(qt[gr.associatedIconIndex]={x:zr,y:Jr,z:rn,angle:an})}else Tp(Tr,Ht)}if(It){Gt.clear();const hr=it.icon.placedSymbolArray;for(let gr=0;gr<hr.length;gr++){const dr=hr.get(gr),{numGlyphs:Ir}=dr,Tr=qt[gr];if(dr.hidden||!Tr)Tp(Ir,Gt);else{const{x:Rr,y:Er,z:vr,angle:kr}=Tr;for(let Ur=0;Ur<Ir;Ur++)c.bO(Gt,Rr,Er,vr,kr)}}it.icon.dynamicLayoutVertexBuffer.updateData(Gt)}it.text.dynamicLayoutVertexBuffer.updateData(Ht)}function My(it,d,$,st,lt,ht,pt={}){const mt=$.paint.get("icon-translate"),St=$.paint.get("text-translate"),It=$.paint.get("icon-translate-anchor"),Dt=$.paint.get("text-translate-anchor"),Ht=$.layout.get("icon-rotation-alignment"),Gt=$.layout.get("text-rotation-alignment"),qt=$.layout.get("icon-pitch-alignment"),Qt=$.layout.get("text-pitch-alignment"),Zt=$.layout.get("icon-keep-upright"),sr=$.layout.get("text-keep-upright"),ir=$.paint.get("icon-color-saturation"),hr=$.paint.get("icon-color-contrast"),gr=$.paint.get("icon-color-brightness-min"),dr=$.paint.get("icon-color-brightness-max"),Ir=$.layout.get("symbol-elevation-reference")==="sea",Tr=$.layout.get("icon-image-use-theme")==="none",Rr=it.context,Er=Rr.gl,vr=it.transform,kr=Ht==="map",Ur=Gt==="map",zr=qt==="map",Jr=Qt==="map",rn=$.layout.get("symbol-sort-key").constantOr(1)!==void 0;let pn=!1;const Pn=it.depthModeForSublayer(0,as.ReadOnly),Kr=new as(it.context.gl.LEQUAL,as.ReadOnly,it.depthRangeFor3D),jr=[c.aF(vr.center.lng),c.aJ(vr.center.lat)],an=$.layout.get("text-variable-anchor"),Xr=vr.projection.name==="globe",bn=[],Fn=[0,-1,0];for(const Hn of st){const Ln=d.getTile(Hn),In=Ln.getBucket($);if(!In||In.projection.name==="mercator"&&Xr||In.fullyClipped)continue;const ns=In.projection.name==="globe",_i=ns?c.aj(vr.zoom):0,$n=jp(Hn,In.getProjection(),vr),qn=vr.calculatePixelsToTileUnitsMatrix(Ln),ms=an&&In.hasTextData(),Ns=In.hasIconTextFit()&&ms&&In.hasIconData(),to=In.getProjection().createInversionMatrix(vr,Hn.canonical),_o=(1<<Ln.tileID.canonical.z)*c.al/it.transform.worldSize,is=So=>{let uo=[0,0,0];if(So){const Us=it.style.directionalLight,Yo=it.style.ambientLight;Us&&Yo&&(uo=Jp(it.style,Us,Yo))}return uo},go=So=>{vr.depthOcclusionForSymbolsAndCircles&&($.hasOcclusionOpacityProperties||it.terrain)&&(So.push("DEPTH_D24"),So.push("DEPTH_OCCLUSION"))},Ds=So=>{$.lut&&!Tr&&($.lut.texture||($.lut.texture=new c.d$(it.context,$.lut.image,[$.lut.image.height,$.lut.image.height,$.lut.image.height],Rr.gl.RGBA8)),Rr.activeTexture.set(Rr.gl.TEXTURE0+gu.LUT),$.lut.texture&&$.lut.texture.bind(Rr.gl.LINEAR,Rr.gl.CLAMP_TO_EDGE),So.push("APPLY_LUT_ON_GPU"))},To=()=>{const So=kr&&$.layout.get("symbol-placement")!=="point",uo=[];go(uo),Ds(uo);const Us=So||Ns,Yo=In.elevationType==="road",Fl=it.shadowRenderer,wl=Yo&&zr&&!!Fl&&Fl.enabled,Oo=is(wl),zu=Yo&&zr&&!it.terrain?Kr:Pn,Eu=$.paint.get("icon-image-cross-fade");it.terrainRenderModeElevated()&&zr&&uo.push("PITCH_WITH_MAP_TERRAIN"),ns&&(uo.push("PROJECTION_GLOBE_VIEW"),Us&&uo.push("PROJECTED_POS_ON_VIEWPORT")),Eu>0&&In.hasAnySecondaryIcon&&uo.push("ICON_TRANSITION"),!In.icon.zOffsetVertexBuffer||Yo&&it.terrain||uo.push("Z_OFFSET"),ir===0&&hr===0&&gr===0&&dr===1||uo.push("COLOR_ADJUSTMENT"),In.sdfIcons&&uo.push("RENDER_SDF"),wl&&uo.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Yo&&zr&&!it.terrain&&In.icon.orientationVertexBuffer&&uo.push("ELEVATED_ROADS");const nu=In.icon.programConfigurations.get($.id),Pu=it.getOrCreateProgram("symbol",{config:nu,defines:uo}),Iu=Ln.imageAtlasTexture?Ln.imageAtlasTexture.size:[0,0],xu=In.iconSizeData,np=c.bK(xu,vr.zoom),_p=zr||!vr.isOrthographic,qu=Nu($n,Ln.tileID.canonical,zr,kr,vr,In.getProjection(),qn),Nl=py($n,Ln.tileID.canonical,zr,kr,vr,In.getProjection(),qn),Gl=it.translatePosMatrix(Nl,Ln,mt,It,!0),Fo=it.translatePosMatrix($n,Ln,mt,It),Kl=Us?ky:qu,Rl=kr&&!zr&&!So;let El=Fn;!Xr&&!vr.mercatorFromTransition||kr||(El=em(vr));const vp=ns?El:Fn,Gy=$.getColorAdjustmentMatrix(ir,hr,gr,dr),Ip=Kx(xu.kind,np,Rl,zr,it,Fo,Kl,Gl,Ir,!1,Iu,[0,0],0,Hn,_i,jr,to,vp,In.getProjection(),Oo,_o,Gy,Eu,null),Hy=Ln.imageAtlasTexture?Ln.imageAtlasTexture:null,H0=$.layout.get("icon-size").constantOr(0)!==1||In.iconsNeedLinear,Wp=In.sdfIcons||it.options.rotating||it.options.zooming||H0||_p?Er.LINEAR:Er.NEAREST,um=In.sdfIcons&&$.paint.get("icon-halo-width").constantOr(1)!==0,W0=it.terrain&&zr&&So?c.bl(c.bC(),qu):ky;if(So&&In.icon){const zm=c.bV.getAtTileOffsetFunc(Hn,vr.center.lat,vr.worldSize,In.getProjection()),hm=yx($n,Ln.tileID.canonical,zr,kr,vr,In.getProjection(),qn),kp=$.layout.get("icon-size-scale-range"),dm=c.aA(it.scaleFactor,kp[0],kp[1]);nw(In,$n,it,!1,hm,Nl,zr,Zt,zm,Hn,dm)}return{program:Pu,buffers:In.icon,uniformValues:Ip,atlasTexture:Hy,atlasTextureIcon:null,atlasInterpolation:Wp,atlasInterpolationIcon:null,isSDF:In.sdfIcons,hasHalo:um,depthMode:zu,tile:Ln,renderWithShadows:wl,labelPlaneMatrixInv:W0}},Do=()=>{const So=Ur&&$.layout.get("symbol-placement")!=="point",uo=[],Us=So||an||Ns,Yo=In.elevationType==="road",Fl=it.shadowRenderer,wl=Yo&&Jr&&!!Fl&&Fl.enabled,Oo=is(wl),zu=Yo&&Jr&&!it.terrain?Kr:Pn;it.terrainRenderModeElevated()&&Jr&&uo.push("PITCH_WITH_MAP_TERRAIN"),ns&&(uo.push("PROJECTION_GLOBE_VIEW"),Us&&uo.push("PROJECTED_POS_ON_VIEWPORT")),!In.text.zOffsetVertexBuffer||Yo&&it.terrain||uo.push("Z_OFFSET"),In.iconsInText&&uo.push("RENDER_TEXT_AND_SYMBOL"),uo.push("RENDER_SDF"),wl&&uo.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Yo&&Jr&&!it.terrain&&In.text.orientationVertexBuffer&&uo.push("ELEVATED_ROADS"),go(uo);const Eu=In.text.programConfigurations.get($.id),nu=it.getOrCreateProgram("symbol",{config:Eu,defines:uo});let Pu,Iu=[0,0],xu=null;const np=In.textSizeData;In.iconsInText&&(Iu=Ln.imageAtlasTexture?Ln.imageAtlasTexture.size:[0,0],xu=Ln.imageAtlasTexture?Ln.imageAtlasTexture:null,Pu=Jr||!vr.isOrthographic||it.options.rotating||it.options.zooming||np.kind==="composite"||np.kind==="camera"?Er.LINEAR:Er.NEAREST);const _p=Ln.glyphAtlasTexture?Ln.glyphAtlasTexture.size:[0,0],qu=$.layout.get("text-size-scale-range"),Nl=c.aA(it.scaleFactor,qu[0],qu[1]),Gl=c.bK(np,vr.zoom,Nl),Fo=Nu($n,Ln.tileID.canonical,Jr,Ur,vr,In.getProjection(),qn),Kl=py($n,Ln.tileID.canonical,Jr,Ur,vr,In.getProjection(),qn),Rl=it.translatePosMatrix(Kl,Ln,St,Dt,!0),El=it.translatePosMatrix($n,Ln,St,Dt),vp=Us?ky:Fo,Gy=Ur&&!Jr&&!So;let Ip=Fn;!Xr&&!vr.mercatorFromTransition||Ur||(Ip=em(vr));const Hy=Kx(np.kind,Gl,Gy,Jr,it,El,vp,Rl,Ir,!0,_p,Iu,0,Hn,_i,jr,to,ns?Ip:Fn,In.getProjection(),Oo,_o,null,null,Nl),H0=Ln.glyphAtlasTexture?Ln.glyphAtlasTexture:null,Wp=Er.LINEAR,um=$.paint.get("text-halo-width").constantOr(1)!==0,W0=it.terrain&&Jr&&So?c.bl(c.bC(),Fo):ky;if(So&&In.text){const zm=c.bV.getAtTileOffsetFunc(Hn,vr.center.lat,vr.worldSize,In.getProjection()),hm=yx($n,Ln.tileID.canonical,Jr,Ur,vr,In.getProjection(),qn);nw(In,$n,it,!0,hm,Kl,Jr,sr,zm,Hn,Nl)}return{program:nu,buffers:In.text,uniformValues:Hy,atlasTexture:H0,atlasTextureIcon:xu,atlasInterpolation:Wp,atlasInterpolationIcon:Pu,isSDF:!0,hasHalo:um,depthMode:zu,tile:Ln,renderWithShadows:wl,labelPlaneMatrixInv:W0}},Po=In.icon.segments.get().length,mo=In.text.segments.get().length,Vs=Po&&!pt.onlyText?To():null,bo=mo&&!pt.onlyIcons?Do():null,Al=$.paint.get("icon-opacity").constantOr(1),xa=$.paint.get("text-opacity").constantOr(1);if(rn&&In.canOverlap){pn=!0;const So=Al&&!pt.onlyText?In.icon.segments.get():[],uo=xa&&!pt.onlyIcons?In.text.segments.get():[];for(const Us of So)bn.push({segments:new c.bg([Us]),sortKey:Us.sortKey,state:Vs});for(const Us of uo)bn.push({segments:new c.bg([Us]),sortKey:Us.sortKey,state:bo})}else pt.onlyText||bn.push({segments:Al?In.icon.segments:new c.bg([]),sortKey:0,state:Vs}),pt.onlyIcons||bn.push({segments:xa?In.text.segments:new c.bg([]),sortKey:0,state:bo})}pn&&bn.sort((Hn,Ln)=>Hn.sortKey-Ln.sortKey);for(const Hn of bn){const Ln=Hn.state;if(Ln)if(it.terrain?it.terrain.setupElevationDraw(Ln.tile,Ln.program,{useDepthForOcclusion:vr.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ln.labelPlaneMatrixInv}):it.setupDepthForOcclusion(vr.depthOcclusionForSymbolsAndCircles,Ln.program),Rr.activeTexture.set(Er.TEXTURE0),Ln.atlasTexture&&Ln.atlasTexture.bind(Ln.atlasInterpolation,Er.CLAMP_TO_EDGE,!0),Ln.atlasTextureIcon&&(Rr.activeTexture.set(Er.TEXTURE1),Ln.atlasTextureIcon&&Ln.atlasTextureIcon.bind(Ln.atlasInterpolationIcon,Er.CLAMP_TO_EDGE,!0)),Ln.renderWithShadows&&it.shadowRenderer.setupShadows(Ln.tile.tileID.toUnwrapped(),Ln.program,"vector-tile"),it.uploadCommonLightUniforms(it.context,Ln.program),Ln.hasHalo){const In=Ln.uniformValues;In.u_is_halo=1,Bv(Ln.buffers,Hn.segments,$,it,Ln.program,Ln.depthMode,lt,ht,In,2),In.u_is_halo=0}else{if(Ln.isSDF){const In=Ln.uniformValues;Ln.hasHalo&&(In.u_is_halo=1,Bv(Ln.buffers,Hn.segments,$,it,Ln.program,Ln.depthMode,lt,ht,In,1)),In.u_is_halo=0}Bv(Ln.buffers,Hn.segments,$,it,Ln.program,Ln.depthMode,lt,ht,Ln.uniformValues,1)}}}function Bv(it,d,$,st,lt,ht,pt,mt,St,It){const Dt=[it.dynamicLayoutVertexBuffer,it.opacityVertexBuffer,it.iconTransitioningVertexBuffer,it.globeExtVertexBuffer,it.zOffsetVertexBuffer,it.orientationVertexBuffer];lt.draw(st,st.context.gl.TRIANGLES,ht,pt,mt,Rs.disabled,St,$.id,it.layoutVertexBuffer,it.indexBuffer,d,$.paint,st.transform.zoom,it.programConfigurations.get($.id),Dt,It)}function Lw(it,d){const $=1<<it.canonical.z,st=(d.x*$-it.canonical.x-it.wrap*$)*c.al,lt=(d.y*$-it.canonical.y)*c.al,ht=c.e8(d.z,d.y);return c.d5(st,lt,ht)}function Zx(it,d,$,st,lt){if(!$.layout||$.layout.get("fill-elevation-reference")==="none"||$.paint.get("fill-opacity").constantOr(1)===0)return;const ht=it.context.gl,pt=new as(it.context.gl.LEQUAL,as.ReadWrite,it.depthRangeFor3D),mt=new as(it.context.gl.GREATER,as.ReadWrite,it.depthRangeFor3D),St=function(qt){let Qt=.01;return qt.isOrthographic&&(Qt=c.ak(1e-4,Qt,c.d0(qt.pitch>=Cp?1:qt.pitch/Cp))),2*Qt}(it.transform),It=it.transform.getFreeCameraOptions().position,Dt="elevatedStructuresDepthReconstruct",Ht=it.getOrCreateProgram(Dt,{defines:["DEPTH_RECONSTRUCTION"]}),Gt=it.getOrCreateProgram(Dt);for(const qt of st){const Qt=d.getTile(qt),Zt=Qt.getBucket($);if(!Zt)continue;const sr=Zt.elevatedStructures;if(!sr)continue;const ir=Zt.elevationBufferData.heightRange,hr=Lw(qt.toUnwrapped(),It),gr=it.translatePosMatrix(qt.projMatrix,Qt,$.paint.get("fill-translate"),$.paint.get("fill-translate-anchor"));let dr,Ir,Tr,Rr;if(lt==="initialize"){if(!ir||ir.min>=1||sr.depthSegments.segments[0].primitiveLength===0)continue;dr=n0(gr,hr,St,1,0),Ir=pt,Tr=sr.depthSegments,Rr=Ht}else if(lt==="reset"){if(!ir||ir.min>=0||sr.maskSegments.segments[0].primitiveLength===0)continue;dr=n0(gr,hr,0,0,1),Ir=mt,Tr=sr.maskSegments,Rr=Ht}else if(lt==="geometry"){if(sr.depthSegments.segments[0].primitiveLength===0)continue;dr=n0(gr,hr,St,1,0),Ir=pt,Tr=sr.depthSegments,Rr=Gt}Rr.draw(it,ht.TRIANGLES,Ir,Ps.disabled,Bs.disabled,Rs.disabled,dr,$.id,sr.vertexBuffer,sr.indexBuffer,Tr,$.paint,it.transform.zoom)}}function Yx(it,d,$,st){const{painter:lt,sourceCache:ht,layer:pt,coords:mt,colorMode:St,elevationType:It,terrainEnabled:Dt,pass:Ht}=it,Gt=lt.context.gl,qt=pt.paint.get("fill-pattern"),Qt=pt.paint.get("fill-pattern-cross-fade"),Zt=qt.constantOr(null);let sr=It;It!=="road"||d&&!Dt||(sr="none");const ir=sr==="road",hr=it.painter.shadowRenderer,gr=ir&&!!hr&&hr.enabled,dr=new as(lt.context.gl.LEQUAL,as.ReadOnly,lt.depthRangeFor3D);let Ir=[0,0,0];if(gr){const vr=lt.style.directionalLight,kr=lt.style.ambientLight;vr&&kr&&(Ir=Jp(lt.style,vr,kr))}const Tr=qt&&qt.constantOr(1),Rr=lt.terrain&&lt.terrain.renderingToTexture,Er=(vr,kr)=>{let Ur,zr,Jr,rn,pn;kr?(Ur=Tr&&!pt.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Jr=Gt.LINES):(Ur=Tr?"fillPattern":"fill",Jr=Gt.TRIANGLES);for(const Pn of mt){const Kr=ht.getTile(Pn);if(Tr&&!Kr.patternsLoaded())continue;const jr=Kr.getBucket(pt);if(!jr)continue;const an=d?jr.elevationBufferData:jr.bufferData;if(an.isEmpty())continue;lt.prepareDrawTile();const Xr=an.programConfigurations.get(pt.id),bn=lt.isTileAffectedByFog(Pn),Fn=[],Hn=[];ir&&(Fn.push("ELEVATED_ROADS"),Hn.push(an.elevatedLayoutVertexBuffer)),gr&&Fn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Rr&&$&&Fn.push("USE_MRT1"),Tr&&(lt.context.activeTexture.set(Gt.TEXTURE0),Kr.imageAtlasTexture&&Kr.imageAtlasTexture.bind(Gt.LINEAR,Gt.CLAMP_TO_EDGE),Xr.updatePaintBuffers());let Ln=!1;if(Zt&&Kr.imageAtlas){const qn=Kr.imageAtlas,ms=c.e3.from(Zt),Ns=ms.getPrimary().scaleSelf(c.o.devicePixelRatio).toString(),to=ms.getSecondary(),_o=qn.patternPositions.get(Ns),is=to?qn.patternPositions.get(to.scaleSelf(c.o.devicePixelRatio).toString()):null;Ln=!!_o&&!!is,_o&&Xr.setConstantPatternPositions(_o,is)}Qt>0&&(Ln||Xr.getPatternTransitionVertexBuffer("fill-pattern"))&&Fn.push("FILL_PATTERN_TRANSITION");const In=lt.getOrCreateProgram(Ur,{config:Xr,overrideFog:bn,defines:Fn}),ns=lt.translatePosMatrix(Pn.projMatrix,Kr,pt.paint.get("fill-translate"),pt.paint.get("fill-translate-anchor"));gr&&hr.setupShadows(Kr.tileID.toUnwrapped(),In,"vector-tile");const _i=pt.paint.get("fill-emissive-strength");if(kr){rn=an.lineIndexBuffer,pn=an.lineSegments;const qn=lt.terrain&&lt.terrain.renderingToTexture?lt.terrain.drapeBufferSize:[Gt.drawingBufferWidth,Gt.drawingBufferHeight];zr=Ur==="fillOutlinePattern"&&Tr?Lv(ns,_i,lt,Kr,qn,Ir,Qt):Sw(ns,_i,qn,Ir)}else rn=an.indexBuffer,pn=an.triangleSegments,zr=Tr?Nv(ns,_i,lt,Kr,Ir,Qt):Dv(ns,_i,Ir);lt.uploadCommonUniforms(lt.context,In,Pn.toUnwrapped());let $n=vr;(It==="road"&&!Dt||It==="offset")&&($n=dr),In.draw(lt,Jr,$n,st||lt.stencilModeForClipping(Pn),St,Rs.disabled,zr,pt.id,an.layoutVertexBuffer,rn,pn,pt.paint,lt.transform.zoom,Xr,Hn)}};lt.renderPass===Ht&&Er(lt.depthModeForSublayer(1,lt.renderPass==="opaque"?as.ReadWrite:as.ReadOnly),!1),sr==="none"&&lt.renderPass==="translucent"&&pt.paint.get("fill-antialias")&&Er(lt.depthModeForSublayer(pt.getPaintProperty("fill-outline-color")?2:0,as.ReadOnly),!0)}function Qx(it,d,$,st,lt,ht,pt,mt){$.resetLayerRenderingStats(it);const St=it.context,It=St.gl,Dt=it.transform,Ht=$.paint.get("fill-extrusion-pattern"),Gt=$.paint.get("fill-extrusion-pattern-cross-fade"),qt=Ht.constantOr(null),Qt=Ht.constantOr(1),Zt=$.paint.get("fill-extrusion-opacity"),sr=it.style.enable3dLights(),ir=$.paint.get(sr&&!Qt?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),hr=[$.paint.get("fill-extrusion-ambient-occlusion-intensity"),ir],gr=$.layout.get("fill-extrusion-edge-radius"),dr=gr>0&&!$.paint.get("fill-extrusion-rounded-roof"),Ir=dr?0:gr,Tr=Dt.projection.name==="globe"?c.eb():0,Rr=Dt.projection.name==="globe",Er=Rr?c.aj(Dt.zoom):0,vr=[c.aF(Dt.center.lng),c.aJ(Dt.center.lat)],kr=$.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ur=$.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(kr?null:$.lut).toArray01().slice(0,3),zr=$.paint.get("fill-extrusion-flood-light-intensity"),Jr=$.paint.get("fill-extrusion-vertical-scale"),rn=$.paint.get("fill-extrusion-line-width").constantOr(1)!==0,pn=$.paint.get("fill-extrusion-height-alignment"),Pn=$.paint.get("fill-extrusion-base-alignment"),Kr=Cm(it,$.paint.get("fill-extrusion-cutoff-fade-range")),jr=[];let an;Rr&&jr.push("PROJECTION_GLOBE_VIEW"),hr[0]>0&&jr.push("FAUX_AO"),dr&&jr.push("ZERO_ROOF_RADIUS"),mt&&jr.push("HAS_CENTROID"),zr>0&&jr.push("FLOOD_LIGHT"),Kr.shouldRenderCutoff&&jr.push("RENDER_CUTOFF"),rn&&jr.push("RENDER_WALL_MODE");const Xr=it.renderPass==="shadow",bn=it.shadowRenderer,Fn=Xr&&!!bn,Hn=Xr?Rs.disabled:Rs.backCCW;it.shadowRenderer&&(it.shadowRenderer.useNormalOffset=!0);let Ln=[0,0,0];if(bn){const _i=it.style.directionalLight,$n=it.style.ambientLight;_i&&$n&&(Ln=Jp(it.style,_i,$n)),Xr||(jr.push("RENDER_SHADOWS","DEPTH_TEXTURE"),bn.useNormalOffset&&jr.push("NORMAL_OFFSET")),an=jr.concat(["SHADOWS_SINGLE_CASCADE"])}const In=Fn?"fillExtrusionDepth":Qt?"fillExtrusionPattern":"fillExtrusion",ns=$.getLayerRenderingStats();for(const _i of st){const $n=d.getTile(_i),qn=$n.getBucket($);if(!qn||qn.projection.name!==Dt.projection.name)continue;let ms=!1;bn&&(ms=bn.getMaxCascadeForTile(_i.toUnwrapped())===0);const Ns=it.isTileAffectedByFog(_i),to=qn.programConfigurations.get($.id);let _o=!1;if(qt&&$n.imageAtlas){const mo=$n.imageAtlas,Vs=c.e3.from(qt),bo=Vs.getPrimary().scaleSelf(c.o.devicePixelRatio).toString(),Al=Vs.getSecondary(),xa=mo.patternPositions.get(bo),So=Al?mo.patternPositions.get(Al.scaleSelf(c.o.devicePixelRatio).toString()):null;_o=!!xa&&!!So,xa&&to.setConstantPatternPositions(xa,So)}Gt>0&&(_o||to.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&jr.push("FILL_EXTRUSION_PATTERN_TRANSITION");const is=it.getOrCreateProgram(In,{config:to,defines:ms?an:jr,overrideFog:Ns});if(it.terrain&&it.terrain.setupElevationDraw($n,is,{useMeterToDem:!0}),!qn.centroidVertexBuffer){const mo=is.getAttributeLocation(It,"a_centroid_pos");mo!==-1&&It.vertexAttrib2f(mo,0,0)}!Xr&&bn&&bn.setupShadows($n.tileID.toUnwrapped(),is,"vector-tile"),Qt&&(it.context.activeTexture.set(It.TEXTURE0),$n.imageAtlasTexture&&$n.imageAtlasTexture.bind(It.LINEAR,It.CLAMP_TO_EDGE),to.updatePaintBuffers());const go=$.paint.get("fill-extrusion-vertical-gradient"),Ds=1/qn.tileToMeter;let To;if(Xr&&bn){if(rm($n.tileID,qn.maxHeight,it))continue;const mo=bn.calculateShadowPassMatrixFromTile($n.tileID.toUnwrapped());To=Mv(mo,Ir,Ds,Jr,pn,Pn)}else{const mo=it.translatePosMatrix(_i.expandedProjMatrix,$n,$.paint.get("fill-extrusion-translate"),$.paint.get("fill-extrusion-translate-anchor")),Vs=Dt.projection.createInversionMatrix(Dt,_i.canonical);To=Qt?Tw(mo,it,go,Zt,hr,Ir,Ds,_i,$n,Tr,pn,Pn,Er,vr,Vs,Ur,Jr,Gt):Gx(mo,it,go,Zt,hr,Ir,Ds,_i,Tr,pn,Pn,Er,vr,Vs,Ur,Jr,zr,Ln)}it.uploadCommonUniforms(St,is,_i.toUnwrapped(),null,Kr);let Do=qn.segments;if(Dt.projection.name==="mercator"&&!Xr&&(Do=qn.getVisibleSegments($n.tileID,it.terrain,it.transform.getFrustum(0)),!Do.get().length))continue;if(ns)if(Xr)for(const mo of Do.get())ns.numRenderedVerticesInShadowPass+=mo.primitiveLength;else for(const mo of Do.get())ns.numRenderedVerticesInTransparentPass+=mo.primitiveLength;const Po=[];(it.terrain||mt)&&Po.push(qn.centroidVertexBuffer),Rr&&Po.push(qn.layoutVertexExtBuffer),rn&&Po.push(qn.wallVertexBuffer),is.draw(it,St.gl.TRIANGLES,lt,ht,pt,Hn,To,$.id,qn.layoutVertexBuffer,qn.indexBuffer,Do,$.paint,it.transform.zoom,to,Po)}it.shadowRenderer&&(it.shadowRenderer.useNormalOffset=!1)}class zv{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function tm(it,d,$,st,lt,ht,pt,mt,St,It,Dt,Ht,Gt,qt,Qt,Zt,sr,ir,hr,gr){const dr=d.context,Ir=dr.gl,Tr=d.transform,Rr=d.transform.zoom,Er=[],vr=it.translate,kr=it.translateAnchor,Ur=it.edgeRadius,zr=Cm(d,it.cutoffFadeRange);Dt==="clear"?(Er.push("CLEAR_SUBPASS"),gr&&(Er.push("CLEAR_FROM_TEXTURE"),dr.activeTexture.set(Ir.TEXTURE0),gr.bind(Ir.LINEAR,Ir.CLAMP_TO_EDGE))):Dt==="sdf"?Er.push("SDF_SUBPASS"):Dt==="emissive"&&(Er.push("USE_MRT1"),dr.activeTexture.set(Ir.TEXTURE0),gr.bind(Ir.LINEAR,Ir.CLAMP_TO_EDGE)),ir&&Er.push("HAS_CENTROID"),zr.shouldRenderCutoff&&Er.push("RENDER_CUTOFF");const Jr=(rn,pn,Pn,Kr,jr)=>{let an=Er;pn.groundRadiusBuffer!=null&&(an=Er.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const Xr=pn.programConfigurations.get(st.id),bn=d.isTileAffectedByFog(rn),Fn=d.getOrCreateProgram("fillExtrusionGroundEffect",{config:Xr,defines:an,overrideFog:bn}),Hn=N0(d,Kr,Ht,It,jr,[Gt,qt*jr],Qt,Zt,sr,Rr>=17?0:Ur*jr,gr?gr.size[0]:0),Ln=[];ir&&Ln.push(pn.hiddenByLandmarkVertexBuffer),pn.groundRadiusBuffer!=null&&Ln.push(pn.groundRadiusBuffer),d.uploadCommonUniforms(dr,Fn,rn.toUnwrapped(),null,zr),Fn.draw(d,dr.gl.TRIANGLES,ht,pt,mt,St,Hn,st.id,pn.vertexBuffer,pn.indexBuffer,Pn,st.paint,Rr,Xr,Ln)};for(const rn of lt){const pn=$.getTile(rn),Pn=pn.getBucket(st);if(!Pn||Pn.projection.name!==Tr.projection.name||!Pn.groundEffect||Pn.groundEffect&&!Pn.groundEffect.hasData())continue;const Kr=Pn.groundEffect,jr=1/Pn.tileToMeter;{const an=d.translatePosMatrix(rn.projMatrix,pn,vr,kr),Xr=Kr.getDefaultSegment();Jr(rn,Kr,Xr,an,jr)}if(hr)for(let an=0;an<4;an++){const Xr=c.e9[an](rn),bn=$.getTile(Xr);if(!bn)continue;const Fn=bn.getBucket(st);if(!Fn||Fn.projection.name!==Tr.projection.name||!Fn.groundEffect||Fn.groundEffect&&!Fn.groundEffect.hasData())continue;const Hn=Fn.groundEffect;let Ln,In;an===0?(Ln=[-c.al,0,0],In=1):an===1?(Ln=[c.al,0,0],In=0):an===2?(Ln=[0,-c.al,0],In=3):(Ln=[0,c.al,0],In=2);const ns=Hn.regionSegments[In];if(!ns)continue;const _i=new Float32Array(16);c.br(_i,rn.projMatrix,Ln),Jr(rn,Hn,ns,d.translatePosMatrix(_i,pn,vr,kr),jr)}}}function gT(it,d,$,st,lt,ht,pt){st.centroidVertexArray.length===0&&st.createCentroidsBuffer();const mt=ht?ht.findDEMTileFor($):null;if(!(mt&&mt.dem||pt))return;ht&&mt&&mt.dem&&st.selfDEMTileTimestamp!==mt.dem._timestamp&&(st.borderDoneWithNeighborZ=[-1,-1,-1,-1],st.selfDEMTileTimestamp=mt.dem._timestamp);const St=ir=>new c.P(Math.ceil((ir+c.ed)*c.ee),0),It=ir=>{const hr=d.getSource().minzoom,gr=Ir=>{const Tr=d.getTileByID(Ir);if(Tr&&Tr.hasData())return Tr.getBucket(lt)},dr=[0,-1,1];for(const Ir of dr){if(ir.overscaledZ+Ir<hr)continue;const Tr=gr(ir.calculateScaledKey(ir.overscaledZ+Ir));if(Tr)return Tr}},Dt=[0,0,0],Ht=(ir,hr)=>(Dt[0]=Math.min(ir.min.y,hr.min.y),Dt[1]=Math.max(ir.max.y,hr.max.y),Dt[2]=c.al-hr.min.x>ir.max.x?hr.min.x-c.al:ir.max.x,Dt),Gt=(ir,hr)=>(Dt[0]=Math.min(ir.min.x,hr.min.x),Dt[1]=Math.max(ir.max.x,hr.max.x),Dt[2]=c.al-hr.min.y>ir.max.y?hr.min.y-c.al:ir.max.y,Dt),qt=[(ir,hr)=>Ht(ir,hr),(ir,hr)=>Ht(hr,ir),(ir,hr)=>Gt(ir,hr),(ir,hr)=>Gt(hr,ir)],Qt=(ir,hr,gr,dr,Ir,Tr,Rr)=>{if(!ht)return 0;const Er=[[Tr?gr:ir,Tr?ir:gr,0],[Tr?gr:hr,Tr?hr:gr,0]],vr=Rr<0?c.al+Rr:Rr,kr=[Tr?vr:(ir+hr)/2,Tr?(ir+hr)/2:vr,0];return gr===0&&Rr<0||gr!==0&&Rr>0?ht.getForTilePoints(Ir,[kr],!0,dr):Er.push(kr),ht.getForTilePoints($,Er,!0,mt),Math.max(Er[0][2],Er[1][2],kr[2])/ht.exaggeration()};for(let ir=0;ir<4;ir++){const hr=st.borderFeatureIndices[ir];if(hr.length===0)continue;const gr=c.e9[ir]($),dr=It(gr);if(!(dr&&dr instanceof c.ea))continue;const Ir=ht?ht.findDEMTileFor(gr):null;if(!(Ir&&Ir.dem||pt)||(ht&&Ir&&Ir.dem&&st.borderDEMTileTimestamp[ir]!==Ir.dem._timestamp&&(st.borderDoneWithNeighborZ[ir]=-1,st.borderDEMTileTimestamp[ir]=Ir.dem._timestamp),st.borderDoneWithNeighborZ[ir]===dr.canonical.z))continue;dr.centroidVertexArray.length===0&&dr.createCentroidsBuffer();const Tr=(ir<2?1:5)-ir,Rr=dr.borderDoneWithNeighborZ[Tr]!==st.canonical.z,Er=dr.borderFeatureIndices[Tr];let vr=0;if(st.canonical.z!==dr.canonical.z){for(const kr of hr)st.showCentroid(st.featuresOnBorder[kr]);if(Rr)for(const kr of Er)dr.showCentroid(dr.featuresOnBorder[kr]);st.borderDoneWithNeighborZ[ir]=dr.canonical.z,dr.borderDoneWithNeighborZ[Tr]=st.canonical.z}for(const kr of hr){const Ur=st.featuresOnBorder[kr],zr=st.centroidData[Ur.centroidDataIndex],Jr=Ur.borders[ir];let rn;for(;vr<Er.length;){rn=dr.featuresOnBorder[Er[vr]];const pn=rn.borders[Tr];if(pn[1]>Jr[0]+3||pn[0]>Jr[0]-3)break;dr.showCentroid(rn),vr++}if(rn&&vr<Er.length){const pn=vr;let Pn=0;for(;!(rn.borders[Tr][0]>Jr[1]-3)&&(Pn++,++vr!==Er.length);)rn=dr.featuresOnBorder[Er[vr]];rn=dr.featuresOnBorder[Er[pn]];let Kr=!1;if(Pn>=1){const Xr=rn.borders[Tr];Math.abs(Jr[0]-Xr[0])<3&&Math.abs(Jr[1]-Xr[1])<3&&(Pn=1,Kr=!0,vr=pn+1)}else if(Pn===0){st.showCentroid(Ur);continue}const jr=dr.centroidData[rn.centroidDataIndex];pt&&Kr&&(((Zt=zr).flags|(sr=jr).flags)&c.ec?(Zt.flags|=c.ec,sr.flags|=c.ec):(Zt.flags&=~c.ec,sr.flags&=~c.ec));const an=Ur.intersectsCount()>1||rn.intersectsCount()>1;if(Pn>1)vr=pn,zr.centroidXY=jr.centroidXY=new c.P(0,0);else if(Ir&&Ir.dem&&!an){const Xr=qt[ir](zr,jr),bn=ir%2?c.al-1:0,Fn=Qt(Xr[0],Math.min(c.al-1,Xr[1]),bn,Ir,gr,ir<2,Xr[2]);zr.centroidXY=jr.centroidXY=St(Fn)}else an?zr.centroidXY=jr.centroidXY=new c.P(0,0):(zr.centroidXY=st.encodeBorderCentroid(Ur),jr.centroidXY=dr.encodeBorderCentroid(rn));st.writeCentroidToBuffer(zr),dr.writeCentroidToBuffer(jr)}else st.showCentroid(Ur)}st.borderDoneWithNeighborZ[ir]=dr.canonical.z,dr.borderDoneWithNeighborZ[Tr]=st.canonical.z}var Zt,sr;(st.needsCentroidUpdate||!st.centroidVertexBuffer&&st.centroidVertexArray.length!==0)&&st.uploadCentroid(it)}const Zu=[1,0,0],Vv=[0,1,0],Fu=[0,0,1];function rm(it,d,$){const st=$.transform,lt=$.shadowRenderer;if(!lt)return!0;const ht=it.toUnwrapped(),pt=st.tileSize*lt._cascades[$.currentShadowCascade].scale;let mt=d;if(st.elevation){const Zt=st.elevation.getMinMaxForTile(it);Zt&&(mt+=Zt.max)}const St=[...lt.shadowDirection];St[2]=-St[2];const It=lt.computeSimplifiedTileShadowVolume(ht,mt,pt,St);if(!It)return!1;const Dt=[Zu,Vv,Fu,St,[St[0],0,St[2]],[0,St[1],St[2]]],Ht=st.projection.name==="globe",Gt=st.scaleZoom(pt),qt=c.cB.fromInvProjectionMatrix(st.invProjMatrix,st.worldSize,Gt,!Ht),Qt=lt.getCurrentCascadeFrustum();return qt.intersectsPrecise(It.vertices,It.planes,Dt)===0||Qt.intersectsPrecise(It.vertices,It.planes,Dt)===0}function Dy(it){const{painter:d,source:$,layer:st,coords:lt}=it;let ht=it.defines;const pt=d.context,mt=d.renderPass==="shadow",St=d.renderPass==="light-beam",It=d.shadowRenderer,Dt=c.ef(d.transform.center.lat,d.transform.zoom),Ht=Cm(d,st.paint.get("building-cutoff-fade-range"));Ht.shouldRenderCutoff&&(ht=ht.concat("RENDER_CUTOFF")),it.floodLightIntensity>0&&(ht=ht.concat("FLOOD_LIGHT"));for(const Gt of lt){const qt=$.getTile(Gt),Qt=qt.getBucket(st);if(!Qt)continue;It&&It.getMaxCascadeForTile(Gt.toUnwrapped())===0&&(ht=ht.concat("SHADOWS_SINGLE_CASCADE"));const Zt=Qt.programConfigurations.get(st.id);let sr,ir,hr,gr=d.translatePosMatrix(Gt.expandedProjMatrix,qt,[0,0],"map");if(gr=c.cS(c.bC(),gr,[1,1,it.verticalScale]),mt&&It){if(rm(qt.tileID,Qt.maxHeight*Dt,d))continue;let Ir=It.calculateShadowPassMatrixFromTile(qt.tileID.toUnwrapped());Ir=c.cS(c.bC(),Ir,[1,1,it.verticalScale]),hr=Dm(Ir),sr=ir=d.getOrCreateProgram("buildingDepth",{config:Zt,defines:ht,overrideFog:!1})}else if(St)sr=ir=d.getOrCreateProgram("buildingBloom",{config:Zt,defines:ht,overrideFog:!1}),hr=Cw(gr);else{const Ir=d.transform.calculatePosMatrix(Gt.toUnwrapped(),d.transform.worldSize);c.cS(Ir,Ir,[1,1,it.verticalScale]);const Tr=c.bC();c.cS(Tr,Ir,[1,-1,1/Dt]),c.bl(Tr,Tr),c.eg(Tr,Tr);const Rr=d.transform.getFreeCameraOptions().position,Er=1<<Gt.canonical.z;if(hr=Hx(gr,Tr,it.opacity,it.facadeAOIntensity,[((Rr.x-Gt.wrap)*Er-Gt.canonical.x)*c.al,(Rr.y*Er-Gt.canonical.y)*c.al,Rr.z*Er*c.al],Qt.tileToMeter,it.facadeEmissiveChance,it.floodLightColor,it.floodLightIntensity),ir=d.getOrCreateProgram("building",{config:Zt,defines:ht,overrideFog:!1}),it.depthOnly===!0)sr=ir;else{const vr=ht.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);sr=d.getOrCreateProgram("building",{config:Zt,defines:vr,overrideFog:!1})}It&&(It.setupShadowsFromMatrix(Ir,ir,!0),sr!==ir&&It.setupShadowsFromMatrix(Ir,sr,!0))}const dr=(Ir,Tr)=>{if(St){const Rr=Ir.entranceBloom;Tr.draw(d,pt.gl.TRIANGLES,it.depthMode,Ps.disabled,it.blendMode,Rs.disabled,hr,st.id,Rr.layoutVertexBuffer,Rr.indexBuffer,Rr.segmentsBucket,st.paint,d.transform.zoom,Zt,[Rr.layoutAttenuationBuffer,Rr.layoutColorBuffer])}else{const Rr=Ir.segmentsBucket;let Er=[Ir.layoutNormalBuffer,Ir.layoutCentroidBuffer,Ir.layoutColorBuffer,Ir.layoutFloodLightDataBuffer];Ir.layoutFacadePaintBuffer&&(Er=Er.concat([Ir.layoutFacadeDataBuffer,Ir.layoutFacadeVerticalRangeBuffer,Ir.layoutFacadePaintBuffer])),Tr.draw(d,pt.gl.TRIANGLES,it.depthMode,Ps.disabled,it.blendMode,mt?Rs.disabled:Rs.backCW,hr,st.id,Ir.layoutVertexBuffer,Ir.indexBuffer,Rr,st.paint,d.transform.zoom,Zt,Er)}};d.uploadCommonUniforms(pt,ir,Gt.toUnwrapped(),null,Ht),Qt.buildingWithoutFacade&&dr(Qt.buildingWithoutFacade,ir),Qt.buildingWithFacade&&(sr!==ir&&d.uploadCommonUniforms(pt,sr,Gt.toUnwrapped(),null,Ht),dr(Qt.buildingWithFacade,sr))}}function Jx(it,d,$,st,lt,ht,pt,mt,St,It,Dt,Ht,Gt){const qt=it.context.gl,Qt=it.depthModeForSublayer(1,as.ReadOnly,qt.LEQUAL,!0),Zt=.1*(1-(sr=Dt))+3*sr;var sr;const ir=it._showOverdrawInspector,hr=Ht,gr=new zv;ir||tm(gr,it,d,$,st,Qt,new Ps({func:qt.ALWAYS,mask:255},255,255,qt.KEEP,qt.KEEP,qt.REPLACE),new Bs([qt.ONE,qt.ONE,qt.ONE,qt.ONE],c.ao.transparent,[!1,!1,!1,!0],qt.MIN),Rs.disabled,lt,"sdf",ht,pt,mt,St,It,Zt,hr,!1);{const dr=ir?Ps.disabled:new Ps({func:qt.EQUAL,mask:255},255,255,qt.KEEP,qt.DECR,qt.DECR),Ir=ir?it.colorModeForRenderPass():new Bs([qt.ONE_MINUS_DST_ALPHA,qt.DST_ALPHA,qt.ONE,qt.ONE],c.ao.transparent,[!0,!0,!0,!0]);tm(gr,it,d,$,st,Qt,dr,Ir,Rs.disabled,lt,"color",ht,pt,mt,St,It,Zt,hr,!1)}}function e_(it){return[it[0]*c.eh,it[1]*c.eh,it[2]*c.eh,0]}function Ny(it,d,$,st,lt,ht,pt,mt,St){const It=st.getSource(),Dt=$.globeSharedBuffers;if(!Dt)return;let Ht,Gt,qt;if(d&&(Ht=st.getTile(d)),It instanceof c.aU?(Gt=It.texture,qt=c.dK(0,0,$.transform)):Ht&&d&&(Gt=Ht.texture,qt=c.dK(d.canonical.z,d.canonical.x,$.transform)),!Gt||!qt)return;it||(qt=c.cS(c.bC(),qt,[1,-1,1]));const Qt=$.context,Zt=Qt.gl,sr=lt.paint.get("raster-resampling")==="nearest"?Zt.NEAREST:Zt.LINEAR,ir=$.colorModeForDrapableLayerRenderPass(ht),hr=pt.defines;hr.push("GLOBE_POLES");const gr=new as(Zt.LEQUAL,as.ReadWrite,$.depthRangeFor3D),dr=Float32Array.from($.transform.expandedFarZProjMatrix),Ir=Float32Array.from(c.bk(c.dJ(new c.cD(0,0,0))));$.terrain&&$.terrain.prepareDrawTile(),Qt.activeTexture.set(Zt.TEXTURE0),Gt.bind(sr,Zt.CLAMP_TO_EDGE),Qt.activeTexture.set(Zt.TEXTURE1),Gt.bind(sr,Zt.CLAMP_TO_EDGE),"useMipmap"in Gt&&Qt.extTextureFilterAnisotropic&&$.transform.pitch>20&&Zt.texParameterf(Zt.TEXTURE_2D,Qt.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Qt.extTextureFilterAnisotropicMax);const[Tr,Rr,Er,vr]=d?Dt.getPoleBuffers(d.canonical.z,!1):Dt.getPoleBuffers(0,!0),kr=lt.paint.get("raster-elevation");let Ur;it?(Ur=Tr,$.renderDefaultNorthPole=kr!==0):(Ur=Rr,$.renderDefaultSouthPole=kr!==0);const zr=e_(pt.mix),Jr=((pn,Pn,Kr,jr,an,Xr,bn,Fn,Hn,Ln,In,ns,_i)=>Pw(pn,Pn,Kr,new Float32Array(16),new Float32Array(9),[0,0],jr,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Xr,[0,0],Fn,2,Ln,In,ns,1,0,_i))(dr,Ir,qt,c.aj($.transform.zoom),0,lt,0,kr,0,zr,pt.offset,pt.range,ht),rn=$.getOrCreateProgram("raster",{defines:hr});$.uploadCommonUniforms(Qt,rn,null),rn.draw($,Zt.TRIANGLES,gr,St,ir,mt,Jr,lt.id,Ur,Er,vr)}function jw(it){const d=it._nearZ,$=it.projection.farthestPixelDistance(it),st=$-d,lt=.2*it.height,ht=d+lt;return[d,$,(ht-lt-d)/st,(ht-d)/st]}function im(it,d,$,st){if(it)return d instanceof Du&&it instanceof dx?d.getTextureDescriptor(it,$,!0):{texture:it.texture,mix:e_(st.mix),offset:st.offset,buffer:0,tileSize:1}}var Xo=c.ei([{name:"a_index",type:"Int16",components:1}]);class t_{constructor(d,$,st,lt){const ht={width:st[0],height:st[1],data:null},pt=d.gl;this.targetColorTexture=new c.T(d,ht,pt.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new c.T(d,ht,pt.RGBA8,{useMipmap:!1}),this.context=d,this.updateParticleTexture($,lt),this.lastInvalidatedAt=0}updateParticleTexture(d,$){if(this.particleTextureDimension===$.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const st=this.context.gl,lt=$.width*$.height;this.particleTexture0=new c.T(this.context,$,st.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new c.T(this.context,$,st.RGBA8,{premultiply:!1,useMipmap:!1});const ht=new c.ej;ht.reserve(lt);for(let pt=0;pt<lt;pt++)ht.emplaceBack(pt);this.particleIndexBuffer=this.context.createVertexBuffer(ht,Xo.members,!0),this.particleSegment=c.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=$.width}update(d){return!(this.lastInvalidatedAt<d&&(this.lastInvalidatedAt=c.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Uv(it,d,$){if(!it)return null;const st=d.getTextureDescriptor(it,$,!0);if(!st)return null;let{texture:lt,mix:ht,offset:pt,tileSize:mt,buffer:St,format:It}=st;if(!lt||!It)return null;let Dt=!1;return It==="uint32"&&(Dt=!0,ht[3]=0,ht=Wx(c.ek,ht,[0,$.paint.get("raster-particle-max-speed")]),pt=qx(c.ek,pt,[0,$.paint.get("raster-particle-max-speed")])),{texture:lt,textureOffset:[St/(mt+2*St),mt/(mt+2*St)],tileSize:mt,scalarData:Dt,scale:ht,offset:pt,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[It]]}}function Ow(it){const d=it._nearZ,$=it.projection.farthestPixelDistance(it),st=$-d,lt=.2*it.height,ht=d+lt;return[d,$,(ht-lt-d)/st,(ht-d)/st]}const Fw=new c.ao(1,0,0,1),Bw=new c.ao(0,1,0,1),zw=new c.ao(0,0,1,1),o0=new c.ao(1,0,1,1),a0=new c.ao(0,1,1,1);function Nn(it,d,$,st,lt,ht){for(let pt=0;pt<$.length;pt++)if(lt){const It=new c.ao(st.r*.8,st.g*.8,st.b*.8,1);Bn(it,d,$[pt],st,-1,-1,ht),Bn(it,d,$[pt],st,-1,1,ht),Bn(it,d,$[pt],st,1,1,ht),Bn(it,d,$[pt],st,1,-1,ht),Bn(it,d,$[pt],It,0,0,ht)}else Bn(it,d,$[pt],st,0,0,ht)}function Bn(it,d,$,st,lt,ht,pt){const mt=it.context,St=it.transform,It=mt.gl,Dt=St.projection.name==="globe",Ht=Dt?["PROJECTION_GLOBE_VIEW"]:[];let Gt=c.bz($.projMatrix);if(Dt&&c.aj(St.zoom)>0){const zr=c.bj($.canonical,St),Jr=c.el(zr);Gt=c.aB(new Float32Array(16),St.globeMatrix,Jr),c.aB(Gt,St.projMatrix,Gt)}const qt=c.bC();qt[12]+=2*lt/(c.o.devicePixelRatio*St.width),qt[13]+=2*ht/(c.o.devicePixelRatio*St.height),c.aB(Gt,qt,Gt);const Qt=it.getOrCreateProgram("debug",{defines:Ht}),Zt=d.getTileByID($.key);it.terrain&&it.terrain.setupElevationDraw(Zt,Qt);const sr=as.disabled,ir=Ps.disabled,hr=it.colorModeForRenderPass(),gr="$debug";mt.activeTexture.set(It.TEXTURE0),it.emptyTexture.bind(It.LINEAR,It.CLAMP_TO_EDGE),Dt?Zt._makeGlobeTileDebugBuffers(it.context,St):Zt._makeDebugTileBoundsBuffers(it.context,St.projection);const dr=Zt._tileDebugBuffer||it.debugBuffer,Ir=Zt._tileDebugIndexBuffer||it.debugIndexBuffer,Tr=Zt._tileDebugSegments||it.debugSegments;if(Qt.draw(it,It.LINE_STRIP,sr,ir,hr,Rs.disabled,Py(Gt,st.toPremultipliedRenderColor(null)),gr,dr,Ir,Tr,null,null,null,[Zt._globeTileDebugBorderBuffer]),pt){const zr=Zt.latestRawTileData,Jr=Math.floor((zr&&zr.byteLength||0)/1024);let rn=$.canonical.toString();$.overscaledZ!==$.canonical.z&&(rn+=` => ${$.overscaledZ}`),rn+=` ${Zt.state}`,rn+=` ${Jr}kb`,function(pn,Pn){pn.initDebugOverlayCanvas();const Kr=pn.debugOverlayCanvas,jr=pn.context.gl,an=pn.debugOverlayCanvas.getContext("2d");an.clearRect(0,0,Kr.width,Kr.height),an.shadowColor="white",an.shadowBlur=2,an.lineWidth=1.5,an.strokeStyle="white",an.textBaseline="top",an.font="bold 36px Open Sans, sans-serif",an.fillText(Pn,5,5),an.strokeText(Pn,5,5),pn.debugOverlayTexture.update(Kr),pn.debugOverlayTexture.bind(jr.LINEAR,jr.CLAMP_TO_EDGE)}(it,rn)}const Rr=d.getTile($).tileSize,Er=512/Math.min(Rr,512)*($.overscaledZ/St.zoom)*.5,vr=Zt._tileDebugTextBuffer||it.debugBuffer,kr=Zt._tileDebugTextIndexBuffer||it.quadTriangleIndexBuffer,Ur=Zt._tileDebugTextSegments||it.debugSegments;Qt.draw(it,It.TRIANGLES,sr,ir,Bs.alphaBlended,Rs.disabled,Py(Gt,c.ao.transparent.toPremultipliedRenderColor(null),Er),gr,vr,kr,Ur,null,null,null,[Zt._globeTileDebugTextBuffer])}function l0(it,d,$,st){Hr(it,0,d+$/2,it.transform.width,$,st)}function Dl(it,d,$,st){Hr(it,d-$/2,0,$,it.transform.height,st)}function Hr(it,d,$,st,lt,ht){const pt=it.context,mt=pt.gl;mt.enable(mt.SCISSOR_TEST),mt.scissor(d*c.o.devicePixelRatio,$*c.o.devicePixelRatio,st*c.o.devicePixelRatio,lt*c.o.devicePixelRatio),pt.clear({color:ht}),mt.disable(mt.SCISSOR_TEST)}const Vw=c.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:r_}=Vw;function Up(it,d,$,st){it.emplaceBack(d,$,st)}class n_{constructor(d){this.vertexArray=new c.em,this.indices=new c.b0,Up(this.vertexArray,-1,-1,1),Up(this.vertexArray,1,-1,1),Up(this.vertexArray,-1,1,1),Up(this.vertexArray,1,1,1),Up(this.vertexArray,-1,-1,-1),Up(this.vertexArray,1,-1,-1),Up(this.vertexArray,-1,1,-1),Up(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=d.createVertexBuffer(this.vertexArray,r_),this.indexBuffer=d.createIndexBuffer(this.indices),this.segment=c.bg.simpleSegment(0,0,36,12)}}function c0(it,d,$,st,lt,ht){const pt=it.context.gl,mt=d.paint.get("sky-atmosphere-color"),St=d.paint.get("sky-atmosphere-halo-color"),It=d.paint.get("sky-atmosphere-sun-intensity"),Dt=((Ht,Gt,qt,Qt,Zt)=>({u_matrix_3f:Ht,u_sun_direction:Gt,u_sun_intensity:qt,u_color_tint_r:[Qt.r,Qt.g,Qt.b,Qt.a],u_color_tint_m:[Zt.r,Zt.g,Zt.b,Zt.a],u_luminance:5e-5}))(c.eo(c.dO(),st),lt,It,mt.toPremultipliedRenderColor(null),St.toPremultipliedRenderColor(null));pt.framebufferTexture2D(pt.FRAMEBUFFER,pt.COLOR_ATTACHMENT0,pt.TEXTURE_CUBE_MAP_POSITIVE_X+ht,d.skyboxTexture,0),$.draw(it,pt.TRIANGLES,as.disabled,Ps.disabled,Bs.unblended,Rs.frontCW,Dt,"skyboxCapture",d.skyboxGeometry.vertexBuffer,d.skyboxGeometry.indexBuffer,d.skyboxGeometry.segment)}const Uw=c.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class O0{constructor(d){const $=new c.ep;$.emplaceBack(-1,1,1,0,0),$.emplaceBack(1,1,1,1,0),$.emplaceBack(1,-1,1,1,1),$.emplaceBack(-1,-1,1,0,1);const st=new c.b0;st.emplaceBack(0,1,2),st.emplaceBack(2,3,0),this.vertexBuffer=d.createVertexBuffer($,Uw.members),this.indexBuffer=d.createIndexBuffer(st),this.segments=c.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const yT=c.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class xT{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class $w{constructor(d){this.colorModeAlphaBlendedWriteRGB=new Bs([1,Fp,1,Fp],c.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Bs([1,0,1,0],c.ao.transparent,[!1,!1,!1,!0]),this.params=new xT,this.updateNeeded=!0}update(d){const $=d.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new O0($);const st=this.params.sizeRange,lt=this.params.intensityRange,ht=function(Dt){const Ht=c.eq(30),Gt=[];for(let qt=0;qt<Dt;++qt){const Qt=2*Math.PI*Ht(),Zt=Math.acos(1-2*Ht())-.5*Math.PI;Gt.push(c.d5(Math.cos(Zt)*Math.cos(Qt),Math.cos(Zt)*Math.sin(Qt),Math.sin(Zt)))}return Gt}(this.params.starsCount),pt=c.eq(300),mt=new c.er,St=new c.b0;let It=0;for(let Dt=0;Dt<ht.length;++Dt){const Ht=c.c5([],ht[Dt],200),Gt=Math.max(0,1+.01*st*(1*pt()-.5)),qt=Math.max(0,1+.01*lt*(1*pt()-.5));mt.emplaceBack(Ht[0],Ht[1],Ht[2],-1,-1,Gt,qt),mt.emplaceBack(Ht[0],Ht[1],Ht[2],1,-1,Gt,qt),mt.emplaceBack(Ht[0],Ht[1],Ht[2],1,1,Gt,qt),mt.emplaceBack(Ht[0],Ht[1],Ht[2],-1,1,Gt,qt),St.emplaceBack(It+0,It+1,It+2),St.emplaceBack(It+0,It+2,It+3),It+=4}this.starsVx=$.createVertexBuffer(mt,yT.members),this.starsIdx=$.createIndexBuffer(St),this.starsSegments=c.bg.simpleSegment(0,0,mt.length,St.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(d,$){const st=d.context,lt=st.gl,ht=d.transform,pt=new as(lt.LEQUAL,as.ReadOnly,[0,1]),mt=c.aj(ht.zoom),St=d.style.getLut($.scope),It=$.properties.get("color-use-theme")==="none",Dt=$.properties.get("color").toNonPremultipliedRenderColor(It?null:St),Ht=$.properties.get("high-color-use-theme")==="none",Gt=$.properties.get("high-color").toNonPremultipliedRenderColor(Ht?null:St),qt=$.properties.get("space-color-use-theme")==="none",Qt=$.properties.get("space-color").toNonPremultipliedRenderColor(qt?null:St),Zt=5e-4,sr=c.es($.properties.get("horizon-blend"),0,1,Zt,.25),ir=c.dE(d,st,ht)&&sr===Zt?ht.worldSize/(2*Math.PI*1.025)-1:ht.globeRadius,hr=d.frameCounter/1e3%1,gr=c.ag(ht.globeCenterInViewSpace),dr=Math.sqrt(Math.pow(gr,2)-Math.pow(ir,2)),Ir=Math.acos(dr/gr),Tr=Rr=>{const Er=ht.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Rr&&Er.push("ALPHA_PASS");const vr=d.getOrCreateProgram("globeAtmosphere",{defines:Er}),kr=((zr,Jr,rn,pn,Pn,Kr,jr,an,Xr,bn,Fn,Hn)=>({u_frustum_tl:zr,u_frustum_tr:Jr,u_frustum_br:rn,u_frustum_bl:pn,u_horizon:Pn,u_transition:Kr,u_fadeout_range:jr,u_atmosphere_fog_color:an.toArray01(),u_high_color:Xr.toArray01(),u_space_color:bn.toArray01(),u_temporal_offset:Fn,u_horizon_angle:Hn}))(ht.frustumCorners.TL,ht.frustumCorners.TR,ht.frustumCorners.BR,ht.frustumCorners.BL,ht.frustumCorners.horizon,mt,sr,Dt,Gt,Qt,hr,Ir);d.uploadCommonUniforms(st,vr);const Ur=this.atmosphereBuffer;Ur&&vr.draw(d,lt.TRIANGLES,pt,Ps.disabled,Rr?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Rs.backCW,kr,Rr?"atmosphere_glow_alpha":"atmosphere_glow",Ur.vertexBuffer,Ur.indexBuffer,Ur.segments)};Tr(!1),Tr(!0)}drawStars(d,$){const st=c.aA($.properties.get("star-intensity"),0,1);if(st===0)return;const lt=d.context,ht=lt.gl,pt=d.transform,mt=d.getOrCreateProgram("stars"),St=c.c7([]);c.c9(St,St,-pt._pitch),c.c8(St,St,-pt.angle),c.c9(St,St,c.an(pt._center.lat)),c.et(St,St,-c.an(pt._center.lng));const It=c.cc(new Float32Array(16),St),Dt=c.aB([],pt.starsProjMatrix,It),Ht=c.eo([],It),Gt=c.eu([],Ht),qt=[0,1,0];c.dQ(qt,qt,Gt),c.c5(qt,qt,this.params.sizeMultiplier);const Qt=[1,0,0];c.dQ(Qt,Qt,Gt),c.c5(Qt,Qt,this.params.sizeMultiplier);const Zt=(sr=qt,ir=Qt,hr=st,{u_matrix:Float32Array.from(Dt),u_up:sr,u_right:ir,u_intensity_multiplier:hr});var sr,ir,hr;d.uploadCommonUniforms(lt,mt),this.starsVx&&this.starsIdx&&mt.draw(d,ht.TRIANGLES,as.disabled,Ps.disabled,this.colorModeAlphaBlendedWriteRGB,Rs.disabled,Zt,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class i_{constructor(){this.visibleTiles=[]}updateBorders(d,$){const st=[],lt=[],ht=d._getRenderableCoordinates(!1,!0);for(const St of ht){const It=d.getTile(St);if(!It.hasData())continue;const Dt=It.getBucket($);Dt&&(Dt.isEmpty()||(st.push(St.key),lt.push({bucket:Dt,tileID:St.canonical})))}let pt=st.length!==this.visibleTiles.length;if(!pt){st.sort();for(let St=0;St<st.length;St++)if(st[St]!==this.visibleTiles[St]){pt=!0;break}}if(!pt)return;const mt=new Set;this.visibleTiles=st,lt.sort((St,It)=>St.tileID.z-It.tileID.z||St.tileID.x-It.tileID.x||St.tileID.y-It.tileID.y);for(const St of lt){const It=new Array,Dt=new Array,Ht=St.bucket;for(const Gt of Ht.featuresOnBorder)mt.has(Gt.featureId)?Dt.push(Gt.footprintIndex):(mt.add(Gt.featureId),It.push(Gt.footprintIndex));Ht.updateFootprintHiddenFlags(It,c.ev,!1),Ht.updateFootprintHiddenFlags(Dt,c.ev,!0)}}}function s_(it,d){const $=[...it],st=d.cameraWorldSizeForFog/d.worldSize,lt=c.bA([]);return c.cS(lt,lt,[st,st,1]),c.aB($,lt,$),c.aB($,d.worldToFogMatrix,$),$}function o_(it,d,$,st,lt){const ht=$.material,pt=st.context,{baseColorTexture:mt,metallicRoughnessTexture:St}=ht.pbrMetallicRoughness,{normalTexture:It,occlusionTexture:Dt,emissionTexture:Ht}=ht;function Gt(Qt,Zt,sr){if(Qt&&(it.push(Zt),pt.activeTexture.set(pt.gl.TEXTURE0+sr),Qt.gfxTexture)){const{minFilter:ir,magFilter:hr,wrapS:gr,wrapT:dr}=Qt.sampler;Qt.gfxTexture.bindExtraParam(ir,hr,gr,dr)}}Gt(mt,"HAS_TEXTURE_u_baseColorTexture",gu.BaseColor),Gt(St,"HAS_TEXTURE_u_metallicRoughnessTexture",gu.MetallicRoughness),Gt(It,"HAS_TEXTURE_u_normalTexture",gu.Normal),Gt(Dt,"HAS_TEXTURE_u_occlusionTexture",gu.Occlusion),Gt(Ht,"HAS_TEXTURE_u_emissionTexture",gu.Emission),lt&&(lt.texture||(lt.texture=new c.d$(st.context,lt.image,[lt.image.height,lt.image.height,lt.image.height],pt.gl.RGBA8)),pt.activeTexture.set(pt.gl.TEXTURE0+gu.LUT),lt.texture&&lt.texture.bind(pt.gl.LINEAR,pt.gl.CLAMP_TO_EDGE),it.push("APPLY_LUT_ON_GPU")),$.texcoordBuffer&&(it.push("HAS_ATTRIBUTE_a_uv_2f"),d.push($.texcoordBuffer)),$.colorBuffer&&(it.push($.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),d.push($.colorBuffer)),$.normalBuffer&&(it.push("HAS_ATTRIBUTE_a_normal_3f"),d.push($.normalBuffer)),$.pbrBuffer&&(it.push("HAS_ATTRIBUTE_a_pbr"),it.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),d.push($.pbrBuffer)),ht.alphaMode!=="OPAQUE"&&ht.alphaMode!=="MASK"||it.push("UNPREMULT_TEXTURE_IN_SHADER"),ht.defined||it.push("DIFFUSE_SHADED");const qt=st.shadowRenderer;qt&&(it.push("RENDER_SHADOWS","DEPTH_TEXTURE"),qt.useNormalOffset&&it.push("NORMAL_OFFSET"))}function a_(it,d,$,st,lt,ht){const pt=it.modelOpacity,mt=d.context,St=new as(d.context.gl.LEQUAL,it.isLightMesh?as.ReadOnly:as.ReadWrite,d.depthRangeFor3D),It=d.transform,Dt=it.mesh,Ht=Dt.material,Gt=Ht.pbrMetallicRoughness,qt=d.style.fog;let Qt;Qt=d.transform.projection.zAxisUnit==="pixels"?[...it.nodeModelMatrix]:c.aB([],st.zScaleMatrix,it.nodeModelMatrix),c.aB(Qt,st.negCameraPosMatrix,Qt);const Zt=c.bl([],Qt);c.eg(Zt,Zt);const sr=$.paint.get("model-color-use-theme").constantOr("default")==="none",ir=$.paint.get("model-emissive-strength").constantOr(0),hr=i0(new Float32Array(it.worldViewProjection),new Float32Array(Qt),new Float32Array(Zt),null,d,pt,Gt.baseColorFactor,Ht.emissiveFactor,Gt.metallicFactor,Gt.roughnessFactor,Ht,ir,$,void 0,void 0,it.materialOverride,it.modelColor),gr={defines:[]},dr=[],Ir=d.shadowRenderer;Ir&&(Ir.useNormalOffset=!1),o_(gr.defines,dr,Dt,d,sr?null:$.lut);let Tr=null;if(qt){const vr=s_(it.nodeModelMatrix,d.transform);if(Tr=new Float32Array(vr),It.projection.name!=="globe"){const kr=Dt.aabb.min,Ur=Dt.aabb.max,[zr,Jr]=qt.getOpacityForBounds(vr,kr[0],kr[1],Ur[0],Ur[1]);gr.overrideFog=zr>=mn||Jr>=mn}}const Rr=Cm(d,$.paint.get("model-cutoff-fade-range"));Rr.shouldRenderCutoff&&gr.defines.push("RENDER_CUTOFF");const Er=d.getOrCreateProgram("model",gr);d.uploadCommonUniforms(mt,Er,null,Tr,Rr),d.renderPass!=="shadow"&&Ir&&Ir.setupShadowsFromMatrix(it.nodeModelMatrix,Er),Er.draw(d,mt.gl.TRIANGLES,St,lt,ht,Dt.material.doubleSided?Rs.disabled:Rs.backCCW,hr,$.id,Dt.vertexBuffer,Dt.indexBuffer,Dt.segments,$.paint,d.transform.zoom,void 0,dr)}function Ly(it,d){return it.style._importedAsBasemap?"basemap":d.scope}function u0(it,d,$,st,lt,ht,pt,mt,St,It){const Dt=it.transform,Ht=!!d.isGeometryBloom&&d.isGeometryBloom;if(Ht&&it.renderPass==="shadow")return;const Gt=Dt.projection.name==="globe"?c.eD($,Dt):[...$];c.aB(Gt,Gt,d.globalMatrix);const qt=c.aB([],st,Gt);if(d.meshes)for(const Qt of d.meshes){const Zt=mt.get(Qt.material.name);if(Zt&&Zt.opacity<=0)continue;if(Qt.material.alphaMode!=="BLEND"){pt.push({mesh:Qt,depth:0,modelIndex:lt,worldViewProjection:qt,nodeModelMatrix:Gt,isLightMesh:Ht,materialOverride:Zt,modelOpacity:St,modelColor:It});continue}const sr=c.af([],Qt.centroid,qt);!Dt.isOrthographic&&sr[2]<=0||ht.push({mesh:Qt,depth:sr[2],modelIndex:lt,worldViewProjection:qt,nodeModelMatrix:Gt,isLightMesh:Ht,materialOverride:Zt,modelOpacity:St,modelColor:It})}if(d.children)for(const Qt of d.children)u0(it,Qt,$,st,lt,ht,pt,mt,St,It)}function Rp(it,d,$,st){const lt=$.shadowRenderer;if(!lt)return;const ht=lt.getShadowPassDepthMode(),pt=lt.getShadowPassColorMode(),mt=lt.calculateShadowPassMatrixFromMatrix(d),St=Ov(mt);$.getOrCreateProgram("modelDepth",{defines:$._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw($,$.context.gl.TRIANGLES,ht,Ps.disabled,pt,Rs.disabled,St,st.id,it.vertexBuffer,it.indexBuffer,it.segments,st.paint,$.transform.zoom,void 0,void 0)}function Gw(it,d,$,st,lt,ht){for(const pt of lt){const mt=Object.assign({},st);mt.part=pt;const St={type:"Unknown",id:d,properties:mt},It={orientation:it.paint.get("model-rotation").evaluate(St,$)};ht.set(pt,It)}}function Hw(it,d,$,st,lt,ht){for(const pt of lt){const mt=Object.assign({},st);mt.part=pt;const St={type:"Unknown",id:d,properties:mt},It={color:it.paint.get("model-color").evaluate(St,$),colorMix:it.paint.get("model-color-mix-intensity").evaluate(St,$),opacity:it.paint.get("model-opacity").evaluate(St,$),emissionStrength:it.paint.get("model-emissive-strength").evaluate(St,$)};ht.set(pt,It)}}function Ww(it,d,$,st,lt){let ht=!1;for(const mt of st)mt.modelOpacity!==1&&(a_(mt,it,d,lt[mt.modelIndex],Ps.disabled,Bs.disabled),ht=!0);for(const mt of st)a_(mt,it,d,lt[mt.modelIndex],mt.modelOpacity!==1?it.stencilModeFor3D():Ps.disabled,it.colorModeForRenderPass());ht&&it.resetStencilClippingMasks();const pt=Bs.additive;for(const mt of $)a_(mt,it,d,lt[mt.modelIndex],Ps.disabled,mt.isLightMesh?pt:it.colorModeForRenderPass())}function qw(it,d,$){const st=d.updateZoomBasedPaintProperties(),lt=function(ht,pt,mt){let St,It,Dt,Ht=ht.terrain?ht.terrain.exaggeration():0;if(ht.terrain&&Ht>0){const Gt=ht.terrain,qt=Gt.findDEMTileFor(mt);qt&&qt.dem?St=c.eF.create(Gt,mt,qt):Ht=0}if(Ht===0&&(pt.terrainElevationMin=0,pt.terrainElevationMax=0),Ht===pt.validForExaggeration&&(Ht===0||St&&St._demTile&&St._demTile.tileID===pt.validForDEMTile.id&&St._dem._timestamp===pt.validForDEMTile.timestamp))return!1;for(const Gt in pt.instancesPerModel){const qt=pt.instancesPerModel[Gt];for(let Qt=0;Qt<qt.instancedDataArray.length;++Qt){const Zt=(St?Ht*St.getElevationAt(0|qt.instancedDataArray.float32[16*Qt],0|qt.instancedDataArray.float32[16*Qt+1],!0,!0):0)+qt.instancesEvaluatedElevation[Qt];qt.instancedDataArray.float32[16*Qt+6]=Zt,It=It?Math.min(pt.terrainElevationMin,Zt):Zt,Dt=Dt?Math.max(pt.terrainElevationMax,Zt):Zt}}return pt.terrainElevationMin=It||0,pt.terrainElevationMax=Dt||0,pt.validForExaggeration=Ht,pt.validForDEMTile=St&&St._demTile?{id:St._demTile.tileID,timestamp:St._dem._timestamp}:{id:void 0,timestamp:0},!0}(it,d,$);(st||lt)&&(d.uploaded=!1,d.upload(it.context))}const $p={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new c.d9([0,0,0],[c.al,c.al,0])};function Bu(it,d){const $=1<<it.canonical.z,st=d.getFreeCameraOptions().position,lt=d.elevation,ht=it.canonical.x/$,pt=(it.canonical.x+1)/$,mt=it.canonical.y/$,St=(it.canonical.y+1)/$;let It=d._centerAltitude;if(lt){const qt=lt.getMinMaxForTile(it);qt&&qt.max>It&&(It=qt.max)}const Dt=c.aA(st.x,ht,pt)-st.x,Ht=c.aA(st.y,mt,St)-st.y,Gt=c.cf(It,d.center.lat)-st.z;return d._zoomFromMercatorZ(Math.sqrt(Dt*Dt+Ht*Ht+Gt*Gt))}function Kw(it,d,$,st,lt,ht,pt){const mt=it.context,St=it.renderPass==="shadow",It=it.shadowRenderer,Dt=St&&It?It.getShadowPassDepthMode():new as(mt.gl.LEQUAL,as.ReadWrite,it.depthRangeFor3D),Ht=it.isTileAffectedByFog(ht),Gt=it.transform.projection.name==="globe";if($.meshes)for(const qt of $.meshes){const Qt=Gt?[]:["MODEL_POSITION_ON_GPU"],Zt=[];let sr,ir,hr;const gr=!Gt&&st.instancedDataArray.length>20;gr&&Qt.push("INSTANCED_ARRAYS");const dr=Cm(it,d.paint.get("model-cutoff-fade-range"));if(dr.shouldRenderCutoff&&Qt.push("RENDER_CUTOFF"),St&&It)sr=it.getOrCreateProgram("modelDepth",{defines:Qt}),ir=Ov(pt.shadowTileMatrix,pt.shadowTileMatrix,Float32Array.from($.globalMatrix)),hr=It.getShadowPassColorMode();else{o_(Qt,Zt,qt,it,d.paint.get("model-color-use-theme").constantOr("default")==="none"?null:d.lut),sr=it.getOrCreateProgram("model",{defines:Qt,overrideFog:Ht});const Tr=qt.material,Rr=Tr.pbrMetallicRoughness,Er=d.paint.get("model-opacity").constantOr(1),vr=d.paint.get("model-emissive-strength").constantOr(0);ir=i0(ht.expandedProjMatrix,Float32Array.from($.globalMatrix),new Float32Array(16),null,it,Er,Rr.baseColorFactor,Tr.emissiveFactor,Rr.metallicFactor,Rr.roughnessFactor,Tr,vr,d,lt),It&&(pt.shadowUniformsInitialized?sr.setShadowUniformValues(mt,It.getShadowUniformValues()):(It.setupShadows(ht.toUnwrapped(),sr,"model-tile"),pt.shadowUniformsInitialized=!0)),hr=dr.shouldRenderCutoff||Er<1||Tr.alphaMode!=="OPAQUE"?Bs.alphaBlended:Bs.unblended}it.uploadCommonUniforms(mt,sr,ht.toUnwrapped(),null,dr);const Ir=qt.material.doubleSided?Rs.disabled:Rs.backCCW;if(gr)Zt.push(st.instancedDataBuffer),sr.draw(it,mt.gl.TRIANGLES,Dt,Ps.disabled,hr,Ir,ir,d.id,qt.vertexBuffer,qt.indexBuffer,qt.segments,d.paint,it.transform.zoom,void 0,Zt,st.instancedDataArray.length);else{const Tr=St?"u_instance":"u_normal_matrix";for(let Rr=0;Rr<st.instancedDataArray.length;++Rr)ir[Tr]=new Float32Array(st.instancedDataArray.arrayBuffer,64*Rr,16),sr.draw(it,mt.gl.TRIANGLES,Dt,Ps.disabled,hr,Ir,ir,d.id,qt.vertexBuffer,qt.indexBuffer,qt.segments,d.paint,it.transform.zoom,void 0,Zt)}}if($.children)for(const qt of $.children)Kw(it,d,qt,st,lt,ht,pt)}const jy=[1,-1,1];function _T(it,d,$,st){if(!$.modelManager)return!0;const lt=$.modelManager;if(!$.shadowRenderer)return!0;const ht=$.shadowRenderer,pt=d.aabb;let mt=!0,St=it.maxHeight;if(St===0){let Dt=0;for(const Ht in it.instancesPerModel){const Gt=lt.getModel(Ht,st);Gt?Dt=Math.max(Dt,Math.max(Math.max(Gt.aabb.max[0],Gt.aabb.max[1]),Gt.aabb.max[2])):mt=!1}St=it.maxScale*Dt*1.41+it.maxVerticalOffset,mt&&(it.maxHeight=St)}pt.max[2]=St,pt.min[2]+=it.terrainElevationMin,pt.max[2]+=it.terrainElevationMax,c.af(pt.min,pt.min,d.tileMatrix),c.af(pt.max,pt.max,d.tileMatrix);const It=pt.intersects(ht.getCurrentCascadeFrustum());return $.currentShadowCascade===0&&(it.isInsideFirstShadowMapFrustum=It===2),It===0}function ga(it,d){const $=it.uniformValues.u_cutoff_params[0],st=it.uniformValues.u_cutoff_params[1],lt=it.uniformValues.u_cutoff_params[2],ht=it.uniformValues.u_cutoff_params[3];return st===$||ht===lt?1:c.aA(((d-$)/(st-$)-lt)/(ht-lt),0,1)}function Ys(it,d,$,st){if(d.pitch<20)return 1;const lt=d.getWorldToCameraMatrix();c.aB(lt,lt,it);const ht=c.bU($.min[0],$.min[1],$.min[2],1);let pt=c.aC(c.eG(),ht,lt),mt=pt,St=pt;ht[1]=$.max[1],pt=c.aC(c.eG(),ht,lt),mt=pt[1]<mt[1]?pt:mt,St=pt[1]>St[1]?pt:St,ht[0]=$.max[0],pt=c.aC(c.eG(),ht,lt),mt=pt[1]<mt[1]?pt:mt,St=pt[1]>St[1]?pt:St,ht[1]=$.min[1],pt=c.aC(c.eG(),ht,lt),mt=pt[1]<mt[1]?pt:mt,St=pt[1]>St[1]?pt:St;const It=c.aA(st[0],0,1),Dt=100*d.pixelsPerMeter*c.aA(st[1],0,1),Ht=c.aA(st[2],0,1),Gt=c.eH(c.eG(),mt,St,It),qt=Math.tan(.5*d.fovX),Qt=-Gt[2]*qt;if(Dt===0)return Gt[1]<-Math.abs(Qt)?Ht:1;const Zt=(-Math.abs(Qt)-Gt[1])/Dt,sr=(hr,gr,dr)=>(1-dr)*hr+dr*gr,ir=c.aA(sr(1,Ht,Zt),Ht,1);return sr(1,ir,c.aA((d.pitch-20)/20,0,1))}class Xw{}class jm{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(d,$,st){{const Ht=this._storage.get($.id);if(Ht)return Ht.lastUsedFrameIdx=d,Ht.buf}const lt=st.gl,ht=lt.getBufferParameter(lt.ELEMENT_ARRAY_BUFFER,lt.BUFFER_SIZE),pt=new ArrayBuffer(ht),mt=new Int16Array(pt);lt.getBufferSubData(lt.ELEMENT_ARRAY_BUFFER,0,new Int16Array(pt));const St=new c.eJ;for(let Ht=0;Ht<ht/2;Ht+=3){const Gt=mt[Ht],qt=mt[Ht+1],Qt=mt[Ht+2];St.emplaceBack(Gt,qt),St.emplaceBack(qt,Qt),St.emplaceBack(Qt,Gt)}const It=st.bindVertexArrayOES.current,Dt=new Xw;return Dt.buf=new Ap(st,St),Dt.lastUsedFrameIdx=d,this._storage.set($.id,Dt),st.bindVertexArrayOES.set(It),Dt.buf}update(d){for(const[$,st]of this._storage)d-st.lastUsedFrameIdx>30&&(st.buf.destroy(),this._storage.delete($))}destroy(){for(const[d,$]of this._storage)$.buf.destroy(),this._storage.delete(d)}}class F0{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const B0=c.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class sm{constructor(d){this.revealStart=11,this.revealRange=2}}const $v=c.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class Gv{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(d,$){const st=d.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const pt=new c.eK,mt=new c.b0;pt.emplaceBack(-1,-1),pt.emplaceBack(1,-1),pt.emplaceBack(1,1),pt.emplaceBack(-1,1),mt.emplaceBack(0,1,2),mt.emplaceBack(0,2,3),this.vignetteVx=d.context.createVertexBuffer(pt,$v.members),this.vignetteIdx=d.context.createIndexBuffer(mt)}const lt=c.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){d.uploadCommonUniforms(d.context,st);const pt={u_vignetteShape:(ht={vignetteShape:[$.start,$.range,Math.pow(10,$.fadePower)],vignetteColor:[$.color.r,$.color.g,$.color.b,$.color.a*$.strength]}).vignetteShape,u_vignetteColor:ht.vignetteColor};st.draw(d,d.context.gl.TRIANGLES,as.disabled,Ps.disabled,Bs.alphaBlended,Rs.disabled,pt,"vignette",this.vignetteVx,this.vignetteIdx,lt)}var ht}}class Hv{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(d,$){const st=d.getFreeCameraOptions().position,lt=st.toAltitude(),ht=st.toLngLat(),pt=c.an(ht.lng),mt=c.an(ht.lat),St=d.pixelsPerMeter/$,It=pt*c.eM,Dt=c.eM*Math.log(Math.tan(Math.PI/4+mt/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const Ht=-this._offsetYPrev+Dt,Gt=-this._elevationPrev+lt;this._accumulatedOffsetX+=(-this._offsetXPrev+It)*St,this._accumulatedOffsetY+=Ht*St,this._accumulatedElevation+=Gt*St,this._offsetXPrev=It,this._offsetYPrev=Dt,this._elevationPrev=lt}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function l_(it,d){return[-(it[0]-Math.floor(it[0]/d)*d),-(it[1]-Math.floor(it[1]/d)*d),-(it[2]-Math.floor(it[2]/d)*d)]}function tp(it){const d=c.eq(1323123451230),$=[];for(let st=0;st<it;++st){const lt=2*d()-1,ht=2*d()-1,pt=2*d()-1;$.push(c.d5(lt,ht,pt))}return $}function Hu(it,d,$,st,lt){const ht=c.aA((lt-$)/(st-$),0,1);return(1-ht)*it+ht*d}class h0{constructor(d){this._movement=new Hv,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Gv,this._ppmScaleFactor=d}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(d,$){const st=d.transform;this._movement.update(st,this._ppmScaleFactor);const lt=st.starsProjMatrix,ht=c.c7([]);c.c9(ht,ht,c.an(90)-st._pitch),c.c8(ht,ht,-st.angle);const pt=c.cc(new Float32Array(16),ht),mt=c.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),St=c.eg([],mt),It=c.aB([],St,pt),Dt=Date.now()/1e3;return this._accumulatedTimeFromStart+=(Dt-this._prevTime)*$,this._prevTime=Dt,{projectionMatrix:lt,modelviewMatrix:It}}}class c_ extends h0{constructor(d){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new sm("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(d){const $=d.context;if(!this.particlesVx){const st=tp(this.particlesCount),lt=new c.eN,ht=new c.b0;let pt=0;const mt=c.eq(1323123451230);for(let St=0;St<st.length;++St){const It=st[St],Dt=[2*mt()-1,mt(),mt(),mt()];lt.emplaceBack(It[0],It[1],It[2],-1,-1,...Dt),lt.emplaceBack(It[0],It[1],It[2],1,-1,...Dt),lt.emplaceBack(It[0],It[1],It[2],1,1,...Dt),lt.emplaceBack(It[0],It[1],It[2],-1,1,...Dt),ht.emplaceBack(pt+0,pt+1,pt+2),ht.emplaceBack(pt+0,pt+2,pt+3),pt+=4}this.particlesVx=$.createVertexBuffer(lt,B0.members),this.particlesIdx=$.createIndexBuffer(ht)}}draw(d){if(!this._params.overrideStyleParameters&&!d.style.rain)return;const $=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},st=d.transform.zoom;if($.revealStart>st)return;const lt=Hu(0,1,$.revealStart,$.revealStart+$.revealRange,st);if(!this.particlesVx||!this.particlesIdx)return;const ht=structuredClone(this._params);let pt=[-ht.direction.x,ht.direction.y,-100];c.aw(pt,pt);const mt=structuredClone(this._vignetteParams);mt.strength*=lt,ht.overrideStyleParameters||(ht.intensity=d.style.rain.state.density,ht.timeFactor=d.style.rain.state.intensity,ht.color=structuredClone(d.style.rain.state.color),pt=structuredClone(d.style.rain.state.direction),ht.screenThinning.intensity=d.style.rain.state.centerThinning,ht.dropletSizeX=d.style.rain.state.dropletSize[0],ht.dropletSizeYScale=d.style.rain.state.dropletSize[1]/d.style.rain.state.dropletSize[0],ht.distortionStrength=100*d.style.rain.state.distortionStrength,mt.strength=1,mt.color=structuredClone(d.style.rain.state.vignetteColor));const St=this.updateOnRender(d,ht.timeFactor),It=d.context,Dt=It.gl,Ht=d.transform;this.screenTexture&&this.screenTexture.size[0]===d.width&&this.screenTexture.size[1]===d.height||(this.screenTexture=new c.T(It,{width:d.width,height:d.height,data:null},Dt.RGBA8)),ht.distortionStrength>0&&(It.activeTexture.set(Dt.TEXTURE0),this.screenTexture.bind(Dt.LINEAR,Dt.CLAMP_TO_EDGE),Dt.copyTexSubImage2D(Dt.TEXTURE_2D,0,0,0,0,0,d.width,d.height));const Gt=d.getOrCreateProgram("rainParticle");d.uploadCommonUniforms(It,Gt),It.activeTexture.set(Dt.TEXTURE0),this.screenTexture.bind(Dt.LINEAR,Dt.CLAMP_TO_EDGE);const qt=[ht.color.r,ht.color.g,ht.color.b,ht.color.a],Qt=(Zt,sr)=>{const ir=l_(this._movement.getPosition(),Zt),hr=ht.dropletSizeX,gr=ht.dropletSizeX*ht.dropletSizeYScale,dr=d.width/2,Ir=d.height/2,Tr=Hu(0,ht.screenThinning.start,0,1,ht.screenThinning.intensity),Rr=Hu(.001,ht.screenThinning.range,0,1,ht.screenThinning.intensity),Er=Hu(0,ht.screenThinning.particleOffset,0,1,ht.screenThinning.intensity),vr=(kr={modelview:St.modelviewMatrix,projection:St.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ir,velocityConeAperture:ht.velocityConeAperture,velocity:ht.velocity,boxSize:Zt,rainDropletSize:[hr,gr],distortionStrength:ht.distortionStrength,rainDirection:pt,color:qt,screenSize:[Ht.width,Ht.height],thinningCenterPos:[dr,Ir],thinningShape:[Tr,Rr,Math.pow(10,ht.screenThinning.fadePower)],thinningAffectedRatio:ht.screenThinning.affectedRatio,thinningParticleOffset:Er,shapeDirectionalPower:ht.shapeDirPower,shapeNormalPower:ht.shapeNormalPower,mode:sr?0:1},{u_modelview:Float32Array.from(kr.modelview),u_projection:Float32Array.from(kr.projection),u_time:kr.time,u_cam_pos:kr.camPos,u_texScreen:0,u_velocityConeAperture:kr.velocityConeAperture,u_velocity:kr.velocity,u_boxSize:kr.boxSize,u_rainDropletSize:kr.rainDropletSize,u_distortionStrength:kr.distortionStrength,u_rainDirection:kr.rainDirection,u_color:kr.color,u_screenSize:kr.screenSize,u_thinningCenterPos:kr.thinningCenterPos,u_thinningShape:kr.thinningShape,u_thinningAffectedRatio:kr.thinningAffectedRatio,u_thinningParticleOffset:kr.thinningParticleOffset,u_shapeDirectionalPower:kr.shapeDirectionalPower,u_shapeNormalPower:kr.shapeNormalPower,u_mode:kr.mode});var kr;const Ur=Math.round(ht.intensity*this.particlesCount),zr=c.bg.simpleSegment(0,0,4*Ur,2*Ur);Gt.draw(d,Dt.TRIANGLES,as.disabled,Ps.disabled,Bs.alphaBlended,Rs.disabled,vr,"rain_particles",this.particlesVx,this.particlesIdx,zr)};ht.distortionStrength>0&&Qt(ht.boxSize,!0),Qt(ht.boxSize,!1),this._vignette.draw(d,mt)}}const Wv=c.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class qv extends h0{constructor(d){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new sm("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(d){const $=d.context;if(!this.particlesVx){const st=tp(this.particlesCount),lt=new c.eO,ht=new c.b0;let pt=0;const mt=c.eq(1323123451230);for(let St=0;St<st.length;++St){const It=st[St],Dt=mt(),Ht=mt(),Gt=mt(),qt=[St/st.length,Dt,Ht,Gt],Qt=[mt(),mt()];lt.emplaceBack(It[0],It[1],It[2],-1,-1,...qt,...Qt),lt.emplaceBack(It[0],It[1],It[2],1,-1,...qt,...Qt),lt.emplaceBack(It[0],It[1],It[2],1,1,...qt,...Qt),lt.emplaceBack(It[0],It[1],It[2],-1,1,...qt,...Qt),ht.emplaceBack(pt+0,pt+1,pt+2),ht.emplaceBack(pt+0,pt+2,pt+3),pt+=4}this.particlesVx=$.createVertexBuffer(lt,Wv.members),this.particlesIdx=$.createIndexBuffer(ht)}}draw(d){if(!this._params.overrideStyleParameters&&!d.style.snow)return;const $=structuredClone(this._params);let st=[-$.direction.x,$.direction.y,-100];c.aw(st,st);const lt=structuredClone(this._vignetteParams),ht=$.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},pt=d.transform.zoom;if(ht.revealStart>pt)return;const mt=Hu(0,1,ht.revealStart,ht.revealStart+ht.revealRange,pt);lt.strength*=mt,$.overrideStyleParameters||($.intensity=d.style.snow.state.density,$.timeFactor=d.style.snow.state.intensity,$.color=structuredClone(d.style.snow.state.color),st=structuredClone(d.style.snow.state.direction),$.screenThinning.intensity=d.style.snow.state.centerThinning,$.billboardSize=2.79*d.style.snow.state.flakeSize,lt.strength=1,lt.color=structuredClone(d.style.snow.state.vignetteColor));const St=this.updateOnRender(d,$.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const It=d.context,Dt=It.gl,Ht=d.transform,Gt=d.getOrCreateProgram("snowParticle");d.uploadCommonUniforms(It,Gt),((qt,Qt,Zt)=>{const sr=l_(this._movement.getPosition(),qt),ir=Ht.width/2,hr=Ht.height/2,gr=Hu(0,Zt.screenThinning.start,0,1,Zt.screenThinning.intensity),dr=Hu(.001,Zt.screenThinning.range,0,1,Zt.screenThinning.intensity),Ir=Hu(0,Zt.screenThinning.particleOffset,0,1,Zt.screenThinning.intensity),Tr=(Rr={modelview:St.modelviewMatrix,projection:St.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:sr,velocityConeAperture:Zt.velocityConeAperture,velocity:Zt.velocity,horizontalOscillationRadius:Zt.horizontalOscillationRadius,horizontalOscillationRate:Zt.horizontalOscillationRate,boxSize:qt,billboardSize:1*Zt.billboardSize,simpleShapeParameters:[Zt.shapeFadeStart,Zt.shapeFadePower],screenSize:[Ht.width,Ht.height],thinningCenterPos:[ir,hr],thinningShape:[gr,dr,Math.pow(10,Zt.screenThinning.fadePower)],thinningAffectedRatio:Zt.screenThinning.affectedRatio,thinningParticleOffset:Ir,color:[Zt.color.r,Zt.color.g,Zt.color.b,Zt.color.a],direction:st},{u_modelview:Float32Array.from(Rr.modelview),u_projection:Float32Array.from(Rr.projection),u_time:Rr.time,u_cam_pos:Rr.camPos,u_velocityConeAperture:Rr.velocityConeAperture,u_velocity:Rr.velocity,u_horizontalOscillationRadius:Rr.horizontalOscillationRadius,u_horizontalOscillationRate:Rr.horizontalOscillationRate,u_boxSize:Rr.boxSize,u_billboardSize:Rr.billboardSize,u_simpleShapeParameters:Rr.simpleShapeParameters,u_screenSize:Rr.screenSize,u_thinningCenterPos:Rr.thinningCenterPos,u_thinningShape:Rr.thinningShape,u_thinningAffectedRatio:Rr.thinningAffectedRatio,u_thinningParticleOffset:Rr.thinningParticleOffset,u_particleColor:Rr.color,u_direction:Rr.direction});var Rr;const Er=Math.round(Zt.intensity*this.particlesCount),vr=c.bg.simpleSegment(0,0,4*Er,2*Er);this.particlesVx&&this.particlesIdx&&Gt.draw(d,Dt.TRIANGLES,as.disabled,Ps.disabled,Bs.alphaBlended,Rs.disabled,Tr,"snow_particles",this.particlesVx,this.particlesIdx,vr)})($.boxSize,0,$),this._vignette.draw(d,lt)}}const Om={symbol:function(it,d,$,st,lt){if(it.renderPass!=="translucent")return;const ht=Ps.disabled,pt=it.colorModeForRenderPass(),mt=$.layout.get("text-variable-anchor"),St=$.layout.get("text-size-scale-range"),It=c.aA(it.scaleFactor,St[0],St[1]);mt&&function(Gt,qt,Qt,Zt,sr,ir,hr,gr){const dr=qt.transform,Ir=sr==="map",Tr=ir==="map";for(const Rr of Gt){const Er=Zt.getTile(Rr),vr=Er.getBucket(Qt);if(!vr||!vr.text||!vr.text.segments.get().length)continue;const kr=c.bK(vr.textSizeData,dr.zoom,gr),Ur=jp(Rr,vr.getProjection(),dr),zr=dr.calculatePixelsToTileUnitsMatrix(Er),Jr=Nu(Ur,Er.tileID.canonical,Tr,Ir,dr,vr.getProjection(),zr),rn=vr.hasIconTextFit()&&vr.hasIconData();kr&&vs(vr,Ir,Tr,hr,dr,Jr,Rr,Math.pow(2,dr.zoom-Er.tileID.overscaledZ),kr,rn)}}(st,it,$,d,$.layout.get("text-rotation-alignment"),$.layout.get("text-pitch-alignment"),lt,It);const Dt=$.paint.get("icon-opacity").constantOr(1)!==0,Ht=$.paint.get("text-opacity").constantOr(1)!==0;$.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(Dt||Ht)?My(it,d,$,st,ht,pt):(Dt&&My(it,d,$,st,ht,pt,{onlyIcons:!0}),Ht&&My(it,d,$,st,ht,pt,{onlyText:!0})),d.map.showCollisionBoxes&&(Jn(it,d,$,st,$.paint.get("text-translate"),$.paint.get("text-translate-anchor"),!0),Jn(it,d,$,st,$.paint.get("icon-translate"),$.paint.get("icon-translate-anchor"),!1))},circle:function(it,d,$,st){if(it.renderPass!=="translucent")return;const lt=$.paint.get("circle-opacity"),ht=$.paint.get("circle-stroke-width"),pt=$.paint.get("circle-stroke-opacity"),mt=$.layout.get("circle-sort-key").constantOr(1)!==void 0,St=$.paint.get("circle-emissive-strength");if(lt.constantOr(1)===0&&(ht.constantOr(1)===0||pt.constantOr(1)===0))return;const It=it.context,Dt=It.gl,Ht=it.transform,Gt=!(!it.terrain||!it.terrain.enabled),qt=$.layout.get("circle-elevation-reference"),Qt=it.depthModeForSublayer(0,as.ReadOnly),Zt=new as(it.context.gl.LEQUAL,as.ReadOnly,it.depthRangeFor3D),sr=qt==="none"||Gt?Qt:Zt,ir=Ps.disabled,hr=it.colorModeForDrapableLayerRenderPass(St),gr=Ht.projection.name==="globe",dr=[c.aF(Ht.center.lng),c.aJ(Ht.center.lat)],Ir=[];for(let Rr=0;Rr<st.length;Rr++){const Er=st[Rr],vr=d.getTile(Er),kr=vr.getBucket($);if(!kr||kr.projection.name!==Ht.projection.name)continue;const Ur=kr.programConfigurations.get($.id),zr=kr.layoutVertexBuffer,Jr=kr.globeExtVertexBuffer,rn=kr.indexBuffer,pn=c.e0($),Pn=[Jr],Kr=it.isTileAffectedByFog(Er);gr&&pn.push("PROJECTION_GLOBE_VIEW"),pn.push("DEPTH_D24"),it.terrain&&Ht.depthOcclusionForSymbolsAndCircles&&pn.push("DEPTH_OCCLUSION"),kr.hasElevation&&!it.terrain&&(pn.push("ELEVATED_ROADS"),Pn.push(kr.elevatedLayoutVertexBuffer));const jr=it.getOrCreateProgram("circle",{config:Ur,defines:pn,overrideFog:Kr}),an=Ht.projection.createInversionMatrix(Ht,Er.canonical),Xr={programConfiguration:Ur,program:jr,layoutVertexBuffer:zr,dynamicBuffers:Pn,indexBuffer:rn,uniformValues:c.e1(it,Er,vr,an,dr,$),tile:vr};if(mt){const bn=kr.segments.get();for(const Fn of bn)Ir.push({segments:new c.bg([Fn]),sortKey:Fn.sortKey,state:Xr})}else Ir.push({segments:kr.segments,sortKey:0,state:Xr})}mt&&Ir.sort((Rr,Er)=>Rr.sortKey-Er.sortKey);const Tr={useDepthForOcclusion:Ht.depthOcclusionForSymbolsAndCircles};for(const Rr of Ir){const{programConfiguration:Er,program:vr,layoutVertexBuffer:kr,dynamicBuffers:Ur,indexBuffer:zr,uniformValues:Jr,tile:rn}=Rr.state,pn=Rr.segments;it.terrain&&it.terrain.setupElevationDraw(rn,vr,Tr),it.uploadCommonUniforms(It,vr,rn.tileID.toUnwrapped()),vr.draw(it,Dt.TRIANGLES,sr,ir,hr,Rs.disabled,Jr,$.id,kr,zr,pn,$.paint,Ht.zoom,Er,Ur)}},heatmap:function(it,d,$,st){if($.paint.get("heatmap-opacity")!==0)if(it.renderPass==="offscreen"){const lt=it.context,ht=lt.gl,pt=Ps.disabled,mt=new Bs([ht.ONE,ht.ONE,ht.ONE,ht.ONE],c.ao.transparent,[!0,!0,!0,!0]);(function(qt,Qt,Zt,sr){const ir=qt.gl,hr=Qt.width*sr,gr=Qt.height*sr;qt.activeTexture.set(ir.TEXTURE1),qt.viewport.set([0,0,hr,gr]);let dr=Zt.heatmapFbo;if(!dr||dr&&(dr.width!==hr||dr.height!==gr)){dr&&dr.destroy();const Ir=ir.createTexture();ir.bindTexture(ir.TEXTURE_2D,Ir),ir.texParameteri(ir.TEXTURE_2D,ir.TEXTURE_WRAP_S,ir.CLAMP_TO_EDGE),ir.texParameteri(ir.TEXTURE_2D,ir.TEXTURE_WRAP_T,ir.CLAMP_TO_EDGE),ir.texParameteri(ir.TEXTURE_2D,ir.TEXTURE_MIN_FILTER,ir.LINEAR),ir.texParameteri(ir.TEXTURE_2D,ir.TEXTURE_MAG_FILTER,ir.LINEAR),dr=Zt.heatmapFbo=qt.createFramebuffer(hr,gr,1,null),function(Tr,Rr,Er,vr,kr,Ur){const zr=Tr.gl;zr.texImage2D(zr.TEXTURE_2D,0,Tr.extRenderToTextureHalfFloat?zr.RGBA16F:zr.RGBA,kr,Ur,0,zr.RGBA,Tr.extRenderToTextureHalfFloat?zr.HALF_FLOAT:zr.UNSIGNED_BYTE,null),vr.colorAttachment0.set(Er)}(qt,0,Ir,dr,hr,gr)}else ir.bindTexture(ir.TEXTURE_2D,dr.colorAttachment0.get()),qt.bindFramebuffer.set(dr.framebuffer)})(lt,it,$,it.transform.projection.name==="globe"?.5:.25),lt.clear({color:c.ao.transparent});const St=it.transform,It=St.projection.name==="globe",Dt=It?["PROJECTION_GLOBE_VIEW"]:[],Ht=It?Rs.frontCCW:Rs.disabled,Gt=[c.aF(St.center.lng),c.aJ(St.center.lat)];for(let qt=0;qt<st.length;qt++){const Qt=st[qt];if(d.hasRenderableParent(Qt))continue;const Zt=d.getTile(Qt),sr=Zt.getBucket($);if(!sr||sr.projection.name!==St.projection.name)continue;const ir=it.isTileAffectedByFog(Qt),hr=sr.programConfigurations.get($.id),gr=it.getOrCreateProgram("heatmap",{config:hr,defines:Dt,overrideFog:ir}),{zoom:dr}=it.transform;it.terrain&&it.terrain.setupElevationDraw(Zt,gr),it.uploadCommonUniforms(lt,gr,Qt.toUnwrapped());const Ir=St.projection.createInversionMatrix(St,Qt.canonical);gr.draw(it,ht.TRIANGLES,as.disabled,pt,mt,Ht,Rw(it,Qt,Zt,Ir,Gt,dr,$.paint.get("heatmap-intensity")),$.id,sr.layoutVertexBuffer,sr.indexBuffer,sr.segments,$.paint,it.transform.zoom,hr,It?[sr.globeExtVertexBuffer]:null)}lt.viewport.set([0,0,it.width,it.height])}else it.renderPass==="translucent"&&(it.context.setColorMode(it.colorModeForRenderPass()),function(lt,ht){const pt=lt.context,mt=pt.gl,St=ht.heatmapFbo;if(!St)return;pt.activeTexture.set(mt.TEXTURE0),mt.bindTexture(mt.TEXTURE_2D,St.colorAttachment0.get()),pt.activeTexture.set(mt.TEXTURE1);let It=ht.colorRampTexture;It||(It=ht.colorRampTexture=new c.T(pt,ht.colorRamp,mt.RGBA8)),It.bind(mt.LINEAR,mt.CLAMP_TO_EDGE),lt.getOrCreateProgram("heatmapTexture").draw(lt,mt.TRIANGLES,as.disabled,Ps.disabled,lt.colorModeForRenderPass(),Rs.disabled,((Dt,Ht,Gt,qt)=>({u_image:0,u_color_ramp:1,u_opacity:Ht.paint.get("heatmap-opacity")}))(0,ht),ht.id,lt.viewportBuffer,lt.quadTriangleIndexBuffer,lt.viewportSegments,ht.paint,lt.transform.zoom)}(it,$))},line:function(it,d,$,st){if(it.renderPass!=="translucent")return;const lt=$.paint.get("line-opacity"),ht=$.paint.get("line-width");if(lt.constantOr(1)===0||ht.constantOr(1)===0)return;const pt=$.paint.get("line-emissive-strength").isConstant(),mt=$.paint.get("line-emissive-strength").constantOr(0),St=$.paint.get("line-occlusion-opacity"),It=$.layout.get("line-elevation-reference"),Dt=$.layout.get("line-width-unit")==="meters",Ht=It==="sea",Gt=!(!it.terrain||!it.terrain.enabled),qt=it.context,Qt=qt.gl;if($.hasElevatedBuckets&&it.transform.projection.name==="globe")return;const Zt=$.layout.get("line-cross-slope"),sr=Zt!==void 0,ir=Zt<1,hr=it.colorModeForDrapableLayerRenderPass(pt?mt:null),gr=it.terrain&&it.terrain.renderingToTexture,dr=gr?1:c.o.devicePixelRatio,Ir=$.paint.get("line-dasharray"),Tr=Ir.constantOr(1),Rr=$.layout.get("line-cap"),Er=Ir.constantOr(null),vr=Rr.constantOr(null),kr=$.paint.get("line-pattern"),Ur=kr.constantOr(1),zr=$.paint.get("line-pattern-cross-fade"),Jr=kr.constantOr(null),rn=$.paint.get("line-opacity").constantOr(1);let pn=!Ur&&rn!==1||it.depthOcclusion&&St>0&&St<1;const Pn=$.paint.get("line-gradient"),Kr=Ur?"linePattern":"line",jr=c.e2($);let an;if(gr&&it.terrain&&it.terrain.clipOrMaskOverlapStencilType()&&(pn=!1),St!==0&&it.depthOcclusion){const Hn=$.paint._values["line-opacity"];Hn&&Hn.value&&Hn.value.kind==="constant"?an=Hn.value:c.w(`Occlusion opacity for layer ${$.id} is supported only when line-opacity isn't data-driven.`)}ht.value.kind!=="constant"&&ht.value.isLineProgressConstant===!1&&jr.push("VARIABLE_LINE_WIDTH"),gr&&(it.emissiveMode!=="dual-source-blending"||pt?it.emissiveMode==="mrt-fallback"&&jr.push("USE_MRT1"):jr.push("DUAL_SOURCE_BLENDING"));const Xr=(Hn,Ln,In,ns,_i,$n)=>{for(const qn of Hn){const ms=d.getTile(qn);if(Ur&&!ms.patternsLoaded())continue;const Ns=ms.getBucket($);if(!Ns||Ns.elevationType!=="none"&&!_i||Ns.elevationType==="none"&&_i)continue;it.prepareDrawTile();const to=[...Ln],_o=it.shadowRenderer,is=Ns.elevationType==="road"&&!!_o&&_o.enabled;let go=[0,0,0];if(is){const Us=it.style.directionalLight,Yo=it.style.ambientLight;Us&&Yo&&(go=Jp(it.style,Us,Yo)),to.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Ds=Ns.programConfigurations.get($.id);let To=!1;if(Jr&&ms.imageAtlas){const Us=c.e3.from(Jr),Yo=Us.getPrimary().scaleSelf(dr).toString(),Fl=ms.imageAtlas.patternPositions.get(Yo),wl=Us.getSecondary(),Oo=wl?ms.imageAtlas.patternPositions.get(wl.scaleSelf(dr).toString()):null;To=!!Fl&&!!Oo,Fl&&Ds.setConstantPatternPositions(Fl,Oo)}zr>0&&(To||Ds.getPatternTransitionVertexBuffer("line-pattern"))&&to.push("LINE_PATTERN_TRANSITION");const Do=it.isTileAffectedByFog(qn),Po=it.getOrCreateProgram(Kr,{config:Ds,defines:to,overrideFog:Do});if(!Ur&&Er&&vr&&ms.lineAtlas){const Us=ms.lineAtlas.getDash(Er,vr);Us&&Ds.setConstantPatternPositions(Us)}is&&_o.setupShadows(ms.tileID.toUnwrapped(),Po,"vector-tile");let[mo,Vs]=$.paint.get("line-trim-offset");(vr==="round"||vr==="square")&&mo!==Vs&&(mo===0&&(mo-=1),Vs===1&&(Vs+=1));const bo=gr?qn.projMatrix:null,Al=Dt?1/Ns.tileToMeter/c.ay(ms,1,it.transform.zoom):1,xa=Dt?1/Ns.tileToMeter/c.ay(ms,1,Math.floor(it.transform.zoom)):1,So=Ur?c.e4(it,ms,$,bo,dr,Al,xa,[mo,Vs],go,zr):c.e5(it,ms,$,bo,Ns.lineClipsArray.length,dr,Al,xa,[mo,Vs],go);if(Pn){const Us=Ns.gradients[$.id];let Yo=Us.texture;if($.gradientVersion!==Us.version){let Fl=256;if($.stepInterpolant){const wl=d.getSource().maxzoom,Oo=qn.canonical.z===wl?Math.ceil(1<<it.transform.maxZoom-qn.canonical.z):1;Fl=c.aA(c.e6(Ns.maxLineLength/c.al*1024*Oo),256,qt.maxTextureSize)}Us.gradient=c.e7({expression:$.gradientExpression(),evaluationKey:"lineProgress",resolution:Fl,image:Us.gradient||void 0,clips:Ns.lineClipsArray}),Us.texture?Us.texture.update(Us.gradient):Us.texture=new c.T(qt,Us.gradient,Qt.RGBA8),Us.version=$.gradientVersion,Yo=Us.texture}qt.activeTexture.set(Qt.TEXTURE1),Yo.bind($.stepInterpolant?Qt.NEAREST:Qt.LINEAR,Qt.CLAMP_TO_EDGE)}Tr&&(qt.activeTexture.set(Qt.TEXTURE0),ms.lineAtlasTexture&&ms.lineAtlasTexture.bind(Qt.LINEAR,Qt.REPEAT),Ds.updatePaintBuffers()),Ur&&(qt.activeTexture.set(Qt.TEXTURE0),ms.imageAtlasTexture&&ms.imageAtlasTexture.bind(Qt.LINEAR,Qt.CLAMP_TO_EDGE),Ds.updatePaintBuffers()),_i&&!Ht&&it.terrain.setupElevationDraw(ms,Po),it.uploadCommonUniforms(qt,Po,qn.toUnwrapped());const uo=Us=>{an!=null&&(an.value=rn*St),Po.draw(it,Qt.TRIANGLES,In,Us,hr,Rs.disabled,So,$.id,Ns.layoutVertexBuffer,Ns.indexBuffer,Ns.segments,$.paint,it.transform.zoom,Ds,[Ns.layoutVertexBuffer2,Ns.patternVertexBuffer,Ns.zOffsetVertexBuffer]),an!=null&&(an.value=rn)};if(pn&&!_i){const Us=it.stencilModeForClipping(qn).ref;Us===0&&gr&&qt.clear({stencil:0});const Yo={func:Qt.EQUAL,mask:255};So.u_alpha_discard_threshold=.8,uo(new Ps(Yo,Us,255,Qt.KEEP,Qt.KEEP,Qt.INVERT)),So.u_alpha_discard_threshold=0,uo(new Ps(Yo,Us,255,Qt.KEEP,Qt.KEEP,Qt.KEEP))}else So.u_alpha_discard_threshold=pn&&_i&&$n?.8:0,uo(_i?ns:it.stencilModeForClipping(qn))}};let bn=it.depthModeForSublayer(0,as.ReadOnly);const Fn=new as(it.depthOcclusion?Qt.GREATER:Qt.LEQUAL,as.ReadOnly,it.depthRangeFor3D);if($.hasNonElevatedBuckets){const Hn=!gr&&it.terrain;St!==0&&Hn?c.w(`Occlusion opacity for layer ${$.id} is supported on terrain only if the layer has line-z-offset enabled.`):Hn?c.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${$.id}.`):Xr(st,jr,bn,Ps.disabled,!1,!0)}if($.hasElevatedBuckets){It==="hd-road-markup"?Gt||(bn=Fn,jr.push("ELEVATED_ROADS")):(jr.push("ELEVATED"),bn=Fn,sr&&jr.push(ir?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),Ht&&jr.push("ELEVATION_REFERENCE_SEA"));const Hn=pn?it.stencilModeFor3D():Ps.disabled;it.forceTerrainMode=!0,Xr(st,jr,bn,Hn,!0,!0),pn&&Xr(st,jr,bn,Hn,!0,!1),it.forceTerrainMode=!1}pn&&(it.resetStencilClippingMasks(),gr&&qt.clear({stencil:0})),St===0||it.depthOcclusion||gr||it.layersWithOcclusionOpacity.push(it.currentLayer)},fill:function(it,d,$,st){const lt=$.paint.get("fill-color"),ht=$.paint.get("fill-opacity");if(ht.constantOr(1)===0)return;const pt=$.paint.get("fill-emissive-strength"),mt=it.colorModeForDrapableLayerRenderPass(pt),St=$.paint.get("fill-pattern"),It=it.opaquePassEnabledForLayer()&&!St.constantOr(1)&&lt.constantOr(c.ao.transparent).a===1&&ht.constantOr(0)===1?"opaque":"translucent";let Dt="none";$.layout.get("fill-elevation-reference")!=="none"?Dt="road":$.paint.get("fill-z-offset").constantOr(1)!==0&&(Dt="offset");const Ht=!(!it.terrain||!it.terrain.enabled),Gt={painter:it,sourceCache:d,layer:$,coords:st,colorMode:mt,elevationType:Dt,terrainEnabled:Ht,pass:It};if(it.renderPass==="shadow")return void(it.shadowRenderer&&Dt==="road"&&!Ht&&function(Qt){const{painter:Zt,sourceCache:sr,layer:ir,coords:hr}=Qt,gr=Zt.context.gl,dr=Qt.painter.shadowRenderer;for(const Ir of hr){const Tr=sr.getTile(Ir),Rr=Tr.getBucket(ir);if(!Rr)continue;const Er=Rr.elevatedStructures;if(!Er||!Er.shadowCasterSegments||Er.shadowCasterSegments.segments[0].primitiveLength===0)continue;Zt.prepareDrawTile();const vr=Rr.bufferData.programConfigurations.get(ir.id),kr=Zt.isTileAffectedByFog(Ir),Ur=Zt.getOrCreateProgram("elevatedStructuresDepth",{config:vr,overrideFog:kr}),zr=dr.calculateShadowPassMatrixFromTile(Tr.tileID.toUnwrapped());Zt.uploadCommonUniforms(Zt.context,Ur,Ir.toUnwrapped());const Jr={u_matrix:zr,u_depth_bias:0};Ur.draw(Zt,gr.TRIANGLES,dr.getShadowPassDepthMode(),Ps.disabled,dr.getShadowPassColorMode(),Rs.disabled,Jr,ir.id,Er.vertexBuffer,Er.indexBuffer,Er.shadowCasterSegments,ir.paint,Zt.transform.zoom,vr)}}(Gt));const qt=it.emissiveMode==="mrt-fallback";if(Dt!=="offset"){if(Yx(Gt,!1,qt),Dt==="road"){const Qt=!Ht&&it.renderPass==="translucent";Qt&&Zx(it,d,$,st,"geometry"),Yx(Gt,!0,qt,Ps.disabled),Qt&&function(Zt){const{painter:sr,sourceCache:ir,layer:hr,coords:gr,colorMode:dr}=Zt,Ir=sr.context.gl,Tr=Zt.painter.shadowRenderer,Rr=!!Tr&&Tr.enabled,Er=new as(sr.context.gl.LEQUAL,as.ReadOnly,sr.depthRangeFor3D);let vr=[0,0,0];if(Rr){const Ur=sr.style.directionalLight,zr=sr.style.ambientLight;Ur&&zr&&(vr=Jp(sr.style,Ur,zr))}const kr=Ur=>{for(const zr of gr){const Jr=ir.getTile(zr),rn=Jr.getBucket(hr);if(!rn)continue;const pn=rn.elevatedStructures;if(!pn)continue;let Pn,Kr;if(Ur?(Pn=pn.renderableBridgeSegments,Kr=pn.bridgeProgramConfigurations.get(hr.id)):(Pn=pn.renderableTunnelSegments,Kr=pn.tunnelProgramConfigurations.get(hr.id)),!Pn||Pn.segments[0].primitiveLength===0)continue;Kr.updatePaintBuffers(),sr.prepareDrawTile();const jr=sr.isTileAffectedByFog(zr),an=[];Rr&&an.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Xr=sr.getOrCreateProgram("elevatedStructures",{config:Kr,overrideFog:jr,defines:an}),bn=sr.translatePosMatrix(zr.projMatrix,Jr,hr.paint.get("fill-translate"),hr.paint.get("fill-translate-anchor"));Rr&&Tr.setupShadows(Jr.tileID.toUnwrapped(),Xr,"vector-tile");const Fn=Mm(bn,vr);sr.uploadCommonUniforms(sr.context,Xr,zr.toUnwrapped()),Xr.draw(sr,Ir.TRIANGLES,Er,Ps.disabled,dr,Rs.backCCW,Fn,hr.id,pn.vertexBuffer,pn.indexBuffer,Pn,hr.paint,sr.transform.zoom,Kr,[pn.vertexBufferNormal])}};kr(!0),kr(!1)}(Gt)}}else Yx(Gt,!1,qt,it.stencilModeFor3D())},"fill-extrusion":function(it,d,$,st){const lt=$.paint.get("fill-extrusion-opacity"),ht=it.context,pt=ht.gl,mt=it.terrain,St=mt&&mt.renderingToTexture;if(lt===0)return;const It=it.emissiveMode==="mrt-fallback",Dt=it.conflationActive&&it.style.isLayerClipped($,d.getSource()),Ht=it.style.order.indexOf($.fqid);if(Dt&&function(Gt,qt,Qt,Zt,sr){for(const ir of Zt){const hr=qt.getTile(ir).getBucket(Qt);hr&&(hr.updateReplacement(ir,Gt.replacementSource,sr),hr.uploadCentroid(Gt.context))}}(it,d,$,st,Ht),mt||Dt)for(const Gt of st){const qt=d.getTile(Gt).getBucket($);qt&&gT(it.context,d,Gt,qt,$,mt,Dt)}if(it.renderPass==="shadow"&&it.shadowRenderer){const Gt=it.shadowRenderer;if(mt&&lt<.65&&$._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof c.ad)return;const qt=Gt.getShadowPassDepthMode(),Qt=Gt.getShadowPassColorMode();Qx(it,d,$,st,qt,Ps.disabled,Qt,Dt)}else if(it.renderPass==="translucent"){const Gt=!$.paint.get("fill-extrusion-pattern").constantOr(1),qt=$.paint.get("fill-extrusion-color").constantOr(c.ao.white);if(!St&&qt.a!==0){const Qt=new as(it.context.gl.LEQUAL,as.ReadWrite,it.depthRangeFor3D);lt===1&&Gt?Qx(it,d,$,st,Qt,Ps.disabled,Bs.unblended,Dt):(Qx(it,d,$,st,Qt,Ps.disabled,Bs.disabled,Dt),Qx(it,d,$,st,Qt,it.stencilModeFor3D(),it.colorModeForRenderPass(),Dt),it.resetStencilClippingMasks())}if(it.style.enable3dLights()&&Gt&&(!mt&&it.transform.projection.name!=="globe"||St)){const Qt=$.paint.get("fill-extrusion-opacity"),Zt=$.paint.get("fill-extrusion-ambient-occlusion-intensity"),sr=$.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ir=$.paint.get("fill-extrusion-flood-light-intensity"),hr=$.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",gr=$.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(hr?null:$.lut).toArray01().slice(0,3),dr=Zt>0&&sr>0,Ir=ir>0,Tr=(vr,kr,Ur)=>(1-Ur)*vr+Ur*kr,Rr=new zv;Rr.translate=$.paint.get("fill-extrusion-translate"),Rr.translateAnchor=$.paint.get("fill-extrusion-translate-anchor"),Rr.edgeRadius=$.layout.get("fill-extrusion-edge-radius"),Rr.cutoffFadeRange=$.paint.get("fill-extrusion-cutoff-fade-range");const Er=vr=>{const kr=it.depthModeForSublayer(1,as.ReadOnly,pt.LEQUAL,!0),Ur=$.paint.get(vr?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),zr=Tr(.1,3,Ur),Jr=it._showOverdrawInspector;if(!Jr){const rn=new Ps({func:pt.ALWAYS,mask:255},255,255,pt.KEEP,pt.KEEP,pt.REPLACE),pn=new Bs([pt.ONE,pt.ONE,pt.ONE,pt.ONE],c.ao.transparent,[!1,!1,!1,!0],pt.MIN);tm(Rr,it,d,$,st,kr,rn,pn,Rs.disabled,vr,"sdf",Qt,Zt,sr,ir,gr,zr,Dt,!1)}{const rn=Jr?Ps.disabled:new Ps({func:pt.EQUAL,mask:255},255,255,pt.KEEP,pt.DECR,pt.DECR),pn=Jr?it.colorModeForRenderPass():new Bs([pt.ONE_MINUS_DST_ALPHA,pt.DST_ALPHA,pt.ONE,pt.ONE],c.ao.transparent,[!0,!0,!0,!0]);tm(Rr,it,d,$,st,kr,rn,pn,Rs.disabled,vr,"color",Qt,Zt,sr,ir,gr,zr,Dt,!1)}};if(St){const vr=()=>{const Ur=mt.drapeBufferSize[0],zr=mt.drapeBufferSize[1];let Jr=mt.framebufferCopyTexture;return Jr&&(!Jr||Jr.size[0]===Ur&&Jr.size[1]===zr)||(Jr&&Jr.destroy(),Jr=mt.framebufferCopyTexture=new c.T(ht,new c.q({width:Ur,height:zr}),pt.RGBA8)),Jr.bind(pt.LINEAR,pt.CLAMP_TO_EDGE),pt.copyTexSubImage2D(pt.TEXTURE_2D,0,0,0,0,0,Ur,zr),Jr},kr=(Ur,zr,Jr)=>{const rn=it.depthModeForSublayer(1,as.ReadOnly,pt.LEQUAL,!1),pn=$.paint.get(Ur?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Pn=Tr(.1,3,pn);{const Kr=new Bs([pt.ONE,pt.ONE,pt.ONE,pt.ONE],c.ao.transparent,[!1,!1,!1,!0]);tm(Rr,it,d,$,st,rn,Ps.disabled,Kr,Rs.disabled,Ur,"clear",Qt,Zt,sr,ir,gr,Pn,Dt,zr)}{const Kr=new Ps({func:pt.ALWAYS,mask:255},255,255,pt.KEEP,pt.KEEP,pt.REPLACE),jr=new Bs([pt.ONE,pt.ONE,pt.ONE,pt.ONE],c.ao.transparent,[!1,!1,!1,!0],pt.MIN);tm(Rr,it,d,$,st,rn,Kr,jr,Rs.disabled,Ur,"sdf",Qt,Zt,sr,ir,gr,Pn,Dt,zr)}It&&!Ur&&(Jr=vr());{const Kr=Ur?pt.ZERO:pt.ONE_MINUS_DST_ALPHA,jr=new Ps({func:pt.EQUAL,mask:255},255,255,pt.KEEP,pt.DECR,pt.DECR),an=new Bs([Kr,pt.DST_ALPHA,pt.ONE_MINUS_DST_ALPHA,pt.ZERO],c.ao.transparent,[!0,!0,!0,!0]);tm(Rr,it,d,$,st,rn,jr,an,Rs.disabled,Ur,"color",Qt,Zt,sr,ir,gr,Pn,Dt,zr)}if(!It||Ur){const Kr=new Bs([pt.ONE,pt.ONE,pt.ONE,Ur?pt.ZERO:pt.ONE],c.ao.transparent,[!1,!1,!1,!0],Ur?pt.FUNC_ADD:pt.MAX);tm(Rr,it,d,$,st,rn,Ps.disabled,Kr,Rs.disabled,Ur,"clear",Qt,Zt,sr,ir,gr,Pn,Dt,zr,Jr)}else{pt.drawBuffers([pt.NONE,pt.COLOR_ATTACHMENT1]);const Kr=new Ps({func:pt.EQUAL,mask:255},254,255,pt.KEEP,pt.DECR,pt.DECR),jr=new Bs([pt.ONE,pt.ONE,pt.ONE,pt.ONE],c.ao.transparent,[!0,!1,!1,!1],pt.MAX);tm(Rr,it,d,$,st,rn,Kr,jr,Rs.disabled,Ur,"emissive",Qt,Zt,sr,ir,gr,Pn,Dt,zr,Jr),pt.drawBuffers([pt.COLOR_ATTACHMENT0])}};if(dr||Ir){let Ur;it.prepareDrawTile(),It&&!dr||(Ur=vr()),dr&&kr(!0,!1,Ur),Ir&&kr(!1,!0,Ur)}}else dr&&Er(!0),Ir&&Er(!1),(dr||Ir)&&it.resetStencilClippingMasks()}}},building:function(it,d,$,st){it.currentLayer<it.firstLightBeamLayer&&(it.firstLightBeamLayer=it.currentLayer);const lt=$.paint.get("building-ambient-occlusion-ground-intensity"),ht=$.paint.get("building-ambient-occlusion-ground-radius"),pt=$.paint.get("building-ambient-occlusion-ground-attenuation"),mt=$.paint.get("building-opacity");if(mt<=0)return;let St=lt>0&&ht>0,It=!0;const Dt=$.paint.get("building-vertical-scale");if(Dt<=0)return;it.shadowRenderer||(It=!1);const Ht=it.conflationActive&&it.style.isLayerClipped($,d.getSource()),Gt=it.style.order.indexOf($.fqid);if(function(qt,Qt,Zt,sr,ir,hr){for(const gr of hr){const dr=Qt.getTile(gr).getBucket(Zt);dr&&(ir&&dr.updateReplacement(gr,qt.replacementSource,sr),dr.uploadUpdatedIndexBuffer(qt.context))}}(it,d,$,Gt,Ht,st),function(qt,Qt,Zt,sr){for(const ir of sr){const hr=Qt.getTile(ir).getBucket(Zt);hr&&hr.needsEvaluation()&&hr.uploadUpdatedColorBuffer(qt.context)}}(it,d,$,st),$.resetLayerRenderingStats(it),it.shadowRenderer&&(it.shadowRenderer.useNormalOffset=!0),it.renderPass==="shadow"&&it.shadowRenderer){const qt=it.shadowRenderer,Qt=[],Zt=qt.getShadowPassDepthMode();Dy({painter:it,source:d,layer:$,coords:st,defines:Qt,blendMode:qt.getShadowPassColorMode(),depthMode:Zt,opacity:mt,verticalScale:Dt,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(it.renderPass==="translucent"){let qt=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];It&&(qt=qt.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),it.shadowRenderer&&it.shadowRenderer.useNormalOffset&&(qt=qt.concat("NORMAL_OFFSET"));const Qt=$.paint.get("building-facade-emissive-chance"),Zt=$.paint.get("building-ambient-occlusion-intensity"),sr=$.paint.get("building-flood-light-intensity"),ir=$.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",hr=$.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(ir?null:$.lut).toArray01().slice(0,3),gr=$.paint.get("building-flood-light-ground-attenuation"),dr=sr>0,Ir=new as(it.context.gl.LEQUAL,as.ReadWrite,it.depthRangeFor3D);mt<1&&Dy({painter:it,source:d,layer:$,coords:st,defines:qt,blendMode:Bs.disabled,depthMode:Ir,opacity:mt,verticalScale:Dt,facadeEmissiveChance:Qt,facadeAOIntensity:Zt,floodLightIntensity:sr,floodLightColor:hr,depthOnly:!0});const Tr=it.colorModeForRenderPass();Dy({painter:it,source:d,layer:$,coords:st,defines:qt,blendMode:Tr,depthMode:Ir,opacity:mt,verticalScale:Dt,facadeEmissiveChance:Qt,facadeAOIntensity:Zt,floodLightIntensity:sr,floodLightColor:hr}),St&&Jx(it,d,$,st,!0,mt,lt,ht,sr,hr,pt,Ht),dr&&Jx(it,d,$,st,!1,mt,lt,ht,sr,hr,gr,Ht)}else if(it.renderPass==="light-beam"){const qt=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],Qt=new as(it.context.gl.LEQUAL,as.ReadOnly,it.depthRangeFor3D);Dy({painter:it,source:d,layer:$,coords:st,defines:qt,blendMode:Bs.alphaBlended,depthMode:Qt,opacity:mt,verticalScale:Dt,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}it.shadowRenderer&&(it.shadowRenderer.useNormalOffset=!1),it.resetStencilClippingMasks()},hillshade:function(it,d,$,st){if(it.renderPass!=="offscreen"&&it.renderPass!=="translucent"||it.style.disableElevatedTerrain)return;const lt=it.context,ht=it.terrain&&it.terrain.renderingToTexture,[pt,mt]=it.renderPass!=="translucent"||ht?[{},st]:it.stencilConfigForOverlap(st);for(const St of mt){const It=d.getTile(St);if(It.needsHillshadePrepare&&it.renderPass==="offscreen")oT(it,It,$);else if(it.renderPass==="translucent"){const Dt=it.depthModeForSublayer(0,as.ReadOnly),Ht=$.paint.get("hillshade-emissive-strength"),Gt=it.colorModeForDrapableLayerRenderPass(Ht),qt=ht&&it.terrain?it.terrain.stencilModeForRTTOverlap(St):pt[St.overscaledZ];sT(it,St,It,$,Dt,qt,Gt)}}lt.viewport.set([0,0,it.width,it.height]),it.resetStencilClippingMasks()},raster:function(it,d,$,st,lt,ht){if(it.renderPass!=="translucent"||$.paint.get("raster-opacity")===0)return;const pt=it.transform.projection.name==="globe",mt=$.paint.get("raster-elevation")!==0,St=mt&&pt;if(it.renderElevatedRasterBackface&&!St)return;const It=it.context,Dt=It.gl,Ht=d.getSource(),Gt=function(Tr,Rr,Er,vr,kr){const Ur=Rr.paint.get("raster-color"),zr=Tr.type==="raster-array",Jr=[],rn=Rr.paint.get("raster-resampling"),pn=Rr.paint.get("raster-color-mix");let Pn=Rr.paint.get("raster-color-range");const Kr=[pn[0],pn[1],pn[2],0],jr=pn[3];let an=rn==="nearest"?vr.NEAREST:vr.LINEAR;if(zr&&(Jr.push("RASTER_ARRAY"),Ur||Jr.push("RASTER_COLOR"),rn==="linear"&&Jr.push("RASTER_ARRAY_LINEAR"),an=vr.NEAREST,!Pn&&Tr.rasterLayers)){const Xr=Tr.rasterLayers.find(({id:bn})=>bn===Rr.sourceLayer);Xr&&Xr.fields&&Xr.fields.range&&(Pn=Xr.fields.range)}if(Pn=Pn||[0,1],Ur){Jr.push("RASTER_COLOR"),Er.activeTexture.set(vr.TEXTURE2),Rr.updateColorRamp(Pn);let Xr=Rr.colorRampTexture;Xr||(Xr=Rr.colorRampTexture=new c.T(Er,Rr.colorRamp,vr.RGBA8)),Xr.bind(vr.LINEAR,vr.CLAMP_TO_EDGE)}return kr&&Jr.push("USE_MRT1"),{mix:Kr,range:Pn,offset:jr,defines:Jr,resampling:an}}(Ht,$,It,Dt,it.terrain&&it.terrain.renderingToTexture&&it.emissiveMode==="mrt-fallback");if(Ht instanceof c.aU&&!st.length&&!pt)return;const qt=$.paint.get("raster-emissive-strength"),Qt=it.colorModeForDrapableLayerRenderPass(qt),Zt=it.terrain&&it.terrain.renderingToTexture,sr=!it.options.moving,ir=$.paint.get("raster-resampling")==="nearest"?Dt.NEAREST:Dt.LINEAR;if(Ht instanceof c.aU&&!st.length&&(Ht.onNorthPole||Ht.onSouthPole)){const Tr=mt?it.stencilModeFor3D():Ps.disabled;return void Ny(!!Ht.onNorthPole,null,it,d,$,qt,Gt,Rs.disabled,Tr)}if(!st.length)return;const[hr,gr]=Ht instanceof c.aU||Zt?[{},st]:it.stencilConfigForOverlap(st),dr=gr[gr.length-1].overscaledZ;St&&Gt.defines.push("PROJECTION_GLOBE_VIEW"),mt&&Gt.defines.push("RENDER_CUTOFF");const Ir=(Tr,Rr,Er)=>{for(const vr of Tr){const kr=vr.toUnwrapped(),Ur=d.getTile(vr);if(Zt&&(!Ur||!Ur.hasData()))continue;It.activeTexture.set(Dt.TEXTURE0);const zr=im(Ur,Ht,$,Gt);if(!zr||!zr.texture)continue;const{texture:Jr,mix:rn,offset:pn,tileSize:Pn,buffer:Kr}=zr;let jr,an;Zt?(jr=as.disabled,an=vr.projMatrix):mt?(jr=new as(Dt.LEQUAL,as.ReadWrite,it.depthRangeFor3D),an=pt?Float32Array.from(it.transform.expandedFarZProjMatrix):it.transform.calculateProjMatrix(kr,sr)):(jr=it.depthModeForSublayer(vr.overscaledZ-dr,$.paint.get("raster-opacity")===1?as.ReadWrite:as.ReadOnly,Dt.LESS),an=it.transform.calculateProjMatrix(kr,sr));const Xr=it.terrain&&Zt?it.terrain.stencilModeForRTTOverlap(vr):hr[vr.overscaledZ],bn=ht?0:$.paint.get("raster-fade-duration");Ur.registerFadeDuration(bn);const Fn=d.findLoadedParent(vr,0),Hn=Ry(Ur,Fn,d,it.transform,bn);let Ln,In;!Hn.isFading&&Ur.refreshedUponExpiration&&(Ur.refreshedUponExpiration=!1),it.terrain&&it.terrain.prepareDrawTile(),It.activeTexture.set(Dt.TEXTURE0),Jr.bind(ir,Dt.CLAMP_TO_EDGE),It.activeTexture.set(Dt.TEXTURE1),Fn?(Fn.texture&&Fn.texture.bind(ir,Dt.CLAMP_TO_EDGE),Ln=Math.pow(2,Fn.tileID.overscaledZ-Ur.tileID.overscaledZ),In=[Ur.tileID.canonical.x*Ln%1,Ur.tileID.canonical.y*Ln%1]):Jr.bind(ir,Dt.CLAMP_TO_EDGE),"useMipmap"in Jr&&It.extTextureFilterAnisotropic&&it.transform.pitch>20&&Dt.texParameterf(Dt.TEXTURE_2D,It.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,It.extTextureFilterAnisotropicMax);const ns=it.transform;let _i;const $n=mt?jw(ns):[0,0,0,0];let qn,ms,Ns,to,_o,is=0;if(St&&Ht instanceof c.aU&&Ht.coordinates.length>3)qn=Float32Array.from(c.bk(c.dJ(new c.cD(0,0,0)))),ms=Float32Array.from(ns.globeMatrix),Ns=Float32Array.from(c.dF(ns)),to=[c.aF(ns.center.lng),c.aJ(ns.center.lat)],_i=Ht.elevatedGlobePerspectiveTransform,_o=Ht.elevatedGlobeGridMatrix||new Float32Array(9);else if(St){const Do=c.dG(vr.canonical);is=c.dH(Do.getCenter().lat),qn=Float32Array.from(c.bk(c.dJ(vr.canonical))),ms=Float32Array.from(ns.globeMatrix),Ns=Float32Array.from(c.dF(ns)),to=[c.aF(ns.center.lng),c.aJ(ns.center.lat)],_i=[0,0],_o=Float32Array.from(c.dI(vr.canonical,Do,is,ns.worldSize/ns._pixelsPerMercatorPixel))}else _i=Ht instanceof c.aU?Ht.perspectiveTransform:[0,0],qn=new Float32Array(16),ms=new Float32Array(9),Ns=new Float32Array(16),to=[0,0],_o=new Float32Array(9);const go=Pw(an,qn,ms,Ns,_o,In||[0,0],c.aj(it.transform.zoom),to,$n,Ln||1,Hn,$,_i,mt?$.paint.get("raster-elevation"):0,2,rn,pn,Gt.range,Pn,Kr,qt),Ds=it.isTileAffectedByFog(vr),To=it.getOrCreateProgram("raster",{defines:Gt.defines,overrideFog:Ds});if(it.uploadCommonUniforms(It,To,kr),Ht instanceof c.aU){const Do=Ht.elevatedGlobeVertexBuffer,Po=Ht.elevatedGlobeIndexBuffer;if(Zt||!pt)Ht.boundsBuffer&&Ht.boundsSegments&&To.draw(it,Dt.TRIANGLES,jr,Ps.disabled,Qt,Rs.disabled,go,$.id,Ht.boundsBuffer,it.quadTriangleIndexBuffer,Ht.boundsSegments);else if(Do&&Po){const mo=ns.zoom<=c.c_?Ht.elevatedGlobeSegments:Ht.getSegmentsForLongitude(ns.center.lng);mo&&To.draw(it,Dt.TRIANGLES,jr,Ps.disabled,Qt,Rr,go,$.id,Do,Po,mo)}}else if(St){jr=new as(Dt.LEQUAL,as.ReadOnly,it.depthRangeFor3D);const Do=it.globeSharedBuffers;if(Do){const[Po,mo,Vs]=Do.getGridBuffers(is,!1);To.draw(it,Dt.TRIANGLES,jr,Er||Xr,it.colorModeForRenderPass(),Rr,go,$.id,Po,mo,Vs)}}else{const{tileBoundsBuffer:Do,tileBoundsIndexBuffer:Po,tileBoundsSegments:mo}=it.getTileBoundsBuffers(Ur);To.draw(it,Dt.TRIANGLES,jr,Xr,Qt,Rs.disabled,go,$.id,Do,Po,mo)}}if(!(Ht instanceof c.aU)&&St)for(const vr of Tr){const kr=vr.canonical.y===(1<<vr.canonical.z)-1;vr.canonical.y===0&&Ny(!0,vr,it,d,$,qt,Gt,Rr,Er||Ps.disabled),kr&&Ny(!1,vr,it,d,$,qt,Gt,Rr===Rs.frontCW?Rs.backCW:Rs.frontCW,Er||Ps.disabled)}};St?Ir(gr,it.renderElevatedRasterBackface?Rs.backCW:Rs.frontCW,it.stencilModeFor3D()):Ir(gr,Rs.disabled,void 0),it.resetStencilClippingMasks()},"raster-particle":function(it,d,$,st,lt,ht){it.renderPass==="offscreen"&&function(pt,mt,St,It){if(!It.length)return;const Dt=pt.context,Ht=Dt.gl,Gt=mt.getSource();if(!(Gt instanceof Du))return;const qt=Math.ceil(Math.sqrt(St.paint.get("raster-particle-count")));let Qt=St.particlePositionRGBAImage;if(!Qt||Qt.width!==qt){const gr=function(dr){const Ir=dr*dr,Tr=new Uint8Array(4*Ir),Rr=function(vr){return vr|=0,vr=Math.imul(2747636419^vr,2654435769),vr=Math.imul(vr^vr>>>16,2654435769),((vr=Math.imul(vr^vr>>>16,2654435769))>>>0)/4294967296},Er=1/1.1;for(let vr=0;vr<Ir;vr++){const kr=Er*(Rr(2*vr+0)+Vp),Ur=Er*(Rr(2*vr+1)+Vp),zr=255*kr%1,Jr=255*Ur%1,rn=zr,pn=Ur-Jr/255,Pn=Jr;Tr[4*vr+0]=255*(kr-zr/255),Tr[4*vr+1]=255*rn,Tr[4*vr+2]=255*pn,Tr[4*vr+3]=255*Pn}return Tr}(qt);Qt=St.particlePositionRGBAImage=new c.q({width:qt,height:qt},gr)}let Zt=St.particleFramebuffer;Zt?Zt.width!==qt&&(Zt.destroy(),Zt=St.particleFramebuffer=Dt.createFramebuffer(qt,qt,1,null)):Zt=St.particleFramebuffer=Dt.createFramebuffer(qt,qt,1,null);const sr=[];for(const gr of It){const dr=mt.getTile(gr);if(!(dr instanceof dx))continue;const Ir=Uv(dr,Gt,St);if(!Ir)continue;const Tr=[dr.tileSize,dr.tileSize];let Rr=St.tileFramebuffer;Rr||(Rr=St.tileFramebuffer=Dt.createFramebuffer(Tr[0],Tr[1],1,null));let Er=dr.rasterParticleState;Er||(Er=dr.rasterParticleState=new t_(Dt,gr,Tr,Qt));const vr=Er.update(St.lastInvalidatedAt);Er.particleTextureDimension!==qt&&Er.updateParticleTexture(gr,Qt);const kr=Er.targetColorTexture;Er.targetColorTexture=Er.backgroundColorTexture,Er.backgroundColorTexture=kr;const Ur=Er.particleTexture0;Er.particleTexture0=Er.particleTexture1,Er.particleTexture1=Ur,sr.push([gr,Ir,Er,vr])}if(sr.length===0)return;const ir=c.o.now(),hr=St.previousDrawTimestamp?.001*(ir-St.previousDrawTimestamp):.0167;if(St.previousDrawTimestamp=ir,St.hasColorMap()){Dt.activeTexture.set(Ht.TEXTURE0+2);let gr=St.colorRampTexture;gr||(gr=St.colorRampTexture=new c.T(Dt,St.colorRamp,Ht.RGBA8)),gr.bind(Ht.LINEAR,Ht.CLAMP_TO_EDGE)}Dt.bindFramebuffer.set(St.tileFramebuffer.framebuffer),function(gr,dr,Ir){const Tr=gr.context,Rr=Tr.gl,Er=dr.tileFramebuffer;Tr.activeTexture.set(Rr.TEXTURE0);const vr={u_texture:0,u_opacity:1.05*(Ur=dr.paint.get("raster-particle-fade-opacity-factor"))/(Ur+.05)},kr=gr.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ur;for(const zr of Ir){const[,,Jr,rn]=zr;Er.colorAttachment0.set(Jr.targetColorTexture.texture),Tr.viewport.set([0,0,Er.width,Er.height]),Tr.clear({color:c.ao.transparent}),rn&&(Jr.backgroundColorTexture.bind(Rr.NEAREST,Rr.CLAMP_TO_EDGE),kr.draw(gr,Rr.TRIANGLES,as.disabled,Ps.disabled,Bs.alphaBlended,Rs.disabled,vr,dr.id,gr.viewportBuffer,gr.quadTriangleIndexBuffer,gr.viewportSegments))}}(pt,St,sr),function(gr,dr,Ir,Tr){const Rr=gr.context,Er=Rr.gl,vr=Ir.tileFramebuffer,kr=gr.transform.projection.name==="globe",Ur=Ir.paint.get("raster-particle-max-speed");for(const zr of Tr){const[Jr,rn,pn]=zr;Rr.activeTexture.set(Er.TEXTURE0+0),rn.texture.bind(Er.LINEAR,Er.CLAMP_TO_EDGE),vr.colorAttachment0.set(pn.targetColorTexture.texture);const Pn=gr.getOrCreateProgram("rasterParticleDraw",{defines:rn.defines,overrideFog:!1});Rr.activeTexture.set(Er.TEXTURE0+1);const Kr=rn.scalarData?[]:[0,1,2,3].map(Xr=>c.e9[Xr](Jr));Kr.push(Jr);const jr=Jr.canonical.x,an=Jr.canonical.y;for(const Xr of Kr){const bn=dr.getTile(kr?Xr.wrapped():Xr);if(!bn)continue;const Fn=bn.rasterParticleState;if(!Fn)continue;const Hn=Xr.canonical.x+(1<<Xr.canonical.z)*(Xr.wrap-Jr.wrap),Ln=Xr.canonical.y;Fn.particleTexture0.bind(Er.NEAREST,Er.CLAMP_TO_EDGE);const In=mT(1,Fn.particleTexture0.size[0],[Hn-jr,Ln-an],0,rn.texture.size,2,Ur,rn.textureOffset,rn.scale,rn.offset);Pn.draw(gr,Er.POINTS,as.disabled,Ps.disabled,Bs.alphaBlended,Rs.disabled,In,Ir.id,Fn.particleIndexBuffer,void 0,Fn.particleSegment)}}}(pt,mt,St,sr),Dt.bindFramebuffer.set(St.particleFramebuffer.framebuffer),function(gr,dr,Ir,Tr){const Rr=gr.context,Er=Rr.gl,vr=dr.paint.get("raster-particle-max-speed"),kr=Tr*dr.paint.get("raster-particle-speed-factor")*.15,Ur=function(Jr){return Math.pow(Jr,6)}(.01+1*dr.paint.get("raster-particle-reset-rate-factor")),zr=dr.particleFramebuffer;Rr.viewport.set([0,0,zr.width,zr.height]);for(const Jr of Ir){const[,rn,pn]=Jr;Rr.activeTexture.set(Er.TEXTURE0+0),rn.texture.bind(Er.LINEAR,Er.CLAMP_TO_EDGE),Rr.activeTexture.set(Er.TEXTURE0+1);const Pn=pn.particleTexture0;Pn.bind(Er.NEAREST,Er.CLAMP_TO_EDGE);const Kr=kw(1,Pn.size[0],0,rn.texture.size,vr,kr,Ur,rn.textureOffset,rn.scale,rn.offset);zr.colorAttachment0.set(pn.particleTexture1.texture),Rr.clear({color:c.ao.transparent}),gr.getOrCreateProgram("rasterParticleUpdate",{defines:rn.defines}).draw(gr,Er.TRIANGLES,as.disabled,Ps.disabled,Bs.unblended,Rs.disabled,Kr,dr.id,gr.viewportBuffer,gr.quadTriangleIndexBuffer,gr.viewportSegments)}}(pt,St,sr,hr)}(it,d,$,st),it.renderPass==="translucent"&&(function(pt,mt,St,It,Dt){const Ht=pt.context,Gt=Ht.gl,qt=mt.getSource().tileSize,Qt=5*(1-c.ah(c.cL,c.cL+1,pt.transform.zoom))*qt+St.paint.get("raster-particle-elevation"),Zt=!pt.options.moving,sr=pt.transform.projection.name==="globe";if(!It.length)return;const[ir,hr]=pt.stencilConfigForOverlap(It),gr=[];sr&&gr.push("PROJECTION_GLOBE_VIEW");const dr=pt.stencilModeFor3D();for(const Ir of hr){const Tr=Ir.toUnwrapped(),Rr=mt.getTile(Ir);if(!Rr.rasterParticleState)continue;const Er=Rr.rasterParticleState,vr=100;Rr.registerFadeDuration(vr);const kr=mt.findLoadedParent(Ir,0),Ur=Ry(Rr,kr,mt,pt.transform,vr);let zr,Jr;pt.terrain&&pt.terrain.prepareDrawTile(),Ht.activeTexture.set(Gt.TEXTURE0),Er.targetColorTexture.bind(Gt.LINEAR,Gt.CLAMP_TO_EDGE),Ht.activeTexture.set(Gt.TEXTURE1),kr&&kr.rasterParticleState?(kr.rasterParticleState.targetColorTexture.bind(Gt.LINEAR,Gt.CLAMP_TO_EDGE),zr=Math.pow(2,kr.tileID.overscaledZ-Rr.tileID.overscaledZ),Jr=[Rr.tileID.canonical.x*zr%1,Rr.tileID.canonical.y*zr%1]):Er.targetColorTexture.bind(Gt.LINEAR,Gt.CLAMP_TO_EDGE);const rn=sr?Float32Array.from(pt.transform.expandedFarZProjMatrix):pt.transform.calculateProjMatrix(Tr,Zt),pn=pt.transform,Pn=Ow(pn),Kr=c.dG(Ir.canonical),jr=c.dH(Kr.getCenter().lat);let an,Xr,bn,Fn,Hn;sr?(an=Float32Array.from(c.bk(c.dJ(Ir.canonical))),Xr=Float32Array.from(pn.globeMatrix),bn=Float32Array.from(c.dF(pn)),Fn=[c.aF(pn.center.lng),c.aJ(pn.center.lat)],Hn=Float32Array.from(c.dI(Ir.canonical,Kr,jr,pn.worldSize/pn._pixelsPerMercatorPixel))):(an=new Float32Array(16),Xr=new Float32Array(9),bn=new Float32Array(16),Fn=[0,0],Hn=new Float32Array(9));const Ln=fT(rn,an,Xr,bn,Hn,Jr||[0,0],c.aj(pt.transform.zoom),Fn,Pn,zr||1,Ur,Qt),In=pt.isTileAffectedByFog(Ir),ns=pt.getOrCreateProgram("rasterParticle",{defines:gr,overrideFog:In});if(pt.uploadCommonUniforms(Ht,ns,Tr),sr){const _i=new as(Gt.LEQUAL,as.ReadOnly,pt.depthRangeFor3D),$n=0,qn=pt.globeSharedBuffers;if(qn){const[ms,Ns,to]=qn.getGridBuffers(jr,$n!==0);ns.draw(pt,Gt.TRIANGLES,_i,dr,Bs.alphaBlended,pt.renderElevatedRasterBackface?Rs.frontCCW:Rs.backCCW,Ln,St.id,ms,Ns,to)}}else{const _i=pt.depthModeForSublayer(0,as.ReadOnly),$n=ir[Ir.overscaledZ],{tileBoundsBuffer:qn,tileBoundsIndexBuffer:ms,tileBoundsSegments:Ns}=pt.getTileBoundsBuffers(Rr);ns.draw(pt,Gt.TRIANGLES,_i,$n,Bs.alphaBlended,Rs.disabled,Ln,St.id,qn,ms,Ns)}}pt.resetStencilClippingMasks()}(it,d,$,st),it.style.map.triggerRepaint())},background:function(it,d,$,st){const lt=$.paint.get("background-color"),ht=$.paint.get("background-color-use-theme").constantOr("default")==="none",pt=$.paint.get("background-opacity"),mt=$.paint.get("background-emissive-strength"),St=$.paint.get("background-pitch-alignment")==="viewport";if(pt===0)return;const It=it.context,Dt=It.gl,Ht=it.transform,Gt=Ht.tileSize,qt=$.paint.get("background-pattern");let Qt;if(qt!==void 0&&(qt===null||(Qt=it.imageManager.getPattern(c.I.from(qt.toString()),$.scope,it.style.getLut($.scope)),!Qt)))return;const Zt=!qt&&lt.a===1&&pt===1&&it.opaquePassEnabledForLayer()?"opaque":"translucent";if(it.renderPass!==Zt)return;const sr=Ps.disabled,ir=it.depthModeForSublayer(0,Zt==="opaque"?as.ReadWrite:as.ReadOnly),hr=it.colorModeForDrapableLayerRenderPass(mt),gr=qt?"backgroundPattern":"background";let dr,Ir=st;Ir||(dr=it.getBackgroundTiles(),Ir=Object.values(dr).map(Rr=>Rr.tileID)),qt&&(It.activeTexture.set(Dt.TEXTURE0),it.imageManager.bind(it.context,$.scope));const Tr=[];if(it.terrain&&it.terrain.renderingToTexture&&it.emissiveMode==="mrt-fallback"&&Tr.push("USE_MRT1"),St){const Rr=it.getOrCreateProgram(gr,{overrideFog:!1,overrideRtt:!0,defines:Tr}),Er=new Float32Array(c.bA([])),vr=new c.aQ(0,0,0,0,0),kr=qt?Nm(Er,mt,pt,it,0,$.scope,Qt,St,{tileID:vr,tileSize:Gt}):Iy(Er,mt,pt,lt.toPremultipliedRenderColor(ht?null:$.lut));Rr.draw(it,Dt.TRIANGLES,ir,sr,hr,Rs.disabled,kr,$.id,it.viewportBuffer,it.quadTriangleIndexBuffer,it.viewportSegments)}else for(const Rr of Ir){const Er=it.isTileAffectedByFog(Rr),vr=it.getOrCreateProgram(gr,{overrideFog:Er,defines:Tr}),kr=Rr.toUnwrapped(),Ur=st?Rr.projMatrix:it.transform.calculateProjMatrix(kr);it.prepareDrawTile();const zr=d?d.getTile(Rr):dr?dr[Rr.key]:new Ym(Rr,Gt,Ht.zoom,it),Jr=qt?Nm(Ur,mt,pt,it,0,$.scope,Qt,St,{tileID:Rr,tileSize:Gt}):Iy(Ur,mt,pt,lt.toPremultipliedRenderColor(ht?null:$.lut));it.uploadCommonUniforms(It,vr,kr);const{tileBoundsBuffer:rn,tileBoundsIndexBuffer:pn,tileBoundsSegments:Pn}=it.getTileBoundsBuffers(zr);vr.draw(it,Dt.TRIANGLES,ir,sr,hr,Rs.disabled,Jr,$.id,rn,pn,Pn)}},sky:function(it,d,$){const st=it._atmosphere?c.aj(it.transform.zoom):1,lt=$.paint.get("sky-opacity")*st;if(lt===0)return;const ht=it.context,pt=$.paint.get("sky-type"),mt=new as(ht.gl.LEQUAL,as.ReadOnly,[0,1]),St=it.frameCounter/1e3%1;pt==="atmosphere"?it.renderPass==="offscreen"?$.needsSkyboxCapture(it)&&(function(It,Dt,Ht,Gt){const qt=It.context,Qt=qt.gl;let Zt=Dt.skyboxFbo;if(!Zt){Zt=Dt.skyboxFbo=qt.createFramebuffer(32,32,1,null),Dt.skyboxGeometry=new n_(qt),Dt.skyboxTexture=qt.gl.createTexture(),Qt.bindTexture(Qt.TEXTURE_CUBE_MAP,Dt.skyboxTexture),Qt.texParameteri(Qt.TEXTURE_CUBE_MAP,Qt.TEXTURE_WRAP_S,Qt.CLAMP_TO_EDGE),Qt.texParameteri(Qt.TEXTURE_CUBE_MAP,Qt.TEXTURE_WRAP_T,Qt.CLAMP_TO_EDGE),Qt.texParameteri(Qt.TEXTURE_CUBE_MAP,Qt.TEXTURE_MIN_FILTER,Qt.LINEAR),Qt.texParameteri(Qt.TEXTURE_CUBE_MAP,Qt.TEXTURE_MAG_FILTER,Qt.LINEAR);for(let gr=0;gr<6;++gr)Qt.texImage2D(Qt.TEXTURE_CUBE_MAP_POSITIVE_X+gr,0,Qt.RGBA,32,32,0,Qt.RGBA,Qt.UNSIGNED_BYTE,null)}qt.bindFramebuffer.set(Zt.framebuffer),qt.viewport.set([0,0,32,32]);const sr=Dt.getCenter(It,!0),ir=It.getOrCreateProgram("skyboxCapture"),hr=new Float64Array(16);c.bA(hr),c.en(hr,hr,.5*-Math.PI),c0(It,Dt,ir,hr,sr,0),c.bA(hr),c.en(hr,hr,.5*Math.PI),c0(It,Dt,ir,hr,sr,1),c.bA(hr),c.cU(hr,hr,.5*-Math.PI),c0(It,Dt,ir,hr,sr,2),c.bA(hr),c.cU(hr,hr,.5*Math.PI),c0(It,Dt,ir,hr,sr,3),c.bA(hr),c0(It,Dt,ir,hr,sr,4),c.bA(hr),c.en(hr,hr,Math.PI),c0(It,Dt,ir,hr,sr,5),qt.viewport.set([0,0,It.width,It.height])}(it,$),$.markSkyboxValid(it)):it.renderPass==="sky"&&function(It,Dt,Ht,Gt,qt){const Qt=It.context,Zt=Qt.gl,sr=It.transform,ir=It.getOrCreateProgram("skybox");Qt.activeTexture.set(Zt.TEXTURE0),Zt.bindTexture(Zt.TEXTURE_CUBE_MAP,Dt.skyboxTexture);const hr=((gr,dr,Ir,Tr,Rr)=>({u_matrix:gr,u_sun_direction:dr,u_cubemap:0,u_opacity:Tr,u_temporal_offset:Rr}))(sr.skyboxMatrix,Dt.getCenter(It,!1),0,Gt,qt);It.uploadCommonUniforms(Qt,ir),ir.draw(It,Zt.TRIANGLES,Ht,Ps.disabled,It.colorModeForRenderPass(),Rs.backCW,hr,"skybox",Dt.skyboxGeometry.vertexBuffer,Dt.skyboxGeometry.indexBuffer,Dt.skyboxGeometry.segment)}(it,$,mt,lt,St):pt==="gradient"&&it.renderPass==="sky"&&function(It,Dt,Ht,Gt,qt){const Qt=It.context,Zt=Qt.gl,sr=It.transform,ir=It.getOrCreateProgram("skyboxGradient");Dt.skyboxGeometry||(Dt.skyboxGeometry=new n_(Qt)),Qt.activeTexture.set(Zt.TEXTURE0);let hr=Dt.colorRampTexture;hr||(hr=Dt.colorRampTexture=new c.T(Qt,Dt.colorRamp,Zt.RGBA8)),hr.bind(Zt.LINEAR,Zt.CLAMP_TO_EDGE);const gr=((dr,Ir,Tr,Rr,Er)=>({u_matrix:dr,u_color_ramp:0,u_center_direction:Ir,u_radius:c.an(Tr),u_opacity:Rr,u_temporal_offset:Er}))(sr.skyboxMatrix,Dt.getCenter(It,!1),Dt.paint.get("sky-gradient-radius"),Gt,qt);It.uploadCommonUniforms(Qt,ir),ir.draw(It,Zt.TRIANGLES,Ht,Ps.disabled,It.colorModeForRenderPass(),Rs.backCW,gr,"skyboxGradient",Dt.skyboxGeometry.vertexBuffer,Dt.skyboxGeometry.indexBuffer,Dt.skyboxGeometry.segment)}(it,$,mt,lt,St)},custom:function(it,d,$,st){const lt=it.context,ht=$.implementation;if(!it.transform.projection.unsupportedLayers||!it.transform.projection.unsupportedLayers.includes("custom")||it.terrain&&(it.terrain.renderingToTexture||it.renderPass==="offscreen")&&$.isDraped(d)){if(it.renderPass==="offscreen"){const pt=ht.prerender;if(pt){if(it.setCustomLayerDefaults(),lt.setColorMode(it.colorModeForRenderPass()),it.transform.projection.name==="globe"){const mt=it.transform.pointMerc;pt.call(ht,lt.gl,it.transform.customLayerMatrix(),it.transform.getProjection(),it.transform.globeToMercatorMatrix(),c.aj(it.transform.zoom),[mt.x,mt.y],it.transform.pixelsPerMeterRatio)}else pt.call(ht,lt.gl,it.transform.customLayerMatrix());lt.setDirty(),it.setBaseState()}}else if(it.renderPass==="translucent"){if(it.terrain&&it.terrain.renderingToTexture){const mt=ht.renderToTile;if(mt){const St=st[0].canonical,It={x:St.x+st[0].wrap*(ht.wrapTileId?0:1<<St.z),y:St.y,z:St.z};lt.setDepthMode(as.disabled),lt.setStencilMode(Ps.disabled),lt.setColorMode(it.colorModeForRenderPass()),it.setCustomLayerDefaults(),mt.call(ht,lt.gl,It),lt.setDirty(),it.setBaseState()}return}it.setCustomLayerDefaults(),lt.setColorMode(it.colorModeForRenderPass()),lt.setStencilMode(Ps.disabled);const pt=ht.renderingMode==="3d"?new as(it.context.gl.LEQUAL,as.ReadWrite,it.depthRangeFor3D):it.depthModeForSublayer(0,as.ReadOnly);if(lt.setDepthMode(pt),it.transform.projection.name==="globe"){const mt=it.transform.pointMerc;ht.render(lt.gl,it.transform.customLayerMatrix(),it.transform.getProjection(),it.transform.globeToMercatorMatrix(),c.aj(it.transform.zoom),[mt.x,mt.y],it.transform.pixelsPerMeterRatio)}else ht.render(lt.gl,it.transform.customLayerMatrix());lt.setDirty(),it.setBaseState(),lt.bindFramebuffer.set(null)}}else c.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(it,d,$,st){if(it.renderPass==="opaque")return;const lt=$.paint.get("model-opacity").constantOr(1),ht=$.paint.get("model-elevation-reference"),pt=ht==="ground",mt=ht==="ground";if(lt===0)return;const St=$.paint.get("model-cast-shadows");if(it.renderPass==="shadow"&&(!St||it.terrain&&lt<.65&&$._transitionablePaint._values["model-opacity"].value.expression instanceof c.ad))return;const It=it.shadowRenderer,Dt=$.paint.get("model-receive-shadows");It&&(It.useNormalOffset=!0,Dt||(It.enabled=!1));const Ht=()=>{It&&(It.useNormalOffset=!0,Dt||(It.enabled=!0))},Gt=d.getSource();if(it.renderPass==="light-beam"&&Gt.type!=="batched-model")return;if(Gt.type==="vector"||Gt.type==="geojson")return function(dr,Ir,Tr,Rr,Er){const vr=dr.transform,kr=vr.projection.name==="globe",Ur=vr.getFreeCameraOptions().position;if(!dr.modelManager)return;const zr=dr.modelManager;Tr.modelManager=zr;const Jr=dr.shadowRenderer;if(!Tr._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const rn=Tr._unevaluatedLayout._values["model-id"],pn=Object.assign({},Tr.layout.get("model-id").parameters),Pn=dr.style.order.indexOf(Tr.fqid),Kr=Tr.paint.get("model-opacity").constantOr(1);for(const jr of Rr){const an=Ir.getTile(jr).getBucket(Tr);if(!an||an.projection.name!==vr.projection.name)continue;const Xr=an.getModelUris();if(Xr&&!an.modelsRequested&&(zr.addModelsFromBucket(Xr,Er),an.modelsRequested=!0),kr)pn.zoom=jr.overscaledZ;else{const $n=Bu(jr,vr);pn.zoom=$n}const bn=rn.possiblyEvaluate(pn);if(qw(dr,an,jr),$p.shadowUniformsInitialized=!1,$p.useSingleShadowCascade=!!Jr&&Jr.getMaxCascadeForTile(jr.toUnwrapped())===0,dr.renderPass==="shadow"&&Jr){if(dr.currentShadowCascade===1&&an.isInsideFirstShadowMapFrustum)continue;const $n=vr.calculatePosMatrix(jr.toUnwrapped(),vr.worldSize);if($p.tileMatrix.set($n),$p.shadowTileMatrix=Float32Array.from(Jr.calculateShadowPassMatrixFromMatrix($n)),$p.aabb.min=[0,0,0],$p.aabb.max[0]=$p.aabb.max[1]=c.al,$p.aabb.max[2]=0,_T(an,$p,dr,Tr.scope))continue}const Fn=1<<jr.canonical.z,Hn=[((Ur.x-jr.wrap)*Fn-jr.canonical.x)*c.al,(Ur.y*Fn-jr.canonical.y)*c.al,Ur.z*Fn*c.al];dr.conflationActive&&Object.keys(an.instancesPerModel).length>0&&dr.style.isLayerClipped(Tr,Ir.getSource())&&an.updateReplacement(jr,dr.replacementSource,Pn,Tr.scope)&&(an.uploaded=!1,an.upload(dr.context));let Ln=0;const In=new Array,ns=new Array,_i=new Array;for(let $n in an.instancesPerModel){const qn=an.instancesPerModel[$n];qn.features.length>0&&!kr&&($n=bn.evaluate(qn.features[0].feature,{}));const ms=zr.getModel($n,Er);if(ms||zr.hasURLBeenRequested($n)||an.modelUris.includes($n)||(an.modelUris.push($n),an.modelsRequested=!1),ms&&ms.uploaded)if(kr){const Ns=c.c5([],[Ur.x,Ur.y,Ur.z],dr.transform.worldSize);c.ew(Ns,Ns);for(let to=0;to<qn.instancedDataArray.length;++to){const _o=[0,0,0],is=[1,1,1],go=c.ex(),Ds=qn.tileCoordinatesForInstance(to),To=qn.transformForInstance(to);c.ey(is,To),c.ez(go,To),c.eA(_o,go);const Do=qn.translationForInstance(to),Po=new c.aT(0,0);c.eB(an.canonical,Po,Ds.x,Ds.y);const mo=c.bC();c.eC(mo,ms,dr.transform,Po,_o,is,Do,!0,!1,!1);const Vs=qn.colorForInstance(to),bo=c.bA([]),Al=c.ef(Po.lat,dr.transform.zoom),xa=c.bq([],[1,1,1/Al]);c.br(bo,bo,Ns),_i.push({zScaleMatrix:xa,negCameraPosMatrix:bo});for(const So of ms.nodes)u0(dr,So,mo,dr.transform.expandedFarZProjMatrix,Ln,In,ns,ms.materialOverrides,Kr,Vs);++Ln}}else for(const Ns of ms.nodes)Kw(dr,Tr,Ns,qn,Hn,jr,$p)}if(kr)if(dr.renderPass==="shadow"){for(const $n of ns)Rp($n.mesh,$n.nodeModelMatrix,dr,Tr);for(const $n of In)Rp($n.mesh,$n.nodeModelMatrix,dr,Tr)}else Ww(dr,Tr,In,ns,_i)}}(it,d,$,st,Ly(it,$)),void Ht();if(!Gt.loaded())return;if(Gt.type==="batched-model")return function(dr,Ir,Tr,Rr){Tr.resetLayerRenderingStats(dr);const Er=dr.context,vr=dr.transform,kr=dr.style.fog,Ur=dr.shadowRenderer;if(vr.projection.name!=="mercator")return void c.w(`Drawing 3D landmark models for ${vr.projection.name} projection is not yet implemented`);const zr=dr.transform.getFreeCameraOptions().position,Jr=c.c5([],[zr.x,zr.y,zr.z],dr.transform.worldSize),rn=c.ew([],Jr),pn=c.bA([]),Pn=c.ef(vr.center.lat,vr.zoom),Kr=c.bq([],[1,1,1/Pn]);c.br(pn,pn,rn);const jr=Tr.paint.get("model-opacity").constantOr(1),an=new as(Er.gl.LEQUAL,as.ReadWrite,dr.depthRangeFor3D),Xr=new as(Er.gl.LEQUAL,as.ReadOnly,dr.depthRangeFor3D),bn=new c.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Fn=dr.renderPass==="shadow",Hn=Fn&&Ur?Ur.getCurrentCascadeFrustum():vr.getFrustum(vr.scaleZoom(vr.worldSize)),Ln=Tr.paint.get("model-front-cutoff"),In=Ln[2]<1,ns=Cm(dr,Tr.paint.get("model-cutoff-fade-range")),_i=Tr.getLayerRenderingStats();(function($n,qn,ms,Ns){const to=$n.terrain?$n.terrain.exaggeration():0,_o=$n.transform.zoom;for(const is of Ns){const go=qn.getTile(is).getBucket(ms);go&&(go.setFilter(ms.filter),$n.conflationActive&&go.updateReplacement(is,$n.replacementSource),go.evaluateTransform($n,ms),$n.terrain&&to>0&&go.elevationUpdate($n.terrain,to,is,ms.source),go.needsReEvaluation($n,_o,ms)&&go.evaluate(ms))}})(dr,Ir,Tr,Rr),function(){let $n,qn,ms;In?($n=Rr.length-1,qn=-1,ms=-1):($n=0,qn=Rr.length,ms=1);const Ns=new Float64Array(16),to=c.cA(),_o=new c.P(0,0);for(let is=$n;is!==qn;is+=ms){const go=Rr[is],Ds=Ir.getTile(go).getBucket(Tr);if(!Ds||!Ds.uploaded)continue;let To=!1;Ur&&(To=Ur.getMaxCascadeForTile(go.toUnwrapped())===0);const Do=vr.calculatePosMatrix(go.toUnwrapped(),vr.worldSize),Po=Ds.modelTraits;!Fn&&In&&(c.bl(Ns,Do),c.af(to,Jr,Ns),_o.x=to[0],_o.y=to[1]);const mo=[];Ds.setFilter(Tr.filter);for(const Vs of Ds.getNodesInfo()){if(Vs.hiddenByReplacement||!Vs.node.meshes)continue;const bo=Vs.node;let Al=0;dr.terrain&&bo.elevation&&(Al=bo.elevation*dr.terrain.exaggeration());const xa=(()=>{const Pu=Vs.aabb;return bn.min=[...Pu.min],bn.max=[...Pu.max],bn.min[2]+=Al,bn.max[2]+=Al,c.af(bn.min,bn.min,Do),c.af(bn.max,bn.max,Do),bn})(),So=Vs.evaluatedScale;if(So[0]<=1&&So[1]<=1&&So[2]<=1&&xa.intersects(Hn)===0)continue;if(!Fn&&In){const Pu=.16666666666666666;Vs.cameraCollisionOpacity=Jr[0]>xa.min[0]&&Jr[0]<xa.max[0]&&Jr[1]>xa.min[1]&&Jr[1]<xa.max[1]&&Jr[2]*Pn<xa.max[2]&&bo.footprint&&c.c0(_o,bo.footprint)?Math.max(Vs.cameraCollisionOpacity-Pu,0):Math.min(1,Vs.cameraCollisionOpacity+Pu)}const uo=[...Do],Us=1/c.d7(go.canonical),Yo=bo.anchor?bo.anchor[0]:0,Fl=bo.anchor?bo.anchor[1]:0;c.br(uo,uo,[Yo*(So[0]-1)+Vs.evaluatedTranslation[0]*Us,Fl*(So[1]-1)+Vs.evaluatedTranslation[1]*Us,Al+Vs.evaluatedTranslation[2]]),c.cq(So,c.eE)||c.cS(uo,uo,So);const wl=c.aB([],uo,bo.globalMatrix),Oo=c.aB([],vr.expandedFarZProjMatrix,wl),zu=c.aB([],vr.expandedFarZProjMatrix,uo),Eu=c.aC([],[Yo,Fl,Al,1],Oo)[2];bo.hidden=!1;let nu=jr;Fn||(In&&(nu*=Vs.cameraCollisionOpacity,nu*=Ys(uo,vr,Vs.aabb,Ln)),nu*=ga(ns,Eu)),nu!==0?mo.push({nodeInfo:Vs,depth:Eu,opacity:nu,wvpForNode:Oo,wvpForTile:zu,nodeModelMatrix:wl,tileModelMatrix:uo}):bo.hidden=!0}Fn||mo.sort((Vs,bo)=>!In||Vs.opacity===1&&bo.opacity===1?Vs.depth<bo.depth?-1:1:Vs.opacity===1?-1:bo.opacity===1?1:Vs.depth>bo.depth?-1:1);for(const Vs of mo){const bo=Vs.nodeInfo,Al=bo.node;let xa=c.aB([],Kr,Vs.tileModelMatrix);c.aB(xa,pn,xa);const So=c.bl([],xa);c.eg(So,So),c.cS(So,So,jy),xa=c.aB(xa,xa,Al.globalMatrix);const uo=dr.renderPass==="light-beam",Us=Tr.paint.get("model-color-use-theme").constantOr("default")==="none",Yo=Po&c.eI.HasMapboxMeshFeatures,Fl=Yo?0:bo.evaluatedRMEA[0][2];for(let wl=0;wl<Al.meshes.length;++wl){const Oo=Al.meshes[wl],zu=wl===Al.lightMeshIndex;let Eu=Vs.wvpForNode;if(zu){if(!uo&&!dr.terrain&&dr.shadowRenderer){dr.currentLayer<dr.firstLightBeamLayer&&(dr.firstLightBeamLayer=dr.currentLayer);continue}Eu=Vs.wvpForTile}else if(uo)continue;const nu={defines:[]},Pu=[];if(!Fn&&Ur&&(Ur.useNormalOffset=!!Oo.normalBuffer),o_(nu.defines,Pu,Oo,dr,Us?null:Tr.lut),Yo||nu.defines.push("DIFFUSE_SHADED"),To&&nu.defines.push("SHADOWS_SINGLE_CASCADE"),_i&&(Fn?_i.numRenderedVerticesInShadowPass+=Oo.vertexArray.length:_i.numRenderedVerticesInTransparentPass+=Oo.vertexArray.length),Fn){Rp(Oo,Vs.nodeModelMatrix,dr,Tr);continue}let Iu=null;if(kr){const Gl=s_(Vs.nodeModelMatrix,dr.transform);if(Iu=new Float32Array(Gl),vr.projection.name!=="globe"){const Fo=Oo.aabb.min,Kl=Oo.aabb.max,[Rl,El]=kr.getOpacityForBounds(Gl,Fo[0],Fo[1],Kl[0],Kl[1]);nu.overrideFog=Rl>=mn||El>=mn}}const xu=Oo.material;let np;xu.occlusionTexture&&xu.occlusionTexture.offsetScale&&(np=xu.occlusionTexture.offsetScale,nu.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const _p=dr.getOrCreateProgram("model",nu);!Fn&&Ur&&Ur.setupShadowsFromMatrix(Vs.tileModelMatrix,_p,Ur.useNormalOffset),dr.uploadCommonUniforms(Er,_p,null,Iu);const qu=xu.pbrMetallicRoughness;qu.metallicFactor=.9,qu.roughnessFactor=.5;const Nl=i0(new Float32Array(Eu),new Float32Array(xa),new Float32Array(So),new Float32Array(Al.globalMatrix),dr,Vs.opacity,qu.baseColorFactor,xu.emissiveFactor,qu.metallicFactor,qu.roughnessFactor,xu,Fl,Tr,[0,0,0],np);!zu&&(bo.hasTranslucentParts||Vs.opacity<1)&&_p.draw(dr,Er.gl.TRIANGLES,an,Ps.disabled,Bs.disabled,Rs.backCCW,Nl,Tr.id,Oo.vertexBuffer,Oo.indexBuffer,Oo.segments,Tr.paint,dr.transform.zoom,void 0,Pu),_p.draw(dr,Er.gl.TRIANGLES,zu?Xr:an,Ps.disabled,zu||Vs.opacity<1||bo.hasTranslucentParts?Bs.alphaBlended:Bs.unblended,Rs.backCCW,Nl,Tr.id,Oo.vertexBuffer,Oo.indexBuffer,Oo.segments,Tr.paint,dr.transform.zoom,void 0,Pu)}}}}()}(it,d,$,st),void Ht();if(Gt.type!=="model")return;const qt=Gt.getModels(),Qt=[],Zt=it.transform.getFreeCameraOptions().position,sr=c.c5([],[Zt.x,Zt.y,Zt.z],it.transform.worldSize);c.ew(sr,sr);const ir=[],hr=[];let gr=0;for(const dr of qt){const Ir=d.getFeatureState("",dr.id),Tr={type:"Unknown",id:dr.id,properties:dr.featureProperties},Rr=$.paint.get("model-rotation").evaluate(Tr,Ir),Er=$.paint.get("model-scale").evaluate(Tr,Ir),vr=$.paint.get("model-translation").evaluate(Tr,Ir),kr=$.paint.get("model-opacity").evaluate(Tr,Ir);Gw($,dr.id,Ir,dr.featureProperties,dr.nodeOverrideNames,dr.nodeOverrides),Hw($,dr.id,Ir,dr.featureProperties,dr.materialOverrideNames,dr.materialOverrides),dr.nodeOverrides.size>0&&dr.computeBoundsAndApplyParent(),dr.computeModelMatrix(it,Rr,Er,vr,mt,pt,!1);const Ur=c.bA([]),zr=c.ef(dr.position.lat,it.transform.zoom),Jr=c.bq([],[1,1,1/zr]);c.br(Ur,Ur,sr),Qt.push({zScaleMatrix:Jr,negCameraPosMatrix:Ur});for(const rn of dr.nodes)u0(it,rn,dr.matrix,it.transform.expandedFarZProjMatrix,gr,ir,hr,dr.materialOverrides,kr);gr++}if(ir.sort((dr,Ir)=>Ir.depth-dr.depth),it.renderPass!=="shadow")Ww(it,$,ir,hr,Qt),Ht();else{for(const dr of hr)Rp(dr.mesh,dr.nodeModelMatrix,it,$);for(const dr of ir)Rp(dr.mesh,dr.nodeModelMatrix,it,$);Ht()}}},u_={line:function(it,d,$){if(it.hasElevatedBuckets=!1,it.hasNonElevatedBuckets=!1,it._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||it._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(d){const st=d.getVisibleCoordinates();for(const lt of st){const ht=d.getTile(lt).getBucket(it);if(ht&&(ht.elevationType!=="none"?it.hasElevatedBuckets=!0:it.hasNonElevatedBuckets=!0,it.hasElevatedBuckets&&it.hasNonElevatedBuckets))break}}}else it.hasNonElevatedBuckets=!0},model:function(it,d,$){const st=d.getSource();if(!st.loaded())return;if(st.type==="vector"||st.type==="geojson")return void($.modelManager&&$.modelManager.upload($,Ly($,it)));if(st.type==="batched-model"||st.type!=="model")return;const lt=st.getModels();for(const ht of lt)ht.upload($.context)},raster:function(it,d,$){const st=d.getSource();if(!(st instanceof Du&&st.loaded()))return;const lt=it.sourceLayer||st.rasterLayerIds&&st.rasterLayerIds[0];if(!lt)return;const ht=it.paint.get("raster-array-band")||st.getInitialBand(lt);if(ht==null)return;const pt=d.getIds().map(mt=>d.getTileByID(mt));for(const mt of pt)mt.updateNeeded(it.id,ht)&&st.prepareTile(mt,lt,it.id,ht)},"raster-particle":function(it,d,$){const st=d.getSource();if(!(st instanceof Du&&st.loaded()))return;const lt=it.sourceLayer||st.rasterLayerIds&&st.rasterLayerIds[0];if(!lt)return;const ht=it.paint.get("raster-particle-array-band")||st.getInitialBand(lt);if(ht==null)return;const pt=d.getIds().map(mt=>d.getTileByID(mt));for(const mt of pt)mt.updateNeeded(it.id,ht)&&st.prepareTile(mt,lt,it.id,ht)}},rp={fill:Zx},h_={fill:function(it,d,$,st){if(!$.layout||$.layout.get("fill-elevation-reference")==="none"||$.paint.get("fill-opacity").constantOr(1)===0)return;const lt=it.context.gl,ht=new as(lt.LEQUAL,as.ReadOnly,it.depthRangeFor3D),pt=new Ps({func:lt.ALWAYS,mask:255},255,255,lt.KEEP,lt.KEEP,lt.REPLACE),mt=it.transform.getFreeCameraOptions().position,St=it.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const It of st){const Dt=d.getTile(It),Ht=Dt.getBucket($);if(!Ht)continue;const Gt=Ht.elevatedStructures;if(!Gt||Gt.depthSegments.segments[0].primitiveLength===0)continue;const qt=Lw(It.toUnwrapped(),mt),Qt=it.translatePosMatrix(It.projMatrix,Dt,$.paint.get("fill-translate"),$.paint.get("fill-translate-anchor")),Zt=n0(Qt,qt,0,1,0);St.draw(it,lt.TRIANGLES,ht,pt,Bs.disabled,Rs.disabled,Zt,$.id,Gt.vertexBuffer,Gt.indexBuffer,Gt.depthSegments,$.paint,it.transform.zoom)}}};class d_{constructor(d,$,st,lt,ht){this.context=new j0(d,$),this.transform=st,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=c.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const pt=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const St of pt)this._debugParams.enabledLayers[St]=!0;for(const St of pt);this.occlusionParams=new F0,this.setup(),this.numSublayers=Xu.maxUnderzooming+Xu.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new c.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new T0(this),this._wireframeDebugCache=new jm,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const mt=new c.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new c.T(this.context,mt,d.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=lt,this.worldview=ht,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(d,$){const st=!!d&&!!d.terrain&&this.transform.projection.supportsTerrain;if(!(st||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new kv(this,d));const lt=this._terrain;this.transform.elevation=st?lt:null,lt.update(d,this.transform,$),this.transform.elevation&&!lt.enabled&&(this.transform.elevation=null)}_updateFog(d){const $=d.fog;if(!$||this.transform.projection.name==="globe"||$.getOpacity(this.transform.pitch)<1||$.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[st,lt]=$.getFovAdjustedRange(this.transform._fov);if(st>lt)return void(this.transform.fogCullDistSq=null);const ht=st+.78*(lt-st);this.transform.fogCullDistSq=ht*ht}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(d){d&&!this._terrain&&(this._terrain=new kv(this,this.style)),this._forceTerrainMode=d}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(d,$){if(this.width=d*c.o.devicePixelRatio,this.height=$*c.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const st of this.style.order)this.style._mergedLayers[st].resize()}setup(){const d=this.context,$=new c.bd;$.emplaceBack(0,0),$.emplaceBack(c.al,0),$.emplaceBack(0,c.al),$.emplaceBack(c.al,c.al),this.tileExtentBuffer=d.createVertexBuffer($,c.bf.members),this.tileExtentSegments=c.bg.simpleSegment(0,0,4,2);const st=new c.bd;st.emplaceBack(0,0),st.emplaceBack(c.al,0),st.emplaceBack(0,c.al),st.emplaceBack(c.al,c.al),this.debugBuffer=d.createVertexBuffer(st,c.bf.members),this.debugSegments=c.bg.simpleSegment(0,0,4,5);const lt=new c.bd;lt.emplaceBack(-1,-1),lt.emplaceBack(1,-1),lt.emplaceBack(-1,1),lt.emplaceBack(1,1),this.viewportBuffer=d.createVertexBuffer(lt,c.bf.members),this.viewportSegments=c.bg.simpleSegment(0,0,4,2);const ht=new c.b1;ht.emplaceBack(0,0,0,0),ht.emplaceBack(c.al,0,c.al,0),ht.emplaceBack(0,c.al,0,c.al),ht.emplaceBack(c.al,c.al,c.al,c.al),this.mercatorBoundsBuffer=d.createVertexBuffer(ht,c.bi.members),this.mercatorBoundsSegments=c.bg.simpleSegment(0,0,4,2);const pt=new c.b0;pt.emplaceBack(0,1,2),pt.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=d.createIndexBuffer(pt);const mt=new c.be;for(const It of[0,1,3,2,0])mt.emplaceBack(It);this.debugIndexBuffer=d.createIndexBuffer(mt),this.emptyTexture=new c.T(d,new c.q({width:1,height:1},Uint8Array.of(0,0,0,0)),d.gl.RGBA8),this.identityMat=c.bC();const St=this.context.gl;this.stencilClearMode=new Ps({func:St.ALWAYS,mask:0},0,255,St.ZERO,St.ZERO,St.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(d){return d._makeTileBoundsBuffers(this.context,this.transform.projection),d._tileBoundsBuffer?{tileBoundsBuffer:d._tileBoundsBuffer,tileBoundsIndexBuffer:d._tileBoundsIndexBuffer,tileBoundsSegments:d._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const d=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,d.TRIANGLES,as.disabled,this.stencilClearMode,Bs.disabled,Rs.disabled,Ay(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(d,$,st){if(!$||this.currentStencilSource===$.id||!d.isTileClipped()||!st||st.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let mt=!1;for(const St of st)if(this._tileClippingMaskIDs[St.key]===void 0){mt=!0;break}if(!mt)return}this.currentStencilSource=$.id;const lt=this.context,ht=lt.gl;this.nextStencilID+st.length>256&&this.clearStencil(),lt.setColorMode(Bs.disabled),lt.setDepthMode(as.disabled);const pt=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const mt of st){const St=$.getTile(mt),It=this._tileClippingMaskIDs[mt.key]=this.nextStencilID++,{tileBoundsBuffer:Dt,tileBoundsIndexBuffer:Ht,tileBoundsSegments:Gt}=this.getTileBoundsBuffers(St);pt.draw(this,ht.TRIANGLES,as.disabled,new Ps({func:ht.ALWAYS,mask:0},It,255,ht.KEEP,ht.KEEP,ht.REPLACE),Bs.disabled,Rs.disabled,Ay(mt.projMatrix),"$clipping",Dt,Ht,Gt)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const d=this.nextStencilID++,$=this.context.gl;return new Ps({func:$.NOTEQUAL,mask:255},d,255,$.KEEP,$.KEEP,$.REPLACE)}stencilModeForClipping(d){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(d);const $=this.context.gl;return new Ps({func:$.EQUAL,mask:255},this._tileClippingMaskIDs[d.key],0,$.KEEP,$.KEEP,$.REPLACE)}stencilConfigForOverlap(d){const $=this.context.gl,st=d.sort((pt,mt)=>mt.overscaledZ-pt.overscaledZ),lt=st[st.length-1].overscaledZ,ht=st[0].overscaledZ-lt+1;if(ht>1){this.currentStencilSource=void 0,this.nextStencilID+ht>256&&this.clearStencil();const pt={};for(let mt=0;mt<ht;mt++)pt[mt+lt]=new Ps({func:$.GEQUAL,mask:255},mt+this.nextStencilID,255,$.KEEP,$.KEEP,$.REPLACE);return this.nextStencilID+=ht,[pt,st]}return[{[lt]:Ps.disabled},st]}colorModeForRenderPass(){const d=this.context.gl;return this._showOverdrawInspector?new Bs([d.CONSTANT_COLOR,d.ONE,d.CONSTANT_COLOR,d.ONE],new c.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Bs.unblended:Bs.alphaBlended}colorModeForDrapableLayerRenderPass(d){const $=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?d!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new Bs([$.ONE,$.ONE_MINUS_SRC_ALPHA,$.CONSTANT_ALPHA,$.ONE_MINUS_SRC_ALPHA],new c.ao(0,0,0,d??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new Bs([$.ONE,$.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,$.ONE_MINUS_SRC_ALPHA],c.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(d,$,st,lt=!1){if(this.depthOcclusion)return new as(this.context.gl.GREATER,as.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!lt)return as.disabled;const ht=1-((1+this.currentLayer)*this.numSublayers+d)*this.depthEpsilon;return new as(st||this.context.gl.LEQUAL,$,[ht,ht])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const d=this.context.gl,$=Math.ceil(this.width),st=Math.ceil(this.height),lt=this.context.bindFramebuffer.get(),ht=d.getParameter(d.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===$&&this.depthFBO.height===st||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),$!==0&&st!==0&&(this.depthFBO=new Nw(this.context,$,st,0,"texture"),this.depthTexture=new c.T(this.context,{width:$,height:st,data:null},d.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(lt),d.bindTexture(d.TEXTURE_2D,ht),this.depthFBO&&(d.bindFramebuffer(d.READ_FRAMEBUFFER,null),d.bindFramebuffer(d.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),d.blitFramebuffer(0,0,$,st,0,0,$,st,d.DEPTH_BUFFER_BIT,d.NEAREST),d.bindFramebuffer(d.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((d,$)=>d+$/this._fpsHistory.length,0))}render(d,$){const st=c.o.now();this._dt=st-this._timeStamp,this._timeStamp=st,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=d.map.repaint,this.style=d,this.options=$;const lt=this.style._mergedLayers,ht=!(!this.terrain||!this.terrain.enabled),pt=()=>this.style._getOrder(ht).filter(Kr=>{const jr=lt[Kr];return!(jr.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[jr.type]});let mt=pt(),St=!1,It=!1,Dt=null,Ht=0,Gt=!1;for(const Kr of mt){const jr=lt[Kr];jr.visibility!=="none"&&(jr.type==="circle"?St=!0:jr.type==="building"?(Dt=jr,++Ht):jr.type==="symbol"&&(jr.hasOcclusionOpacityProperties?It=!0:St=!0))}this.updateEmissiveMode();let qt=mt.map(Kr=>lt[Kr]);const Qt=this.style._mergedSourceCaches;this.imageManager=d.imageManager,this.modelManager=d.modelManager,this.symbolFadeChange=d.placement.symbolFadeChange(c.o.now()),this.imageManager.beginFrame();for(const Kr in Qt){const jr=Qt[Kr];jr.used&&(jr.prepare(this.context),jr.getSource().usedInConflation&&++Ht)}let Zt=!1;for(const Kr of qt)Kr.isHidden(this.transform.zoom)||(Kr.type==="clip"&&(Zt=!0),this.prepareLayer(Kr));const sr={},ir={},hr={},gr={},dr={};for(const Kr in Qt){const jr=Qt[Kr];sr[Kr]=jr.getVisibleCoordinates(),ir[Kr]=sr[Kr].slice().reverse(),hr[Kr]=jr.getVisibleCoordinates(!0).reverse(),gr[Kr]=jr.getShadowCasterCoordinates(),dr[Kr]=jr.sortCoordinatesByDistance(sr[Kr])}const Ir=Kr=>{const jr=this.style.getLayerSourceCache(Kr);return jr&&jr.used?jr.getSource():null};if(Ht||Zt||this._clippingActiveLastFrame){const Kr=[],jr=[];let an=0;for(const Xr of qt)this.isSourceForClippingOrConflation(Xr,Ir(Xr))&&(Kr.push(Xr),jr.push(an)),an++;if(Kr&&(Zt||Kr.length>1)||this._clippingActiveLastFrame){Zt=!1;const Xr=[];for(let bn=0;bn<Kr.length;bn++){const Fn=Kr[bn],Hn=jr[bn],Ln=this.style.getLayerSourceCache(Fn);if(!Ln||!Ln.used||!Ln.getSource().usedInConflation&&Fn.type!=="clip"&&Fn.type!=="building")continue;let In=c.eQ,ns=c.b_.None;const _i=[];let $n=!0;if(Fn.type==="building")In=c.eS;else if(Fn.type==="clip"){In=Hn;for(const qn of Fn.layout.get("clip-layer-types"))ns|=qn==="model"?c.b_.Model:qn==="symbol"?c.b_.Symbol:c.b_.FillExtrusion;for(const qn of Fn.layout.get("clip-layer-scope"))_i.push(qn);Fn.isHidden(this.transform.zoom)?$n=!1:Zt=!0}$n&&Xr.push({layer:Fn.fqid,cache:Ln,order:In,clipMask:ns,clipScope:_i})}this.replacementSource.setSources(Xr),Gt=!0}}this._clippingActiveLastFrame=Zt,Gt||this.replacementSource.clear(),this.conflationActive=Gt,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Kr=0;Kr<qt.length;Kr++){const jr=qt[Kr];if(jr.visibility==="none")continue;const an=jr.cutoffRange();if(this.longestCutoffRange=Math.max(an,this.longestCutoffRange),an>0){const Xr=Ir(jr);Xr&&(this.minCutoffZoom=Math.max(Xr.minzoom,this.minCutoffZoom)),jr.minzoom&&(this.minCutoffZoom=Math.max(jr.minzoom,this.minCutoffZoom))}jr.is3D(ht)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Kr),this._lastOcclusionLayer=Kr)}const Tr=this.style&&this.style.fog;Tr?(this._fogVisible=Tr.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Tr.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(hr),this.opaquePassCutoff=0,mt=pt(),qt=mt.map(Kr=>lt[Kr]));const Rr=this._shadowRenderer;if(Rr){Rr.updateShadowParameters(this.transform,this.style.directionalLight);for(const Kr in Qt)for(const jr of sr[Kr]){let an={min:0,max:0};this.terrain&&(an=this.terrain.getMinMaxForTile(jr)||an),Rr.addShadowReceiver(jr.toUnwrapped(),an.min,an.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new c.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new $w(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Er=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),vr=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Er&&!this._snow&&(this._snow=new qv(this)),!Er&&this._snow&&(this._snow.destroy(),delete this._snow),vr&&!this._rain&&(this._rain=new c_(this)),!vr&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),Dt){this.buildingTileBorderManager||(this.buildingTileBorderManager=new i_);const Kr=this.style.getLayerSourceCache(Dt);this.buildingTileBorderManager.updateBorders(Kr,Dt)}if(!ba.has(this.context.gl))return;this.renderPass="offscreen";for(const Kr of qt){const jr=d.getLayerSourceCache(Kr);if(!Kr.hasOffscreenPass()||Kr.isHidden(this.transform.zoom))continue;const an=jr?ir[jr.id]:void 0;(Kr.type==="custom"||Kr.type==="raster"||Kr.type==="raster-particle"||Kr.isSky()||an&&an.length)&&this.renderLayer(this,jr,Kr,an)}this.depthRangeFor3D=[0,1-(qt.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,gr)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const kr=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ur=(()=>{if($.showOverdrawInspector)return c.ao.black;const Kr=this.style.fog;if(Kr&&this.transform.projection.supportsFog){const jr=this.style.getLut(Kr.scope);if(!kr){const an=Kr.properties.get("color-use-theme")==="none",Xr=Kr.properties.get("color").toNonPremultipliedRenderColor(an?null:jr).toArray01();return new c.ao(...Xr)}if(kr){const an=Kr.properties.get("space-color-use-theme")==="none",Xr=Kr.properties.get("space-color").toNonPremultipliedRenderColor(an?null:jr).toArray01();return new c.ao(...Xr)}}return c.ao.transparent})();if(this.context.clear({color:Ur,depth:1}),this.clearStencil(),this._showOverdrawInspector=$.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&kr&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=mt.length-1;this.currentLayer>=0;this.currentLayer--){const Kr=qt[this.currentLayer],jr=d.getLayerSourceCache(Kr);if(Kr.isSky())continue;const an=jr?(Kr.is3D(ht)?dr:ir)[jr.id]:void 0;this._renderTileClippingMasks(Kr,jr,an),this.renderLayer(this,jr,Kr,an)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&kr&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||c.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<mt.length;this.currentLayer++){const Kr=qt[this.currentLayer],jr=d.getLayerSourceCache(Kr);Kr.isSky()&&this.renderLayer(this,jr,Kr,jr?ir[jr.id]:void 0)}function zr(Kr,jr){let an;return jr&&(an=(Kr.type==="symbol"?hr:Kr.is3D(ht)?dr:ir)[jr.id]),an}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<mt.length;){const Kr=qt[this.currentLayer];if(Kr.type==="raster"||Kr.type==="raster-particle"){const jr=d.getLayerSourceCache(Kr);this.renderLayer(this,jr,Kr,zr(Kr,jr))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Jr=0;Rr&&(Jr=Rr.getShadowCastingLayerCount());let rn=!1,pn=-1;for(let Kr=0;Kr<mt.length;++Kr){const jr=qt[Kr];jr.isHidden(this.transform.zoom)||jr.is3D(ht)&&(pn=Kr)}It&&pn===-1&&(St=!0);let Pn=!1;for(;this.currentLayer<mt.length;){const Kr=qt[this.currentLayer],jr=d.getLayerSourceCache(Kr);if(Kr.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Kr)){if(Kr.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Pn&&Kr.is3D(ht)&&!ht){const an=this.currentLayer,Xr=bn=>{for(this.currentLayer=0;this.currentLayer<qt.length;this.currentLayer++){const Fn=qt[this.currentLayer];if(rp[Fn.type]){const Hn=this.style.getLayerSourceCache(Fn);rp[Fn.type](this,Hn,Fn,zr(Fn,Hn),bn)}}};Xr("initialize"),Xr("reset"),this.currentLayer=an,Pn=!0}if(St&&!rn&&this.terrain&&!this.transform.isOrthographic&&(rn=!0,this.blitDepth()),It&&pn!==-1&&this.currentLayer===pn+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Kr,jr,jr?sr[jr.id]:void 0),this.renderLayer(this,jr,Kr,zr(Kr,jr)),!this.terrain&&Rr&&Jr>0&&Kr.hasShadowPass()&&--Jr==0){{this.clearStencil(),this.resetStencilClippingMasks();const an=this.currentLayer;for(this.currentLayer=0;this.currentLayer<qt.length;this.currentLayer++){const Xr=qt[this.currentLayer];if(h_[Xr.type]){const bn=this.style.getLayerSourceCache(Xr);h_[Xr.type](this,bn,Xr,zr(Xr,bn))}}this.currentLayer=an}if(Rr.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const an=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=an;this.currentLayer++){const Xr=qt[this.currentLayer];if(!Xr.hasLightBeamPass())continue;const bn=d.getLayerSourceCache(Xr);this.renderLayer(this,bn,Xr,bn?ir[bn.id]:void 0)}this.currentLayer=an,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const an=this.currentLayer;this.depthOcclusion=!0;for(const Xr of this.layersWithOcclusionOpacity){this.currentLayer=Xr;const bn=qt[this.currentLayer],Fn=d.getLayerSourceCache(bn),Hn=Fn?ir[Fn.id]:void 0;this.terrain||this._renderTileClippingMasks(bn,Fn,Fn?sr[Fn.id]:void 0),this.renderLayer(this,Fn,bn,Hn)}this.depthOcclusion=!1,this.currentLayer=an,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Kr=null;qt.forEach(jr=>{const an=d.getLayerSourceCache(jr);an&&!jr.isHidden(this.transform.zoom)&&an.getVisibleCoordinates().length&&(!Kr||Kr.getSource().maxzoom<an.getSource().maxzoom)&&(Kr=an)}),Kr&&this.options.showTileBoundaries&&Nn(this,Kr,Kr.getVisibleCoordinates(),c.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Nn(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new c.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Kr){const jr=Kr.transform.padding;l0(Kr,Kr.transform.height-(jr.top||0),3,Fw),l0(Kr,jr.bottom||0,3,Bw),Dl(Kr,jr.left||0,3,zw),Dl(Kr,Kr.transform.width-(jr.right||0),3,o0);const an=Kr.transform.centerPoint;(function(Xr,bn,Fn,Hn){Hr(Xr,bn-1,Fn-10,2,20,Hn),Hr(Xr,bn-10,Fn-1,20,2,Hn)})(Kr,an.x,Kr.transform.height-an.y,a0)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Gt||(this.conflationActive=!1)}prepareLayer(d){this.gpuTimingStart(d);const{unsupportedLayers:$}=this.transform.projection,st=!$||!$.includes(d.type);if(u_[d.type]&&(st||this.terrain&&d.type==="custom")){const lt=this.style.getLayerSourceCache(d);u_[d.type](d,lt,this)}this.gpuTimingEnd()}renderLayer(d,$,st,lt){st.isHidden(this.transform.zoom)||(st.type==="background"||st.type==="sky"||st.type==="custom"||st.type==="model"||st.type==="raster"||st.type==="raster-particle"||lt&&lt.length)&&(this.id=st.id,this.gpuTimingStart(st),d.transform.projection.unsupportedLayers&&d.transform.projection.unsupportedLayers.includes(st.type)&&(!d.terrain||st.type!=="custom")||st.type==="clip"||Om[st.type](d,$,st,lt,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(d){if(!this.options.gpuTiming)return;const $=this.context.extTimerQuery,st=this.context.gl;let lt=this.gpuTimers[d.id];lt||(lt=this.gpuTimers[d.id]={calls:0,cpuTime:0,query:st.createQuery()}),lt.calls++,st.beginQuery($.TIME_ELAPSED_EXT,lt.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const d=this.context.extTimerQuery,$=this.context.gl,st=$.createQuery();this.deferredRenderGpuTimeQueries.push(st),$.beginQuery(d.TIME_ELAPSED_EXT,st)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const d=this.gpuTimers;return this.gpuTimers={},d}collectDeferredRenderGpuQueries(){const d=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],d}queryGpuTimers(d){const $={};for(const st in d){const lt=d[st],ht=this.context.extTimerQuery,pt=ht.getQueryParameter(lt.query,this.context.gl.QUERY_RESULT)/1e6;ht.deleteQueryEXT(lt.query),$[st]=pt}return $}queryGpuTimeDeferredRender(d){if(!this.options.gpuTimingDeferredRender)return 0;const $=this.context.gl;let st=0;for(const lt of d)st+=$.getQueryParameter(lt,$.QUERY_RESULT)/1e6,$.deleteQuery(lt);return st}translatePosMatrix(d,$,st,lt,ht){if(!st[0]&&!st[1])return d;const pt=ht?lt==="map"?this.transform.angle:0:lt==="viewport"?-this.transform.angle:0;if(pt){const It=Math.sin(pt),Dt=Math.cos(pt);st=[st[0]*Dt-st[1]*It,st[0]*It+st[1]*Dt]}const mt=[ht?st[0]:c.ay($,st[0],this.transform.zoom),ht?st[1]:c.ay($,st[1],this.transform.zoom),0],St=new Float32Array(16);return c.br(St,d,mt),St}saveTileTexture(d){if(d.context!==this.context)return;const $=d.size[0],st=this._tileTextures[$];st?st.push(d):this._tileTextures[$]=[d]}getTileTexture(d){const $=this._tileTextures[d];return $&&$.length>0?$.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(d,$,st){const lt=st===void 0?this.terrain&&this.terrain.renderingToTexture:st,ht=[];return this.style&&this.style.enable3dLights()&&(d==="globeRaster"||d==="terrainRaster"?(ht.push("LIGHTING_3D_MODE"),ht.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):lt||ht.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||ht.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(ht.push("TERRAIN"),this.linearFloatFilteringSupported()&&ht.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&ht.push("GLOBE"),!this._fogVisible||lt||$!==void 0&&!$||ht.push("FOG","FOG_DITHERING"),lt&&ht.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&ht.push("OVERDRAW_INSPECTOR"),ht}getOrCreateProgram(d,$){this.cache=this.cache||{};const st=$&&$.defines||[],lt=$&&$.config,ht=this.currentGlobalDefines(d,$&&$.overrideFog,$&&$.overrideRtt).concat(st),pt=ww.cacheKey(xv[d],d,ht,lt);return this.cache[pt]||(this.cache[pt]=new ww(this.context,d,xv[d],lt,Xx[d],ht)),this.cache[pt]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const d=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(d.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(d,$){if(this.style.enable3dLights()){const st=this.style.directionalLight,lt=this.style.ambientLight;if(st&&lt){const ht=((pt,mt,St)=>{const It=pt.properties.get("direction"),Dt=pt.properties.get("color-use-theme")==="none",Ht=pt.properties.get("color").toNonPremultipliedRenderColor(Dt?null:St.getLut(pt.scope)).toArray01(),Gt=pt.properties.get("intensity"),qt=mt.properties.get("color-use-theme")==="none",Qt=mt.properties.get("color").toNonPremultipliedRenderColor(qt?null:St.getLut(mt.scope)).toArray01(),Zt=mt.properties.get("intensity"),sr=[It.x,It.y,It.z],ir=c.dN(Qt,Zt),hr=c.dN(Ht,Gt);return{u_lighting_ambient_color:ir,u_lighting_directional_dir:sr,u_lighting_directional_color:hr,u_ground_radiance:D0(sr,hr,ir)}})(st,lt,this.style);$.setLightsUniformValues(d,ht)}}}uploadCommonUniforms(d,$,st,lt,ht){if(this.uploadCommonLightUniforms(d,$),this.terrain&&this.terrain.renderingToTexture)return;const pt=this.style.fog;if(pt){const mt=pt.getOpacity(this.transform.pitch),St=((It,Dt,Ht,Gt,qt,Qt,Zt,sr,ir,hr,gr,dr)=>{const Ir=It.transform,Tr=Dt.properties.get("color-use-theme")==="none",Rr=Dt.properties.get("color").toNonPremultipliedRenderColor(Tr?null:It.style.getLut(Dt.scope)).toArray01();Rr[3]=Gt;const Er=It.frameCounter/1e3%1,[vr,kr]=Dt.properties.get("vertical-range");return{u_fog_matrix:Ht?Ir.calculateFogTileMatrix(Ht):dr||It.identityMat,u_fog_range:Dt.getFovAdjustedRange(Ir._fov),u_fog_color:Rr,u_fog_horizon_blend:Dt.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(vr,kr),kr],u_fog_temporal_offset:Er,u_frustum_tl:qt,u_frustum_tr:Qt,u_frustum_br:Zt,u_frustum_bl:sr,u_globe_pos:ir,u_globe_radius:hr,u_viewport:gr,u_globe_transition:c.aj(Ir.zoom),u_is_globe:+(Ir.projection.name==="globe")}})(this,pt,st,mt,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*c.o.devicePixelRatio,this.transform.height*c.o.devicePixelRatio],lt);$.setFogUniformValues(d,St)}ht&&$.setCutoffUniformValues(d,ht.uniformValues)}setTileLoadedFlag(d){this.tileLoaded=d}saveCanvasCopy(){const d=this.canvasCopy();d&&(this.frameCopies.push(d),this.tileLoaded=!1)}canvasCopy(){const d=this.context.gl,$=d.createTexture();return d.bindTexture(d.TEXTURE_2D,$),d.copyTexImage2D(d.TEXTURE_2D,0,d.RGBA,0,0,d.drawingBufferWidth,d.drawingBufferHeight,0),$}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const d=this.style&&this.style.fog;return!!d&&d.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const d=this._backgroundTiles,$=this._backgroundTiles={},st=this.transform.coveringTiles({tileSize:512});for(const lt of st)$[lt.key]=d[lt.key]||new Ym(lt,512,this.transform.tileZoom,this,void 0,this.worldview);return $}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(d,$){return!(!d.is3D(!(!this.terrain||!this.terrain.enabled))||d.type!=="clip"&&d.type!=="building"&&(d.minzoom&&d.minzoom>this.transform.zoom||(this.style._clipLayerPresent||d.sourceLayer!=="building"&&d.sourceLayer!=="procedural_buildings")&&(!$||$.type!=="batched-model")))}isTileAffectedByFog(d){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let $=this._cachedTileFogOpacities[d.key];return $||(this._cachedTileFogOpacities[d.key]=$=this.style.fog.getOpacityForTile(d)),$[0]>=mn||$[1]>=mn}setupDepthForOcclusion(d,$,st){const lt=this.context,ht=lt.gl,pt=!!st;var mt;st||(st={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),lt.activeTexture.set(ht.TEXTURE3),d&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(ht.NEAREST,ht.CLAMP_TO_EDGE),st.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],st.u_depth_range_unpack=[2/((mt=this.depthRangeFor3D)[1]-mt[0]),-1-2*mt[0]/(mt[1]-mt[0])],st.u_occluder_half_size=.5*this.occlusionParams.occluderSize,st.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(ht.NEAREST,ht.CLAMP_TO_EDGE),lt.activeTexture.set(ht.TEXTURE0),pt||$.setTerrainUniformValues(lt,st)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const d=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=d?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function p_(it,d){let $=!1,st=null;const lt=()=>{st=null,$&&(it(),st=setTimeout(lt,d),$=!1)};return()=>($=!0,st||lt(),st)}class Kv{constructor(d){this._hashName=d&&encodeURIComponent(d),c.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=p_(this._updateHashUnthrottled.bind(this),300)}addTo(d){return this._map=d,window.addEventListener("hashchange",this._onHashChange,!1),d.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const d=this._map;if(!d)return"";const $=tu(d);if(this._hashName){const st=this._hashName;let lt=!1;const ht=location.hash.slice(1).split("&").map(pt=>{const mt=pt.split("=")[0];return mt===st?(lt=!0,`${mt}=${$}`):pt}).filter(pt=>pt);return lt||ht.push(`${st}=${$}`),`#${ht.join("&")}`}return`#${$}`}_getCurrentHash(){const d=location.hash.replace("#","");if(this._hashName){let $;return d.split("&").map(st=>st.split("=")).forEach(st=>{st[0]===this._hashName&&($=st)}),($&&$[1]||"").split("/")}return d.split("/")}_onHashChange(){const d=this._map;if(!d)return!1;const $=this._getCurrentHash();if($.length>=3&&!$.some(st=>isNaN(Number(st)))){const st=d.dragRotate.isEnabled()&&d.touchZoomRotate.isEnabled()?+($[3]||0):d.getBearing();return d.jumpTo({center:[+$[2],+$[1]],zoom:+$[0],bearing:st,pitch:+($[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function tu(it,d){const $=it.getCenter(),st=Math.round(100*it.getZoom())/100,lt=Math.ceil((st*Math.LN2+Math.log(512/360/.5))/Math.LN10),ht=Math.pow(10,lt),pt=Math.round($.lng*ht)/ht,mt=Math.round($.lat*ht)/ht,St=it.getBearing(),It=it.getPitch();let Dt=d?`/${pt}/${mt}/${st}`:`${st}/${mt}/${pt}`;return(St||It)&&(Dt+="/"+Math.round(10*St)/10),It&&(Dt+=`/${Math.round(It)}`),Dt}const z0={linearity:.3,easing:c.eT(0,0,.3,1)},Xv=Object.assign({deceleration:2500,maxSpeed:1400},z0),Zv=Object.assign({deceleration:20,maxSpeed:1400},z0),d0=Object.assign({deceleration:1e3,maxSpeed:360},z0),Yv=Object.assign({deceleration:1e3,maxSpeed:90},z0);class Qv{constructor(d){this._map=d,this.clear()}clear(){this._inertiaBuffer=[]}record(d){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.o.now(),settings:d})}_drainInertiaBuffer(){const d=this._inertiaBuffer,$=c.o.now();for(;d.length>0&&$-d[0].time>160;)d.shift()}_onMoveEnd(d){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const $={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:ht}of this._inertiaBuffer)$.zoom+=ht.zoomDelta||0,$.bearing+=ht.bearingDelta||0,$.pitch+=ht.pitchDelta||0,ht.panDelta&&$.pan._add(ht.panDelta),ht.around&&($.around=ht.around),ht.pinchAround&&($.pinchAround=ht.pinchAround);const st=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,lt={};if($.pan.mag()){const ht=Gp($.pan.mag(),st,Object.assign({},Xv,d||{}));lt.offset=$.pan.mult(ht.amount/$.pan.mag()),lt.center=this._map.transform.center,V0(lt,ht)}if($.zoom){const ht=Gp($.zoom,st,Zv);lt.zoom=this._map.transform.zoom+ht.amount,V0(lt,ht)}if($.bearing){const ht=Gp($.bearing,st,d0);lt.bearing=this._map.transform.bearing+c.aA(ht.amount,-179,179),V0(lt,ht)}if($.pitch){const ht=Gp($.pitch,st,Yv);lt.pitch=this._map.transform.pitch+ht.amount,V0(lt,ht)}if(lt.zoom||lt.bearing){const ht=$.pinchAround===void 0?$.around:$.pinchAround;lt.around=ht?this._map.unproject(ht):this._map.getCenter()}return this.clear(),lt.noMoveStart=!0,lt}}function V0(it,d){(!it.duration||it.duration<d.duration)&&(it.duration=d.duration,it.easing=d.easing)}function Gp(it,d,$){const{maxSpeed:st,linearity:lt,deceleration:ht}=$,pt=c.aA(it*lt/(d/1e3),-st,st),mt=Math.abs(pt)/(ht*lt);return{easing:$.easing,duration:1e3*mt,amount:pt*(mt/2)}}class Wu extends c.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(d,$,st,lt={}){const ht=mr($.getCanvasContainer(),st),pt=$.unproject(ht);super(d,Object.assign({point:ht,lngLat:pt,originalEvent:st},lt)),this._defaultPrevented=!1,this.target=$}}class Fm extends c.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(d,$,st){const lt=d==="touchend"?st.changedTouches:st.touches,ht=Fr($.getCanvasContainer(),lt),pt=ht.map(St=>$.unproject(St)),mt=ht.reduce((St,It,Dt,Ht)=>St.add(It.div(Ht.length)),new c.P(0,0));super(d,{points:ht,point:mt,lngLats:pt,lngLat:$.unproject(mt),originalEvent:st}),this._defaultPrevented=!1}}class Jv extends c.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(d,$){super("wheel",{originalEvent:$}),this._defaultPrevented=!1}}class f_{constructor(d,$){this._map=d,this._clickTolerance=$.clickTolerance}reset(){this._mousedownPos=void 0}wheel(d){return this._firePreventable(new Jv(this._map,d))}mousedown(d,$){return this._mousedownPos=$,this._firePreventable(new Wu(d.type,this._map,d))}mouseup(d){this._map.fire(new Wu(d.type,this._map,d))}preclick(d){const $=new MouseEvent("preclick",d);this._map.fire(new Wu($.type,this._map,$))}click(d,$){this._mousedownPos&&this._mousedownPos.dist($)>=this._clickTolerance||(this.preclick(d),this._map.fire(new Wu(d.type,this._map,d)))}dblclick(d){return this._firePreventable(new Wu(d.type,this._map,d))}mouseover(d){this._map.fire(new Wu(d.type,this._map,d))}mouseout(d){this._map.fire(new Wu(d.type,this._map,d))}touchstart(d){return this._firePreventable(new Fm(d.type,this._map,d))}touchmove(d){this._map.fire(new Fm(d.type,this._map,d))}touchend(d){this._map.fire(new Fm(d.type,this._map,d))}touchcancel(d){this._map.fire(new Fm(d.type,this._map,d))}_firePreventable(d){if(this._map.fire(d),d.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class e1{constructor(d){this._map=d}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(d){this._map.fire(new Wu(d.type,this._map,d))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Wu("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(d){this._delayContextMenu?this._contextMenuEvent=d:this._map.fire(new Wu(d.type,this._map,d)),this._map.listens("contextmenu")&&d.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class m_{constructor(d,$){this._map=d,this._el=d.getCanvasContainer(),this._container=d.getContainer(),this._clickTolerance=$.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(d,$){this.isEnabled()&&d.shiftKey&&d.button===0&&(Vt(),this._startPos=this._lastPos=$,this._active=!0)}mousemoveWindow(d,$){if(!this._active)return;const st=$,lt=this._startPos,ht=this._lastPos;if(!lt||!ht||ht.equals(st)||!this._box&&st.dist(lt)<this._clickTolerance)return;this._lastPos=st,this._box||(this._box=Pt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",d));const pt=Math.min(lt.x,st.x),mt=Math.max(lt.x,st.x),St=Math.min(lt.y,st.y),It=Math.max(lt.y,st.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${pt}px,${St}px)`,this._box.style.width=mt-pt+"px",this._box.style.height=It-St+"px")})}mouseupWindow(d,$){if(!this._active)return;const st=this._startPos,lt=$;if(st&&d.button===0){if(this.reset(),ar(),st.x!==lt.x||st.y!==lt.y)return this._map.fire(new c.z("boxzoomend",{originalEvent:d})),{cameraAnimation:ht=>ht.fitScreenCoordinates(st,lt,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",d)}}keydown(d){this._active&&d.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",d))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Xt(),delete this._startPos,delete this._lastPos}_fireEvent(d,$){return this._map.fire(new c.z(d,{originalEvent:$}))}}function g_(it,d){const $={};for(let st=0;st<it.length;st++)$[it[st].identifier]=d[st];return $}class Zw{constructor(d){this.reset(),this.numTouches=d.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(d,$,st){(this.centroid||st.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=d.timeStamp),st.length===this.numTouches&&(this.centroid=function(lt){const ht=new c.P(0,0);for(const pt of lt)ht._add(pt);return ht.div(lt.length)}($),this.touches=g_(st,$)))}touchmove(d,$,st){if(this.aborted||!this.centroid)return;const lt=g_(st,$);for(const ht in this.touches){const pt=lt[ht];(!pt||pt.dist(this.touches[ht])>30)&&(this.aborted=!0)}}touchend(d,$,st){if((!this.centroid||d.timeStamp-this.startTime>500)&&(this.aborted=!0),st.length===0){const lt=!this.aborted&&this.centroid;if(this.reset(),lt)return lt}}}class y_{constructor(d){this.singleTap=new Zw(d),this.numTaps=d.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(d,$,st){this.singleTap.touchstart(d,$,st)}touchmove(d,$,st){this.singleTap.touchmove(d,$,st)}touchend(d,$,st){const lt=this.singleTap.touchend(d,$,st);if(lt){const ht=d.timeStamp-this.lastTime<500,pt=!this.lastTap||this.lastTap.dist(lt)<30;if(ht&&pt||this.reset(),this.count++,this.lastTime=d.timeStamp,this.lastTap=lt,this.count===this.numTaps)return this.reset(),lt}}}class Yw{constructor(){this._zoomIn=new y_({numTouches:1,numTaps:2}),this._zoomOut=new y_({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(d,$,st){this._zoomIn.touchstart(d,$,st),this._zoomOut.touchstart(d,$,st)}touchmove(d,$,st){this._zoomIn.touchmove(d,$,st),this._zoomOut.touchmove(d,$,st)}touchend(d,$,st){const lt=this._zoomIn.touchend(d,$,st),ht=this._zoomOut.touchend(d,$,st);return lt?(this._active=!0,d.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:pt=>pt.easeTo({duration:300,zoom:pt.getZoom()+1,around:pt.unproject(lt)},{originalEvent:d})}):ht?(this._active=!0,d.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:pt=>pt.easeTo({duration:300,zoom:pt.getZoom()-1,around:pt.unproject(ht)},{originalEvent:d})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Qw={0:1,2:2},t1={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class x_{constructor(d){this.reset(),this._clickTolerance=d.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(d,$){return!1}_move(d,$){return{}}mousedown(d,$){if(this._lastPoint)return;const st=sn(d);this._correctButton(d,st)&&(this._lastPoint=$,this._eventButton=st)}mousemoveWindow(d,$){const st=this._lastPoint;if(st){if(d.preventDefault(),this._eventButton!=null&&function(lt,ht){const pt=Qw[ht];return lt.buttons===void 0||(lt.buttons&pt)!==pt}(d,this._eventButton))this.reset();else if(this._moved||!($.dist(st)<this._clickTolerance))return this._moved=!0,this._lastPoint=$,this._move(st,$)}}mouseupWindow(d){this._lastPoint&&sn(d)===this._eventButton&&(this._moved&&ar(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jw extends x_{mousedown(d,$){super.mousedown(d,$),this._lastPoint&&(this._active=!0)}_correctButton(d,$){return $===0&&!d.ctrlKey}_move(d,$){return{around:$,panDelta:$.sub(d)}}}class r1 extends x_{constructor(d){super(d),this._pitchRotateKey=d.pitchRotateKey?t1[d.pitchRotateKey]:void 0}_correctButton(d,$){return this._pitchRotateKey?$===0&&d[this._pitchRotateKey]:$===0&&d.ctrlKey||$===2}_move(d,$){const st=.8*($.x-d.x);if(st)return this._active=!0,{bearingDelta:st}}contextmenu(d){this._pitchRotateKey||d.preventDefault()}}class n1 extends x_{constructor(d){super(d),this._pitchRotateKey=d.pitchRotateKey?t1[d.pitchRotateKey]:void 0}_correctButton(d,$){return this._pitchRotateKey?$===0&&d[this._pitchRotateKey]:$===0&&d.ctrlKey||$===2}_move(d,$){const st=-.5*($.y-d.y);if(st)return this._active=!0,{pitchDelta:st}}contextmenu(d){this._pitchRotateKey||d.preventDefault()}}class eE{constructor(d,$){this._map=d,this._el=d.getCanvasContainer(),this._minTouches=1,this._clickTolerance=$.clickTolerance||1,this.reset(),c.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}touchstart(d,$,st){return this._calculateTransform(d,$,st)}touchmove(d,$,st){if(this._active&&!(st.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(st.length===1&&!c.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return d.cancelable&&d.preventDefault(),this._calculateTransform(d,$,st)}}touchend(d,$,st){this._calculateTransform(d,$,st),this._active&&st.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(d,$,st){st.length>0&&(this._active=!0);const lt=g_(st,$),ht=new c.P(0,0),pt=new c.P(0,0);let mt=0;for(const It in lt){const Dt=lt[It],Ht=this._touches[It];Ht&&(ht._add(Dt),pt._add(Dt.sub(Ht)),mt++,lt[It]=Dt)}if(this._touches=lt,mt<this._minTouches||!pt.mag())return;const St=pt.div(mt);return this._sum._add(St),this._sum.mag()<this._clickTolerance?void 0:{around:ht.div(mt),panDelta:St}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Pt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class __{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(d){}_move(d,$,st){return{}}touchstart(d,$,st){this._firstTwoTouches||st.length<2||(this._firstTwoTouches=[st[0].identifier,st[1].identifier],this._start([$[0],$[1]]))}touchmove(d,$,st){const lt=this._firstTwoTouches;if(!lt)return;d.preventDefault();const[ht,pt]=lt,mt=Oy(st,$,ht),St=Oy(st,$,pt);if(!mt||!St)return;const It=this._aroundCenter?null:mt.add(St).div(2);return this._move([mt,St],It,d)}touchend(d,$,st){if(!this._firstTwoTouches)return;const[lt,ht]=this._firstTwoTouches,pt=Oy(st,$,lt),mt=Oy(st,$,ht);pt&&mt||(this._active&&ar(),this.reset())}touchcancel(){this.reset()}enable(d){this._enabled=!0,this._aroundCenter=!!d&&d.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Oy(it,d,$){for(let st=0;st<it.length;st++)if(it[st].identifier===$)return d[st]}function tE(it,d){return Math.log2(it/d)}class vT extends __{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(d){this._startDistance=this._distance=d[0].dist(d[1])}_move(d,$){const st=this._distance;if(this._distance=d[0].dist(d[1]),this._active||!(Math.abs(tE(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:tE(this._distance,st),pinchAround:$}}}function rE(it,d){return 180*it.angleWith(d)/Math.PI}class _l extends __{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(d){this._startVector=this._vector=d[0].sub(d[1]),this._minDiameter=d[0].dist(d[1])}_move(d,$){const st=this._vector;if(this._vector=d[0].sub(d[1]),st&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:rE(this._vector,st),pinchAround:$}}_isBelowThreshold(d){this._minDiameter=Math.min(this._minDiameter,d.mag());const $=25/(Math.PI*this._minDiameter)*360,st=this._startVector;if(!st)return!1;const lt=rE(d,st);return Math.abs(lt)<$}}function v_(it){return Math.abs(it.y)>Math.abs(it.x)}class bT extends __{constructor(d){super(),this._map=d}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(d){this._lastPoints=d,v_(d[0].sub(d[1]))&&(this._valid=!1)}_move(d,$,st){const lt=this._lastPoints;if(!lt)return;const ht=d[0].sub(lt[0]),pt=d[1].sub(lt[1]);return this._map._cooperativeGestures&&!c.eU()&&st.touches.length<3||(this._valid=this.gestureBeginsVertically(ht,pt,st.timeStamp),!this._valid)?void 0:(this._lastPoints=d,this._active=!0,{pitchDelta:(ht.y+pt.y)/2*-.5})}gestureBeginsVertically(d,$,st){if(this._valid!==void 0)return this._valid;const lt=d.mag()>=2,ht=$.mag()>=2;if(!lt&&!ht)return;if(!lt||!ht)return this._firstMove==null&&(this._firstMove=st),st-this._firstMove<100&&void 0;const pt=d.y>0==$.y>0;return v_(d)&&v_($)&&pt}}const wT={panStep:100,bearingStep:15,pitchStep:10};class ET{constructor(){const d=wT;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(d){if(d.altKey||d.ctrlKey||d.metaKey)return;let $=0,st=0,lt=0,ht=0,pt=0;switch(d.keyCode){case 61:case 107:case 171:case 187:$=1;break;case 189:case 109:case 173:$=-1;break;case 37:d.shiftKey?st=-1:(d.preventDefault(),ht=-1);break;case 39:d.shiftKey?st=1:(d.preventDefault(),ht=1);break;case 38:d.shiftKey?lt=1:(d.preventDefault(),pt=-1);break;case 40:d.shiftKey?lt=-1:(d.preventDefault(),pt=1);break;default:return}return this._rotationDisabled&&(st=0,lt=0),{cameraAnimation:mt=>{const St=mt.getZoom();mt.easeTo({duration:300,easeId:"keyboardHandler",easing:Fy,zoom:$?Math.round(St)+$*(d.shiftKey?2:1):St,bearing:mt.getBearing()+st*this._bearingStep,pitch:mt.getPitch()+lt*this._pitchStep,offset:[-ht*this._panStep,-pt*this._panStep],center:mt.getCenter()},{originalEvent:d})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Fy(it){return it*(2-it)}const i1=4.000244140625,s1=1/450;class b_{constructor(d,$){this._map=d,this._el=d.getCanvasContainer(),this._handler=$,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=s1,c.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(d){this._defaultZoomRate=d}setWheelZoomRate(d){this._wheelZoomRate=d}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(d){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!d&&d.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(d){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(d.ctrlKey||d.metaKey||this.isZooming()||c.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let $=d.deltaMode===WheelEvent.DOM_DELTA_LINE?40*d.deltaY:d.deltaY;const st=c.o.now(),lt=st-(this._lastWheelEventTime||0);this._lastWheelEventTime=st,$!==0&&$%i1==0?this._type="wheel":$!==0&&Math.abs($)<4?this._type="trackpad":lt>400?(this._type=null,this._lastValue=$,this._timeout=window.setTimeout(this._onTimeout,40,d)):this._type||(this._type=Math.abs(lt*$)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,$+=this._lastValue)),d.shiftKey&&$&&($/=4),this._type&&(this._lastWheelEvent=d,this._delta-=$,this._active||this._start(d)),d.preventDefault()}_onTimeout(d){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)}_start(d){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const $=mr(this._el,d);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:$,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const d=this._map.transform;this._type==="wheel"&&d.projection.wrap&&(d._center.lng>=180||d._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const $=()=>d._terrainEnabled()&&this._aroundCoord?d.computeZoomRelativeTo(this._aroundCoord):d.zoom;if(this._delta!==0){const It=this._type==="wheel"&&Math.abs(this._delta)>i1?this._wheelZoomRate:this._defaultZoomRate;let Dt=2/(1+Math.exp(-Math.abs(this._delta*It)));this._delta<0&&Dt!==0&&(Dt=1/Dt);const Ht=$(),Gt=Math.pow(2,Ht),qt=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):Gt;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(qt*Dt))),this._type==="wheel"&&(this._startZoom=Ht,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const st=typeof this._targetZoom=="number"?this._targetZoom:$(),lt=this._startZoom,ht=this._easing;let pt,mt=!1;if(this._type==="wheel"&&lt&&ht){const It=Math.min((c.o.now()-this._lastWheelEventTime)/200,1),Dt=ht(It);pt=c.ak(lt,st,Dt),It<1?this._frameId||(this._frameId=!0):mt=!0}else pt=st,mt=!0;this._active=!0,mt&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let St=pt-$();return St*this._lastDelta<0&&(St=0),{noInertia:!0,needsRenderFrame:!mt,zoomDelta:St,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(d){let $=c.eV;if(this._prevEase){const st=this._prevEase,lt=(c.o.now()-st.start)/st.duration,ht=st.easing(lt+.01)-st.easing(lt),pt=.27/Math.sqrt(ht*ht+1e-4)*.01,mt=Math.sqrt(.0729-pt*pt);$=c.eT(pt,mt,.25,1)}return this._prevEase={start:c.o.now(),duration:d,easing:$},$}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Pt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class om{constructor(d,$){this._clickZoom=d,this._tapZoom=$}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class w_{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(d,$){return d.preventDefault(),{cameraAnimation:st=>{st.easeTo({duration:300,zoom:st.getZoom()+(d.shiftKey?-1:1),around:st.unproject($)},{originalEvent:d})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ru{constructor(){this._tap=new y_({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(d,$,st){this._swipePoint||(this._tapTime&&d.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?st.length>0&&(this._swipePoint=$[0],this._swipeTouch=st[0].identifier):this._tap.touchstart(d,$,st))}touchmove(d,$,st){if(this._tapTime){if(this._swipePoint){if(st[0].identifier!==this._swipeTouch)return;const lt=$[0],ht=lt.y-this._swipePoint.y;return this._swipePoint=lt,d.preventDefault(),this._active=!0,{zoomDelta:ht/128}}}else this._tap.touchmove(d,$,st)}touchend(d,$,st){this._tapTime?this._swipePoint&&st.length===0&&this.reset():this._tap.touchend(d,$,st)&&(this._tapTime=d.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hp{constructor(d,$,st){this._el=d,this._mousePan=$,this._touchPan=st}enable(d){this._inertiaOptions=d||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class By{constructor(d,$,st){this._pitchWithRotate=d.pitchWithRotate,this._mouseRotate=$,this._mousePitch=st}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class E_{constructor(d,$,st,lt){this._el=d,this._touchZoom=$,this._touchRotate=st,this._tapDragZoom=lt,this._rotationDisabled=!1,this._enabled=!0}enable(d){this._touchZoom.enable(d),this._rotationDisabled||this._touchRotate.enable(d),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const zy=it=>it.zoom||it.drag||it.pitch||it.rotate;class TT extends c.z{}class Vy{constructor(){this.constants=[1,1,.01],this.radius=0}setup(d,$){const st=c.av([],$,d);this.radius=c.ag(st[2]<0?c.eX([],st,this.constants):[st[0],st[1],0])}projectRay(d){c.eX(d,d,this.constants),c.aw(d,d),c.eY(d,d,this.constants);const $=c.c5([],d,this.radius);if($[2]>0){const st=c.c5([],[0,0,1],c.bJ($,[0,0,1])),lt=c.c5([],c.aw([],[$[0],$[1],0]),this.radius),ht=c.d8([],$,c.c5([],c.av([],c.d8([],lt,st),$),2));$[0]=ht[0],$[1]=ht[1]}return $}}function T_(it){return it.panDelta&&it.panDelta.mag()||it.zoomDelta||it.bearingDelta||it.pitchDelta}class ST{constructor(d,$){this._map=d,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qv(d),this._bearingSnap=$.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Vy,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers($),c.aY(["handleEvent","handleWindowEvent"],this);const st=this._el;this._listeners=[[st,"touchstart",{passive:!0}],[st,"touchmove",{passive:!1}],[st,"touchend",void 0],[st,"touchcancel",void 0],[st,"mousedown",void 0],[st,"mousemove",void 0],[st,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[st,"mouseover",void 0],[st,"mouseout",void 0],[st,"dblclick",void 0],[st,"click",void 0],[st,"keydown",{capture:!1}],[st,"keyup",void 0],[st,"wheel",{passive:!1}],[st,"contextmenu",void 0],[window,"blur",void 0]];for(const[lt,ht,pt]of this._listeners){const mt=lt===document?this.handleWindowEvent:this.handleEvent;lt.addEventListener(ht,mt,pt)}}destroy(){for(const[d,$,st]of this._listeners){const lt=d===document?this.handleWindowEvent:this.handleEvent;d.removeEventListener($,lt,st)}}_addDefaultHandlers(d){const $=this._map,st=$.getCanvasContainer();this._add("mapEvent",new f_($,d));const lt=$.boxZoom=new m_($,d);this._add("boxZoom",lt);const ht=new Yw,pt=new w_;$.doubleClickZoom=new om(pt,ht),this._add("tapZoom",ht),this._add("clickZoom",pt);const mt=new ru;this._add("tapDragZoom",mt);const St=$.touchPitch=new bT($);this._add("touchPitch",St);const It=new r1(d),Dt=new n1(d);$.dragRotate=new By(d,It,Dt),this._add("mouseRotate",It,["mousePitch"]),this._add("mousePitch",Dt,["mouseRotate"]);const Ht=new Jw(d),Gt=new eE($,d);$.dragPan=new Hp(st,Ht,Gt),this._add("mousePan",Ht),this._add("touchPan",Gt,["touchZoom","touchRotate"]);const qt=new _l,Qt=new vT;$.touchZoomRotate=new E_(st,Qt,qt,mt),this._add("touchRotate",qt,["touchPan","touchZoom"]),this._add("touchZoom",Qt,["touchPan","touchRotate"]),this._add("blockableMapEvent",new e1($));const Zt=$.scrollZoom=new b_($,this);this._add("scrollZoom",Zt,["mousePan"]);const sr=$.keyboard=new ET;this._add("keyboard",sr);for(const ir of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])d.interactive&&d[ir]&&$[ir].enable(d[ir])}_add(d,$,st){this._handlers.push({handlerName:d,handler:$,allowed:st}),this._handlersById[d]=$}stop(d){if(!this._updatingCamera){for(const{handler:$}of this._handlers)$.reset();this._inertia.clear(),this._fireEvents({},{},d),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:d}of this._handlers)if(d.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!zy(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(d,$,st){for(const lt in d)if(lt!==st&&(!$||$.indexOf(lt)<0))return!0;return!1}handleWindowEvent(d){this.handleEvent(d,`${d.type}Window`)}_getMapTouches(d){const $=[];for(const st of d)this._el.contains(st.target)&&$.push(st);return $}handleEvent(d,$){this._updatingCamera=!0;const st=d.type==="renderFrame",lt=st?void 0:d,ht={needsRenderFrame:!1},pt={},mt={},St=d.touches?this._getMapTouches(d.touches):void 0,It=St?Fr(this._el,St):st?void 0:mr(this._el,d);for(const{handlerName:Gt,handler:qt,allowed:Qt}of this._handlers){if(!qt.isEnabled())continue;let Zt;this._blockedByActive(mt,Qt,Gt)?qt.reset():qt[$||d.type]&&(Zt=qt[$||d.type](d,It,St),this.mergeHandlerResult(ht,pt,Zt,Gt,lt),Zt&&Zt.needsRenderFrame&&this._triggerRenderFrame()),(Zt||qt.isActive())&&(mt[Gt]=qt)}const Dt={};for(const Gt in this._previousActiveHandlers)mt[Gt]||(Dt[Gt]=lt);this._previousActiveHandlers=mt,(Object.keys(Dt).length||T_(ht))&&(this._changes.push([ht,pt,Dt]),this._triggerRenderFrame()),(Object.keys(mt).length||T_(ht))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Ht}=ht;Ht&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ht(this._map))}mergeHandlerResult(d,$,st,lt,ht){if(!st)return;Object.assign(d,st);const pt={handlerName:lt,originalEvent:st.originalEvent||ht};st.zoomDelta!==void 0&&($.zoom=pt),st.panDelta!==void 0&&($.drag=pt),st.pitchDelta!==void 0&&($.pitch=pt),st.bearingDelta!==void 0&&($.rotate=pt)}_applyChanges(){const d={},$={},st={};for(const[lt,ht,pt]of this._changes)lt.panDelta&&(d.panDelta=(d.panDelta||new c.P(0,0))._add(lt.panDelta)),lt.zoomDelta&&(d.zoomDelta=(d.zoomDelta||0)+lt.zoomDelta),lt.bearingDelta&&(d.bearingDelta=(d.bearingDelta||0)+lt.bearingDelta),lt.pitchDelta&&(d.pitchDelta=(d.pitchDelta||0)+lt.pitchDelta),lt.around!==void 0&&(d.around=lt.around),lt.aroundCoord!==void 0&&(d.aroundCoord=lt.aroundCoord),lt.pinchAround!==void 0&&(d.pinchAround=lt.pinchAround),lt.noInertia&&(d.noInertia=lt.noInertia),Object.assign($,ht),Object.assign(st,pt);this._updateMapTransform(d,$,st),this._changes=[]}_updateMapTransform(d,$,st){const lt=this._map,ht=lt.transform,pt=hr=>[hr.x,hr.y,hr.z];if((hr=>{const gr=this._eventsInProgress.drag;return gr&&!this._handlersById[gr.handlerName].isActive()})()&&!T_(d)){const hr=ht.zoom;ht.cameraElevationReference="sea",this._originalZoom!=null&&ht._orthographicProjectionAtLowPitch&&ht.projection.name!=="globe"&&ht.pitch===0?(ht.cameraElevationReference="ground",ht.zoom=this._originalZoom):(ht.recenterOnTerrain(),ht.cameraElevationReference="ground"),hr!==ht.zoom&&this._map._update(!0)}if(ht._isCameraConstrained&&lt._stop(!0),!T_(d))return void this._fireEvents($,st,!0);let{panDelta:mt,zoomDelta:St,bearingDelta:It,pitchDelta:Dt,around:Ht,aroundCoord:Gt,pinchAround:qt}=d;ht._isCameraConstrained&&(St>0&&(St=0),ht._isCameraConstrained=!1),qt!==void 0&&(Ht=qt),(St||(hr=>$[hr]&&!this._eventsInProgress[hr])("drag"))&&Ht&&(this._dragOrigin=pt(ht.pointCoordinate3D(Ht)),this._originalZoom=ht.zoom,this._trackingEllipsoid.setup(ht._camera.position,this._dragOrigin)),ht.cameraElevationReference="sea",lt._stop(!0),Ht=Ht||lt.transform.centerPoint,It&&(ht.bearing+=It),Dt&&(ht.pitch+=Dt),ht._updateCameraState();const Qt=[0,0,0];if(mt)if(ht.projection.name==="mercator"){const hr=this._trackingEllipsoid.projectRay(ht.screenPointToMercatorRay(Ht).dir),gr=this._trackingEllipsoid.projectRay(ht.screenPointToMercatorRay(Ht.sub(mt)).dir);Qt[0]=gr[0]-hr[0],Qt[1]=gr[1]-hr[1]}else{const hr=ht.pointCoordinate(Ht);if(ht.projection.name==="globe"){mt=mt.rotate(-ht.angle);const gr=ht._pixelsPerMercatorPixel/ht.worldSize;Qt[0]=-mt.x*c.eW(c.a$(hr.y))*gr,Qt[1]=-mt.y*c.eW(ht.center.lat)*gr}else{const gr=ht.pointCoordinate(Ht.sub(mt));hr&&gr&&(Qt[0]=gr.x-hr.x,Qt[1]=gr.y-hr.y)}}const Zt=ht.zoom,sr=[0,0,0];if(St){const hr=pt(Gt||ht.pointCoordinate3D(Ht)),gr={dir:c.aw([],c.av([],hr,ht._camera.position))};if(gr.dir[2]<0){const dr=ht.zoomDeltaToMovement(hr,St);c.c5(sr,gr.dir,dr)}}const ir=c.d8(Qt,Qt,sr);ht._translateCameraConstrained(ir),St&&Math.abs(ht.zoom-Zt)>1e-4&&ht.recenterOnTerrain(),ht.cameraElevationReference="ground",this._map._update(),d.noInertia||this._inertia.record(d),this._fireEvents($,st,!0)}_fireEvents(d,$,st){const lt=zy(this._eventsInProgress),ht=zy(d),pt={};for(const Dt in d){const{originalEvent:Ht}=d[Dt];this._eventsInProgress[Dt]||(pt[`${Dt}start`]=Ht),this._eventsInProgress[Dt]=d[Dt]}!lt&&ht&&this._fireEvent("movestart",ht.originalEvent);for(const Dt in pt)this._fireEvent(Dt,pt[Dt]);ht&&this._fireEvent("move",ht.originalEvent);for(const Dt in d){const{originalEvent:Ht}=d[Dt];this._fireEvent(Dt,Ht)}const mt={};let St;for(const Dt in this._eventsInProgress){const{handlerName:Ht,originalEvent:Gt}=this._eventsInProgress[Dt];this._handlersById[Ht].isActive()||(delete this._eventsInProgress[Dt],St=$[Ht]||Gt,mt[`${Dt}end`]=St)}for(const Dt in mt)this._fireEvent(Dt,mt[Dt]);const It=zy(this._eventsInProgress);if(st&&(lt||ht)&&!It){this._updatingCamera=!0;const Dt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Ht=Gt=>Gt!==0&&-this._bearingSnap<Gt&&Gt<this._bearingSnap;Dt?(Ht(Dt.bearing||this._map.getBearing())&&(Dt.bearing=0),this._map.easeTo(Dt,{originalEvent:St})):(this._map.fire(new c.z("moveend",{originalEvent:St})),Ht(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(d,$){this._map.fire(new c.z(d,$?{originalEvent:$}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(d=>{this._frameId=void 0,this.handleEvent(new TT("renderFrame",{timeStamp:d})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const S_="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class o1 extends c.E{constructor(d,$){super(),this._moving=!1,this._zooming=!1,this.transform=d,this._bearingSnap=$.bearingSnap,this._respectPrefersReducedMotion=$.respectPrefersReducedMotion!==!1,c.aY(["_renderFrameCallback"],this)}getCenter(){return new c.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(d,$){return this.jumpTo({center:d},$)}panBy(d,$,st){return d=c.P.convert(d).mult(-1),this.panTo(this.transform.center,Object.assign({offset:d},$),st)}panTo(d,$,st){return this.easeTo(Object.assign({center:d},$),st)}getZoom(){return this.transform.zoom}setZoom(d,$){return this.jumpTo({zoom:d},$),this}zoomTo(d,$,st){return this.easeTo(Object.assign({zoom:d},$),st)}zoomIn(d,$){return this.zoomTo(this.getZoom()+1,d,$),this}zoomOut(d,$){return this.zoomTo(this.getZoom()-1,d,$),this}getBearing(){return this.transform.bearing}setBearing(d,$){return this.jumpTo({bearing:d},$),this}getPadding(){return this.transform.padding}setPadding(d,$){return this.jumpTo({padding:d},$),this}rotateTo(d,$,st){return this.easeTo(Object.assign({bearing:d},$),st)}resetNorth(d,$){return this.rotateTo(0,Object.assign({duration:1e3},d),$),this}resetNorthPitch(d,$){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},d),$),this}snapToNorth(d,$){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(d,$):this}getPitch(){return this.transform.pitch}setPitch(d,$){return this.jumpTo({pitch:d},$),this}cameraForBounds(d,$){d=c.aI.convert(d);const st=$&&$.bearing||0,lt=$&&$.pitch||0,ht=d.getNorthWest(),pt=d.getSouthEast();return this._cameraForBounds(this.transform,ht,pt,st,lt,$)}_extendPadding(d){const $={top:0,right:0,bottom:0,left:0};return d==null?Object.assign({},$,this.transform.padding):typeof d=="number"?{top:d,bottom:d,right:d,left:d}:Object.assign({},$,d)}_extendCameraOptions(d){return(d=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=this._extendPadding(d.padding),d}_minimumAABBFrustumDistance(d,$){const st=$.max[0]-$.min[0],lt=$.max[1]-$.min[1];return st/lt>d.aspect?st/(2*Math.tan(.5*d.fovX)*d.aspect):lt/(2*Math.tan(.5*d.fovY)*d.aspect)}_cameraForBoundsOnGlobe(d,$,st,lt,ht,pt){const mt=d.clone(),St=this._extendCameraOptions(pt);mt.bearing=lt,mt.pitch=ht;const It=c.aT.convert($),Dt=c.aT.convert(st),Ht=.5*(It.lat+Dt.lat),Gt=.5*(It.lng+Dt.lng),qt=c.eZ(Ht,Gt),Qt=c.aw([],qt),Zt=c.aw([],c.bI([],Qt,[0,1,0])),sr=c.bI([],Zt,Qt),ir=[Zt[0],Zt[1],Zt[2],0,sr[0],sr[1],sr[2],0,Qt[0],Qt[1],Qt[2],0,0,0,0,1],hr=[qt,c.eZ(It.lat,It.lng),c.eZ(Dt.lat,It.lng),c.eZ(Dt.lat,Dt.lng),c.eZ(It.lat,Dt.lng),c.eZ(Ht,It.lng),c.eZ(Ht,Dt.lng),c.eZ(It.lat,Gt),c.eZ(Dt.lat,Gt)];let gr=c.d9.fromPoints(hr.map(Xr=>[c.bJ(Zt,Xr),c.bJ(sr,Xr),c.bJ(Qt,Xr)]));const dr=c.af([],gr.center,ir);c.e_(dr)===0&&c.e$(dr,0,0,1),c.aw(dr,dr),c.c5(dr,dr,c.aD),mt.center=c.f0(dr);const Ir=mt.getWorldToCameraMatrix(),Tr=c.bl(new Float64Array(16),Ir);gr=c.d9.applyTransform(gr,c.aB([],Ir,ir));const Rr=this._extendAABB(gr,mt,St,lt);if(!Rr)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");gr=Rr,c.af(dr,dr,Ir);const Er=.5*(gr.max[2]-gr.min[2]),vr=this._minimumAABBFrustumDistance(mt,gr),kr=c.c5([],[0,0,1],Er),Ur=c.d8(kr,dr,kr),zr=vr+(mt.pitch===0?0:c.bG(dr,Ur)),Jr=mt.globeCenterInViewSpace,rn=c.av([],dr,[Jr[0],Jr[1],Jr[2]]);c.aw(rn,rn),c.c5(rn,rn,zr);const pn=c.d8([],dr,rn);c.af(pn,pn,Tr);const Pn=c.eM/c.aD,Kr=c.ag(pn),jr=c.cf(Math.max(Kr*Pn-c.eM,Number.EPSILON),0),an=Math.min(mt.zoomFromMercatorZAdjusted(jr),St.maxZoom);return an>.5*(c.c_+c.cL)?(mt.setProjection({name:"mercator"}),mt.zoom=an,this._cameraForBounds(mt,$,st,lt,ht,pt)):{center:mt.center,zoom:an,bearing:lt,pitch:ht}}_extendAABB(d,$,st,lt){const ht=.5*((st.padding.left||0)+(st.padding.right||0)),pt=.5*((st.padding.top||0)+(st.padding.bottom||0)),mt=pt,St=ht,It=ht,Dt=pt,Ht=$.width-(St+It),Gt=$.height-(mt+Dt),qt=c.av([],d.max,d.min),Qt=Math.min(Ht/qt[0],Gt/qt[1]),Zt=Math.min($.scaleZoom($.scale*Qt),st.maxZoom);if(isNaN(Zt))return null;const sr=$.scale/$.zoomScale(Zt),ir=new c.d9([d.min[0]-St*sr,d.min[1]-Dt*sr,d.min[2]],[d.max[0]+It*sr,d.max[1]+mt*sr,d.max[2]]),hr=(typeof st.offset.x=="number"&&typeof st.offset.y=="number"?new c.P(st.offset.x,st.offset.y):c.P.convert(st.offset)).rotate(-c.an(lt));return ir.center[0]-=hr.x*sr,ir.center[1]+=hr.y*sr,ir}queryTerrainElevation(d,$){const st=this.transform.elevation;return st?($=Object.assign({},{exaggerated:!0},$),st.getAtPoint(c.ae.fromLngLat(d),null,$.exaggerated)):null}_cameraForBounds(d,$,st,lt,ht,pt){if(d.projection.name==="globe")return this._cameraForBoundsOnGlobe(d,$,st,lt,ht,pt);const mt=d.clone(),St=this._extendCameraOptions(pt);mt.bearing=lt,mt.pitch=ht;const It=c.aT.convert($),Dt=c.aT.convert(st),Ht=new c.aT(It.lng,Dt.lat),Gt=new c.aT(Dt.lng,It.lat),qt=mt.project(It),Qt=mt.project(Dt),Zt=this.queryTerrainElevation(It),sr=this.queryTerrainElevation(Dt),ir=this.queryTerrainElevation(Ht),hr=this.queryTerrainElevation(Gt),gr=[[qt.x,qt.y,Math.min(Zt||0,sr||0,ir||0,hr||0)],[Qt.x,Qt.y,Math.max(Zt||0,sr||0,ir||0,hr||0)]];let dr=c.d9.fromPoints(gr);const Ir=mt.getWorldToCameraMatrix(),Tr=c.bl(new Float64Array(16),Ir);dr=c.d9.applyTransform(dr,Ir);const Rr=this._extendAABB(dr,mt,St,lt);if(!Rr)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");dr=Rr;const Er=.5*c.av([],dr.max,dr.min)[2],vr=this._minimumAABBFrustumDistance(mt,dr),kr=[0,0,1,0];c.aC(kr,kr,Ir),c.f1(kr,kr);const Ur=c.c5([],kr,vr+Er),zr=c.d8([],dr.center,Ur);c.af(dr.center,dr.center,Tr),c.af(zr,zr,Tr);const Jr=mt.unproject(new c.P(dr.center[0],dr.center[1])),rn=c.f2(mt.projection,Jr),pn=Math.pow(2,rn),Pn=Math.min(mt._zoomFromMercatorZ(zr[2]*mt.pixelsPerMeter*pn/mt.worldSize),St.maxZoom);return mt.mercatorFromTransition&&Pn<.5*(c.c_+c.cL)?(mt.setProjection({name:"globe"}),mt.zoom=Pn,this._cameraForBounds(mt,$,st,lt,ht,pt)):{center:Jr,zoom:Pn,bearing:lt,pitch:ht}}fitBounds(d,$,st){const lt=this.cameraForBounds(d,$);return this._fitInternal(lt,$,st)}fitScreenCoordinates(d,$,st,lt,ht){const pt=c.P.convert(d),mt=c.P.convert($),St=new c.P(Math.min(pt.x,mt.x),Math.min(pt.y,mt.y)),It=new c.P(Math.max(pt.x,mt.x),Math.max(pt.y,mt.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(pt,mt))return this;const Dt=this.transform.pointLocation3D(St),Ht=this.transform.pointLocation3D(It),Gt=this.transform.pointLocation3D(new c.P(St.x,It.y)),qt=this.transform.pointLocation3D(new c.P(It.x,St.y)),Qt=[Math.min(Dt.lng,Ht.lng,Gt.lng,qt.lng),Math.min(Dt.lat,Ht.lat,Gt.lat,qt.lat)],Zt=[Math.max(Dt.lng,Ht.lng,Gt.lng,qt.lng),Math.max(Dt.lat,Ht.lat,Gt.lat,qt.lat)],sr=lt&&lt.pitch?lt.pitch:this.getPitch(),ir=this._cameraForBounds(this.transform,Qt,Zt,st,sr,lt);return this._fitInternal(ir,lt,ht)}_fitInternal(d,$,st){return d?($=Object.assign(d,$)).linear?this.easeTo($,st):this.flyTo($,st):this}jumpTo(d,$){this.stop();const st=d.preloadOnly?this.transform.clone():this.transform;let lt=!1,ht=!1,pt=!1;"zoom"in d&&st.zoom!==+d.zoom&&(lt=!0,st.zoom=+d.zoom),d.center!==void 0&&(st.center=c.aT.convert(d.center)),"bearing"in d&&st.bearing!==+d.bearing&&(ht=!0,st.bearing=+d.bearing),"pitch"in d&&st.pitch!==+d.pitch&&(pt=!0,st.pitch=+d.pitch);const mt=typeof d.padding=="number"?this._extendPadding(d.padding):d.padding;if(d.padding!=null&&!st.isPaddingEqual(mt))if(d.retainPadding===!1){const St=st.clone();St.padding=mt,st.setLocationAtPoint(st.center,St.centerPoint)}else st.padding=mt;return d.preloadOnly?(this._preloadTiles(st),this):(this.fire(new c.z("movestart",$)).fire(new c.z("move",$)),lt&&this.fire(new c.z("zoomstart",$)).fire(new c.z("zoom",$)).fire(new c.z("zoomend",$)),ht&&this.fire(new c.z("rotatestart",$)).fire(new c.z("rotate",$)).fire(new c.z("rotateend",$)),pt&&this.fire(new c.z("pitchstart",$)).fire(new c.z("pitch",$)).fire(new c.z("pitchend",$)),this.fire(new c.z("moveend",$)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||c.w(S_),this.transform.getFreeCameraOptions()}setFreeCameraOptions(d,$){const st=this.transform;if(!st.projection.supportsFreeCamera)return c.w(S_),this;this.stop();const lt=st.zoom,ht=st.pitch,pt=st.bearing;st.setFreeCameraOptions(d);const mt=lt!==st.zoom,St=ht!==st.pitch,It=pt!==st.bearing;return this.fire(new c.z("movestart",$)).fire(new c.z("move",$)),mt&&this.fire(new c.z("zoomstart",$)).fire(new c.z("zoom",$)).fire(new c.z("zoomend",$)),It&&this.fire(new c.z("rotatestart",$)).fire(new c.z("rotate",$)).fire(new c.z("rotateend",$)),St&&this.fire(new c.z("pitchstart",$)).fire(new c.z("pitch",$)).fire(new c.z("pitchend",$)),this.fire(new c.z("moveend",$)),this}easeTo(d,$){this._stop(!1,d.easeId),((d=Object.assign({offset:[0,0],duration:500,easing:c.eV},d)).animate===!1||this._prefersReducedMotion(d))&&(d.duration=0);const st=this.transform,lt=this.getZoom(),ht=this.getBearing(),pt=this.getPitch(),mt=this.getPadding(),St="zoom"in d?+d.zoom:lt,It="bearing"in d?this._normalizeBearing(d.bearing,ht):ht,Dt="pitch"in d?+d.pitch:pt,Ht=this._extendPadding(d.padding),Gt=c.P.convert(d.offset);let qt,Qt,Zt;if(st.projection.name==="globe"){const kr=c.ae.fromLngLat(st.center),Ur=Gt.rotate(-st.angle);kr.x+=Ur.x/st.worldSize,kr.y+=Ur.y/st.worldSize;const zr=kr.toLngLat(),Jr=c.aT.convert(d.center||zr);this._normalizeCenter(Jr),qt=st.centerPoint.add(Ur),Qt=new c.P(kr.x,kr.y).mult(st.worldSize),Zt=new c.P(c.aF(Jr.lng),c.aJ(Jr.lat)).mult(st.worldSize).sub(Qt)}else{qt=st.centerPoint.add(Gt);const kr=st.pointLocation(qt),Ur=c.aT.convert(d.center||kr);this._normalizeCenter(Ur),Qt=st.project(kr),Zt=st.project(Ur).sub(Qt)}const sr=st.zoomScale(St-lt);let ir,hr;d.around&&(ir=c.aT.convert(d.around),hr=st.locationPoint(ir));const gr=this._zooming||St!==lt,dr=this._rotating||ht!==It,Ir=this._pitching||Dt!==pt,Tr=!st.isPaddingEqual(Ht),Rr=d.retainPadding===!1?st.clone():st,Er=kr=>Ur=>{if(gr&&(kr.zoom=c.ak(lt,St,Ur)),dr&&(kr.bearing=c.ak(ht,It,Ur)),Ir&&(kr.pitch=c.ak(pt,Dt,Ur)),Tr&&(Rr.interpolatePadding(mt,Ht,Ur),qt=Rr.centerPoint.add(Gt)),ir)kr.setLocationAtPoint(ir,hr);else{const zr=kr.zoomScale(kr.zoom-lt),Jr=St>lt?Math.min(2,sr):Math.max(.5,sr),rn=Math.pow(Jr,1-Ur),pn=kr.unproject(Qt.add(Zt.mult(Ur*rn)).mult(zr));kr.setLocationAtPoint(kr.renderWorldCopies?pn.wrap():pn,qt)}return d.preloadOnly||this._fireMoveEvents($),kr};if(d.preloadOnly){const kr=this._emulate(Er,d.duration,st);return this._preloadTiles(kr),this}const vr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=gr,this._rotating=dr,this._pitching=Ir,this._padding=Tr,this._easeId=d.easeId,this._prepareEase($,d.noMoveStart,vr),this._ease(Er(st),kr=>{st.cameraElevationReference==="sea"&&st.recenterOnTerrain(),this._afterEase($,kr)},d),this}_prepareEase(d,$,st={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),$||st.moving||this.fire(new c.z("movestart",d)),this._zooming&&!st.zooming&&this.fire(new c.z("zoomstart",d)),this._rotating&&!st.rotating&&this.fire(new c.z("rotatestart",d)),this._pitching&&!st.pitching&&this.fire(new c.z("pitchstart",d))}_fireMoveEvents(d){this.fire(new c.z("move",d)),this._zooming&&this.fire(new c.z("zoom",d)),this._rotating&&this.fire(new c.z("rotate",d)),this._pitching&&this.fire(new c.z("pitch",d))}_afterEase(d,$){if(this._easeId&&$&&this._easeId===$)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const st=this._zooming,lt=this._rotating,ht=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,st&&this.fire(new c.z("zoomend",d)),lt&&this.fire(new c.z("rotateend",d)),ht&&this.fire(new c.z("pitchend",d)),this.fire(new c.z("moveend",d))}flyTo(d,$){if(this._prefersReducedMotion(d)){const Xr=c.aH(d,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Xr,$)}this.stop(),d=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:c.eV},d);const st=this.transform,lt=this.getZoom(),ht=this.getBearing(),pt=this.getPitch(),mt=this.getPadding(),St="zoom"in d?c.aA(+d.zoom,st.minZoom,st.maxZoom):lt,It="bearing"in d?this._normalizeBearing(d.bearing,ht):ht,Dt="pitch"in d?+d.pitch:pt,Ht=this._extendPadding(d.padding),Gt=st.zoomScale(St-lt),qt=c.P.convert(d.offset);let Qt=st.centerPoint.add(qt);const Zt=st.pointLocation(Qt),sr=c.aT.convert(d.center||Zt);this._normalizeCenter(sr);const ir=st.project(Zt),hr=st.project(sr).sub(ir);let gr=d.curve;const dr=Math.max(st.width,st.height),Ir=dr/Gt,Tr=hr.mag();if("minZoom"in d){const Xr=c.aA(Math.min(d.minZoom,lt,St),st.minZoom,st.maxZoom),bn=dr/st.zoomScale(Xr-lt);gr=Math.sqrt(bn/Tr*2)}const Rr=gr*gr;function Er(Xr){const bn=(Ir*Ir-dr*dr+(Xr?-1:1)*Rr*Rr*Tr*Tr)/(2*(Xr?Ir:dr)*Rr*Tr);return Math.log(Math.sqrt(bn*bn+1)-bn)}function vr(Xr){return(Math.exp(Xr)-Math.exp(-Xr))/2}function kr(Xr){return(Math.exp(Xr)+Math.exp(-Xr))/2}const Ur=Er(0);let zr=function(Xr){return kr(Ur)/kr(Ur+gr*Xr)},Jr=function(Xr){return dr*((kr(Ur)*(vr(bn=Ur+gr*Xr)/kr(bn))-vr(Ur))/Rr)/Tr;var bn},rn=(Er(1)-Ur)/gr;if(Math.abs(Tr)<1e-6||!isFinite(rn)){if(Math.abs(dr-Ir)<1e-6)return this.easeTo(d,$);const Xr=Ir<dr?-1:1;rn=Math.abs(Math.log(Ir/dr))/gr,Jr=function(){return 0},zr=function(bn){return Math.exp(Xr*gr*bn)}}d.duration="duration"in d?+d.duration:1e3*rn/("screenSpeed"in d?+d.screenSpeed/gr:+d.speed),d.maxDuration&&d.duration>d.maxDuration&&(d.duration=0);const pn=ht!==It,Pn=Dt!==pt,Kr=!st.isPaddingEqual(Ht),jr=d.retainPadding===!1?st.clone():st,an=Xr=>bn=>{const Fn=bn*rn,Hn=1/zr(Fn);Xr.zoom=bn===1?St:lt+Xr.scaleZoom(Hn),pn&&(Xr.bearing=c.ak(ht,It,bn)),Pn&&(Xr.pitch=c.ak(pt,Dt,bn)),Kr&&(jr.interpolatePadding(mt,Ht,bn),Qt=jr.centerPoint.add(qt));const Ln=bn===1?sr:Xr.unproject(ir.add(hr.mult(Jr(Fn))).mult(Hn));return Xr.setLocationAtPoint(Xr.renderWorldCopies?Ln.wrap():Ln,Qt),Xr._updateCameraOnTerrain(),d.preloadOnly||this._fireMoveEvents($),Xr};if(d.preloadOnly){const Xr=this._emulate(an,d.duration,st);return this._preloadTiles(Xr),this}return this._zooming=!0,this._rotating=pn,this._pitching=Pn,this._padding=Kr,this._prepareEase($,!1),this._ease(an(st),()=>this._afterEase($),d),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(d){}_cancelRenderFrame(d){}_stop(d,$){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const st=this._onEaseEnd;this._onEaseEnd=void 0,st.call(this,$)}if(!d){const st=this.handlers;st&&st.stop(!1)}return this}_ease(d,$,st){st.animate===!1||st.duration===0?(d(1),$()):(this._easeStart=c.o.now(),this._easeOptions=st,this._onEaseFrame=d,this._onEaseEnd=$,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const d=Math.min((c.o.now()-this._easeStart)/this._easeOptions.duration,1),$=this._onEaseFrame;$&&$(this._easeOptions.easing(d)),d<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(d,$){d=c.bT(d,-180,180);const st=Math.abs(d-$);return Math.abs(d-360-$)<st&&(d-=360),Math.abs(d+360-$)<st&&(d+=360),d}_normalizeCenter(d){const $=this.transform;if($.maxBounds||$.projection.name!=="globe"&&!$.renderWorldCopies)return;const st=d.lng-$.center.lng;d.lng+=st>180?-360:st<-180?360:0}_prefersReducedMotion(d){return this._respectPrefersReducedMotion&&c.o.prefersReducedMotion&&!(d&&d.essential)}_emulate(d,$,st){const lt=Math.ceil(15*$/1e3),ht=[],pt=d(st.clone());for(let mt=0;mt<=lt;mt++){const St=pt(mt/lt);ht.push(St.clone())}return ht}_preloadTiles(d,$){}}class Uy{constructor(d={}){this.options=d,c.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(d){const $=this.options&&this.options.compact,st=d._getUIString("AttributionControl.ToggleAttribution");this._map=d,this._container=Pt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Pt("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",st);const lt=Pt("span","mapboxgl-ctrl-icon",this._compactButton);return lt.setAttribute("aria-hidden","true"),lt.setAttribute("title",st),this._innerContainer=Pt("div","mapboxgl-ctrl-attrib-inner",this._container),$&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),$===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let d=this._editLink;d||(d=this._editLink=this._container.querySelector(".mapbox-improve-map"));const $=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||c.e.ACCESS_TOKEN}];if(d){const st=$.reduce((lt,ht,pt)=>(ht.value&&(lt+=`${ht.key}=${ht.value}${pt<$.length-1?"&":""}`),lt),"?");d.href=`${c.e.FEEDBACK_URL}/${st}#${tu(this._map,!0)}`,d.rel="noopener nofollow"}}_updateData(d){!d||(d.dataType!=="source"||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility")&&d.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let d=[];if(this._map.style.stylesheet){const lt=this._map.style.stylesheet;this.styleOwner=lt.owner,this.styleId=lt.id}const $=this._map.style._mergedSourceCaches;for(const lt in $){const ht=$[lt];if(ht.used){const pt=ht.getSource();pt.attribution&&d.indexOf(pt.attribution)<0&&d.push(pt.attribution)}}d.sort((lt,ht)=>lt.length-ht.length),d=d.filter((lt,ht)=>{for(let pt=ht+1;pt<d.length;pt++)if(d[pt].indexOf(lt)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?d=[...this.options.customAttribution,...d]:d.unshift(this.options.customAttribution));const st=d.map(lt=>function(ht){const pt=new DOMParser().parseFromString(ht,"text/html");return Array.from(pt.body.querySelectorAll("*")).forEach(mt=>{const St=mt.textContent||"";if(mt.tagName!=="A")return void mt.replaceWith(pt.createTextNode(St));const It=mt.getAttribute("href");if(!It||!/^(https?:|mailto:)/i.test(It))return void mt.replaceWith(pt.createTextNode(St));const Dt=pt.createElement("a");Dt.href=It,Dt.textContent=St,Dt.rel="noopener nofollow";const Ht=mt.getAttribute("class");Ht&&(Dt.className=Ht),mt.replaceWith(Dt)}),pt.body.innerHTML}(lt)).join(" | ");st!==this._attribHTML&&(this._attribHTML=st,d.length?(this._innerContainer.innerHTML=st,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class $y{constructor(){c.aY(["_updateLogo","_updateCompact"],this)}onAdd(d){this._map=d,this._container=Pt("div","mapboxgl-ctrl");const $=Pt("a","mapboxgl-ctrl-logo");return $.target="_blank",$.rel="noopener nofollow",$.href="https://www.mapbox.com/",$.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),$.setAttribute("rel","noopener nofollow"),this._container.appendChild($),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(d){d&&d.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const d=this._map.style._sourceCaches;if(Object.entries(d).length===0)return!0;for(const $ in d){const st=d[$].getSource();if(st.hasOwnProperty("mapbox_logo")&&!st.mapbox_logo)return!1}return!0}_updateCompact(){const d=this._container.children;if(d.length){const $=d[0];this._map.getCanvasContainer().offsetWidth<250?$.classList.add("mapboxgl-compact"):$.classList.remove("mapboxgl-compact")}}}class U0{constructor(){c.aY(["_onIndoorUpdate"],this)}onAdd(d){return this._map=d,this._container=Pt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",$=>this._onIndoorUpdate($)),this._container}_createButton(d,$){const st=Pt("button",d,this._container);return st.type="button",st.addEventListener("click",$),st}_createSeparator(){return Pt("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(d,$){this._map&&(d.setAttribute("aria-label",$),d.textContent=$)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(d){if(!d||!d.floors)return this._model=d,void(this._container.style.display="none");const $=this._model;this._model=d,this._container.style.display="inline-block",this._container.style.borderRadius="8px",$&&Array.from(this._container.children).forEach(st=>st.remove()),d.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(d.floors,d.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const d=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const $=this._map;this._model&&$&&$._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});Pt("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&d.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(d),this._createSeparator()}_updateBuildingsButtonState(){const d=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");d&&this._model&&(this._model.activeFloorsVisible?d.classList.remove("mapboxgl-ctrl-level-button-selected"):d.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(d,$){for(let st=0;st<d.length;st++){const lt=d[st],ht=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(lt.id)});this._setButtonTitle(ht,lt.zIndex.toString()),this._model&&lt.id===this._model.selectedFloorId&&$&&ht.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(ht),st<d.length-1&&this._createSeparator()}}}class am{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(d){const $=++this._id;return this._queue.push({callback:d,id:$,cancelled:!1}),$}remove(d){const $=this._currentlyRunning,st=$?this._queue.concat($):this._queue;for(const lt of st)if(lt.id===d)return void(lt.cancelled=!0)}run(d=0){const $=this._currentlyRunning=this._queue;this._queue=[];for(const st of $)if(!st.cancelled&&(st.callback(d),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class lm{constructor(d){this.jumpTo(d)}getValue(d){if(d<=this._startTime)return this._start;if(d>=this._endTime)return this._end;const $=c.dD((d-this._startTime)/(this._endTime-this._startTime));return this._start*(1-$)+this._end*$}isEasing(d){return d>=this._startTime&&d<=this._endTime}jumpTo(d){this._startTime=-1/0,this._endTime=-1/0,this._start=d,this._end=d}easeTo(d,$,st){this._start=this.getValue($),this._end=d,this._startTime=$,this._endTime=$+st}}const cm={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Bm extends c.z{constructor(d,$,st,lt){const{point:ht,lngLat:pt,originalEvent:mt,target:St}=d;super(d.type,{point:ht,lngLat:pt,originalEvent:mt,target:St}),this.preventDefault=()=>{d.preventDefault()},this.id=$,this.interaction=st,this.feature=lt}}class Pp{constructor(d){this.map=d,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(d,$){if(this.typeById.has(d))throw new Error(`Interaction id "${d}" already exists.`);const st=$.filter;let lt=$.type;st&&this.filters.set(d,c.b6(st)),lt==="mouseover"&&(lt="mouseenter"),lt==="mouseout"&&(lt="mouseleave");const ht=this.interactionsByType.get(lt)||new Map;lt==="mouseenter"||lt==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(d,$)):ht.size===0&&this.map.on(lt,this.handleType),ht.size===0&&this.interactionsByType.set(lt,ht),ht.set(d,$),this.typeById.set(d,lt)}get(d){const $=this.typeById.get(d);if(!$)return;const st=this.interactionsByType.get($);return st?st.get(d):void 0}remove(d){const $=this.typeById.get(d);if(!$)return;this.typeById.delete(d),this.filters.delete(d);const st=this.interactionsByType.get($);st&&(st.delete(d),$==="mouseenter"||$==="mouseleave"?(this.delegatedInteractions.delete(d),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):st.size===0&&this.map.off($,this.handleType))}queryTargets(d,$){const st=[];for(const[lt,ht]of $)ht.target&&st.push({targetId:lt,target:ht.target,filter:this.filters.get(lt)});return this.map.style.queryRenderedTargets(d,st,this.map.transform)}handleMove(d){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const $=this.queryTargets(d.point,Array.from(this.delegatedInteractions).reverse());$.length&&(d.type="mouseenter",this.handleType(d,$));const st=new Map;for(const[lt,{feature:ht}]of this.prevHoveredFeatures)this.hoveredFeatures.has(lt)||st.set(ht.id,ht);st.size&&(d.type="mouseleave",this.handleType(d,Array.from(st.values())))}handleOut(d){const $=Array.from(this.hoveredFeatures.values()).map(({feature:st})=>st);$.length&&(d.type="mouseleave",this.handleType(d,$)),this.hoveredFeatures.clear()}handleType(d,$){const st=d.type==="mouseenter";if(st&&!this.interactionsByType.has(d.type))return void c.w("mouseenter interaction required for mouseleave to work.");const lt=Array.from(this.interactionsByType.get(d.type)).reverse(),ht=!!$;$=$||this.queryTargets(d.point,lt);let pt=!1;const mt=new Set;for(const St of $){for(const[It,Dt]of lt){if(!Dt.target)continue;const Ht=St.variants?St.variants[It]:null;if(Ht){for(const Gt of Ht){if(v0(Gt,St,mt,It))continue;const qt=new c.dx(St,Gt),Qt=Xm(Gt,St,It);ht&&qt.id!==void 0&&(qt.state=this.map.getFeatureState(qt));const Zt=st?this.prevHoveredFeatures.get(Qt):null,sr=new Bm(d,It,Dt,qt),ir=Zt?Zt.stop:Dt.handler(sr);if(st&&this.hoveredFeatures.set(Qt,{feature:St,stop:ir}),ir!==!1){pt=!0;break}}if(pt)break}}if(pt)break}if(!pt)for(const[St,It]of lt){const{handler:Dt,target:Ht}=It;if(!Ht&&Dt(new Bm(d,St,It,null))!==!1)break}}}function CT(it,d){if(Array.isArray(it)&&Array.isArray(d)){const $=new Set(it),st=new Set(d);return $.size===st.size&&it.every(lt=>st.has(lt))}return c.by(it,d)}const AT={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},RT={showCompass:!0,showZoom:!0,visualizePitch:!1};class PT{constructor(d,$,st=!1){this._clickTolerance=10,this.element=$,this.mouseRotate=new r1({clickTolerance:d.dragRotate._mouseRotate._clickTolerance}),this.map=d,st&&(this.mousePitch=new n1({clickTolerance:d.dragRotate._mousePitch._clickTolerance})),c.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),$.addEventListener("mousedown",this.mousedown),$.addEventListener("touchstart",this.touchstart,{passive:!1}),$.addEventListener("touchmove",this.touchmove),$.addEventListener("touchend",this.touchend),$.addEventListener("touchcancel",this.reset)}down(d,$){this.mouseRotate.mousedown(d,$),this.mousePitch&&this.mousePitch.mousedown(d,$),Vt()}move(d,$){const st=this.map,lt=this.mouseRotate.mousemoveWindow(d,$),ht=lt&&lt.bearingDelta;if(ht&&st.setBearing(st.getBearing()+ht),this.mousePitch){const pt=this.mousePitch.mousemoveWindow(d,$),mt=pt&&pt.pitchDelta;mt&&st.setPitch(st.getPitch()+mt)}}off(){const d=this.element;d.removeEventListener("mousedown",this.mousedown),d.removeEventListener("touchstart",this.touchstart),d.removeEventListener("touchmove",this.touchmove),d.removeEventListener("touchend",this.touchend),d.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Xt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(d){this.down(Object.assign({},d,{ctrlKey:!0,preventDefault:()=>d.preventDefault()}),mr(this.element,d)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(d){this.move(d,mr(this.element,d))}mouseup(d){this.mouseRotate.mouseupWindow(d),this.mousePitch&&this.mousePitch.mouseupWindow(d),this.offTemp()}touchstart(d){d.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Fr(this.element,d.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>d.preventDefault()},this._startPos))}touchmove(d){d.targetTouches.length!==1?this.reset():(this._lastPos=Fr(this.element,d.targetTouches)[0],this.move({preventDefault:()=>d.preventDefault()},this._lastPos))}touchend(d){d.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function a1(it,d,$){if(it=new c.aT(it.lng,it.lat),d){const st=new c.aT(it.lng-360,it.lat),lt=new c.aT(it.lng+360,it.lat),ht=360*Math.ceil(Math.abs(it.lng-$.center.lng)/360),pt=$.locationPoint3D(it).distSqr(d),mt=d.x<0||d.y<0||d.x>$.width||d.y>$.height;$.locationPoint3D(st).distSqr(d)<pt&&(mt||Math.abs(st.lng-$.center.lng)<ht)?it=st:$.locationPoint3D(lt).distSqr(d)<pt&&(mt||Math.abs(lt.lng-$.center.lng)<ht)&&(it=lt)}for(;Math.abs(it.lng-$.center.lng)>180;){const st=$.locationPoint3D(it);if(st.x>=0&&st.y>=0&&st.x<=$.width&&st.y<=$.height)break;it.lng>$.center.lng?it.lng-=360:it.lng+=360}return it}const Ru={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},gp={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class C_ extends c.E{constructor(d,$){super(),(d instanceof HTMLElement||$)&&(d=Object.assign({element:d},$)),c.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:st="center",color:lt="#3FB1CE",scale:ht=1,draggable:pt=!1,clickTolerance:mt=0,rotation:St=gp.rotation,rotationAlignment:It=gp.rotationAlignment,pitchAlignment:Dt=gp.pitchAlignment,occludedOpacity:Ht=gp.occludedOpacity,altitude:Gt=gp.altitude}=d||{};this._anchor=st,this._color=lt,this._scale=ht,this._draggable=pt,this._clickTolerance=mt,this._rotation=St,this._rotationAlignment=It,this._pitchAlignment=Dt,this._occludedOpacity=Ht,this._altitude=Gt,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),d&&d.element?(this._element=d.element,this._offset=c.P.convert(d&&d.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=c.P.convert(d&&d.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Zt=>{Zt.preventDefault()}),this._element.addEventListener("mousedown",Zt=>{Zt.preventDefault()});const qt=this._element.classList;for(const Zt in Ru)qt.remove(`mapboxgl-marker-anchor-${Zt}`);qt.add(`mapboxgl-marker-anchor-${this._anchor}`);const Qt=d&&d.className?d.className.trim().split(/\s+/):[];qt.add(...Qt),this._popup=null}_createDefaultMarker(){const d=Pt("div"),$=$t("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},d);if(this._altitude===0){const st=$t("radialGradient",{id:"shadowGradient"},$t("defs",{},$));$t("stop",{offset:"10%","stop-opacity":.4},st),$t("stop",{offset:"100%","stop-opacity":.05},st),$t("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},$)}return $t("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},$),$t("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},$),$t("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},$),d}addTo(d){return d===this._map||(this.remove(),this._map=d,d.getCanvasContainer().appendChild(this._element),d.on("move",this._updateMoving),d.on("moveend",this._update),d.on("remove",this._clearFadeTimer),d._addMarker(this),this.setDraggable(this._draggable),this._update(),d.on("click",this._onMapClick)),this}remove(){const d=this._map;return d&&(d.off("click",this._onMapClick),d.off("move",this._updateMoving),d.off("moveend",this._update),d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler),d.off("mouseup",this._onUp),d.off("touchend",this._onUp),d.off("mousemove",this._onMove),d.off("touchmove",this._onMove),d.off("remove",this._clearFadeTimer),d._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=c.aT.convert(d),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(d){return d===this._altitude||(this._defaultMarker&&(this._altitude===0&&d!==0||this._altitude!==0&&d===0)&&(this._element=this._createDefaultMarker()),this._altitude=d||gp.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(d){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),d){if(!("offset"in d.options)){const lt=Math.sqrt(Math.pow(13.5,2)/2);d.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[lt,-1*(38.1-13.5+lt)],"bottom-right":[-lt,-1*(38.1-13.5+lt)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=d,d._marker=this,d._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(d){const $=d.code,st=d.charCode||d.keyCode;$!=="Space"&&$!=="Enter"&&st!==32&&st!==13||this.togglePopup()}_onMapClick(d){const $=d.originalEvent.target,st=this._element;this._popup&&($===st||st.contains($))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const d=this._popup;return d?(d.isOpen()?(d.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(d.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const d=this._map,$=this._pos;if(!d||!$)return!1;const st=d.unproject($,this._altitude),lt=d.getFreeCameraOptions();if(!lt.position)return!1;const ht=lt.position.toLngLat();return ht.distanceTo(st)<.9*ht.distanceTo(this._lngLat)}_evaluateOpacity(){const d=this._map;if(!d)return;const $=this._pos;if(!$||$.x<0||$.x>d.transform.width||$.y<0||$.y>d.transform.height)return void this._clearFadeTimer();const st=d.unproject($,this._altitude);let lt;d._showingGlobe()&&c.f5(d.transform,this._lngLat)?lt=0:(lt=1-d._queryFogOpacity(st),d.transform._terrainEnabled()&&d.getTerrain()&&this._behindTerrain()&&(lt*=this._occludedOpacity)),this._element.style.opacity=`${lt}`,this._element.style.pointerEvents=lt>0?"auto":"none",this._popup&&this._popup._setOpacity(lt),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const d=this._pos;if(!d||!this._map)return;const $=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${d.x}px,${d.y}px)
            ${Ru[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${$.x}px,${$.y}px)
        `}_calculateXYTransform(){const d=this._pos,$=this._map,st=this.getPitchAlignment();if(!$||!d||st!=="map")return"";if(!$._showingGlobe()){const St=$.getPitch();return St?`rotateX(${St}deg)`:""}const lt=c.cX(c.f6($.transform,this._lngLat)),ht=d.sub(c.f7($.transform)),pt=Math.abs(ht.x)+Math.abs(ht.y);if(pt===0)return"";const mt=lt/pt;return`rotateX(${-ht.y*mt}deg) rotateY(${ht.x*mt}deg)`}_calculateZTransform(){const d=this._pos,$=this._map;if(!$||!d)return"";let st=0;const lt=this.getRotationAlignment();if(lt==="map")if($._showingGlobe()){const ht=$.project(new c.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),pt=$.project(new c.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(ht);st=c.cX(Math.atan2(pt.y,pt.x))-90}else st=-$.getBearing();else if(lt==="horizon"){const ht=c.ah(4,6,$.getZoom()),pt=c.f7($.transform);pt.y+=ht*$.transform.height;const mt=d.sub(pt),St=c.cX(Math.atan2(mt.y,mt.x));st=(St>90?St-270:St+90)*(1-ht)}return st+=this._rotation,st?`rotateZ(${st}deg)`:""}_update(d){cancelAnimationFrame(this._updateFrameId);const $=this._map;$&&($.transform.renderWorldCopies&&(this._lngLat=a1(this._lngLat,this._pos,$.transform)),this._pos=$.project(this._lngLat,this._altitude),d===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),$._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),($._showingGlobe()||$.getTerrain()||$.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(d){return this._offset=c.P.convert(d),this._update(),this}addClassName(d){return this._element.classList.add(d),this}removeClassName(d){return this._element.classList.remove(d),this}toggleClassName(d){return this._element.classList.toggle(d)}_onMove(d){const $=this._map;if(!$)return;const st=this._pointerdownPos,lt=this._positionDelta;if(st&&lt){if(!this._isDragging){const ht=this._clickTolerance||$._clickTolerance;if(d.point.dist(st)<ht)return;this._isDragging=!0}this._pos=d.point.sub(lt),this._lngLat=$.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.z("dragstart"))),this.fire(new c.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const d=this._map;d&&(d.off("mousemove",this._onMove),d.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new c.z("dragend")),this._state="inactive"}_addDragHandler(d){const $=this._map,st=this._pos;$&&st&&this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(st),this._pointerdownPos=d.point,this._state="pending",$.on("mousemove",this._onMove),$.on("touchmove",this._onMove),$.once("mouseup",this._onUp),$.once("touchend",this._onUp))}setDraggable(d){this._draggable=!!d;const $=this._map;return $&&(d?($.on("mousedown",this._addDragHandler),$.on("touchstart",this._addDragHandler)):($.off("mousedown",this._addDragHandler),$.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(d){return this._rotation=d||gp.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(d){return this._rotationAlignment=d||gp.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(d){return this._pitchAlignment=d||gp.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(d){return this._occludedOpacity=d||gp.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const IT={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},$0={maxWidth:100,unit:"metric"},l1={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},yp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},xp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function p0(it=new c.P(0,0),d="bottom"){if(typeof it=="number"){const $=Math.round(Math.sqrt(.5*Math.pow(it,2)));switch(d){case"top":return new c.P(0,it);case"top-left":return new c.P($,$);case"top-right":return new c.P(-$,$);case"bottom":return new c.P(0,-it);case"bottom-left":return new c.P($,-$);case"bottom-right":return new c.P(-$,-$);case"left":return new c.P(it,0);case"right":return new c.P(-it,0)}return new c.P(0,0)}return it instanceof c.P||Array.isArray(it)?c.P.convert(it):c.P.convert(it[d]||[0,0])}return{version:ct,supported:Mt.supported,setRTLTextPlugin:c.fb,getRTLTextPluginStatus:c.fa,Map:class extends o1{constructor(it){gt.mark(dt.create);const d=it;if((it=Object.assign({},AT,it)).minZoom!=null&&it.maxZoom!=null&&it.minZoom>it.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(it.minPitch!=null&&it.maxPitch!=null&&it.minPitch>it.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(it.minPitch!=null&&it.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(it.maxPitch!=null&&it.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(it.antialias&&c.f3(window)&&(it.antialias=!1,c.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new hv(it.minZoom,it.maxZoom,it.minPitch,it.maxPitch,it.renderWorldCopies,null,null),it),this._repaint=!!it.repaint,this._interactive=it.interactive,this._minTileCacheSize=it.minTileCacheSize,this._maxTileCacheSize=it.maxTileCacheSize,this._failIfMajorPerformanceCaveat=it.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=it.preserveDrawingBuffer,this._antialias=it.antialias,this._trackResize=it.trackResize,this._bearingSnap=it.bearingSnap,this._refreshExpiredTiles=it.refreshExpiredTiles,this._fadeDuration=it.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=it.crossSourceCollisions,this._collectResourceTiming=it.collectResourceTiming,this._language=this._parseLanguage(it.language),this._worldview=it.worldview,this._renderTaskQueue=new am,this._domRenderTaskQueue=new am,this._controls=[],this._markers=[],this._popups=[],this._mapId=c.b2(),this._locale=Object.assign({},cm,it.locale),this._clickTolerance=it.clickTolerance,this._cooperativeGestures=it.cooperativeGestures,this._performanceMetricsCollection=it.performanceMetricsCollection,this._tessellationStep=it.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=it.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new lm(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=it.scaleFactor,this._requestManager=new dn(it.transformRequest,it.accessToken,it.testMode),this._silenceAuthErrors=!!it.testMode,this._contextCreateOptions=it.contextCreateOptions?Object.assign({},it.contextCreateOptions):{},typeof it.container=="string"){const $=document.getElementById(it.container);if(!$)throw new Error(`Container '${it.container.toString()}' not found.`);this._container=$}else{if(!(it.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=it.container}if(this._container.childNodes.length>0&&c.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),it.maxBounds&&this.setMaxBounds(it.maxBounds),this._spriteFormat=it.spriteFormat,c.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ST(this,it),this._localFontFamily=it.localFontFamily,this._localIdeographFontFamily=it.localIdeographFontFamily,(it.style||!it.testMode)&&this.setStyle(it.style||c.e.DEFAULT_STYLE,{config:it.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),it.projection&&this.setProjection(it.projection),it.hash&&(this._hash=new Kv(typeof it.hash=="string"&&it.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){d.center==null&&d.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:it.center,zoom:it.zoom,bearing:it.bearing,pitch:it.pitch});const $=it.bounds;$&&(this.resize(),this.fitBounds($,Object.assign({},it.fitBoundsOptions,{duration:0})))}this.resize(),it.attributionControl&&this.addControl(new Uy({customAttribution:it.customAttribution})),this._logoControl=new $y,this.addControl(this._logoControl,it.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",$=>{this._update($.dataType==="style"),this.fire(new c.z(`${$.dataType}data`,$))}),this.on("dataloading",$=>{this.fire(new c.z(`${$.dataType}dataloading`,$))}),this._interactions=new Pp(this)}_getMapId(){return this._mapId}addControl(it,d){if(d===void 0&&(d=it.getDefaultPosition?it.getDefaultPosition():"top-right"),!it||!it.onAdd)return this.fire(new c.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const $=it.onAdd(this);this._controls.push(it);const st=this._controlPositions[d];return d.indexOf("bottom")!==-1?st.insertBefore($,st.firstChild):st.appendChild($),this}removeControl(it){if(!it||!it.onRemove)return this.fire(new c.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const d=this._controls.indexOf(it);return d>-1&&this._controls.splice(d,1),it.onRemove(this),this}hasControl(it){return this._controls.indexOf(it)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(it){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const d=!this._moving;return d&&this.fire(new c.z("movestart",it)).fire(new c.z("move",it)),this.fire(new c.z("resize",it)),d&&this.fire(new c.z("moveend",it)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(it){return this.transform.setMaxBounds(c.aI.convert(it)),this._update()}setMinZoom(it){if((it=it??-2)>=-2&&it<=this.transform.maxZoom)return this.transform.minZoom=it,this._update(),this.getZoom()<it?this.setZoom(it):this.fire(new c.z("zoomstart")).fire(new c.z("zoom")).fire(new c.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(it){if((it=it??22)>=this.transform.minZoom)return this.transform.maxZoom=it,this._update(),this.getZoom()>it?this.setZoom(it):this.fire(new c.z("zoomstart")).fire(new c.z("zoom")).fire(new c.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(it){if((it=it??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(it>=0&&it<=this.transform.maxPitch)return this.transform.minPitch=it,this._update(),this.getPitch()<it?this.setPitch(it):this.fire(new c.z("pitchstart")).fire(new c.z("pitch")).fire(new c.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(it){if((it=it??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(it>=this.transform.minPitch)return this.transform.maxPitch=it,this._update(),this.getPitch()>it?this.setPitch(it):this.fire(new c.z("pitchstart")).fire(new c.z("pitch")).fire(new c.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(it){return this._scaleFactor=it,this.painter.scaleFactor=it,this._scaleFactorChanged=!0,this.style._updateFilteredLayers(d=>d.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(it){return this.transform.renderWorldCopies=it,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(it){return it==="auto"?navigator.language:Array.isArray(it)?it.length===0?void 0:it.map(d=>d==="auto"?navigator.language:d):it}setLanguage(it){const d=this._parseLanguage(it);if(!this.style||d===this._language)return this;this._language=d,this.style.reloadSources();for(const $ of this._controls)$._setLanguage&&$._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(it){return this.style&&it!==this._worldview?(this._worldview=it,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(it){return this._lazyInitEmptyStyle(),it?typeof it=="string"&&(it={name:it}):it=null,this._useExplicitProjection=!!it,this._prioritizeAndUpdateProjection(it,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const it=this.transform,d=it.projection.name;let $;d==="globe"&&it.zoom>=c.cL?(it.setMercatorFromTransition(),$=!0):d==="mercator"&&it.zoom<c.cL&&(it.setProjection({name:"globe"}),$=!0),$&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(it,d){return this._updateProjection(it||d||{name:"mercator"})}_updateProjection(it){let d;const $=this.transform.mercatorFromTransition;d=it.name==="globe"&&this.transform.zoom>=c.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(it),this.style.applyProjectionUpdate();const st=this.transform.getProjection().name==="mercator"&&$!==this.transform.mercatorFromTransition;return(d||st)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(it,d){return this.transform.locationPoint3D(c.aT.convert(it),d)}unproject(it,d){return this.transform.pointLocation3D(c.P.convert(it),d)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(it,d,$){const st=lt=>{let ht=[];if(Array.isArray(d)){const pt=d.filter(mt=>this.getLayer(mt));ht=pt.length?this.queryRenderedFeatures(lt,{layers:pt}):[]}else ht=this.queryRenderedFeatures(lt,{target:d});return ht};if(it==="mouseenter"||it==="mouseover"){let lt=!1;return{listener:$,targets:d,delegates:{mousemove:pt=>{const mt=st(pt.point);mt.length?lt||(lt=!0,$.call(this,new Wu(it,this,pt.originalEvent,{features:mt}))):lt=!1},mouseout:()=>{lt=!1}}}}if(it==="mouseleave"||it==="mouseout"){let lt=!1;return{listener:$,targets:d,delegates:{mousemove:mt=>{st(mt.point).length?lt=!0:lt&&(lt=!1,$.call(this,new Wu(it,this,mt.originalEvent)))},mouseout:mt=>{lt&&(lt=!1,$.call(this,new Wu(it,this,mt.originalEvent)))}}}}{const lt=ht=>{const pt=st(ht.point);pt.length&&(ht.features=pt,$.call(this,ht),delete ht.features)};return{listener:$,targets:d,delegates:{[it]:lt}}}}on(it,d,$){if(typeof d=="function"||$===void 0)return super.on(it,d);if(typeof d=="string"&&(d=[d]),!this._areTargetsValid(d))return this;const st=this._createDelegatedListener(it,d,$);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[it]=this._delegatedListeners[it]||[],this._delegatedListeners[it].push(st);for(const lt in st.delegates)this.on(lt,st.delegates[lt]);return this}once(it,d,$){if(typeof d=="function"||$===void 0)return super.once(it,d);if(typeof d=="string"&&(d=[d]),!this._areTargetsValid(d))return this;const st=this._createDelegatedListener(it,d,$);for(const lt in st.delegates)this.once(lt,st.delegates[lt]);return this}off(it,d,$){if(typeof d=="function"||$===void 0)return super.off(it,d);if(typeof d=="string"&&(d=[d]),!this._areTargetsValid(d))return this;const st=this._delegatedListeners?this._delegatedListeners[it]:void 0;return st&&(lt=>{for(let ht=0;ht<lt.length;ht++){const pt=lt[ht];if(pt.listener===$&&CT(pt.targets,d)){for(const mt in pt.delegates)this.off(mt,pt.delegates[mt]);return lt.splice(ht,1),this}}})(st),this}queryRenderedFeatures(it,d){if(!this.style)return[];if(it===void 0||it instanceof c.P||Array.isArray(it)||d!==void 0||(d=it,it=void 0),it=it||[[0,0],[this.transform.width,this.transform.height]],!d){const ht=this.style.queryRenderedFeatures(it,void 0,this.transform),pt=this.style.queryRenderedFeatureset(it,void 0,this.transform);return ht.concat(pt)}let $=!0;if(d.target&&($=this._isTargetValid(d.target),$&&!d.layers))return this.style.queryRenderedFeatureset(it,d,this.transform);let st=!0;if(d.layers&&Array.isArray(d.layers)){for(const ht of d.layers)if(!this._isValidId(ht)){st=!1;break}if(st&&!d.target)return this.style.queryRenderedFeatures(it,d,this.transform)}let lt=[];return st&&(lt=lt.concat(this.style.queryRenderedFeatures(it,d,this.transform))),$&&(lt=lt.concat(this.style.queryRenderedFeatureset(it,d,this.transform))),lt}querySourceFeatures(it,d){return!it||typeof it=="string"&&!this._isValidId(it)?[]:this.style.querySourceFeatures(it,d)}queryRasterValue(it,d,$){return this._isValidId(it)?this.style.queryRasterValue(it,d,$):Promise.resolve(null)}isPointOnSurface(it){const{name:d}=this.transform.projection;return d!=="globe"&&d!=="mercator"&&c.w(`${d} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(c.P.convert(it))}addInteraction(it,d){return this._interactions.add(it,d),this}removeInteraction(it){return this._interactions.remove(it),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(it){return this._cooperativeGestures=it,this}setStyle(it,d){return d=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},d),this.style&&it&&d.diff!==!1&&d.localFontFamily===this._localFontFamily&&d.localIdeographFontFamily===this._localIdeographFontFamily&&!d.config?(this.style._diffStyle(it,($,st)=>{if($){const lt=typeof $=="string"?$:$ instanceof Error?$.message:$.error;c.w(`Unable to perform style diff: ${lt}. Rebuilding the style from scratch.`),this._updateStyle(it,d)}else st&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=d.localIdeographFontFamily,this._localFontFamily=d.localFontFamily,this._updateStyle(it,d))}_getUIString(it){const d=this._locale[it];if(d==null)throw new Error(`Missing UI string '${it}'`);return d}_updateStyle(it,d){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),it){const $=Object.assign({},d);d&&d.config&&($.initialConfig=d.config,delete $.config),this.style=new mp(this,$).load(it),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new mp(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(c.w("There is no style added to the map."),!1)}_isValidId(it){return it==null?(this.fire(new c.y(new Error("IDs can't be empty."))),!1):!c.dr(it)||(this.fire(new c.y(new Error(`IDs can't contain special symbols: "${it}".`))),!1)}_isTargetValid(it){return"featuresetId"in it?this._isValidId("importId"in it?it.importId:it.featuresetId):"layerId"in it&&this._isValidId(it.layerId)}_areTargetsValid(it){if(Array.isArray(it)){for(const d of it)if(!this._isValidId(d))return!1;return!0}return this._isTargetValid(it)}addSource(it,d){return this._isValidId(it)?(this._lazyInitEmptyStyle(),this.style.addSource(it,d),this._update(!0)):this}isSourceLoaded(it){return!!this._isValidId(it)&&!!this.style&&this.style._isSourceCacheLoaded(it)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(it,d,$){this._lazyInitEmptyStyle(),this.style.addSourceType(it,d,$)}removeSource(it){return this._isValidId(it)?(this.style.removeSource(it),this._updateTerrain(),this._update(!0)):this}getSource(it){return this._isValidId(it)?this.style.getOwnSource(it):null}addImage(it,d,{pixelRatio:$=1,sdf:st=!1,stretchX:lt,stretchY:ht,content:pt}={}){this._lazyInitEmptyStyle();const mt=c.I.from(it);if(d instanceof HTMLImageElement||ImageBitmap&&d instanceof ImageBitmap){const{width:St,height:It,data:Dt}=c.o.getImageData(d);this.style.addImage(mt,{data:new c.q({width:St,height:It},Dt),pixelRatio:$,stretchX:lt,stretchY:ht,content:pt,sdf:st,version:0,usvg:!1})}else if(d.width===void 0||d.height===void 0)this.fire(new c.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:St,height:It}=d,Dt=d;this.style.addImage(mt,{data:new c.q({width:St,height:It},new Uint8Array(Dt.data)),pixelRatio:$,stretchX:lt,stretchY:ht,content:pt,sdf:st,usvg:!1,version:0,userImage:Dt}),Dt.onAdd&&Dt.onAdd(this,it)}}updateImage(it,d){this._lazyInitEmptyStyle();const $=c.I.from(it),st=this.style.getImage($);if(!st)return void this.fire(new c.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const lt=d instanceof HTMLImageElement||ImageBitmap&&d instanceof ImageBitmap?c.o.getImageData(d):d,{width:ht,height:pt,data:mt}=lt;if(ht===void 0||pt===void 0)return void this.fire(new c.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(ht!==(st.usvg?st.icon.usvg_tree.width:st.data.width)||pt!==(st.usvg?st.icon.usvg_tree.height:st.data.height))return void this.fire(new c.y(new Error(`The width and height of the updated image (${ht}, ${pt})
                must be that same as the previous version of the image
                (${st.data.width}, ${st.data.height})`)));const St=!(d instanceof HTMLImageElement||ImageBitmap&&d instanceof ImageBitmap);let It=!1;st.usvg?(st.data=new c.q({width:ht,height:pt},new Uint8Array(mt)),st.usvg=!1,st.icon=void 0,It=!0):st.data.replace(mt,St),this.style.updateImage($,st,It)}hasImage(it){return it?!!this.style&&!!this.style.getImage(c.I.from(it)):(this.fire(new c.y(new Error("Missing required image id"))),!1)}removeImage(it){this.style.removeImage(c.I.from(it))}loadImage(it,d){c.n(this._requestManager.transformRequest(it,c.R.Image),($,st)=>{d($,st instanceof HTMLImageElement?c.o.getImageData(st):st)})}listImages(){return this.style.listImages().map(it=>it.name)}addModel(it,d){this._lazyInitEmptyStyle(),this.style.addModel(it,d)}hasModel(it){return it?this.style.hasModel(it):(this.fire(new c.y(new Error("Missing required model id"))),!1)}removeModel(it){this.style.removeModel(it)}listModels(){return this.style.listModels()}addLayer(it,d){return this._isValidId(it.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(it,d),this._update(!0)):this}getSlot(it){const d=this.getLayer(it);return d&&d.slot||null}setSlot(it,d){return this.style.setSlot(it,d),this.style.mergeLayers(),this._update(!0)}addImport(it,d){return this.style.addImport(it,d).catch($=>this.fire(new c.y(new Error("Failed to add import",$)))),this}updateImport(it,d){return typeof d!="string"&&d.id!==it?(this.removeImport(it),this.addImport(d)):(this.style.updateImport(it,d),this._update(!0))}removeImport(it){return this.style.removeImport(it),this}moveImport(it,d){return this.style.moveImport(it,d),this._update(!0)}moveLayer(it,d){return this._isValidId(it)?(this.style.moveLayer(it,d),this._update(!0)):this}removeLayer(it){return this._isValidId(it)?(this.style.removeLayer(it),this._update(!0)):this}getLayer(it){if(!this._isValidId(it))return null;const d=this.style.getOwnLayer(it);return d?d.type==="custom"?d.implementation:d.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(it,d,$){return this._isValidId(it)?(this.style.setLayerZoomRange(it,d,$),this._update(!0)):this}setFilter(it,d,$={}){return this._isValidId(it)?(this.style.setFilter(it,d,$),this._update(!0)):this}getFilter(it){return this._isValidId(it)?this.style.getFilter(it):null}setPaintProperty(it,d,$,st={}){return this._isValidId(it)?(this.style.setPaintProperty(it,d,$,st),this._update(!0)):this}getPaintProperty(it,d){return this._isValidId(it)?this.style.getPaintProperty(it,d):null}setLayoutProperty(it,d,$,st={}){return this._isValidId(it)?(this.style.setLayoutProperty(it,d,$,st),this._update(!0)):this}getLayoutProperty(it,d){return this._isValidId(it)?this.style.getLayoutProperty(it,d):null}setLayerProperty(it,d,$,st={}){return this._isValidId(it)?(d==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(it,d,$,st),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(it){return this.style.setGlyphsUrl(it),this._update(!0)}getSchema(it){return this.style.getSchema(it)}setSchema(it,d){return this.style.setSchema(it,d),this._update(!0)}getConfig(it){return this.style.getConfig(it)}setConfig(it,d){return this.style.setConfig(it,d),this._update(!0)}getConfigProperty(it,d){return this.style.getConfigProperty(it,d)}setConfigProperty(it,d,$){return this.style.setConfigProperty(it,d,$),this._update(!0)}getFeaturesetDescriptors(it){return this.style.getFeaturesetDescriptors(it)}setLights(it){if(this._lazyInitEmptyStyle(),it&&it.length===1&&it[0].type==="flat"){const d=it[0];d.properties?this.style.setFlatLight(d.properties,d.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(it),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const it=this.style.getLights()||[];return it.length===0&&it.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),it}setLight(it,d={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:it}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(it){return this._lazyInitEmptyStyle(),!it&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(it),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(it){return this._lazyInitEmptyStyle(),this.style.setFog(it),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(it){return this._lazyInitEmptyStyle(),this.style.setSnow(it),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(it){return this._lazyInitEmptyStyle(),this.style.setRain(it),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(it){return this._lazyInitEmptyStyle(),this.style.setColorTheme(it),this._update(!0)}setImportColorTheme(it,d){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(it,d),this._update(!0)}setCamera(it){return this.style.setCamera(it),this._triggerCameraUpdate(it)}_triggerCameraUpdate(it){return this._update(this.transform.setOrthographicProjectionAtLowPitch(it["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(it){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(c.aT.convert(it),this.transform):0}setFeatureState(it,d){return it.source&&!this._isValidId(it.source)?this:(this.style.setFeatureState(it,d),this._update())}removeFeatureState(it,d){return it.source&&!this._isValidId(it.source)?this:(this.style.removeFeatureState(it,d),this._update())}getFeatureState(it){return it.source&&!this._isValidId(it.source)?null:this.style.getFeatureState(it)}_selectIndoorFloor(it){this.indoor.selectFloor(it)}_setIndoorActiveFloorsVisibility(it){this.indoor.setActiveFloorsVisibility(it)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new U0),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const it=this._container.getBoundingClientRect().width||400,d=this._container.getBoundingClientRect().height||300;let $,st,lt,ht=this._container;for(;ht&&(!st||!lt);){const pt=window.getComputedStyle(ht).transform;pt&&pt!=="none"&&($=pt.match(/matrix.*\((.+)\)/)[1].split(", "),$[0]&&$[0]!=="0"&&$[0]!=="1"&&(st=$[0]),$[3]&&$[3]!=="0"&&$[3]!=="1"&&(lt=$[3])),ht=ht.parentElement}this._containerWidth=st?Math.abs(it/st):it,this._containerHeight=lt?Math.abs(d/lt):d}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&c.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new cw(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const it=this._container;it.classList.add("mapboxgl-map"),(this._missingCSSCanary=Pt("div","mapboxgl-canary",it)).style.visibility="hidden",this._detectMissingCSS();const d=this._canvasContainer=Pt("div","mapboxgl-canvas-container",it);this._canvas=Pt("canvas","mapboxgl-canvas",d),this._interactive&&(d.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const $=this._controlContainer=Pt("div","mapboxgl-control-container",it),st=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(lt=>{st[lt]=Pt("div",`mapboxgl-ctrl-${lt}`,$)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(it,d){const $=c.o.devicePixelRatio||1;this._canvas.width=$*Math.ceil(it),this._canvas.height=$*Math.ceil(d),this._canvas.style.width=`${it}px`,this._canvas.style.height=`${d}px`}_addMarker(it){this._markers.push(it)}_removeMarker(it){const d=this._markers.indexOf(it);d!==-1&&this._markers.splice(d,1)}_addPopup(it){this._popups.push(it)}_removePopup(it){const d=this._popups.indexOf(it);d!==-1&&this._popups.splice(d,1)}_setupPainter(){const it=Object.assign({},Mt.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),d=this._canvas.getContext("webgl2",it);d?(Qo(d,!0),this.painter=new d_(d,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",$=>{$.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),c.k.testSupport(d)):this.fire(new c.y(new Error("Failed to initialize WebGL")))}_contextLost(it){it.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.z("webglcontextlost",{originalEvent:it}))}_contextRestored(it){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new c.z("webglcontextrestored",{originalEvent:it}))}_onMapScroll(it){if(it.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(it){return this.style?(this._styleDirty=this._styleDirty||it,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(it){return this._update(),this._renderTaskQueue.add(it)}_cancelRenderFrame(it){this._renderTaskQueue.remove(it)}_requestDomTask(it){!this.loaded()||this.loaded()&&!this.isMoving()?it():this._domRenderTaskQueue.add(it)}_render(it){let d;this.fire(new c.z("renderstart")),++this._frameId;const $=this.painter.context.extTimerQuery,st=c.o.now(),lt=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(d=lt.createQuery(),lt.beginQuery($.TIME_ELAPSED_EXT,d)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(it),this._domRenderTaskQueue.run(it),this._removed)return;this._updateProjectionTransition();const ht=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const It=this.transform.zoom,Dt=this.transform.pitch,Ht=c.o.now(),Gt=new c.ac(It,{now:Ht,fadeDuration:ht,pitch:Dt,transition:this.style.transition,worldview:this._worldview});this.style.update(Gt)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let pt=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),pt=this._updateAverageElevation(st),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):pt=this._updateAverageElevation(st);const mt=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,ht,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),mt&&(this._placementDirty=mt.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:ht,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new c.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,gt.mark(dt.load),this.fire(new c.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),d){const It=c.o.now()-st;lt.endQuery($.TIME_ELAPSED_EXT),setTimeout(()=>{const Dt=lt.getQueryParameter(d,lt.QUERY_RESULT)/1e6;lt.deleteQuery(d),this.fire(new c.z("gpu-timing-frame",{cpuTime:It,gpuTime:Dt}))},50)}if(this.listens("gpu-timing-layer")){const It=this.painter.collectGpuTimers();setTimeout(()=>{const Dt=this.painter.queryGpuTimers(It);this.fire(new c.z("gpu-timing-layer",{layerTimes:Dt}))},50)}if(this.listens("gpu-timing-deferred-render")){const It=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const Dt=this.painter.queryGpuTimeDeferredRender(It);this.fire(new c.z("gpu-timing-deferred-render",{gpuTime:Dt}))},50)}const St=this._sourcesDirty||this._styleDirty||this._placementDirty||pt;if(St||this._repaint)this.triggerRepaint();else{const It=this.idle();if(It&&(pt=this._updateAverageElevation(st,!0)),pt)this.triggerRepaint();else if(this._triggerFrame(!1),It&&(this.fire(new c.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const Dt=this._calculateSpeedIndex();this.fire(new c.z("speedindexcompleted",{speedIndex:Dt})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||St||(this._fullyLoaded=!0,gt.mark(dt.fullLoad),this._performanceMetricsCollection&&_s(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(it){for(const d of this._markers)it&&!this.getRenderWorldCopies()&&(d._lngLat=d._lngLat.wrap()),d._update();for(const d of this._popups)!it||this.getRenderWorldCopies()||d._trackPointer||(d._lngLat=d._lngLat.wrap()),d._update()}_updateAverageElevation(it,d=!1){const $=lt=>(this.transform.averageElevation=lt,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&$(0);const st=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(st||(d||it-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(it)){const lt=this.transform.averageElevation;let ht=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(ht)?ht=0:this._averageElevationLastSampledAt=it;const pt=Math.abs(lt-ht);if(pt>1){if(this._isInitialLoad||st)return this._averageElevation.jumpTo(ht),$(ht);this._averageElevation.easeTo(ht,it,300)}else if(pt>1e-4)return this._averageElevation.jumpTo(ht),$(ht)}return!!this._averageElevation.isEasing(it)&&$(this._averageElevation.getValue(it))}_authenticate(){Vl(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,it=>{if(it&&(it.message===Qr||it.status===401)){const d=this.painter.context.gl;Qo(d,!1),this._logoControl instanceof $y&&this._logoControl._updateLogo(),d&&d.clear(d.DEPTH_BUFFER_BIT|d.COLOR_BUFFER_BIT|d.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new c.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),hs(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&ss(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&ds(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){ys(this._requestManager._customAccessToken)}_updateTerrain(){const it=this._isDragging();this.painter.updateTerrain(this.style,it)}_calculateSpeedIndex(){const it=this.painter.canvasCopy(),d=this.painter.getCanvasCopiesAndTimestamps();d.timeStamps.push(performance.now());const $=this.painter.context.gl,st=$.createFramebuffer();function lt(ht){$.framebufferTexture2D($.FRAMEBUFFER,$.COLOR_ATTACHMENT0,$.TEXTURE_2D,ht,0);const pt=new Uint8Array($.drawingBufferWidth*$.drawingBufferHeight*4);return $.readPixels(0,0,$.drawingBufferWidth,$.drawingBufferHeight,$.RGBA,$.UNSIGNED_BYTE,pt),pt}return $.bindFramebuffer($.FRAMEBUFFER,st),this._canvasPixelComparison(lt(it),d.canvasCopies.map(lt),d.timeStamps)}_canvasPixelComparison(it,d,$){let st=$[1]-$[0];const lt=it.length/4;for(let ht=0;ht<d.length;ht++){const pt=d[ht];let mt=0;for(let St=0;St<pt.length;St+=4)pt[St]===it[St]&&pt[St+1]===it[St+1]&&pt[St+2]===it[St+2]&&pt[St+3]===it[St+3]&&(mt+=1);st+=($[ht+2]-$[ht+1])*(1-mt/lt)}return st}remove(){this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const it=this.painter.context.gl.getExtension("WEBGL_lose_context");it&&it.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),ba.delete(this.painter.context.gl),Ss.remove(),vn.remove(),this._removed=!0,this.fire(new c.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(it){this._renderNextFrame=this._renderNextFrame||it,this.style&&!this._frame&&(this._frame=c.o.frame(d=>{const $=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,$&&this._render(d)}))}_preloadTiles(it){const d=this.style?this.style.getSourceCaches():[];return c.bw(d,($,st)=>$._preloadTiles(it,st),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(it){this._trackResize&&this.resize({originalEvent:it})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(it){this._showTileBoundaries!==it&&(this._showTileBoundaries=it,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(it){this._showParseStatus!==it&&(this._showParseStatus=it,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(it){this._showTerrainWireframe!==it&&(this._showTerrainWireframe=it,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(it){this._showLayers2DWireframe!==it&&(this._showLayers2DWireframe=it,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(it){this._showLayers3DWireframe!==it&&(this._showLayers3DWireframe=it,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(it){this._speedIndexTiming!==it&&(this._speedIndexTiming=it,this._update())}get showPadding(){return!!this._showPadding}set showPadding(it){this._showPadding!==it&&(this._showPadding=it,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(it){this._showCollisionBoxes!==it&&(this._showCollisionBoxes=it,this.style&&it?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(it){this._showOverdrawInspector!==it&&(this._showOverdrawInspector=it,this._update())}get repaint(){return!!this._repaint}set repaint(it){this._repaint!==it&&(this._repaint=it,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(it){this._vertices=it,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(it){this._showTileAABBs!==it&&(this._showTileAABBs=it,it&&this._update())}_setCacheLimits(it,d){c.f4(it,d)}get version(){return ct}},NavigationControl:class{constructor(it={}){this.options=Object.assign({},RT,it),this._container=Pt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",d=>d.preventDefault()),this.options.showZoom&&(c.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",d=>{this._map&&this._map.zoomIn({},{originalEvent:d})}),Pt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",d=>{this._map&&this._map.zoomOut({},{originalEvent:d})}),Pt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(c.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",d=>{const $=this._map;$&&(this.options.visualizePitch?$.resetNorthPitch({},{originalEvent:d}):$.resetNorth({},{originalEvent:d}))}),this._compassIcon=Pt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const it=this._map;if(!it)return;const d=it.getZoom(),$=d===it.getMaxZoom(),st=d===it.getMinZoom();this._zoomInButton.disabled=$,this._zoomOutButton.disabled=st,this._zoomInButton.setAttribute("aria-disabled",$.toString()),this._zoomOutButton.setAttribute("aria-disabled",st.toString())}_rotateCompassArrow(){const it=this._map;if(!it)return;const d=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(it.transform.pitch*(Math.PI/180)),.5)}) rotateX(${it.transform.pitch}deg) rotateZ(${it.transform.angle*(180/Math.PI)}deg)`:`rotate(${it.transform.angle*(180/Math.PI)}deg)`;it._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=d)})}onAdd(it){return this._map=it,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),it.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&it.on("pitch",this._rotateCompassArrow),it.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new PT(it,this._compass,this.options.visualizePitch)),this._container}onRemove(){const it=this._map;it&&(this._container.remove(),this.options.showZoom&&it.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&it.off("pitch",this._rotateCompassArrow),it.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(it,d){const $=Pt("button",it,this._container);return $.type="button",$.addEventListener("click",d),$}_setButtonTitle(it,d){if(!this._map)return;const $=this._map._getUIString(`NavigationControl.${d}`);it.setAttribute("aria-label",$),it.firstElementChild&&it.firstElementChild.setAttribute("title",$)}},GeolocateControl:class extends c.E{constructor(it={}){super();const d=navigator.geolocation;this.options=Object.assign({geolocation:d},IT,it),c.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=p_(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(it){return this._map=it,this._container=Pt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(it){const d=($=!!this.options.geolocation)=>{this._supportsGeolocation=$,it($)};this._supportsGeolocation!==void 0?it(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then($=>d($.state!=="denied")).catch(()=>d()):d()}_isOutOfMapMaxBounds(it){const d=this._map.getMaxBounds(),$=it.coords;return!!d&&($.longitude<d.getWest()||$.longitude>d.getEast()||$.latitude<d.getSouth()||$.latitude>d.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(it){if(this._map){if(this._isOutOfMapMaxBounds(it))return this._setErrorState(),this.fire(new c.z("outofmaxbounds",it)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=it,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(it),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(it),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new c.z("geolocate",Object.assign({coords:it.coords,timestamp:it.timestamp},it.toJSON?{toJSON:it.toJSON.bind(it)}:{}))),this._finish()}}_updateCamera(it){const d=new c.aT(it.coords.longitude,it.coords.latitude),$=it.coords.accuracy,st=this._map.getBearing(),lt=Object.assign({bearing:st},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds($),lt,{geolocateSource:!0})}_updateMarker(it){if(it){const d=new c.aT(it.coords.longitude,it.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=it.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const it=this._map.transform,d=c.cf(1,it._center.lat)*it.worldSize,$=Math.ceil(2*this._accuracy*d);this._circleElement.style.width=`${$}px`,this._circleElement.style.height=`${$}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(it){if(this._map){if(this.options.trackUserLocation)if(it.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",d),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(it.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new c.z("error",it)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(it){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=Pt("button","mapboxgl-ctrl-geolocate",this._container),Pt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",it===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",d),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",d),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Pt("div","mapboxgl-user-location"),this._dotElement.appendChild(Pt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Pt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new C_({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Pt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new C_({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new c.z("trackuserlocationend")))})}}_onDeviceOrientation(it){this._userLocationDotMarker&&(it.webkitCompassHeading?this._heading=it.webkitCompassHeading:it.absolute===!0&&(this._heading=-1*it.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new c.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let it;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(it={maximumAge:6e5,timeout:0},this._noTimeout=!0):(it=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,it),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const it=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(d=>{d==="granted"&&it()}).catch(console.error):it()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Uy,ScaleControl:class{constructor(it={}){this.options=Object.assign({},$0,it),c.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const it=this.options.maxWidth||100,d=this._map,$=d._containerHeight/2,st=d._containerWidth/2-it/2,lt=d.unproject([st,$]),ht=d.unproject([st+it,$]),pt=lt.distanceTo(ht);if(this.options.unit==="imperial"){const mt=3.2808*pt;mt>5280?this._setScale(it,mt/5280,"mile"):this._setScale(it,mt,"foot")}else this.options.unit==="nautical"?this._setScale(it,pt/1852,"nautical-mile"):pt>=1e3?this._setScale(it,pt/1e3,"kilometer"):this._setScale(it,pt,"meter")}_setScale(it,d,$){this._map._requestDomTask(()=>{const st=function(ht){const pt=Math.pow(10,`${Math.floor(ht)}`.length-1);let mt=ht/pt;return mt=mt>=10?10:mt>=5?5:mt>=3?3:mt>=2?2:mt>=1?1:function(St){const It=Math.pow(10,Math.ceil(-Math.log(St)/Math.LN10));return Math.round(St*It)/It}(mt),pt*mt}(d),lt=st/d;this._container.innerHTML=$!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:$}).format(st):`${st}&nbsp;${l1[$]}`,this._container.style.width=it*lt+"px"})}onAdd(it){return this._map=it,this._language=it.getLanguage(),this._container=Pt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",it.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(it){this._language=it,this._update()}setUnit(it){this.options.unit=it,this._update()}},FullscreenControl:class{constructor(it={}){this._fullscreen=!1,it&&it.container&&(it.container instanceof HTMLElement?this._container=it.container:c.w("Full screen control 'container' must be a DOM element.")),c.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(it){return this._map=it,this._container||(this._container=this._map.getContainer()),this._controlContainer=Pt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",c.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const it=this._fullscreenButton=Pt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Pt("span","mapboxgl-ctrl-icon",it).setAttribute("aria-hidden","true"),it.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const it=this._getTitle();this._fullscreenButton.setAttribute("aria-label",it),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",it)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:U0,Popup:class extends c.E{constructor(it){super(),this.options=Object.assign(Object.create(yp),it),this._altitude=this.options.altitude,c.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(it&&it.className?it.className.trim().split(/\s+/):[])}addTo(it){return this._map&&this.remove(),this._map=it,this.options.closeOnClick&&it.on("preclick",this._onClose),this.options.closeOnMove&&it.on("move",this._onClose),it.on("remove",this.remove),this._update(),it._addPopup(this),this._focusFirstElement(),this._trackPointer?(it.on("mousemove",this._onMouseEvent),it.on("mouseup",this._onMouseEvent),it._canvasContainer.classList.add("mapboxgl-track-pointer")):it.on("move",this._update),this.fire(new c.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const it=this._map;return it&&(it.off("move",this._update),it.off("move",this._onClose),it.off("preclick",this._onClose),it.off("click",this._onClose),it.off("remove",this.remove),it.off("mousemove",this._onMouseEvent),it.off("mouseup",this._onMouseEvent),it.off("drag",this._onMouseEvent),it._canvasContainer&&it._canvasContainer.classList.remove("mapboxgl-track-pointer"),it._removePopup(this),this._map=void 0),this.fire(new c.z("close")),this}getLngLat(){return this._lngLat}setLngLat(it){this._lngLat=c.aT.convert(it),this._pos=null,this._trackPointer=!1,this._update();const d=this._map;return d&&(d.on("move",this._update),d.off("mousemove",this._onMouseEvent),d._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(it){return this._altitude=it,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const it=this._map;return it&&(it.off("move",this._update),it.on("mousemove",this._onMouseEvent),it.on("drag",this._onMouseEvent),it._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(it){return this.setDOMContent(document.createTextNode(it))}setHTML(it){const d=document.createDocumentFragment(),$=document.createElement("body");let st;for($.innerHTML=it;st=$.firstChild,st;)d.appendChild(st);return this.setDOMContent(d)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(it){return this.options.maxWidth=it,this._update(),this}setDOMContent(it){let d=this._content;if(d)for(;d.hasChildNodes();)d.firstChild&&d.removeChild(d.firstChild);else d=this._content=Pt("div","mapboxgl-popup-content",this._container||void 0);if(d.appendChild(it),this.options.closeButton){const $=this._closeButton=Pt("button","mapboxgl-popup-close-button",d);$.type="button",$.setAttribute("aria-label","Close popup"),$.innerHTML='<span aria-hidden="true">&#215;</span>',$.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(it){return this._classList.add(it),this._updateClassList(),this}removeClassName(it){return this._classList.delete(it),this._updateClassList(),this}setOffset(it){return this.options.offset=it,this._update(),this}toggleClassName(it){let d;return this._classList.delete(it)?d=!1:(this._classList.add(it),d=!0),this._updateClassList(),d}_onMouseEvent(it){this._update(it.point)}_getAnchor(it){if(this.options.anchor)return this.options.anchor;const d=this._map,$=this._container,st=this._pos;if(!d||!$||!st)return"bottom";const lt=$.offsetWidth,ht=$.offsetHeight,pt=st.x<lt/2,mt=st.x>d.transform.width-lt/2;if(st.y+it<ht)return pt?"top-left":mt?"top-right":"top";if(st.y>d.transform.height-ht){if(pt)return"bottom-left";if(mt)return"bottom-right"}return pt?"left":mt?"right":"bottom"}_updateClassList(){const it=this._container;if(!it)return;const d=[...this._classList];d.push("mapboxgl-popup"),this._anchor&&d.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&d.push("mapboxgl-popup-track-pointer"),it.className=d.join(" ")}_update(it){const d=this._map,$=this._content;if(!d||!this._lngLat&&!this._trackPointer||!$)return;let st=this._container;if(st||(st=this._container=Pt("div","mapboxgl-popup",d.getContainer()),this._tip=Pt("div","mapboxgl-popup-tip",st),st.appendChild($)),this.options.maxWidth&&st.style.maxWidth!==this.options.maxWidth&&(st.style.maxWidth=this.options.maxWidth),d.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=a1(this._lngLat,this._pos,d.transform)),!this._trackPointer||it){const lt=this._pos=this._trackPointer&&it instanceof c.P?it:d.project(this._lngLat,this._altitude),ht=p0(this.options.offset),pt=this._anchor=this._getAnchor(ht.y),mt=p0(this.options.offset,pt),St=lt.add(mt).round();d._requestDomTask(()=>{this._container&&pt&&(this._container.style.transform=`${Ru[pt]} translate(${St.x}px,${St.y}px)`)})}if(!this._marker&&d._showingGlobe()){const lt=c.f5(d.transform,this._lngLat)?0:1;this._setOpacity(lt)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const it=this._container.querySelector(xp);it&&it.focus()}_onClose(){this.remove()}_setOpacity(it){this._container&&(this._container.style.opacity=`${it}`),this._content&&(this._content.style.pointerEvents=it?"auto":"none")}},Marker:C_,Style:mp,LngLat:c.aT,LngLatBounds:c.aI,Point:c.P,MercatorCoordinate:c.ae,FreeCameraOptions:Ou,Evented:c.E,config:c.e,prewarm:c.f9,clearPrewarmedResources:c.f8,get accessToken(){return c.e.ACCESS_TOKEN},set accessToken(it){c.e.ACCESS_TOKEN=it},get baseApiUrl(){return c.e.API_URL},set baseApiUrl(it){c.e.API_URL=it},get workerCount(){return c.fi.workerCount},set workerCount(it){c.fi.workerCount=it},get maxParallelImageRequests(){return c.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(it){c.e.MAX_PARALLEL_IMAGE_REQUESTS=it},clearStorage(it){c.fh(it)},get workerUrl(){return c.fg.workerUrl},set workerUrl(it){c.fg.workerUrl=it},get workerClass(){return c.fg.workerClass},set workerClass(it){c.fg.workerClass=it},get workerParams(){return c.fg.workerParams},set workerParams(it){c.fg.workerParams=it},get dracoUrl(){return c.ff()},set dracoUrl(it){c.fe(it)},get meshoptUrl(){return c.fd()},set meshoptUrl(it){c.fc(it)},setNow:c.o.setNow,restoreNow:c.o.restoreNow}});var nt=_;return nt})})(mapboxGl);var mapboxGlExports=mapboxGl.exports;const mapboxgl=getDefaultExportFromCjs(mapboxGlExports);function useFranchises(){const[e,i]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[_,et]=reactExports.useState(null);return reactExports.useEffect(()=>{const nt=ref(database,"franchises"),c=onValue(nt,ct=>{try{const dt=ct.val();if(dt){const gt=Object.entries(dt).map(([Tt,Et])=>({...Et,id:Tt}));i(gt)}else i([]);a(!1)}catch{et("Failed to fetch franchises"),a(!1)}});return()=>c()},[]),{franchises:e,loading:s,error:_}}function useFranchise(e){const[i,s]=reactExports.useState(null),[a,_]=reactExports.useState(!0),[et,nt]=reactExports.useState(null);return reactExports.useEffect(()=>{if(!e){_(!1);return}const c=ref(database,`franchises/${e}`),ct=onValue(c,dt=>{try{const gt=dt.val();s(gt?{...gt,id:e}:null),_(!1)}catch{nt("Failed to fetch franchise"),_(!1)}});return()=>ct()},[e]),{franchise:i,loading:a,error:et}}function useAllUsersForAdmin(){const[e,i]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[_,et]=reactExports.useState(0),nt=reactExports.useCallback(()=>{et(c=>c+1)},[]);return reactExports.useEffect(()=>{const c=ref(database,"users"),ct=onValue(c,dt=>{const gt=dt.val();if(gt){const Tt=Object.entries(gt).map(([Et,At])=>({...At,id:Et}));i(Tt)}else i([]);a(!1)});return()=>ct()},[_]),{users:e,loading:s,refetch:nt}}async function createFranchise(e){try{const i=ref(database,"franchises"),s=push(i);return await set(s,e),e.adminId&&await update(ref(database,`users/${e.adminId}`),{role:"franchise_admin",franchiseId:s.key}),s.key}catch(i){return console.error("Error creating franchise:",i),null}}async function deleteFranchise(e,i){i&&await update(ref(database,`users/${i}`),{role:"user",franchiseId:null});const s=ref(database,`franchises/${e}`);await remove(s)}async function createFranchiseAdmin(e,i,s,a){try{const _=await createUserWithEmailAndPassword(auth,e,i),et={id:_.user.uid,email:e,name:s,phone:a,role:"franchise_admin",createdAt:Date.now()};return await set(ref(database,`users/${_.user.uid}`),et),_.user.uid}catch(_){throw _.code==="auth/email-already-in-use"?new Error("Email already in use"):_}}function FranchiseZoneLocationPicker({onLocationSelect:e,initialLocation:i,label:s="Kitchen Location",instructions:a="Select location within green zone",fullScreen:_=!1,showZoomControls:et=!0}){var fn;const nt=reactExports.useRef(null),c=reactExports.useRef(null),ct=reactExports.useRef(null),[dt,gt]=reactExports.useState(!0),[Tt,Et]=reactExports.useState(!1),[At,Mt]=reactExports.useState("Tap on map to select location"),[Pt,$t]=reactExports.useState(!1),[Lt,Bt]=reactExports.useState(null),{franchises:Nt,loading:Vt}=useFranchises(),Xt=async(Lr,Qr)=>{try{const en=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${Qr},${Lr}.json?access_token=${MAPBOX_ACCESS_TOKEN}&types=address,place,postcode`)).json();return en.features&&en.features.length>0?en.features[0].place_name:"Unknown location"}catch(dn){return console.error("Geocoding error:",dn),"Unknown location"}},nr=(Lr,Qr)=>{for(const dn of Nt)if(dn.zone&&isPointInPolygon({lat:Lr,lng:Qr},dn.zone))return{isInZone:!0,franchiseId:dn.id};return{isInZone:!1,franchiseId:null}},ar=async Lr=>{if(!c.current)return;Et(!0);const{isInZone:Qr,franchiseId:dn}=nr(Lr.lat,Lr.lng);$t(!Qr),Bt(dn),ct.current?ct.current.setLngLat([Lr.lng,Lr.lat]):(ct.current=new mapboxgl.Marker({color:"#f97316",draggable:!0}).setLngLat([Lr.lng,Lr.lat]).addTo(c.current),ct.current.on("dragend",async()=>{var Ar;const yr=(Ar=ct.current)==null?void 0:Ar.getLngLat();if(yr){Et(!0);const{isInZone:rr,franchiseId:ur}=nr(yr.lat,yr.lng);$t(!rr),Bt(ur);const Br=await Xt(yr.lat,yr.lng);Mt(Br),e({lat:yr.lat,lng:yr.lng,address:Br,franchiseId:rr?ur:null}),Et(!1)}}));const en=await Xt(Lr.lat,Lr.lng);Mt(en),e({lat:Lr.lat,lng:Lr.lng,address:en,franchiseId:Qr?dn:null}),Et(!1)},mr=()=>{"geolocation"in navigator&&(Et(!0),navigator.geolocation.getCurrentPosition(async Lr=>{const{latitude:Qr,longitude:dn}=Lr.coords;c.current&&c.current.flyTo({center:[dn,Qr],zoom:14,duration:1500}),await ar({lat:Qr,lng:dn})},Lr=>{console.error("Location error:",Lr),Et(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4}))},Fr=()=>{!c.current||Nt.length===0||Nt.forEach((Lr,Qr)=>{if(!Lr.zone||!c.current)return;const dn=`franchise-zone-${Lr.id}`,en=`franchise-zone-fill-${Lr.id}`,yr=`franchise-zone-line-${Lr.id}`;c.current.getLayer(en)&&c.current.removeLayer(en),c.current.getLayer(yr)&&c.current.removeLayer(yr),c.current.getSource(dn)&&c.current.removeSource(dn),c.current.addSource(dn,{type:"geojson",data:{type:"Feature",properties:{name:Lr.name},geometry:Lr.zone}}),c.current.addLayer({id:en,type:"fill",source:dn,paint:{"fill-color":"#22c55e","fill-opacity":.15}}),c.current.addLayer({id:yr,type:"line",source:dn,paint:{"line-color":"#22c55e","line-width":2,"line-dasharray":[2,2]}})})};reactExports.useEffect(()=>{if(!nt.current||Vt)return;mapboxgl.accessToken=MAPBOX_ACCESS_TOKEN;let Lr=[78.4867,17.385];if(i)Lr=[i.lng,i.lat];else if(Nt.length>0&&Nt[0].zone){const Qr=getPolygonCenter(Nt[0].zone);Qr&&(Lr=[Qr.lng,Qr.lat])}return c.current=new mapboxgl.Map({container:nt.current,style:"mapbox://styles/mapbox/streets-v12",center:Lr,zoom:12,attributionControl:!1}),c.current.on("load",()=>{gt(!1),Fr(),i&&ar({lat:i.lat,lng:i.lng})}),c.current.on("click",async Qr=>{await ar({lat:Qr.lngLat.lat,lng:Qr.lngLat.lng})}),et&&c.current.addControl(new mapboxgl.NavigationControl({showCompass:!1}),"bottom-right"),()=>{var Qr;(Qr=c.current)==null||Qr.remove()}},[Vt,Nt]),reactExports.useEffect(()=>{c.current&&!dt&&Nt.length>0&&Fr()},[Nt,dt]);const sn=Lt?(fn=Nt.find(Lr=>Lr.id===Lt))==null?void 0:fn.name:null;return jsxRuntimeExports.jsxs("div",{className:`flex flex-col ${_?"absolute inset-0":"space-y-3 h-full"}`,children:[jsxRuntimeExports.jsxs("div",{className:`relative overflow-hidden ${_?"flex-1 w-full h-full":"rounded-xl flex-1 min-h-[435px]"}`,children:[jsxRuntimeExports.jsx("div",{ref:nt,className:"absolute inset-0",style:{marginBottom:"-30px",height:"calc(100% + 30px)"}}),(dt||Vt)&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-secondary flex items-center justify-center z-10",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-6 h-6 animate-spin text-primary"})}),jsxRuntimeExports.jsx(Button,{size:"icon",variant:"secondary",className:`absolute right-3 rounded-full shadow-md z-10 ${_?"top-safe-offset":"top-3"}`,style:{top:_?"1rem":void 0},onClick:mr,children:jsxRuntimeExports.jsx(Navigation,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("div",{className:`absolute left-3 bg-card/90 backdrop-blur-sm rounded-lg px-3 py-1.5 z-10 ${_?"top-safe-offset":"top-3"}`,style:{top:_?"1rem":void 0},children:jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:a})}),!_&&jsxRuntimeExports.jsxs("div",{className:"absolute bottom-3 left-3 bg-card/90 backdrop-blur-sm rounded-lg px-3 py-1.5 flex items-center gap-2 z-10",children:[jsxRuntimeExports.jsx("div",{className:"w-3 h-3 rounded-sm bg-green-500/30 border border-green-500"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Service Area"})]})]}),jsxRuntimeExports.jsxs("div",{className:`${_?"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-background/80 to-transparent pt-12":"space-y-3"}`,children:[Pt&&jsxRuntimeExports.jsxs("div",{className:`bg-destructive/10 border border-destructive/20 p-3 flex items-start gap-3 ${_?"rounded-xl mb-3 bg-background/95 backdrop-blur-sm":"rounded-xl"}`,children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-5 h-5 text-destructive flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-destructive",children:"Outside Service Area"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Please select a location within the green zone."})]})]}),jsxRuntimeExports.jsxs("div",{className:`p-3 flex items-start gap-3 ${_?"rounded-xl bg-background/95 backdrop-blur-sm shadow-sm border border-border/50":`rounded-xl ${Pt?"bg-muted":"bg-secondary"}`}`,children:[jsxRuntimeExports.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${Pt?"bg-muted-foreground/10":"bg-primary/10"}`,children:Tt?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 text-primary animate-spin"}):jsxRuntimeExports.jsx(MapPin,{className:`w-4 h-4 ${Pt?"text-muted-foreground":"text-primary"}`})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:s}),jsxRuntimeExports.jsx("p",{className:`text-sm font-medium line-clamp-2 ${Pt?"text-muted-foreground":"text-foreground"}`,children:Tt?"Finding address...":At}),sn&&!Pt&&jsxRuntimeExports.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[" ",sn," zone"]})]})]})]})]})}function RegisterKitchen(){const{user:e}=useAuth(),i=useNavigate(),[s,a]=reactExports.useState(!1),[_,et]=reactExports.useState(null),[nt,c]=reactExports.useState(null),[ct,dt]=reactExports.useState(null),[gt,Tt]=reactExports.useState({name:"",description:"",specialties:"",cookingTime:"20-30 mins",isVeg:!0,address:{line1:"",line2:"",city:"",pincode:"",lat:0,lng:0}}),Et=Mt=>{var $t;const Pt=($t=Mt.target.files)==null?void 0:$t[0];if(Pt){et(Pt);const Lt=new FileReader;Lt.onloadend=()=>{c(Lt.result)},Lt.readAsDataURL(Pt)}},At=async Mt=>{if(Mt.preventDefault(),!e){ue.error("Please login first");return}if(!gt.name||!gt.address.line1||!ct){ue.error("Please fill in all required fields and select location within service area");return}a(!0);try{let Pt="https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=400";if(_){const $t=await uploadToImgBB(_);$t&&(Pt=$t.display_url)}await createKitchen({ownerId:e.id,franchiseId:ct,name:gt.name,description:gt.description,image:Pt,coverImage:Pt,address:gt.address,rating:0,totalRatings:0,isOpen:!1,specialties:gt.specialties.split(",").map($t=>$t.trim()).filter(Boolean),cookingTime:gt.cookingTime,isVeg:gt.isVeg,isApproved:!1,createdAt:Date.now()}),ue.success("Kitchen registered! Waiting for admin approval."),i("/amma/dashboard")}catch(Pt){console.error("Registration failed:",Pt),ue.error("Failed to register kitchen")}finally{a(!1)}};return!e||e.role!=="amma"?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"You need to be registered as an Amma"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Login as Amma"})})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[jsxRuntimeExports.jsx(Link,{to:"/amma/dashboard",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})})}),jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Register Kitchen"})]})}),jsxRuntimeExports.jsxs("form",{onSubmit:At,className:"px-4 py-6 space-y-6",children:[jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsxs("label",{className:"cursor-pointer",children:[jsxRuntimeExports.jsx("div",{className:"w-32 h-32 rounded-2xl bg-secondary flex items-center justify-center overflow-hidden",children:nt?jsxRuntimeExports.jsx("img",{src:nt,alt:"Preview",className:"w-full h-full object-cover"}):jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(Camera,{className:"w-8 h-8 text-muted-foreground mx-auto mb-1"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Add Photo"})]})}),jsxRuntimeExports.jsx("input",{type:"file",accept:"image/*",onChange:Et,className:"hidden"})]})}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Kitchen Name *"}),jsxRuntimeExports.jsx(Input,{placeholder:"e.g., Lakshmi Amma's Kitchen",value:gt.name,onChange:Mt=>Tt({...gt,name:Mt.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Description"}),jsxRuntimeExports.jsx(Textarea,{placeholder:"Tell customers about your kitchen and cooking style...",value:gt.description,onChange:Mt=>Tt({...gt,description:Mt.target.value}),className:"bg-secondary border-0 mt-1 resize-none",rows:3})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Specialties (comma separated)"}),jsxRuntimeExports.jsx(Input,{placeholder:"e.g., Biryani, Andhra Meals, Pickles",value:gt.specialties,onChange:Mt=>Tt({...gt,specialties:Mt.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Cooking Time"}),jsxRuntimeExports.jsx(Input,{placeholder:"e.g., 20-30 mins",value:gt.cookingTime,onChange:Mt=>Tt({...gt,cookingTime:Mt.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between bg-secondary rounded-xl p-4",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"veg-switch",children:"Pure Vegetarian Kitchen"}),jsxRuntimeExports.jsx(Switch,{id:"veg-switch",checked:gt.isVeg,onCheckedChange:Mt=>Tt({...gt,isVeg:Mt})})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-foreground flex items-center gap-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4"})," Kitchen Location"]}),jsxRuntimeExports.jsx(FranchiseZoneLocationPicker,{onLocationSelect:Mt=>{var Lt;dt(Mt.franchiseId);const Pt=Mt.address.split(","),$t=Pt.length>1?(Lt=Pt[Pt.length-2])==null?void 0:Lt.trim():"";Tt({...gt,address:{...gt.address,line1:Mt.address,city:$t||gt.address.city,lat:Mt.lat,lng:Mt.lng}})}}),jsxRuntimeExports.jsx(Input,{placeholder:"Additional address details (optional)",value:gt.address.line2,onChange:Mt=>Tt({...gt,address:{...gt.address,line2:Mt.target.value}}),className:"bg-secondary border-0"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(Input,{placeholder:"City",value:gt.address.city,onChange:Mt=>Tt({...gt,address:{...gt.address,city:Mt.target.value}}),className:"bg-secondary border-0"}),jsxRuntimeExports.jsx(Input,{placeholder:"Pincode",value:gt.address.pincode,onChange:Mt=>Tt({...gt,address:{...gt.address,pincode:Mt.target.value}}),className:"bg-secondary border-0"})]})]}),jsxRuntimeExports.jsx(Button,{type:"submit",disabled:s,className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl",children:s?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin"}),jsxRuntimeExports.jsx("span",{children:"Registering..."})]}):"Register Kitchen"})]})]})}function clamp(e,[i,s]){return Math.min(s,Math.max(i,e))}var OPEN_KEYS=[" ","Enter","ArrowUp","ArrowDown"],SELECTION_KEYS=[" ","Enter"],SELECT_NAME="Select",[Collection,useCollection,createCollectionScope]=createCollection(SELECT_NAME),[createSelectContext,createSelectScope]=createContextScope(SELECT_NAME,[createCollectionScope,createPopperScope]),usePopperScope=createPopperScope(),[SelectProvider,useSelectContext]=createSelectContext(SELECT_NAME),[SelectNativeOptionsProvider,useSelectNativeOptionsContext]=createSelectContext(SELECT_NAME),Select$1=e=>{const{__scopeSelect:i,children:s,open:a,defaultOpen:_,onOpenChange:et,value:nt,defaultValue:c,onValueChange:ct,dir:dt,name:gt,autoComplete:Tt,disabled:Et,required:At,form:Mt}=e,Pt=usePopperScope(i),[$t,Lt]=reactExports.useState(null),[Bt,Nt]=reactExports.useState(null),[Vt,Xt]=reactExports.useState(!1),nr=useDirection(dt),[ar,mr]=useControllableState({prop:a,defaultProp:_??!1,onChange:et,caller:SELECT_NAME}),[Fr,sn]=useControllableState({prop:nt,defaultProp:c,onChange:ct,caller:SELECT_NAME}),fn=reactExports.useRef(null),Lr=$t?Mt||!!$t.closest("form"):!0,[Qr,dn]=reactExports.useState(new Set),en=Array.from(Qr).map(yr=>yr.props.value).join(";");return jsxRuntimeExports.jsx(Root2$3,{...Pt,children:jsxRuntimeExports.jsxs(SelectProvider,{required:At,scope:i,trigger:$t,onTriggerChange:Lt,valueNode:Bt,onValueNodeChange:Nt,valueNodeHasChildren:Vt,onValueNodeHasChildrenChange:Xt,contentId:useId(),value:Fr,onValueChange:sn,open:ar,onOpenChange:mr,dir:nr,triggerPointerDownPosRef:fn,disabled:Et,children:[jsxRuntimeExports.jsx(Collection.Provider,{scope:i,children:jsxRuntimeExports.jsx(SelectNativeOptionsProvider,{scope:e.__scopeSelect,onNativeOptionAdd:reactExports.useCallback(yr=>{dn(Ar=>new Set(Ar).add(yr))},[]),onNativeOptionRemove:reactExports.useCallback(yr=>{dn(Ar=>{const rr=new Set(Ar);return rr.delete(yr),rr})},[]),children:s})}),Lr?jsxRuntimeExports.jsxs(SelectBubbleInput,{"aria-hidden":!0,required:At,tabIndex:-1,name:gt,autoComplete:Tt,value:Fr,onChange:yr=>sn(yr.target.value),disabled:Et,form:Mt,children:[Fr===void 0?jsxRuntimeExports.jsx("option",{value:""}):null,Array.from(Qr)]},en):null]})})};Select$1.displayName=SELECT_NAME;var TRIGGER_NAME="SelectTrigger",SelectTrigger$1=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,disabled:a=!1,..._}=e,et=usePopperScope(s),nt=useSelectContext(TRIGGER_NAME,s),c=nt.disabled||a,ct=useComposedRefs$1(i,nt.onTriggerChange),dt=useCollection(s),gt=reactExports.useRef("touch"),[Tt,Et,At]=useTypeaheadSearch(Pt=>{const $t=dt().filter(Nt=>!Nt.disabled),Lt=$t.find(Nt=>Nt.value===nt.value),Bt=findNextItem($t,Pt,Lt);Bt!==void 0&&nt.onValueChange(Bt.value)}),Mt=Pt=>{c||(nt.onOpenChange(!0),At()),Pt&&(nt.triggerPointerDownPosRef.current={x:Math.round(Pt.pageX),y:Math.round(Pt.pageY)})};return jsxRuntimeExports.jsx(Anchor,{asChild:!0,...et,children:jsxRuntimeExports.jsx(Primitive.button,{type:"button",role:"combobox","aria-controls":nt.contentId,"aria-expanded":nt.open,"aria-required":nt.required,"aria-autocomplete":"none",dir:nt.dir,"data-state":nt.open?"open":"closed",disabled:c,"data-disabled":c?"":void 0,"data-placeholder":shouldShowPlaceholder(nt.value)?"":void 0,..._,ref:ct,onClick:composeEventHandlers(_.onClick,Pt=>{Pt.currentTarget.focus(),gt.current!=="mouse"&&Mt(Pt)}),onPointerDown:composeEventHandlers(_.onPointerDown,Pt=>{gt.current=Pt.pointerType;const $t=Pt.target;$t.hasPointerCapture(Pt.pointerId)&&$t.releasePointerCapture(Pt.pointerId),Pt.button===0&&Pt.ctrlKey===!1&&Pt.pointerType==="mouse"&&(Mt(Pt),Pt.preventDefault())}),onKeyDown:composeEventHandlers(_.onKeyDown,Pt=>{const $t=Tt.current!=="";!(Pt.ctrlKey||Pt.altKey||Pt.metaKey)&&Pt.key.length===1&&Et(Pt.key),!($t&&Pt.key===" ")&&OPEN_KEYS.includes(Pt.key)&&(Mt(),Pt.preventDefault())})})})});SelectTrigger$1.displayName=TRIGGER_NAME;var VALUE_NAME="SelectValue",SelectValue$1=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,className:a,style:_,children:et,placeholder:nt="",...c}=e,ct=useSelectContext(VALUE_NAME,s),{onValueNodeHasChildrenChange:dt}=ct,gt=et!==void 0,Tt=useComposedRefs$1(i,ct.onValueNodeChange);return useLayoutEffect2(()=>{dt(gt)},[dt,gt]),jsxRuntimeExports.jsx(Primitive.span,{...c,ref:Tt,style:{pointerEvents:"none"},children:shouldShowPlaceholder(ct.value)?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:nt}):et})});SelectValue$1.displayName=VALUE_NAME;var ICON_NAME="SelectIcon",SelectIcon=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,children:a,..._}=e;return jsxRuntimeExports.jsx(Primitive.span,{"aria-hidden":!0,..._,ref:i,children:a||""})});SelectIcon.displayName=ICON_NAME;var PORTAL_NAME="SelectPortal",SelectPortal=e=>jsxRuntimeExports.jsx(Portal$2,{asChild:!0,...e});SelectPortal.displayName=PORTAL_NAME;var CONTENT_NAME="SelectContent",SelectContent$1=reactExports.forwardRef((e,i)=>{const s=useSelectContext(CONTENT_NAME,e.__scopeSelect),[a,_]=reactExports.useState();if(useLayoutEffect2(()=>{_(new DocumentFragment)},[]),!s.open){const et=a;return et?reactDomExports.createPortal(jsxRuntimeExports.jsx(SelectContentProvider,{scope:e.__scopeSelect,children:jsxRuntimeExports.jsx(Collection.Slot,{scope:e.__scopeSelect,children:jsxRuntimeExports.jsx("div",{children:e.children})})}),et):null}return jsxRuntimeExports.jsx(SelectContentImpl,{...e,ref:i})});SelectContent$1.displayName=CONTENT_NAME;var CONTENT_MARGIN=10,[SelectContentProvider,useSelectContentContext]=createSelectContext(CONTENT_NAME),CONTENT_IMPL_NAME="SelectContentImpl",Slot=createSlot("SelectContent.RemoveScroll"),SelectContentImpl=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,position:a="item-aligned",onCloseAutoFocus:_,onEscapeKeyDown:et,onPointerDownOutside:nt,side:c,sideOffset:ct,align:dt,alignOffset:gt,arrowPadding:Tt,collisionBoundary:Et,collisionPadding:At,sticky:Mt,hideWhenDetached:Pt,avoidCollisions:$t,...Lt}=e,Bt=useSelectContext(CONTENT_NAME,s),[Nt,Vt]=reactExports.useState(null),[Xt,nr]=reactExports.useState(null),ar=useComposedRefs$1(i,ss=>Vt(ss)),[mr,Fr]=reactExports.useState(null),[sn,fn]=reactExports.useState(null),Lr=useCollection(s),[Qr,dn]=reactExports.useState(!1),en=reactExports.useRef(!1);reactExports.useEffect(()=>{if(Nt)return hideOthers(Nt)},[Nt]),useFocusGuards();const yr=reactExports.useCallback(ss=>{const[Mn,...ds]=Lr().map(Hs=>Hs.ref.current),[gs]=ds.slice(-1),ys=document.activeElement;for(const Hs of ss)if(Hs===ys||(Hs==null||Hs.scrollIntoView({block:"nearest"}),Hs===Mn&&Xt&&(Xt.scrollTop=0),Hs===gs&&Xt&&(Xt.scrollTop=Xt.scrollHeight),Hs==null||Hs.focus(),document.activeElement!==ys))return},[Lr,Xt]),Ar=reactExports.useCallback(()=>yr([mr,Nt]),[yr,mr,Nt]);reactExports.useEffect(()=>{Qr&&Ar()},[Qr,Ar]);const{onOpenChange:rr,triggerPointerDownPosRef:ur}=Bt;reactExports.useEffect(()=>{if(Nt){let ss={x:0,y:0};const Mn=gs=>{var ys,Hs;ss={x:Math.abs(Math.round(gs.pageX)-(((ys=ur.current)==null?void 0:ys.x)??0)),y:Math.abs(Math.round(gs.pageY)-(((Hs=ur.current)==null?void 0:Hs.y)??0))}},ds=gs=>{ss.x<=10&&ss.y<=10?gs.preventDefault():Nt.contains(gs.target)||rr(!1),document.removeEventListener("pointermove",Mn),ur.current=null};return ur.current!==null&&(document.addEventListener("pointermove",Mn),document.addEventListener("pointerup",ds,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Mn),document.removeEventListener("pointerup",ds,{capture:!0})}}},[Nt,rr,ur]),reactExports.useEffect(()=>{const ss=()=>rr(!1);return window.addEventListener("blur",ss),window.addEventListener("resize",ss),()=>{window.removeEventListener("blur",ss),window.removeEventListener("resize",ss)}},[rr]);const[Br,xr]=useTypeaheadSearch(ss=>{const Mn=Lr().filter(ys=>!ys.disabled),ds=Mn.find(ys=>ys.ref.current===document.activeElement),gs=findNextItem(Mn,ss,ds);gs&&setTimeout(()=>gs.ref.current.focus())}),qr=reactExports.useCallback((ss,Mn,ds)=>{const gs=!en.current&&!ds;(Bt.value!==void 0&&Bt.value===Mn||gs)&&(Fr(ss),gs&&(en.current=!0))},[Bt.value]),tn=reactExports.useCallback(()=>Nt==null?void 0:Nt.focus(),[Nt]),vn=reactExports.useCallback((ss,Mn,ds)=>{const gs=!en.current&&!ds;(Bt.value!==void 0&&Bt.value===Mn||gs)&&fn(ss)},[Bt.value]),hs=a==="popper"?SelectPopperPosition:SelectItemAlignedPosition,Ts=hs===SelectPopperPosition?{side:c,sideOffset:ct,align:dt,alignOffset:gt,arrowPadding:Tt,collisionBoundary:Et,collisionPadding:At,sticky:Mt,hideWhenDetached:Pt,avoidCollisions:$t}:{};return jsxRuntimeExports.jsx(SelectContentProvider,{scope:s,content:Nt,viewport:Xt,onViewportChange:nr,itemRefCallback:qr,selectedItem:mr,onItemLeave:tn,itemTextRefCallback:vn,focusSelectedItem:Ar,selectedItemText:sn,position:a,isPositioned:Qr,searchRef:Br,children:jsxRuntimeExports.jsx(ReactRemoveScroll,{as:Slot,allowPinchZoom:!0,children:jsxRuntimeExports.jsx(FocusScope,{asChild:!0,trapped:Bt.open,onMountAutoFocus:ss=>{ss.preventDefault()},onUnmountAutoFocus:composeEventHandlers(_,ss=>{var Mn;(Mn=Bt.trigger)==null||Mn.focus({preventScroll:!0}),ss.preventDefault()}),children:jsxRuntimeExports.jsx(DismissableLayer,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:et,onPointerDownOutside:nt,onFocusOutside:ss=>ss.preventDefault(),onDismiss:()=>Bt.onOpenChange(!1),children:jsxRuntimeExports.jsx(hs,{role:"listbox",id:Bt.contentId,"data-state":Bt.open?"open":"closed",dir:Bt.dir,onContextMenu:ss=>ss.preventDefault(),...Lt,...Ts,onPlaced:()=>dn(!0),ref:ar,style:{display:"flex",flexDirection:"column",outline:"none",...Lt.style},onKeyDown:composeEventHandlers(Lt.onKeyDown,ss=>{const Mn=ss.ctrlKey||ss.altKey||ss.metaKey;if(ss.key==="Tab"&&ss.preventDefault(),!Mn&&ss.key.length===1&&xr(ss.key),["ArrowUp","ArrowDown","Home","End"].includes(ss.key)){let gs=Lr().filter(ys=>!ys.disabled).map(ys=>ys.ref.current);if(["ArrowUp","End"].includes(ss.key)&&(gs=gs.slice().reverse()),["ArrowUp","ArrowDown"].includes(ss.key)){const ys=ss.target,Hs=gs.indexOf(ys);gs=gs.slice(Hs+1)}setTimeout(()=>yr(gs)),ss.preventDefault()}})})})})})})});SelectContentImpl.displayName=CONTENT_IMPL_NAME;var ITEM_ALIGNED_POSITION_NAME="SelectItemAlignedPosition",SelectItemAlignedPosition=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,onPlaced:a,..._}=e,et=useSelectContext(CONTENT_NAME,s),nt=useSelectContentContext(CONTENT_NAME,s),[c,ct]=reactExports.useState(null),[dt,gt]=reactExports.useState(null),Tt=useComposedRefs$1(i,ar=>gt(ar)),Et=useCollection(s),At=reactExports.useRef(!1),Mt=reactExports.useRef(!0),{viewport:Pt,selectedItem:$t,selectedItemText:Lt,focusSelectedItem:Bt}=nt,Nt=reactExports.useCallback(()=>{if(et.trigger&&et.valueNode&&c&&dt&&Pt&&$t&&Lt){const ar=et.trigger.getBoundingClientRect(),mr=dt.getBoundingClientRect(),Fr=et.valueNode.getBoundingClientRect(),sn=Lt.getBoundingClientRect();if(et.dir!=="rtl"){const ys=sn.left-mr.left,Hs=Fr.left-ys,_s=ar.left-Hs,Ss=ar.width+_s,Vl=Math.max(Ss,mr.width),ba=window.innerWidth-CONTENT_MARGIN,Qo=clamp(Hs,[CONTENT_MARGIN,Math.max(CONTENT_MARGIN,ba-Vl)]);c.style.minWidth=Ss+"px",c.style.left=Qo+"px"}else{const ys=mr.right-sn.right,Hs=window.innerWidth-Fr.right-ys,_s=window.innerWidth-ar.right-Hs,Ss=ar.width+_s,Vl=Math.max(Ss,mr.width),ba=window.innerWidth-CONTENT_MARGIN,Qo=clamp(Hs,[CONTENT_MARGIN,Math.max(CONTENT_MARGIN,ba-Vl)]);c.style.minWidth=Ss+"px",c.style.right=Qo+"px"}const fn=Et(),Lr=window.innerHeight-CONTENT_MARGIN*2,Qr=Pt.scrollHeight,dn=window.getComputedStyle(dt),en=parseInt(dn.borderTopWidth,10),yr=parseInt(dn.paddingTop,10),Ar=parseInt(dn.borderBottomWidth,10),rr=parseInt(dn.paddingBottom,10),ur=en+yr+Qr+rr+Ar,Br=Math.min($t.offsetHeight*5,ur),xr=window.getComputedStyle(Pt),qr=parseInt(xr.paddingTop,10),tn=parseInt(xr.paddingBottom,10),vn=ar.top+ar.height/2-CONTENT_MARGIN,hs=Lr-vn,Ts=$t.offsetHeight/2,ss=$t.offsetTop+Ts,Mn=en+yr+ss,ds=ur-Mn;if(Mn<=vn){const ys=fn.length>0&&$t===fn[fn.length-1].ref.current;c.style.bottom="0px";const Hs=dt.clientHeight-Pt.offsetTop-Pt.offsetHeight,_s=Math.max(hs,Ts+(ys?tn:0)+Hs+Ar),Ss=Mn+_s;c.style.height=Ss+"px"}else{const ys=fn.length>0&&$t===fn[0].ref.current;c.style.top="0px";const _s=Math.max(vn,en+Pt.offsetTop+(ys?qr:0)+Ts)+ds;c.style.height=_s+"px",Pt.scrollTop=Mn-vn+Pt.offsetTop}c.style.margin=`${CONTENT_MARGIN}px 0`,c.style.minHeight=Br+"px",c.style.maxHeight=Lr+"px",a==null||a(),requestAnimationFrame(()=>At.current=!0)}},[Et,et.trigger,et.valueNode,c,dt,Pt,$t,Lt,et.dir,a]);useLayoutEffect2(()=>Nt(),[Nt]);const[Vt,Xt]=reactExports.useState();useLayoutEffect2(()=>{dt&&Xt(window.getComputedStyle(dt).zIndex)},[dt]);const nr=reactExports.useCallback(ar=>{ar&&Mt.current===!0&&(Nt(),Bt==null||Bt(),Mt.current=!1)},[Nt,Bt]);return jsxRuntimeExports.jsx(SelectViewportProvider,{scope:s,contentWrapper:c,shouldExpandOnScrollRef:At,onScrollButtonChange:nr,children:jsxRuntimeExports.jsx("div",{ref:ct,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:Vt},children:jsxRuntimeExports.jsx(Primitive.div,{..._,ref:Tt,style:{boxSizing:"border-box",maxHeight:"100%",..._.style}})})})});SelectItemAlignedPosition.displayName=ITEM_ALIGNED_POSITION_NAME;var POPPER_POSITION_NAME="SelectPopperPosition",SelectPopperPosition=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,align:a="start",collisionPadding:_=CONTENT_MARGIN,...et}=e,nt=usePopperScope(s);return jsxRuntimeExports.jsx(Content$2,{...nt,...et,ref:i,align:a,collisionPadding:_,style:{boxSizing:"border-box",...et.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});SelectPopperPosition.displayName=POPPER_POSITION_NAME;var[SelectViewportProvider,useSelectViewportContext]=createSelectContext(CONTENT_NAME,{}),VIEWPORT_NAME="SelectViewport",SelectViewport=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,nonce:a,..._}=e,et=useSelectContentContext(VIEWPORT_NAME,s),nt=useSelectViewportContext(VIEWPORT_NAME,s),c=useComposedRefs$1(i,et.onViewportChange),ct=reactExports.useRef(0);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),jsxRuntimeExports.jsx(Collection.Slot,{scope:s,children:jsxRuntimeExports.jsx(Primitive.div,{"data-radix-select-viewport":"",role:"presentation",..._,ref:c,style:{position:"relative",flex:1,overflow:"hidden auto",..._.style},onScroll:composeEventHandlers(_.onScroll,dt=>{const gt=dt.currentTarget,{contentWrapper:Tt,shouldExpandOnScrollRef:Et}=nt;if(Et!=null&&Et.current&&Tt){const At=Math.abs(ct.current-gt.scrollTop);if(At>0){const Mt=window.innerHeight-CONTENT_MARGIN*2,Pt=parseFloat(Tt.style.minHeight),$t=parseFloat(Tt.style.height),Lt=Math.max(Pt,$t);if(Lt<Mt){const Bt=Lt+At,Nt=Math.min(Mt,Bt),Vt=Bt-Nt;Tt.style.height=Nt+"px",Tt.style.bottom==="0px"&&(gt.scrollTop=Vt>0?Vt:0,Tt.style.justifyContent="flex-end")}}}ct.current=gt.scrollTop})})})]})});SelectViewport.displayName=VIEWPORT_NAME;var GROUP_NAME="SelectGroup",[SelectGroupContextProvider,useSelectGroupContext]=createSelectContext(GROUP_NAME),SelectGroup=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,...a}=e,_=useId();return jsxRuntimeExports.jsx(SelectGroupContextProvider,{scope:s,id:_,children:jsxRuntimeExports.jsx(Primitive.div,{role:"group","aria-labelledby":_,...a,ref:i})})});SelectGroup.displayName=GROUP_NAME;var LABEL_NAME="SelectLabel",SelectLabel$1=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,...a}=e,_=useSelectGroupContext(LABEL_NAME,s);return jsxRuntimeExports.jsx(Primitive.div,{id:_.id,...a,ref:i})});SelectLabel$1.displayName=LABEL_NAME;var ITEM_NAME="SelectItem",[SelectItemContextProvider,useSelectItemContext]=createSelectContext(ITEM_NAME),SelectItem$1=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,value:a,disabled:_=!1,textValue:et,...nt}=e,c=useSelectContext(ITEM_NAME,s),ct=useSelectContentContext(ITEM_NAME,s),dt=c.value===a,[gt,Tt]=reactExports.useState(et??""),[Et,At]=reactExports.useState(!1),Mt=useComposedRefs$1(i,Bt=>{var Nt;return(Nt=ct.itemRefCallback)==null?void 0:Nt.call(ct,Bt,a,_)}),Pt=useId(),$t=reactExports.useRef("touch"),Lt=()=>{_||(c.onValueChange(a),c.onOpenChange(!1))};if(a==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return jsxRuntimeExports.jsx(SelectItemContextProvider,{scope:s,value:a,disabled:_,textId:Pt,isSelected:dt,onItemTextChange:reactExports.useCallback(Bt=>{Tt(Nt=>Nt||((Bt==null?void 0:Bt.textContent)??"").trim())},[]),children:jsxRuntimeExports.jsx(Collection.ItemSlot,{scope:s,value:a,disabled:_,textValue:gt,children:jsxRuntimeExports.jsx(Primitive.div,{role:"option","aria-labelledby":Pt,"data-highlighted":Et?"":void 0,"aria-selected":dt&&Et,"data-state":dt?"checked":"unchecked","aria-disabled":_||void 0,"data-disabled":_?"":void 0,tabIndex:_?void 0:-1,...nt,ref:Mt,onFocus:composeEventHandlers(nt.onFocus,()=>At(!0)),onBlur:composeEventHandlers(nt.onBlur,()=>At(!1)),onClick:composeEventHandlers(nt.onClick,()=>{$t.current!=="mouse"&&Lt()}),onPointerUp:composeEventHandlers(nt.onPointerUp,()=>{$t.current==="mouse"&&Lt()}),onPointerDown:composeEventHandlers(nt.onPointerDown,Bt=>{$t.current=Bt.pointerType}),onPointerMove:composeEventHandlers(nt.onPointerMove,Bt=>{var Nt;$t.current=Bt.pointerType,_?(Nt=ct.onItemLeave)==null||Nt.call(ct):$t.current==="mouse"&&Bt.currentTarget.focus({preventScroll:!0})}),onPointerLeave:composeEventHandlers(nt.onPointerLeave,Bt=>{var Nt;Bt.currentTarget===document.activeElement&&((Nt=ct.onItemLeave)==null||Nt.call(ct))}),onKeyDown:composeEventHandlers(nt.onKeyDown,Bt=>{var Vt;((Vt=ct.searchRef)==null?void 0:Vt.current)!==""&&Bt.key===" "||(SELECTION_KEYS.includes(Bt.key)&&Lt(),Bt.key===" "&&Bt.preventDefault())})})})})});SelectItem$1.displayName=ITEM_NAME;var ITEM_TEXT_NAME="SelectItemText",SelectItemText=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,className:a,style:_,...et}=e,nt=useSelectContext(ITEM_TEXT_NAME,s),c=useSelectContentContext(ITEM_TEXT_NAME,s),ct=useSelectItemContext(ITEM_TEXT_NAME,s),dt=useSelectNativeOptionsContext(ITEM_TEXT_NAME,s),[gt,Tt]=reactExports.useState(null),Et=useComposedRefs$1(i,Lt=>Tt(Lt),ct.onItemTextChange,Lt=>{var Bt;return(Bt=c.itemTextRefCallback)==null?void 0:Bt.call(c,Lt,ct.value,ct.disabled)}),At=gt==null?void 0:gt.textContent,Mt=reactExports.useMemo(()=>jsxRuntimeExports.jsx("option",{value:ct.value,disabled:ct.disabled,children:At},ct.value),[ct.disabled,ct.value,At]),{onNativeOptionAdd:Pt,onNativeOptionRemove:$t}=dt;return useLayoutEffect2(()=>(Pt(Mt),()=>$t(Mt)),[Pt,$t,Mt]),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Primitive.span,{id:ct.textId,...et,ref:Et}),ct.isSelected&&nt.valueNode&&!nt.valueNodeHasChildren?reactDomExports.createPortal(et.children,nt.valueNode):null]})});SelectItemText.displayName=ITEM_TEXT_NAME;var ITEM_INDICATOR_NAME="SelectItemIndicator",SelectItemIndicator=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,...a}=e;return useSelectItemContext(ITEM_INDICATOR_NAME,s).isSelected?jsxRuntimeExports.jsx(Primitive.span,{"aria-hidden":!0,...a,ref:i}):null});SelectItemIndicator.displayName=ITEM_INDICATOR_NAME;var SCROLL_UP_BUTTON_NAME="SelectScrollUpButton",SelectScrollUpButton$1=reactExports.forwardRef((e,i)=>{const s=useSelectContentContext(SCROLL_UP_BUTTON_NAME,e.__scopeSelect),a=useSelectViewportContext(SCROLL_UP_BUTTON_NAME,e.__scopeSelect),[_,et]=reactExports.useState(!1),nt=useComposedRefs$1(i,a.onScrollButtonChange);return useLayoutEffect2(()=>{if(s.viewport&&s.isPositioned){let c=function(){const dt=ct.scrollTop>0;et(dt)};const ct=s.viewport;return c(),ct.addEventListener("scroll",c),()=>ct.removeEventListener("scroll",c)}},[s.viewport,s.isPositioned]),_?jsxRuntimeExports.jsx(SelectScrollButtonImpl,{...e,ref:nt,onAutoScroll:()=>{const{viewport:c,selectedItem:ct}=s;c&&ct&&(c.scrollTop=c.scrollTop-ct.offsetHeight)}}):null});SelectScrollUpButton$1.displayName=SCROLL_UP_BUTTON_NAME;var SCROLL_DOWN_BUTTON_NAME="SelectScrollDownButton",SelectScrollDownButton$1=reactExports.forwardRef((e,i)=>{const s=useSelectContentContext(SCROLL_DOWN_BUTTON_NAME,e.__scopeSelect),a=useSelectViewportContext(SCROLL_DOWN_BUTTON_NAME,e.__scopeSelect),[_,et]=reactExports.useState(!1),nt=useComposedRefs$1(i,a.onScrollButtonChange);return useLayoutEffect2(()=>{if(s.viewport&&s.isPositioned){let c=function(){const dt=ct.scrollHeight-ct.clientHeight,gt=Math.ceil(ct.scrollTop)<dt;et(gt)};const ct=s.viewport;return c(),ct.addEventListener("scroll",c),()=>ct.removeEventListener("scroll",c)}},[s.viewport,s.isPositioned]),_?jsxRuntimeExports.jsx(SelectScrollButtonImpl,{...e,ref:nt,onAutoScroll:()=>{const{viewport:c,selectedItem:ct}=s;c&&ct&&(c.scrollTop=c.scrollTop+ct.offsetHeight)}}):null});SelectScrollDownButton$1.displayName=SCROLL_DOWN_BUTTON_NAME;var SelectScrollButtonImpl=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,onAutoScroll:a,..._}=e,et=useSelectContentContext("SelectScrollButton",s),nt=reactExports.useRef(null),c=useCollection(s),ct=reactExports.useCallback(()=>{nt.current!==null&&(window.clearInterval(nt.current),nt.current=null)},[]);return reactExports.useEffect(()=>()=>ct(),[ct]),useLayoutEffect2(()=>{var gt;const dt=c().find(Tt=>Tt.ref.current===document.activeElement);(gt=dt==null?void 0:dt.ref.current)==null||gt.scrollIntoView({block:"nearest"})},[c]),jsxRuntimeExports.jsx(Primitive.div,{"aria-hidden":!0,..._,ref:i,style:{flexShrink:0,..._.style},onPointerDown:composeEventHandlers(_.onPointerDown,()=>{nt.current===null&&(nt.current=window.setInterval(a,50))}),onPointerMove:composeEventHandlers(_.onPointerMove,()=>{var dt;(dt=et.onItemLeave)==null||dt.call(et),nt.current===null&&(nt.current=window.setInterval(a,50))}),onPointerLeave:composeEventHandlers(_.onPointerLeave,()=>{ct()})})}),SEPARATOR_NAME="SelectSeparator",SelectSeparator$1=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,...a}=e;return jsxRuntimeExports.jsx(Primitive.div,{"aria-hidden":!0,...a,ref:i})});SelectSeparator$1.displayName=SEPARATOR_NAME;var ARROW_NAME="SelectArrow",SelectArrow=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,...a}=e,_=usePopperScope(s),et=useSelectContext(ARROW_NAME,s),nt=useSelectContentContext(ARROW_NAME,s);return et.open&&nt.position==="popper"?jsxRuntimeExports.jsx(Arrow,{..._,...a,ref:i}):null});SelectArrow.displayName=ARROW_NAME;var BUBBLE_INPUT_NAME="SelectBubbleInput",SelectBubbleInput=reactExports.forwardRef(({__scopeSelect:e,value:i,...s},a)=>{const _=reactExports.useRef(null),et=useComposedRefs$1(a,_),nt=usePrevious(i);return reactExports.useEffect(()=>{const c=_.current;if(!c)return;const ct=window.HTMLSelectElement.prototype,gt=Object.getOwnPropertyDescriptor(ct,"value").set;if(nt!==i&&gt){const Tt=new Event("change",{bubbles:!0});gt.call(c,i),c.dispatchEvent(Tt)}},[nt,i]),jsxRuntimeExports.jsx(Primitive.select,{...s,style:{...VISUALLY_HIDDEN_STYLES,...s.style},ref:et,defaultValue:i})});SelectBubbleInput.displayName=BUBBLE_INPUT_NAME;function shouldShowPlaceholder(e){return e===""||e===void 0}function useTypeaheadSearch(e){const i=useCallbackRef$1(e),s=reactExports.useRef(""),a=reactExports.useRef(0),_=reactExports.useCallback(nt=>{const c=s.current+nt;i(c),function ct(dt){s.current=dt,window.clearTimeout(a.current),dt!==""&&(a.current=window.setTimeout(()=>ct(""),1e3))}(c)},[i]),et=reactExports.useCallback(()=>{s.current="",window.clearTimeout(a.current)},[]);return reactExports.useEffect(()=>()=>window.clearTimeout(a.current),[]),[s,_,et]}function findNextItem(e,i,s){const _=i.length>1&&Array.from(i).every(dt=>dt===i[0])?i[0]:i,et=s?e.indexOf(s):-1;let nt=wrapArray(e,Math.max(et,0));_.length===1&&(nt=nt.filter(dt=>dt!==s));const ct=nt.find(dt=>dt.textValue.toLowerCase().startsWith(_.toLowerCase()));return ct!==s?ct:void 0}function wrapArray(e,i){return e.map((s,a)=>e[(i+a)%e.length])}var Root2=Select$1,Trigger=SelectTrigger$1,Value=SelectValue$1,Icon=SelectIcon,Portal=SelectPortal,Content2=SelectContent$1,Viewport=SelectViewport,Label=SelectLabel$1,Item=SelectItem$1,ItemText=SelectItemText,ItemIndicator=SelectItemIndicator,ScrollUpButton=SelectScrollUpButton$1,ScrollDownButton=SelectScrollDownButton$1,Separator=SelectSeparator$1;const Select=Root2,SelectValue=Value,SelectTrigger=reactExports.forwardRef(({className:e,children:i,...s},a)=>jsxRuntimeExports.jsxs(Trigger,{ref:a,className:cn("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...s,children:[i,jsxRuntimeExports.jsx(Icon,{asChild:!0,children:jsxRuntimeExports.jsx(ChevronDown,{className:"h-4 w-4 opacity-50"})})]}));SelectTrigger.displayName=Trigger.displayName;const SelectScrollUpButton=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(ScrollUpButton,{ref:s,className:cn("flex cursor-default items-center justify-center py-1",e),...i,children:jsxRuntimeExports.jsx(ChevronUp,{className:"h-4 w-4"})}));SelectScrollUpButton.displayName=ScrollUpButton.displayName;const SelectScrollDownButton=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(ScrollDownButton,{ref:s,className:cn("flex cursor-default items-center justify-center py-1",e),...i,children:jsxRuntimeExports.jsx(ChevronDown,{className:"h-4 w-4"})}));SelectScrollDownButton.displayName=ScrollDownButton.displayName;const SelectContent=reactExports.forwardRef(({className:e,children:i,position:s="popper",...a},_)=>jsxRuntimeExports.jsx(Portal,{children:jsxRuntimeExports.jsxs(Content2,{ref:_,className:cn("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...a,children:[jsxRuntimeExports.jsx(SelectScrollUpButton,{}),jsxRuntimeExports.jsx(Viewport,{className:cn("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:i}),jsxRuntimeExports.jsx(SelectScrollDownButton,{})]})}));SelectContent.displayName=Content2.displayName;const SelectLabel=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Label,{ref:s,className:cn("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...i}));SelectLabel.displayName=Label.displayName;const SelectItem=reactExports.forwardRef(({className:e,children:i,...s},a)=>jsxRuntimeExports.jsxs(Item,{ref:a,className:cn("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...s,children:[jsxRuntimeExports.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:jsxRuntimeExports.jsx(ItemIndicator,{children:jsxRuntimeExports.jsx(Check,{className:"h-4 w-4"})})}),jsxRuntimeExports.jsx(ItemText,{children:i})]}));SelectItem.displayName=Item.displayName;const SelectSeparator=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Separator,{ref:s,className:cn("-mx-1 my-1 h-px bg-muted",e),...i}));SelectSeparator.displayName=Separator.displayName;const categories=["Biryani","Meals","Curries","Tiffin","Dosa","Sweets","Snacks","Beverages"];function AddDish(){const{user:e}=useAuth(),i=useNavigate(),{kitchens:s}=useAmmaKitchens(e==null?void 0:e.id),[a,_]=reactExports.useState(!1),[et,nt]=reactExports.useState(null),[c,ct]=reactExports.useState(null),[dt,gt]=reactExports.useState({kitchenId:"",name:"",description:"",price:"",originalPrice:"",category:"Meals",preparationTime:"15 mins",servingSize:"1 person",isVeg:!0,isAvailable:!0,tags:""}),Tt=At=>{var Pt;const Mt=(Pt=At.target.files)==null?void 0:Pt[0];if(Mt){nt(Mt);const $t=new FileReader;$t.onloadend=()=>{ct($t.result)},$t.readAsDataURL(Mt)}},Et=async At=>{var Pt;At.preventDefault();const Mt=dt.kitchenId||((Pt=s[0])==null?void 0:Pt.id);if(!Mt){ue.error("No kitchen found. Please register your kitchen first.");return}if(!dt.name||!dt.price){ue.error("Please fill in all required fields");return}_(!0);try{let $t="https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=400";if(et){const Lt=await uploadToImgBB(et);Lt&&($t=Lt.display_url)}await createDish({kitchenId:Mt,name:dt.name,description:dt.description,image:$t,price:parseFloat(dt.price),originalPrice:dt.originalPrice?parseFloat(dt.originalPrice):void 0,isVeg:dt.isVeg,isAvailable:dt.isAvailable,category:dt.category,tags:dt.tags.split(",").map(Lt=>Lt.trim()).filter(Boolean),preparationTime:dt.preparationTime,servingSize:dt.servingSize}),ue.success("Dish added successfully!"),i("/amma/dashboard")}catch($t){console.error("Failed to add dish:",$t),ue.error("Failed to add dish")}finally{_(!1)}};return!e||e.role!=="amma"?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"You need to be registered as an Amma"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Login as Amma"})})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[jsxRuntimeExports.jsx(Link,{to:"/amma/dashboard",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})})}),jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Add New Dish"})]})}),jsxRuntimeExports.jsxs("form",{onSubmit:Et,className:"px-4 py-6 space-y-6",children:[jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsxs("label",{className:"cursor-pointer",children:[jsxRuntimeExports.jsx("div",{className:"w-40 h-40 rounded-2xl bg-secondary flex items-center justify-center overflow-hidden",children:c?jsxRuntimeExports.jsx("img",{src:c,alt:"Preview",className:"w-full h-full object-cover"}):jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(Camera,{className:"w-8 h-8 text-muted-foreground mx-auto mb-1"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Add Dish Photo"})]})}),jsxRuntimeExports.jsx("input",{type:"file",accept:"image/*",onChange:Tt,className:"hidden"})]})}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Dish Name *"}),jsxRuntimeExports.jsx(Input,{placeholder:"e.g., Chicken Biryani",value:dt.name,onChange:At=>gt({...dt,name:At.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Description"}),jsxRuntimeExports.jsx(Textarea,{placeholder:"Describe your dish...",value:dt.description,onChange:At=>gt({...dt,description:At.target.value}),className:"bg-secondary border-0 mt-1 resize-none",rows:2})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Price () *"}),jsxRuntimeExports.jsx(Input,{type:"number",placeholder:"180",value:dt.price,onChange:At=>gt({...dt,price:At.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Original Price ()"}),jsxRuntimeExports.jsx(Input,{type:"number",placeholder:"220",value:dt.originalPrice,onChange:At=>gt({...dt,originalPrice:At.target.value}),className:"bg-secondary border-0 mt-1"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Category"}),jsxRuntimeExports.jsxs(Select,{value:dt.category,onValueChange:At=>gt({...dt,category:At}),children:[jsxRuntimeExports.jsx(SelectTrigger,{className:"bg-secondary border-0 mt-1",children:jsxRuntimeExports.jsx(SelectValue,{})}),jsxRuntimeExports.jsx(SelectContent,{children:categories.map(At=>jsxRuntimeExports.jsx(SelectItem,{value:At,children:At},At))})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Prep Time"}),jsxRuntimeExports.jsx(Input,{placeholder:"15 mins",value:dt.preparationTime,onChange:At=>gt({...dt,preparationTime:At.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Serving Size"}),jsxRuntimeExports.jsx(Input,{placeholder:"1 person",value:dt.servingSize,onChange:At=>gt({...dt,servingSize:At.target.value}),className:"bg-secondary border-0 mt-1"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Tags (comma separated)"}),jsxRuntimeExports.jsx(Input,{placeholder:"bestseller, spicy, healthy",value:dt.tags,onChange:At=>gt({...dt,tags:At.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between bg-secondary rounded-xl p-4",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"veg-dish",children:"Vegetarian"}),jsxRuntimeExports.jsx(Switch,{id:"veg-dish",checked:dt.isVeg,onCheckedChange:At=>gt({...dt,isVeg:At})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between bg-secondary rounded-xl p-4",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"available",children:"Available Now"}),jsxRuntimeExports.jsx(Switch,{id:"available",checked:dt.isAvailable,onCheckedChange:At=>gt({...dt,isAvailable:At})})]})]}),jsxRuntimeExports.jsx(Button,{type:"submit",disabled:a,className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl",children:a?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin"}),jsxRuntimeExports.jsx("span",{children:"Adding..."})]}):"Add Dish"})]})]})}function EditKitchen(){const{kitchenId:e}=useParams(),i=useNavigate(),{user:s}=useAuth();useLocationContext();const[a,_]=reactExports.useState(!0),[et,nt]=reactExports.useState(!1),[c,ct]=reactExports.useState(""),[dt,gt]=reactExports.useState(null),[Tt,Et]=reactExports.useState(null),[At,Mt]=reactExports.useState(null),[Pt,$t]=reactExports.useState({name:"",description:"",specialties:"",cookingTime:"30-45 mins",isVeg:!0,address:{line1:"",city:"",pincode:""}});reactExports.useEffect(()=>{(async()=>{if(e){try{const Xt=ref(database,`kitchens/${e}`),nr=await get(Xt);if(nr.exists()){const ar=nr.val();if(ar.ownerId!==(s==null?void 0:s.id)){ue.error("You do not have permission to edit this kitchen"),i("/amma/dashboard");return}$t({name:ar.name,description:ar.description,specialties:ar.specialties.join(", "),cookingTime:ar.cookingTime,isVeg:ar.isVeg,address:{line1:ar.address.line1,city:ar.address.city,pincode:ar.address.pincode}}),ct(ar.image),ar.address.lat&&ar.address.lng&&Et({lat:ar.address.lat,lng:ar.address.lng,address:ar.address.line1}),Mt(ar.franchiseId||null)}}catch(Xt){console.error("Error loading kitchen:",Xt),ue.error("Failed to load kitchen data")}_(!1)}})()},[e,s==null?void 0:s.id,i]);const Lt=Vt=>{var nr;const Xt=(nr=Vt.target.files)==null?void 0:nr[0];if(Xt){gt(Xt);const ar=new FileReader;ar.onload=()=>ct(ar.result),ar.readAsDataURL(Xt)}},Bt=Vt=>{Et(Vt),Mt(Vt.franchiseId),$t(Xt=>({...Xt,address:{...Xt.address,line1:Vt.address}}))},Nt=async()=>{if(e){if(!Pt.name.trim()){ue.error("Please enter your kitchen name");return}if(!Tt){ue.error("Please select your kitchen location on the map");return}if(!At){ue.error("Your location must be within a service area");return}nt(!0);try{let Vt=c;dt&&(Vt=(await uploadImage(dt)).data.display_url),await updateKitchen(e,{name:Pt.name,description:Pt.description,specialties:Pt.specialties.split(",").map(Xt=>Xt.trim()).filter(Boolean),cookingTime:Pt.cookingTime,isVeg:Pt.isVeg,image:Vt,franchiseId:At,address:{line1:Tt.address,city:Pt.address.city,pincode:Pt.address.pincode,lat:Tt.lat,lng:Tt.lng}}),ue.success("Kitchen updated successfully!"),i("/amma/dashboard")}catch(Vt){console.error("Error updating kitchen:",Vt),ue.error("Failed to update kitchen")}nt(!1)}};return a?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-8",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:()=>i(-1),children:jsxRuntimeExports.jsx(ChevronLeft,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Edit Kitchen"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Update your kitchen details"})]})]})}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-6 space-y-6",children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-foreground mb-2",children:"Kitchen Image"}),jsxRuntimeExports.jsxs("div",{className:"relative w-full h-48 rounded-2xl bg-secondary overflow-hidden cursor-pointer group",children:[c?jsxRuntimeExports.jsx("img",{src:c,alt:"Kitchen",className:"w-full h-full object-cover"}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[jsxRuntimeExports.jsx(Camera,{className:"w-10 h-10 text-muted-foreground mb-2"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-muted-foreground",children:"Add kitchen photo"})]}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:jsxRuntimeExports.jsx(Camera,{className:"w-8 h-8 text-white"})}),jsxRuntimeExports.jsx("input",{type:"file",accept:"image/*",onChange:Lt,className:"absolute inset-0 opacity-0 cursor-pointer"})]})]})}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Kitchen Name *"}),jsxRuntimeExports.jsx(Input,{value:Pt.name,onChange:Vt=>$t({...Pt,name:Vt.target.value}),placeholder:"e.g., Amma's Kitchen",className:"mt-1 bg-secondary border-0"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Description"}),jsxRuntimeExports.jsx("textarea",{value:Pt.description,onChange:Vt=>$t({...Pt,description:Vt.target.value}),placeholder:"Tell customers about your kitchen...",rows:3,className:"mt-1 w-full px-4 py-3 rounded-xl bg-secondary text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 resize-none"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Specialties"}),jsxRuntimeExports.jsx(Input,{value:Pt.specialties,onChange:Vt=>$t({...Pt,specialties:Vt.target.value}),placeholder:"e.g., Biryani, South Indian, Sweets",className:"mt-1 bg-secondary border-0"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Separate with commas"})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Cooking Time"}),jsxRuntimeExports.jsxs("select",{value:Pt.cookingTime,onChange:Vt=>$t({...Pt,cookingTime:Vt.target.value}),className:"mt-1 w-full px-4 py-3 rounded-xl bg-secondary text-foreground",children:[jsxRuntimeExports.jsx("option",{value:"15-30 mins",children:"15-30 mins"}),jsxRuntimeExports.jsx("option",{value:"30-45 mins",children:"30-45 mins"}),jsxRuntimeExports.jsx("option",{value:"45-60 mins",children:"45-60 mins"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 pt-6",children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Pure Veg?"}),jsxRuntimeExports.jsx("button",{onClick:()=>$t({...Pt,isVeg:!Pt.isVeg}),className:`w-12 h-6 rounded-full transition-colors ${Pt.isVeg?"bg-veg":"bg-muted"}`,children:jsxRuntimeExports.jsx("div",{className:`w-5 h-5 rounded-full bg-white shadow-md transition-transform ${Pt.isVeg?"translate-x-6":"translate-x-1"}`})})]})]})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4 text-primary"}),jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Kitchen Location *"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"Tap on the map to set your kitchen location. It must be within a service zone."}),jsxRuntimeExports.jsx(FranchiseZoneLocationPicker,{onLocationSelect:Bt,initialLocation:Tt||void 0})]}),Tt&&jsxRuntimeExports.jsxs("div",{className:"bg-secondary rounded-xl p-4",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-foreground",children:"Selected Address"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:Tt.address}),At&&jsxRuntimeExports.jsx("p",{className:"text-xs text-veg mt-2",children:" Within service area"})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"City"}),jsxRuntimeExports.jsx(Input,{value:Pt.address.city,onChange:Vt=>$t({...Pt,address:{...Pt.address,city:Vt.target.value}}),placeholder:"City",className:"mt-1 bg-secondary border-0"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Pincode"}),jsxRuntimeExports.jsx(Input,{value:Pt.address.pincode,onChange:Vt=>$t({...Pt,address:{...Pt.address,pincode:Vt.target.value}}),placeholder:"Pincode",className:"mt-1 bg-secondary border-0"})]})]})]}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:jsxRuntimeExports.jsx(Button,{onClick:Nt,disabled:et,className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl text-lg font-semibold",children:et?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin mr-2"}),"Saving..."]}):"Save Changes"})})]})]})}const roleDashboardMap={super_admin:"/super-admin",franchise_admin:"/franchise-admin",admin:"/admin",amma:"/amma/dashboard",user:"/"};function useRoleRedirect(e){const i=useAuth(),s=useNavigate(),{user:a,loading:_}=i;return reactExports.useEffect(()=>{if(!_){if(!a){s("/auth",{replace:!0});return}if(!e.includes(a.role)){const nt=roleDashboardMap[a.role]||"/";s(nt,{replace:!0})}}},[a,_,e,s]),{isAuthorized:!_&&a&&e.includes(a.role),isLoading:_}}const KitchenMap=({kitchens:e=[],userLocation:i,selectedKitchen:s,onKitchenSelect:a,height:_="300px",showUserLocation:et=!0})=>{const nt=reactExports.useRef(null),c=reactExports.useRef(null),ct=reactExports.useRef([]),[dt,gt]=reactExports.useState(!1),Tt=[80.648,16.5062];return reactExports.useEffect(()=>{if(!(!nt.current||c.current))return mapboxgl.accessToken=MAPBOX_ACCESS_TOKEN,c.current=new mapboxgl.Map({container:nt.current,style:"mapbox://styles/mapbox/streets-v12",center:i?[i.lng,i.lat]:Tt,zoom:13}),c.current.addControl(new mapboxgl.NavigationControl,"top-right"),c.current.on("load",()=>{gt(!0)}),()=>{var Et;(Et=c.current)==null||Et.remove(),c.current=null}},[]),reactExports.useEffect(()=>{if(!c.current||!dt||!i||!et)return;const Et=new mapboxgl.Marker({color:"#D97706"}).setLngLat([i.lng,i.lat]).setPopup(new mapboxgl.Popup().setHTML("<strong>Your Location</strong>")).addTo(c.current);return c.current.flyTo({center:[i.lng,i.lat],zoom:14}),()=>{Et.remove()}},[i,dt,et]),reactExports.useEffect(()=>{var Et;if(!(!c.current||!dt)&&(ct.current.forEach(At=>At.remove()),ct.current=[],e.forEach(At=>{if(!At.address.lat||!At.address.lng)return;const Mt=document.createElement("div");Mt.className="kitchen-marker",Mt.innerHTML=`
        <div class="w-10 h-10 rounded-full ${At.isOpen?"bg-primary":"bg-muted"} flex items-center justify-center shadow-lg cursor-pointer transform hover:scale-110 transition-transform">
          <span class="text-lg"></span>
        </div>
      `;const Pt=new mapboxgl.Popup({offset:25}).setHTML(`
        <div class="p-2">
          <h3 class="font-bold text-sm">${At.name}</h3>
          <p class="text-xs text-gray-500">${At.specialties.join(", ")}</p>
          <p class="text-xs ${At.isOpen?"text-green-600":"text-red-500"}">
            ${At.isOpen?" Open":" Closed"}
          </p>
        </div>
      `),$t=new mapboxgl.Marker(Mt).setLngLat([At.address.lng,At.address.lat]).setPopup(Pt).addTo(c.current);Mt.addEventListener("click",()=>{a&&a(At.id)}),ct.current.push($t)}),e.length>0)){const At=new mapboxgl.LngLatBounds;e.forEach(Mt=>{Mt.address.lat&&Mt.address.lng&&At.extend([Mt.address.lng,Mt.address.lat])}),i&&At.extend([i.lng,i.lat]),At.isEmpty()||(Et=c.current)==null||Et.fitBounds(At,{padding:50})}},[e,dt,a]),reactExports.useEffect(()=>{if(!c.current||!s)return;const Et=e.find(At=>At.id===s);Et!=null&&Et.address.lat&&(Et!=null&&Et.address.lng)&&c.current.flyTo({center:[Et.address.lng,Et.address.lat],zoom:15})},[s,e]),jsxRuntimeExports.jsxs("div",{className:"relative w-full rounded-xl overflow-hidden shadow-lg",style:{height:_},children:[jsxRuntimeExports.jsx("div",{ref:nt,className:"absolute inset-0"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 pointer-events-none bg-gradient-to-b from-transparent to-background/5 rounded-xl"})]})};function AdminDashboard(){useAuth();const{isAuthorized:e,isLoading:i}=useRoleRedirect(["admin","franchise_admin"]),{kitchens:s,loading:a}=useAllKitchens(),{orders:_,loading:et}=useAllOrders(),{users:nt,loading:c}=useAllUsers(),[ct,dt]=reactExports.useState("overview"),[gt,Tt]=reactExports.useState(""),Et=s.filter(Vt=>!Vt.isApproved),At=s.filter(Vt=>Vt.isApproved),Mt=_.filter(Vt=>{const Xt=new Date;return new Date(Vt.createdAt).toDateString()===Xt.toDateString()}),Pt=_.reduce((Vt,Xt)=>Vt+Xt.totalAmount,0),$t=async Vt=>{try{await approveKitchen(Vt),ue.success("Kitchen approved!")}catch{ue.error("Failed to approve kitchen")}},Lt=async Vt=>{try{await rejectKitchen(Vt),ue.success("Kitchen rejected")}catch{ue.error("Failed to reject kitchen")}},Bt=async Vt=>{if(confirm("Are you sure you want to delete this user?"))try{await deleteUser(Vt),ue.success("User deleted")}catch{ue.error("Failed to delete user")}};return i||a||et||c||!e?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx(Link,{to:"/profile",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Admin Dashboard"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Manage everything"})]})]}),Et.length>0&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-gold text-foreground text-xs",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-3 h-3"}),Et.length," pending"]})]}),jsxRuntimeExports.jsx("div",{className:"flex bg-secondary mx-4 rounded-xl p-1 mb-4 overflow-x-auto",children:["overview","kitchens","users","orders"].map(Vt=>jsxRuntimeExports.jsx("button",{onClick:()=>dt(Vt),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all capitalize whitespace-nowrap ${ct===Vt?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:Vt},Vt))})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[ct==="overview"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(Store$1,{className:"w-6 h-6 text-primary mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:At.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Active Kitchens"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(Users,{className:"w-6 h-6 text-accent mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:nt.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Users"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(Package,{className:"w-6 h-6 text-gold mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:Mt.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Today's Orders"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(TrendingUp,{className:"w-6 h-6 text-veg mb-2"}),jsxRuntimeExports.jsxs("p",{className:"text-2xl font-bold text-foreground",children:["",Pt]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Revenue"})]})]}),Et.length>0&&jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-foreground mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-4 h-4 text-gold"}),"Pending Kitchen Approvals"]}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:Et.map(Vt=>jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-3 bg-secondary rounded-xl",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:Vt.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:Vt.address.city})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Button,{size:"sm",className:"bg-veg text-primary-foreground",onClick:()=>$t(Vt.id),children:jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(Button,{size:"sm",variant:"outline",className:"text-destructive border-destructive",onClick:()=>Lt(Vt.id),children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]})]},Vt.id))})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Kitchen Locations"}),jsxRuntimeExports.jsx(KitchenMap,{kitchens:At,height:"250px",showUserLocation:!1})]})]}),ct==="kitchens"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{placeholder:"Search kitchens...",value:gt,onChange:Vt=>Tt(Vt.target.value),className:"bg-secondary border-0"}),s.filter(Vt=>Vt.name.toLowerCase().includes(gt.toLowerCase())).map(Vt=>jsxRuntimeExports.jsxs(motion.div,{className:"bg-card rounded-xl p-4 shadow-card flex gap-4",children:[jsxRuntimeExports.jsx("img",{src:Vt.image,alt:Vt.name,className:"w-16 h-16 rounded-lg object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:Vt.name}),!Vt.isApproved&&jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 bg-gold/20 text-gold text-xs rounded-full",children:"Pending"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:Vt.specialties.join(", ")}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:Vt.address.city})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-1",children:[jsxRuntimeExports.jsx("span",{className:cn("text-xs px-2 py-1 rounded-full text-center",Vt.isOpen?"bg-veg/20 text-veg":"bg-muted text-muted-foreground"),children:Vt.isOpen?"Open":"Closed"}),!Vt.isApproved&&jsxRuntimeExports.jsx(Button,{size:"sm",className:"bg-veg text-primary-foreground text-xs",onClick:()=>$t(Vt.id),children:"Approve"})]})]},Vt.id))]}),ct==="users"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{placeholder:"Search users...",value:gt,onChange:Vt=>Tt(Vt.target.value),className:"bg-secondary border-0"}),nt.filter(Vt=>Vt.name.toLowerCase().includes(gt.toLowerCase())||Vt.email.toLowerCase().includes(gt.toLowerCase())).map(Vt=>jsxRuntimeExports.jsxs(motion.div,{className:"bg-card rounded-xl p-4 shadow-card flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(Users,{className:"w-6 h-6 text-muted-foreground"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:Vt.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:Vt.email})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:cn("text-xs px-2 py-1 rounded-full capitalize",Vt.role==="admin"?"bg-primary/20 text-primary":Vt.role==="amma"?"bg-gold/20 text-gold":"bg-secondary text-muted-foreground"),children:Vt.role}),Vt.role!=="admin"&&jsxRuntimeExports.jsx(Button,{size:"icon",variant:"ghost",className:"text-destructive",onClick:()=>Bt(Vt.id),children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]})]},Vt.id))]}),ct==="orders"&&jsxRuntimeExports.jsx("div",{className:"space-y-4",children:_.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Package,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No orders yet"})]}):_.slice(0,20).map(Vt=>jsxRuntimeExports.jsxs(motion.div,{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-2",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:Vt.kitchenName}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",Vt.id.slice(-8),"  ",new Date(Vt.createdAt).toLocaleDateString()]})]}),jsxRuntimeExports.jsx("span",{className:cn("text-xs px-2 py-1 rounded-full capitalize",Vt.status==="delivered"?"bg-veg/20 text-veg":Vt.status==="cancelled"?"bg-destructive/20 text-destructive":"bg-primary/20 text-primary"),children:Vt.status})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsxs("span",{className:"text-muted-foreground",children:[Vt.items.length," items"]}),jsxRuntimeExports.jsxs("span",{className:"font-semibold text-foreground",children:["",Vt.totalAmount]})]})]},Vt.id))})]})]})}function FranchiseZoneMap({zone:e,kitchens:i=[],users:s=[],height:a="400px",onKitchenClick:_}){const et=reactExports.useRef(null),nt=reactExports.useRef(null),[c,ct]=reactExports.useState(!0),dt=reactExports.useRef([]);return reactExports.useEffect(()=>{if(et.current)return mapboxgl.accessToken=MAPBOX_ACCESS_TOKEN,nt.current=new mapboxgl.Map({container:et.current,style:"mapbox://styles/mapbox/streets-v12",center:[78.4867,17.385],zoom:10,attributionControl:!1}),nt.current.addControl(new mapboxgl.NavigationControl,"bottom-right"),nt.current.on("load",()=>{if(ct(!1),!nt.current)return;nt.current.addSource("franchise-zone",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:e.coordinates}}}),nt.current.addLayer({id:"franchise-zone-fill",type:"fill",source:"franchise-zone",paint:{"fill-color":"#f97316","fill-opacity":.15}}),nt.current.addLayer({id:"franchise-zone-border",type:"line",source:"franchise-zone",paint:{"line-color":"#f97316","line-width":3,"line-dasharray":[2,1]}});const gt=e.coordinates[0],Tt=new mapboxgl.LngLatBounds;gt.forEach(Et=>Tt.extend([Et[0],Et[1]])),nt.current.fitBounds(Tt,{padding:50})}),()=>{var gt;(gt=nt.current)==null||gt.remove()}},[]),reactExports.useEffect(()=>{!nt.current||c||(dt.current.forEach(gt=>gt.remove()),dt.current=[],i.forEach(gt=>{var Mt;if(!gt.address.lat||!gt.address.lng)return;const Tt=document.createElement("div");Tt.className="kitchen-marker",Tt.innerHTML=`
        <div class="w-10 h-10 rounded-full bg-orange-500 flex items-center justify-center shadow-lg border-2 border-white cursor-pointer transform hover:scale-110 transition-transform">
          <span class="text-lg"></span>
        </div>
      `,Tt.addEventListener("click",()=>{_&&_(gt.id)});const Et=new mapboxgl.Popup({offset:25}).setHTML(`
        <div class="p-2">
          <h3 class="font-bold text-sm text-orange-600"> ${gt.name}</h3>
          <p class="text-xs text-gray-500">${((Mt=gt.specialties)==null?void 0:Mt.join(", "))||"Home Kitchen"}</p>
          <p class="text-xs ${gt.isOpen?"text-green-600":"text-red-500"}">
            ${gt.isOpen?" Open":" Closed"}
          </p>
          ${gt.isApproved?"":'<p class="text-xs text-yellow-600"> Pending Approval</p>'}
          <p class="text-xs text-blue-500 mt-1 cursor-pointer">Click for details </p>
        </div>
      `),At=new mapboxgl.Marker(Tt).setLngLat([gt.address.lng,gt.address.lat]).setPopup(Et).addTo(nt.current);dt.current.push(At)}),s.forEach(gt=>{const Tt=document.createElement("div");Tt.className="user-marker",Tt.innerHTML=`
        <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center shadow-lg border-2 border-white cursor-pointer transform hover:scale-110 transition-transform">
          <span class="text-sm"></span>
        </div>
      `;const Et=new mapboxgl.Popup({offset:20}).setHTML(`
        <div class="p-2">
          <h3 class="font-bold text-sm text-blue-600"> ${gt.name}</h3>
          ${gt.email?`<p class="text-xs text-gray-500">${gt.email}</p>`:""}
          ${gt.city?`<p class="text-xs text-gray-400">${gt.city}</p>`:""}
        </div>
      `),At=new mapboxgl.Marker(Tt).setLngLat([gt.lng,gt.lat]).setPopup(Et).addTo(nt.current);dt.current.push(At)}))},[i,s,c,_]),jsxRuntimeExports.jsxs("div",{className:"relative rounded-xl overflow-hidden shadow-lg",style:{height:a},children:[jsxRuntimeExports.jsx("div",{ref:et,className:"absolute inset-0"}),c&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-6 h-6 animate-spin text-primary"})}),jsxRuntimeExports.jsxs("div",{className:"absolute bottom-4 left-4 bg-card/95 backdrop-blur-sm rounded-lg px-3 py-2 shadow-lg",children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-foreground mb-2",children:"Legend"}),jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-4 h-4 rounded-full bg-orange-500 flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-[8px]",children:""})}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Amma (Kitchen)"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-4 h-4 rounded-full bg-blue-500 flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-[8px]",children:""})}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Customer"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-4 h-1 bg-orange-500 rounded",style:{borderStyle:"dashed"}}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Service Zone"})]})]})]})]})}function FranchiseAdminDashboard(){var ur,Br;const{user:e,signOut:i}=useAuth(),s=useNavigate(),{isAuthorized:a,isLoading:_}=useRoleRedirect(["franchise_admin"]),{franchise:et,loading:nt}=useFranchise(e==null?void 0:e.franchiseId),{kitchens:c,loading:ct}=useAllKitchens(),{orders:dt,loading:gt}=useAllOrders(),{users:Tt,loading:Et}=useAllUsers(),{dishes:At,loading:Mt}=useAllDishes(),[Pt,$t]=reactExports.useState("overview"),[Lt,Bt]=reactExports.useState(""),[Nt,Vt]=reactExports.useState(null),Xt=async()=>{await i(),s("/auth")},nr=xr=>{const qr=ar.find(tn=>tn.id===xr);qr&&Vt(qr)},ar=c.filter(xr=>!(et!=null&&et.zone)||!xr.address.lat||!xr.address.lng?!1:isPointInZone(xr.address.lat,xr.address.lng,et.zone)),mr=Tt.filter(xr=>{var qr,tn;return!(et!=null&&et.zone)||!((qr=xr.address)!=null&&qr.lat)||!((tn=xr.address)!=null&&tn.lng)||xr.role!=="user"?!1:isPointInZone(xr.address.lat,xr.address.lng,et.zone)});Tt.filter(xr=>{var qr,tn;return!(et!=null&&et.zone)||!((qr=xr.address)!=null&&qr.lat)||!((tn=xr.address)!=null&&tn.lng)?!1:xr.role==="amma"&&isPointInZone(xr.address.lat,xr.address.lng,et.zone)});const Fr=ar.filter(xr=>!xr.isApproved),sn=ar.filter(xr=>xr.isApproved),fn=dt.filter(xr=>{const qr=c.find(tn=>tn.id===xr.kitchenId);return!(et!=null&&et.zone)||!(qr!=null&&qr.address.lat)||!(qr!=null&&qr.address.lng)?!1:isPointInZone(qr.address.lat,qr.address.lng,et.zone)}),Lr=fn.filter(xr=>{const qr=new Date;return new Date(xr.createdAt).toDateString()===qr.toDateString()}),Qr=fn.reduce((xr,qr)=>xr+qr.totalAmount,0),dn=At.filter(xr=>{const qr=c.find(tn=>tn.id===xr.kitchenId);return!(et!=null&&et.zone)||!(qr!=null&&qr.address.lat)||!(qr!=null&&qr.address.lng)?!1:isPointInZone(qr.address.lat,qr.address.lng,et.zone)}),en=async(xr,qr)=>{try{await updateDish(xr,{isBestSeller:!qr}),ue.success(qr?"Removed from Best Sellers":"Added to Best Sellers")}catch{ue.error("Failed to update dish")}},yr=async xr=>{try{await approveKitchen(xr),ue.success("Kitchen approved!")}catch{ue.error("Failed to approve kitchen")}},Ar=async xr=>{try{await rejectKitchen(xr),ue.success("Kitchen rejected")}catch{ue.error("Failed to reject kitchen")}};return _||nt||ct||gt||Et||Mt||!a?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):et?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:et.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Franchise Dashboard"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[Fr.length>0&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-gold text-foreground text-xs",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-3 h-3"}),Fr.length," pending"]}),jsxRuntimeExports.jsxs(Button,{variant:"ghost",size:"sm",onClick:Xt,className:"text-destructive",children:[jsxRuntimeExports.jsx(LogOut,{className:"w-4 h-4 mr-1"}),"Logout"]})]})]}),jsxRuntimeExports.jsx("div",{className:"flex bg-secondary mx-4 rounded-xl p-1 mb-4 overflow-x-auto",children:["overview","orders","map","kitchens","users","best_sellers"].map(xr=>jsxRuntimeExports.jsx("button",{onClick:()=>$t(xr),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all capitalize whitespace-nowrap ${Pt===xr?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:xr==="map"?jsxRuntimeExports.jsxs("span",{className:"flex items-center justify-center gap-1",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-3 h-3"})," Map"]}):xr==="best_sellers"?jsxRuntimeExports.jsxs("span",{className:"flex items-center justify-center gap-1",children:[jsxRuntimeExports.jsx(Sparkles,{className:"w-3 h-3"})," Best Sellers"]}):xr},xr))})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[Pt==="overview"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(Store$1,{className:"w-6 h-6 text-primary mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:sn.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Active Kitchens"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(Users,{className:"w-6 h-6 text-blue-500 mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:mr.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Customers"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(Package,{className:"w-6 h-6 text-gold mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:Lr.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Today's Orders"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(TrendingUp,{className:"w-6 h-6 text-veg mb-2"}),jsxRuntimeExports.jsxs("p",{className:"text-2xl font-bold text-foreground",children:["",Qr]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Revenue"})]})]}),Fr.length>0&&jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-foreground mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-4 h-4 text-gold"}),"Pending Kitchen Approvals"]}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:Fr.map(xr=>jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-3 bg-secondary rounded-xl",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:xr.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:xr.address.city})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Button,{size:"sm",className:"bg-veg text-primary-foreground",onClick:()=>yr(xr.id),children:jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(Button,{size:"sm",variant:"outline",className:"text-destructive border-destructive",onClick:()=>Ar(xr.id),children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]})]},xr.id))})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-foreground mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4 text-primary"}),"Service Zone"]}),jsxRuntimeExports.jsx(FranchiseZoneMap,{zone:et.zone,kitchens:ar,users:mr.map(xr=>{var qr;return{id:xr.id,name:xr.name,lat:xr.address.lat,lng:xr.address.lng,email:xr.email,city:(qr=xr.address)==null?void 0:qr.city}}),height:"500px",onKitchenClick:nr}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground text-center mt-2",children:[ar.length," Ammas  ",mr.length," Customers in zone"]})]})]}),Pt==="orders"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground px-1",children:"Active Deliveries"}),fn.filter(xr=>!["delivered","cancelled"].includes(xr.status)).length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Package,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No active orders to manage"})]}):fn.filter(xr=>!["delivered","cancelled"].includes(xr.status)).sort((xr,qr)=>qr.createdAt-xr.createdAt).map(xr=>{const qr=xr.status==="packed",tn=xr.status==="out_for_delivery",vn=c.find(hs=>hs.id===xr.kitchenId);return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:(vn==null?void 0:vn.name)||"Unknown Kitchen"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",xr.id.slice(-8),"  ",new Date(xr.createdAt).toLocaleTimeString()]})]}),jsxRuntimeExports.jsx("span",{className:cn("px-2 py-1 rounded-full text-xs font-medium",xr.status==="packed"?"bg-veg text-primary-foreground":xr.status==="out_for_delivery"?"bg-accent text-accent-foreground":"bg-secondary text-muted-foreground"),children:xr.status==="packed"?"Ready for Pickup":xr.status.replace(/_/g," ")})]}),jsxRuntimeExports.jsx("div",{className:"space-y-1 mb-3",children:xr.items.map((hs,Ts)=>jsxRuntimeExports.jsx("div",{className:"flex justify-between text-sm",children:jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:[hs.dish.name," x",hs.quantity]})},Ts))}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-4",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-3 h-3"}),jsxRuntimeExports.jsxs("span",{children:[xr.deliveryAddress.line1,", ",xr.deliveryAddress.city]})]}),jsxRuntimeExports.jsxs("div",{className:"pt-3 border-t border-border space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Amount"}),jsxRuntimeExports.jsxs("span",{className:"font-bold text-foreground",children:["",xr.totalAmount]})]}),(qr||tn)&&jsxRuntimeExports.jsxs("div",{className:"w-full space-y-3",children:[jsxRuntimeExports.jsxs(Button,{variant:"outline",className:"w-full border-primary/20 text-primary hover:bg-primary/5",onClick:()=>{const hs=vn!=null&&vn.address.lat&&(vn!=null&&vn.address.lng)?`${vn.address.lat},${vn.address.lng}`:encodeURIComponent(`${vn==null?void 0:vn.address.line1}, ${vn==null?void 0:vn.address.city}`),ss=`https://www.google.com/maps/dir/?api=1&destination=${xr.deliveryAddress.lat&&xr.deliveryAddress.lng?`${xr.deliveryAddress.lat},${xr.deliveryAddress.lng}`:encodeURIComponent(`${xr.deliveryAddress.line1}, ${xr.deliveryAddress.city}`)}&waypoints=${hs}&travelmode=driving`;window.open(ss,"_blank")},children:[jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4 mr-2"})," Open Delivery Route"]}),jsxRuntimeExports.jsx(SlideAction,{onSuccess:async()=>{const hs=qr?"out_for_delivery":"delivered";try{await updateOrderStatus(xr.id,hs),ue.success(`Order updated to ${hs.replace(/_/g," ")}`)}catch{ue.error("Failed to update order")}},text:qr?"SLIDE TO START DELIVERY":"SLIDE TO COMPLETE DELIVERY",icon:qr?TrendingUp:Check,className:"h-12 bg-secondary/50 border-primary/20 w-full",sliderColor:"bg-primary",textColor:"text-primary"})]})]})]},xr.id)})]}),Pt==="map"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-foreground mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4 text-primary"}),et.name," - Service Zone Map"]}),jsxRuntimeExports.jsx(FranchiseZoneMap,{zone:et.zone,kitchens:ar,users:mr.map(xr=>{var qr;return{id:xr.id,name:xr.name,lat:xr.address.lat,lng:xr.address.lng,email:xr.email,city:(qr=xr.address)==null?void 0:qr.city}}),height:"750px",onKitchenClick:nr})]}),Nt&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-4",children:[jsxRuntimeExports.jsx("img",{src:Nt.image,alt:Nt.name,className:"w-20 h-20 rounded-xl object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:Nt.name}),!Nt.isApproved&&jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 bg-gold/20 text-gold text-xs rounded-full",children:"Pending"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:(ur=Nt.specialties)==null?void 0:ur.join(", ")}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:[Nt.address.line1,", ",Nt.address.city]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[jsxRuntimeExports.jsx("span",{className:cn("text-xs px-2 py-1 rounded-full",Nt.isOpen?"bg-veg/20 text-veg":"bg-muted text-muted-foreground"),children:Nt.isOpen?" Open":" Closed"}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-muted-foreground",children:[" ",((Br=Nt.rating)==null?void 0:Br.toFixed(1))||"N/A"]})]})]}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",onClick:()=>Vt(null),className:"text-muted-foreground",children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]}),!Nt.isApproved&&jsxRuntimeExports.jsxs("div",{className:"flex gap-2 mt-4",children:[jsxRuntimeExports.jsxs(Button,{size:"sm",className:"flex-1 bg-veg text-primary-foreground",onClick:()=>{yr(Nt.id),Vt(null)},children:[jsxRuntimeExports.jsx(Check,{className:"w-4 h-4 mr-1"})," Approve"]}),jsxRuntimeExports.jsxs(Button,{size:"sm",variant:"outline",className:"flex-1 text-destructive border-destructive",onClick:()=>{Ar(Nt.id),Vt(null)},children:[jsxRuntimeExports.jsx(X,{className:"w-4 h-4 mr-1"})," Reject"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-3 shadow-card text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-orange-500",children:ar.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Ammas"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-3 shadow-card text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-blue-500",children:mr.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Customers"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-3 shadow-card text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-veg",children:fn.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Orders"})]})]})]}),Pt==="kitchens"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{placeholder:"Search kitchens...",value:Lt,onChange:xr=>Bt(xr.target.value),className:"bg-secondary border-0"}),ar.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Store$1,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No kitchens in your zone yet"})]}):ar.filter(xr=>xr.name.toLowerCase().includes(Lt.toLowerCase())).map(xr=>{var qr;return jsxRuntimeExports.jsxs(motion.div,{className:"bg-card rounded-xl p-4 shadow-card flex gap-4",children:[jsxRuntimeExports.jsx("img",{src:xr.image,alt:xr.name,className:"w-16 h-16 rounded-lg object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:xr.name}),!xr.isApproved&&jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 bg-gold/20 text-gold text-xs rounded-full",children:"Pending"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:(qr=xr.specialties)==null?void 0:qr.join(", ")}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:xr.address.city})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-1",children:[jsxRuntimeExports.jsx("span",{className:cn("text-xs px-2 py-1 rounded-full text-center",xr.isOpen?"bg-veg/20 text-veg":"bg-muted text-muted-foreground"),children:xr.isOpen?"Open":"Closed"}),!xr.isApproved&&jsxRuntimeExports.jsx(Button,{size:"sm",className:"bg-veg text-primary-foreground text-xs",onClick:()=>yr(xr.id),children:"Approve"})]})]},xr.id)})]}),Pt==="users"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{placeholder:"Search users...",value:Lt,onChange:xr=>Bt(xr.target.value),className:"bg-secondary border-0"}),mr.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Users,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No customers in your zone yet"})]}):mr.filter(xr=>xr.name.toLowerCase().includes(Lt.toLowerCase())||xr.email.toLowerCase().includes(Lt.toLowerCase())).map(xr=>{var qr;return jsxRuntimeExports.jsxs(motion.div,{className:"bg-card rounded-xl p-4 shadow-card flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-500/20 flex items-center justify-center",children:jsxRuntimeExports.jsx(Users,{className:"w-6 h-6 text-blue-500"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:xr.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:xr.email}),((qr=xr.address)==null?void 0:qr.city)&&jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:xr.address.city})]}),jsxRuntimeExports.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-blue-500/20 text-blue-500",children:"Customer"})]},xr.id)})]}),Pt==="best_sellers"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card mb-4 border-l-4 border-gold",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-4",children:[jsxRuntimeExports.jsx("div",{className:"p-3 bg-gold/10 rounded-full",children:jsxRuntimeExports.jsx(Sparkles,{className:"w-6 h-6 text-gold"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:"Manage Best Sellers"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:'Highlight popular dishes to appear in the "Best Selling" section on the home page.'})]})]})}),jsxRuntimeExports.jsx(Input,{placeholder:"Search dishes...",value:Lt,onChange:xr=>Bt(xr.target.value),className:"bg-secondary border-0"}),dn.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Store$1,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No dishes available in your zone yet"})]}):dn.filter(xr=>xr.name.toLowerCase().includes(Lt.toLowerCase())).map(xr=>{const qr=c.find(tn=>tn.id===xr.kitchenId);return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card rounded-xl p-4 shadow-card flex items-center gap-4",children:[jsxRuntimeExports.jsx("img",{src:xr.image,alt:xr.name,className:"w-16 h-16 rounded-lg object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:xr.name}),xr.isBestSeller&&jsxRuntimeExports.jsxs("span",{className:"px-2 py-0.5 bg-gold text-white text-xs rounded-full flex items-center gap-1",children:[jsxRuntimeExports.jsx(Sparkles,{className:"w-3 h-3"})," Featured"]})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1",children:xr.description}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[jsxRuntimeExports.jsxs("p",{className:"text-xs font-semibold text-primary",children:["",xr.price]}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:""}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:(qr==null?void 0:qr.name)||"Unknown Kitchen"})]})]}),jsxRuntimeExports.jsx(Button,{size:"sm",variant:xr.isBestSeller?"secondary":"default",className:cn(xr.isBestSeller?"bg-secondary text-foreground hover:bg-destructive/10 hover:text-destructive":"bg-gold hover:bg-gold/90 text-white"),onClick:()=>en(xr.id,xr.isBestSeller),children:xr.isBestSeller?"Remove":"Highlight"})]},xr.id)})]})]})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-16 h-16 text-gold mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"No franchise assigned to your account"}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Go Home"})})]})}const Dialog=Root$1,DialogTrigger=Trigger$2,DialogPortal=Portal$1,DialogOverlay=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Overlay,{ref:s,className:cn("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...i}));DialogOverlay.displayName=Overlay.displayName;const DialogContent=reactExports.forwardRef(({className:e,children:i,...s},a)=>jsxRuntimeExports.jsxs(DialogPortal,{children:[jsxRuntimeExports.jsx(DialogOverlay,{}),jsxRuntimeExports.jsxs(Content$1,{ref:a,className:cn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s,children:[i,jsxRuntimeExports.jsxs(Close,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[jsxRuntimeExports.jsx(X,{className:"h-4 w-4"}),jsxRuntimeExports.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));DialogContent.displayName=Content$1.displayName;const DialogHeader=({className:e,...i})=>jsxRuntimeExports.jsx("div",{className:cn("flex flex-col space-y-1.5 text-center sm:text-left",e),...i});DialogHeader.displayName="DialogHeader";const DialogTitle=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Title,{ref:s,className:cn("text-lg font-semibold leading-none tracking-tight",e),...i}));DialogTitle.displayName=Title.displayName;const DialogDescription=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Description,{ref:s,className:cn("text-sm text-muted-foreground",e),...i}));DialogDescription.displayName=Description.displayName;const classes={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},sources={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},cursors={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},types$1={POLYGON:"polygon",LINE:"line_string",POINT:"point"},geojsonTypes={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},modes$1={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},events$1={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},updateActions={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},meta={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},activeStates={ACTIVE:"true",INACTIVE:"false"},interactions=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],LAT_MIN$1=-90,LAT_RENDERED_MIN$1=-85,LAT_MAX$1=90,LAT_RENDERED_MAX$1=85,LNG_MIN$1=-270,LNG_MAX$1=270,Constants=Object.freeze(Object.defineProperty({__proto__:null,LAT_MAX:LAT_MAX$1,LAT_MIN:LAT_MIN$1,LAT_RENDERED_MAX:LAT_RENDERED_MAX$1,LAT_RENDERED_MIN:LAT_RENDERED_MIN$1,LNG_MAX:LNG_MAX$1,LNG_MIN:LNG_MIN$1,activeStates,classes,cursors,events:events$1,geojsonTypes,interactions,meta,modes:modes$1,sources,types:types$1,updateActions},Symbol.toStringTag,{value:"Module"}));function isOfMetaType(e){return function(i){const s=i.featureTarget;return!s||!s.properties?!1:s.properties.meta===e}}function isShiftMousedown(e){return!e.originalEvent||!e.originalEvent.shiftKey?!1:e.originalEvent.button===0}function isActiveFeature(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===activeStates.ACTIVE&&e.featureTarget.properties.meta===meta.FEATURE}function isInactiveFeature(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===activeStates.INACTIVE&&e.featureTarget.properties.meta===meta.FEATURE}function noTarget(e){return e.featureTarget===void 0}function isFeature(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.meta===meta.FEATURE}function isVertex$1(e){const i=e.featureTarget;return!i||!i.properties?!1:i.properties.meta===meta.VERTEX}function isShiftDown(e){return e.originalEvent?e.originalEvent.shiftKey===!0:!1}function isEscapeKey(e){return e.key==="Escape"||e.keyCode===27}function isEnterKey(e){return e.key==="Enter"||e.keyCode===13}function isBackspaceKey(e){return e.key==="Backspace"||e.keyCode===8}function isDeleteKey(e){return e.key==="Delete"||e.keyCode===46}function isDigit1Key(e){return e.key==="1"||e.keyCode===49}function isDigit2Key(e){return e.key==="2"||e.keyCode===50}function isDigit3Key(e){return e.key==="3"||e.keyCode===51}function isDigitKey(e){const i=e.key||String.fromCharCode(e.keyCode);return i>="0"&&i<="9"}function isTrue(){return!0}const common_selectors=Object.freeze(Object.defineProperty({__proto__:null,isActiveFeature,isBackspaceKey,isDeleteKey,isDigit1Key,isDigit2Key,isDigit3Key,isDigitKey,isEnterKey,isEscapeKey,isFeature,isInactiveFeature,isOfMetaType,isShiftDown,isShiftMousedown,isTrue,isVertex:isVertex$1,noTarget},Symbol.toStringTag,{value:"Module"}));var geojsonArea={},wgs84$1={};wgs84$1.RADIUS=6378137;wgs84$1.FLATTENING=1/298.257223563;wgs84$1.POLAR_RADIUS=63567523142e-4;var wgs84=wgs84$1;geojsonArea.geometry=geometry;geojsonArea.ring=ringArea;function geometry(e){var i=0,s;switch(e.type){case"Polygon":return polygonArea(e.coordinates);case"MultiPolygon":for(s=0;s<e.coordinates.length;s++)i+=polygonArea(e.coordinates[s]);return i;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(s=0;s<e.geometries.length;s++)i+=geometry(e.geometries[s]);return i}}function polygonArea(e){var i=0;if(e&&e.length>0){i+=Math.abs(ringArea(e[0]));for(var s=1;s<e.length;s++)i-=Math.abs(ringArea(e[s]))}return i}function ringArea(e){var i,s,a,_,et,nt,c,ct=0,dt=e.length;if(dt>2){for(c=0;c<dt;c++)c===dt-2?(_=dt-2,et=dt-1,nt=0):c===dt-1?(_=dt-1,et=0,nt=1):(_=c,et=c+1,nt=c+2),i=e[_],s=e[et],a=e[nt],ct+=(rad(a[0])-rad(i[0]))*Math.sin(rad(s[1]));ct=ct*wgs84.RADIUS*wgs84.RADIUS/2}return ct}function rad(e){return e*Math.PI/180}const FEATURE_SORT_RANKS={Point:0,LineString:1,MultiLineString:1,Polygon:2};function comparator(e,i){const s=FEATURE_SORT_RANKS[e.geometry.type]-FEATURE_SORT_RANKS[i.geometry.type];return s===0&&e.geometry.type===geojsonTypes.POLYGON?e.area-i.area:s}function sortFeatures(e){return e.map(i=>(i.geometry.type===geojsonTypes.POLYGON&&(i.area=geojsonArea.geometry({type:geojsonTypes.FEATURE,property:{},geometry:i.geometry})),i)).sort(comparator).map(i=>(delete i.area,i))}function mapEventToBoundingBox(e,i=0){return[[e.point.x-i,e.point.y-i],[e.point.x+i,e.point.y+i]]}function StringSet(e){if(this._items={},this._nums={},this._length=e?e.length:0,!!e)for(let i=0,s=e.length;i<s;i++)this.add(e[i]),e[i]!==void 0&&(typeof e[i]=="string"?this._items[e[i]]=i:this._nums[e[i]]=i)}StringSet.prototype.add=function(e){return this.has(e)?this:(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length,this)};StringSet.prototype.delete=function(e){return this.has(e)===!1?this:(this._length--,delete this._items[e],delete this._nums[e],this)};StringSet.prototype.has=function(e){return typeof e!="string"&&typeof e!="number"?!1:this._items[e]!==void 0||this._nums[e]!==void 0};StringSet.prototype.values=function(){const e=[];return Object.keys(this._items).forEach(i=>{e.push({k:i,v:this._items[i]})}),Object.keys(this._nums).forEach(i=>{e.push({k:JSON.parse(i),v:this._nums[i]})}),e.sort((i,s)=>i.v-s.v).map(i=>i.k)};StringSet.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const META_TYPES=[meta.FEATURE,meta.MIDPOINT,meta.VERTEX],featuresAt={click:featuresAtClick,touch:featuresAtTouch};function featuresAtClick(e,i,s){return featuresAt$1(e,i,s,s.options.clickBuffer)}function featuresAtTouch(e,i,s){return featuresAt$1(e,i,s,s.options.touchBuffer)}function featuresAt$1(e,i,s,a){if(s.map===null)return[];const _=e?mapEventToBoundingBox(e,a):i,et={};s.options.styles&&(et.layers=s.options.styles.map(dt=>dt.id).filter(dt=>s.map.getLayer(dt)!=null));const nt=s.map.queryRenderedFeatures(_,et).filter(dt=>META_TYPES.indexOf(dt.properties.meta)!==-1),c=new StringSet,ct=[];return nt.forEach(dt=>{const gt=dt.properties.id;c.has(gt)||(c.add(gt),ct.push(dt))}),sortFeatures(ct)}function getFeatureAtAndSetCursors(e,i){const s=featuresAt.click(e,null,i),a={mouse:cursors.NONE};return s[0]&&(a.mouse=s[0].properties.active===activeStates.ACTIVE?cursors.MOVE:cursors.POINTER,a.feature=s[0].properties.meta),i.events.currentModeName().indexOf("draw")!==-1&&(a.mouse=cursors.ADD),i.ui.queueMapClasses(a),i.ui.updateMapClasses(),s[0]}function euclideanDistance(e,i){const s=e.x-i.x,a=e.y-i.y;return Math.sqrt(s*s+a*a)}const FINE_TOLERANCE=4,GROSS_TOLERANCE=12,INTERVAL=500;function isClick(e,i,s={}){const a=s.fineTolerance!=null?s.fineTolerance:FINE_TOLERANCE,_=s.grossTolerance!=null?s.grossTolerance:GROSS_TOLERANCE,et=s.interval!=null?s.interval:INTERVAL;e.point=e.point||i.point,e.time=e.time||i.time;const nt=euclideanDistance(e.point,i.point);return nt<a||nt<_&&i.time-e.time<et}const TAP_TOLERANCE=25,TAP_INTERVAL=250;function isTap(e,i,s={}){const a=s.tolerance!=null?s.tolerance:TAP_TOLERANCE,_=s.interval!=null?s.interval:TAP_INTERVAL;return e.point=e.point||i.point,e.time=e.time||i.time,euclideanDistance(e.point,i.point)<a&&i.time-e.time<_}const ModeHandler=function(e,i){const s={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},a={on(et,nt,c){if(s[et]===void 0)throw new Error(`Invalid event type: ${et}`);s[et].push({selector:nt,fn:c})},render(et){i.store.featureChanged(et)}},_=function(et,nt){const c=s[et];let ct=c.length;for(;ct--;){const dt=c[ct];if(dt.selector(nt)){dt.fn.call(a,nt)||i.store.render(),i.ui.updateMapClasses();break}}};return e.start.call(a),{render:e.render,stop(){e.stop&&e.stop()},trash(){e.trash&&(e.trash(),i.store.render())},combineFeatures(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures(){e.uncombineFeatures&&e.uncombineFeatures()},drag(et){_("drag",et)},click(et){_("click",et)},mousemove(et){_("mousemove",et)},mousedown(et){_("mousedown",et)},mouseup(et){_("mouseup",et)},mouseout(et){_("mouseout",et)},keydown(et){_("keydown",et)},keyup(et){_("keyup",et)},touchstart(et){_("touchstart",et)},touchmove(et){_("touchmove",et)},touchend(et){_("touchend",et)},tap(et){_("tap",et)}}};let customAlphabet=(e,i=21)=>(s=i)=>{let a="",_=s|0;for(;_--;)a+=e[Math.random()*e.length|0];return a};const nanoid=customAlphabet("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function generateID(){return nanoid()}const Feature=function(e,i){this.ctx=e,this.properties=i.properties||{},this.coordinates=i.geometry.coordinates,this.id=i.id||generateID(),this.type=i.geometry.type};Feature.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};Feature.prototype.incomingCoords=function(e){this.setCoordinates(e)};Feature.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};Feature.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};Feature.prototype.setProperty=function(e,i){this.properties[e]=i};Feature.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:geojsonTypes.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};Feature.prototype.internal=function(e){const i={id:this.id,meta:meta.FEATURE,"meta:type":this.type,active:activeStates.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(const s in this.properties)i[`user_${s}`]=this.properties[s];return{type:geojsonTypes.FEATURE,properties:i,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const Point$1=function(e,i){Feature.call(this,e,i)};Point$1.prototype=Object.create(Feature.prototype);Point$1.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};Point$1.prototype.updateCoordinate=function(e,i,s){arguments.length===3?this.coordinates=[i,s]:this.coordinates=[e,i],this.changed()};Point$1.prototype.getCoordinate=function(){return this.getCoordinates()};const LineString=function(e,i){Feature.call(this,e,i)};LineString.prototype=Object.create(Feature.prototype);LineString.prototype.isValid=function(){return this.coordinates.length>1};LineString.prototype.addCoordinate=function(e,i,s){this.changed();const a=parseInt(e,10);this.coordinates.splice(a,0,[i,s])};LineString.prototype.getCoordinate=function(e){const i=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[i]))};LineString.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)};LineString.prototype.updateCoordinate=function(e,i,s){const a=parseInt(e,10);this.coordinates[a]=[i,s],this.changed()};const Polygon=function(e,i){Feature.call(this,e,i),this.coordinates=this.coordinates.map(s=>s.slice(0,-1))};Polygon.prototype=Object.create(Feature.prototype);Polygon.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(e=>e.length>2)};Polygon.prototype.incomingCoords=function(e){this.coordinates=e.map(i=>i.slice(0,-1)),this.changed()};Polygon.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};Polygon.prototype.addCoordinate=function(e,i,s){this.changed();const a=e.split(".").map(et=>parseInt(et,10));this.coordinates[a[0]].splice(a[1],0,[i,s])};Polygon.prototype.removeCoordinate=function(e){this.changed();const i=e.split(".").map(a=>parseInt(a,10)),s=this.coordinates[i[0]];s&&(s.splice(i[1],1),s.length<3&&this.coordinates.splice(i[0],1))};Polygon.prototype.getCoordinate=function(e){const i=e.split(".").map(a=>parseInt(a,10)),s=this.coordinates[i[0]];return JSON.parse(JSON.stringify(s[i[1]]))};Polygon.prototype.getCoordinates=function(){return this.coordinates.map(e=>e.concat([e[0]]))};Polygon.prototype.updateCoordinate=function(e,i,s){this.changed();const a=e.split("."),_=parseInt(a[0],10),et=parseInt(a[1],10);this.coordinates[_]===void 0&&(this.coordinates[_]=[]),this.coordinates[_][et]=[i,s]};const models={MultiPoint:Point$1,MultiLineString:LineString,MultiPolygon:Polygon},takeAction=(e,i,s,a,_)=>{const et=s.split("."),nt=parseInt(et[0],10),c=et[1]?et.slice(1).join("."):null;return e[nt][i](c,a,_)},MultiFeature=function(e,i){if(Feature.call(this,e,i),delete this.coordinates,this.model=models[i.geometry.type],this.model===void 0)throw new TypeError(`${i.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(i.geometry.coordinates)};MultiFeature.prototype=Object.create(Feature.prototype);MultiFeature.prototype._coordinatesToFeatures=function(e){const i=this.model.bind(this);return e.map(s=>new i(this.ctx,{id:generateID(),type:geojsonTypes.FEATURE,properties:{},geometry:{coordinates:s,type:this.type.replace("Multi","")}}))};MultiFeature.prototype.isValid=function(){return this.features.every(e=>e.isValid())};MultiFeature.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()};MultiFeature.prototype.getCoordinate=function(e){return takeAction(this.features,"getCoordinate",e)};MultiFeature.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(e=>e.type===geojsonTypes.POLYGON?e.getCoordinates():e.coordinates)))};MultiFeature.prototype.updateCoordinate=function(e,i,s){takeAction(this.features,"updateCoordinate",e,i,s),this.changed()};MultiFeature.prototype.addCoordinate=function(e,i,s){takeAction(this.features,"addCoordinate",e,i,s),this.changed()};MultiFeature.prototype.removeCoordinate=function(e){takeAction(this.features,"removeCoordinate",e),this.changed()};MultiFeature.prototype.getFeatures=function(){return this.features};function ModeInterface(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}ModeInterface.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)};ModeInterface.prototype.setSelectedCoordinates=function(e){this._ctx.store.setSelectedCoordinates(e),e.reduce((i,s)=>(i[s.feature_id]===void 0&&(i[s.feature_id]=!0,this._ctx.store.get(s.feature_id).changed()),i),{})};ModeInterface.prototype.getSelected=function(){return this._ctx.store.getSelected()};ModeInterface.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};ModeInterface.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)};ModeInterface.prototype.getFeature=function(e){return this._ctx.store.get(e)};ModeInterface.prototype.select=function(e){return this._ctx.store.select(e)};ModeInterface.prototype.deselect=function(e){return this._ctx.store.deselect(e)};ModeInterface.prototype.deleteFeature=function(e,i={}){return this._ctx.store.delete(e,i)};ModeInterface.prototype.addFeature=function(e,i={}){return this._ctx.store.add(e,i)};ModeInterface.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};ModeInterface.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};ModeInterface.prototype.setActionableState=function(e={}){const i={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(i)};ModeInterface.prototype.changeMode=function(e,i={},s={}){return this._ctx.events.changeMode(e,i,s)};ModeInterface.prototype.fire=function(e,i){return this._ctx.events.fire(e,i)};ModeInterface.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)};ModeInterface.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)};ModeInterface.prototype.featuresAt=function(e,i,s="click"){if(s!=="click"&&s!=="touch")throw new Error("invalid buffer type");return featuresAt[s](e,i,this._ctx)};ModeInterface.prototype.newFeature=function(e){const i=e.geometry.type;return i===geojsonTypes.POINT?new Point$1(this._ctx,e):i===geojsonTypes.LINE_STRING?new LineString(this._ctx,e):i===geojsonTypes.POLYGON?new Polygon(this._ctx,e):new MultiFeature(this._ctx,e)};ModeInterface.prototype.isInstanceOf=function(e,i){if(e===geojsonTypes.POINT)return i instanceof Point$1;if(e===geojsonTypes.LINE_STRING)return i instanceof LineString;if(e===geojsonTypes.POLYGON)return i instanceof Polygon;if(e==="MultiFeature")return i instanceof MultiFeature;throw new Error(`Unknown feature class: ${e}`)};ModeInterface.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)};ModeInterface.prototype.onSetup=function(){};ModeInterface.prototype.onDrag=function(){};ModeInterface.prototype.onClick=function(){};ModeInterface.prototype.onMouseMove=function(){};ModeInterface.prototype.onMouseDown=function(){};ModeInterface.prototype.onMouseUp=function(){};ModeInterface.prototype.onMouseOut=function(){};ModeInterface.prototype.onKeyUp=function(){};ModeInterface.prototype.onKeyDown=function(){};ModeInterface.prototype.onTouchStart=function(){};ModeInterface.prototype.onTouchMove=function(){};ModeInterface.prototype.onTouchEnd=function(){};ModeInterface.prototype.onTap=function(){};ModeInterface.prototype.onStop=function(){};ModeInterface.prototype.onTrash=function(){};ModeInterface.prototype.onCombineFeature=function(){};ModeInterface.prototype.onUncombineFeature=function(){};ModeInterface.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const eventMapper={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},eventKeys=Object.keys(eventMapper);function objectToMode(e){const i=Object.keys(e);return function(s,a={}){let _={};const et=i.reduce((c,ct)=>(c[ct]=e[ct],c),new ModeInterface(s));function nt(c){return ct=>et[c](_,ct)}return{start(){_=et.onSetup(a),eventKeys.forEach(c=>{const ct=eventMapper[c];let dt=()=>!1;e[ct]&&(dt=()=>!0),this.on(c,dt,nt(ct))})},stop(){et.onStop(_)},trash(){et.onTrash(_)},combineFeatures(){et.onCombineFeatures(_)},uncombineFeatures(){et.onUncombineFeatures(_)},render(c,ct){et.toDisplayFeatures(_,c,ct)}}}}function events(e){const i=Object.keys(e.options.modes).reduce((Et,At)=>(Et[At]=objectToMode(e.options.modes[At]),Et),{});let s={},a={};const _={};let et=null,nt=null;_.drag=function(Et,At){At({point:Et.point,time:new Date().getTime()})?(e.ui.queueMapClasses({mouse:cursors.DRAG}),nt.drag(Et)):Et.originalEvent.stopPropagation()},_.mousedrag=function(Et){_.drag(Et,At=>!isClick(s,At))},_.touchdrag=function(Et){_.drag(Et,At=>!isTap(a,At))},_.mousemove=function(Et){if((Et.originalEvent.buttons!==void 0?Et.originalEvent.buttons:Et.originalEvent.which)===1)return _.mousedrag(Et);const Mt=getFeatureAtAndSetCursors(Et,e);Et.featureTarget=Mt,nt.mousemove(Et)},_.mousedown=function(Et){s={time:new Date().getTime(),point:Et.point};const At=getFeatureAtAndSetCursors(Et,e);Et.featureTarget=At,nt.mousedown(Et)},_.mouseup=function(Et){const At=getFeatureAtAndSetCursors(Et,e);Et.featureTarget=At,isClick(s,{point:Et.point,time:new Date().getTime()})?nt.click(Et):nt.mouseup(Et)},_.mouseout=function(Et){nt.mouseout(Et)},_.touchstart=function(Et){if(!e.options.touchEnabled)return;a={time:new Date().getTime(),point:Et.point};const At=featuresAt.touch(Et,null,e)[0];Et.featureTarget=At,nt.touchstart(Et)},_.touchmove=function(Et){if(e.options.touchEnabled)return nt.touchmove(Et),_.touchdrag(Et)},_.touchend=function(Et){if(Et.originalEvent.preventDefault(),!e.options.touchEnabled)return;const At=featuresAt.touch(Et,null,e)[0];Et.featureTarget=At,isTap(a,{time:new Date().getTime(),point:Et.point})?nt.tap(Et):nt.touchend(Et)};const c=Et=>{const At=isBackspaceKey(Et),Mt=isDeleteKey(Et),Pt=isDigitKey(Et);return!(At||Mt||Pt)};_.keydown=function(Et){(Et.srcElement||Et.target).classList.contains(classes.CANVAS)&&((isBackspaceKey(Et)||isDeleteKey(Et))&&e.options.controls.trash?(Et.preventDefault(),nt.trash()):c(Et)?nt.keydown(Et):isDigit1Key(Et)&&e.options.controls.point?ct(modes$1.DRAW_POINT):isDigit2Key(Et)&&e.options.controls.line_string?ct(modes$1.DRAW_LINE_STRING):isDigit3Key(Et)&&e.options.controls.polygon&&ct(modes$1.DRAW_POLYGON))},_.keyup=function(Et){c(Et)&&nt.keyup(Et)},_.zoomend=function(){e.store.changeZoom()},_.data=function(Et){if(Et.dataType==="style"){const{setup:At,map:Mt,options:Pt,store:$t}=e;Pt.styles.some(Bt=>Mt.getLayer(Bt.id))||(At.addLayers(),$t.setDirty(),$t.render())}};function ct(Et,At,Mt={}){nt.stop();const Pt=i[Et];if(Pt===void 0)throw new Error(`${Et} is not valid`);et=Et;const $t=Pt(e,At);nt=ModeHandler($t,e),Mt.silent||e.map.fire(events$1.MODE_CHANGE,{mode:Et}),e.store.setDirty(),e.store.render()}const dt={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function gt(Et){let At=!1;Object.keys(Et).forEach(Mt=>{if(dt[Mt]===void 0)throw new Error("Invalid action type");dt[Mt]!==Et[Mt]&&(At=!0),dt[Mt]=Et[Mt]}),At&&e.map.fire(events$1.ACTIONABLE,{actions:dt})}return{start(){et=e.options.defaultMode,nt=ModeHandler(i[et](e),e)},changeMode:ct,actionable:gt,currentModeName(){return et},currentModeRender(Et,At){return nt.render(Et,At)},fire(Et,At){e.map&&e.map.fire(Et,At)},addEventListeners(){e.map.on("mousemove",_.mousemove),e.map.on("mousedown",_.mousedown),e.map.on("mouseup",_.mouseup),e.map.on("data",_.data),e.map.on("touchmove",_.touchmove),e.map.on("touchstart",_.touchstart),e.map.on("touchend",_.touchend),e.container.addEventListener("mouseout",_.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",_.keydown),e.container.addEventListener("keyup",_.keyup))},removeEventListeners(){e.map.off("mousemove",_.mousemove),e.map.off("mousedown",_.mousedown),e.map.off("mouseup",_.mouseup),e.map.off("data",_.data),e.map.off("touchmove",_.touchmove),e.map.off("touchstart",_.touchstart),e.map.off("touchend",_.touchend),e.container.removeEventListener("mouseout",_.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",_.keydown),e.container.removeEventListener("keyup",_.keyup))},trash(Et){nt.trash(Et)},combineFeatures(){nt.combineFeatures()},uncombineFeatures(){nt.uncombineFeatures()},getMode(){return et}}}function toDenseArray(e){return[].concat(e).filter(i=>i!==void 0)}function render(){const e=this;if(!(e.ctx.map&&e.ctx.map.getSource(sources.HOT)!==void 0))return ct();const s=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:s});let a=[],_=[];e.isDirty?_=e.getAllIds():(a=e.getChangedIds().filter(dt=>e.get(dt)!==void 0),_=e.sources.hot.filter(dt=>dt.properties.id&&a.indexOf(dt.properties.id)===-1&&e.get(dt.properties.id)!==void 0).map(dt=>dt.properties.id)),e.sources.hot=[];const et=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(dt=>{const gt=dt.properties.id||dt.properties.parent;return a.indexOf(gt)===-1});const nt=et!==e.sources.cold.length||_.length>0;a.forEach(dt=>c(dt,"hot")),_.forEach(dt=>c(dt,"cold"));function c(dt,gt){const Et=e.get(dt).internal(s);e.ctx.events.currentModeRender(Et,At=>{At.properties.mode=s,e.sources[gt].push(At)})}nt&&e.ctx.map.getSource(sources.COLD).setData({type:geojsonTypes.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(sources.HOT).setData({type:geojsonTypes.FEATURE_COLLECTION,features:e.sources.hot}),ct();function ct(){e.isDirty=!1,e.clearChangedIds()}}function Store(e){this._features={},this._featureIds=new StringSet,this._selectedFeatureIds=new StringSet,this._selectedCoordinates=[],this._changedFeatureIds=new StringSet,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]};let i;this.render=()=>{i||(i=requestAnimationFrame(()=>{i=null,render.call(this),this._emitSelectionChange&&(this.ctx.events.fire(events$1.SELECTION_CHANGE,{features:this.getSelected().map(s=>s.toGeoJSON()),points:this.getSelectedCoordinates().map(s=>({type:geojsonTypes.FEATURE,properties:{},geometry:{type:geojsonTypes.POINT,coordinates:s.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(events$1.RENDER,{})}))},this.isDirty=!1}Store.prototype.createRenderBatch=function(){const e=this.render;let i=0;return this.render=function(){i++},()=>{this.render=e,i>0&&this.render()}};Store.prototype.setDirty=function(){return this.isDirty=!0,this};Store.prototype.featureCreated=function(e,i={}){if(this._changedFeatureIds.add(e),(i.silent!=null?i.silent:this.ctx.options.suppressAPIEvents)!==!0){const a=this.get(e);this.ctx.events.fire(events$1.CREATE,{features:[a.toGeoJSON()]})}return this};Store.prototype.featureChanged=function(e,i={}){return this._changedFeatureIds.add(e),(i.silent!=null?i.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(events$1.UPDATE,{action:i.action?i.action:updateActions.CHANGE_COORDINATES,features:[this.get(e).toGeoJSON()]}),this};Store.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};Store.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};Store.prototype.getAllIds=function(){return this._featureIds.values()};Store.prototype.add=function(e,i={}){return this._features[e.id]=e,this._featureIds.add(e.id),this.featureCreated(e.id,{silent:i.silent}),this};Store.prototype.delete=function(e,i={}){const s=[];return toDenseArray(e).forEach(a=>{this._featureIds.has(a)&&(this._featureIds.delete(a),this._selectedFeatureIds.delete(a),i.silent||s.indexOf(this._features[a])===-1&&s.push(this._features[a].toGeoJSON()),delete this._features[a],this.isDirty=!0)}),s.length&&this.ctx.events.fire(events$1.DELETE,{features:s}),refreshSelectedCoordinates(this,i),this};Store.prototype.get=function(e){return this._features[e]};Store.prototype.getAll=function(){return Object.keys(this._features).map(e=>this._features[e])};Store.prototype.select=function(e,i={}){return toDenseArray(e).forEach(s=>{this._selectedFeatureIds.has(s)||(this._selectedFeatureIds.add(s),this._changedFeatureIds.add(s),i.silent||(this._emitSelectionChange=!0))}),this};Store.prototype.deselect=function(e,i={}){return toDenseArray(e).forEach(s=>{this._selectedFeatureIds.has(s)&&(this._selectedFeatureIds.delete(s),this._changedFeatureIds.add(s),i.silent||(this._emitSelectionChange=!0))}),refreshSelectedCoordinates(this,i),this};Store.prototype.clearSelected=function(e={}){return this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this};Store.prototype.setSelected=function(e,i={}){return e=toDenseArray(e),this.deselect(this._selectedFeatureIds.values().filter(s=>e.indexOf(s)===-1),{silent:i.silent}),this.select(e.filter(s=>!this._selectedFeatureIds.has(s)),{silent:i.silent}),this};Store.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this};Store.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};Store.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};Store.prototype.getSelected=function(){return this.getSelectedIds().map(e=>this.get(e))};Store.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(i=>({coordinates:this.get(i.feature_id).getCoordinate(i.coord_path)}))};Store.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)};Store.prototype.setFeatureProperty=function(e,i,s,a={}){this.get(e).setProperty(i,s),this.featureChanged(e,{silent:a.silent,action:updateActions.CHANGE_PROPERTIES})};function refreshSelectedCoordinates(e,i={}){const s=e._selectedCoordinates.filter(a=>e._selectedFeatureIds.has(a.feature_id));e._selectedCoordinates.length!==s.length&&!i.silent&&(e._emitSelectionChange=!0),e._selectedCoordinates=s}Store.prototype.storeMapConfig=function(){interactions.forEach(e=>{this.ctx.map[e]&&(this._mapInitialConfig[e]=this.ctx.map[e].isEnabled())})};Store.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(e=>{this._mapInitialConfig[e]?this.ctx.map[e].enable():this.ctx.map[e].disable()})};Store.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]!==void 0?this._mapInitialConfig[e]:!0};const classTypes=["mode","feature","mouse"];function ui(e){const i={};let s=null,a={mode:null,feature:null,mouse:null},_={mode:null,feature:null,mouse:null};function et(){nt({mode:null,feature:null,mouse:null}),c()}function nt(At){_=Object.assign(_,At)}function c(){if(!e.container)return;const At=[],Mt=[];classTypes.forEach(Pt=>{_[Pt]!==a[Pt]&&(At.push(`${Pt}-${a[Pt]}`),_[Pt]!==null&&Mt.push(`${Pt}-${_[Pt]}`))}),At.length>0&&e.container.classList.remove(...At),Mt.length>0&&e.container.classList.add(...Mt),a=Object.assign(a,_)}function ct(At,Mt={}){const Pt=document.createElement("button");return Pt.className=`${classes.CONTROL_BUTTON} ${Mt.className}`,Pt.setAttribute("title",Mt.title),Mt.container.appendChild(Pt),Pt.addEventListener("click",$t=>{if($t.preventDefault(),$t.stopPropagation(),$t.target===s){dt(),Mt.onDeactivate();return}gt(At),Mt.onActivate()},!0),Pt}function dt(){s&&(s.classList.remove(classes.ACTIVE_BUTTON),s=null)}function gt(At){dt();const Mt=i[At];Mt&&Mt&&At!=="trash"&&(Mt.classList.add(classes.ACTIVE_BUTTON),s=Mt)}function Tt(){const At=e.options.controls,Mt=document.createElement("div");return Mt.className=`${classes.CONTROL_GROUP} ${classes.CONTROL_BASE}`,At&&(At[types$1.POINT]&&(i[types$1.POINT]=ct(types$1.POINT,{container:Mt,className:classes.CONTROL_BUTTON_POINT,title:`Marker tool ${e.options.keybindings?"(1)":""}`,onActivate:()=>e.events.changeMode(modes$1.DRAW_POINT),onDeactivate:()=>e.events.trash()})),At[types$1.LINE]&&(i[types$1.LINE]=ct(types$1.LINE,{container:Mt,className:classes.CONTROL_BUTTON_LINE,title:`LineString tool ${e.options.keybindings?"(2)":""}`,onActivate:()=>e.events.changeMode(modes$1.DRAW_LINE_STRING),onDeactivate:()=>e.events.trash()})),At[types$1.POLYGON]&&(i[types$1.POLYGON]=ct(types$1.POLYGON,{container:Mt,className:classes.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${e.options.keybindings?"(3)":""}`,onActivate:()=>e.events.changeMode(modes$1.DRAW_POLYGON),onDeactivate:()=>e.events.trash()})),At.trash&&(i.trash=ct("trash",{container:Mt,className:classes.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{e.events.trash()}})),At.combine_features&&(i.combine_features=ct("combineFeatures",{container:Mt,className:classes.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{e.events.combineFeatures()}})),At.uncombine_features&&(i.uncombine_features=ct("uncombineFeatures",{container:Mt,className:classes.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{e.events.uncombineFeatures()}}))),Mt}function Et(){Object.keys(i).forEach(At=>{const Mt=i[At];Mt.parentNode&&Mt.parentNode.removeChild(Mt),delete i[At]})}return{setActiveButton:gt,queueMapClasses:nt,updateMapClasses:c,clearMapClasses:et,addButtons:Tt,removeButtons:Et}}function runSetup(e){let i=null,s=null;const a={onRemove(){return e.map.off("load",a.connect),clearInterval(s),a.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,i&&i.parentNode&&i.parentNode.removeChild(i),i=null,this},connect(){e.map.off("load",a.connect),clearInterval(s),a.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd(_){if(e.map=_,e.events=events(e),e.ui=ui(e),e.container=_.getContainer(),e.store=new Store(e),i=e.ui.addButtons(),e.options.boxSelect){e.boxZoomInitial=_.boxZoom.isEnabled(),_.boxZoom.disable();const et=_.dragPan.isEnabled();_.dragPan.disable(),_.dragPan.enable(),et||_.dragPan.disable()}return _.loaded()?a.connect():(_.on("load",a.connect),s=setInterval(()=>{_.loaded()&&a.connect()},16)),e.events.start(),i},addLayers(){e.map.addSource(sources.COLD,{data:{type:geojsonTypes.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(sources.HOT,{data:{type:geojsonTypes.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(_=>{e.map.addLayer(_)}),e.store.setDirty(!0),e.store.render()},removeLayers(){e.options.styles.forEach(_=>{e.map.getLayer(_.id)&&e.map.removeLayer(_.id)}),e.map.getSource(sources.COLD)&&e.map.removeSource(sources.COLD),e.map.getSource(sources.HOT)&&e.map.removeSource(sources.HOT)}};return e.setup=a,a}const blue="#3bb2d0",orange="#fbb03b",white="#fff",styles=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],orange,blue],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],orange,blue],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":white}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],orange,blue]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":white}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":orange}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":orange}}];function Point(e,i){this.x=e,this.y=i}Point.prototype={clone(){return new Point(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,i){return this.clone()._rotateAround(e,i)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const i=e.x-this.x,s=e.y-this.y;return i*i+s*s},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult(e){const i=e[0]*this.x+e[1]*this.y,s=e[2]*this.x+e[3]*this.y;return this.x=i,this.y=s,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const i=Math.cos(e),s=Math.sin(e),a=i*this.x-s*this.y,_=s*this.x+i*this.y;return this.x=a,this.y=_,this},_rotateAround(e,i){const s=Math.cos(e),a=Math.sin(e),_=i.x+s*(this.x-i.x)-a*(this.y-i.y),et=i.y+a*(this.x-i.x)+s*(this.y-i.y);return this.x=_,this.y=et,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Point};Point.convert=function(e){if(e instanceof Point)return e;if(Array.isArray(e))return new Point(+e[0],+e[1]);if(e.x!==void 0&&e.y!==void 0)return new Point(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};function mouseEventPoint(e,i){const s=i.getBoundingClientRect();return new Point(e.clientX-s.left-(i.clientLeft||0),e.clientY-s.top-(i.clientTop||0))}function createVertex(e,i,s,a){return{type:geojsonTypes.FEATURE,properties:{meta:meta.VERTEX,parent:e,coord_path:s,active:a?activeStates.ACTIVE:activeStates.INACTIVE},geometry:{type:geojsonTypes.POINT,coordinates:i}}}function isNumber(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function coordEach(e,i,s){if(e!==null)for(var a,_,et,nt,c,ct,dt,gt=0,Tt=0,Et,At=e.type,Mt=At==="FeatureCollection",Pt=At==="Feature",$t=Mt?e.features.length:1,Lt=0;Lt<$t;Lt++){dt=Mt?e.features[Lt].geometry:Pt?e.geometry:e,Et=dt?dt.type==="GeometryCollection":!1,c=Et?dt.geometries.length:1;for(var Bt=0;Bt<c;Bt++){var Nt=0,Vt=0;if(nt=Et?dt.geometries[Bt]:dt,nt!==null){ct=nt.coordinates;var Xt=nt.type;switch(gt=0,Xt){case null:break;case"Point":if(i(ct,Tt,Lt,Nt,Vt)===!1)return!1;Tt++,Nt++;break;case"LineString":case"MultiPoint":for(a=0;a<ct.length;a++){if(i(ct[a],Tt,Lt,Nt,Vt)===!1)return!1;Tt++,Xt==="MultiPoint"&&Nt++}Xt==="LineString"&&Nt++;break;case"Polygon":case"MultiLineString":for(a=0;a<ct.length;a++){for(_=0;_<ct[a].length-gt;_++){if(i(ct[a][_],Tt,Lt,Nt,Vt)===!1)return!1;Tt++}Xt==="MultiLineString"&&Nt++,Xt==="Polygon"&&Vt++}Xt==="Polygon"&&Nt++;break;case"MultiPolygon":for(a=0;a<ct.length;a++){for(Vt=0,_=0;_<ct[a].length;_++){for(et=0;et<ct[a][_].length-gt;et++){if(i(ct[a][_][et],Tt,Lt,Nt,Vt)===!1)return!1;Tt++}Vt++}Nt++}break;case"GeometryCollection":for(a=0;a<nt.geometries.length;a++)if(coordEach(nt.geometries[a],i)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function clone(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return cloneFeature(e);case"FeatureCollection":return cloneFeatureCollection(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return cloneGeometry(e);default:throw new Error("unknown GeoJSON type")}}function cloneFeature(e){const i={type:"Feature"};return Object.keys(e).forEach(s=>{switch(s){case"type":case"properties":case"geometry":return;default:i[s]=e[s]}}),i.properties=cloneProperties(e.properties),e.geometry==null?i.geometry=null:i.geometry=cloneGeometry(e.geometry),i}function cloneProperties(e){const i={};return e&&Object.keys(e).forEach(s=>{const a=e[s];typeof a=="object"?a===null?i[s]=null:Array.isArray(a)?i[s]=a.map(_=>_):i[s]=cloneProperties(a):i[s]=a}),i}function cloneFeatureCollection(e){const i={type:"FeatureCollection"};return Object.keys(e).forEach(s=>{switch(s){case"type":case"features":return;default:i[s]=e[s]}}),i.features=e.features.map(s=>cloneFeature(s)),i}function cloneGeometry(e){const i={type:e.type};return e.bbox&&(i.bbox=e.bbox),e.type==="GeometryCollection"?(i.geometries=e.geometries.map(s=>cloneGeometry(s)),i):(i.coordinates=deepSlice(e.coordinates),i)}function deepSlice(e){const i=e;return typeof i[0]!="object"?i.slice():i.map(s=>deepSlice(s))}function toMercator(e,i={}){return convert(e,"mercator",i)}function toWgs84(e,i={}){return convert(e,"wgs84",i)}function convert(e,i,s={}){s=s||{};var a=s.mutate;if(!e)throw new Error("geojson is required");return Array.isArray(e)&&isNumber(e[0])?e=i==="mercator"?convertToMercator(e):convertToWgs84(e):(a!==!0&&(e=clone(e)),coordEach(e,function(_){var et=i==="mercator"?convertToMercator(_):convertToWgs84(_);_[0]=et[0],_[1]=et[1]})),e}function convertToMercator(e){var i=Math.PI/180,s=6378137,a=20037508342789244e-9,_=Math.abs(e[0])<=180?e[0]:e[0]-sign(e[0])*360,et=[s*_*i,s*Math.log(Math.tan(Math.PI*.25+.5*e[1]*i))];return et[0]>a&&(et[0]=a),et[0]<-a&&(et[0]=-a),et[1]>a&&(et[1]=a),et[1]<-a&&(et[1]=-a),et}function convertToWgs84(e){var i=180/Math.PI,s=6378137;return[e[0]*i/s,(Math.PI*.5-2*Math.atan(Math.exp(-e[1]/s)))*i]}function sign(e){return e<0?-1:e>0?1:0}function createMidpoint(e,i,s){const a=i.geometry.coordinates,_=s.geometry.coordinates;if(a[1]>LAT_RENDERED_MAX$1||a[1]<LAT_RENDERED_MIN$1||_[1]>LAT_RENDERED_MAX$1||_[1]<LAT_RENDERED_MIN$1)return null;const et=toMercator(a),nt=toMercator(_),c=Tt=>Number(Tt.toFixed(8)),ct=(Tt,Et)=>(Tt+Et)/2,dt=toWgs84([ct(et[0],nt[0]),ct(et[1],nt[1])]),gt=[c(dt[0]),c(dt[1])];return{type:geojsonTypes.FEATURE,properties:{meta:meta.MIDPOINT,parent:e,lng:gt[0],lat:gt[1],coord_path:s.properties.coord_path},geometry:{type:geojsonTypes.POINT,coordinates:gt}}}function createSupplementaryPoints(e,i={},s=null){const{type:a,coordinates:_}=e.geometry,et=e.properties&&e.properties.id;let nt=[];a===geojsonTypes.POINT?nt.push(createVertex(et,_,s,ct(s))):a===geojsonTypes.POLYGON?_.forEach((gt,Tt)=>{c(gt,s!==null?`${s}.${Tt}`:String(Tt))}):a===geojsonTypes.LINE_STRING?c(_,s):a.indexOf(geojsonTypes.MULTI_PREFIX)===0&&dt();function c(gt,Tt){let Et="",At=null;gt.forEach((Mt,Pt)=>{const $t=Tt!=null?`${Tt}.${Pt}`:String(Pt),Lt=createVertex(et,Mt,$t,ct($t));if(i.midpoints&&At){const Nt=createMidpoint(et,At,Lt);Nt&&nt.push(Nt)}At=Lt;const Bt=JSON.stringify(Mt);Et!==Bt&&nt.push(Lt),Pt===0&&(Et=Bt)})}function ct(gt){return i.selectedPaths?i.selectedPaths.indexOf(gt)!==-1:!1}function dt(){const gt=a.replace(geojsonTypes.MULTI_PREFIX,"");_.forEach((Tt,Et)=>{const At={type:geojsonTypes.FEATURE,properties:e.properties,geometry:{type:gt,coordinates:Tt}};nt=nt.concat(createSupplementaryPoints(At,i,Et))})}return nt}const doubleClickZoom={enable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.doubleClickZoom.disable()},0)}},{LAT_MIN,LAT_MAX,LAT_RENDERED_MIN,LAT_RENDERED_MAX,LNG_MIN,LNG_MAX}=Constants;function extent(e){const i={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[e.geometry.type],s=[e.geometry.coordinates].flat(i),a=s.map(c=>c[0]),_=s.map(c=>c[1]),et=c=>Math.min.apply(null,c),nt=c=>Math.max.apply(null,c);return[et(a),et(_),nt(a),nt(_)]}function constrainFeatureMovement(e,i){let s=LAT_MIN,a=LAT_MAX,_=LAT_MIN,et=LAT_MAX,nt=LNG_MAX,c=LNG_MIN;e.forEach(dt=>{const gt=extent(dt),Tt=gt[1],Et=gt[3],At=gt[0],Mt=gt[2];Tt>s&&(s=Tt),Et<a&&(a=Et),Et>_&&(_=Et),Tt<et&&(et=Tt),At<nt&&(nt=At),Mt>c&&(c=Mt)});const ct=i;return s+ct.lat>LAT_RENDERED_MAX&&(ct.lat=LAT_RENDERED_MAX-s),_+ct.lat>LAT_MAX&&(ct.lat=LAT_MAX-_),a+ct.lat<LAT_RENDERED_MIN&&(ct.lat=LAT_RENDERED_MIN-a),et+ct.lat<LAT_MIN&&(ct.lat=LAT_MIN-et),nt+ct.lng<=LNG_MIN&&(ct.lng+=Math.ceil(Math.abs(ct.lng)/360)*360),c+ct.lng>=LNG_MAX&&(ct.lng-=Math.ceil(Math.abs(ct.lng)/360)*360),ct}function moveFeatures(e,i){const s=constrainFeatureMovement(e.map(a=>a.toGeoJSON()),i);e.forEach(a=>{const _=a.getCoordinates(),et=dt=>{const gt={lng:dt[0]+s.lng,lat:dt[1]+s.lat};return[gt.lng,gt.lat]},nt=dt=>dt.map(gt=>et(gt)),c=dt=>dt.map(gt=>nt(gt));let ct;a.type===geojsonTypes.POINT?ct=et(_):a.type===geojsonTypes.LINE_STRING||a.type===geojsonTypes.MULTI_POINT?ct=_.map(et):a.type===geojsonTypes.POLYGON||a.type===geojsonTypes.MULTI_LINE_STRING?ct=_.map(nt):a.type===geojsonTypes.MULTI_POLYGON&&(ct=_.map(c)),a.incomingCoords(ct)})}const SimpleSelect={};SimpleSelect.onSetup=function(e){const i={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(i.initiallySelectedFeatureIds.filter(s=>this.getFeature(s)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),i};SimpleSelect.fireUpdate=function(){this.fire(events$1.UPDATE,{action:updateActions.MOVE,features:this.getSelected().map(e=>e.toGeoJSON())})};SimpleSelect.fireActionable=function(){const e=this.getSelected(),i=e.filter(et=>this.isInstanceOf("MultiFeature",et));let s=!1;if(e.length>1){s=!0;const et=e[0].type.replace("Multi","");e.forEach(nt=>{nt.type.replace("Multi","")!==et&&(s=!1)})}const a=i.length>0,_=e.length>0;this.setActionableState({combineFeatures:s,uncombineFeatures:a,trash:_})};SimpleSelect.getUniqueIds=function(e){return e.length?e.map(s=>s.properties.id).filter(s=>s!==void 0).reduce((s,a)=>(s.add(a),s),new StringSet).values():[]};SimpleSelect.stopExtendedInteractions=function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),(e.canDragMove||e.canBoxSelect)&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1};SimpleSelect.onStop=function(){doubleClickZoom.enable(this)};SimpleSelect.onMouseMove=function(e,i){return isFeature(i)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0};SimpleSelect.onMouseOut=function(e){return e.dragMoving?this.fireUpdate():!0};SimpleSelect.onTap=SimpleSelect.onClick=function(e,i){if(noTarget(i))return this.clickAnywhere(e,i);if(isOfMetaType(meta.VERTEX)(i))return this.clickOnVertex(e,i);if(isFeature(i))return this.clickOnFeature(e,i)};SimpleSelect.clickAnywhere=function(e){const i=this.getSelectedIds();i.length&&(this.clearSelectedFeatures(),i.forEach(s=>this.doRender(s))),doubleClickZoom.enable(this),this.stopExtendedInteractions(e)};SimpleSelect.clickOnVertex=function(e,i){this.changeMode(modes$1.DIRECT_SELECT,{featureId:i.featureTarget.properties.parent,coordPath:i.featureTarget.properties.coord_path,startPos:i.lngLat}),this.updateUIClasses({mouse:cursors.MOVE})};SimpleSelect.startOnActiveFeature=function(e,i){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(i.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=i.lngLat};SimpleSelect.clickOnFeature=function(e,i){doubleClickZoom.disable(this),this.stopExtendedInteractions(e);const s=isShiftDown(i),a=this.getSelectedIds(),_=i.featureTarget.properties.id,et=this.isSelected(_);if(!s&&et&&this.getFeature(_).type!==geojsonTypes.POINT)return this.changeMode(modes$1.DIRECT_SELECT,{featureId:_});et&&s?(this.deselect(_),this.updateUIClasses({mouse:cursors.POINTER}),a.length===1&&doubleClickZoom.enable(this)):!et&&s?(this.select(_),this.updateUIClasses({mouse:cursors.MOVE})):!et&&!s&&(a.forEach(nt=>this.doRender(nt)),this.setSelected(_),this.updateUIClasses({mouse:cursors.MOVE})),this.doRender(_)};SimpleSelect.onMouseDown=function(e,i){if(e.initialDragPanState=this.map.dragPan.isEnabled(),isActiveFeature(i))return this.startOnActiveFeature(e,i);if(this.drawConfig.boxSelect&&isShiftMousedown(i))return this.startBoxSelect(e,i)};SimpleSelect.startBoxSelect=function(e,i){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=mouseEventPoint(i.originalEvent,this.map.getContainer()),e.canBoxSelect=!0};SimpleSelect.onTouchStart=function(e,i){if(isActiveFeature(i))return this.startOnActiveFeature(e,i)};SimpleSelect.onDrag=function(e,i){if(e.canDragMove)return this.dragMove(e,i);if(this.drawConfig.boxSelect&&e.canBoxSelect)return this.whileBoxSelect(e,i)};SimpleSelect.whileBoxSelect=function(e,i){e.boxSelecting=!0,this.updateUIClasses({mouse:cursors.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(classes.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));const s=mouseEventPoint(i.originalEvent,this.map.getContainer()),a=Math.min(e.boxSelectStartLocation.x,s.x),_=Math.max(e.boxSelectStartLocation.x,s.x),et=Math.min(e.boxSelectStartLocation.y,s.y),nt=Math.max(e.boxSelectStartLocation.y,s.y),c=`translate(${a}px, ${et}px)`;e.boxSelectElement.style.transform=c,e.boxSelectElement.style.WebkitTransform=c,e.boxSelectElement.style.width=`${_-a}px`,e.boxSelectElement.style.height=`${nt-et}px`};SimpleSelect.dragMove=function(e,i){e.dragMoving=!0,i.originalEvent.stopPropagation();const s={lng:i.lngLat.lng-e.dragMoveLocation.lng,lat:i.lngLat.lat-e.dragMoveLocation.lat};moveFeatures(this.getSelected(),s),e.dragMoveLocation=i.lngLat};SimpleSelect.onTouchEnd=SimpleSelect.onMouseUp=function(e,i){if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){const s=[e.boxSelectStartLocation,mouseEventPoint(i.originalEvent,this.map.getContainer())],a=this.featuresAt(null,s,"click"),_=this.getUniqueIds(a).filter(et=>!this.isSelected(et));_.length&&(this.select(_),_.forEach(et=>this.doRender(et)),this.updateUIClasses({mouse:cursors.MOVE}))}this.stopExtendedInteractions(e)};SimpleSelect.toDisplayFeatures=function(e,i,s){i.properties.active=this.isSelected(i.properties.id)?activeStates.ACTIVE:activeStates.INACTIVE,s(i),this.fireActionable(),!(i.properties.active!==activeStates.ACTIVE||i.geometry.type===geojsonTypes.POINT)&&createSupplementaryPoints(i).forEach(s)};SimpleSelect.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()};SimpleSelect.onCombineFeatures=function(){const e=this.getSelected();if(e.length===0||e.length<2)return;const i=[],s=[],a=e[0].type.replace("Multi","");for(let _=0;_<e.length;_++){const et=e[_];if(et.type.replace("Multi","")!==a)return;et.type.includes("Multi")?et.getCoordinates().forEach(nt=>{i.push(nt)}):i.push(et.getCoordinates()),s.push(et.toGeoJSON())}if(s.length>1){const _=this.newFeature({type:geojsonTypes.FEATURE,properties:s[0].properties,geometry:{type:`Multi${a}`,coordinates:i}});this.addFeature(_),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([_.id]),this.fire(events$1.COMBINE_FEATURES,{createdFeatures:[_.toGeoJSON()],deletedFeatures:s})}this.fireActionable()};SimpleSelect.onUncombineFeatures=function(){const e=this.getSelected();if(e.length===0)return;const i=[],s=[];for(let a=0;a<e.length;a++){const _=e[a];this.isInstanceOf("MultiFeature",_)&&(_.getFeatures().forEach(et=>{this.addFeature(et),et.properties=_.properties,i.push(et.toGeoJSON()),this.select([et.id])}),this.deleteFeature(_.id,{silent:!0}),s.push(_.toGeoJSON()))}i.length>1&&this.fire(events$1.UNCOMBINE_FEATURES,{createdFeatures:i,deletedFeatures:s}),this.fireActionable()};const isVertex=isOfMetaType(meta.VERTEX),isMidpoint=isOfMetaType(meta.MIDPOINT),DirectSelect={};DirectSelect.fireUpdate=function(){this.fire(events$1.UPDATE,{action:updateActions.CHANGE_COORDINATES,features:this.getSelected().map(e=>e.toGeoJSON())})};DirectSelect.fireActionable=function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})};DirectSelect.startDragging=function(e,i){e.initialDragPanState==null&&(e.initialDragPanState=this.map.dragPan.isEnabled()),this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=i.lngLat};DirectSelect.stopDragging=function(e){e.canDragMove&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.initialDragPanState=null,e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null};DirectSelect.onVertex=function(e,i){this.startDragging(e,i);const s=i.featureTarget.properties,a=e.selectedCoordPaths.indexOf(s.coord_path);!isShiftDown(i)&&a===-1?e.selectedCoordPaths=[s.coord_path]:isShiftDown(i)&&a===-1&&e.selectedCoordPaths.push(s.coord_path);const _=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(_)};DirectSelect.onMidpoint=function(e,i){this.startDragging(e,i);const s=i.featureTarget.properties;e.feature.addCoordinate(s.coord_path,s.lng,s.lat),this.fireUpdate(),e.selectedCoordPaths=[s.coord_path]};DirectSelect.pathsToCoordinates=function(e,i){return i.map(s=>({feature_id:e,coord_path:s}))};DirectSelect.onFeature=function(e,i){e.selectedCoordPaths.length===0?this.startDragging(e,i):this.stopDragging(e)};DirectSelect.dragFeature=function(e,i,s){moveFeatures(this.getSelected(),s),e.dragMoveLocation=i.lngLat};DirectSelect.dragVertex=function(e,i,s){const a=e.selectedCoordPaths.map(nt=>e.feature.getCoordinate(nt)),_=a.map(nt=>({type:geojsonTypes.FEATURE,properties:{},geometry:{type:geojsonTypes.POINT,coordinates:nt}})),et=constrainFeatureMovement(_,s);for(let nt=0;nt<a.length;nt++){const c=a[nt];e.feature.updateCoordinate(e.selectedCoordPaths[nt],c[0]+et.lng,c[1]+et.lat)}};DirectSelect.clickNoTarget=function(){this.changeMode(modes$1.SIMPLE_SELECT)};DirectSelect.clickInactive=function(){this.changeMode(modes$1.SIMPLE_SELECT)};DirectSelect.clickActiveFeature=function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()};DirectSelect.onSetup=function(e){const i=e.featureId,s=this.getFeature(i);if(!s)throw new Error("You must provide a featureId to enter direct_select mode");if(s.type===geojsonTypes.POINT)throw new TypeError("direct_select mode doesn't handle point features");const a={featureId:i,feature:s,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(i,a.selectedCoordPaths)),this.setSelected(i),doubleClickZoom.disable(this),this.setActionableState({trash:!0}),a};DirectSelect.onStop=function(){doubleClickZoom.enable(this),this.clearSelectedCoordinates()};DirectSelect.toDisplayFeatures=function(e,i,s){e.featureId===i.properties.id?(i.properties.active=activeStates.ACTIVE,s(i),createSupplementaryPoints(i,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(s)):(i.properties.active=activeStates.INACTIVE,s(i)),this.fireActionable(e)};DirectSelect.onTrash=function(e){e.selectedCoordPaths.sort((i,s)=>s.localeCompare(i,"en",{numeric:!0})).forEach(i=>e.feature.removeCoordinate(i)),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(modes$1.SIMPLE_SELECT,{}))};DirectSelect.onMouseMove=function(e,i){const s=isActiveFeature(i),a=isVertex(i),_=isMidpoint(i),et=e.selectedCoordPaths.length===0;return s&&et?this.updateUIClasses({mouse:cursors.MOVE}):a&&!et?this.updateUIClasses({mouse:cursors.MOVE}):this.updateUIClasses({mouse:cursors.NONE}),(a||s||_)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0};DirectSelect.onMouseOut=function(e){return e.dragMoving&&this.fireUpdate(),!0};DirectSelect.onTouchStart=DirectSelect.onMouseDown=function(e,i){if(isVertex(i))return this.onVertex(e,i);if(isActiveFeature(i))return this.onFeature(e,i);if(isMidpoint(i))return this.onMidpoint(e,i)};DirectSelect.onDrag=function(e,i){if(e.canDragMove!==!0)return;e.dragMoving=!0,i.originalEvent.stopPropagation();const s={lng:i.lngLat.lng-e.dragMoveLocation.lng,lat:i.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,i,s):this.dragFeature(e,i,s),e.dragMoveLocation=i.lngLat};DirectSelect.onClick=function(e,i){if(noTarget(i))return this.clickNoTarget(e,i);if(isActiveFeature(i))return this.clickActiveFeature(e,i);if(isInactiveFeature(i))return this.clickInactive(e,i);this.stopDragging(e)};DirectSelect.onTap=function(e,i){if(noTarget(i))return this.clickNoTarget(e,i);if(isActiveFeature(i))return this.clickActiveFeature(e,i);if(isInactiveFeature(i))return this.clickInactive(e,i)};DirectSelect.onTouchEnd=DirectSelect.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};const DrawPoint={};DrawPoint.onSetup=function(){const e=this.newFeature({type:geojsonTypes.FEATURE,properties:{},geometry:{type:geojsonTypes.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:cursors.ADD}),this.activateUIButton(types$1.POINT),this.setActionableState({trash:!0}),{point:e}};DrawPoint.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT)};DrawPoint.onTap=DrawPoint.onClick=function(e,i){this.updateUIClasses({mouse:cursors.MOVE}),e.point.updateCoordinate("",i.lngLat.lng,i.lngLat.lat),this.fire(events$1.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.point.id]})};DrawPoint.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})};DrawPoint.toDisplayFeatures=function(e,i,s){const a=i.properties.id===e.point.id;if(i.properties.active=a?activeStates.ACTIVE:activeStates.INACTIVE,!a)return s(i)};DrawPoint.onTrash=DrawPoint.stopDrawingAndRemove;DrawPoint.onKeyUp=function(e,i){if(isEscapeKey(i)||isEnterKey(i))return this.stopDrawingAndRemove(e,i)};function isEventAtCoordinates(e,i){return e.lngLat?e.lngLat.lng===i[0]&&e.lngLat.lat===i[1]:!1}const DrawPolygon={};DrawPolygon.onSetup=function(){const e=this.newFeature({type:geojsonTypes.FEATURE,properties:{},geometry:{type:geojsonTypes.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),doubleClickZoom.disable(this),this.updateUIClasses({mouse:cursors.ADD}),this.activateUIButton(types$1.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}};DrawPolygon.clickAnywhere=function(e,i){if(e.currentVertexPosition>0&&isEventAtCoordinates(i,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:cursors.ADD}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,i.lngLat.lng,i.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,i.lngLat.lng,i.lngLat.lat)};DrawPolygon.clickOnVertex=function(e){return this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};DrawPolygon.onMouseMove=function(e,i){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,i.lngLat.lng,i.lngLat.lat),isVertex$1(i)&&this.updateUIClasses({mouse:cursors.POINTER})};DrawPolygon.onTap=DrawPolygon.onClick=function(e,i){return isVertex$1(i)?this.clickOnVertex(e,i):this.clickAnywhere(e,i)};DrawPolygon.onKeyUp=function(e,i){isEscapeKey(i)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT)):isEnterKey(i)&&this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};DrawPolygon.onStop=function(e){this.updateUIClasses({mouse:cursors.NONE}),doubleClickZoom.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.fire(events$1.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT,{},{silent:!0})))};DrawPolygon.toDisplayFeatures=function(e,i,s){const a=i.properties.id===e.polygon.id;if(i.properties.active=a?activeStates.ACTIVE:activeStates.INACTIVE,!a)return s(i);if(i.geometry.coordinates.length===0)return;const _=i.geometry.coordinates[0].length;if(!(_<3)){if(i.properties.meta=meta.FEATURE,s(createVertex(e.polygon.id,i.geometry.coordinates[0][0],"0.0",!1)),_>3){const et=i.geometry.coordinates[0].length-3;s(createVertex(e.polygon.id,i.geometry.coordinates[0][et],`0.${et}`,!1))}if(_<=4){const et=[[i.geometry.coordinates[0][0][0],i.geometry.coordinates[0][0][1]],[i.geometry.coordinates[0][1][0],i.geometry.coordinates[0][1][1]]];if(s({type:geojsonTypes.FEATURE,properties:i.properties,geometry:{coordinates:et,type:geojsonTypes.LINE_STRING}}),_===3)return}return s(i)}};DrawPolygon.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT)};const DrawLineString={};DrawLineString.onSetup=function(e){e=e||{};const i=e.featureId;let s,a,_="forward";if(i){if(s=this.getFeature(i),!s)throw new Error("Could not find a feature with the provided featureId");let et=e.from;if(et&&et.type==="Feature"&&et.geometry&&et.geometry.type==="Point"&&(et=et.geometry),et&&et.type==="Point"&&et.coordinates&&et.coordinates.length===2&&(et=et.coordinates),!et||!Array.isArray(et))throw new Error("Please use the `from` property to indicate which point to continue the line from");const nt=s.coordinates.length-1;if(s.coordinates[nt][0]===et[0]&&s.coordinates[nt][1]===et[1])a=nt+1,s.addCoordinate(a,...s.coordinates[nt]);else if(s.coordinates[0][0]===et[0]&&s.coordinates[0][1]===et[1])_="backwards",a=0,s.addCoordinate(a,...s.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else s=this.newFeature({type:geojsonTypes.FEATURE,properties:{},geometry:{type:geojsonTypes.LINE_STRING,coordinates:[]}}),a=0,this.addFeature(s);return this.clearSelectedFeatures(),doubleClickZoom.disable(this),this.updateUIClasses({mouse:cursors.ADD}),this.activateUIButton(types$1.LINE),this.setActionableState({trash:!0}),{line:s,currentVertexPosition:a,direction:_}};DrawLineString.clickAnywhere=function(e,i){if(e.currentVertexPosition>0&&isEventAtCoordinates(i,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&isEventAtCoordinates(i,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:cursors.ADD}),e.line.updateCoordinate(e.currentVertexPosition,i.lngLat.lng,i.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,i.lngLat.lng,i.lngLat.lat)):e.line.addCoordinate(0,i.lngLat.lng,i.lngLat.lat)};DrawLineString.clickOnVertex=function(e){return this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.line.id]})};DrawLineString.onMouseMove=function(e,i){e.line.updateCoordinate(e.currentVertexPosition,i.lngLat.lng,i.lngLat.lat),isVertex$1(i)&&this.updateUIClasses({mouse:cursors.POINTER})};DrawLineString.onTap=DrawLineString.onClick=function(e,i){if(isVertex$1(i))return this.clickOnVertex(e,i);this.clickAnywhere(e,i)};DrawLineString.onKeyUp=function(e,i){isEnterKey(i)?this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.line.id]}):isEscapeKey(i)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT))};DrawLineString.onStop=function(e){doubleClickZoom.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.fire(events$1.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT,{},{silent:!0})))};DrawLineString.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT)};DrawLineString.toDisplayFeatures=function(e,i,s){const a=i.properties.id===e.line.id;if(i.properties.active=a?activeStates.ACTIVE:activeStates.INACTIVE,!a)return s(i);i.geometry.coordinates.length<2||(i.properties.meta=meta.FEATURE,s(createVertex(e.line.id,i.geometry.coordinates[e.direction==="forward"?i.geometry.coordinates.length-2:1],`${e.direction==="forward"?i.geometry.coordinates.length-2:1}`,!1)),s(i))};const modes={simple_select:SimpleSelect,direct_select:DirectSelect,draw_point:DrawPoint,draw_polygon:DrawPolygon,draw_line_string:DrawLineString},defaultOptions$1={defaultMode:modes$1.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles,modes,controls:{},userProperties:!1,suppressAPIEvents:!0},showControls={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},hideControls={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function addSources(e,i){return e.map(s=>s.source?s:Object.assign({},s,{id:`${s.id}.${i}`,source:i==="hot"?sources.HOT:sources.COLD}))}function setupOptions(e={}){let i=Object.assign({},e);return e.controls||(i.controls={}),e.displayControlsDefault===!1?i.controls=Object.assign({},hideControls,e.controls):i.controls=Object.assign({},showControls,e.controls),i=Object.assign({},defaultOptions$1,i),i.styles=addSources(i.styles,"cold").concat(addSources(i.styles,"hot")),i}var fastDeepEqual=function e(i,s){if(i===s)return!0;if(i&&s&&typeof i=="object"&&typeof s=="object"){if(i.constructor!==s.constructor)return!1;var a,_,et;if(Array.isArray(i)){if(a=i.length,a!=s.length)return!1;for(_=a;_--!==0;)if(!e(i[_],s[_]))return!1;return!0}if(i.constructor===RegExp)return i.source===s.source&&i.flags===s.flags;if(i.valueOf!==Object.prototype.valueOf)return i.valueOf()===s.valueOf();if(i.toString!==Object.prototype.toString)return i.toString()===s.toString();if(et=Object.keys(i),a=et.length,a!==Object.keys(s).length)return!1;for(_=a;_--!==0;)if(!Object.prototype.hasOwnProperty.call(s,et[_]))return!1;for(_=a;_--!==0;){var nt=et[_];if(!e(i[nt],s[nt]))return!1}return!0}return i!==i&&s!==s};const isEqual=getDefaultExportFromCjs(fastDeepEqual);var geojsonNormalize=normalize,types={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function normalize(e){if(!e||!e.type)return null;var i=types[e.type];if(!i)return null;if(i==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]};if(i==="feature")return{type:"FeatureCollection",features:[e]};if(i==="featurecollection")return e}const normalize$1=getDefaultExportFromCjs(geojsonNormalize);function stringSetsAreEqual(e,i){return e.length!==i.length?!1:JSON.stringify(e.map(s=>s).sort())===JSON.stringify(i.map(s=>s).sort())}const featureTypes={Polygon,LineString,Point:Point$1,MultiPolygon:MultiFeature,MultiLineString:MultiFeature,MultiPoint:MultiFeature};function setupAPI(e,i){i.modes=modes$1;const s=e.options.suppressAPIEvents!==void 0?!!e.options.suppressAPIEvents:!0;return i.getFeatureIdsAt=function(a){return featuresAt.click({point:a},null,e).map(et=>et.properties.id)},i.getSelectedIds=function(){return e.store.getSelectedIds()},i.getSelected=function(){return{type:geojsonTypes.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(a=>e.store.get(a)).map(a=>a.toGeoJSON())}},i.getSelectedPoints=function(){return{type:geojsonTypes.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(a=>({type:geojsonTypes.FEATURE,properties:{},geometry:{type:geojsonTypes.POINT,coordinates:a.coordinates}}))}},i.set=function(a){if(a.type===void 0||a.type!==geojsonTypes.FEATURE_COLLECTION||!Array.isArray(a.features))throw new Error("Invalid FeatureCollection");const _=e.store.createRenderBatch();let et=e.store.getAllIds().slice();const nt=i.add(a),c=new StringSet(nt);return et=et.filter(ct=>!c.has(ct)),et.length&&i.delete(et),_(),nt},i.add=function(a){const et=JSON.parse(JSON.stringify(normalize$1(a))).features.map(nt=>{if(nt.id=nt.id||generateID(),nt.geometry===null)throw new Error("Invalid geometry: null");if(e.store.get(nt.id)===void 0||e.store.get(nt.id).type!==nt.geometry.type){const c=featureTypes[nt.geometry.type];if(c===void 0)throw new Error(`Invalid geometry type: ${nt.geometry.type}.`);const ct=new c(e,nt);e.store.add(ct,{silent:s})}else{const c=e.store.get(nt.id),ct=c.properties;c.properties=nt.properties,isEqual(ct,nt.properties)||e.store.featureChanged(c.id,{silent:s}),isEqual(c.getCoordinates(),nt.geometry.coordinates)||c.incomingCoords(nt.geometry.coordinates)}return nt.id});return e.store.render(),et},i.get=function(a){const _=e.store.get(a);if(_)return _.toGeoJSON()},i.getAll=function(){return{type:geojsonTypes.FEATURE_COLLECTION,features:e.store.getAll().map(a=>a.toGeoJSON())}},i.delete=function(a){return e.store.delete(a,{silent:s}),i.getMode()===modes$1.DIRECT_SELECT&&!e.store.getSelectedIds().length?e.events.changeMode(modes$1.SIMPLE_SELECT,void 0,{silent:s}):e.store.render(),i},i.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:s}),i.getMode()===modes$1.DIRECT_SELECT?e.events.changeMode(modes$1.SIMPLE_SELECT,void 0,{silent:s}):e.store.render(),i},i.changeMode=function(a,_={}){return a===modes$1.SIMPLE_SELECT&&i.getMode()===modes$1.SIMPLE_SELECT?(stringSetsAreEqual(_.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(_.featureIds,{silent:s}),e.store.render()),i):(a===modes$1.DIRECT_SELECT&&i.getMode()===modes$1.DIRECT_SELECT&&_.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(a,_,{silent:s}),i)},i.getMode=function(){return e.events.getMode()},i.trash=function(){return e.events.trash({silent:s}),i},i.combineFeatures=function(){return e.events.combineFeatures({silent:s}),i},i.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:s}),i},i.setFeatureProperty=function(a,_,et){return e.store.setFeatureProperty(a,_,et,{silent:s}),i},i}const lib=Object.freeze(Object.defineProperty({__proto__:null,CommonSelectors:common_selectors,ModeHandler,StringSet,constrainFeatureMovement,createMidPoint:createMidpoint,createSupplementaryPoints,createVertex,doubleClickZoom,euclideanDistance,featuresAt,getFeatureAtAndSetCursors,isClick,isEventAtCoordinates,isTap,mapEventToBoundingBox,moveFeatures,sortFeatures,stringSetsAreEqual,theme:styles,toDenseArray},Symbol.toStringTag,{value:"Module"})),setupDraw=function(e,i){e=setupOptions(e);const s={options:e};i=setupAPI(s,i),s.api=i;const a=runSetup(s);return i.onAdd=a.onAdd,i.onRemove=a.onRemove,i.types=types$1,i.options=e,i};function MapboxDraw(e){setupDraw(e,this)}MapboxDraw.modes=modes;MapboxDraw.constants=Constants;MapboxDraw.lib=lib;function ZoneDrawer({onZoneChange:e,initialZone:i,height:s="400px",showCurrentLocation:a=!0}){const _=reactExports.useRef(null),et=reactExports.useRef(null),nt=reactExports.useRef(null),c=reactExports.useRef(null),[ct,dt]=reactExports.useState(!0),[gt,Tt]=reactExports.useState(!!i),[Et,At]=reactExports.useState(null),[Mt,Pt]=reactExports.useState(!1),$t=()=>{navigator.geolocation&&(Pt(!0),navigator.geolocation.getCurrentPosition(Bt=>{var Xt;const{latitude:Nt,longitude:Vt}=Bt.coords;if(At({lat:Nt,lng:Vt}),c.current)c.current.setLngLat([Vt,Nt]);else if(et.current){const nr=document.createElement("div");nr.className="current-location-marker",nr.innerHTML=`
            <div style="
              width: 20px;
              height: 20px;
              background: hsl(24, 95%, 53%);
              border: 3px solid white;
              border-radius: 50%;
              box-shadow: 0 2px 8px rgba(0,0,0,0.3);
              position: relative;
            ">
              <div style="
                position: absolute;
                width: 40px;
                height: 40px;
                background: hsla(24, 95%, 53%, 0.2);
                border-radius: 50%;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                animation: pulse 2s infinite;
              "></div>
            </div>
          `,c.current=new mapboxgl.Marker(nr).setLngLat([Vt,Nt]).setPopup(new mapboxgl.Popup({offset:25}).setText("Your current location")).addTo(et.current)}(Xt=et.current)==null||Xt.flyTo({center:[Vt,Nt],zoom:13,duration:1500}),Pt(!1)},Bt=>{console.error("Location error:",Bt),Pt(!1)},{enableHighAccuracy:!0,timeout:1e4}))};reactExports.useEffect(()=>{if(!_.current)return;mapboxgl.accessToken=MAPBOX_ACCESS_TOKEN,et.current=new mapboxgl.Map({container:_.current,style:"mapbox://styles/mapbox/streets-v12",center:[78.4867,17.385],zoom:10,attributionControl:!1}),nt.current=new MapboxDraw({displayControlsDefault:!1,controls:{polygon:!0,trash:!0},defaultMode:"simple_select",styles:[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#f97316","fill-outline-color":"#f97316","fill-opacity":.2}},{id:"gl-draw-polygon-stroke",type:"line",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#f97316","line-width":3}},{id:"gl-draw-polygon-and-line-vertex-halo-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#f97316"}}]}),et.current.addControl(nt.current,"top-left"),et.current.addControl(new mapboxgl.NavigationControl,"bottom-right"),et.current.on("load",()=>{var Nt;if(dt(!1),i&&nt.current){const Vt={type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:i.coordinates}};nt.current.add(Vt),Tt(!0);const Xt=i.coordinates[0],nr=new mapboxgl.LngLatBounds;Xt.forEach(ar=>nr.extend([ar[0],ar[1]])),(Nt=et.current)==null||Nt.fitBounds(nr,{padding:50})}}),et.current.on("draw.create",Bt),et.current.on("draw.update",Bt),et.current.on("draw.delete",()=>{Tt(!1),e(null)});function Bt(){if(!nt.current)return;const Nt=nt.current.getAll();if(Nt.features.length>0){const Vt=Nt.features.filter(ar=>ar.geometry.type==="Polygon");if(Vt.length>1)for(let ar=0;ar<Vt.length-1;ar++)nt.current.delete(Vt[ar].id);const Xt=Vt[Vt.length-1],nr=geoJSONToZonePolygon(Xt);Tt(!!nr),e(nr)}else Tt(!1),e(null)}return a&&$t(),()=>{var Nt,Vt;(Nt=c.current)==null||Nt.remove(),(Vt=et.current)==null||Vt.remove()}},[]);const Lt=()=>{nt.current&&(nt.current.deleteAll(),Tt(!1),e(null))};return jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx("style",{children:`
        @keyframes pulse {
          0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
          100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
        }
      `}),jsxRuntimeExports.jsxs("div",{className:"relative rounded-xl overflow-hidden",style:{height:s},children:[jsxRuntimeExports.jsx("div",{ref:_,className:"absolute inset-0"}),ct&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-6 h-6 animate-spin text-primary"})}),a&&jsxRuntimeExports.jsx(Button,{size:"sm",variant:"secondary",className:"absolute bottom-3 left-3 shadow-lg",onClick:$t,disabled:Mt,children:Mt?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Navigation,{className:"w-4 h-4 mr-1"}),"My Location"]})}),jsxRuntimeExports.jsx("div",{className:"absolute top-3 right-3 bg-card/90 backdrop-blur-sm rounded-lg px-3 py-2 max-w-[200px]",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:gt?"Zone drawn! Click on the zone to edit or delete.":"Click the polygon tool (top-left) to draw a service zone."})}),Et&&jsxRuntimeExports.jsx("div",{className:"absolute top-3 left-14 bg-card/90 backdrop-blur-sm rounded-lg px-3 py-2",children:jsxRuntimeExports.jsxs("p",{className:"text-xs text-primary font-medium flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"w-2 h-2 bg-primary rounded-full animate-pulse"}),"Live Location"]})})]}),gt&&jsxRuntimeExports.jsxs(Button,{variant:"outline",className:"w-full text-destructive border-destructive",onClick:Lt,children:[jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4 mr-2"})," Clear Zone"]})]})}const ALL_ROLES=[{value:"user",label:"User"},{value:"amma",label:"Amma"},{value:"admin",label:"Admin"},{value:"franchise_admin",label:"Franchise Admin"},{value:"super_admin",label:"Super Admin"}];function SuperAdminDashboard(){const{user:e,signOut:i}=useAuth(),s=useNavigate(),{isAuthorized:a,isLoading:_}=useRoleRedirect(["super_admin","admin"]),{franchises:et,loading:nt}=useFranchises(),{users:c,refetch:ct}=useAllUsersForAdmin(),{kitchens:dt}=useAllKitchens(),[gt,Tt]=reactExports.useState("franchises"),[Et,At]=reactExports.useState(!1),Mt=async()=>{if(confirm('CRITICAL WARNING: This will delete ALL users, franchises, kitchens, dishes, and orders. Only the Super Admin account will remain. This action cannot be undone. Type "DELETE" to confirm.')&&prompt('Type "DELETE" to confirm database reset:')==="DELETE"){At(!0);try{await clearAllDataExceptSuperAdmin(),ue.success("Database has been reset successfully"),ct(),window.location.reload()}catch{ue.error("Failed to reset database")}finally{At(!1)}}},[Pt,$t]=reactExports.useState(!1),[Lt,Bt]=reactExports.useState(!1),[Nt,Vt]=reactExports.useState(!1),[Xt,nr]=reactExports.useState(null),[ar,mr]=reactExports.useState("user"),[Fr,sn]=reactExports.useState(!1),[fn,Lr]=reactExports.useState(!1),[Qr,dn]=reactExports.useState(!1),[en,yr]=reactExports.useState({name:"",description:"",adminId:"",zone:null}),[Ar,rr]=reactExports.useState({email:"",password:"",name:"",phone:""}),ur=c.filter(Mn=>Mn.role==="user"||Mn.role==="admin"||Mn.role==="franchise_admin"),Br=dt.filter(Mn=>!Mn.isApproved),xr=async()=>{if(!Ar.email||!Ar.password||!Ar.name||!Ar.phone){ue.error("Please fill all fields");return}if(Ar.password.length<6){ue.error("Password must be at least 6 characters");return}Lr(!0);try{await createFranchiseAdmin(Ar.email,Ar.password,Ar.name,Ar.phone),ue.success("Franchise Admin created successfully!"),Bt(!1),rr({email:"",password:"",name:"",phone:""}),ct()}catch(Mn){ue.error(Mn.message||"Failed to create admin")}finally{Lr(!1)}},qr=async Mn=>{try{await approveKitchen(Mn),ue.success("Kitchen approved!")}catch{ue.error("Failed to approve kitchen")}},tn=async Mn=>{if(confirm("Are you sure you want to reject this kitchen?"))try{await rejectKitchen(Mn),ue.success("Kitchen rejected")}catch{ue.error("Failed to reject kitchen")}},vn=async()=>{if(!Xt)return;if(Xt.currentRole==="amma"&&ar!=="amma"||Xt.currentRole==="franchise_admin"&&ar!=="franchise_admin"){const ds=Xt.currentRole==="amma"?"kitchens and dishes":"franchise assignment";if(!confirm(`Warning: Changing this role will delete all ${ds} for this user. Continue?`))return}dn(!0);try{await updateUserRole(Xt.id,ar,Xt.currentRole),ue.success(`Role updated to ${ar.replace("_"," ")}`),Vt(!1),nr(null),ct()}catch{ue.error("Failed to update role")}finally{dn(!1)}},hs=(Mn,ds,gs)=>{nr({id:Mn,name:ds,currentRole:gs}),mr(gs),Vt(!0)},Ts=async()=>{if(!e)return;if(!en.name||!en.adminId||!en.zone){ue.error("Please fill all fields and draw a zone");return}const Mn=c.find(ds=>ds.id===en.adminId);if(!Mn){ue.error("Invalid admin selected");return}sn(!0);try{await createFranchise({name:en.name,description:en.description,adminId:en.adminId,adminName:Mn.name,adminEmail:Mn.email,zone:en.zone,isActive:!0,createdAt:Date.now(),createdBy:e.id}),ue.success("Franchise created successfully!"),$t(!1),yr({name:"",description:"",adminId:"",zone:null})}catch{ue.error("Failed to create franchise")}finally{sn(!1)}},ss=async(Mn,ds)=>{if(confirm("Are you sure you want to delete this franchise?"))try{await deleteFranchise(Mn,ds),ue.success("Franchise deleted")}catch{ue.error("Failed to delete franchise")}};return _||!a?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Super Admin"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Franchise Management"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[Br.length>0&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-gold text-foreground text-xs",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-3 h-3"}),Br.length," pending"]}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",onClick:async()=>{await i(),s("/auth")},className:"text-destructive",children:"Logout"})]})]}),jsxRuntimeExports.jsx("div",{className:"flex bg-secondary mx-4 rounded-xl p-1 mb-4",children:["franchises","users","kitchens","system"].map(Mn=>jsxRuntimeExports.jsx("button",{onClick:()=>Tt(Mn),className:`flex-1 py-2 rounded-lg text-sm font-medium transition-all capitalize ${gt===Mn?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:Mn},Mn))})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[gt==="franchises"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-foreground",children:["Franchises (",et.length,")"]}),jsxRuntimeExports.jsxs(Dialog,{open:Pt,onOpenChange:$t,children:[jsxRuntimeExports.jsx(DialogTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{size:"sm",className:"gradient-primary text-primary-foreground",children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4 mr-1"})," Add Franchise"]})}),jsxRuntimeExports.jsxs(DialogContent,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(DialogTitle,{children:"Create New Franchise"})}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 mt-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Franchise Name"}),jsxRuntimeExports.jsx(Input,{placeholder:"e.g., Hyderabad Central",value:en.name,onChange:Mn=>yr({...en,name:Mn.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Description"}),jsxRuntimeExports.jsx(Textarea,{placeholder:"Brief description of this franchise area...",value:en.description,onChange:Mn=>yr({...en,description:Mn.target.value}),className:"bg-secondary border-0 mt-1 resize-none",rows:2})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Assign Franchise Admin"}),jsxRuntimeExports.jsxs(Select,{value:en.adminId,onValueChange:Mn=>yr({...en,adminId:Mn}),children:[jsxRuntimeExports.jsx(SelectTrigger,{className:"bg-secondary border-0 mt-1",children:jsxRuntimeExports.jsx(SelectValue,{placeholder:"Select a user to assign as admin"})}),jsxRuntimeExports.jsx(SelectContent,{children:ur.map(Mn=>jsxRuntimeExports.jsxs(SelectItem,{value:Mn.id,children:[Mn.name," (",Mn.email,")"]},Mn.id))})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Draw Service Zone"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Draw a polygon on the map to define the service area"}),jsxRuntimeExports.jsx(ZoneDrawer,{onZoneChange:Mn=>yr({...en,zone:Mn}),height:"300px"})]}),jsxRuntimeExports.jsx(Button,{onClick:Ts,disabled:Fr,className:"w-full gradient-primary text-primary-foreground",children:Fr?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin"}):"Create Franchise"})]})]})]})]}),nt?jsxRuntimeExports.jsx("div",{className:"flex justify-center py-8",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):et.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Store$1,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No franchises yet"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Create your first franchise to get started"})]}):et.map(Mn=>jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:Mn.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:Mn.description})]}),jsxRuntimeExports.jsx("span",{className:cn("px-2 py-1 rounded-full text-xs font-medium",Mn.isActive?"bg-veg/20 text-veg":"bg-muted text-muted-foreground"),children:Mn.isActive?"Active":"Inactive"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx(Users,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:Mn.adminName})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx(Store$1,{className:"w-4 h-4"}),jsxRuntimeExports.jsxs("span",{children:[dt.filter(ds=>ds.franchiseId===Mn.id).length," kitchens"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",onClick:()=>s(`/super-admin/franchise/${Mn.id}`),children:[jsxRuntimeExports.jsx(Eye,{className:"w-4 h-4 mr-1"})," View"]}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",className:"text-destructive border-destructive",onClick:()=>ss(Mn.id,Mn.adminId),children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]})]},Mn.id))]}),gt==="users"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-foreground",children:["All Users (",c.length,")"]}),jsxRuntimeExports.jsxs(Dialog,{open:Lt,onOpenChange:Bt,children:[jsxRuntimeExports.jsx(DialogTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{size:"sm",className:"gradient-primary text-primary-foreground",children:[jsxRuntimeExports.jsx(UserPlus,{className:"w-4 h-4 mr-1"})," Create Admin"]})}),jsxRuntimeExports.jsxs(DialogContent,{className:"max-w-md",children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(DialogTitle,{children:"Create Franchise Admin"})}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 mt-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Name"}),jsxRuntimeExports.jsx(Input,{placeholder:"Admin Name",value:Ar.name,onChange:Mn=>rr({...Ar,name:Mn.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Email"}),jsxRuntimeExports.jsx(Input,{type:"email",placeholder:"admin@example.com",value:Ar.email,onChange:Mn=>rr({...Ar,email:Mn.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Phone"}),jsxRuntimeExports.jsx(Input,{placeholder:"9876543210",value:Ar.phone,onChange:Mn=>rr({...Ar,phone:Mn.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Password"}),jsxRuntimeExports.jsx(Input,{type:"password",placeholder:"Min 6 characters",value:Ar.password,onChange:Mn=>rr({...Ar,password:Mn.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsx(Button,{onClick:xr,disabled:fn,className:"w-full gradient-primary text-primary-foreground",children:fn?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin"}):"Create Franchise Admin"})]})]})]})]}),c.map(Mn=>jsxRuntimeExports.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:Mn.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:Mn.email})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:cn("px-2 py-1 rounded-full text-xs font-medium capitalize",Mn.role==="super_admin"&&"bg-primary/20 text-primary",Mn.role==="franchise_admin"&&"bg-accent/20 text-accent-foreground",Mn.role==="amma"&&"bg-veg/20 text-veg",Mn.role==="admin"&&"bg-gold/20 text-gold",Mn.role==="user"&&"bg-secondary text-secondary-foreground"),children:Mn.role.replace("_"," ")}),Mn.id!==(e==null?void 0:e.id)&&jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",onClick:()=>hs(Mn.id,Mn.name,Mn.role),children:jsxRuntimeExports.jsx(SquarePen,{className:"w-3 h-3"})})]})]})},Mn.id)),jsxRuntimeExports.jsx(Dialog,{open:Nt,onOpenChange:Vt,children:jsxRuntimeExports.jsxs(DialogContent,{className:"max-w-sm",children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(DialogTitle,{children:"Change User Role"})}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 mt-4",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground",children:["Change role for ",jsxRuntimeExports.jsx("span",{className:"font-medium text-foreground",children:Xt==null?void 0:Xt.name})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"New Role"}),jsxRuntimeExports.jsxs(Select,{value:ar,onValueChange:Mn=>mr(Mn),children:[jsxRuntimeExports.jsx(SelectTrigger,{className:"bg-secondary border-0 mt-1",children:jsxRuntimeExports.jsx(SelectValue,{})}),jsxRuntimeExports.jsx(SelectContent,{children:ALL_ROLES.map(Mn=>jsxRuntimeExports.jsx(SelectItem,{value:Mn.value,children:Mn.label},Mn.value))})]})]}),jsxRuntimeExports.jsx(Button,{onClick:vn,disabled:Qr||ar===(Xt==null?void 0:Xt.currentRole),className:"w-full gradient-primary text-primary-foreground",children:Qr?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin"}):"Update Role"})]})]})})]}),gt==="kitchens"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-foreground",children:["All Kitchens (",dt.length,")"]}),Br.length>0&&jsxRuntimeExports.jsxs("div",{className:"bg-gold/10 rounded-2xl p-4 mb-4",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-foreground mb-3 flex items-center gap-2",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-4 h-4 text-gold"}),"Pending Approvals (",Br.length,")"]}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:Br.map(Mn=>{var ds;return jsxRuntimeExports.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("img",{src:Mn.image,alt:Mn.name,className:"w-16 h-16 rounded-lg object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:Mn.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:Mn.address.city}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:(ds=Mn.specialties)==null?void 0:ds.join(", ")})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-1",children:[jsxRuntimeExports.jsx(Button,{size:"sm",className:"bg-veg text-primary-foreground",onClick:()=>qr(Mn.id),children:jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(Button,{size:"sm",variant:"outline",className:"text-destructive border-destructive",onClick:()=>tn(Mn.id),children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]})]})},Mn.id)})})]}),dt.filter(Mn=>Mn.isApproved).map(Mn=>{const ds=et.find(gs=>gs.id===Mn.franchiseId);return jsxRuntimeExports.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("img",{src:Mn.image,alt:Mn.name,className:"w-16 h-16 rounded-lg object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:Mn.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:Mn.address.city}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs bg-veg/20 text-veg",children:"Approved"}),ds&&jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs bg-primary/20 text-primary",children:ds.name})]})]})]})},Mn.id)})]}),gt==="system"&&jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"System Management"}),jsxRuntimeExports.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-2xl p-6",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-destructive flex items-center gap-2 mb-4",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-5 h-5"}),"Danger Zone"]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-medium text-foreground",children:"Reset Database"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"This will permanently delete all data including users, franchises, kitchens, dishes, and orders. Only the Super Admin account will be preserved."})]}),jsxRuntimeExports.jsx(Button,{variant:"destructive",onClick:Mt,disabled:Et,className:"w-full sm:w-auto",children:Et?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 mr-2 animate-spin"}),"Resetting..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4 mr-2"}),"Reset Database (Keep Super Admin)"]})})]})]})]})]})]})}function PendingApproval({kitchenName:e}){const{signOut:i}=useAuth(),s=useNavigate();return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Kitchen Status"}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:async()=>{await i(),s("/auth")},className:"text-destructive",children:jsxRuntimeExports.jsx(LogOut,{className:"w-5 h-5"})})]})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-6 py-12",children:[jsxRuntimeExports.jsx(motion.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:20},className:"w-24 h-24 rounded-full bg-gold/20 flex items-center justify-center mb-6",children:jsxRuntimeExports.jsx(Clock,{className:"w-12 h-12 text-gold"})}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-center max-w-sm",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Pending Approval"}),jsxRuntimeExports.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card mb-6",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:jsxRuntimeExports.jsx(ChefHat,{className:"w-6 h-6 text-primary"})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"font-semibold text-foreground",children:e}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Your Kitchen"})]})]})}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-6",children:"Your kitchen registration is under review by the franchise admin. You'll be automatically redirected once approved."}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground bg-secondary rounded-lg p-3",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-gold animate-pulse"}),jsxRuntimeExports.jsx("span",{children:"Waiting for franchise admin approval..."})]})})]}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"mt-8",children:jsxRuntimeExports.jsxs(Button,{variant:"outline",onClick:()=>s("/"),className:"gap-2",children:[jsxRuntimeExports.jsx(House,{className:"w-4 h-4"}),"Browse as Customer"]})})]})]})}function AmmaRouteWrapper({children:e}){const{user:i,loading:s}=useAuth(),{kitchens:a,loading:_}=useAmmaKitchens(i==null?void 0:i.id);if(s)return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})});if(!i)return jsxRuntimeExports.jsx(Navigate,{to:"/auth",replace:!0});if(_)return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})});if(a.length>0){const et=a[0];if(!et.isApproved)return jsxRuntimeExports.jsx(PendingApproval,{kitchenName:et.name})}return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:e})}function LocationSelectionPage(){const e=useNavigate(),{userLocation:i,setUserLocation:s}=useLocationContext(),{user:a,updateUserLocation:_}=useAuth(),[et,nt]=reactExports.useState(null),[c,ct]=reactExports.useState(!1),[dt,gt]=reactExports.useState("home"),Tt=At=>{nt(At)},Et=async()=>{if(!(!et||!et.franchiseId)){if(ct(!0),s({lat:et.lat,lng:et.lng,address:et.address}),a)try{await _(et.lat,et.lng,et.address,dt)}catch(At){console.error("Failed to update user profile location:",At)}await new Promise(At=>setTimeout(At,500)),ct(!1),e(-1)}};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center gap-3 bg-card sticky top-0 z-10",children:[jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:()=>e(-1),children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-lg",children:"Select Location"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Deliver to"})]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 relative",children:jsxRuntimeExports.jsx(FranchiseZoneLocationPicker,{onLocationSelect:Tt,initialLocation:i?{lat:i.lat,lng:i.lng}:void 0,label:"Delivery Location",instructions:"Drag pin to your exact delivery location",fullScreen:!0,showZoomControls:!1})}),jsxRuntimeExports.jsx("div",{className:"p-4 bg-card border-t border-border sticky bottom-0 z-10",children:jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium mb-3",children:"Save as"}),jsxRuntimeExports.jsx("div",{className:"flex gap-3",children:["home","work","other"].map(At=>jsxRuntimeExports.jsxs("button",{onClick:()=>gt(At),className:`flex items-center gap-2 px-4 py-2 rounded-full border transition-all ${dt===At?"bg-primary text-primary-foreground border-primary":"bg-background border-border text-muted-foreground hover:border-primary/50"}`,children:[At==="home"&&jsxRuntimeExports.jsx(House,{className:"w-4 h-4"}),At==="work"&&jsxRuntimeExports.jsx(Briefcase,{className:"w-4 h-4"}),At==="other"&&jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{className:"capitalize",children:At})]},At))})]}),jsxRuntimeExports.jsx(Button,{className:"w-full font-semibold py-6 text-base",size:"lg",onClick:Et,disabled:!et||!et.franchiseId||c,children:c?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"mr-2 h-5 w-5 animate-spin"}),"Confirming..."]}):"Confirm Location"}),et&&!et.franchiseId&&jsxRuntimeExports.jsx("p",{className:"text-center text-destructive text-sm mt-2",children:"Location outside service area"})]})})]})}const NotFound=()=>{const e=useLocation();return reactExports.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),jsxRuntimeExports.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),jsxRuntimeExports.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),jsxRuntimeExports.jsx(Link,{to:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})},v="5.1.7",fr=30,ip=25,op=69,w=600,h=600,nm="success",ddd=0,assets=[{id:"comp_0",layers:[{ddd:0,ind:1,ty:4,nm:"Layer 4 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[115.68,468.673,0],ix:2},a:{a:0,k:[26.859,26.86,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[-20.859,20.86],[20.859,-20.86]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[26.859,26.86],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:0,k:0,ix:1},e:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[100],e:[0]},{t:22}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:2,ty:4,nm:"Layer 5 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[467.82,115.827,0],ix:2},a:{a:0,k:[26.86,26.859,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[-20.86,20.859],[20.86,-20.859]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[26.86,26.859],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[0],e:[100]},{t:22}],ix:1},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:3,ty:4,nm:"Layer 6 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[115.327,116.18,0],ix:2},a:{a:0,k:[26.859,26.859,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[-20.859,-20.86],[20.859,20.86]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[26.859,26.86],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:0,k:0,ix:1},e:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[100],e:[0]},{t:22}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:4,ty:4,nm:"Layer 7 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[468.174,468.32,0],ix:2},a:{a:0,k:[26.86,26.86,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[-20.86,-20.86],[20.86,20.86]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[26.86,26.86],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[0],e:[100]},{t:22}],ix:1},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:5,ty:4,nm:"Layer 8 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[42.5,292.5,0],ix:2},a:{a:0,k:[35.5,6,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[6,6],[65,6]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:0,k:0,ix:1},e:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[100],e:[0]},{t:22}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:6,ty:4,nm:"Layer 9 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[541,292,0],ix:2},a:{a:0,k:[35.5,6,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[6,6],[65,6]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[0],e:[100]},{t:22}],ix:1},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:7,ty:4,nm:"Layer 10 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[292,541.5,0],ix:2},a:{a:0,k:[6,35.5,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[6,65],[6,6]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:0,k:0,ix:1},e:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[100],e:[0]},{t:22}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:8,ty:4,nm:"Layer 11 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[291.5,43,0],ix:2},a:{a:0,k:[6,35.5,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[6,65],[6,6]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[0],e:[100]},{t:22}],ix:1},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0}]}],layers=[{ddd:0,ind:1,ty:4,nm:"Shape Layer 2",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[300,300,0],ix:2},a:{a:0,k:[0,0,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[367.859,367.859],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:25,s:[0],e:[0]},{i:{x:[.089],y:[1]},o:{x:[.655],y:[0]},n:["0p089_1_0p655_0"],t:36,s:[0],e:[100]},{t:50}],ix:1},e:{a:1,k:[{i:{x:[.333],y:[1]},o:{x:[.829],y:[0]},n:["0p333_1_0p829_0"],t:25,s:[0],e:[100]},{t:39}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1},{ty:"st",c:{a:0,k:[.893382352941,.893382352941,.893382352941,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:20,ix:5},lc:1,lj:1,ml:4,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[1.93,-10.07],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Ellipse 1",np:4,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:25,op:50,st:25,bm:0},{ddd:0,ind:2,ty:4,nm:"Shape Layer 1",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[300,300,0],ix:2},a:{a:0,k:[0,0,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[367.859,367.859],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:0,s:[0],e:[0]},{i:{x:[.089],y:[1]},o:{x:[.655],y:[0]},n:["0p089_1_0p655_0"],t:11,s:[0],e:[100]},{t:25}],ix:1},e:{a:1,k:[{i:{x:[.333],y:[1]},o:{x:[.829],y:[0]},n:["0p333_1_0p829_0"],t:0,s:[0],e:[100]},{t:14}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1},{ty:"st",c:{a:0,k:[.893382352941,.893382352941,.893382352941,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:20,ix:5},lc:1,lj:1,ml:4,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[1.93,-10.07],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Ellipse 1",np:4,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:25,st:0,bm:0},{ddd:0,ind:3,ty:0,nm:"Pre-comp 1",refId:"comp_0",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]},n:["0p833_0p833_0p167_0p167"],t:54,s:[0],e:[100]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]},n:["0p833_0p833_0p167_0p167"],t:56,s:[100],e:[100]},{t:62}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[300,300,0],ix:2},a:{a:0,k:[300,300,0],ix:1},s:{a:1,k:[{i:{x:[.833,.833,.833],y:[.833,.833,.833]},o:{x:[.167,.167,.167],y:[.167,.167,.167]},n:["0p833_0p833_0p167_0p167","0p833_0p833_0p167_0p167","0p833_0p833_0p167_0p167"],t:54,s:[86,86,100],e:[94,94,100]},{t:62}],ix:6}},ao:0,w:600,h:600,ip:54,op:354,st:54,bm:0},{ddd:0,ind:4,ty:4,nm:"Layer 2 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[300,300,0],ix:2},a:{a:0,k:[137.378,109.309,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0]],v:[[-84.878,.669],[-28.738,56.809],[84.878,-56.809]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:21,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[137.378,109.308],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[.185],y:[1]},o:{x:[.333],y:[0]},n:["0p185_1_0p333_0"],t:59,s:[0],e:[6]},{i:{x:[.306],y:[1]},o:{x:[.333],y:[0]},n:["0p306_1_0p333_0"],t:62,s:[6],e:[0]},{t:66}],ix:1},e:{a:1,k:[{i:{x:[.35],y:[1]},o:{x:[.333],y:[0]},n:["0p35_1_0p333_0"],t:54,s:[0],e:[100]},{i:{x:[.032],y:[1]},o:{x:[.333],y:[0]},n:["0p032_1_0p333_0"],t:62,s:[100],e:[94]},{t:66}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:54,op:354,st:54,bm:0},{ddd:0,ind:5,ty:4,nm:"Layer 1 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[299.988,299.91,0],ix:2},a:{a:0,k:[190.878,189.014,0],ix:1},s:{a:1,k:[{i:{x:[.046,.046,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},n:["0p046_1_0p333_0","0p046_1_0p333_0","0p667_1_0p333_0"],t:50,s:[0,0,100],e:[116,116,100]},{i:{x:[.019,.019,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[.032,.032,0]},n:["0p019_1_0p333_0p032","0p019_1_0p333_0p032","0p667_1_0p333_0"],t:61,s:[116,116,100],e:[100,100,100]},{t:67}],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-4.067,-3.573],[0,0],[-2.665,-.588],[0,0],[-1.937,-5.043],[0,0],[-2.087,-1.753],[0,0],[.635,-5.357],[0,0],[-1.033,-2.517],[0,0],[3.063,-4.444],[0,0],[.259,-2.704],[0,0],[4.789,-2.513],[0,0],[1.492,-2.273],[0,0],[5.418,-.007],[0,0],[2.383,-1.32],[0,0],[4.806,2.501],[0,0],[2.727,-.064],[0,0],[3.093,4.437],[0,0],[2.448,1.205],[0,0],[.67,5.356],[0,0],[1.607,2.198],[0,0],[-1.904,5.047],[0,0],[.399,2.689],[0,0],[-4.043,3.583],[0,0],[-.901,2.564],[0,0],[-5.257,1.298],[0,0],[-1.995,1.85],[0,0],[-5.265,-1.284],[0,0],[-2.632,.713],[0,0]],o:[[0,0],[2.049,1.8],[0,0],[5.292,1.166],[0,0],[.976,2.539],[0,0],[4.146,3.481],[0,0],[-.32,2.698],[0,0],[2.05,4.998],[0,0],[-1.542,2.239],[0,0],[-.514,5.372],[0,0],[-2.412,1.266],[0,0],[-2.961,4.512],[0,0],[-2.728,.003],[0,0],[-4.73,2.62],[0,0],[-2.42,-1.26],[0,0],[-5.416,.129],[0,0],[-1.557,-2.233],[0,0],[-4.861,-2.393],[0,0],[-.338,-2.697],[0,0],[-3.192,-4.367],[0,0],[.959,-2.542],[0,0],[-.792,-5.339],[0,0],[2.036,-1.805],[0,0],[1.789,-5.09],[0,0],[2.647,-.653],[0,0],[3.961,-3.674],[0,0],[2.651,.646],[0,0],[5.226,-1.416]],v:[[49.728,-183.893],[75.948,-160.861],[83.134,-157.221],[117.251,-149.704],[128.834,-139.758],[141.329,-107.249],[146,-100.704],[172.734,-78.264],[178.36,-64.104],[174.265,-29.568],[175.352,-21.617],[188.578,10.606],[186.957,25.734],[167.211,54.389],[164.465,61.924],[161.152,96.546],[152.657,109.178],[121.785,125.385],[115.833,130.78],[96.742,159.871],[83.317,167.112],[48.39,167.159],[40.598,169.176],[10.101,186.072],[-5.177,186.263],[-36.157,170.138],[-44.005,168.317],[-78.921,169.146],[-92.553,162.244],[-112.489,133.642],[-118.596,128.399],[-149.931,112.972],[-158.793,100.558],[-163.119,66.033],[-166.084,58.567],[-186.661,30.418],[-188.724,15.336],[-176.447,-17.206],[-175.593,-25.182],[-180.697,-59.604],[-175.488,-73.898],[-149.422,-97.001],[-144.943,-103.66],[-133.405,-136.47],[-122.117,-146.703],[-88.233,-155.074],[-81.156,-158.891],[-55.62,-182.572],[-40.839,-186.4],[-6.899,-178.12],[1.156,-178.22],[34.84,-187.349]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:4},o:{a:0,k:100,ix:5},r:1,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[190.878,189.015],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:50,op:350,st:50,bm:0}],markers=[],successAnimation={v,fr,ip,op,w,h,nm,ddd,assets,layers,markers};function OrderSuccessPage(){const e=useNavigate(),i=reactExports.useRef(null);return reactExports.useEffect(()=>{i.current&&i.current.setSpeed(.8)},[]),jsxRuntimeExports.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-green-50 to-white px-4",children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},className:"w-full max-w-md flex flex-col items-center text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-64 h-64",children:jsxRuntimeExports.jsx(Lottie,{lottieRef:i,animationData:successAnimation,loop:!1})}),jsxRuntimeExports.jsx(motion.h1,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"text-2xl font-bold text-foreground mt-4 mb-2",children:"Order Placed!"}),jsxRuntimeExports.jsx(motion.p,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},className:"text-muted-foreground mb-8",children:"Your order has been placed successfully and sent to the kitchen."}),jsxRuntimeExports.jsxs(motion.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},className:"w-full space-y-3",children:[jsxRuntimeExports.jsx(Button,{onClick:()=>e("/orders"),className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl font-semibold shadow-elevated",children:"View Order Status"}),jsxRuntimeExports.jsx(Button,{variant:"ghost",onClick:()=>e("/"),className:"w-full",children:"Back to Home"})]})]})})}function toDate(e){const i=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&i==="[object Date]"?new e.constructor(+e):typeof e=="number"||i==="[object Number]"||typeof e=="string"||i==="[object String]"?new Date(e):new Date(NaN)}function constructFrom(e,i){return e instanceof Date?new e.constructor(i):new Date(i)}const minutesInMonth=43200,minutesInDay=1440;let defaultOptions={};function getDefaultOptions(){return defaultOptions}function getTimezoneOffsetInMilliseconds(e){const i=toDate(e),s=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()));return s.setUTCFullYear(i.getFullYear()),+e-+s}function compareAsc(e,i){const s=toDate(e),a=toDate(i),_=s.getTime()-a.getTime();return _<0?-1:_>0?1:_}function constructNow(e){return constructFrom(e,Date.now())}function differenceInCalendarMonths(e,i){const s=toDate(e),a=toDate(i),_=s.getFullYear()-a.getFullYear(),et=s.getMonth()-a.getMonth();return _*12+et}function getRoundingMethod(e){return i=>{const a=(e?Math[e]:Math.trunc)(i);return a===0?0:a}}function differenceInMilliseconds(e,i){return+toDate(e)-+toDate(i)}function endOfDay(e){const i=toDate(e);return i.setHours(23,59,59,999),i}function endOfMonth(e){const i=toDate(e),s=i.getMonth();return i.setFullYear(i.getFullYear(),s+1,0),i.setHours(23,59,59,999),i}function isLastDayOfMonth(e){const i=toDate(e);return+endOfDay(i)==+endOfMonth(i)}function differenceInMonths(e,i){const s=toDate(e),a=toDate(i),_=compareAsc(s,a),et=Math.abs(differenceInCalendarMonths(s,a));let nt;if(et<1)nt=0;else{s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-_*et);let c=compareAsc(s,a)===-_;isLastDayOfMonth(toDate(e))&&et===1&&compareAsc(e,a)===1&&(c=!1),nt=_*(et-Number(c))}return nt===0?0:nt}function differenceInSeconds(e,i,s){const a=differenceInMilliseconds(e,i)/1e3;return getRoundingMethod(s==null?void 0:s.roundingMethod)(a)}const formatDistanceLocale={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},formatDistance$1=(e,i,s)=>{let a;const _=formatDistanceLocale[e];return typeof _=="string"?a=_:i===1?a=_.one:a=_.other.replace("{{count}}",i.toString()),s!=null&&s.addSuffix?s.comparison&&s.comparison>0?"in "+a:a+" ago":a};function buildFormatLongFn(e){return(i={})=>{const s=i.width?String(i.width):e.defaultWidth;return e.formats[s]||e.formats[e.defaultWidth]}}const dateFormats={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},timeFormats={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},dateTimeFormats={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},formatLong={date:buildFormatLongFn({formats:dateFormats,defaultWidth:"full"}),time:buildFormatLongFn({formats:timeFormats,defaultWidth:"full"}),dateTime:buildFormatLongFn({formats:dateTimeFormats,defaultWidth:"full"})},formatRelativeLocale={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},formatRelative=(e,i,s,a)=>formatRelativeLocale[e];function buildLocalizeFn(e){return(i,s)=>{const a=s!=null&&s.context?String(s.context):"standalone";let _;if(a==="formatting"&&e.formattingValues){const nt=e.defaultFormattingWidth||e.defaultWidth,c=s!=null&&s.width?String(s.width):nt;_=e.formattingValues[c]||e.formattingValues[nt]}else{const nt=e.defaultWidth,c=s!=null&&s.width?String(s.width):e.defaultWidth;_=e.values[c]||e.values[nt]}const et=e.argumentCallback?e.argumentCallback(i):i;return _[et]}}const eraValues={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},quarterValues={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},monthValues={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},dayValues={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},dayPeriodValues={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},formattingDayPeriodValues={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},ordinalNumber=(e,i)=>{const s=Number(e),a=s%100;if(a>20||a<10)switch(a%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},localize={ordinalNumber,era:buildLocalizeFn({values:eraValues,defaultWidth:"wide"}),quarter:buildLocalizeFn({values:quarterValues,defaultWidth:"wide",argumentCallback:e=>e-1}),month:buildLocalizeFn({values:monthValues,defaultWidth:"wide"}),day:buildLocalizeFn({values:dayValues,defaultWidth:"wide"}),dayPeriod:buildLocalizeFn({values:dayPeriodValues,defaultWidth:"wide",formattingValues:formattingDayPeriodValues,defaultFormattingWidth:"wide"})};function buildMatchFn(e){return(i,s={})=>{const a=s.width,_=a&&e.matchPatterns[a]||e.matchPatterns[e.defaultMatchWidth],et=i.match(_);if(!et)return null;const nt=et[0],c=a&&e.parsePatterns[a]||e.parsePatterns[e.defaultParseWidth],ct=Array.isArray(c)?findIndex(c,Tt=>Tt.test(nt)):findKey(c,Tt=>Tt.test(nt));let dt;dt=e.valueCallback?e.valueCallback(ct):ct,dt=s.valueCallback?s.valueCallback(dt):dt;const gt=i.slice(nt.length);return{value:dt,rest:gt}}}function findKey(e,i){for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&i(e[s]))return s}function findIndex(e,i){for(let s=0;s<e.length;s++)if(i(e[s]))return s}function buildMatchPatternFn(e){return(i,s={})=>{const a=i.match(e.matchPattern);if(!a)return null;const _=a[0],et=i.match(e.parsePattern);if(!et)return null;let nt=e.valueCallback?e.valueCallback(et[0]):et[0];nt=s.valueCallback?s.valueCallback(nt):nt;const c=i.slice(_.length);return{value:nt,rest:c}}}const matchOrdinalNumberPattern=/^(\d+)(th|st|nd|rd)?/i,parseOrdinalNumberPattern=/\d+/i,matchEraPatterns={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},parseEraPatterns={any:[/^b/i,/^(a|c)/i]},matchQuarterPatterns={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},parseQuarterPatterns={any:[/1/i,/2/i,/3/i,/4/i]},matchMonthPatterns={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},parseMonthPatterns={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},matchDayPatterns={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},parseDayPatterns={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},matchDayPeriodPatterns={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},parseDayPeriodPatterns={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},match={ordinalNumber:buildMatchPatternFn({matchPattern:matchOrdinalNumberPattern,parsePattern:parseOrdinalNumberPattern,valueCallback:e=>parseInt(e,10)}),era:buildMatchFn({matchPatterns:matchEraPatterns,defaultMatchWidth:"wide",parsePatterns:parseEraPatterns,defaultParseWidth:"any"}),quarter:buildMatchFn({matchPatterns:matchQuarterPatterns,defaultMatchWidth:"wide",parsePatterns:parseQuarterPatterns,defaultParseWidth:"any",valueCallback:e=>e+1}),month:buildMatchFn({matchPatterns:matchMonthPatterns,defaultMatchWidth:"wide",parsePatterns:parseMonthPatterns,defaultParseWidth:"any"}),day:buildMatchFn({matchPatterns:matchDayPatterns,defaultMatchWidth:"wide",parsePatterns:parseDayPatterns,defaultParseWidth:"any"}),dayPeriod:buildMatchFn({matchPatterns:matchDayPeriodPatterns,defaultMatchWidth:"any",parsePatterns:parseDayPeriodPatterns,defaultParseWidth:"any"})},enUS={code:"en-US",formatDistance:formatDistance$1,formatLong,formatRelative,localize,match,options:{weekStartsOn:0,firstWeekContainsDate:1}};function formatDistance(e,i,s){const a=getDefaultOptions(),_=(s==null?void 0:s.locale)??a.locale??enUS,et=2520,nt=compareAsc(e,i);if(isNaN(nt))throw new RangeError("Invalid time value");const c=Object.assign({},s,{addSuffix:s==null?void 0:s.addSuffix,comparison:nt});let ct,dt;nt>0?(ct=toDate(i),dt=toDate(e)):(ct=toDate(e),dt=toDate(i));const gt=differenceInSeconds(dt,ct),Tt=(getTimezoneOffsetInMilliseconds(dt)-getTimezoneOffsetInMilliseconds(ct))/1e3,Et=Math.round((gt-Tt)/60);let At;if(Et<2)return s!=null&&s.includeSeconds?gt<5?_.formatDistance("lessThanXSeconds",5,c):gt<10?_.formatDistance("lessThanXSeconds",10,c):gt<20?_.formatDistance("lessThanXSeconds",20,c):gt<40?_.formatDistance("halfAMinute",0,c):gt<60?_.formatDistance("lessThanXMinutes",1,c):_.formatDistance("xMinutes",1,c):Et===0?_.formatDistance("lessThanXMinutes",1,c):_.formatDistance("xMinutes",Et,c);if(Et<45)return _.formatDistance("xMinutes",Et,c);if(Et<90)return _.formatDistance("aboutXHours",1,c);if(Et<minutesInDay){const Mt=Math.round(Et/60);return _.formatDistance("aboutXHours",Mt,c)}else{if(Et<et)return _.formatDistance("xDays",1,c);if(Et<minutesInMonth){const Mt=Math.round(Et/minutesInDay);return _.formatDistance("xDays",Mt,c)}else if(Et<minutesInMonth*2)return At=Math.round(Et/minutesInMonth),_.formatDistance("aboutXMonths",At,c)}if(At=differenceInMonths(dt,ct),At<12){const Mt=Math.round(Et/minutesInMonth);return _.formatDistance("xMonths",Mt,c)}else{const Mt=At%12,Pt=Math.trunc(At/12);return Mt<3?_.formatDistance("aboutXYears",Pt,c):Mt<9?_.formatDistance("overXYears",Pt,c):_.formatDistance("almostXYears",Pt+1,c)}}function formatDistanceToNow(e,i){return formatDistance(e,constructNow(e),i)}function NotificationsPage(){const{user:e}=useAuth(),{notifications:i,loading:s}=useNotifications(e==null?void 0:e.id),a=useNavigate(),_=async et=>{et.read||await markNotificationAsRead(et.id),et.link&&a(et.link)};return s?jsxRuntimeExports.jsx(LoadingAnimation,{}):e?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-32",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border px-4 py-4 flex items-center gap-3 safe-top",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",className:"h-9 w-9 -ml-2 rounded-full hover:bg-muted",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 text-foreground"})})}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold text-foreground",children:"Notifications"})]}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4 space-y-3",children:i.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Bell,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No notifications yet"})]}):i.map((et,nt)=>jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:nt*.05},onClick:()=>_(et),className:cn("p-4 rounded-xl cursor-pointer transition-all relative overflow-hidden",et.read?"bg-card border border-border":"bg-card shadow-soft border border-primary/20 bg-primary/5"),children:[jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsx("div",{className:cn("w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",et.type==="order"?"bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"bg-gray-100 text-gray-600 dark:bg-muted dark:text-muted-foreground"),children:et.type==="order"?jsxRuntimeExports.jsx(Package,{className:"w-5 h-5"}):jsxRuntimeExports.jsx(Info,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-1",children:[jsxRuntimeExports.jsx("h3",{className:cn("text-base",et.read?"font-medium text-foreground/80":"font-bold text-foreground"),children:et.title}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap ml-2",children:formatDistanceToNow(et.createdAt,{addSuffix:!0})})]}),jsxRuntimeExports.jsx("p",{className:cn("text-sm leading-relaxed line-clamp-2",et.read?"text-muted-foreground":"text-foreground/90"),children:et.message})]})]}),!et.read&&jsxRuntimeExports.jsx("div",{className:"absolute top-4 right-2 w-2 h-2 rounded-full bg-primary animate-pulse"})]},et.id))}),jsxRuntimeExports.jsx(BottomNav,{})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4 pb-24",children:[jsxRuntimeExports.jsx(Bell,{className:"w-16 h-16 text-muted-foreground mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"Please login to view notifications"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Login"})}),jsxRuntimeExports.jsx(BottomNav,{})]})}function ScrollToTop(){const{pathname:e}=useLocation();return reactExports.useEffect(()=>{window.scrollTo(0,0)},[e]),null}function NotificationListener(){const{user:e}=useAuth(),{notifications:i}=useNotifications(e==null?void 0:e.id),s=reactExports.useRef(Date.now()),a=useNavigate();return reactExports.useEffect(()=>{if(!e)return;const _=i.filter(et=>et.createdAt>s.current&&!et.read);if(_.length>0){_.forEach(nt=>{ue(nt.title||"New Notification",{description:nt.message,action:nt.link?{label:"View",onClick:()=>a(nt.link)}:void 0})});const et=Math.max(..._.map(nt=>nt.createdAt));s.current=et}},[i,e,a]),null}const queryClient=new QueryClient;function SplashScreen({onFinish:e}){return reactExports.useEffect(()=>{const i=setTimeout(()=>{e()},3e3);return()=>clearTimeout(i)},[e]),jsxRuntimeExports.jsx("div",{className:"w-full h-full",children:jsxRuntimeExports.jsx(LoadingAnimation,{message:"Welcome to Amma Cheythi Vanta..."})})}const AppRoutes=()=>{const[e,i]=reactExports.useState(!0);return e?jsxRuntimeExports.jsx(SplashScreen,{onFinish:()=>i(!1)}):jsxRuntimeExports.jsxs(BrowserRouter,{basename:"/ammacheythivantalive",children:[jsxRuntimeExports.jsx(ScrollToTop,{}),jsxRuntimeExports.jsxs(Routes,{children:[jsxRuntimeExports.jsx(Route,{path:"/",element:jsxRuntimeExports.jsx(HomePage,{})}),jsxRuntimeExports.jsx(Route,{path:"/kitchen/:id",element:jsxRuntimeExports.jsx(KitchenPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/cart",element:jsxRuntimeExports.jsx(CartPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/checkout",element:jsxRuntimeExports.jsx(CheckoutPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/auth",element:jsxRuntimeExports.jsx(AuthPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/profile",element:jsxRuntimeExports.jsx(ProfilePage,{})}),jsxRuntimeExports.jsx(Route,{path:"/settings",element:jsxRuntimeExports.jsx(SettingsPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/help",element:jsxRuntimeExports.jsx(HelpSupportPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/search",element:jsxRuntimeExports.jsx(SearchPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/orders",element:jsxRuntimeExports.jsx(OrdersPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/notifications",element:jsxRuntimeExports.jsx(NotificationsPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/order-success",element:jsxRuntimeExports.jsx(OrderSuccessPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/favorites",element:jsxRuntimeExports.jsx(FavoritesPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/addresses",element:jsxRuntimeExports.jsx(SavedAddressesPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/amma/dashboard",element:jsxRuntimeExports.jsx(AmmaRouteWrapper,{children:jsxRuntimeExports.jsx(AmmaDashboard,{})})}),jsxRuntimeExports.jsx(Route,{path:"/amma/register",element:jsxRuntimeExports.jsx(AmmaRouteWrapper,{children:jsxRuntimeExports.jsx(RegisterKitchen,{})})}),jsxRuntimeExports.jsx(Route,{path:"/amma/add-dish",element:jsxRuntimeExports.jsx(AmmaRouteWrapper,{children:jsxRuntimeExports.jsx(AddDish,{})})}),jsxRuntimeExports.jsx(Route,{path:"/amma/edit-kitchen/:kitchenId",element:jsxRuntimeExports.jsx(AmmaRouteWrapper,{children:jsxRuntimeExports.jsx(EditKitchen,{})})}),jsxRuntimeExports.jsx(Route,{path:"/admin",element:jsxRuntimeExports.jsx(AdminDashboard,{})}),jsxRuntimeExports.jsx(Route,{path:"/franchise-admin",element:jsxRuntimeExports.jsx(FranchiseAdminDashboard,{})}),jsxRuntimeExports.jsx(Route,{path:"/super-admin",element:jsxRuntimeExports.jsx(SuperAdminDashboard,{})}),jsxRuntimeExports.jsx(Route,{path:"/location-select",element:jsxRuntimeExports.jsx(LocationSelectionPage,{})}),jsxRuntimeExports.jsx(Route,{path:"*",element:jsxRuntimeExports.jsx(NotFound,{})})]})]})},App=()=>jsxRuntimeExports.jsx(QueryClientProvider,{client:queryClient,children:jsxRuntimeExports.jsx(AuthProvider,{children:jsxRuntimeExports.jsx(LocationProvider,{children:jsxRuntimeExports.jsx(DataProvider,{children:jsxRuntimeExports.jsx(CartProvider,{children:jsxRuntimeExports.jsxs(TooltipProvider,{children:[jsxRuntimeExports.jsx(Toaster$1,{}),jsxRuntimeExports.jsx(Toaster,{}),jsxRuntimeExports.jsx(NotificationListener,{}),jsxRuntimeExports.jsx(AppRoutes,{})]})})})})})});createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(App,{}));
